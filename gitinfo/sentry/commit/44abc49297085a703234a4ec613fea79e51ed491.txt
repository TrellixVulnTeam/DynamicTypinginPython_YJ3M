commit 44abc49297085a703234a4ec613fea79e51ed491
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Thu Dec 6 13:29:27 2018 -0600

    feat(snuba): Add SENTRY_SNUBA_CONSISTENT environment var for use on wâ€¦ (#10951)
    
    * feat(snuba): Add SENTRY_SNUBA_CONSISTENT environment var for use on workers
    
    * Fix test.

diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 8ffdd7dd56..88d829f371 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -4,6 +4,7 @@ from collections import OrderedDict
 from contextlib import contextmanager
 from datetime import datetime, timedelta
 from dateutil.parser import parse as parse_datetime
+import os
 import pytz
 import re
 import six
@@ -27,7 +28,9 @@ MAX_HASHES = 5000
 # Global Snuba request option override dictionary. Only intended
 # to be used with the `options_override` contextmanager below.
 # NOT THREAD SAFE!
-OVERRIDE_OPTIONS = {}
+OVERRIDE_OPTIONS = {
+    'consistent': os.environ.get('SENTRY_SNUBA_CONSISTENT', 'false').lower() in ('true', '1')
+}
 
 SENTRY_SNUBA_MAP = {
     # general
diff --git a/tests/snuba/test_util.py b/tests/snuba/test_util.py
index 71ef73a380..071f8abdeb 100644
--- a/tests/snuba/test_util.py
+++ b/tests/snuba/test_util.py
@@ -64,10 +64,10 @@ class SnubaUtilTest(TestCase):
             )
 
     def test_override_options(self):
-        assert snuba.OVERRIDE_OPTIONS == {}
+        assert snuba.OVERRIDE_OPTIONS == {'consistent': False}
         with snuba.options_override({'foo': 1}):
-            assert snuba.OVERRIDE_OPTIONS == {'foo': 1}
+            assert snuba.OVERRIDE_OPTIONS == {'foo': 1, 'consistent': False}
             with snuba.options_override({'foo': 2}):
-                assert snuba.OVERRIDE_OPTIONS == {'foo': 2}
-            assert snuba.OVERRIDE_OPTIONS == {'foo': 1}
-        assert snuba.OVERRIDE_OPTIONS == {}
+                assert snuba.OVERRIDE_OPTIONS == {'foo': 2, 'consistent': False}
+            assert snuba.OVERRIDE_OPTIONS == {'foo': 1, 'consistent': False}
+        assert snuba.OVERRIDE_OPTIONS == {'consistent': False}
