commit bbfe68d9a184fa69351543c884e7edc1b9a16153
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Nov 15 01:35:45 2012 -0800

    Move collection truncation code to addMember

diff --git a/src/sentry/static/sentry/coffee/views.coffee b/src/sentry/static/sentry/coffee/views.coffee
index 2e4c679a54..e1ce5c23a2 100644
--- a/src/sentry/static/sentry/coffee/views.coffee
+++ b/src/sentry/static/sentry/coffee/views.coffee
@@ -47,6 +47,10 @@ jQuery ->
 
         addMember: (member) ->
             if not @hasMember(member)
+                # make sure we limit the number shown
+                while @collection.models.length >= @config.maxItems
+                    @collection.pop()
+
                 @collection.add(member)
             else
                 @updateMember(member)
@@ -99,10 +103,6 @@ jQuery ->
                     enableTagOptions: true
                     height: $(el).height()
 
-            # make sure we limit the number shown
-            while @collection.models.length > @config.maxItems
-                @collection.pop()
-
 
         renderMember: (member) ->
             view = new GroupView
diff --git a/src/sentry/static/sentry/scripts/site.js b/src/sentry/static/sentry/scripts/site.js
index ca1b3ea05a..16d863d405 100644
--- a/src/sentry/static/sentry/scripts/site.js
+++ b/src/sentry/static/sentry/scripts/site.js
@@ -485,6 +485,9 @@
 
       OrderedElementsView.prototype.addMember = function(member) {
         if (!this.hasMember(member)) {
+          while (this.collection.models.length >= this.config.maxItems) {
+            this.collection.pop();
+          }
           return this.collection.add(member);
         } else {
           return this.updateMember(member);
@@ -515,7 +518,7 @@
       };
 
       OrderedElementsView.prototype.renderMemberInContainer = function(member) {
-        var $el, $rel, new_pos, _results,
+        var $el, $rel, new_pos,
           _this = this;
         new_pos = this.collection.indexOf(member);
         this.$parent.find('li.empty').remove();
@@ -535,17 +538,12 @@
             $el.insertBefore($rel);
           }
         }
-        $el.find('.sparkline').each(function(_, el) {
+        return $el.find('.sparkline').each(function(_, el) {
           return $(el).sparkline('html', {
             enableTagOptions: true,
             height: $(el).height()
           });
         });
-        _results = [];
-        while (this.collection.models.length > this.config.maxItems) {
-          _results.push(this.collection.pop());
-        }
-        return _results;
       };
 
       OrderedElementsView.prototype.renderMember = function(member) {
