commit 1929b4472015a92af3378717e6ccd901ca027a98
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Mon Jan 22 14:51:44 2018 -0800

    feat(projects): Add endpoint to add/remove teams from project

diff --git a/src/sentry/api/endpoints/project_team_details.py b/src/sentry/api/endpoints/project_team_details.py
new file mode 100644
index 0000000000..2cabd8ec8a
--- /dev/null
+++ b/src/sentry/api/endpoints/project_team_details.py
@@ -0,0 +1,84 @@
+from __future__ import absolute_import
+
+from django.http import Http404
+from rest_framework.response import Response
+
+from sentry.api.bases.project import ProjectEndpoint, ProjectPermission
+from sentry.api.serializers import serialize
+from sentry.api.serializers.models.project import ProjectWithTeamSerializer
+from sentry.models import Team
+
+
+class ProjectTeamsPermission(ProjectPermission):
+    scope_map = {
+        'GET': ['project:read', 'project:write', 'project:admin'],
+        'POST': ['project:write', 'project:admin'],
+        'PUT': ['project:write', 'project:admin'],
+        # allow deletes with write permission because it's just removing
+        # a team from a project and not anything more destructive
+        'DELETE': ['project:write', 'project:admin'],
+    }
+
+
+class ProjectTeamDetailsEndpoint(ProjectEndpoint):
+    permission_classes = (ProjectTeamsPermission, )
+
+    def post(self, request, project, team_slug):
+        """
+        Give a team access to a project
+        ```````````````````````````````
+        :pparam string organization_slug: the slug of the organization.
+        :pparam string project_slug: the slug of the project.
+        :pparam string team_slug: the slug of the project.
+        :auth: required
+        """
+        try:
+            team = Team.objects.get(
+                organization_id=project.organization_id,
+                slug=team_slug,
+            )
+        except Team.DoesNotExist:
+            raise Http404
+        if not request.access.has_team_scope(team, 'project:write'):
+            return Response(
+                {
+                    'detail': ['You do not have permission to perform this action.']
+                },
+                status=403
+            )
+        project.add_team(team)
+        return Response(
+            serialize(project, request.user, ProjectWithTeamSerializer()),
+            status=201,
+        )
+
+    def delete(self, request, project, team_slug):
+        """
+        Revoke a team's access to a project
+        ```````````````````````````````````
+        :pparam string organization_slug: the slug of the organization.
+        :pparam string project_slug: the slug of the project.
+        :pparam string team_slug: the slug of the project.
+        :auth: required
+        """
+        try:
+            team = Team.objects.get(
+                organization_id=project.organization_id,
+                slug=team_slug,
+            )
+        except Team.DoesNotExist:
+            raise Http404
+
+        if not request.access.has_team_scope(team, 'project:write'):
+            return Response(
+                {
+                    'detail': ['You do not have permission to perform this action.']
+                },
+                status=403
+            )
+        project.remove_team(team)
+
+        return Response(
+            serialize(project, request.user, ProjectWithTeamSerializer()),
+            status=200,
+        )
diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index c0a43d305f..8fc75fc002 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -104,6 +104,7 @@ from .endpoints.project_stats import ProjectStatsEndpoint
 from .endpoints.project_tags import ProjectTagsEndpoint
 from .endpoints.project_tagkey_details import ProjectTagKeyDetailsEndpoint
 from .endpoints.project_tagkey_values import ProjectTagKeyValuesEndpoint
+from .endpoints.project_team_details import ProjectTeamDetailsEndpoint
 from .endpoints.project_teams import ProjectTeamsEndpoint
 from .endpoints.project_processingissues import ProjectProcessingIssuesEndpoint, \
     ProjectProcessingIssuesFixEndpoint, ProjectProcessingIssuesDiscardEndpoint
@@ -659,10 +660,15 @@ urlpatterns = patterns(
         name='sentry-api-0-project-tagkey-values'
     ),
     url(
-        r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/teams/',
+        r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/teams/$',
         ProjectTeamsEndpoint.as_view(),
         name='sentry-api-0-project-teams'
     ),
+    url(
+        r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/teams/(?P<team_slug>[^\/]+)/$',
+        ProjectTeamDetailsEndpoint.as_view(),
+        name='sentry-api-0-project-team-details'
+    ),
     url(
         r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/users/$',
         ProjectUsersEndpoint.as_view(),
