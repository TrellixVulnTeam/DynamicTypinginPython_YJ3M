commit 2295a33d151352672bab531597e636a7b1fcdd71
Author: ted kaemming <ted@kaemming.com>
Date:   Thu May 24 15:49:56 2018 -0700

    fix(snuba): Use `tags[sentry:user]` for user distinct count models (#8546)

diff --git a/src/sentry/tsdb/snuba.py b/src/sentry/tsdb/snuba.py
index cc00456f5f..8e3649570a 100644
--- a/src/sentry/tsdb/snuba.py
+++ b/src/sentry/tsdb/snuba.py
@@ -26,8 +26,8 @@ class SnubaTSDB(BaseTSDB):
         TSDBModel.project: ('project_id', None),
         TSDBModel.group: ('issue', None),
         TSDBModel.release: ('tags[sentry:release]', None),
-        TSDBModel.users_affected_by_group: ('issue', 'user_id'),
-        TSDBModel.users_affected_by_project: ('project_id', 'user_id'),
+        TSDBModel.users_affected_by_group: ('issue', 'tags[sentry:user]'),
+        TSDBModel.users_affected_by_project: ('project_id', 'tags[sentry:user]'),
         TSDBModel.frequent_environments_by_group: ('issue', 'environment'),
         TSDBModel.frequent_releases_by_group: ('issue', 'tags[sentry:release]'),
         TSDBModel.frequent_issues_by_project: ('project_id', 'issue'),
diff --git a/tests/snuba/tsdb/test_tsdb_backend.py b/tests/snuba/tsdb/test_tsdb_backend.py
index f2d1f6dca7..6306dd23f1 100644
--- a/tests/snuba/tsdb/test_tsdb_backend.py
+++ b/tests/snuba/tsdb/test_tsdb_backend.py
@@ -72,6 +72,7 @@ class SnubaTSDBTest(TestCase):
                     'foo': 'bar',
                     'baz': 'quux',
                     'environment': self.proj1env1.name,
+                    'sentry:user': 'id:user{}'.format(r // 3300),
                     'sentry:release': six.text_type(r // 3600) * 10,  # 1 per hour
                 },
                 'sentry.interfaces.User': {
