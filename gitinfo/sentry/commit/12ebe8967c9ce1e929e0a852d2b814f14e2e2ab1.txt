commit 12ebe8967c9ce1e929e0a852d2b814f14e2e2ab1
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Jan 19 16:46:46 2013 -0800

    Basic view for showing list of users

diff --git a/src/sentry/templates/sentry/header.html b/src/sentry/templates/sentry/header.html
index 692053f39e..49b0658a0e 100644
--- a/src/sentry/templates/sentry/header.html
+++ b/src/sentry/templates/sentry/header.html
@@ -18,6 +18,7 @@
                 <ul class="nav">
                     {% if project %}
                         <li{% if SECTION == 'stream' %} class="active"{% endif %}><a href="{% url sentry-stream project.slug %}">{% trans "Stream" %}</a></li>
+                        <li{% if SECTION == 'users' %} class="active"{% endif %}><a href="{% url sentry-users project.slug %}">{% trans "Users" %}</a></li>
                         <li{% if SECTION == 'settings' %} class="active"{% endif %}><a href="{% url sentry-manage-project project.slug %}">{% trans "Settings" %}</a></li>
                     {% endif %}
                 </ul>
diff --git a/src/sentry/templates/sentry/users/list.html b/src/sentry/templates/sentry/users/list.html
index 33b3040cee..6abe100aac 100644
--- a/src/sentry/templates/sentry/users/list.html
+++ b/src/sentry/templates/sentry/users/list.html
@@ -6,6 +6,8 @@
 
 {% block title %}Users | {{ project.name }} | {{ block.super }}{% endblock %}
 
+{% block bodyclass %}{% endblock %}
+
 {% block breadcrumb %}
     {{ block.super }}
     <li class="divider">/</li>
@@ -13,40 +15,49 @@
 {% endblock %}
 
 {% block main %}
-    {% paginator user_list from request as user_list %}
-    {% querystring from request without sort as sort_querystring %}
-
-    <div class="btn-toolbar">
-        <div class="btn-group">
-            <a href="#" class="btn dropdown-toggle" data-toggle="dropdown">{% blocktrans with sort_label as label %}Sort by: {{ label }}{% endblocktrans %} <span class="caret"></span></a>
-            <ul class="dropdown-menu">
-                <li{% ifequal sort 'recent' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=recent">{% trans "Last Seen" %}</a></li>
-                <li{% ifequal sort 'new' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=newest">{% trans "First Seen" %}</a></li>
-                <li{% ifequal sort 'events' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=freq">{% trans "Number of Events" %}</a></li>
-                <li class="divider"></li>
-            </ul>
-        </div>
-        <div class="btn-group pull-right">
-            <a class="btn prev{% if not user_list.paginator.has_previous %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
-            <a class="btn next{% if not user_list.paginator.has_next %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+    <section class="body">
+        {% paginator user_list from request as user_list %}
+        {% querystring from request without sort as sort_querystring %}
+
+        <div class="btn-toolbar">
+            <div class="btn-group">
+                <a href="#" class="btn dropdown-toggle" data-toggle="dropdown">{% blocktrans with sort_label as label %}Sort by: {{ label }}{% endblocktrans %} <span class="caret"></span></a>
+                <ul class="dropdown-menu">
+                    <li{% ifequal sort 'recent' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=recent">{{ SORT_OPTIONS.recent }}</a></li>
+                    <li{% ifequal sort 'newest' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=newest">{{ SORT_OPTIONS.newest }}</a></li>
+                    <li{% ifequal sort 'events' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=events">{{ SORT_OPTIONS.events }}</a></li>
+                </ul>
+            </div>
+            <div class="btn-group pull-right">
+                <a class="btn prev{% if not user_list.paginator.has_previous %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+                <a class="btn next{% if not user_list.paginator.has_next %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+            </div>
         </div>
-    </div>
-
-    <div id="user_list"></div>
 
-    <div class="btn-toolbar">
-        <div class="btn-group pull-right">
-            <a class="btn prev{% if not user_list.paginator.has_previous %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
-            <a class="btn next{% if not user_list.paginator.has_next %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+        <table class="table table-bordered table-striped">
+            <thead>
+                <tr>
+                    <th>{% trans "User" %}</th>
+                    <th style="width:150px;text-align:center">{% trans "Last Seen" %}</th>
+                    <th style="width:100px;text-align:center">{% trans "Events Seen" %}</th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for user in user_list.paginator.objects %}
+                    <tr>
+                        <td>{% if user.email %}{{ user.email }}{% else %}{{ user.ident }}{% endif %}</td>
+                        <td style="text-align:center">{{ user.last_seen|timesince }}</td>
+                        <td style="text-align:center">{{ user.num_events|small_count }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+
+        <div class="btn-toolbar">
+            <div class="btn-group pull-right">
+                <a class="btn prev{% if not user_list.paginator.has_previous %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+                <a class="btn next{% if not user_list.paginator.has_next %} disabled{% endif %}" href="?{{ user_list.query_string|escape }}&amp;p={{ user_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+            </div>
         </div>
-    </div>
-
-    <script>
-    $(function(){
-        new app.UserListPage({
-            users: {{ user_list.paginator.objects|to_json:request|safe }}
-        });
-    });
-    </script>
-
+    </section>
 {% endblock %}
diff --git a/src/sentry/web/frontend/users.py b/src/sentry/web/frontend/users.py
index 53852478bf..aaf5990dc2 100644
--- a/src/sentry/web/frontend/users.py
+++ b/src/sentry/web/frontend/users.py
@@ -13,7 +13,11 @@ from sentry.web.decorators import login_required, has_access
 from sentry.web.helpers import render_to_response
 
 DEFAULT_SORT_OPTION = 'recent'
-SORT_OPTIONS = ('recent', 'newest', 'events')
+SORT_OPTIONS = {
+    'recent': 'Last Seen',
+    'newest': 'First Seen',
+    'events': 'Number of Events',
+}
 
 
 @has_access
@@ -32,6 +36,13 @@ def user_list(request, project):
     elif sort == 'events':
         user_list = user_list.order_by('-num_events')
 
+    # TODO: add separate pain for unbound users (e.g. missing email addresses)
+    user_list = user_list.filter(email__isnull=False)
+
     return render_to_response('sentry/users/list.html', {
         'user_list': user_list,
+        'project': project,
+        'sort_label': SORT_OPTIONS[sort],
+        'SECTION': 'users',
+        'SORT_OPTIONS': SORT_OPTIONS,
     }, request)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index cac4dfd171..0db197b40a 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -12,7 +12,7 @@ from django.conf.urls.defaults import include, patterns, url
 
 from sentry.web import api
 from sentry.web.frontend import accounts, generic, groups, events, \
-  projects, admin, docs, teams
+  projects, admin, docs, teams, users
 
 __all__ = ('urlpatterns',)
 
@@ -35,7 +35,6 @@ urlpatterns = patterns('',
     url(r'^_static/(?P<module>[^/]+)/(?P<path>.*)$', generic.static_media, name='sentry-media'),
 
     # Account
-
     url(r'^login/$', accounts.login, name='sentry-login'),
     url(r'^login-redirect/$', accounts.login_redirect, name='sentry-login-redirect'),
     url(r'^logout/$', accounts.logout, name='sentry-logout'),
@@ -47,8 +46,7 @@ urlpatterns = patterns('',
     url(r'^account/settings/identities/$', accounts.list_identities, name='sentry-account-settings-identities'),
     url(r'^account/settings/notifications/$', accounts.notification_settings, name='sentry-account-settings-notifications'),
 
-    # Teams
-
+    # Settings - Teams
     url(r'^account/teams/$', teams.team_list, name='sentry-team-list'),
     url(r'^account/teams/new/$', teams.create_new_team, name='sentry-new-team'),
     url(r'^account/teams/(?P<team_slug>[\w_-]+)/edit/$', teams.manage_team,
@@ -78,8 +76,7 @@ urlpatterns = patterns('',
     url(r'^accept/(?P<member_id>\d+)/(?P<token>\w+)/$', teams.accept_invite,
         name='sentry-accept-invite'),
 
-    # Projects
-
+    # Settings - Projects
     url(r'^account/projects/$', projects.project_list, name='sentry-project-list'),
     url(r'^account/projects/new/$', projects.new_project, name='sentry-new-project'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/edit/$', projects.manage_project,
@@ -111,10 +108,11 @@ urlpatterns = patterns('',
     url(r'^account/projects/(?P<project_id>[\w_-]+)/team/$', projects.manage_project_team,
         name='sentry-manage-project-team'),
 
-    # Global
-
+    # Generic
     url(r'^$', generic.dashboard, name='sentry'),
     url(r'^wall/$', generic.wall_display, name='sentry-wall'),
+
+    # Admin
     url(r'^manage/status/$', admin.status_env, name='sentry-admin-status'),
     url(r'^manage/status/packages/$', admin.status_packages, name='sentry-admin-packages-status'),
     url(r'^manage/status/mail/$', admin.status_mail, name='sentry-admin-mail-status'),
@@ -155,8 +153,10 @@ urlpatterns = patterns('',
     url(r'^api/(?:(?P<project_id>[\w_-]+)/)?stats/$', api.get_stats, name='sentry-api-stats'),
     url(r'^api/(?P<project_id>[\w_-]+)/tags/search/$', api.search_tags, name='sentry-api-search-tags'),
 
-    # Project specific
+    # Users
+    url(r'^(?P<project_id>[\w_-]+)/users/$', users.user_list, name='sentry-users'),
 
+    # Project specific
     url(r'^(?P<project_id>[\w_-]+)/get-started/$', projects.get_started, name='sentry-get-started'),
     url(r'^(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/$', groups.group, name='sentry-group'),
     url(r'^(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/$', groups.group_event_list, name='sentry-group-events'),
