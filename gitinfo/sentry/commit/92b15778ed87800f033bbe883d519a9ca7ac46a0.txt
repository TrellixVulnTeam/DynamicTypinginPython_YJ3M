commit 92b15778ed87800f033bbe883d519a9ca7ac46a0
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Fri Jul 10 22:48:18 2020 +0200

    fix(grouping): Do not crash when logentry.formatted is null (#19818)
    
    Fix SENTRY-H29

diff --git a/src/sentry/data/samples/invalid-interfaces.json b/src/sentry/data/samples/invalid-interfaces.json
index 5013168b5b..91e41665ec 100644
--- a/src/sentry/data/samples/invalid-interfaces.json
+++ b/src/sentry/data/samples/invalid-interfaces.json
@@ -88,8 +88,9 @@
     },
     "logentry": {
         "params": [
-            "missing message or formatted"
-        ]
+            "bogus"
+        ],
+        "formatted": 42
     },
     "request": {
         "method": "unknown",
diff --git a/src/sentry/grouping/strategies/message.py b/src/sentry/grouping/strategies/message.py
index e7f5818d5e..2ad3b6d074 100644
--- a/src/sentry/grouping/strategies/message.py
+++ b/src/sentry/grouping/strategies/message.py
@@ -110,13 +110,13 @@ def trim_message_for_grouping(string):
 @strategy(id="message:v1", interfaces=["message"], variants=["default"], score=0)
 def message_v1(message_interface, **meta):
     return GroupingComponent(
-        id="message", values=[message_interface.message or message_interface.formatted]
+        id="message", values=[message_interface.message or message_interface.formatted or u""]
     )
 
 
 @strategy(id="message:v2", interfaces=["message"], variants=["default"], score=0)
 def message_v2(message_interface, **meta):
-    message_in = message_interface.message or message_interface.formatted
+    message_in = message_interface.message or message_interface.formatted or u""
     message_trimmed = trim_message_for_grouping(message_in)
     hint = "stripped common values" if message_in != message_trimmed else None
     return GroupingComponent(id="message", values=[message_trimmed], hint=hint)
