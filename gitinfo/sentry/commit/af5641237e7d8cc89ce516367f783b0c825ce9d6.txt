commit af5641237e7d8cc89ce516367f783b0c825ce9d6
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Apr 6 11:26:06 2017 -0700

    [js] remove native code frames from grouping algo

diff --git a/src/sentry/interfaces/stacktrace.py b/src/sentry/interfaces/stacktrace.py
index 5b89180381..f68ad2f7ea 100644
--- a/src/sentry/interfaces/stacktrace.py
+++ b/src/sentry/interfaces/stacktrace.py
@@ -368,6 +368,12 @@ class Frame(Interface):
         This is one of the few areas in Sentry that isn't platform-agnostic.
         """
         output = []
+        # Safari throws [native code] frames in for calls like ``forEach``
+        # whereas Chrome ignores these. Let's remove it from the hashing algo
+        # so that they're more likely to group together
+        if self.filename == '[native code]':
+            return output
+
         if self.module:
             if self.is_unhashable_module():
                 output.append('<module>')
diff --git a/tests/sentry/interfaces/test_stacktrace.py b/tests/sentry/interfaces/test_stacktrace.py
index 687a0b7bf0..9c24afcfa8 100644
--- a/tests/sentry/interfaces/test_stacktrace.py
+++ b/tests/sentry/interfaces/test_stacktrace.py
@@ -376,6 +376,15 @@ class StacktraceTest(TestCase):
         result = interface.get_hash()
         assert result == []
 
+    def test_get_hash_ignores_safari_native_code(self):
+        interface = Frame.to_python({
+            'abs_path': '[native code]',
+            'filename': '[native code]',
+            'function': 'forEach',
+        })
+        result = interface.get_hash()
+        self.assertEquals(result, [])
+
     def test_cocoa_culprit(self):
         stacktrace = Stacktrace.to_python(dict(frames=[
             {
