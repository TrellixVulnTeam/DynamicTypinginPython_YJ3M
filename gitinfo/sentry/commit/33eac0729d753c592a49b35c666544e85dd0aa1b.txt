commit 33eac0729d753c592a49b35c666544e85dd0aa1b
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed May 23 16:28:05 2018 -0700

    feat(api): Scrub data across Message interface
    
    Fixes APP-221

diff --git a/src/sentry/utils/data_scrubber.py b/src/sentry/utils/data_scrubber.py
index 74fbc95ac1..c8d5e09325 100644
--- a/src/sentry/utils/data_scrubber.py
+++ b/src/sentry/utils/data_scrubber.py
@@ -95,6 +95,9 @@ class SensitiveDataFilter(object):
         if 'sentry.interfaces.Csp' in data:
             self.filter_csp(data['sentry.interfaces.Csp'])
 
+        if 'sentry.interfaces.Message' in data:
+            self.filter_message(data['sentry.interfaces.Message'])
+
         if 'extra' in data:
             data['extra'] = varmap(self.sanitize, data['extra'])
 
@@ -197,3 +200,9 @@ class SensitiveDataFilter(object):
                     querybits.append(chunk)
             query = '&'.join('='.join(k) for k in querybits)
             data[key] = urlunsplit((scheme, netloc, path, query, fragment))
+
+    def filter_message(self, data):
+        for key in 'message', 'formatted', 'params':
+            val = data.get(key)
+            if val:
+                data[key] = varmap(self.sanitize, val)
diff --git a/tests/sentry/utils/test_data_scrubber.py b/tests/sentry/utils/test_data_scrubber.py
index c6bc567c54..90e5972902 100644
--- a/tests/sentry/utils/test_data_scrubber.py
+++ b/tests/sentry/utils/test_data_scrubber.py
@@ -442,3 +442,22 @@ class SensitiveDataFilterTest(TestCase):
         assert 'sentry.interfaces.Csp' in data
         csp = data['sentry.interfaces.Csp']
         assert csp['blocked_uri'] == 'https://example.com/?foo=[Filtered]&bar=baz'
+
+    def test_message(self):
+        data = {
+            'sentry.interfaces.Message': {
+                'message': 'foo 4571234567890111 bar',
+                'formatted': 'foo 4571234567890111 bar',
+                'params': [1, 'foo 4571234567890111 bar'],
+            },
+        }
+
+        proc = SensitiveDataFilter()
+        proc.apply(data)
+        assert data == {
+            'sentry.interfaces.Message': {
+                'message': FILTER_MASK,
+                'formatted': FILTER_MASK,
+                'params': [1, FILTER_MASK],
+            },
+        }
