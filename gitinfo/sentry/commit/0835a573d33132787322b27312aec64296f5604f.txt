commit 0835a573d33132787322b27312aec64296f5604f
Author: Mark Story <mark@sentry.io>
Date:   Tue Mar 10 09:58:53 2020 -0400

    fix(discover) Fix navigating with user facets (#17537)
    
    The user tags contain more stuff inside them that we need to repack to
    create valid queries. Doing that in querystring utils lets us improve
    both issues and discover.

diff --git a/src/sentry/static/sentry/app/utils/queryString.tsx b/src/sentry/static/sentry/app/utils/queryString.tsx
index 2b1c265c45..cee7e3d926 100644
--- a/src/sentry/static/sentry/app/utils/queryString.tsx
+++ b/src/sentry/static/sentry/app/utils/queryString.tsx
@@ -37,7 +37,14 @@ export function appendTagCondition(
 ): string {
   let currentQuery = Array.isArray(query) ? query.pop() : isString(query) ? query : '';
 
-  if (isString(value) && value.indexOf(' ') > -1) {
+  // The user key values have additional key data inside them.
+  if (key === 'user' && value.includes(':')) {
+    const parts = value.split(':', 2);
+    key = [key, parts[0]].join('.');
+    value = parts[1];
+  }
+
+  if (isString(value) && value.includes(' ')) {
     value = `"${value}"`;
   }
   if (currentQuery) {
diff --git a/tests/js/spec/utils/queryString.spec.js b/tests/js/spec/utils/queryString.spec.js
index f3b3edad65..fad934a0c6 100644
--- a/tests/js/spec/utils/queryString.spec.js
+++ b/tests/js/spec/utils/queryString.spec.js
@@ -55,4 +55,18 @@ describe('appendTagCondition', function() {
     const result = utils.appendTagCondition(null, 'color', 'purple red');
     expect(result).toEqual('color:"purple red"');
   });
+
+  it('special cases user tags', function() {
+    let result = utils.appendTagCondition('', 'user', 'something');
+    expect(result).toEqual('user:something');
+
+    result = utils.appendTagCondition('', 'user', 'id:1');
+    expect(result).toEqual('user.id:1');
+
+    result = utils.appendTagCondition('', 'user', 'email:foo@example.com');
+    expect(result).toEqual('user.email:foo@example.com');
+
+    result = utils.appendTagCondition('', 'user', 'name:jill jones');
+    expect(result).toEqual('user.name:"jill jones"');
+  });
 });
