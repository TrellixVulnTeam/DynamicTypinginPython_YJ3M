commit e460131fd644c12d03099b016987d8a19ebed3fa
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 26 18:55:01 2011 -0800

    Added time spent sort options (might need optimized yet)

diff --git a/sentry/templates/sentry/groups/group_list.html b/sentry/templates/sentry/groups/group_list.html
index b1e166c0af..95c13074bd 100644
--- a/sentry/templates/sentry/groups/group_list.html
+++ b/sentry/templates/sentry/groups/group_list.html
@@ -62,6 +62,9 @@
                 <li{% ifequal sort 'new' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=new">{% trans "First Seen" %}</a></li>
                 <li{% ifequal sort 'freq' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=freq">{% trans "Frequency" %}</a></li>
                 <li class="divider"></li>
+                <li{% ifequal sort 'tottime' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=tottime">{% trans "Total Time Spent" %}</a></li>
+                <li{% ifequal sort 'avgtime' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=avgtime">{% trans "Average Time Spent" %}</a></li>
+                <li class="divider"></li>
                 <li{% ifequal sort 'accel_15' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_15">{% trans "Trending: 15 minutes" %}</a></li>
                 <li{% ifequal sort 'accel_60' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_60">{% trans "Trending: 60 minutes" %}</a></li>
             </ul>
diff --git a/sentry/web/frontend/groups.py b/sentry/web/frontend/groups.py
index a7ca74bd6a..ab52900f97 100644
--- a/sentry/web/frontend/groups.py
+++ b/sentry/web/frontend/groups.py
@@ -63,6 +63,13 @@ def ajax_handler(request, project):
             event_list = event_list.order_by('-first_seen')
         elif sort == 'freq':
             event_list = event_list.order_by('-times_seen')
+        elif sort == 'tottime':
+            event_list = event_list.filter(time_spent_count__gt=0)\
+                                    .order_by('-time_spent_total')
+        elif sort == 'avgtime':
+            event_list = event_list.filter(time_spent_count__gt=0)\
+                                   .extra(select={'avg_time_spent': 'time_spent_total / time_spent_count'})\
+                                   .order_by('-avg_time_spent')
         elif sort and sort.startswith('accel_'):
             event_list = Group.objects.get_accelerated(event_list, minutes=int(sort.split('_', 1)[1]))
         else:
@@ -243,6 +250,15 @@ def group_list(request, project):
     elif sort == 'freq':
         sort_label = 'Frequency'
         event_list = event_list.order_by('-times_seen')
+    elif sort == 'tottime':
+        sort_label = 'Total Time Spent'
+        event_list = event_list.filter(time_spent_count__gt=0)\
+                                .order_by('-time_spent_total')
+    elif sort == 'avgtime':
+        sort_label = 'Average Time Spent'
+        event_list = event_list.filter(time_spent_count__gt=0)\
+                               .extra(select={'avg_time_spent': 'time_spent_total / time_spent_count'})\
+                               .order_by('-avg_time_spent')
     elif sort and sort.startswith('accel_'):
         minutes = int(sort.split('_', 1)[1])
         sort_label = 'Trending: {0} minutes'.format(minutes)
