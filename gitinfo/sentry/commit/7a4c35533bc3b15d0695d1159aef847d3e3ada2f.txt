commit 7a4c35533bc3b15d0695d1159aef847d3e3ada2f
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Thu Mar 1 17:26:21 2018 -0800

    feat: Add primary_hash to event post processing tasks/signals (#7425)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index cef5913142..a0886157f1 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -872,6 +872,7 @@ class EventManager(object):
                 is_sample=is_sample,
                 is_regression=is_regression,
                 is_new_group_environment=is_new_group_environment,
+                primary_hash=hashes[0],
             )
         else:
             self.logger.info('post_process.skip.raw_event', extra={'event_id': event.id})
diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index b7191cc03b..1fdfea1fba 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -121,6 +121,7 @@ def post_process_group(event, is_new, is_regression, is_sample, is_new_group_env
         project=event.project,
         group=event.group,
         event=event,
+        primary_hash=kwargs.get('primary_hash'),
     )
 
 
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index 249b80e930..1215609228 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -822,6 +822,7 @@ class EventManagerTest(TransactionTestCase):
             is_sample=False,
             is_regression=False,
             is_new_group_environment=True,
+            primary_hash='acbd18db4cc2f85cedef654fccc4a4d8',
         )
 
         event = save_event()
@@ -835,6 +836,7 @@ class EventManagerTest(TransactionTestCase):
             is_sample=False,
             is_regression=None,  # XXX: wut
             is_new_group_environment=False,
+            primary_hash='acbd18db4cc2f85cedef654fccc4a4d8',
         )
 
     def test_default_fingerprint(self):
