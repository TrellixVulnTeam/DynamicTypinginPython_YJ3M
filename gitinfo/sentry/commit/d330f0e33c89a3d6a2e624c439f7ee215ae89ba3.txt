commit d330f0e33c89a3d6a2e624c439f7ee215ae89ba3
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Mar 6 18:41:31 2017 -0800

    [api] add test for empty list on sensitive fields

diff --git a/tests/sentry/api/endpoints/test_organization_details.py b/tests/sentry/api/endpoints/test_organization_details.py
index 38520fe5c6..1f298c0eff 100644
--- a/tests/sentry/api/endpoints/test_organization_details.py
+++ b/tests/sentry/api/endpoints/test_organization_details.py
@@ -175,7 +175,7 @@ class OrganizationUpdateTest(APITestCase):
 
         assert org.default_role == 'member'
 
-    def test_empty_safe_fields(self):
+    def test_empty_string_in_array_safe_fields(self):
         org = self.create_organization(owner=self.user)
         self.login_as(user=self.user)
         url = reverse('sentry-api-0-organization-details', kwargs={
@@ -196,8 +196,11 @@ class OrganizationUpdateTest(APITestCase):
 
         assert not options.get('sentry:safe_fields')
 
-    def test_empty_sensitive_fields(self):
+    def test_empty_string_in_array_sensitive_fields(self):
         org = self.create_organization(owner=self.user)
+        OrganizationOption.objects.set_value(
+            org, 'sentry:sensitive_fields', ['foobar'],
+        )
         self.login_as(user=self.user)
         url = reverse('sentry-api-0-organization-details', kwargs={
             'organization_slug': org.slug,
@@ -215,6 +218,30 @@ class OrganizationUpdateTest(APITestCase):
             )
         }
 
+        assert options.get('sentry:sensitive_fields') == ['foobar']
+
+    def test_empty_sensitive_fields(self):
+        org = self.create_organization(owner=self.user)
+        OrganizationOption.objects.set_value(
+            org, 'sentry:sensitive_fields', ['foobar'],
+        )
+        self.login_as(user=self.user)
+        url = reverse('sentry-api-0-organization-details', kwargs={
+            'organization_slug': org.slug,
+        })
+        response = self.client.put(url, data={
+            'sensitiveFields': [],
+        })
+        assert response.status_code == 200, (response.status_code, response.content)
+        org = Organization.objects.get(id=org.id)
+
+        options = {
+            o.key: o.value
+            for o in OrganizationOption.objects.filter(
+                organization=org,
+            )
+        }
+
         assert not options.get('sentry:sensitive_fields')
 
 
