commit 1a7757e4bd3e6bfcac96e2dffacf18a6c1d19e45
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Apr 5 13:42:08 2018 -0700

    feat(environments): Filter tag keys by environment (#7943)

diff --git a/src/sentry/static/sentry/app/components/group/tagDistributionMeter.jsx b/src/sentry/static/sentry/app/components/group/tagDistributionMeter.jsx
index ae1f005821..18024b6073 100644
--- a/src/sentry/static/sentry/app/components/group/tagDistributionMeter.jsx
+++ b/src/sentry/static/sentry/app/components/group/tagDistributionMeter.jsx
@@ -7,6 +7,7 @@ import SentryTypes from '../../proptypes';
 import TooltipMixin from '../../mixins/tooltip';
 import {escape, percent, deviceNameMapper} from '../../utils';
 import {t} from '../../locale';
+import withEnvironment from '../../utils/withEnvironment';
 
 const TagDistributionMeter = createReactClass({
   displayName: 'TagDistributionMeter',
@@ -17,6 +18,7 @@ const TagDistributionMeter = createReactClass({
     name: PropTypes.string,
     orgId: PropTypes.string.isRequired,
     projectId: PropTypes.string.isRequired,
+    environment: SentryTypes.Environment,
   },
 
   mixins: [
@@ -45,17 +47,21 @@ const TagDistributionMeter = createReactClass({
       this.state.loading !== nextState.loading ||
       this.state.error !== nextState.error ||
       this.props.tag !== nextProps.tag ||
-      this.props.name !== nextProps.name
+      this.props.name !== nextProps.name ||
+      this.props.environment !== nextProps.environment
     );
   },
 
+  componentDidUpdate(prevProps) {
+    if (prevProps.environment !== this.props.environment) {
+      this.fetchData();
+    }
+  },
+
   fetchData() {
-    let url =
-      '/issues/' +
-      this.props.group.id +
-      '/tags/' +
-      encodeURIComponent(this.props.tag) +
-      '/';
+    const {group, tag, environment} = this.props;
+    const url = `/issues/${group.id}/tags/${encodeURIComponent(tag)}/`;
+    const query = environment ? {environment: environment.name} : {};
 
     this.setState({
       loading: true,
@@ -63,7 +69,8 @@ const TagDistributionMeter = createReactClass({
     });
 
     this.api.request(url, {
-      success: (data, _, jqXHR) => {
+      query,
+      success: data => {
         this.setState({
           data,
           error: false,
@@ -168,4 +175,5 @@ const TagDistributionMeter = createReactClass({
   },
 });
 
-export default TagDistributionMeter;
+export {TagDistributionMeter};
+export default withEnvironment(TagDistributionMeter);
diff --git a/tests/js/spec/components/group/tagDistributionMeter.spec.jsx b/tests/js/spec/components/group/tagDistributionMeter.spec.jsx
index ef592df7c0..b16b5b79c6 100644
--- a/tests/js/spec/components/group/tagDistributionMeter.spec.jsx
+++ b/tests/js/spec/components/group/tagDistributionMeter.spec.jsx
@@ -4,7 +4,7 @@ import ReactDOMServer from 'react-dom/server';
 import TestUtils from 'react-dom/test-utils';
 
 import {Client} from 'app/api';
-import TagDistributionMeter from 'app/components/group/tagDistributionMeter';
+import {TagDistributionMeter} from 'app/components/group/tagDistributionMeter';
 
 describe('TagDistributionMeter', function() {
   let sandbox;
