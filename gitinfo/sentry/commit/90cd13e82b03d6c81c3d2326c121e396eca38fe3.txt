commit 90cd13e82b03d6c81c3d2326c121e396eca38fe3
Author: Dan Fuller <dfuller@sentry.io>
Date:   Wed Jan 9 17:49:20 2019 -0800

    fix(api): Fix broken spam email blocking code
    
    Fixes a bug in #10152, so that we actually block invalid email addresses.

diff --git a/src/sentry/web/forms/fields.py b/src/sentry/web/forms/fields.py
index a63bd2bc0b..b42d236710 100644
--- a/src/sentry/web/forms/fields.py
+++ b/src/sentry/web/forms/fields.py
@@ -108,4 +108,4 @@ def email_address_validator(value):
 
 
 class AllowedEmailField(EmailField):
-    default_validators = EmailField.default_validators + [is_valid_email_address]
+    default_validators = EmailField.default_validators + [email_address_validator]
diff --git a/tests/sentry/api/endpoints/test_organization_member_index.py b/tests/sentry/api/endpoints/test_organization_member_index.py
index 777f85496b..6d6de2e0bd 100644
--- a/tests/sentry/api/endpoints/test_organization_member_index.py
+++ b/tests/sentry/api/endpoints/test_organization_member_index.py
@@ -294,3 +294,24 @@ class OrganizationMemberListTest(APITestCase):
             })
 
         assert response.status_code == 400
+
+
+class OrganizationMemberListPostTest(APITestCase):
+    endpoint = 'sentry-api-0-organization-member-index'
+    method = 'post'
+
+    def setUp(self):
+        self.owner_user = self.create_user('foo@localhost', username='foo')
+        self.org = self.create_organization(owner=self.owner_user)
+        self.team = self.create_team(organization=self.org)
+        self.login_as(user=self.owner_user)
+
+    def test(self):
+        resp = self.get_response(
+            self.org.slug,
+            email='1234@qq.com',
+            role='member',
+            teams=[self.team.slug],
+        )
+        assert resp.status_code == 400
+        assert resp.data['email'][0] == 'Enter a valid email address.'
