commit aec3cbcb17b1fb5d202ce39e59a9268827780d33
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Sep 14 18:10:23 2010 -0700

    Support data which hasn't been gzipped

diff --git a/sentry/tests/tests.py b/sentry/tests/tests.py
index 158fbaa4ee..1ae69e4817 100644
--- a/sentry/tests/tests.py
+++ b/sentry/tests/tests.py
@@ -629,6 +629,21 @@ class RemoteSentryTest(TestCase):
         self.assertEquals(instance.server_name, 'not_dcramer.local')
         self.assertEquals(instance.level, 40)
 
+    def testUngzippedData(self):
+        kwargs = {'message': 'hello', 'server_name': 'not_dcramer.local', 'level': 40}
+        data = {
+            
+        }
+        resp = self.client.post(reverse('sentry-store'), {
+            'data': base64.b64encode(pickle.dumps(transform(kwargs))),
+            'key': settings.KEY,
+        })
+        self.assertEquals(resp.status_code, 200)
+        instance = Message.objects.get()
+        self.assertEquals(instance.message, 'hello')
+        self.assertEquals(instance.server_name, 'not_dcramer.local')
+        self.assertEquals(instance.level, 40)
+
     # def testProcess(self):
     #     self.start_test_server()
     #     SentryClient.process(message='hello')
diff --git a/sentry/views.py b/sentry/views.py
index decbd248d0..a24b4f321b 100644
--- a/sentry/views.py
+++ b/sentry/views.py
@@ -6,6 +6,7 @@ except ImportError:
 import datetime
 from math import log
 import logging
+import zlib
 
 try:
     from pygooglechart import SimpleLineChart
@@ -227,7 +228,10 @@ def store(request):
         return HttpResponseForbidden('Missing data')
     
     try:
-        data = pickle.loads(base64.b64decode(data).decode('zlib'))
+        try:
+            data = pickle.loads(base64.b64decode(data).decode('zlib'))
+        except zlib.error, e:
+            data = pickle.loads(base64.b64decode(data))
     except Exception, e:
         return HttpResponseForbidden('Bad data')
 
