commit 4fc87b542e223dff1598ee04b451f52488b2a3fb
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Fri Aug 24 11:18:50 2018 -0700

    feat(jira): Disable integration when uninstalled from jira

diff --git a/src/sentry/integrations/jira/uninstalled.py b/src/sentry/integrations/jira/uninstalled.py
new file mode 100644
index 0000000000..3db1944aa4
--- /dev/null
+++ b/src/sentry/integrations/jira/uninstalled.py
@@ -0,0 +1,34 @@
+from __future__ import absolute_import
+
+
+from django.views.decorators.csrf import csrf_exempt
+
+from sentry.api.base import Endpoint
+from sentry.constants import ObjectStatus
+from sentry.integrations.atlassian_connect import AtlassianConnectValidationError, get_integration_from_jwt
+
+
+class JiraUninstalledEndpoint(Endpoint):
+    authentication_classes = ()
+    permission_classes = ()
+
+    @csrf_exempt
+    def dispatch(self, request, *args, **kwargs):
+        return super(JiraUninstalledEndpoint, self).dispatch(request, *args, **kwargs)
+
+    def post(self, request, *args, **kwargs):
+        try:
+            token = request.META['HTTP_AUTHORIZATION'].split(' ', 1)[1]
+        except (KeyError, IndexError):
+            return self.respond(status=400)
+
+        try:
+            integration = get_integration_from_jwt(
+                token, request.path, 'jira', request.GET, method='POST'
+            )
+        except AtlassianConnectValidationError:
+            return self.respond(status=400)
+
+        integration.update(status=ObjectStatus.DISABLED)
+
+        return self.respond()
diff --git a/src/sentry/integrations/jira/urls.py b/src/sentry/integrations/jira/urls.py
index 8bdd44f061..89ea602bb8 100644
--- a/src/sentry/integrations/jira/urls.py
+++ b/src/sentry/integrations/jira/urls.py
@@ -6,6 +6,7 @@ from .configure import JiraConfigureView
 from .descriptor import JiraDescriptorEndpoint
 from .installed import JiraInstalledEndpoint
 from .search import JiraSearchEndpoint
+from .uninstalled import JiraUninstalledEndpoint
 from .webhooks import JiraIssueUpdatedWebhook
 
 
@@ -14,6 +15,7 @@ urlpatterns = patterns(
     url(r'^configure/$', JiraConfigureView.as_view()),
     url(r'^descriptor/$', JiraDescriptorEndpoint.as_view()),
     url(r'^installed/$', JiraInstalledEndpoint.as_view()),
+    url(r'^uninstalled/$', JiraUninstalledEndpoint.as_view()),
     url(r'^issue-updated/$', JiraIssueUpdatedWebhook.as_view(),
         name='sentry-extensions-jira-issue-updated'),
     url(r'^search/(?P<organization_slug>[^\/]+)/(?P<integration_id>\d+)/$',
diff --git a/tests/sentry/integrations/jira/test_uninstalled.py b/tests/sentry/integrations/jira/test_uninstalled.py
new file mode 100644
index 0000000000..214db2ceec
--- /dev/null
+++ b/tests/sentry/integrations/jira/test_uninstalled.py
@@ -0,0 +1,31 @@
+from __future__ import absolute_import
+
+from mock import patch
+
+from sentry.constants import ObjectStatus
+from sentry.models import Integration
+from sentry.testutils import APITestCase
+
+
+class JiraUninstalledTest(APITestCase):
+    def test_simple(self):
+        org = self.organization
+
+        integration = Integration.objects.create(
+            provider='jira',
+            name='Example Jira',
+            status=ObjectStatus.VISIBLE,
+        )
+        integration.add_organization(org.id)
+
+        path = '/extensions/jira/uninstalled/'
+
+        with patch('sentry.integrations.jira.uninstalled.get_integration_from_jwt', return_value=integration):
+            resp = self.client.post(
+                path,
+                data={},
+                HTTP_AUTHORIZATION='JWT anexampletoken',
+            )
+            integration = Integration.objects.get(id=integration.id)
+            assert integration.status == ObjectStatus.DISABLED
+            assert resp.status_code == 200
