commit b0d02e93b817ab6b37ff52c2d0ac182dd0e57e74
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 27 15:33:07 2012 -0800

    Run upgrade as part of the start process

diff --git a/sentry/commands/control.py b/sentry/commands/control.py
index 382b0eef69..dbbbba5d80 100644
--- a/sentry/commands/control.py
+++ b/sentry/commands/control.py
@@ -62,8 +62,7 @@ def get_daemon_for_service(service, daemonize=True, **options):
 @consume_args
 def start(args, daemonize=False, debug=False):
     from sentry.conf import settings
-
-    service = get_service_from_args(args)
+    from sentry.commands.upgrade import upgrade
 
     if not os.path.exists(settings.LOG_DIR):
         os.makedirs(settings.LOG_DIR)
@@ -71,6 +70,11 @@ def start(args, daemonize=False, debug=False):
     if not os.path.exists(settings.RUN_DIR):
         os.makedirs(settings.RUN_DIR)
 
+    # Ensure we force an environment upgrade before we start the server
+    upgrade()
+
+    service = get_service_from_args(args)
+
     proc = get_daemon_for_service(service, daemonize, debug=debug)
 
     proc.start()
