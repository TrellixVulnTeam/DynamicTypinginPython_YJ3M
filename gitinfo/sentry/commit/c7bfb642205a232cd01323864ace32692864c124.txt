commit c7bfb642205a232cd01323864ace32692864c124
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Thu Jan 24 21:51:48 2019 +0100

    fix: Use get_path in web_crawler filter (#11696)

diff --git a/src/sentry/filters/web_crawlers.py b/src/sentry/filters/web_crawlers.py
index e30056f578..0a784101c5 100644
--- a/src/sentry/filters/web_crawlers.py
+++ b/src/sentry/filters/web_crawlers.py
@@ -4,6 +4,7 @@ import re
 
 from .base import Filter
 from sentry.utils.data_filters import FilterStatKeys
+from sentry.utils.safe import get_path
 
 # not all of these agents are guaranteed to execute JavaScript, but to avoid
 # overhead of identifying which ones do, and which ones will over time we simply
@@ -52,7 +53,7 @@ class WebCrawlersFilter(Filter):
 
     def get_user_agent(self, data):
         try:
-            for key, value in data['request']['headers']:
+            for key, value in get_path(data, 'request', 'headers', filter=True) or ():
                 if key.lower() == 'user-agent':
                     return value
         except LookupError:
