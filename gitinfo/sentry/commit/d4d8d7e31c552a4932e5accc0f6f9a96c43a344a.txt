commit d4d8d7e31c552a4932e5accc0f6f9a96c43a344a
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Fri Jul 20 16:34:38 2018 -0500

    fix(snuba): Convert Snuba start/end to naive UTC (#9135)
    
    Fixes SENTRY-71C
    Fixes SENTRY-71B
    Fixes SENTRY-71A
    Fixes SENTRY-719

diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index cc5e4fd4bb..218ff18876 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -6,6 +6,7 @@ from datetime import datetime, timedelta
 from dateutil.parser import parse as parse_datetime
 from itertools import chain
 from operator import or_
+import pytz
 import six
 import time
 import urllib3
@@ -172,6 +173,11 @@ def query(start, end, groupby, conditions=None, filter_keys=None,
           aggregations=None, rollup=None, arrayjoin=None, limit=None, orderby=None,
           having=None, referrer=None, is_grouprelease=False, selected_columns=None):
 
+    # convert to naive UTC datetimes, as Snuba only deals in UTC
+    # and this avoids offset-naive and offset-aware issues
+    start = start if not start.tzinfo else start.astimezone(pytz.utc).replace(tzinfo=None)
+    end = end if not end.tzinfo else end.astimezone(pytz.utc).replace(tzinfo=None)
+
     aggregations = aggregations or [['count()', '', 'aggregate']]
     filter_keys = filter_keys or {}
     selected_columns = selected_columns or []
