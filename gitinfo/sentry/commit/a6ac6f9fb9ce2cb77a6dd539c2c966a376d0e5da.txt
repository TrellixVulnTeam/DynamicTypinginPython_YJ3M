commit a6ac6f9fb9ce2cb77a6dd539c2c966a376d0e5da
Author: MeredithAnya <meredith.a.heller@gmail.com>
Date:   Thu Feb 21 13:52:37 2019 -0800

    fix(app-platform): Make webhook payloads consistent (#12154)

diff --git a/src/sentry/mediators/sentry_app_installations/installation_notifier.py b/src/sentry/mediators/sentry_app_installations/installation_notifier.py
index 3cdba1f5e8..259e0e310a 100644
--- a/src/sentry/mediators/sentry_app_installations/installation_notifier.py
+++ b/src/sentry/mediators/sentry_app_installations/installation_notifier.py
@@ -49,7 +49,7 @@ class InstallationNotifier(Mediator):
             resource='installation',
             action=self.action,
             install=self.install,
-            data=data,
+            data={'installation': data},
             actor=self.user,
         )
 
diff --git a/src/sentry/tasks/sentry_apps.py b/src/sentry/tasks/sentry_apps.py
index 57bf8225cd..a26fd07992 100644
--- a/src/sentry/tasks/sentry_apps.py
+++ b/src/sentry/tasks/sentry_apps.py
@@ -149,7 +149,9 @@ def _process_resource_change(action, sender, instance_id, retryer=None, *args, *
     )
 
     for installation in installations:
-        send_webhooks(installation, event, data=serialize(instance))
+        data = {}
+        data[name] = serialize(instance)
+        send_webhooks(installation, event, data=data)
 
 
 @instrumented_task('sentry.tasks.process_resource_change', **TASK_OPTIONS)
diff --git a/tests/sentry/mediators/sentry_app_installations/test_installation_notifier.py b/tests/sentry/mediators/sentry_app_installations/test_installation_notifier.py
index fdefb98b5c..b154de63b6 100644
--- a/tests/sentry/mediators/sentry_app_installations/test_installation_notifier.py
+++ b/tests/sentry/mediators/sentry_app_installations/test_installation_notifier.py
@@ -54,15 +54,17 @@ class TestInstallationNotifier(TestCase):
                 'uuid': self.install.uuid,
             },
             'data': {
-                'app': {
-                    'uuid': self.sentry_app.uuid,
-                    'slug': self.sentry_app.slug,
+                'installation': {
+                    'app': {
+                        'uuid': self.sentry_app.uuid,
+                        'slug': self.sentry_app.slug,
+                    },
+                    'organization': {
+                        'slug': self.org.slug,
+                    },
+                    'uuid': self.install.uuid,
+                    'code': self.install.api_grant.code,
                 },
-                'organization': {
-                    'slug': self.org.slug,
-                },
-                'uuid': self.install.uuid,
-                'code': self.install.api_grant.code,
             },
             'actor': {
                 'id': self.user.id,
@@ -95,15 +97,17 @@ class TestInstallationNotifier(TestCase):
                 'uuid': self.install.uuid,
             },
             'data': {
-                'app': {
-                    'uuid': self.sentry_app.uuid,
-                    'slug': self.sentry_app.slug,
+                'installation': {
+                    'app': {
+                        'uuid': self.sentry_app.uuid,
+                        'slug': self.sentry_app.slug,
+                    },
+                    'organization': {
+                        'slug': self.org.slug,
+                    },
+                    'uuid': self.install.uuid,
+                    'code': self.install.api_grant.code,
                 },
-                'organization': {
-                    'slug': self.org.slug,
-                },
-                'uuid': self.install.uuid,
-                'code': self.install.api_grant.code,
             },
             'actor': {
                 'id': self.user.id,
diff --git a/tests/sentry/tasks/test_sentry_apps.py b/tests/sentry/tasks/test_sentry_apps.py
index cb425e8a7a..e53681f03f 100644
--- a/tests/sentry/tasks/test_sentry_apps.py
+++ b/tests/sentry/tasks/test_sentry_apps.py
@@ -187,7 +187,7 @@ class TestProcessResourceChange(TestCase):
 
         assert data['action'] == 'created'
         assert data['installation']['uuid'] == self.install.uuid
-        assert data['data']['id'] == six.text_type(issue.id)
+        assert data['data']['issue']['id'] == six.text_type(issue.id)
         assert faux(safe_urlopen).kwargs_contain('headers.Content-Type')
         assert faux(safe_urlopen).kwargs_contain('headers.Request-ID')
         assert faux(safe_urlopen).kwargs_contain('headers.Sentry-Hook-Resource')
