commit bfeb9370a6b97f6a4876e95af7d6e8c5fd8c426b
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Oct 15 11:52:41 2010 -0700

    Change timesince filter

diff --git a/sentry/media/scripts/global.js b/sentry/media/scripts/global.js
index 961d340154..32a99b85d8 100644
--- a/sentry/media/scripts/global.js
+++ b/sentry/media/scripts/global.js
@@ -110,10 +110,10 @@ function sentryRefresh(){
               var id = el[0];
               var data = el[1];
               if ((row = $('#group_' + id))) {
-                  row.remove();
-                  $('#message_list').prepend(data.html);
                   if (row.attr('data-sentry-count') != data.count) {
                       $('#group_' + id).addClass('fresh');
+                      row.remove();
+                      $('#message_list').prepend(data.html);
                   }
               } else {
                   $('#message_list').prepend(data.html);
diff --git a/sentry/media/styles/global.css b/sentry/media/styles/global.css
index 7af02b8b31..1df269ad13 100644
--- a/sentry/media/styles/global.css
+++ b/sentry/media/styles/global.css
@@ -127,7 +127,7 @@ ul { margin: 1em 0 1em 2em; }
 #sidebar {
     float: right;
     width: 300px;
-    margin: 0em 2em 2em 1.5em;
+    margin: 0em 2em 2em 0em;
     background: inherit;
     overflow: hidden;
     }
diff --git a/sentry/templates/sentry/group/details.html b/sentry/templates/sentry/group/details.html
index d04d2bdefc..a34ec386be 100644
--- a/sentry/templates/sentry/group/details.html
+++ b/sentry/templates/sentry/group/details.html
@@ -31,9 +31,9 @@
 			<dt>Status:</dt>
 			<dd>{{ group.get_status_display|title }}</dd>
 			<dt>First Seen:</dt>
-			<dd>{{ group.first_seen|date }}<br/><small>{{ group.first_seen|timesince }}</small> ago</dd>
+			<dd>{{ group.first_seen|timesince }}</dd>
 			<dt>Last Seen:</dt>
-			<dd>{{ group.last_seen|date }}<br/><small>{{ group.last_seen|timesince }}</small> ago</dd>
+			<dd>{{ group.last_seen|timesince }}</dd>
 		</dl>
 		
 		{% for html in group|get_widgets:request %}
@@ -46,7 +46,7 @@
 			<li class="{% cycle 'row1' 'row2' %} level-{{ group.level }} active" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
 				<span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
 				<h3>{% if group.view %}{{ group.view }}{% else %}{{ group.message }}{% endif %}</h3>
-				<span class="last_seen">{{ group.last_seen|timesince }} ago</span>
+				<span class="last_seen">{{ group.last_seen|timesince }}</span>
 				<span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
 				<p class="message"><span class="tag tag-level">{{ group.get_level_display }}</span> {{ group.error }}</p>
 				{% if group.status == 0 %}
diff --git a/sentry/templates/sentry/group/message.html b/sentry/templates/sentry/group/message.html
index 1b0f8b434f..144018e98a 100644
--- a/sentry/templates/sentry/group/message.html
+++ b/sentry/templates/sentry/group/message.html
@@ -10,7 +10,7 @@
 		<li class="row1 active level-{{ message.level }}" data-sentry-count="{{ message.times_seen }}">
 			<h3><a href="{% url sentry-group-message group.pk message.pk %}">{% if message.url %}{{ message.url }}{% else %}{{ message.server_name }}{% endif %}</a></h3>
 			<span class="status status-{{ message.status }}">{{ message.get_status_display }}</span>
-			<p class="message"><span class="tag tag-level">{{ message.get_level_display }}</span> <span class="tag tag-server">{{ message.server_name }}</span><span class="last_seen">{{ message.datetime|timesince }} ago</span>
+			<p class="message"><span class="tag tag-level">{{ message.get_level_display }}</span> <span class="tag tag-server">{{ message.server_name }}</span><span class="last_seen">{{ message.datetime|timesince }}</span>
 			</p>
 		    <a href="{% url sentry-group-message group.pk message.pk %}" class="row_link"></a>
 		</li>
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index eb1d041700..a736b28a74 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -3,7 +3,7 @@
 <li class="{% cycle 'row1' 'row2' %} level-{{ group.level }}{% if priority %} priority-{{ priority }}{% endif %}" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
 	<span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
 	<h3><a href="{% url sentry-group group.pk %}">{% if group.view %}{{ group.view }}{% else %}{{ group.message }}{% endif %}</a></h3>
-	<span class="last_seen">{{ group.last_seen|timesince }} ago</span>
+	<span class="last_seen">{{ group.last_seen|timesince }}</span>
 	<span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
 	<p class="message">
 		<span class="tag tag-level">{{ group.get_level_display }}</span> 
diff --git a/sentry/templates/sentry/partial/_message.html b/sentry/templates/sentry/partial/_message.html
index ec98a115e3..a96535b55e 100644
--- a/sentry/templates/sentry/partial/_message.html
+++ b/sentry/templates/sentry/partial/_message.html
@@ -3,7 +3,7 @@
 <li class="{% cycle 'row1' 'row2' %} level-{{ message.level }}{% if priority %} priority-{{ priority }}{% endif %}" id="message_{{ message.pk }}" data-sentry-count="{{ message.times_seen }}">
 	<h3><a href="{% url sentry-group-message group.pk message.pk %}">{% if message.url %}{{ message.url }}{% else %}{{ message.server_name }}{% endif %}</a></h3>
 	<span class="status status-{{ message.status }}">{{ message.get_status_display }}</span>
-	<p class="message"><span class="tag tag-level">{{ message.get_level_display }}</span> <span class="tag tag-server">{{ message.server_name }}</span><span class="last_seen">{{ message.datetime|timesince }} ago</span>
+	<p class="message"><span class="tag tag-level">{{ message.get_level_display }}</span> <span class="tag tag-server">{{ message.server_name }}</span><span class="last_seen">{{ message.datetime|timesince }}</span>
 	</p>
     <a href="{% url sentry-group-message group.pk message.pk %}" class="row_link"></a>
 </li>
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 48fcad97e7..60f12f7210 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -104,4 +104,18 @@ def get_widgets(group, request):
         resp = inst.widget(request, group)
         if resp:
             yield resp
-register.filter(get_widgets)
\ No newline at end of file
+register.filter(get_widgets)
+
+def timesince(value):
+    from django.template.defaultfilters import timesince
+    if not value:
+        return 'Never'
+    if value < datetime.datetime.now() - datetime.timedelta(days=5):
+        return value.date()
+    value = (' '.join(timesince(value).split(' ')[0:2])).strip(',')
+    if value == '0 minutes':
+        return 'Just now'
+    if value == '1 day':
+        return 'Yesterday'
+    return value + ' ago'
+register.filter(timesince)
\ No newline at end of file
