commit 82b04dbdd0194cc21420baddd61e726cb77b17da
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 22 11:46:11 2013 -0800

    Gracefully handle missing lines in syntax highlighting

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index b121a288c5..abd7c15bb8 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -65,7 +65,13 @@ def get_context(lineno, context_line, pre_context=None, post_context=None, filen
         lexer = TextLexer()
 
     formatter = HtmlFormatter()
-    context = tuple((n, mark_safe(highlight(l, lexer, formatter))) for n, l in context)
+
+    def format(line):
+        if not line:
+            return ''
+        return mark_safe(highlight(l, lexer, formatter))
+
+    context = tuple((n, format(l)) for n, l in context)
 
     return context
 
diff --git a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 5ee474f755..6b0e40236d 100644
--- a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -40,7 +40,7 @@
                     {% if frame.context %}
                         <ol start="{{ frame.start_lineno }}" class="context">
                         {% for num, line in frame.context %}
-                            <li{% if num == frame.lineno %} class="active"{% else %} class="expandable"{% endif %} onclick="$('.frame-{{ forloop.parentloop.counter0 }}').toggleClass('expanded')">{{ line|default_if_none:"" }}</li>
+                            <li{% if num == frame.lineno %} class="active"{% else %} class="expandable"{% endif %} onclick="$('.frame-{{ forloop.parentloop.counter0 }}').toggleClass('expanded')">{{ line }}</li>
                         {% endfor %}
                         </ol>
                     {% endif %}
