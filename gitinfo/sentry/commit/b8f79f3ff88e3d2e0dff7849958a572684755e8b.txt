commit b8f79f3ff88e3d2e0dff7849958a572684755e8b
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Oct 31 10:43:19 2016 -0700

    [search] add culprit to message index (#4442)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index b4e473ca7b..2d0b31de97 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -519,6 +519,10 @@ class EventManager(object):
             if value_u not in message:
                 message = u'{} {}'.format(message, value_u)
 
+        if culprit and culprit not in message:
+            culprit_u = force_text(culprit, errors='replace')
+            message = u'{} {}'.format(message, culprit_u)
+
         message = trim(message.strip(), settings.SENTRY_MAX_MESSAGE_LENGTH)
 
         event.message = message
diff --git a/tests/integration/tests.py b/tests/integration/tests.py
index 03f5d17fe4..7ed99ba50e 100644
--- a/tests/integration/tests.py
+++ b/tests/integration/tests.py
@@ -138,7 +138,7 @@ class RavenIntegrationTest(TransactionTestCase):
         group = Group.objects.get()
         assert group.event_set.count() == 1
         instance = group.event_set.get()
-        assert instance.message == 'foo'
+        assert instance.data['sentry.interfaces.Message']['message'] == 'foo'
 
 
 class SentryRemoteTest(TestCase):
diff --git a/tests/sentry/utils/test_raven.py b/tests/sentry/utils/test_raven.py
index 5ac99355ca..2cfe8dc274 100644
--- a/tests/sentry/utils/test_raven.py
+++ b/tests/sentry/utils/test_raven.py
@@ -19,7 +19,8 @@ class SentryInternalClientTest(TestCase):
             client.captureMessage('internal client test')
 
         event = Event.objects.get()
-        assert event.message == 'internal client test'
+        assert event.data['sentry.interfaces.Message']['message'] == \
+            'internal client test'
         assert send.call_count == 0
 
     @patch.object(SentryInternalClient, 'is_enabled', Mock(return_value=True))
@@ -31,7 +32,8 @@ class SentryInternalClientTest(TestCase):
                     client.captureMessage('internal client test')
 
                 event = Event.objects.get()
-                assert event.message == 'internal client test'
+                assert event.data['sentry.interfaces.Message']['message'] == \
+                    'internal client test'
 
                 # Make sure that the event also got sent upstream
                 assert send.call_count == 1
