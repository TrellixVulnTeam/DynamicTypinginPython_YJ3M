commit e748570d04322c94a4a38a3a1c74b4efa506f26a
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Aug 28 11:28:38 2015 -0700

    Add group status for deletion and merge events

diff --git a/src/sentry/api/endpoints/group_details.py b/src/sentry/api/endpoints/group_details.py
index 6b3163fa37..781ace9df2 100644
--- a/src/sentry/api/endpoints/group_details.py
+++ b/src/sentry/api/endpoints/group_details.py
@@ -321,6 +321,15 @@ class GroupDetailsEndpoint(GroupEndpoint):
         """
         from sentry.tasks.deletion import delete_group
 
-        delete_group.delay(object_id=group.id)
+        updated = Group.objects.filter(
+            id=group.id,
+        ).exclude(
+            status__in=[
+                GroupStatus.PENDING_DELETION,
+                GroupStatus.DELETION_IN_PROGRESS,
+            ]
+        ).update(status=GroupStatus.PENDING_DELETION)
+        if updated:
+            delete_group.delay(object_id=group.id)
 
         return Response(status=202)
diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index 495bc2d202..4bec87a261 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -363,6 +363,7 @@ class ProjectGroupIndexEndpoint(ProjectEndpoint):
             for group in group_list:
                 if group == primary_group:
                     continue
+                group.update(status=GroupStatus.PENDING_MERGE)
                 merge_group.delay(
                     from_object_id=group.id,
                     to_object_id=primary_group.id,
diff --git a/src/sentry/api/serializers/models/group.py b/src/sentry/api/serializers/models/group.py
index 81f7312ca2..c6597b642e 100644
--- a/src/sentry/api/serializers/models/group.py
+++ b/src/sentry/api/serializers/models/group.py
@@ -106,6 +106,10 @@ class GroupSerializer(Serializer):
             status_label = 'resolved'
         elif status == GroupStatus.MUTED:
             status_label = 'muted'
+        elif status in [GroupStatus.PENDING_DELETION, GroupStatus.DELETION_IN_PROGRESS]:
+            status_label = 'pending_deletion'
+        elif status == GroupStatus.PENDING_MERGE:
+            status_label = 'pending_merge'
         else:
             status_label = 'unresolved'
 
diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index f7db18e96b..38f3ac37c4 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -37,6 +37,9 @@ class GroupStatus(object):
     UNRESOLVED = 0
     RESOLVED = 1
     MUTED = 2
+    PENDING_DELETION = 3
+    DELETION_IN_PROGRESS = 4
+    PENDING_MERGE = 5
 
 
 class GroupManager(BaseManager):
diff --git a/src/sentry/tasks/deletion.py b/src/sentry/tasks/deletion.py
index 65325c720f..f96742dfcd 100644
--- a/src/sentry/tasks/deletion.py
+++ b/src/sentry/tasks/deletion.py
@@ -135,8 +135,8 @@ def delete_project(object_id, continuous=True, **kwargs):
 @retry
 def delete_group(object_id, continuous=True, **kwargs):
     from sentry.models import (
-        Group, GroupHash, GroupRuleStatus, GroupTagKey, GroupTagValue,
-        EventMapping
+        EventMapping, Group, GroupHash, GroupRuleStatus, GroupStatus,
+        GroupTagKey, GroupTagValue
     )
 
     try:
@@ -144,6 +144,9 @@ def delete_group(object_id, continuous=True, **kwargs):
     except Group.DoesNotExist:
         return
 
+    if group.status != GroupStatus.DELETION_IN_PROGRESS:
+        group.update(status=GroupStatus.DELETION_IN_PROGRESS)
+
     bulk_model_list = (
         GroupHash, GroupRuleStatus, GroupTagValue, GroupTagKey, EventMapping
     )
