commit 3b386e2fef5f99920c3ad2213bde8698919645a9
Author: Dora <dora.l.chan@gmail.com>
Date:   Thu Jun 25 11:31:46 2020 -0700

    ref(icon refactor): replace icon anchor (#19401)
    
    * make title hover over show anchor
    
    * fix permalink issue
    
    * update snapshot
    
    Co-authored-by: Dora Chan <dora.lchan@gmail.com>
    Co-authored-by: Priscila Oliveira <priscila.oliveira@sentry.io>

diff --git a/src/sentry/static/sentry/app/components/events/eventDataSection.tsx b/src/sentry/static/sentry/app/components/events/eventDataSection.tsx
index d01e309525..7d1b5ac0b0 100644
--- a/src/sentry/static/sentry/app/components/events/eventDataSection.tsx
+++ b/src/sentry/static/sentry/app/components/events/eventDataSection.tsx
@@ -6,6 +6,7 @@ import {css} from '@emotion/core';
 import {t} from 'app/locale';
 import {callIfFunction} from 'app/utils/callIfFunction';
 import {DataSection} from 'app/components/events/styles';
+import {IconAnchor} from 'app/icons/iconAnchor';
 import Button from 'app/components/button';
 import ButtonBar from 'app/components/buttonBar';
 import space from 'app/styles/space';
@@ -14,6 +15,7 @@ const defaultProps = {
   wrapTitle: true,
   raw: false,
   isCentered: false,
+  showPermalink: true,
 };
 
 type DefaultProps = Readonly<typeof defaultProps>;
@@ -69,6 +71,7 @@ class EventDataSection extends React.Component<Props> {
       wrapTitle,
       actions,
       isCentered,
+      showPermalink,
     } = this.props;
 
     const titleNode = wrapTitle ? <h3>{title}</h3> : title;
@@ -77,10 +80,14 @@ class EventDataSection extends React.Component<Props> {
       <DataSection className={className || ''}>
         {title && (
           <SectionHeader id={type} isCentered={isCentered}>
-            <Permalink href={'#' + type} className="permalink">
-              <em className="icon-anchor" />
-            </Permalink>
-            {titleNode}
+            {showPermalink ? (
+              <Permalink href={'#' + type} className="permalink">
+                <StyledIconAnchor />
+                {titleNode}
+              </Permalink>
+            ) : (
+              <div>{titleNode}</div>
+            )}
             {type === 'extra' && (
               <ButtonBar merged active={raw ? 'raw' : 'formatted'}>
                 <Button
@@ -108,22 +115,23 @@ class EventDataSection extends React.Component<Props> {
   }
 }
 
-const Permalink = styled('a')`
-  font-size: ${p => p.theme.fontSizeSmall};
-  line-height: 27px;
+const StyledIconAnchor = styled(IconAnchor)`
   display: none;
   position: absolute;
-  top: -1.5px;
+  top: 4px;
   left: -22px;
-  color: ${p => p.theme.gray400};
-  padding: ${space(0.25)} 5px;
+`;
+
+const Permalink = styled('a')`
+  :hover ${StyledIconAnchor} {
+    display: block;
+    color: ${p => p.theme.gray500};
+  }
 `;
 
 const SectionHeader = styled('div')<{isCentered?: boolean}>`
   display: flex;
-  justify-content: space-between;
   align-items: center;
-  position: relative;
   margin-bottom: ${space(3)};
 
   & h3,
@@ -157,10 +165,6 @@ const SectionHeader = styled('div')<{isCentered?: boolean}>`
     font-weight: normal;
   }
 
-  &:hover ${Permalink} {
-    display: block;
-  }
-
   @media (min-width: ${props => props.theme.breakpoints[2]}) {
     & > small {
       margin-left: ${space(1)};
@@ -176,6 +180,11 @@ const SectionHeader = styled('div')<{isCentered?: boolean}>`
         display: block;
       }
     `}
+
+  >*:first-child {
+    position: relative;
+    flex-grow: 1;
+  }
 `;
 
 const SectionContents = styled('div')`
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/crashHeader.jsx b/src/sentry/static/sentry/app/components/events/interfaces/crashHeader.jsx
index 6cb06fdfc4..4d7a589d96 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/crashHeader.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/crashHeader.jsx
@@ -186,33 +186,18 @@ const Wrapper = styled('div')`
   display: flex;
   justify-content: space-between;
   flex-wrap: wrap;
-  width: 100%;
 `;
 
-const TitleWrapper = styled('div')`
+const TitleWrapper = styled('span')`
   display: flex;
   flex-wrap: wrap;
   align-items: center;
-  > * {
-    margin-bottom: ${space(0.5)};
-    :last-child {
-      margin-bottom: 0;
-    }
-  }
-
-  @media (min-width: ${props => props.theme.breakpoints[0]}) {
-    > * {
-      margin-right: ${space(0.5)};
-      margin-bottom: 0;
-      :last-child {
-        margin-right: ${space(1)};
-      }
-    }
-  }
+  flex-grow: 1;
+  justify-content: flex-start;
 `;
 
 const ButtonGroup = styled(ButtonBar)`
-  padding: ${space(1.5)} ${space(1)} ${space(1.5)} 0;
+  padding-right: ${space(1)};
 `;
 
 const ButtonGroupWrapper = styled('div')`
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/threads/threads.jsx b/src/sentry/static/sentry/app/components/events/interfaces/threads/threads.jsx
index 7e8d25c2dc..d4ea7c1317 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/threads/threads.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/threads/threads.jsx
@@ -211,6 +211,7 @@ class ThreadsInterface extends React.Component {
         event={evt}
         type={this.props.type}
         title={title}
+        showPermalink={!threads.length > 1}
         wrapTitle={false}
       >
         <Thread
diff --git a/tests/js/spec/components/__snapshots__/toggleRawEventData.spec.jsx.snap b/tests/js/spec/components/__snapshots__/toggleRawEventData.spec.jsx.snap
index 0e4bfbfe97..111a08ff5c 100644
--- a/tests/js/spec/components/__snapshots__/toggleRawEventData.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/toggleRawEventData.spec.jsx.snap
@@ -12,13 +12,11 @@ exports[`EventDataSection renders formatted 1`] = `
       className="permalink"
       href="#extra"
     >
-      <em
-        className="icon-anchor"
-      />
+      <StyledIconAnchor />
+      <h3>
+        Additional Data
+      </h3>
     </Permalink>
-    <h3>
-      Additional Data
-    </h3>
     <ButtonBar
       active="formatted"
       merged={true}
@@ -55,13 +53,11 @@ exports[`EventDataSection renders raw 1`] = `
       className="permalink"
       href="#extra"
     >
-      <em
-        className="icon-anchor"
-      />
+      <StyledIconAnchor />
+      <h3>
+        Additional Data
+      </h3>
     </Permalink>
-    <h3>
-      Additional Data
-    </h3>
     <ButtonBar
       active="raw"
       merged={true}
diff --git a/tests/js/spec/components/events/__snapshots__/sdkUpdates.spec.jsx.snap b/tests/js/spec/components/events/__snapshots__/sdkUpdates.spec.jsx.snap
index 32e2f75beb..f379717353 100644
--- a/tests/js/spec/components/events/__snapshots__/sdkUpdates.spec.jsx.snap
+++ b/tests/js/spec/components/events/__snapshots__/sdkUpdates.spec.jsx.snap
@@ -31,6 +31,7 @@ exports[`EventSdkUpdates renders a suggestion to update the sdk and then enable
   <EventDataSection
     isCentered={false}
     raw={false}
+    showPermalink={true}
     title={null}
     type="sdk-updates"
     wrapTitle={true}
@@ -43,7 +44,7 @@ exports[`EventSdkUpdates renders a suggestion to update the sdk and then enable
       >
         <SectionContents>
           <div
-            className="css-16dhebx-SectionContents e1fbjd862"
+            className="css-16dhebx-SectionContents e1fbjd863"
           >
             <Alert
               icon="icon-upgrade"
diff --git a/tests/js/spec/views/sharedGroupDetails/__snapshots__/index.spec.jsx.snap b/tests/js/spec/views/sharedGroupDetails/__snapshots__/index.spec.jsx.snap
index 03312334a4..ddc302d9b1 100644
--- a/tests/js/spec/views/sharedGroupDetails/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/views/sharedGroupDetails/__snapshots__/index.spec.jsx.snap
@@ -571,6 +571,7 @@ exports[`SharedGroupDetails renders 1`] = `
                               }
                               isCentered={false}
                               raw={false}
+                              showPermalink={true}
                               title="Message"
                               type="message"
                               wrapTitle={true}
@@ -586,7 +587,7 @@ exports[`SharedGroupDetails renders 1`] = `
                                     isCentered={false}
                                   >
                                     <div
-                                      className="css-n08n7b-SectionHeader e1fbjd861"
+                                      className="css-8d8cxx-SectionHeader e1fbjd862"
                                       id="message"
                                     >
                                       <Permalink
@@ -594,22 +595,40 @@ exports[`SharedGroupDetails renders 1`] = `
                                         href="#message"
                                       >
                                         <a
-                                          className="permalink css-rl8enl-Permalink e1fbjd860"
+                                          className="permalink css-8q4au4-Permalink e1fbjd861"
                                           href="#message"
                                         >
-                                          <em
-                                            className="icon-anchor"
-                                          />
+                                          <StyledIconAnchor>
+                                            <IconAnchor
+                                              className="css-1x65iks-StyledIconAnchor e1fbjd860"
+                                            >
+                                              <ForwardRef(SvgIcon)
+                                                className="css-1x65iks-StyledIconAnchor e1fbjd860"
+                                              >
+                                                <svg
+                                                  className="css-1x65iks-StyledIconAnchor e1fbjd860"
+                                                  fill="currentColor"
+                                                  height="16px"
+                                                  viewBox="0 0 16 16"
+                                                  width="16px"
+                                                >
+                                                  <path
+                                                    d="M8,1.59a.31.31,0,1,0,.31.31A.31.31,0,0,0,8,1.59ZM6.19,1.9A1.81,1.81,0,1,1,8.75,3.55v2h4.66a.75.75,0,0,1,0,1.5H8.75v7.32a6.87,6.87,0,0,0,5.57-4.12.75.75,0,0,1,1.44.3v2.5a.75.75,0,0,1-1.5,0,8.38,8.38,0,0,1-12.52,0,.75.75,0,0,1-1.5,0v-2.5a.75.75,0,0,1,1.44-.3,6.87,6.87,0,0,0,5.57,4.12V7.05H2.59a.75.75,0,1,1,0-1.5H7.25v-2A1.81,1.81,0,0,1,6.19,1.9Z"
+                                                  />
+                                                </svg>
+                                              </ForwardRef(SvgIcon)>
+                                            </IconAnchor>
+                                          </StyledIconAnchor>
+                                          <h3>
+                                            Message
+                                          </h3>
                                         </a>
                                       </Permalink>
-                                      <h3>
-                                        Message
-                                      </h3>
                                     </div>
                                   </SectionHeader>
                                   <SectionContents>
                                     <div
-                                      className="css-16dhebx-SectionContents e1fbjd862"
+                                      className="css-16dhebx-SectionContents e1fbjd863"
                                     >
                                       <pre
                                         className="plain"
