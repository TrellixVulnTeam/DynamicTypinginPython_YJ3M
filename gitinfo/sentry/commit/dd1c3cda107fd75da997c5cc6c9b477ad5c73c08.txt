commit dd1c3cda107fd75da997c5cc6c9b477ad5c73c08
Author: David Cramer <dcramer@gmail.com>
Date:   Thu May 13 11:03:14 2010 -0700

    Make sure everything is properly coerced to a unicode value before pickling

diff --git a/djangodblog/__init__.py b/djangodblog/__init__.py
index 83d78f0e2d..29734dbc4b 100644
--- a/djangodblog/__init__.py
+++ b/djangodblog/__init__.py
@@ -1 +1 @@
-__version__ = (1, 7, 3)
\ No newline at end of file
+__version__ = (1, 7, 4)
\ No newline at end of file
diff --git a/djangodblog/manager.py b/djangodblog/manager.py
index e1d9ca455e..8a5e97a9ac 100644
--- a/djangodblog/manager.py
+++ b/djangodblog/manager.py
@@ -119,9 +119,8 @@ class DBLogManager(models.Manager):
 
         def to_unicode(f):
             if isinstance(f, dict):
-                nf = dict()
                 for k, v in f.iteritems():
-                    nf[k] = to_unicode(v)
+                    f[str(k)] = to_unicode(v)
             elif isinstance(f, (list, tuple)):
                 f = [to_unicode(f) for f in f]
             else:
@@ -129,10 +128,10 @@ class DBLogManager(models.Manager):
             return f
 
         reporter = ExceptionReporter(None, exc_type, exc_value, traceback)
-        frames = to_unicode(reporter.get_traceback_frames())
+        frames = reporter.get_traceback_frames()
 
         data = kwargs.pop('data', {})
-        data['exc'] = base64.b64encode(pickle.dumps([exc_type.__class__.__module__, exc_value.args, frames]))
+        data['exc'] = base64.b64encode(pickle.dumps(map(to_unicode, [exc_type.__class__.__module__, exc_value.args, frames])))
 
         tb_message = '\n'.join(traceback_mod.format_exception(exc_type, exc_value, traceback))
 
