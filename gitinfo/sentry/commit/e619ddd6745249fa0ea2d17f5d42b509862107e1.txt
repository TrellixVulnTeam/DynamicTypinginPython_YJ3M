commit e619ddd6745249fa0ea2d17f5d42b509862107e1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 6 10:50:58 2018 -0700

    Additional fixes

diff --git a/src/sentry/south_migrations/0392_auto__add_projectownership.py b/src/sentry/south_migrations/0392_auto__add_projectownership.py
index 75170930d6..14d11b539c 100644
--- a/src/sentry/south_migrations/0392_auto__add_projectownership.py
+++ b/src/sentry/south_migrations/0392_auto__add_projectownership.py
@@ -20,8 +20,8 @@ class Migration(SchemaMigration):
             ('raw', self.gf('django.db.models.fields.TextField')(null=True)),
             ('schema', self.gf('jsonfield.fields.JSONField')(null=True)),
             ('fallthrough', self.gf('django.db.models.fields.BooleanField')(default=True)),
-            ('date_created', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
-            ('last_updated', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_created', self.gf('django.db.models.fields.DateTimeField')()),
+            ('last_updated', self.gf('django.db.models.fields.DateTimeField')()),
             ('is_active', self.gf('django.db.models.fields.BooleanField')(default=True)),
         ))
         db.send_create_signal('sentry', ['ProjectOwnership'])
diff --git a/src/sentry/south_migrations/0395_auto__add_releaseprojectenvironment__add_unique_releaseprojectenvironm.py b/src/sentry/south_migrations/0395_auto__add_releaseprojectenvironment__add_unique_releaseprojectenvironm.py
index d69dc04037..1f16cd6c30 100644
--- a/src/sentry/south_migrations/0395_auto__add_releaseprojectenvironment__add_unique_releaseprojectenvironm.py
+++ b/src/sentry/south_migrations/0395_auto__add_releaseprojectenvironment__add_unique_releaseprojectenvironm.py
@@ -22,9 +22,9 @@ class Migration(SchemaMigration):
             ('environment', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
                 to=orm['sentry.Environment'])),
             ('new_issues_count', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(default=0)),
-            ('first_seen', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('first_seen', self.gf('django.db.models.fields.DateTimeField')()),
             ('last_seen', self.gf('django.db.models.fields.DateTimeField')(
-                default=datetime.datetime.now, db_index=True)),
+                db_index=True)),
         ))
         db.send_create_signal('sentry', ['ReleaseProjectEnvironment'])
 
diff --git a/src/sentry/south_migrations/0400_auto__add_projectredirect__add_unique_projectredirect_organization_red.py b/src/sentry/south_migrations/0400_auto__add_projectredirect__add_unique_projectredirect_organization_red.py
index 8a717c4a71..a6486c180d 100644
--- a/src/sentry/south_migrations/0400_auto__add_projectredirect__add_unique_projectredirect_organization_red.py
+++ b/src/sentry/south_migrations/0400_auto__add_projectredirect__add_unique_projectredirect_organization_red.py
@@ -20,7 +20,7 @@ class Migration(SchemaMigration):
                 to=orm['sentry.Project'])),
             ('organization', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
                 to=orm['sentry.Organization'])),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['ProjectRedirect'])
 
diff --git a/src/sentry/south_migrations/0413_auto__add_externalissue__add_unique_externalissue_organization_id_inte.py b/src/sentry/south_migrations/0413_auto__add_externalissue__add_unique_externalissue_organization_id_inte.py
index 3c4b83ad97..b1e8c9d4a6 100644
--- a/src/sentry/south_migrations/0413_auto__add_externalissue__add_unique_externalissue_organization_id_inte.py
+++ b/src/sentry/south_migrations/0413_auto__add_externalissue__add_unique_externalissue_organization_id_inte.py
@@ -18,7 +18,7 @@ class Migration(SchemaMigration):
             ('organization_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')()),
             ('integration_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')()),
             ('key', self.gf('django.db.models.fields.CharField')(max_length=128)),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
             ('title', self.gf('django.db.models.fields.TextField')(null=True)),
             ('description', self.gf('django.db.models.fields.TextField')(null=True)),
         ))
diff --git a/src/sentry/south_migrations/0415_auto__add_relay.py b/src/sentry/south_migrations/0415_auto__add_relay.py
index 37dea4ff37..c13efbe89b 100644
--- a/src/sentry/south_migrations/0415_auto__add_relay.py
+++ b/src/sentry/south_migrations/0415_auto__add_relay.py
@@ -17,8 +17,8 @@ class Migration(SchemaMigration):
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
             ('relay_id', self.gf('django.db.models.fields.CharField')(unique=True, max_length=64)),
             ('public_key', self.gf('django.db.models.fields.CharField')(max_length=200)),
-            ('first_seen', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
-            ('last_seen', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('first_seen', self.gf('django.db.models.fields.DateTimeField')()),
+            ('last_seen', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['Relay'])
 
diff --git a/src/sentry/south_migrations/0422_auto__add_grouphashtombstone__add_unique_grouphashtombstone_project_ha.py b/src/sentry/south_migrations/0422_auto__add_grouphashtombstone__add_unique_grouphashtombstone_project_ha.py
index 5101a60dd4..45a35673ed 100644
--- a/src/sentry/south_migrations/0422_auto__add_grouphashtombstone__add_unique_grouphashtombstone_project_ha.py
+++ b/src/sentry/south_migrations/0422_auto__add_grouphashtombstone__add_unique_grouphashtombstone_project_ha.py
@@ -15,9 +15,10 @@ class Migration(SchemaMigration):
         # Adding model 'GroupHashTombstone'
         db.create_table('sentry_grouphashtombstone', (
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
-            ('project', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(to=orm['sentry.Project'])),
+            ('project', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
+                to=orm['sentry.Project'])),
             ('hash', self.gf('django.db.models.fields.CharField')(max_length=32)),
-            ('deleted_at', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('deleted_at', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['GroupHashTombstone'])
 
diff --git a/src/sentry/south_migrations/0426_auto__add_sentryappinstallation__add_sentryapp__add_field_user_is_sent.py b/src/sentry/south_migrations/0426_auto__add_sentryappinstallation__add_sentryapp__add_field_user_is_sent.py
index 27df0bd77d..c66e68e16b 100644
--- a/src/sentry/south_migrations/0426_auto__add_sentryappinstallation__add_sentryapp__add_field_user_is_sent.py
+++ b/src/sentry/south_migrations/0426_auto__add_sentryappinstallation__add_sentryapp__add_field_user_is_sent.py
@@ -16,13 +16,28 @@ class Migration(SchemaMigration):
         db.create_table('sentry_sentryappinstallation', (
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
             ('date_deleted', self.gf('django.db.models.fields.DateTimeField')(null=True, blank=True)),
-            ('sentry_app', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(related_name='installations', to=orm['sentry.SentryApp'])),
-            ('organization', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(related_name='sentry_app_installations', to=orm['sentry.Organization'])),
-            ('authorization', self.gf('django.db.models.fields.related.OneToOneField')(related_name='sentry_app_installation', unique=True, null=True, on_delete=models.SET_NULL, to=orm['sentry.ApiAuthorization'])),
-            ('api_grant', self.gf('django.db.models.fields.related.OneToOneField')(related_name='sentry_app_installation', unique=True, null=True, on_delete=models.SET_NULL, to=orm['sentry.ApiGrant'])),
-            ('uuid', self.gf('django.db.models.fields.CharField')(default='b0d8118e-f1fa-4224-a090-28c812ef94e4', max_length=64)),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
-            ('date_updated', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('sentry_app', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
+                related_name='installations', to=orm['sentry.SentryApp'])),
+            ('organization', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
+                related_name='sentry_app_installations', to=orm['sentry.Organization'])),
+            ('authorization',
+             self.gf('django.db.models.fields.related.OneToOneField')(related_name='sentry_app_installation',
+                                                                      unique=True,
+                                                                      null=True,
+                                                                      on_delete=models.SET_NULL,
+                                                                      to=orm['sentry.ApiAuthorization'])),
+            (
+                'api_grant',
+                self.gf('django.db.models.fields.related.OneToOneField')(
+                    related_name='sentry_app_installation',
+                    unique=True,
+                    null=True,
+                    on_delete=models.SET_NULL,
+                    to=orm['sentry.ApiGrant'])),
+            ('uuid', self.gf('django.db.models.fields.CharField')
+             (default='b0d8118e-f1fa-4224-a090-28c812ef94e4', max_length=64)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
+            ('date_updated', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['SentryAppInstallation'])
 
@@ -30,23 +45,29 @@ class Migration(SchemaMigration):
         db.create_table('sentry_sentryapp', (
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
             ('date_deleted', self.gf('django.db.models.fields.DateTimeField')(null=True, blank=True)),
-            ('application', self.gf('django.db.models.fields.related.OneToOneField')(related_name='sentry_app', unique=True, to=orm['sentry.ApiApplication'])),
-            ('proxy_user', self.gf('django.db.models.fields.related.OneToOneField')(related_name='sentry_app', unique=True, to=orm['sentry.User'])),
-            ('owner', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(related_name='owned_sentry_apps', to=orm['sentry.User'])),
+            ('application', self.gf('django.db.models.fields.related.OneToOneField')
+             (related_name='sentry_app', unique=True, to=orm['sentry.ApiApplication'])),
+            ('proxy_user', self.gf('django.db.models.fields.related.OneToOneField')(
+                related_name='sentry_app', unique=True, to=orm['sentry.User'])),
+            ('owner', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
+                related_name='owned_sentry_apps', to=orm['sentry.User'])),
             ('scopes', self.gf('django.db.models.fields.BigIntegerField')(default=None)),
-            ('scope_list', self.gf('sentry.db.models.fields.array.ArrayField')(of=('django.db.models.fields.TextField', [], {}))),
+            ('scope_list', self.gf('sentry.db.models.fields.array.ArrayField')(
+                of=('django.db.models.fields.TextField', [], {}))),
             ('name', self.gf('django.db.models.fields.TextField')()),
             ('slug', self.gf('django.db.models.fields.CharField')(unique=True, max_length=64)),
-            ('uuid', self.gf('django.db.models.fields.CharField')(default='45ab4e12-5a17-461b-8665-bca3fbe00836', max_length=64)),
+            ('uuid', self.gf('django.db.models.fields.CharField')
+             (default='45ab4e12-5a17-461b-8665-bca3fbe00836', max_length=64)),
             ('webhook_url', self.gf('django.db.models.fields.TextField')()),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
-            ('date_updated', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
+            ('date_updated', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['SentryApp'])
 
         # Adding field 'User.is_sentry_app'
         db.add_column('auth_user', 'is_sentry_app',
-                      self.gf('django.db.models.fields.NullBooleanField')(default=None, null=True, blank=True),
+                      self.gf('django.db.models.fields.NullBooleanField')(
+                          default=None, null=True, blank=True),
                       keep_default=False)
 
     def backwards(self, orm):
diff --git a/src/sentry/south_migrations/0427_auto__add_eventattachment__add_unique_eventattachment_project_id_event.py b/src/sentry/south_migrations/0427_auto__add_eventattachment__add_unique_eventattachment_project_id_event.py
index 2ae71ce3a1..c7bc543741 100644
--- a/src/sentry/south_migrations/0427_auto__add_eventattachment__add_unique_eventattachment_project_id_event.py
+++ b/src/sentry/south_migrations/0427_auto__add_eventattachment__add_unique_eventattachment_project_id_event.py
@@ -18,9 +18,10 @@ class Migration(SchemaMigration):
             ('project_id', self.gf('sentry.db.models.fields.bounded.BoundedBigIntegerField')()),
             ('group_id', self.gf('sentry.db.models.fields.bounded.BoundedBigIntegerField')(null=True)),
             ('event_id', self.gf('django.db.models.fields.CharField')(max_length=32)),
-            ('file', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(to=orm['sentry.File'])),
+            ('file', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(
+                to=orm['sentry.File'])),
             ('name', self.gf('django.db.models.fields.TextField')()),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
         ))
         db.send_create_signal('sentry', ['EventAttachment'])
 
diff --git a/src/sentry/south_migrations/0429_auto__add_integrationexternalproject__add_unique_integrationexternalpr.py b/src/sentry/south_migrations/0429_auto__add_integrationexternalproject__add_unique_integrationexternalpr.py
index 74fa08348f..0b324fdd60 100644
--- a/src/sentry/south_migrations/0429_auto__add_integrationexternalproject__add_unique_integrationexternalpr.py
+++ b/src/sentry/south_migrations/0429_auto__add_integrationexternalproject__add_unique_integrationexternalpr.py
@@ -17,7 +17,7 @@ class Migration(SchemaMigration):
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
             ('organization_integration_id', self.gf(
                 'sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(db_index=True)),
-            ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
+            ('date_added', self.gf('django.db.models.fields.DateTimeField')()),
             ('name', self.gf('django.db.models.fields.CharField')(max_length=128)),
             ('external_id', self.gf('django.db.models.fields.CharField')(max_length=64)),
             ('resolved_status', self.gf('django.db.models.fields.CharField')(max_length=64)),
diff --git a/src/sentry/utils/pytest/sentry.py b/src/sentry/utils/pytest/sentry.py
index 80ef9d2a79..1f4dec5922 100644
--- a/src/sentry/utils/pytest/sentry.py
+++ b/src/sentry/utils/pytest/sentry.py
@@ -173,6 +173,10 @@ def pytest_configure(config):
     configure_structlog()
     fix_south(settings)
 
+    import django
+    if hasattr(django, 'setup'):
+        django.setup()
+
     bind_cache_to_option_store()
 
     initialize_receivers()
