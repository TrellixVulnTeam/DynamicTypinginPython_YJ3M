commit 5d9a97ecea982c8b09c59e05b6982a1a551ddc4a
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jan 15 15:39:30 2015 -0800

    Correct project member endpoint (no access group support)

diff --git a/src/sentry/api/endpoints/project_member_index.py b/src/sentry/api/endpoints/project_member_index.py
index 7fc5eebe3a..bcb2deb008 100644
--- a/src/sentry/api/endpoints/project_member_index.py
+++ b/src/sentry/api/endpoints/project_member_index.py
@@ -16,9 +16,11 @@ class ProjectMemberIndexEndpoint(Endpoint):
         assert_perm(project, request.user, request.auth)
 
         member_list = sorted(set(User.objects.filter(
-            Q(member_set__team=project.team) |
-            Q(accessgroup__projects=project),
-        )[:1000]), key=lambda x: x.email)
+            sentry_orgmember_set__organization=project.organization,
+        ).filter(
+            Q(sentry_orgmember_set__teams=project.team) |
+            Q(sentry_orgmember_set__has_global_access=True)
+        ).distinct()[:1000]), key=lambda x: x.email)
 
         member_list = serialize(member_list, request.user)
 
diff --git a/tests/sentry/api/endpoints/test_project_member_index.py b/tests/sentry/api/endpoints/test_project_member_index.py
index 9c36966b45..e5824d4546 100644
--- a/tests/sentry/api/endpoints/test_project_member_index.py
+++ b/tests/sentry/api/endpoints/test_project_member_index.py
@@ -1,5 +1,7 @@
+from __future__ import absolute_import
+
 from django.core.urlresolvers import reverse
-from sentry.models import AccessGroup
+
 from sentry.testutils import APITestCase
 
 
@@ -8,12 +10,12 @@ class ProjectMemberIndexTest(APITestCase):
         user_1 = self.create_user('foo@localhost', username='foo')
         user_2 = self.create_user('bar@localhost', username='bar')
         user_3 = self.create_user('baz@localhost', username='baz')
-        team = self.create_team(slug='baz', owner=user_1)
+        org = self.create_organization(owner=user_1)
+        team = self.create_team(organization=org, slug='baz')
         project_1 = self.create_project(team=team, slug='foo')
         project_2 = self.create_project(team=team, slug='bar')
-        ag = AccessGroup.objects.create(team=team, name='foo')
-        ag.projects.add(project_1)
-        ag.members.add(user_2)
+        org.member_set.create(user=user_2, has_global_access=True)
+        org.member_set.create(user=user_3, has_global_access=False)
 
         self.login_as(user=user_1)
 
@@ -23,5 +25,5 @@ class ProjectMemberIndexTest(APITestCase):
         response = self.client.get(url)
         assert response.status_code == 200
         assert len(response.data) == 2
-        assert response.data[0]['email'] == 'bar@localhost'
-        assert response.data[1]['email'] == 'foo@localhost'
+        assert response.data[0]['email'] == user_2.email
+        assert response.data[1]['email'] == user_1.email
