commit d271599a6508e75cecb768140835cd9027c18d80
Author: NisanthanNanthakumar <nisanthan.nanthakumar@sentry.io>
Date:   Mon Mar 2 11:14:40 2020 -0800

    feat(IntegrationDirectory): Update integrationViewController to use experiment variants (#17389)
    
    Control which version of the Integration Directory is shown to the user by the IntegrationDirectoryExperiment Planout experiment.

diff --git a/src/sentry/static/sentry/app/types/index.tsx b/src/sentry/static/sentry/app/types/index.tsx
index f835cbedf8..dbac620b17 100644
--- a/src/sentry/static/sentry/app/types/index.tsx
+++ b/src/sentry/static/sentry/app/types/index.tsx
@@ -828,6 +828,7 @@ export type SentryAppComponent = {
 
 export type ActiveExperiments = {
   TrialUpgradeV2Experiment: 'upgrade' | 'trial' | -1;
+  IntegrationDirectoryExperiment: '1' | '0';
   AlertDefaultsExperimentTmp: 'testControl' | 'test2Options' | 'test3Options';
 };
 
diff --git a/src/sentry/static/sentry/app/utils/integrationUtil.tsx b/src/sentry/static/sentry/app/utils/integrationUtil.tsx
index 4fc70fc409..1b8eb435e7 100644
--- a/src/sentry/static/sentry/app/utils/integrationUtil.tsx
+++ b/src/sentry/static/sentry/app/utils/integrationUtil.tsx
@@ -28,8 +28,16 @@ export const clearAnalyticsSession = () => {
 export const getAnalyticsSessionId = () =>
   window.sessionStorage.getItem(INTEGRATIONS_ANALYTICS_SESSION_KEY);
 
-export const isIntegrationDirectoryActive = () =>
-  localStorage.getItem(USE_INTEGRATION_DIRECTORY) === '1';
+export const isIntegrationDirectoryActive = (organization?: Organization) => {
+  const variant = organization?.experiments?.IntegrationDirectoryExperiment;
+  if (localStorage.getItem(USE_INTEGRATION_DIRECTORY) === '1') {
+    return true;
+  } else if (localStorage.getItem(USE_INTEGRATION_DIRECTORY) === '0') {
+    return false;
+  } else {
+    return variant && variant === '1';
+  }
+};
 
 export type SingleIntegrationEvent = {
   eventKey:
@@ -127,7 +135,7 @@ export const trackIntegrationEvent = (
     analytics_session_id: sessionId,
     organization_id: org?.id,
     role: org?.role,
-    integration_directory_active: isIntegrationDirectoryActive(),
+    integration_directory_active: isIntegrationDirectoryActive(org),
     ...analyticsParams,
   };
 
diff --git a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationViewController.tsx b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationViewController.tsx
index 065421eeef..91faa17df3 100644
--- a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationViewController.tsx
+++ b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationViewController.tsx
@@ -1,13 +1,23 @@
 import React from 'react';
+import {RouteComponentProps} from 'react-router/lib/Router';
 
 import {isIntegrationDirectoryActive} from 'app/utils/integrationUtil.tsx';
+import withOrganization from 'app/utils/withOrganization';
+import {Organization} from 'app/types';
 
 import Control from './index';
 import Test from './integrationListDirectory';
 
-export default function IntegrationViewController(props) {
-  if (isIntegrationDirectoryActive()) {
+type Props = RouteComponentProps<{orgId: string}, {}> & {
+  organization: Organization;
+  hideHeader: boolean;
+};
+
+function IntegrationViewController(props: Props) {
+  if (isIntegrationDirectoryActive(props.organization)) {
     return <Test {...props} />;
   }
   return <Control {...props} />;
 }
+
+export default withOrganization(IntegrationViewController);
