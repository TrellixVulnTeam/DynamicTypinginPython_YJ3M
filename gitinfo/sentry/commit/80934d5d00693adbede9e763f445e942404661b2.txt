commit 80934d5d00693adbede9e763f445e942404661b2
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jun 3 12:11:27 2012 -0700

    Improve dashboard to show multiple intervals for trends and new events

diff --git a/bootstrap/sentry.less b/bootstrap/sentry.less
index 6cdb27419e..4848d263e8 100644
--- a/bootstrap/sentry.less
+++ b/bootstrap/sentry.less
@@ -462,20 +462,25 @@ footer {
 
     &.event-small {
       min-height: 30px;
-      padding: 10px 10px 10px 60px;
+      padding: 8px 10px 8px 60px;
 
       h3 {
-        margin-top: 2px;
+        margin: 0;
         font-size: 14px;
+        line-height: 16px;
+      }
+
+      .message {
+        font-size: 12px;
       }
 
       .count {
         left: 10px;
-        font-size: 11px;
-        width: 40px;
-        height: 30px;
-        line-height: 32px;
-        .border-radius(10px);
+        font-size: 12px;
+        width: 36px;
+        height: 36px;
+        line-height: 38px;
+        .border-radius(36px);
       }
 
       .meta {
@@ -800,3 +805,18 @@ legend {
   vertical-align: middle;
   border-radius: 3px;
 }
+
+
+.nav-pills > li.active > a {
+  background-color: lighten(@linkColor, 10%);
+}
+.nav-small {
+  &.nav-pills > li > a {
+    padding: 5px 8px;
+    font-size: 12px;
+  }
+}
+
+.page-header h3.pull-left {
+  margin-right: 10px;
+}
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index 85050033a7..29ba314958 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -4093,21 +4093,25 @@ footer a {
 }
 .events .event.event-small {
   min-height: 30px;
-  padding: 10px 10px 10px 60px;
+  padding: 8px 10px 8px 60px;
 }
 .events .event.event-small h3 {
-  margin-top: 2px;
+  margin: 0;
   font-size: 14px;
+  line-height: 16px;
+}
+.events .event.event-small .message {
+  font-size: 12px;
 }
 .events .event.event-small .count {
   left: 10px;
-  font-size: 11px;
-  width: 40px;
-  height: 30px;
-  line-height: 32px;
-  -webkit-border-radius: 10px;
-  -moz-border-radius: 10px;
-  border-radius: 10px;
+  font-size: 12px;
+  width: 36px;
+  height: 36px;
+  line-height: 38px;
+  -webkit-border-radius: 36px;
+  -moz-border-radius: 36px;
+  border-radius: 36px;
 }
 .events .event.event-small .meta {
   right: 10px;
@@ -4461,3 +4465,13 @@ legend {
   vertical-align: middle;
   border-radius: 3px;
 }
+.nav-pills > li.active > a {
+  background-color: #70ace6;
+}
+.nav-small.nav-pills > li > a {
+  padding: 5px 8px;
+  font-size: 12px;
+}
+.page-header h3.pull-left {
+  margin-right: 10px;
+}
diff --git a/sentry/static/styles/global.min.css b/sentry/static/styles/global.min.css
index fc6282b11a..b3e6889d76 100644
--- a/sentry/static/styles/global.min.css
+++ b/sentry/static/styles/global.min.css
@@ -694,8 +694,9 @@ footer a{color:#fff;font-weight:bold;}
 .events .event.level-fatal .count{background:#f0431c;}
 .events .event.resolved h3{text-decoration:line-through;}
 .events .event.resolved .count{opacity:0.5;filter:alpha(opacity=50);}
-.events .event.event-small{min-height:30px;padding:10px 10px 10px 60px;}.events .event.event-small h3{margin-top:2px;font-size:14px;}
-.events .event.event-small .count{left:10px;font-size:11px;width:40px;height:30px;line-height:32px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;}
+.events .event.event-small{min-height:30px;padding:8px 10px 8px 60px;}.events .event.event-small h3{margin:0;font-size:14px;line-height:16px;}
+.events .event.event-small .message{font-size:12px;}
+.events .event.event-small .count{left:10px;font-size:12px;width:36px;height:36px;line-height:38px;-webkit-border-radius:36px;-moz-border-radius:36px;border-radius:36px;}
 .events .event.event-small .meta{right:10px;}
 .events .event.event-small .tag,.events .event.event-small .meta{font-size:11px;}
 label{font-weight:bold;}
@@ -765,3 +766,6 @@ legend{margin-bottom:18px;}
 .datepicker-box .submit .help-block{margin-top:0;padding-top:5px;}
 #daterange{display:none;}
 .avatar{vertical-align:middle;border-radius:3px;}
+.nav-pills>li.active>a{background-color:#70ace6;}
+.nav-small.nav-pills>li>a{padding:5px 8px;font-size:12px;}
+.page-header h3.pull-left{margin-right:10px;}
diff --git a/sentry/templates/sentry/dashboard.html b/sentry/templates/sentry/dashboard.html
index 6b33801921..2562b62ddb 100644
--- a/sentry/templates/sentry/dashboard.html
+++ b/sentry/templates/sentry/dashboard.html
@@ -24,7 +24,12 @@
             </div>
             {% if top_event_list %}
                 <div class="page-header">
-                    <h3>{% trans "Top Events" %} <small>{% trans "Today" %}</small></h3>
+                    <h3 class="pull-left">{% trans "Trends" %}</h3>
+                    <ul class="nav nav-pills nav-small">
+                        <li class="active"><a href="#">{% trans "15 minutes" %}</a></li>
+                        <li><a href="#">{% trans "60 minutes" %}</a></li>
+                        <li><a href="#">{% trans "24 hours" %}</a></li>
+                    </ul>
                 </div>
                 <ul class="events" id="event_list">
                     {% for group in top_event_list %}
@@ -32,9 +37,14 @@
                     {% endfor %}
                 </ul>
             {% endif %}
-            <div class="page-header">
-                <h3>{% trans "New Events" %} <small>{% trans "Today" %}</small></h3>
-            </div>
+                <div class="page-header">
+                    <h3 class="pull-left">{% trans "New Events" %}</h3>
+                    <ul class="nav nav-pills nav-small">
+                        <li class="active"><a href="#">{% trans "15 minutes" %}</a></li>
+                        <li><a href="#">{% trans "60 minutes" %}</a></li>
+                        <li><a href="#">{% trans "24 hours" %}</a></li>
+                    </ul>
+                </div>
             {% if new_event_list %}
                 <ul class="events" id="event_list">
                     {% for group in new_event_list %}
diff --git a/sentry/templates/sentry/partial/_group_small.html b/sentry/templates/sentry/partial/_group_small.html
index 14ddbe4ad8..4b2202e5a7 100644
--- a/sentry/templates/sentry/partial/_group_small.html
+++ b/sentry/templates/sentry/partial/_group_small.html
@@ -14,6 +14,9 @@
                 {% endif %}
             </a>
         </h3>
+        <p class="message" title="{{ group.message }}">
+            {{ group.error }}
+        </p>
         <div class="meta">
             <span class="last-seen pretty-date" title="{{ group.last_seen|date:"c" }}Z">{{ group.last_seen|timesince }}</span>
             {% if group.avg_time_spent %}
diff --git a/sentry/web/frontend/generic.py b/sentry/web/frontend/generic.py
index 56ac9f725c..122ea7c3ce 100644
--- a/sentry/web/frontend/generic.py
+++ b/sentry/web/frontend/generic.py
@@ -15,6 +15,9 @@ from sentry.models import Group
 from sentry.web.decorators import login_required
 from sentry.web.helpers import get_project_list, render_to_response, \
   get_login_url
+from sentry.utils.db import has_trending
+
+DASHBOARD_EVENTS = 5
 
 
 @login_required
@@ -30,15 +33,16 @@ def dashboard(request):
             status=0,
         ).select_related('project').order_by('-score')
 
-        # TODO: change this to calculate the most frequent events in the time period,
-        # not just events seen within the time period that have at one time been frequent
-        top_event_list = list(base_qs.filter(
-            last_seen__gte=cutoff
-        )[:10])
+        if has_trending():
+            top_event_list = list(Group.objects.get_accelerated(base_qs, minutes=60 * 24)[:DASHBOARD_EVENTS])
+        else:
+            top_event_list = list(base_qs.filter(
+                last_seen__gte=cutoff
+            )[:DASHBOARD_EVENTS])
 
         new_event_list = list(base_qs.filter(
             active_at__gte=cutoff,
-        )[:10])
+        )[:DASHBOARD_EVENTS])
     else:
         top_event_list = None
         new_event_list = None
