commit 1edde6a34003cffbc3c34d3849123c7a072fb229
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Tue Apr 16 14:55:55 2019 +0200

    fix(symbolicator): Various fixes (#12796)
    
    * fix: Update casing for builtin sources
    
    * build: Run snuba in symbolicator tests
    
    Followup to #12207
    
    * fix: Do not crash on missing abs_path

diff --git a/.travis.yml b/.travis.yml
index 8699832963..a57f8168d9 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -209,22 +209,14 @@ matrix:
         - nvm install
         - npm install -g "yarn@${YARN_VERSION}"
 
-    - python: 2.7
+    - <<: *postgres_default
       name: 'Symbolicator Integration'
       env: TEST_SUITE=symbolicator
-      services:
-        - docker
-        - memcached
-        - redis-server
-        - postgresql
       before_install:
+        - docker run -d --network host --name clickhouse-server --ulimit nofile=262144:262144 yandex/clickhouse-server:18.14.9
+        - docker run -d --network host --name snuba --env SNUBA_SETTINGS=test --env CLICKHOUSE_SERVER=localhost:9000 getsentry/snuba
         - docker run -d --network host --name symbolicator us.gcr.io/sentryio/symbolicator:latest run
         - docker ps -a
-      install:
-        - python setup.py install_egg_info
-        - pip install -e ".[dev,tests,optional]"
-      before_script:
-        - psql -c 'create database sentry;' -U postgres
 
     # snuba in testing
     - python: 2.7
diff --git a/src/sentry/lang/native/plugin.py b/src/sentry/lang/native/plugin.py
index 6b95df9132..0fa7daa808 100644
--- a/src/sentry/lang/native/plugin.py
+++ b/src/sentry/lang/native/plugin.py
@@ -416,10 +416,11 @@ class NativeStacktraceProcessor(StacktraceProcessor):
             new_frame['function'] = sfrm['function']
             if sfrm.get('symbol'):
                 new_frame['symbol'] = sfrm['symbol']
-            new_frame['abs_path'] = sfrm['abs_path']
-            new_frame['filename'] = sfrm.get('filename') or \
-                (sfrm['abs_path'] and posixpath.basename(sfrm['abs_path'])) or \
-                None
+            if sfrm.get('abs_path'):
+                new_frame['abs_path'] = sfrm['abs_path']
+                new_frame['filename'] = posixpath.basename(sfrm['abs_path'])
+            if sfrm.get('filename'):
+                new_frame['filename'] = sfrm['filename']
             if sfrm.get('lineno'):
                 new_frame['lineno'] = sfrm['lineno']
             if sfrm.get('colno'):
diff --git a/src/sentry/lang/native/symbolicator.py b/src/sentry/lang/native/symbolicator.py
index 427355f6bb..65dea75888 100644
--- a/src/sentry/lang/native/symbolicator.py
+++ b/src/sentry/lang/native/symbolicator.py
@@ -28,7 +28,7 @@ BUILTIN_SOURCES = {
     'microsoft': {
         'type': 'http',
         'id': 'sentry:microsoft',
-        'layout': 'symstore',
+        'layout': {'type': 'symstore'},
         'filetypes': ['pdb', 'pe'],
         'url': 'https://msdl.microsoft.com/download/symbols/',
         'is_public': True,
