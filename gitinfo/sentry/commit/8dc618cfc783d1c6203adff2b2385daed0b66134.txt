commit 8dc618cfc783d1c6203adff2b2385daed0b66134
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Oct 14 14:17:28 2015 -0700

    Bail on CSP Violation prefix

diff --git a/src/sentry/interfaces/csp.py b/src/sentry/interfaces/csp.py
index c902d3ea1d..55db066552 100644
--- a/src/sentry/interfaces/csp.py
+++ b/src/sentry/interfaces/csp.py
@@ -54,21 +54,21 @@ SELF = "'self'"
 
 DIRECTIVE_TO_MESSAGES = {
     # 'base-uri': '',
-    'child-src': ("blocked 'child' from {uri!r}", "blocked inline 'child'"),
-    'connect-src': ("blocked 'connect' from {uri!r}", "blocked inline 'connect'"),
+    'child-src': ("Blocked 'child' from {uri!r}", "Blocked inline 'child'"),
+    'connect-src': ("Blocked 'connect' from {uri!r}", "Blocked inline 'connect'"),
     # 'default-src': '',
-    'font-src': ("blocked 'font' from {uri!r}", "blocked inline 'font'"),
-    'form-action': ("blocked 'form' action to {uri!r}",),  # no inline option
+    'font-src': ("Blocked 'font' from {uri!r}", "Blocked inline 'font'"),
+    'form-action': ("Blocked 'form' action to {uri!r}",),  # no inline option
     # 'frame-ancestors': '',
-    'img-src': ("blocked 'image' from {uri!r}", "blocked inline 'image'"),
-    'manifest-src': ("blocked 'manifest' from {uri!r}", "blocked inline 'manifest'"),
-    'media-src': ("blocked 'media' from {uri!r}", "blocked inline 'media'"),
-    'object-src': ("blocked 'object' from {uri!r}", "blocked inline 'object'"),
+    'img-src': ("Blocked 'image' from {uri!r}", "Blocked inline 'image'"),
+    'manifest-src': ("Blocked 'manifest' from {uri!r}", "Blocked inline 'manifest'"),
+    'media-src': ("Blocked 'media' from {uri!r}", "Blocked inline 'media'"),
+    'object-src': ("Blocked 'object' from {uri!r}", "Blocked inline 'object'"),
     # 'plugin-types': '',
     # 'referrer': '',
     # 'reflected-xss': '',
-    'script-src': ("blocked 'script' from {uri!r}", "blocked unsafe 'script'"),
-    'style-src': ("blocked 'style' from {uri!r}", "blocked inline 'style'"),
+    'script-src': ("Blocked 'script' from {uri!r}", "Blocked unsafe 'script'"),
+    'style-src': ("Blocked 'style' from {uri!r}", "Blocked inline 'style'"),
     # 'upgrade-insecure-requests': '',
 }
 
@@ -84,7 +84,7 @@ class Csp(Interface):
     >>> {
     >>>     "document_uri": "http://example.com/",
     >>>     "violated_directive": "style-src cdn.example.com",
-    >>>     "blocked_uri": "http://example.com/style.css",
+    >>>     "Blocked_uri": "http://example.com/style.css",
     >>>     "effective_directive": "style-src",
     >>> }
     """
@@ -135,9 +135,9 @@ class Csp(Interface):
         # so we want to attempt to guess which it was
         if _is_unsafe_script(directive, uri) and self.violated_directive:
             if "'unsafe-inline'" in self.violated_directive:
-                tmpl = "blocked unsafe eval() 'script'"
+                tmpl = "Blocked unsafe eval() 'script'"
             elif "'unsafe-eval'" in self.violated_directive:
-                tmpl = "blocked unsafe inline 'script'"
+                tmpl = "Blocked unsafe inline 'script'"
 
         if tmpl is None:
             try:
@@ -145,8 +145,7 @@ class Csp(Interface):
             except (KeyError, IndexError):
                 tmpl = DEFAULT_MESSAGE[index]
 
-        message = tmpl.format(directive=directive, uri=uri)
-        return 'CSP Violation: ' + message
+        return tmpl.format(directive=directive, uri=uri)
 
     def get_culprit(self):
         return self._normalize_directive(self.violated_directive)
diff --git a/tests/integration/fixtures/csp/chrome_blocked_asset_output.json b/tests/integration/fixtures/csp/chrome_blocked_asset_output.json
index 51fbe21f76..9b09e9d0fa 100644
--- a/tests/integration/fixtures/csp/chrome_blocked_asset_output.json
+++ b/tests/integration/fixtures/csp/chrome_blocked_asset_output.json
@@ -1,5 +1,5 @@
 {
-  "message": "CSP Violation: blocked 'style' from 'localhost:8000'",
+  "message": "Blocked 'style' from 'localhost:8000'",
   "data": {
     "sentry.interfaces.User": {"ip_address": "127.0.0.1"},
     "sentry.interfaces.Csp": {
diff --git a/tests/sentry/interfaces/test_csp.py b/tests/sentry/interfaces/test_csp.py
index 975ba28638..955dc1d925 100644
--- a/tests/sentry/interfaces/test_csp.py
+++ b/tests/sentry/interfaces/test_csp.py
@@ -130,14 +130,14 @@ class CspTest(TestCase):
             effective_directive='img-src',
             blocked_uri='http://google.com/foo',
         ))
-        assert result.get_message() == "CSP Violation: blocked 'image' from 'google.com'"
+        assert result.get_message() == "Blocked 'image' from 'google.com'"
 
         result = Csp.to_python(dict(
             document_uri='http://example.com/foo',
             effective_directive='style-src',
             blocked_uri='',
         ))
-        assert result.get_message() == "CSP Violation: blocked inline 'style'"
+        assert result.get_message() == "Blocked inline 'style'"
 
         result = Csp.to_python(dict(
             document_uri='http://example.com/foo',
@@ -145,7 +145,7 @@ class CspTest(TestCase):
             blocked_uri='',
             violated_directive="script-src 'unsafe-inline'",
         ))
-        assert result.get_message() == "CSP Violation: blocked unsafe eval() 'script'"
+        assert result.get_message() == "Blocked unsafe eval() 'script'"
 
         result = Csp.to_python(dict(
             document_uri='http://example.com/foo',
@@ -153,7 +153,7 @@ class CspTest(TestCase):
             blocked_uri='',
             violated_directive="script-src 'unsafe-eval'",
         ))
-        assert result.get_message() == "CSP Violation: blocked unsafe inline 'script'"
+        assert result.get_message() == "Blocked unsafe inline 'script'"
 
         result = Csp.to_python(dict(
             document_uri='http://example.com/foo',
@@ -161,4 +161,4 @@ class CspTest(TestCase):
             blocked_uri='',
             violated_directive="script-src example.com",
         ))
-        assert result.get_message() == "CSP Violation: blocked unsafe 'script'"
+        assert result.get_message() == "Blocked unsafe 'script'"
