commit 994a9e40645d91a1bc934005ab979972f066cf0d
Author: adhiraj <693121+adhiraj@users.noreply.github.com>
Date:   Fri Aug 31 15:51:20 2018 -0700

    Fix #assistant bug (#9592)
    
    When a user navigates away from the page, neither hashchange nor load fires. We need to look at the browser history to correctly determine URL change.

diff --git a/src/sentry/static/sentry/app/stores/guideStore.jsx b/src/sentry/static/sentry/app/stores/guideStore.jsx
index 09adfdd12a..0ee6a97c6b 100644
--- a/src/sentry/static/sentry/app/stores/guideStore.jsx
+++ b/src/sentry/static/sentry/app/stores/guideStore.jsx
@@ -1,3 +1,4 @@
+import {browserHistory} from 'react-router';
 import Reflux from 'reflux';
 import $ from 'jquery';
 import GuideActions from 'app/actions/guideActions';
@@ -44,8 +45,8 @@ const GuideStore = Reflux.createStore({
     this.listenTo(ProjectActions.setActive, this.onSetActiveProject);
     this.listenTo(OrganizationsActions.changeSlug, this.onChangeOrgSlug);
 
-    window.addEventListener('hashchange', this.onURLChange, false);
     window.addEventListener('load', this.onURLChange, false);
+    browserHistory.listen(() => this.onURLChange());
   },
 
   onURLChange() {
diff --git a/tests/js/spec/stores/guideStore.spec.jsx b/tests/js/spec/stores/guideStore.spec.jsx
index 49fea08d47..67dc97f221 100644
--- a/tests/js/spec/stores/guideStore.spec.jsx
+++ b/tests/js/spec/stores/guideStore.spec.jsx
@@ -87,7 +87,7 @@ describe('GuideStore', function() {
   it('should force show a guide', function() {
     GuideStore.onFetchSucceeded(data);
     window.location.hash = '#assistant';
-    window.dispatchEvent(new Event('hashchange'));
+    GuideStore.onURLChange();
     expect(GuideStore.state.currentGuide.id).toEqual(1);
     // Should prune steps that don't have anchors.
     expect(GuideStore.state.currentGuide.steps).toHaveLength(2);
