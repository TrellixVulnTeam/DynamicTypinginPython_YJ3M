commit 4be7bb97609d9cd4d8b876bcb20aaab05f48e21a
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Tue Sep 19 15:06:21 2017 -0700

    feat(saml): Guard clause extract_parsed_data_from_idp_data

diff --git a/src/sentry/auth/providers/saml2.py b/src/sentry/auth/providers/saml2.py
index 08c9671aab..93000c7d20 100644
--- a/src/sentry/auth/providers/saml2.py
+++ b/src/sentry/auth/providers/saml2.py
@@ -520,18 +520,20 @@ class SAML2Provider(Provider):
 
     @staticmethod
     def extract_parsed_data_from_idp_data(data):
+        if 'idp' not in data:
+            return {}
+
         parsed_data = {}
-        if 'idp' in data:
-            if 'idp_entityid' in data['idp']:
-                parsed_data['entityId'] = data['idp']['idp_entityid']
-            if 'idp_sso_url' in data['idp']:
-                parsed_data['singleSignOnService'] = {}
-                parsed_data['singleSignOnService']['url'] = data['idp']['idp_sso_url']
-            if 'idp_slo_url' in data['idp']:
-                parsed_data['singleLogoutService'] = {}
-                parsed_data['singleLogoutService']['url'] = data['idp']['idp_slo_url']
-            if 'idp_x509cert' in data['idp']:
-                parsed_data['x509cert'] = data['idp']['idp_x509cert']
+
+        if 'idp_entityid' in data['idp']:
+            parsed_data['entityId'] = data['idp']['idp_entityid']
+        if 'idp_sso_url' in data['idp']:
+            parsed_data['singleSignOnService'] = {'url': data['idp']['idp_sso_url']}
+        if 'idp_slo_url' in data['idp']:
+            parsed_data['singleLogoutService'] = {'url': data['idp']['idp_slo_url']}
+        if 'idp_x509cert' in data['idp']:
+            parsed_data['x509cert'] = data['idp']['idp_x509cert']
+
         return parsed_data
 
     @staticmethod
