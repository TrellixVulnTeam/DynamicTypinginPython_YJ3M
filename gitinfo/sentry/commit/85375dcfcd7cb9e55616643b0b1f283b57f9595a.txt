commit 85375dcfcd7cb9e55616643b0b1f283b57f9595a
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Feb 4 01:40:39 2014 -0800

    Dedupe these tests

diff --git a/src/sentry/testutils/cases.py b/src/sentry/testutils/cases.py
index c0c7e40ceb..d32d2d3b35 100644
--- a/src/sentry/testutils/cases.py
+++ b/src/sentry/testutils/cases.py
@@ -116,25 +116,13 @@ class BaseTestCase(Fixtures, Exam):
         )
         return resp
 
-    def _getWithoutReferer(self, data, key=None):
+    def _getWithReferer(self, data, key=None, referer='getsentry.com'):
         if key is None:
             key = self.projectkey.public_key
 
-        message = self._makeMessage(data)
-        qs = {
-            'sentry_version': '4',
-            'sentry_client': 'raven-js/lol',
-            'sentry_key': key,
-            'sentry_data': message,
-        }
-        resp = self.client.get(
-            '%s?%s' % (reverse('sentry-api-store', args=(self.project.pk,)), urllib.urlencode(qs))
-        )
-        return resp
-
-    def _getWithReferer(self, data, key=None):
-        if key is None:
-            key = self.projectkey.public_key
+        headers = {}
+        if referer is not None:
+            headers['HTTP_REFERER'] = referer
 
         message = self._makeMessage(data)
         qs = {
@@ -145,7 +133,7 @@ class BaseTestCase(Fixtures, Exam):
         }
         resp = self.client.get(
             '%s?%s' % (reverse('sentry-api-store', args=(self.project.pk,)), urllib.urlencode(qs)),
-            HTTP_REFERER='http://getsentry.com/'
+            **headers
         )
         return resp
 
diff --git a/tests/integration/tests.py b/tests/integration/tests.py
index 0092f01c59..8155b854b3 100644
--- a/tests/integration/tests.py
+++ b/tests/integration/tests.py
@@ -176,13 +176,13 @@ class SentryRemoteTest(TestCase):
     @override_settings(SENTRY_ALLOW_ORIGIN='getsentry.com')
     def test_get_without_referer(self):
         kwargs = {'message': 'hello', 'server_name': 'not_dcramer.local', 'level': 40, 'site': 'not_a_real_site'}
-        resp = self._getWithoutReferer(kwargs)
+        resp = self._getWithReferer(kwargs, referer=None)
         self.assertEquals(resp.status_code, 400, resp.content)
 
     @override_settings(SENTRY_ALLOW_ORIGIN='*')
     def test_get_without_referer_allowed(self):
         kwargs = {'message': 'hello', 'server_name': 'not_dcramer.local', 'level': 40, 'site': 'not_a_real_site'}
-        resp = self._getWithoutReferer(kwargs)
+        resp = self._getWithReferer(kwargs, referer=None)
         self.assertEquals(resp.status_code, 200, resp.content)
 
     # def test_byte_sequence(self):
