commit 0b29dbe968047606a8b21d8f4cbf4b0ad67eefc2
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Wed Jun 19 09:28:51 2019 +0200

    ref: Remove another sampling option (#13673)
    
    * ref: Clean up renormalization 2
    
    * fix: Remove old monkeypatch

diff --git a/src/sentry/models/event.py b/src/sentry/models/event.py
index d86218d744..3ca6b96eda 100644
--- a/src/sentry/models/event.py
+++ b/src/sentry/models/event.py
@@ -22,7 +22,7 @@ from hashlib import md5
 
 from semaphore.processing import StoreNormalizer
 
-from sentry import eventtypes, options
+from sentry import eventtypes
 from sentry.constants import EVENT_ORDERING_KEY
 from sentry.db.models import (
     BoundedBigIntegerField,
@@ -41,17 +41,6 @@ from sentry.utils.safe import get_path
 from sentry.utils.strings import truncatechars
 
 
-def _should_disable_trim(event_id):
-    if not event_id:
-        return False
-
-    sample_rate = options.get('store.disable-trim-in-renormalization')
-    if sample_rate == 0:
-        return False
-
-    return int(md5(event_id).hexdigest(), 16) % (10 ** 8) <= (sample_rate * (10 ** 8))
-
-
 class EventDict(CanonicalKeyDict):
     """
     Creating an instance of this dictionary will send the event through basic
@@ -71,7 +60,7 @@ class EventDict(CanonicalKeyDict):
         if not skip_renormalization and not is_renormalized:
             normalizer = StoreNormalizer(
                 is_renormalize=True,
-                enable_trimming=not _should_disable_trim(data.get('event_id'))
+                enable_trimming=False,
             )
             data = normalizer.normalize_event(dict(data))
 
diff --git a/src/sentry/options/defaults.py b/src/sentry/options/defaults.py
index ec206a551b..a532f5ccee 100644
--- a/src/sentry/options/defaults.py
+++ b/src/sentry/options/defaults.py
@@ -185,7 +185,7 @@ register('symbolicator.minidump-refactor-random-sampling', default=0.0)  # unuse
 
 # Normalization after processors
 register('store.normalize-after-processing', default=0.0)  # unused
-register('store.disable-trim-in-renormalization', default=0.0)
+register('store.disable-trim-in-renormalization', default=0.0)  # unused
 
 # Post Process Error Hook Sampling
 register('post-process.use-error-hook-sampling', default=False)
diff --git a/src/sentry/utils/pytest/sentry.py b/src/sentry/utils/pytest/sentry.py
index 1727f20027..20fc77159d 100644
--- a/src/sentry/utils/pytest/sentry.py
+++ b/src/sentry/utils/pytest/sentry.py
@@ -1,6 +1,5 @@
 from __future__ import absolute_import
 
-import pytest
 import mock
 import os
 
@@ -253,8 +252,3 @@ def pytest_runtest_teardown(item):
         model.objects.clear_local_cache()
 
     Hub.main.bind_client(None)
-
-
-@pytest.fixture(autouse=True)
-def _disable_renormalization_trim(monkeypatch):
-    monkeypatch.setattr('sentry.models.event._should_disable_trim', lambda _: True)
