commit 7bcf73034ad5eb7678c724c0a3594e4aa40da888
Author: Alex Hofsteede <alex@hofsteede.com>
Date:   Mon Nov 12 12:59:11 2018 -0800

    fix: Return set from group_tag_keys_and_top_values (#10403)

diff --git a/src/sentry/tagstore/snuba/backend.py b/src/sentry/tagstore/snuba/backend.py
index d0d0aa405b..b3999e7278 100644
--- a/src/sentry/tagstore/snuba/backend.py
+++ b/src/sentry/tagstore/snuba/backend.py
@@ -324,7 +324,7 @@ class SnubaTagStorage(TagStorage):
             key_ctor = functools.partial(GroupTagKey, group_id=group_id)
             value_ctor = functools.partial(GroupTagValue, group_id=group_id)
 
-        return [
+        return set([
             key_ctor(
 
                 # TODO we don't know these from the current query, but in the
@@ -346,7 +346,7 @@ class SnubaTagStorage(TagStorage):
                     ) for value, data in six.iteritems(values)
                 ]
             ) for key, values in six.iteritems(result)
-        ]
+        ])
 
     def __get_release(self, project_id, group_id, first=True):
         start, end = self.get_time_range()
diff --git a/tests/snuba/tagstore/test_tagstore_backend.py b/tests/snuba/tagstore/test_tagstore_backend.py
index f669f7e6dd..61d260a226 100644
--- a/tests/snuba/tagstore/test_tagstore_backend.py
+++ b/tests/snuba/tagstore/test_tagstore_backend.py
@@ -85,11 +85,11 @@ class TagStorageTest(SnubaTestCase):
         assert requests.post(settings.SENTRY_SNUBA + '/tests/insert', data=data).status_code == 200
 
     def test_get_group_tag_keys_and_top_values(self):
-        result = self.ts.get_group_tag_keys_and_top_values(
+        result = list(self.ts.get_group_tag_keys_and_top_values(
             self.proj1.id,
             self.proj1group1.id,
             self.proj1env1.id,
-        )
+        ))
         tags = [r.key for r in result]
         assert set(tags) == set(['foo', 'baz', 'environment', 'sentry:release', 'sentry:user'])
 
@@ -108,12 +108,12 @@ class TagStorageTest(SnubaTestCase):
         assert all(v.times_seen == 1 for v in top_release_values)
 
         # Now with only a specific set of keys,
-        result = self.ts.get_group_tag_keys_and_top_values(
+        result = list(self.ts.get_group_tag_keys_and_top_values(
             self.proj1.id,
             self.proj1group1.id,
             self.proj1env1.id,
             keys=['environment', 'sentry:release'],
-        )
+        ))
         tags = [r.key for r in result]
         assert set(tags) == set(['environment', 'sentry:release'])
 
