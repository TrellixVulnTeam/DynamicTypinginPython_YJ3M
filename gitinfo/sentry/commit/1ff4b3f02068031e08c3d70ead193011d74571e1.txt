commit 1ff4b3f02068031e08c3d70ead193011d74571e1
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Wed Oct 30 04:27:24 2019 +0300

    build(docker): Only tag and push images from master (#15344)

diff --git a/docker/cloudbuild.yaml b/docker/cloudbuild.yaml
index 6ba4a6a221..38147984f2 100644
--- a/docker/cloudbuild.yaml
+++ b/docker/cloudbuild.yaml
@@ -38,6 +38,8 @@ steps:
   - '-e'
   - '-c'
   - |
+    # Only push to Docker Hub from master
+    [ "$BRANCH_NAME" != "master" ] && exit 0
     # Need to pull the image first due to Kaniko
     docker pull us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA
     echo "$$DOCKER_PASSWORD" | docker login --username=sentrybuilder --password-stdin
@@ -45,11 +47,8 @@ steps:
     docker push getsentry/sentry:$SHORT_SHA
     docker tag us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA getsentry/sentry:$COMMIT_SHA
     docker push getsentry/sentry:$COMMIT_SHA
-    # Only tag "latest" when on master
-    if [ "$BRANCH_NAME" == "master" ]; then
-      docker tag us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA getsentry/sentry:latest
-      docker push getsentry/sentry:latest
-    fi
+    docker tag us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA getsentry/sentry:latest
+    docker push getsentry/sentry:latest
 timeout: 2400s
 options:
   # We need more memory for Webpack builds & e2e onpremise tests
