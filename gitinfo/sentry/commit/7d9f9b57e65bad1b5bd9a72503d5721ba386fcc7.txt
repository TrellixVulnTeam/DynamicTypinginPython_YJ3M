commit 7d9f9b57e65bad1b5bd9a72503d5721ba386fcc7
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Aug 13 00:11:06 2013 -0700

    Replace sequence hack with less evil hack

diff --git a/conftest.py b/conftest.py
index dc72a1dfa3..66d6b59ccb 100644
--- a/conftest.py
+++ b/conftest.py
@@ -67,3 +67,36 @@ def pytest_configure(config):
     # enable draft features
     settings.SENTRY_ENABLE_EXPLORE_CODE = True
     settings.SENTRY_ENABLE_EXPLORE_USERS = True
+
+
+_HAS_FIXED_SEQUENCES = False
+
+
+def pytest_runtest_call(item):
+    # HACK: sequences arent reset for postgres
+    global _HAS_FIXED_SEQUENCES
+
+    if not _HAS_FIXED_SEQUENCES:
+        import os
+
+        os.environ['DJANGO_COLORS'] = 'nocolor'
+
+        from django.core.management import call_command
+        from django.conf import settings
+        from django.db import connection
+        from django.db.models.loading import get_app
+        from StringIO import StringIO
+
+        commands = StringIO()
+        cursor = connection.cursor()
+
+        for app in settings.INSTALLED_APPS:
+            label = app.split('.')[-1]
+            if get_app(label, emptyOK=True):
+                call_command('sqlsequencereset', label, stdout=commands)
+
+        value = commands.getvalue()
+        if value:
+            cursor.execute(value)
+
+        _HAS_FIXED_SEQUENCES = True
diff --git a/src/sentry/models.py b/src/sentry/models.py
index bb0fd61155..21acf32a21 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -1191,20 +1191,12 @@ def create_default_project(created_models, verbosity=2, **kwargs):
         user = None
 
     project = Project.objects.create(
+        id=settings.SENTRY_PROJECT,
         public=False,
         name='Sentry (Internal)',
         slug='sentry',
         owner=user,
     )
-    if project.id != settings.SENTRY_PROJECT:
-        # HACK: the database is not correctly advancing our auto incr ID
-        # so lets do a wasteful query to update instead of doing it on insert
-        update(project, id=settings.SENTRY_PROJECT)
-
-    # default key (used by sentry-js client, etc)
-    ProjectKey.objects.create(
-        project=project,
-    )
 
     if verbosity > 0:
         print 'Created internal Sentry project (slug=%s, id=%s)' % (project.slug, project.id)
