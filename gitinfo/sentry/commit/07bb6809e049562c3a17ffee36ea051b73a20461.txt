commit 07bb6809e049562c3a17ffee36ea051b73a20461
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 6 21:25:35 2013 -0700

    Basic views for code exploration

diff --git a/src/sentry/templates/sentry/explore/code/list_tag.html b/src/sentry/templates/sentry/explore/code/list_tag.html
new file mode 100644
index 0000000000..dd88c08a3f
--- /dev/null
+++ b/src/sentry/templates/sentry/explore/code/list_tag.html
@@ -0,0 +1,83 @@
+{% extends "sentry/teams/base.html" %}
+
+{% load url from future %}
+{% load i18n %}
+{% load sentry_helpers %}
+{% load sentry_plugins %}
+
+{% block title %}Explore Code | {{ team.name }} | {{ block.super }}{% endblock %}
+
+{% block bodyclass %}{% endblock %}
+
+{% block breadcrumb %}
+    <li class="divider"></li>
+    <li><a href="{% url 'sentry-explore-code' team.slug project.slug %}">{% trans "Code" %}</a></li>
+{% endblock %}
+
+{% block main %}
+    <section class="body">
+        <ul class="nav nav-tabs">
+            <li{% if selection == 'filenames' %} class="active"{% endif %}>
+                <a href="{% url 'sentry-explore-code' team.slug project.slug %}">Files</a></li>
+            <li{% if selection == 'functions' %} class="active"{% endif %}>
+                <a href="{% url 'sentry-explore-code-by-function' team.slug project.slug %}">Functions</a></li>
+        </ul>
+
+        {% paginator tag_list from request as tag_list %}
+        {% querystring from request without sort as sort_querystring %}
+
+        <div class="btn-toolbar">
+            <div class="btn-group">
+                <a href="#" class="btn dropdown-toggle" data-toggle="dropdown">{% blocktrans with sort_label as label %}Sort by: {{ label }}{% endblocktrans %} <span class="caret"></span></a>
+                <ul class="dropdown-menu">
+                    <li{% ifequal sort 'recent' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=recent">{{ SORT_OPTIONS.recent }}</a></li>
+                    <li{% ifequal sort 'newest' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=newest">{{ SORT_OPTIONS.newest }}</a></li>
+                    <li{% ifequal sort 'events' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=events">{{ SORT_OPTIONS.events }}</a></li>
+                </ul>
+            </div>
+            <div class="btn-group pull-right">
+                <a class="btn prev{% if not tag_list.paginator.has_previous %} disabled{% endif %}" href="?{{ tag_list.query_string|escape }}&amp;p={{ tag_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+                <a class="btn next{% if not tag_list.paginator.has_next %} disabled{% endif %}" href="?{{ tag_list.query_string|escape }}&amp;p={{ tag_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+            </div>
+        </div>
+
+        {% if not tag_list.paginator.objects %}
+            <p>{% blocktrans %}You dont seem to have any user data recorded. For more information on how to send this information consult your client's documentation.{% endblocktrans %}</p>
+        {% else %}
+            <table class="table table-bordered table-striped">
+                <thead>
+                    <tr>
+                        <th>{% trans "Path" %}</th>
+                        <th style="width:150px;text-align:center">{% trans "Last Seen" %}</th>
+                        <th style="width:100px;text-align:center">{% trans "Events Seen" %}</th>
+                    </tr>
+                </thead>
+                <tbody>
+                    {% for tag in tag_list.paginator.objects %}
+                        <tr>
+                            <td>
+                                {% if selection == 'functions' %}
+                                    {% url 'sentry-explore-code-details-by-function' team.slug project.slug tag.id as link %}
+                                    <a href="{{ link }}">{{ tag.data.function }}</a><br>
+                                    <small>{{ tag.data.filename }}</small>
+                                {% else %}
+                                    {% url 'sentry-explore-code-details' team.slug project.slug tag.id as link %}
+                                    <a href="{{ link }}">{{ tag.data.filename }}</a><br>
+                                {% endif %}
+                            </td>
+                            <td style="text-align:center">{{ tag.last_seen|timesince }}</td>
+                            <td style="text-align:center">{{ tag.times_seen|small_count }}</td>
+                        </tr>
+                    {% endfor %}
+                </tbody>
+            </table>
+
+            <div class="btn-toolbar">
+                <div class="btn-group pull-right">
+                    <a class="btn prev{% if not tag_list.paginator.has_previous %} disabled{% endif %}" href="?{{ tag_list.query_string|escape }}&amp;p={{ tag_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+                    <a class="btn next{% if not tag_list.paginator.has_next %} disabled{% endif %}" href="?{{ tag_list.query_string|escape }}&amp;p={{ tag_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+                </div>
+            </div>
+        {% endif %}
+    </section>
+{% endblock %}
diff --git a/src/sentry/templates/sentry/explore/code/tag_details.html b/src/sentry/templates/sentry/explore/code/tag_details.html
new file mode 100644
index 0000000000..90dd1de688
--- /dev/null
+++ b/src/sentry/templates/sentry/explore/code/tag_details.html
@@ -0,0 +1,76 @@
+{% extends "sentry/explore/code/list_tag.html" %}
+
+{% load url from future %}
+{% load i18n %}
+{% load sentry_helpers %}
+{% load sentry_plugins %}
+
+{% block title %}
+    {% if selection == 'functions' %}
+        {{ tag.data.function }} from
+    {% endif %}
+    {{ tag.data.filename }} | {{ block.super }}
+{% endblock %}
+
+{% block breadcrumb %}
+    {{ block.super }}
+    <li class="divider"></li>
+    <li><a href="{% url 'sentry-explore-code-details' team.slug project.slug tag.id %}">{{ tag.data.filename }}</a></li>
+    {% if selection == 'functions' %}
+        <li class="divider"></li>
+        <li><a href="{% url 'sentry-explore-code-details-by-function' team.slug project.slug tag.id %}">{{ tag.data.function }}</a></li>
+    {% endif %}
+{% endblock %}
+
+{% block bodyclass %} with-sidebar{% endblock %}
+
+{% block sidebar %}
+    <h6>{% trans "Code Details" %}</h6>
+    <dl>
+        <dt>{% trans "Filename:" %}</dt>
+        <dd><a href="{% url 'sentry-explore-code-details' team.slug project.slug tag.id %}">{{ tag.data.filename }}</a></dd>
+        {% if selection == 'functions' %}
+            <dt>{% trans "Function:" %}</dt>
+            <dd><a href="{% url 'sentry-explore-code-details-by-function' team.slug project.slug tag.id %}">{{ tag.data.function }}</a></dd>
+        {% endif %}
+        <dt>First Seen:</dt>
+        <dd>{{ tag.first_seen|timesince }}</dd>
+        <dt>Last Seen:</dt>
+        <dd>{{ tag.last_seen|timesince }}</dd>
+        <dt>Number of Events:</dt>
+        <dd>{{ tag.times_seen|small_count }}</dd>
+    </dl>
+{% endblock %}
+
+{% block main %}
+    {% paginator event_list from request as event_list per_page MESSAGES_PER_PAGE %}
+
+    <div class="btn-toolbar">
+        <div class="pull-left">
+            <h2 style="line-height:1;">{{ tag.data.filename }}{% if selection == 'functions' %} <small>{{ tag.data.function }}</small>{% endif %}</h2>
+        </div>
+        <div class="btn-group pull-right">
+            <a class="btn prev{% if not event_list.paginator.has_previous %} disabled{% endif %}" href="?p={{ event_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?p={{ event_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+        </div>
+    </div>
+
+    <div id="event_list"></div>
+
+    <script>
+    $(function(){
+        new app.GroupListView({
+            className: 'group-list',
+            members: {{ event_list.paginator.objects|to_json:request|safe }},
+            id: "event_list"
+        });
+    });
+    </script>
+
+    <div class="btn-toolbar">
+        <div class="btn-group pull-right">
+            <a class="btn prev{% if not event_list.paginator.has_previous %} disabled{% endif %}" href="?p={{ event_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?p={{ event_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
+        </div>
+    </div>
+{% endblock %}
diff --git a/src/sentry/web/frontend/explore_code.py b/src/sentry/web/frontend/explore_code.py
new file mode 100644
index 0000000000..e28cb4227d
--- /dev/null
+++ b/src/sentry/web/frontend/explore_code.py
@@ -0,0 +1,75 @@
+"""
+sentry.web.frontend.explore_code
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+:copyright: (c) 2012 by the Sentry Team, see AUTHORS for more details.
+:license: BSD, see LICENSE for more details.
+"""
+from sentry.models import TagValue, Group
+from sentry.web.decorators import login_required, has_access
+from sentry.web.helpers import render_to_response
+
+DEFAULT_SORT_OPTION = 'recent'
+SORT_OPTIONS = {
+    'recent': 'Last Seen',
+    'newest': 'First Seen',
+    'events': 'Number of Events',
+}
+
+
+@has_access
+@login_required
+def list_tag(request, team, project, selection):
+    assert selection in ('filenames', 'functions')
+
+    tag_name = selection[:-1]
+
+    sort = request.GET.get('sort')
+    if sort not in SORT_OPTIONS:
+        sort = DEFAULT_SORT_OPTION
+
+    tag_list = TagValue.objects.filter(project=project, key='sentry:%s' % (tag_name,))
+
+    if sort == 'recent':
+        tag_list = tag_list.order_by('-last_seen')
+    elif sort == 'newest':
+        tag_list = tag_list.order_by('-first_seen')
+    elif sort == 'events':
+        tag_list = tag_list.order_by('-times_seen')
+
+    return render_to_response('sentry/explore/code/list_tag.html', {
+        'team': team,
+        'project': project,
+        'tag_list': tag_list,
+        'selection': selection,
+        'sort_label': SORT_OPTIONS[sort],
+        'SORT_OPTIONS': SORT_OPTIONS,
+    }, request)
+
+
+@has_access
+@login_required
+def tag_details(request, team, project, selection, tag_id):
+    assert selection in ('filenames', 'functions')
+
+    tag_name = selection[:-1]
+
+    tag = TagValue.objects.get(
+        project=project,
+        key='sentry:%s' % (tag_name,),
+        id=tag_id,
+    )
+
+    event_list = Group.objects.filter(
+        grouptag__project=project,
+        grouptag__key='sentry:%s' % (tag_name,),
+        grouptag__value=tag.value,
+    )
+
+    return render_to_response('sentry/explore/code/tag_details.html', {
+        'team': team,
+        'project': project,
+        'tag': tag,
+        'selection': selection,
+        'event_list': event_list,
+    }, request)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 94bed8b208..9e53489c1b 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -16,7 +16,7 @@ except ImportError:
 
 from sentry.web import api
 from sentry.web.frontend import (alerts, accounts, generic, groups, events,
-    projects, admin, docs, teams, users)
+    projects, admin, docs, teams, users, explore_code)
 
 __all__ = ('urlpatterns',)
 
@@ -243,6 +243,16 @@ urlpatterns = patterns('',
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/users/(?P<user_id>\d+)/$', users.user_details,
         name='sentry-user-details'),
 
+    # Explore - Code
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/code/$', explore_code.list_tag,
+        {'selection': 'filenames'}, name='sentry-explore-code'),
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/code/by/function/$', explore_code.list_tag,
+        {'selection': 'functions'}, name='sentry-explore-code-by-function'),
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/code/by/filename/(?P<tag_id>\d+)/$',
+        explore_code.tag_details, {'selection': 'filenames'}, name='sentry-explore-code-details'),
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/code/by/function/(?P<tag_id>\d+)/$',
+        explore_code.tag_details, {'selection': 'functions'}, name='sentry-explore-code-details-by-function'),
+
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/get-started/$', projects.get_started,
         name='sentry-get-started'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/$', groups.group,
