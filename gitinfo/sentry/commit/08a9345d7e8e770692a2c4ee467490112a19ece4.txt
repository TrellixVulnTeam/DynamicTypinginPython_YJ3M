commit 08a9345d7e8e770692a2c4ee467490112a19ece4
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Oct 18 11:44:27 2016 -0700

    sourcemaps: conditionally import libsourcemap if found (#4366)

diff --git a/setup.py b/setup.py
index 1922cea047..e13b9cd63e 100755
--- a/setup.py
+++ b/setup.py
@@ -110,6 +110,7 @@ install_requires = [
     'lxml>=3.4.1',
 
     'ipaddress>=1.0.16,<1.1.0',
+    'libsourcemap==0.4.0',
     'mock>=0.8.0,<1.1',
     'oauth2>=1.5.167',
     'percy>=0.2.5',
diff --git a/src/sentry/lang/javascript/sourcemaps/__init__.py b/src/sentry/lang/javascript/sourcemaps/__init__.py
index c81da2e126..f40a3740d5 100644
--- a/src/sentry/lang/javascript/sourcemaps/__init__.py
+++ b/src/sentry/lang/javascript/sourcemaps/__init__.py
@@ -1,3 +1,6 @@
 from __future__ import absolute_import
 
-from .native import from_json  # NOQA
+try:
+    from libsourcemap import from_json
+except ImportError:
+    from .native import from_json  # NOQA
diff --git a/src/sentry/testutils/skips.py b/src/sentry/testutils/skips.py
index d05c7a8a88..194469519e 100644
--- a/src/sentry/testutils/skips.py
+++ b/src/sentry/testutils/skips.py
@@ -37,3 +37,15 @@ def cassandra_is_available():
 requires_cassandra = pytest.mark.skipif(
     not cassandra_is_available(),
     reason="requires cassandra server running")
+
+
+def libsourcemap_is_available():
+    try:
+        import libsourcemap  # NOQA
+        return True
+    except ImportError:
+        return False
+
+requires_no_libsourcemap = pytest.mark.skipif(
+    libsourcemap_is_available(),
+    reason="doesn't work with libsourcemap")
diff --git a/tests/sentry/lang/javascript/test_processor.py b/tests/sentry/lang/javascript/test_processor.py
index e5caa3158c..9ef6e8990e 100644
--- a/tests/sentry/lang/javascript/test_processor.py
+++ b/tests/sentry/lang/javascript/test_processor.py
@@ -19,7 +19,7 @@ from sentry.lang.javascript.errormapping import (
     rewrite_exception, REACT_MAPPING_URL
 )
 from sentry.models import File, Release, ReleaseFile
-from sentry.testutils import TestCase
+from sentry.testutils import TestCase, requires_no_libsourcemap
 
 base64_sourcemap = 'data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvdGVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zb2xlLmxvZyhcImhlbGxvLCBXb3JsZCFcIikiXX0='
 
@@ -245,6 +245,7 @@ class GenerateModuleTest(TestCase):
         assert generate_module('~/app/components/projectHeader/projectSelector.jsx') == 'app/components/projectHeader/projectSelector'
 
 
+@requires_no_libsourcemap
 class FetchBase64SourcemapTest(TestCase):
     def test_simple(self):
         smap_view = fetch_sourcemap(base64_sourcemap)
