commit dbe7524fc19f462a640be43a4fa84fbad08ce9eb
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Dec 4 18:32:16 2015 -0800

    Leverage get_server_hostname inside AllowedHosts

diff --git a/src/sentry/runner/hacks.py b/src/sentry/runner/hacks.py
index 56a903b962..4927969980 100644
--- a/src/sentry/runner/hacks.py
+++ b/src/sentry/runner/hacks.py
@@ -7,8 +7,7 @@ sentry.runner.hacks
 """
 from __future__ import absolute_import, print_function
 
-from urlparse import urlparse
-from sentry import options
+from sentry.http import get_server_hostname
 
 
 class AllowedHosts(object):
@@ -17,8 +16,4 @@ class AllowedHosts(object):
     # in Django internals, so we want this "tuple" to respond
     # to runtime changes based on our system.url-prefix Option
     def __iter__(self):
-        hostname = urlparse(options.get('system.url-prefix')).hostname
-        if hostname:
-            yield hostname
-        else:
-            yield '*'
+        yield get_server_hostname() or '*'
