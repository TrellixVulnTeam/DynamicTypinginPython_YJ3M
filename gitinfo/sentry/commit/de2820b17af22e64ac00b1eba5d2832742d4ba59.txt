commit de2820b17af22e64ac00b1eba5d2832742d4ba59
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Apr 16 21:42:20 2015 -0700

    Add internal stats endpoint

diff --git a/src/sentry/api/endpoints/internal_stats.py b/src/sentry/api/endpoints/internal_stats.py
new file mode 100644
index 0000000000..48349154cf
--- /dev/null
+++ b/src/sentry/api/endpoints/internal_stats.py
@@ -0,0 +1,22 @@
+from __future__ import absolute_import
+
+from rest_framework.response import Response
+
+from sentry.app import tsdb
+from sentry.api.base import Endpoint, StatsMixin
+from sentry.api.permissions import SuperuserPermission
+
+
+class InternalStatsEndpoint(Endpoint, StatsMixin):
+    permission_classes = (SuperuserPermission,)
+
+    def get(self, request):
+        key = request.GET['key']
+
+        data = tsdb.get_range(
+            model=tsdb.models.internal,
+            keys=[key],
+            **self._parse_args(request)
+        )[key]
+
+        return Response(data)
diff --git a/src/sentry/api/permissions.py b/src/sentry/api/permissions.py
index b7d15df617..b7a75301ca 100644
--- a/src/sentry/api/permissions.py
+++ b/src/sentry/api/permissions.py
@@ -52,3 +52,10 @@ class ScopedPermission(permissions.BasePermission):
 
     def is_project_key(self, request):
         return isinstance(request.auth, ProjectKey)
+
+
+class SuperuserPermission(permissions.BasePermission):
+    def has_permission(self, request, view):
+        if request.user.is_superuser:
+            return True
+        return False
diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index 696673e75c..c5c9637728 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -17,6 +17,7 @@ from .endpoints.group_tagkey_values import GroupTagKeyValuesEndpoint
 from .endpoints.helppage_details import HelpPageDetailsEndpoint
 from .endpoints.helppage_index import HelpPageIndexEndpoint
 from .endpoints.index import IndexEndpoint
+from .endpoints.internal_stats import InternalStatsEndpoint
 from .endpoints.legacy_project_redirect import LegacyProjectRedirectEndpoint
 from .endpoints.organization_details import OrganizationDetailsEndpoint
 from .endpoints.organization_member_details import OrganizationMemberDetailsEndpoint
@@ -177,6 +178,11 @@ urlpatterns = patterns(
         HelpPageDetailsEndpoint.as_view(),
         name='sentry-api-0-helppage-details'),
 
+    # Internal
+    url(r'^internal/stats/$',
+        InternalStatsEndpoint.as_view(),
+        name='sentry-api-0-internal-stats'),
+
     url(r'^$',
         IndexEndpoint.as_view(),
         name='sentry-api-catchall'),
