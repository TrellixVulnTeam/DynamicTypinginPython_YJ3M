commit c954e18fc9374b620ca3bcff4ef40a712e872ae1
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jan 6 14:37:42 2016 -0800

    Improve HTTP error handlers
    
    - Fix/re-implement 404 handler (missing 'request' context)
    - Unify client and server handlers
    - Add tests

diff --git a/src/sentry/conf/urls.py b/src/sentry/conf/urls.py
index 259c5a2059..704ba3bca2 100644
--- a/src/sentry/conf/urls.py
+++ b/src/sentry/conf/urls.py
@@ -16,16 +16,16 @@ try:
 except ImportError:
     # django < 1.5 compat
     from django.conf.urls.defaults import include, patterns, url  # NOQA
-from django.views.defaults import page_not_found
 from django.http import HttpResponse
 
 from sentry import django_admin, status_checks
 from sentry.utils import json
 from sentry.web.urls import urlpatterns as web_urlpatterns
 from sentry.web.frontend.csrf_failure import CsrfFailureView
+from sentry.web.frontend.error_404 import Error404View
 from sentry.web.frontend.error_500 import Error500View
 
-handler404 = lambda x: page_not_found(x, template_name='sentry/404.html')
+handler404 = Error404View.as_view()
 handler500 = Error500View.as_view()
 
 
@@ -45,10 +45,10 @@ def handler_healthcheck(request):
 
 urlpatterns = patterns(
     '',
+    url(r'^_health/$', handler_healthcheck, name='healthcheck'),
     url(r'^admin/', include(django_admin.site.urls)),
     url(r'^500/', handler500, name='error-500'),
-    url(r'^404/', handler404, name='error-400'),
-    url(r'^_health/$', handler_healthcheck, name='healthcheck'),
+    url(r'^404/', handler404, name='error-404'),
     url(r'^403-csrf-failure/', CsrfFailureView.as_view(), name='error-403-csrf-failure'),
     url(r'^__debug__/', include(debug_toolbar.urls)),
 ) + web_urlpatterns
diff --git a/src/sentry/static/sentry/app/views/routeError.jsx b/src/sentry/static/sentry/app/views/routeError.jsx
index dcc20b3213..b909918621 100644
--- a/src/sentry/static/sentry/app/views/routeError.jsx
+++ b/src/sentry/static/sentry/app/views/routeError.jsx
@@ -48,7 +48,7 @@ const RouteError = React.createClass({
           <span className="icon-exclamation" style={{fontSize: 20, marginRight: 10}} />
           <span>Oops! Something went wrong</span>
         </div>
-        <p>It looks like you've hit an issue in our client appliation. Don't worry
+        <p>It looks like you've hit an issue in our client application. Don't worry
           though! We use Sentry to monitor Sentry and it's likely we're already
           looking into this!</p>
         <p>If you're daring, you may want to try the following:</p>
diff --git a/src/sentry/static/sentry/app/views/routeNotFound.jsx b/src/sentry/static/sentry/app/views/routeNotFound.jsx
index 15ce976560..19b484e2a3 100644
--- a/src/sentry/static/sentry/app/views/routeNotFound.jsx
+++ b/src/sentry/static/sentry/app/views/routeNotFound.jsx
@@ -18,12 +18,21 @@ const RouteNotFound = React.createClass({
           <div className="container">
             <div className="content">
               <section className="body">
-                <div className="page-header">
-                  <h2>{t('Page Not Found')}</h2>
+                <div className="alert alert-block alert-error">
+                  <div style={{fontSize: 24, marginBottom: 10}}>
+                    <span className="icon-exclamation" style={{fontSize: 20, marginRight: 10}} />
+                    <span>{t('Page Not Found')}</span>
+                  </div>
+
+                  <p>The page you are looking for was not found.</p>
+                  <p>You may wish to try the following:</p>
+                  <ul>
+                      <li>If you entered the address manually, double check the path. Did you forget a trailing slash?</li>
+                      <li>If you followed a link here, try hitting back and reloading the page. It's possible the resource was moved out from under you.</li>
+                      <li>If all else fails, <a href="http://github.com/getsentry/sentry/issues">create an issue</a> with more details.</li>
+                  </ul>
+                  <p>Not sure what to do? <a href="/">Return to the dashboard</a></p>
                 </div>
-                <p className="alert-message notice">
-                  {t('The page you are looking for was not found.')}
-                </p>
               </section>
             </div>
           </div>
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index 68954234ed..597e4e3a73 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -1940,8 +1940,9 @@ table.integrations {
 }
 // ugh this is awful
 .alert-block p + ul,
-.alert-block p + p {
-  margin-top: 10px;
+.alert-block p + p,
+.alert-block ul + p {
+  margin-top: 10px !important;
 }
 
 .alert-error,
diff --git a/src/sentry/templates/sentry/404.html b/src/sentry/templates/sentry/404.html
index 1517f9ee3f..69b39eaedb 100644
--- a/src/sentry/templates/sentry/404.html
+++ b/src/sentry/templates/sentry/404.html
@@ -5,11 +5,20 @@
 {% block title %}{% trans "Page Not Found" %} | {{ block.super }}{% endblock %}
 
 {% block main %}
-    <section class="body">
-        <div class="page-header">
-            <h2>{% trans "Page Not Found" %}</h2>
-        </div>
-        <p class="alert-message notice">{% trans "The page you are looking for was not found." %}</p>
-        <p><a href="{% url 'sentry' %}">{% trans "Return to the dashboard" %}</a></p>
-    </section>
+  <section class="body">
+    <div class="alert alert-block alert-error">
+      <div style="font-size:24px;margin-bottom:10px">
+        <span class="icon-exclamation" style="font-size:20px;margin-right:10px;"></span>
+        <span>Page Not Found</span>
+      </div>
+      <p>{% trans "The page you are looking for was not found." %}</p>
+      <p>{% trans "You may wish to try the following:" %}</p>
+      <ul>
+        <li>If you entered the address manually, double check the path. Did you forget a trailing slash?</li>
+        <li>If you followed a link here, try hitting back and reloading the page. It's possible the resource was moved out from under you.</li>
+        <li>If all else fails, <a href="http://github.com/getsentry/sentry/issues">create an issue</a> with more details.</li>
+      </ul>
+      <p>Not sure what to do? <a href="{% url 'sentry' %}">{% trans "Return to the dashboard" %}</a></p>
+    </div>
+  </section>
 {% endblock %}
diff --git a/src/sentry/templates/sentry/500.html b/src/sentry/templates/sentry/500.html
index f5e27cd52d..086c9e977d 100644
--- a/src/sentry/templates/sentry/500.html
+++ b/src/sentry/templates/sentry/500.html
@@ -6,10 +6,21 @@
 
 {% block main %}
   <section class="body">
-    <div class="page-header">
-      <h2>{% trans "Internal Server Error" %}</h2>
+    <div class="alert alert-block alert-error">
+      <div style="font-size:24px;margin-bottom:10px">
+        <span class="icon-exclamation" style="font-size:20px;margin-right:10px;"></span>
+        <span>Oops! Something went wrong</span>
+      </div>
+
+      <p>It looks like you've hit an issue in our server API. Don't worry
+        though! We use Sentry to monitor Sentry and it's likely we're already
+        looking into this!</p>
+      <p>If you're daring, you may want to try the following:</p>
+      <ul>
+        <li>Give it a few seconds and <a onClick="window.location.href = window.location.href">reload the page</a>.</li>
+        <li>If all else fails, <a href="http://github.com/getsentry/sentry/issues">create an issue</a> with more details.</li>
+      </ul>
     </div>
-    <p>{% trans "There was an internal server error while processing your request." %}</p>
 
     {% if request.sentry.id %}
       <script>
diff --git a/src/sentry/web/frontend/error_404.py b/src/sentry/web/frontend/error_404.py
new file mode 100644
index 0000000000..7196d138da
--- /dev/null
+++ b/src/sentry/web/frontend/error_404.py
@@ -0,0 +1,15 @@
+from __future__ import absolute_import
+
+from django.views.generic import View
+from django.template import Context, loader
+from django.http import HttpResponseNotFound
+
+
+class Error404View(View):
+    def dispatch(self, request):
+        context = {
+            'request': request,
+        }
+
+        t = loader.get_template('sentry/404.html')
+        return HttpResponseNotFound(t.render(Context(context)))
diff --git a/tests/sentry/web/frontend/test_error_404.py b/tests/sentry/web/frontend/test_error_404.py
new file mode 100644
index 0000000000..cf78ebbbab
--- /dev/null
+++ b/tests/sentry/web/frontend/test_error_404.py
@@ -0,0 +1,14 @@
+from __future__ import absolute_import
+
+from django.core.urlresolvers import reverse
+
+from sentry.testutils import TestCase
+
+
+class Error404Test(TestCase):
+    urls = 'sentry.conf.urls'
+
+    def test_renders(self):
+        resp = self.client.get(reverse('error-404'))
+        assert resp.status_code == 404
+        self.assertTemplateUsed(resp, 'sentry/404.html')
diff --git a/tests/sentry/web/frontend/test_error_500.py b/tests/sentry/web/frontend/test_error_500.py
new file mode 100644
index 0000000000..36c0301142
--- /dev/null
+++ b/tests/sentry/web/frontend/test_error_500.py
@@ -0,0 +1,14 @@
+from __future__ import absolute_import
+
+from django.core.urlresolvers import reverse
+
+from sentry.testutils import TestCase
+
+
+class Error500Test(TestCase):
+    urls = 'sentry.conf.urls'
+
+    def test_renders(self):
+        resp = self.client.get(reverse('error-500'))
+        assert resp.status_code == 500
+        self.assertTemplateUsed(resp, 'sentry/500.html')
