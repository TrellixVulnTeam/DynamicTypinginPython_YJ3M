commit e1ec756c202246773085adcac54f3594cbf5f9ac
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Thu Oct 11 12:10:15 2018 -0700

    ref(integrations): Remove integration flags that are defaulted to on

diff --git a/src/sentry/api/endpoints/organization_config_integrations.py b/src/sentry/api/endpoints/organization_config_integrations.py
index e5dc789c6c..d62cac6aa0 100644
--- a/src/sentry/api/endpoints/organization_config_integrations.py
+++ b/src/sentry/api/endpoints/organization_config_integrations.py
@@ -12,39 +12,12 @@ from django.conf import settings
 
 class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
     def get(self, request, organization):
-        has_bb = features.has('organizations:bitbucket-integration',
-                              organization,
-                              actor=request.user)
-        has_ghe = features.has('organizations:github-enterprise',
-                               organization,
-                               actor=request.user)
         has_catchall = features.has('organizations:internal-catchall',
                                     organization,
                                     actor=request.user)
-        has_github_apps = features.has('organizations:github-apps',
-                                       organization,
-                                       actor=request.user)
-        has_jira = features.has('organizations:jira-integration',
-                                organization,
-                                actor=request.user)
-        has_vsts = features.has('organizations:vsts-integration',
-                                organization,
-                                actor=request.user)
-
         providers = []
         for provider in integrations.all():
-            internal_integrations = {i for i in settings.SENTRY_INTERNAL_INTEGRATIONS}
-            if has_bb:
-                internal_integrations.remove('bitbucket')
-            if has_ghe:
-                internal_integrations.remove('github_enterprise')
-            if has_github_apps:
-                internal_integrations.remove('github')
-            if has_jira:
-                internal_integrations.remove('jira')
-            if has_vsts:
-                internal_integrations.remove('vsts')
-            if not has_catchall and provider.key in internal_integrations:
+            if not has_catchall and provider.key in settings.SENTRY_INTERNAL_INTEGRATIONS:
                 continue
 
             providers.append(provider)
diff --git a/src/sentry/api/endpoints/organization_repositories.py b/src/sentry/api/endpoints/organization_repositories.py
index 114e10aa94..5cda354a44 100644
--- a/src/sentry/api/endpoints/organization_repositories.py
+++ b/src/sentry/api/endpoints/organization_repositories.py
@@ -98,28 +98,18 @@ class OrganizationRepositoriesEndpoint(OrganizationEndpoint):
             }, status=403)
 
         provider_id = request.DATA.get('provider')
-        has_ghe = provider_id == 'integrations:github_enterprise' and features.has(
-            'organizations:github-enterprise', organization, actor=request.user)
-        has_bb = provider_id == 'integrations:bitbucket' and features.has(
-            'organizations:bitbucket-integration', organization, actor=request.user)
-        has_vsts = provider_id == 'integrations:vsts' and features.has(
-            'organizations:vsts-integration', organization, actor=request.user)
-        has_github = provider_id == 'integrations:github' and features.has(
-            'organizations:github-apps', organization, actor=request.user)
-
-        if features.has('organizations:internal-catchall', organization,
-                        actor=request.user) or has_ghe or has_bb or has_vsts or has_github:
-            if provider_id is not None and provider_id.startswith('integrations:'):
-                try:
-                    provider_cls = bindings.get('integration-repository.provider').get(provider_id)
-                except KeyError:
-                    return Response(
-                        {
-                            'error_type': 'validation',
-                        }, status=400
-                    )
-                provider = provider_cls(id=provider_id)
-                return provider.dispatch(request, organization)
+
+        if provider_id is not None and provider_id.startswith('integrations:'):
+            try:
+                provider_cls = bindings.get('integration-repository.provider').get(provider_id)
+            except KeyError:
+                return Response(
+                    {
+                        'error_type': 'validation',
+                    }, status=400
+                )
+            provider = provider_cls(id=provider_id)
+            return provider.dispatch(request, organization)
 
         try:
             provider_cls = bindings.get('repository.provider').get(provider_id)
diff --git a/src/sentry/api/serializers/models/organization.py b/src/sentry/api/serializers/models/organization.py
index 09f8770ea9..c40f848f70 100644
--- a/src/sentry/api/serializers/models/organization.py
+++ b/src/sentry/api/serializers/models/organization.py
@@ -119,8 +119,6 @@ class DetailedOrganizationSerializer(OrganizationSerializer):
             feature_list.append('api-keys')
         if features.has('organizations:group-unmerge', obj, actor=user):
             feature_list.append('group-unmerge')
-        if features.has('organizations:github-apps', obj, actor=user):
-            feature_list.append('github-apps')
         if features.has('organizations:require-2fa', obj, actor=user):
             feature_list.append('require-2fa')
         if features.has('organizations:repos', obj, actor=user):
@@ -129,14 +127,6 @@ class DetailedOrganizationSerializer(OrganizationSerializer):
             feature_list.append('internal-catchall')
         if features.has('organizations:new-issue-ui', obj, actor=user):
             feature_list.append('new-issue-ui')
-        if features.has('organizations:github-enterprise', obj, actor=user):
-            feature_list.append('github-enterprise')
-        if features.has('organizations:bitbucket-integration', obj, actor=user):
-            feature_list.append('bitbucket-integration')
-        if features.has('organizations:jira-integration', obj, actor=user):
-            feature_list.append('jira-integration')
-        if features.has('organizations:vsts-integration', obj, actor=user):
-            feature_list.append('vsts-integration')
         if features.has('organizations:integrations-issue-basic', obj, actor=user):
             feature_list.append('integrations-issue-basic')
         if features.has('organizations:integrations-issue-sync', obj, actor=user):
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 92aa265c8f..792bbb3d75 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -774,15 +774,10 @@ SENTRY_FEATURES = {
     'organizations:sso-saml2': True,
     'organizations:sso-rippling': False,
     'organizations:group-unmerge': False,
-    'organizations:github-apps': True,
     'organizations:invite-members': True,
     'organizations:require-2fa': False,
     'organizations:internal-catchall': False,
     'organizations:new-issue-ui': True,
-    'organizations:github-enterprise': True,
-    'organizations:bitbucket-integration': True,
-    'organizations:jira-integration': True,
-    'organizations:vsts-integration': True,
     'organizations:integrations-issue-basic': False,
     'organizations:integrations-issue-sync': False,
     'organizations:new-teams': True,
@@ -1279,12 +1274,7 @@ SENTRY_DEFAULT_INTEGRATIONS = (
 )
 
 SENTRY_INTERNAL_INTEGRATIONS = (
-    'bitbucket',
-    'github',
-    'github_enterprise',
     'gitlab',
-    'jira',
-    'vsts',
     'vsts-extension',
 )
 
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index 64380a8944..740dacd973 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -17,15 +17,10 @@ default_manager.add('organizations:repos', OrganizationFeature)  # NOQA
 default_manager.add('organizations:release-commits', OrganizationFeature)  # NOQA
 default_manager.add('organizations:suggested-commits', OrganizationFeature)  # NOQA
 default_manager.add('organizations:group-unmerge', OrganizationFeature)  # NOQA
-default_manager.add('organizations:github-apps', OrganizationFeature)  # NOQA
 default_manager.add('organizations:invite-members', OrganizationFeature)  # NOQA
 default_manager.add('organizations:require-2fa', OrganizationFeature)  # NOQA
 default_manager.add('organizations:internal-catchall', OrganizationFeature)  # NOQA
 default_manager.add('organizations:new-issue-ui', OrganizationFeature)  # NOQA
-default_manager.add('organizations:github-enterprise', OrganizationFeature)  # NOQA
-default_manager.add('organizations:bitbucket-integration', OrganizationFeature)  # NOQA
-default_manager.add('organizations:jira-integration', OrganizationFeature)  # NOQA
-default_manager.add('organizations:vsts-integration', OrganizationFeature)  # NOQA
 default_manager.add('organizations:integrations-issue-basic', OrganizationFeature)  # NOQA
 default_manager.add('organizations:integrations-issue-sync', OrganizationFeature)  # NOQA
 default_manager.add('organizations:new-teams', OrganizationFeature)  # NOQA
diff --git a/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx b/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
index c31c1b7ae9..0cd151651c 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
@@ -7,17 +7,12 @@ import {t, tct} from 'app/locale';
 import AlertLink from 'app/components/alertLink';
 import Button from 'app/components/button';
 import Confirm from 'app/components/confirm';
-import DropdownLink from 'app/components/dropdownLink';
-import Feature from 'app/components/feature';
 import HeroIcon from 'app/components/heroIcon';
-import MenuItem from 'app/components/menuItem';
 import SpreadLayout from 'app/components/spreadLayout';
 import {Panel, PanelBody, PanelHeader} from 'app/components/panels';
 import SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';
 import TextBlock from 'app/views/settings/components/text/textBlock';
 
-import AddRepositoryLink from './addRepositoryLink';
-
 const RepoRow = styled(SpreadLayout)`
   border-bottom: 1px solid ${p => p.theme.borderLight};
 
@@ -29,8 +24,6 @@ const RepoRow = styled(SpreadLayout)`
 export default class OrganizationRepositories extends React.Component {
   static propTypes = {
     itemList: PropTypes.array,
-    repoConfig: PropTypes.object,
-    onAddRepo: PropTypes.func,
     onCancelDelete: PropTypes.func,
     onDeleteRepo: PropTypes.func,
   };
@@ -51,70 +44,18 @@ export default class OrganizationRepositories extends React.Component {
   }
 
   render() {
-    let {
-      params,
-      itemList,
-      repoConfig,
-      onAddRepo,
-      onCancelDelete,
-      onDeleteRepo,
-    } = this.props;
+    let {params, itemList, onCancelDelete, onDeleteRepo} = this.props;
     let {orgId} = params;
     let hasItemList = itemList && itemList.length > 0;
 
     return (
       <div>
-        <SettingsPageHeader
-          title={t('Repositories')}
-          action={
-            <Feature
-              feature={['bitbucket-integration', 'github-enterprise']}
-              requireAll={false}
-            >
-              {({hasFeature}) => {
-                return (
-                  !hasFeature && (
-                    <DropdownLink
-                      anchorRight
-                      className="btn btn-primary btn-sm"
-                      title={t('Add Repository')}
-                    >
-                      {repoConfig &&
-                        repoConfig.providers &&
-                        repoConfig.providers.map(provider => {
-                          return (
-                            <MenuItem noAnchor={true} key={provider.id}>
-                              <AddRepositoryLink
-                                provider={provider}
-                                orgId={orgId}
-                                onSuccess={onAddRepo}
-                              />
-                            </MenuItem>
-                          );
-                        })}
-                    </DropdownLink>
-                  )
-                );
-              }}
-            </Feature>
-          }
-        />
-        <Feature
-          feature={['bitbucket-integration', 'github-enterprise']}
-          requireAll={false}
-        >
-          {({hasFeature}) => {
-            return (
-              hasFeature && (
-                <AlertLink to={`/settings/${orgId}/integrations/`}>
-                  {t(
-                    'Want to add a repository to start tracking commits? Install or configure your version control integration here.'
-                  )}
-                </AlertLink>
-              )
-            );
-          }}
-        </Feature>
+        <SettingsPageHeader title={t('Repositories')} />
+        <AlertLink to={`/settings/${orgId}/integrations/`}>
+          {t(
+            'Want to add a repository to start tracking commits? Install or configure your version control integration here.'
+          )}
+        </AlertLink>
         {!hasItemList && (
           <div className="m-b-2">
             <TextBlock>
diff --git a/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap b/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
index 525afc184a..300b584aa8 100644
--- a/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
+++ b/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
@@ -3,32 +3,14 @@
 exports[`OrganizationRepositories renders with a repository 1`] = `
 <div>
   <SettingsPageHeading
-    action={
-      <FeatureContainer
-        feature={
-          Array [
-            "bitbucket-integration",
-            "github-enterprise",
-          ]
-        }
-        requireAll={false}
-      >
-        [Function]
-      </FeatureContainer>
-    }
     title="Repositories"
   />
-  <FeatureContainer
-    feature={
-      Array [
-        "bitbucket-integration",
-        "github-enterprise",
-      ]
-    }
-    requireAll={false}
+  <AlertLink
+    priority="warning"
+    to="/settings/org-slug/integrations/"
   >
-    <Component />
-  </FeatureContainer>
+    Want to add a repository to start tracking commits? Install or configure your version control integration here.
+  </AlertLink>
   <Panel>
     <PanelHeader
       disablePadding={true}
@@ -110,32 +92,14 @@ exports[`OrganizationRepositories renders with a repository 1`] = `
 exports[`OrganizationRepositories renders with github provider 1`] = `
 <div>
   <SettingsPageHeading
-    action={
-      <FeatureContainer
-        feature={
-          Array [
-            "bitbucket-integration",
-            "github-enterprise",
-          ]
-        }
-        requireAll={false}
-      >
-        [Function]
-      </FeatureContainer>
-    }
     title="Repositories"
   />
-  <FeatureContainer
-    feature={
-      Array [
-        "bitbucket-integration",
-        "github-enterprise",
-      ]
-    }
-    requireAll={false}
+  <AlertLink
+    priority="warning"
+    to="/settings/org-slug/integrations/"
   >
-    <Component />
-  </FeatureContainer>
+    Want to add a repository to start tracking commits? Install or configure your version control integration here.
+  </AlertLink>
   <div
     className="m-b-2"
   >
@@ -202,32 +166,14 @@ exports[`OrganizationRepositories renders with github provider 1`] = `
 exports[`OrganizationRepositories renders without providers 1`] = `
 <div>
   <SettingsPageHeading
-    action={
-      <FeatureContainer
-        feature={
-          Array [
-            "bitbucket-integration",
-            "github-enterprise",
-          ]
-        }
-        requireAll={false}
-      >
-        [Function]
-      </FeatureContainer>
-    }
     title="Repositories"
   />
-  <FeatureContainer
-    feature={
-      Array [
-        "bitbucket-integration",
-        "github-enterprise",
-      ]
-    }
-    requireAll={false}
+  <AlertLink
+    priority="warning"
+    to="/settings/org-slug/integrations/"
   >
-    <Component />
-  </FeatureContainer>
+    Want to add a repository to start tracking commits? Install or configure your version control integration here.
+  </AlertLink>
   <div
     className="m-b-2"
   >
