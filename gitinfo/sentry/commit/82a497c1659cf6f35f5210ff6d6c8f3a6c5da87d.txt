commit 82a497c1659cf6f35f5210ff6d6c8f3a6c5da87d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 8 08:42:11 2015 -0700

    Various polish for org/project details
    
    - Adds document title
    - Improves loading/error conditions

diff --git a/package.json b/package.json
index cdd251c60c..523f0c698c 100644
--- a/package.json
+++ b/package.json
@@ -34,6 +34,7 @@
     "raven-js": "^1.1.11",
     "react": "^0.13.3",
     "react-bootstrap": "^0.13.0",
+    "react-document-title": "^1.0.2",
     "react-router": "^0.13.3",
     "react-sticky": "^2.1.0",
     "reflux": "^0.2.2",
diff --git a/src/sentry/static/sentry/app/utils.jsx b/src/sentry/static/sentry/app/utils.jsx
index 6f426381a5..d74f1cf3f4 100644
--- a/src/sentry/static/sentry/app/utils.jsx
+++ b/src/sentry/static/sentry/app/utils.jsx
@@ -1,6 +1,12 @@
 /*** @jsx React.DOM */
 
-var modelCompare = function(obj1, obj2) {
+var modelsEqual = function(obj1, obj2) {
+  if (!obj1 && !obj2)
+    return true;
+  if (obj1.id && !obj2)
+    return false;
+  if (obj2.id && !obj1)
+    return false;
   return obj1.id === obj2.id;
 };
 
@@ -167,6 +173,7 @@ module.exports = {
   arrayIsEqual: arrayIsEqual,
   objectMatchesSubset: objectMatchesSubset,
   compareArrays: compareArrays,
+  modelsEqual: modelsEqual,
   valueIsEqual: valueIsEqual,
   parseLinkHeader: require('./utils/parseLinkHeader'),
 
diff --git a/src/sentry/static/sentry/app/views/organizationDetails.jsx b/src/sentry/static/sentry/app/views/organizationDetails.jsx
index b007d24d32..1d9663c258 100644
--- a/src/sentry/static/sentry/app/views/organizationDetails.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDetails.jsx
@@ -5,11 +5,13 @@ var Router = require("react-router");
 
 var api = require("../api");
 var BreadcrumbMixin = require("../mixins/breadcrumbMixin");
-var LoadingIndicator = require("../components/loadingIndicator");
+var DocumentTitle = require("react-document-title");
+var Footer = require("../components/footer");
 var Header = require("../components/header");
-var PropTypes = require("../proptypes");
+var LoadingError = require("../components/loadingError");
+var LoadingIndicator = require("../components/loadingIndicator");
 var OrganizationState = require("../mixins/organizationState");
-var Footer = require("../components/footer");
+var PropTypes = require("../proptypes");
 var RouteMixin = require("../mixins/routeMixin");
 var TeamStore = require("../stores/teamStore");
 
@@ -37,7 +39,7 @@ var OrganizationDetails = React.createClass({
 
   getInitialState() {
     return {
-      loading: false,
+      loading: true,
       error: false,
       organization: null
     };
@@ -73,6 +75,12 @@ var OrganizationDetails = React.createClass({
         this.setBreadcrumbs([
           {name: data.name, to: 'organizationDetails'}
         ]);
+      },
+      error: () => {
+        this.setState({
+          loading: false,
+          error: true
+        });
       }
     });
   },
@@ -83,18 +91,26 @@ var OrganizationDetails = React.createClass({
     return '/organizations/' + params.orgId + '/';
   },
 
+  getTitle() {
+    if (this.state.organization)
+      return this.state.organization.name + ' | Sentry';
+    return 'Sentry';
+  },
+
   render() {
-    if (this.state.loading) {
+    if (this.state.loading)
       return <LoadingIndicator />;
-    }
+    else if (this.state.error)
+      return <LoadingError onRetry={this.fetchData} />;
+
     return (
-      <div>
+      <DocumentTitle title={this.getTitle()}>
         <div className="app">
           <Header />
           <Router.RouteHandler />
           <Footer />
         </div>
-      </div>
+      </DocumentTitle>
     );
   }
 });
diff --git a/src/sentry/static/sentry/app/views/projectDetails.jsx b/src/sentry/static/sentry/app/views/projectDetails.jsx
index 88577f286c..05d0a746e9 100644
--- a/src/sentry/static/sentry/app/views/projectDetails.jsx
+++ b/src/sentry/static/sentry/app/views/projectDetails.jsx
@@ -8,8 +8,11 @@ var api = require("../api");
 var BreadcrumbMixin = require("../mixins/breadcrumbMixin");
 var ConfigStore = require("../stores/configStore");
 var DropdownLink = require("../components/dropdownLink");
+var DocumentTitle = require("react-document-title");
 var MemberListStore = require("../stores/memberListStore");
 var MenuItem = require("../components/menuItem");
+var {modelsEqual} = require("../utils");
+var LoadingError = require("../components/loadingError");
 var LoadingIndicator = require("../components/loadingIndicator");
 var ProjectHeader = require("../components/projectHeader");
 var OrganizationState = require("../mixins/organizationState");
@@ -136,6 +139,8 @@ var ProjectDetails = React.createClass({
 
   getInitialState() {
     return {
+      loading: true,
+      error: false,
       memberList: [],
       project: null,
       team: null,
@@ -147,6 +152,17 @@ var ProjectDetails = React.createClass({
     this.fetchData();
   },
 
+  componentDidUpdate(prevProps, prevState) {
+    if (!modelsEqual(prevState.project, this.state.project)) {
+      var project = this.state.project;
+      var org = this.getOrganization();
+      this.setBreadcrumbs([
+        <ProjectSelector organization={org} projectId={this.project.slug}
+                         router={this.context.router} />
+      ]);
+    }
+  },
+
   routeDidChange(nextPath, nextParams) {
     var router = this.context.router;
     var params = router.getCurrentParams();
@@ -162,25 +178,26 @@ var ProjectDetails = React.createClass({
       return;
     }
 
+    this.setState({
+      loading: true,
+      error: false
+    });
+
     var router = this.context.router;
     var params = router.getCurrentParams();
     var projectSlug = params.projectId;
-    var activeProject;
+    var activeProject = null;
+    var activeTeam = null;
     org.teams.forEach((team) => {
       team.projects.forEach((project) => {
         if (project.slug == projectSlug) {
           activeProject = project;
+          activeTeam = team;
         }
       });
     });
 
-    this.setState({
-      project: activeProject,
-      loading: false,
-      error: typeof activeProject !== "undefined"
-    });
-
-    if (typeof activeProject !== "undefined") {
+    if (activeProject) {
       // TODO(dcramer): move member list to organization level
       api.request(this.getMemberListEndpoint(), {
         success: (data) => {
@@ -188,9 +205,16 @@ var ProjectDetails = React.createClass({
         }
       });
 
-      this.setBreadcrumbs([
-        <ProjectSelector organization={org} projectId={projectSlug} router={this.context.router} />
-      ]);
+      this.setState({
+        project: activeProject,
+        team: activeTeam,
+        loading: false
+      });
+    } else {
+      this.setState({
+        loading: false,
+        error: true
+      });
     }
   },
 
@@ -206,22 +230,32 @@ var ProjectDetails = React.createClass({
     });
   },
 
+  getTitle() {
+    if (this.state.project)
+      return this.state.team.name + ' / ' + this.state.project.name + ' | Sentry';
+    return 'Sentry';
+  },
+
   render() {
-    if (!this.state.project) {
+    if (this.state.loading)
       return <LoadingIndicator />;
-    }
+    else if (this.state.error)
+      return <LoadingError onRetry={this.fetchData} />;
+
     return (
-      <div>
-        <ProjectHeader activeSection={this.state.projectNavSection} />
-        <div className="container">
-          <div className="content">
-            <Router.RouteHandler
-                memberList={this.state.memberList}
-                setProjectNavSection={this.setProjectNavSection}
-                {...this.props} />
+      <DocumentTitle title={this.getTitle()}>
+        <div>
+          <ProjectHeader activeSection={this.state.projectNavSection} />
+          <div className="container">
+            <div className="content">
+              <Router.RouteHandler
+                  memberList={this.state.memberList}
+                  setProjectNavSection={this.setProjectNavSection}
+                  {...this.props} />
+            </div>
           </div>
         </div>
-      </div>
+      </DocumentTitle>
     );
   }
 });
diff --git a/webpack.config.js b/webpack.config.js
index 3a7029c38e..94d2bacc2d 100644
--- a/webpack.config.js
+++ b/webpack.config.js
@@ -16,6 +16,7 @@ module.exports = {
       "moment",
       "raven-js",
       "react/addons",
+      "react-document-title",
       "react-router",
       "react-bootstrap",
       "reflux",
