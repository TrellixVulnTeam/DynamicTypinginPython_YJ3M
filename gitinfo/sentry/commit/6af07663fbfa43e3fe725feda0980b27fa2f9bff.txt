commit 6af07663fbfa43e3fe725feda0980b27fa2f9bff
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Dec 23 10:52:59 2010 -0800

    Basic tests to ensure haystack is working

diff --git a/.gitignore b/.gitignore
index c20f25f60e..6781066768 100644
--- a/.gitignore
+++ b/.gitignore
@@ -7,4 +7,5 @@ pip-log.txt
 .DS_Store
 /example_project/local_settings.py
 /docs/html
-/docs/doctrees
\ No newline at end of file
+/docs/doctrees
+/sentry_index
\ No newline at end of file
diff --git a/runtests.py b/runtests.py
index ffd8576b56..6277b81d9b 100644
--- a/runtests.py
+++ b/runtests.py
@@ -1,7 +1,7 @@
 #!/usr/bin/env python
 import logging
 import sys
-from os.path import dirname, abspath
+from os.path import dirname, abspath, join
 
 logging.getLogger('sentry').addHandler(logging.StreamHandler())
 
@@ -26,7 +26,7 @@ if not settings.configured:
             'indexer',
             'south',
             'djcelery', # celery client
-            # 'haystack',
+            'haystack',
 
             'sentry',
             'sentry.client',
@@ -51,6 +51,12 @@ if not settings.configured:
         CELERY_ALWAYS_EAGER=True,
         SENTRY_THRASHING_LIMIT=0,
         TEMPLATE_DEBUG=True,
+        HAYSTACK_SITECONF='sentry.search_indexes',
+        HAYSTACK_SEARCH_ENGINE='whoosh',
+        SENTRY_SEARCH_ENGINE='whoosh',
+        SENTRY_SEARCH_OPTIONS={
+            'path': join(dirname(__file__), 'sentry_index'),
+        },
     )
     import djcelery
     djcelery.setup_loader()
diff --git a/sentry/tests/tests.py b/sentry/tests/tests.py
index 114efd5844..9495af9b27 100644
--- a/sentry/tests/tests.py
+++ b/sentry/tests/tests.py
@@ -984,3 +984,14 @@ class SentryManageTest(TestCase):
         command.handle(days=1)
         
         self.assertEquals(Message.objects.count(), 0)
+
+class SentrySearchTest(TestCase):
+    urls = 'sentry.tests.urls'
+
+    def test_build_index(self):
+        from sentry.views import get_search_query_set
+        logger.error('test search error')
+        
+        qs = get_search_query_set('error')
+        self.assertEquals(qs.count(), 1)
+        self.assertEquals(qs[0:1][0].message, 'test search error')
\ No newline at end of file
