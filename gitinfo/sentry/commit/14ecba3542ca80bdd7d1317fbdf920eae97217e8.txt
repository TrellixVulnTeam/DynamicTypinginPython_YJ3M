commit 14ecba3542ca80bdd7d1317fbdf920eae97217e8
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Aug 31 15:41:19 2017 -0400

    fix(api): Remove case insensitive email searches from EventUser
    
    We don't have a proper functional index on these, and we had an incident
    where we were hitting a bunch of queries that took multiple minutes
    causing some brief downtime.
    
    The alternative is to add another functional index for this as well.
    
    To do this, I'd prefer if we just maintained one index, and made all
    lookup on this field case insensitive to not need to maintain both. But
    as it stands, event attempting to add this index is causing performance
    issues since the table is so massive, so trying to punt on adding a new
    index unless absolutely necessary.

diff --git a/src/sentry/api/endpoints/organization_user_issues_search.py b/src/sentry/api/endpoints/organization_user_issues_search.py
index add9a2cc9b..ec143e0b3e 100644
--- a/src/sentry/api/endpoints/organization_user_issues_search.py
+++ b/src/sentry/api/endpoints/organization_user_issues_search.py
@@ -29,7 +29,7 @@ class OrganizationUserIssuesSearchEndpoint(OrganizationEndpoint):
         )
 
         event_users = EventUser.objects.filter(
-            email__iexact=email,
+            email=email,
             project_id__in=project_ids,
         )[:1000]
 
diff --git a/src/sentry/api/endpoints/project_user_reports.py b/src/sentry/api/endpoints/project_user_reports.py
index c76de13e1f..d3c9ec7a24 100644
--- a/src/sentry/api/endpoints/project_user_reports.py
+++ b/src/sentry/api/endpoints/project_user_reports.py
@@ -150,7 +150,7 @@ class ProjectUserReportsEndpoint(ProjectEndpoint):
             try:
                 return EventUser.objects.filter(
                     project=report.project_id,
-                    email__iexact=report.email,
+                    email=report.email,
                 )[0]
             except IndexError:
                 return None
diff --git a/src/sentry/models/eventuser.py b/src/sentry/models/eventuser.py
index a3a720bc2f..d27f6d3601 100644
--- a/src/sentry/models/eventuser.py
+++ b/src/sentry/models/eventuser.py
@@ -109,7 +109,7 @@ class EventUser(Model):
 
         filters = []
         if self.email:
-            filters.append(models.Q(email__iexact=self.email))
+            filters.append(models.Q(email=self.email))
         if self.ip_address:
             filters.append(models.Q(ip_address=self.ip_address))
         if not filters:
