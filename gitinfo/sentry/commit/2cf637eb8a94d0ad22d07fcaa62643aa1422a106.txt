commit 2cf637eb8a94d0ad22d07fcaa62643aa1422a106
Author: josh <josh@jrl.ninja>
Date:   Thu Jan 9 21:51:02 2020 +0000

    test: fix remaining Django 1.11 tests and make required (#16367)

diff --git a/.travis.yml b/.travis.yml
index ff5e1a6fe9..6123451547 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -149,17 +149,14 @@ matrix:
       name: 'Acceptance'
       env: TEST_SUITE=acceptance USE_SNUBA=1
 
-    # allowed to fail
     - <<: *postgres_default
       name: '[Django 1.11] Backend with migrations [Postgres] (1/2)'
       env: DJANGO_VERSION=">=1.11,<1.12" TEST_SUITE=postgres DB=postgres TOTAL_TEST_GROUPS=2 TEST_GROUP=0 MIGRATIONS_TEST_MIGRATE=1
 
-    # allowed to fail
     - <<: *postgres_default
       name: '[Django 1.11] Backend with migrations [Postgres] (2/2)'
       env: DJANGO_VERSION=">=1.11,<1.12" TEST_SUITE=postgres DB=postgres TOTAL_TEST_GROUPS=2 TEST_GROUP=1 MIGRATIONS_TEST_MIGRATE=1
 
-    # allowed to fail
     - <<: *acceptance_default
       name: '[Django 1.11] Acceptance'
       env: DJANGO_VERSION=">=1.11,<1.12" TEST_SUITE=acceptance USE_SNUBA=1 PERCY_ENABLE=0
@@ -229,7 +226,6 @@ matrix:
       before_script:
         - psql -c 'create database sentry;' -U postgres
 
-    # allowed to fail
     - python: 2.7
       name: '[Django 1.11] Snuba Integration with migrations'
       env: DJANGO_VERSION=">=1.11,<1.12" TEST_SUITE=snuba USE_SNUBA=1 SENTRY_ZOOKEEPER_HOSTS=localhost:2181 SENTRY_KAFKA_HOSTS=localhost:9092 MIGRATIONS_TEST_MIGRATE=1
@@ -273,10 +269,6 @@ matrix:
 
   allow_failures:
     - name: 'Storybook Deploy'
-    - name: '[Django 1.11] Backend with migrations [Postgres] (1/2)'
-    - name: '[Django 1.11] Backend with migrations [Postgres] (2/2)'
-    - name: '[Django 1.11] Acceptance'
-    - name: '[Django 1.11] Snuba Integration with migrations'
 
 notifications:
   webhooks:
diff --git a/tests/integration/tests.py b/tests/integration/tests.py
index 9d0024e32a..a34553686a 100644
--- a/tests/integration/tests.py
+++ b/tests/integration/tests.py
@@ -491,6 +491,7 @@ class SentryRemoteTest(SnubaTestCase):
 
 
 class SentryWsgiRemoteTest(TransactionTestCase):
+    @override_settings(ALLOWED_HOSTS=["localhost"])
     def test_traceparent_header_wsgi(self):
         # Assert that posting something to store will not create another
         # (transaction) event under any circumstances.
diff --git a/tests/sentry/utils/test_linksign.py b/tests/sentry/utils/test_linksign.py
index ef5be94ed3..cb6df6616d 100644
--- a/tests/sentry/utils/test_linksign.py
+++ b/tests/sentry/utils/test_linksign.py
@@ -2,6 +2,7 @@
 
 from __future__ import absolute_import
 
+from django.test import override_settings
 from django.test.client import RequestFactory
 
 from sentry.testutils import TestCase
@@ -9,6 +10,7 @@ from sentry.utils import linksign
 
 
 class LinkSignTestCase(TestCase):
+    @override_settings(ALLOWED_HOSTS=["something-else", "testserver"])
     def test_link_signing(self):
         rf = RequestFactory()
 
