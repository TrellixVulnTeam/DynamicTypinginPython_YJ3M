commit 2a804392a3124f8c336bb77638173c3b92f60dd1
Author: Sarah Lohmeier <sarah.lohmeier@sentry.io>
Date:   Thu May 28 15:33:08 2020 -0700

    feat(api): Log session_expiration (#19070)
    
    The library we use to parse SAML responses, OneLogin, has a built-in method for fetching the SessionNotOnOrAfter attribute if it's sent in the SAML response. Okta doesn't send this attribute, but we don't know whether any other SAML identity provider sends this attribute. If anyone is sending this attribute, we need to fetch this value and set it as the session cookie's expiration. But if no one is sending it, that'd just be dead code and wasted effort.
    
    This is a temporary change, that should be reverted in less than a week.

diff --git a/src/sentry/auth/providers/saml2/provider.py b/src/sentry/auth/providers/saml2/provider.py
index 377c75fef2..edad4453df 100644
--- a/src/sentry/auth/providers/saml2/provider.py
+++ b/src/sentry/auth/providers/saml2/provider.py
@@ -1,5 +1,7 @@
 from __future__ import absolute_import, print_function
 
+import logging
+
 from django.contrib import messages
 from django.contrib.auth import logout
 from django.core.urlresolvers import reverse
@@ -152,6 +154,14 @@ class SAML2ACSView(AuthView):
 
         helper.bind_state("auth_attributes", auth.get_attributes())
 
+        # XXX(slohmes): 5/28/2020 Temporarily adding logging here to check if any IdPs send a SessionNotOnOrAfter
+        # value in their SAML response.
+        if auth.get_session_expiration() is not None:
+            logging.warning(
+                "Received SessionNotOnOrAfter value in SAML response",
+                extra={"session_expiration": auth.get_session_expiration()},
+            )
+
         return helper.next_step()
 
 
