commit 82d2d38bf5c94c7baab4368a742046938dfce6c1
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Mon Nov 19 22:16:12 2018 +0100

    test: Fix a flaky test test_updates_group (#10658)
    
    * test: Fix a flaky test test_updates_group
    
    * fix: A better fix for the testcase which shows the intended behavior more

diff --git a/tests/sentry/event_manager/test_event_manager.py b/tests/sentry/event_manager/test_event_manager.py
index a65172eeec..a3a3c61cf1 100644
--- a/tests/sentry/event_manager/test_event_manager.py
+++ b/tests/sentry/event_manager/test_event_manager.py
@@ -130,11 +130,13 @@ class EventManagerTest(TransactionTestCase):
         assert Event.objects.count() == 1
 
     def test_updates_group(self):
+        timestamp = time() - 300
         manager = EventManager(
             make_event(
                 message='foo',
                 event_id='a' * 32,
                 checksum='a' * 32,
+                timestamp=timestamp,
             )
         )
         manager.normalize()
@@ -145,6 +147,7 @@ class EventManagerTest(TransactionTestCase):
                 message='foo bar',
                 event_id='b' * 32,
                 checksum='a' * 32,
+                timestamp=timestamp + 2.0,
             )
         )
         manager.normalize()
@@ -155,7 +158,7 @@ class EventManagerTest(TransactionTestCase):
         group = Group.objects.get(id=event.group_id)
 
         assert group.times_seen == 2
-        assert group.last_seen.replace(microsecond=0) == event.datetime.replace(microsecond=0)
+        assert group.last_seen.replace(microsecond=0) == event2.datetime.replace(microsecond=0)
         assert group.message == event2.message
         assert group.data.get('type') == 'default'
         assert group.data.get('metadata') == {
