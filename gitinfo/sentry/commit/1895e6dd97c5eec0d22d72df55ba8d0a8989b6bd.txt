commit 1895e6dd97c5eec0d22d72df55ba8d0a8989b6bd
Author: Ted Kaemming <ted@kaemming.com>
Date:   Wed Nov 18 17:03:50 2015 -0800

    Use `ProjectOption` directly for digest options.

diff --git a/src/sentry/plugins/bases/notify.py b/src/sentry/plugins/bases/notify.py
index 34c0eeb49e..512710e830 100644
--- a/src/sentry/plugins/bases/notify.py
+++ b/src/sentry/plugins/bases/notify.py
@@ -21,7 +21,10 @@ from sentry.digests.notifications import (
     unsplit_key,
 )
 from sentry.plugins import Notification, Plugin
-from sentry.models import UserOption
+from sentry.models import (
+    ProjectOption,
+    UserOption,
+)
 from sentry.tasks.digests import deliver_digest
 
 
@@ -79,11 +82,19 @@ class NotificationPlugin(Plugin):
                 self.notify(notification)
 
             if features.has('projects:digests:store', project):
-                key = unsplit_key(self, event.group.project)
-                increment_delay = self.get_option('digests:increment_delay', project=project)
-                maximum_delay = self.get_option('digests:maximum_delay', project=project)
-                if digests.add(key, event_to_record(event, rules), increment_delay=increment_delay, maximum_delay=maximum_delay):
-                    deliver_digest.delay(key)
+                get_digest_option = lambda key: ProjectOption.objects.get_value(
+                    project,
+                    '{0}:digests:{1}'.format(self.get_conf_key(), key),
+                )
+                digest_key = unsplit_key(self, event.group.project)
+                immediate_delivery = digests.add(
+                    digest_key,
+                    event_to_record(event, rules),
+                    increment_delay=get_digest_option('increment_delay'),
+                    maximum_delay=get_digest_option('maximum_delay'),
+                )
+                if immediate_delivery:
+                    deliver_digest.delay(digest_key)
 
         else:
             notification = Notification(event=event, rules=rules)
diff --git a/src/sentry/tasks/digests.py b/src/sentry/tasks/digests.py
index b76a56d74a..dff858d44b 100644
--- a/src/sentry/tasks/digests.py
+++ b/src/sentry/tasks/digests.py
@@ -6,6 +6,7 @@ from sentry.digests.notifications import (
     build_digest,
     split_key,
 )
+from sentry.models import ProjectOption
 from sentry.tasks.base import instrumented_task
 
 
@@ -39,7 +40,10 @@ def deliver_digest(key, schedule_timestamp=None):
     from sentry.app import digests
 
     plugin, project = split_key(key)
-    minimum_delay = plugin.get_option('digests:minimum_delay', project=project)
+    minimum_delay = ProjectOption.objects.get_value(
+        project,
+        '{0}:digests:{1}'.format(plugin.get_conf_key(), 'minimum_delay'),
+    )
     with digests.digest(key, minimum_delay=minimum_delay) as records:
         digest = build_digest(project, records)
 
