commit faf0aa281dc2fcc45ee42c8183755ba10b75a6d0
Author: Jess MacQueen <jess@getsentry.com>
Date:   Thu Jul 6 15:34:36 2017 -0700

    add feature gating to discard workflow

diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index 5c10232b7e..03c07001c7 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -10,6 +10,7 @@ from django.utils import timezone
 from rest_framework import serializers
 from rest_framework.response import Response
 
+from sentry import features
 from sentry import search
 from sentry.api.base import DocSection
 from sentry.api.bases.project import ProjectEndpoint, ProjectEventPermission
@@ -472,6 +473,8 @@ class ProjectGroupIndexEndpoint(ProjectEndpoint):
 
         discard = result.get('discard')
         if discard:
+            if not features.has('projects:custom-filters', project, actor=request.user):
+                return Response({'detail': ['You do not have that feature enabled']}, status=400)
             group_list = list(queryset)
             for group in group_list:
                 with transaction.atomic():
diff --git a/src/sentry/api/serializers/models/project.py b/src/sentry/api/serializers/models/project.py
index 7563cf16df..2ef226e232 100644
--- a/src/sentry/api/serializers/models/project.py
+++ b/src/sentry/api/serializers/models/project.py
@@ -66,7 +66,7 @@ class ProjectSerializer(Serializer):
         from sentry import features
 
         feature_list = []
-        for feature in ('global-events', 'data-forwarding', 'rate-limits'):
+        for feature in ('global-events', 'data-forwarding', 'rate-limits', 'custom-filters'):
             if features.has('projects:' + feature, obj, actor=user):
                 feature_list.append(feature)
 
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index e45df6bd96..16e6b3ccb1 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -783,6 +783,7 @@ SENTRY_FEATURES = {
     'projects:sample-events': True,
     'projects:data-forwarding': True,
     'projects:rate-limits': True,
+    'projects:custom-filters': False,
 }
 
 # Default time zone for localization in the UI.
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index 6f4384563c..26ec7767c2 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -23,6 +23,7 @@ default_manager.add('projects:rate-limits', ProjectFeature)  # NOQA
 default_manager.add('workflow:release-emails', ProjectFeature)  # NOQA
 default_manager.add('projects:sample-events', ProjectFeature)  # NOQA
 default_manager.add('projects:similarity-indexing', ProjectFeature)  # NOQA
+default_manager.add('projects:custom-filters', ProjectFeature)  # NOQA
 
 # expose public api
 add = default_manager.add
diff --git a/src/sentry/static/sentry/app/views/groupDetails/actions.jsx b/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
index 596dc9fb0a..5740c5a7b5 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
@@ -448,6 +448,7 @@ export default React.createClass({
     let group = this.getGroup();
     let project = this.getProject();
     let org = this.getOrganization();
+    let features = new Set(project.features);
 
     let bookmarkClassName = 'group-bookmark btn btn-default btn-sm';
     if (group.isBookmarked) {
@@ -490,21 +491,23 @@ export default React.createClass({
             <span className="icon-trash" />
           </LinkWithConfirmation>
         </div>
-        <div className="btn-group">
-          {/* TODO(jess): we need an icon for discard. Maybe an octogon/stop-sign like icon? */}
-          <LinkWithConfirmation
-            className="group-remove btn btn-default btn-sm"
-            title={t('Discard')}
-            message={t(
-              'Discarding this event will result in the deletion ' +
-                'of most data associated with this issue and future ' +
-                'events being discarded before reaching your stream. ' +
-                'Are you sure you wish to continue?'
-            )}
-            onConfirm={this.onDiscard}>
-            <span className="icon-stop">X</span>
-          </LinkWithConfirmation>
-        </div>
+        {features.has('custom-filters') &&
+          <div className="btn-group">
+            {/* TODO(jess): we need an icon for discard. Maybe an octogon/stop-sign like icon? */}
+            <LinkWithConfirmation
+              className="group-remove btn btn-default btn-sm"
+              title={t('Discard')}
+              message={t(
+                'Discarding this event will result in the deletion ' +
+                  'of most data associated with this issue and future ' +
+                  'events being discarded before reaching your stream. ' +
+                  'Are you sure you wish to continue?'
+              )}
+              onConfirm={this.onDiscard}>
+              <span className="icon-stop">X</span>
+            </LinkWithConfirmation>
+          </div>
+        }
         {group.pluginActions.length > 1
           ? <div className="btn-group more">
               <DropdownLink className="btn btn-default btn-sm" title={t('More')}>
