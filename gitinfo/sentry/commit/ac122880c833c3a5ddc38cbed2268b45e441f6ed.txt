commit ac122880c833c3a5ddc38cbed2268b45e441f6ed
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Apr 5 13:20:28 2016 -0700

    Apply mail.backend aliases before escalating into settings
    
    Fixes GH-2975

diff --git a/src/sentry/runner/initializer.py b/src/sentry/runner/initializer.py
index e468383721..6e69b74b9d 100644
--- a/src/sentry/runner/initializer.py
+++ b/src/sentry/runner/initializer.py
@@ -140,6 +140,12 @@ def bootstrap_options(settings, config=None):
     for o in (settings.SENTRY_DEFAULT_OPTIONS, settings.SENTRY_OPTIONS):
         for k, v in o.iteritems():
             if k in options_mapper:
+                # Map the mail.backend aliases to something Django understands
+                if k == 'mail.backend':
+                    try:
+                        v = settings.SENTRY_EMAIL_BACKEND_ALIASES[v]
+                    except KeyError:
+                        pass
                 # Escalate the few needed to actually get the app bootstrapped into settings
                 setattr(settings, options_mapper[k], v)
 
diff --git a/tests/sentry/runner/test_initializer.py b/tests/sentry/runner/test_initializer.py
index bf46bfbd50..e4efac6a4a 100644
--- a/tests/sentry/runner/test_initializer.py
+++ b/tests/sentry/runner/test_initializer.py
@@ -16,6 +16,7 @@ def settings():
     s.SENTRY_FEATURES = {}
     s.SENTRY_OPTIONS = {}
     s.SENTRY_DEFAULT_OPTIONS = {}
+    s.SENTRY_EMAIL_BACKEND_ALIASES = {'dummy': 'alias-for-dummy'}
     return s
 
 
@@ -138,6 +139,14 @@ def test_bootstrap_options_no_config_only_sentry_options(settings):
     assert settings.EMAIL_SUBJECT_PREFIX == 'my-mail-subject-prefix'
 
 
+def test_bootstrap_options_mail_aliases(settings):
+    settings.SENTRY_OPTIONS = {
+        'mail.backend': 'dummy',
+    }
+    bootstrap_options(settings)
+    assert settings.EMAIL_BACKEND == 'alias-for-dummy'
+
+
 def test_bootstrap_options_missing_file(settings):
     bootstrap_options(settings, 'this-file-does-not-exist-xxxxxxxxxxxxxx.yml')
     assert settings.SENTRY_OPTIONS == {}
