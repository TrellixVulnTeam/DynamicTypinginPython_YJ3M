commit 76b7f75a064f4a31cf3834e7fd12e8610c8550a3
Author: Ted Kaemming <ted@kaemming.com>
Date:   Fri Oct 30 14:10:16 2015 -0700

    Track results for `jobs.finished` metric.
    
    Examples:
    
        2015-10-30 21:09:30,500 2064  DEBUG    sentry.metrics 'jobs.started': +1; instance='sentry.tasks.options.sync_options'; tags={}
        2015-10-30 21:09:30,530 2067  DEBUG    sentry.metrics 'jobs.dispatched': +1; instance='sentry.tasks.digests.deliver_digest'; tags={}
        2015-10-30 21:09:30,532 2067  DEBUG    sentry.metrics 'jobs.duration': 0.0336339 ms; instance='sentry.tasks.digests.schedule_digests'; tags={'result': 'success'}
        2015-10-30 21:09:30,533 2067  DEBUG    sentry.metrics 'jobs.finished': +1; instance='sentry.tasks.digests.schedule_digests'; tags={'result': 'success'}
    
    This fixes GH-2251.

diff --git a/src/sentry/receivers/stats.py b/src/sentry/receivers/stats.py
index e53a93cc75..9db7ac4171 100644
--- a/src/sentry/receivers/stats.py
+++ b/src/sentry/receivers/stats.py
@@ -1,6 +1,12 @@
 from __future__ import absolute_import
 
-from celery.signals import task_prerun, task_postrun, task_revoked, task_sent
+from celery.signals import (
+    task_failure,
+    task_prerun,
+    task_revoked,
+    task_sent,
+    task_success,
+)
 from django.db.models.signals import post_save
 
 from sentry.utils import metrics
@@ -23,11 +29,11 @@ def _get_task_name(task):
     return task.name or '{0}.{1}'.format(task.__module__, task.__name__)
 
 
-def record_task_signal(signal, name):
-    def handler(task, **kwargs):
-        if not isinstance(task, basestring):
-            task = _get_task_name(task)
-        metrics.incr('jobs.{0}'.format(name), instance=task)
+def record_task_signal(signal, name, **options):
+    def handler(sender, **kwargs):
+        if not isinstance(sender, basestring):
+            sender = _get_task_name(sender)
+        metrics.incr('jobs.{0}'.format(name), instance=sender, **options)
 
     signal.connect(
         handler,
@@ -50,6 +56,8 @@ task_revoked.connect(
     dispatch_uid='sentry.stats.tasks.revoked',
 )
 
-record_task_signal(task_prerun, 'started')
-record_task_signal(task_postrun, 'finished')
+
 record_task_signal(task_sent, 'dispatched')
+record_task_signal(task_prerun, 'started')
+record_task_signal(task_success, 'finished', tags={'result': 'success'})
+record_task_signal(task_failure, 'finished', tags={'result': 'failure'})
