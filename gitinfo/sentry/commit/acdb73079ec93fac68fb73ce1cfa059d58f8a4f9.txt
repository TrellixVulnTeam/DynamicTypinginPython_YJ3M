commit acdb73079ec93fac68fb73ce1cfa059d58f8a4f9
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Dec 8 17:24:09 2015 -0800

    Only add user to top dog role when creating a superuser

diff --git a/src/sentry/runner/commands/createuser.py b/src/sentry/runner/commands/createuser.py
index 8040809edb..4b76b17f8e 100644
--- a/src/sentry/runner/commands/createuser.py
+++ b/src/sentry/runner/commands/createuser.py
@@ -92,9 +92,13 @@ def createuser(email, password, superuser, no_password, no_input):
     if settings.SENTRY_SINGLE_ORGANIZATION:
         from sentry.models import Organization, OrganizationMember
         org = Organization.get_default()
+        if superuser:
+            role = roles.get_top_dog().id
+        else:
+            role = org.default_role
         OrganizationMember.objects.create(
             organization=org,
             user=user,
-            role=roles.get_top_dog().id,
+            role=role,
         )
         click.echo('Added to organization: %s' % (org.slug,))
diff --git a/tests/sentry/runner/commands/test_createuser.py b/tests/sentry/runner/commands/test_createuser.py
index 5144aee215..1132706daa 100644
--- a/tests/sentry/runner/commands/test_createuser.py
+++ b/tests/sentry/runner/commands/test_createuser.py
@@ -2,6 +2,7 @@
 
 from __future__ import absolute_import
 
+from sentry import roles
 from sentry.testutils import CliTestCase
 from sentry.runner.commands.createuser import createuser
 from sentry.models import User, OrganizationMember
@@ -69,6 +70,22 @@ class CreateUserTest(CliTestCase):
             member = OrganizationMember.objects.all()[0]
             assert member.user.email == 'you@somewhereawesome.com'
             assert member.organization.slug in rv.output
+            assert member.role == member.organization.default_role
+
+    def test_single_org_superuser(self):
+        with self.settings(SENTRY_SINGLE_ORGANIZATION=True):
+            rv = self.invoke(
+                '--email=you@somewhereawesome.com',
+                '--no-password',
+                '--superuser'
+            )
+            assert rv.exit_code == 0, rv.output
+            assert 'you@somewhereawesome.com' in rv.output
+            assert OrganizationMember.objects.count() == 1
+            member = OrganizationMember.objects.all()[0]
+            assert member.user.email == 'you@somewhereawesome.com'
+            assert member.organization.slug in rv.output
+            assert member.role == roles.get_top_dog().id
 
     def test_not_single_org(self):
         with self.settings(SENTRY_SINGLE_ORGANIZATION=False):
