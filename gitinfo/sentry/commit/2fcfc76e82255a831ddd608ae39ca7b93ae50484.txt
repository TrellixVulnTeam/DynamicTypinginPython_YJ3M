commit 2fcfc76e82255a831ddd608ae39ca7b93ae50484
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Tue Feb 11 16:10:04 2020 -0800

    feat(workflow): Add alert + rule to `load-mocks` (#16961)
    
    This adds an alert and alert rule to `load-mocks` for local testing

diff --git a/bin/load-mocks b/bin/load-mocks
index 44ac2ac191..4375d55ad1 100755
--- a/bin/load-mocks
+++ b/bin/load-mocks
@@ -21,6 +21,13 @@ from pytz import utc
 
 from sentry import buffer, roles, tsdb
 from sentry.event_manager import HashDiscarded
+from sentry.incidents.logic import (
+    AlertRuleNameAlreadyUsedError,
+    create_alert_rule,
+    create_alert_rule_trigger,
+    create_incident,
+)
+from sentry.incidents.models import IncidentType, AlertRuleThresholdType
 from sentry.models import (
     Activity,
     Broadcast,
@@ -56,6 +63,7 @@ from sentry.models import (
 )
 from sentry.signals import mocks_loaded
 from sentry.similarity import features
+from sentry.snuba.models import QueryAggregations
 from sentry.utils import loremipsum
 from sentry.utils.hashlib import md5_text
 from sentry.utils.samples import create_sample_event as _create_sample_event
@@ -652,8 +660,25 @@ def main(num_events=1, extra_events=False):
                     comments=make_sentence(),
                 )
 
-            print ("    > Loading time series data".format(project_name))  # NOQA
+            try:
+                # Metric alerts
+                alert_rule = create_alert_rule(
+                    org, [project], "My Alert Rule", "level:error", QueryAggregations.TOTAL, 10, 1
+                )
+                create_alert_rule_trigger(alert_rule, "critical", AlertRuleThresholdType.ABOVE, 10)
+                create_incident(
+                    org,
+                    type=IncidentType.DETECTED,
+                    title="My Incident",
+                    query="",
+                    aggregation=QueryAggregations.TOTAL,
+                    alert_rule=alert_rule,
+                    projects=[project],
+                )
+            except AlertRuleNameAlreadyUsedError:
+                pass
 
+            print ("    > Loading time series data".format(project_name))  # NOQA
             create_sample_time_series(event1, release=release)
             create_sample_time_series(event2, release=release)
             create_sample_time_series(event3)
