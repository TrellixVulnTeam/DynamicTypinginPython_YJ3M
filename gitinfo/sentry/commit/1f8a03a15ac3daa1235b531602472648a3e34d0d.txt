commit 1f8a03a15ac3daa1235b531602472648a3e34d0d
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Oct 18 19:15:53 2012 -0700

    Disable trending in mysql due to performance issues

diff --git a/src/sentry/utils/db.py b/src/sentry/utils/db.py
index 79a62c162d..72a5efc6ec 100644
--- a/src/sentry/utils/db.py
+++ b/src/sentry/utils/db.py
@@ -24,7 +24,9 @@ def get_db_engine(alias='default'):
 
 
 def has_trending(alias='default'):
-    return get_db_engine('default').startswith(('mysql', 'postgres'))
+    # we only support trend queriess for postgres to db optimization
+    # issues in mysql, and lack of anything useful in sqlite
+    return get_db_engine('default').startswith('postgres')
 
 
 def has_charts(db):
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index 876e73b3cf..c042388e82 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -413,7 +413,7 @@ def get_group_trends(request, project=None):
     base_qs = Group.objects.filter(
         project__in=project_dict.keys(),
         status=0,
-    ).order_by('-score')
+    )
 
     if has_trending():
         group_list = list(Group.objects.get_accelerated(base_qs, minutes=(
@@ -425,7 +425,7 @@ def get_group_trends(request, project=None):
 
         group_list = list(base_qs.filter(
             last_seen__gte=cutoff_dt
-        )[:limit])
+        ).order_by('-score')[:limit])
 
     for group in group_list:
         group._project_cache = project_dict.get(group.project_id)
