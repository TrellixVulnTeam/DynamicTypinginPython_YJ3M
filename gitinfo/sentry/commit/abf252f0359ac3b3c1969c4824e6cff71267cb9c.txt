commit abf252f0359ac3b3c1969c4824e6cff71267cb9c
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jan 21 16:48:19 2015 -0800

    Only compute expire once

diff --git a/src/sentry/tsdb/redis.py b/src/sentry/tsdb/redis.py
index 04c819aa26..982760491d 100644
--- a/src/sentry/tsdb/redis.py
+++ b/src/sentry/tsdb/redis.py
@@ -101,12 +101,13 @@ class RedisTSDB(BaseTSDB):
         with self.conn.map() as conn:
             for rollup, max_values in self.rollups:
                 norm_epoch = normalize_to_rollup(timestamp, rollup)
+                expire = rollup * max_values
 
                 for model, key in items:
                     model_key = self.get_model_key(key)
                     hash_key = make_key(model, norm_epoch, model_key)
                     conn.hincrby(hash_key, model_key, count)
-                    conn.expire(hash_key, rollup * max_values)
+                    conn.expire(hash_key, expire)
 
     def get_range(self, model, keys, start, end, rollup=None):
         """
