commit b1086398caee1ac76168bff46da4395a1b800690
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Tue Mar 3 22:25:25 2020 +0300

    feat(migrations): Fail loudly when cannot migrate any event (#17440)
    
    This is to avoid potential data loss in cases like #17422. If we cannot migrate any event, fail loudly, stopping migrations on their tracks and ask the user to explicitly bypass this migration.

diff --git a/src/sentry/migrations/0024_auto_20191230_2052.py b/src/sentry/migrations/0024_auto_20191230_2052.py
index 4544195bba..e79cd02250 100644
--- a/src/sentry/migrations/0024_auto_20191230_2052.py
+++ b/src/sentry/migrations/0024_auto_20191230_2052.py
@@ -98,6 +98,11 @@ def backfill_eventstream(apps, schema_editor):
                 )
             )
 
+    if processed == 0:
+        raise Exception(
+            "Cannot migrate any event. If this is okay, re-run migrations with SENTRY_SKIP_EVENTS_BACKFILL_FOR_10 environment variable set to skip this step."
+        )
+
     print("Event migration done. Migrated {} of {} events.\n".format(processed, count))
 
 
