commit 5c44e8b165ba21ad37b11c5977750badc31ebc67
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 13 13:38:03 2012 -0800

    Massive plugin reorganization

diff --git a/TODO b/TODO
new file mode 100644
index 0000000000..a78b65d3cc
--- /dev/null
+++ b/TODO
@@ -0,0 +1,3 @@
+- Remove middleware (we probably need some kind of global method decorator or singular entry point for all views)
+- Fix display issue when not logged in (bookmark button) on event list
+- API needs to work with key authentication globally (not just the store view)
\ No newline at end of file
diff --git a/sentry/middleware.py b/sentry/middleware.py
index b44569dac8..fdc5cebf5a 100644
--- a/sentry/middleware.py
+++ b/sentry/middleware.py
@@ -1,36 +1,51 @@
 from sentry.models import Project
-from sentry.plugins import Plugin, PluginProxy
+from sentry.plugins import Plugin
 
 
 class PluginList(object):
-    def __init__(self, plugins):
-        self.plugins = plugins
-
-    def __getitem__(self, slice):
-        return list.__getitem__(self)
+    def __init__(self, request, project, plugins):
+        self._request = request
+        self._project = project
+        self._plugins = plugins
+        self._cache = {}
+
+    def __getitem__(self, slug):
+        if slug not in self._cache:
+            plugin_cls = self._plugins[slug]
+            plugin = plugin_cls(self._request)
+            if self._project:
+                plugin.configure(self._project)
+            self._cache[slug] = plugin
+
+        return self._cache[slug]
 
     def __iter__(self):
-        for p in self.plugins:
-            if not p.enabled:
+        for plugin in (self[s] for s in self._plugins.iterkeys()):
+            if not plugin.enabled:
                 continue
-            yield p
+            yield plugin
 
+    def for_project(self):
+        for slug, plugin_cls in self._plugins.iteritems():
+            if not plugin_cls.project_conf_form:
+                continue
+            yield slug, self[slug].get_title()
 
-def get_plugins(request, project):
-    plugins = []
-    for cls in Plugin.plugins.itervalues():
-        plugin = PluginProxy(cls(request), project)
-        plugins.append(plugin)
-    return plugins
+    def for_site(self):
+        for slug, plugin_cls in self._plugins.iteritems():
+            if not plugin_cls.site_conf_form:
+                continue
+            yield slug, self[slug].get_title()
 
 
 class SentryMiddleware(object):
     def process_view(self, request, view_func, view_args, view_kwargs):
-        if 'project_id' not in view_kwargs:
-            return
-        project = Project.objects.get(pk=view_kwargs['project_id'])
+        if 'project_id' in view_kwargs:
+            project = Project.objects.get(pk=view_kwargs['project_id'])
+        else:
+            project = None
 
-        request.plugins = PluginList(get_plugins(request, project))
+        request.plugins = PluginList(request, project, Plugin.plugins)
 
     def process_response(self, request, response):
         request.plugins = []
diff --git a/sentry/plugins/__init__.py b/sentry/plugins/__init__.py
index 44e143504d..d9f374960e 100644
--- a/sentry/plugins/__init__.py
+++ b/sentry/plugins/__init__.py
@@ -38,46 +38,30 @@ class PluginMount(type):
             cls.plugins[cls.slug] = cls
 
 
-class PluginProxy(object):
+class Plugin(object):
     """
-    Proxy for plugins to delay configuration until they're accessed.
+    All children should allow **kwargs on all inherited methods.
     """
-    def __init__(self, plugin, project):
-        self.project = project
-        self.__configured = False
-        self.__plugin = plugin
 
-    def __repr__(self):
-        return repr(self.__plugin)
+    __metaclass__ = PluginMount
 
-    def __call__(self, *args, **kwargs):
-        if not self.__configured:
-            self._configure()
-        return self.__plugin.__call__(*args, **kwargs)
+    conf_key = None
+    conf_title = None
 
-    def __getattr__(self, attr):
-        if not self.__configured:
-            self._configure()
-        return getattr(self.__plugin, attr)
+    project_conf_form = None
+    project_conf_template = 'sentry/plugins/project_configuration.html'
 
-    def _configure(self):
-        self.__plugin.configure(self.project)
-        self.__configured = True
+    site_conf_form = None
+    site_conf_template = 'sentry/plugins/site_configuration.html'
 
-
-class Plugin(object):
-    """
-    All children should allow **kwargs on all inherited methods.
-    """
-
-    __metaclass__ = PluginMount
+    title = None
 
     enabled = True
 
     def __init__(self, request):
         self.request = request
 
-    def __call__(self, group):
+    def get_view_response(self, group):
         self.selected = self.request.path == self.get_url(group)
 
         if not self.selected:
@@ -99,6 +83,17 @@ class Plugin(object):
             'group': group,
         })
 
+    def get_conf_key(self):
+        if not self.conf_key:
+            return self.conf_title.lower().replace(' ', '_')
+        return self.conf_key
+
+    def get_conf_title(self):
+        return self.conf_title or self.get_title()
+
+    def get_title(self):
+        return self.title
+
     def redirect(self, url):
         return HttpResponseRedirect(url)
 
@@ -118,6 +113,15 @@ class Plugin(object):
         Handles the view logic. If no response is given, we continue to the next action provider.
         """
 
+    def before_events(self, group_list, **kwargs):
+        """
+        Allows preprocessing of groups in the list view.
+
+        This is generally useful if you need to cache lookups
+        for something like ``tags`` which would otherwise do
+        multiple queries.
+        """
+
     def tags(self, group, tag_list, **kwargs):
         """Modifies the tag list for a grouped message."""
         return tag_list
diff --git a/sentry/plugins/sentry_bugzilla/models.py b/sentry/plugins/sentry_bugzilla/models.py
index e5ffe51ef9..3d26f750ac 100644
--- a/sentry/plugins/sentry_bugzilla/models.py
+++ b/sentry/plugins/sentry_bugzilla/models.py
@@ -26,6 +26,7 @@ class CreateBugzillaIssue(Plugin):
     title = 'Create Bugzilla Issue'
     slug = 'create-bugzilla-issue'
 
-    site_conf_title = 'Bugzilla'
+    conf_title = 'Bugzilla'
+    conf_key = 'bugzilla'
     site_conf_form = BugzillaConfigurationForm
     site_conf_template = 'sentry/plugins/bugzilla/site_configuration.html'
diff --git a/sentry/plugins/sentry_bugzilla/templates/sentry/plugins/bugzilla/site_configuration.html b/sentry/plugins/sentry_bugzilla/templates/sentry/plugins/bugzilla/site_configuration.html
index 38b0e69b08..cbd5639b7f 100644
--- a/sentry/plugins/sentry_bugzilla/templates/sentry/plugins/bugzilla/site_configuration.html
+++ b/sentry/plugins/sentry_bugzilla/templates/sentry/plugins/bugzilla/site_configuration.html
@@ -1,18 +1 @@
-    {% load i18n %}
-    <form class="form-stacked" action="" method="post">
-        {% csrf_token %}
-        <fieldset>
-            {% for field in form %}
-                <div class="clearfix{% if field.errors %} error{% endif %}">
-                    {{ field.label_tag }}
-                    <div class="input">{{ field }}</div>
-                    {% if field.help_text %}
-                        <span class="help-block">{{ field.help_text }}</span>
-                    {% endif %}
-                </div>
-            {% endfor %}
-        </fieldset>
-        <p class="actions">
-            <button type="submit" class="btn primary">{% trans "Save Changes" %}</button>
-        </p>
-    </form>
+{% include "sentry/partial/_form.html" %}
\ No newline at end of file
diff --git a/sentry/templates/sentry/partial/_form.html b/sentry/templates/sentry/partial/_form.html
index c51f6fe1e4..e8c404f427 100644
--- a/sentry/templates/sentry/partial/_form.html
+++ b/sentry/templates/sentry/partial/_form.html
@@ -1,3 +1,4 @@
+{% load i18n %}
 <form class="form-stacked" action="" method="post">
     {% csrf_token %}
     {% for field in form %}
@@ -14,4 +15,7 @@
             {% endif %}
         </div>
     {% endfor %}
+    <p class="actions">
+        <button type="submit" class="btn primary">{% trans "Save Changes" %}</button>
+    </p>
 </form>
\ No newline at end of file
diff --git a/sentry/templates/sentry/plugins/project_configuration.html b/sentry/templates/sentry/plugins/project_configuration.html
new file mode 100644
index 0000000000..cbd5639b7f
--- /dev/null
+++ b/sentry/templates/sentry/plugins/project_configuration.html
@@ -0,0 +1 @@
+{% include "sentry/partial/_form.html" %}
\ No newline at end of file
diff --git a/sentry/templates/sentry/plugins/site_configuration.html b/sentry/templates/sentry/plugins/site_configuration.html
new file mode 100644
index 0000000000..cbd5639b7f
--- /dev/null
+++ b/sentry/templates/sentry/plugins/site_configuration.html
@@ -0,0 +1 @@
+{% include "sentry/partial/_form.html" %}
\ No newline at end of file
diff --git a/sentry/templates/sentry/projects/manage.html b/sentry/templates/sentry/projects/manage.html
index 33f38f1d76..c7fa00b8dd 100644
--- a/sentry/templates/sentry/projects/manage.html
+++ b/sentry/templates/sentry/projects/manage.html
@@ -18,77 +18,85 @@
 {% endblock %}
 
 {% block main %}
-    <ul class="breadcrumb">
-        <li><a href="{% url sentry-project-list %}">{% trans "Projects" %}</a> <span class="divider">/</span></li>
-        <li class="active">{% trans "Manage Project" %}</li>
+    <ul class="tabs">
+        <li{% if page == 'details' %} class="active"{% endif %}>
+            <a href="{% url sentry-manage-project project.pk %}">{% trans "Details" %}</a>
+        </li>
+        {% for slug, title in request.plugins.for_project %}
+            <li{% if page == 'plugin' and plugin.slug == slug %} class="active"{% endif %}>
+                <a href="{% url sentry-configure-project-plugin project.pk slug %}">{{ title }}</a>
+            </li>
+        {% endfor %}
     </ul>
-    <p>{% trans "Here you can edit project information, as well as control the access list for a project with fine-grained permissions." %}</p>
-    <hr>
-    <div class="page-header">
-        <h2>{% trans "Project Details" %}</h2>
-    </div>
-    {% if request.GET.success %}
-        <div class="alert-message success">{% trans "Changes to your project were saved successfully." %}</div>
-    {% else %}
-        {% if form.errors %}
-            <div class="alert-message error">{% trans "Please correct the errors below." %}</div>
-        {% endif %}
-    {% endif %}
-    <form class="form-stacked" action="" method="post">
-        {% csrf_token %}
-        <fieldset>
-            {% for field in form %}
-                <div class="clearfix{% if field.errors %} error{% endif %}">
-                    {{ field.label_tag }}
-                    <div class="input">{{ field }}</div>
-                    {% if field.help_text %}
-                        <span class="help-block">{{ field.help_text }}</span>
-                    {% endif %}
-                </div>
-            {% endfor %}
-        </fieldset>
-        <p class="actions">
-            <button type="submit" class="btn primary">{% trans "Save Changes" %}</button>
-            {% if PROJECT_ID != project.pk %}
-                <a href="{% url sentry-remove-project project.pk %}" class="btn danger">{% trans "Remove Project" %}</a>
-            {% else %}
-                <a href="#" class="btn disabled danger">{% trans "Cannot remove default project" %}</a>
+    {% block inner %}
+        <p>{% trans "Here you can edit project information, as well as control the access list for a project with fine-grained permissions." %}</p>
+        <hr>
+        <div class="page-header">
+            <h2>{% trans "Project Details" %}</h2>
+        </div>
+        {% if request.GET.success %}
+            <div class="alert-message success">{% trans "Changes to your project were saved successfully." %}</div>
+        {% else %}
+            {% if form.errors %}
+                <div class="alert-message error">{% trans "Please correct the errors below." %}</div>
             {% endif %}
-        </p>
-    </form>
-    <div class="page-header">
-        <a href="{% url sentry-new-project-member project.pk %}" class="btn pull-right small primary">+ New Member</a>
-        <h2>{% trans "Members" %}</h2>
-    </div>
-    <table class="bordered-table zebra-striped">
-        <colgroup>
-            <col width="100px"/>
-            <col/>
-            <col width="50px"/>
-        </colgroup>
-        <thead>
-            <tr>
-                <th>Username</th>
-                <th>Access</th>
-                <th>&nbsp;</th>
-            </tr>
-        </thead>
-        <tbody>
-            {% for member, user in member_list %}
-                <tr>
-                    <td><a href="{% url sentry-edit-project-member project.pk member.pk %}">{{ user.username }}</a></td>
-                    <td>
-                        {{ member.get_type_display }}
-                    </td>
-                    <td style="text-align:center;">
-                        {% if user == project.owner %}
-                            <em>owner</em>
-                        {% else %}
-                            <a href="{% url sentry-remove-project-member project.pk member.pk %}">Revoke</a>
+        {% endif %}
+        <form class="form-stacked" action="" method="post">
+            {% csrf_token %}
+            <fieldset>
+                {% for field in form %}
+                    <div class="clearfix{% if field.errors %} error{% endif %}">
+                        {{ field.label_tag }}
+                        <div class="input">{{ field }}</div>
+                        {% if field.help_text %}
+                            <span class="help-block">{{ field.help_text }}</span>
                         {% endif %}
-                    </td>
+                    </div>
+                {% endfor %}
+            </fieldset>
+            <p class="actions">
+                <button type="submit" class="btn primary">{% trans "Save Changes" %}</button>
+                {% if PROJECT_ID != project.pk %}
+                    <a href="{% url sentry-remove-project project.pk %}" class="btn danger">{% trans "Remove Project" %}</a>
+                {% else %}
+                    <a href="#" class="btn disabled danger">{% trans "Cannot remove default project" %}</a>
+                {% endif %}
+            </p>
+        </form>
+        <div class="page-header">
+            <a href="{% url sentry-new-project-member project.pk %}" class="btn pull-right small primary">{% trans "+ New Member" %}</a>
+            <h2>{% trans "Members" %}</h2>
+        </div>
+        <table class="bordered-table zebra-striped">
+            <colgroup>
+                <col width="100px"/>
+                <col/>
+                <col width="50px"/>
+            </colgroup>
+            <thead>
+                <tr>
+                    <th>{% trans "Username" %}</th>
+                    <th>{% trans "Access" %}</th>
+                    <th>&nbsp;</th>
                 </tr>
-            {% endfor %}
-        </tbody>
-    </table>
+            </thead>
+            <tbody>
+                {% for member, user in member_list %}
+                    <tr>
+                        <td><a href="{% url sentry-edit-project-member project.pk member.pk %}">{{ user.username }}</a></td>
+                        <td>
+                            {{ member.get_type_display }}
+                        </td>
+                        <td style="text-align:center;">
+                            {% if user == project.owner %}
+                                <em>owner</em>
+                            {% else %}
+                                <a href="{% url sentry-remove-project-member project.pk member.pk %}">{% trans "Revoke" %}</a>
+                            {% endif %}
+                        </td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% endblock %}
 {% endblock %}
diff --git a/sentry/templates/sentry/projects/plugins/configure.html b/sentry/templates/sentry/projects/plugins/configure.html
new file mode 100644
index 0000000000..25c29da70b
--- /dev/null
+++ b/sentry/templates/sentry/projects/plugins/configure.html
@@ -0,0 +1,5 @@
+{% extends "sentry/projects/manage.html" %}
+
+{% block inner %}
+    {{ view }}
+{% endblock %}
\ No newline at end of file
diff --git a/sentry/templates/sentry/status.html b/sentry/templates/sentry/status.html
index c13692e6e2..da0b7b5edd 100644
--- a/sentry/templates/sentry/status.html
+++ b/sentry/templates/sentry/status.html
@@ -10,17 +10,17 @@
 {% block content %}
     <div class="span16">
         <ul class="tabs" data-tabs="tabs">
-            <li class="active"><a href="#main">Environment</a></li>
-            <li><a href="#packages">Packages</a></li>
-            <li><a href="#workers">Workers</a></li>
+            <li class="active"><a href="#main">{% trans "Environment" %}</a></li>
+            <li><a href="#packages">{% trans "Packages" %}</a></li>
+            <li><a href="#workers">{% trans "Workers" %}</a></li>
             {% for conf in site_configs %}
-            <li><a href="#config_{{conf.slug}}">{{conf.site_conf_title|default:conf.title}}</a></li>
+                <li><a href="#config_{{ conf.slug }}">{{ conf.site_conf_title }}</a></li>
             {% endfor %}
         </ul>
         <div class="tab-content">
             <div id="main" class="active">
                 <div class="page-header">
-                    <h2>Environment</h2>
+                    <h2>{% trans "Environment" %}</h2>
                 </div>
                 {% if environment %}
                     <table class="vars bordered-table zebra-striped">
@@ -29,29 +29,29 @@
                         </colgroup>
                         <tbody>
                             <tr>
-                                <th>Server Version</th>
+                                <th>{% trans "Server Version" %}</th>
                                 <td>{% sentry_version %}</td>
                             </tr>
                             <tr>
-                                <th>Python Version</th>
+                                <th>{% trans "Python Version" %}</th>
                                 <td>{{ python_version }}</td>
                             </tr>
                             <tr>
-                                <th>Configuration File</th>
+                                <th>{% trans "Configuration File" %}</th>
                                 <td>{{ environment.config }}</td>
                             </tr>
                             <tr>
-                                <th>Uptime</th>
+                                <th>{% trans "Uptime" %}</th>
                                 <td>{{ environment.start_date|timesince }} (since {{ environment.start_date|date }})</td>
                             </tr>
                         </tbody>
                     </table>
                 {% else %}
-                    <p>Environment not found (are you using the builtin Sentry webserver?).</p>
+                    <p>{% trans "Environment not found (are you using the builtin Sentry webserver?)." %}</p>
                 {% endif %}
 
                 <div class="page-header">
-                    <h2>Configuration{% if environment.config %} <small>{{ environment.config }}</small>{% endif %}</h2>
+                    <h2>{% trans "Configuration" %}{% if environment.config %} <small>{{ environment.config }}</small>{% endif %}</h2>
                 </div>
                 <table class="vars bordered-table zebra-striped">
                     <colgroup>
@@ -69,7 +69,7 @@
             </div>
             <div id="packages">
                 <div class="page-header">
-                    <h2>Extensions</h2>
+                    <h2>{% trans "Extensions" %}</h2>
                 </div>
                 {% if extensions %}
                     <table class="vars bordered-table zebra-striped">
@@ -86,10 +86,10 @@
                         </tbody>
                     </table>
                 {% else %}
-                    <p>No extensions registered.</p>
+                    <p>{% trans "No extensions registered." %}</p>
                 {% endif %}
                 <div class="page-header">
-                    <h2>Views</h2>
+                    <h2>{% trans "Views" %}</h2>
                 </div>
                 {% if views %}
                     <table class="vars bordered-table zebra-striped">
@@ -106,10 +106,10 @@
                         </tbody>
                     </table>
                 {% else %}
-                    <p>No views registered.</p>
+                    <p>{% trans "No views registered." %}</p>
                 {% endif %}
                 <div class="page-header">
-                    <h2>Processors</h2>
+                    <h2>{% trans "Processors" %}</h2>
                 </div>
                 {% if processors %}
                     <table class="vars bordered-table zebra-striped">
@@ -126,10 +126,10 @@
                         </tbody>
                     </table>
                 {% else %}
-                    <p>No event processors registered.</p>
+                    <p>{% trans "No event processors registered." %}</p>
                 {% endif %}
                 <div class="page-header">
-                    <h2>Modules</h2>
+                    <h2>{% trans "Modules" %}</h2>
                 </div>
                 <table class="vars bordered-table zebra-striped">
                     <colgroup>
@@ -146,55 +146,55 @@
                 </table>
             </div>
             {% if worker_status %}
-            <div id="workers">
-                <div class="page-header">
-                    <h2>Background Processes</h2>
-                </div>
-                {% if background_procs %}
+                <div id="workers">
+                    <div class="page-header">
+                        <h2>{% trans "Background Processes" %}</h2>
+                    </div>
+                    {% if background_procs %}
+                        <table class="vars bordered-table zebra-striped">
+                            <colgroup>
+                                <col style="width:220px">
+                            </colgroup>
+                            <tbody>
+                            </tbody>
+                        </table>
+                    {% else %}
+                        <p>{% trans "No information available." %}</p>
+                    {% endif %}
+                    <div class="page-header">
+                        <h2>{% trans "Pending Tasks" %}</h2>
+                    </div>
                     <table class="vars bordered-table zebra-striped">
                         <colgroup>
-                            <col style="width:220px">
+                            <col>
+                            <col style="width:150px">
                         </colgroup>
+                        <thead>
+                            <tr>
+                                <th>{% trans "Queue" %}</th>
+                                <th>{% trans "Pending Tasks" %}</th>
+                            </tr>
+                        </thead>
                         <tbody>
+                            {% for queue, num_pending in pending_tasks %}
+                                <tr>
+                                    <td>{{ queue }}</td>
+                                    <td>{{ num_pending }}</td>
+                                </tr>
+                            {% endfor %}
                         </tbody>
                     </table>
-                {% else %}
-                    <p>No information available.</p>
-                {% endif %}
-                <div class="page-header">
-                    <h2>Pending Tasks</h2>
                 </div>
-                <table class="vars bordered-table zebra-striped">
-                    <colgroup>
-                        <col>
-                        <col style="width:150px">
-                    </colgroup>
-                    <thead>
-                        <tr>
-                            <th>Queue</th>
-                            <th>Pending Tasks</th>
-                        </tr>
-                    </thead>
-                    <tbody>
-                        {% for queue, num_pending in pending_tasks %}
-                            <tr>
-                                <td>{{ queue }}</td>
-                                <td>{{ num_pending }}</td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            </div>
             {% endif %}
             {% for conf in site_configs %}
-            <div id="config_{{conf.slug}}">
-                <div class="page-header">
+                <div id="config_{{ conf.slug }}">
                     <div class="page-header">
-                        <h2>{{conf.site_config_title|default:conf.title}} configuration</h2>
+                        <div class="page-header">
+                            <h2>{{ conf.site_config_title|default:conf.title }} configuration</h2>
+                        </div>
+                        {{ conf.view|safe }}
                     </div>
-                    {{ conf.view|safe }}
                 </div>
-            </div>
             {% endfor %}
         </div>
     </div>
diff --git a/sentry/web/frontend/generic.py b/sentry/web/frontend/generic.py
index e84d8de1e6..e96972d5b4 100644
--- a/sentry/web/frontend/generic.py
+++ b/sentry/web/frontend/generic.py
@@ -9,7 +9,6 @@ import pkg_resources
 import sys
 
 from django.core.urlresolvers import reverse
-from django.shortcuts import redirect
 from django.db.models import Sum
 from django.http import HttpResponseRedirect, Http404, HttpResponseNotModified, \
   HttpResponse
@@ -40,21 +39,19 @@ def status(request):
 
     # Deal with the plugins
     site_configs = []
-    for name, cls in Plugin.plugins.iteritems():
-        if hasattr(cls, 'site_conf_form'):
-            action, view = plugin_config(cls, None, request)
-            if action == 'redirect':
-                return redirect(request.path)
-            item = {
-                'title': cls.title,
-                'slug': cls.slug,
-                'site_conf_title': cls.site_conf_title,
-                'view': view,
-            }
-            for prop in ('site_config_title',):
-                if hasattr(cls, prop):
-                    item[prop] = getattr(cls, prop)
-            site_configs.append(item)
+    for slug, title in request.plugins.for_site():
+        plugin = request.plugins[slug]
+        action, view = plugin_config(plugin, None, request)
+        if action == 'redirect':
+            return HttpResponseRedirect(request.path)
+        item = {
+            'plugin': plugin,
+            'title': plugin.get_title(),
+            'slug': plugin.slug,
+            'site_conf_title': plugin.get_conf_title(),
+            'view': view,
+        }
+        site_configs.append(item)
 
     config = []
     for k in sorted(dir(settings)):
diff --git a/sentry/web/frontend/groups.py b/sentry/web/frontend/groups.py
index adab98bec5..1214769aaa 100644
--- a/sentry/web/frontend/groups.py
+++ b/sentry/web/frontend/groups.py
@@ -304,14 +304,12 @@ def group_plugin_action(request, project, group_id, slug):
     if group.project and group.project != project:
         return HttpResponseRedirect(reverse('sentry-group-plugin-action', kwargs={'group_id': group.pk, 'project_id': group.project_id, 'slug': slug}))
 
-    plugin = None
-    for inst in request.plugins:
-        if inst.slug == slug:
-            plugin = inst
-            break
-    if not plugin:
+    try:
+        plugin = request.plugins[slug]
+    except KeyError:
+
         raise Http404('Plugin not found')
-    response = inst(group)
+    response = plugin.get_view_response(group)
     if response:
         return response
     return HttpResponseRedirect(request.META.get('HTTP_REFERER') or reverse('sentry', kwargs={'project_id': group.project_id}))
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index cb82d1680c..df7c2155cb 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -7,8 +7,9 @@ from sentry.conf import settings
 from sentry.models import MEMBER_USER, MEMBER_OWNER
 from sentry.web.decorators import login_required, has_access
 from sentry.web.forms import EditProjectForm, NewProjectForm, \
-     EditProjectMemberForm, NewProjectMemberForm, RemoveProjectForm
-from sentry.web.helpers import render_to_response, get_project_list
+  EditProjectMemberForm, NewProjectMemberForm, RemoveProjectForm
+from sentry.web.helpers import render_to_response, get_project_list, \
+  plugin_config
 
 
 @login_required
@@ -93,6 +94,7 @@ def manage_project(request, project):
 
     context = csrf(request)
     context.update({
+        'page': 'details',
         'form': form,
         'project': project,
         'member_list': member_list
@@ -163,3 +165,32 @@ def remove_project_member(request, project, member_id):
     })
 
     return render_to_response('sentry/projects/members/remove.html', context, request)
+
+
+@login_required
+@has_access(MEMBER_OWNER)
+@csrf_protect
+def configure_project_plugin(request, project, slug):
+    try:
+        plugin = request.plugins[slug]
+    except KeyError:
+        return HttpResponseRedirect(reverse('sentry-manage-project', args=[project.pk]))
+
+    form = plugin.project_conf_form
+    if form is None:
+        return HttpResponseRedirect(reverse('sentry-manage-project', args=[project.pk]))
+
+    action, view = plugin_config(plugin, project, request)
+    if action == 'redirect':
+        return HttpResponseRedirect(request.path + '?success=1')
+
+    context = csrf(request)
+    context.update({
+        'page': 'plugin',
+        'title': plugin.get_title(),
+        'view': view,
+        'project': project,
+        'plugin': plugin,
+    })
+
+    return render_to_response('sentry/projects/plugins/configure.html', context, request)
diff --git a/sentry/web/helpers.py b/sentry/web/helpers.py
index e82db1b20d..4293626e99 100644
--- a/sentry/web/helpers.py
+++ b/sentry/web/helpers.py
@@ -119,7 +119,7 @@ def plugin_config(plugin, project, request):
     be displayed.
     """
 
-    plugin_key = plugin.site_conf_title.lower()
+    plugin_key = plugin.get_conf_key()
     if project:
         form_class = plugin.project_conf_form
     else:
diff --git a/sentry/web/urls.py b/sentry/web/urls.py
index 6786eec6e6..a8dc8c8368 100644
--- a/sentry/web/urls.py
+++ b/sentry/web/urls.py
@@ -12,6 +12,17 @@ from django.views.defaults import page_not_found
 from sentry.web import api
 from sentry.web.frontend import accounts, generic, groups, events, projects
 
+
+def init_plugins():
+    from django.db.models import get_apps, get_models
+    for app in get_apps():
+        try:
+            get_models(app)
+        except:
+            continue
+init_plugins()
+
+
 handler404 = lambda x: page_not_found(x, template_name='sentry/404.html')
 
 
@@ -53,6 +64,7 @@ urlpatterns = patterns('',
     url(r'^projects/$', projects.project_list, name='sentry-project-list'),
     url(r'^projects/new/$', projects.new_project, name='sentry-new-project'),
     url(r'^projects/(?P<project_id>\d+)/edit/$', projects.manage_project, name='sentry-manage-project'),
+    url(r'^projects/(?P<project_id>\d+)/plugins/(?P<slug>[\w_-]+)/$', projects.configure_project_plugin, name='sentry-configure-project-plugin'),
     url(r'^projects/(?P<project_id>\d+)/remove/$', projects.remove_project, name='sentry-remove-project'),
     url(r'^projects/(?P<project_id>\d+)/members/new/$', projects.new_project_member, name='sentry-new-project-member'),
     url(r'^projects/(?P<project_id>\d+)/members/(?P<member_id>\d+)/edit/$', projects.edit_project_member, name='sentry-edit-project-member'),
