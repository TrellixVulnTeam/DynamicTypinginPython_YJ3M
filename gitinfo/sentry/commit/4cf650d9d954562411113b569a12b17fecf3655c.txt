commit 4cf650d9d954562411113b569a12b17fecf3655c
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 13 21:55:27 2014 -0800

    Add team name to emails

diff --git a/src/sentry/models/event.py b/src/sentry/models/event.py
index cfbb33c675..c64c05cc7d 100644
--- a/src/sentry/models/event.py
+++ b/src/sentry/models/event.py
@@ -192,7 +192,8 @@ class Event(Model):
         return len(unicode(vars(self)))
 
     def get_email_subject(self):
-        return '[%s] %s: %s' % (
+        return '[%s %s] %s: %s' % (
+            self.team.name.encode('utf-8'),
             self.project.name.encode('utf-8'),
             unicode(self.get_level_display()).upper().encode('utf-8'),
             self.error().encode('utf-8').splitlines()[0])
diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index 51f6333248..e9a755ddc9 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -71,7 +71,8 @@ class MailPlugin(NotificationPlugin):
 
     def on_alert(self, alert):
         project = alert.project
-        subject = '[{0}] ALERT: {1}'.format(
+        subject = '[{0} {1}] ALERT: {2}'.format(
+            project.team.name.encode('utf-8'),
             project.name.encode('utf-8'),
             alert.message.encode('utf-8'),
         )
diff --git a/src/sentry/templates/sentry/emails/error.html b/src/sentry/templates/sentry/emails/error.html
index 2ec3744c83..12a9c61f6e 100644
--- a/src/sentry/templates/sentry/emails/error.html
+++ b/src/sentry/templates/sentry/emails/error.html
@@ -12,9 +12,9 @@
     <h2>
         {% url 'sentry-stream' group.project.team.slug group.project.slug as project_link %}
         {% if group.times_seen == 1 %}
-            New Event on <a href="{% absolute_uri project_link %}" class="highlight">{{ group.project.name }}</a>
+            New Event on <a href="{% absolute_uri project_link %}" class="highlight">{{ group.team.name }} {{ group.project.name }}</a>
         {% else %}
-            Regression on <a href="{% absolute_uri project_link %}" class="highlight">{{ group.project.name }}</a>
+            Regression on <a href="{% absolute_uri project_link %}" class="highlight">{{ group.team.name }} {{ group.project.name }}</a>
         {% endif %}
     </h2>
 
diff --git a/tests/sentry/models/activity/tests.py b/tests/sentry/models/activity/tests.py
index 20ff3ac881..a57ddb8039 100644
--- a/tests/sentry/models/activity/tests.py
+++ b/tests/sentry/models/activity/tests.py
@@ -27,7 +27,7 @@ class SendNotificationTest(TestCase):
 
         msg = mail.outbox[0]
 
-        assert msg.subject == 'Re: [Sentry] [Bar] ERROR: Foo bar'
+        assert msg.subject == 'Re: [Sentry] [foo Bar] ERROR: Foo bar'
         assert msg.to == [self.user.email]
         assert msg.extra_headers['Message-Id'] == '<activity/%s@localhost>' % activity.pk
         assert msg.extra_headers['In-Reply-To'] == '<group/%s@localhost>' % self.group.pk
diff --git a/tests/sentry/plugins/mail/tests.py b/tests/sentry/plugins/mail/tests.py
index 9fe8fbc30f..1f494edcdb 100644
--- a/tests/sentry/plugins/mail/tests.py
+++ b/tests/sentry/plugins/mail/tests.py
@@ -130,7 +130,8 @@ class MailPluginTest(TestCase):
         self.assertEquals(kwargs.get('fail_silently'), False)
         self.assertEquals(kwargs.get('project'), self.project)
         self.assertEquals(kwargs.get('group'), group)
-        assert kwargs.get('subject') == u"[{0}] ERROR: hello world".format(self.project.name)
+        assert kwargs.get('subject') == u"[{0} {1}] ERROR: hello world".format(
+            self.team.name, self.project.name)
 
     @mock.patch('sentry.plugins.sentry_mail.models.MailPlugin._send_mail')
     def test_multiline_error(self, _send_mail):
@@ -154,7 +155,8 @@ class MailPluginTest(TestCase):
 
         _send_mail.assert_called_once()
         args, kwargs = _send_mail.call_args
-        assert kwargs.get('subject') == u"[{0}] ERROR: hello world".format(self.project.name)
+        assert kwargs.get('subject') == u"[{0} {1}] ERROR: hello world".format(
+            self.team.name, self.project.name)
 
     def test_get_sendable_users(self):
         from sentry.models import Project, UserOption, User
@@ -206,5 +208,5 @@ class MailPluginTest(TestCase):
 
         _send_mail.assert_called_once()
         args, kwargs = _send_mail.call_args
-        assert kwargs.get('subject') == u"[{0}] ALERT: {1}".format(
-            self.project.name, alert.message)
+        assert kwargs.get('subject') == u"[{0} {1}] ALERT: {2}".format(
+            self.team.name, self.project.name, alert.message)
