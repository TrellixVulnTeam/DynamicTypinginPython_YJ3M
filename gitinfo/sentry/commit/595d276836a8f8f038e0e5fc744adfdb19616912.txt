commit 595d276836a8f8f038e0e5fc744adfdb19616912
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Tue Sep 10 19:35:19 2019 +0300

    fix(user-feedback): Fix user feedback page hostname (#14628)
    
    This reverts commit a55f211d875234c059c1fb42fb6cf7bb74cff2b4,
    fixes #13970, retries #14429.
    
    Tested locally with a full installation and got the following:
    `var endpoint =
    /**/"http://localhost:9000/api/embed/error-page/?dsn=http://1adad07c9e504cea91017c04f88a51a0@localhost:9000/1&eventId=1636edda23414a0a8a5d7c8d05d7db2e";/**/'';`

diff --git a/src/sentry/web/frontend/error_page_embed.py b/src/sentry/web/frontend/error_page_embed.py
index 416cae8fc4..822eb4946f 100644
--- a/src/sentry/web/frontend/error_page_embed.py
+++ b/src/sentry/web/frontend/error_page_embed.py
@@ -17,7 +17,7 @@ from sentry.models import Event, ProjectKey, ProjectOption, UserReport
 from sentry.web.helpers import render_to_response
 from sentry.signals import user_feedback_received
 from sentry.utils import json
-from sentry.utils.http import is_valid_origin, origin_from_request
+from sentry.utils.http import absolute_uri, is_valid_origin, origin_from_request
 from sentry.utils.validators import normalize_event_id
 
 GENERIC_ERROR = _("An unknown error occurred while submitting your report. Please try again.")
@@ -208,7 +208,9 @@ class ErrorPageEmbedView(View):
         )
 
         context = {
-            "endpoint": mark_safe("*/" + json.dumps(request.build_absolute_uri()) + ";/*"),
+            "endpoint": mark_safe(
+                "*/" + json.dumps(absolute_uri(request.get_full_path())) + ";/*"
+            ),
             "template": mark_safe("*/" + json.dumps(template) + ";/*"),
             "strings": json.dumps_htmlsafe(
                 {
