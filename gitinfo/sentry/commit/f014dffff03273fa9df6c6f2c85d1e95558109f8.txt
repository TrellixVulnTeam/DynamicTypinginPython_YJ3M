commit f014dffff03273fa9df6c6f2c85d1e95558109f8
Author: Eric Feng <ehfeng@users.noreply.github.com>
Date:   Thu Mar 15 11:18:30 2018 -0700

    feat(analytics): Project Issue Search Analytics (#7538)
    
    * feat(analytics): Project Issue Search Analytics

diff --git a/src/sentry/static/sentry/app/components/eventOrGroupHeader.jsx b/src/sentry/static/sentry/app/components/eventOrGroupHeader.jsx
index ec5caff564..8b9a71f17e 100644
--- a/src/sentry/static/sentry/app/components/eventOrGroupHeader.jsx
+++ b/src/sentry/static/sentry/app/components/eventOrGroupHeader.jsx
@@ -26,6 +26,7 @@ class EventOrGroupHeader extends React.Component {
     includeLink: PropTypes.bool,
     hideIcons: PropTypes.bool,
     hideLevel: PropTypes.bool,
+    query: PropTypes.string,
   };
 
   static defaultProps = {
@@ -54,9 +55,12 @@ class EventOrGroupHeader extends React.Component {
     let props = {};
     let Wrapper;
     if (includeLink) {
-      props.to = `/${orgId}/${projectId}/issues/${isEvent ? groupID : id}/${isEvent
-        ? `events/${data.id}/`
-        : ''}`;
+      props.to = {
+        pathname: `/${orgId}/${projectId}/issues/${isEvent ? groupID : id}/${isEvent
+          ? `events/${data.id}/`
+          : ''}`,
+        search: `${this.props.query ? `?query=${this.props.query}` : ''}`,
+      };
       Wrapper = Link;
     } else {
       Wrapper = 'span';
diff --git a/src/sentry/static/sentry/app/components/stream/group.jsx b/src/sentry/static/sentry/app/components/stream/group.jsx
index 63edb7eede..88a73bb311 100644
--- a/src/sentry/static/sentry/app/components/stream/group.jsx
+++ b/src/sentry/static/sentry/app/components/stream/group.jsx
@@ -25,6 +25,7 @@ const StreamGroup = createReactClass({
     projectId: PropTypes.string.isRequired,
     statsPeriod: PropTypes.string.isRequired,
     canSelect: PropTypes.bool,
+    query: PropTypes.string,
   },
 
   mixins: [Reflux.listenTo(GroupStore, 'onGroupChange'), ProjectState],
@@ -111,7 +112,12 @@ const StreamGroup = createReactClass({
               <GroupCheckBox id={data.id} />
             </div>
           )}
-          <EventOrGroupHeader data={data} orgId={orgId} projectId={projectId} />
+          <EventOrGroupHeader
+            data={data}
+            orgId={orgId}
+            projectId={projectId}
+            query={this.props.query}
+          />
           <EventOrGroupExtraDetails
             group
             {...data}
diff --git a/src/sentry/static/sentry/app/views/stream/stream.jsx b/src/sentry/static/sentry/app/views/stream/stream.jsx
index a80466ad13..7740f31085 100644
--- a/src/sentry/static/sentry/app/views/stream/stream.jsx
+++ b/src/sentry/static/sentry/app/views/stream/stream.jsx
@@ -11,6 +11,7 @@ import SentryTypes from '../../proptypes';
 import ApiMixin from '../../mixins/apiMixin';
 import GroupStore from '../../stores/groupStore';
 import EnvironmentStore from '../../stores/environmentStore';
+import HookStore from '../../stores/hookStore';
 import LoadingError from '../../components/loadingError';
 import LoadingIndicator from '../../components/loadingIndicator';
 import ProjectState from '../../mixins/projectState';
@@ -477,6 +478,18 @@ const Stream = createReactClass({
         this.transitionTo
       );
     }
+
+    // Ignore saved searches
+    if (this.state.savedSearchList.map(s => s.query == this.state.query).length > 0) {
+      let {orgId, projectId} = this.props.params;
+      HookStore.get('analytics:event').forEach(cb =>
+        cb('issue.search', {
+          query: this.state.query,
+          organization_id: orgId,
+          project_id: projectId,
+        })
+      );
+    }
   },
 
   onSortChange(sort) {
@@ -620,6 +633,7 @@ const Stream = createReactClass({
           orgId={orgId}
           projectId={projectId}
           statsPeriod={statsPeriod}
+          query={this.state.query}
         />
       );
     });
diff --git a/tests/js/spec/components/__snapshots__/eventOrGroupHeader.spec.jsx.snap b/tests/js/spec/components/__snapshots__/eventOrGroupHeader.spec.jsx.snap
index 765be6171f..05a28e36ad 100644
--- a/tests/js/spec/components/__snapshots__/eventOrGroupHeader.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/eventOrGroupHeader.spec.jsx.snap
@@ -10,7 +10,12 @@ exports[`EventOrGroupHeader Event hides level tag 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/groupID/events/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/groupID/events/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="icon icon-soundoff"
@@ -56,7 +61,12 @@ exports[`EventOrGroupHeader Event renders with \`type = csp\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/groupID/events/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/groupID/events/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="icon icon-soundoff"
@@ -110,7 +120,12 @@ exports[`EventOrGroupHeader Event renders with \`type = default\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/groupID/events/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/groupID/events/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="icon icon-soundoff"
@@ -155,7 +170,12 @@ exports[`EventOrGroupHeader Event renders with \`type = error\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/groupID/events/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/groupID/events/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="icon icon-soundoff"
@@ -209,7 +229,12 @@ exports[`EventOrGroupHeader Group renders with \`type = csp\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="error-level truncate"
@@ -267,7 +292,12 @@ exports[`EventOrGroupHeader Group renders with \`type = default\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="error-level truncate"
@@ -325,7 +355,12 @@ exports[`EventOrGroupHeader Group renders with \`type = error\` 1`] = `
     <Link
       onlyActiveOnIndex={false}
       style={Object {}}
-      to="/orgId/projectId/issues/id/"
+      to={
+        Object {
+          "pathname": "/orgId/projectId/issues/id/",
+          "search": "",
+        }
+      }
     >
       <span
         className="error-level truncate"
diff --git a/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap b/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
index f351c824ff..1e16a536d7 100644
--- a/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
@@ -787,7 +787,12 @@ exports[`Issues -> Merged View renders with mocked data 1`] = `
                               <Link
                                 onlyActiveOnIndex={false}
                                 style={Object {}}
-                                to="/orgId/projectId/issues/268/events/904/"
+                                to={
+                                  Object {
+                                    "pathname": "/orgId/projectId/issues/268/events/904/",
+                                    "search": "",
+                                  }
+                                }
                               >
                                 <a
                                   onClick={[Function]}
@@ -1216,7 +1221,12 @@ exports[`Issues -> Merged View renders with mocked data 1`] = `
                               <Link
                                 onlyActiveOnIndex={false}
                                 style={Object {}}
-                                to="/orgId/projectId/issues/268/events/904/"
+                                to={
+                                  Object {
+                                    "pathname": "/orgId/projectId/issues/268/events/904/",
+                                    "search": "",
+                                  }
+                                }
                               >
                                 <a
                                   onClick={[Function]}
@@ -2132,7 +2142,12 @@ exports[`Issues -> Merged View renders with mocked data 2`] = `
                               <Link
                                 onlyActiveOnIndex={false}
                                 style={Object {}}
-                                to="/orgId/projectId/issues/268/events/904/"
+                                to={
+                                  Object {
+                                    "pathname": "/orgId/projectId/issues/268/events/904/",
+                                    "search": "",
+                                  }
+                                }
                               >
                                 <a
                                   onClick={[Function]}
@@ -2561,7 +2576,12 @@ exports[`Issues -> Merged View renders with mocked data 2`] = `
                               <Link
                                 onlyActiveOnIndex={false}
                                 style={Object {}}
-                                to="/orgId/projectId/issues/268/events/904/"
+                                to={
+                                  Object {
+                                    "pathname": "/orgId/projectId/issues/268/events/904/",
+                                    "search": "",
+                                  }
+                                }
                               >
                                 <a
                                   onClick={[Function]}
diff --git a/tests/js/spec/views/__snapshots__/groupSimilarView.spec.jsx.snap b/tests/js/spec/views/__snapshots__/groupSimilarView.spec.jsx.snap
index 98cb3ecd77..b3664ae357 100644
--- a/tests/js/spec/views/__snapshots__/groupSimilarView.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/groupSimilarView.spec.jsx.snap
@@ -672,7 +672,12 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                                 <Link
                                   onlyActiveOnIndex={false}
                                   style={Object {}}
-                                  to="/orgId/projectId/issues/271/"
+                                  to={
+                                    Object {
+                                      "pathname": "/orgId/projectId/issues/271/",
+                                      "search": "",
+                                    }
+                                  }
                                 >
                                   <a
                                     onClick={[Function]}
@@ -1756,7 +1761,12 @@ exports[`Issues Similar View renders with mocked data 2`] = `
                                 <Link
                                   onlyActiveOnIndex={false}
                                   style={Object {}}
-                                  to="/orgId/projectId/issues/271/"
+                                  to={
+                                    Object {
+                                      "pathname": "/orgId/projectId/issues/271/",
+                                      "search": "",
+                                    }
+                                  }
                                 >
                                   <a
                                     onClick={[Function]}
diff --git a/tests/js/spec/views/stream/__snapshots__/stream.spec.jsx.snap b/tests/js/spec/views/stream/__snapshots__/stream.spec.jsx.snap
index a2ac859236..11acbb252c 100644
--- a/tests/js/spec/views/stream/__snapshots__/stream.spec.jsx.snap
+++ b/tests/js/spec/views/stream/__snapshots__/stream.spec.jsx.snap
@@ -47,6 +47,7 @@ exports[`Stream render() displays the group list 1`] = `
           key="1"
           orgId="123"
           projectId="456"
+          query="is:unresolved"
           statsPeriod="24h"
         />
       </ul>
@@ -184,6 +185,7 @@ exports[`Stream toggles environment select all environments 1`] = `
           key="1"
           orgId="123"
           projectId="456"
+          query="is:unresolved"
           statsPeriod="24h"
         />
       </ul>
