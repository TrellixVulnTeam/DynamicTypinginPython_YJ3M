commit 30b533e686762a76a40b92f869490dda7304227c
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Fri Feb 1 10:15:06 2019 -0800

    feat(email): Update group links in email templates for Sentry 10 (#11817)
    
    * feat(email): Update group links in email templates for Sentry 10
    
    * whitespace :(

diff --git a/src/sentry/templates/sentry/emails/_group.html b/src/sentry/templates/sentry/emails/_group.html
index fdd30d31e1..1741817e90 100644
--- a/src/sentry/templates/sentry/emails/_group.html
+++ b/src/sentry/templates/sentry/emails/_group.html
@@ -1,14 +1,12 @@
 {% load sentry_helpers %}
 
-{% url_with_referrer 'sentry-group' group.organization.slug group.project.slug group.id as group_link %}
-
 {% with type=group.get_event_type metadata=group.get_event_metadata transaction=group.culprit %}
 <div class="issue {% if group.is_resolved %}resolved{% endif %}">
   {% if type == "error" %}
     <div class="event-type error">
       <h3>
         {% if metadata.type %}
-          <a href="{% absolute_uri group_link %}">{{ metadata.type|truncatechars:40 }}</a>
+          {% include "sentry/emails/_group_link.html" with text=metadata.type|truncatechars:40 %}
           {% if transaction %}
             <span class="event-subtitle">{{ transaction }}</span>
           {% endif %}
@@ -17,7 +15,8 @@
             <small>{{ metadata.value|truncatechars:100|soft_break:40 }}</small>
           {% endif %}
         {% else %}
-          <a href="{% absolute_uri group_link %}">{{ metadata.value|truncatechars:40 }}</a><br />
+          {% include "sentry/emails/_group_link.html" with text=metadata.value|truncatechars:40 %}
+          <br />
           {% if transaction %}
             <span class="event-subtitle">{{ transaction }}</span>
           {% endif %}
@@ -27,7 +26,8 @@
   {% elif type == "csp" %}
     <div class="event-type csp">
       <h3>
-        <a href="{% absolute_uri group_link %}">{{ metadata.directive|truncatechars:40 }}</a><br />
+        {% include "sentry/emails/_group_link.html" with text=metadata.directive|truncatechars:40 %}
+        <br />
         {% if metadata.uri %}
           <span class="event-subtitle">{{ metadata.uri }}</span>
         {% endif %}
@@ -36,7 +36,8 @@
   {% else %}
     <div class="event-type default">
       <h3>
-        <a href="{% absolute_uri group_link %}">{{ group.title|truncatechars:40 }}</a><br />
+        {% include "sentry/emails/_group_link.html" with text=group.title|truncatechars:40 %}
+        <br />
         {% if transaction %}
           <span class="event-subtitle">{{ transaction }}</span>
         {% endif %}
diff --git a/src/sentry/templates/sentry/emails/_group_link.html b/src/sentry/templates/sentry/emails/_group_link.html
new file mode 100644
index 0000000000..06a7c3b009
--- /dev/null
+++ b/src/sentry/templates/sentry/emails/_group_link.html
@@ -0,0 +1,12 @@
+{% load sentry_helpers %}
+{% load sentry_features %}
+
+{% url_with_referrer 'sentry-group' group.organization.slug group.project.slug group.id as old_group_link %}
+{% url_with_referrer 'sentry-organization-issue' group.organization.slug group.id as new_group_link %}
+
+{% load sentry_features %}
+{% feature organizations:sentry10 group.organization %}
+    <a href="{% absolute_uri new_group_link %}">{{text}}</a>
+{% else %}
+    <a href="{% absolute_uri old_group_link %}">{{text}}</a>
+{% endfeature %}
diff --git a/src/sentry/templates/sentry/emails/digests/body.txt b/src/sentry/templates/sentry/emails/digests/body.txt
index ea5b4177e8..6a5e30d706 100644
--- a/src/sentry/templates/sentry/emails/digests/body.txt
+++ b/src/sentry/templates/sentry/emails/digests/body.txt
@@ -1,11 +1,12 @@
-{% load sentry_helpers %}Notifications for {{ project.slug }}
+{% load sentry_helpers %}
+{% load sentry_features %}Notifications for {{ project.slug }}
 {{ start|date:"N j, Y, P e" }} to {{ end|date:"N j, Y, P e" }}
 
 {% for rule, groups in digest.iteritems %}{{ rule.label }}
-
-{% for group, records in groups.iteritems %}* {{ group.title }} ({{ group.event_count }} event{{ group.event_count|pluralize }}, {{ group.user_count }} user{{ group.user_count|pluralize }})
-  {% url 'sentry-group' group.organization.slug group.project.slug group.id as group_link %}{% absolute_uri group_link %}?referrer=digest_email
-
-{% endfor %}{% endfor %}
+{% for group, records in groups.iteritems %}
+* {{ group.title }} ({{ group.event_count }} event{{ group.event_count|pluralize }}, {{ group.user_count }} user{{ group.user_count|pluralize }}){% url 'sentry-group' group.organization.slug group.project.slug group.id as old_group_link %}{% url 'sentry-organization-issue' group.organization.slug group.id as new_group_link %}
+  {% feature organizations:sentry10 group.organization %}{% absolute_uri new_group_link %}?referrer=digest_email{% else %}{% absolute_uri old_group_link %}?referrer=digest_email{% endfeature %}
+{% endfor %}
+{% endfor %}
 
 Unsubscribe: {{ unsubscribe_link }}
