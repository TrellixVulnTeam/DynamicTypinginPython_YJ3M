commit 3a366c42ae311f3e11bfc82064a6322b45e5ad37
Author: Megan Heskett <meg.heskett@gmail.com>
Date:   Tue Dec 3 13:48:39 2019 -0800

    Add invite modal to onboarding widget (#15862)

diff --git a/src/sentry/static/sentry/app/components/onboardingWizard/getOnboardingTasks.jsx b/src/sentry/static/sentry/app/components/onboardingWizard/getOnboardingTasks.jsx
index 80e1ae4052..0637ed2a22 100644
--- a/src/sentry/static/sentry/app/components/onboardingWizard/getOnboardingTasks.jsx
+++ b/src/sentry/static/sentry/app/components/onboardingWizard/getOnboardingTasks.jsx
@@ -1,4 +1,5 @@
 import {t} from 'app/locale';
+import {openInviteMembersModal} from 'app/actionCreators/modal';
 import {sourceMaps} from 'app/data/platformCategories';
 
 function hasPlatformWithSourceMaps(organization) {
@@ -44,8 +45,8 @@ export default function getOnboardingTasks(organization) {
       ),
       skippable: true,
       prereq: [],
-      featureLocation: 'organization',
-      location: 'members/',
+      featureLocation: 'modal',
+      location: () => openInviteMembersModal({source: 'onboarding_widget'}),
       display: true,
     },
     {
diff --git a/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx b/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
index a64db27eeb..1b709e9a99 100644
--- a/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
+++ b/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
@@ -57,6 +57,8 @@ class TodoItem extends React.Component {
       learnMoreUrl = `/organizations/${org.slug}/${task.location}`;
     } else if (task.featureLocation === 'absolute') {
       learnMoreUrl = task.location;
+    } else if (task.featureLocation === 'modal') {
+      learnMoreUrl = undefined;
     } else {
       Sentry.withScope(scope => {
         scope.setExtra('props', this.props);
@@ -86,6 +88,12 @@ class TodoItem extends React.Component {
   };
 
   handleClick = e => {
+    const {task} = this.props;
+
+    if (task && task.featureLocation === 'modal' && typeof task.location === 'function') {
+      task.location();
+    }
+
     this.recordAnalytics('clickthrough');
     e.stopPropagation();
   };
@@ -134,10 +142,12 @@ class TodoItem extends React.Component {
       >
         <Content blur={showConfirmation}>
           <Checkbox>{task.status && <IndicatorIcon status={task.status} />}</Checkbox>
-          <StyledLink href={learnMoreUrl} onClick={this.handleClick}>
-            <ItemHeader status={task.status} data-test-id={task.task}>
-              {task.title}
-            </ItemHeader>
+          <StyledLink
+            href={learnMoreUrl}
+            onClick={this.handleClick}
+            data-test-id={task.task}
+          >
+            <ItemHeader status={task.status}>{task.title}</ItemHeader>
           </StyledLink>
           <Description>{description}</Description>
           <SkipButton
diff --git a/tests/js/spec/components/onboardingWizard/todoList.spec.jsx b/tests/js/spec/components/onboardingWizard/todoList.spec.jsx
index 3f96b0a7ee..de7abaea16 100644
--- a/tests/js/spec/components/onboardingWizard/todoList.spec.jsx
+++ b/tests/js/spec/components/onboardingWizard/todoList.spec.jsx
@@ -1,8 +1,13 @@
 import React from 'react';
 import {mountWithTheme} from 'sentry-test/enzyme';
 
+import {openInviteMembersModal} from 'app/actionCreators/modal';
 import TodoList from 'app/components/onboardingWizard/todoList';
 
+jest.mock('app/actionCreators/modal', () => ({
+  openInviteMembersModal: jest.fn(),
+}));
+
 describe('TodoList', function() {
   const routerContext = TestStubs.routerContext();
 
@@ -12,7 +17,7 @@ describe('TodoList', function() {
       <TodoList organization={organization} />,
       routerContext
     );
-    expect(wrapper.find('h4[data-test-id=7]').exists()).toBe(false);
+    expect(wrapper.find('a[data-test-id=7]').exists()).toBe(false);
   });
 
   it('does not render `upload source maps` task with python project', function() {
@@ -23,7 +28,7 @@ describe('TodoList', function() {
       <TodoList organization={organization} />,
       routerContext
     );
-    expect(wrapper.find('h4[data-test-id=7]').exists()).toBe(false);
+    expect(wrapper.find('a[data-test-id=7]').exists()).toBe(false);
   });
 
   it('renders `upload source maps` task with js project', function() {
@@ -34,6 +39,19 @@ describe('TodoList', function() {
       <TodoList organization={organization} />,
       routerContext
     );
-    expect(wrapper.find('h4[data-test-id=7]').text()).toBe('Upload source maps');
+    expect(wrapper.find('a[data-test-id=7]').text()).toBe('Upload source maps');
+  });
+
+  it('opens invite members modal on `invite team members` task click', function() {
+    const organization = TestStubs.Organization();
+    const wrapper = mountWithTheme(
+      <TodoList organization={organization} />,
+      routerContext
+    );
+    wrapper.find('a[data-test-id=3]').simulate('click');
+    expect(openInviteMembersModal).toHaveBeenCalled();
+    expect(wrapper.find('a[href="/organizations/org-slug/members/"]').exists()).toBe(
+      false
+    );
   });
 });
diff --git a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
index d619d860bf..b812371b5b 100644
--- a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
@@ -1501,20 +1501,19 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
+                                    data-test-id={1}
                                     href="/organizations/org-slug/projects/new/"
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
+                                      data-test-id={1}
                                       href="/organizations/org-slug/projects/new/"
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={1}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={1}
                                         >
                                           Create a project
                                         </h4>
@@ -1816,20 +1815,19 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
+                                    data-test-id={2}
                                     href="/organizations/org-slug/projects/choose/?onboarding=1&task=2"
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
+                                      data-test-id={2}
                                       href="/organizations/org-slug/projects/choose/?onboarding=1&task=2"
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={2}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={2}
                                         >
                                           Send your first event
                                         </h4>
@@ -2054,8 +2052,8 @@ exports[`Sidebar can have onboarding feature 1`] = `
                             "detailedDescription": "Let Sentry help your team triage and assign issues. Improve your workflow
         by unlocking mentions, assignment, and suggested issue owners.",
                             "display": true,
-                            "featureLocation": "organization",
-                            "location": "members/",
+                            "featureLocation": "modal",
+                            "location": [Function],
                             "prereq": Array [],
                             "skippable": true,
                             "task": 3,
@@ -2099,8 +2097,8 @@ exports[`Sidebar can have onboarding feature 1`] = `
                               "detailedDescription": "Let Sentry help your team triage and assign issues. Improve your workflow
         by unlocking mentions, assignment, and suggested issue owners.",
                               "display": true,
-                              "featureLocation": "organization",
-                              "location": "members/",
+                              "featureLocation": "modal",
+                              "location": [Function],
                               "prereq": Array [],
                               "skippable": true,
                               "task": 3,
@@ -2129,20 +2127,17 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
-                                    href="/organizations/org-slug/members/"
+                                    data-test-id={3}
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
-                                      href="/organizations/org-slug/members/"
+                                      data-test-id={3}
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={3}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={3}
                                         >
                                           Invite team members
                                         </h4>
@@ -2446,20 +2441,19 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
+                                    data-test-id={4}
                                     href="/organizations/org-slug/projects/new/"
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
+                                      data-test-id={4}
                                       href="/organizations/org-slug/projects/new/"
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={4}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={4}
                                         >
                                           Add a second platform
                                         </h4>
@@ -2765,20 +2759,19 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
+                                    data-test-id={5}
                                     href="https://docs.sentry.io/enriching-error-data/context/#capturing-the-user"
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
+                                      data-test-id={5}
                                       href="https://docs.sentry.io/enriching-error-data/context/#capturing-the-user"
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={5}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={5}
                                         >
                                           Add user context
                                         </h4>
@@ -3084,20 +3077,19 @@ exports[`Sidebar can have onboarding feature 1`] = `
                                     />
                                   </Checkbox>
                                   <StyledLink
+                                    data-test-id={6}
                                     href="/organizations/org-slug/projects/choose/?onboarding=1&task=6"
                                     onClick={[Function]}
                                   >
                                     <a
                                       className="css-1ylws2h-StyledLink e1a4o5475"
+                                      data-test-id={6}
                                       href="/organizations/org-slug/projects/choose/?onboarding=1&task=6"
                                       onClick={[Function]}
                                     >
-                                      <ItemHeader
-                                        data-test-id={6}
-                                      >
+                                      <ItemHeader>
                                         <h4
                                           className="css-158to6c-ItemHeader e1a4o5476"
-                                          data-test-id={6}
                                         >
                                           Set up release tracking
                                         </h4>
