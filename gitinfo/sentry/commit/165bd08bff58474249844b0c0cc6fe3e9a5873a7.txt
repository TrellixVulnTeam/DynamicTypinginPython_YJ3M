commit 165bd08bff58474249844b0c0cc6fe3e9a5873a7
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Mar 11 11:22:33 2015 -0700

    Switch AuthProvider.organization to FlexibleForeignKey (refs GH-1450)

diff --git a/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py b/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
index 7890e0f7b1..9e866c0289 100644
--- a/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
+++ b/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
@@ -25,7 +25,7 @@ class Migration(SchemaMigration):
         # Adding model 'AuthProvider'
         db.create_table('sentry_authprovider', (
             ('id', self.gf('sentry.db.models.fields.bounded.BoundedBigAutoField')(primary_key=True)),
-            ('organization', self.gf('django.db.models.fields.related.ForeignKey')(to=orm['sentry.Organization'], unique=True)),
+            ('organization', self.gf('sentry.db.models.fields.foreignkey.FlexibleForeignKey')(to=orm['sentry.Organization'], unique=True)),
             ('provider', self.gf('django.db.models.fields.CharField')(max_length=128)),
             ('config', self.gf('sentry.db.models.fields.gzippeddict.GzippedDictField')()),
             ('date_added', self.gf('django.db.models.fields.DateTimeField')(default=datetime.datetime.now)),
@@ -128,7 +128,7 @@ class Migration(SchemaMigration):
             'default_role': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'default': '50'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -427,4 +427,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py b/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
index 2d38524656..2b3169db8c 100644
--- a/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
+++ b/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
@@ -98,7 +98,7 @@ class Migration(SchemaMigration):
             'default_role': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'default': '50'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -397,4 +397,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py b/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
index e795b50ff4..968326b76d 100644
--- a/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
+++ b/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
@@ -109,7 +109,7 @@ class Migration(SchemaMigration):
             'default_role': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'default': '50'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -409,4 +409,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py b/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
index 9336d590b2..c3dc19ffcc 100644
--- a/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
+++ b/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
@@ -115,7 +115,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -415,4 +415,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py b/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
index 03503f5f57..3f7694809c 100644
--- a/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
+++ b/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
@@ -101,7 +101,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -401,4 +401,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py b/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
index 993eb67e4d..2a1e0c5ad6 100644
--- a/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
+++ b/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
@@ -101,7 +101,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -401,4 +401,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py b/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
index 10084108d4..4709fcc08d 100644
--- a/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
+++ b/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
@@ -104,7 +104,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -404,4 +404,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py b/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
index 64fc6f1aa8..de6e42eb11 100644
--- a/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
+++ b/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
@@ -136,7 +136,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -446,4 +446,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py b/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
index 79deb1db24..27884a85cc 100644
--- a/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
+++ b/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
@@ -102,7 +102,7 @@ class Migration(SchemaMigration):
             'default_teams': ('django.db.models.fields.related.ManyToManyField', [], {'to': "orm['sentry.Team']", 'symmetrical': 'False', 'blank': 'True'}),
             'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
             'last_sync': ('django.db.models.fields.DateTimeField', [], {'null': 'True'}),
-            'organization': ('django.db.models.fields.related.ForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
+            'organization': ('sentry.db.models.fields.foreignkey.FlexibleForeignKey', [], {'to': "orm['sentry.Organization']", 'unique': 'True'}),
             'provider': ('django.db.models.fields.CharField', [], {'max_length': '128'}),
             'sync_time': ('sentry.db.models.fields.bounded.BoundedPositiveIntegerField', [], {'null': 'True'})
         },
@@ -412,4 +412,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
diff --git a/src/sentry/models/authprovider.py b/src/sentry/models/authprovider.py
index 18b8784dea..1419d485db 100644
--- a/src/sentry/models/authprovider.py
+++ b/src/sentry/models/authprovider.py
@@ -4,7 +4,9 @@ from django.db import models
 from django.utils import timezone
 from jsonfield import JSONField
 
-from sentry.db.models import BoundedPositiveIntegerField, Model
+from sentry.db.models import (
+    BoundedPositiveIntegerField, FlexibleForeignKey, Model
+)
 
 from .organizationmember import OrganizationMember
 
@@ -13,7 +15,7 @@ _organizationemmber_type_field = OrganizationMember._meta.get_field('type')
 
 
 class AuthProvider(Model):
-    organization = models.ForeignKey('sentry.Organization', unique=True)
+    organization = FlexibleForeignKey('sentry.Organization', unique=True)
     provider = models.CharField(max_length=128)
     config = JSONField()
 
