commit 9e7a3b101d04ebd2871e34db6740ac39f7742af8
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 13 12:52:11 2015 -0700

    Abstract session cleanup

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index d3fbde5b6f..72d333ac9f 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -127,6 +127,10 @@ class AuthHelper(object):
     def get_redirect_url(self):
         return self.request.build_absolute_uri(reverse('sentry-auth-sso'))
 
+    def clear_session(self):
+        del self.request.session['auth']
+        self.request.session.is_modified = True
+
     def next_step(self):
         # TODO: this needs to somehow embed the next step
         # (it shouldnt force an exteneral redirect)
@@ -154,8 +158,7 @@ class AuthHelper(object):
             # create identity and authenticate the user
             response = self._finish_link_pipeline(identity)
 
-        del self.request.session['auth']
-        self.request.session.is_modified = True
+        self.clear_session()
 
         return response
 
