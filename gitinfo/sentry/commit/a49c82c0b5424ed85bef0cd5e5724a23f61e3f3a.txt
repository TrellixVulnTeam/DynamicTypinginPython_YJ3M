commit a49c82c0b5424ed85bef0cd5e5724a23f61e3f3a
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Apr 15 19:27:38 2012 -0700

    Safer slug migration

diff --git a/sentry/migrations/0047_migrate_project_slugs.py b/sentry/migrations/0047_migrate_project_slugs.py
index b7b10f971d..4d829022fc 100644
--- a/sentry/migrations/0047_migrate_project_slugs.py
+++ b/sentry/migrations/0047_migrate_project_slugs.py
@@ -2,7 +2,7 @@
 import datetime
 from south.db import db
 from south.v2 import DataMigration
-from django.db import models, IntegrityError
+from django.db import models
 
 
 class Migration(DataMigration):
@@ -16,13 +16,12 @@ class Migration(DataMigration):
             slug = base_slug
             n = 0
             while True:
-                try:
-                    update(project, slug=slug)
-                except IntegrityError:
+                if orm['sentry.Project'].objects.filter(slug=slug):
                     n += 1
                     slug = base_slug + '-' + str(n)
-                else:
-                    break
+                    continue
+                update(project, slug=slug)
+                break
 
     def backwards(self, orm):
         pass
