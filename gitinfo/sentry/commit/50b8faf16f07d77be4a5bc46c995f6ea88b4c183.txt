commit 50b8faf16f07d77be4a5bc46c995f6ea88b4c183
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Thu Mar 3 20:27:48 2016 +0100

    Bump modified times every day for dsyms

diff --git a/src/sentry/lang/native/dsymcache.py b/src/sentry/lang/native/dsymcache.py
index b50cd53087..0ed7923638 100644
--- a/src/sentry/lang/native/dsymcache.py
+++ b/src/sentry/lang/native/dsymcache.py
@@ -1,10 +1,15 @@
 import os
+import time
+import errno
 import shutil
 
 from django.conf import settings
 from sentry.models import find_dsym_file
 
 
+ONE_DAY = 60 * 60 * 24
+
+
 class DSymCache(object):
 
     def __init__(self):
@@ -13,6 +18,9 @@ class DSymCache(object):
     def get_project_path(self, project):
         return os.path.join(settings.DSYM_CACHE_PATH, str(project.id))
 
+    def get_global_path(self):
+        return os.path.join(settings.DSYM_CACHE_PATH, 'global')
+
     def fetch_dsyms(self, project, uuids):
         base = self.get_project_path(project)
         loaded = []
@@ -22,17 +30,35 @@ class DSymCache(object):
                 loaded.append(dsym)
         return base, loaded
 
+    def try_bump_timestamp(self, path, old_stat):
+        now = int(time.time())
+        if old_stat.st_ctime < now - ONE_DAY:
+            os.utime(path, (now, now))
+        return path
+
     def fetch_dsym(self, project, image_uuid):
         image_uuid = image_uuid.lower()
-        base = self.get_project_path(project)
-        dsym = os.path.join(base, image_uuid)
-        if os.path.isfile(dsym):
-            return dsym
+        for path in self.get_project_path(project), self.get_global_path():
+            base = self.get_project_path(project)
+            dsym = os.path.join(base, image_uuid)
+            try:
+                stat = os.stat(dsym)
+            except OSError as e:
+                if e.errno != errno.ENOENT:
+                    raise
+            else:
+                return self.try_bump_timestamp(dsym, stat)
 
         dsf = find_dsym_file(project, image_uuid)
         if dsf is None:
             return None
 
+        if dsf.is_global:
+            base = self.get_global_path()
+        else:
+            base = self.get_project_path(project)
+        dsym = os.path.join(base, image_uuid)
+
         try:
             os.makedirs(base)
         except OSError:
diff --git a/src/sentry/models/dsymfile.py b/src/sentry/models/dsymfile.py
index af9368ed78..4a5ee6a1f6 100644
--- a/src/sentry/models/dsymfile.py
+++ b/src/sentry/models/dsymfile.py
@@ -55,6 +55,7 @@ class CommonDSymFile(Model):
 class ProjectDSymFile(CommonDSymFile):
     project = FlexibleForeignKey('sentry.Project', null=True)
     uuid = models.CharField(max_length=36)
+    is_global = False
 
     class Meta(CommonDSymFile.Meta):
         unique_together = (('project', 'uuid'),)
@@ -63,6 +64,7 @@ class ProjectDSymFile(CommonDSymFile):
 
 class GlobalDSymFile(CommonDSymFile):
     uuid = models.CharField(max_length=36, unique=True)
+    is_global = True
 
     class Meta(CommonDSymFile.Meta):
         db_table = 'sentry_globaldsymfile'
