commit 573d1bf88abdb9c846b63aabe4cd6c1b13ce4dbe
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Sep 27 20:55:36 2010 -0700

    Added SENTRY_URL_PREFIX setting so that you may specify the absolute position to your sentry server (for email purposes).

diff --git a/sentry/models.py b/sentry/models.py
index 02c356024c..6a6ce96a33 100644
--- a/sentry/models.py
+++ b/sentry/models.py
@@ -128,7 +128,7 @@ class GroupedMessage(MessageBase):
 
     @models.permalink
     def get_absolute_url(self):
-        return ('sentry-group', (self.pk), {})
+        return ('sentry-group', (self.pk,), {})
 
     def natural_key(self):
         return (self.logger, self.view, self.checksum)
@@ -180,7 +180,7 @@ class GroupedMessage(MessageBase):
         if request:
             link = request.build_absolute_url(self.get_absolute_url())
         else:
-            link = None
+            link = '%s%s' % (settings.URL_PREFIX, self.get_absolute_url())
 
         body = render_to_string('sentry/emails/error.txt', {
             'request_repr': request_repr,
diff --git a/sentry/settings.py b/sentry/settings.py
index c1c7ec70cb..0cd2070169 100644
--- a/sentry/settings.py
+++ b/sentry/settings.py
@@ -70,4 +70,7 @@ EXCLUDE_PATHS = getattr(settings, 'SENTRY_EXCLUDE_PATHS', [])
 
 # By default Sentry only looks at modules in INSTALLED_APPS for drilling down
 # where an exception is located
-INCLUDE_PATHS = getattr(settings, 'SENTRY_INCLUDE_PATHS', [])
\ No newline at end of file
+INCLUDE_PATHS = getattr(settings, 'SENTRY_INCLUDE_PATHS', [])
+
+# Absolute URL to the sentry root directory. Should not include a trailing slash.
+URL_PREFIX = getattr(settings, 'SENTRY_URL_PREFIX', None)
\ No newline at end of file
diff --git a/sentry/templates/sentry/emails/error.txt b/sentry/templates/sentry/emails/error.txt
index 1ff7960950..a8fcfaef78 100644
--- a/sentry/templates/sentry/emails/error.txt
+++ b/sentry/templates/sentry/emails/error.txt
@@ -1,5 +1,6 @@
 {% autoescape off %}{% if link %}
 View in detail: {{ link }}
+
 {% endif %}{% if traceback %}{{ traceback }}
 
 {% endif %}{% if request_repr %}{{ request_repr }}{% endif %}{% endautoescape %}
\ No newline at end of file
diff --git a/sentry/tests/tests.py b/sentry/tests/tests.py
index c4a934cbde..bf3cec3f53 100644
--- a/sentry/tests/tests.py
+++ b/sentry/tests/tests.py
@@ -819,6 +819,16 @@ class SentryMailTest(TestCase):
         self.assertTrue("<Request" in out.body)
         self.assertEquals(out.subject, '[Django] Error (EXTERNAL IP): /trigger-500')
 
+    def test_url_prefix(self):
+        settings.URL_PREFIX = 'http://example.com'
+
+        group = GroupedMessage.objects.get()
+        group.mail_admins(fail_silently=False)
+
+        out = mail.outbox[0]
+
+        self.assertTrue('http://example.com/group/2' in out.body, out.body)
+
 class SentryHelpersTest(TestCase):
     def test_get_db_engine(self):
         from django.conf import settings
