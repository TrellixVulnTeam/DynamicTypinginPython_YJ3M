commit 959ffbd37cb4a7821f7a2676c137be54cad171a8
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Oct 31 16:07:15 2016 -0700

    [mfa] fix not authenticated requests

diff --git a/src/sentry/web/frontend/twofactor.py b/src/sentry/web/frontend/twofactor.py
index fffa78ad7d..1092fe58d0 100644
--- a/src/sentry/web/frontend/twofactor.py
+++ b/src/sentry/web/frontend/twofactor.py
@@ -22,7 +22,7 @@ class TwoFactorAuthView(BaseView):
     auth_required = False
 
     def perform_signin(self, request, user, interface=None):
-        auth.login(request, user, passed_2fa=True)
+        assert auth.login(request, user, passed_2fa=True)
         rv = HttpResponseRedirect(auth.get_login_redirect(request))
         if interface is not None:
             interface.authenticator.mark_used()
@@ -99,7 +99,7 @@ class TwoFactorAuthView(BaseView):
 
     def handle(self, request):
         user = auth.get_pending_2fa_user(request)
-        if user is None or not request.user.is_authenticated():
+        if user is None:
             return HttpResponseRedirect(auth.get_login_url())
 
         interfaces = Authenticator.objects.all_interfaces_for_user(user)
