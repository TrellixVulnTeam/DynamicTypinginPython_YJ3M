commit 3dfe70f4e47e0f3abb9e15e13a7d3aaec0e6f0b5
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jan 27 17:31:41 2013 -0800

    Store the last seen team in session cookie and use it as the redirect for dashboard

diff --git a/src/sentry/web/frontend/generic.py b/src/sentry/web/frontend/generic.py
index bd0276f4ef..49ceb8f97a 100644
--- a/src/sentry/web/frontend/generic.py
+++ b/src/sentry/web/frontend/generic.py
@@ -23,9 +23,16 @@ def dashboard(request, template='dashboard.html'):
     if not team_list:
         return HttpResponseRedirect(reverse('sentry-new-team'))
 
+    # This cookie gets automatically set by render_to_response
+    last_team = request.session.get('team')
+    if last_team in team_list:
+        team = team_list[last_team]
+    else:
+        team = team_list.values()[0]
+
     # Redirect to first team
     # TODO: maybe store this in a cookie and redirect to last seen team?
-    return HttpResponseRedirect(reverse('sentry', args=[team_list.values()[0].slug]))
+    return HttpResponseRedirect(reverse('sentry', args=[team.slug]))
 
 
 def wall_display(request):
diff --git a/src/sentry/web/helpers.py b/src/sentry/web/helpers.py
index 71f0af5ee9..4ebea815a1 100644
--- a/src/sentry/web/helpers.py
+++ b/src/sentry/web/helpers.py
@@ -155,6 +155,12 @@ def render_to_response(template, context=None, request=None, status=200):
     response = HttpResponse(render_to_string(template, context, request))
     response.status_code = status
 
+    # HACK: set team session value for dashboard redirect
+    if context and 'team' in context and isinstance(context['team'], Team):
+        team = context['team']
+        if request.session.get('team') != team.slug:
+            request.session['team'] = team.slug
+
     return response
 
 
