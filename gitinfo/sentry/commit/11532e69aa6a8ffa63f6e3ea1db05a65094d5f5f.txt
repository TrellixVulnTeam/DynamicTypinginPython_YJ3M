commit 11532e69aa6a8ffa63f6e3ea1db05a65094d5f5f
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Sep 15 11:51:09 2010 -0700

    Improve test coverage

diff --git a/sentry/tests/fixtures/encode_error.json b/sentry/tests/fixtures/encode_error.json
new file mode 100644
index 0000000000..bd4c0746e6
--- /dev/null
+++ b/sentry/tests/fixtures/encode_error.json
@@ -0,0 +1,13 @@
+{
+  "server_name": "localhost",
+  "message": "hello",
+  "data": {
+    "__sentry__": {
+      "exc": "[u'__builtin__', [u'invalid byte sequence for encoding \"UTF8\": 0xedb7af\nHINT:  This error can also happen if the byte sequence does not match the encoding expected by the server, which is controlled by \"client_encoding\".\n'], [{'function': u'get_response', 'pre_context': [u'                # Apply view middleware', u'                for middleware_method in self._view_middleware:', u'                    response = middleware_method(request, callback, callback_args, callback_kwargs)', u'                    if response:', u'                        return response', u'', u'                try:'], 'vars': [[u'exceptions', u\"<module 'django.core.exceptions' from '/www/disqus.com/env/lib/python2.6/site-packages/django/core/exceptions.pyc'>\"], [u'e', u'invalid byte sequence for encoding \"UTF8\": 0xedb7af\nHINT:  This error can also happen if the byte sequence does not match the encoding expected by the server, which is controlled by \"client_encoding\".\n'], [u'callback_args', []], [u'settings', u'<django.conf.LazySettings object at 0x7fbd15b55dd0>'], [u'middleware_method', u'<bound method ReadOnlyMiddleware.process_exception of <disqus.common.readonly.middleware.ReadOnlyMiddleware object at 0x7fbd16072cd0>>'], [u'self', u'<django.core.handlers.wsgi.WSGIHandler object at 0x7fbd15d6f810>'], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'callback', u'<function thread at 0x7fbd16ddc5f0>'], [u'resolver', u'<RegexURLResolver disqus.urls (None:None) ^/>'], [u'urlresolvers', u\"<module 'django.core.urlresolvers' from '/www/disqus.com/env/lib/python2.6/site-packages/django/core/urlresolvers.pyc'>\"], [u'exc_info', [u\"<class 'django.db.utils.DatabaseError'>\", u'invalid byte sequence for encoding \"UTF8\": 0xedb7af\nHINT:  This error can also happen if the byte sequence does not match the encoding expected by the server, which is controlled by \"client_encoding\".\n', u'<traceback object at 0x7fbd17e64128>']], [u'callback_kwargs', {'forum': u'hebizamurai'}], [u'response', u'None'], [u'urlconf', u'disqus.urls']], 'pre_context_lineno': u'93', 'post_context': [u'                except Exception, e:', u'                    # If the view raised an exception, run it through exception', u'                    # middleware, and if the exception middleware returns a', u'                    # response, use that. Otherwise, reraise the exception.', u'                    for middleware_method in self._exception_middleware:', u'                        response = middleware_method(request, e)'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/core/handlers/base.py', 'lineno': u'100', 'tb': u'<traceback object at 0x7fbd17e64128>', 'id': u'140450126512424', 'context_line': u'                    response = callback(request, *callback_args, **callback_kwargs)'}, {'function': u'_embed_view', 'pre_context': [u'}', u'', u'def embed_view(viewfunc_name):', u'    def _embed_view(request, *args, **kwargs):', u\"        version = get_version(request, kwargs.get('forum'), viewfunc_map.get(viewfunc_name, DEFAULT_VERSION))\", u'', u'        if version == 2.0:'], 'vars': [[u'viewfunc_name', u'thread'], [u'version', u'2.0'], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'args', []], [u'kwargs', {'forum': u'hebizamurai'}]], 'pre_context_lineno': u'9', 'post_context': [u'    _embed_view.__name__ = viewfunc_name', u'    return _embed_view', u'', u'viewfunc_map = {', u\"    'embed_stylesheet': 2.0,\", u\"    'embed_javascript': 2.0,\"], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/embed.py', 'lineno': u'16', 'tb': u'<traceback object at 0x7fbd17e64e18>', 'id': u'140450126515736', 'context_line': u'            return getattr(embed_2_0, viewfunc_name)(request, *args, **kwargs)'}, {'function': u'wrapper', 'pre_context': [u'            try:', u'                forum = Forum.from_url(forum)', u'            except Forum.DoesNotExist:', u'                forum = None', u'', u'        if forum and not forum.REVERT_DTPL() and hasattr(dtpl, func.__name__)\\', u'            and (func.__name__ != \"post_create\" or forum.USE_NEW_IFRAME()):'], 'vars': [[u'dtpl', u\"<module 'disqus.forums.dtpl' from '/www/disqus.com/htdocs/disqus/../disqus/forums/dtpl.pyc'>\"], [u'get_forum_from_request', u'<function get_forum_from_request at 0x7fbd16baae60>'], [u'forum', u'\u86c7\u4f8d (hebizamurai)'], [u'args', []], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'func', u'<function thread at 0x7fbd16dd2e60>'], [u'kwargs', {'forum': u'hebizamurai'}]], 'pre_context_lineno': u'81', 'post_context': [u'', u'        return func(request, *args, **kwargs)', u'    return wrapper'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/decorators.py', 'lineno': u'88', 'tb': u'<traceback object at 0x7fbd17e64878>', 'id': u'140450126514296', 'context_line': u'            return getattr(dtpl, func.__name__)(request, *args, **kwargs)'}, {'function': u'_uses_i18n', 'pre_context': [u'    Decorator for use with views which use translation.active() to ensure', u'    the cleanup is always done since using django.utils.translation is not', u'    thread-safe.', u'    \"\"\"', u'    @wraps(viewfunc)', u'    def _uses_i18n(request, *args, **kwargs):', u'        try:'], 'vars': [[u'viewfunc', u'<function thread at 0x7fbd171b9488>'], [u'args', []], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'kwargs', {'forum': u'hebizamurai'}]], 'pre_context_lineno': u'299', 'post_context': [u'        finally:', u'            translation.deactivate()', u'', u\"        patch_vary_headers(response, ('Accept-Language',))\", u\"        response['Content-Language'] = translation.get_language()\", u'        return response'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/common/decorators.py', 'lineno': u'306', 'tb': u'<traceback object at 0x7fbd17e64320>', 'id': u'140450126512928', 'context_line': u'            response = viewfunc(request, *args, **kwargs)'}, {'function': u'_new_view', 'pre_context': [u'def returns_javascript(view):', u'    \"\"\"', u'    Decorator to ensure that all HttpResponse objects returned', u'    by the view have mimetype text/javascript.', u'    \"\"\"', u'    @functools.wraps(view)', u'    def _new_view(*args, **kwargs):'], 'vars': [[u'args', [u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"]], [u'view', u'<function thread at 0x7fbd171b9410>'], [u'kwargs', {'forum': u'hebizamurai'}]], 'pre_context_lineno': u'218', 'post_context': [u\"        response.content_type = 'text/javascript; charset=UTF-8'\", u\"        response._headers['content-type'] = ('Content-Type', 'text/javascript; charset=UTF-8')\", u'        return response', u'    return _new_view', u'', u'def returns_json(view):'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/helpers.py', 'lineno': u'225', 'tb': u'<traceback object at 0x7fbd17e76bd8>', 'id': u'140450126588888', 'context_line': u'        response = view(*args, **kwargs)'}, {'function': u'wrapper', 'pre_context': [u\"            # with AnonymousUser if not the partner's SSO remote account.\", u'            if forum.DISQUS_AUTH_DISABLED():', u'                if (not request.user.is_remote) or \\', u'                   (remote_domain and forum and remote_domain != forum.get_partner().remote_domain_id):', u'                    request.user = AnonymousUser()', u'                    request.user.is_remote = False', u''], 'vars': [[u'PARTNER_SESSION_KEY', u'_partner_remote_user_id'], [u'get_forum_from_request', u'<function get_forum_from_request at 0x7fbd16baae60>'], [u'remote_user', u'None'], [u'update_partner_dict', u'<function update_partner_dict at 0x7fbd168bd848>'], [u'forum', u'\u86c7\u4f8d (hebizamurai)'], [u'Forum', u\"<class 'disqus.forums.models.Forum'>\"], [u'partner_remote_user_dict', u'None'], [u'args', []], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'AnonymousUser', u\"<class 'django.contrib.auth.models.AnonymousUser'>\"], [u'User', u\"<class 'django.contrib.auth.models.User'>\"], [u'kwargs', {'forum': u'hebizamurai'}], [u'fn', u'<function thread at 0x7fbd171b9398>'], [u'get_remote_user', u'<function get_remote_user at 0x7fbd168b9938>']], 'pre_context_lineno': u'161', 'post_context': [u'    return wrapper', u'', u'', u'def requires_attr(*attrs, **kwargs):', u'    \"\"\"', u'    A decorator for instance methods that requires the instance to have certain'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/common/decorators.py', 'lineno': u'168', 'tb': u'<traceback object at 0x7fbd17b6c200>', 'id': u'140450123399680', 'context_line': u'        return fn(request, *args, **kwargs)'}, {'function': u'thread', 'pre_context': [u\"                    # TODO: It's hard to determine what the correct behavior\", u'                    #       should be here.  We can either merge the two threads', u'                    #       or move the identifier to the thread attached to', u'                    #       the link, both of which are pretty destructive.', u'                    pass', u'        if not thread and url:', u'            thread = Thread.from_article_url(request, forum, url, title, message, \\'], 'vars': [[u'pagination_type', u'append'], [u'category_id', u''], [u'forum', u'\u86c7\u4f8d (hebizamurai)'], [u'thread', u'None'], [u'author', u'None'], [u'url', u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], [u'title', u''], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'integration', u'\u86c7\u4f8d (hebizamurai)'], [u'THREADMETA_SOURCE', u'embed:from_ident'], [u'preview_forum', u'None'], [u'thread_slug', u'None'], [u'per_page', u'0'], [u'message', u''], [u'identifier', u''], [u'developer', u'0']], 'pre_context_lineno': u'183', 'post_context': [u'', u'            # If a custom identifier was provided, but no ThreadMeta had', u\"            # been created yet, then we'll need to create it now.\", u'            if identifier and thread:', u'                ThreadMeta.objects.get_or_create(forum=forum, thread=thread, data=identifier,', u\"                                                 defaults={'source': THREADMETA_SOURCE})\"], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/dtpl.py', 'lineno': u'190', 'tb': u'<traceback object at 0x7fbd17e4f908>', 'id': u'140450126428424', 'context_line': u'                                             category_id=category_id, developer=developer)'}, {'function': u'from_article_url', 'pre_context': [u'    def from_article_url(request, forum, url, *args, **kwargs):', u'        \"\"\"Retrieve a Thread object from it's attached article URL.', u'', u'        forum is a Forum instance', u'', u'        Returns None if no matching Thread object was found.', u'        \"\"\"'], 'vars': [[u'url', u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], [u'args', [u'', u'']], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'forum', u'\u86c7\u4f8d (hebizamurai)'], [u'kwargs', {'category_id': u'', 'developer': u'0'}]], 'pre_context_lineno': u'1286', 'post_context': [u'', u'    @staticmethod', u'    def anon_thread_key(thread, forum, sort_int, page, per_page=None, is_initial_load=True):', u'        key = \"anon_thread:%d.%d.%d.%d.%s.%d\" % (thread.id, sort_int,', u'                                              page, per_page or 0,', u'                                              forum.get_options_signature(),'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/models.py', 'lineno': u'1293', 'tb': u'<traceback object at 0x7fbd17e4fea8>', 'id': u'140450126429864', 'context_line': u'        return Thread.from_(request, forum, url, *args, **kwargs)'}, {'function': u'from_', 'pre_context': [u'            thread.IMPORTED(True)', u'        thread.created = True', u'        thread.created_from_article_url = True', u'', u'        # Try to save the new thread/link objects.  If another request beat us', u\"        # here (race condition), we'll fetch the objects.\", u'        try:'], 'vars': [[u'category', u'General for \u86c7\u4f8d (hebizamurai)'], [u'forum', u'\u86c7\u4f8d (hebizamurai)'], [u'url_fp', u'<addinfourl at 140450126427416 whose fp = <socket._fileobject object at 0x7fbd180057d0>>'], [u'category_id', u''], [u'imported', u'False'], [u'create_on_fail', u'True'], [u'thread', u'__3043'], [u'title', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd'], [u'validate_url', u'True'], [u'data', '(Error decoding value)'], [u'request', u\"<WSGIRequest\nGET:<QueryDict: {u'sort': [u''], u'identifier': [u''], u'title': [u''], u'url': [u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], u'trackbacks': [u'null'], u'1284511580281': [u''], u'trackback_url': [u'null'], u'per_page': [u'null'], u'category_id': [u''], u'developer': [u'0']}>,\nPOST:<QueryDict: {}>,\nCOOKIES:{},\nMETA:{'DOCUMENT_ROOT': '/www/disqus.com/htdocs/',\n 'GATEWAY_INTERFACE': 'CGI/1.1',\n 'HTTP_ACCEPT': '*/*',\n 'HTTP_ACCEPT_ENCODING': 'gzip, deflate',\n 'HTTP_ACCEPT_LANGUAGE': 'ja',\n 'HTTP_CACHE_CONTROL': 'max-age=259200',\n 'HTTP_HOST': 'hebizamurai.disqus.com',\n 'HTTP_REFERER': 'http://hebizamurai.blog90.fc2.com/blog-entry-634.html',\n 'HTTP_UA_CPU': 'x86',\n 'HTTP_USER_AGENT': 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)',\n 'HTTP_VIA': '1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)',\n 'HTTP_X_FORWARDED_FOR': 'unknown, 210.249.171.193',\n 'PATH_INFO': u'/thread.js',\n 'PATH_TRANSLATED': '/www/disqus.com/htdocs/disqus/django.wsgi/thread.js',\n 'QUERY_STRING': 'url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'REMOTE_ADDR': '210.249.171.193',\n 'REMOTE_PORT': '7855',\n 'REQUEST_METHOD': 'GET',\n 'REQUEST_URI': '/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281',\n 'SCRIPT_FILENAME': '/www/disqus.com/htdocs/disqus/django.wsgi',\n 'SCRIPT_NAME': u'',\n 'SERVER_ADDR': '10.13.198.24',\n 'SERVER_ADMIN': 'all@disqus.com',\n 'SERVER_NAME': 'hebizamurai.disqus.com',\n 'SERVER_PORT': '80',\n 'SERVER_PROTOCOL': 'HTTP/1.0',\n 'SERVER_SIGNATURE': '<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\\n',\n 'SERVER_SOFTWARE': 'Apache/2.2.14 (Ubuntu)',\n 'mod_wsgi.application_group': 'guinea.disqus.net|',\n 'mod_wsgi.callable_object': 'application',\n 'mod_wsgi.handler_script': '',\n 'mod_wsgi.input_chunked': '0',\n 'mod_wsgi.listener_host': '10.13.198.24',\n 'mod_wsgi.listener_port': '80',\n 'mod_wsgi.process_group': 'disqus-app',\n 'mod_wsgi.request_handler': 'wsgi-script',\n 'mod_wsgi.script_reloading': '1',\n 'mod_wsgi.version': (3, 1),\n 'wsgi.errors': <mod_wsgi.Log object at 0x7fbd17a42730>,\n 'wsgi.file_wrapper': <built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>,\n 'wsgi.input': <mod_wsgi.Input object at 0x7fbd17a42ab0>,\n 'wsgi.multiprocess': True,\n 'wsgi.multithread': False,\n 'wsgi.run_once': False,\n 'wsgi.url_scheme': 'http',\n 'wsgi.version': (1, 1)}>\"], [u'source', u''], [u'url', u'http://hebizamurai.blog90.fc2.com/blog-entry-634.html'], [u'url2', u'http://www.hebizamurai.blog90.fc2.com/blog-entry-634.html'], [u'message', u''], [u'identifier', u'None'], [u'tumblr_match', u'None'], [u'slug', u'__3043'], [u'developer', u'0']], 'pre_context_lineno': u'1243', 'post_context': [u'        except IntegrityError, e:', u'            # Because we just encountered an SQL error, we need to clean the connection.', u'            transaction.rollback()', u'            thread = Thread.objects.get(forum=forum, slug=slug)', u'            return thread', u'        '], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/models.py', 'lineno': u'1250', 'tb': u'<traceback object at 0x7fbd17e64d40>', 'id': u'140450126515520', 'context_line': u'            thread.save()'}, {'function': u'save', 'pre_context': [u'    def save(self, **kwargs):', u'        created = bool(not self.id)', u'        # HACK: Truncate title length to 200.', u'        # TODO: This should get the length of the field from the model.', u'        if len(self.title) > 200:', u\"            self.title = self.title[:197] + '...'\", u''], 'vars': [[u'self', u'__3043'], [u'kwargs', {}], [u'created', u'True']], 'pre_context_lineno': u'1564', 'post_context': [u'        # Invalidate cached links to this thread.', u'        if not created:', u'            for link in Link.rs_objects.filter(thread=self):', u'                cache.delete(Thread.article_url_cache_key(self.forum_id, link.url), hard=True)', u'        cache.set(Thread.slug_cache_key(self.forum_id, self.slug), self)', u''], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/forums/models.py', 'lineno': u'1571', 'tb': u'<traceback object at 0x7fbd17e641b8>', 'id': u'140450126512568', 'context_line': u'        super(Thread, self).save(**kwargs)'}, {'function': u'save', 'pre_context': [u'', u\"        The 'force_insert' and 'force_update' parameters can be used to insist\", u'        that the \"save\" must be an SQL insert or update (or equivalent for', u'        non-SQL backends), respectively. Normally, they should not be set.', u'        \"\"\"', u'        if force_insert and force_update:', u'            raise ValueError(\"Cannot force both insert and updating in model saving.\")'], 'vars': [[u'using', u'None'], [u'self', u'__3043'], [u'force_update', u'False'], [u'force_insert', u'False']], 'pre_context_lineno': u'429', 'post_context': [u'', u'    save.alters_data = True', u'', u'    def update(self, using=None, **kwargs):', u'        \"\"\"', u'        Updates specified attributes on the current instance.'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/base.py', 'lineno': u'436', 'tb': u'<traceback object at 0x7fbd17e4ff38>', 'id': u'140450126430008', 'context_line': u'        self.save_base(using=using, force_insert=force_insert, force_update=force_update)'}, {'function': u'save_base', 'pre_context': [u'                        for f in meta.local_fields]', u'', u'                record_exists = False', u'', u'                update_pk = bool(meta.has_auto_field and not pk_set)', u'                if values:', u'                    # Create a new record.'], 'vars': [[u'origin', u\"<class 'disqus.forums.models.Thread'>\"], [u'non_pks', [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56510>', u'<django.db.models.fields.SlugField object at 0x7fbd16c56650>', u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56710>', u'<django.db.models.fields.CharField object at 0x7fbd16c56790>', u'<django.db.models.fields.DateTimeField object at 0x7fbd16c56810>', u'<django.db.models.fields.PositiveSmallIntegerField object at 0x7fbd16c56850>', u'<django.db.models.fields.TextField object at 0x7fbd16c56890>', u'<django.db.models.fields.IPAddressField object at 0x7fbd16c568d0>', u'<django.db.models.fields.IntegerField object at 0x7fbd16c56910>', u'<django.db.models.fields.BooleanField object at 0x7fbd16c56950>', u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56990>', u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a10>', u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a50>']], [u'f', u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a50>'], [u'self', u'__3043'], [u'force_update', u'False'], [u'connection', u'<django.db.backends.postgresql_psycopg2.base.DatabaseWrapper object at 0x7fbd15f743c0>'], [u'force_insert', u'False'], [u'raw', u'False'], [u'manager', u'<django.db.models.manager.Manager object at 0x7fbd16c5a3d0>'], [u'meta', u'forums.thread'], [u'values', [[u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56510>', u'441188'], [u'<django.db.models.fields.SlugField object at 0x7fbd16c56650>', u'__3043'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56710>', u'3935381'], [u'<django.db.models.fields.CharField object at 0x7fbd16c56790>', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd'], [u'<django.db.models.fields.DateTimeField object at 0x7fbd16c56810>', u'2010-09-14 20:46:21.094395'], [u'<django.db.models.fields.PositiveSmallIntegerField object at 0x7fbd16c56850>', u'4'], [u'<django.db.models.fields.TextField object at 0x7fbd16c56890>', u''], [u'<django.db.models.fields.IPAddressField object at 0x7fbd16c568d0>', u'210.249.171.193'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56910>', u'0'], [u'<django.db.models.fields.BooleanField object at 0x7fbd16c56950>', u'False'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56990>', u'447829'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a10>', u'0'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a50>', u'None']]], [u'pk_val', u'None'], [u'using', u'default'], [u'pk_set', u'False'], [u'org', u'None'], [u'cls', u\"<class 'disqus.forums.models.Thread'>\"], [u'update_pk', u'True'], [u'record_exists', u'False']], 'pre_context_lineno': u'536', 'post_context': [u'                else:', u'                    # Create a new record with defaults for everything.', u'                    result = manager._insert([(meta.pk, connection.ops.pk_default_value())], return_id=update_pk, raw_values=True, using=using)', u'', u'                if update_pk:', u'                    setattr(self, meta.pk.attname, result)'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/base.py', 'lineno': u'543', 'tb': u'<traceback object at 0x7fbd17e4fb00>', 'id': u'140450126428928', 'context_line': u'                    result = manager._insert(values, return_id=update_pk, using=using)'}, {'function': u'_insert', 'pre_context': [u'    def using(self, *args, **kwargs):', u'        return self.get_query_set().using(*args, **kwargs)', u'', u'    def exists(self, *args, **kwargs):', u'        return self.get_query_set().exists(*args, **kwargs)', u'', u'    def _insert(self, values, **kwargs):'], 'vars': [[u'self', u'<django.db.models.manager.Manager object at 0x7fbd16c5a3d0>'], [u'values', [[u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56510>', u'441188'], [u'<django.db.models.fields.SlugField object at 0x7fbd16c56650>', u'__3043'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56710>', u'3935381'], [u'<django.db.models.fields.CharField object at 0x7fbd16c56790>', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd'], [u'<django.db.models.fields.DateTimeField object at 0x7fbd16c56810>', u'2010-09-14 20:46:21.094395'], [u'<django.db.models.fields.PositiveSmallIntegerField object at 0x7fbd16c56850>', u'4'], [u'<django.db.models.fields.TextField object at 0x7fbd16c56890>', u''], [u'<django.db.models.fields.IPAddressField object at 0x7fbd16c568d0>', u'210.249.171.193'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56910>', u'0'], [u'<django.db.models.fields.BooleanField object at 0x7fbd16c56950>', u'False'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56990>', u'447829'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a10>', u'0'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a50>', u'None']]], [u'kwargs', {'using': u'default', 'return_id': u'True'}]], 'pre_context_lineno': u'188', 'post_context': [u'', u'    def _update(self, values, **kwargs):', u'        return self.get_query_set()._update(values, **kwargs)', u'', u'    def raw(self, raw_query, params=None, *args, **kwargs):', u'        return RawQuerySet(raw_query=raw_query, model=self.model, params=params, using=self._db, *args, **kwargs)'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/manager.py', 'lineno': u'195', 'tb': u'<traceback object at 0x7fbd17e4ff80>', 'id': u'140450126430080', 'context_line': u'        return insert_query(self.model, values, **kwargs)'}, {'function': u'insert_query', 'pre_context': [u'    \"\"\"', u'    Inserts a new record for the given model. This provides an interface to', u'    the InsertQuery class and is how Model.save() is implemented. It is not', u'    part of the public API.', u'    \"\"\"', u'    query = sql.InsertQuery(model)', u'    query.insert_values(values, raw_values)'], 'vars': [[u'raw_values', u'False'], [u'return_id', u'True'], [u'values', [[u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56510>', u'441188'], [u'<django.db.models.fields.SlugField object at 0x7fbd16c56650>', u'__3043'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56710>', u'3935381'], [u'<django.db.models.fields.CharField object at 0x7fbd16c56790>', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd'], [u'<django.db.models.fields.DateTimeField object at 0x7fbd16c56810>', u'2010-09-14 20:46:21.094395'], [u'<django.db.models.fields.PositiveSmallIntegerField object at 0x7fbd16c56850>', u'4'], [u'<django.db.models.fields.TextField object at 0x7fbd16c56890>', u''], [u'<django.db.models.fields.IPAddressField object at 0x7fbd16c568d0>', u'210.249.171.193'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56910>', u'0'], [u'<django.db.models.fields.BooleanField object at 0x7fbd16c56950>', u'False'], [u'<django.db.models.fields.related.ForeignKey object at 0x7fbd16c56990>', u'447829'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a10>', u'0'], [u'<django.db.models.fields.IntegerField object at 0x7fbd16c56a50>', u'None']]], [u'using', u'default'], [u'query', '(Error decoding value)'], [u'model', u\"<class 'disqus.forums.models.Thread'>\"]], 'pre_context_lineno': u'1476', 'post_context': [], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/query.py', 'lineno': u'1483', 'tb': u'<traceback object at 0x7fbd17e4f7a0>', 'id': u'140450126428064', 'context_line': u'    return query.get_compiler(using=using).execute_sql(return_id)'}, {'function': u'execute_sql', 'pre_context': [u'            r_fmt, r_params = self.connection.ops.return_insert_id()', u'            result.append(r_fmt % col)', u'            params = params + r_params', u\"        return ' '.join(result), params\", u'', u'    def execute_sql(self, return_id=False):', u'        self.return_id = return_id'], 'vars': [[u'self', u'<django.db.models.sql.compiler.SQLInsertCompiler object at 0x7fbd18014a10>'], [u'return_id', u'True']], 'pre_context_lineno': u'777', 'post_context': [u'        if not (return_id and cursor):', u'            return', u'        if self.connection.features.can_return_id_from_insert:', u'            return self.connection.ops.fetch_returned_insert_id(cursor)', u'        return self.connection.ops.last_insert_id(cursor,', u'                self.query.model._meta.db_table, self.query.model._meta.pk.column)'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/sql/compiler.py', 'lineno': u'784', 'tb': u'<traceback object at 0x7fbd17e4fcf8>', 'id': u'140450126429432', 'context_line': u'        cursor = super(SQLInsertCompiler, self).execute_sql(None)'}, {'function': u'__performance_logging', 'pre_context': [u'    \"\"\"', u'    def _performance_logging(func):', u'        @wraps(func)', u'        def __performance_logging(*args, **kwargs):', u\"            if getattr(settings, 'PERFORMANCE_LOG', False):\", u'                start_time = time.time()', u''], 'vars': [[u'start_time', u'1284511581.1'], [u'args', [u'<django.db.models.sql.compiler.SQLInsertCompiler object at 0x7fbd18014a10>', u'None']], [u'key', u'orm'], [u'func', u'<function execute_sql at 0x7fbd1727c8c0>'], [u'kwargs', {}]], 'pre_context_lineno': u'14', 'post_context': [u'', u\"            if getattr(settings, 'PERFORMANCE_LOG', False):\", u'                thread_ident = thread.get_ident()', u'                if thread_ident not in thread_data:', u'                    thread_data[thread_ident] = defaultdict(list)', u'                thread_data[thread_ident][key].append(time.time() - start_time)'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/contrib/performance_log/decorators.py', 'lineno': u'21', 'tb': u'<traceback object at 0x7fbd17e4f6c8>', 'id': u'140450126427848', 'context_line': u'            retval = func(*args, **kwargs)'}, {'function': u'execute_sql', 'pre_context': [u'        except EmptyResultSet:', u'            if result_type == MULTI:', u'                return empty_iter()', u'            else:', u'                return', u'', u'        cursor = self.connection.cursor()'], 'vars': [[u'cursor', u'<django.db.backends.util.CursorWrapper object at 0x7fbd18014090>'], [u'self', u'<django.db.models.sql.compiler.SQLInsertCompiler object at 0x7fbd18014a10>'], [u'params', [u'441188', u'__3043', u'3935381', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd', u'2010-09-14 20:46:21.094395', u'4', u'', u'210.249.171.193', u'0', u'False', u'447829', u'0', u'None']], [u'result_type', u'None'], [u'sql', u'INSERT INTO \"forums_thread\" (\"forum_id\", \"slug\", \"creator_id\", \"title\", \"date\", \"type\", \"message\", \"ip_address\", \"views\", \"killed\", \"category_id\", \"flags\", \"days_alive\") VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)']], 'pre_context_lineno': u'721', 'post_context': [u'', u'        if not result_type:', u'            return cursor', u'        if result_type == SINGLE:', u'            if self.query.ordering_aliases:', u'                return cursor.fetchone()[:-len(self.query.ordering_aliases)]'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/models/sql/compiler.py', 'lineno': u'728', 'tb': u'<traceback object at 0x7fbd17e4f710>', 'id': u'140450126427920', 'context_line': u'        cursor.execute(sql, params)'}, {'function': u'__performance_logging', 'pre_context': [u'    \"\"\"', u'    def _performance_logging(func):', u'        @wraps(func)', u'        def __performance_logging(*args, **kwargs):', u\"            if getattr(settings, 'PERFORMANCE_LOG', False):\", u'                start_time = time.time()', u''], 'vars': [[u'start_time', u'1284511581.1'], [u'args', [u'<django.db.backends.util.CursorWrapper object at 0x7fbd18014090>', u'INSERT INTO \"forums_thread\" (\"forum_id\", \"slug\", \"creator_id\", \"title\", \"date\", \"type\", \"message\", \"ip_address\", \"views\", \"killed\", \"category_id\", \"flags\", \"days_alive\") VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)', [u'441188', u'__3043', u'3935381', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd', u'2010-09-14 20:46:21.094395', u'4', u'', u'210.249.171.193', u'0', u'False', u'447829', u'0', u'None']]], [u'key', u'sql'], [u'func', u'<function execute at 0x7fbd15f8bb18>'], [u'kwargs', {}]], 'pre_context_lineno': u'14', 'post_context': [u'', u\"            if getattr(settings, 'PERFORMANCE_LOG', False):\", u'                thread_ident = thread.get_ident()', u'                if thread_ident not in thread_data:', u'                    thread_data[thread_ident] = defaultdict(list)', u'                thread_data[thread_ident][key].append(time.time() - start_time)'], 'filename': u'/www/disqus.com/htdocs/disqus/../disqus/contrib/performance_log/decorators.py', 'lineno': u'21', 'tb': u'<traceback object at 0x7fbd17e4fbd8>', 'id': u'140450126429144', 'context_line': u'            retval = func(*args, **kwargs)'}, {'function': u'execute', 'pre_context': [u'        self.cursor = cursor', u'        self.db = db # Instance of a BaseDatabaseWrapper subclass', u'', u\"    @performance_logging('sql')\", u'    def execute(self, sql, params=None):', u'        start = time()', u'        if params is not None:'], 'vars': [[u'start', u'1284511581.1'], [u'self', u'<django.db.backends.util.CursorWrapper object at 0x7fbd18014090>'], [u'params', [u'441188', u'__3043', u'3935381', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd', u'2010-09-14 20:46:21.094395', u'4', u'', u'210.249.171.193', u'0', u'False', u'447829', u'0', u'None']], [u'sql', u'INSERT INTO \"forums_thread\" (\"forum_id\", \"slug\", \"creator_id\", \"title\", \"date\", \"type\", \"message\", \"ip_address\", \"views\", \"killed\", \"category_id\", \"flags\", \"days_alive\") VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)']], 'pre_context_lineno': u'19', 'post_context': [u'        else:', u'            retval = self.cursor.execute(sql)', u'', u\"        if getattr(settings, 'PERFORMANCE_LOG_QUERIES', False):\", u'            sql = self.db.ops.last_executed_query(self.cursor, sql, params)', u'            self.db.queries.append({'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/backends/util.py', 'lineno': u'26', 'tb': u'<traceback object at 0x7fbd17e4ffc8>', 'id': u'140450126430152', 'context_line': u'            retval = self.cursor.execute(sql, params)'}, {'function': u'execute', 'pre_context': [u'    \"\"\"', u'', u'    def __init__(self, cursor):', u'        self.cursor = cursor', u'', u'    def execute(self, query, args=None):', u'        try:'], 'vars': [[u'query', u'INSERT INTO \"forums_thread\" (\"forum_id\", \"slug\", \"creator_id\", \"title\", \"date\", \"type\", \"message\", \"ip_address\", \"views\", \"killed\", \"category_id\", \"flags\", \"days_alive\") VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)'], [u'self', u'<django.db.backends.postgresql_psycopg2.base.CursorWrapper object at 0x7fbd18014b50>'], [u'args', [u'441188', u'__3043', u'3935381', u'\ufffd\ufffd\ufffd\u787c\ufffd\ufffd\\U000e19a5\ufffd\ufffd\uddef\ufffd\ufffd\ufffd\u02fe\ufffd\u01ef\ufffd\ufffd\ufffd\u01e5\ufffd\ufffd\u0665\uc979\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\u063b\ufffd\ufffd\ufffd\ufffd\ufffd\u0265\ufffd\ufffd\ufffd', u'2010-09-14 20:46:21.094395', u'4', u'', u'210.249.171.193', u'0', u'False', u'447829', u'0', u'None']], [u'e', u'invalid byte sequence for encoding \"UTF8\": 0xedb7af\nHINT:  This error can also happen if the byte sequence does not match the encoding expected by the server, which is controlled by \"client_encoding\".\n']], 'pre_context_lineno': u'37', 'post_context': [u'        except Database.IntegrityError, e:', u'            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]', u'        except Database.DatabaseError, e:', u'            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]', u'', u'    def executemany(self, query, args):'], 'filename': u'/www/disqus.com/env/lib/python2.6/site-packages/django/db/backends/postgresql_psycopg2/base.py', 'lineno': u'44', 'tb': u'<traceback object at 0x7fbd17e4fb48>', 'id': u'140450126429000', 'context_line': u'            return self.cursor.execute(query, args)'}]]"
+    },
+    "COOKIES": {},
+    "GET": {"sort": "", "identifier": "", "title": "", "url": "http://hebizamurai.blog90.fc2.com/blog-entry-634.html", "trackbacks": "null", "1284511580281": "", "trackback_url": "null", "per_page": "null", "category_id": "", "developer": "0"}, "url": "http://hebizamurai.disqus.com/forums/hebizamurai/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281",
+    "META": {"mod_wsgi.listener_port": "80", "HTTP_REFERER": "http://hebizamurai.blog90.fc2.com/blog-entry-634.html", "mod_wsgi.listener_host": "10.13.198.24", "SERVER_SOFTWARE": "Apache/2.2.14 (Ubuntu)", "SCRIPT_NAME": "", "mod_wsgi.handler_script": "", "SERVER_SIGNATURE": "<address>Apache/2.2.14 (Ubuntu) Server at hebizamurai.disqus.com Port 80</address>\n", "REQUEST_METHOD": "GET", "PATH_INFO": "/thread.js", "SERVER_PROTOCOL": "HTTP/1.0", "QUERY_STRING": "url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281", "HTTP_USER_AGENT": "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 1.1.4322; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618)", "SERVER_NAME": "hebizamurai.disqus.com", "REMOTE_ADDR": "210.249.171.193", "mod_wsgi.request_handler": "wsgi-script", "wsgi.url_scheme": "http", "HTTP_VIA": "1.0 scan05:8082 (squid/2.5.STABLE9), 1.0 scan05:8081 (IWSS)", "PATH_TRANSLATED": "/www/disqus.com/htdocs/disqus/django.wsgi/thread.js", "SERVER_PORT": "80", "wsgi.multiprocess": true, "mod_wsgi.input_chunked": "0", "SERVER_ADDR": "10.13.198.24", "DOCUMENT_ROOT": "/www/disqus.com/htdocs/", "mod_wsgi.process_group": "disqus-app", "SCRIPT_FILENAME": "/www/disqus.com/htdocs/disqus/django.wsgi", "SERVER_ADMIN": "all@disqus.com", "wsgi.input": "<mod_wsgi.Input object at 0x7fbd17a42ab0>", "HTTP_HOST": "hebizamurai.disqus.com", "mod_wsgi.callable_object": "application", "wsgi.multithread": false, "HTTP_UA_CPU": "x86", "HTTP_CACHE_CONTROL": "max-age=259200", "REQUEST_URI": "/thread.js?url=http%3A%2F%2Fhebizamurai.blog90.fc2.com%2Fblog-entry-634.html&title=&sort=&per_page=null&category_id=&developer=0&identifier=&trackback_url=null&trackbacks=null&1284511580281", "HTTP_ACCEPT": "*/*", "wsgi.version": [1, 1], "GATEWAY_INTERFACE": "CGI/1.1", "HTTP_X_FORWARDED_FOR": "unknown, 210.249.171.193", "wsgi.errors": "<mod_wsgi.Log object at 0x7fbd17a42730>", "REMOTE_PORT": "7855", "HTTP_ACCEPT_LANGUAGE": "ja", "mod_wsgi.version": [3, 1], "wsgi.run_once": false, "mod_wsgi.application_group": "guinea.disqus.net|", "mod_wsgi.script_reloading": "1", "wsgi.file_wrapper": "<built-in method file_wrapper of mod_wsgi.Adapter object at 0x7fbd17d7af30>", "HTTP_ACCEPT_ENCODING": "gzip, deflate"},
+    "POST": {}
+  }
+}
\ No newline at end of file
diff --git a/sentry/tests/tests.py b/sentry/tests/tests.py
index 1ae69e4817..71d2872b58 100644
--- a/sentry/tests/tests.py
+++ b/sentry/tests/tests.py
@@ -7,6 +7,7 @@ except ImportError:
     import pickle
 import getpass
 import logging
+import os.path
 import sys
 import threading
 
@@ -19,6 +20,7 @@ from django.core.servers import basehttp
 from django.test.client import Client
 from django.test import TestCase
 from django.utils.encoding import smart_unicode
+from django.utils import simplejson
 
 from sentry import settings
 from sentry.helpers import transform
@@ -226,7 +228,8 @@ class SentryTestCase(TestCase):
         try:
             Message.objects.get(id=999999989)
         except Message.DoesNotExist, exc:
-            get_client().create_from_exception(exc)
+            error = get_client().create_from_exception(exc)
+            self.assertTrue(error.data.get('__sentry__', {}).get('exc'))
         else:
             self.fail('Unable to create `Message` entry.')
 
@@ -238,7 +241,6 @@ class SentryTestCase(TestCase):
         else:
             self.fail('Unable to create `Message` entry.')
 
-        
         self.assertEquals(Message.objects.count(), 2)
         self.assertEquals(GroupedMessage.objects.count(), 2)
         last = Message.objects.all().order_by('-id')[0:1].get()
@@ -502,6 +504,7 @@ class SentryTestCase(TestCase):
         
         settings.NAME = orig
 
+
 class SentryViewsTest(TestCase):
     urls = 'sentry.tests.urls'
     fixtures = ['sentry/tests/fixtures/views.json']
@@ -616,9 +619,6 @@ class RemoteSentryTest(TestCase):
 
     def testCorrectData(self):
         kwargs = {'message': 'hello', 'server_name': 'not_dcramer.local', 'level': 40}
-        data = {
-            
-        }
         resp = self.client.post(reverse('sentry-store'), {
             'data': base64.b64encode(pickle.dumps(transform(kwargs)).encode('zlib')),
             'key': settings.KEY,
@@ -631,9 +631,6 @@ class RemoteSentryTest(TestCase):
 
     def testUngzippedData(self):
         kwargs = {'message': 'hello', 'server_name': 'not_dcramer.local', 'level': 40}
-        data = {
-            
-        }
         resp = self.client.post(reverse('sentry-store'), {
             'data': base64.b64encode(pickle.dumps(transform(kwargs))),
             'key': settings.KEY,
@@ -644,6 +641,24 @@ class RemoteSentryTest(TestCase):
         self.assertEquals(instance.server_name, 'not_dcramer.local')
         self.assertEquals(instance.level, 40)
 
+    def testByteSequence(self):
+        """
+        invalid byte sequence for encoding "UTF8": 0xedb7af
+        """
+        fname = os.path.join(os.path.dirname(__file__), 'fixtures/encode_error.json')
+        kwargs = simplejson.load(open(fname))
+        
+        resp = self.client.post(reverse('sentry-store'), {
+            'data': base64.b64encode(pickle.dumps(transform(kwargs)).encode('zlib')),
+            'key': settings.KEY,
+        })
+        self.assertEquals(resp.status_code, 200)
+        instance = Message.objects.get()
+        self.assertEquals(instance.message, 'hello')
+        self.assertEquals(instance.server_name, 'localhost')
+        self.assertEquals(instance.level, 40)
+        self.assertTrue(instance.data['__sentry__']['exc'])
+
     # def testProcess(self):
     #     self.start_test_server()
     #     SentryClient.process(message='hello')
@@ -803,4 +818,3 @@ class SentryClientTest(TestCase):
         self.assertEquals(_foo[''].getMessage(), 'view exception')
         self.assertEquals(_foo[''].levelno, client.default_level)
         self.assertEquals(_foo[''].class_name, 'Exception')
-
