commit da5cc0cd17090e22e0889cc9ce334e67e7b4acd8
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Dec 17 21:56:40 2014 -0800

    Functional project selector

diff --git a/src/sentry/static/sentry/styles/sentry.css b/src/sentry/static/sentry/styles/sentry.css
index 0751687532..4cf18f1575 100644
--- a/src/sentry/static/sentry/styles/sentry.css
+++ b/src/sentry/static/sentry/styles/sentry.css
@@ -9413,6 +9413,83 @@ pre {
   background: #ffffff url(../images/dashboard/sidebar-bg.png) top left repeat-y;
   background-size: 211px 100%;
 }
+.docs .select-project {
+  font-size: 16px;
+}
+.docs .select-project .project-label {
+  color: #A4ABB5;
+}
+.docs .select-project .dropdown-menu {
+  left: auto;
+  right: 0;
+  width: 500px;
+  overflow: hidden;
+  padding: 0;
+  max-height: 400px;
+  overflow: auto;
+}
+.docs .select-project .dropdown-menu h6 {
+  font-size: 14px;
+  margin-bottom: 10px;
+}
+.docs .select-project .dropdown-menu ul {
+  margin: 0;
+}
+.docs .select-project .dropdown-menu .org h5 {
+  border-top: 1px solid #f1f2f3;
+  background: #fafafa;
+  margin: 0;
+  padding: 5px 15px;
+}
+.docs .select-project .dropdown-menu .team {
+  padding: 10px 15px 0;
+  border-top: 1px solid #f1f2f3;
+}
+.docs .select-project .dropdown-menu .projects {
+  *zoom: 1;
+  box-sizing: border-box;
+}
+.docs .select-project .dropdown-menu .projects:before,
+.docs .select-project .dropdown-menu .projects:after {
+  display: table;
+  content: "";
+  line-height: 0;
+}
+.docs .select-project .dropdown-menu .projects:after {
+  clear: both;
+}
+.docs .select-project .dropdown-menu .projects li {
+  float: left;
+  margin: 0 0 8px;
+  box-sizing: border-box;
+  width: 33.33%;
+  padding-right: 14px;
+  position: relative;
+}
+.docs .select-project .dropdown-menu .projects li.active a {
+  background: transparent;
+  position: relative;
+  z-index: 2;
+}
+.docs .select-project .dropdown-menu .projects li.active:after {
+  display: block;
+  content: "";
+  position: absolute;
+  top: -2px;
+  left: -6px;
+  bottom: -2px;
+  right: 10px;
+  background: #2e9fff;
+  z-index: 1;
+  border-radius: 3px;
+}
+.docs .select-project .dropdown-menu .projects li a {
+  display: block;
+  font-weight: normal;
+  overflow: hidden;
+  text-overflow: ellipsis;
+  white-space: nowrap;
+}
 .docs .crumbs {
   *zoom: 1;
   color: #A4ABB5;
@@ -9505,8 +9582,8 @@ pre {
   border-right: 0;
 }
 .docs .docs-main .api-resource {
-  border-top: 1px solid #e9ecf0;
-  padding: 15px 40px 0;
+  border-top: 1px solid #f2f4f6;
+  padding: 40px 40px 25px;
   margin-bottom: -1px;
   margin-left: -40px;
   margin-right: -40px;
@@ -9514,14 +9591,12 @@ pre {
 .docs .docs-main .api-resource + .api-resource {
   border-radius: 0;
 }
-.docs .docs-main .api-resource:last-child {
-  margin-bottom: 15px;
-}
 .docs .docs-main .api-resource h4 {
-  background: rgba(250, 250, 250, 0.55);
-  border-bottom: 1px solid #e9ecf0;
-  padding: 10px 40px;
-  margin: -15px -40px 19px;
+  font-size: 22px;
+  font-weight: 400;
+  letter-spacing: -0.025em;
+  margin-bottom: 24px;
+  color: #282E35;
 }
 .docs .docs-main .api-resource h5 {
   font-size: 16px;
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index 6cb76a97f2..2f89c4fe30 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -174,7 +174,8 @@
       <h2>No events to show.</h2>
       <p>We'll notify you if that changes. In the meantime why not take a moment to become more familiar with Sentry.</p>
       <p class="links">
-        <a href="docs/">Installation instructions</a> <a href="settings/">Project settings</a>
+        <a href="{% url 'sentry-help-platform-list' %}?pid={{ project.id }}">Installation instructions</a>
+        <a href="{% url 'sentry-manage-project' organization.slug project.slug %}">Project settings</a>
       </p>
     </div>
   </script>
@@ -195,7 +196,7 @@
               <div class="span4">
                 <p>New here?</p>
                 <ul>
-                  <li><a href="{% url 'sentry-help' %}">Installation instructions</a></li>
+                  <li><a href="{% url 'sentry-help-platform-list' %}?pid={{ project.id }}">Installation instructions</a></li>
                   <li><a href="{% url 'sentry-manage-project' organization.slug project.slug %}">Project settings</a></li>
                 </ul>
               </div>
diff --git a/src/sentry/templates/sentry/help/index.html b/src/sentry/templates/sentry/help/index.html
index b073b26df3..b506bc150e 100644
--- a/src/sentry/templates/sentry/help/index.html
+++ b/src/sentry/templates/sentry/help/index.html
@@ -20,67 +20,8 @@
             {% endblock %}
           </div>
           <div class="span9 docs-main">
-            <div class="select-project dropdown pull-right">
-              <div class="dropdown-toggle" data-toggle="dropdown"><span class="project-label">Project:</span> Chef <span class="caret"></span></div>
-              <div class="dropdown-menu">
-                <ul class="orgs">
-                  <li class="org">
-                    <h5>Sentry</h5>
-                    <ul class="teams unstyled">
-                      <li class="team">
-                        <h6>Sentry</h6>
-                        <ul class="projects unstyled">
-                          <li><a href="#">Backend</a></li>
-                          <li class="active"><a href="#">Chef</a></li>
-                          <li><a href="#">Frontend</a></li>
-                          <li><a href="#">Runscope Check</a></li>
-                        </ul>
-                      </li>
-                      <li class="team">
-                        <h6>Sentry Test</h6>
-                        <ul class="projects unstyled">
-                          <li><a href="#">AS3</a></li>
-                          <li><a href="#">C#</a></li>
-                          <li><a href="#">iOS</a></li>
-                          <li><a href="#">Java</a></li>
-                          <li><a href="#">JavaScript</a></li>
-                          <li><a href="#">PHP</a></li>
-                          <li><a href="#">Python</a></li>
-                          <li><a href="#">Ruby</a></li>
-                        </ul>
-                      </li>
-                    </ul>
-                  </li>
-                  <li class="org">
-                    <h5>GitHub</h5>
-                    <ul class="teams unstyled">
-                      <li class="team">
-                        <h6>Chat</h6>
-                        <ul class="projects unstyled">
-                          <li><a href="#">Backend</a></li>
-                          <li><a href="#">Chef</a></li>
-                          <li><a href="#">Frontend</a></li>
-                          <li><a href="#">Runscope Check</a></li>
-                        </ul>
-                      </li>
-                      <li class="team">
-                        <h6>Atom</h6>
-                        <ul class="projects unstyled">
-                          <li><a href="#">AS3</a></li>
-                          <li><a href="#">C#</a></li>
-                          <li><a href="#">iOS</a></li>
-                          <li><a href="#">Java</a></li>
-                          <li><a href="#">JavaScript</a></li>
-                          <li><a href="#">PHP</a></li>
-                          <li><a href="#">Python</a></li>
-                          <li><a href="#">Ruby</a></li>
-                        </ul>
-                      </li>
-                    </ul>
-                  </li>
-                </ul>
-              </div>
-            </div>
+            {% block pre_breadcrumbs %}
+            {% endblock %}
             <ul class="crumbs">
               {% block breadcrumbs %}
               <li><a href="{% url 'sentry-help' %}">Docs</a></li>
diff --git a/src/sentry/templates/sentry/help/platform_details.html b/src/sentry/templates/sentry/help/platform_details.html
index 70373e941c..e01d2b2266 100644
--- a/src/sentry/templates/sentry/help/platform_details.html
+++ b/src/sentry/templates/sentry/help/platform_details.html
@@ -6,6 +6,40 @@
 {% block title %}{{ platform_title }} Client Configuration | {{ block.super }}{% endblock %}
 {% block client_overview_class %}{% endblock %}
 
+{% block pre_breadcrumbs %}
+  <div class="select-project dropdown pull-right">
+    <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)">
+    {% if selected_project %}
+      <span class="project-label">Project:</span> {{ selected_project.name }} <span class="caret"></span>
+    {% else %}
+      <span class="project-label">Project:</span> (Select) <span class="caret"></span>
+    {% endif %}
+    </a>
+    <div class="dropdown-menu">
+      <ul class="orgs">
+      {% for org, team_results in org_results %}
+        <li class="org">
+          <h5>{{ org.name }}</h5>
+          <ul class="teams unstyled">
+          {% for team, project_results in team_results %}
+            <li class="team">
+              <h6>{{ team.name }}</h6>
+              <ul class="projects unstyled">
+              {% for project in project_results %}
+                <li{% if project == selected_project %} class="active"{% endif %}>
+                  <a href="?pid={{ project.id }}">{{ project.name }}</a>
+                </li>
+              {% endfor %}
+              </ul>
+            </li>
+          {% endfor %}
+        </li>
+      {% endfor %}
+      </ul>
+    </div>
+  </div>
+{% endblock %}
+
 {% block breadcrumbs %}
   {{ block.super }}
   <li class="divider">/</li>
diff --git a/src/sentry/templates/sentry/help/platform_index.html b/src/sentry/templates/sentry/help/platform_index.html
index 464cee8c19..a184f12e29 100644
--- a/src/sentry/templates/sentry/help/platform_index.html
+++ b/src/sentry/templates/sentry/help/platform_index.html
@@ -7,10 +7,9 @@
 {% block client_overview_class %}active{% endblock %}
 
 {% block breadcrumbs %}
-{{ block.super }}
-<li class="divider">/</li>
-<li><a href="{% url 'sentry-help-platform-list' %}">{% trans "Clients" %}</a></li>
-
+    {{ block.super }}
+    <li class="divider">/</li>
+    <li><a href="{% url 'sentry-help-platform-list' %}">{% trans "Clients" %}</a></li>
 {% endblock%}
 
 {% block main %}
diff --git a/src/sentry/web/frontend/help_platform_details.py b/src/sentry/web/frontend/help_platform_details.py
index ebe7cba195..0a821ee18a 100644
--- a/src/sentry/web/frontend/help_platform_details.py
+++ b/src/sentry/web/frontend/help_platform_details.py
@@ -1,8 +1,11 @@
 from __future__ import absolute_import
 
+from django.db.models import Q
 from django.http import Http404
+from itertools import groupby
 
 from sentry.constants import PLATFORM_LIST, PLATFORM_TITLES
+from sentry.models import Project, ProjectKey
 from sentry.web.helpers import render_to_response, render_to_string
 from sentry.web.frontend.base import BaseView
 
@@ -10,13 +13,70 @@ from sentry.web.frontend.base import BaseView
 class HelpPlatformDetailsView(BaseView):
     auth_required = False
 
+    def get_project_list(self, user):
+        return list(Project.objects.filter(
+            Q(organization__member_set__has_global_access=True, organization__member_set__user=user)
+            | Q(team__organization__member_set__user=user)
+        ).select_related('team', 'organization').order_by('organization', 'team'))
+
+    def group_project_list(self, project_list):
+        results = []
+        for org, org_project_list in groupby(project_list, key=lambda x: x.organization):
+            org_results = []
+            for team, team_project_list in groupby(org_project_list, key=lambda x: x.team):
+                org_results.append((team, team_project_list))
+            results.append((org, org_results))
+        return results
+
     def get(self, request, platform):
         if platform not in PLATFORM_LIST:
             raise Http404
 
         template = 'sentry/partial/client_config/%s.html' % (platform,)
 
+        if request.user.is_authenticated():
+            project_list = self.get_project_list(request.user)
+        else:
+            project_list = []
+
+        org_results = self.group_project_list(project_list)
+
+        try:
+            pid = int(request.GET.get('pid', request.session.get('pid', 0)))
+        except (TypeError, ValueError):
+            pid = None
+
+        if pid:
+            for project in project_list:
+                if pid == project.id:
+                    selected_project = project
+                    break
+            else:
+                selected_project = None
+        else:
+            selected_project = None
+
+        if selected_project:
+            request.session['pid'] = selected_project.id
+            try:
+                key = ProjectKey.objects.filter(user=None, project=project)[0]
+            except ProjectKey.DoesNotExist:
+                try:
+                    key = ProjectKey.objects.get(user=request.user, project=project)
+                except IndexError:
+                    key = None
+        else:
+            key = None
+
+        if key:
+            dsn_private = key.dsn_private
+            dsn_public = key.dsn_public
+
         context = {
+            'selected_project': selected_project,
+            'org_results': org_results,
+            'dsn': dsn_private,
+            'dsn_public': dsn_public,
             'platform': platform,
             'platform_title': PLATFORM_TITLES.get(platform, platform.title()),
         }
diff --git a/src/sentry/web/frontend/help_platform_index.py b/src/sentry/web/frontend/help_platform_index.py
index 75dc54d12c..2bf050800b 100644
--- a/src/sentry/web/frontend/help_platform_index.py
+++ b/src/sentry/web/frontend/help_platform_index.py
@@ -8,4 +8,12 @@ class HelpPlatformIndexView(BaseView):
     auth_required = False
 
     def get(self, request):
+        try:
+            pid = int(request.GET.get('pid', 0))
+        except (TypeError, ValueError):
+            pid = None
+
+        if pid:
+            request.session['pid'] = pid
+
         return render_to_response('sentry/help/platform_index.html', {}, request)
