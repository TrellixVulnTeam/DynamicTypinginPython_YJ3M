commit 67321b7f5685c2ac42370638caaa992680682547
Author: Ryan Skonnord <ryan.skonnord@sentry.io>
Date:   Tue Jun 9 11:47:30 2020 -0700

    ref(api): Add GroupDetailsEndpoint.get.current_release span (#19229)

diff --git a/src/sentry/api/endpoints/group_details.py b/src/sentry/api/endpoints/group_details.py
index c2fd16f895..418316319f 100644
--- a/src/sentry/api/endpoints/group_details.py
+++ b/src/sentry/api/endpoints/group_details.py
@@ -8,6 +8,8 @@ from uuid import uuid4
 from django.utils import timezone
 from rest_framework.response import Response
 
+import sentry_sdk
+
 from sentry import eventstream, tsdb, tagstore
 from sentry.api import client
 from sentry.api.base import DocSection, EnvironmentMixin
@@ -285,22 +287,25 @@ class GroupDetailsEndpoint(GroupEndpoint, EnvironmentMixin):
             # the current release is the 'latest seen' release within the
             # environment even if it hasnt affected this issue
             if environments:
-                try:
-                    current_release = GroupRelease.objects.filter(
-                        group_id=group.id,
-                        environment__in=[env.name for env in environments],
-                        release_id=ReleaseEnvironment.objects.filter(
-                            release_id__in=ReleaseProject.objects.filter(
-                                project_id=group.project_id
-                            ).values_list("release_id", flat=True),
-                            organization_id=group.project.organization_id,
-                            environment_id__in=environment_ids,
-                        )
-                        .order_by("-first_seen")
-                        .values_list("release_id", flat=True)[:1],
-                    )[0]
-                except IndexError:
-                    current_release = None
+                with sentry_sdk.start_span(op="GroupDetailsEndpoint.get.current_release") as span:
+                    span.set_data("Environment Count", len(environments))
+
+                    try:
+                        current_release = GroupRelease.objects.filter(
+                            group_id=group.id,
+                            environment__in=[env.name for env in environments],
+                            release_id=ReleaseEnvironment.objects.filter(
+                                release_id__in=ReleaseProject.objects.filter(
+                                    project_id=group.project_id
+                                ).values_list("release_id", flat=True),
+                                organization_id=group.project.organization_id,
+                                environment_id__in=environment_ids,
+                            )
+                            .order_by("-first_seen")
+                            .values_list("release_id", flat=True)[:1],
+                        )[0]
+                    except IndexError:
+                        current_release = None
 
                 data.update(
                     {
