commit d52b69d1300469c2f2351e149779df3f923a6920
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Mon Oct 2 17:38:16 2017 -0700

    fix: Be consistent about checking the auth pipeline
    
    We check the pipeline in the auth_provider_login (SSO endpoint), but we
    don't check during SSO configuration and the SSO login action (clicking
    the login button and any associated flow).

diff --git a/src/sentry/web/frontend/auth_organization_login.py b/src/sentry/web/frontend/auth_organization_login.py
index ca1bab4487..9d52ea3c45 100644
--- a/src/sentry/web/frontend/auth_organization_login.py
+++ b/src/sentry/web/frontend/auth_organization_login.py
@@ -88,6 +88,9 @@ class AuthOrganizationLoginView(BaseView):
             if request.POST.get('init'):
                 helper.init_pipeline()
 
+            if not helper.pipeline_is_valid():
+                return helper.error('Something unexpected happened during authentication.')
+
             return helper.current_step()
 
         provider = auth_provider.get_provider()
diff --git a/src/sentry/web/frontend/organization_auth_settings.py b/src/sentry/web/frontend/organization_auth_settings.py
index e087f18af3..58e391a84a 100644
--- a/src/sentry/web/frontend/organization_auth_settings.py
+++ b/src/sentry/web/frontend/organization_auth_settings.py
@@ -188,6 +188,9 @@ class OrganizationAuthSettingsView(OrganizationView):
             if request.POST.get('init'):
                 helper.init_pipeline()
 
+            if not helper.pipeline_is_valid():
+                return helper.error('Something unexpected happened during authentication.')
+
             # render first time setup view
             return helper.current_step()
 
