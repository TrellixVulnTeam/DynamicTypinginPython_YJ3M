commit fc1d445119f7b63f2d2459a4404bc70f40e1029f
Author: Ben Vinegar <ben@benv.ca>
Date:   Wed May 25 11:51:37 2016 -0700

    Make is_user_subscribed_to_mail_alerts a method on sentry.models.Project

diff --git a/src/sentry/models/project.py b/src/sentry/models/project.py
index 3ba9b88358..7f5a1bdba5 100644
--- a/src/sentry/models/project.py
+++ b/src/sentry/models/project.py
@@ -256,3 +256,14 @@ class Project(Model):
         if self.team.name not in self.name:
             return '%s %s' % (self.team.name, self.name)
         return self.name
+
+    def is_user_subscribed_to_mail_alerts(self, user):
+        from sentry.models import UserOption
+        is_enabled = UserOption.objects.get_value(
+            user, self, 'mail:alert', None)
+        if is_enabled is None:
+            is_enabled = UserOption.objects.get_value(
+                user, None, 'subscribe_by_default', '1') == '1'
+        else:
+            is_enabled = bool(is_enabled)
+        return is_enabled
diff --git a/src/sentry/models/useroption.py b/src/sentry/models/useroption.py
index de3119276e..423bb13e3d 100644
--- a/src/sentry/models/useroption.py
+++ b/src/sentry/models/useroption.py
@@ -119,14 +119,3 @@ class UserOption(Model):
         unique_together = (('user', 'project', 'key',),)
 
     __repr__ = sane_repr('user_id', 'project_id', 'key', 'value')
-
-    @classmethod
-    def is_user_subscribed_to_mail_alerts(cls, user, project):
-        is_enabled = cls.objects.get_value(
-            user, project, 'mail:alert', None)
-        if is_enabled is None:
-            is_enabled = cls.objects.get_value(
-                user, None, 'subscribe_by_default', '1') == '1'
-        else:
-            is_enabled = bool(is_enabled)
-        return is_enabled
diff --git a/src/sentry/web/forms/accounts.py b/src/sentry/web/forms/accounts.py
index d3e0280fb0..2bd56254be 100644
--- a/src/sentry/web/forms/accounts.py
+++ b/src/sentry/web/forms/accounts.py
@@ -388,7 +388,7 @@ class ProjectEmailOptionsForm(forms.Form):
 
         super(ProjectEmailOptionsForm, self).__init__(*args, **kwargs)
 
-        is_enabled = UserOption.is_user_subscribed_to_mail_alerts(user, project)
+        is_enabled = project.is_user_subscribed_to_mail_alerts(user)
 
         self.fields['alert'].initial = is_enabled
         self.fields['email'].initial = UserOption.objects.get_value(
diff --git a/src/sentry/web/frontend/project_notifications.py b/src/sentry/web/frontend/project_notifications.py
index 03fe08e79f..cf4138f85c 100644
--- a/src/sentry/web/frontend/project_notifications.py
+++ b/src/sentry/web/frontend/project_notifications.py
@@ -8,7 +8,6 @@ from django.utils.translation import ugettext_lazy as _
 from sentry import constants
 from sentry import options
 from sentry.app import digests
-from sentry.models import UserOption
 from sentry.digests import get_option_key as get_digest_option_key
 from sentry.plugins import plugins, NotificationPlugin
 from sentry.web.forms.projects import (
@@ -140,7 +139,7 @@ class ProjectNotificationsView(ProjectView):
             elif plugin.can_configure_for_project(project):
                 other_plugins.append(plugin)
 
-        is_user_subbed = UserOption.is_user_subscribed_to_mail_alerts(request.user, project)
+        is_user_subbed = project.is_user_subscribed_to_mail_alerts(request.user)
 
         context = {
             'page': 'notifications',
