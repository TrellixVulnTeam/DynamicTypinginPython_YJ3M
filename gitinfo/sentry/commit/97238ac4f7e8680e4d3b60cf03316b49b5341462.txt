commit 97238ac4f7e8680e4d3b60cf03316b49b5341462
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 23 20:13:50 2012 -0800

    Updated default EMAIL_SUBJECT_PREFIX and added SentryMiddleware in so we can auto detect URL_PREFIX

diff --git a/sentry/conf/defaults.py b/sentry/conf/defaults.py
index f926b50748..88cda30606 100644
--- a/sentry/conf/defaults.py
+++ b/sentry/conf/defaults.py
@@ -43,7 +43,7 @@ URL_PREFIX = ''
 # Allow access to Sentry without authentication.
 PUBLIC = False
 
-EMAIL_SUBJECT_PREFIX = ''
+EMAIL_SUBJECT_PREFIX = '[Sentry] '
 
 INTERNAL_IPS = set()
 
diff --git a/sentry/conf/server.py b/sentry/conf/server.py
index b60892f568..01347d4fde 100644
--- a/sentry/conf/server.py
+++ b/sentry/conf/server.py
@@ -82,6 +82,7 @@ MIDDLEWARE_CLASSES = (
     'django.contrib.sessions.middleware.SessionMiddleware',
     'django.middleware.csrf.CsrfViewMiddleware',
     'django.contrib.auth.middleware.AuthenticationMiddleware',
+    'sentry.middleware.SentryMiddleware',
     # 'django.contrib.messages.middleware.MessageMiddleware',
 )
 
@@ -119,6 +120,8 @@ ADMIN_MEDIA_PREFIX = '/_admin_media/'
 SENTRY_PUBLIC = True
 SENTRY_PROJECT = 1
 
+EMAIL_SUBJECT_PREFIX = '[Sentry] '
+
 # Configure logging
 from raven.conf import setup_logging
 from raven.contrib.django.handlers import SentryHandler
diff --git a/sentry/middleware.py b/sentry/middleware.py
index a02ab030b0..5aff446dfc 100644
--- a/sentry/middleware.py
+++ b/sentry/middleware.py
@@ -1,3 +1,11 @@
+from sentry.conf import settings
+from django.core.urlresolvers import reverse
+
+
 class SentryMiddleware(object):
-    # DEPRECATED
-    pass
+    def process_request(self, request):
+        # HACK: bootstrap some env crud if we havent yet
+        if not settings.URL_PREFIX:
+            settings.URL_PREFIX = request.build_absolute_uri(reverse('sentry')).strip('/')
+
+
