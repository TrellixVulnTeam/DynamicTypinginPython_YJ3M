commit 5876a5e984803af69ad6f085ba4489618a3bad4f
Author: Ted Kaemming <ted@kaemming.com>
Date:   Mon Nov 16 18:44:04 2015 -0800

    Add dateline to digest emails.

diff --git a/src/sentry/digests/utilities.py b/src/sentry/digests/utilities.py
new file mode 100644
index 0000000000..dc53b01b46
--- /dev/null
+++ b/src/sentry/digests/utilities.py
@@ -0,0 +1,21 @@
+from collections import Counter
+
+
+# TODO(tkaemming): This should probably just be part of `build_digest`.t
+def get_digest_metadata(digest):
+    start = None
+    end = None
+
+    counts = Counter()
+    for rule, groups in digest.iteritems():
+        counts.update(groups.keys())
+
+        for group, records in groups.iteritems():
+            for record in records:
+                if start is None or record.datetime < start:
+                    start = record.datetime
+
+                if end is None or record.datetime > end:
+                    end = record.datetime
+
+    return start, end, counts
diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index 3c402fd1b7..6644c1e6b8 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -8,7 +8,6 @@ sentry.plugins.sentry_mail.models
 from __future__ import absolute_import
 
 import itertools
-from collections import Counter
 
 import sentry
 
@@ -19,6 +18,7 @@ from django.utils.encoding import force_text
 from django.utils.safestring import mark_safe
 
 from sentry import features
+from sentry.digests.utilities import get_digest_metadata
 from sentry.plugins import register
 from sentry.plugins.base.structs import Notification
 from sentry.plugins.bases.notify import NotificationPlugin
@@ -179,9 +179,7 @@ class MailPlugin(NotificationPlugin):
         )
 
     def notify_digest(self, project, digest):
-        counts = Counter()
-        for rule, groups in digest.iteritems():
-            counts.update(groups.keys())
+        start, end, counts = get_digest_metadata(digest)
 
         # If there is only one group in this digest (regardless of how many
         # rules it appears in), we should just render this using the single
@@ -201,6 +199,8 @@ class MailPlugin(NotificationPlugin):
                 return self.notify(notification)
 
         context = {
+            'start': start,
+            'end': end,
             'project': project,
             'digest': digest,
             'counts': counts,
diff --git a/src/sentry/templates/sentry/emails/digests/body.html b/src/sentry/templates/sentry/emails/digests/body.html
index e961337a6a..d57646ec60 100644
--- a/src/sentry/templates/sentry/emails/digests/body.html
+++ b/src/sentry/templates/sentry/emails/digests/body.html
@@ -7,7 +7,8 @@
 {% block content %}
 
 <div class="container" style="padding-top: 30px;">
-  <h2 style="margin-bottom: 30px">{{ counts|length }} new notification{{ counts|pluralize }} from <a href="{{ project.get_absolute_url }}">{{ project.name }}</a></h2>
+  <h2>{{ counts|length }} new notification{{ counts|pluralize }} from <a href="{{ project.get_absolute_url }}">{{ project.name }}</a></h2>
+  <div class="dateline">{{ start|date:"N j, Y, P e" }} to {{ end|date:"N j, Y, P e" }}</div>
 </div>
 
 {% for rule, groups in digest.iteritems %}
diff --git a/src/sentry/templates/sentry/emails/digests/body.txt b/src/sentry/templates/sentry/emails/digests/body.txt
index 97e4da1f45..cfb926169a 100644
--- a/src/sentry/templates/sentry/emails/digests/body.txt
+++ b/src/sentry/templates/sentry/emails/digests/body.txt
@@ -1,4 +1,5 @@
 {% load sentry_helpers %}Notifications for {{ project.name }}
+{{ start|date:"N j, Y, P e" }} to {{ end|date:"N j, Y, P e" }}
 
 {% for rule, groups in digest.iteritems %}{{ rule.label }}
 
diff --git a/src/sentry/templates/sentry/emails/digests/subject.txt b/src/sentry/templates/sentry/emails/digests/subject.txt
index 3e3ed92191..6e9296760c 100644
--- a/src/sentry/templates/sentry/emails/digests/subject.txt
+++ b/src/sentry/templates/sentry/emails/digests/subject.txt
@@ -1 +1 @@
-[{{ project.name }}] {{ counts|length }} notification{{ counts|pluralize }}
+[{{ project.name }}] {{ counts|length }} notification{{ counts|pluralize }} since {{ start|date:"N j, Y, P e" }}
diff --git a/src/sentry/templates/sentry/emails/email-styles.html b/src/sentry/templates/sentry/emails/email-styles.html
index 6f03f18a37..e7e2c62b6f 100644
--- a/src/sentry/templates/sentry/emails/email-styles.html
+++ b/src/sentry/templates/sentry/emails/email-styles.html
@@ -403,6 +403,16 @@
     padding-top: 0;
   }
 
+  .digest h2 {
+    margin-bottom: 10px;
+  }
+
+  .digest .dateline {
+    color: #687276;
+    font-size: 16px;
+    margin-bottom: 30px;
+  }
+
   .digest .rule {
     background: #F6F7F8;
     padding: 8px;
diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index d6c76076bb..a80497fcba 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -5,7 +5,6 @@ import logging
 import time
 import traceback
 import uuid
-from collections import Counter
 from datetime import (
     datetime,
     timedelta,
@@ -27,6 +26,7 @@ from sentry.digests.notifications import (
     Notification,
     build_digest,
 )
+from sentry.digests.utilities import get_digest_metadata
 from sentry.models import (
     Activity,
     Event,
@@ -326,11 +326,7 @@ def digest(request):
             state['user_counts'][group_id] = random.randint(10, 1e4)
 
     digest = build_digest(project, records, state)
-
-    # TODO(tkaemming): This duplication from ``MailPlugin.notify_digest`` is a code smell
-    counts = Counter()
-    for rule, groups in digest.iteritems():
-        counts.update(groups.keys())
+    start, end, counts = get_digest_metadata(digest)
 
     return MailPreview(
         html_template='sentry/emails/digests/body.html',
@@ -339,6 +335,8 @@ def digest(request):
             'project': project,
             'counts': counts,
             'digest': digest,
+            'start': start,
+            'end': end,
         },
     ).render()
 
