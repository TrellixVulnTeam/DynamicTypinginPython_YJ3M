commit e4728680357156bd33be48f16c730cfdb78f2874
Author: ted kaemming <ted@kaemming.com>
Date:   Thu Mar 8 13:02:52 2018 -0800

    fix(rules): Correct presence check for environment in `RuleSerializer` (#7526)

diff --git a/src/sentry/api/serializers/rest_framework/rule.py b/src/sentry/api/serializers/rest_framework/rule.py
index 8787875967..1ec5e7d484 100644
--- a/src/sentry/api/serializers/rest_framework/rule.py
+++ b/src/sentry/api/serializers/rest_framework/rule.py
@@ -87,7 +87,7 @@ class RuleSerializer(serializers.Serializer):
 
     def save(self, rule):
         rule.project = self.context['project']
-        if self.data.get('environment'):
+        if 'environment' in self.data:
             rule.environment_id = self.data['environment']
         if self.data.get('name'):
             rule.label = self.data['name']
diff --git a/tests/sentry/api/endpoints/test_project_rule_details.py b/tests/sentry/api/endpoints/test_project_rule_details.py
index c2b731fac3..700564eda6 100644
--- a/tests/sentry/api/endpoints/test_project_rule_details.py
+++ b/tests/sentry/api/endpoints/test_project_rule_details.py
@@ -186,7 +186,14 @@ class UpdateProjectRuleTest(APITestCase):
 
         project = self.create_project()
 
-        rule = Rule.objects.create(project=project, label='foo')
+        rule = Rule.objects.create(
+            project=project,
+            environment_id=Environment.get_or_create(
+                project,
+                'production',
+            ).id,
+            label='foo',
+        )
 
         url = reverse(
             'sentry-api-0-project-rule-details',
