commit a465319322830eb7e858ca6db94581cc58b9adee
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Mon Feb 25 16:22:36 2019 -0800

    feat: Tag name autocomplete for negation operators (#12201)
    
    Allow tag names to be autocompleted when the negation operator is used.
    This applies to the issue and event streams.

diff --git a/src/sentry/static/sentry/app/components/smartSearchBar.jsx b/src/sentry/static/sentry/app/components/smartSearchBar.jsx
index b8f722c4d9..f9b697f3f4 100644
--- a/src/sentry/static/sentry/app/components/smartSearchBar.jsx
+++ b/src/sentry/static/sentry/app/components/smartSearchBar.jsx
@@ -301,7 +301,8 @@ class SmartSearchBar extends React.Component {
 
     if (index === -1) {
       // No colon present; must still be deciding key
-      matchValue = last;
+      matchValue = last.replace(new RegExp(`^${NEGATION_OPERATOR}`), '');
+
       autoCompleteItems = this.getTagKeys(matchValue);
 
       this.setState({searchTerm: matchValue});
diff --git a/tests/js/spec/components/smartSearchBar.spec.jsx b/tests/js/spec/components/smartSearchBar.spec.jsx
index ddea341c36..bced4dbd34 100644
--- a/tests/js/spec/components/smartSearchBar.spec.jsx
+++ b/tests/js/spec/components/smartSearchBar.spec.jsx
@@ -314,6 +314,20 @@ describe('SmartSearchBar', function() {
       expect(searchBar.state.activeSearchItem).toEqual(0);
     });
 
+    it('sets state when incomplete tag has negation operator', function() {
+      const props = {
+        orgId: '123',
+        projectId: '456',
+        query: '!fu',
+        supportedTags,
+      };
+      const searchBar = mount(<SmartSearchBar {...props} />, options).instance();
+      searchBar.updateAutoCompleteItems();
+      expect(searchBar.state.searchTerm).toEqual('fu');
+      expect(searchBar.state.searchItems).toEqual([]);
+      expect(searchBar.state.activeSearchItem).toEqual(0);
+    });
+
     it('sets state when incomplete tag as second input', function() {
       const props = {
         orgId: '123',
