commit d435d1bdc26afd4e7d8189bfa2456a4c9b37761e
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jul 2 12:12:25 2015 -0700

    Support local http connections (fixes local sourcemaps in dev)

diff --git a/src/sentry/http.py b/src/sentry/http.py
index 0cd0e8650d..9682766816 100644
--- a/src/sentry/http.py
+++ b/src/sentry/http.py
@@ -28,6 +28,12 @@ USER_AGENT = 'sentry/{version} (https://getsentry.com)'.format(
 DISALLOWED_IPS = set((IPNetwork(i) for i in settings.SENTRY_DISALLOWED_IPS))
 
 
+def get_server_hostname():
+    # TODO(dcramer): Ideally this would parse at runtime, but we currently
+    # change the URL prefix when runner initializes which may be post-import
+    return urlparse(settings.SENTRY_URL_PREFIX).hostname
+
+
 def is_valid_url(url):
     """
     Tests a URL to ensure it doesn't appear to be a blacklisted IP range.
@@ -36,11 +42,19 @@ def is_valid_url(url):
     if not parsed.hostname:
         return False
 
+    server_hostname = get_server_hostname()
+
+    if parsed.hostname == server_hostname:
+        return True
+
     try:
         ip_address = socket.gethostbyname(parsed.hostname)
     except socket.gaierror:
         return False
 
+    if ip_address == server_hostname:
+        return True
+
     ip_network = IPNetwork(ip_address)
     for addr in DISALLOWED_IPS:
         if ip_network in addr:
