commit 13c747cc6a3b28098a4a3e16079cbd7c0d3af9b9
Author: Jess MacQueen <jess@getsentry.com>
Date:   Wed Jul 5 16:08:38 2017 -0700

    add a test to project_group_index

diff --git a/tests/sentry/api/endpoints/test_project_group_index.py b/tests/sentry/api/endpoints/test_project_group_index.py
index 4c10bcffe7..528524b072 100644
--- a/tests/sentry/api/endpoints/test_project_group_index.py
+++ b/tests/sentry/api/endpoints/test_project_group_index.py
@@ -1177,6 +1177,42 @@ class GroupUpdateTest(APITestCase):
 
         assert response.status_code == 400, response.content
 
+    def test_discard(self):
+        group1 = self.create_group(checksum='a' * 32, is_public=True)
+        group2 = self.create_group(checksum='b' * 32, is_public=True)
+        group_hash = GroupHash.objects.create(
+            hash='x' * 32,
+            project=group1.project,
+            group=group1,
+        )
+        user = self.user
+
+        self.login_as(user=user)
+        url = '{url}?id={group1.id}'.format(
+            url=self.path,
+            group1=group1,
+        )
+        with self.tasks():
+            response = self.client.put(url, data={
+                'discard': True,
+            })
+
+        assert response.status_code == 204
+        assert not Group.objects.filter(
+            id=group1.id,
+        ).exists()
+        assert Group.objects.filter(
+            id=group2.id,
+        ).exists()
+        assert GroupHash.objects.filter(
+            id=group_hash.id,
+        ).exists()
+        tombstone = GroupHash.objects.get(id=group_hash.id).group_tombstone
+        assert tombstone.message == group1.message
+        assert tombstone.culprit == group1.culprit
+        assert tombstone.project == group1.project
+        assert tombstone.type == group1.get_event_type()
+
 
 class GroupDeleteTest(APITestCase):
     @fixture
