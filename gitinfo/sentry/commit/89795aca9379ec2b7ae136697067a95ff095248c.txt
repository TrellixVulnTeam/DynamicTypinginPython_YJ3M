commit 89795aca9379ec2b7ae136697067a95ff095248c
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Mar 27 15:11:30 2012 -0700

    Django 1.4 compatibility

diff --git a/.travis.yml b/.travis.yml
index 6147f545b9..49aa966351 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -5,6 +5,7 @@ python:
 env:
   - DJANGO=1.2.7
   - DJANGO=1.3.1
+  - DJANGO=1.4
 install:
   - pip install -q Django==$DJANGO --use-mirrors
   - pip install -q -e . --use-mirrors
diff --git a/runtests.py b/runtests.py
index b44bb35c01..48d18de0ba 100644
--- a/runtests.py
+++ b/runtests.py
@@ -44,4 +44,4 @@ if __name__ == '__main__':
     parser.add_options(NoseTestSuiteRunner.options)
     (options, args) = parser.parse_args()
 
-    runtests(*args, **options.__dict__)
+    runtests(noinput=True, *args, **options.__dict__)
diff --git a/setup.py b/setup.py
index e94240edb2..87e9efd310 100755
--- a/setup.py
+++ b/setup.py
@@ -35,7 +35,7 @@ install_requires = [
     'cssutils>=0.9.9',
     'BeautifulSoup>=3.2.1',
     'django-celery>=2.5.0,<3.0',
-    'Django>=1.2,<1.4',
+    'Django>=1.2,<1.5',
     'django-indexer>=0.3.0',
     'django-paging>=0.2.4',
     'django-picklefield>=0.2.0',
diff --git a/tests/sentry/plugins/mail/tests.py b/tests/sentry/plugins/mail/tests.py
index cd2067cf45..a2461ad403 100644
--- a/tests/sentry/plugins/mail/tests.py
+++ b/tests/sentry/plugins/mail/tests.py
@@ -56,14 +56,18 @@ class MailProcessorTest(TestCase):
 
     @mock.patch('sentry.plugins.sentry_mail.MailProcessor._send_mail')
     def test_notify_users_renders_interfaces(self, _send_mail):
-        group = Mock(spec=Group)
+        group = Group()
         group.first_seen = datetime.datetime.now()
-        group.project_id = 1
+        group.last_seen = group.first_seen
         group.id = 2
+        group.project_id = 1
+
         stacktrace = Mock(spec=Stacktrace)
         stacktrace.to_string.return_value = 'foo bar'
         stacktrace.get_title.return_value = 'Stacktrace'
+
         event = Event()
+        event.group = group
         event.message = 'hello world'
         event.logger = 'root'
         event.site = None
@@ -78,14 +82,18 @@ class MailProcessorTest(TestCase):
 
     @mock.patch('sentry.plugins.sentry_mail.MailProcessor._send_mail')
     def test_notify_users_renders_interfaces_with_utf8(self, _send_mail):
-        group = Mock(spec=Group)
+        group = Group()
         group.first_seen = datetime.datetime.now()
-        group.project_id = 1
+        group.last_seen = group.first_seen
         group.id = 2
+        group.project_id = 1
+
         stacktrace = Mock(spec=Stacktrace)
         stacktrace.to_string.return_value = u'רונית מגן'
         stacktrace.get_title.return_value = 'Stacktrace'
+
         event = Event()
+        event.group = group
         event.message = 'hello world'
         event.logger = 'root'
         event.site = None
@@ -102,18 +110,18 @@ class MailProcessorTest(TestCase):
     def test_notify_users_does_email(self, _send_mail):
         project = Project(id=1, name='Project Name')
 
-        group = Mock(spec=Group)
+        group = Group()
         group.first_seen = datetime.datetime.now()
-        group.project_id = project.id
+        group.last_seen = group.first_seen
         group.project = project
         group.id = 2
 
         event = Event()
+        event.group = group
         event.message = 'hello world'
         event.logger = 'root'
-        event.site = None
-        event.project_id = project.id
         event.project = project
+        event.date = group.last_seen
 
         with self.Settings(SENTRY_URL_PREFIX='http://example.com'):
             p = MailProcessor(send_to=['foo@example.com'])
@@ -129,18 +137,18 @@ class MailProcessorTest(TestCase):
     def test_multiline_error(self, _send_mail):
         project = Project(id=1, name='Project Name')
 
-        group = Mock(spec=Group)
+        group = Group()
         group.first_seen = datetime.datetime.now()
-        group.project_id = project.id
+        group.last_seen = group.first_seen
         group.project = project
         group.id = 2
 
         event = Event()
+        event.group = group
         event.message = 'hello world\nfoo bar'
         event.logger = 'root'
-        event.site = None
-        event.project_id = project.id
         event.project = project
+        event.date = group.last_seen
 
         with self.Settings(SENTRY_URL_PREFIX='http://example.com'):
             p = MailProcessor(send_to=['foo@example.com'])
