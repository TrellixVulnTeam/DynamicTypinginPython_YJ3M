commit 9ff7fd6d710323c964d00847f2793ce6549c55fc
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Dec 11 14:13:07 2018 -0800

    ref: Provide a generic sentry.net.http:connection_from_url
    
    This removes it from being snuba specific into a utility that can be
    reused.

diff --git a/src/sentry/net/http.py b/src/sentry/net/http.py
index 012eeef19b..815b70c36f 100644
--- a/src/sentry/net/http.py
+++ b/src/sentry/net/http.py
@@ -5,7 +5,7 @@ from socket import error as SocketError, timeout as SocketTimeout
 
 from requests import Session as _Session
 from requests.adapters import HTTPAdapter, DEFAULT_POOLBLOCK
-from urllib3.connectionpool import HTTPConnectionPool, HTTPSConnectionPool
+from urllib3.connectionpool import HTTPConnectionPool, HTTPSConnectionPool, connection_from_url as _connection_from_url
 from urllib3.connection import HTTPConnection, HTTPSConnection
 from urllib3.exceptions import NewConnectionError, ConnectTimeoutError
 from urllib3.poolmanager import PoolManager
@@ -199,3 +199,9 @@ class UnixHTTPConnectionPool(HTTPConnectionPool):
     def __str__(self):
         return '%s(host=%r)' % (type(self).__name__,
                                 self.host)
+
+
+def connection_from_url(endpoint, **kw):
+    if endpoint[:1] == '/':
+        return UnixHTTPConnectionPool(endpoint, **kw)
+    return _connection_from_url(endpoint, **kw)
diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 10f45d6290..6c0fd529fe 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -18,6 +18,7 @@ from sentry.models import (
     Environment, Group, GroupRelease,
     Organization, Project, Release, ReleaseProject
 )
+from sentry.net.http import connection_from_url
 from sentry.utils import metrics, json
 from sentry.utils.dates import to_timestamp
 
@@ -193,13 +194,6 @@ def options_override(overrides):
             OVERRIDE_OPTIONS.pop(k)
 
 
-def connection_from_url(url, **kw):
-    if url[:1] == '/':
-        from sentry.net.http import UnixHTTPConnectionPool
-        return UnixHTTPConnectionPool(url, **kw)
-    return urllib3.connectionpool.connection_from_url(url, **kw)
-
-
 _snuba_pool = connection_from_url(
     settings.SENTRY_SNUBA,
     retries=False,
