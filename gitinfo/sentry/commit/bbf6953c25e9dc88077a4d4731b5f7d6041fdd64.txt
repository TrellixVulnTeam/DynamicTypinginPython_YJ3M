commit bbf6953c25e9dc88077a4d4731b5f7d6041fdd64
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu May 10 08:12:03 2018 -0700

    feat(dashboard): Add "Join a Team" to empty dash state (#8371)
    
    * Disable "Create a Project" if no permission to create projects

diff --git a/src/sentry/static/sentry/app/views/organizationDashboard/emptyState.jsx b/src/sentry/static/sentry/app/views/organizationDashboard/emptyState.jsx
index 694dea6d52..63c13838a0 100644
--- a/src/sentry/static/sentry/app/views/organizationDashboard/emptyState.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDashboard/emptyState.jsx
@@ -1,31 +1,61 @@
 import React from 'react';
-import PropTypes from 'prop-types';
 import {Flex} from 'grid-emotion';
 import styled from 'react-emotion';
 
-import {t} from '../../locale';
+import {t} from 'app/locale';
+import Button from 'app/components/buttons/button';
+import Tooltip from 'app/components/tooltip';
+import SentryTypes from 'app/proptypes';
 import img from '../../../images/dashboard/hair-on-fire.svg';
-import Button from '../../components/buttons/button';
 
 export default class EmptyState extends React.Component {
   static propTypes = {
-    orgId: PropTypes.string,
+    organization: SentryTypes.Organization,
   };
 
   render() {
-    const {orgId} = this.props;
+    const {organization} = this.props;
+    const orgId = organization.slug;
+    const canCreateProject = organization.access.includes('project:write');
+    const canJoinTeam = organization.access.includes('team:read');
+
     return (
       <Flex flex="1" align="center" justify="center">
         <Wrapper>
           <img src={img} height={350} alt="Nothing to see" />
           <Content direction="column" justify="center">
             <h2>{t('Remain calm.')}</h2>
-            <p>{t("Sentry's got you covered.")}</p>
-            <div>
-              <Button priority="primary" to={`/organizations/${orgId}/projects/new/`}>
-                {t('Create project')}
-              </Button>
-            </div>
+            <p>{t("Sentry's got you covered. To get started:")}</p>
+            <Flex align="center">
+              <CallToAction>
+                <Tooltip
+                  disabled={canJoinTeam}
+                  title={t('You do not have permission to join a team.')}
+                >
+                  <Button
+                    disabled={!canJoinTeam}
+                    priority="primary"
+                    to={`/settings/${orgId}/teams/`}
+                  >
+                    {t('Join a Team')}
+                  </Button>
+                </Tooltip>
+              </CallToAction>
+
+              <CallToAction>
+                <Tooltip
+                  disabled={canCreateProject}
+                  title={t('You do not have permission to create a project.')}
+                >
+                  <Button
+                    disabled={!canCreateProject}
+                    to={`/organizations/${orgId}/projects/new/`}
+                  >
+                    {t('Create project')}
+                  </Button>
+                </Tooltip>
+              </CallToAction>
+            </Flex>
           </Content>
         </Wrapper>
       </Flex>
@@ -33,6 +63,13 @@ export default class EmptyState extends React.Component {
   }
 }
 
+const CallToAction = styled('div')`
+  margin-right: 8px;
+  &:last-child {
+    margin-right: 0;
+  }
+`;
+
 const Wrapper = styled(Flex)`
   height: 350px;
 `;
diff --git a/src/sentry/static/sentry/app/views/organizationDashboard/index.jsx b/src/sentry/static/sentry/app/views/organizationDashboard/index.jsx
index 52c5ac6eb2..244e5f4b65 100644
--- a/src/sentry/static/sentry/app/views/organizationDashboard/index.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDashboard/index.jsx
@@ -119,7 +119,9 @@ class Dashboard extends AsyncComponent {
             </TeamSection>
           );
         })}
-        {!teamSlugs.length && <EmptyState orgId={params.orgId} />}
+        {!teamSlugs.length && (
+          <EmptyState projects={projects} teams={teams} organization={organization} />
+        )}
       </React.Fragment>
     );
   }
diff --git a/tests/js/spec/views/organizationDashboard/emptyState.spec.jsx b/tests/js/spec/views/organizationDashboard/emptyState.spec.jsx
new file mode 100644
index 0000000000..586f4adccd
--- /dev/null
+++ b/tests/js/spec/views/organizationDashboard/emptyState.spec.jsx
@@ -0,0 +1,45 @@
+import React from 'react';
+import {shallow} from 'enzyme';
+
+import EmptyState from 'app/views/organizationDashboard/emptyState';
+
+describe('EmptyState', function() {
+  const org = TestStubs.Organization();
+  it('shows "Create Project" button when there are no projects', function() {
+    let wrapper = shallow(
+      <EmptyState organization={org} projects={[]} />,
+      TestStubs.routerContext()
+    );
+    expect(
+      wrapper.find('Button[to="/organizations/org-slug/projects/new/"]')
+    ).toHaveLength(1);
+  });
+
+  it('"Create Project" is disabled when no access to `project:write`', function() {
+    let wrapper = shallow(
+      <EmptyState organization={TestStubs.Organization({access: []})} projects={[]} />,
+      TestStubs.routerContext()
+    );
+    expect(
+      wrapper.find('Button[to="/organizations/org-slug/projects/new/"]').prop('disabled')
+    ).toBe(true);
+  });
+
+  it('has "Join a Team" button', function() {
+    let wrapper = shallow(
+      <EmptyState organization={org} projects={[]} />,
+      TestStubs.routerContext()
+    );
+    expect(wrapper.find('Button[to="/settings/org-slug/teams/"]')).toHaveLength(1);
+  });
+
+  it('has a disabled "Join a Team" button if no access to `team:read`', function() {
+    let wrapper = shallow(
+      <EmptyState organization={TestStubs.Organization({access: []})} projects={[]} />,
+      TestStubs.routerContext()
+    );
+    expect(wrapper.find('Button[to="/settings/org-slug/teams/"]').prop('disabled')).toBe(
+      true
+    );
+  });
+});
