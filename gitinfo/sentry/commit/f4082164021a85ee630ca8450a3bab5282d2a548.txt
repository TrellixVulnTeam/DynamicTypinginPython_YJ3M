commit f4082164021a85ee630ca8450a3bab5282d2a548
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Feb 6 18:10:29 2019 -0800

    feat(email): Update project and tag links in alert email for Sentry 10 (#11937)

diff --git a/src/sentry/models/project.py b/src/sentry/models/project.py
index eadf3e1ca6..90ee3dda74 100644
--- a/src/sentry/models/project.py
+++ b/src/sentry/models/project.py
@@ -19,6 +19,7 @@ from django.conf import settings
 from django.db import IntegrityError, models, transaction
 from django.utils import timezone
 from django.utils.translation import ugettext_lazy as _
+from django.utils.http import urlencode
 from uuid import uuid1
 
 from sentry.app import locks
@@ -146,13 +147,18 @@ class Project(Model):
             super(Project, self).save(*args, **kwargs)
         self.update_rev_for_option()
 
-    def get_absolute_url(self):
+    def get_absolute_url(self, params=None):
         from sentry import features
         if features.has('organizations:sentry10', self.organization):
-            return absolute_uri(
-                u'/organizations/{}/issues/?project={}'.format(self.organization.slug, self.id))
+            url = u'/organizations/{}/issues/'.format(self.organization.slug)
+            params = {} if params is None else params
+            params['project'] = self.id
         else:
-            return absolute_uri(u'/{}/{}/'.format(self.organization.slug, self.slug))
+            url = u'/{}/{}/'.format(self.organization.slug, self.slug)
+
+        if params:
+            url = url + '?' + urlencode(params)
+        return absolute_uri(url)
 
     def is_internal_project(self):
         for value in (settings.SENTRY_FRONTEND_PROJECT, settings.SENTRY_PROJECT):
diff --git a/src/sentry/templates/sentry/emails/_group_link.html b/src/sentry/templates/sentry/emails/_group_link.html
index 06a7c3b009..3762400246 100644
--- a/src/sentry/templates/sentry/emails/_group_link.html
+++ b/src/sentry/templates/sentry/emails/_group_link.html
@@ -4,7 +4,6 @@
 {% url_with_referrer 'sentry-group' group.organization.slug group.project.slug group.id as old_group_link %}
 {% url_with_referrer 'sentry-organization-issue' group.organization.slug group.id as new_group_link %}
 
-{% load sentry_features %}
 {% feature organizations:sentry10 group.organization %}
     <a href="{% absolute_uri new_group_link %}">{{text}}</a>
 {% else %}
diff --git a/src/sentry/templates/sentry/emails/error.html b/src/sentry/templates/sentry/emails/error.html
index 46dd347e98..21220ba3ed 100644
--- a/src/sentry/templates/sentry/emails/error.html
+++ b/src/sentry/templates/sentry/emails/error.html
@@ -2,6 +2,7 @@
 
 {% load sentry_avatars %}
 {% load sentry_helpers %}
+{% load sentry_features %}
 {% load i18n %}
 
 {% block preheader %}
@@ -15,7 +16,7 @@
 
 {% block main %}
     <h2 style="margin-bottom: 15px">
-        New alert from <a href="{% absolute_uri '/{}/{}/' group.project.organization.slug group.project.slug %}">{{ project_label }}</a>
+        New alert from <a href="{{group.project.get_absolute_url}}">{{ project_label }}</a>
         {% if environment %} in {{ environment }}{% endif %}
     </h2>
 
@@ -129,7 +130,11 @@
               <em>=</em>
               <span>
               {% with query=tag_key|add:":\""|add:tag_value|add:"\""|urlencode %}
-                <a href="{% absolute_uri '/{}/{}/' group.project.organization.slug group.project.slug %}?query={{ query }}">{{ tag_value|truncatechars:50 }}</a> {% if tag_value|is_url %}<a href="{{ tag_value }}" class="icon-share"></a>{% endif %}
+              {% feature organizations:sentry10 group.project.organization %}
+                  <a href="{% absolute_uri '/organizations/{}/issues/' group.project.organization.slug %}?project={{ group.project.id }}&query={{ query }}">{{ tag_value|truncatechars:50 }}</a> {% if tag_value|is_url %}<a href="{{ tag_value }}" class="icon-share"></a>{% endif %}
+              {% else %}
+                  <a href="{% absolute_uri '/{}/{}/' group.project.organization.slug group.project.slug %}?query={{ query }}">{{ tag_value|truncatechars:50 }}</a> {% if tag_value|is_url %}<a href="{{ tag_value }}" class="icon-share"></a>{% endif %}
+              {% endfeature %}
               {% endwith %}
               </span>
           </li>
