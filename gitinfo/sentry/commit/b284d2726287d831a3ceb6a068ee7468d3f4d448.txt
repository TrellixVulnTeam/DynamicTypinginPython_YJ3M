commit b284d2726287d831a3ceb6a068ee7468d3f4d448
Author: Ted Kaemming <ted@kaemming.com>
Date:   Wed Oct 21 15:15:08 2015 -0700

    Add group count to digest headline

diff --git a/src/sentry/templates/sentry/emails/digests/body.html b/src/sentry/templates/sentry/emails/digests/body.html
index 871b066226..14bfaace40 100644
--- a/src/sentry/templates/sentry/emails/digests/body.html
+++ b/src/sentry/templates/sentry/emails/digests/body.html
@@ -7,7 +7,7 @@
 {% block content %}
 
 <div class="container" style="padding-top: 30px;">
-  <h2 style="margin-bottom: 30px">N new notifications from <a href="{{ project.url }}">{{ project.name }}</a>:</h2>
+  <h2 style="margin-bottom: 30px">{{ counts|length }} new notification{{ counts|pluralize }} from <a href="{{ project.url }}">{{ project.name }}</a>:</h2>
 </div>
 
 {% for rule, groups in digest.iteritems %}
diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index 7434164e41..0e2e5a0511 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -5,6 +5,7 @@ import logging
 import time
 import traceback
 import uuid
+from collections import Counter
 from datetime import (
     datetime,
     timedelta,
@@ -254,11 +255,17 @@ def digest(request):
 
     digest = build_digest(project, records, state)
 
+    # TODO(tkaemming): This duplication from ``MailPlugin.notify_digest`` is a code smell
+    counts = Counter()
+    for rule, groups in digest.iteritems():
+        counts.update(groups.keys())
+
     return MailPreview(
         html_template='sentry/emails/digests/body.html',
         text_template='sentry/emails/digests/body.txt',
         context={
             'project': project,
+            'counts': counts,
             'digest': digest,
         },
     ).render()
