commit 7dcad9fe4a0c5575b734a44e3b1b98e17de0a0c5
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Thu Apr 13 13:26:54 2017 -0700

    Added missing with transaction.atomic

diff --git a/src/sentry/lang/native/plugin.py b/src/sentry/lang/native/plugin.py
index 3651fab696..b83540dbcf 100644
--- a/src/sentry/lang/native/plugin.py
+++ b/src/sentry/lang/native/plugin.py
@@ -12,7 +12,7 @@ from symsynd.heuristics import find_best_instruction
 from symsynd.utils import parse_addr
 
 from sentry import options
-from django.db import IntegrityError
+from django.db import transaction, IntegrityError
 from sentry.models import Project, EventError, VersionDSymFile, DSymPlatform, \
     DSymApp
 from sentry.plugins import Plugin2
@@ -461,12 +461,13 @@ class NativeStacktraceProcessor(StacktraceProcessor):
                     platform=DSymPlatform.APPLE,
                 )
                 try:
-                    version_dsym_file, created = VersionDSymFile.objects.get_or_create(
-                        dsym_file=dsym_file,
-                        dsym_app=dsym_app,
-                        version=app_info.version,
-                        build=app_info.build,
-                    )
+                    with transaction.atomic():
+                        version_dsym_file, created = VersionDSymFile.objects.get_or_create(
+                            dsym_file=dsym_file,
+                            dsym_app=dsym_app,
+                            version=app_info.version,
+                            build=app_info.build,
+                        )
                 except IntegrityError:
                     # XXX: this can currently happen because we only
                     # support one app per dsym file.  Since this can
