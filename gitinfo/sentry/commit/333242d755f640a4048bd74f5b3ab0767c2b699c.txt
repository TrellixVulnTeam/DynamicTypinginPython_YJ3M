commit 333242d755f640a4048bd74f5b3ab0767c2b699c
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 20 16:27:04 2015 -0700

    Allow headers to be specified with releases

diff --git a/src/sentry/api/endpoints/release_files.py b/src/sentry/api/endpoints/release_files.py
index 4361f146e7..3028706fe0 100644
--- a/src/sentry/api/endpoints/release_files.py
+++ b/src/sentry/api/endpoints/release_files.py
@@ -57,6 +57,7 @@ class ReleaseFilesEndpoint(ProjectEndpoint):
 
             {method} {path}
             name=http%3A%2F%2Fexample.com%2Fapplication.js
+            &header=X-SourceMap%3A%20http%3A%2F%2Fexample.com%2Fapplication.js.map
 
             # ...
 
@@ -73,21 +74,30 @@ class ReleaseFilesEndpoint(ProjectEndpoint):
         )
 
         if 'file' not in request.FILES:
-            return Response(status=400)
+            return Response({'detail': 'Missing uploaded file'}, status=400)
 
         fileobj = request.FILES['file']
 
         full_name = request.DATA.get('name', fileobj.name)
         name = full_name.rsplit('/', 1)[-1]
 
+        headers = {
+            'Content-Type': fileobj.content_type,
+        }
+        for headerval in request.DATA.getlist('header') or ():
+            try:
+                k, v = headerval.split(':', 1)
+            except ValueError:
+                return Response({'detail': 'header value was not formatted correctly'}, status=400)
+            else:
+                headers[k] = v.strip()
+
         # TODO(dcramer): File's are unique on (name, checksum) so we need to
         # ensure that this file does not already exist for other purposes
         file = File(
             name=name,
             type='release.file',
-            headers={
-                'Content-Type': fileobj.content_type,
-            }
+            headers=headers,
         )
         file.putfile(fileobj)
 
diff --git a/tests/sentry/api/endpoints/test_release_files.py b/tests/sentry/api/endpoints/test_release_files.py
index 67a1473d68..8a7bb64f1a 100644
--- a/tests/sentry/api/endpoints/test_release_files.py
+++ b/tests/sentry/api/endpoints/test_release_files.py
@@ -61,6 +61,7 @@ class ReleaseFileCreateTest(APITestCase):
 
         response = self.client.post(url, {
             'name': 'http://example.com/application.js',
+            'header': 'X-SourceMap: http://example.com',
             'file': SimpleUploadedFile('application.js', 'function() { }',
                                        content_type='application/javascript'),
         }, format='multipart')
@@ -71,4 +72,5 @@ class ReleaseFileCreateTest(APITestCase):
         assert releasefile.name == 'http://example.com/application.js'
         assert releasefile.file.headers == {
             'Content-Type': 'application/javascript',
+            'X-SourceMap': 'http://example.com',
         }
