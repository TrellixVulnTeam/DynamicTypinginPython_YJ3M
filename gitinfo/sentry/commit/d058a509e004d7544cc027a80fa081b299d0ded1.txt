commit d058a509e004d7544cc027a80fa081b299d0ded1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Oct 22 01:21:19 2012 -0700

    Improve how we load ajax data into an OrderedElementsView

diff --git a/src/sentry.less b/src/sentry.less
index 8033428c3c..dabfb80089 100644
--- a/src/sentry.less
+++ b/src/sentry.less
@@ -447,9 +447,11 @@ footer {
 
     &.empty {
       border: 0;
-      padding: 15px 20px;
-      p {
-        margin: 5px 0 5px;
+      padding: 0 !important;
+      &:hover {
+        .reset-filter();
+        background-image: none;
+        background-color: inherit;
       }
     }
 
@@ -588,10 +590,6 @@ footer {
       min-height: 30px;
       padding: 10px 10px 10px 60px;
 
-      &.empty {
-        padding: 10px 20px;
-      }
-
       h3 {
         margin: 0;
         font-size: 14px;
diff --git a/src/sentry/static/sentry/coffee/app.coffee b/src/sentry/static/sentry/coffee/app.coffee
index 498809a707..4952b5abe1 100644
--- a/src/sentry/static/sentry/coffee/app.coffee
+++ b/src/sentry/static/sentry/coffee/app.coffee
@@ -89,12 +89,13 @@ jQuery ->
             $('a[data-toggle=ajtab]').click (e) =>
                 $tab = $(e.target)
                 view_id = $tab.attr('href').substr(1)
+                view = @getView(view_id)
                 uri = $tab.attr('data-uri')
 
                 if (!uri)
+                    view.load()
                     return
 
-                view = @getView(view_id)
                 $cont = $(name)
                 $parent = $cont.parent()
 
@@ -106,8 +107,7 @@ jQuery ->
                     url: uri
                     dataType: 'json'
                     success: (data) =>
-                        for item in data
-                            view.addMember(data)
+                        view.load(data)
                         $parent.css('opacity', 1)
                         $tab.tab('show')
                     # error: ->
@@ -122,6 +122,7 @@ jQuery ->
                     className: 'group-list small'
                     id: id
                     maxItems: 5
+                    loaded: false
             return @views[id]
 
 # We're not talking to the server
diff --git a/src/sentry/static/sentry/coffee/views.coffee b/src/sentry/static/sentry/coffee/views.coffee
index 089be5b74b..5e1dc8ab77 100644
--- a/src/sentry/static/sentry/coffee/views.coffee
+++ b/src/sentry/static/sentry/coffee/views.coffee
@@ -7,10 +7,15 @@ jQuery ->
 
             _.bindAll(@)
 
-            @$empty = $('<li class="empty"><p>There is nothing to show here.</p></li>')
+            @loaded = data.loaded ? true
             @$wrapper = $('#' + @id)
             @$parent = $('<ul></ul>')
-            @$parent.html(@$empty)
+            @$empty = $('<li class="empty"></li>')
+            if @loaded
+                @empty.html('<p>There is nothing to show here.</p>')
+            else
+                @$empty.html('<p>Loading ...</p>')
+            @setEmpty()
             @$wrapper.html(@$parent)
 
             if data.className
@@ -28,6 +33,18 @@ jQuery ->
             @collection.on('reset', @reSortMembers)
             @collection.sort()
 
+        load: (data) ->
+            @loaded = true
+            @$empty.html('<p>There is nothing to show here.</p>')
+            @extend(data) if data
+
+        setEmpty: ->
+            @$parent.html(@$empty)
+
+        extend: (data) ->
+            for item in data
+                @addMember(data)
+
         addMember: (member) ->
             if not @hasMember(member)
                 @collection.add(member)
@@ -95,7 +112,7 @@ jQuery ->
         unrenderMember: (member) ->
             $('#' + @id + member.id).remove()
             if !@$parent.find('li').length
-                @$parent.html(@$empty)
+                @setEmpty()
 
 
     app.GroupListView = class GroupListView extends OrderedElementsView
diff --git a/src/sentry/static/sentry/scripts/site.js b/src/sentry/static/sentry/scripts/site.js
index abe3d636a5..58a7dced44 100644
--- a/src/sentry/static/sentry/scripts/site.js
+++ b/src/sentry/static/sentry/scripts/site.js
@@ -4,7 +4,7 @@
     __hasProp = {}.hasOwnProperty,
     __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };
 
-  window.app = app = app || {};
+  window.app = app = window.app || {};
 
   app.config = app.config || {};
 
@@ -109,11 +109,12 @@
           var $cont, $parent, $tab, uri, view, view_id;
           $tab = $(e.target);
           view_id = $tab.attr('href').substr(1);
+          view = _this.getView(view_id);
           uri = $tab.attr('data-uri');
           if (!uri) {
+            view.load();
             return;
           }
-          view = _this.getView(view_id);
           $cont = $(name);
           $parent = $cont.parent();
           $parent.css('opacity', .6);
@@ -122,11 +123,7 @@
             url: uri,
             dataType: 'json',
             success: function(data) {
-              var item, _i, _len;
-              for (_i = 0, _len = data.length; _i < _len; _i++) {
-                item = data[_i];
-                view.addMember(data);
-              }
+              view.load(data);
               $parent.css('opacity', 1);
               return $tab.tab('show');
             }
@@ -140,7 +137,8 @@
           this.views[id] = new app.OrderedElementsView({
             className: 'group-list small',
             id: id,
-            maxItems: 5
+            maxItems: 5,
+            loaded: false
           });
         }
         return this.views[id];
@@ -155,7 +153,7 @@
     return success();
   };
 
-  window.app = app = app || {};
+  window.app = app = window.app || {};
 
   jQuery(function() {
     var ScoredList;
@@ -243,7 +241,7 @@
     })(Backbone.Model);
   });
 
-  window.app = app = app || {};
+  window.app = app = window.app || {};
 
   app.utils = app.utils || {};
 
@@ -299,7 +297,7 @@
     });
   });
 
-  window.app = app = app || {};
+  window.app = app = window.app || {};
 
   jQuery(function() {
     var GroupListView, GroupView, OrderedElementsView;
@@ -312,18 +310,24 @@
       }
 
       OrderedElementsView.prototype.initialize = function(data) {
-        var _ref;
+        var _ref, _ref1;
         _.bindAll(this);
-        this.$empty = $('<li class="empty"><p>There is nothing to show here.</p></li>');
+        this.loaded = (_ref = data.loaded) != null ? _ref : true;
         this.$wrapper = $('#' + this.id);
         this.$parent = $('<ul></ul>');
-        this.$parent.html(this.$empty);
+        this.$empty = $('<li class="empty"></li>');
+        if (this.loaded) {
+          this.empty.html('<p>There is nothing to show here.</p>');
+        } else {
+          this.$empty.html('<p>Loading ...</p>');
+        }
+        this.setEmpty();
         this.$wrapper.html(this.$parent);
         if (data.className) {
           this.$parent.addClass(data.className);
         }
         this.config = {
-          maxItems: (_ref = data.maxItems) != null ? _ref : 50
+          maxItems: (_ref1 = data.maxItems) != null ? _ref1 : 50
         };
         this.collection = new app.ScoredList;
         this.collection.add(data.members || []);
@@ -333,6 +337,28 @@
         return this.collection.sort();
       };
 
+      OrderedElementsView.prototype.load = function(data) {
+        this.loaded = true;
+        this.$empty.html('<p>There is nothing to show here.</p>');
+        if (data) {
+          return this.extend(data);
+        }
+      };
+
+      OrderedElementsView.prototype.setEmpty = function() {
+        return this.$parent.html(this.$empty);
+      };
+
+      OrderedElementsView.prototype.extend = function(data) {
+        var item, _i, _len, _results;
+        _results = [];
+        for (_i = 0, _len = data.length; _i < _len; _i++) {
+          item = data[_i];
+          _results.push(this.addMember(data));
+        }
+        return _results;
+      };
+
       OrderedElementsView.prototype.addMember = function(member) {
         if (!this.hasMember(member)) {
           return this.collection.add(member);
@@ -404,7 +430,7 @@
       OrderedElementsView.prototype.unrenderMember = function(member) {
         $('#' + this.id + member.id).remove();
         if (!this.$parent.find('li').length) {
-          return this.$parent.html(this.$empty);
+          return this.setEmpty();
         }
       };
 
diff --git a/src/sentry/static/sentry/styles/global.css b/src/sentry/static/sentry/styles/global.css
index 49b13746fd..bf8325e88b 100644
--- a/src/sentry/static/sentry/styles/global.css
+++ b/src/sentry/static/sentry/styles/global.css
@@ -5897,11 +5897,13 @@ footer a:hover {
 .group-list > li.empty,
 .events > li.empty {
   border: 0;
-  padding: 15px 20px;
+  padding: 0 !important;
 }
-.group-list > li.empty p,
-.events > li.empty p {
-  margin: 5px 0 5px;
+.group-list > li.empty:hover,
+.events > li.empty:hover {
+  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
+  background-image: none;
+  background-color: inherit;
 }
 .group-list > li.with-metadata .message,
 .events > li.with-metadata .message {
@@ -6073,10 +6075,6 @@ footer a:hover {
   min-height: 30px;
   padding: 10px 10px 10px 60px;
 }
-.group-list.small > li.empty,
-.events.small > li.empty {
-  padding: 10px 20px;
-}
 .group-list.small > li h3,
 .events.small > li h3 {
   margin: 0;
diff --git a/src/sentry/static/sentry/styles/global.min.css b/src/sentry/static/sentry/styles/global.min.css
index 4ab866474e..2bbd6f9299 100644
--- a/src/sentry/static/sentry/styles/global.min.css
+++ b/src/sentry/static/sentry/styles/global.min.css
@@ -937,7 +937,7 @@ footer a{color:#f4f4f4;font-weight:bold;}footer a:hover{color:#fff;}
 .btn.next span{display:block;width:13px;height:13px;background:url(../images/dashboard/pagination.png) -13px 0;}
 .group-list,.events{margin:0;padding:0;list-style:none;}.group-list.no-counts>li,.events.no-counts>li{padding-left:20px;}
 .group-list>li,.events>li{position:relative;padding:15px 20px 15px 100px;position:relative;border:1px solid #e5e6e7;border-top-width:0;min-height:60px;}.group-list>li:first-child,.events>li:first-child{border-top-width:1px;}
-.group-list>li.empty,.events>li.empty{border:0;padding:15px 20px;}.group-list>li.empty p,.events>li.empty p{margin:5px 0 5px;}
+.group-list>li.empty,.events>li.empty{border:0;padding:0 !important;}.group-list>li.empty:hover,.events>li.empty:hover{filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);background-image:none;background-color:inherit;}
 .group-list>li.with-metadata .message,.events>li.with-metadata .message{padding-right:124px;}
 .group-list>li.with-metadata .meta,.events>li.with-metadata .meta{right:155px;}
 .group-list>li:hover,.events>li:hover{background-color:#f4fafe;background-image:-moz-linear-gradient(top, #f7fbfe, #eff8fd);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f7fbfe), to(#eff8fd));background-image:-webkit-linear-gradient(top, #f7fbfe, #eff8fd);background-image:-o-linear-gradient(top, #f7fbfe, #eff8fd);background-image:linear-gradient(to bottom, #f7fbfe, #eff8fd);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff7fbfe', endColorstr='#ffeff8fd', GradientType=0);border-color:#aec9d7;}.group-list>li:hover h3 a,.events>li:hover h3 a{color:#12659a;}
@@ -957,8 +957,7 @@ footer a{color:#f4f4f4;font-weight:bold;}footer a:hover{color:#fff;}
 .group-list>li.level-fatal .count,.events>li.level-fatal .count{background:#f0431c;}
 .group-list>li.resolved h3,.events>li.resolved h3{text-decoration:line-through;}
 .group-list>li.resolved .count,.events>li.resolved .count{opacity:0.5;filter:alpha(opacity=50);}
-.group-list.small>li,.events.small>li{min-height:30px;padding:10px 10px 10px 60px;}.group-list.small>li.empty,.events.small>li.empty{padding:10px 20px;}
-.group-list.small>li h3,.events.small>li h3{margin:0;font-size:14px;line-height:16px;}
+.group-list.small>li,.events.small>li{min-height:30px;padding:10px 10px 10px 60px;}.group-list.small>li h3,.events.small>li h3{margin:0;font-size:14px;line-height:16px;}
 .group-list.small>li .message,.events.small>li .message{font-size:12px;}
 .group-list.small>li .count,.events.small>li .count{left:10px;font-size:12px;width:36px;height:36px;line-height:38px;-webkit-border-radius:36px;-moz-border-radius:36px;border-radius:36px;}
 .group-list.small>li .actions,.events.small>li .actions{display:none;}
