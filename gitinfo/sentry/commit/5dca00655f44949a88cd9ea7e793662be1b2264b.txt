commit 5dca00655f44949a88cd9ea7e793662be1b2264b
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Wed Feb 6 19:38:05 2019 -0800

    fix(dashboard): Change Dashboard to use Discover feature flag [APP-1095] (#11943)
    
    Changes sidebar order too
    
    ![image](https://user-images.githubusercontent.com/79684/52381351-f55a4080-2a25-11e9-82d5-5c1b244a9526.png)

diff --git a/src/sentry/static/sentry/app/components/sidebar/index.jsx b/src/sentry/static/sentry/app/components/sidebar/index.jsx
index 45defb5f2b..835aaf93eb 100644
--- a/src/sentry/static/sentry/app/components/sidebar/index.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/index.jsx
@@ -252,14 +252,6 @@ class Sidebar extends React.Component {
                   renderDisabled={projectsSidebarItem}
                   organization={organization}
                 >
-                  <SidebarItem
-                    {...sidebarItemProps}
-                    index
-                    onClick={this.hidePanel}
-                    icon={<InlineSvg src="icon-health" />}
-                    label={t('Dashboard')}
-                    to={`/organizations/${organization.slug}/dashboards/`}
-                  />
                   <SidebarItem
                     {...sidebarItemProps}
                     onClick={(_id, evt) =>
@@ -287,32 +279,58 @@ class Sidebar extends React.Component {
                   />
                 </Feature>
 
-                <Feature features={['sentry10']} organization={organization}>
-                  <SidebarItem
-                    {...sidebarItemProps}
-                    onClick={(_id, evt) =>
-                      this.navigateWithGlobalSelection(
-                        `/organizations/${organization.slug}/releases/`,
-                        evt
-                      )}
-                    icon={<InlineSvg src="icon-releases" />}
-                    label={t('Releases')}
-                    to={`/organizations/${organization.slug}/releases/`}
-                  />
-                  <SidebarItem
-                    {...sidebarItemProps}
-                    onClick={(_id, evt) =>
-                      this.navigateWithGlobalSelection(
-                        `/organizations/${organization.slug}/user-feedback/`,
-                        evt
-                      )}
-                    icon={<InlineSvg src="icon-support" />}
-                    label={t('User Feedback')}
-                    to={`/organizations/${organization.slug}/user-feedback/`}
-                  />
-                </Feature>
+                {hasSentry10 && (
+                  <React.Fragment>
+                    <SidebarItem
+                      {...sidebarItemProps}
+                      onClick={(_id, evt) =>
+                        this.navigateWithGlobalSelection(
+                          `/organizations/${organization.slug}/releases/`,
+                          evt
+                        )}
+                      icon={<InlineSvg src="icon-releases" />}
+                      label={t('Releases')}
+                      to={`/organizations/${organization.slug}/releases/`}
+                    />
+                    <SidebarItem
+                      {...sidebarItemProps}
+                      onClick={(_id, evt) =>
+                        this.navigateWithGlobalSelection(
+                          `/organizations/${organization.slug}/user-feedback/`,
+                          evt
+                        )}
+                      icon={<InlineSvg src="icon-support" />}
+                      label={t('User Feedback')}
+                      to={`/organizations/${organization.slug}/user-feedback/`}
+                    />
+                  </React.Fragment>
+                )}
+
+                {!hasSentry10 && (
+                  <Feature features={['discover']}>
+                    <SidebarItem
+                      {...sidebarItemProps}
+                      onClick={this.hidePanel}
+                      icon={<InlineSvg src="icon-discover" />}
+                      label={t('Discover')}
+                      to={`/organizations/${organization.slug}/discover/`}
+                    />
+                  </Feature>
+                )}
+              </SidebarSection>
 
-                <Feature features={['discover']}>
+              <Feature features={['sentry10', 'discover']}>
+                <SidebarSection>
+                  <Feature features={['sentry10', 'discover']}>
+                    <SidebarItem
+                      {...sidebarItemProps}
+                      index
+                      onClick={this.hidePanel}
+                      icon={<InlineSvg src="icon-health" />}
+                      label={t('Dashboards')}
+                      to={`/organizations/${organization.slug}/dashboards/`}
+                    />
+                  </Feature>
                   <SidebarItem
                     {...sidebarItemProps}
                     onClick={this.hidePanel}
@@ -320,8 +338,8 @@ class Sidebar extends React.Component {
                     label={t('Discover')}
                     to={`/organizations/${organization.slug}/discover/`}
                   />
-                </Feature>
-              </SidebarSection>
+                </SidebarSection>
+              </Feature>
 
               {!hasSentry10 && (
                 <SidebarSection>
diff --git a/src/sentry/static/sentry/app/views/organizationDashboard/organizationDashboardContainer.jsx b/src/sentry/static/sentry/app/views/organizationDashboard/organizationDashboardContainer.jsx
index cfa334bd67..980c518975 100644
--- a/src/sentry/static/sentry/app/views/organizationDashboard/organizationDashboardContainer.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDashboard/organizationDashboardContainer.jsx
@@ -19,7 +19,7 @@ class OrganizationDashboardContainer extends React.Component {
     const {organization, children} = this.props;
 
     return (
-      <Feature features={['sentry10']} renderDisabled>
+      <Feature features={['sentry10', 'discover']} renderDisabled>
         <GlobalSelectionHeader organization={organization} />
 
         <PageContent>
diff --git a/tests/js/spec/components/sidebar/index.spec.jsx b/tests/js/spec/components/sidebar/index.spec.jsx
index e80dca31cc..1edbfb983c 100644
--- a/tests/js/spec/components/sidebar/index.spec.jsx
+++ b/tests/js/spec/components/sidebar/index.spec.jsx
@@ -293,7 +293,7 @@ describe('Sidebar', function() {
       wrapper.setProps({organization: sentry10Org});
       wrapper.update();
       const labels = wrapper.find('SidebarItemLabel').map(node => node.text());
-      expect(labels).toHaveLength(10);
+      expect(labels).toHaveLength(9);
       expect(labels).not.toContain('Assigned to me');
       expect(labels).not.toContain('Bookmarked issues');
       expect(labels).not.toContain('Recently viewed');
diff --git a/tests/js/spec/views/organizationDashboard/dashboard.spec.jsx b/tests/js/spec/views/organizationDashboard/dashboard.spec.jsx
index 5ad74f621f..10ae9bee3a 100644
--- a/tests/js/spec/views/organizationDashboard/dashboard.spec.jsx
+++ b/tests/js/spec/views/organizationDashboard/dashboard.spec.jsx
@@ -13,7 +13,7 @@ describe('OrganizationDashboard', function() {
   const {organization, router, routerContext} = initializeOrg({
     projects: [{isMember: true}, {isMember: true, slug: 'new-project', id: 3}],
     organization: {
-      features: ['sentry10', 'global-views'],
+      features: ['sentry10', 'discover', 'global-views'],
     },
     router: {
       location: {
