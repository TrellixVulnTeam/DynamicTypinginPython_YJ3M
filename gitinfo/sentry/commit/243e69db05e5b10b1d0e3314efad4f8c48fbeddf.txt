commit 243e69db05e5b10b1d0e3314efad4f8c48fbeddf
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 17 22:01:37 2012 -0800

    WSGI support

diff --git a/src/sentry/utils/runner.py b/src/sentry/utils/runner.py
index 7a1700b971..4b081cd4ce 100644
--- a/src/sentry/utils/runner.py
+++ b/src/sentry/utils/runner.py
@@ -6,7 +6,7 @@ sentry.utils.runner
 :copyright: (c) 2012 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
-from logan.runner import run_app
+from logan.runner import run_app, configure_app
 from sentry import environment
 
 import base64
@@ -172,6 +172,17 @@ def initialize_app(config):
     install_plugins(config['settings'])
 
 
+def configure():
+    configure_app(
+        project='sentry',
+        default_config_path='~/.sentry/sentry.conf.py',
+        default_settings='sentry.conf.server',
+        settings_initializer=generate_settings,
+        settings_envvar='SENTRY_CONF',
+        initializer=initialize_app,
+    )
+
+
 def main():
     run_app(
         project='sentry',
diff --git a/src/sentry/wsgi.py b/src/sentry/wsgi.py
index 1ab01f1968..f175f11e0a 100644
--- a/src/sentry/wsgi.py
+++ b/src/sentry/wsgi.py
@@ -14,22 +14,21 @@ import sys
 sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))
 sys.stdout = sys.stderr
 
-# Set our settings module
-from django.conf import settings
-
-if not settings.configured and not os.environ.get('DJANGO_SETTINGS_MODULE'):
-    os.environ['DJANGO_SETTINGS_MODULE'] = 'sentry.conf.server'
-
-os.environ['CELERY_LOADER'] = 'django'
+# Configure the application (Logan)
+from sentry.utils.runner import configure
+configure()
 
+# Build the wsgi app
 import django.core.handlers.wsgi
-from raven.contrib.django.middleware.wsgi import Sentry
 
-# Run WSGI handler for the application
-application = Sentry(django.core.handlers.wsgi.WSGIHandler())
+from django.conf import settings
+from raven.contrib.django.middleware.wsgi import Sentry
 
-if settings.SESSION_FILE_PATH:
+if settings.SESSION_FILE_PATH and not os.path.exists(settings.SESSION_FILE_PATH):
     try:
         os.makedirs(settings.SESSION_FILE_PATH)
     except OSError:
         pass
+
+# Run WSGI handler for the application
+application = Sentry(django.core.handlers.wsgi.WSGIHandler())
