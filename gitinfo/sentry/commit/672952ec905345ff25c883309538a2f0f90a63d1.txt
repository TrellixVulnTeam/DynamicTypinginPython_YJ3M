commit 672952ec905345ff25c883309538a2f0f90a63d1
Author: ted kaemming <ted@kaemming.com>
Date:   Fri Feb 10 14:11:27 2017 -0800

    Add similarity indexing to `event_processed` signal receivers. (#4898)

diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index e85131eb7c..ca7a6f47f4 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -18,6 +18,7 @@ default_manager.add('projects:global-events', ProjectFeature)  # NOQA
 default_manager.add('projects:plugins', ProjectPluginFeature)  # NOQA
 default_manager.add('workflow:release-emails', ProjectFeature)  # NOQA
 default_manager.add('projects:sample-events', ProjectFeature)  # NOQA
+default_manager.add('projects:similarity-indexing', ProjectFeature)  # NOQA
 
 # expose public api
 add = default_manager.add
diff --git a/src/sentry/receivers/similarity.py b/src/sentry/receivers/similarity.py
new file mode 100644
index 0000000000..c8e1b5ebcd
--- /dev/null
+++ b/src/sentry/receivers/similarity.py
@@ -0,0 +1,13 @@
+from __future__ import absolute_import
+
+from sentry import features as feature_flags
+from sentry.signals import event_processed
+from sentry.similarity import features as similarity_features
+
+
+@event_processed.connect(weak=False)
+def record(project, group, event, **kwargs):
+    if not feature_flags.has('projects:similarity-indexing', project):
+        return
+
+    similarity_features.record(event)
