commit 2efddcfb21b79647308a5bbabaa1b45f7cd6faa1
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Wed May 18 22:56:33 2016 +0200

    Use django's builtin time compare

diff --git a/src/sentry/utils/otp.py b/src/sentry/utils/otp.py
index 0de22d9a5f..0c38e3f094 100644
--- a/src/sentry/utils/otp.py
+++ b/src/sentry/utils/otp.py
@@ -8,31 +8,10 @@ import qrcode
 import urllib
 import hashlib
 from datetime import datetime
-from itertools import izip
 
 from sentry.utils.dates import to_timestamp
 
-
-_builtin_constant_time_compare = getattr(hmac, 'compare_digest', None)
-
-
-def constant_time_compare(val1, val2):
-    if isinstance(val1, unicode):
-        val1 = val1.encode('utf-8')
-    if isinstance(val2, unicode):
-        val2 = val2.encode('utf-8')
-    if _builtin_constant_time_compare is not None:
-        return _builtin_constant_time_compare(val1, val2)
-    len_eq = len(val1) == len(val2)
-    if len_eq:
-        result = 0
-        left = val1
-    else:
-        result = 1
-        left = val2
-    for x, y in izip(bytearray(left), bytearray(val2)):
-        result |= x ^ y
-    return result == 0
+from django.utils.crypto import constant_time_compare
 
 
 def generate_secret_key(length=32):
