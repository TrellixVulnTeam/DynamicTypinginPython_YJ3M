commit d6b6d7eab2173ea1657d2f691263dc6afe34728c
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Tue Jul 25 11:10:59 2017 -0700

    exclude pending deletion / in progress deletion statuses from group endpoints (#5762)
    
    * exclude pending deletion / in progress deletion statuses from group endpoints
    
    * add pending merge to excluded statuses
    
    * also update project index test

diff --git a/src/sentry/api/bases/group.py b/src/sentry/api/bases/group.py
index e2de4e8e8e..fe9b579163 100644
--- a/src/sentry/api/bases/group.py
+++ b/src/sentry/api/bases/group.py
@@ -6,10 +6,14 @@ from sentry.api.base import Endpoint
 from sentry.api.bases.project import ProjectPermission
 from sentry.api.exceptions import ResourceDoesNotExist
 from sentry.app import raven
-from sentry.models import Group, get_group_with_redirect
+from sentry.models import Group, GroupStatus, get_group_with_redirect
 
 logger = logging.getLogger(__name__)
 
+EXCLUDED_STATUSES = (
+    GroupStatus.PENDING_DELETION, GroupStatus.DELETION_IN_PROGRESS, GroupStatus.PENDING_MERGE
+)
+
 
 class GroupPermission(ProjectPermission):
     scope_map = {
@@ -54,6 +58,9 @@ class GroupEndpoint(Endpoint):
             }
         )
 
+        if group.status in EXCLUDED_STATUSES:
+            raise ResourceDoesNotExist
+
         kwargs['group'] = group
 
         return (args, kwargs)
diff --git a/tests/sentry/api/endpoints/test_group_details.py b/tests/sentry/api/endpoints/test_group_details.py
index ae5eebc872..a12aceaf22 100644
--- a/tests/sentry/api/endpoints/test_group_details.py
+++ b/tests/sentry/api/endpoints/test_group_details.py
@@ -49,6 +49,33 @@ class GroupDetailsTest(APITestCase):
         assert response.data['id'] == six.text_type(group.id)
         assert response.data['firstRelease']['version'] == release.version
 
+    def test_pending_delete_pending_merge_excluded(self):
+        group1 = self.create_group(
+            status=GroupStatus.PENDING_DELETION,
+        )
+        group2 = self.create_group(
+            status=GroupStatus.DELETION_IN_PROGRESS,
+        )
+
+        group3 = self.create_group(
+            status=GroupStatus.PENDING_MERGE,
+        )
+
+        self.login_as(user=self.user)
+
+        url = '/api/0/issues/{}/'.format(group1.id)
+
+        response = self.client.get(url, format='json')
+        assert response.status_code == 404
+
+        url = '/api/0/issues/{}/'.format(group2.id)
+        response = self.client.get(url, format='json')
+        assert response.status_code == 404
+
+        url = '/api/0/issues/{}/'.format(group3.id)
+        response = self.client.get(url, format='json')
+        assert response.status_code == 404
+
 
 class GroupUpdateTest(APITestCase):
     def test_resolve(self):
diff --git a/tests/sentry/api/endpoints/test_project_group_index.py b/tests/sentry/api/endpoints/test_project_group_index.py
index 034be71d41..3aba5a5157 100644
--- a/tests/sentry/api/endpoints/test_project_group_index.py
+++ b/tests/sentry/api/endpoints/test_project_group_index.py
@@ -261,6 +261,29 @@ class GroupListTest(APITestCase):
         assert len(issues) == 1
         assert int(issues[0]['id']) == group.id
 
+    def test_pending_delete_pending_merge_excluded(self):
+        self.create_group(
+            checksum='a' * 32,
+            status=GroupStatus.PENDING_DELETION,
+        )
+        group = self.create_group(
+            checksum='b' * 32,
+        )
+        self.create_group(
+            checksum='c' * 32,
+            status=GroupStatus.DELETION_IN_PROGRESS,
+        )
+        self.create_group(
+            checksum='d' * 32,
+            status=GroupStatus.PENDING_MERGE,
+        )
+
+        self.login_as(user=self.user)
+
+        response = self.client.get(self.path, format='json')
+        assert len(response.data) == 1
+        assert response.data[0]['id'] == six.text_type(group.id)
+
 
 class GroupUpdateTest(APITestCase):
     @fixture
