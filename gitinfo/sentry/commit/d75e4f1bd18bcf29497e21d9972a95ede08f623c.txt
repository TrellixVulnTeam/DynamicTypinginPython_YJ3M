commit d75e4f1bd18bcf29497e21d9972a95ede08f623c
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Jan 31 14:52:12 2019 -0800

    feat(email): Update links for Sentry 10 in release email (#11834)

diff --git a/src/sentry/plugins/sentry_mail/activity/release.py b/src/sentry/plugins/sentry_mail/activity/release.py
index 5cb35f7cd5..66eda0ed09 100644
--- a/src/sentry/plugins/sentry_mail/activity/release.py
+++ b/src/sentry/plugins/sentry_mail/activity/release.py
@@ -188,6 +188,7 @@ class ReleaseActivityEmail(ActivityEmail):
         }
 
     def get_user_context(self, user):
+        from sentry import features
         if user.is_superuser or self.organization.flags.allow_joinleave:
             projects = self.projects
         else:
@@ -198,15 +199,28 @@ class ReleaseActivityEmail(ActivityEmail):
                 ).values_list('project_id', flat=True).distinct()
             )
             projects = [p for p in self.projects if p.id in team_projects]
-        release_links = [
-            absolute_uri(
-                u'/{}/{}/releases/{}/'.format(
-                    self.organization.slug,
-                    p.slug,
-                    self.release.version,
-                )
-            ) for p in projects
-        ]
+
+        has_new_links = features.has('organizations:sentry10', self.organization)
+        if has_new_links:
+            release_links = [
+                absolute_uri(
+                    u'/organizations/{}/releases/{}/'.format(
+                        self.organization.slug,
+                        self.release.version,
+                    )
+                ) for p in projects
+            ]
+        else:
+            release_links = [
+                absolute_uri(
+                    u'/{}/{}/releases/{}/'.format(
+                        self.organization.slug,
+                        p.slug,
+                        self.release.version,
+                    )
+                ) for p in projects
+            ]
+
         resolved_issue_counts = [self.group_counts_by_project.get(p.id, 0) for p in projects]
         return {
             'projects': zip(projects, release_links, resolved_issue_counts),
diff --git a/src/sentry/web/frontend/debug/debug_new_release_email.py b/src/sentry/web/frontend/debug/debug_new_release_email.py
index 55113ea6eb..d2d121e0c4 100644
--- a/src/sentry/web/frontend/debug/debug_new_release_email.py
+++ b/src/sentry/web/frontend/debug/debug_new_release_email.py
@@ -13,6 +13,8 @@ from sentry.utils.http import absolute_uri
 
 from .mail import MailPreview
 
+from sentry import features
+
 
 class DebugNewReleaseEmailView(View):
     def get(self, request):
@@ -54,13 +56,26 @@ class DebugNewReleaseEmailView(View):
             date_finished=datetime.datetime(2016, 10, 12, 15, 39, tzinfo=pytz.utc),
         )
 
-        release_links = [
-            absolute_uri(u'/{}/{}/releases/{}/'.format(
-                org.slug,
-                p.slug,
-                release.version,
-            )) for p in projects
-        ]
+        has_new_links = features.has('organizations:sentry10', org)
+        if has_new_links:
+            release_links = [
+                absolute_uri(
+                    u'/organizations/{}/releases/{}/'.format(
+                        org.slug,
+                        release.version,
+                    )
+                ) for p in projects
+            ]
+        else:
+            release_links = [
+                absolute_uri(
+                    u'/{}/{}/releases/{}/'.format(
+                        org.slug,
+                        p.slug,
+                        release.version,
+                    )
+                ) for p in projects
+            ]
 
         repos = [
             {
