commit 08bbfb42d06aa31a5c1a46b558dd46172c326eef
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Jan 12 16:19:21 2017 -0800

    migration: fix 0285 by explicitly just dropping null constraint
    
    South is trying to do too much magic here and causing a deadlock

diff --git a/src/sentry/south_migrations/0285_auto__chg_field_release_project_id__chg_field_releasefile_project_id.py b/src/sentry/south_migrations/0285_auto__chg_field_release_project_id__chg_field_releasefile_project_id.py
index 9dfba7b6dc..f32cda512a 100644
--- a/src/sentry/south_migrations/0285_auto__chg_field_release_project_id__chg_field_releasefile_project_id.py
+++ b/src/sentry/south_migrations/0285_auto__chg_field_release_project_id__chg_field_releasefile_project_id.py
@@ -3,30 +3,38 @@ from south.utils import datetime_utils as datetime
 from south.db import db
 from south.v2 import SchemaMigration
 from django.db import models
+from sentry.utils.db import is_postgres
 
 
 class Migration(SchemaMigration):
 
     def forwards(self, orm):
 
-        # Changing field 'Release.project_id'
-        db.alter_column('sentry_release', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(null=True))
+        if is_postgres():
+            # Changing field 'Release.project_id'
+            db.execute("ALTER TABLE sentry_release ALTER COLUMN project_id DROP NOT NULL")
 
-        # Changing field 'ReleaseFile.project_id'
-        db.alter_column('sentry_releasefile', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(null=True))
+            # Changing field 'ReleaseFile.project_id'
+            db.execute("ALTER TABLE sentry_releasefile ALTER COLUMN project_id DROP NOT NULL")
+        else:
+            # Changing field 'Release.project_id'
+            db.alter_column('sentry_release', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(null=True))
+
+            # Changing field 'ReleaseFile.project_id'
+            db.alter_column('sentry_releasefile', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')(null=True))
 
     def backwards(self, orm):
 
         # User chose to not deal with backwards NULL issues for 'Release.project_id'
         raise RuntimeError("Cannot reverse this migration. 'Release.project_id' and its values cannot be restored.")
-        
+
         # The following code is provided here to aid in writing a correct migration
         # Changing field 'Release.project_id'
         db.alter_column('sentry_release', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')())
 
         # User chose to not deal with backwards NULL issues for 'ReleaseFile.project_id'
         raise RuntimeError("Cannot reverse this migration. 'ReleaseFile.project_id' and its values cannot be restored.")
-        
+
         # The following code is provided here to aid in writing a correct migration
         # Changing field 'ReleaseFile.project_id'
         db.alter_column('sentry_releasefile', 'project_id', self.gf('sentry.db.models.fields.bounded.BoundedPositiveIntegerField')())
@@ -713,4 +721,4 @@ class Migration(SchemaMigration):
         }
     }
 
-    complete_apps = ['sentry']
\ No newline at end of file
+    complete_apps = ['sentry']
