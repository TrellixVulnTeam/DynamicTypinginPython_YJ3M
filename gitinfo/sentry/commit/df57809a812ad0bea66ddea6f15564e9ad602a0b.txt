commit df57809a812ad0bea66ddea6f15564e9ad602a0b
Author: William Mak <william@wmak.io>
Date:   Tue May 26 18:19:10 2020 -0400

    feat(discover): Adding aggregates to the autocomplete
    
    - This adds aggregates that are currently selected in the table to the
      autocomplete. This prevents the case where a user could query for
      apdex(400) but only have apdex(300) in the columns.

diff --git a/src/sentry/static/sentry/app/views/events/searchBar.jsx b/src/sentry/static/sentry/app/views/events/searchBar.jsx
index f965976e2e..193e6f19b3 100644
--- a/src/sentry/static/sentry/app/views/events/searchBar.jsx
+++ b/src/sentry/static/sentry/app/views/events/searchBar.jsx
@@ -32,6 +32,7 @@ class SearchBar extends React.PureComponent {
     tags: PropTypes.objectOf(SentryTypes.Tag),
     omitTags: PropTypes.arrayOf(PropTypes.string),
     projectIds: PropTypes.arrayOf(PropTypes.number),
+    fields: PropTypes.arrayOf(PropTypes.object),
   };
 
   componentDidMount() {
@@ -78,12 +79,20 @@ class SearchBar extends React.PureComponent {
   prepareQuery = query => query.replace(SEARCH_SPECIAL_CHARS_REGEXP, '');
 
   getTagList() {
-    const {organization, tags, omitTags} = this.props;
-    const fields = organization.features.includes('transaction-events')
-      ? FIELD_TAGS
+    const {fields, organization, tags, omitTags} = this.props;
+    const functionTags = fields
+      ? Object.fromEntries(
+          fields
+            .filter(item => !Object.keys(FIELD_TAGS).includes(item.field))
+            .map(item => [item.field, {key: item.field, name: item.field}])
+        )
+      : {};
+
+    const fieldTags = organization.features.includes('transaction-events')
+      ? assign(FIELD_TAGS, functionTags)
       : omit(FIELD_TAGS, TRACING_FIELDS);
 
-    const combined = assign({}, tags, fields);
+    const combined = assign({}, tags, fieldTags);
     combined.has = {
       key: 'has',
       name: 'Has property',
diff --git a/src/sentry/static/sentry/app/views/eventsV2/results.tsx b/src/sentry/static/sentry/app/views/eventsV2/results.tsx
index 910cf23252..10546e79aa 100644
--- a/src/sentry/static/sentry/app/views/eventsV2/results.tsx
+++ b/src/sentry/static/sentry/app/views/eventsV2/results.tsx
@@ -250,6 +250,7 @@ class Results extends React.Component<Props, State> {
                   organization={organization}
                   projectIds={eventView.project}
                   query={query}
+                  fields={eventView.fields}
                   onSearch={this.handleSearch}
                 />
                 <ResultsChart
diff --git a/src/sentry/static/sentry/app/views/performance/landing.tsx b/src/sentry/static/sentry/app/views/performance/landing.tsx
index cb0560b1f7..d37b9a440f 100644
--- a/src/sentry/static/sentry/app/views/performance/landing.tsx
+++ b/src/sentry/static/sentry/app/views/performance/landing.tsx
@@ -239,6 +239,7 @@ class PerformanceLanding extends React.Component<Props, State> {
                     projectIds={eventView.project}
                     location={location}
                     query={filterString}
+                    fields={eventView.fields}
                     onSearch={this.handleSearch}
                   />
                   <Charts
diff --git a/src/sentry/static/sentry/app/views/performance/transactionSummary/content.tsx b/src/sentry/static/sentry/app/views/performance/transactionSummary/content.tsx
index 7136544ae4..26c76a2225 100644
--- a/src/sentry/static/sentry/app/views/performance/transactionSummary/content.tsx
+++ b/src/sentry/static/sentry/app/views/performance/transactionSummary/content.tsx
@@ -96,6 +96,7 @@ class SummaryContent extends React.Component<Props> {
               organization={organization}
               projectIds={eventView.project}
               query={query}
+              fields={eventView.fields}
               onSearch={this.handleSearch}
             />
             <TransactionSummaryCharts
