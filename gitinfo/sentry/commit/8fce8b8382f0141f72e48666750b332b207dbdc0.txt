commit 8fce8b8382f0141f72e48666750b332b207dbdc0
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Aug 26 17:04:26 2014 +0000

    Force a data dict to be all utf8 all the time

diff --git a/src/sentry/interfaces/http.py b/src/sentry/interfaces/http.py
index f13a957fae..9c6e8dd99d 100644
--- a/src/sentry/interfaces/http.py
+++ b/src/sentry/interfaces/http.py
@@ -34,6 +34,13 @@ def format_cookies(value):
     )
 
 
+def format_body(value):
+    return dict(
+        (k.encode('utf8'), v.encode('utf8'))
+        for k, v in value.iteritems()
+    )
+
+
 class Http(Interface):
     """
     The Request information is stored in the Http interface. Two arguments
@@ -205,7 +212,7 @@ class Http(Interface):
             bits.append('-X' + method)
             data = self.data
             if isinstance(data, dict):
-                data = urlencode(data)
+                data = urlencode(format_body(data))
             if isinstance(data, basestring):
                 bits.append('--data ' + quote(data))
         bits.append(quote(self.full_url))
diff --git a/tests/sentry/interfaces/test_http.py b/tests/sentry/interfaces/test_http.py
index afa1dc765e..4e8b29645d 100644
--- a/tests/sentry/interfaces/test_http.py
+++ b/tests/sentry/interfaces/test_http.py
@@ -143,3 +143,11 @@ class HttpTest(TestCase):
             data='foo=bar&a=b',
         ))
         assert result.to_curl() == "curl -XPOST --data 'foo=bar&a=b' 'http://example.com?foo=bar' -H 'X-Foo-Bar: baz' -H 'Cookie: foo=bar' -H 'Accept-Encoding: deflate, gzip' --compressed"
+
+    def test_to_curl_post_with_unicode(self):
+        result = Http.to_python(dict(
+            method='POST',
+            url='http://example.com',
+            data={u'föo': u'bär'},
+        ))
+        assert result.to_curl() == "curl -XPOST --data f%C3%B6o=b%C3%A4r http://example.com"
