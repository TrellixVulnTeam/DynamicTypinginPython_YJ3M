commit 922bd5243a9ce3d60310934beeff56b4708f8ee9
Author: Anton Ovchinnikov <anton@tonyo.info>
Date:   Tue Jul 30 14:32:24 2019 +0200

    fix: Sampling options for publishing raw events to Kafka (#14201)

diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index f182287554..91dca7a11c 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -354,16 +354,20 @@ class APIView(BaseView):
         Sends raw event data to Kafka for later offline processing.
         """
         try:
+            raw_event_sample_rate = options.get('kafka-publisher.raw-event-sample-rate')
+
+            # Early return if sampling is disabled
+            if raw_event_sample_rate == 0:
+                return
+
             # This may fail when we e.g. send a multipart form. We ignore those errors for now.
             data = request.body
 
-            max_event_size = options.get('kafka-publisher.raw-event-sample-rate')
-            if not data or max_event_size is None or len(data) > max_event_size:
+            if not data or len(data) > options.get('kafka-publisher.max-event-size'):
                 return
 
             # Sampling
-            raw_event_sample_rate = options.get('kafka-publisher.max-event-size')
-            if raw_event_sample_rate is None or random.random() >= raw_event_sample_rate:
+            if random.random() >= raw_event_sample_rate:
                 return
 
             # We want to send only serializable items from request.META
