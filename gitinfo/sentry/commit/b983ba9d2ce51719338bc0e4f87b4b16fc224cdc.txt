commit b983ba9d2ce51719338bc0e4f87b4b16fc224cdc
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Feb 2 21:23:41 2013 -0800

    More improvements/fixes for logging

diff --git a/src/sentry/coreapi.py b/src/sentry/coreapi.py
index 4e3e8f7276..44a68f28c5 100644
--- a/src/sentry/coreapi.py
+++ b/src/sentry/coreapi.py
@@ -86,31 +86,21 @@ class APITimestampExpired(APIError):
     http_status = 410
 
 
-def client_metadata(client=None, exception=None, **kwargs):
-    data = {
-        'extra': {
-            'client': client,
-        },
-        'tags': {
-            'client': client,
-        },
-    }
-    if exception:
-        data['tags']['exc_type'] = type(exception).__name__
+def client_metadata(client=None, exception=None, tags=None, extra=None):
+    if not extra:
+        extra = {}
+    if not tags:
+        tags = {}
 
-    if env.request:
-        user = env.request.user
-        data['sentry.interfaces.User'] = {
-            'id': user.id,
-            'email': user.email,
-            'username': user.username,
-        }
+    extra['client'] = client
+    extra['request'] = env.request
+    extra['tags'] = tags
 
-    data['extra'].update(kwargs.pop('extra', {}))
-    data['tags'].update(kwargs.pop('tags', {}))
-    data.update(kwargs)
+    tags['client'] = client
+    if exception:
+        tags['exc_type'] = type(exception).__name__
 
-    return {'extra': data}
+    return {'extra': extra}
 
 
 def extract_auth_vars(request):
@@ -355,7 +345,7 @@ def validate_data(project, data, client=None):
 
         value = data.pop(k)
         try:
-            inst = interface(**data.pop(k))
+            inst = interface(**value)
             inst.validate()
             data[import_path] = inst.serialize()
         except Exception, e:
