commit aa68689b84e99a452c50e70833301a0637a86165
Author: Eric Feng <ehfeng@users.noreply.github.com>
Date:   Fri May 26 15:50:09 2017 -0700

    Fixing notification on-boarding task and adding alert rule signal (#5397)
    
    * fixing notification onboarding task to adjust for jess' migration to sentry-plugins for Slack, and other notification integrations
    
    * adding alert rule signal
    
    * responding to jess' comments
    
    * addressing @macqueen's comment that this signal should be moved to the api endpoint instead of the model's save method

diff --git a/src/sentry/api/endpoints/project_plugin_details.py b/src/sentry/api/endpoints/project_plugin_details.py
index 08e9273ad6..2b78076d58 100644
--- a/src/sentry/api/endpoints/project_plugin_details.py
+++ b/src/sentry/api/endpoints/project_plugin_details.py
@@ -15,6 +15,7 @@ from sentry.api.serializers import serialize
 from sentry.api.serializers.models.plugin import (
     PluginSerializer, PluginWithConfigSerializer, serialize_field
 )
+from sentry.signals import plugin_enabled
 
 ERR_ALWAYS_ENABLED = 'This plugin is always enabled.'
 ERR_FIELD_REQUIRED = 'This field is required.'
@@ -132,4 +133,6 @@ class ProjectPluginDetailsEndpoint(ProjectEndpoint):
         context = serialize(
             plugin, request.user, PluginWithConfigSerializer(project))
 
+        plugin_enabled.send(plugin=plugin, project=project, user=request.user, sender=self)
+
         return Response(context)
diff --git a/src/sentry/api/endpoints/project_rules.py b/src/sentry/api/endpoints/project_rules.py
index b4e2061d40..36f6876bbb 100644
--- a/src/sentry/api/endpoints/project_rules.py
+++ b/src/sentry/api/endpoints/project_rules.py
@@ -7,6 +7,7 @@ from sentry.api.bases.project import ProjectEndpoint
 from sentry.api.serializers import serialize
 from sentry.api.serializers.rest_framework import RuleSerializer
 from sentry.models import AuditLogEntryEvent, Rule, RuleStatus
+from sentry.signals import alert_rule_created
 
 
 class ProjectRulesEndpoint(ProjectEndpoint):
@@ -60,6 +61,7 @@ class ProjectRulesEndpoint(ProjectEndpoint):
                 event=AuditLogEntryEvent.RULE_ADD,
                 data=rule.get_audit_log_data(),
             )
+            alert_rule_created.send(project=project, rule=rule, sender=self)
 
             return Response(serialize(rule, request.user))
 
diff --git a/src/sentry/receivers/rules.py b/src/sentry/receivers/rules.py
index 3bf5c30459..8a535077a5 100644
--- a/src/sentry/receivers/rules.py
+++ b/src/sentry/receivers/rules.py
@@ -5,22 +5,26 @@ from django.db.models.signals import post_save
 from sentry.models import Project, Rule
 
 
+DEFAULT_RULE_LABEL = 'Send a notification for new events'
+DEFAULT_RULE_DATA = {
+    'match': 'all',
+    'conditions': [
+        {'id': 'sentry.rules.conditions.first_seen_event.FirstSeenEventCondition'},
+    ],
+    'actions': [
+        {'id': 'sentry.rules.actions.notify_event.NotifyEventAction'},
+    ],
+}
+
+
 def create_default_rules(instance, created=True, RuleModel=Rule, **kwargs):
     if not created:
         return
 
     RuleModel.objects.create(
         project=instance,
-        label='Send a notification for new events',
-        data={
-            'match': 'all',
-            'conditions': [
-                {'id': 'sentry.rules.conditions.first_seen_event.FirstSeenEventCondition'},
-            ],
-            'actions': [
-                {'id': 'sentry.rules.actions.notify_event.NotifyEventAction'},
-            ],
-        },
+        label=DEFAULT_RULE_LABEL,
+        data=DEFAULT_RULE_DATA,
     )
 
 
diff --git a/src/sentry/signals.py b/src/sentry/signals.py
index a82151672d..d45ef89a36 100644
--- a/src/sentry/signals.py
+++ b/src/sentry/signals.py
@@ -59,3 +59,4 @@ save_search_created = BetterSignal(providing_args=["project"])
 inbound_filter_toggled = BetterSignal(providing_args=["project"])
 sso_enabled = BetterSignal(providing_args=["organization"])
 data_scrubber_enabled = BetterSignal(providing_args=["organization"])
+alert_rule_created = BetterSignal(providing_args=["project", "rule"])
