commit 38c7774b35e1cc94d23bcde56f5c0e15903bd55a
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 19 11:44:02 2016 -0800

    Handle GroupMeta in bulk project delete

diff --git a/src/sentry/tasks/deletion.py b/src/sentry/tasks/deletion.py
index c99bfb3b4b..51b96a8712 100644
--- a/src/sentry/tasks/deletion.py
+++ b/src/sentry/tasks/deletion.py
@@ -93,7 +93,7 @@ def delete_project(object_id, continuous=True, **kwargs):
     from sentry.models import (
         Project, ProjectKey, ProjectStatus, TagKey, TagValue, GroupTagKey,
         GroupTagValue, Activity, EventMapping, Group, GroupEmailThread,
-        GroupRuleStatus, GroupHash, GroupSeen, UserReport
+        GroupRuleStatus, GroupHash, GroupMeta, GroupSeen, UserReport
     )
 
     try:
@@ -121,6 +121,15 @@ def delete_project(object_id, continuous=True, **kwargs):
                 delete_project.delay(object_id=object_id, countdown=15)
             return
 
+    # TODO(dcramer): GroupMeta has no project relation so we cant easily bulk
+    # delete today
+    has_more = delete_objects([GroupMeta], relation={'group__project': p},
+                              logger=logger)
+    if has_more:
+        if continuous:
+            delete_project.delay(object_id=object_id, countdown=15)
+        return
+
     has_more = delete_events(relation={'project_id': p.id}, logger=logger)
     if has_more:
         if continuous:
diff --git a/tests/sentry/tasks/test_deletion.py b/tests/sentry/tasks/test_deletion.py
index 954dd23283..e87ff0510a 100644
--- a/tests/sentry/tasks/test_deletion.py
+++ b/tests/sentry/tasks/test_deletion.py
@@ -4,8 +4,8 @@ from mock import patch
 
 from sentry.exceptions import DeleteAborted
 from sentry.models import (
-    GroupTagKey, GroupTagValue, Organization, OrganizationStatus, Project,
-    ProjectStatus, TagKey, TagValue, Team, TeamStatus
+    GroupMeta, GroupTagKey, GroupTagValue, Organization, OrganizationStatus,
+    Project, ProjectStatus, TagKey, TagValue, Team, TeamStatus
 )
 from sentry.tasks.deletion import (
     delete_organization, delete_project, delete_tag_key, delete_team
@@ -77,6 +77,8 @@ class DeleteProjectTest(TestCase):
             name='test',
             status=ProjectStatus.PENDING_DELETION,
         )
+        group = self.create_group(project=project)
+        GroupMeta.objects.create(group=group, key='foo', value='bar')
 
         with self.tasks():
             delete_project(object_id=project.id)
