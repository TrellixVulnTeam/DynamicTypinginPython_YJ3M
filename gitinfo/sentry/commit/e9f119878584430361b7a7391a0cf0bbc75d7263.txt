commit e9f119878584430361b7a7391a0cf0bbc75d7263
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Dec 15 16:03:55 2012 -0800

    Add basic team page for projects

diff --git a/src/sentry/templates/sentry/projects/manage.html b/src/sentry/templates/sentry/projects/manage.html
index 8da6bfa41c..3460c0557e 100644
--- a/src/sentry/templates/sentry/projects/manage.html
+++ b/src/sentry/templates/sentry/projects/manage.html
@@ -54,51 +54,6 @@
                 {% endif %}
             </div>
         </form>
-        {% if member_list or can_add_member %}
-            <div class="page-header" id="members">
-                {% if can_add_member %}
-                    <a href="{% url sentry-new-team-member project.slug %}" class="btn pull-right btn-primary">{% trans "New Member" %}</a>
-                {% endif %}
-                <h2>{% trans "Members" %}</h2>
-            </div>
-            {% if project.team %}
-                {% url sentry-manage-team project.team.slug as link %}
-                <p>{% blocktrans with project.team.name as team_name %}You can manage project membership on the <a href="{{ link }}">team settings page for {{ team_name }}</a>.{% endblocktrans %}<p>
-            {% endif %}
-            {% if member_list %}
-                <table class="table table-bordered table-striped">
-                    <colgroup>
-                        <col/>
-                        <col width="100px"/>
-                    </colgroup>
-                    <thead>
-                        <tr>
-                            <th>{% trans "User" %}</th>
-                            <th style="text-align:center">{% trans "Access" %}</th>
-                        </tr>
-                    </thead>
-                    <tbody>
-                        {% for member, user in member_list %}
-                            <tr>
-                                <td>
-                                    <a href="{# {% url sentry-view-project-member project.slug member.pk %} #}">{{ user.username }}</a><br>
-                                    {{ user.email }}
-                                </td>
-                                <td style="text-align:center;">
-                                    {% if user == project.team.owner %}
-                                        {% trans "Owner" %}
-                                    {% else %}
-                                        {{ member.get_type_display }}
-                                    {% endif %}
-                                </td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            {% else %}
-                <p>{% trans "There are no members of this project." %}</p>
-            {% endif %}
-        {% endif %}
     {% endblock %}
     </section>
     <script>
@@ -112,8 +67,13 @@
     <ul class="nav nav-list">
         <li class="nav-header">{% trans "Project" %}</li>
         <li{% if page == 'details' %} class="active"{% endif %}>
-            <a href="{% url sentry-manage-project project.slug %}">{% trans "Details" %}</a>
+            <a href="{% url sentry-manage-project project.slug %}">{% trans "Settings" %}</a>
         </li>
+        {% if project.team %}
+            <li{% if page == 'team' %} class="active"{% endif %}>
+                <a href="{% url sentry-manage-project-team project.slug %}">{% trans "Team" %}</a>
+            </li>
+        {% endif %}
         <li{% if page == 'tags' %} class="active"{% endif %}>
             <a href="{% url sentry-manage-project-tags project.slug %}">{% trans "Tags" %}</a>
         </li>
@@ -142,7 +102,7 @@
     {% with project|get_plugins as plugins %}
         {% if plugins %}
             <ul class="nav nav-list">
-                <li class="nav-header">Plugins</li>
+                <li class="nav-header">{% trans "Active Plugins" %}</li>
                 {% for p in plugins %}
                     <li{% if page == 'plugin' and plugin.slug == p.slug %} class="active"{% endif %}>
                         <a href="{% url sentry-configure-project-plugin project.slug p.slug %}">{{ p.get_title }}</a>
diff --git a/src/sentry/templates/sentry/projects/team.html b/src/sentry/templates/sentry/projects/team.html
new file mode 100644
index 0000000000..029026196d
--- /dev/null
+++ b/src/sentry/templates/sentry/projects/team.html
@@ -0,0 +1,116 @@
+{% extends "sentry/projects/manage.html" %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+{% load sentry_plugins %}
+
+{% block title %}{% trans "Manage Team" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    {{ block.super }}
+    <li class="divider">/</li>
+    <li><a href="{% url sentry-manage-project-team project.slug %}">{% trans "Manage Team" %}</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        {% if can_add_member %}
+            <a href="{% url sentry-new-team-member team.slug %}" class="btn pull-right btn-primary">{% trans "New Member" %}</a>
+        {% endif %}
+        <h2>
+            {% trans "Manage Team" %}
+            <small><a href="{% url sentry-manage-team team.slug %}">{{ team.name }}</a></small>
+        </h2>
+    </div>
+    <ul class="nav nav-tabs">
+        <li class="active"><a href="#members" data-toggle="tab">{% trans "Members" %}</a></li>
+        <li><a href="#pending-members" data-toggle="tab">{% blocktrans with pending_member_list|length as count %}Pending ({{ count }}){% endblocktrans %}</a></li>
+    </ul>
+    <div class="tab-content">
+        <div class="tab-pane active" id="members">
+            <table class="table table-bordered table-striped">
+                <colgroup>
+                    <col/>
+                    <col width="100px"/>
+                    <col width="90px"/>
+                    <col width="90px"/>
+                </colgroup>
+                <thead>
+                    <tr>
+                        <th>{% trans "User" %}</th>
+                        <th style="text-align:center">{% trans "Access" %}</th>
+                        <th colspan="2" style="text-align:center">{% trans "Actions" %}</th>
+                    </tr>
+                </thead>
+                <tbody>
+                    {% for member, user in member_list %}
+                        <tr>
+                            <td>
+                                <a href="{% url sentry-edit-team-member team.slug member.pk %}">{{ user.username }}</a><br>
+                                {{ user.email }}
+                            </td>
+                            <td style="text-align:center;">
+                                {% if user == team.owner %}
+                                    {% trans "Owner" %}
+                                {% else %}
+                                    {{ member.get_type_display }}
+                                {% endif %}
+                            </td>
+                            {% if user == team.owner %}
+                                <td style="text-align:center;" colspan="2">
+                                    <em>{% trans "unavailable for owner" %}</em>
+                                </td>
+                            {% else %}
+                                <td style="text-align:center;">
+                                    <a href="{% url sentry-remove-team-member team.slug member.pk %}" class="btn btn-danger btn-small">{% trans "Remove" %}</a>
+                                </td>
+                                <td style="text-align:center;">
+                                    {% if member.is_active %}
+                                        <a href="{% url sentry-suspend-team-member team.slug member.pk %}" class="btn btn-small">{% trans "Suspend" %}</a>
+                                    {% else %}
+                                        <a href="{% url sentry-restore-team-member team.slug member.pk %}" class="btn btn-small">{% trans "Restore" %}</a>
+                                    {% endif %}
+                                </td>
+                            {% endif %}
+                        </tr>
+                    {% endfor %}
+                </tbody>
+            </table>
+        </div>
+        <div class="tab-pane" id="pending-members">
+            <table class="table table-bordered table-striped">
+                <colgroup>
+                    <col/>
+                    <col width="100px"/>
+                    <col width="90px"/>
+                    <col width="90px"/>
+                </colgroup>
+                <thead>
+                    <tr>
+                        <th>{% trans "User" %}</th>
+                        <th style="text-align:center">{% trans "Access" %}</th>
+                        <th style="text-align:center" colspan="2">{% trans "Actions" %}</th>
+                    </tr>
+                </thead>
+                <tbody>
+                    {% for member, email in pending_member_list %}
+                        <tr>
+                            <td>
+                                {{ email }}
+                            </td>
+                            <td style="text-align:center;">
+                                {{ member.get_type_display }}
+                            </td>
+                            <td style="text-align:center;">
+                                <a href="{% url sentry-remove-pending-team-member team.slug member.pk %}" class="btn btn-small btn-danger">{% trans "Remove" %}</a>
+                            </td>
+                            <td style="text-align:center;">
+                                <a href="{% url sentry-reinvite-pending-team-member team.slug member.pk %}" class="btn btn-small">{% trans "Resend" %}</a>
+                            </td>
+                        </tr>
+                    {% endfor %}
+                </tbody>
+            </table>
+        </div>
+    </div>
+{% endblock %}
diff --git a/src/sentry/web/frontend/projects.py b/src/sentry/web/frontend/projects.py
index d0098f65d4..ffa2d6eb68 100644
--- a/src/sentry/web/frontend/projects.py
+++ b/src/sentry/web/frontend/projects.py
@@ -12,7 +12,8 @@ from django.views.decorators.csrf import csrf_protect
 
 from sentry.constants import MEMBER_OWNER, MEMBER_USER
 from sentry.models import TeamMember, ProjectKey, Team, FilterKey
-from sentry.permissions import can_create_projects, can_remove_project, can_create_teams
+from sentry.permissions import can_create_projects, can_remove_project, can_create_teams, \
+  can_add_team_member
 from sentry.plugins import plugins
 from sentry.plugins.helpers import set_option, get_option
 from sentry.web.decorators import login_required, has_access
@@ -166,6 +167,25 @@ def manage_project(request, project):
         set_option('sentry:origins', form.cleaned_data.get('origins') or [], project)
         return HttpResponseRedirect(request.path + '?success=1')
 
+    context = csrf(request)
+    context.update({
+        'can_remove_project': can_remove_project(request.user, project),
+        'page': 'details',
+        'form': form,
+        'project': project,
+        'TEAM_LIST': team_list.values(),
+    })
+
+    return render_to_response('sentry/projects/manage.html', context, request)
+
+
+@has_access(MEMBER_OWNER)
+@csrf_protect
+def manage_project_team(request, project):
+    result = plugins.first('has_perm', request.user, 'edit_project', project)
+    if result is False and not request.user.has_perm('sentry.can_change_project'):
+        return HttpResponseRedirect(reverse('sentry'))
+
     if not project.team:
         member_list = []
     else:
@@ -173,15 +193,14 @@ def manage_project(request, project):
 
     context = csrf(request)
     context.update({
-        'can_remove_project': can_remove_project(request.user, project),
-        'page': 'details',
-        'form': form,
+        'page': 'team',
         'project': project,
+        'team': project.team,
         'member_list': member_list,
-        'TEAM_LIST': team_list.values(),
+        'can_add_member': can_add_team_member(request.user, project.team),
     })
 
-    return render_to_response('sentry/projects/manage.html', context, request)
+    return render_to_response('sentry/projects/team.html', context, request)
 
 
 @has_access(MEMBER_USER)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index ce032e3b5b..448d32e796 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -77,6 +77,8 @@ urlpatterns = patterns('',
     url(r'^account/projects/new/$', projects.new_project, name='sentry-new-project'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/edit/$', projects.manage_project,
         name='sentry-manage-project'),
+    url(r'^account/projects/(?P<project_id>[\w_-]+)/team/$', projects.manage_project_team,
+        name='sentry-manage-project-team'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/tags/$', projects.manage_project_tags,
         name='sentry-manage-project-tags'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/docs/$', projects.client_help,
