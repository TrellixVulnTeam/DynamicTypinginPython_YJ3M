commit c05690948606cd22b8889a05c8a2fec69b857d5c
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jun 6 01:26:07 2012 -0700

    Dont render dashboard components server-side

diff --git a/sentry/templates/sentry/dashboard.html b/sentry/templates/sentry/dashboard.html
index 13256c12ba..fa23975ccf 100644
--- a/sentry/templates/sentry/dashboard.html
+++ b/sentry/templates/sentry/dashboard.html
@@ -31,19 +31,9 @@
                 </ul>
             </div>
             <div class="tab-content">
-                <div class="tab-pane active" id="top_15m">
-                    {% if top_event_list %}
-                        <ul class="events">
-                            {% for group in top_event_list %}
-                                {% include "sentry/partial/_group_small.html" %}
-                            {% endfor %}
-                        </ul>
-                    {% else %}
-                        <p>{% trans "No unresolved events are listed in the time period selected." %}</p>
-                    {% endif %}
-                </div>
+                <div class="tab-pane" id="top_15m"></div>
                 <div class="tab-pane" id="top_60m"></div>
-                <div class="tab-pane" id="top_24h"></div>
+                <div class="tab-pane active" id="top_24h"><p>Loading ...</p></div>
             </div>
             <div class="page-header">
                 <h3 class="pull-left">{% trans "New Events" %}</h3>
@@ -54,19 +44,9 @@
                 </ul>
             </div>
             <div class="tab-content">
-                <div class="tab-pane active" id="new_15m">
-                    {% if new_event_list %}
-                        <ul class="events">
-                            {% for group in new_event_list %}
-                                {% include "sentry/partial/_group_small.html" %}
-                            {% endfor %}
-                        </ul>
-                    {% else %}
-                        <p>{% trans "No unresolved events are listed in the time period selected." %}</p>
-                    {% endif %}
-                </div>
+                <div class="tab-pane" id="new_15m"></div>
                 <div class="tab-pane" id="new_60m"></div>
-                <div class="tab-pane" id="new_24h"></div>
+                <div class="tab-pane active" id="new_24h"><p>Loading ...</p></div>
             </div>
         {% else %}
             {% if can_create_projects %}
@@ -111,37 +91,46 @@
     $(document).ready(function() {
         Sentry.charts.render('#chart');
         //load content for first tab and initialize
-        $('a[data-toggle=ajtab]').bind('click', function(e) {
-            var $el = $(e.target);
-            var uri = $el.attr('data-uri');
-            if (!uri) {
-                return;
-            }
-            var $tab = $(this);
-            var $cont = $($tab.attr('href'));
-            var $parent = $cont.parent();
+        $('a[data-toggle=ajtab]').each(function(){
+            var $el = $(this);
 
-            $parent.css('opacity', .6)
-            e.preventDefault()
+            $el.bind('click', function(e) {
+                var $el = $(e.target);
+                var uri = $el.attr('data-uri');
+                if (!uri) {
+                    return;
+                }
+                var $tab = $(this);
+                var $cont = $($tab.attr('href'));
+                var $parent = $cont.parent();
 
-            // load content for selected tab
-            $.ajax({
-                url: uri,
-                dataType: 'json',
-                success: function(data){
-                    if (data.length) {
-                        var $ul = $('<ul class="events"></ul>');
-                        $.each(data, function(_, group){
-                            $ul.append($(group.html));
-                        });
-                        $cont.html($ul);
-                    } else {
-                        $cont.html('<p>{% trans "No unresolved events are listed in the time period selected." %}</p>');
+                $parent.css('opacity', .6)
+                e.preventDefault()
+
+                // load content for selected tab
+                $.ajax({
+                    url: uri,
+                    dataType: 'json',
+                    success: function(data){
+                        if (data.length) {
+                            var $ul = $('<ul class="events"></ul>');
+                            $.each(data, function(_, group){
+                                $ul.append($(group.html));
+                            });
+                            $cont.html($ul);
+                        } else {
+                            $cont.html('<p>{% trans "No unresolved events are listed in the time period selected." %}</p>');
+                        }
+                        console.log($cont);
+                        $parent.css('opacity', 1)
+                        $tab.tab('show');
                     }
-                    $parent.css('opacity', 1)
-                    $tab.tab('show');
-                }
+                });
             });
+    
+            if ($el.parent().hasClass('active')) {
+                $el.click();
+            }
         });
     });
     </script>
diff --git a/sentry/web/api.py b/sentry/web/api.py
index 448a5fcac3..a53f3abb0e 100644
--- a/sentry/web/api.py
+++ b/sentry/web/api.py
@@ -362,14 +362,14 @@ def get_group_trends(request, project=None):
     limit = min(100, int(request.REQUEST.get('limit', 10)))
 
     if project:
-        project_list = [project]
+        project_dict = {project.pk: project}
     else:
-        project_list = get_project_list(request.user).values()
+        project_dict = get_project_list(request.user)
 
     base_qs = Group.objects.filter(
-        project__in=project_list,
+        project__in=project_dict.keys(),
         status=0,
-    ).select_related('project').order_by('-score')
+    ).order_by('-score')
 
     if has_trending():
         group_list = list(Group.objects.get_accelerated(base_qs, minutes=(
@@ -383,6 +383,9 @@ def get_group_trends(request, project=None):
             last_seen__gte=cutoff_dt
         )[:limit])
 
+    for group in group_list:
+        group._project_cache = project_dict.get(group.project_id)
+
     data = transform_groups(request, group_list, template='sentry/partial/_group_small.html')
 
     response = HttpResponse(json.dumps(data))
diff --git a/sentry/web/frontend/generic.py b/sentry/web/frontend/generic.py
index 122ea7c3ce..6d00f9aab0 100644
--- a/sentry/web/frontend/generic.py
+++ b/sentry/web/frontend/generic.py
@@ -5,19 +5,13 @@ sentry.web.frontend.generic
 :copyright: (c) 2010-2012 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
-import datetime
-
 from django.http import HttpResponseRedirect, Http404, HttpResponseNotModified, \
   HttpResponse
 
 from sentry.conf import settings
-from sentry.models import Group
 from sentry.web.decorators import login_required
 from sentry.web.helpers import get_project_list, render_to_response, \
   get_login_url
-from sentry.utils.db import has_trending
-
-DASHBOARD_EVENTS = 5
 
 
 @login_required
@@ -26,30 +20,7 @@ def dashboard(request):
     if len(project_list) == 0 and not request.user.is_authenticated():
         return HttpResponseRedirect(get_login_url())
 
-    if project_list:
-        cutoff = datetime.datetime.now() - datetime.timedelta(days=1)
-        base_qs = Group.objects.filter(
-            project__in=project_list.values(),
-            status=0,
-        ).select_related('project').order_by('-score')
-
-        if has_trending():
-            top_event_list = list(Group.objects.get_accelerated(base_qs, minutes=60 * 24)[:DASHBOARD_EVENTS])
-        else:
-            top_event_list = list(base_qs.filter(
-                last_seen__gte=cutoff
-            )[:DASHBOARD_EVENTS])
-
-        new_event_list = list(base_qs.filter(
-            active_at__gte=cutoff,
-        )[:DASHBOARD_EVENTS])
-    else:
-        top_event_list = None
-        new_event_list = None
-
     return render_to_response('sentry/dashboard.html', {
-        'top_event_list': top_event_list,
-        'new_event_list': new_event_list,
     }, request)
 
 
diff --git a/setup.py b/setup.py
index e9f699b158..258a756adf 100755
--- a/setup.py
+++ b/setup.py
@@ -72,7 +72,7 @@ dependency_links = [
 
 setup(
     name='sentry',
-    version='4.5.6',
+    version='4.5.7',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/sentry',
