commit 98c2f175cbb42f00dfea1d2127152f3699101b7b
Author: Stephen Cefali <scefali@sentry.io>
Date:   Tue Jun 2 15:54:11 2020 -0700

    fix(plugins) change logic when to render data fowarding graph (#19143)

diff --git a/src/sentry/static/sentry/app/views/settings/projectDataForwarding.jsx b/src/sentry/static/sentry/app/views/settings/projectDataForwarding.tsx
similarity index 80%
rename from src/sentry/static/sentry/app/views/settings/projectDataForwarding.jsx
rename to src/sentry/static/sentry/app/views/settings/projectDataForwarding.tsx
index f060a692a3..648fcf55f4 100644
--- a/src/sentry/static/sentry/app/views/settings/projectDataForwarding.jsx
+++ b/src/sentry/static/sentry/app/views/settings/projectDataForwarding.tsx
@@ -1,4 +1,5 @@
 import React from 'react';
+import {RouteComponentProps} from 'react-router/lib/Router';
 
 import {Panel, PanelBody, PanelHeader} from 'app/components/panels';
 import {t, tct} from 'app/locale';
@@ -14,11 +15,22 @@ import SettingsPageHeader from 'app/views/settings/components/settingsPageHeader
 import StackedBarChart from 'app/components/stackedBarChart';
 import TextBlock from 'app/views/settings/components/text/textBlock';
 import withOrganization from 'app/utils/withOrganization';
-import withProjects from 'app/utils/withProjects';
+import withProject from 'app/utils/withProject';
 import SentryDocumentTitle from 'app/components/sentryDocumentTitle';
+import {Organization, Plugin, Project} from 'app/types';
 
-class DataForwardingStats extends AsyncComponent {
-  getEndpoints() {
+type RouteParams = {projectId: string; orgId: string};
+
+type StatProps = {
+  params: RouteParams;
+};
+
+type StatState = AsyncComponent['state'] & {
+  stats: Array<{x: number; y: [number]}>;
+};
+
+class DataForwardingStats extends AsyncComponent<StatProps, StatState> {
+  getEndpoints(): [[string, string, object]] {
     const {orgId, projectId} = this.props.params;
     const until = Math.floor(new Date().getTime() / 1000);
     const since = until - 3600 * 24 * 30;
@@ -37,14 +49,16 @@ class DataForwardingStats extends AsyncComponent {
 
   renderBody() {
     const {projectId} = this.props.params;
+    //y is an array of size one which denotes how many events were forwarded in that period
     const stats = this.state.stats.map(p => ({x: p[0], y: [p[1]]}));
+    const fowardedAny = stats.some(({y}) => y[0]);
 
     return (
       <Panel>
         <SentryDocumentTitle title={t('Data Forwarding')} objSlug={projectId} />
         <PanelHeader>{t('Forwarded events in the last 30 days (by day)')}</PanelHeader>
         <PanelBody>
-          {stats.length > 0 && stats[0][0] ? (
+          {fowardedAny ? (
             <StackedBarChart
               style={{
                 border: 'none',
@@ -67,8 +81,17 @@ class DataForwardingStats extends AsyncComponent {
   }
 }
 
-class ProjectDataForwarding extends AsyncComponent {
-  getEndpoints() {
+type Props = RouteComponentProps<RouteParams, {}> & {
+  organization: Organization;
+  project: Project;
+};
+
+type State = AsyncComponent['state'] & {
+  plugins: Plugin[];
+};
+
+class ProjectDataForwarding extends AsyncComponent<Props, State> {
+  getEndpoints(): [[string, string]] {
     const {orgId, projectId} = this.props.params;
 
     return [['plugins', `/projects/${orgId}/${projectId}/plugins/`]];
@@ -80,7 +103,7 @@ class ProjectDataForwarding extends AsyncComponent {
     );
   }
 
-  updatePlugin(plugin, enabled) {
+  updatePlugin(plugin: Plugin, enabled: boolean) {
     const plugins = this.state.plugins.map(p => ({
       ...p,
       enabled: p.id === plugin.id ? enabled : p.enabled,
@@ -89,8 +112,8 @@ class ProjectDataForwarding extends AsyncComponent {
     this.setState({plugins});
   }
 
-  onEnablePlugin = plugin => this.updatePlugin(plugin, true);
-  onDisablePlugin = plugin => this.updatePlugin(plugin, false);
+  onEnablePlugin = (plugin: Plugin) => this.updatePlugin(plugin, true);
+  onDisablePlugin = (plugin: Plugin) => this.updatePlugin(plugin, false);
 
   renderBody() {
     const {params, organization, project} = this.props;
@@ -166,4 +189,4 @@ class ProjectDataForwarding extends AsyncComponent {
   }
 }
 
-export default withProjects(withOrganization(ProjectDataForwarding));
+export default withProject(withOrganization(ProjectDataForwarding));
