commit 6afec111b632496338613b3bed8b929f266a6779
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Nov 24 11:32:03 2012 -0800

    Improve api error handling

diff --git a/src/sentry/services/udp.py b/src/sentry/services/udp.py
index 9bcb4b8270..8885cf09a7 100644
--- a/src/sentry/services/udp.py
+++ b/src/sentry/services/udp.py
@@ -30,7 +30,11 @@ def handle_sentry(data, address):
         except ValueError:
             raise APIError('missing auth header')
 
-        auth_vars = parse_auth_header(auth_header)
+        try:
+            auth_vars = parse_auth_header(auth_header)
+        except (ValueError, IndexError):
+            raise APIError('invalid auth header')
+
         project = project_from_auth_vars(auth_vars)
 
         client = auth_vars.get('sentry_client')
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index 421d06443d..1c6dd64988 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -80,7 +80,10 @@ class APIView(BaseView):
         return None
 
     def _parse_header(self, request, project):
-        auth_vars = extract_auth_vars(request)
+        try:
+            auth_vars = extract_auth_vars(request)
+        except (IndexError, ValueError):
+            raise APIError('Invalid auth header')
 
         if not auth_vars:
             raise APIError('Client/server version mismatch: Unsupported client')
@@ -92,7 +95,7 @@ class APIView(BaseView):
             raise APIError('Client/server version mismatch: Unsupported protocol version (%s)' % server_version)
 
         if not client:
-            raise APIError('Client request error: Missing client version identifier.')
+            raise APIError('Client request error: Missing client version identifier')
 
         return auth_vars
 
