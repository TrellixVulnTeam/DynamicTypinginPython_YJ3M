commit 23738f6151ce2c866d2f97811494bc3f7a65aded
Author: Ben Vinegar <ben.vinegar@gmail.com>
Date:   Fri Feb 16 12:47:46 2018 -0800

    feat(ui): Add "environments" sidebar link to new project settings (#7288)
    
    * feat(ui): Add "environments" sidebar link to new project settings
    
    * Remove console.log
    
    * Remove (now) unnecessary org context declaration

diff --git a/src/sentry/static/sentry/app/utils/__mocks__/recreateRoute.jsx b/src/sentry/static/sentry/app/utils/__mocks__/recreateRoute.jsx
new file mode 100644
index 0000000000..edde9f5672
--- /dev/null
+++ b/src/sentry/static/sentry/app/utils/__mocks__/recreateRoute.jsx
@@ -0,0 +1,3 @@
+let mockFn = jest.fn();
+
+export default mockFn;
diff --git a/src/sentry/static/sentry/app/views/projectEnvironments.jsx b/src/sentry/static/sentry/app/views/projectEnvironments.jsx
index 23c4705d60..ab22d939eb 100644
--- a/src/sentry/static/sentry/app/views/projectEnvironments.jsx
+++ b/src/sentry/static/sentry/app/views/projectEnvironments.jsx
@@ -14,6 +14,7 @@ import Button from '../components/buttons/button';
 import SettingsPageHeader from './settings/components/settingsPageHeader';
 import ListLink from '../components/listLink';
 import ApiMixin from '../mixins/apiMixin';
+import recreateRoute from '../utils/recreateRoute';
 
 import LoadingIndicator from '../components/loadingIndicator';
 import IndicatorStore from '../stores/indicatorStore';
@@ -26,8 +27,10 @@ import {
 const ProjectEnvironments = createReactClass({
   propTypes: {
     route: PropTypes.object,
+    routes: PropTypes.array,
     params: PropTypes.object,
   },
+
   mixins: [ApiMixin, Reflux.listenTo(EnvironmentStore, 'onEnvironmentsChange')],
 
   getInitialState() {
@@ -139,24 +142,30 @@ const ProjectEnvironments = createReactClass({
 
   render() {
     const {environments} = this.state;
-    const {orgId, projectId} = this.props.params;
+    const {routes, params} = this.props;
 
     if (environments === null) {
       return <LoadingIndicator />;
     }
 
+    const baseUrl = recreateRoute('', {routes, params, stepBack: -1});
     return (
       <div>
         <SettingsPageHeader
           title={t('Manage Environments')}
           tabs={
             <ul className="nav nav-tabs" style={{borderBottom: '1px solid #ddd'}}>
-              <ListLink to={`/${orgId}/${projectId}/settings/environments/`} index={true}>
+              <ListLink
+                to={`${baseUrl}environments/`}
+                index={true}
+                isActive={() => !this.state.isHidden}
+              >
                 {t('Environments')}
               </ListLink>
               <ListLink
-                to={`/${orgId}/${projectId}/settings/environments/hidden/`}
+                to={`${baseUrl}environments/hidden/`}
                 index={true}
+                isActive={() => this.state.isHidden}
               >
                 {t('Hidden')}
               </ListLink>
diff --git a/src/sentry/static/sentry/app/views/settings/project/navigationConfiguration.jsx b/src/sentry/static/sentry/app/views/settings/project/navigationConfiguration.jsx
index a2a72243f1..fb17597f06 100644
--- a/src/sentry/static/sentry/app/views/settings/project/navigationConfiguration.jsx
+++ b/src/sentry/static/sentry/app/views/settings/project/navigationConfiguration.jsx
@@ -30,6 +30,10 @@ export default function getConfiguration({project}) {
           path: `${pathPrefix}/tags/`,
           title: t('Tags'),
         },
+        {
+          path: `${pathPrefix}/environments/`,
+          title: t('Environments'),
+        },
         {
           path: `${pathPrefix}/issue-tracking/`,
           title: t('Issue Tracking'),
diff --git a/tests/js/spec/views/__snapshots__/projectEnvironments.spec.jsx.snap b/tests/js/spec/views/__snapshots__/projectEnvironments.spec.jsx.snap
index c4d2c0de10..5bf996903d 100644
--- a/tests/js/spec/views/__snapshots__/projectEnvironments.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/projectEnvironments.spec.jsx.snap
@@ -87,6 +87,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
       "path": "environments/",
     }
   }
+  routes={Array []}
 >
   <div>
     <SettingsPageHeading
@@ -102,6 +103,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/"
           >
             Environments
@@ -109,6 +111,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/hidden/"
           >
             Hidden
@@ -130,6 +133,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/"
             >
               Environments
@@ -137,6 +141,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/hidden/"
             >
               Hidden
@@ -180,10 +185,11 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/"
               >
                 <li
-                  className=""
+                  className="active"
                 >
                   <Link
                     onlyActiveOnIndex={true}
@@ -202,6 +208,7 @@ exports[`ProjectEnvironments render active renders empty message 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/hidden/"
               >
                 <li
@@ -366,6 +373,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
       "path": "environments/",
     }
   }
+  routes={Array []}
 >
   <div>
     <SettingsPageHeading
@@ -381,6 +389,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/"
           >
             Environments
@@ -388,6 +397,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/hidden/"
           >
             Hidden
@@ -409,6 +419,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/"
             >
               Environments
@@ -416,6 +427,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/hidden/"
             >
               Hidden
@@ -459,10 +471,11 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/"
               >
                 <li
-                  className=""
+                  className="active"
                 >
                   <Link
                     onlyActiveOnIndex={true}
@@ -481,6 +494,7 @@ exports[`ProjectEnvironments render active renders environment list 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/hidden/"
               >
                 <li
@@ -775,6 +789,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
       "path": "environments/hidden/",
     }
   }
+  routes={Array []}
 >
   <div>
     <SettingsPageHeading
@@ -790,6 +805,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/"
           >
             Environments
@@ -797,6 +813,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/hidden/"
           >
             Hidden
@@ -818,6 +835,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/"
             >
               Environments
@@ -825,6 +843,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/hidden/"
             >
               Hidden
@@ -868,6 +887,7 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/"
               >
                 <li
@@ -890,10 +910,11 @@ exports[`ProjectEnvironments render hidden renders empty message 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/hidden/"
               >
                 <li
-                  className=""
+                  className="active"
                 >
                   <Link
                     onlyActiveOnIndex={true}
@@ -1054,6 +1075,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
       "path": "environments/hidden/",
     }
   }
+  routes={Array []}
 >
   <div>
     <SettingsPageHeading
@@ -1069,6 +1091,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/"
           >
             Environments
@@ -1076,6 +1099,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
           <ListLink
             activeClassName="active"
             index={true}
+            isActive={[Function]}
             to="/org-slug/project-slug/settings/environments/hidden/"
           >
             Hidden
@@ -1097,6 +1121,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/"
             >
               Environments
@@ -1104,6 +1129,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
             <ListLink
               activeClassName="active"
               index={true}
+              isActive={[Function]}
               to="/org-slug/project-slug/settings/environments/hidden/"
             >
               Hidden
@@ -1147,6 +1173,7 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/"
               >
                 <li
@@ -1169,10 +1196,11 @@ exports[`ProjectEnvironments render hidden renders environment list 1`] = `
               <ListLink
                 activeClassName="active"
                 index={true}
+                isActive={[Function]}
                 to="/org-slug/project-slug/settings/environments/hidden/"
               >
                 <li
-                  className=""
+                  className="active"
                 >
                   <Link
                     onlyActiveOnIndex={true}
diff --git a/tests/js/spec/views/projectEnvironments.spec.jsx b/tests/js/spec/views/projectEnvironments.spec.jsx
index c2339521c1..3fb31747bd 100644
--- a/tests/js/spec/views/projectEnvironments.spec.jsx
+++ b/tests/js/spec/views/projectEnvironments.spec.jsx
@@ -2,8 +2,12 @@ import React from 'react';
 import {mount} from 'enzyme';
 
 import ProjectEnvironments from 'app/views/projectEnvironments';
-
 import EnvironmentStore from 'app/stores/environmentStore';
+import recreateRoute from 'app/utils/recreateRoute';
+
+jest.mock('app/utils/recreateRoute');
+
+recreateRoute.mockReturnValue('/org-slug/project-slug/settings/');
 
 function mountComponent(isHidden) {
   const org = TestStubs.Organization();
@@ -16,6 +20,7 @@ function mountComponent(isHidden) {
         projectId: project.slug,
       }}
       route={{path}}
+      routes={[]}
     />,
     TestStubs.routerContext()
   );
