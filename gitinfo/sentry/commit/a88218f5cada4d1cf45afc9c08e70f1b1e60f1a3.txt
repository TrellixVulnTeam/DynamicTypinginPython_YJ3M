commit a88218f5cada4d1cf45afc9c08e70f1b1e60f1a3
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Sep 18 18:25:10 2014 -0700

    Initial work on modal logkc

diff --git a/src/sentry/static/sentry/app/controllers/projectStream.js b/src/sentry/static/sentry/app/controllers/projectStream.js
index d9a6a72239..f388563dcc 100644
--- a/src/sentry/static/sentry/app/controllers/projectStream.js
+++ b/src/sentry/static/sentry/app/controllers/projectStream.js
@@ -10,6 +10,15 @@
     return '/api/0/projects/' + selectedProject.id + '/groups/?' + $.param(params);
   }
 
+  SentryApp.controller('ProjectStreamActionModalCtrl', [
+    '$scope', '$modalInstance', 'context',
+    function($scope, $modalInstance, context) {
+      $scope.numEvents = context.selectedGroupIds.length;
+      $scope.actionLabel = context.actionLabel;
+      $scope.canActionAll = context.canActionAll;
+    }
+  ]);
+
   SentryApp.controller('ProjectStreamControlsCtrl', [
     '$scope', '$timeout',
     function($scope, $timeout){
@@ -43,8 +52,8 @@
   ]);
 
   SentryApp.controller('ProjectStreamCtrl', [
-    '$http', '$scope', '$timeout', 'Collection', 'GroupModel', 'selectedProject',
-    function($http, $scope, $timeout, Collection, GroupModel, selectedProject) {
+    '$http', '$modal', '$scope', '$timeout', 'Collection', 'GroupModel', 'selectedProject',
+    function($http, $modal, $scope, $timeout, Collection, GroupModel, selectedProject) {
       var timeoutId;
       var pollForChanges = function() {
         var params = app.utils.getQueryParams();
@@ -99,8 +108,39 @@
         $('.stream-actions .chk-select-all').prop('checked', allSelected);
       });
 
+      $('.stream-actions .action-resolve').click(function(e){
+        e.preventDefault();
+
+        var selectedGroupIds = $.map($('.group-list .chk-select:checked'), function(item){
+          return $(item).val();
+        });
+        if (selectedGroupIds.length === 0) {
+          return;
+        }
+
+        var modal = $modal.open({
+          templateUrl: '/templates/action-modal.html',
+          controller: 'ProjectStreamActionModalCtrl',
+          resolve: {
+            context: function(){
+              return {
+                selectAllActive: $scope.selectAllActive,
+                selectedGroupIds: selectedGroupIds,
+                actionLabel: 'Resolve',
+                canActionAll: true
+              };
+            }
+          }
+        });
+        // result.then(function(selectedItem) {
+        //   $scope.selected = selectedItem;
+        // }, function () {
+        //   console.log('Modal dismissed at: ' + new Date());
+        // });
+      });
+
       $('.stream-actions .datepicker-box').click(function(e){
-        e.stopPropagation();
+        e.preventDefault();
       });
 
       // we explicitly avoid $timeout here to prevent the watcher
diff --git a/src/sentry/static/sentry/app/templates/action-modal.html b/src/sentry/static/sentry/app/templates/action-modal.html
new file mode 100644
index 0000000000..cc6f54e5c0
--- /dev/null
+++ b/src/sentry/static/sentry/app/templates/action-modal.html
@@ -0,0 +1,16 @@
+<div class="modal-header">
+  <button type="button" class="close" data-dismiss="modal">
+    <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
+  </button>
+  <h4 class="modal-title">Please confirm</h4>
+</div>
+<div class="modal-body">
+  <p><strong>Are you sure that you want to <% actionLabel.toLowerCase() %> these <% numEvents %> events?</strong></p>
+  <p>This action cannot be undone.</p>
+</div>
+<div class="modal-footer">
+  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
+  <button type="button" class="btn btn-danger"
+          ng-if="canActionAll"><% actionLabel %> all recorded events</button>
+  <button type="button" class="btn btn-primary"><% actionLabel %> <% numEvents %> selected events</button>
+</div>
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index 35d2385672..0102bef147 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -19,8 +19,12 @@
                     <input type="checkbox" class="chk-select-all">
                 </div>
                 <div class="btn-group">
-                    <a class="btn btn-default btn-sm" href="javascript:void(0)" id="sentry-resolve-feed" onclick="Sentry.stream.clear('{{ project.slug }}');"><i aria-hidden="true" class="icon-checkmark"></i></a>
-                    <a href="#" class="btn btn-default btn-sm"><span class="icon icon-bookmark"></span></a>
+                    <a  href="javascript:void(0)" class="btn btn-default btn-sm action-resolve">
+                        <i aria-hidden="true" class="icon-checkmark"></i>
+                    </a>
+                    <a href="#" class="btn btn-default btn-sm action-bookmark">
+                        <span class="icon icon-bookmark"></span>
+                    </a>
                 </div>
                 <div class="btn-group">
                     <a class="btn btn-default btn-sm hidden-xs" data-action="pause" data-pause-label="{% trans "Updates are paused. Click to enable." %}" data-play-label="{% trans "Updates are live. Click to pause." %}" href="javascript:void(0)">
@@ -121,7 +125,7 @@
             ng-class="{'seen': group.hasSeen}">
             <div class="event-details event-cell">
               <div class="checkbox">
-                  <input type="checkbox" class="chk-select">
+                  <input type="checkbox" class="chk-select" value="<% group.id %>">
               </div>
               <h3><a href="<% group.permalink %>"><% group.title %></a></h3>
               <div class="event-meta">
@@ -173,7 +177,6 @@
         <h3>No events to show.</h3>
       </div>
     </div>
-
     <script>
     window.groupList = {% serialize event_list %}
     </script>
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index 60ae0b3871..4f0a4929fe 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -191,50 +191,5 @@
         moment.lang(window.SentryConfig.lang);
         </script>
         {% endblock %}
-        <!-- Button trigger modal -->
-        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#confirm">
-          Launch confirm modal
-        </button>
-
-        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#normal">
-          Launch normal modal
-        </button>
-
-        <div class="modal fade" id="confirm">
-          <div class="modal-dialog">
-            <div class="modal-content">
-              <div class="modal-header">
-                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
-                <h4 class="modal-title">What did you mean to do here?</h4>
-              </div>
-              <!-- <div class="modal-body">
-                <p>What did you mean to do here?</p>
-              </div> -->
-              <div class="modal-footer">
-                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Cancel</button>
-                <button type="button" class="btn btn-danger">Resolve all 673 events</button>
-                <button type="button" class="btn btn-primary">Resolve 25 selected events</button>
-              </div>
-            </div><!-- /.modal-content -->
-          </div><!-- /.modal-dialog -->
-        </div><!-- /.modal -->
-
-        <div class="modal fade" id="normal">
-          <div class="modal-dialog">
-            <div class="modal-content">
-              <div class="modal-header">
-                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
-                <h4 class="modal-title">Please confirm</h4>
-              </div>
-              <div class="modal-body">
-                <p><strong>Are you sure that you want to merge these 3 events</strong>? <br>This action cannot be undone.</p>
-              </div>
-              <div class="modal-footer">
-                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
-                <button type="button" class="btn btn-primary">Merge 3 events</button>
-              </div>
-            </div><!-- /.modal-content -->
-          </div><!-- /.modal-dialog -->
-        </div><!-- /.modal -->
     </body>
 </html>
