commit 8c65785b794a2973f14301eb9a5b87948b232ece
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Dec 9 15:16:17 2010 -0800

    Better default setup for Haystack -- use a seperate site for instances where Sentry is on the same server as the application

diff --git a/example_project/settings.py b/example_project/settings.py
index 1c4f53f0b6..530e0393a5 100644
--- a/example_project/settings.py
+++ b/example_project/settings.py
@@ -121,12 +121,12 @@ SENTRY_TESTING = True
 SENTRY_SITE = 'example'
 SENTRY_PUBLIC = False
 
-# HAYSTACK_WHOOSH_PATH = os.path.join(PROJECT_ROOT, 'sentry_index')
-# HAYSTACK_SEARCH_ENGINE = 'whoosh'
+HAYSTACK_WHOOSH_PATH = os.path.join(PROJECT_ROOT, 'sentry_index')
+HAYSTACK_SEARCH_ENGINE = 'whoosh'
 # HAYSTACK_SOLR_URL = 'http://127.0.0.1:8983/solr'
 # HAYSTACK_SEARCH_ENGINE = 'solr'
 
-HAYSTACK_SITECONF = 'sentry.search_indexes'
+HAYSTACK_SITECONF = 'sentry.search_sites'
 
 try:
     import debug_toolbar
diff --git a/sentry/search_indexes.py b/sentry/search_indexes.py
index 505b17adbb..5303b0067d 100644
--- a/sentry/search_indexes.py
+++ b/sentry/search_indexes.py
@@ -1,5 +1,7 @@
+import haystack
 from haystack.indexes import *
-from haystack import site
+
+from sentry.search_sites import site
 from sentry.models import GroupedMessage
 
 class GroupedMessageIndex(RealTimeSearchIndex):
diff --git a/sentry/search_sites.py b/sentry/search_sites.py
new file mode 100644
index 0000000000..bbf9295558
--- /dev/null
+++ b/sentry/search_sites.py
@@ -0,0 +1,6 @@
+import haystack
+from haystack.sites import SearchSite
+
+haystack.autodiscover()
+
+site = SearchSite()
diff --git a/sentry/views.py b/sentry/views.py
index 5031a0cc3d..b3899645f9 100644
--- a/sentry/views.py
+++ b/sentry/views.py
@@ -29,6 +29,7 @@ from sentry.reporter import ImprovedExceptionReporter
 if 'sentry.filters.SearchFilter' in conf.FILTERS:
     try:
         from haystack.query import SearchQuerySet
+        from sentry.search_indexes import site as SentrySearchSite
     except ImportError:
         SentrySearchQuerySet = None
     else:
@@ -159,7 +160,7 @@ def ajax_handler(request):
         is_search = query and SentrySearchQuerySet
 
         if is_search:
-            message_list = SentrySearchQuerySet().filter(content=query)
+            message_list = SentrySearchQuerySet(site=SentrySearchSite).filter(content=query)
         else:
             message_list = GroupedMessage.objects.extra(
                 select={
