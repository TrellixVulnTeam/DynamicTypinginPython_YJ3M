commit 44b7085dc82a3967c041fdea7cb37cc0ce545585
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 24 13:16:45 2015 -0800

    Add user context to emails

diff --git a/src/sentry/interfaces/user.py b/src/sentry/interfaces/user.py
index 0ee2c8108a..f11e72e61f 100644
--- a/src/sentry/interfaces/user.py
+++ b/src/sentry/interfaces/user.py
@@ -64,15 +64,26 @@ class User(Interface):
     def get_hash(self):
         return []
 
-    def to_html(self, event, is_public=False, **kwargs):
-        if is_public:
-            return ''
-        return render_to_string('sentry/partial/interfaces/user.html', {
-            'is_public': is_public,
-            'event': event,
+    def get_context(self):
+        return {
             'user_ip_address': self.ip_address,
             'user_id': self.id,
             'user_username': self.username,
             'user_email': self.email,
             'user_data': self.data,
+        }
+
+    def to_html(self, event, is_public=False, **kwargs):
+        if is_public:
+            return ''
+
+        context = self.get_context()
+        context.update({
+            'is_public': is_public,
+            'event': event,
         })
+        return render_to_string('sentry/partial/interfaces/user.html', context)
+
+    def to_email_html(self, event, **kwargs):
+        context = self.get_context()
+        return render_to_string('sentry/partial/interfaces/user_email.html', context)
diff --git a/src/sentry/templates/sentry/partial/interfaces/user_email.html b/src/sentry/templates/sentry/partial/interfaces/user_email.html
new file mode 100644
index 0000000000..3c66b5b4b4
--- /dev/null
+++ b/src/sentry/templates/sentry/partial/interfaces/user_email.html
@@ -0,0 +1,50 @@
+{% load i18n %}
+{% load sentry_helpers %}
+<table>
+  <tr>
+    <td style="width:84px;padding-top:10px;vertical-align:top">
+      <img src="{% gravatar_url user_email size 64 %}">
+    </td>
+    <td>
+      <table>
+        <colgroup>
+          <col style="width:130px;">
+        </colgroup>
+        <tbody>
+          {% if user_id %}
+            <tr>
+              <th>{% trans "ID:" %}</th>
+              <td class="code">{{ user_id }}</td>
+            </tr>
+            {% endif %}
+          {% if user_ip_address %}
+            <tr>
+              <th>{% trans "IP Address:" %}</th>
+              <td class="code">{{ user_ip_address }}</td>
+            </tr>
+          {% endif %}
+          {% if user_username %}
+            <tr>
+              <th>{% trans "Username:" %}</th>
+              <td class="code">{{ user_username }}</td>
+            </tr>
+          {% endif %}
+          {% if user_email %}
+            <tr>
+              <th>{% trans "Email:" %}</th>
+              <td class="code">{{ user_email }}</td>
+            </tr>
+          {% endif %}
+          {% if user_data %}
+            {% for key, value in user_data.iteritems %}
+              <tr>
+                <th>{{ key|titlize }}</th>
+                <td class="code">{{ value }}</td>
+              </tr>
+            {% endfor %}
+          {% endif %}
+        </tbody>
+      </table>
+    </td>
+  </tr>
+</table>
