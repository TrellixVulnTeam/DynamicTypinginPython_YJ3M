commit ab3ff1e6a7c048bf4517c853cf594fe5ae4789b4
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jul 31 23:29:29 2013 -0700

    Ensure you cannot register an account with a duplicate username (form validation)

diff --git a/src/sentry/web/forms/accounts.py b/src/sentry/web/forms/accounts.py
index c22f0b33e7..864ecd6e06 100644
--- a/src/sentry/web/forms/accounts.py
+++ b/src/sentry/web/forms/accounts.py
@@ -32,6 +32,14 @@ class RegistrationForm(forms.ModelForm):
             raise forms.ValidationError(_('An account is already registered with that email address.'))
         return value
 
+    def clean_username(self):
+        value = self.cleaned_data.get('username')
+        if not value:
+            return
+        if User.objects.filter(username__iexact=value).exists():
+            raise forms.ValidationError(_('An account is already registered with that username.'))
+        return value
+
     def save(self, commit=True):
         user = super(RegistrationForm, self).save(commit=False)
         user.set_password(self.cleaned_data['password'])
