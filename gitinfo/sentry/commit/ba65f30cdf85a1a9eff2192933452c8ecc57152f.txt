commit ba65f30cdf85a1a9eff2192933452c8ecc57152f
Author: bkonkle <brandon@konkle.us>
Date:   Wed Feb 8 16:14:31 2012 -0700

    Allow for preflighted cross-domain requests

diff --git a/sentry/utils/http.py b/sentry/utils/http.py
index e82c2e8839..79e25b79bd 100644
--- a/sentry/utils/http.py
+++ b/sentry/utils/http.py
@@ -50,12 +50,12 @@ def is_same_domain(url1, url2):
 
 def apply_access_control_headers(response):
     """
-    Provides the Access-Control-Allow-Origin and Access-Control-Allow-Headers
-    headers to enable cross-site HTTP requests. You can find more information
-    about these headers here:
+    Provides the Access-Control headers to enable cross-site HTTP requests. You
+    can find more information about these headers here:
     https://developer.mozilla.org/En/HTTP_access_control#Simple_requests
     """
     if settings.ALLOW_ORIGIN:
         response['Access-Control-Allow-Origin'] = settings.ALLOW_ORIGIN
         response['Access-Control-Allow-Headers'] = 'X-Sentry-Auth'
+        response['Access-Control-Allow-Methods'] = 'POST'
     return response
diff --git a/sentry/web/api.py b/sentry/web/api.py
index 7faeefc5b9..14c6e603a1 100644
--- a/sentry/web/api.py
+++ b/sentry/web/api.py
@@ -28,7 +28,7 @@ logger = logging.getLogger('sentry.errors.coreapi')
 
 
 @csrf_exempt
-@require_http_methods(['POST'])
+@require_http_methods(['POST', 'OPTIONS'])
 def store(request):
     """
     The primary endpoint for storing new events.
diff --git a/tests/utils/http/tests.py b/tests/utils/http/tests.py
index 1e9f1e2e7f..40925b79a7 100644
--- a/tests/utils/http/tests.py
+++ b/tests/utils/http/tests.py
@@ -39,6 +39,8 @@ class AccessControlTestCase(TestCase):
                              None)
             self.assertEqual(response.get('Access-Control-Allow-Headers', None),
                              None)
+            self.assertEqual(response.get('Access-Control-Allow-Methods', None),
+                             None)
     
     def test_allow_origin(self):
         with self.Settings(SENTRY_ALLOW_ORIGIN="http://foo.example"):
@@ -47,3 +49,5 @@ class AccessControlTestCase(TestCase):
                              "http://foo.example")
             self.assertEqual(response.get('Access-Control-Allow-Headers', None),
                              "X-Sentry-Auth")
+            self.assertEqual(response.get('Access-Control-Allow-Methods', None),
+                             "POST")
