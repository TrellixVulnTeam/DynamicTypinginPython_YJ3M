commit 3a3c36da4ccc297faaf758dff8d7784ccf0b3b62
Author: Jan Michael Auer <account@jauer.org>
Date:   Tue Oct 2 14:50:08 2018 +0200

    fix(minidump): Detect empty minidumps (#9968)

diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index b740c1f393..3e0dde23a8 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -617,6 +617,9 @@ class MinidumpView(StoreView):
             except KeyError:
                 raise APIError('Missing minidump upload')
 
+        if minidump.size == 0:
+            raise APIError('Empty minidump upload received')
+
         if settings.SENTRY_MINIDUMP_CACHE:
             if not os.path.exists(settings.SENTRY_MINIDUMP_PATH):
                 os.mkdir(settings.SENTRY_MINIDUMP_PATH, 0o744)
diff --git a/tests/sentry/lang/native/test_plugin.py b/tests/sentry/lang/native/test_plugin.py
index 0201a1175e..bec2974925 100644
--- a/tests/sentry/lang/native/test_plugin.py
+++ b/tests/sentry/lang/native/test_plugin.py
@@ -1618,3 +1618,10 @@ class MinidumpIntegrationTest(TestCase):
         assert not Event.objects.filter(event_id=event.event_id).exists()
         assert not EventAttachment.objects.filter(event_id=event.event_id).exists()
         assert not File.objects.filter(id=file.id).exists()
+
+    def test_empty_minidump(self):
+        f = BytesIO()
+        f.name = 'empty.dmp'
+        response = self._postMinidumpWithHeader(f)
+        assert response.status_code == 400
+        assert response.content == '{"error":"Empty minidump upload received"}'
