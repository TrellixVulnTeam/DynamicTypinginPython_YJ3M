commit 027f110e9e510a57698264daf2ccb81cda9fa23f
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Apr 19 02:01:19 2016 +0200

    Stop using prepare for symbol filling

diff --git a/src/sentry/models/dsymfile.py b/src/sentry/models/dsymfile.py
index d9b707018a..f17e53deb6 100644
--- a/src/sentry/models/dsymfile.py
+++ b/src/sentry/models/dsymfile.py
@@ -161,7 +161,7 @@ class DSymSymbolManager(BaseManager):
         try:
             # First try: exact match on uuid
             cur.execute('''
-                select symbol
+                select s.symbol
                   from sentry_dsymsymbol s,
                        sentry_dsymobject o
                  where o.uuid = %s and
@@ -183,7 +183,7 @@ class DSymSymbolManager(BaseManager):
                 return
 
             cur.execute('''
-                select symbol
+                select s.symbol
                   from sentry_dsymsymbol s,
                        sentry_dsymobject o,
                        sentry_dsymsdk k,
diff --git a/src/sentry/runner/commands/dsym.py b/src/sentry/runner/commands/dsym.py
index 8228ed0188..bf09dbe50d 100644
--- a/src/sentry/runner/commands/dsym.py
+++ b/src/sentry/runner/commands/dsym.py
@@ -80,19 +80,15 @@ def process_archive(members, zip, sdk_info, threads=8, trim_symbols=False,
     def process_items():
         cur = connection.cursor()
         cur.execute('begin')
-        cur.execute('''
-            prepare add_sym(bigint, bigint, text) as
-                insert into sentry_dsymsymbol (object_id, address, symbol)
-                select $1, $2, $3
-                where not exists (select 1 from sentry_dsymsymbol
-                    where object_id = $1 and address = $2);
-        ''')
         while 1:
             items = q.get()
             if items is SHUTDOWN:
                 break
             cur.executemany('''
-                execute add_sym(%(object_id)s, %(address)s, %(symbol)s);
+                insert into sentry_dsymsymbol (object_id, address, symbol)
+                select %(object_id)s, %(address)s, %(symbol)s
+                where not exists (select 1 from sentry_dsymsymbol
+                    where object_id = %(object_id)s and address = %(address)s);
             ''', items)
         cur.execute('commit')
 
