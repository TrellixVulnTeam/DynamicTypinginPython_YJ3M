commit 7a9e2cccde5989a0bca8e4684ebf2edb633a6c0f
Author: MeredithAnya <meredith.a.heller@gmail.com>
Date:   Wed Jul 25 09:52:17 2018 -0700

    ref(integrations): Change GHE domain_name (#9173)
    
    * ref(integrations): Change GHE domain_name

diff --git a/src/sentry/integrations/github_enterprise/integration.py b/src/sentry/integrations/github_enterprise/integration.py
index 472214b4ff..edcc207d0a 100644
--- a/src/sentry/integrations/github_enterprise/integration.py
+++ b/src/sentry/integrations/github_enterprise/integration.py
@@ -47,7 +47,7 @@ API_ERRORS = {
 
 class GitHubEnterpriseIntegration(Integration, GitHubIssueBasic, RepositoryMixin):
     def get_client(self):
-        base_url = urlparse(self.model.metadata['domain_name']).netloc
+        base_url = self.model.metadata['domain_name'].split('/')[0]
         return GitHubEnterpriseAppsClient(
             base_url=base_url,
             integration=self.model,
@@ -246,7 +246,7 @@ class GitHubEnterpriseIntegrationProvider(GitHubIntegrationProvider):
                 'access_token': None,
                 'expires_at': None,
                 'icon': installation['account']['avatar_url'],
-                'domain_name': installation['account']['html_url'],
+                'domain_name': installation['account']['html_url'].replace('https://', ''),
                 'installation_id': installation['id'],
                 'installation': installation_data
             },
diff --git a/tests/sentry/integrations/github_enterprise/test_integration.py b/tests/sentry/integrations/github_enterprise/test_integration.py
index a9aeaf03c7..d7c792d860 100644
--- a/tests/sentry/integrations/github_enterprise/test_integration.py
+++ b/tests/sentry/integrations/github_enterprise/test_integration.py
@@ -127,7 +127,7 @@ class GitHubEnterpriseIntegrationTest(IntegrationTestCase):
             u'access_token': None,
             u'expires_at': None,
             u'icon': u'https://35.232.149.196/avatar.png',
-            u'domain_name': u'https://35.232.149.196/Test-Organization',
+            u'domain_name': u'35.232.149.196/Test-Organization',
             u'installation_id': u'install_id_1',
             u'installation': {
                 u'client_id': u'client_id',
diff --git a/tests/sentry/integrations/github_enterprise/test_issues.py b/tests/sentry/integrations/github_enterprise/test_issues.py
index bab0f03a41..056ad5e7bd 100644
--- a/tests/sentry/integrations/github_enterprise/test_issues.py
+++ b/tests/sentry/integrations/github_enterprise/test_issues.py
@@ -25,7 +25,7 @@ class GitHubEnterpriseIssueBasicTest(TestCase):
             external_id='github_external_id',
             name='getsentry',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/getsentry',
                 'installation_id': 'installation_id',
                 'installation': {
                     'id': 2,
diff --git a/tests/sentry/integrations/github_enterprise/test_webhooks.py b/tests/sentry/integrations/github_enterprise/test_webhooks.py
index 8c34e1f34e..3bfb17c475 100644
--- a/tests/sentry/integrations/github_enterprise/test_webhooks.py
+++ b/tests/sentry/integrations/github_enterprise/test_webhooks.py
@@ -93,7 +93,7 @@ class PushEventWebhookTest(APITestCase):
             external_id="35.232.149.196:12345",
             provider='github_enterprise',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation_id': '12345',
                 'installation': {
                     'id': '2',
@@ -159,7 +159,7 @@ class PushEventWebhookTest(APITestCase):
             external_id='35.232.149.196:12345',
             name='octocat',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation': {
                     'id': '2',
                     'private_key': 'private_key',
@@ -245,7 +245,7 @@ class PushEventWebhookTest(APITestCase):
             external_id="35.232.149.196:12345",
             provider='github_enterprise',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation_id': '12345',
                 'installation': {
                     'id': '2',
@@ -268,7 +268,7 @@ class PushEventWebhookTest(APITestCase):
             external_id="35.232.149.196:99",
             provider='github_enterprise',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/another',
                 'installation': {
                     'installation_id': '99',
                     'id': '2',
@@ -325,7 +325,7 @@ class PullRequestEventWebhook(APITestCase):
             external_id='35.232.149.196:234',
             name='octocat',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation': {
                     'id': '2',
                     'private_key': 'private_key',
@@ -385,7 +385,7 @@ class PullRequestEventWebhook(APITestCase):
             external_id='35.232.149.196:234',
             name='octocat',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation': {
                     'id': '2',
                     'private_key': 'private_key',
@@ -444,7 +444,7 @@ class PullRequestEventWebhook(APITestCase):
             external_id='35.232.149.196:234',
             name='octocat',
             metadata={
-                'domain_name': 'https://35.232.149.196',
+                'domain_name': '35.232.149.196/baxterthehacker',
                 'installation': {
                     'id': '2',
                     'private_key': 'private_key',
