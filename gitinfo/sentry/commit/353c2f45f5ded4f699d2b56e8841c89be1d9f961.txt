commit 353c2f45f5ded4f699d2b56e8841c89be1d9f961
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 5 19:27:34 2014 -0700

    Add sort options to tags and remove project from queries

diff --git a/src/sentry/api/endpoints/group_tags.py b/src/sentry/api/endpoints/group_tags.py
index f2cca7b7e2..f12d53c9f6 100644
--- a/src/sentry/api/endpoints/group_tags.py
+++ b/src/sentry/api/endpoints/group_tags.py
@@ -28,7 +28,6 @@ class GroupTagsEndpoint(Endpoint):
         for tag_key in tag_keys:
             queryset = GroupTagValue.objects.filter(
                 group=group,
-                project=group.project,
                 key=tag_key.key,
             )
 
diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index d3c57aa9a7..ba627507eb 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -142,13 +142,12 @@ class Group(Model):
         module = self.data.get('module', 'ver')
         return module, self.data['version']
 
-    def get_unique_tags(self, tag, since=None):
+    def get_unique_tags(self, tag, since=None, order_by='-times_seen'):
         # TODO(dcramer): this has zero test coverage and is a critical path
         from sentry.models import GroupTagValue
 
         queryset = GroupTagValue.objects.filter(
             group=self,
-            project=self.project,
             key=tag,
         )
         if since:
@@ -158,7 +157,7 @@ class Group(Model):
             'times_seen',
             'first_seen',
             'last_seen',
-        ).order_by('-times_seen')
+        ).order_by(order_by)
 
     def get_tags(self):
         from sentry.models import GroupTagKey
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 1f75ad6d65..09097a99a7 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -487,10 +487,18 @@ def group_tag_list(request, team, project, group):
 
 @has_group_access
 def group_tag_details(request, team, project, group, tag_name):
+    sort = request.GET.get('sort')
+    if sort == 'date':
+        order_by = '-last_seen'
+    elif sort == 'new':
+        order_by = '-first_seen'
+    else:
+        order_by = '-times_seen'
+
     return render_with_group_context(group, 'sentry/plugins/bases/tag/index.html', {
         'title': tag_name.replace('_', ' ').title(),
         'tag_name': tag_name,
-        'unique_tags': group.get_unique_tags(tag_name),
+        'unique_tags': group.get_unique_tags(tag_name, order_by=order_by),
         'page': 'tag_details',
     }, request)
 
