commit b9af37f2a24c6368bc3c1e553a20c95bbff455ac
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Aug 2 15:13:03 2018 -0700

    fix(ui): Fix <NoteInput> handling 401 error objects incorrectly (#9292)
    
    Expected string but received an object.

diff --git a/src/sentry/static/sentry/app/components/activity/noteInput.jsx b/src/sentry/static/sentry/app/components/activity/noteInput.jsx
index 955fee254b..9baca64184 100644
--- a/src/sentry/static/sentry/app/components/activity/noteInput.jsx
+++ b/src/sentry/static/sentry/app/components/activity/noteInput.jsx
@@ -302,6 +302,13 @@ const NoteInput = createReactClass({
 
     let btnText = updating ? t('Save Comment') : t('Post Comment');
 
+    let errorMessage =
+      (errorJSON &&
+        (typeof errorJSON.detail === 'string'
+          ? errorJSON.detail
+          : (errorJSON.detail && errorJSON.detail.message) ||
+            t('Unable to post comment'))) ||
+      null;
     return (
       <form
         noValidate
@@ -360,8 +367,7 @@ const NoteInput = createReactClass({
             </MentionsInput>
           )}
           <div className="activity-actions">
-            {errorJSON &&
-              errorJSON.detail && <small className="error">{errorJSON.detail}</small>}
+            {errorMessage && <small className="error">{errorMessage}</small>}
             <button className="btn btn-default" type="submit" disabled={loading}>
               {btnText}
             </button>
diff --git a/tests/js/spec/components/noteInput.spec.jsx b/tests/js/spec/components/noteInput.spec.jsx
index 337dab6dc7..b3e4832fcb 100644
--- a/tests/js/spec/components/noteInput.spec.jsx
+++ b/tests/js/spec/components/noteInput.spec.jsx
@@ -56,4 +56,23 @@ describe('NoteInput', function() {
     input.simulate('keyDown', {key: 'Enter', ctrlKey: true});
     expect(spy).toHaveBeenCalled();
   });
+
+  it('handles 401 error objects', async function() {
+    Client.addMockResponse({
+      url: '/issues/groupId/comments/',
+      method: 'POST',
+      body: {detail: {message: '', code: 401, extra: ''}},
+      statusCode: 401,
+    });
+    let wrapper = mount(
+      <NoteInput group={{project: {}, id: 'groupId'}} memberList={[]} sessionUser={{}} />,
+      TestStubs.routerContext()
+    );
+
+    let input = wrapper.find('textarea');
+
+    input.simulate('keyDown', {key: 'Enter', ctrlKey: true});
+    wrapper.update();
+    expect(wrapper.find('.activity-actions .error')).toHaveLength(1);
+  });
 });
