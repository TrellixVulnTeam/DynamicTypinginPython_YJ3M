commit 5c16cb3eafcb302f9df2a5b106cf4f898a8e693d
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Oct 28 17:15:38 2019 +0100

    fix(test): Fix missing op in trace context (#15289)
    
    * fix(test): Fix missing op in trace context
    
    * fix: Fix another occurrence

diff --git a/requirements-base.txt b/requirements-base.txt
index da1572d008..3edee3b820 100644
--- a/requirements-base.txt
+++ b/requirements-base.txt
@@ -51,7 +51,7 @@ redis>=2.10.3,<2.10.6
 requests-oauthlib==0.3.3
 requests[security]>=2.20.0,<2.21.0
 selenium==3.141.0
-semaphore>=0.4.46,<0.5.0
+semaphore>=0.4.57,<0.5.0
 sentry-sdk>=0.13.1
 setproctitle>=1.1.7,<1.2.0
 simplejson>=3.2.0,<3.9.0
diff --git a/src/sentry/data/samples/transaction.json b/src/sentry/data/samples/transaction.json
index bddc3febbd..c6a460c49f 100644
--- a/src/sentry/data/samples/transaction.json
+++ b/src/sentry/data/samples/transaction.json
@@ -68,6 +68,7 @@
       "trace": {
          "parent_span_id": "8988cec7cc0779c1",
          "type": "trace",
+         "op": "foobar",
          "trace_id": "a7d67cf796774551a95be6543cacd459",
          "span_id": "babaae0d4b7512d9"
       },
diff --git a/tests/sentry/event_manager/test_event_manager.py b/tests/sentry/event_manager/test_event_manager.py
index 975472ca20..a6ff1fe25f 100644
--- a/tests/sentry/event_manager/test_event_manager.py
+++ b/tests/sentry/event_manager/test_event_manager.py
@@ -894,6 +894,7 @@ class EventManagerTest(TestCase):
                     "contexts": {
                         "trace": {
                             "parent_span_id": "bce14471e0e9654d",
+                            "op": "foobar",
                             "trace_id": "a0fa8803753e40fd8124b21eeb2986b5",
                             "span_id": "bf5be759039ede9a",
                         }
@@ -1100,6 +1101,7 @@ class EventManagerTest(TestCase):
                 contexts={
                     "trace": {
                         "parent_span_id": "bce14471e0e9654d",
+                        "op": "foobar",
                         "trace_id": "a0fa8803753e40fd8124b21eeb2986b5",
                         "span_id": "bf5be759039ede9a",
                     }
@@ -1133,6 +1135,7 @@ class EventManagerTest(TestCase):
                 contexts={
                     "trace": {
                         "parent_span_id": "bce14471e0e9654d",
+                        "op": "foobar",
                         "trace_id": "a0fa8803753e40fd8124b21eeb2986b5",
                         "span_id": "bf5be759039ede9a",
                     }
diff --git a/tests/sentry/web/frontend/test_project_event.py b/tests/sentry/web/frontend/test_project_event.py
index 42852f960a..00fb517854 100644
--- a/tests/sentry/web/frontend/test_project_event.py
+++ b/tests/sentry/web/frontend/test_project_event.py
@@ -52,7 +52,7 @@ class ProjectEventTest(SnubaTestCase, TestCase):
                 "timestamp": min_ago,
                 "start_timestamp": min_ago,
                 "spans": [],
-                "contexts": {"trace": {"trace_id": "a" * 32, "span_id": "b" * 16}},
+                "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "b" * 16}},
             },
             project_id=self.project.id,
         )
diff --git a/tests/snuba/api/endpoints/test_organization_event_details.py b/tests/snuba/api/endpoints/test_organization_event_details.py
index 289f04bc78..513a3771a1 100644
--- a/tests/snuba/api/endpoints/test_organization_event_details.py
+++ b/tests/snuba/api/endpoints/test_organization_event_details.py
@@ -74,7 +74,7 @@ class OrganizationEventDetailsEndpointTest(APITestCase, SnubaTestCase):
                 "type": "transaction",
                 "transaction": "api.issue.delete",
                 "spans": [],
-                "contexts": {"trace": {"trace_id": "a" * 32, "span_id": "a" * 16}},
+                "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "a" * 16}},
                 "start_timestamp": iso_format(before_now(minutes=1, seconds=5)),
                 "timestamp": min_ago,
             },
@@ -251,7 +251,7 @@ class OrganizationEventDetailsEndpointTest(APITestCase, SnubaTestCase):
             "type": "transaction",
             "transaction": "api.issue.delete",
             "spans": [],
-            "contexts": {"trace": {"trace_id": "a" * 32, "span_id": "a" * 16}},
+            "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "a" * 16}},
             "tags": {"important": "yes"},
         }
         fixtures = (
diff --git a/tests/snuba/api/endpoints/test_organization_events_meta.py b/tests/snuba/api/endpoints/test_organization_events_meta.py
index 5d03f3a0c1..78d8b8eb41 100644
--- a/tests/snuba/api/endpoints/test_organization_events_meta.py
+++ b/tests/snuba/api/endpoints/test_organization_events_meta.py
@@ -72,7 +72,7 @@ class OrganizationEventsMetaEndpoint(APITestCase, SnubaTestCase):
             "type": "transaction",
             "transaction": "api.issue.delete",
             "spans": [],
-            "contexts": {"trace": {"trace_id": "a" * 32, "span_id": "a" * 16}},
+            "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "a" * 16}},
             "tags": {"important": "yes"},
             "timestamp": iso_format(before_now(minutes=1)),
             "start_timestamp": iso_format(before_now(minutes=1, seconds=3)),
diff --git a/tests/snuba/api/endpoints/test_organization_events_stats.py b/tests/snuba/api/endpoints/test_organization_events_stats.py
index 04813fadd0..e1e142821a 100644
--- a/tests/snuba/api/endpoints/test_organization_events_stats.py
+++ b/tests/snuba/api/endpoints/test_organization_events_stats.py
@@ -289,7 +289,7 @@ class OrganizationEventsStatsEndpointTest(APITestCase, SnubaTestCase):
             "type": "transaction",
             "transaction": "api.issue.delete",
             "spans": [],
-            "contexts": {"trace": {"trace_id": "a" * 32, "span_id": "a" * 16}},
+            "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "a" * 16}},
             "tags": {"important": "yes"},
         }
         fixtures = (
