commit e726688ace6d85af77c21319a862821dffdb4a3c
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Dec 31 12:53:20 2011 -0800

    Update context processor to work when request is missing

diff --git a/sentry/web/helpers.py b/sentry/web/helpers.py
index b3f4174358..c1e12d94d7 100644
--- a/sentry/web/helpers.py
+++ b/sentry/web/helpers.py
@@ -77,11 +77,13 @@ def render_to_string(template, context=None, request=None):
         'has_search': False,
         'MESSAGES_PER_PAGE': settings.MESSAGES_PER_PAGE,
         'PROJECT_ID': settings.PROJECT,
-        'can_create_projects': request.user.has_perm('sentry.add_project'),
     })
 
     if request:
-        context['request'] = request
+        context.update({
+            'request': request,
+            'can_create_projects': request.user.has_perm('sentry.add_project'),
+        })
         if 'project_list' not in context:
             context['project_list'] = get_project_list(request.user).values()
 
