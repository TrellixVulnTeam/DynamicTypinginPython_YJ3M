commit 89552751168768ac3981b3f785413a77cb05e793
Author: Tony <Zylphrex@users.noreply.github.com>
Date:   Thu Jun 18 17:46:42 2020 -0400

    fix(discover): Remove apdex, impact, user_misery columns during drilldown (#19458)
    
    Clicking the Open Stack CTA will expand the arguments to functions including
    apdex, impact, and user_misery which previously had no arguments but now
    takes a single number. This causes the drilldown to create a column for the
    number. This change will remove all aggregations that does not take another
    column (apdex, impact and user_misery) as its argument as they cannot be
    expanded.

diff --git a/src/sentry/static/sentry/app/views/eventsV2/utils.tsx b/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
index bca7a64390..bc20414d34 100644
--- a/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
+++ b/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
@@ -265,7 +265,15 @@ export function getExpandedResults(
         field = 'id';
       }
 
-      if (!field) {
+      // if at least one of the parameters to the function is an available column,
+      // then we should proceed to replace it with the column, however, for functions
+      // like apdex that takes a number as its parameter we should delete it
+      const {parameters = []} = AGGREGATIONS[exploded.function[0]] ?? {};
+      if (
+        !field ||
+        (parameters.length > 0 &&
+          parameters.every(parameter => parameter.kind !== 'column'))
+      ) {
         // This is a function with no field alias. We delete this column as it'll add a blank column in the drilldown.
         fieldsToDelete.push(indexToUpdate);
         return;
diff --git a/tests/js/spec/views/eventsV2/utils.spec.jsx b/tests/js/spec/views/eventsV2/utils.spec.jsx
index b5beb5508a..634f921374 100644
--- a/tests/js/spec/views/eventsV2/utils.spec.jsx
+++ b/tests/js/spec/views/eventsV2/utils.spec.jsx
@@ -242,8 +242,9 @@ describe('getExpandedResults()', function() {
         {field: 'custom_tag'},
         {field: 'title'}, // not expected to be dropped
         {field: 'unique_count(id)'},
-        {field: 'apdex()'}, // should be dropped
-        {field: 'impact()'}, // should be dropped
+        {field: 'apdex(300)'}, // should be dropped
+        {field: 'impact(300)'}, // should be dropped
+        {field: 'user_misery(300)'}, // should be dropped
       ],
     });
 
