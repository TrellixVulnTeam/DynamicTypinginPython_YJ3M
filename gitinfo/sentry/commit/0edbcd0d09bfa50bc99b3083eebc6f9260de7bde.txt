commit 0edbcd0d09bfa50bc99b3083eebc6f9260de7bde
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 12 11:34:09 2015 -0800

    Add release to mocks

diff --git a/bin/load-mocks b/bin/load-mocks
index ba56635b44..abe4b842e2 100755
--- a/bin/load-mocks
+++ b/bin/load-mocks
@@ -10,12 +10,13 @@ from datetime import datetime, timedelta
 from pytz import utc
 from random import randint
 
-from sentry.app import buffer, tsdb
+from sentry.app import tsdb
 from sentry.models import (
     AccessGroup, Activity, User, Organization, Project, Team
 )
 from sentry.utils.samples import create_sample_event
 
+
 def create_sample_time_series(event):
     group = event.group
 
@@ -94,10 +95,18 @@ def main():
                 }
             )
 
-            event1 = create_sample_event(project, 'python')
+            event1 = create_sample_event(
+                project=project,
+                platform='python',
+                release='4f38b65c62c4565aa94bba391ff8946922a8eed4',
+            )
             create_sample_time_series(event1)
 
-            event2 = create_sample_event(project, 'javascript')
+            event2 = create_sample_event(
+                project=project,
+                platform='javascript',
+                release='4f38b65c62c4565aa94bba391ff8946922a8eed4',
+            )
             create_sample_time_series(event2)
 
             Activity.objects.create(
@@ -125,14 +134,6 @@ def main():
         data={'version': '4f38b65c62c4565aa94bba391ff8946922a8eed4'},
     )
 
-    # force the buffer to process any pending incrs
-    # (this ensures tags get populated)
-    # TODO(dcramer): we should load a buffer backend which just does incr's in
-    # realtime
-    buffer.process_pending()
-    # Run it once again to handle TagKey incrs
-    buffer.process_pending()
-
 
 if __name__ == '__main__':
     from django.conf import settings
diff --git a/src/sentry/utils/samples.py b/src/sentry/utils/samples.py
index f117b4f89d..3dde16af8c 100644
--- a/src/sentry/utils/samples.py
+++ b/src/sentry/utils/samples.py
@@ -64,7 +64,8 @@ def load_data(platform, default=None):
     return data
 
 
-def create_sample_event(project, platform=None, default=None):
+def create_sample_event(project, platform=None, default=None, tags=None,
+                        release=None):
     if not platform:
         platform = project.platform
 
@@ -78,6 +79,12 @@ def create_sample_event(project, platform=None, default=None):
     if not data:
         return
 
+    if tags:
+        data['tags'] = tags
+
+    if release:
+        data['release'] = release
+
     manager = EventManager(data)
     manager.normalize()
     return manager.save(project.id, raw=True)
