commit 32c1337781fed95689b6dba23f7237a40b4c3be3
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Dec 4 20:18:20 2012 -0800

    Replace dashboard chart with pure css/html bar chart

diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index c6c25f696c..a0e264b23d 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -426,6 +426,38 @@ footer {
   }
 }
 
+.sparkline {
+  > span {
+    position: relative;
+    float: left;
+    height: 100%;
+    display: block; 
+
+    &:hover {
+      > span {
+        background: @linkColor;
+        border-color: @linkColor;
+      }
+    }
+
+    > span {
+      display: block; 
+      position: absolute; 
+      bottom: 0;
+      left: 0; 
+      right: 1px;
+      background: #dfe3e9;
+      .border-radius(3px 3px 0 0);
+      border: 1px solid #dfe3e9;
+      min-width: 1px;
+      height: 0;
+      overflow: hidden; 
+      text-indent: -9999px;
+
+    }
+  }
+}
+
 .group-list, .events {
   margin: 0;
   padding: 0;
@@ -549,23 +581,6 @@ footer {
         position: relative;
         float: left;
         width: 3px;
-        margin-right: 1px;
-        height: 100%;
-        display: block; 
-
-        > span {
-          display: block; 
-          position: absolute; 
-          bottom: 0;
-          left: 0; 
-          background: #dfe3e9;
-          .border-radius(3px);
-          border: 1px solid #dfe3e9;
-          width: 1px;
-          height: 0;
-          overflow: hidden; 
-          text-indent: -9999px;
-        }
       }
     }
     .meta {
diff --git a/src/sentry/static/sentry/scripts/app.js b/src/sentry/static/sentry/scripts/app.js
index 4c6402d272..0bae5ea404 100644
--- a/src/sentry/static/sentry/scripts/app.js
+++ b/src/sentry/static/sentry/scripts/app.js
@@ -119,8 +119,7 @@
         initialize: function(data){
             BasePage.prototype.initialize.call(this, data);
 
-            // TODO: abstract this out into our newer components
-            Sentry.charts.render('#chart');
+            app.charts.render('#chart');
         }
 
     });
diff --git a/src/sentry/static/sentry/scripts/charts.js b/src/sentry/static/sentry/scripts/charts.js
new file mode 100644
index 0000000000..fcb91ebd8a
--- /dev/null
+++ b/src/sentry/static/sentry/scripts/charts.js
@@ -0,0 +1,71 @@
+/*global Sentry:true*/
+
+(function(app, Backbone, jQuery, _){
+    "use strict";
+
+    var $ = jQuery;
+
+    app.charts = {
+
+        render: function(el) {
+            var $el = $('#chart');
+            var url = $el.attr('data-api-url');
+
+            $el.height($el.parent().height());
+            $.ajax({
+                url: $el.attr('data-api-url'),
+                type: 'get',
+                dataType: 'json',
+                data: {
+                    days: 7,
+                    gid: $el.attr('data-group') || undefined
+                },
+                success: function(resp) {
+                    $el.empty();
+                    var data = [];
+                    $.each(resp, function(_, val){
+                        data.push({
+                            y: val[1],
+                            label: val[0]
+                        });
+                    });
+                    app.charts.createSparkline($el, data);
+                }
+            });
+        },
+
+        createSparkline: function(el, points){
+            // TODO: maxval could default to # of hours since first_seen / times_seen
+            var $el = $(el),
+                existing = $el.find('> span'),
+                maxval = 10,
+                point, pct, child, point_width;
+
+            for (var i=0; i<points.length; i++) {
+                point = points[i];
+                if (typeof(point) === "number") {
+                    point = points[i] = {
+                        y: point
+                    };
+                }
+                if (point.y > maxval) {
+                    maxval = point.y;
+                }
+            }
+
+            point_width = app.utils.floatFormat(100.0 / points.length, 2) + '%';
+
+            // TODO: we should only remove nodes that are no longer valid
+            for (i=0; (point = points[i]); i++) {
+                pct = app.utils.floatFormat(point.y / maxval * 99, 2) + '%';
+                child = existing[i];
+                if (child === undefined) {
+                    $('<span style="width:' + point_width + ';"><span style="height:' + pct + '" title="' + (point.label || point.y) + '">' + point.y + '</span></span>').appendTo($el);
+                } else {
+                    $(child).find('span').css('height', pct).text(point.y).attr('title', (point.label || point.y));
+                }
+            }
+        }
+
+    };
+}(app, Backbone, jQuery));
\ No newline at end of file
diff --git a/src/sentry/static/sentry/scripts/utils.js b/src/sentry/static/sentry/scripts/utils.js
index 02ea2759ce..103863b629 100644
--- a/src/sentry/static/sentry/scripts/utils.js
+++ b/src/sentry/static/sentry/scripts/utils.js
@@ -47,32 +47,6 @@
             return vars;
         },
 
-        createSparkline: function(el, bits){
-            // TODO: maxval could default to # of hours since first_seen / times_seen
-            var $el = $(el),
-                existing = $el.find('> span'),
-                maxval = 10,
-                i, bit, pct, child;
-
-            for (i=0; i<bits.length; i++) {
-                if (bits[i] > maxval) {
-                    maxval = bits[i];
-                }
-            }
-
-            // TODO: we should only remove nodes that are no longer valid
-            for (i=0; i<bits.length; i++) {
-                bit = bits[i];
-                pct = parseInt(bit / maxval * 100, 10) + '%';
-                child = existing[i];
-                if (child === undefined) {
-                    $('<span><span style="height:' + pct + '" title="' + bit + '">' + bit + '</span></span>').appendTo($el);
-                } else {
-                    $(child).find('span').css('height', pct).text(bit);
-                }
-            }
-        },
-
         floatFormat: function(number, places){
             var multi = Math.pow(10, places);
             return parseInt(number * multi, 10) / multi;
diff --git a/src/sentry/static/sentry/scripts/views.js b/src/sentry/static/sentry/scripts/views.js
index 0e383937a7..ce9a0f0e9e 100644
--- a/src/sentry/static/sentry/scripts/views.js
+++ b/src/sentry/static/sentry/scripts/views.js
@@ -42,7 +42,7 @@
             if (!data)
                 return;
 
-            app.utils.createSparkline(this.$el.find('.sparkline'), data);
+            app.charts.createSparkline(this.$el.find('.sparkline'), data);
         },
 
         getResolveUrl: function(){
diff --git a/src/sentry/templates/sentry/dashboard.html b/src/sentry/templates/sentry/dashboard.html
index 04cc93df19..df7e78ec2f 100644
--- a/src/sentry/templates/sentry/dashboard.html
+++ b/src/sentry/templates/sentry/dashboard.html
@@ -10,7 +10,7 @@
     <section class="body">
         {% if PROJECT_LIST %}
             <div style="height:200px;">
-                <div id="chart" data-api-url="{% url sentry-api-chart %}">
+                <div id="chart" class="sparkline" data-api-url="{% url sentry-api-chart %}">
                     <span class="loading">{% trans "Loading historical data..." %}</span>
                 </div>
             </div>
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index e828cf6b72..bb9b223ac9 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -26,7 +26,7 @@
         <title>{% block title %}Sentry{% endblock %}</title>
 
         <!--[if lt IE 9]>
-        <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/html5shiv.js" %}"></script>
+        <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/lib/html5shiv.js" %}"></script>
         <![endif]-->
         {% block scripts %}
             {% compress js %}
@@ -47,6 +47,7 @@
                 <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/templates.js" %}"></script>
                 <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/utils.js" %}"></script>
                 <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/collections.js" %}"></script>
+                <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/charts.js" %}"></script>
                 <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/views.js" %}"></script>
                 <script type="text/javascript" src="{% url sentry-media "sentry" "scripts/app.js" %}"></script>
             {% endcompress %}
