commit 053018d24e35750adc96521098cf5c864f2d9707
Author: Mark Story <mark@sentry.io>
Date:   Mon Apr 20 15:09:24 2020 -0400

    fix(discover) Ensure projects are loaded when rendering fields (#18360)
    
    I missed a spot where we were using `organization.projects` in discover
    results. This fix ensures that the project field render function always
    has the project loaded.
    
    Fixes JAVASCRIPt-21Z0

diff --git a/src/sentry/static/sentry/app/utils/discover/fieldRenderers.tsx b/src/sentry/static/sentry/app/utils/discover/fieldRenderers.tsx
index a314d791e9..bfb4533ced 100644
--- a/src/sentry/static/sentry/app/utils/discover/fieldRenderers.tsx
+++ b/src/sentry/static/sentry/app/utils/discover/fieldRenderers.tsx
@@ -13,6 +13,7 @@ import ShortId from 'app/components/shortId';
 import {formatFloat, formatPercentage} from 'app/utils/formatters';
 import Version from 'app/components/version';
 import {getAggregateAlias} from 'app/utils/discover/fields';
+import Projects from 'app/utils/projects';
 
 import {
   Container,
@@ -198,10 +199,19 @@ const SPECIAL_FIELDS: SpecialFields = {
   project: {
     sortField: 'project',
     renderFunc: (data, {organization}) => {
-      const project = organization.projects.find(p => p.slug === data.project);
       return (
         <Container>
-          {project ? <ProjectBadge project={project} avatarSize={16} /> : data.project}
+          <Projects orgId={organization.slug} slugs={[data.project]}>
+            {({projects}) => {
+              const project = projects.find(p => p.slug === data.project);
+              return (
+                <ProjectBadge
+                  project={project ? project : {slug: data.project}}
+                  avatarSize={16}
+                />
+              );
+            }}
+          </Projects>
         </Container>
       );
     },
diff --git a/tests/js/spec/utils/discover/fieldRenderer.spec.jsx b/tests/js/spec/utils/discover/fieldRenderer.spec.jsx
index a039d2156c..df97b3993c 100644
--- a/tests/js/spec/utils/discover/fieldRenderer.spec.jsx
+++ b/tests/js/spec/utils/discover/fieldRenderer.spec.jsx
@@ -25,6 +25,11 @@ describe('getFieldRenderer', function() {
       latest_event: 'deadbeef',
       project: project.slug,
     };
+
+    MockApiClient.addMockResponse({
+      url: `/organizations/${organization.slug}/projects/${project.slug}/`,
+      body: project,
+    });
   });
 
   it('can render string fields', function() {
@@ -83,6 +88,6 @@ describe('getFieldRenderer', function() {
 
     const value = wrapper.find('ProjectBadge');
     expect(value).toHaveLength(1);
-    expect(value.props().project).toEqual(project);
+    expect(value.text()).toEqual(project.slug);
   });
 });
