commit 99e74d6e60e26244c28a9b398fcd8de0063e5a82
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Thu Oct 25 20:27:58 2018 +0200

    feat: Restore ability to set upstream DSN for internal errors (#10270)
    
    * feat: Restore ability to set upstream DSN for internal errors
    
    * fix: Restore install-id

diff --git a/src/sentry/utils/sdk.py b/src/sentry/utils/sdk.py
index d9d090fe45..87f1103baf 100644
--- a/src/sentry/utils/sdk.py
+++ b/src/sentry/utils/sdk.py
@@ -11,7 +11,7 @@ from django.utils.functional import cached_property
 
 import sentry_sdk
 
-from sentry_sdk.transport import Transport
+from sentry_sdk.transport import Transport, HttpTransport
 from sentry_sdk.consts import VERSION as SDK_VERSION
 from sentry_sdk.utils import Auth, capture_internal_exceptions
 from sentry_sdk.utils import logger as sdk_logger
@@ -80,14 +80,30 @@ def configure_sdk():
 
     assert sentry_sdk.Hub.main.client is None
 
+    options = settings.SENTRY_SDK_CONFIG
+
+    internal_transport = InternalTransport()
+    upstream_transport = None
+    if options.get('dsn'):
+        upstream_transport = HttpTransport(options)
+
+    def capture_event(event):
+        internal_transport.capture_event(event)
+
+        if upstream_transport is not None:
+            from sentry import options
+            event.setdefault('tags', {})['install-id'] = \
+                options.get('sentry:install-id')
+            upstream_transport.capture_event(event)
+
     sentry_sdk.init(
         integrations=[
             DjangoIntegration(),
             CeleryIntegration(),
             LoggingIntegration(event_level=None)
         ],
-        transport=InternalTransport(),
-        **settings.SENTRY_SDK_CONFIG
+        transport=capture_event,
+        **options
     )
 
 
