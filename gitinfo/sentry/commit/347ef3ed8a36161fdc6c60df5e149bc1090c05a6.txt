commit 347ef3ed8a36161fdc6c60df5e149bc1090c05a6
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 6 17:17:25 2018 -0700

    Fix bitfield queries

diff --git a/src/sentry/models/projectkey.py b/src/sentry/models/projectkey.py
index 836502ab5c..f02fb084cd 100644
--- a/src/sentry/models/projectkey.py
+++ b/src/sentry/models/projectkey.py
@@ -115,12 +115,11 @@ class ProjectKey(Model):
 
     @classmethod
     def get_default(cls, project):
-        try:
-            return cls.objects.filter(
-                project=project, roles=cls.roles.store, status=ProjectKeyStatus.ACTIVE
-            )[0]
-        except IndexError:
-            return None
+        return cls.objects.filter(
+            project=project,
+            roles=models.F('roles').bitor(cls.roles.store),
+            status=ProjectKeyStatus.ACTIVE
+        ).first()
 
     @property
     def is_active(self):
diff --git a/src/sentry/web/frontend/organization_auth_settings.py b/src/sentry/web/frontend/organization_auth_settings.py
index 25ae96046f..1688089212 100644
--- a/src/sentry/web/frontend/organization_auth_settings.py
+++ b/src/sentry/web/frontend/organization_auth_settings.py
@@ -139,7 +139,7 @@ class OrganizationAuthSettingsView(OrganizationView):
 
         pending_links_count = OrganizationMember.objects.filter(
             organization=organization,
-            flags=~getattr(OrganizationMember.flags, 'sso:linked'),
+            flags=F('flags').bitand(~getattr(OrganizationMember.flags, 'sso:linked')),
         ).count()
 
         context = {
