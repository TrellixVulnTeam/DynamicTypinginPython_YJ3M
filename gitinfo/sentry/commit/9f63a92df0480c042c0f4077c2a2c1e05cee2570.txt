commit 9f63a92df0480c042c0f4077c2a2c1e05cee2570
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Dec 4 12:31:57 2014 -0800

    Record total events and reject events

diff --git a/src/sentry/tsdb/base.py b/src/sentry/tsdb/base.py
index db6f4ca689..a405be3c4a 100644
--- a/src/sentry/tsdb/base.py
+++ b/src/sentry/tsdb/base.py
@@ -14,15 +14,16 @@ ONE_HOUR = ONE_MINUTE * 60
 ONE_DAY = ONE_HOUR * 24
 
 
+# rollups must be ordered from highest granularity to lowest
 ROLLUPS = (
-    # time in seconds, samples to keep
+    # (time in seconds, samples to keep)
     (10, 30),  # 5 minute at 10 seconds
     (ONE_HOUR, ONE_DAY * 7),  # 1 days at 1 hour
-    # (ONE_DAY, 30),  # 30 days at 1 day
 )
 
 
 class TSDBModel(Enum):
+    # number of events seen specific to grouping
     project = 1
     project_tag_key = 2
     project_tag_value = 3
@@ -30,6 +31,11 @@ class TSDBModel(Enum):
     group_tag_key = 5
     group_tag_value = 6
 
+    # the number of events sent to the server
+    project_total_received = 100
+    # the number of events rejected due to rate limiting
+    project_total_rejected = 101
+
 
 class BaseTSDB(object):
     models = TSDBModel
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index f871b68e28..e42240b664 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -318,7 +318,13 @@ class StoreView(APIView):
             rate_limit = RateLimit(is_limited=rate_limit, retry_after=None)
 
         if rate_limit is not None and rate_limit.is_limited:
+            app.tsdb.incr_multi(
+                (app.tsdb.models.project_total_received, project.id),
+                (app.tsdb.models.project_total_rejected, project.id),
+            )
             raise APIRateLimited(rate_limit.retry_after)
+        else:
+            app.tsdb.incr(app.tsdb.models.project_total_received, project.id)
 
         result = plugins.first('has_perm', request.user, 'create_event', project)
         if result is False:
