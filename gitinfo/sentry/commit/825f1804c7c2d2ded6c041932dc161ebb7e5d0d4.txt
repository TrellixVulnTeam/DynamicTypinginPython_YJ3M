commit 825f1804c7c2d2ded6c041932dc161ebb7e5d0d4
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jan 20 16:51:50 2013 -0800

    Annotate frames with sourcemap data if available

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index 3055dde7fa..b5ae474874 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -352,7 +352,7 @@ class Stacktrace(Interface):
 
             in_app = bool(frame.get('in_app', True))
 
-            frames.append({
+            frame_data = {
                 'abs_path': frame.get('abs_path'),
                 'filename': frame['filename'],
                 'function': frame.get('function'),
@@ -361,7 +361,18 @@ class Stacktrace(Interface):
                 'context': context,
                 'vars': context_vars,
                 'in_app': in_app,
-            })
+            }
+
+            if event.platform == 'javascript' and frame.get('data'):
+                data = frame['data']
+                frame_data.update({
+                    'sourcemap': data['sourcemap'].rsplit('/', 1)[-1],
+                    'orig_filename': data['orig_filename'],
+                    'orig_lineno': data['orig_lineno'],
+                    'orig_colno': data['orig_colno'],
+                })
+
+            frames.append(frame_data)
 
             if not in_app:
                 system_frames += 1
diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 54cc3ce10f..4039d9a77a 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -898,7 +898,20 @@ ul.traceback { list-style-type: none; margin-left: 0; }
     color: #999;
   }
 
+  p {
+    font-size: 12px;
+
+    a.annotation {
+      color: inherit;
+      padding: 0 1px;
+      border-bottom: 1px dotted #666;
+      &:hover { text-decoration: none; }
+    }
+  }
+
   code {
+    padding: 0;
+    font-size: inherit;
     color: inherit;
   }
 
diff --git a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 239cde9c74..f5a8fedad1 100644
--- a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -23,7 +23,7 @@
             {% for frame in frames %}
                 <li class="frame{% if not frame.in_app %} system-frame{% endif %} frame-{{ forloop.counter0 }}">
                     <p>
-                        <code>{{ frame.filename }}</code>
+                        <code>{{ frame.filename }}</code>{% if frame.sourcemap %} <a href="#" class="annotation tip" rel="tooltip" data-placement="right" data-title="<div style='white-space:nowrap'>Occurred in {{ frame.orig_filename }} (line {{ frame.orig_lineno }}, col {{ frame.orig_colno }})</div><div>(via {{ frame.sourcemap }})</div>">?</a>{% endif %}
                         {% if frame.function %} in <code>{{ frame.function }}</code>{% endif %}
                         {% if not frame.context and frame.lineno %} at line <code>{{ frame.lineno }}</code>{% endif %}
                         {% if system_frames and frame.in_app %}
