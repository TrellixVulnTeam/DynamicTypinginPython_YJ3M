commit c4d5113c4a1872b2f405238df578b3384fb151f2
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 3 19:21:23 2013 -0700

    Improve a couple of tests

diff --git a/tests/sentry/models/tests.py b/tests/sentry/models/tests.py
index d74cda2c25..98f37488b7 100644
--- a/tests/sentry/models/tests.py
+++ b/tests/sentry/models/tests.py
@@ -110,14 +110,15 @@ class LostPasswordTest(TestCase):
         )
 
     def test_send_recover_mail(self):
-        self.password_hash.send_recover_mail()
-        assert len(mail.outbox) == 1
-        msg = mail.outbox[0]
-        assert msg.to == [self.user.email]
-        assert msg.subject == '[Sentry] Password Recovery'
-        url = 'http://testserver' + reverse('sentry-account-recover-confirm',
-            args=[self.password_hash.user_id, self.password_hash.hash])
-        assert url in msg.body
+        with self.Settings(SENTRY_URL_PREFIX='http://testserver'):
+            self.password_hash.send_recover_mail()
+            assert len(mail.outbox) == 1
+            msg = mail.outbox[0]
+            assert msg.to == [self.user.email]
+            assert msg.subject == '[Sentry] Password Recovery'
+            url = 'http://testserver' + reverse('sentry-account-recover-confirm',
+                args=[self.password_hash.user_id, self.password_hash.hash])
+            assert url in msg.body
 
 
 class AlertTest(TestCase):
diff --git a/tests/sentry/search/tests.py b/tests/sentry/search/tests.py
index 855928530d..b2393e58c1 100644
--- a/tests/sentry/search/tests.py
+++ b/tests/sentry/search/tests.py
@@ -34,5 +34,6 @@ class SearchIndexTest(TestCase):
         doc = SearchDocument.objects.index(event)
 
         results = list(SearchDocument.objects.search(event.project, event.message.upper()))
+        assert len(results) == 1
         [res] = results
         assert res.id == doc.id
