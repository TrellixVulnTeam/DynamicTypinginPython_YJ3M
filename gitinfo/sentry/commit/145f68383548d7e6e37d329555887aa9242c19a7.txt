commit 145f68383548d7e6e37d329555887aa9242c19a7
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Dec 7 12:27:01 2015 -0800

    Add a hack to keep SENTRY_URL_PREFIX up to date when reading
    system.url-prefix

diff --git a/src/sentry/options/manager.py b/src/sentry/options/manager.py
index 046cc4fb7e..bf0ada84f4 100644
--- a/src/sentry/options/manager.py
+++ b/src/sentry/options/manager.py
@@ -110,6 +110,11 @@ class OptionsManager(object):
         if not (opt.flags & FLAG_NOSTORE):
             result = self.store.get(opt, silent=silent)
             if result is not None:
+                # HACK(mattrobenolt): SENTRY_URL_PREFIX must be kept in sync
+                # when reading values from the database. This should
+                # be replaced by a signal.
+                if key == 'system.url-prefix':
+                    settings.SENTRY_URL_PREFIX = result
                 return result
 
         # Some values we don't want to allow them to be configured through
