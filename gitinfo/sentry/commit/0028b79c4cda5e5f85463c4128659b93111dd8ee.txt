commit 0028b79c4cda5e5f85463c4128659b93111dd8ee
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu May 9 09:30:03 2019 -0700

    test(js): Fix flakey savedSearchesStore test (#13145)
    
    Sometimes we assert before store is fully updated

diff --git a/tests/js/spec/stores/savedSearchesStore.spec.jsx b/tests/js/spec/stores/savedSearchesStore.spec.jsx
index 939f508ca5..a29e32e6e4 100644
--- a/tests/js/spec/stores/savedSearchesStore.spec.jsx
+++ b/tests/js/spec/stores/savedSearchesStore.spec.jsx
@@ -10,8 +10,9 @@ import {Client} from 'app/api';
 describe('SavedSearchesStore', function() {
   let api;
 
-  beforeAll(function() {
+  beforeAll(async function() {
     api = new Client();
+    await SavedSearchesStore.reset();
   });
 
   beforeEach(function() {
@@ -30,9 +31,10 @@ describe('SavedSearchesStore', function() {
     });
   });
 
-  afterEach(function() {
+  afterEach(async function() {
     Client.clearMockResponses();
     SavedSearchesStore.reset();
+    await tick();
   });
 
   it('get', function() {
@@ -64,8 +66,10 @@ describe('SavedSearchesStore', function() {
         isPinned: true,
       },
     });
+
     pinSearch(api, 'org-1', 0, 'level:info');
     await tick();
+    await tick();
 
     expect(SavedSearchesStore.get().savedSearches).toHaveLength(3);
     expect(SavedSearchesStore.get().savedSearches[0]).toEqual(
@@ -115,6 +119,7 @@ describe('SavedSearchesStore', function() {
 
     pinSearch(api, 'org-1', 0, searches[1].query);
     await tick();
+    await tick();
 
     // Order should remain the same
     expect(SavedSearchesStore.get().savedSearches[1]).toEqual(
@@ -161,6 +166,7 @@ describe('SavedSearchesStore', function() {
 
     pinSearch(api, 'org-1', 0, searches[1].query);
     await tick();
+    await tick();
 
     expect(SavedSearchesStore.get().savedSearches).toHaveLength(2);
 
@@ -208,6 +214,7 @@ describe('SavedSearchesStore', function() {
 
     unpinSearch(api, 'org-1', 0, searches[0]);
     await tick();
+    await tick();
 
     // Saved custom search should be removed
     expect(SavedSearchesStore.get().savedSearches).toHaveLength(2);
@@ -245,6 +252,7 @@ describe('SavedSearchesStore', function() {
 
     unpinSearch(api, 'org-1', 0, searches[0]);
     await tick();
+    await tick();
 
     expect(SavedSearchesStore.get().savedSearches).toHaveLength(2);
 
@@ -284,6 +292,7 @@ describe('SavedSearchesStore', function() {
 
     unpinSearch(api, 'org-1', 0, searches[0]);
     await tick();
+    await tick();
 
     expect(SavedSearchesStore.get().savedSearches).toHaveLength(2);
 
diff --git a/tests/js/spec/views/organizationStream/overview.spec.jsx b/tests/js/spec/views/organizationStream/overview.spec.jsx
index ab743d319a..1e9277ed31 100644
--- a/tests/js/spec/views/organizationStream/overview.spec.jsx
+++ b/tests/js/spec/views/organizationStream/overview.spec.jsx
@@ -193,6 +193,7 @@ describe('OrganizationStream', function() {
       expect(savedSearchesRequest).toHaveBeenCalledTimes(1);
       // Update stores with saved searches
       await tick();
+      await tick();
       wrapper.update();
 
       // auxillary requests being made
