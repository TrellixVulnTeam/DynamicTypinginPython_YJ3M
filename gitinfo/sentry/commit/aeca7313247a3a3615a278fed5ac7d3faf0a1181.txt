commit aeca7313247a3a3615a278fed5ac7d3faf0a1181
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Mar 7 14:38:09 2018 -0800

    feat(environments): Handle environment in saved searches (#7483)
    
    Saved search should be agnostic of environment with the environments feature

diff --git a/src/sentry/static/sentry/app/views/stream/stream.jsx b/src/sentry/static/sentry/app/views/stream/stream.jsx
index a237fce41a..3970110940 100644
--- a/src/sentry/static/sentry/app/views/stream/stream.jsx
+++ b/src/sentry/static/sentry/app/views/stream/stream.jsx
@@ -258,7 +258,22 @@ const Stream = createReactClass({
         search => search.id === searchId
       );
       if (searchResult) {
-        newState.query = searchResult.query;
+        // New behavior is that we'll no longer want to support environment in saved search
+        // We check if the query contains a valid environment and update the global setting if so
+        // We'll always strip environment from the querystring whether valid or not
+        if (this.props.hasEnvironmentsFeature) {
+          const queryEnv = queryString.getQueryEnvironment(searchResult.query);
+          if (queryEnv) {
+            const env = EnvironmentStore.getByName(queryEnv);
+            setActiveEnvironment(env);
+          }
+          newState.query = queryString.getQueryStringWithoutEnvironment(
+            searchResult.query
+          );
+        } else {
+          // Old behavior, keep the environment in the querystring
+          newState.query = searchResult.query;
+        }
       } else {
         newState.searchId = null;
       }
