commit eee462ee3dcd99b8d635da41d5aa46d436290920
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Nov 18 13:16:13 2016 -0800

    api: explicitly bind Organization to Project on event ingest (#4567)
    
    `Organization` was getting bound implicitly when it first checked to see
    if being rate limited. Because this binding is implicit, it doesn't
    allow us to attempt to fetch from cache, guaranteeing we do at least 1
    query for every event ingestion to inflate the `Organization`.
    
    Explicitly binding this allows us to also use `project.organization`
    later now without worrying which will actually be used in GH-4554.

diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index 763e93d194..2d61eaf83c 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -22,7 +22,7 @@ from sentry.coreapi import (
     APIError, APIForbidden, APIRateLimited, ClientApiHelper, CspApiHelper,
     LazyData
 )
-from sentry.models import Project, OrganizationOption
+from sentry.models import Project, OrganizationOption, Organization
 from sentry.signals import (
     event_accepted, event_dropped, event_filtered, event_received
 )
@@ -198,6 +198,12 @@ class APIView(BaseView):
             helper.context.bind_auth(auth)
             Raven.tags_context(helper.context.get_tags_context())
 
+            # Explicitly bind Organization so we don't implicitly query it later
+            # this just allows us to comfortably assure that `project.organization` is safe.
+            # This also allows us to pull the object from cache, instead of being
+            # implicitly fetched from database.
+            project.organization = Organization.objects.get_from_cache(id=project.organization_id)
+
             if auth.version != '2.0':
                 if not auth.secret_key:
                     # If we're missing a secret_key, check if we are allowed
