commit d6805368f38672f63b2af245500308de4989ca78
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed May 25 12:07:12 2016 -0700

    Only look up active accounts when linking SSO (#3333)

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index 9433af2643..2ecc290aa7 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -367,7 +367,7 @@ class AuthHelper(object):
         op = request.POST.get('op')
         if not request.user.is_authenticated():
             try:
-                existing_user = auth.find_users(identity['email'])[0]
+                existing_user = auth.find_users(identity['email'], is_active=True)[0]
             except IndexError:
                 existing_user = None
             login_form = self._get_login_form(existing_user)
diff --git a/src/sentry/utils/auth.py b/src/sentry/utils/auth.py
index 2ed5a9320d..c50950603f 100644
--- a/src/sentry/utils/auth.py
+++ b/src/sentry/utils/auth.py
@@ -81,12 +81,16 @@ def get_login_redirect(request, default=None):
     return login_url
 
 
-def find_users(username, with_valid_password=True):
+def find_users(username, with_valid_password=True, is_active=None):
     """
     Return a list of users that match a username
     and falling back to email
     """
     qs = User.objects
+
+    if is_active is not None:
+        qs = qs.filter(is_active=is_active)
+
     if with_valid_password:
         qs = qs.exclude(password='!')
 
