commit 88780c073a3b5a3c4620fb1e78aa2aadd6ebaadd
Author: David Cramer <dcramer@gmail.com>
Date:   Sun May 31 14:36:10 2015 +0200

    Improve shared header abstraction

diff --git a/src/sentry/static/sentry/app/components/header.jsx b/src/sentry/static/sentry/app/components/header.jsx
index 40bc1310fd..ccf9a54b56 100644
--- a/src/sentry/static/sentry/app/components/header.jsx
+++ b/src/sentry/static/sentry/app/components/header.jsx
@@ -9,6 +9,7 @@ var DropdownLink = require("./dropdownLink");
 var Gravatar = require("./gravatar");
 var MenuItem = require("./menuItem");
 var OrganizationState = require("../mixins/organizationState");
+var OrganizationStore = require("../stores/organizationStore");
 var UserInfo = require("./userInfo");
 
 var UserNav = React.createClass({
@@ -47,23 +48,25 @@ var UserNav = React.createClass({
 var OrganizationSelector = React.createClass({
   mixins: [
     AppState,
-    OrganizationState
   ],
 
+  shouldComponentUpdate(nextProps, nextState) {
+    return (nextProps.organization || {}).id !== (this.props.organization || {}).id;
+  },
+
   render() {
-    var activeOrg = this.getOrganization();
     var urlPrefix = ConfigStore.get('urlPrefix');
     var features = ConfigStore.get('features');
+    var activeOrg = this.props.organization;
 
     if (!activeOrg) {
-      // TODO
       return <div />;
     }
 
     return (
       <DropdownLink
           title={activeOrg.name}>
-        {this.getOrganizationList().map((org) => {
+        {OrganizationStore.getAll().map((org) => {
           var iconStyle = {
             backgroundImage: 'url(https://github.com/getsentry.png)' //TODO(dcramer) use actual org avatar
           };
@@ -87,13 +90,15 @@ var OrganizationSelector = React.createClass({
 
 
 var Header = React.createClass({
+  mixins: [OrganizationState],
+
   render() {
     return (
       <header>
         <div className="container">
           <UserNav className="pull-right" />
           <a href="/"><span className="icon-sentry-logo"></span></a>
-          <OrganizationSelector />
+          <OrganizationSelector organization={this.getOrganization()} />
         </div>
       </header>
     );
diff --git a/src/sentry/static/sentry/app/components/organizationHeader.jsx b/src/sentry/static/sentry/app/components/organizationHeader.jsx
index 458f551f01..6da553723c 100644
--- a/src/sentry/static/sentry/app/components/organizationHeader.jsx
+++ b/src/sentry/static/sentry/app/components/organizationHeader.jsx
@@ -3,13 +3,15 @@
 var React = require("react");
 
 var Breadcrumbs = require("./breadcrumbs");
-var Header = require("../components/header");
 
 var OrganizationHeader = React.createClass({
+  shouldComponentUpdate(nextProps, nextState) {
+    return false;
+  },
+
   render() {
     return (
       <div>
-        <Header />
         <div className="sub-header">
           <div className="container">
             <Breadcrumbs />
diff --git a/src/sentry/static/sentry/app/components/projectHeader.jsx b/src/sentry/static/sentry/app/components/projectHeader.jsx
index 4c61403738..1be5e93c5c 100644
--- a/src/sentry/static/sentry/app/components/projectHeader.jsx
+++ b/src/sentry/static/sentry/app/components/projectHeader.jsx
@@ -6,7 +6,6 @@ var Router = require("react-router");
 var AppState = require("../mixins/appState");
 var Breadcrumbs = require("./breadcrumbs");
 var ConfigStore = require("../stores/configStore");
-var Header = require("../components/header");
 
 var DateRangePicker = React.createClass({
   render() {
@@ -34,7 +33,6 @@ var ProjectHeader = React.createClass({
 
     return (
       <div>
-        <Header />
         <div className="sub-header">
           <div className="container">
             <div className="pull-right">
diff --git a/src/sentry/static/sentry/app/views/organizationDetails.jsx b/src/sentry/static/sentry/app/views/organizationDetails.jsx
index 781b7f9563..915a94d043 100644
--- a/src/sentry/static/sentry/app/views/organizationDetails.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDetails.jsx
@@ -6,6 +6,7 @@ var Router = require("react-router");
 var api = require("../api");
 var BreadcrumbMixin = require("../mixins/breadcrumbMixin");
 var LoadingIndicator = require("../components/loadingIndicator");
+var Header = require("../components/header");
 var PropTypes = require("../proptypes");
 var OrganizationState = require("../mixins/organizationState");
 // var OrganizationSidebar = require("../components/organizationSidebar");
@@ -90,6 +91,7 @@ var OrganizationDetails = React.createClass({
     return (
       <div>
         <div className="app">
+          <Header />
           <Router.RouteHandler />
           <Footer />
         </div>
