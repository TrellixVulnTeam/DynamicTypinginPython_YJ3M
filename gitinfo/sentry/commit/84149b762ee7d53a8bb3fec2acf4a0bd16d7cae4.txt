commit 84149b762ee7d53a8bb3fec2acf4a0bd16d7cae4
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Feb 17 02:37:41 2012 -0800

    Correctly handle context in render shortcuts

diff --git a/sentry/web/helpers.py b/sentry/web/helpers.py
index b7e2e86de6..4e0bc7c565 100644
--- a/sentry/web/helpers.py
+++ b/sentry/web/helpers.py
@@ -79,7 +79,7 @@ def iter_data(obj):
         yield k, v
 
 
-def get_default_context(request):
+def get_default_context(request, existing_context=None):
     from sentry.plugins import plugins
 
     context = {
@@ -96,18 +96,19 @@ def get_default_context(request):
             'request': request,
             'can_create_projects': can_create_projects(request.user),
         })
-        if 'project_list' not in context:
+        if not existing_context or 'project_list' not in existing_context:
             context['project_list'] = get_project_list(request.user).values()
 
     return context
 
 
 def render_to_string(template, context=None, request=None):
-    default_context = get_default_context(request)
+    default_context = get_default_context(request, context)
 
     if context is None:
         context = default_context
     else:
+        context = dict(context)
         context.update(default_context)
 
     if request:
