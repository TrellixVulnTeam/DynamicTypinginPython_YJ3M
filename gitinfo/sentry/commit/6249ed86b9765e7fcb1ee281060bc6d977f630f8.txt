commit 6249ed86b9765e7fcb1ee281060bc6d977f630f8
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Aug 10 18:04:32 2016 -0700

    Add support for working around react-native's encoding comment (#3909)

diff --git a/src/sentry/lang/javascript/processor.py b/src/sentry/lang/javascript/processor.py
index e87892f792..2689e388d7 100644
--- a/src/sentry/lang/javascript/processor.py
+++ b/src/sentry/lang/javascript/processor.py
@@ -191,6 +191,23 @@ def discover_sourcemap(result):
                 sourcemap = line[21:].rstrip()
 
     if sourcemap:
+        # react-native shoves a comment at the end of the
+        # sourceMappingURL line.
+        # For example:
+        #  sourceMappingURL=app.js.map/*ascii:...*/
+        # This comment is completely out of spec and no browser
+        # would support this, but we need to strip it to make
+        # people happy.
+        if '/*' in sourcemap and sourcemap[-2:] == '*/':
+            index = sourcemap.index('/*')
+            # comment definitely shouldn't be the first character,
+            # so let's just make sure of that.
+            if index == 0:
+                raise AssertionError(
+                    'react-native comment found at bad location: %d, %r' %
+                    (index, sourcemap)
+                )
+            sourcemap = sourcemap[:index]
         # fix url so its absolute
         sourcemap = urljoin(result.url, sourcemap)
 
diff --git a/tests/sentry/lang/javascript/test_processor.py b/tests/sentry/lang/javascript/test_processor.py
index 72e95cbe98..bfdc31a7a5 100644
--- a/tests/sentry/lang/javascript/test_processor.py
+++ b/tests/sentry/lang/javascript/test_processor.py
@@ -207,6 +207,13 @@ class DiscoverSourcemapTest(TestCase):
         result = UrlResult('http://example.com', {}, 'console.log(true)\n//# sourceMappingURL=http://example.com/source.map.js\n//# sourceMappingURL=http://example.com/source2.map.js')
         assert discover_sourcemap(result) == 'http://example.com/source2.map.js'
 
+        result = UrlResult('http://example.com', {}, '//# sourceMappingURL=app.map.js/*ascii:lol*/')
+        assert discover_sourcemap(result) == 'http://example.com/app.map.js'
+
+        result = UrlResult('http://example.com', {}, '//# sourceMappingURL=/*lol*/')
+        with self.assertRaises(AssertionError):
+            discover_sourcemap(result)
+
 
 class GenerateModuleTest(TestCase):
     def test_simple(self):
