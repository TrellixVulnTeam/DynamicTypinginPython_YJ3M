commit cf20bb17f598e9a86ac18c3197f00f44097e392b
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 26 13:25:33 2016 -0800

    Loosen credit card data filtering

diff --git a/src/sentry/utils/data_scrubber.py b/src/sentry/utils/data_scrubber.py
index 380f1f271f..3a35f81b10 100644
--- a/src/sentry/utils/data_scrubber.py
+++ b/src/sentry/utils/data_scrubber.py
@@ -46,7 +46,8 @@ class SensitiveDataFilter(object):
     Asterisk out things that look like passwords, credit card numbers,
     and API keys in frames, http, and basic extra data.
     """
-    VALUES_RE = re.compile(r'\b(?:\d[ -]*?){13,16}\b')
+    # http://www.richardsramblings.com/regex/credit-card-numbers/
+    VALUES_RE = re.compile(r'\b(?:3[47]\d|(?:4\d|5[1-5]|65)\d{2}|6011)\d{12}\b')
     URL_PASSWORD_RE = re.compile(r'\b((?:[a-z0-9]+:)?//[^:]+:)([^@]+)@')
 
     def __init__(self, fields=None, include_defaults=True):
diff --git a/tests/sentry/utils/test_data_scrubber.py b/tests/sentry/utils/test_data_scrubber.py
index d5715f752c..6036a7a9b1 100644
--- a/tests/sentry/utils/test_data_scrubber.py
+++ b/tests/sentry/utils/test_data_scrubber.py
@@ -138,23 +138,43 @@ class SensitiveDataFilterTest(TestCase):
 
     def test_sanitize_credit_card(self):
         proc = SensitiveDataFilter()
-        result = proc.sanitize('foo', '4242424242424242')
-        self.assertEquals(result, FILTER_MASK)
+        result = proc.sanitize('foo', '4571234567890111')
+        assert result == FILTER_MASK
 
     def test_sanitize_credit_card_amex(self):
         # AMEX numbers are 15 digits, not 16
         proc = SensitiveDataFilter()
-        result = proc.sanitize('foo', '424242424242424')
-        self.assertEquals(result, FILTER_MASK)
+        result = proc.sanitize('foo', '378282246310005')
+        assert result == FILTER_MASK
+
+    def test_sanitize_credit_card_discover(self):
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', '6011111111111117')
+        assert result == FILTER_MASK
+
+    def test_sanitize_credit_card_visa(self):
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', '4111111111111111')
+        assert result == FILTER_MASK
+
+    def test_sanitize_credit_card_mastercard(self):
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', '5555555555554444')
+        assert result == FILTER_MASK
 
     def test_sanitize_credit_card_within_value(self):
         proc = SensitiveDataFilter()
-        result = proc.sanitize('foo', "'4242424242424242'")
-        self.assertEquals(result, FILTER_MASK)
+        result = proc.sanitize('foo', "'4571234567890111'")
+        assert result == FILTER_MASK
+
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', "foo 4571234567890111")
+        assert result == FILTER_MASK
 
+    def test_does_not_sanitize_timestamp_looks_like_card(self):
         proc = SensitiveDataFilter()
-        result = proc.sanitize('foo', "foo 4242424242424242")
-        self.assertEquals(result, FILTER_MASK)
+        result = proc.sanitize('foo', '1453843029218310')
+        assert result == '1453843029218310'
 
     def test_sanitize_url(self):
         proc = SensitiveDataFilter()
