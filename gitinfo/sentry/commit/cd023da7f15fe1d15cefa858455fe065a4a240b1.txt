commit cd023da7f15fe1d15cefa858455fe065a4a240b1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 6 21:37:52 2013 -0700

    Support module as alternative to filename and bail out on missing function/filenames

diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index be20b4062f..d3630de422 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -84,18 +84,23 @@ def record_affected_code(group, event, **kwargs):
             if has_app_frames and not frame.in_app:
                 continue
 
-            tags.extend((
-                (
-                    'sentry:filename',
-                    checksum(frame.filename),
-                    {'filename': frame.filename},
-                ),
-                (
-                    'sentry:function',
-                    checksum('%s:%s' % (frame.filename, frame.function)),
-                    {'filename': frame.filename, 'function': frame.function}
-                )
+            filename = frame.filename or frame.module
+            if not filename:
+                continue
+
+            tags.append((
+                'sentry:filename',
+                checksum(filename),
+                {'filename': filename},
             ))
 
+            function = frame.function
+            if function:
+                tags.append((
+                    'sentry:function',
+                    checksum('%s:%s' % (filename, function)),
+                    {'filename': filename, 'function': function}
+                ))
+
     if tags:
         Group.objects.add_tags(group, tags)
