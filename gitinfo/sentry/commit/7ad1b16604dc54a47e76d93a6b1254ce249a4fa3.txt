commit 7ad1b16604dc54a47e76d93a6b1254ce249a4fa3
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 25 20:01:44 2013 -0800

    Add callbacks to RangeQuerySetWrapper

diff --git a/src/sentry/utils/query.py b/src/sentry/utils/query.py
index 666e09a075..250467a70a 100644
--- a/src/sentry/utils/query.py
+++ b/src/sentry/utils/query.py
@@ -53,7 +53,7 @@ class RangeQuerySetWrapper(object):
     """
 
     def __init__(self, queryset, step=1000, limit=None, min_id=None,
-                 order_by='pk'):
+                 order_by='pk', callbacks=()):
         # Support for slicing
         if queryset.query.low_mark == 0 and not \
                 (queryset.query.order_by or queryset.query.extra_order_by):
@@ -73,6 +73,7 @@ class RangeQuerySetWrapper(object):
         self.queryset = queryset
         self.min_value = min_id
         self.order_by = order_by
+        self.callbacks = callbacks
 
     def __iter__(self):
         max_value = None
@@ -104,7 +105,10 @@ class RangeQuerySetWrapper(object):
             elif not self.desc:
                 results = queryset.filter(**{'%s__gte' % self.order_by: cur_value})
 
-            results = results[offset:offset + self.step].iterator()
+            results = list(results[offset:offset + self.step])
+
+            for cb in self.callbacks:
+                cb(results)
 
             for result in results:
                 yield result
