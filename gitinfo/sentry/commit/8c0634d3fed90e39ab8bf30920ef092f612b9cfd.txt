commit 8c0634d3fed90e39ab8bf30920ef092f612b9cfd
Author: Alberto Leal <mail4alberto@gmail.com>
Date:   Fri Feb 14 10:06:51 2020 -0500

    fix(discover2): Normalize timestamp field for count() drilldowns (#17017)

diff --git a/src/sentry/static/sentry/app/views/eventsV2/utils.tsx b/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
index 1f752ec207..c5162d02a2 100644
--- a/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
+++ b/src/sentry/static/sentry/app/views/eventsV2/utils.tsx
@@ -389,7 +389,16 @@ export function getExpandedResults(
     // match their name.
     if (dataRow) {
       if (dataRow[dataKey]) {
-        additionalConditions[column.field] = String(dataRow[dataKey]).trim();
+        const nextValue = String(dataRow[dataKey]).trim();
+
+        switch (column.field) {
+          case 'timestamp':
+            // normalize the "timestamp" field to ensure the payload works
+            additionalConditions[column.field] = getUtcDateString(nextValue);
+            break;
+          default:
+            additionalConditions[column.field] = nextValue;
+        }
       }
       // If we have an event, check tags as well.
       if (dataRow && dataRow.tags && dataRow.tags instanceof Array) {
diff --git a/tests/js/spec/views/eventsV2/utils.spec.jsx b/tests/js/spec/views/eventsV2/utils.spec.jsx
index 744aee0ed0..48d992d859 100644
--- a/tests/js/spec/views/eventsV2/utils.spec.jsx
+++ b/tests/js/spec/views/eventsV2/utils.spec.jsx
@@ -437,6 +437,20 @@ describe('getExpandedResults()', function() {
     expect(result.query).toEqual('event.type:error');
     expect(result.environment).toEqual(['staging', 'dev']);
   });
+
+  it('normalizes the timestamp field', () => {
+    const view = new EventView({
+      ...state,
+      fields: [{field: 'timestamp'}],
+      sorts: [{field: 'timestamp', kind: 'desc'}],
+    });
+    const event = {
+      type: 'error',
+      timestamp: '2020-02-13T17:05:46+00:00',
+    };
+    const result = getExpandedResults(view, {}, event);
+    expect(result.query).toEqual('event.type:error timestamp:2020-02-13T17:05:46');
+  });
 });
 
 describe('getDiscoverLandingUrl', function() {
