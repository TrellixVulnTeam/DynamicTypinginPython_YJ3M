commit f20968e34a6376e63935b7deeab20054d20eb2b8
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Nov 16 13:02:58 2013 -0800

    Abstract note saving into form

diff --git a/src/sentry/web/forms/__init__.py b/src/sentry/web/forms/__init__.py
index 99546a2a57..5cc6f064d8 100644
--- a/src/sentry/web/forms/__init__.py
+++ b/src/sentry/web/forms/__init__.py
@@ -9,7 +9,7 @@ from django import forms
 from django.utils.translation import ugettext_lazy as _
 
 from sentry.interfaces import Http
-from sentry.models import User
+from sentry.models import User, Activity
 from sentry.web.forms.fields import RadioFieldRenderer
 
 
@@ -65,3 +65,13 @@ class TestEmailForm(forms.Form):
 
 class NewNoteForm(forms.Form):
     text = forms.CharField(widget=forms.Textarea(attrs={'class': 'span8'}))
+
+    def save(self, event, user):
+        activity = Activity.objects.create(
+            group=event.group, event=event, project=event.project,
+            type=Activity.NOTE, user=user,
+            data=self.cleaned_data
+        )
+        activity.send_notification()
+
+        return activity
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 9576353977..56cf1343c3 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -395,12 +395,7 @@ def group(request, team, project, group, event_id=None):
     if request.POST.get('o') == 'note' and request.user.is_authenticated():
         add_note_form = NewNoteForm(request.POST)
         if add_note_form.is_valid():
-            activity = Activity.objects.create(
-                group=group, event=event, project=project,
-                type=Activity.NOTE, user=request.user,
-                data=add_note_form.cleaned_data
-            )
-            activity.send_notification()
+            add_note_form.save(event, request.user)
             return HttpResponseRedirect(request.path)
     else:
         add_note_form = NewNoteForm()
