commit bb8f7f63ca9e551b74692ac70336ea4579334736
Author: Chris Clark <christopherchristopherclark@gmail.com>
Date:   Mon Aug 27 13:55:21 2018 -0400

    Feat(issue sync): hover card for issue sync items (#9394)
    
    * basic styles setup
    
    * show integrationItem if nothing is linked
    
    * move it on up
    
    * connected issue hovercard content
    
    * clean up integrationItem
    
    * remove unecessary prop and update snapshot tests
    
    * update snapshot
    
    * use translation for hover card header
    
    * labels should be it's own component
    
    * better label translation and verbage that makes sense when no issue added

diff --git a/src/sentry/static/sentry/app/components/group/externalIssueActions.jsx b/src/sentry/static/sentry/app/components/group/externalIssueActions.jsx
index 39d13545e3..c3b19dc611 100644
--- a/src/sentry/static/sentry/app/components/group/externalIssueActions.jsx
+++ b/src/sentry/static/sentry/app/components/group/externalIssueActions.jsx
@@ -3,14 +3,18 @@ import React from 'react';
 import PropTypes from 'prop-types';
 import Modal from 'react-bootstrap/lib/Modal';
 import queryString from 'query-string';
+import styled from 'react-emotion';
 
 import {addSuccessMessage, addErrorMessage} from 'app/actionCreators/indicator';
 import AsyncComponent from 'app/components/asyncComponent';
 import IssueSyncListElement from 'app/components/issueSyncListElement';
 import FieldFromConfig from 'app/views/settings/components/forms/fieldFromConfig';
+import IntegrationItem from 'app/views/organizationIntegrations/integrationItem';
 import Form from 'app/views/settings/components/forms/form';
 import SentryTypes from 'app/sentryTypes';
 import {t} from 'app/locale';
+import overflowEllipsis from 'app/styles/overflowEllipsis';
+import space from 'app/styles/space';
 
 const MESSAGES_BY_ACTION = {
   link: t('Successfully linked issue.'),
@@ -255,6 +259,19 @@ class ExternalIssueActions extends AsyncComponent {
           onClose={this.deleteIssue.bind(this)}
           integrationType={selectedIntegration.provider.key}
           integrationName={selectedIntegration.name}
+          hoverCardHeader={t('Linked %s Integration', selectedIntegration.provider.name)}
+          hoverCardBody={
+            issue && issue.title ? (
+              <div>
+                <IssueTitle>{issue.title}</IssueTitle>
+                {issue.description && (
+                  <IssueDescription>{issue.description}</IssueDescription>
+                )}
+              </div>
+            ) : (
+              <IntegrationItem integration={selectedIntegration} />
+            )
+          }
         />
         {selectedIntegration && (
           <Modal
@@ -297,4 +314,15 @@ class ExternalIssueActions extends AsyncComponent {
   }
 }
 
+const IssueTitle = styled('div')`
+  font-size: 1.1em;
+  font-weight: 600;
+  ${overflowEllipsis};
+`;
+
+const IssueDescription = styled('div')`
+  margin-top: ${space(1)};
+  ${overflowEllipsis};
+`;
+
 export default ExternalIssueActions;
diff --git a/src/sentry/static/sentry/app/components/issueSyncListElement.jsx b/src/sentry/static/sentry/app/components/issueSyncListElement.jsx
index 5a88581fff..dbb7c5c6aa 100644
--- a/src/sentry/static/sentry/app/components/issueSyncListElement.jsx
+++ b/src/sentry/static/sentry/app/components/issueSyncListElement.jsx
@@ -1,19 +1,32 @@
 import PropTypes from 'prop-types';
 import React from 'react';
-import styled from 'react-emotion';
+import styled, {css} from 'react-emotion';
 import InlineSvg from 'app/components/inlineSvg';
 import space from 'app/styles/space';
 import {capitalize} from 'lodash';
+import Hovercard from 'app/components/hovercard';
+
+const hoverCardContainer = css`
+  display: flex;
+  align-items: center;
+`;
+
+const hoverCardStyles = css`
+  min-height: 0;
+  bottom: ${28 + 10}px; /* 28px is the current bottom value called in hovercard.less */
+`;
 
 class IssueSyncElement extends React.Component {
   static propTypes = {
     externalIssueLink: PropTypes.string,
-    externalIssueId: PropTypes.string,
+    externalIssueId: PropTypes.number,
     externalIssueKey: PropTypes.string,
     onOpen: PropTypes.func,
     onClose: PropTypes.func,
     integrationType: PropTypes.string,
     integrationName: PropTypes.string,
+    hoverCardHeader: PropTypes.node,
+    hoverCardBody: PropTypes.node,
   };
 
   isLinked() {
@@ -81,10 +94,15 @@ class IssueSyncElement extends React.Component {
   render() {
     return (
       <IssueSyncListElementContainer>
-        <div>
+        <Hovercard
+          containerClassName={hoverCardContainer}
+          header={this.props.hoverCardHeader}
+          body={this.props.hoverCardBody}
+          className={hoverCardStyles}
+        >
           {this.getIcon()}
           {this.getLink()}
-        </div>
+        </Hovercard>
         {this.props.onOpen &&
           this.props.onClose && (
             <OpenCloseIcon
@@ -103,8 +121,9 @@ const IssueSyncListElementContainer = styled('div')`
   display: flex;
   align-items: center;
   justify-content: space-between;
+
   &:not(:last-child) {
-    padding-bottom: ${space(2)};
+    margin-bottom: ${space(2)};
   }
 `;
 
@@ -122,6 +141,7 @@ const IntegrationLink = styled('a')`
   color: ${p => p.theme.gray4};
   border-bottom: 1px solid ${p => p.theme.gray4};
   cursor: pointer;
+  line-height: 1;
 
   &,
   &:hover {
diff --git a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationItem.jsx b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationItem.jsx
index bfc9608330..a147ff036c 100644
--- a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationItem.jsx
+++ b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationItem.jsx
@@ -35,40 +35,30 @@ export default class IntegrationItem extends React.Component {
               </Tooltip>
             )}
           </IntegrationName>
-          <DomainName>{integration.domainName}</DomainName>
+          <DomainName compact={compact}>{integration.domainName}</DomainName>
         </Labels>
       </Flex>
     );
   }
 }
 
-const ExpandedLabels = styled(p => <Flex direction="column" pl={1} {...p} />)``;
+const Labels = p => {
+  const {compact, ...props} = p;
 
-const CompactLabels = styled(p => (
-  <Flex align="center" direction="row" pl={1} {...p} />
-))``;
+  return compact ? (
+    <Flex align="center" direction="row" pl={1} {...props} />
+  ) : (
+    <Flex direction="column" pl={1} {...props} />
+  );
+};
 
 const IntegrationName = styled('div')`
   font-size: 1.6rem;
 `;
 
 const DomainName = styled('div')`
-  color: ${p => p.theme.gray3};
+  color: ${p => (p.compact ? p.theme.gray1 : p.theme.gray3)};
+  margin-left: ${p => (p.compact ? space(1) : 'inherit')};
+  margin-top: ${p => (!p.compact ? space(0.25) : 'inherit')};
   font-size: 1.4rem;
-
-  /* stylelint-disable-next-line no-duplicate-selectors */
-  ${ExpandedLabels} & {
-    margin-top: 3px;
-  }
-
-  /* stylelint-disable-next-line no-duplicate-selectors */
-  ${CompactLabels} & {
-    color: ${p => p.theme.gray1};
-    margin-left: ${space(1)};
-  }
 `;
-
-const Labels = p => {
-  const {compact, ...props} = p;
-  return compact ? <CompactLabels {...props} /> : <ExpandedLabels {...props} />;
-};
diff --git a/src/sentry/static/sentry/less/sentry-hovercard.less b/src/sentry/static/sentry/less/sentry-hovercard.less
index 7a99cd0be7..6a8f115b9f 100644
--- a/src/sentry/static/sentry/less/sentry-hovercard.less
+++ b/src/sentry/static/sentry/less/sentry-hovercard.less
@@ -174,7 +174,7 @@
 
   .hovercard-body {
     padding: @hovercard-padding;
-    min-height: 74px;
+    min-height: 50px;
 
     .commit-heading {
       margin: 10px 0;
diff --git a/tests/js/spec/components/__snapshots__/issueSyncListElement.spec.jsx.snap b/tests/js/spec/components/__snapshots__/issueSyncListElement.spec.jsx.snap
index 3533c184d9..58a51dd227 100644
--- a/tests/js/spec/components/__snapshots__/issueSyncListElement.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/issueSyncListElement.spec.jsx.snap
@@ -2,13 +2,17 @@
 
 exports[`AlertLink renders 1`] = `
 <IssueSyncListElementContainer>
-  <div>
+  <Hovercard
+    className="css-17m6soy-hoverCardStyles"
+    containerClassName="css-1s8b4pt-hoverCardContainer"
+    displayTimeout={100}
+  >
     <IntegrationIcon
       src="icon-github"
     />
     <IntegrationLink>
       Link GitHub Issue
     </IntegrationLink>
-  </div>
+  </Hovercard>
 </IssueSyncListElementContainer>
 `;
diff --git a/tests/js/spec/components/group/__snapshots__/externalIssueActions.spec.jsx.snap b/tests/js/spec/components/group/__snapshots__/externalIssueActions.spec.jsx.snap
index 41f52cdc8c..91cfd056fa 100644
--- a/tests/js/spec/components/group/__snapshots__/externalIssueActions.spec.jsx.snap
+++ b/tests/js/spec/components/group/__snapshots__/externalIssueActions.spec.jsx.snap
@@ -2,9 +2,38 @@
 
 exports[`ExternalIssueActions with an external issue linked renders 1`] = `
 <IssueSyncElement
-  externalIssueId="100"
+  externalIssueId={100}
   externalIssueKey="getsentry/sentry#2"
   externalIssueLink="https://github.com/MeredithAnya/testing/issues/2"
+  hoverCardBody={
+    <IntegrationItem
+      integration={
+        Object {
+          "configData": Object {},
+          "configOrganization": Array [],
+          "domainName": "gtithub.com/test-integration",
+          "externalIssues": Array [
+            Object {
+              "id": 100,
+              "key": "getsentry/sentry#2",
+              "url": "https://github.com/MeredithAnya/testing/issues/2",
+            },
+          ],
+          "icon": "http://example.com/integration_icon.png",
+          "id": "1",
+          "name": "Test Integration",
+          "projects": Array [],
+          "provider": Object {
+            "canAdd": true,
+            "features": Array [],
+            "key": "github",
+            "name": "GitHub",
+          },
+        }
+      }
+    />
+  }
+  hoverCardHeader="Linked GitHub Integration"
   integrationName="Test Integration"
   integrationType="github"
   onClose={[Function]}
@@ -12,62 +41,101 @@ exports[`ExternalIssueActions with an external issue linked renders 1`] = `
 >
   <IssueSyncListElementContainer>
     <div
-      className="css-43gy94-IssueSyncListElementContainer e1vaar1z0"
+      className="css-lh3vnw-IssueSyncListElementContainer e1vaar1z0"
     >
-      <div>
-        <IntegrationIcon
-          src="icon-github"
+      <Hovercard
+        body={
+          <IntegrationItem
+            integration={
+              Object {
+                "configData": Object {},
+                "configOrganization": Array [],
+                "domainName": "gtithub.com/test-integration",
+                "externalIssues": Array [
+                  Object {
+                    "id": 100,
+                    "key": "getsentry/sentry#2",
+                    "url": "https://github.com/MeredithAnya/testing/issues/2",
+                  },
+                ],
+                "icon": "http://example.com/integration_icon.png",
+                "id": "1",
+                "name": "Test Integration",
+                "projects": Array [],
+                "provider": Object {
+                  "canAdd": true,
+                  "features": Array [],
+                  "key": "github",
+                  "name": "GitHub",
+                },
+              }
+            }
+          />
+        }
+        className="css-17m6soy-hoverCardStyles"
+        containerClassName="css-1s8b4pt-hoverCardContainer"
+        displayTimeout={100}
+        header="Linked GitHub Integration"
+      >
+        <span
+          className="hovercard-container css-1s8b4pt-hoverCardContainer"
+          onMouseEnter={[Function]}
+          onMouseLeave={[Function]}
         >
-          <InlineSvg
-            className="css-qf3g6n-IntegrationIcon e1vaar1z1"
+          <IntegrationIcon
             src="icon-github"
           >
-            <StyledSvg
+            <InlineSvg
               className="css-qf3g6n-IntegrationIcon e1vaar1z1"
-              height="1em"
-              viewBox={Object {}}
-              width="1em"
+              src="icon-github"
             >
-              <svg
-                className="e1vaar1z1 css-18jkql6-StyledSvg-IntegrationIcon e2idor0"
+              <StyledSvg
+                className="css-qf3g6n-IntegrationIcon e1vaar1z1"
                 height="1em"
                 viewBox={Object {}}
                 width="1em"
               >
-                <use
-                  href="#test"
-                  xlinkHref="#test"
-                />
-              </svg>
-            </StyledSvg>
-          </InlineSvg>
-        </IntegrationIcon>
-        <IntegrationLink
-          href="https://github.com/MeredithAnya/testing/issues/2"
-        >
-          <a
-            className="css-1ado49n-IntegrationLink e1vaar1z2"
+                <svg
+                  className="e1vaar1z1 css-18jkql6-StyledSvg-IntegrationIcon e2idor0"
+                  height="1em"
+                  viewBox={Object {}}
+                  width="1em"
+                >
+                  <use
+                    href="#test"
+                    xlinkHref="#test"
+                  />
+                </svg>
+              </StyledSvg>
+            </InlineSvg>
+          </IntegrationIcon>
+          <IntegrationLink
             href="https://github.com/MeredithAnya/testing/issues/2"
           >
-            getsentry/sentry#2
-          </a>
-        </IntegrationLink>
-      </div>
+            <a
+              className="css-oytllg-IntegrationLink e1vaar1z2"
+              href="https://github.com/MeredithAnya/testing/issues/2"
+            >
+              getsentry/sentry#2
+            </a>
+          </IntegrationLink>
+        </span>
+      </Hovercard>
       <OpenCloseIcon
-        isLinked="100"
+        isLinked={100}
         onClick={[Function]}
         src="icon-close"
       >
         <InlineSvg
           className="css-92xk5s-OpenCloseIcon e1vaar1z3"
-          isLinked="100"
+          isLinked={100}
           onClick={[Function]}
           src="icon-close"
         >
           <StyledSvg
             className="css-92xk5s-OpenCloseIcon e1vaar1z3"
             height="1em"
-            isLinked="100"
+            isLinked={100}
             onClick={[Function]}
             viewBox={Object {}}
             width="1em"
@@ -150,6 +218,29 @@ exports[`ExternalIssueActions with no external issues linked renders 1`] = `
     externalIssueId={null}
     externalIssueKey={null}
     externalIssueLink={null}
+    hoverCardBody={
+      <IntegrationItem
+        integration={
+          Object {
+            "configData": Object {},
+            "configOrganization": Array [],
+            "domainName": "gtithub.com/test-integration",
+            "externalIssues": Array [],
+            "icon": "http://example.com/integration_icon.png",
+            "id": "1",
+            "name": "Test Integration",
+            "projects": Array [],
+            "provider": Object {
+              "canAdd": true,
+              "features": Array [],
+              "key": "github",
+              "name": "GitHub",
+            },
+          }
+        }
+      />
+    }
+    hoverCardHeader="Linked GitHub Integration"
     integrationName="Test Integration"
     integrationType="github"
     onClose={[Function]}
@@ -157,49 +248,82 @@ exports[`ExternalIssueActions with no external issues linked renders 1`] = `
   >
     <IssueSyncListElementContainer>
       <div
-        className="css-43gy94-IssueSyncListElementContainer e1vaar1z0"
+        className="css-lh3vnw-IssueSyncListElementContainer e1vaar1z0"
       >
-        <div>
-          <IntegrationIcon
-            src="icon-github"
+        <Hovercard
+          body={
+            <IntegrationItem
+              integration={
+                Object {
+                  "configData": Object {},
+                  "configOrganization": Array [],
+                  "domainName": "gtithub.com/test-integration",
+                  "externalIssues": Array [],
+                  "icon": "http://example.com/integration_icon.png",
+                  "id": "1",
+                  "name": "Test Integration",
+                  "projects": Array [],
+                  "provider": Object {
+                    "canAdd": true,
+                    "features": Array [],
+                    "key": "github",
+                    "name": "GitHub",
+                  },
+                }
+              }
+            />
+          }
+          className="css-17m6soy-hoverCardStyles"
+          containerClassName="css-1s8b4pt-hoverCardContainer"
+          displayTimeout={100}
+          header="Linked GitHub Integration"
+        >
+          <span
+            className="hovercard-container css-1s8b4pt-hoverCardContainer"
+            onMouseEnter={[Function]}
+            onMouseLeave={[Function]}
           >
-            <InlineSvg
-              className="css-qf3g6n-IntegrationIcon e1vaar1z1"
+            <IntegrationIcon
               src="icon-github"
             >
-              <StyledSvg
+              <InlineSvg
                 className="css-qf3g6n-IntegrationIcon e1vaar1z1"
-                height="1em"
-                viewBox={Object {}}
-                width="1em"
+                src="icon-github"
               >
-                <svg
-                  className="e1vaar1z1 css-18jkql6-StyledSvg-IntegrationIcon e2idor0"
+                <StyledSvg
+                  className="css-qf3g6n-IntegrationIcon e1vaar1z1"
                   height="1em"
                   viewBox={Object {}}
                   width="1em"
                 >
-                  <use
-                    href="#test"
-                    xlinkHref="#test"
-                  />
-                </svg>
-              </StyledSvg>
-            </InlineSvg>
-          </IntegrationIcon>
-          <IntegrationLink
-            href={null}
-            onClick={[Function]}
-          >
-            <a
-              className="css-1ado49n-IntegrationLink e1vaar1z2"
+                  <svg
+                    className="e1vaar1z1 css-18jkql6-StyledSvg-IntegrationIcon e2idor0"
+                    height="1em"
+                    viewBox={Object {}}
+                    width="1em"
+                  >
+                    <use
+                      href="#test"
+                      xlinkHref="#test"
+                    />
+                  </svg>
+                </StyledSvg>
+              </InlineSvg>
+            </IntegrationIcon>
+            <IntegrationLink
               href={null}
               onClick={[Function]}
             >
-              Link GitHub Issue
-            </a>
-          </IntegrationLink>
-        </div>
+              <a
+                className="css-oytllg-IntegrationLink e1vaar1z2"
+                href={null}
+                onClick={[Function]}
+              >
+                Link GitHub Issue
+              </a>
+            </IntegrationLink>
+          </span>
+        </Hovercard>
         <OpenCloseIcon
           isLinked={null}
           onClick={[Function]}
diff --git a/tests/js/spec/components/group/externalIssueActions.spec.jsx b/tests/js/spec/components/group/externalIssueActions.spec.jsx
index 9e67eb7596..59e170273d 100644
--- a/tests/js/spec/components/group/externalIssueActions.spec.jsx
+++ b/tests/js/spec/components/group/externalIssueActions.spec.jsx
@@ -50,7 +50,7 @@ describe('ExternalIssueActions', function() {
   describe('with an external issue linked', function() {
     let externalIssues = [
       {
-        id: '100',
+        id: 100,
         url: 'https://github.com/MeredithAnya/testing/issues/2',
         key: 'getsentry/sentry#2',
       },
diff --git a/tests/js/spec/views/settings/organizationIntegrations/__snapshots__/index.spec.jsx.snap b/tests/js/spec/views/settings/organizationIntegrations/__snapshots__/index.spec.jsx.snap
index 27cc2aa563..a844cd9ac3 100644
--- a/tests/js/spec/views/settings/organizationIntegrations/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/views/settings/organizationIntegrations/__snapshots__/index.spec.jsx.snap
@@ -1968,45 +1968,40 @@ exports[`OrganizationIntegrations render() with installed integrations Displays
                                               <Labels
                                                 compact={true}
                                               >
-                                                <CompactLabels>
-                                                  <Component
-                                                    className="css-12z09fy-CompactLabels ettpo131"
+                                                <Flex
+                                                  align="center"
+                                                  direction="row"
+                                                  pl={1}
+                                                >
+                                                  <Base
+                                                    align="center"
+                                                    className="css-x3jwi"
+                                                    direction="row"
+                                                    pl={1}
                                                   >
-                                                    <Flex
-                                                      align="center"
-                                                      className="css-12z09fy-CompactLabels ettpo131"
-                                                      direction="row"
-                                                      pl={1}
+                                                    <div
+                                                      className="css-x3jwi"
+                                                      is={null}
                                                     >
-                                                      <Base
-                                                        align="center"
-                                                        className="ettpo131 css-1pegbxc-CompactLabels"
-                                                        direction="row"
-                                                        pl={1}
+                                                      <IntegrationName>
+                                                        <div
+                                                          className="css-ksmg3c-IntegrationName ettpo130"
+                                                        >
+                                                          Jira Test Integration
+                                                        </div>
+                                                      </IntegrationName>
+                                                      <DomainName
+                                                        compact={true}
                                                       >
                                                         <div
-                                                          className="ettpo131 css-1pegbxc-CompactLabels"
-                                                          is={null}
+                                                          className="css-1wocc7i-DomainName ettpo131"
                                                         >
-                                                          <IntegrationName>
-                                                            <div
-                                                              className="css-ksmg3c-IntegrationName ettpo132"
-                                                            >
-                                                              Jira Test Integration
-                                                            </div>
-                                                          </IntegrationName>
-                                                          <DomainName>
-                                                            <div
-                                                              className="css-1apzxil-DomainName ettpo133"
-                                                            >
-                                                              jira.com/test-integration
-                                                            </div>
-                                                          </DomainName>
+                                                          jira.com/test-integration
                                                         </div>
-                                                      </Base>
-                                                    </Flex>
-                                                  </Component>
-                                                </CompactLabels>
+                                                      </DomainName>
+                                                    </div>
+                                                  </Base>
+                                                </Flex>
                                               </Labels>
                                             </div>
                                           </Base>
