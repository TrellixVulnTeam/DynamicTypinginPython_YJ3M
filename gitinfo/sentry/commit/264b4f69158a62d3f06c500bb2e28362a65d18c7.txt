commit 264b4f69158a62d3f06c500bb2e28362a65d18c7
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Feb 4 19:53:13 2012 -0800

    Ensure we query on project so we hit the index

diff --git a/sentry/manager.py b/sentry/manager.py
index 0d124ad659..1ff4839e4d 100644
--- a/sentry/manager.py
+++ b/sentry/manager.py
@@ -419,7 +419,10 @@ class GroupManager(models.Manager, ChartMixin):
                 'time_spent_count': F('time_spent_count') + 1,
             })
 
-        affected = group.messagecountbyminute_set.filter(date=normalized_datetime).update(**update_kwargs)
+        affected = group.messagecountbyminute_set.filter(
+            project=project,
+            date=normalized_datetime,
+        ).update(**update_kwargs)
         if not affected:
             group.messagecountbyminute_set.create(
                 project=project,
@@ -449,7 +452,11 @@ class GroupManager(models.Manager, ChartMixin):
                 value=value,
             )
 
-            affected = group.messagefiltervalue_set.filter(key=key, value=value).update(times_seen=F('times_seen') + 1)
+            affected = group.messagefiltervalue_set.filter(
+                project=project,
+                key=key,
+                value=value,
+            ).update(times_seen=F('times_seen') + 1)
             if not affected:
                 group.messagefiltervalue_set.create(
                     project=project,
