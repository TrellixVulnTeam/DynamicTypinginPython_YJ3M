commit da1cc1f38d9fc6d3aaa3cb990d0d127c067091d8
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Wed Sep 13 17:55:11 2017 -0500

    db: Add ORDER BY clause to Group cleanup (#6120)
    
    * db: Add ORDER BY clause to Group cleanup
    
    See: https://github.com/getsentry/sentry/commit/dc6195bdc0557a7877d69b7c8d01d3118668f47d
    
    * Flippin bits

diff --git a/src/sentry/runner/commands/cleanup.py b/src/sentry/runner/commands/cleanup.py
index b6e836dbed..980a1cb19e 100644
--- a/src/sentry/runner/commands/cleanup.py
+++ b/src/sentry/runner/commands/cleanup.py
@@ -99,14 +99,14 @@ def cleanup(days, project, concurrency, silent, model, router, timed):
         (models.GroupRuleStatus, 'date_added', None),
         (models.GroupTagValue, 'last_seen', None),
         (models.TagValue, 'last_seen', None),
-        (models.EventTag, 'date_added', '-date_added'),
+        (models.EventTag, 'date_added', 'date_added'),
     )
 
     # Deletions that use the `deletions` code path (which handles their child relations)
-    # (model, datetime_field)
+    # (model, datetime_field, order_by)
     DELETES = (
-        (models.Event, 'datetime'),
-        (models.Group, 'last_seen'),
+        (models.Event, 'datetime', None),
+        (models.Group, 'last_seen', 'last_seen'),
     )
 
     if not silent:
@@ -170,7 +170,7 @@ def cleanup(days, project, concurrency, silent, model, router, timed):
                 order_by=order_by,
             ).execute()
 
-    for model, dtfield in DELETES:
+    for model, dtfield, order_by in DELETES:
         if not silent:
             click.echo(
                 "Removing {model} for days={days} project={project}".format(
@@ -197,13 +197,15 @@ def cleanup(days, project, concurrency, silent, model, router, timed):
             task = deletions.get(
                 model=model,
                 query=query,
+                order_by=order_by,
                 transaction_id=uuid4().hex,
             )
 
             def _chunk_until_complete(num_shards=None, shard_id=None):
                 has_more = True
                 while has_more:
-                    has_more = task.chunk(num_shards=num_shards, shard_id=shard_id)
+                    has_more = task.chunk(
+                        num_shards=num_shards, shard_id=shard_id)
 
             if concurrency > 1:
                 threads = []
