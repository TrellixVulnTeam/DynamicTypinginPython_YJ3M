commit b37eca212593cf0173063594ee8079c3869e6c7b
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Apr 22 14:26:12 2015 -0700

    Correct membership queries

diff --git a/src/sentry/models/team.py b/src/sentry/models/team.py
index a849599a1e..010e0874c2 100644
--- a/src/sentry/models/team.py
+++ b/src/sentry/models/team.py
@@ -80,20 +80,23 @@ class TeamManager(BaseManager):
                 team_qs = self.none()
             else:
                 # TODO(dcramer):
-                om_teams = om.teams.filter(
-                    status=TeamStatus.VISIBLE
+                om_teams = self.model.objects.filter(
+                    status=TeamStatus.VISIBLE,
                 )
 
                 if om.has_global_access:
                     inactive = list(om_teams.filter(
-                        is_active=False,
-                    ).values_list('team', flat=True))
+                        organizationmemberteam__is_active=False,
+                    ).values_list('id', flat=True))
 
                     team_qs = base_team_qs
                     if inactive:
                         team_qs = team_qs.exclude(id__in=inactive)
                 else:
-                    team_qs = om_teams
+                    team_qs = om_teams.filter(
+                        organizationmemberteam__organizationmember=om,
+                        organizationmemberteam__is_active=True,
+                    )
 
                 for team in team_qs:
                     team.access_type = om.type
