commit 345878a49a590394bd44c00b40dd54364ba6da59
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Fri Sep 7 14:15:29 2018 -0700

    fix(integrations): Limit disabling of plugins to migrating integration

diff --git a/src/sentry/integrations/example/integration.py b/src/sentry/integrations/example/integration.py
index 9800704ffc..ac685df06a 100644
--- a/src/sentry/integrations/example/integration.py
+++ b/src/sentry/integrations/example/integration.py
@@ -124,8 +124,7 @@ class ExampleIntegrationProvider(IntegrationProvider):
         }]
 
     def post_install(self, integration, organization):
-        installation = self.get_installation(integration, organization.id)
-        PluginMigrator(installation, organization).call()
+        PluginMigrator(integration, organization).call()
 
     def build_integration(self, state):
         return {
diff --git a/src/sentry/integrations/migrate.py b/src/sentry/integrations/migrate.py
index 74d81129d7..607ac62792 100644
--- a/src/sentry/integrations/migrate.py
+++ b/src/sentry/integrations/migrate.py
@@ -5,14 +5,6 @@ from sentry.plugins import plugins
 from sentry.utils.cache import memoize
 
 
-DISABLEABLE_PLUGINS = (
-    'vsts',
-    'bitbucket',
-    'github',
-    'example',  # Tests
-)
-
-
 class PluginMigrator(object):
     def __init__(self, integration, organization):
         self.integration = integration
@@ -21,7 +13,7 @@ class PluginMigrator(object):
     def call(self):
         for project in self.projects:
             for plugin in plugins.for_project(project):
-                if plugin.slug not in DISABLEABLE_PLUGINS:
+                if plugin.slug != self.integration.provider:
                     continue
 
                 if self.all_repos_migrated(plugin.slug):
diff --git a/src/sentry/integrations/vsts/integration.py b/src/sentry/integrations/vsts/integration.py
index 241f5d2994..7fb744fca0 100644
--- a/src/sentry/integrations/vsts/integration.py
+++ b/src/sentry/integrations/vsts/integration.py
@@ -280,7 +280,7 @@ class VstsIntegrationProvider(IntegrationProvider):
         for repo in repos:
             repo.update(integration_id=integration.id)
 
-        PluginMigrator(installation, organization).call()
+        PluginMigrator(integration, organization).call()
 
     def get_pipeline_views(self):
         identity_pipeline_config = {
diff --git a/tests/sentry/integrations/test_migrate.py b/tests/sentry/integrations/test_migrate.py
index 207cb8138b..812749717a 100644
--- a/tests/sentry/integrations/test_migrate.py
+++ b/tests/sentry/integrations/test_migrate.py
@@ -22,22 +22,20 @@ class PluginMigratorTest(TestCase):
         self.organization = self.create_organization()
         self.project = self.create_project(organization=self.organization)
 
-        self.integration = ExampleIntegrationProvider()
+        self.integration = Integration.objects.create(
+            provider=ExampleIntegrationProvider.key,
+        )
 
         self.migrator = PluginMigrator(self.integration, self.organization)
 
     def test_all_repos_migrated(self):
-        integration = Integration.objects.create(
-            provider=ExampleIntegrationProvider.key,
-        )
-
         Repository.objects.create(
             organization_id=self.organization.id,
-            provider=self.integration.key,
-            integration_id=integration.id,
+            provider=self.integration.provider,
+            integration_id=self.integration.id,
         )
 
-        assert self.migrator.all_repos_migrated(self.integration.key)
+        assert self.migrator.all_repos_migrated(self.integration.provider)
 
     def test_disable_for_all_projects(self):
         plugin = plugins.get('example')
