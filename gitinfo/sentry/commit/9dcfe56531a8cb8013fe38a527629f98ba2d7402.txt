commit 9dcfe56531a8cb8013fe38a527629f98ba2d7402
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Mar 28 17:10:05 2016 -0700

    Set the devserver log-format different based on if it's running through honcho or not
    
    honcho prefixes all lines wiht a timestamp already, so we don't need to
    show a double timestamp when honcho is managing. But if we only manage
    one process, we just exec() out and we need timestamps from uwsgi

diff --git a/src/sentry/runner/commands/devserver.py b/src/sentry/runner/commands/devserver.py
index e8c56e24ea..b2fbf36bce 100644
--- a/src/sentry/runner/commands/devserver.py
+++ b/src/sentry/runner/commands/devserver.py
@@ -33,8 +33,6 @@ def devserver(reload, watchers, workers, bind):
     uwsgi_overrides = {
         # Make sure we don't try and use uwsgi protocol
         'protocol': 'http',
-        # A better log-format for local dev
-        'log-format': '"%(method) %(uri) %(proto)" %(status) %(size)',
         # Make sure we reload really quickly for local dev in case it
         # doesn't want to shut down nicely on it's own, NO MERCY
         'worker-reload-mercy': 2,
@@ -43,8 +41,6 @@ def devserver(reload, watchers, workers, bind):
     if reload:
         uwsgi_overrides['py-autoreload'] = 1
 
-    server = SentryHTTPServer(host=host, port=port, workers=1, extra_options=uwsgi_overrides)
-
     daemons = []
 
     if watchers:
@@ -59,6 +55,15 @@ def devserver(reload, watchers, workers, bind):
             ('beat', ['sentry', 'celery', 'beat', '-l', 'INFO']),
         ]
 
+    # A better log-format for local dev when running through honcho,
+    # but if there aren't any other daemons, we don't want to override.
+    if daemons:
+        uwsgi_overrides['log-format'] = '"%(method) %(uri) %(proto)" %(status) %(size)'
+    else:
+        uwsgi_overrides['log-format'] = '[%(ltime)] "%(method) %(uri) %(proto)" %(status) %(size)'
+
+    server = SentryHTTPServer(host=host, port=port, workers=1, extra_options=uwsgi_overrides)
+
     # If we don't need any other daemons, just launch a normal uwsgi webserver
     # and avoid dealing with subprocesses
     if not daemons:
