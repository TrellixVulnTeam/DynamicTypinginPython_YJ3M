commit 92e7ad34ff82d6ee3b41c0539bab10c021942690
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Nov 7 09:56:09 2017 -0800

    ci: Update zeus configuration to use webhooks and mimetypes

diff --git a/.travis.yml b/.travis.yml
index 5f94d3ec35..61aedc2638 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -28,8 +28,6 @@ env:
     - TRAVIS_NODE_VERSION=4
     - CXX=g++-4.8
     - SOUTH_TESTS_MIGRATE=1
-before_install:
-  - bin/update-zeus-job in_progress unknown || echo "failed to report build to Zeus; continuing"
 install:
   - nvm install $TRAVIS_NODE_VERSION
   - npm install -g yarn@0.27.5
@@ -41,14 +39,14 @@ script:
   - make travis-test-$TEST_SUITE
 after_success:
   - codecov -e TEST_SUITE
-  - bin/upload-zeus-artifact junit.xml
-  - bin/upload-zeus-artifact coverage.xml
-  - bin/update-zeus-job finished passed
+  - bin/upload-zeus-artifact junit.xml "text/xml+xunit"
+  - bin/upload-zeus-artifact coverage.xml "text/xml+coverage"
+  - bin/upload-zeus-artifact pytest.html "text/html+pytest"
 after_failure:
   - dmesg | tail -n 100
-  - bin/upload-zeus-artifact junit.xml
-  - bin/upload-zeus-artifact coverage.xml
-  - bin/update-zeus-job finished failed
+  - bin/upload-zeus-artifact junit.xml "text/xml+xunit"
+  - bin/upload-zeus-artifact coverage.xml "text/xml+coverage"
+  - bin/upload-zeus-artifact pytest.html "text/html+pytest"
 # each attribute in the matrix will override the global attribute
 matrix:
   fast_finish: true
@@ -108,3 +106,12 @@ matrix:
         - memcached
         - redis-server
         - postgresql
+notifications:
+  webhooks:
+    urls:
+      - https://zeus.ci/hooks/fa079cf6-8e6b-11e7-9155-0a580a28081c/public/provider/travis/webhook
+    on_success: always
+    on_failure: always
+    on_start: always
+    on_cancel: always
+    on_error: always
diff --git a/bin/upload-zeus-artifact b/bin/upload-zeus-artifact
index 2d7331f943..543f7a4f5f 100755
--- a/bin/upload-zeus-artifact
+++ b/bin/upload-zeus-artifact
@@ -1,9 +1,10 @@
 #!/bin/bash -eu
 
 if [[ -e $1 ]]; then
-    curl $ZEUS_HOOK_BASE/builds/$TRAVIS_BUILD_NUMBER/jobs/$TRAVIS_JOB_NUMBER/artifacts \
+    curl -i $ZEUS_HOOK_BASE/builds/$TRAVIS_BUILD_ID/jobs/$TRAVIS_JOB_ID/artifacts \
         -X POST \
-        -F "file=@$1"
+        -F "file=@$1" \
+        -F "type=$2"
 else
     (>&2 echo "[WARN] File not found: $1")
 fi
