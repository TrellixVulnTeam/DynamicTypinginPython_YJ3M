commit 37cdd9f875ca3fe5c69bd0489f959d1dc14f2734
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Sep 2 14:21:34 2015 -0700

    Add test for successful ref case

diff --git a/tests/sentry/models/tests.py b/tests/sentry/models/tests.py
index 542a32dc68..c2a993b091 100644
--- a/tests/sentry/models/tests.py
+++ b/tests/sentry/models/tests.py
@@ -134,3 +134,13 @@ class EventNodeStoreTest(TestCase):
 
         with pytest.raises(NodeIntegrityFailure):
             Event.objects.bind_nodes([event], 'data')
+
+    def test_accepts_valid_ref(self):
+        invalid_event = self.create_event()
+        event = self.create_event()
+        event.data.bind_ref(event)
+        event.save()
+
+        Event.objects.bind_nodes([event], 'data')
+
+        assert event.data.ref == event.pk
