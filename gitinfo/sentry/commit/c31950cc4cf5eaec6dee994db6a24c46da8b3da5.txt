commit c31950cc4cf5eaec6dee994db6a24c46da8b3da5
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 19 10:46:07 2015 -0800

    Add basic tests for sentry.http

diff --git a/setup.py b/setup.py
index 0f81f2e776..dc03f8955a 100755
--- a/setup.py
+++ b/setup.py
@@ -58,6 +58,7 @@ tests_require = [
     'pytest-cov>=1.4',
     'pytest-timeout',
     'python-coveralls',
+    'responses',
     'riak',
 ]
 
diff --git a/tests/sentry/test_http.py b/tests/sentry/test_http.py
new file mode 100644
index 0000000000..52c2c9292b
--- /dev/null
+++ b/tests/sentry/test_http.py
@@ -0,0 +1,29 @@
+from __future__ import absolute_import
+
+import responses
+import pytest
+
+from django.core.exceptions import SuspiciousOperation
+
+from sentry.http import safe_urlopen, safe_urlread
+from sentry.testutils import TestCase
+
+
+class HttpTest(TestCase):
+    @responses.activate
+    def test_simple(self):
+        responses.add(responses.GET, 'http://example.com', body='foo bar')
+
+        resp = safe_urlopen('http://example.com')
+        data = safe_urlread(resp)
+        assert data == 'foo bar'
+
+        request = responses.calls[0].request
+        assert 'User-Agent' in request.headers
+        assert 'gzip' in request.headers.get('Accept-Encoding', '')
+
+    # XXX(dcramer): we can't use responses here as it hooks Session.send
+    # @responses.activate
+    def test_ip_blacklist(self):
+        with pytest.raises(SuspiciousOperation):
+            resp = safe_urlopen('http://127.0.0.1')
