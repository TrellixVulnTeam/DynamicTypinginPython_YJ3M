commit e729405832be46b6925136d5c942be904ba1892d
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Fri Aug 16 09:46:07 2019 -0700

    ref(eventstore): Error page uses Eventstore instead of Events table (#14394)

diff --git a/src/sentry/web/frontend/error_page_embed.py b/src/sentry/web/frontend/error_page_embed.py
index 71b534f517..416cae8fc4 100644
--- a/src/sentry/web/frontend/error_page_embed.py
+++ b/src/sentry/web/frontend/error_page_embed.py
@@ -12,7 +12,8 @@ from django.utils.safestring import mark_safe
 from django.utils.translation import ugettext_lazy as _
 from django.views.decorators.csrf import csrf_exempt
 
-from sentry.models import Event, Group, ProjectKey, ProjectOption, UserReport
+from sentry import eventstore
+from sentry.models import Event, ProjectKey, ProjectOption, UserReport
 from sentry.web.helpers import render_to_response
 from sentry.signals import user_feedback_received
 from sentry.utils import json
@@ -149,16 +150,9 @@ class ErrorPageEmbedView(View):
             report.project = key.project
             report.event_id = event_id
 
-            try:
-                event = Event.objects.filter(
-                    project_id=report.project.id, event_id=report.event_id
-                )[0]
-            except IndexError:
-                try:
-                    report.group = Group.objects.from_event_id(report.project, report.event_id)
-                except Group.DoesNotExist:
-                    pass
-            else:
+            event = eventstore.get_event_by_id(report.project.id, report.event_id)
+
+            if event is not None:
                 Event.objects.bind_nodes([event])
                 report.environment = event.get_environment()
                 report.group = event.group
diff --git a/tests/sentry/web/frontend/test_error_page_embed.py b/tests/sentry/web/frontend/test_error_page_embed.py
index b103e34953..1810cb0f0c 100644
--- a/tests/sentry/web/frontend/test_error_page_embed.py
+++ b/tests/sentry/web/frontend/test_error_page_embed.py
@@ -4,6 +4,8 @@ from django.core.urlresolvers import reverse
 from six.moves.urllib.parse import quote
 from uuid import uuid4
 import logging
+from datetime import timedelta
+from django.utils import timezone
 
 from sentry.models import Environment, UserReport
 from sentry.testutils import TestCase
@@ -161,10 +163,11 @@ class ErrorPageEmbedEnvironmentTest(TestCase):
         self.environment.add_project(self.project)
 
     def make_event(self, **kwargs):
+        min_ago = (timezone.now() - timedelta(minutes=1)).isoformat()[:19]
         result = {
             "event_id": "a" * 32,
             "message": "foo",
-            "timestamp": 1403007314.570599,
+            "timestamp": min_ago,
             "level": logging.ERROR,
             "logger": "default",
             "tags": [],
