commit 5b3032a6345fc3d65b75aa053d4b8004da2516cb
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Oct 4 16:31:47 2016 -0700

    [plugins] Disable social auth middleware

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index d659214903..a0564fc3a9 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -210,7 +210,8 @@ MIDDLEWARE_CLASSES = (
     'sentry.middleware.sudo.SudoMiddleware',
     'sentry.middleware.superuser.SuperuserMiddleware',
     'sentry.middleware.locale.SentryLocaleMiddleware',
-    'sentry.middleware.social_auth.SentrySocialAuthExceptionMiddleware',
+    # TODO(dcramer): kill this once we verify its safe
+    # 'sentry.middleware.social_auth.SentrySocialAuthExceptionMiddleware',
     'django.contrib.messages.middleware.MessageMiddleware',
     'sentry.debug.middleware.DebugMiddleware',
 )
diff --git a/src/social_auth/middleware.py b/src/social_auth/middleware.py
index 67052db9ab..007e2f097b 100644
--- a/src/social_auth/middleware.py
+++ b/src/social_auth/middleware.py
@@ -1,8 +1,10 @@
 # -*- coding: utf-8 -*-
 from __future__ import absolute_import
 
+import six
+
 from django.conf import settings
-from django.contrib.messages.api import error, MessageFailure
+from django.contrib import messages
 from django.shortcuts import redirect
 
 from social_auth.exceptions import SocialAuthBaseException
@@ -32,12 +34,7 @@ class SocialAuthExceptionMiddleware(object):
             if backend_name:
                 tags.append(backend_name)
 
-            try:
-                error(request, message, extra_tags=' '.join(tags))
-            except MessageFailure:  # messages app is not installed
-                url += ('?' in url and '&' or '?') + 'message=' + message
-                if backend_name:
-                    url += '&backend=' + backend_name
+            messages.error(request, message, extra_tags=' '.join(tags))
             return redirect(url)
 
     def get_backend(self, request, exception):
@@ -53,7 +50,7 @@ class SocialAuthExceptionMiddleware(object):
         return backend and backend_setting(backend, 'SOCIAL_AUTH_RAISE_EXCEPTIONS')
 
     def get_message(self, request, exception):
-        return unicode(exception)
+        return six.text_type(exception)
 
     def get_redirect_uri(self, request, exception):
         if self.backend is not None:
