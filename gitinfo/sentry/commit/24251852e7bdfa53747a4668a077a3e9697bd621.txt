commit 24251852e7bdfa53747a4668a077a3e9697bd621
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Tue Nov 27 13:30:56 2018 -0600

    fix(tagstore): Fix merging when corresponding GroupTagValue row doesn't already exist (#10786)
    
    Fixes SENTRY-84V

diff --git a/src/sentry/tagstore/legacy/models/grouptagvalue.py b/src/sentry/tagstore/legacy/models/grouptagvalue.py
index 4a4cf70d4c..c12da8c90f 100644
--- a/src/sentry/tagstore/legacy/models/grouptagvalue.py
+++ b/src/sentry/tagstore/legacy/models/grouptagvalue.py
@@ -50,7 +50,7 @@ class GroupTagValue(Model):
     def merge_counts(self, new_group):
         try:
             with transaction.atomic(using=router.db_for_write(GroupTagValue)):
-                new_obj = GroupTagValue.objects.get(
+                new_obj, _ = GroupTagValue.objects.get_or_create(
                     group_id=new_group.id,
                     key=self.key,
                     value=self.value,
diff --git a/src/sentry/tagstore/v2/models/grouptagvalue.py b/src/sentry/tagstore/v2/models/grouptagvalue.py
index a5bf00f028..347db04092 100644
--- a/src/sentry/tagstore/v2/models/grouptagvalue.py
+++ b/src/sentry/tagstore/v2/models/grouptagvalue.py
@@ -124,7 +124,7 @@ class GroupTagValue(Model):
     def merge_counts(self, new_group):
         try:
             with transaction.atomic(using=router.db_for_write(GroupTagValue)):
-                new_obj = GroupTagValue.objects.get(
+                new_obj, _ = GroupTagValue.objects.get_or_create(
                     group_id=new_group.id,
                     project_id=new_group.project_id,
                     _key_id=self._key_id,
