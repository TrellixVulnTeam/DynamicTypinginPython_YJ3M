commit 1dea0cccfab6b7968a8e98aa948d236ddc444677
Author: josh <josh@jrl.ninja>
Date:   Tue May 26 18:12:19 2020 +0000

    dev: setup-pyenv and bake in PYENV_VERSION into setup-git (#18906)

diff --git a/.python-version b/.python-version
index 35b46aeaca..a1464d1b1f 100644
--- a/.python-version
+++ b/.python-version
@@ -1 +1,2 @@
 2.7.16
+3.6.7
diff --git a/Makefile b/Makefile
index 1840aa6823..7d020d6e2d 100644
--- a/Makefile
+++ b/Makefile
@@ -2,6 +2,9 @@ PIP := python -m pip --disable-pip-version-check
 WEBPACK := NODE_ENV=production ./bin/yarn webpack
 YARN := ./bin/yarn
 
+# Currently, this is only required to install black via pre-commit.
+REQUIRED_PY3_VERSION := $(shell awk 'FNR == 2' .python-version)
+
 bootstrap: develop init-config run-dependent-services create-db apply-migrations
 
 develop: ensure-pinned-pip setup-git install-yarn-pkgs install-sentry-dev
@@ -46,6 +49,9 @@ apply-migrations: ensure-venv
 
 reset-db: drop-db create-db apply-migrations
 
+setup-pyenv:
+	@cat .python-version | xargs -n1 pyenv install --skip-existing
+
 ensure-venv:
 	@./scripts/ensure-venv.sh
 
@@ -60,6 +66,8 @@ setup-git-config:
 setup-git: ensure-venv setup-git-config
 	@echo "--> Installing git hooks"
 	cd .git/hooks && ln -sf ../../config/hooks/* ./
+	@PYENV_VERSION=$(REQUIRED_PY3_VERSION) python3 -c '' || (echo 'Please run `make setup-pyenv` to install the required Python 3 version.'; exit 1)
+
 	@# XXX(joshuarli): virtualenv >= 20 doesn't work with the version of six we have pinned for sentry.
 	@# Since pre-commit is installed in the venv, it will install virtualenv in the venv as well.
 	@# We need to tell pre-commit to install an older virtualenv,
@@ -67,7 +75,8 @@ setup-git: ensure-venv setup-git-config
 	@# won't complain about a newer six being present.
 	@# So, this six pin here needs to be synced with requirements-base.txt.
 	$(PIP) install "pre-commit==1.18.2" "virtualenv>=16.7,<20" "six>=1.10.0,<1.11.0"
-	pre-commit install --install-hooks
+
+	@PYENV_VERSION=$(REQUIRED_PY3_VERSION) pre-commit install --install-hooks
 	@echo ""
 
 node-version-check:
