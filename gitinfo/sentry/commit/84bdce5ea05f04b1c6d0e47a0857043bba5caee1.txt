commit 84bdce5ea05f04b1c6d0e47a0857043bba5caee1
Author: Mark Story <mark@sentry.io>
Date:   Fri Nov 15 10:06:02 2019 -0500

    feat(discover) Allow saved queries to be filtered by version (#15610)
    
    Enable saved queries to be filtered by their schema version. We don't
    yet have values in this column but I'll be fixing that soon and there
    are no consumers of this version filter yet.

diff --git a/src/sentry/discover/endpoints/discover_saved_queries.py b/src/sentry/discover/endpoints/discover_saved_queries.py
index 7f42d6ffa7..256b4f2742 100644
--- a/src/sentry/discover/endpoints/discover_saved_queries.py
+++ b/src/sentry/discover/endpoints/discover_saved_queries.py
@@ -39,6 +39,9 @@ class DiscoverSavedQueriesEndpoint(OrganizationEndpoint):
                 if key == "name" or key == "query":
                     value = " ".join(value)
                     queryset = queryset.filter(name__icontains=value)
+                elif key == "version":
+                    value = " ".join(value)
+                    queryset = queryset.filter(version=value)
                 else:
                     queryset = queryset.none()
 
diff --git a/tests/snuba/api/endpoints/test_discover_saved_queries.py b/tests/snuba/api/endpoints/test_discover_saved_queries.py
index 206fc0917b..286ff17dff 100644
--- a/tests/snuba/api/endpoints/test_discover_saved_queries.py
+++ b/tests/snuba/api/endpoints/test_discover_saved_queries.py
@@ -19,7 +19,7 @@ class DiscoverSavedQueryBase(APITestCase, SnubaTestCase):
         query = {"fields": ["test"], "conditions": [], "limit": 10}
 
         model = DiscoverSavedQuery.objects.create(
-            organization=self.org, created_by=self.user, name="Test query", query=query
+            organization=self.org, created_by=self.user, name="Test query", query=query, version=1
         )
 
         model.set_projects(self.project_ids)
@@ -41,6 +41,21 @@ class DiscoverSavedQueriesTest(DiscoverSavedQueryBase):
         assert response.data[0]["conditions"] == []
         assert response.data[0]["limit"] == 10
 
+    def test_get_version_filter(self):
+        url = reverse("sentry-api-0-discover-saved-queries", args=[self.org.slug])
+        with self.feature(self.feature_name):
+            response = self.client.get(url, format="json", data={"query": "version:1"})
+
+        assert response.status_code == 200, response.content
+        assert len(response.data) == 1
+        assert response.data[0]["name"] == "Test query"
+
+        with self.feature(self.feature_name):
+            response = self.client.get(url, format="json", data={"query": "version:2"})
+
+        assert response.status_code == 200, response.content
+        assert len(response.data) == 0
+
     def test_get_name_filter(self):
         url = reverse("sentry-api-0-discover-saved-queries", args=[self.org.slug])
         with self.feature(self.feature_name):
