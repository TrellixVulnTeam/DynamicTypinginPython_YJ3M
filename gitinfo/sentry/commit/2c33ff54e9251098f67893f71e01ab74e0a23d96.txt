commit 2c33ff54e9251098f67893f71e01ab74e0a23d96
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Feb 11 23:58:23 2013 -0800

    Some initial work on UI for project notification settings

diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index c4fdfd2d4a..e030bd6efe 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -1723,6 +1723,10 @@ section.body {
     .border-radius(5px); 
   }
 }
+table.table td input,
+table.table td .select2-container {
+  margin-bottom: 0;
+}
 
 .btn.disabled, .btn[disabled] {
   background: #ecf0f4;
diff --git a/src/sentry/static/sentry/styles/global.min.css b/src/sentry/static/sentry/styles/global.min.css
index fbac504522..0b9ddb9d2b 100644
--- a/src/sentry/static/sentry/styles/global.min.css
+++ b/src/sentry/static/sentry/styles/global.min.css
@@ -7893,6 +7893,10 @@ section.body .uneditable-input {
   -moz-border-radius: 5px;
   border-radius: 5px;
 }
+table.table td input,
+table.table td .select2-container {
+  margin-bottom: 0;
+}
 .btn.disabled,
 .btn[disabled] {
   background: #ecf0f4;
diff --git a/src/sentry/static/sentry/styles/sentry.css b/src/sentry/static/sentry/styles/sentry.css
index fbac504522..0b9ddb9d2b 100644
--- a/src/sentry/static/sentry/styles/sentry.css
+++ b/src/sentry/static/sentry/styles/sentry.css
@@ -7893,6 +7893,10 @@ section.body .uneditable-input {
   -moz-border-radius: 5px;
   border-radius: 5px;
 }
+table.table td input,
+table.table td .select2-container {
+  margin-bottom: 0;
+}
 .btn.disabled,
 .btn[disabled] {
   background: #ecf0f4;
diff --git a/src/sentry/templates/sentry/projects/manage.html b/src/sentry/templates/sentry/projects/manage.html
index 3d04920432..1a4ede8725 100644
--- a/src/sentry/templates/sentry/projects/manage.html
+++ b/src/sentry/templates/sentry/projects/manage.html
@@ -80,12 +80,15 @@
         <li{% if page == 'details' %} class="active"{% endif %}>
             <a href="{% url sentry-manage-project project.team.slug project.slug %}">{% trans "Settings" %}</a>
         </li>
-        <li{% if page == 'keys' %} class="active"{% endif %}>
-            <a href="{% url sentry-manage-project-keys project.team.slug project.slug %}">{% trans "API Keys" %}</a>
+        <li{% if page == 'notifications' %} class="active"{% endif %}>
+            <a href="{% url sentry-project-notifications project.team.slug project.slug %}">{% trans "Notifcations" %}</a>
         </li>
         <li{% if page == 'tags' %} class="active"{% endif %}>
             <a href="{% url sentry-manage-project-tags project.team.slug project.slug %}">{% trans "Tags" %}</a>
         </li>
+        <li{% if page == 'keys' %} class="active"{% endif %}>
+            <a href="{% url sentry-manage-project-keys project.team.slug project.slug %}">{% trans "API Keys" %}</a>
+        </li>
     </ul>
     <ul class="nav nav-list">
         <li class="nav-header">{% trans "Client Configuration" %}</li>
diff --git a/src/sentry/templates/sentry/projects/notifications.html b/src/sentry/templates/sentry/projects/notifications.html
new file mode 100644
index 0000000000..64ed44829a
--- /dev/null
+++ b/src/sentry/templates/sentry/projects/notifications.html
@@ -0,0 +1,71 @@
+{% extends "sentry/projects/manage.html" %}
+
+{% load crispy_forms_tags %}
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Notifications" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    {{ block.super }}
+    <li class="divider"></li>
+    <li><a href="{% url sentry-project-notifications project.team.slug project.slug %}">{% trans "Notifications" %}</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Notifications" %}</h2>
+    </div>
+    <form action="" method="post" class="form-stacked">
+        <p>{% trans "Notification settings will guarantee that you will never be notified more than once for a specific event." %}</p>
+        {% csrf_token %}
+
+        <div class="page-header">
+            <h3>{% trans "Global Rules" %}</h3>
+        </div>
+
+        <p>{% trans "The following rules will apply regardless of any other settings." %}</p>
+
+        {{ form|as_crispy_errors }}
+
+        {% for field in form %}
+            {% include "sentry/partial/_form_field.html" %}
+        {% endfor %}
+
+        <div class="page-header">
+            <h3>{% trans "Tags" %}</h3>
+        </div>
+
+        <p>{% trans "Tag restrictions are based on your global notification rules. If tags are specified, notifications will be sent when they match any of the restrictions." %}</p>
+
+        <table class="table table-striped" id="tag_list">
+            <colgroup>
+                <col style="width:130px">
+            </colgroup>
+            <tbody>
+                {% for tag_form in tag_forms %}
+                    <tr>
+                        <th style="vertical-align:middle">{{ tag_form.values.label|titlize }}</th>
+                        <td style="vertical-align:middle">{{ tag_form.values }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+
+        <fieldset class="form-actions">
+            <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
+        </fieldset>
+
+    </form>
+    <script type="text/javascript">
+    $(function(){
+        $("#tag_list input").select2({
+            multiple: true,
+            width: 'element',
+            tags: ["hello world", "foo", "bar"],
+            tokenSeperators: [","]
+        });
+    });
+    </script>
+{% endblock %}
+
diff --git a/src/sentry/web/forms/projects.py b/src/sentry/web/forms/projects.py
index 0aab47c972..1535fc76e1 100644
--- a/src/sentry/web/forms/projects.py
+++ b/src/sentry/web/forms/projects.py
@@ -153,3 +153,20 @@ class EditProjectAdminForm(EditProjectForm):
     class Meta:
         fields = ('name', 'platform', 'public', 'team', 'owner', 'slug')
         model = Project
+
+
+class NotificationSettingsForm(forms.Form):
+    new_events = forms.BooleanField(help_text=_('Notify the first time an event is seen or becomes a regression.'),
+        required=False)
+    event_age = forms.CharField(help_text=_('Notify when an event hasn\'t been seen for this many hours.'),
+        required=False)
+
+
+class NotificationTagValuesForm(forms.Form):
+    values = forms.CharField()
+
+    def __init__(self, project, tag, *args, **kwargs):
+        self.project = project
+        self.tag = tag
+        super(NotificationTagValuesForm, self).__init__(*args, **kwargs)
+        self.fields['values'].label = self.tag
diff --git a/src/sentry/web/frontend/projects.py b/src/sentry/web/frontend/projects.py
index 4bbb5f8d0f..2c8b121e50 100644
--- a/src/sentry/web/frontend/projects.py
+++ b/src/sentry/web/frontend/projects.py
@@ -21,7 +21,8 @@ from sentry.plugins import plugins
 from sentry.plugins.helpers import set_option, get_option
 from sentry.web.decorators import login_required, has_access
 from sentry.web.forms.projects import (NewProjectForm, NewProjectAdminForm,
-    ProjectTagsForm, EditProjectForm, RemoveProjectForm, EditProjectAdminForm)
+    ProjectTagsForm, EditProjectForm, RemoveProjectForm, EditProjectAdminForm,
+    NotificationSettingsForm, NotificationTagValuesForm)
 from sentry.web.forms.teams import NewTeamForm, SelectTeamForm
 from sentry.web.helpers import render_to_response, plugin_config
 
@@ -274,6 +275,32 @@ def manage_project_tags(request, team, project):
     return render_to_response('sentry/projects/manage_tags.html', context, request)
 
 
+@has_access(MEMBER_OWNER)
+@csrf_protect
+def notification_settings(request, team, project):
+    initial = {
+        'new_events': True,
+    }
+    form = NotificationSettingsForm(request.POST or None, initial=initial)
+
+    tag_forms = []
+    for tag in FilterKey.objects.all_keys(project):
+        tag_forms.append(NotificationTagValuesForm(project, tag, request.POST or None,
+            prefix='tag-%s' % (tag,)))
+
+    context = csrf(request)
+    context.update({
+        'team': team,
+        'project': project,
+        'form': form,
+        'tag_forms': tag_forms,
+        'page': 'notifications',
+        'SECTION': 'team',
+        'SUBSECTION': 'projects',
+    })
+    return render_to_response('sentry/projects/notifications.html', context, request)
+
+
 @has_access(MEMBER_OWNER)
 @csrf_protect
 def manage_plugins(request, team, project):
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 0eb050e37c..8c3464938b 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -126,6 +126,8 @@ urlpatterns = patterns('',
         name='sentry-remove-project'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/tags/$', projects.manage_project_tags,
         name='sentry-manage-project-tags'),
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/notifications/$', projects.notification_settings,
+        name='sentry-project-notifications'),
 
     # Generic
     url(r'^$', generic.dashboard, name='sentry'),
