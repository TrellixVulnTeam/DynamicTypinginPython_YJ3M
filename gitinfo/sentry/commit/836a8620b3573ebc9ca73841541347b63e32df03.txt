commit 836a8620b3573ebc9ca73841541347b63e32df03
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Wed Sep 16 17:39:24 2015 -0700

    Made enabling/disabling of plugins hookable.

diff --git a/src/sentry/plugins/base/v1.py b/src/sentry/plugins/base/v1.py
index 9d978383de..2aa9ffad3f 100644
--- a/src/sentry/plugins/base/v1.py
+++ b/src/sentry/plugins/base/v1.py
@@ -143,6 +143,14 @@ class IPlugin(local, PluggableViewMixin):
         from sentry.plugins.helpers import unset_option
         return unset_option(self._get_option_key(key), project, user)
 
+    def enable(self, project=None, user=None):
+        """Enable the plugin."""
+        self.set_option('enabled', True, project, user)
+
+    def disble(self, project=None, user=None):
+        """Disable the plugin."""
+        self.set_option('enabled', False, project, user)
+
     def get_url(self, group):
         """
         Returns the absolute URL to this plugins group action handler.
diff --git a/src/sentry/plugins/base/v2.py b/src/sentry/plugins/base/v2.py
index a1e9b3989d..84012e1d6c 100644
--- a/src/sentry/plugins/base/v2.py
+++ b/src/sentry/plugins/base/v2.py
@@ -137,6 +137,14 @@ class IPlugin2(local):
         from sentry.plugins.helpers import unset_option
         return unset_option(self._get_option_key(key), project, user)
 
+    def enable(self, project=None, user=None):
+        """Enable the plugin."""
+        self.set_option('enabled', True, project, user)
+
+    def disble(self, project=None, user=None):
+        """Disable the plugin."""
+        self.set_option('enabled', False, project, user)
+
     def get_conf_key(self):
         """
         Returns a string representing the configuration keyspace prefix for this plugin.
diff --git a/src/sentry/web/frontend/project_issue_tracking.py b/src/sentry/web/frontend/project_issue_tracking.py
index 4e58c3b8cf..fe5bf6c93a 100644
--- a/src/sentry/web/frontend/project_issue_tracking.py
+++ b/src/sentry/web/frontend/project_issue_tracking.py
@@ -21,7 +21,7 @@ class ProjectIssueTrackingView(ProjectView):
 
     def _handle_enable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', True, project)
+        plugin.enable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_ENABLED.format(name=plugin.get_title()),
@@ -29,7 +29,7 @@ class ProjectIssueTrackingView(ProjectView):
 
     def _handle_disable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', False, project)
+        plugin.disable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_DISABLED.format(name=plugin.get_title()),
diff --git a/src/sentry/web/frontend/project_notifications.py b/src/sentry/web/frontend/project_notifications.py
index ea6b18eae0..57f43d006d 100644
--- a/src/sentry/web/frontend/project_notifications.py
+++ b/src/sentry/web/frontend/project_notifications.py
@@ -26,7 +26,7 @@ class ProjectNotificationsView(ProjectView):
 
     def _handle_enable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', True, project)
+        plugin.enable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_ENABLED.format(name=plugin.get_title()),
@@ -34,7 +34,7 @@ class ProjectNotificationsView(ProjectView):
 
     def _handle_disable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', False, project)
+        plugin.disable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_DISABLED.format(name=plugin.get_title()),
diff --git a/src/sentry/web/frontend/project_release_tracking.py b/src/sentry/web/frontend/project_release_tracking.py
index 66ffa24183..b0dac805bb 100644
--- a/src/sentry/web/frontend/project_release_tracking.py
+++ b/src/sentry/web/frontend/project_release_tracking.py
@@ -33,7 +33,7 @@ class ProjectReleaseTrackingView(ProjectView):
 
     def _handle_enable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', True, project)
+        plugin.enable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_ENABLED.format(name=plugin.get_title()),
@@ -41,7 +41,7 @@ class ProjectReleaseTrackingView(ProjectView):
 
     def _handle_disable_plugin(self, request, project):
         plugin = plugins.get(request.POST['plugin'])
-        plugin.set_option('enabled', False, project)
+        plugin.disable(project)
         messages.add_message(
             request, messages.SUCCESS,
             constants.OK_PLUGIN_DISABLED.format(name=plugin.get_title()),
diff --git a/src/sentry/web/frontend/projects/plugins.py b/src/sentry/web/frontend/projects/plugins.py
index 658f26b998..bbfbb3d2b5 100644
--- a/src/sentry/web/frontend/projects/plugins.py
+++ b/src/sentry/web/frontend/projects/plugins.py
@@ -27,7 +27,10 @@ def manage_plugins(request, organization, project):
         enabled = set(request.POST.getlist('plugin'))
         for plugin in plugins.all(version=None):
             if plugin.can_enable_for_projects():
-                plugin.set_option('enabled', plugin.slug in enabled, project)
+                if plugin.slug in enabled:
+                    plugin.enable(project)
+                else:
+                    plugin.disable(project)
 
         messages.add_message(
             request, messages.SUCCESS,
@@ -106,7 +109,7 @@ def enable_project_plugin(request, organization, project, slug):
     if plugin.is_enabled(project) or not plugin.can_enable_for_projects():
         return HttpResponseRedirect(redirect_to)
 
-    plugin.set_option('enabled', True, project)
+    plugin.enable()
 
     return HttpResponseRedirect(redirect_to)
 
@@ -124,6 +127,6 @@ def disable_project_plugin(request, organization, project, slug):
     if not (plugin.can_disable and plugin.is_enabled(project) and plugin.can_enable_for_projects()):
         return HttpResponseRedirect(redirect_to)
 
-    plugin.set_option('enabled', False, project)
+    plugin.disable()
 
     return HttpResponseRedirect(redirect_to)
