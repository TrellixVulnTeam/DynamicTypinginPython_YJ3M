commit b84351334209dac990dfc9329081ee226ba95787
Author: William Mak <william@wmak.io>
Date:   Tue May 26 14:01:33 2020 -0400

    fix(discover): Prevent blank fields from breaking event details
    
    - This adds a check that a field isn't blank

diff --git a/src/sentry/api/endpoints/organization_event_details.py b/src/sentry/api/endpoints/organization_event_details.py
index 282881a393..86928dbf77 100644
--- a/src/sentry/api/endpoints/organization_event_details.py
+++ b/src/sentry/api/endpoints/organization_event_details.py
@@ -41,7 +41,9 @@ class OrganizationEventDetailsEndpoint(OrganizationEventsEndpointBase):
             return Response({"detail": "Event not found"}, status=404)
 
         reference = None
-        fields = request.query_params.getlist("field")
+        fields = [
+            field for field in request.query_params.getlist("field") if not field.strip() == ""
+        ]
         if fields:
             event_slug = u"{}:{}".format(project.slug, event_id)
             reference = discover.ReferenceEvent(
diff --git a/tests/snuba/api/endpoints/test_organization_event_details.py b/tests/snuba/api/endpoints/test_organization_event_details.py
index 3034eb6158..4146fcd018 100644
--- a/tests/snuba/api/endpoints/test_organization_event_details.py
+++ b/tests/snuba/api/endpoints/test_organization_event_details.py
@@ -529,3 +529,24 @@ class OrganizationEventDetailsEndpointTest(APITestCase, SnubaTestCase):
         assert trace["parent_span_id"] == original_trace["parent_span_id"]
         assert trace["description"].endswith("...")
         assert trace["description"][:-3] in original_trace["description"]
+
+    def test_blank_fields(self):
+        url = reverse(
+            "sentry-api-0-organization-event-details",
+            kwargs={
+                "organization_slug": self.project.organization.slug,
+                "project_slug": self.project.slug,
+                "event_id": "a" * 32,
+            },
+        )
+
+        with self.feature("organizations:discover-basic"):
+            response = self.client.get(
+                url, data={"field": ["", " "], "statsPeriod": "24h"}, format="json",
+            )
+
+        assert response.status_code == 200, response.content
+        assert response.data["id"] == "a" * 32
+        assert response.data["previousEventID"] is None
+        assert response.data["nextEventID"] == format_project_event(self.project.slug, "b" * 32)
+        assert response.data["projectSlug"] == self.project.slug
