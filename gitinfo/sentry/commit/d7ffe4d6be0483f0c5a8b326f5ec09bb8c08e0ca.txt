commit d7ffe4d6be0483f0c5a8b326f5ec09bb8c08e0ca
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Sat Jan 18 23:05:03 2014 -0800

    Don't ignore url fragments

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index 4100afbdbd..efc78699a5 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -984,26 +984,27 @@ class Http(Interface):
         if method:
             method = method.upper()
 
-        urlparts = urlparse.urlsplit(url)
+        scheme, netloc, path, query, fragment = urlparse.urlsplit(url)
 
-        if not query_string:
-            # define querystring from url
-            query_string = urlparts.query
-
-        elif query_string.startswith('?'):
-            # remove '?' prefix
-            query_string = query_string[1:]
+        if query_string:
+            # if querystring was a dict, convert it to a string
+            if isinstance(query_string, dict):
+                query = urlencode(query_string.items())
+            else:
+                query = query_string
+                if query[0] == '?':
+                    # remove '?' prefix
+                    query = query[1:]
 
         if isinstance(data, (list, tuple)):
             data = dict(enumerate(data))
 
-        self.url = '%s://%s%s' % (urlparts.scheme, urlparts.netloc, urlparts.path)
+        self.url = urlparse.urlunsplit((scheme, netloc, path, query, fragment))
+        self.short_url = urlparse.urlunsplit((scheme, netloc, path, None, None))
         self.method = method
         self.data = data
-        # if querystring was a dict, convert it to a string
-        if isinstance(query_string, dict):
-            query_string = urlencode(query_string.items())
-        self.query_string = query_string
+        self.query_string = query
+        self.fragment = fragment
         if cookies:
             self.cookies = cookies
         else:
@@ -1038,8 +1039,8 @@ class Http(Interface):
     def to_email_html(self, event, **kwargs):
         return render_to_string('sentry/partial/interfaces/http_email.html', {
             'event': event,
-            'full_url': '?'.join(filter(bool, [self.url, self.query_string])),
             'url': self.url,
+            'short_url': self.short_url,
             'method': self.method,
             'query_string': self.query_string,
         })
@@ -1067,10 +1068,11 @@ class Http(Interface):
         context = {
             'is_public': is_public,
             'event': event,
-            'full_url': '?'.join(filter(bool, [self.url, self.query_string])),
             'url': self.url,
+            'short_url': self.short_url,
             'method': self.method,
             'query_string': self.query_string,
+            'fragment': self.fragment,
             'headers': self.headers,
         }
         if not is_public:
diff --git a/src/sentry/templates/sentry/partial/interfaces/http.html b/src/sentry/templates/sentry/partial/interfaces/http.html
index e16bc64b1b..e9aaa9aab5 100644
--- a/src/sentry/templates/sentry/partial/interfaces/http.html
+++ b/src/sentry/templates/sentry/partial/interfaces/http.html
@@ -16,7 +16,7 @@
             <tbody>
                 <tr>
                     <th>{% trans "URL:" %}</th>
-                    <td><a href="{{ url }}{% if query_string %}?{{ query_string }}{% endif %}">{{ url }}</a></td>
+                    <td><a href="{{ url }}">{{ short_url }}</a></td>
                 </tr>
                 {% if method %}
                     <tr>
@@ -24,12 +24,22 @@
                         <td>{{ method }}</td>
                     </tr>
                 {% endif %}
-                <tr>
-                    <th>{% trans "Query:" %}</th>
-                    <td class="values">
-                        <pre>{{ query_string }}</pre>
-                    </td>
-                </tr>
+                {% if query_string %}
+                    <tr>
+                        <th>{% trans "Query:" %}</th>
+                        <td class="values">
+                            <pre>{{ query_string }}</pre>
+                        </td>
+                    </tr>
+                {% endif %}
+                {% if fragment %}
+                    <tr>
+                        <th>{% trans "Fragment:" %}</th>
+                        <td class="values">
+                            <pre>{{ fragment }}</pre>
+                        </td>
+                    </tr>
+                {% endif %}
                 {% if data %}
                     <tr>
                         <th>{% trans "Body:" %}</th>
diff --git a/src/sentry/templates/sentry/partial/interfaces/http_email.html b/src/sentry/templates/sentry/partial/interfaces/http_email.html
index 0990c9dee1..d9b76c2081 100644
--- a/src/sentry/templates/sentry/partial/interfaces/http_email.html
+++ b/src/sentry/templates/sentry/partial/interfaces/http_email.html
@@ -3,7 +3,7 @@
     <tbody>
         <tr>
             <th>{% trans "URL" %}</th>
-            <td><a href="{{ url }}{% if query_string %}?{{ query_string }}{% endif %}">{{ url }}</a></td>
+            <td><a href="{{ url }}">{{ short_url }}</a></td>
         </tr>
         {% if method %}
             <tr>
