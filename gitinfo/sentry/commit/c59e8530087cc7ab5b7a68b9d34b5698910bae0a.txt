commit c59e8530087cc7ab5b7a68b9d34b5698910bae0a
Author: Ben Vinegar <ben@benv.ca>
Date:   Tue Oct 6 11:45:21 2015 -0700

    Load assets from django server according to manifest.json

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 378a801e90..5a56211f86 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -14,6 +14,7 @@ from django.conf.global_settings import *  # NOQA
 from datetime import timedelta
 
 import hashlib
+import json
 import os
 import os.path
 import socket
@@ -258,6 +259,10 @@ STATICFILES_FINDERS = (
     "django.contrib.staticfiles.finders.AppDirectoriesFinder",
 )
 
+ASSET_MANIFEST_PATH = os.path.join(STATIC_ROOT, 'sentry', 'dist', 'manifest.json')
+with open(ASSET_MANIFEST_PATH) as manifest_file:
+    ASSET_MANIFEST = json.load(manifest_file)
+
 # setup a default media root to somewhere useless
 MEDIA_ROOT = '/tmp/sentry-media'
 
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index ad5b07fe4d..80c1b033c8 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -1,6 +1,7 @@
 {% load i18n %}
 {% load sentry_api %}
 {% load sentry_dsn %}
+{% load sentry_assets %}
 {% load sentry_features %}
 {% load sentry_helpers %}
 {% load sentry_react %}
@@ -18,7 +19,7 @@
   <link href="{% url 'sentry-media' "sentry" "images/favicon.ico" %}" rel="shortcut icon" type="image/png"/>
 
   {% block css %}
-  <link href="{% url 'sentry-media' "sentry" "dist/sentry.css" %}" rel="stylesheet"/>
+  <link href="{% asset_url 'sentry-media' "sentry" "dist/sentry.css" %}" rel="stylesheet"/>
   {% endblock %}
 
   <title>{% block title %}Sentry{% endblock %}</title>
@@ -27,8 +28,8 @@
   <script type="text/javascript" src="{% url 'sentry-media' "sentry" "scripts/lib/html5shiv.js" %}"></script>
   <![endif]-->
   {% block scripts %}
-  <script src="{% url 'sentry-media' "sentry" "dist/vendor.js" %}"></script>
-  <script src="{% url 'sentry-media' "sentry" "dist/app.js" %}"></script>
+  <script src="{% asset_url 'sentry-media' "sentry" "dist/vendor.js" %}"></script>
+  <script src="{% asset_url 'sentry-media' "sentry" "dist/app.js" %}"></script>
 
   <script>
     for (var n in window.exports) {
diff --git a/src/sentry/templatetags/sentry_assets.py b/src/sentry/templatetags/sentry_assets.py
new file mode 100644
index 0000000000..4528849273
--- /dev/null
+++ b/src/sentry/templatetags/sentry_assets.py
@@ -0,0 +1,39 @@
+from django.template import Library
+from django.template.defaulttags import URLNode, url
+
+from django.conf import settings
+
+register = Library()
+
+
+class AssetURLNode(URLNode):
+    def render(self, context):
+        path = super(AssetURLNode, self).render(context)
+
+        # Replace last part of url path with value from manifest
+        # TODO: Blow up gracefully if not in manifest?
+        parts = path.split('/')
+        last = parts[-1]
+        parts[-1] = settings.ASSET_MANIFEST[last]
+
+        return '/'.join(parts)
+
+
+@register.tag
+def asset_url(parser, token, node_cls=AssetURLNode):
+    """
+        Just like the "url" templatetag, except replaces the filename part of
+        the url path with the versioned filename pulled from the asset manifest
+        generated by webpack.
+
+        Example:
+          {% asset_url 'sentry-media' 'sentry' 'dist/sentry.css' %}
+          =>  "/_static/sentry/dist/sentry.74d127b78dc7daf2c51f.css"
+    """
+
+    node_instance = url(parser, token)
+
+    return node_cls(view_name=node_instance.view_name,
+        args=node_instance.args,
+        kwargs=node_instance.kwargs,
+        asvar=node_instance.asvar)
