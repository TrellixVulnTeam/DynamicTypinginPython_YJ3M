commit bc3bab2daabf2f6a3644fa0cf8b4d67573f15d62
Author: Daniel Griesser <daniel.griesser.86@gmail.com>
Date:   Fri Feb 17 10:05:33 2017 +0100

    Add app url scheme with monkey patch, Remove react-native scheme

diff --git a/src/sentry/__init__.py b/src/sentry/__init__.py
index b8f0ab820f..d901d1c7df 100644
--- a/src/sentry/__init__.py
+++ b/src/sentry/__init__.py
@@ -62,3 +62,6 @@ def is_docker():
 __version__ = VERSION
 __build__ = get_revision()
 __docformat__ = 'restructuredtext en'
+
+# This triggers monkey patches
+__import__('sentry.monkey')
diff --git a/src/sentry/lang/javascript/plugin.py b/src/sentry/lang/javascript/plugin.py
index 9a82e02fa7..929d7c2d51 100644
--- a/src/sentry/lang/javascript/plugin.py
+++ b/src/sentry/lang/javascript/plugin.py
@@ -26,7 +26,8 @@ def generate_modules(data):
             if platform != 'javascript' or frame.get('module'):
                 continue
             abs_path = frame.get('abs_path')
-            if abs_path and abs_path.startswith(('http:', 'https:', 'webpack:')):
+            if abs_path and abs_path.startswith(('http:', 'https:',
+                    'webpack:', 'app:')):
                 frame['module'] = generate_module(abs_path)
 
 
diff --git a/src/sentry/lang/javascript/processor.py b/src/sentry/lang/javascript/processor.py
index 6dc1336c46..dea884d442 100644
--- a/src/sentry/lang/javascript/processor.py
+++ b/src/sentry/lang/javascript/processor.py
@@ -761,7 +761,7 @@ class JavaScriptStacktraceProcessor(StacktraceProcessor):
                     # We want to explicitly generate a webpack module name
                     new_frame['module'] = generate_module(filename)
 
-                if frame['abs_path'].startswith('react-native:'):
+                if abs_path.startswith('app:'):
                     if NODE_MODULES_RE.match(filename):
                         in_app = False
                     else:
@@ -770,7 +770,7 @@ class JavaScriptStacktraceProcessor(StacktraceProcessor):
                 new_frame['abs_path'] = abs_path
                 new_frame['filename'] = filename
                 if not frame.get('module') and abs_path.startswith(
-                        ('http:', 'https:', 'webpack:')):
+                        ('http:', 'https:', 'webpack:', 'app:')):
                     new_frame['module'] = generate_module(abs_path)
 
         elif sourcemap_url:
diff --git a/src/sentry/monkey.py b/src/sentry/monkey.py
new file mode 100644
index 0000000000..f533f174b0
--- /dev/null
+++ b/src/sentry/monkey.py
@@ -0,0 +1,12 @@
+from __future__ import absolute_import
+
+
+def register_scheme(name):
+    from six.moves.urllib import parse as urlparse
+    uses = urlparse.uses_netloc, urlparse.uses_query, urlparse.uses_relative, urlparse.uses_fragment
+    for use in uses:
+        if name not in use:
+            use.append(name)
+
+
+register_scheme('app')
diff --git a/tests/sentry/lang/javascript/test_processor.py b/tests/sentry/lang/javascript/test_processor.py
index 400b3741bf..189adfa886 100644
--- a/tests/sentry/lang/javascript/test_processor.py
+++ b/tests/sentry/lang/javascript/test_processor.py
@@ -247,7 +247,9 @@ class GenerateModuleTest(TestCase):
         assert generate_module('/a/javascripts/application-bundle-149360d3414c26adac3febdf6832e25c.min.js') == 'a/javascripts/application-bundle'
         assert generate_module('https://example.com/libs/libs-20150417171659.min.js') == 'libs/libs'
         assert generate_module('webpack:///92cd589eca8235e7b373bf5ae94ebf898e3b949c/vendor.js') == 'vendor'
-        assert generate_module('webpack:///example/92cd589eca8235e7b373bf5ae94ebf898e3b949c/vendor.js') == 'vendor'
+        assert generate_module('webpack:///92cd589eca8235e7b373bf5ae94ebf898e3b949c/vendor.js') == 'vendor'
+        assert generate_module('app:///92cd589eca8235e7b373bf5ae94ebf898e3b949c/vendor.js') == 'vendor'
+        assert generate_module('app:///example/92cd589eca8235e7b373bf5ae94ebf898e3b949c/vendor.js') == 'vendor'
         assert generate_module('~/app/components/projectHeader/projectSelector.jsx') == 'app/components/projectHeader/projectSelector'
 
 
