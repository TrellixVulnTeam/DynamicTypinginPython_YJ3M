commit c385e67c1e9fed08508ab9bfeeeb19683c076562
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Mar 5 19:53:43 2015 -0800

    Add release delete endpoint

diff --git a/src/sentry/api/endpoints/release_details.py b/src/sentry/api/endpoints/release_details.py
index eaef4a33ea..5f97cc4457 100644
--- a/src/sentry/api/endpoints/release_details.py
+++ b/src/sentry/api/endpoints/release_details.py
@@ -5,7 +5,7 @@ from rest_framework.response import Response
 from sentry.api.base import DocSection
 from sentry.api.bases.project import ProjectEndpoint
 from sentry.api.serializers import serialize
-from sentry.models import Release
+from sentry.models import Release, ReleaseFile
 
 
 class ReleaseDetailsEndpoint(ProjectEndpoint):
@@ -26,3 +26,30 @@ class ReleaseDetailsEndpoint(ProjectEndpoint):
         )
 
         return Response(serialize(release, request.user))
+
+    def delete(self, request, project, version):
+        """
+        Delete a file
+
+        Permanently remove a file from a release.
+
+            {method} {path}
+
+        This will also remove the physical file from storage.
+        """
+        # TODO(dcramer): this needs to happen in the queue as it could be a long
+        # and expensive operation
+        release = Release.objects.get(
+            project=project,
+            version=version,
+        )
+
+        file_list = ReleaseFile.objects.filter(
+            release=release,
+        ).select_related('file')
+        for releasefile in file_list:
+            releasefile.file.delete()
+            releasefile.delete()
+        release.delete()
+
+        return Response(status=204)
diff --git a/tests/sentry/api/endpoints/test_release_details.py b/tests/sentry/api/endpoints/test_release_details.py
index 53073723f1..19fbfdf95f 100644
--- a/tests/sentry/api/endpoints/test_release_details.py
+++ b/tests/sentry/api/endpoints/test_release_details.py
@@ -2,7 +2,7 @@ from __future__ import absolute_import
 
 from django.core.urlresolvers import reverse
 
-from sentry.models import Release
+from sentry.models import File, Release, ReleaseFile
 from sentry.testutils import APITestCase
 
 
@@ -20,7 +20,38 @@ class ReleaseDetailsTest(APITestCase):
             'project_id': project.id,
             'version': release.version,
         })
-        response = self.client.get(url, format='json')
+        response = self.client.get(url)
 
         assert response.status_code == 200, response.content
         assert response.data['version'] == release.version
+
+
+class ReleaseDeleteTest(APITestCase):
+    def test_simple(self):
+        self.login_as(user=self.user)
+
+        project = self.create_project(name='foo')
+        release = Release.objects.create(
+            project=project,
+            version='1',
+        )
+        releasefile = ReleaseFile.objects.create(
+            project=project,
+            release=release,
+            file=File.objects.create(
+                path='http://example.com',
+                name='application.js',
+                type='release.file',
+            ),
+            name='http://example.com/application.js'
+        )
+
+        url = reverse('sentry-api-0-release-details', kwargs={
+            'project_id': project.id,
+            'version': release.version,
+        })
+        response = self.client.delete(url)
+
+        assert response.status_code == 204, response.content
+
+        assert not Release.objects.filter(id=release.id).exists()
