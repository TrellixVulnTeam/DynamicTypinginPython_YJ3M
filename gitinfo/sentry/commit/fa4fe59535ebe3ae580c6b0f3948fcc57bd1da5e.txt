commit fa4fe59535ebe3ae580c6b0f3948fcc57bd1da5e
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Aug 19 10:55:53 2019 +0200

    fix: Hide misleading dotnet suggestion (#14404)

diff --git a/src/sentry/sdk_updates.py b/src/sentry/sdk_updates.py
index 964122fe1b..11f29e6e37 100644
--- a/src/sentry/sdk_updates.py
+++ b/src/sentry/sdk_updates.py
@@ -115,9 +115,9 @@ class UpdateSDKSuggestion(Suggestion):
 
 class ChangeSDKSuggestion(Suggestion):
     """
-    :param module_names: A list of modules that, when any of them is loaded,
-        indicate that the SDK is already used. This list is used to weed out
-        invalid suggestions when using multiple SDKs in e.g. .NET.
+    :param module_names: Hide this suggestion if any of the given modules is
+        loaded. This list is used to weed out invalid suggestions when using
+        multiple SDKs in e.g. .NET.
     """
 
     def __init__(self, new_sdk_name, module_names=None):
@@ -281,11 +281,15 @@ SDK_SUPPORTED_MODULES = [
         "sdk_version_added": "0.0.0",
         "module_name": "Microsoft.Extensions.Logging.Configuration",
         "module_version_min": "2.1.0",
-        # For some reason the SDK does not always report the
-        # `Sentry.Extensions.Logging` module (observed in ASP.NET apps that use
-        # the logging SDK implicitly).
         "suggestion": ChangeSDKSuggestion(
-            "sentry.dotnet.extensions.logging", ["Sentry.Extensions.Logging", "Sentry.AspNetCore"]
+            "sentry.dotnet.extensions.logging",
+            [
+                "Sentry.Extensions.Logging",
+                # If AspNetCore is used, do not show this suggestion at all,
+                # because the (hopefully visible) suggestion to use the
+                # AspNetCore SDK is more specific.
+                "Microsoft.AspNetCore.Hosting",
+            ],
         ),
     },
     {
diff --git a/tests/sentry/test_sdk_updates.py b/tests/sentry/test_sdk_updates.py
index f7b67a781b..aedf59d456 100644
--- a/tests/sentry/test_sdk_updates.py
+++ b/tests/sentry/test_sdk_updates.py
@@ -176,3 +176,31 @@ def test_add_no_dotnet_sdk(some_dotnet_sdk):
 
     suggestions = list(get_suggested_updates(setup, DOTNET_INDEX_STATE))
     assert suggestions == []
+
+
+def test_more_specific_dotnet_sdk(some_dotnet_sdk):
+    setup = SdkSetupState(
+        sdk_name=some_dotnet_sdk,
+        sdk_version="1.2.0",
+        integrations=[],
+        modules={
+            "Microsoft.AspNetCore.Hosting": "2.1.0",
+            "Microsoft.Extensions.Logging.Configuration": "2.1.0",
+        },
+    )
+
+    suggestions = list(get_suggested_updates(setup, DOTNET_INDEX_STATE))
+    if some_dotnet_sdk == "sentry.dotnet.aspnetcore":
+        assert not suggestions
+    else:
+        # Do not show suggestion for sentry.dotnet.extensions.logging. The user
+        # has a aspnetcore application and the aspnetcore SDK instruments
+        # logging too.
+        assert suggestions == [
+            {
+                "enables": [],
+                "newSdkName": "sentry.dotnet.aspnetcore",
+                "sdkUrl": None,
+                "type": "changeSdk",
+            }
+        ]
