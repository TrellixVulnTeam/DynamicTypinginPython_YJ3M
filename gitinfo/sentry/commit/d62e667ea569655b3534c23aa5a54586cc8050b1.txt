commit d62e667ea569655b3534c23aa5a54586cc8050b1
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Sep 30 12:15:11 2015 -0700

    More efficient queryset for projectkey backfill

diff --git a/src/sentry/management/commands/repair.py b/src/sentry/management/commands/repair.py
index b562da9a2c..96257d9661 100644
--- a/src/sentry/management/commands/repair.py
+++ b/src/sentry/management/commands/repair.py
@@ -19,10 +19,9 @@ class Command(BaseCommand):
         sync_docs()
 
         from sentry.models import Project, ProjectKey
-        from sentry.utils.query import RangeQuerySetWrapperWithProgressBar
         print("Creating missing project keys")
-        queryset = Project.objects.all()
-        for project in RangeQuerySetWrapperWithProgressBar(queryset):
+        queryset = Project.objects.filter(key_set__isnull=True)
+        for project in queryset:
             try:
                 ProjectKey.objects.get_or_create(
                     project=project,
