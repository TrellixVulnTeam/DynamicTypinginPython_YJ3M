commit 22ef22bd800e1e47545017da3f4c7b71404b70f1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 19 04:17:55 2012 -0800

    Support HEAD and additional headers in CORS

diff --git a/src/sentry/utils/http.py b/src/sentry/utils/http.py
index 0b2bc00473..6514d5ba7a 100644
--- a/src/sentry/utils/http.py
+++ b/src/sentry/utils/http.py
@@ -84,7 +84,8 @@ def apply_access_control_headers(response, origin):
     """
     if origin:
         response['Access-Control-Allow-Origin'] = origin
-        response['Access-Control-Allow-Headers'] = 'X-Sentry-Auth, Authentication'
-        response['Access-Control-Allow-Methods'] = 'POST, OPTIONS'
+        response['Access-Control-Allow-Headers'] = 'X-Sentry-Auth, X-Requested-With, Origin, Accept, Content-Type, ' \
+            'Authentication'
+        response['Access-Control-Allow-Methods'] = 'HEAD, POST, OPTIONS'
 
     return response
diff --git a/tests/sentry/utils/http/tests.py b/tests/sentry/utils/http/tests.py
index 96d98009fd..0907e26561 100644
--- a/tests/sentry/utils/http/tests.py
+++ b/tests/sentry/utils/http/tests.py
@@ -48,10 +48,19 @@ class AccessControlTestCase(TestCase):
             response = apply_access_control_headers(HttpResponse(), "http://foo.example")
             self.assertEqual(response.get('Access-Control-Allow-Origin', None),
                              "http://foo.example")
-            self.assertEqual(response.get('Access-Control-Allow-Headers', None),
-                             "X-Sentry-Auth, Authentication")
-            self.assertEqual(response.get('Access-Control-Allow-Methods', None),
-                             "POST, OPTIONS")
+
+            headers = response.get('Access-Control-Allow-Headers', None)
+            self.assertNotEquals(headers, None)
+            headers = headers.split(', ')
+            self.assertIn('X-Sentry-Auth', headers)
+            self.assertIn('Authentication', headers)
+
+            methods = response.get('Access-Control-Allow-Methods', None)
+            self.assertNotEquals(methods, None)
+            methods = methods.split(', ')
+            self.assertIn('POST', methods)
+            self.assertIn('HEAD', methods)
+            self.assertIn('OPTIONS', methods)
 
 
 class IsValidOriginTestCase(TestCase):
