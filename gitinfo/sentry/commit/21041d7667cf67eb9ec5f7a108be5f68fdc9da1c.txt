commit 21041d7667cf67eb9ec5f7a108be5f68fdc9da1c
Author: Chris Jennings <chriskjennings@gmail.com>
Date:   Fri Sep 7 11:26:42 2018 -0700

    feat(ui): Discover table and various other tweaks (#9653)
    
    feat(ui): Discover table and various other tweaks

diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
index 204330ef48..f9919e1231 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
@@ -24,7 +24,7 @@ import EarlyAdopterMessage from './earlyAdopterMessage';
 
 import {isValidCondition} from './conditions/utils';
 import {isValidAggregation} from './aggregations/utils';
-import {Fieldset, PlaceholderText, ButtonSpinner, SidebarLabel} from './styles';
+import {Heading, Fieldset, PlaceholderText, ButtonSpinner, SidebarLabel} from './styles';
 
 import {getQueryStringFromQuery} from './utils';
 import {trackQuery} from './analytics';
@@ -245,9 +245,9 @@ export default class OrganizationDiscover extends React.Component {
         </Header>
         <DiscoverBody>
           <Sidebar w={320}>
-            <SidebarHeader align="center" px={space(4)} py={space(1.5)}>
+            <SidebarHeader>
               <Box flex="1">
-                <DiscoverHeading>{t('Query')}</DiscoverHeading>
+                <Heading>{t('Query')}</Heading>
               </Box>
               <Box>
                 <Button
@@ -320,7 +320,7 @@ export default class OrganizationDiscover extends React.Component {
               />
             </Fieldset>
           </Sidebar>
-          <Flex flex="1" direction="column" px={3} py={3}>
+          <Flex flex="1" direction="column" px={space(4)} pt={space(2)} pb={space(3)}>
             {data && (
               <Result
                 data={data}
@@ -338,19 +338,15 @@ export default class OrganizationDiscover extends React.Component {
   }
 }
 
-const DiscoverHeading = styled.h2`
-  font-size: 18px;
-  font-weight: normal;
-  color: ${p => p.theme.gray4};
-  margin: 0;
-`;
-
 const SidebarHeader = styled(Flex)`
+  align-items: center;
+  padding: ${space(2)} ${space(4)};
   border-bottom: 1px solid ${p => p.theme.borderLight};
 `;
 
 const DiscoverBody = styled(Flex)`
   min-height: calc(100vh - 152px);
+  margin-bottom: -${space(3)};
 `;
 
 const Sidebar = styled(Box)`
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
index 1854f6ce08..54f6ed873c 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
@@ -7,10 +7,14 @@ import {Box, Flex} from 'grid-emotion';
 import {t} from 'app/locale';
 import BarChart from 'app/components/charts/barChart';
 import LineChart from 'app/components/charts/lineChart';
+import Panel from 'app/components/panels/panel';
+import space from 'app/styles/space';
 import Tooltip from 'app/components/charts/components/tooltip';
 
 import Table from './table';
 import {getChartData, getChartDataByDay, formatTooltip} from './utils';
+import {Heading} from '../styles';
+
 import {NUMBER_OF_SERIES_BY_DAY} from '../data';
 
 export default class Result extends React.Component {
@@ -60,24 +64,22 @@ export default class Result extends React.Component {
     }
 
     return (
-      <Flex justify="flex-end" align="center" my={2}>
-        <div className="btn-group">
-          {options.map(opt => {
-            const active = opt.id === this.state.view;
-            return (
-              <a
-                key={opt.id}
-                className={classNames('btn btn-default btn-sm', {active})}
-                onClick={() => {
-                  this.setState({view: opt.id});
-                }}
-              >
-                {opt.name}
-              </a>
-            );
-          })}
-        </div>
-      </Flex>
+      <div className="btn-group">
+        {options.map(opt => {
+          const active = opt.id === this.state.view;
+          return (
+            <a
+              key={opt.id}
+              className={classNames('btn btn-default btn-sm', {active})}
+              onClick={() => {
+                this.setState({view: opt.id});
+              }}
+            >
+              {opt.name}
+            </a>
+          );
+        })}
+      </div>
     );
   }
 
@@ -107,33 +109,42 @@ export default class Result extends React.Component {
 
     return (
       <div>
-        {this.renderToggle()}
+        <Flex align="center" mb={space(2)}>
+          <Box flex="1">
+            <Heading>{t('Result')}</Heading>
+          </Box>
+          <Box justifySelf="flex-end">{this.renderToggle()}</Box>
+        </Flex>
 
         {view === 'table' && <Table data={data} query={query} />}
         {view === 'line' && (
-          <LineChart
-            series={basicChartData}
-            height={300}
-            options={{
-              tooltip: Tooltip({
-                formatter: formatTooltip,
-              }),
-            }}
-          />
+          <ChartWrapper>
+            <LineChart
+              series={basicChartData}
+              height={300}
+              options={{
+                tooltip: Tooltip({
+                  formatter: formatTooltip,
+                }),
+              }}
+            />
+          </ChartWrapper>
         )}
         {view === 'bar' && (
-          <BarChart
-            series={basicChartData}
-            height={300}
-            options={{
-              tooltip: Tooltip({
-                formatter: formatTooltip,
-              }),
-            }}
-          />
+          <ChartWrapper>
+            <BarChart
+              series={basicChartData}
+              height={300}
+              options={{
+                tooltip: Tooltip({
+                  formatter: formatTooltip,
+                }),
+              }}
+            />
+          </ChartWrapper>
         )}
         {view === 'line-by-day' && (
-          <React.Fragment>
+          <ChartWrapper>
             <LineChart
               series={byDayChartData}
               height={300}
@@ -144,10 +155,10 @@ export default class Result extends React.Component {
               }}
             />
             {this.renderNote()}
-          </React.Fragment>
+          </ChartWrapper>
         )}
         {view === 'bar-by-day' && (
-          <React.Fragment>
+          <ChartWrapper>
             <BarChart
               series={byDayChartData}
               stacked={true}
@@ -159,7 +170,7 @@ export default class Result extends React.Component {
               }}
             />
             {this.renderNote()}
-          </React.Fragment>
+          </ChartWrapper>
         )}
         {this.renderSummary()}
       </div>
@@ -167,11 +178,20 @@ export default class Result extends React.Component {
   }
 }
 
+const ChartWrapper = styled(Panel)`
+  padding-left: ${space(3)};
+  padding-right: ${space(3)};
+`;
+
 const Summary = styled(Box)`
   color: ${p => p.theme.gray6};
-  font-size: 12px;
+  font-size: ${p => p.theme.fontSizeSmall};
+  margin-bottom: ${space(3)};
 `;
 
 const Note = styled(Box)`
   text-align: center;
+  font-size: ${p => p.theme.fontSizeMedium};
+  color: ${p => p.theme.gray3};
+  margin-bottom: ${space(3)};
 `;
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
index 0a8959866e..a0b5e64639 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
@@ -8,6 +8,7 @@ import theme from 'app/utils/theme';
 import AutoSelectText from 'app/components/autoSelectText';
 import Link from 'app/components/link';
 import InlineSvg from 'app/components/inlineSvg';
+import Panel from 'app/components/panels/panel';
 import {getDisplayValue, getDisplayText} from './utils';
 
 /**
@@ -45,9 +46,9 @@ export default class ResultTable extends React.Component {
 
     if (rowIndex === 0) {
       return (
-        <Cell key={key} style={style}>
+        <TableHeader key={key} style={style}>
           <strong>{colName}</strong>
-        </Cell>
+        </TableHeader>
       );
     }
 
@@ -108,8 +109,8 @@ export default class ResultTable extends React.Component {
         sizes.push(this.measureText(getDisplayText(row[colName]), false));
       });
 
-      // Ensure size is within max and min bounds, add 8px for cell padding
-      return Math.max(Math.min(Math.max(...sizes) + 8, MAX_COL_WIDTH), MIN_COL_WIDTH);
+      // Ensure size is within max and min bounds, add 20px for cell padding
+      return Math.max(Math.min(Math.max(...sizes) + 20, MAX_COL_WIDTH), MIN_COL_WIDTH);
     }
 
     return MIN_COL_WIDTH;
@@ -146,20 +147,16 @@ export default class ResultTable extends React.Component {
           {({width, height}) => (
             <MultiGrid
               ref={ref => (this.grid = ref)}
-              width={width}
+              width={width - 1}
               height={height}
-              rowCount={data.length + 1} // Add 1 for header row
+              rowCount={data.length + 1}
               columnCount={cols.length + (showEventLinks ? 1 : 0)}
               fixedRowCount={1}
-              rowHeight={30}
+              rowHeight={41}
               columnWidth={this.getColumnWidth}
               cellRenderer={this.cellRenderer}
-              styleBottomRightGrid={{
-                border: `1px solid ${theme.borderDark}`,
-              }}
               styleTopRightGrid={{
-                border: `1px solid ${theme.borderDark}`,
-                borderBottom: 'none',
+                borderBottom: `1px solid ${theme.borderDark}`,
               }}
             />
           )}
@@ -179,8 +176,10 @@ export default class ResultTable extends React.Component {
   }
 }
 
-const GridContainer = styled('div')`
-  height: ${p => p.visibleRows * 30}px;
+const GridContainer = styled(Panel)`
+  height: ${p =>
+    p.visibleRows * 43}px; /* cell height + cell border + top and bottom Panel border */
+  overflow: hidden;
 
   .ReactVirtualized__Grid {
     outline: none;
@@ -188,11 +187,12 @@ const GridContainer = styled('div')`
 `;
 
 const Cell = styled('div')`
-  ${p => p.isOddRow && `background-color: ${p.theme.borderLighter};`} ${p =>
+  ${p => !p.isOddRow && `background-color: ${p.theme.whiteDark};`} ${p =>
       `text-align: ${p.align};`} overflow: scroll;
   font-size: 14px;
-  line-height: 30px;
-  padding: 0 4px;
+  line-height: 40px;
+  padding: 0 10px;
+  border-top: 1px solid ${p => p.theme.borderLight};
 
   ::-webkit-scrollbar {
     display: none;
@@ -204,3 +204,12 @@ const Cell = styled('div')`
 
   -ms-overflow-style: -ms-autohiding-scrollbar;
 `;
+
+const TableHeader = styled(Cell)`
+  background: ${p => p.theme.offWhite};
+  color: ${p => p.theme.gray3};
+  border-top: none;
+  &:first-of-type {
+    border-top-left-radius: 3px;
+  }
+`;
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
index d239200c1e..f0b80bda99 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
@@ -9,6 +9,13 @@ export const PlaceholderText = styled.div`
   font-size: 15px;
 `;
 
+export const Heading = styled.h2`
+  font-size: 20px;
+  font-weight: normal;
+  color: ${p => p.theme.gray4};
+  margin: 0;
+`;
+
 export const Fieldset = styled.fieldset`
   margin: ${space(3)} ${space(4)};
 `;
