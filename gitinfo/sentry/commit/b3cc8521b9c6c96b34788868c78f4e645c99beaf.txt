commit b3cc8521b9c6c96b34788868c78f4e645c99beaf
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed May 25 17:20:18 2016 -0700

    Handle SSO case with AnonymousUser

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index 2fda982288..958796184c 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -517,9 +517,15 @@ class AuthHelper(object):
                 return self._handle_unknown_identity(identity)
 
             # If the User attached to this AuthIdentity is not active,
-            # we want to clobber the old account and take it over, rather
-            # than prompting to merge, which may be confusing.
+            # we want to clobber the old account and take it over, rather than
+            # getting logged into the inactive account.
             if not auth_identity.user.is_active:
+
+                # Current user is also not logged in, so we have to
+                # assume unknown.
+                if not self.request.user.is_authenticated():
+                    return self._handle_unknown_identity(identity)
+
                 auth_identity = self._handle_attach_identity(identity)
 
             return self._handle_existing_identity(auth_identity, identity)
