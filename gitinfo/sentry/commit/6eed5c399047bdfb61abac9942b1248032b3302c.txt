commit 6eed5c399047bdfb61abac9942b1248032b3302c
Author: Josh Wright <josh.wright@silentcircle-llc.com>
Date:   Sat Aug 31 15:23:55 2013 -0400

    Enable IPv6 support for the UDP server

diff --git a/src/sentry/services/udp.py b/src/sentry/services/udp.py
index 86ca6790fd..5ac7ba6286 100644
--- a/src/sentry/services/udp.py
+++ b/src/sentry/services/udp.py
@@ -93,9 +93,15 @@ class BaseUDPServer(Service):
             raise CommandError(
                 'It seems that you don\'t have the ``%s`` package installed, '
                 'which is required to run the udp service.' % (self.name,))
-        sock = self._socket(socket.AF_INET, socket.SOCK_DGRAM)
-        sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
-        sock.bind((self.host, self.port))
+        try:
+            sock = self._socket(socket.AF_INET6, socket.SOCK_DGRAM)
+            sock.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 0)
+            sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
+            sock.bind((self.host.strip('[]'), self.port))
+        except (socket.gaierror, socket.error):
+            sock = self._socket(socket.AF_INET, socket.SOCK_DGRAM)
+            sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
+            sock.bind((self.host, self.port))
         while True:
             try:
                 self._spawn(self.handle, *sock.recvfrom(self.BUF_SIZE))
