commit 554fc203aa3431d2d80400415618ea65855ad648
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Mon Dec 2 13:50:27 2019 -0800

    fix(members): Correct 2fa filter (#15896)
    
    The query must be distinct since we're joining on one -> many

diff --git a/src/sentry/api/endpoints/organization_member_index.py b/src/sentry/api/endpoints/organization_member_index.py
index b146e74fde..e9bc3de740 100644
--- a/src/sentry/api/endpoints/organization_member_index.py
+++ b/src/sentry/api/endpoints/organization_member_index.py
@@ -144,7 +144,7 @@ class OrganizationMemberIndexEndpoint(OrganizationEndpoint):
                         types = [a.type for a in available_authenticators(ignore_backup=True)]
                         queryset = queryset.filter(
                             user__authenticator__isnull=False, user__authenticator__type__in=types
-                        )
+                        ).distinct()
                     else:
                         queryset = queryset.filter(user__authenticator__isnull=True)
 
diff --git a/tests/sentry/api/endpoints/test_organization_member_index.py b/tests/sentry/api/endpoints/test_organization_member_index.py
index ef41905028..48f2745032 100644
--- a/tests/sentry/api/endpoints/test_organization_member_index.py
+++ b/tests/sentry/api/endpoints/test_organization_member_index.py
@@ -202,7 +202,9 @@ class OrganizationMemberListTest(APITestCase):
             invite_status=InviteStatus.APPROVED.value,
         )
 
+        # Two authenticators to ensure the user list is distinct
         Authenticator.objects.create(user=member_2fa.user, type=1)
+        Authenticator.objects.create(user=member_2fa.user, type=2)
 
         response = self.client.get(self.url + "?query=has2fa:true")
         assert response.status_code == 200
