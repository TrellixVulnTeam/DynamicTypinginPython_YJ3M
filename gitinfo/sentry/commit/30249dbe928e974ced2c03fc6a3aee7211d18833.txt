commit 30249dbe928e974ced2c03fc6a3aee7211d18833
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jul 9 12:03:59 2015 -0600

    Ensure daily rollups are correct

diff --git a/src/sentry/api/endpoints/group_details.py b/src/sentry/api/endpoints/group_details.py
index 80e40faaec..474b6f4b17 100644
--- a/src/sentry/api/endpoints/group_details.py
+++ b/src/sentry/api/endpoints/group_details.py
@@ -140,20 +140,18 @@ class GroupDetailsEndpoint(GroupEndpoint):
         action_list = self._get_actions(request, group)
 
         now = timezone.now()
-        hourly_stats = tsdb.get_range(
+        hourly_stats = tsdb.rollup(tsdb.get_range(
             model=tsdb.models.group,
             keys=[group.id],
             end=now,
             start=now - timedelta(days=1),
-            rollup=3600,
-        )[group.id]
-        daily_stats = tsdb.get_range(
+        ), 3600)[group.id]
+        daily_stats = tsdb.rollup(tsdb.get_range(
             model=tsdb.models.group,
             keys=[group.id],
             end=now,
             start=now - timedelta(days=30),
-            rollup=3600 * 24,
-        )[group.id]
+        ), 3600 * 24)[group.id]
 
         data.update({
             'firstRelease': first_release,
diff --git a/src/sentry/api/serializers/models/group.py b/src/sentry/api/serializers/models/group.py
index 7fa3437fbf..52e279e587 100644
--- a/src/sentry/api/serializers/models/group.py
+++ b/src/sentry/api/serializers/models/group.py
@@ -133,20 +133,18 @@ class StreamGroupSerializer(GroupSerializer):
         # we need to compute stats at 1d (1h resolution), and 14d
         group_ids = [g.id for g in item_list]
         now = timezone.now()
-        hourly_stats = tsdb.get_range(
+        hourly_stats = tsdb.rollup(tsdb.get_range(
             model=tsdb.models.group,
             keys=group_ids,
             end=now,
             start=now - timedelta(days=1),
-            rollup=3600,
-        )
-        daily_stats = tsdb.get_range(
+        ), 3600)
+        daily_stats = tsdb.rollup(tsdb.get_range(
             model=tsdb.models.group,
             keys=group_ids,
             end=now,
             start=now - timedelta(days=14),
-            rollup=3600 * 24,
-        )
+        ), 3600 * 24)
 
         for item in item_list:
             attrs[item].update({
