commit d19aad4be0e21e94f7cb033c3cb301f2d359215d
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Sep 20 10:04:15 2016 -0700

    Add project context to post process tasks (#4184)

diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index a27843529b..a29c261705 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -109,6 +109,9 @@ def plugin_post_process_group(plugin_slug, event, **kwargs):
     """
     Fires post processing hooks for a group.
     """
+    Raven.tags_context({
+        'project': event.project_id,
+    })
     plugin = plugins.get(plugin_slug)
     safe_execute(plugin.post_process, event=event, group=event.group, **kwargs)
 
@@ -118,6 +121,10 @@ def plugin_post_process_group(plugin_slug, event, **kwargs):
 def record_affected_user(event, **kwargs):
     from sentry.models import EventUser, Group
 
+    Raven.tags_context({
+        'project': event.project_id,
+    })
+
     user_data = event.data.get('sentry.interfaces.User', event.data.get('user'))
     if not user_data:
         logger.info('No user data found for event_id=%s', event.event_id)
@@ -154,6 +161,10 @@ def record_affected_user(event, **kwargs):
 def index_event_tags(project_id, event_id, tags, group_id=None, **kwargs):
     from sentry.models import EventTag, Project, TagKey, TagValue
 
+    Raven.tags_context({
+        'project': project_id,
+    })
+
     for key, value in tags:
         tagkey, _ = TagKey.objects.get_or_create(
             project=Project(id=project_id),
