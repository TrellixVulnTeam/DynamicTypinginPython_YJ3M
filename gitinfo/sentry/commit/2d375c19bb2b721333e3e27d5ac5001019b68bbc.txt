commit 2d375c19bb2b721333e3e27d5ac5001019b68bbc
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Thu Mar 22 15:40:23 2018 -0700

    fix(slack): Better use of ORM features (#7747)

diff --git a/src/sentry/integrations/slack/action_endpoint.py b/src/sentry/integrations/slack/action_endpoint.py
index f7a10754c0..0c350a8e42 100644
--- a/src/sentry/integrations/slack/action_endpoint.py
+++ b/src/sentry/integrations/slack/action_endpoint.py
@@ -4,7 +4,7 @@ from sentry import analytics
 from sentry import http, options
 from sentry.api import client
 from sentry.api.base import Endpoint
-from sentry.models import Group, Integration, Project, IdentityProvider, Identity, ApiKey
+from sentry.models import Group, Integration, Project, Identity, ApiKey
 from sentry.utils import json
 
 from .link_identity import build_linking_url
@@ -197,7 +197,7 @@ class SlackActionEndpoint(Endpoint):
         action_list = data.get('actions', [])
 
         try:
-            group = Group.objects.get(
+            group = Group.objects.select_related('project__organization').get(
                 project__in=Project.objects.filter(
                     organization__in=integration.organizations.all(),
                 ),
@@ -211,7 +211,7 @@ class SlackActionEndpoint(Endpoint):
         try:
             identity = Identity.objects.get(
                 external_id=user_id,
-                idp=IdentityProvider.objects.get(organization=group.organization),
+                idp__organization=group.organization,
             )
         except Identity.DoesNotExist:
             associate_url = build_linking_url(
