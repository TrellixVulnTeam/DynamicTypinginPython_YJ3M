commit a63fea6c77e550029c96e5054a6020647ef27950
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Mon Apr 9 14:05:45 2018 -0700

    fix(auth): Error on empty state

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index f96e2083ed..b174260e92 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -230,6 +230,11 @@ class AuthHelper(object):
     def finish_pipeline(self):
         data = self.fetch_state()
 
+        # The state data may have expried, in which case the state data will
+        # simply be None.
+        if not data:
+            return self.error(ERR_INVALID_IDENTITY)
+
         try:
             identity = self.provider.build_identity(data)
         except IdentityNotValid:
