commit e09092b383f371dd31d17a8fbdb14e7258755304
Author: David Cramer <dcramer@users.noreply.github.com>
Date:   Tue Feb 11 02:56:20 2020 -0800

    test: Add pytest-sentry (#16928)

diff --git a/.travis.yml b/.travis.yml
index 6110de18e6..4307bb81b5 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -4,15 +4,15 @@ python: 2.7
 
 branches:
   only:
-  - master
+    - master
 
 cache:
   yarn: true
   directories:
     - "${HOME}/virtualenv/python$(python -c 'import platform; print(platform.python_version())')"
-    - "$NODE_DIR"
+    - '$NODE_DIR'
     - node_modules
-    - "${HOME}/google-cloud-sdk"
+    - '${HOME}/google-cloud-sdk'
 
 addons:
   apt:
@@ -35,6 +35,7 @@ env:
     # node's version is pinned by .nvmrc and is autodetected by `nvm install`.
     - NODE_DIR="${HOME}/.nvm/versions/node/v$(< .nvmrc)"
     - NODE_OPTIONS=--max-old-space-size=4096
+    - PYTEST_SENTRY_DSN=https://6fd5cfea2d4d46b182ad214ac7810508@sentry.io/2423079
 
 before_install:
   - &pip_install pip install --no-cache-dir "pip>=20.0.2"
@@ -52,11 +53,11 @@ after_failure:
 
 after_script:
   - |
-      coverage_files=$(ls .artifacts/*coverage.xml || true)
-      if [[ -n "$coverage_files" || -f .artifacts/coverage/cobertura-coverage.xml ]]; then
-        pip install -U codecov
-        codecov -e TEST_SUITE
-      fi
+    coverage_files=$(ls .artifacts/*coverage.xml || true)
+    if [[ -n "$coverage_files" || -f .artifacts/coverage/cobertura-coverage.xml ]]; then
+      pip install -U codecov
+      codecov -e TEST_SUITE
+    fi
   - ./bin/yarn global add @zeus-ci/cli
   - $(./bin/yarn global bin)/zeus upload -t "text/xml+xunit" .artifacts/*junit.xml
   - $(./bin/yarn global bin)/zeus upload -t "text/xml+coverage" .artifacts/*coverage.xml
@@ -110,7 +111,6 @@ base_acceptance: &acceptance_default
   before_script:
     - psql -c 'create database sentry;' -U postgres
 
-
 # each job in the matrix inherits `env/global` and uses everything above,
 # but custom `services`, `before_install`, `install`, and `before_script` directives
 # may be defined to define and setup individual job environments with more precision.
@@ -208,7 +208,7 @@ matrix:
       language: node_js
       env: STORYBOOK_BUILD=1
       before_install:
-         # Decrypt the credentials we added to the repo using the key we added with the Travis command line tool
+        # Decrypt the credentials we added to the repo using the key we added with the Travis command line tool
         - openssl aes-256-cbc -K $encrypted_020be61ef175_key -iv $encrypted_020be61ef175_iv -in .travis/storybook-credentials.tar.gz.enc -out credentials.tar.gz -d
         # If the SDK is not already cached, download it and unpack it
         - if [ ! -d ${HOME}/google-cloud-sdk ]; then curl https://sdk.cloud.google.com | bash; fi
diff --git a/requirements-dev.txt b/requirements-dev.txt
index 6dc36a6d3e..63915c7349 100644
--- a/requirements-dev.txt
+++ b/requirements-dev.txt
@@ -8,6 +8,7 @@ pytest==4.6.5
 pytest-cov==2.5.1
 pytest-django==3.5.1
 pytest-html==1.22.0
+pytest-sentry==0.1.0
 responses>=0.8.1,<0.9.0
 sentry-flake8==0.1.1
 werkzeug==0.15.5
diff --git a/setup.cfg b/setup.cfg
index 07aefa0aab..e655307e3e 100644
--- a/setup.cfg
+++ b/setup.cfg
@@ -5,6 +5,7 @@ norecursedirs = bin dist docs htmlcov script hooks node_modules .* {args}
 looponfailroots = src tests
 selenium_driver = chrome
 self-contained-html = true
+reruns = 1
 markers =
     snuba: mark a test as requiring snuba
 
