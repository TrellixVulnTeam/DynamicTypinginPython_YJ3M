commit c7e7437941e15bf1c71b75fbd572283ec38a7fb9
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Fri Jun 15 09:38:02 2018 -0700

    fix(ui): Add diffing for messages (#8749)
    
    I don't know how to get test data locally, last I checked it was difficult, so hoping unit test is good.

diff --git a/src/sentry/static/sentry/app/components/issueDiff.jsx b/src/sentry/static/sentry/app/components/issueDiff.jsx
index cda5753c3f..d8e51a8672 100644
--- a/src/sentry/static/sentry/app/components/issueDiff.jsx
+++ b/src/sentry/static/sentry/app/components/issueDiff.jsx
@@ -78,9 +78,17 @@ class IssueDiff extends React.Component {
     // diff multiple exceptions
     //
     // See: https://github.com/getsentry/sentry/issues/6055
-    const exc = event.entries.find(({type}) => type === 'exception');
+    let exc = event.entries.find(({type}) => type === 'exception');
 
-    if (!exc || !exc.data) return [];
+    if (!exc) {
+      // Look for a message if not an exception
+      let msg = event.entries.find(({type}) => type === 'message');
+      if (!msg) return [];
+
+      return msg.data && msg.data.message && [msg.data.message];
+    }
+
+    if (!exc.data) return [];
 
     return exc.data.values
       .filter(value => !!value.stacktrace)
diff --git a/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap b/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
index 1ca95b38b1..0e7ee8f04b 100644
--- a/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
@@ -1,5 +1,88 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
+exports[`IssueDiff can diff message 1`] = `
+<IssueDiff
+  api={Client {}}
+  baseEventId="latest"
+  baseIssueId="base"
+  targetEventId="latest"
+  targetIssueId="target"
+>
+  <IssueDiffWrapper
+    loading={false}
+  >
+    <div
+      className="css-no1ym5-IssueDiffWrapper e1mqtsvu0"
+    >
+      <SplitDiff
+        base="Foo World"
+        key="0"
+        target="Hello World"
+        type="words"
+      >
+        <table
+          className="split-diff"
+        >
+          <tbody>
+            <tr
+              key="0"
+            >
+              <td
+                className="split-view-cell removed-row"
+              >
+                <div
+                  className="split-diff-row"
+                >
+                  <span
+                    className="split-view-word removed"
+                    key="0"
+                  >
+                    Foo
+                  </span>
+                  <span
+                    className="split-view-word"
+                    key="1"
+                  >
+                     World
+                  </span>
+                </div>
+              </td>
+              <td
+                style={
+                  Object {
+                    "width": 20,
+                  }
+                }
+              />
+              <td
+                className="split-view-cell added-row"
+              >
+                <div
+                  className="split-diff-row"
+                >
+                  <span
+                    className="split-view-word added"
+                    key="0"
+                  >
+                    Hello
+                  </span>
+                  <span
+                    className="split-view-word"
+                    key="1"
+                  >
+                     World
+                  </span>
+                </div>
+              </td>
+            </tr>
+          </tbody>
+        </table>
+      </SplitDiff>
+    </div>
+  </IssueDiffWrapper>
+</IssueDiff>
+`;
+
 exports[`IssueDiff can dynamically import SplitDiff 1`] = `
 <IssueDiff
   api={Client {}}
diff --git a/tests/js/spec/components/issueDiff.spec.jsx b/tests/js/spec/components/issueDiff.spec.jsx
index 0d4037127d..fc00c5bf3e 100644
--- a/tests/js/spec/components/issueDiff.spec.jsx
+++ b/tests/js/spec/components/issueDiff.spec.jsx
@@ -35,17 +35,34 @@ describe('IssueDiff', function() {
       <IssueDiff api={api} baseIssueId="base" targetIssueId="target" />
     );
 
-    await new Promise(resolve => {
-      wrapper.instance().componentDidUpdate = jest.fn(() => {
-        if (wrapper.state('loading') || !wrapper.state('SplitDiffAsync')) {
-          wrapper.update();
-        } else {
-          resolve();
-        }
-      });
+    await tick();
+    wrapper.update();
+
+    expect(wrapper.find('SplitDiff')).toHaveLength(1);
+    expect(wrapper).toMatchSnapshot();
+  });
+
+  it('can diff message', async function() {
+    Client.addMockResponse({
+      url: '/issues/target/events/latest/',
+      body: {
+        entries: [{type: 'message', data: {message: 'Hello World'}}],
+      },
     });
-    wrapper.instance().componentDidUpdate.mockRestore();
+    Client.addMockResponse({
+      url: '/issues/base/events/latest/',
+      body: {
+        platform: 'javascript',
+        entries: [{type: 'message', data: {message: 'Foo World'}}],
+      },
+    });
+
+    // Need `mount` because of componentDidMount in <IssueDiff>
+    let wrapper = mount(
+      <IssueDiff api={api} baseIssueId="base" targetIssueId="target" />
+    );
 
+    await tick();
     wrapper.update();
 
     expect(wrapper.find('SplitDiff')).toHaveLength(1);
