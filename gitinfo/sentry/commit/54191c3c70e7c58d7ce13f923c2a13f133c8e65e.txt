commit 54191c3c70e7c58d7ce13f923c2a13f133c8e65e
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Sep 10 01:52:20 2018 -0700

    tagstore: Implement some read repair

diff --git a/src/sentry/tagstore/v2/models/grouptagvalue.py b/src/sentry/tagstore/v2/models/grouptagvalue.py
index a7e19c6f09..d9fd41f800 100644
--- a/src/sentry/tagstore/v2/models/grouptagvalue.py
+++ b/src/sentry/tagstore/v2/models/grouptagvalue.py
@@ -67,10 +67,15 @@ class GroupTagValue(Model):
         # fallback
         from sentry.tagstore.v2.models import TagKey
 
-        tk = TagKey.objects.filter(
-            project_id=self.project_id,
-            id=self._key_id,
-        ).values_list('key', flat=True).get()
+        try:
+            tk = TagKey.objects.filter(
+                project_id=self.project_id,
+                id=self._key_id,
+            ).values_list('key', flat=True).get()
+        except TagKey.DoesNotExist:
+            # Data got inconsistent, I must delete myself.
+            self.delete()
+            return None
 
         # cache for future calls
         self.key = tk
@@ -92,10 +97,15 @@ class GroupTagValue(Model):
         # fallback
         from sentry.tagstore.v2.models import TagValue
 
-        tv = TagValue.objects.filter(
-            project_id=self.project_id,
-            id=self._value_id,
-        ).values_list('value', flat=True).get()
+        try:
+            tv = TagValue.objects.filter(
+                project_id=self.project_id,
+                id=self._value_id,
+            ).values_list('value', flat=True).get()
+        except TagValue.DoesNotExist:
+            # Data got inconsistent, I must delete myself.
+            self.delete()
+            return None
 
         # cache for future calls
         self.value = tv
