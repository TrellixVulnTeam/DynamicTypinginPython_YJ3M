commit 3a687ada621721ef4e6c41f7f5a4ccd639787fd4
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Mar 25 14:26:19 2015 -0700

    Add errorId to API responses

diff --git a/src/sentry/api/base.py b/src/sentry/api/base.py
index 33ddd432a8..ba63c02bfd 100644
--- a/src/sentry/api/base.py
+++ b/src/sentry/api/base.py
@@ -74,12 +74,15 @@ class Endpoint(APIView):
     def convert_args(self, request, *args, **kwargs):
         return (args, kwargs)
 
-    def handle_exception(self, exc):
+    def handle_exception(self, request, exc):
         try:
             return super(Endpoint, self).handle_exception(exc)
         except Exception as exc:
-            logging.exception(unicode(exc))
-            return Response({'detail': 'Internal Error'}, status=500)
+            logging.exception(unicode(exc), extra={'request': request})
+            context = {'detail': 'Internal Error'}
+            if hasattr(request, 'sentry'):
+                context['errorId'] = request.sentry['id']
+            return Response(context, status=500)
 
     @csrf_exempt
     def dispatch(self, request, *args, **kwargs):
@@ -110,7 +113,7 @@ class Endpoint(APIView):
             response = handler(request, *args, **kwargs)
 
         except Exception as exc:
-            response = self.handle_exception(exc)
+            response = self.handle_exception(request, exc)
 
         self.response = self.finalize_response(request, response, *args, **kwargs)
         return self.response
