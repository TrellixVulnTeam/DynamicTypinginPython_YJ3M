commit 61bff9cbc8876eaba66647290d713a66dc9945cf
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Jan 26 17:43:05 2013 -0800

    Make activity stream a bit more sexy

diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index e363d8d542..7b0c3b9d61 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -477,14 +477,6 @@ h3 {
       color: #aaa;
     }
   }
-  .activity {
-    margin-bottom: 20px;
-
-    .sep, .time {
-      font-size: 12px;
-      color: #aaa;
-    }
-  }
 
   .sidebar {
     position: relative;
@@ -1829,9 +1821,10 @@ section.body {
 }
 
 .table-striped {
-  border-top: 2px solid #F4F6F9
+  border-top: 2px solid #F4F6F9;
 
-  tbody tr:nth-child(odd) td, .table-striped tbody tr:nth-child(odd) th {
+  tbody tr:nth-child(odd) td,
+  .table-striped tbody tr:nth-child(odd) th {
     background-color: #F4F6F9;
   }
 }
@@ -1843,7 +1836,8 @@ section.body {
   }
 }
 
-.nav-tabs > .active > a, .nav-tabs > .active > a:hover {
+.nav-tabs > .active > a,
+.nav-tabs > .active > a:hover {
   border: 2px solid #dee3e9;
   border-bottom-color: transparent;
 }
@@ -1853,10 +1847,47 @@ section.body {
   font-weight: bold;
   padding-left: 14px;
   padding-right: 14px;
+
   &:hover {
     background-color: transparent;
     border-color: transparent;
   }
 }
 
+.activity {
+  list-style: none;
+  margin: 0 0 20px;
+
+  > li {
+    line-height: 20px;
+    position: relative;
+    padding-left: 20px;
+
+    .avatar {
+      position: absolute;
+      left: 0;
+      top: 2px;
+      width: 16px;
+      height: 16px;
+      display: block;
+      background-size: 16px 16px;
+      background-repeat: no-repeat;
+      background-position: center center;
+
+      img {
+        width: 16px;
+        height: 16px;
+        display: block;
+      }
+
+      &.sentry {
+        background-image: url('../images/favicon.png');
+      }
+    }
 
+    .sep, .time {
+      font-size: 12px;
+      color: #aaa;
+    }
+  }
+}
diff --git a/src/sentry/templatetags/sentry_activity.py b/src/sentry/templatetags/sentry_activity.py
index b75cad39bc..fd919a7863 100644
--- a/src/sentry/templatetags/sentry_activity.py
+++ b/src/sentry/templatetags/sentry_activity.py
@@ -11,7 +11,7 @@ from django.utils.safestring import mark_safe
 
 from sentry.models import Activity
 from sentry.templatetags.sentry_helpers import timesince
-
+from sentry.utils.avatar import get_gravatar_url
 
 register = template.Library()
 
@@ -38,9 +38,12 @@ def render_activity(item):
     output = '<p>'
 
     if item.user:
-        name = item.user.first_name or item.user.email
+        user = item.user
+        name = user.first_name or user.email
+        output += '<span class="avatar"><img src="%s"></span> ' % (get_gravatar_url(user.email, size=20),)
         output += '<strong>%s</strong> %s' % (escape(name), action_str)
     else:
+        output += '<span class="avatar sentry"></span> '
         output += 'The system %s' % (action_str,)
 
     output += ' <span class="sep">&mdash;</span> <span class="time">%s</span></p>' % (timesince(item.datetime),)
diff --git a/src/sentry/templatetags/sentry_helpers.py b/src/sentry/templatetags/sentry_helpers.py
index 4e6b8b6bde..9f1248cce0 100644
--- a/src/sentry/templatetags/sentry_helpers.py
+++ b/src/sentry/templatetags/sentry_helpers.py
@@ -18,15 +18,14 @@ from paging.helpers import paginate as paginate_func
 from sentry.conf import settings
 from sentry.constants import STATUS_MUTED
 from sentry.models import Group
+from sentry.utils.avatar import get_gravatar_url
 from sentry.utils.javascript import to_json
 from sentry.utils.strings import truncatechars
 from templatetag_sugar.register import tag
 from templatetag_sugar.parser import Name, Variable, Constant, Optional
 
 import datetime
-import hashlib
 import logging
-import urllib
 
 register = template.Library()
 
@@ -273,22 +272,10 @@ def get_project_dsn(context, user, project, asvar):
 # The "mm" default is for the grey, "mystery man" icon. See:
 #   http://en.gravatar.com/site/implement/images/
 @tag(register, [Variable('email'),
-                Optional([Constant('size'), Variable('sizevar')]),
-                Optional([Constant('default'), Variable('defaultvar')])])
-def gravatar_url(context, email, sizevar=None, defaultvar='mm'):
-    base = 'https://secure.gravatar.com'
-
-    gravatar_url = "%s/avatar/%s" % (base, hashlib.md5(email.lower()).hexdigest())
-
-    properties = {}
-    if sizevar:
-        properties['s'] = str(sizevar)
-    if defaultvar:
-        properties['d'] = defaultvar
-    if properties:
-        gravatar_url += "?" + urllib.urlencode(properties)
-
-    return gravatar_url
+                Optional([Constant('size'), Variable('size')]),
+                Optional([Constant('default'), Variable('default')])])
+def gravatar_url(context, email, size=None, default='mm'):
+    return get_gravatar_url(email, size, default)
 
 
 @register.filter
diff --git a/src/sentry/utils/avatar.py b/src/sentry/utils/avatar.py
new file mode 100644
index 0000000000..e97d2a6b8e
--- /dev/null
+++ b/src/sentry/utils/avatar.py
@@ -0,0 +1,26 @@
+"""
+sentry.utils.avatar
+~~~~~~~~~~~~~~~~~~~
+
+:copyright: (c) 2010-2012 by the Sentry Team, see AUTHORS for more details.
+:license: BSD, see LICENSE for more details.
+"""
+
+import hashlib
+import urllib
+
+
+def get_gravatar_url(email, size=None, default='mm'):
+    base = 'https://secure.gravatar.com'
+
+    gravatar_url = "%s/avatar/%s" % (base, hashlib.md5(email.lower()).hexdigest())
+
+    properties = {}
+    if size:
+        properties['s'] = str(size)
+    if default:
+        properties['d'] = default
+    if properties:
+        gravatar_url += "?" + urllib.urlencode(properties)
+
+    return gravatar_url
