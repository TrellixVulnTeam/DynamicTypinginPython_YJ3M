commit de82ebefd09bd84518ca6ae172e6b10ee7610955
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Apr 29 13:02:40 2016 -0700

    Fix usage of FileObj and add a file mode

diff --git a/src/sentry/models/file.py b/src/sentry/models/file.py
index 180bcba630..d7d6a1abe2 100644
--- a/src/sentry/models/file.py
+++ b/src/sentry/models/file.py
@@ -150,9 +150,12 @@ class File(Model):
         db_table = 'sentry_file'
 
     def getfile(self, *args, **kwargs):
-        return FileObj(ChunkedFileBlobIndexWrapper(FileBlobIndex.objects.filter(
-            file=self,
-        ).select_related('blob').order_by('offset')), 'rb')
+        return FileObj(ChunkedFileBlobIndexWrapper(
+            FileBlobIndex.objects.filter(
+                file=self,
+            ).select_related('blob').order_by('offset'),
+            mode=kwargs.get('mode'),
+        ), self.name)
 
     def putfile(self, fileobj, blob_size=DEFAULT_BLOB_SIZE, commit=True):
         """
@@ -205,11 +208,12 @@ class FileBlobIndex(Model):
 
 
 class ChunkedFileBlobIndexWrapper(object):
-    def __init__(self, indexes):
+    def __init__(self, indexes, mode=None):
         # eager load from database incase its a queryset
         self._indexes = list(indexes)
         self._curfile = None
         self._curidx = None
+        self.mode = mode
         self.open()
 
     def __enter__(self):
