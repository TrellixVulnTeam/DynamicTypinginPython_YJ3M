commit e86c44efa23432c038078ba25cc21fe88f6cc344
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Sun Oct 11 03:06:48 2015 -0700

    Add some caching into ua_parser
    
    See upstream patch: https://github.com/ua-parser/uap-python/pull/26

diff --git a/src/sentry/utils/ua_parser/parser.py b/src/sentry/utils/ua_parser/parser.py
index 384d2a7682..f84831927a 100644
--- a/src/sentry/utils/ua_parser/parser.py
+++ b/src/sentry/utils/ua_parser/parser.py
@@ -184,6 +184,10 @@ class DeviceParser(object):
         return device, brand, model
 
 
+MAX_CACHE_SIZE = 50
+_parse_cache = {}
+
+
 def Parse(user_agent_string, **jsParseBits):
     """ Parse all the things
     Args:
@@ -193,12 +197,20 @@ def Parse(user_agent_string, **jsParseBits):
       A dictionary containing all parsed bits
     """
     jsParseBits = jsParseBits or {}
-    return {
+    key = (user_agent_string, repr(jsParseBits))
+    cached = _parse_cache.get(key)
+    if cached is not None:
+        return cached
+    if len(_parse_cache) > MAX_CACHE_SIZE:
+        _parse_cache.clear()
+    v = {
         'user_agent': ParseUserAgent(user_agent_string, **jsParseBits),
         'os': ParseOS(user_agent_string, **jsParseBits),
         'device': ParseDevice(user_agent_string, **jsParseBits),
         'string': user_agent_string
     }
+    _parse_cache[key] = v
+    return v
 
 
 def ParseUserAgent(user_agent_string, **jsParseBits):
