commit 2548e9c0e8fd85561a685bbcd2087cbb1827c180
Author: Mark Story <mark@mark-story.com>
Date:   Tue Aug 28 13:59:35 2018 -0700

    feat(releases) Add delete button to release details
    
    Add a delete button to the release details view. Error messages from the
    server will be bubbled up as indicator messages.
    
    Fixes GH-4969

diff --git a/src/sentry/static/sentry/app/sentryTypes.jsx b/src/sentry/static/sentry/app/sentryTypes.jsx
index 218018fa9a..ba608772bc 100644
--- a/src/sentry/static/sentry/app/sentryTypes.jsx
+++ b/src/sentry/static/sentry/app/sentryTypes.jsx
@@ -203,6 +203,14 @@ export const ProjectDetail = PropTypes.shape({
   status: PropTypes.string,
 });
 
+export const Release = PropTypes.shape({
+  version: PropTypes.string.isRequired,
+  ref: PropTypes.string,
+  url: PropTypes.string,
+  dateReleased: PropTypes.string,
+  owner: User,
+});
+
 export const NavigationObject = PropTypes.shape({
   name: PropTypes.string,
   items: PropTypes.arrayOf(
@@ -338,6 +346,7 @@ let SentryTypes = {
   PluginShape,
   PluginsStore,
   ProjectKey,
+  Release,
   User,
 };
 
diff --git a/src/sentry/static/sentry/app/views/releaseDetails.jsx b/src/sentry/static/sentry/app/views/releaseDetails.jsx
index 8e07329371..13d7e6d7a6 100644
--- a/src/sentry/static/sentry/app/views/releaseDetails.jsx
+++ b/src/sentry/static/sentry/app/views/releaseDetails.jsx
@@ -2,11 +2,15 @@ import DocumentTitle from 'react-document-title';
 import PropTypes from 'prop-types';
 import React from 'react';
 import createReactClass from 'create-react-class';
+import {browserHistory} from 'react-router';
 
 import {t} from 'app/locale';
 import ApiMixin from 'app/mixins/apiMixin';
+import Button from 'app/components/button';
+import Confirm from 'app/components/confirm';
 import Count from 'app/components/count';
 import ExternalLink from 'app/components/externalLink';
+import {addErrorMessage, addLoadingMessage} from 'app/actionCreators/indicator';
 import ListLink from 'app/components/listLink';
 import LoadingError from 'app/components/loadingError';
 import LoadingIndicator from 'app/components/loadingIndicator';
@@ -18,6 +22,54 @@ import TimeSince from 'app/components/timeSince';
 import Version from 'app/components/version';
 import withEnvironmentInQueryString from 'app/utils/withEnvironmentInQueryString';
 
+class ReleaseDetailsActions extends React.Component {
+  static propTypes = {
+    api: PropTypes.object.isRequired,
+    orgId: PropTypes.string.isRequired,
+    projectId: PropTypes.string.isRequired,
+    release: SentryTypes.Release,
+  };
+
+  handleDelete = () => {
+    let {orgId, projectId, release, api} = this.props;
+    let version = encodeURIComponent(release.version);
+    let path = `/organizations/${orgId}/releases/${version}/`;
+    let redirectPath = `/${orgId}/${projectId}/releases/`;
+    addLoadingMessage(t('Deleting Release...'));
+
+    api.request(path, {
+      method: 'DELETE',
+      success: () => {
+        browserHistory.push(redirectPath);
+      },
+      error: () => {
+        addErrorMessage(
+          t('This release is referenced by active issues and cannot be removed.')
+        );
+      },
+    });
+  };
+
+  render() {
+    return (
+      <div className="m-b-1">
+        <div className="btn-group">
+          <Confirm
+            onConfirm={this.handleDelete}
+            message={t(
+              'Deleting this release is permanent. Are you sure you wish to continue?'
+            )}
+          >
+            <Button size="small" icon="icon-trash">
+              {t('Delete')}
+            </Button>
+          </Confirm>
+        </div>
+      </div>
+    );
+  }
+}
+
 const ReleaseDetails = createReactClass({
   displayName: 'ReleaseDetails',
 
@@ -99,7 +151,7 @@ const ReleaseDetails = createReactClass({
     let projectId = params.projectId;
     let version = encodeURIComponent(params.version);
 
-    return `/projects/${orgId}/${projectId}/releases/${version}/`
+    return `/projects/${orgId}/${projectId}/releases/${version}/`;
   },
 
   render() {
@@ -108,7 +160,9 @@ const ReleaseDetails = createReactClass({
 
     let release = this.state.release;
     let {orgId, projectId} = this.props.params;
-    let releasePath = `/${orgId}/${projectId}/releases/${encodeURIComponent(release.version)}`
+    let releasePath = `/${orgId}/${projectId}/releases/${encodeURIComponent(
+      release.version
+    )}`;
 
     return (
       <DocumentTitle title={this.getTitle()}>
@@ -175,6 +229,12 @@ const ReleaseDetails = createReactClass({
                 </div>
               </div>
             </div>
+            <ReleaseDetailsActions
+              api={this.api}
+              orgId={orgId}
+              projectId={projectId}
+              release={release}
+            />
             <ul className="nav nav-tabs">
               <ListLink
                 to={`${releasePath}/`}
@@ -186,18 +246,10 @@ const ReleaseDetails = createReactClass({
               >
                 {t('Overview')}
               </ListLink>
-              <ListLink to={`${releasePath}/new-events/`}>
-                {t('New Issues')}
-              </ListLink>
-              <ListLink to={`${releasePath}/all-events/`}>
-                {t('All Issues')}
-              </ListLink>
-              <ListLink to={`${releasePath}/artifacts/`}>
-                {t('Artifacts')}
-              </ListLink>
-              <ListLink to={`${releasePath}/commits/`}>
-                {t('Commits')}
-              </ListLink>
+              <ListLink to={`${releasePath}/new-events/`}>{t('New Issues')}</ListLink>
+              <ListLink to={`${releasePath}/all-events/`}>{t('All Issues')}</ListLink>
+              <ListLink to={`${releasePath}/artifacts/`}>{t('Artifacts')}</ListLink>
+              <ListLink to={`${releasePath}/commits/`}>{t('Commits')}</ListLink>
             </ul>
           </div>
           {React.cloneElement(this.props.children, {
diff --git a/tests/js/spec/views/releaseDetails.spec.jsx b/tests/js/spec/views/releaseDetails.spec.jsx
new file mode 100644
index 0000000000..fd9fc4e266
--- /dev/null
+++ b/tests/js/spec/views/releaseDetails.spec.jsx
@@ -0,0 +1,69 @@
+import React from 'react';
+import {mount} from 'enzyme';
+
+import ReleaseDetails from 'app/views/releaseDetails';
+
+describe('ReleaseDetails', function() {
+  let deleteMock;
+
+  beforeEach(function() {
+    MockApiClient.clearMockResponses();
+    MockApiClient.addMockResponse({
+      url: '/projects/acme/anvils/releases/9.1.1/',
+      body: {
+        version: '9.1.1',
+        ref: 'some-tag',
+        dateCreated: '2018-10-30',
+        dateReleased: '2018-08-30',
+        url: 'http://example.com/api/v1/docs',
+        newGroups: 0,
+        firstEvent: null,
+        lastEvent: null,
+      },
+    });
+
+    deleteMock = MockApiClient.addMockResponse({
+      url: '/organizations/acme/releases/9.1.1/',
+      method: 'DELETE',
+      status: 204,
+    });
+  });
+
+  it('shows release details', function() {
+    let noop = () => {};
+    let params = {
+      orgId: 'acme',
+      projectId: 'anvils',
+      project: {
+        slug: 'anvils',
+      },
+      version: '9.1.1',
+    };
+    let location = {
+      pathname: '/',
+    };
+
+    let wrapper = mount(
+      <ReleaseDetails location={location} params={params} setProjectNavSection={noop}>
+        <div>hi</div>
+      </ReleaseDetails>,
+      TestStubs.routerContext()
+    );
+
+    // Click delete button
+    wrapper
+      .find('button[aria-label="Delete"]')
+      .first()
+      .simulate('click');
+
+    wrapper.update();
+
+    // Click on ok button which is at index 2
+    wrapper
+      .find('Modal Button')
+      .at(1)
+      .simulate('click');
+
+    expect(deleteMock).toHaveBeenCalled();
+  });
+});
