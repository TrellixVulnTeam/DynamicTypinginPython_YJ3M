commit a281beee37f416e687235f857c283f0ee87c6866
Author: Jan Michael Auer <jan.auer@sentry.io>
Date:   Wed Nov 20 09:27:07 2019 +0100

    fix(ui): Handle missing user in Access (#15693)

diff --git a/src/sentry/static/sentry/app/components/acl/access.tsx b/src/sentry/static/sentry/app/components/acl/access.tsx
index 08fdd4c8a7..1e3c410bad 100644
--- a/src/sentry/static/sentry/app/components/acl/access.tsx
+++ b/src/sentry/static/sentry/app/components/acl/access.tsx
@@ -104,7 +104,7 @@ class Access extends React.Component<Props> {
     const method = requireAll ? 'every' : 'some';
 
     const hasAccess = !access || access[method](acc => orgAccess.includes(acc));
-    const hasSuperuser = !!config.user.isSuperuser;
+    const hasSuperuser = !!(config.user && config.user.isSuperuser);
 
     const renderProps: ChildRenderProps = {
       hasAccess,
diff --git a/tests/js/spec/components/acl/access.spec.jsx b/tests/js/spec/components/acl/access.spec.jsx
index 495493602c..503f517e22 100644
--- a/tests/js/spec/components/acl/access.spec.jsx
+++ b/tests/js/spec/components/acl/access.spec.jsx
@@ -95,6 +95,20 @@ describe('Access', function() {
       });
     });
 
+    it('handles no user', function() {
+      // Regression test for the share sheet.
+      ConfigStore.config = {
+        user: null,
+      };
+
+      mount(<Access>{childrenMock}</Access>, routerContext);
+
+      expect(childrenMock).toHaveBeenCalledWith({
+        hasAccess: true,
+        hasSuperuser: false,
+      });
+    });
+
     it('is superuser', function() {
       ConfigStore.config = {
         user: {isSuperuser: true},
