commit 2e1992887d10a77457c625ee6f314d0895dce090
Author: Jan Michael Auer <account@jauer.org>
Date:   Thu Dec 20 13:03:27 2018 +0100

    fix(event_manager): Handle invalid timestamp values gracefully (#11117)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index b17495a0ac..df6d84c030 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -191,7 +191,7 @@ def process_timestamp(value, meta, current_datetime=None):
         except Exception:
             meta.add_error(EventError.INVALID_DATA, original_value)
             return None
-    elif not isinstance(value, datetime):
+    elif isinstance(value, six.string_types):
         # all timestamps are in UTC, but the marker is optional
         if value.endswith('Z'):
             value = value[:-1]
@@ -208,6 +208,9 @@ def process_timestamp(value, meta, current_datetime=None):
         except Exception:
             meta.add_error(EventError.INVALID_DATA, original_value)
             return None
+    elif not isinstance(value, datetime):
+        meta.add_error(EventError.INVALID_DATA, original_value)
+        return None
 
     if current_datetime is None:
         current_datetime = datetime.now()
diff --git a/tests/sentry/event_manager/test_process_timestamp.py b/tests/sentry/event_manager/test_process_timestamp.py
index efb7a86e66..01e2e4d6de 100644
--- a/tests/sentry/event_manager/test_process_timestamp.py
+++ b/tests/sentry/event_manager/test_process_timestamp.py
@@ -50,3 +50,6 @@ class ProcessTimestampTest(TestCase):
             self.meta,
             current_datetime=datetime(2012, 1, 1, 10, 30, 45),
         ) == 1325413845.0
+
+    def test_invalid_type(self):
+        assert process_timestamp({}, self.meta) is None
