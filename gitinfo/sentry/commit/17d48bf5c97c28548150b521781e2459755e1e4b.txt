commit 17d48bf5c97c28548150b521781e2459755e1e4b
Author: Dena Mwangi <dena@getsentry.com>
Date:   Tue Jan 22 15:49:55 2019 -0800

    fix(banner): Swap out check using onboardingTask with checking projects array (#11517)

diff --git a/src/sentry/static/sentry/app/components/installPromptBanner.jsx b/src/sentry/static/sentry/app/components/installPromptBanner.jsx
index 5522ee26b2..53e094d3d0 100644
--- a/src/sentry/static/sentry/app/components/installPromptBanner.jsx
+++ b/src/sentry/static/sentry/app/components/installPromptBanner.jsx
@@ -20,14 +20,13 @@ const InstallPromptBanner = createReactClass({
 
   getInitialState() {
     return {
-      sentFirstEvent: false,
+      sentFirstEvent: this.sentFirstEvent(),
     };
   },
 
   componentDidMount() {
     let {href} = window.location;
     let {organization} = this.props;
-    this.sentFirstEvent();
     analytics('install_prompt.banner_viewed', {
       org_id: parseInt(organization.id, 10),
       page: href,
@@ -41,11 +40,8 @@ const InstallPromptBanner = createReactClass({
   },
 
   sentFirstEvent() {
-    let {onboardingTasks} = this.props.organization;
-    let firstEventTask = onboardingTasks.find(task => task.task === 2);
-    this.setState({
-      sentFirstEvent: firstEventTask && firstEventTask.status === 'complete',
-    });
+    let {projects} = this.props.organization;
+    return !!projects.find(project => project.firstEvent);
   },
 
   getUrl() {
diff --git a/tests/acceptance/test_project_overview.py b/tests/acceptance/test_project_overview.py
index 84da0bd637..3317a9cf82 100644
--- a/tests/acceptance/test_project_overview.py
+++ b/tests/acceptance/test_project_overview.py
@@ -3,7 +3,6 @@ from __future__ import absolute_import
 from django.utils import timezone
 
 from sentry.testutils import AcceptanceTestCase
-from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectOverviewTest(AcceptanceTestCase):
@@ -29,11 +28,6 @@ class ProjectOverviewTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
-        OrganizationOnboardingTask.objects.create_or_update(
-            organization_id=self.project.organization_id,
-            task=OnboardingTask.FIRST_EVENT,
-            status=OnboardingTaskStatus.COMPLETE,
-        )
         self.browser.get(self.path)
         self.browser.wait_until('.chart-wrapper')
         self.browser.wait_until_not('.loading')
diff --git a/tests/acceptance/test_project_releases.py b/tests/acceptance/test_project_releases.py
index bba643b7f5..c0dde191be 100644
--- a/tests/acceptance/test_project_releases.py
+++ b/tests/acceptance/test_project_releases.py
@@ -1,7 +1,8 @@
 from __future__ import absolute_import
 
+from django.utils import timezone
+
 from sentry.testutils import AcceptanceTestCase
-from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectReleasesTest(AcceptanceTestCase):
@@ -31,11 +32,7 @@ class ProjectReleasesTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
-        OrganizationOnboardingTask.objects.create_or_update(
-            organization_id=self.project.organization_id,
-            task=OnboardingTask.FIRST_EVENT,
-            status=OnboardingTaskStatus.COMPLETE,
-        )
+        self.project.update(first_event=timezone.now())
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading')
         self.browser.wait_until('.ref-project-releases')
@@ -60,6 +57,7 @@ class ProjectReleaseDetailsTest(AcceptanceTestCase):
             organization=self.org,
             teams=[self.team],
             name='Bengal',
+            first_event=timezone.now(),
         )
         self.release = self.create_release(
             project=self.project,
@@ -70,11 +68,6 @@ class ProjectReleaseDetailsTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
-        OrganizationOnboardingTask.objects.create_or_update(
-            organization_id=self.project.organization_id,
-            task=OnboardingTask.FIRST_EVENT,
-            status=OnboardingTaskStatus.COMPLETE,
-        )
         self.login_as(self.user)
         self.path = u'/{}/{}/releases/{}/'.format(
             self.org.slug, self.project.slug, self.release.version)
diff --git a/tests/acceptance/test_project_user_feedback.py b/tests/acceptance/test_project_user_feedback.py
index 9c9e265534..5ab29aee89 100644
--- a/tests/acceptance/test_project_user_feedback.py
+++ b/tests/acceptance/test_project_user_feedback.py
@@ -3,7 +3,6 @@ from __future__ import absolute_import
 from django.utils import timezone
 
 from sentry.testutils import AcceptanceTestCase
-from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectUserFeedbackTest(AcceptanceTestCase):
@@ -29,11 +28,6 @@ class ProjectUserFeedbackTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
-        OrganizationOnboardingTask.objects.create_or_update(
-            organization_id=self.project.organization_id,
-            task=OnboardingTask.FIRST_EVENT,
-            status=OnboardingTaskStatus.COMPLETE,
-        )
         self.create_userreport(group=self.group, project=self.project, event=self.event)
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading')
diff --git a/tests/js/spec/components/installPromptBanner.spec.jsx b/tests/js/spec/components/installPromptBanner.spec.jsx
new file mode 100644
index 0000000000..d4f8040755
--- /dev/null
+++ b/tests/js/spec/components/installPromptBanner.spec.jsx
@@ -0,0 +1,28 @@
+import React from 'react';
+import {shallow} from 'enzyme';
+import InstallPromptBanner from 'app/components/installPromptBanner';
+
+describe('InstallPromptBanner', function() {
+  it('renders', function() {
+    let project1 = TestStubs.Project();
+    let project2 = TestStubs.Project({firstEvent: null});
+    let organization = TestStubs.Organization({projects: [project1, project2]});
+    let wrapper = shallow(
+      <InstallPromptBanner organization={organization} />,
+      TestStubs.routerContext()
+    );
+    expect(wrapper.find('StyledAlert').exists()).toBe(true);
+    expect(wrapper.find('a').text()).toContain('Start capturing errors');
+  });
+
+  it('does not render if first event sent', function() {
+    let project1 = TestStubs.Project();
+    let project2 = TestStubs.Project({firstEvent: '2018-03-18'});
+    let organization = TestStubs.Organization({projects: [project1, project2]});
+    let wrapper = shallow(
+      <InstallPromptBanner organization={organization} />,
+      TestStubs.routerContext()
+    );
+    expect(wrapper.find('StyledAlert').exists()).toBe(false);
+  });
+});
