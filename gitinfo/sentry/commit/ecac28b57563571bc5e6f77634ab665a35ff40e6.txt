commit ecac28b57563571bc5e6f77634ab665a35ff40e6
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Mon Apr 9 15:17:56 2018 -0700

    ref: Remove tooltip mixin (#7974)

diff --git a/src/sentry/static/sentry/app/components/group/seenInfo.jsx b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
index b8f9736138..7b38d1ebef 100644
--- a/src/sentry/static/sentry/app/components/group/seenInfo.jsx
+++ b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
@@ -5,7 +5,7 @@ import DateTime from '../../components/dateTime';
 import TimeSince from '../../components/timeSince';
 import Version from '../../components/version';
 import VersionHoverCard from '../../components/versionHoverCard';
-import TooltipMixin from '../../mixins/tooltip';
+import Tooltip from '../../components/tooltip';
 import {defined, toTitleCase} from '../../utils';
 import componentToString from '../../utils/componentToString';
 import {t} from '../../locale';
@@ -23,45 +23,13 @@ const SeenInfo = createReactClass({
     }),
     environment: PropTypes.string,
     hasRelease: PropTypes.bool.isRequired,
+    title: PropTypes.string.isRequired,
   },
 
   contextTypes: {
     organization: PropTypes.object,
   },
 
-  mixins: [
-    TooltipMixin(function() {
-      let instance = this;
-
-      return {
-        html: true,
-        selector: '.tip',
-        title: function() {
-          let {date, dateGlobal, environment, title} = instance.props;
-          return componentToString(
-            <div style={{width: 170}}>
-              <div className="time-label">{title}</div>
-              <dl className="flat">
-                {environment && [
-                  <dt key="0">{toTitleCase(environment)}</dt>,
-                  <dd key="0.1">
-                    <TimeSince date={date} />
-                    <br />
-                  </dd>,
-                ]}
-                <dt key="1">{t('Globally:')}</dt>
-                <dd key="1.1">
-                  <TimeSince date={dateGlobal} />
-                  <br />
-                </dd>
-              </dl>
-            </div>
-          );
-        },
-      };
-    }),
-  ],
-
   shouldComponentUpdate(nextProps, nextState) {
     return (
       (this.props.release || {}).version !== (nextProps.release || {}).version ||
@@ -75,6 +43,30 @@ const SeenInfo = createReactClass({
     return `/${orgId}/${projectId}/settings/release-tracking/`;
   },
 
+  getTooltipTitle() {
+    let {date, dateGlobal, environment, title} = this.props;
+
+    return componentToString(
+      <div style={{width: 170}}>
+        <div className="time-label">{title}</div>
+        <dl className="flat">
+          {environment && [
+            <dt key="0">{toTitleCase(environment)}</dt>,
+            <dd key="0.1">
+              <TimeSince date={date} />
+              <br />
+            </dd>,
+          ]}
+          <dt key="1">{t('Globally:')}</dt>
+          <dd key="1.1">
+            <TimeSince date={dateGlobal} />
+            <br />
+          </dd>
+        </dl>
+      </div>
+    );
+  },
+
   render() {
     let {date, dateGlobal, environment, release, orgId, projectId} = this.props;
     return (
@@ -82,9 +74,11 @@ const SeenInfo = createReactClass({
         <dt key={0}>{t('When')}:</dt>
         {date ? (
           <dd key={1}>
-            <span className="tip">
-              <TimeSince date={date} />
-            </span>
+            <Tooltip title={this.getTooltipTitle} tooltipOptions={{html: true}}>
+              <span>
+                <TimeSince date={date} />
+              </span>
+            </Tooltip>
             <br />
             <small>
               <DateTime date={date} seconds={true} />
@@ -92,9 +86,11 @@ const SeenInfo = createReactClass({
           </dd>
         ) : dateGlobal && environment === '' ? (
           <dd key={1}>
-            <span className="tip">
-              <TimeSince date={dateGlobal} />
-            </span>
+            <Tooltip title={this.getTooltipTitle()} tooltipOptions={{html: true}}>
+              <span>
+                <TimeSince date={dateGlobal} />
+              </span>
+            </Tooltip>
             <br />
             <small>
               <DateTime date={dateGlobal} seconds={true} />
diff --git a/src/sentry/static/sentry/app/components/stackedBarChart.jsx b/src/sentry/static/sentry/app/components/stackedBarChart.jsx
index ff15bcd6b4..cd4d4dc17a 100644
--- a/src/sentry/static/sentry/app/components/stackedBarChart.jsx
+++ b/src/sentry/static/sentry/app/components/stackedBarChart.jsx
@@ -4,7 +4,7 @@ import PropTypes from 'prop-types';
 import moment from 'moment';
 import _ from 'lodash';
 
-import TooltipMixin from '../mixins/tooltip';
+import Tooltip from '../components/tooltip';
 import Count from './count';
 import ConfigStore from '../stores/configStore';
 
@@ -33,7 +33,6 @@ const StackedBarChart = createReactClass({
     ),
     height: PropTypes.number,
     width: PropTypes.number,
-    placement: PropTypes.string,
     label: PropTypes.string,
     markers: PropTypes.arrayOf(
       PropTypes.shape({
@@ -45,33 +44,6 @@ const StackedBarChart = createReactClass({
     barClasses: PropTypes.array,
   },
 
-  mixins: [
-    TooltipMixin(function() {
-      let chart = this;
-
-      return {
-        html: true,
-        placement: this.props.placement,
-        selector: '.tip',
-        viewport: this.props.viewport,
-
-        // This callback is fired when the user hovers over the
-        // barchart / triggers tooltip rendering. This is better
-        // than using data-title, which renders up-front for each
-        // StackedBarChart (slow).
-        title: function(instance) {
-          // `this` is the targeted element
-          let pointIdx = this.getAttribute('data-point-index');
-          let tooltipFunc = chart.props.tooltip || chart.renderTooltip;
-
-          if (pointIdx)
-            return tooltipFunc(chart.state.pointIndex[pointIdx], pointIdx, chart);
-          else return this.getAttribute('data-title');
-        },
-      };
-    }),
-  ],
-
   statics: {
     getInterval(series) {
       // TODO(dcramer): not guaranteed correct
@@ -112,13 +84,11 @@ const StackedBarChart = createReactClass({
       className: 'sparkline',
       height: null,
       label: '',
-      placement: 'bottom',
       points: [],
       series: [],
       markers: [],
       width: null,
       barClasses: ['chart-bar'],
-      tooltip: this.renderTooltip,
     };
   },
 
@@ -242,15 +212,17 @@ const StackedBarChart = createReactClass({
     let timeLabel = moment(marker.x * 1000).format('lll');
     let title =
       '<div style="width:130px">' + marker.label + '<br/>' + timeLabel + '</div>';
-    let className = 'chart-marker tip ' + (marker.className || '');
+    let className = 'chart-marker ' + (marker.className || '');
 
     // example key: m-last-seen-22811123, m-first-seen-228191
     let key = ['m', marker.className, marker.x].join('-');
 
     return (
-      <a key={key} className={className} style={{height: '100%'}} data-title={title}>
-        <span>{marker.label}</span>
-      </a>
+      <Tooltip title={title} key={key} tooltipOptions={{html: true, placement: 'bottom'}}>
+        <a className={className} style={{height: '100%'}}>
+          <span>{marker.label}</span>
+        </a>
+      </Tooltip>
     );
   },
 
@@ -297,15 +269,20 @@ const StackedBarChart = createReactClass({
       prevPct += pct;
       return pt;
     });
+
+    let pointIdx = point.x;
+    let tooltipFunc = this.props.tooltip || this.renderTooltip;
+
     return (
-      <a
+      <Tooltip
+        title={() => tooltipFunc(this.state.pointIndex[pointIdx], pointIdx, this)}
         key={point.x}
-        className="chart-column tip"
-        data-point-index={point.x}
-        style={{width: pointWidth, height: '100%'}}
+        tooltipOptions={{html: true, placement: 'bottom'}}
       >
-        {pts}
-      </a>
+        <a className="chart-column" style={{width: pointWidth, height: '100%'}}>
+          {pts}
+        </a>
+      </Tooltip>
     );
   },
 
diff --git a/src/sentry/static/sentry/app/components/tooltip.jsx b/src/sentry/static/sentry/app/components/tooltip.jsx
index fa6515a1d5..fefb7d4acb 100644
--- a/src/sentry/static/sentry/app/components/tooltip.jsx
+++ b/src/sentry/static/sentry/app/components/tooltip.jsx
@@ -11,7 +11,7 @@ class Tooltip extends React.Component {
     children: PropTypes.node.isRequired,
     disabled: PropTypes.bool,
     tooltipOptions: PropTypes.object,
-    title: PropTypes.node,
+    title: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),
   };
 
   componentWillReceiveProps(newProps) {
diff --git a/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap b/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap
index 69724fff10..be1a9a213b 100644
--- a/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap
+++ b/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap
@@ -195,7 +195,6 @@ exports[`GroupReleaseStats renders 1`] = `
               height={40}
               label="events"
               markers={Array []}
-              placement="bottom"
               points={
                 Array [
                   Object {
@@ -246,108 +245,128 @@ exports[`GroupReleaseStats renders 1`] = `
                   0
                 </span>
                 <span>
-                  <a
-                    className="chart-column tip"
-                    data-point-index={1517281200}
+                  <Tooltip
                     key="1517281200"
-                    style={
+                    title={[Function]}
+                    tooltipOptions={
                       Object {
-                        "height": "100%",
-                        "width": "50%",
+                        "html": true,
+                        "placement": "bottom",
                       }
                     }
                   >
-                    <span
-                      className="release"
-                      key="0"
+                    <a
+                      className="tip chart-column"
                       style={
                         Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "0%",
+                          "height": "100%",
+                          "width": "50%",
                         }
                       }
+                      title={[Function]}
                     >
-                      0
-                    </span>
-                    <span
-                      className="environment"
-                      key="1"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "19.8%",
+                      <span
+                        className="release"
+                        key="0"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "0%",
+                          }
                         }
-                      }
-                    >
-                      2
-                    </span>
-                    <span
-                      className="inactive"
-                      key="2"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "19.8%",
-                          "height": "0%",
+                      >
+                        0
+                      </span>
+                      <span
+                        className="environment"
+                        key="1"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "19.8%",
+                          }
                         }
-                      }
-                    >
-                      0
-                    </span>
-                  </a>
-                  <a
-                    className="chart-column tip"
-                    data-point-index={1517310000}
+                      >
+                        2
+                      </span>
+                      <span
+                        className="inactive"
+                        key="2"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "19.8%",
+                            "height": "0%",
+                          }
+                        }
+                      >
+                        0
+                      </span>
+                    </a>
+                  </Tooltip>
+                  <Tooltip
                     key="1517310000"
-                    style={
+                    title={[Function]}
+                    tooltipOptions={
                       Object {
-                        "height": "100%",
-                        "width": "50%",
+                        "html": true,
+                        "placement": "bottom",
                       }
                     }
                   >
-                    <span
-                      className="release"
-                      key="0"
+                    <a
+                      className="tip chart-column"
                       style={
                         Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "0%",
+                          "height": "100%",
+                          "width": "50%",
                         }
                       }
+                      title={[Function]}
                     >
-                      0
-                    </span>
-                    <span
-                      className="environment"
-                      key="1"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "9.9%",
+                      <span
+                        className="release"
+                        key="0"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "0%",
+                          }
                         }
-                      }
-                    >
-                      1
-                    </span>
-                    <span
-                      className="inactive"
-                      key="2"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "9.9%",
-                          "height": "0%",
+                      >
+                        0
+                      </span>
+                      <span
+                        className="environment"
+                        key="1"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "9.9%",
+                          }
                         }
-                      }
-                    >
-                      0
-                    </span>
-                  </a>
+                      >
+                        1
+                      </span>
+                      <span
+                        className="inactive"
+                        key="2"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "9.9%",
+                            "height": "0%",
+                          }
+                        }
+                      >
+                        0
+                      </span>
+                    </a>
+                  </Tooltip>
                 </span>
               </figure>
             </StackedBarChart>
@@ -438,7 +457,6 @@ exports[`GroupReleaseStats renders 1`] = `
               height={40}
               label="events"
               markers={Array []}
-              placement="bottom"
               points={
                 Array [
                   Object {
@@ -489,108 +507,128 @@ exports[`GroupReleaseStats renders 1`] = `
                   0
                 </span>
                 <span>
-                  <a
-                    className="chart-column tip"
-                    data-point-index={1514764800}
+                  <Tooltip
                     key="1514764800"
-                    style={
+                    title={[Function]}
+                    tooltipOptions={
                       Object {
-                        "height": "100%",
-                        "width": "50%",
+                        "html": true,
+                        "placement": "bottom",
                       }
                     }
                   >
-                    <span
-                      className="release"
-                      key="0"
+                    <a
+                      className="tip chart-column"
                       style={
                         Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "0%",
+                          "height": "100%",
+                          "width": "50%",
                         }
                       }
+                      title={[Function]}
                     >
-                      0
-                    </span>
-                    <span
-                      className="environment"
-                      key="1"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "0.81%",
+                      <span
+                        className="release"
+                        key="0"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "0%",
+                          }
                         }
-                      }
-                    >
-                      1
-                    </span>
-                    <span
-                      className="inactive"
-                      key="2"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "0.81%",
-                          "height": "0%",
+                      >
+                        0
+                      </span>
+                      <span
+                        className="environment"
+                        key="1"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "0.81%",
+                          }
                         }
-                      }
-                    >
-                      0
-                    </span>
-                  </a>
-                  <a
-                    className="chart-column tip"
-                    data-point-index={1515024000}
+                      >
+                        1
+                      </span>
+                      <span
+                        className="inactive"
+                        key="2"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0.81%",
+                            "height": "0%",
+                          }
+                        }
+                      >
+                        0
+                      </span>
+                    </a>
+                  </Tooltip>
+                  <Tooltip
                     key="1515024000"
-                    style={
+                    title={[Function]}
+                    tooltipOptions={
                       Object {
-                        "height": "100%",
-                        "width": "50%",
+                        "html": true,
+                        "placement": "bottom",
                       }
                     }
                   >
-                    <span
-                      className="release"
-                      key="0"
+                    <a
+                      className="tip chart-column"
                       style={
                         Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "0%",
+                          "height": "100%",
+                          "width": "50%",
                         }
                       }
+                      title={[Function]}
                     >
-                      0
-                    </span>
-                    <span
-                      className="environment"
-                      key="1"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "0%",
-                          "height": "99%",
+                      <span
+                        className="release"
+                        key="0"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "0%",
+                          }
                         }
-                      }
-                    >
-                      122
-                    </span>
-                    <span
-                      className="inactive"
-                      key="2"
-                      style={
-                        Object {
-                          "backgroundColor": null,
-                          "bottom": "99%",
-                          "height": "0%",
+                      >
+                        0
+                      </span>
+                      <span
+                        className="environment"
+                        key="1"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "0%",
+                            "height": "99%",
+                          }
                         }
-                      }
-                    >
-                      0
-                    </span>
-                  </a>
+                      >
+                        122
+                      </span>
+                      <span
+                        className="inactive"
+                        key="2"
+                        style={
+                          Object {
+                            "backgroundColor": null,
+                            "bottom": "99%",
+                            "height": "0%",
+                          }
+                        }
+                      >
+                        0
+                      </span>
+                    </a>
+                  </Tooltip>
                 </span>
               </figure>
             </StackedBarChart>
