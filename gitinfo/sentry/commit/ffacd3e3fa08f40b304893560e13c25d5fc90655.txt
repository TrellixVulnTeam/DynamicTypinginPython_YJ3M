commit ffacd3e3fa08f40b304893560e13c25d5fc90655
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 27 16:21:27 2016 -0700

    Basic test with PS4 agent

diff --git a/tests/sentry/lang/javascript/test_plugin.py b/tests/sentry/lang/javascript/test_plugin.py
index 79ea645252..5cd3a3755b 100644
--- a/tests/sentry/lang/javascript/test_plugin.py
+++ b/tests/sentry/lang/javascript/test_plugin.py
@@ -42,7 +42,7 @@ class JavascriptIntegrationTest(TestCase):
             'name': 'Windows 8',
             'type': 'os',
         }
-        assert contexts['browser'] == {
+        assert contexts.get('browser') == {
             'name': 'Chrome',
             'type': 'browser',
             'version': '28.0.1500',
@@ -71,7 +71,7 @@ class JavascriptIntegrationTest(TestCase):
             'type': 'os',
             'version': '4.3',
         }
-        assert contexts['browser'] == {
+        assert contexts.get('browser') == {
             'name': 'Android',
             'type': 'browser',
             'version': '4.3',
@@ -83,6 +83,32 @@ class JavascriptIntegrationTest(TestCase):
             'brand': 'Samsung',
         }
 
+    def test_adds_contexts_with_ps4_device(self):
+        data = {
+            'message': 'hello',
+            'platform': 'javascript',
+            'sentry.interfaces.Http': {
+                'url': 'http://example.com',
+                'headers': [
+                    ['User-Agent', 'Mozilla/5.0 (PlayStation 4 3.55) AppleWebKit/537.78 (KHTML, like Gecko)'],
+                ],
+            }
+        }
+
+        resp = self._postWithHeader(data)
+        assert resp.status_code, 200
+
+        event = Event.objects.get()
+        contexts = event.interfaces['contexts'].to_json()
+        assert contexts.get('os') is None
+        assert contexts.get('browser') is None
+        assert contexts.get('device') == {
+            'family': 'PlayStation 4',
+            'type': 'device',
+            'model': 'PlayStation 4',
+            'brand': 'Sony',
+        }
+
     @patch('sentry.lang.javascript.processor.fetch_file')
     def test_source_expansion(self, mock_fetch_file):
         data = {
