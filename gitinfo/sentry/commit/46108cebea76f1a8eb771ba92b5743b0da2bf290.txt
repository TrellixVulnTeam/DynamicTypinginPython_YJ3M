commit 46108cebea76f1a8eb771ba92b5743b0da2bf290
Author: Ted Kaemming <ted@kaemming.com>
Date:   Fri Mar 18 12:10:43 2016 -0700

    Improve `check_notifications` management command.
    
    Uses `get_email_addresses` instead of `MessageBuilder._send_to`.

diff --git a/src/sentry/management/commands/check_notifications.py b/src/sentry/management/commands/check_notifications.py
index e62e339435..d916468729 100644
--- a/src/sentry/management/commands/check_notifications.py
+++ b/src/sentry/management/commands/check_notifications.py
@@ -7,9 +7,12 @@ sentry.management.commands.check_notifications
 """
 from __future__ import absolute_import, print_function
 
-from django.core.management.base import BaseCommand, CommandError
 from optparse import make_option
 
+from django.core.management.base import BaseCommand, CommandError
+
+from sentry.models import User
+
 
 def find_mail_plugin():
     from sentry.plugins import plugins
@@ -21,11 +24,11 @@ def find_mail_plugin():
 
 def handle_project(plugin, project, stream):
     stream.write('# Project: %s\n' % project)
-    from sentry.utils.email import MessageBuilder
-    msg = MessageBuilder('test')
-    msg.add_users(plugin.get_sendable_users(project), project)
-    for email in msg._send_to:
-        stream.write(email + '\n')
+    from sentry.utils.email import get_email_addresses
+    user_ids = plugin.get_sendable_users(project)
+    users = User.objects.in_bulk(user_ids)
+    for user_id, email in get_email_addresses(user_ids, project).items():
+        stream.write('{}: {}\n'.format(users[user_id].username, email))
 
 
 class Command(BaseCommand):
