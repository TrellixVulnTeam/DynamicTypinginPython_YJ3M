commit e5914eab5f3ba1a180154f3b61d0be21035732c4
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Aug 31 09:50:23 2017 -0700

    feat(ci): Enable Zeus

diff --git a/.travis.yml b/.travis.yml
index d2623b125d..0782d6e4ba 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -27,6 +27,8 @@ env:
     - SENTRY_SKIP_BACKEND_VALIDATION=1
     - TRAVIS_NODE_VERSION=4
     - CXX=g++-4.8
+before_install:
+  - bin/update-zeus-job in_progress unknown || echo "failed to report build to Zeus; continuing"
 install:
   - nvm install $TRAVIS_NODE_VERSION
   - npm install -g yarn@0.27.5
@@ -38,8 +40,14 @@ script:
   - make travis-test-$TEST_SUITE
 after_success:
   - codecov -e TEST_SUITE
+  - bin/upload-zeus-artifact junit.xml
+  - bin/upload-zeus-artifact coverage.xml
+  - bin/update-zeus-job finished passed
 after_failure:
   - dmesg | tail -n 100
+  - bin/upload-zeus-artifact junit.xml
+  - bin/upload-zeus-artifact coverage.xml
+  - bin/update-zeus-job finished failed
 # each attribute in the matrix will override the global attribute
 matrix:
   fast_finish: true
diff --git a/Makefile b/Makefile
index 44dd01dbe4..660ffdb0a9 100644
--- a/Makefile
+++ b/Makefile
@@ -133,7 +133,7 @@ test-js:
 
 test-python: build-platform-assets
 	@echo "--> Running Python tests"
-	py.test tests/integration tests/sentry || exit 1
+	py.test tests/integration tests/sentry --cov . --cov-report="xml:coverage.xml" --junit-xml="junit.xml" || exit 1
 	@echo ""
 
 test-network:
@@ -141,14 +141,14 @@ test-network:
 	sentry init
 	@echo "from sentry.utils.integrationdocs import sync_docs; sync_docs()" | sentry exec
 	@echo "--> Running network tests"
-	py.test tests/network
+	py.test tests/network --cov . --cov-report="xml:coverage.xml" --junit-xml="junit.xml"
 	@echo ""
 
 test-acceptance: build-platform-assets
 	@echo "--> Building static assets"
 	@${NPM_ROOT}/.bin/webpack
 	@echo "--> Running acceptance tests"
-	py.test tests/acceptance
+	py.test tests/acceptance --cov . --cov-report="xml:coverage.xml" --junit-xml="junit.xml" --html="pytest.html"
 	@echo ""
 
 test-python-coverage: build-platform-assets
diff --git a/bin/update-zeus-job b/bin/update-zeus-job
new file mode 100755
index 0000000000..e538110b9f
--- /dev/null
+++ b/bin/update-zeus-job
@@ -0,0 +1,12 @@
+#!/bin/bash -eu
+
+# TODO(dcramer): pass URL
+curl $ZEUS_HOOK_BASE/builds/$TRAVIS_BUILD_NUMBER \
+    -X POST \
+    -H 'Content-Type: application/json' \
+    -d "{\"label\": \"$TRAVIS_BUILD_NUMBER\", \"ref\": \"$TRAVIS_COMMIT\", \"url\": \"https://travis-ci.org/getsentry/sentry/builds/${TRAVIS_BUILD_ID}\"}"
+
+curl $ZEUS_HOOK_BASE/builds/$TRAVIS_BUILD_NUMBER/jobs/$TRAVIS_JOB_NUMBER \
+    -X POST \
+    -H 'Content-Type: application/json' \
+    -d "{\"label\": \"$TRAVIS_JOB_NUMBER\", \"status\": \"$1\", \"result\": \"$2\", \"url\": \"https://travis-ci.org/getsentry/sentry/jobs/${TRAVIS_JOB_ID}\"}"
diff --git a/bin/upload-zeus-artifact b/bin/upload-zeus-artifact
new file mode 100755
index 0000000000..2d7331f943
--- /dev/null
+++ b/bin/upload-zeus-artifact
@@ -0,0 +1,9 @@
+#!/bin/bash -eu
+
+if [[ -e $1 ]]; then
+    curl $ZEUS_HOOK_BASE/builds/$TRAVIS_BUILD_NUMBER/jobs/$TRAVIS_JOB_NUMBER/artifacts \
+        -X POST \
+        -F "file=@$1"
+else
+    (>&2 echo "[WARN] File not found: $1")
+fi
diff --git a/setup.py b/setup.py
index 225fff1267..c570263a1b 100755
--- a/setup.py
+++ b/setup.py
@@ -80,10 +80,9 @@ tests_require = [
     # /cassandra
     'datadog',
     'msgpack-python<0.5.0',
-    'pytest-cov>=1.8.0,<1.9.0',
+    'pytest-cov>=2.5.1,<2.6.0',
     'pytest-timeout>=0.5.0,<0.6.0',
-    'pytest-xdist>=1.11.0,<1.12.0',
-    'python-coveralls',
+    'pytest-xdist>=1.18.0,<1.19.0',
     'responses<0.6.2',  # 0.6.2 has a bug that causes our tests to fail.
 ]
 
@@ -121,7 +120,7 @@ install_requires = [
     'Pillow>=3.2.0,<3.3.0',
     'progressbar2>=3.10,<3.11',
     'psycopg2>=2.6.0,<2.7.0',
-    'pytest>=2.8.0,<2.9.0',
+    'pytest>=3.1.2,<3.2.0',
     'pytest-django>=2.9.1,<2.10.0',
     'pytest-html>=1.9.0,<1.10.0',
     'python-dateutil>=2.0.0,<3.0.0',
