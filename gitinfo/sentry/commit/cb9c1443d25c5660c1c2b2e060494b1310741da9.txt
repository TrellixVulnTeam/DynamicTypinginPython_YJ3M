commit cb9c1443d25c5660c1c2b2e060494b1310741da9
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Dec 1 19:50:07 2015 -0800

    Fix up `create_first_user`

diff --git a/src/sentry/management/commands/createsuperuser.py b/src/sentry/management/commands/createsuperuser.py
index 2eefcaafbb..65c999184a 100644
--- a/src/sentry/management/commands/createsuperuser.py
+++ b/src/sentry/management/commands/createsuperuser.py
@@ -1,6 +1,5 @@
 from __future__ import absolute_import, print_function
 
-from django.core.management import call_command
 from django.contrib.auth.management.commands.createsuperuser import Command
 
 
@@ -8,8 +7,5 @@ class Command(Command):
     help = 'Performs any pending database migrations and upgrades'
 
     def handle(self, **options):
-        call_command(
-            'createuser',
-            is_superuser=True,
-            **options
-        )
+        from sentry.runner.commands.createuser import createuser
+        createuser.main(args=['--interactive'], obj={})
diff --git a/src/sentry/receivers/users.py b/src/sentry/receivers/users.py
index e818deabdd..5c271c8b83 100644
--- a/src/sentry/receivers/users.py
+++ b/src/sentry/receivers/users.py
@@ -1,8 +1,6 @@
 from __future__ import absolute_import, print_function
 
-from django.core.management import call_command
 from django.db.models.signals import post_syncdb
-from django.utils.six.moves import input
 
 from sentry.models import User
 
@@ -12,15 +10,25 @@ def create_first_user(app, created_models, verbosity, db, **kwargs):
         return
     if not kwargs.get('interactive', True):
         return
-    msg = ("Would you like to create a user account now? (yes/no): ")
-    confirm = input(msg)
-    while 1:
-        if confirm not in ('yes', 'no'):
-            confirm = input('Please enter either "yes" or "no": ')
-            continue
-        if confirm == 'yes':
-            call_command("createuser", interactive=True, database=db)
-        break
+
+    import click
+    import time
+    if not click.confirm('\nWould you like to create a user account now?', default=True):
+        # Not using `abort=1` because we don't want to exit out from further execution
+        click.echo('\nRun `sentry createuser` to do this later.\n')
+        time.sleep(2)
+        return
+
+    from sentry.runner.commands.createuser import createuser
+    try:
+        createuser.main(args=[], obj={})
+        click.echo()
+    except SystemExit as e:
+        # click normally wants to exit the process, but we want to just continue execution
+        if e.code == 0:
+            return
+        click.echo('\nRun `sentry createuser` to do this later.\n')
+        time.sleep(2)
 
 
 post_syncdb.connect(
diff --git a/src/sentry/runner/settings.py b/src/sentry/runner/settings.py
index 206f3c44c7..a3da669c97 100644
--- a/src/sentry/runner/settings.py
+++ b/src/sentry/runner/settings.py
@@ -249,7 +249,7 @@ def discover_configs(ctx=None):
      * Optional python config file (~/.sentry/sentry.conf.py)
      * Optional yaml config (~/.sentry/config.yml)
     """
-    if ctx:
+    if ctx and 'config' in ctx.obj:
         config = ctx.obj['config']
     else:
         try:
