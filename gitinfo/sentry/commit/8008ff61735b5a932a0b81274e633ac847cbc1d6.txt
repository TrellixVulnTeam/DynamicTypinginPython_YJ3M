commit 8008ff61735b5a932a0b81274e633ac847cbc1d6
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Feb 22 19:44:29 2016 -0800

    Various improvements to errorHandler
    
    - Dont fail mounting error handler if Raven fails
    - Capture componentWillMount

diff --git a/src/sentry/static/sentry/app/utils/errorHandler.jsx b/src/sentry/static/sentry/app/utils/errorHandler.jsx
index 896451622d..d427dbbe68 100644
--- a/src/sentry/static/sentry/app/utils/errorHandler.jsx
+++ b/src/sentry/static/sentry/app/utils/errorHandler.jsx
@@ -3,12 +3,19 @@ import RouteError from '../views/routeError';
 
 export default function errorHandler(Component) {
   const originalRender = Component.prototype.render;
-
-  Component.prototype.render = function tryRender() {
+  Component.prototype.render = function() {
     try {
       return originalRender.apply(this, arguments);
     } catch (err) {
-      console.error(err);
+      return <RouteError error={err} component={this} />;
+    }
+  };
+
+  const originalComponentWillMount = Component.prototype.componentWillMount;
+  Component.prototype.componentWillMount = function() {
+    try {
+      return originalComponentWillMount.apply(this, arguments);
+    } catch (err) {
       return <RouteError error={err} component={this} />;
     }
   };
diff --git a/src/sentry/static/sentry/app/views/routeError.jsx b/src/sentry/static/sentry/app/views/routeError.jsx
index 37139b49bf..c95e599955 100644
--- a/src/sentry/static/sentry/app/views/routeError.jsx
+++ b/src/sentry/static/sentry/app/views/routeError.jsx
@@ -6,11 +6,19 @@ const RouteError = React.createClass({
   componentWillMount() {
     // TODO(dcramer): show something in addition to embed (that contains it?)
     // TODO(dcramer): capture better context
-    Raven.captureException(this.props.error);
-    Raven.showReportDialog();
+    // throw this in a timeout so if it errors we dont fall over
+    this._timeout = window.setTimeout(function(){
+      Raven.captureException(this.props.error);
+      // TODO(dcramer): we do not have errorId until send() is called which
+      // has latency in production so this will literally never fire
+      Raven.showReportDialog();
+    }.bind(this));
   },
 
   componentWillUnmount() {
+    if (this._timeout) {
+      window.clearTimeout(this._timeout);
+    }
     $('.sentry-error-embed-wrapper').remove();
   },
 
