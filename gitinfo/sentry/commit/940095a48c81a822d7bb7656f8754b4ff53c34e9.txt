commit 940095a48c81a822d7bb7656f8754b4ff53c34e9
Author: Nick Presta <nick@nickpresta.ca>
Date:   Tue Feb 5 21:49:43 2013 -0500

    Adding expanding tables for nested dicts.
    
    * Changes varToggle to use jQuery element, not ID.

diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 0a5db34c31..bef8a772eb 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -8116,3 +8116,7 @@ section.body .uneditable-input {
   font-size: 12px;
   color: #aaa;
 }
+.toggle-expand {
+    display: block;
+    padding: 8px;
+}
diff --git a/src/sentry/static/sentry/scripts/legacy.min.js b/src/sentry/static/sentry/scripts/legacy.min.js
index fdcbce7251..af55d83787 100644
--- a/src/sentry/static/sentry/scripts/legacy.min.js
+++ b/src/sentry/static/sentry/scripts/legacy.min.js
@@ -1,2 +1,2 @@
-function varToggle(link,id){"use strict";jQuery(id).toggle();var s=link.getElementsByTagName("span")[0];var uarr=String.fromCharCode(9654);var darr=String.fromCharCode(9660);s.innerHTML=s.innerHTML==uarr?darr:uarr;return false}if(Sentry===undefined){var Sentry={}}(function(app,jQuery){"use strict";var $=jQuery;$(document).ready(function(){$(".filter").each(function(_,el){var $filter=$(el);var $input=$filter.find("input[type=text]");if($input.length>0){$input.select2({initSelection:function(el,callback){var $el=$(el);callback({id:$el.val(),text:$el.val()})},allowClear:true,minimumInputLength:3,ajax:{url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/tags/search/",dataType:"json",data:function(term,page){return{query:term,quietMillis:300,name:$input.attr("name"),limit:10}},results:function(data,page){var results=[];$(data.results).each(function(_,val){results.push({id:val,text:val})});return{results:results}}}})}else{$input=$filter.find("select").select2({allowClear:true})}if($input.length>0){$input.on("change",function(e){var query=app.utils.getQueryParams();query[e.target.name]=e.val;window.location.href="?"+$.param(query)})}})});$(document).ajaxSend(function(event,xhr,settings){function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!==""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}function sameOrigin(url){var host=document.location.host;var protocol=document.location.protocol;var sr_origin="//"+host;var origin=protocol+sr_origin;return url==origin||url.slice(0,origin.length+1)==origin+"/"||url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+"/"||!/^(\/\/|http:|https:).*/.test(url)}function safeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}if(!safeMethod(settings.type)&&sameOrigin(settings.url)){xhr.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}});$(".popup").live("click",function(){var $this=$(this);var $window=$(window);var $container=$($this.attr("data-container"));var title=$this.attr("data-title")||"Untitled";var content=$container.html();var height=Math.min($window.height()-100,$container.height()+40);var width=Math.min($window.width()-100,$container.width()+40);var w=window.open("about:blank","dsqApiExpand","toolbar=0,status=0,location=0,menubar=0,height="+height+",width="+width);w.document.write("<!DOCTYPE html><html>"+"<head>"+"<title>"+title+"</title>"+'<link href="'+app.config.popupCss+'" rel="stylesheet" type="text/css"/>'+"</head><body>"+'<div id="popup">'+content+"</div></body>"+"</html>")})})(app,jQuery);if(Sentry===undefined){var Sentry={}}(function(jQuery){"use strict";var $=jQuery;Sentry.charts={};Sentry.charts.render=function(el){var $sparkline=$(el);if($sparkline.length<1){return}$.ajax({url:$sparkline.attr("data-api-url"),type:"get",dataType:"json",data:{days:7,gid:$sparkline.attr("data-group")||undefined},success:function(data){var points=[{data:data,color:"#56AFE8",shadowSize:0,lines:{lineWidth:2,show:true,fill:true}}];var options={xaxis:{mode:"time"},yaxis:{min:0,tickFormatter:function(value){if(value>999999){return value/1e6+"mm"}if(value>999){return value/1e3+"k"}return value}},grid:{show:true,backgroundColor:"#ffffff",borderColor:"#DEE3E9",borderWidth:2,tickColor:"#DEE3E9"},hoverable:false,legend:{noColumns:5},lines:{show:false}};$.plot($sparkline,points,options);$(window).resize(function(){$.plot($sparkline,points,options)})}})}})(jQuery);if(Sentry===undefined){var Sentry={}}(function(app,jQuery){"use strict";var $=jQuery;Sentry.stream={};Sentry.stream.clear=function(){if(window.confirm("Are you sure you want to mark all your stream as resolved?")){$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/clear/",type:"post",dataType:"json",success:function(groups){window.location.reload()}})}};Sentry.stream.resolve=function(gid,remove){if(typeof remove=="undefined"){remove=true}$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/resolve/",type:"post",dataType:"json",data:{gid:gid},success:function(groups){for(var i=groups.length-1,data,row;data=groups[i];i--){$('.event[data-group="'+data.id+'"]').remove();if(!remove){$("#event_list").prepend(data.html);$('.event[data-group="'+data.id+'"]').addClass("fresh")}}}})};Sentry.stream.bookmark=function(project_id,gid,el){$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/bookmark/",type:"post",dataType:"json",data:{gid:gid},success:function(data){if(!el){return}var $el=$(el);if(data.bookmarked){$el.addClass("checked")}else{$el.removeClass("checked")}}})}})(app,jQuery);
+function varToggle(link,$elm){"use strict";$elm.toggle();var s=link.getElementsByTagName("span")[0];var uarr=String.fromCharCode(9654);var darr=String.fromCharCode(9660);s.innerHTML=s.innerHTML==uarr?darr:uarr;return false}if(Sentry===undefined){var Sentry={}}(function(app,jQuery){"use strict";var $=jQuery;$(document).ready(function(){$(".filter").each(function(_,el){var $filter=$(el);var $input=$filter.find("input[type=text]");if($input.length>0){$input.select2({initSelection:function(el,callback){var $el=$(el);callback({id:$el.val(),text:$el.val()})},allowClear:true,minimumInputLength:3,ajax:{url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/tags/search/",dataType:"json",data:function(term,page){return{query:term,quietMillis:300,name:$input.attr("name"),limit:10}},results:function(data,page){var results=[];$(data.results).each(function(_,val){results.push({id:val,text:val})});return{results:results}}}})}else{$input=$filter.find("select").select2({allowClear:true})}if($input.length>0){$input.on("change",function(e){var query=app.utils.getQueryParams();query[e.target.name]=e.val;window.location.href="?"+$.param(query)})}})});$(document).ajaxSend(function(event,xhr,settings){function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!==""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}function sameOrigin(url){var host=document.location.host;var protocol=document.location.protocol;var sr_origin="//"+host;var origin=protocol+sr_origin;return url==origin||url.slice(0,origin.length+1)==origin+"/"||url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+"/"||!/^(\/\/|http:|https:).*/.test(url)}function safeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}if(!safeMethod(settings.type)&&sameOrigin(settings.url)){xhr.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))}});$(".popup").live("click",function(){var $this=$(this);var $window=$(window);var $container=$($this.attr("data-container"));var title=$this.attr("data-title")||"Untitled";var content=$container.html();var height=Math.min($window.height()-100,$container.height()+40);var width=Math.min($window.width()-100,$container.width()+40);var w=window.open("about:blank","dsqApiExpand","toolbar=0,status=0,location=0,menubar=0,height="+height+",width="+width);w.document.write("<!DOCTYPE html><html>"+"<head>"+"<title>"+title+"</title>"+'<link href="'+app.config.popupCss+'" rel="stylesheet" type="text/css"/>'+"</head><body>"+'<div id="popup">'+content+"</div></body>"+"</html>")})})(app,jQuery);if(Sentry===undefined){var Sentry={}}(function(jQuery){"use strict";var $=jQuery;Sentry.charts={};Sentry.charts.render=function(el){var $sparkline=$(el);if($sparkline.length<1){return}$.ajax({url:$sparkline.attr("data-api-url"),type:"get",dataType:"json",data:{days:7,gid:$sparkline.attr("data-group")||undefined},success:function(data){var points=[{data:data,color:"#56AFE8",shadowSize:0,lines:{lineWidth:2,show:true,fill:true}}];var options={xaxis:{mode:"time"},yaxis:{min:0,tickFormatter:function(value){if(value>999999){return value/1e6+"mm"}if(value>999){return value/1e3+"k"}return value}},grid:{show:true,backgroundColor:"#ffffff",borderColor:"#DEE3E9",borderWidth:2,tickColor:"#DEE3E9"},hoverable:false,legend:{noColumns:5},lines:{show:false}};$.plot($sparkline,points,options);$(window).resize(function(){$.plot($sparkline,points,options)})}})}})(jQuery);if(Sentry===undefined){var Sentry={}}(function(app,jQuery){"use strict";var $=jQuery;Sentry.stream={};Sentry.stream.clear=function(){if(window.confirm("Are you sure you want to mark all your stream as resolved?")){$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/clear/",type:"post",dataType:"json",success:function(groups){window.location.reload()}})}};Sentry.stream.resolve=function(gid,remove){if(typeof remove=="undefined"){remove=true}$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/resolve/",type:"post",dataType:"json",data:{gid:gid},success:function(groups){for(var i=groups.length-1,data,row;data=groups[i];i--){$('.event[data-group="'+data.id+'"]').remove();if(!remove){$("#event_list").prepend(data.html);$('.event[data-group="'+data.id+'"]').addClass("fresh")}}}})};Sentry.stream.bookmark=function(project_id,gid,el){$.ajax({url:app.config.urlPrefix+"/api/"+app.config.teamId+"/"+app.config.projectId+"/bookmark/",type:"post",dataType:"json",data:{gid:gid},success:function(data){if(!el){return}var $el=$(el);if(data.bookmarked){$el.addClass("checked")}else{$el.removeClass("checked")}}})}})(app,jQuery);
 //@ sourceMappingURL=legacy.min.map.js
\ No newline at end of file
diff --git a/src/sentry/static/sentry/scripts/sentry.core.js b/src/sentry/static/sentry/scripts/sentry.core.js
index ce82326a5a..ae8aee19b7 100644
--- a/src/sentry/static/sentry/scripts/sentry.core.js
+++ b/src/sentry/static/sentry/scripts/sentry.core.js
@@ -1,8 +1,8 @@
 /*global jQuery:true*/
-function varToggle(link, id) {
+function varToggle(link, $elm) {
     "use strict";
 
-    jQuery(id).toggle();
+    $elm.toggle();
     var s = link.getElementsByTagName('span')[0];
     var uarr = String.fromCharCode(0x25b6);
     var darr = String.fromCharCode(0x25bc);
diff --git a/src/sentry/static/sentry/styles/global.min.css b/src/sentry/static/sentry/styles/global.min.css
index 0a5db34c31..eb07da445e 100644
--- a/src/sentry/static/sentry/styles/global.min.css
+++ b/src/sentry/static/sentry/styles/global.min.css
@@ -8116,3 +8116,7 @@ section.body .uneditable-input {
   font-size: 12px;
   color: #aaa;
 }
+.toggle-expand {
+  display: block;
+  padding: 8px;
+}
diff --git a/src/sentry/static/sentry/styles/sentry.css b/src/sentry/static/sentry/styles/sentry.css
index 0a5db34c31..eb07da445e 100644
--- a/src/sentry/static/sentry/styles/sentry.css
+++ b/src/sentry/static/sentry/styles/sentry.css
@@ -8116,3 +8116,7 @@ section.body .uneditable-input {
   font-size: 12px;
   color: #aaa;
 }
+.toggle-expand {
+  display: block;
+  padding: 8px;
+}
diff --git a/src/sentry/templates/sentry/partial/_event_details.html b/src/sentry/templates/sentry/partial/_event_details.html
index 4feb70761a..ea2d681a52 100644
--- a/src/sentry/templates/sentry/partial/_event_details.html
+++ b/src/sentry/templates/sentry/partial/_event_details.html
@@ -17,26 +17,9 @@
                 <tr>
                     <th class="key">{{ k }}</th>
                     <td class="values{% if not v|is_dict %} code{% endif %}">
-                    {% if v|is_dict %}
-                        {% if v|length > 5 %}
-                            <a href="#" onclick="return varToggle(this, '#vExtra{{ forloop.counter }}')"><span>&#x25b6;</span> {% trans "Expand" %}</a>
-                        {% endif %}
-                        <table class="table vars" id="vExtra{{ forloop.counter }}"{% if v|length > 5 %} style="display:none;"{% endif %}>
-                            <colgroup>
-                                <col style="width:100px;">
-                            </colgroup>
-                            <tbody>
-                                {% for k_, v_ in v.iteritems|as_sorted %}
-                                    <tr>
-                                        <th>{{ k_ }}</th>
-                                        <td class="code"><pre>{{ v_|pprint }}</pre></td>
-                                    </tr>
-                                {% endfor %}
-                            </tbody>
-                        </table>
-                    {% else %}
-                        <pre>{{ v|pprint }}</pre>
-                    {% endif %}
+                        {% with value=v threshold=5 template="sentry/partial/_event_details_code_values.html" %}
+                            {% include template %}
+                        {% endwith %}
                     </td>
                 </tr>
             {% endfor %}
diff --git a/src/sentry/templates/sentry/partial/_event_details_code_values.html b/src/sentry/templates/sentry/partial/_event_details_code_values.html
new file mode 100644
index 0000000000..0346b20453
--- /dev/null
+++ b/src/sentry/templates/sentry/partial/_event_details_code_values.html
@@ -0,0 +1,30 @@
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% if value|is_dict %}
+    {% if value|length > threshold %}
+        <a href="#" class="toggle-expand" onclick="return varToggle(this, $(this).next('.js-expand'));"><span>&#x25b6;</span> {% trans "Expand" %}</a>
+    {% endif %}
+    <table class="js-expand table vars"{% if value|length > threshold %} style="display:none;"{% endif %}>
+        <colgroup>
+            <col style="width:100px;">
+        </colgroup>
+        <tbody>
+            {% for k, v in value.iteritems|as_sorted %}
+                <tr>
+                    <th>{{ k }}</th>
+                    {% if v|is_dict %}
+                        <td class="values code">
+                            {% with value=v %}
+                                {% include template %}
+                            {% endwith %}
+                        </td>
+                    {% else %}
+                        <td class="code"><pre>{{ v|pprint }}</pre></td>
+                    {% endif %}
+            {% endfor %}
+        </tbody>
+    </table>
+{% else %}
+    {{ value|pprint }}
+{% endif %}
diff --git a/src/sentry/templates/sentry/partial/interfaces/http.html b/src/sentry/templates/sentry/partial/interfaces/http.html
index 74efa68da2..81bfd9fbce 100644
--- a/src/sentry/templates/sentry/partial/interfaces/http.html
+++ b/src/sentry/templates/sentry/partial/interfaces/http.html
@@ -34,7 +34,7 @@
                         <td>
                             {% if data_is_dict %}
                                 {% if data|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpBody')"><span>&#x25b6;</span> {% trans "Body" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpBody'))"><span>&#x25b6;</span> {% trans "Body" %}</a>
                                 {% endif %}
                                 <table class="table vars" id="vHttpBody"{% if data|length > 5 %} style="display:none;"{% endif %}>
                                     <colgroup>
@@ -51,7 +51,7 @@
                                 </table>
                             {% else %}
                                 {% if data|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpBody')"><span>&#x25b6;</span> {% trans "Body" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpBody'))"><span>&#x25b6;</span> {% trans "Body" %}</a>
                                 {% endif %}
                                 <div id="vHttpBody"{% if data|length > 5 %} style="display:none;"{% endif %}>
                                     <pre>{{ data|pprint }}</pre>
@@ -66,7 +66,7 @@
                         <td>
                             {% if cookies_is_dict %}
                                 {% if cookies|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpCookies')"><span>&#x25b6;</span> {% trans "Cookies" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpCookies'))"><span>&#x25b6;</span> {% trans "Cookies" %}</a>
                                 {% endif %}
                                 <table class="table vars" id="vHttpCookies"{% if cookies|length > 5 %} style="display:none;"{% endif %}>
                                     <colgroup>
@@ -83,7 +83,7 @@
                                 </table>
                             {% else %}
                                 {% if cookies|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpCookies')"><span>&#x25b6;</span> {% trans "Cookies" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpCookies'))"><span>&#x25b6;</span> {% trans "Cookies" %}</a>
                                 {% endif %}
                                 <div id="vHttpCookies"{% if cookies|length > 5 %} style="display:none;"{% endif %}>
                                     <pre>{{ cookies|pprint }}</pre>
@@ -98,7 +98,7 @@
                         <td>
                             {% if headers_is_dict %}
                                 {% if headers|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpHeaders')"><span>&#x25b6;</span> {% trans "Headers" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpHeaders'))"><span>&#x25b6;</span> {% trans "Headers" %}</a>
                                 {% endif %}
                                 <table class="table vars" id="vHttpHeaders"{% if headers|length > 5 %} style="display:none;"{% endif %}>
                                     <colgroup>
@@ -115,7 +115,7 @@
                                 </table>
                             {% else %}
                                 {% if headers|length > 5 %}
-                                    <a href="#" onclick="return varToggle(this, '#vHttpHeaders')"><span>&#x25b6;</span> {% trans "Headers" %}</a>
+                                    <a href="#" onclick="return varToggle(this, $('#vHttpHeaders'))"><span>&#x25b6;</span> {% trans "Headers" %}</a>
                                 {% endif %}
                                 <div id="vHttpHeaders"{% if headers|length > 5 %} style="display:none;"{% endif %}>
                                     <pre>{{ headers|pprint }}</pre>
@@ -129,7 +129,7 @@
                         <th>{% trans "Environment:" %}</th>
                         <td>
                             {% if env|length > 5 %}
-                                <a href="#" onclick="return varToggle(this, '#vHttpEnv')"><span>&#x25b6;</span> {% trans "Environment" %}</a>
+                                <a href="#" onclick="return varToggle(this, $('#vHttpEnv'))"><span>&#x25b6;</span> {% trans "Environment" %}</a>
                             {% endif %}
                             <table class="table vars" id="vHttpEnv"{% if env|length > 5 %} style="display:none;"{% endif %}>
                                 <colgroup>
@@ -150,4 +150,4 @@
             </tbody>
         </table>
     </div>
-</div>
\ No newline at end of file
+</div>
