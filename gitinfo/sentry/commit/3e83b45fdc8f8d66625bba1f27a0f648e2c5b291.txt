commit 3e83b45fdc8f8d66625bba1f27a0f648e2c5b291
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 6 20:48:02 2012 -0700

    Dont include users that are not marked as active in notifications (fixes GH-551)

diff --git a/sentry/plugins/bases/notify.py b/sentry/plugins/bases/notify.py
index 11240a9f5d..b71cb1951a 100644
--- a/sentry/plugins/bases/notify.py
+++ b/sentry/plugins/bases/notify.py
@@ -90,7 +90,9 @@ class NotificationPlugin(Plugin):
         ).values_list('user', flat=True))
 
         # fetch remaining users
-        member_set = set(project.team.member_set.exclude(user__in=disabled).values_list('user', flat=True))
+        member_set = set(project.team.member_set.filter(
+            user__is_active=True,
+        ).exclude(user__in=disabled).values_list('user', flat=True))
 
         return member_set
 
@@ -109,7 +111,7 @@ class NotificationPlugin(Plugin):
 
         # if any didnt exist, grab their default email
         if user_ids:
-            email_list |= set(User.objects.filter(pk__in=user_ids).values_list('email', flat=True))
+            email_list |= set(User.objects.filter(pk__in=user_ids, is_active=True).values_list('email', flat=True))
 
         return email_list
 
diff --git a/tests/sentry/plugins/mail/tests.py b/tests/sentry/plugins/mail/tests.py
index 10f380eb0f..7a34f1bd91 100644
--- a/tests/sentry/plugins/mail/tests.py
+++ b/tests/sentry/plugins/mail/tests.py
@@ -254,11 +254,13 @@ class MailProcessorTest(TestCase):
         from django.contrib.auth.models import User
         from sentry.models import Project, UserOption
 
-        user = User.objects.create(username='foo', email='foo@example.com')
-        user2 = User.objects.create(username='baz', email='baz@example.com')
+        user = User.objects.create(username='foo', email='foo@example.com', is_active=True)
+        user2 = User.objects.create(username='baz', email='baz@example.com', is_active=True)
+        user3 = User.objects.create(username='bar', email='bar@example.com', is_active=False)
         project = Project.objects.create(name='Test', slug='test', owner=user)
         project.team.member_set.get_or_create(user=user)
         project.team.member_set.get_or_create(user=user2)
+        project.team.member_set.get_or_create(user=user3)
 
         p = MailProcessor()
 
