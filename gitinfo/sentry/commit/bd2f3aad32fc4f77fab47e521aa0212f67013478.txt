commit bd2f3aad32fc4f77fab47e521aa0212f67013478
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jun 19 13:11:12 2012 -0700

    Correct default list population for realtime ids

diff --git a/sentry/static/scripts/global.js b/sentry/static/scripts/global.js
index d33e0be3af..bb0cb56667 100644
--- a/sentry/static/scripts/global.js
+++ b/sentry/static/scripts/global.js
@@ -423,7 +423,7 @@ if (Sentry === undefined) {
         var sorted = [];
         $('#event_list .event').each(function(i, el){
             var $el = $(el);
-            sorted.push([$el.attr('data-score'), $el.attr('id')]);
+            sorted.push([$el.attr('data-score'), $el.attr('data-group')]);
         });
         Sentry.realtime.events = sorted;
 
@@ -473,8 +473,7 @@ if (Sentry === undefined) {
             return;
         }
         var data = Sentry.realtime.queue.pop();
-        var id = data.id;
-        var $row = $('.event[data-group="' + id + '"]');
+        var $row = $('.event[data-group="' + data.id + '"]');
         var is_new = ($row.length === 0);
 
         // ensure "no messages" is cleaned up
@@ -498,7 +497,7 @@ if (Sentry === undefined) {
 
         // check to see if the row already exists in the sort,
         // and get the current position
-        old_pos = getPosition(Sentry.realtime.events, id, 1);
+        old_pos = getPosition(Sentry.realtime.events, data.id, 1);
 
         // if the row was already present, adjust its score
         if (old_pos !== -1) {
@@ -522,7 +521,7 @@ if (Sentry === undefined) {
 
         // insert it into the events list at the current position
         if (is_new) {
-            Sentry.realtime.events.splice(pos, 0, [data.score, id]);
+            Sentry.realtime.events.splice(pos, 0, [data.score, data.id]);
         }
 
         // shiny fx
diff --git a/sentry/static/scripts/global.min.js b/sentry/static/scripts/global.min.js
index 8ac75da2c9..a28629136c 100644
--- a/sentry/static/scripts/global.min.js
+++ b/sentry/static/scripts/global.min.js
@@ -1 +1 @@
-function varToggle(e,t){$("#v"+t).toggle();var n=e.getElementsByTagName("span")[0],r=String.fromCharCode(9654),i=String.fromCharCode(9660);return n.innerHTML=n.innerHTML==r?i:r,!1}(function(){var e=function(e,t){return t.priority-e.priority},t=function(e,t){return e.priority-t.priority};Queue=function(n){var r=[],i=!1,s;n===undefined&&(n={}),n.low?s=e:n.high&&(s=t);var o=function(){r.sort(s),i=!0},u={pop:function(){!i&&s&&o();var e=r.pop();return e?e.object:undefined},top:function(){i||o();var e=r[r.length-1];return e?e.object:undefined},includes:function(e){for(var t=r.length-1;t>=0;t--)if(r[t].object===e)return!0;return!1},replace:function(e,t,n){for(var i=r.length-1;i>=0;i--)if(r[i].object[n]===e[n])return r[i]={object:e,priority:t},!0;return u.push(e,t),!1},size:function(){return r.length},empty:function(){return r.length===0},push:function(e,t){r.push({object:e,priority:t}),i=!1}};return u}})(),function(e,t){var n=e.parse,r=[1,4,5,6,7,10,11];e.parse=function(i){var s,o,u=0;if(o=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(i)){for(var a=0,f;f=r[a];++a)o[f]=+o[f]||0;o[2]=(+o[2]||1)-1,o[3]=+o[3]||1,o[8]!=="Z"&&o[9]!==t&&(u=o[10]*60+o[11],o[9]==="+"&&(u=0-u)),s=e.UTC(o[1],o[2],o[3],o[4],o[5]+u,o[6],o[7])}else s=n?n(i):NaN;return s}}(Date);if(Sentry===undefined)var Sentry={};(function(){Sentry.options={urlPrefix:"",mediaUrl:"/media/",defaultImage:"/media/images/sentry.png"},Sentry.config=function(e){$.each(e,function(e,t){Sentry.options[e]=t})},Sentry.prettyDate=function(e){var t=Date.parse(e),n=new Date,r=Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()),i=(r-t)/1e3,s="ago",o=[[60,"just now","just now"],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"yesterday","tomorrow"],[604800,"days",86400],[1209600,"last week","next week"],[2419200,"weeks",604800],[4838400,"last month","next month"],[29030400,"months",2419200],[58060800,"last year","next year"],[290304e4,"years",29030400],[580608e4,"last century","next century"],[580608e5,"centuries",290304e4]],u=1;i<0&&(i=Math.abs(i),s="from now",u=2);for(var a=0,f;f=o[a];a++)if(i<f[0])return typeof f[2]=="string"?f[u]:Math.floor(i/f[2])+" "+f[1]+" "+s;return t},Sentry.prettyDates=function(){$(".pretty-date").each(function(e,t){var n=$(t),r=n.attr("title");if(r){var i=Sentry.prettyDate(r);i&&n.text(i)}})},Sentry.toggle=function(e){var t=$(e);t.toggle()},Sentry.getQueryParams=function(){var e={},t,n=window.location.href;if(n.indexOf("?")===-1)return e;var r=n.slice(n.indexOf("?")+1,n.indexOf("#")!==-1?n.indexOf("#"):n.length).split("&");return $.each(r,function(n,r){t=r.split("=");if(!t[0]&&!t[1])return;e[t[0]]=t[1]?decodeURIComponent(t[1]).replace(/\+/," "):""}),e},$(document).ready(function(){$(".filter-list").each(function(e,t){var n=$(t);if(n.find("li").length>6){var r=$("<select></select>"),i=$('<div class="filter-select sidebar-module">').appendTo(n.parent());n.find("li a").each(function(e,t){t=$(t);var n=$('<option value="'+t.attr("href")+'">'+t.text()+"</option>").appendTo(r);t.parent().hasClass("active")&&n.attr("selected","selected")}),n.remove(),r.appendTo(i).change(function(){window.location.href=$(this).val()})}}),setInterval(Sentry.prettyDates,5e3),Sentry.prettyDates()}),$(document).ajaxSend(function(e,t,n){function r(e){var t=null;if(document.cookie&&document.cookie!==""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}function i(e){var t=document.location.host,n=document.location.protocol,r="//"+t,i=n+r;return e==i||e.slice(0,i.length+1)==i+"/"||e==r||e.slice(0,r.length+1)==r+"/"||!/^(\/\/|http:|https:).*/.test(e)}function s(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}!s(n.type)&&i(n.url)&&t.setRequestHeader("X-CSRFToken",r("csrftoken"))}),$(".popup").live("click",function(){var e=$(this),t=$(window),n=$(e.attr("data-container")),r=e.attr("data-title")||"Untitled",i=n.html(),s=Math.min(t.height()-100,n.height()+40),o=Math.min(t.width()-100,n.width()+40),u=window.open("about:blank","dsqApiExpand","toolbar=0,status=0,location=0,menubar=0,height="+s+",width="+o);u.document.write("<!DOCTYPE html><html><head><title>"+r+"</title>"+'<link href="'+Sentry.options.popupCss+'" rel="stylesheet" type="text/css"/>'+"</head><body>"+'<div id="popup">'+i+"</div></body>"+"</html>")})})();if(Sentry===undefined)var Sentry={};(function(){function e(e,t,n){for(var r=0,i;i=e[r];r++)if(t>i[n])return r;return-1}function t(e,t,n){for(var r=0,i;i=e[r];r++)if(t==i[n])return r;return-1}Sentry.realtime={},Sentry.realtime.options={viewId:null,projectId:null},Sentry.realtime.status=!1,Sentry.realtime.queue=Queue({high:!0}),Sentry.realtime.init=function(){var e=[];$("#event_list .event").each(function(t,n){var r=$(n);e.push([r.attr("data-score"),r.attr("id")])}),Sentry.realtime.events=e,$("#sentry-realtime").click(function(){Sentry.realtime.status?Sentry.realtime.disable():Sentry.realtime.enable()}),Sentry.realtime.poll(),setInterval(Sentry.realtime.tick,300)},Sentry.realtime.config=function(e){$.each(e,function(e,t){Sentry.realtime.options[e]=t})},Sentry.realtime.toggle=function(){Sentry.realtime.status?Sentry.realtime.enable():Sentry.realtime.disable()},Sentry.realtime.enable=function(){var e=$("#sentry-realtime");e.removeClass("realtime-play"),e.addClass("realtime-pause"),e.text("Pause Feed"),Sentry.realtime.status=!0},Sentry.realtime.disable=function(){var e=$("#sentry-realtime");e.addClass("realtime-play"),e.removeClass("realtime-pause"),e.text("Go Live"),Sentry.realtime.status=!1},Sentry.realtime.tick=function(){if(Sentry.realtime.queue.empty())return;var n=Sentry.realtime.queue.pop(),r=n.id,i=$('.event[data-group="'+r+'"]'),s=i.length===0;$("#no_messages").remove(),Sentry.realtime.events.sort(function(e,t){return t[0]-e[0]});if(!s&&i.attr("data-count")==n.count)return;pos=e(Sentry.realtime.events,n.score,0),old_pos=t(Sentry.realtime.events,r,1);if(old_pos!==-1){Sentry.realtime.events[old_pos][0]=n.score;if(old_pos==pos)return;i.remove()}else s||i.remove();i=$(n.html),pos===-1?$("#event_list").append(i):$('.event[data-group="'+Sentry.realtime.events[pos][1]+'"]').before(i),s&&Sentry.realtime.events.splice(pos,0,[n.score,r]),i.css("background-color","#ddd").animate({backgroundColor:"#fff"},1200)},Sentry.realtime.poll=function(){if(!Sentry.realtime.status){setTimeout(Sentry.realtime.poll,1e3);return}data=Sentry.getQueryParams(),data.view_id=Sentry.realtime.options.viewId||undefined,data.cursor=Sentry.realtime.cursor||undefined,$.ajax({url:Sentry.options.urlPrefix+"/api/"+Sentry.realtime.options.projectId+"/poll/",type:"get",dataType:"json",data:data,success:function(e){if(!e.length){setTimeout(Sentry.realtime.poll,5e3);return}Sentry.realtime.cursor=e[e.length-1].score||undefined,$(e).each(function(e,t){Sentry.realtime.queue.replace(t,t.score,"id")}),setTimeout(Sentry.realtime.poll,1e3)},error:function(){setTimeout(Sentry.realtime.poll,1e4)}});while(Sentry.realtime.events.length>50){var e=Sentry.realtime.events.pop();$('.event[data-group="'+e[1]+'"]').remove()}},$(document).ready(function(){Sentry.realtime.init()})})();if(Sentry===undefined)var Sentry={};(function(){Sentry.charts={},Sentry.charts.render=function(e){var t=$(e);if(t.length<1)return;$.ajax({url:t.attr("data-api-url"),type:"get",dataType:"json",data:{days:1,gid:t.attr("data-group")||undefined},success:function(e){var n=(new Date).getTime()-e.length*36e5,r=[],i=25,s=[],o={data:s,shadowSize:0,lines:{lineWidth:1,show:!0,fill:!0}};$.each(e,function(e,t){s.push([n+36e5*e,t]),t>i&&(i=t)}),r.push(o),t.height(t.parent().height()),$.plot(t,[{data:s,color:"#3079d0",shadowSize:0,lines:{lineWidth:1,show:!0,fill:!0}}],{xaxis:{mode:"time"},yaxis:{min:0,max:i},grid:{show:!0,backgroundColor:"#f9f9f9",borderColor:"#eeeeee",borderWidth:1,tickColor:"#eeeeee"},legend:{noColumns:5},lines:{show:!1}})}})}})();if(Sentry===undefined)var Sentry={};(function(){Sentry.notifications={},Sentry.notifications.status=!1,Sentry.notifications.enable=function(){window.webkitNotifications.requestPermission(function(){Sentry.notifications.status=!0,Sentry.notifications.show({type:"simple",title:"Sentry",body:"Notifications have been enabled."}),$("#sentry_notify").text("Disable Notifications")})},Sentry.notifications.disable=function(){Sentry.notifications.status=!1,$("#sentry_notify").text("Enable Notifications")},Sentry.notifications.show=function(e){if(!Sentry.notifications.status)return;var t;e.type=="html"?t=window.webkitNotifications.createHTMLNotification(e.url):t=window.webkitNotifications.createNotification(e.image||Sentry.options.defaultImage,e.title,e.body),t.ondisplay=function(){setTimeout(function(){t.cancel()},1e4)},t.show()},$(document).ready(function(){window.webkitNotifications&&(Sentry.notifications.status=window.webkitNotifications.checkPermission()>0,$('<li><a id="sentry_notify" href="javascript:void()">'+(Sentry.notifications.status?"Disable Notifications":"Enable Notifications")+"</a></li>").click(function(){Sentry.notifications.status?Sentry.notifications.disable():Sentry.notifications.enable()}).prependTo("#account"))})})();if(Sentry===undefined)var Sentry={};(function(){Sentry.stream={},Sentry.stream.clear=function(e){confirm("Are you sure you want to mark all your stream as resolved?")&&$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/clear/",type:"post",dataType:"json",success:function(e){window.location.reload()}})},Sentry.stream.resolve=function(e,t,n){typeof n=="undefined"&&(n=!0),$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/resolve/",type:"post",dataType:"json",data:{gid:t},success:function(e){for(var t=e.length-1,r,i;r=e[t];t--)$('.event[data-group="'+r.id+'"]').remove(),n||($("#event_list").prepend(r.html),$('.event[data-group="'+r.id+'"]').addClass("fresh"))}})},Sentry.stream.bookmark=function(e,t,n){$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/bookmark/",type:"post",dataType:"json",data:{gid:t},success:function(e){if(!n)return;var t=$(n);e.bookmarked?t.addClass("checked"):t.removeClass("checked")}})}})();
\ No newline at end of file
+function varToggle(e,t){$("#v"+t).toggle();var n=e.getElementsByTagName("span")[0],r=String.fromCharCode(9654),i=String.fromCharCode(9660);return n.innerHTML=n.innerHTML==r?i:r,!1}(function(){var e=function(e,t){return t.priority-e.priority},t=function(e,t){return e.priority-t.priority};Queue=function(n){var r=[],i=!1,s;n===undefined&&(n={}),n.low?s=e:n.high&&(s=t);var o=function(){r.sort(s),i=!0},u={pop:function(){!i&&s&&o();var e=r.pop();return e?e.object:undefined},top:function(){i||o();var e=r[r.length-1];return e?e.object:undefined},includes:function(e){for(var t=r.length-1;t>=0;t--)if(r[t].object===e)return!0;return!1},replace:function(e,t,n){for(var i=r.length-1;i>=0;i--)if(r[i].object[n]===e[n])return r[i]={object:e,priority:t},!0;return u.push(e,t),!1},size:function(){return r.length},empty:function(){return r.length===0},push:function(e,t){r.push({object:e,priority:t}),i=!1}};return u}})(),function(e,t){var n=e.parse,r=[1,4,5,6,7,10,11];e.parse=function(i){var s,o,u=0;if(o=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(i)){for(var a=0,f;f=r[a];++a)o[f]=+o[f]||0;o[2]=(+o[2]||1)-1,o[3]=+o[3]||1,o[8]!=="Z"&&o[9]!==t&&(u=o[10]*60+o[11],o[9]==="+"&&(u=0-u)),s=e.UTC(o[1],o[2],o[3],o[4],o[5]+u,o[6],o[7])}else s=n?n(i):NaN;return s}}(Date);if(Sentry===undefined)var Sentry={};(function(){Sentry.options={urlPrefix:"",mediaUrl:"/media/",defaultImage:"/media/images/sentry.png"},Sentry.config=function(e){$.each(e,function(e,t){Sentry.options[e]=t})},Sentry.prettyDate=function(e){var t=Date.parse(e),n=new Date,r=Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()),i=(r-t)/1e3,s="ago",o=[[60,"just now","just now"],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"yesterday","tomorrow"],[604800,"days",86400],[1209600,"last week","next week"],[2419200,"weeks",604800],[4838400,"last month","next month"],[29030400,"months",2419200],[58060800,"last year","next year"],[290304e4,"years",29030400],[580608e4,"last century","next century"],[580608e5,"centuries",290304e4]],u=1;i<0&&(i=Math.abs(i),s="from now",u=2);for(var a=0,f;f=o[a];a++)if(i<f[0])return typeof f[2]=="string"?f[u]:Math.floor(i/f[2])+" "+f[1]+" "+s;return t},Sentry.prettyDates=function(){$(".pretty-date").each(function(e,t){var n=$(t),r=n.attr("title");if(r){var i=Sentry.prettyDate(r);i&&n.text(i)}})},Sentry.toggle=function(e){var t=$(e);t.toggle()},Sentry.getQueryParams=function(){var e={},t,n=window.location.href;if(n.indexOf("?")===-1)return e;var r=n.slice(n.indexOf("?")+1,n.indexOf("#")!==-1?n.indexOf("#"):n.length).split("&");return $.each(r,function(n,r){t=r.split("=");if(!t[0]&&!t[1])return;e[t[0]]=t[1]?decodeURIComponent(t[1]).replace(/\+/," "):""}),e},$(document).ready(function(){$(".filter-list").each(function(e,t){var n=$(t);if(n.find("li").length>6){var r=$("<select></select>"),i=$('<div class="filter-select sidebar-module">').appendTo(n.parent());n.find("li a").each(function(e,t){t=$(t);var n=$('<option value="'+t.attr("href")+'">'+t.text()+"</option>").appendTo(r);t.parent().hasClass("active")&&n.attr("selected","selected")}),n.remove(),r.appendTo(i).change(function(){window.location.href=$(this).val()})}}),setInterval(Sentry.prettyDates,5e3),Sentry.prettyDates()}),$(document).ajaxSend(function(e,t,n){function r(e){var t=null;if(document.cookie&&document.cookie!==""){var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=jQuery.trim(n[r]);if(i.substring(0,e.length+1)==e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}function i(e){var t=document.location.host,n=document.location.protocol,r="//"+t,i=n+r;return e==i||e.slice(0,i.length+1)==i+"/"||e==r||e.slice(0,r.length+1)==r+"/"||!/^(\/\/|http:|https:).*/.test(e)}function s(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}!s(n.type)&&i(n.url)&&t.setRequestHeader("X-CSRFToken",r("csrftoken"))}),$(".popup").live("click",function(){var e=$(this),t=$(window),n=$(e.attr("data-container")),r=e.attr("data-title")||"Untitled",i=n.html(),s=Math.min(t.height()-100,n.height()+40),o=Math.min(t.width()-100,n.width()+40),u=window.open("about:blank","dsqApiExpand","toolbar=0,status=0,location=0,menubar=0,height="+s+",width="+o);u.document.write("<!DOCTYPE html><html><head><title>"+r+"</title>"+'<link href="'+Sentry.options.popupCss+'" rel="stylesheet" type="text/css"/>'+"</head><body>"+'<div id="popup">'+i+"</div></body>"+"</html>")})})();if(Sentry===undefined)var Sentry={};(function(){function e(e,t,n){for(var r=0,i;i=e[r];r++)if(t>i[n])return r;return-1}function t(e,t,n){for(var r=0,i;i=e[r];r++)if(t==i[n])return r;return-1}Sentry.realtime={},Sentry.realtime.options={viewId:null,projectId:null},Sentry.realtime.status=!1,Sentry.realtime.queue=Queue({high:!0}),Sentry.realtime.init=function(){var e=[];$("#event_list .event").each(function(t,n){var r=$(n);e.push([r.attr("data-score"),r.attr("data-group")])}),Sentry.realtime.events=e,$("#sentry-realtime").click(function(){Sentry.realtime.status?Sentry.realtime.disable():Sentry.realtime.enable()}),Sentry.realtime.poll(),setInterval(Sentry.realtime.tick,300)},Sentry.realtime.config=function(e){$.each(e,function(e,t){Sentry.realtime.options[e]=t})},Sentry.realtime.toggle=function(){Sentry.realtime.status?Sentry.realtime.enable():Sentry.realtime.disable()},Sentry.realtime.enable=function(){var e=$("#sentry-realtime");e.removeClass("realtime-play"),e.addClass("realtime-pause"),e.text("Pause Feed"),Sentry.realtime.status=!0},Sentry.realtime.disable=function(){var e=$("#sentry-realtime");e.addClass("realtime-play"),e.removeClass("realtime-pause"),e.text("Go Live"),Sentry.realtime.status=!1},Sentry.realtime.tick=function(){if(Sentry.realtime.queue.empty())return;var n=Sentry.realtime.queue.pop(),r=$('.event[data-group="'+n.id+'"]'),i=r.length===0;$("#no_messages").remove(),Sentry.realtime.events.sort(function(e,t){return t[0]-e[0]});if(!i&&r.attr("data-count")==n.count)return;pos=e(Sentry.realtime.events,n.score,0),old_pos=t(Sentry.realtime.events,n.id,1);if(old_pos!==-1){Sentry.realtime.events[old_pos][0]=n.score;if(old_pos==pos)return;r.remove()}else i||r.remove();r=$(n.html),pos===-1?$("#event_list").append(r):$('.event[data-group="'+Sentry.realtime.events[pos][1]+'"]').before(r),i&&Sentry.realtime.events.splice(pos,0,[n.score,n.id]),r.css("background-color","#ddd").animate({backgroundColor:"#fff"},1200)},Sentry.realtime.poll=function(){if(!Sentry.realtime.status){setTimeout(Sentry.realtime.poll,1e3);return}data=Sentry.getQueryParams(),data.view_id=Sentry.realtime.options.viewId||undefined,data.cursor=Sentry.realtime.cursor||undefined,$.ajax({url:Sentry.options.urlPrefix+"/api/"+Sentry.realtime.options.projectId+"/poll/",type:"get",dataType:"json",data:data,success:function(e){if(!e.length){setTimeout(Sentry.realtime.poll,5e3);return}Sentry.realtime.cursor=e[e.length-1].score||undefined,$(e).each(function(e,t){Sentry.realtime.queue.replace(t,t.score,"id")}),setTimeout(Sentry.realtime.poll,1e3)},error:function(){setTimeout(Sentry.realtime.poll,1e4)}});while(Sentry.realtime.events.length>50){var e=Sentry.realtime.events.pop();$('.event[data-group="'+e[1]+'"]').remove()}},$(document).ready(function(){Sentry.realtime.init()})})();if(Sentry===undefined)var Sentry={};(function(){Sentry.charts={},Sentry.charts.render=function(e){var t=$(e);if(t.length<1)return;$.ajax({url:t.attr("data-api-url"),type:"get",dataType:"json",data:{days:1,gid:t.attr("data-group")||undefined},success:function(e){var n=(new Date).getTime()-e.length*36e5,r=[],i=25,s=[],o={data:s,shadowSize:0,lines:{lineWidth:1,show:!0,fill:!0}};$.each(e,function(e,t){s.push([n+36e5*e,t]),t>i&&(i=t)}),r.push(o),t.height(t.parent().height()),$.plot(t,[{data:s,color:"#3079d0",shadowSize:0,lines:{lineWidth:1,show:!0,fill:!0}}],{xaxis:{mode:"time"},yaxis:{min:0,max:i},grid:{show:!0,backgroundColor:"#f9f9f9",borderColor:"#eeeeee",borderWidth:1,tickColor:"#eeeeee"},legend:{noColumns:5},lines:{show:!1}})}})}})();if(Sentry===undefined)var Sentry={};(function(){Sentry.notifications={},Sentry.notifications.status=!1,Sentry.notifications.enable=function(){window.webkitNotifications.requestPermission(function(){Sentry.notifications.status=!0,Sentry.notifications.show({type:"simple",title:"Sentry",body:"Notifications have been enabled."}),$("#sentry_notify").text("Disable Notifications")})},Sentry.notifications.disable=function(){Sentry.notifications.status=!1,$("#sentry_notify").text("Enable Notifications")},Sentry.notifications.show=function(e){if(!Sentry.notifications.status)return;var t;e.type=="html"?t=window.webkitNotifications.createHTMLNotification(e.url):t=window.webkitNotifications.createNotification(e.image||Sentry.options.defaultImage,e.title,e.body),t.ondisplay=function(){setTimeout(function(){t.cancel()},1e4)},t.show()},$(document).ready(function(){window.webkitNotifications&&(Sentry.notifications.status=window.webkitNotifications.checkPermission()>0,$('<li><a id="sentry_notify" href="javascript:void()">'+(Sentry.notifications.status?"Disable Notifications":"Enable Notifications")+"</a></li>").click(function(){Sentry.notifications.status?Sentry.notifications.disable():Sentry.notifications.enable()}).prependTo("#account"))})})();if(Sentry===undefined)var Sentry={};(function(){Sentry.stream={},Sentry.stream.clear=function(e){confirm("Are you sure you want to mark all your stream as resolved?")&&$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/clear/",type:"post",dataType:"json",success:function(e){window.location.reload()}})},Sentry.stream.resolve=function(e,t,n){typeof n=="undefined"&&(n=!0),$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/resolve/",type:"post",dataType:"json",data:{gid:t},success:function(e){for(var t=e.length-1,r,i;r=e[t];t--)$('.event[data-group="'+r.id+'"]').remove(),n||($("#event_list").prepend(r.html),$('.event[data-group="'+r.id+'"]').addClass("fresh"))}})},Sentry.stream.bookmark=function(e,t,n){$.ajax({url:Sentry.options.urlPrefix+"/api/"+e+"/bookmark/",type:"post",dataType:"json",data:{gid:t},success:function(e){if(!n)return;var t=$(n);e.bookmarked?t.addClass("checked"):t.removeClass("checked")}})}})();
\ No newline at end of file
diff --git a/sentry/static/scripts/sentry.realtime.js b/sentry/static/scripts/sentry.realtime.js
index a1669cadcc..400b1ec76f 100644
--- a/sentry/static/scripts/sentry.realtime.js
+++ b/sentry/static/scripts/sentry.realtime.js
@@ -30,7 +30,7 @@ if (Sentry === undefined) {
         var sorted = [];
         $('#event_list .event').each(function(i, el){
             var $el = $(el);
-            sorted.push([$el.attr('data-score'), $el.attr('id')]);
+            sorted.push([$el.attr('data-score'), $el.attr('data-group')]);
         });
         Sentry.realtime.events = sorted;
 
@@ -80,8 +80,7 @@ if (Sentry === undefined) {
             return;
         }
         var data = Sentry.realtime.queue.pop();
-        var id = data.id;
-        var $row = $('.event[data-group="' + id + '"]');
+        var $row = $('.event[data-group="' + data.id + '"]');
         var is_new = ($row.length === 0);
 
         // ensure "no messages" is cleaned up
@@ -105,7 +104,7 @@ if (Sentry === undefined) {
 
         // check to see if the row already exists in the sort,
         // and get the current position
-        old_pos = getPosition(Sentry.realtime.events, id, 1);
+        old_pos = getPosition(Sentry.realtime.events, data.id, 1);
 
         // if the row was already present, adjust its score
         if (old_pos !== -1) {
@@ -129,7 +128,7 @@ if (Sentry === undefined) {
 
         // insert it into the events list at the current position
         if (is_new) {
-            Sentry.realtime.events.splice(pos, 0, [data.score, id]);
+            Sentry.realtime.events.splice(pos, 0, [data.score, data.id]);
         }
 
         // shiny fx
diff --git a/setup.py b/setup.py
index b933a6fc59..dbf9e848cf 100755
--- a/setup.py
+++ b/setup.py
@@ -73,7 +73,7 @@ dependency_links = [
 
 setup(
     name='sentry',
-    version='4.7.6',
+    version='4.7.7',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/sentry',
