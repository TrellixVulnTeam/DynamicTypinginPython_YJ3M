commit a0e031cf40035d2df187a8ddab49ea4dae64614b
Author: Ben Vinegar <ben@benv.ca>
Date:   Mon Oct 5 17:39:02 2015 -0700

    Use webpack to build less/css (w/ versioning)

diff --git a/package.json b/package.json
index 2ef795ed8a..38d8851c72 100644
--- a/package.json
+++ b/package.json
@@ -10,8 +10,11 @@
     "bootstrap": "^3.3.4",
     "classnames": "^2.1.3",
     "crypto-js": "^3.1.2-5",
+    "css-loader": "^0.19.0",
     "eslint": "^1.5.1",
     "eslint-plugin-react": "^3.3.0",
+    "extract-text-webpack-plugin": "^0.8.2",
+    "file-loader": "^0.8.4",
     "gulp": "^3.8.11",
     "gulp-clean": "^0.3.1",
     "gulp-concat": "^2.4.2",
@@ -21,7 +24,8 @@
     "gulp-watch": "^3.0.0",
     "jquery": "^2.1.3",
     "json-loader": "^0.5.2",
-    "less": "1.7.0",
+    "less": "^2.3.1",
+    "less-loader": "^2.2.1",
     "marked": "^0.3.5",
     "moment": "^2.10.5",
     "moment-timezone": "^0.4.0",
@@ -35,7 +39,9 @@
     "react-sticky": "^2.5.2",
     "reflux": "^0.2.8",
     "select2": "^3.5.1",
+    "style-loader": "^0.12.4",
     "underscore": "^1.8.3",
+    "url-loader": "^0.5.6",
     "webpack": "^1.9.10",
     "webpack-manifest-plugin": "^0.4.0"
   },
diff --git a/src/sentry/static/sentry/less/includes.less b/src/sentry/static/sentry/less/includes.less
index 4366059e91..18b3835ee3 100644
--- a/src/sentry/static/sentry/less/includes.less
+++ b/src/sentry/static/sentry/less/includes.less
@@ -1,9 +1,9 @@
-@import url("includes/bootstrap.less");
-@import url("includes/fonts.less");
-@import url("includes/datepicker.less");
-@import url("includes/github.less");
-@import url("includes/select2.less");
-@import url("includes/pygments.less");
-@import url("includes/simple-slider.less");
-@import url("includes/typeahead.less");
-@import url("includes/animate.less");
+@import url("./includes/bootstrap.less");
+@import url("./includes/fonts.less");
+@import url("./includes/datepicker.less");
+@import url("./includes/github.less");
+@import url("./includes/select2.less");
+@import url("./includes/pygments.less");
+@import url("./includes/simple-slider.less");
+@import url("./includes/typeahead.less");
+@import url("./includes/animate.less");
diff --git a/src/sentry/static/sentry/less/includes/bootstrap.less b/src/sentry/static/sentry/less/includes/bootstrap.less
index c2977b2ae6..b03b976419 100644
--- a/src/sentry/static/sentry/less/includes/bootstrap.less
+++ b/src/sentry/static/sentry/less/includes/bootstrap.less
@@ -1,39 +1,39 @@
-@import "alerts.less";
-@import "breadcrumbs.less";
-@import "buttons.less";
-@import "button-groups.less";
-@import "dropdowns.less";
-@import "normalize.less";
-@import "navs.less";
-@import "print.less";
-@import "type.less";
-@import "code.less";
-@import "tables.less";
-@import "forms.less";
-@import "scaffolding.less";
-@import "grid.less";
-@import "list-group.less";
-@import "tooltip.less";
-@import "modals.less";
-@import "utilities.less";
-@import "responsive-utilities.less";
+@import "~bootstrap/less/alerts.less";
+@import "~bootstrap/less/breadcrumbs.less";
+@import "~bootstrap/less/buttons.less";
+@import "~bootstrap/less/button-groups.less";
+@import "~bootstrap/less/dropdowns.less";
+@import "~bootstrap/less/normalize.less";
+@import "~bootstrap/less/navs.less";
+@import "~bootstrap/less/print.less";
+@import "~bootstrap/less/type.less";
+@import "~bootstrap/less/code.less";
+@import "~bootstrap/less/tables.less";
+@import "~bootstrap/less/forms.less";
+@import "~bootstrap/less/scaffolding.less";
+@import "~bootstrap/less/grid.less";
+@import "~bootstrap/less/list-group.less";
+@import "~bootstrap/less/tooltip.less";
+@import "~bootstrap/less/modals.less";
+@import "~bootstrap/less/utilities.less";
+@import "~bootstrap/less/responsive-utilities.less";
 
-@import (reference) "variables.less";
-@import (reference) "mixins.less";
-@import (reference) "component-animations.less";
-@import (reference) "glyphicons.less";
-@import (reference) "input-groups.less";
-@import (reference) "navbar.less";
-@import (reference) "pagination.less";
-@import (reference) "pager.less";
-@import (reference) "labels.less";
-@import (reference) "badges.less";
-@import (reference) "jumbotron.less";
-@import (reference) "thumbnails.less";
-@import (reference) "progress-bars.less";
-@import (reference) "media.less";
-@import (reference) "panels.less";
-@import (reference) "popovers.less";
-@import (reference) "wells.less";
-@import (reference) "close.less";
-@import (reference) "carousel.less";
+@import (reference) "~bootstrap/less/variables.less";
+@import (reference) "~bootstrap/less/mixins.less";
+@import (reference) "~bootstrap/less/component-animations.less";
+@import (reference) "~bootstrap/less/glyphicons.less";
+@import (reference) "~bootstrap/less/input-groups.less";
+@import (reference) "~bootstrap/less/navbar.less";
+@import (reference) "~bootstrap/less/pagination.less";
+@import (reference) "~bootstrap/less/pager.less";
+@import (reference) "~bootstrap/less/labels.less";
+@import (reference) "~bootstrap/less/badges.less";
+@import (reference) "~bootstrap/less/jumbotron.less";
+@import (reference) "~bootstrap/less/thumbnails.less";
+@import (reference) "~bootstrap/less/progress-bars.less";
+@import (reference) "~bootstrap/less/media.less";
+@import (reference) "~bootstrap/less/panels.less";
+@import (reference) "~bootstrap/less/popovers.less";
+@import (reference) "~bootstrap/less/wells.less";
+@import (reference) "~bootstrap/less/close.less";
+@import (reference) "~bootstrap/less/carousel.less";
diff --git a/src/sentry/static/sentry/less/includes/fonts.less b/src/sentry/static/sentry/less/includes/fonts.less
index 79ec4c571b..308782a889 100644
--- a/src/sentry/static/sentry/less/includes/fonts.less
+++ b/src/sentry/static/sentry/less/includes/fonts.less
@@ -1,22 +1,22 @@
 // Lato
 @font-face{
   font-family: 'Lato';
-  src: url('../fonts/lato-regular.eot');
-  src: url('../fonts/lato-regular.eot') format('embedded-opentype'),
-       url('../fonts/lato-regular.woff') format('woff'),
-       url('../fonts/lato-regular.ttf') format('truetype'),
-       url('../fonts/lato-regular.svg#webfont') format('svg');
+  src: url('../../fonts/lato-regular.eot');
+  src: url('../../fonts/lato-regular.eot') format('embedded-opentype'),
+       url('../../fonts/lato-regular.woff') format('woff'),
+       url('../../fonts/lato-regular.ttf') format('truetype'),
+       url('../../fonts/lato-regular.svg#webfont') format('svg');
   font-weight: normal;
   font-style: normal;
 }
 
 @font-face{
   font-family: 'Lato';
-  src: url('../fonts/lato-bold.eot');
-  src: url('../fonts/lato-bold.eot') format('embedded-opentype'),
-       url('../fonts/lato-bold.woff') format('woff'),
-       url('../fonts/lato-bold.ttf') format('truetype'),
-       url('../fonts/lato-bold.svg#webfont') format('svg');
+  src: url('../../fonts/lato-bold.eot');
+  src: url('../../fonts/lato-bold.eot') format('embedded-opentype'),
+       url('../../fonts/lato-bold.woff') format('woff'),
+       url('../../fonts/lato-bold.ttf') format('truetype'),
+       url('../../fonts/lato-bold.svg#webfont') format('svg');
   font-weight: bold;
   font-style: normal;
 }
@@ -26,12 +26,12 @@
 
 @font-face {
   font-family: 'sentry-simple';
-  src:url('../fonts/sentry-simple.eot?-iwi56z');
-  src:url('../fonts/sentry-simple.eot?#iefix-iwi56z') format('embedded-opentype'),
-    url('../fonts/sentry-simple.woff?-iwi56z') format('woff'),
-    url('../fonts/sentry-simple.woff2?-lhf5py') format('woff2'),
-    url('../fonts/sentry-simple.ttf?-iwi56z') format('truetype'),
-    url('../fonts/sentry-simple.svg?-iwi56z#sentry-simple') format('svg');
+  src:url('../../fonts/sentry-simple.eot?-iwi56z');
+  src:url('../../fonts/sentry-simple.eot?#iefix-iwi56z') format('embedded-opentype'),
+    url('../../fonts/sentry-simple.woff?-iwi56z') format('woff'),
+    url('../../fonts/sentry-simple.woff2?-lhf5py') format('woff2'),
+    url('../../fonts/sentry-simple.ttf?-iwi56z') format('truetype'),
+    url('../../fonts/sentry-simple.svg?-iwi56z#sentry-simple') format('svg');
   font-weight: normal;
   font-style: normal;
 }
diff --git a/src/sentry/static/sentry/less/includes/github.less b/src/sentry/static/sentry/less/includes/github.less
index d7c460aaf0..b13146fb3f 100644
--- a/src/sentry/static/sentry/less/includes/github.less
+++ b/src/sentry/static/sentry/less/includes/github.less
@@ -49,7 +49,7 @@
     height: 14px;
     margin-right: 4px;
     vertical-align: middle;
-    background: url(../images/github-icons.png) no-repeat 0 0;
+    background: url(../../images/github-icons.png) no-repeat 0 0;
     .opacity(65);
 }
 .gh-count {
diff --git a/src/sentry/static/sentry/less/includes/select2.less b/src/sentry/static/sentry/less/includes/select2.less
index 24e8639a8e..254e9cbfda 100644
--- a/src/sentry/static/sentry/less/includes/select2.less
+++ b/src/sentry/static/sentry/less/includes/select2.less
@@ -405,9 +405,9 @@ disabled look for disabled choices in the results dropdown
   display: none;
 }
 
-.select2-more-results.select2-active {
-  background: #f4f4f4 url('select2-spinner.gif') no-repeat 100%;
-}
+// .select2-more-results.select2-active {
+//   background: #f4f4f4 url('~select2/select2-spinner.gif') no-repeat 100%;
+// }
 
 .select2-results .select2-ajax-error {
   background: rgba(255, 50, 50, .2);
@@ -499,9 +499,9 @@ html[dir="rtl"] .select2-container-multi .select2-choices li {
   background: transparent !important;
 }
 
-.select2-container-multi .select2-choices .select2-search-field input.select2-active {
-  background: #fff url('select2-spinner.gif') no-repeat 100% !important;
-}
+// .select2-container-multi .select2-choices .select2-search-field input.select2-active {
+//   background: #fff url('select2-spinner.gif') no-repeat 100% !important;
+// }
 
 .select2-container-multi .select2-choices .select2-search-choice {
   padding: 3px 5px 3px 18px;
diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 44b98f4217..befea737e4 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -1,18 +1,19 @@
-@import url("includes.less");
-@import url("variables.less");
-@import url("type.less");
-@import url("layout.less");
-@import url("forms.less");
-@import url("shared-components.less");
-@import url("stream.less");
-@import url("group-detail.less");
-@import url("releases.less");
-@import url("dashboard.less");
-@import url("organization.less");
-@import url("project-settings.less");
-@import url("docs.less");
-@import url("auth.less");
-@import url("misc.less");
-@import url("admin.less");
+@import url("./includes.less");
+@import url("./variables.less");
+@import url("./type.less");
+@import url("./layout.less");
+@import url("./forms.less");
+@import url("./shared-components.less");
+@import url("./stream.less");
+@import url("./group-detail.less");
+@import url("./releases.less");
+@import url("./dashboard.less");
+@import url("./organization.less");
+@import url("./project-settings.less");
+@import url("./docs.less");
+@import url("./auth.less");
+@import url("./misc.less");
+@import url("./admin.less");
+
+@import "~platformicons/platformicons/platformicons.css";
 
-@import "platformicons.css";
diff --git a/webpack.config.js b/webpack.config.js
index 35cfb7ae30..5f76e6ddff 100644
--- a/webpack.config.js
+++ b/webpack.config.js
@@ -1,7 +1,8 @@
 /*eslint-env node*/
 var path = require("path"),
     webpack = require("webpack"),
-    ManifestPlugin = require('webpack-manifest-plugin');
+    ManifestPlugin = require('webpack-manifest-plugin'),
+    ExtractTextPlugin = require("extract-text-webpack-plugin");
 
 var staticPrefix = "src/sentry/static/sentry",
     distPath = staticPrefix + "/dist";
@@ -13,15 +14,17 @@ var staticPrefix = "src/sentry/static/sentry",
 //   [name].js => [name].[chunkhash].js (in production)
 //   [name].js => [name].js (unaltered in dev)
 
-function fileFormatForEnv(file) {
+function fileFormatForEnv(file, attr) {
+  attr = attr || '[chunkhash]';
   return process.env.NODE_ENV === 'production' ?
-    file.replace(/\.(\w+)$/, '.[chunkhash].$1') :
+    file.replace(/\.([\w\[\]]+)$/, '.' + attr + '.$1') :
     file;
 }
 
 var config = {
   context: path.join(__dirname, staticPrefix),
   entry: {
+    // js
     "app": "app",
     "vendor": [
       "babel-core/polyfill",
@@ -46,7 +49,13 @@ var config = {
       "flot/jquery.flot.time",
       "flot-tooltip/jquery.flot.tooltip",
       "vendor/simple-slider/simple-slider"
-    ]
+    ],
+
+    // css
+    // NOTE: this will also create an empty "sentry.js" file
+    // TODO: figure out how to not generate this
+    "sentry": "less/sentry.less"
+
   },
   module: {
     loaders: [
@@ -59,6 +68,15 @@ var config = {
       {
         test: /\.json$/,
         loader: "json-loader"
+      },
+      {
+        test: /\.less$/,
+        include: path.join(__dirname, staticPrefix),
+        loader: ExtractTextPlugin.extract("style-loader", "css-loader!less-loader")
+      },
+      {
+        test: /\.(woff|woff2|ttf|eot|svg|png|gif|ico|jpg)($|\?)/,
+        loader: 'file-loader?name=' + fileFormatForEnv('[name].[ext]', '[hash]')
       }
     ]
   },
@@ -72,7 +90,8 @@ var config = {
       "root.jQuery": "jquery",
       Raven: "raven-js"
     }),
-    new ManifestPlugin() // writes manifest.json to output directory
+    new ManifestPlugin(), // writes manifest.json to output directory
+    new ExtractTextPlugin(fileFormatForEnv("[name].css"))
   ],
   resolve: {
     alias: {
