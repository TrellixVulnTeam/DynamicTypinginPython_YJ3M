commit ae5b4ed835e232a88db3fa54db888a078adacde8
Author: Mark Story <mark@mark-story.com>
Date:   Fri Apr 5 11:18:51 2019 -0400

    fix(apidocs) Update the api-docs to use postgres (#12649)
    
    With the removal of SQLite from our supported database types we need to
    update the apidocs generation tool to not use sqlite.
    
    Don't drop the database at the end of the run as it causes error,
    instead leave data behind and start fresh each time.

diff --git a/api-docs/generator.py b/api-docs/generator.py
index be2ddb6ad3..361e6d023e 100644
--- a/api-docs/generator.py
+++ b/api-docs/generator.py
@@ -8,8 +8,7 @@ import logging
 import six
 
 from datetime import datetime
-from subprocess import Popen, PIPE
-from contextlib import contextmanager
+from subprocess import Popen, PIPE, check_output
 from six.moves.urllib.parse import urlparse
 
 HERE = os.path.abspath(os.path.dirname(__file__))
@@ -78,18 +77,6 @@ def spawn_sentry():
     return cl
 
 
-@contextmanager
-def management_connection():
-    from sqlite3 import connect
-    cfg = settings.DATABASES['default']
-    con = connect(cfg['NAME'])
-    try:
-        con.cursor()
-        yield con
-    finally:
-        con.close()
-
-
 def init_db():
     drop_db()
     report('db', 'Migrating database (this can take some time)')
@@ -99,10 +86,13 @@ def init_db():
 
 def drop_db():
     report('db', 'Dropping database')
-    try:
-        os.remove(settings.DATABASES['default']['NAME'])
-    except (OSError, IOError):
-        pass
+    config = settings.DATABASES['default']
+    check_output([
+        'dropdb', '-U', config['USER'], '-h', config['HOST'], config['NAME']
+    ])
+    check_output([
+        'createdb', '-U', config['USER'], '-h', config['HOST'], config['NAME']
+    ])
 
 
 class SentryBox(object):
@@ -127,7 +117,6 @@ class SentryBox(object):
             report('redis', 'Stopping redis server')
             self.redis.kill()
             self.redis.wait()
-        drop_db()
 
 
 def run_scenario(vars, scenario_ident, func):
diff --git a/api-docs/sentry.conf.py b/api-docs/sentry.conf.py
index 2886756ee8..92ea7897d8 100644
--- a/api-docs/sentry.conf.py
+++ b/api-docs/sentry.conf.py
@@ -19,8 +19,11 @@ CONF_ROOT = os.path.dirname(__file__)
 
 DATABASES = {
     'default': {
-        'ENGINE': 'django.db.backends.sqlite3',
-        'NAME': '/tmp/sentry_apidocs.db',
+        'ENGINE': 'sentry.db.postgres',
+        'NAME': 'sentry_api_docs',
+        'USER': 'postgres',
+        'PASSWORD': '',
+        'HOST': '127.0.0.1',
     }
 }
 SENTRY_USE_BIG_INTS = True
