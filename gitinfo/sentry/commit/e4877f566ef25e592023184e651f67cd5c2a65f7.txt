commit e4877f566ef25e592023184e651f67cd5c2a65f7
Author: Alex Hofsteede <alex@hofsteede.com>
Date:   Mon Apr 29 14:25:03 2019 -0700

    fix: don't incr empty list (#12984)
    
    fixes SENTRY-AKS, SENTRY-AKR

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 6cdc18c422..95d4ec932a 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -379,10 +379,9 @@ def track_outcome(org_id, project_id, key_id, outcome, reason=None, timestamp=No
     if reason in FILTER_STAT_KEYS_TO_VALUES:
         increment_list.append((FILTER_STAT_KEYS_TO_VALUES[reason], project_id))
 
-    tsdb.incr_multi(
-        [(model, key) for model, key in increment_list if key is not None],
-        timestamp=timestamp,
-    )
+    increment_list = [(model, key) for model, key in increment_list if key is not None]
+    if increment_list:
+        tsdb.incr_multi(increment_list, timestamp=timestamp)
 
     # Send a snuba metrics payload.
     if random.random() <= options.get('snuba.track-outcomes-sample-rate'):
diff --git a/src/sentry/tasks/store.py b/src/sentry/tasks/store.py
index a3ccd69729..86122ffb0b 100644
--- a/src/sentry/tasks/store.py
+++ b/src/sentry/tasks/store.py
@@ -453,7 +453,7 @@ def _do_save_event(cache_key=None, data=None, start_time=None, event_id=None,
     if project_id is None:
         project_id = data.pop('project')
 
-    key_id = data.get('key_id')
+    key_id = None if data is None else data.get('key_id')
     timestamp = to_datetime(start_time) if start_time is not None else None
 
     delete_raw_event(project_id, event_id, allow_hint_clear=True)
