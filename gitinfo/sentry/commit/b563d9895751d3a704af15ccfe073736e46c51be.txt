commit b563d9895751d3a704af15ccfe073736e46c51be
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Sat May 6 01:58:07 2017 +0200

    Added support for more partial data in the apple crash report
    
    This fixes SENTRY-309

diff --git a/src/sentry/lang/native/applecrashreport.py b/src/sentry/lang/native/applecrashreport.py
index fd690fbae4..e19c954168 100644
--- a/src/sentry/lang/native/applecrashreport.py
+++ b/src/sentry/lang/native/applecrashreport.py
@@ -38,49 +38,24 @@ class AppleCrashReport(object):
         rv = []
         if self.exception and self.exception[0]:
             # We only have one exception at a time
-            exception = self.exception[0]
-            signal = ''
-            if (exception
-                .get('mechanism', {})
-                .get('posix_signal', {})
-                .get('name')
-               ):
-                signal = ' (%s)' % \
-                    exception['mechanism']['posix_signal']['name']
-
-            name = ''
-            if (exception
-                .get('mechanism', {})
-                .get('mach_exception', {})
-                .get('exception_name')
-               ):
-                name = exception['mechanism']['mach_exception']['exception_name']
+            exception = self.exception[0] or {}
+            mechanism = exception.get('mechanism') or {}
+
+            signal = (mechanism.get('posix_signal') or {}).get('name')
+            name = (mechanism.get('mach_exception') or {}).get('exception_name')
 
             if name or signal:
                 rv.append('Exception Type: %s%s' % (
-                    name,
-                    signal
+                    name or 'Unknown',
+                    signal and (' (%s)' % signal) or '',
                 ))
 
-            exc_name = ''
-            if (exception
-                .get('mechanism', {})
-                .get('posix_signal', {})
-                .get('code_name')
-               ):
-                exc_name = exception['mechanism']['posix_signal']['code_name']
-
-            exc_addr = ''
-            if (exception
-                .get('mechanism', {})
-                .get('relevant_address')
-               ):
-                exc_addr = ' at %s' % exception['mechanism']['relevant_address']
-
-            if exc_name and exc_addr:
+            exc_name = (mechanism.get('posix_signal') or {}).get('code_name')
+            exc_addr = mechanism.get('relevant_address')
+            if exc_name:
                 rv.append('Exception Codes: %s%s' % (
                     exc_name,
-                    exc_addr
+                    exc_addr is not None and (' at %s' % exc_addr) or '',
                 ))
 
             if exception.get('thread_id') is not None:
diff --git a/tests/sentry/lang/native/test_applecrashreport.py b/tests/sentry/lang/native/test_applecrashreport.py
index 708f4be5a4..06764b84a6 100644
--- a/tests/sentry/lang/native/test_applecrashreport.py
+++ b/tests/sentry/lang/native/test_applecrashreport.py
@@ -411,3 +411,20 @@ Exception Codes: BUS_NOOP at 0x10\n\
 Crashed Thread: 0\n\n\
 Application Specific Information:\n\
 Attempted to dereference garbage pointer 0x10.'
+
+
+def test__get_exception_info_partial():
+    acr = AppleCrashReport(exception=[{
+        "value": "Attempted to dereference garbage pointer 0x10.",
+        "mechanism": {
+            "posix_signal": None,
+            "mach_exception": None,
+        },
+        "type": "EXC_BAD_ACCESS",
+        "thread_id": 0
+    }])
+    exception_info = acr._get_exception_info()
+    assert exception_info == '\
+Crashed Thread: 0\n\n\
+Application Specific Information:\n\
+Attempted to dereference garbage pointer 0x10.'
