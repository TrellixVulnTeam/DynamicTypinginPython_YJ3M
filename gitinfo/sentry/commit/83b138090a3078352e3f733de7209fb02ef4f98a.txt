commit 83b138090a3078352e3f733de7209fb02ef4f98a
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Thu Feb 6 22:04:15 2020 +0300

    build(docker): Make chown logic smarter in entrypoint (#16852)
    
    Implements the logic from https://git.io/JvZ1G which @mattrobenolt brought up recently.

diff --git a/docker/docker-entrypoint.sh b/docker/docker-entrypoint.sh
index 2142b52d9d..222bf9b5f0 100755
--- a/docker/docker-entrypoint.sh
+++ b/docker/docker-entrypoint.sh
@@ -16,7 +16,10 @@ if [ "$1" = 'sentry' ]; then
 	set -- tini -- "$@"
 	if [ "$(id -u)" = '0' ]; then
 		mkdir -p /data/files
-		find /data ! -user sentry -exec chown sentry {} \;
+		sentry_uid=$(id -u sentry)
+		if [ "$(stat -c %u /data)" != "$sentry_uid" || "$(stat -c %u /data/files)" != "$sentry_uid" ]; then
+			find /data ! -user sentry -exec chown sentry {} \;
+		fi
 		set -- gosu sentry "$@"
 	fi
 fi
