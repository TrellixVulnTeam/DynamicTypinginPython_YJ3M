commit ba7122a7e3b8222bd656bc592a5f3281a637e752
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Sat Apr 12 11:16:48 2014 -0400

    Do this in a better way

diff --git a/src/sentry/tasks/fetch_source.py b/src/sentry/tasks/fetch_source.py
index 2d7ba1360e..aaaae9e736 100644
--- a/src/sentry/tasks/fetch_source.py
+++ b/src/sentry/tasks/fetch_source.py
@@ -355,10 +355,7 @@ def expand_javascript_source(data, **kwargs):
                 frame.function = last_state.name if last_state else state.name
                 frame.abs_path = abs_path
                 frame.filename = state.src
-                if state.src is None:
-                    frame.module = UNKNOWN_MODULE
-                else:
-                    frame.module = generate_module(state.src) or UNKNOWN_MODULE
+                frame.module = generate_module(state.src)
         elif sourcemap in sourmap_idxs:
             frame.data = {
                 'sourcemap': sourcemap,
@@ -391,7 +388,9 @@ def generate_module(src):
 
     e.g. http://google.com/js/v1.0/foo/bar/baz.js -> foo/bar/baz
     """
-    return CLEAN_MODULE_RE.sub('', splitext(urlsplit(src).path)[0])
+    if src is None:
+        return UNKNOWN_MODULE
+    return CLEAN_MODULE_RE.sub('', splitext(urlsplit(src).path)[0]) or UNKNOWN_MODULE
 
 
 def generate_culprit(frame):
diff --git a/tests/sentry/tasks/fetch_source/tests.py b/tests/sentry/tasks/fetch_source/tests.py
index 766fd5d46b..10ebd102cd 100644
--- a/tests/sentry/tasks/fetch_source/tests.py
+++ b/tests/sentry/tasks/fetch_source/tests.py
@@ -124,6 +124,7 @@ class ExpandJavascriptSourceTest(TestCase):
 
 class GenerateModuleTest(TestCase):
     def test_simple(self):
+        assert generate_module(None) == '<unknown module>'
         assert generate_module('http://example.com/foo.js') == 'foo'
         assert generate_module('http://example.com/foo/bar.js') == 'foo/bar'
         assert generate_module('http://example.com/js/foo/bar.js') == 'foo/bar'
