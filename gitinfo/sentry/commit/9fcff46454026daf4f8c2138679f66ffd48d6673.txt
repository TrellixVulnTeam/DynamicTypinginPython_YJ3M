commit 9fcff46454026daf4f8c2138679f66ffd48d6673
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Fri Dec 18 20:28:00 2015 +0100

    I think this adds metrics for jobs.delay

diff --git a/src/sentry/celery.py b/src/sentry/celery.py
index 9512c5a1fd..90bde8aa91 100644
--- a/src/sentry/celery.py
+++ b/src/sentry/celery.py
@@ -14,6 +14,8 @@ if not settings.configured:
     from sentry.runner import configure
     configure()
 
+from sentry.utils import metrics
+
 
 class Celery(celery.Celery):
     def on_configure(self):
@@ -29,6 +31,20 @@ class Celery(celery.Celery):
 
 app = Celery('sentry')
 
+
+OriginalTask = app.Task
+
+
+class SentryTask(OriginalTask):
+
+    def delay(self, *args, **kwargs):
+        key = 'jobs.delay'
+        instance = self.name
+        with metrics.timer(key, instance=instance):
+            return OriginalTask.delay(self, *args, **kwargs)
+
+app.Task = SentryTask
+
 # Using a string here means the worker will not have to
 # pickle the object when using Windows.
 app.config_from_object(settings)
