commit 254ad59e6c32c13d11648ca9eecd057e6a6a63a8
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Sep 7 10:08:36 2018 -0700

    feat(security): Generate a notice when a new auth token is created

diff --git a/src/sentry/api/endpoints/api_tokens.py b/src/sentry/api/endpoints/api_tokens.py
index ed13fe30c4..70a3461181 100644
--- a/src/sentry/api/endpoints/api_tokens.py
+++ b/src/sentry/api/endpoints/api_tokens.py
@@ -9,6 +9,7 @@ from sentry.api.base import Endpoint, SessionAuthentication
 from sentry.api.fields import MultipleChoiceField
 from sentry.api.serializers import serialize
 from sentry.models import ApiToken
+from sentry.security import capture_security_activity
 
 
 class ApiTokenSerializer(serializers.Serializer):
@@ -45,6 +46,15 @@ class ApiTokensEndpoint(Endpoint):
                 expires_at=None,
             )
 
+            capture_security_activity(
+                account=request.user,
+                type='api-token-generated',
+                actor=request.user,
+                ip_address=request.META['REMOTE_ADDR'],
+                context={},
+                send_email=True
+            )
+
             return Response(serialize(token, request.user), status=201)
         return Response(serializer.errors, status=400)
 
diff --git a/src/sentry/security/emails.py b/src/sentry/security/emails.py
index 5ee225d841..c59df1668d 100644
--- a/src/sentry/security/emails.py
+++ b/src/sentry/security/emails.py
@@ -24,6 +24,9 @@ def generate_security_email(account, type, actor, ip_address, context=None, curr
     elif type == 'recovery-codes-regenerated':
         template = 'sentry/emails/recovery-codes-regenerated.txt'
         html_template = 'sentry/emails/recovery-codes-regenerated.html'
+    elif type == 'api-token-generated':
+        template = 'sentry/emails/api-token-generated.txt'
+        html_template = 'sentry/emails/api-token-generated.html'
     else:
         raise ValueError(u'unknown type: {}'.format(type))
 
diff --git a/src/sentry/templates/sentry/emails/api-token-generated.html b/src/sentry/templates/sentry/emails/api-token-generated.html
new file mode 100644
index 0000000000..22dbeb0102
--- /dev/null
+++ b/src/sentry/templates/sentry/emails/api-token-generated.html
@@ -0,0 +1,5 @@
+{% extends "sentry/emails/security_base.html" %}
+
+{% block security_body %}
+  <p>A new API token was created for your Sentry account.</p>
+{% endblock %}
diff --git a/src/sentry/templates/sentry/emails/api-token-generated.txt b/src/sentry/templates/sentry/emails/api-token-generated.txt
new file mode 100644
index 0000000000..008eb26dc3
--- /dev/null
+++ b/src/sentry/templates/sentry/emails/api-token-generated.txt
@@ -0,0 +1,5 @@
+{% extends "sentry/emails/security_base.txt" %}
+
+{% block security_body %}
+A new API token was created for your Sentry account.
+{% endblock %}
