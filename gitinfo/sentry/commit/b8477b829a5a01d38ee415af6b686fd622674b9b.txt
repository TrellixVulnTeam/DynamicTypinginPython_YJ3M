commit b8477b829a5a01d38ee415af6b686fd622674b9b
Author: Katie Lundsgaard <katie@getsentry.com>
Date:   Thu Apr 20 11:04:19 2017 -0700

    Group commits by repository (#5259)

diff --git a/src/sentry/api/serializers/models/commit.py b/src/sentry/api/serializers/models/commit.py
index 32d4b41c74..e929de0d35 100644
--- a/src/sentry/api/serializers/models/commit.py
+++ b/src/sentry/api/serializers/models/commit.py
@@ -1,5 +1,7 @@
 from __future__ import absolute_import
 
+import six
+
 from sentry.api.serializers import Serializer, register, serialize
 from sentry.models import Commit, Repository
 from sentry.api.serializers.models.release import get_users_for_commits
@@ -11,13 +13,14 @@ class CommitSerializer(Serializer):
         author_objs = get_users_for_commits(item_list)
 
         repositories = list(Repository.objects.filter(id__in=[c.repository_id for c in item_list]))
+        repositories = serialize(repositories)
         repository_objs = {}
         for repository in repositories:
-            repository_objs[repository.id] = serialize(repository)
+            repository_objs[repository['id']] = repository
         result = {}
         for item in item_list:
             result[item] = {
-                'repository': repository_objs.get(item.repository_id, {}),
+                'repository': repository_objs.get(six.text_type(item.repository_id), {}),
                 'user': author_objs.get(item.author_id, {})
             }
 
diff --git a/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx b/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
index 29c0990c0b..3a217df1ab 100644
--- a/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
+++ b/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
@@ -4,7 +4,8 @@ import LoadingIndicator from '../../components/loadingIndicator';
 import LoadingError from '../../components/loadingError';
 import Avatar from '../../components/avatar';
 import TimeSince from '../../components/timeSince';
-
+import DropdownLink from '../../components/dropdownLink';
+import MenuItem from '../../components/menuItem';
 import ApiMixin from '../../mixins/apiMixin';
 
 import {t} from '../../locale';
@@ -50,7 +51,7 @@ const ReleaseCommit = React.createClass({
     return (
       <li className="list-group-item" key={this.props.commitId}>
         <div className="row row-center-vertically">
-          <div className="col-xs-8 list-group-avatar">
+          <div className="col-xs-10 list-group-avatar">
             <Avatar user={this.props.author} />
             <h5>{this.props.commitMessage || t('No message provided')}</h5>
             <p>
@@ -61,9 +62,6 @@ const ReleaseCommit = React.createClass({
               <TimeSince date={this.props.commitDateCreated} />
             </p>
           </div>
-          <div className="col-xs-2">
-            <span className="repo-label">{this.props.repository.name}</span>
-          </div>
           <div className="col-xs-2 align-right">
             <CommitLink
               commitId={this.props.commitId}
@@ -83,7 +81,8 @@ const ReleaseCommits = React.createClass({
     return {
       loading: true,
       error: false,
-      commitList: []
+      commitList: [],
+      activeRepo: null
     };
   },
 
@@ -121,32 +120,40 @@ const ReleaseCommits = React.createClass({
     );
   },
 
-  render() {
-    if (this.state.loading) return <LoadingIndicator />;
-
-    if (this.state.error) return <LoadingError />;
+  setActiveRepo(repo) {
+    this.setState({
+      activeRepo: repo
+    });
+  },
 
+  getCommitsByRepository() {
     let {commitList} = this.state;
+    let commitsByRepository = commitList.reduce(function(cbr, commit) {
+      let {repository} = commit;
+      if (!cbr.hasOwnProperty(repository.name)) {
+        cbr[repository.name] = [];
+      }
 
-    if (!commitList.length) return <this.emptyState />;
+      cbr[repository.name].push(commit);
+      return cbr;
+    }, {});
+    return commitsByRepository;
+  },
 
+  renderCommitsForRepo(repo) {
+    let commitsByRepository = this.getCommitsByRepository();
+    let activeCommits = commitsByRepository[repo];
     return (
       <div className="panel panel-default">
         <div className="panel-heading panel-heading-bold">
           <div className="row">
-            <div className="col-xs-8">
-              Commit
-            </div>
-            <div className="col-xs-2">
-              Repository
-            </div>
-            <div className="col-xs-2 align-right">
-              SHA
+            <div className="col-xs-12">
+              {repo}
             </div>
           </div>
         </div>
         <ul className="list-group list-group-lg commit-list">
-          {commitList.map(commit => {
+          {activeCommits.map(commit => {
             return (
               <ReleaseCommit
                 key={commit.id}
@@ -161,8 +168,73 @@ const ReleaseCommits = React.createClass({
         </ul>
       </div>
     );
+  },
+
+  render() {
+    if (this.state.loading) return <LoadingIndicator />;
+
+    if (this.state.error) return <LoadingError />;
+
+    let {commitList, activeRepo} = this.state;
+
+    if (!commitList.length) return <this.emptyState />;
+    let commitsByRepository = this.getCommitsByRepository();
+    return (
+      <div>
+        <div className="heading">
+          {Object.keys(commitsByRepository).length > 1
+            ? <div className="commits-dropdown align-left">
+                <div className="commits-dropdowng">
+                  <DropdownLink
+                    caret={false}
+                    title={
+                      <h5>
+                        {this.state.activeRepo || 'All Repositories'}
+                        <span
+                          className="icon-arrow-down dropdown"
+                          style={{marginLeft: 3, marginRight: -3}}
+                        />
+                      </h5>
+                    }
+                  >
+                    <MenuItem
+                      key="all"
+                      noAnchor={true}
+                      onClick={() => {
+                        this.setActiveRepo(null);
+                      }}
+                      isActive={this.state.activeRepo === null}
+                    >
+                      <a>All Repositories</a>
+                    </MenuItem>
+                    {Object.keys(commitsByRepository).map(repository => {
+                      return (
+                        <MenuItem
+                          key={commitsByRepository[repository].id}
+                          noAnchor={true}
+                          onClick={() => {
+                            this.setActiveRepo(repository);
+                          }}
+                          isActive={this.state.activeRepo === repository}
+                        >
+                          <a>{repository}</a>
+                        </MenuItem>
+                      );
+                    })}
+                  </DropdownLink>
+                </div>
+              </div>
+            : null}
+        </div>
+        {activeRepo
+          ? this.renderCommitsForRepo(activeRepo)
+          : Object.keys(commitsByRepository).map(repository => {
+              return this.renderCommitsForRepo(repository);
+            })}
+      </div>
+    );
   }
 });
 
 export default ReleaseCommits;
-export {ReleaseCommits, CommitLink};
+export {ReleaseCommit, CommitLink};
diff --git a/src/sentry/static/sentry/less/releases.less b/src/sentry/static/sentry/less/releases.less
index 9a95da7b06..258cc6cc36 100644
--- a/src/sentry/static/sentry/less/releases.less
+++ b/src/sentry/static/sentry/less/releases.less
@@ -111,3 +111,23 @@
     margin: 0 0 4px 4px;
   }
 }
+
+/**
+* Commits Tab
+* ============================================================================
+*/
+
+.commits-dropdown {
+  padding-left: 0;
+  a {
+    color: @gray-darkest;
+  }
+
+  span.dropdown {
+    display:inline;
+  }
+
+  .dropdown-menu {
+    top: -4px;
+  }
+}
\ No newline at end of file
