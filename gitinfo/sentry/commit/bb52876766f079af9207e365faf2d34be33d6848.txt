commit bb52876766f079af9207e365faf2d34be33d6848
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Oct 23 14:15:58 2011 -0700

    More general cleanup and working interface templates

diff --git a/sentry/conf/server.py b/sentry/conf/server.py
index d724f6ec93..ae402ac030 100644
--- a/sentry/conf/server.py
+++ b/sentry/conf/server.py
@@ -115,6 +115,5 @@ SENTRY_SEARCH_ENGINE = 'whoosh'
 SENTRY_SEARCH_OPTIONS = {
     'path': os.path.join(PROJECT_ROOT, 'sentry_index'),
 }
-
-
-SENTRY_PUBLIC = True
\ No newline at end of file
+SENTRY_PUBLIC = True
+SENTRY_PROJECT = 1
\ No newline at end of file
diff --git a/sentry/interfaces.py b/sentry/interfaces.py
index 2d1b8e5b81..7bb9092c10 100644
--- a/sentry/interfaces.py
+++ b/sentry/interfaces.py
@@ -104,7 +104,7 @@ class Stacktrace(Interface):
         }
 
     def to_html(self, event):
-        return render_to_string('sentry/partial/interfaces/stacktrace.html', **{
+        return render_to_string('sentry/partial/interfaces/stacktrace.html', {
             'frames': self.frames,
         })
 
@@ -126,7 +126,7 @@ class Exception(Interface):
         }
 
     def to_html(self, event):
-        return render_to_string('sentry/partial/interfaces/exception.html', **{
+        return render_to_string('sentry/partial/interfaces/exception.html', {
             'exception_value': self.value,
             'exception_type': self.type,
         })
@@ -181,7 +181,7 @@ class Http(Interface):
         }
 
     def to_html(self, event):
-        return render_to_string('sentry/partial/interfaces/http.html', **{
+        return render_to_string('sentry/partial/interfaces/http.html', {
             'full_url': '?'.join(filter(None, [self.url, self.query_string])),
             'url': self.url,
             'method': self.method,
@@ -224,11 +224,12 @@ class Template(Interface):
         }
 
     def to_html(self, event):
-        return render_to_string('sentry/partial/interfaces/template.html', **{
+        return render_to_string('sentry/partial/interfaces/template.html', {
             'filename': self.filename,
             'context_line': self.context_line,
             'lineno': self.lineno,
             'pre_context': self.pre_context,
+            'pre_context_lineno': self.lineno - len(self.pre_context),
             'post_context': self.post_context,
         })
 
diff --git a/sentry/templates/sentry/group/details.html b/sentry/templates/sentry/group/details.html
index f7333b9145..fbc77344d3 100644
--- a/sentry/templates/sentry/group/details.html
+++ b/sentry/templates/sentry/group/details.html
@@ -74,36 +74,11 @@
     </ul>
 
     {% block inner %}
-        <div id="details">
-            <div id="summary">
-                <h3>{% if exception_type %}{{ exception_type }}: {{ exception_value|escape }}{% else %}Summary{% endif %}</h3>
-                <table class="meta">
-                    {% if exception_type %}
-                        <tr>
-                          <th>Exception Value:</th>
-                          <td><pre>{{ exception_value|escape }}</pre></td>
-                        </tr>
-                    {% endif %}
-                    {% if group.data.url %}
-                        <tr>
-                          <th>URL:</th>
-                          <td><a href="{{ group.data.url }}">{{ group.data.url|truncatechars:100 }}</a></td>
-                        </tr>
-                    {% endif %}
-                    {% if lastframe %}
-                        <tr>
-                          <th>Location:</th>
-                          <td>{{ lastframe.filename|escape }} in {{ lastframe.function|escape }}, line {{ lastframe.lineno }}</td>
-                        </tr>
-                    {% endif %}
-                    {% if group.has_two_part_message %}
-                        <tr>
-                          <th>Full Message</th>
-                          <td><pre id="full-message">{{ group.message }}</pre></td>
-                        </tr>
-                    {% endif %}
-                </table>
-            </div>
+        {% if group.has_two_part_message %}
+            <h2>{% trans "Full Message" %}</h2>
+            <pre id="full-message">{{ group.message }}</pre>
+        {% endif %}
+
 
             {% if version_data %}
                 <div id="versioninfo" class="module">
@@ -121,77 +96,9 @@
                 </div>
             {% endif %}
 
-            {% if template_info %}
-                <div id="template" class="module">
-                    <h2>Template error</h2>
-                    <div class="module-content">
-                        <p>In template <code>{{ template_info.name }}</code>, error at line <strong>{{ template_info.line }}</strong></p>
-                        <h3>{{ template_info.message }}</h3>
-                        <ol>
-                        {% for source_line in template_info.source_lines %}
-                            <li class="{% if source_line.0 == template_info.line %} selected{% endif %}" value="{{ source_line.0 }}">
-                            {% if source_line.0 == template_info.line %}
-                                <pre>{{ template_info.before }}<span class="specific">{{ template_info.during }}</span>{{ template_info.after }}</pre>
-                            {% else %}
-                                <pre>{{ source_line.1 }}</pre>
-                            {% endif %}
-                        {% endfor %}
-                        </table>
-                    </div>
-                </div>
-            {% endif %}
-
-            {% if frames %}
-                <div id="traceback" class="module">
-                    <h2>Traceback</h2>
-                    <div class="module-content">
-                        {% autoescape off %}
-                        <div id="browserTraceback">
-                        <ul class="traceback">
-                          {% for frame in frames %}
-                            <li class="frame">
-                              <code>{{ frame.filename|escape }}</code> in <code>{{ frame.function|escape }}</code>
-
-                              {% if frame.context_line %}
-                                <div class="context" id="c{{ frame.id }}">
-                                  {% if frame.pre_context %}
-                                    <ol start="{{ frame.pre_context_lineno }}" class="pre-context" id="pre{{ frame.id }}">{% for line in frame.pre_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
-                                  {% endif %}
-                                  <ol start="{{ frame.lineno }}" class="context-line"><li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ frame.context_line|escape }} <span>...</span></li></ol>
-                                  {% if frame.post_context %}
-                                    <ol start='{{ frame.lineno|plus:1 }}' class="post-context" id="post{{ frame.id }}">{% for line in frame.post_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
-                                  {% endif %}
-                                </div>
-                              {% endif %}
-                              <div class="commands">
-                                <a href="#" onclick="return varToggle(this, '{{ frame.id }}')"><span>&#x25b6;</span> Local vars</a>
-                              </div>
-                              <table class="vars" id="v{{ frame.id }}">
-                                <thead>
-                                  <tr>
-                                    <th>Variable</th>
-                                    <th>Value</th>
-                                  </tr>
-                                </thead>
-                                <tbody>
-                                {% if frame.vars %}
-                                  {% for var in frame.vars|dictsort:"0" %}
-                                    <tr>
-                                      <td>{{ var.0|escape }}</td>
-                                      <td class="code"><pre>{{ var.1|pprint|escape }}</pre></td>
-                                    </tr>
-                                  {% endfor %}
-                                {% endif %}
-                                </tbody>
-                              </table>
-                            </li>
-                          {% endfor %}
-                        </ul>
-                        </div>
-                        {% endautoescape %}
-                    </div>
-                </div>
-            {% endif %}
+            {% for interface in interface_list %}
+                {{ interface }}
+            {% endfor %}
 
             {% if group|has_charts %}
                 <div class="module">
@@ -205,33 +112,11 @@
                 </div>
             {% endif %}
 
+            {% if json_data %}
             <div id="requestinfo" class="module">
                 <h2>{% trans "Additional Data" %}</h2>
                 <div class="module-content">
                     <table>
-                        {% if user_data %}
-                            <tr>
-                                <th class="key">USER</th>
-                                <td class="values">
-                                    <table class="vars">
-                                        <thead>
-                                            <tr>
-                                                <th>{% trans "Variable" %}</th>
-                                                <th>{% trans "Value" %}</th>
-                                            </tr>
-                                        </thead>
-                                        <tbody>
-                                            {% for k_, v_ in user_data.iteritems|as_sorted %}
-                                            <tr>
-                                                <td>{{ k_ }}</td>
-                                                <td class="code"><pre>{{ v_|pprint }}</pre></td>
-                                            </tr>
-                                            {% endfor %}
-                                        </tbody>
-                                    </table>
-                                </td>
-                            </tr>
-                        {% endif %}
                         {% for k, v in json_data %}
                             <tr>
                                 <th class="key">{{ k }}</th>
@@ -265,6 +150,7 @@
                         {% endfor %}
                     </table>
                 </div>
+                {% endif %}
             </div>
         </div>
     {% endblock %}
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index e7486db5f3..03137e1816 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -5,7 +5,7 @@
     <h3><a href="{% url sentry-group group.project_id group.pk %}">{% if group.view %}{{ group.view }}{% else %}{{ group.message_top|truncatechars:100 }}{% endif %}</a></h3>
     <span class="last_seen">{{ group.last_seen|timesince }}</span>
     <span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
-    <p class="message">
+    <p class="message" title="{{ group.message }}">
         <span class="tag tag-level">{{ group.get_level_display }}</span>
         <span class="tag tag-logger">{{ group.logger }}</span>
         {% with group.get_version as version %}
diff --git a/sentry/templates/sentry/partial/interfaces/exception.html b/sentry/templates/sentry/partial/interfaces/exception.html
index e69de29bb2..e123d55653 100644
--- a/sentry/templates/sentry/partial/interfaces/exception.html
+++ b/sentry/templates/sentry/partial/interfaces/exception.html
@@ -0,0 +1,15 @@
+<div id="summary">
+  <h3>{% if exception_type %}{{ exception_type }}: {{ exception_value|escape }}{% else %}Summary{% endif %}</h3>
+  <table class="meta">
+    <tr>
+      <th>Exception Value:</th>
+      <td><pre>{{ exception_value|escape }}</pre></td>
+    </tr>
+    {% if lastframe %}
+    <tr>
+      <th>Exception Location:</th>
+      <td>{{ lastframe.filename|escape }} in {{ lastframe.function|escape }}, line {{ lastframe.lineno }}</td>
+    </tr>
+    {% endif %}
+  </table>
+</div>
\ No newline at end of file
diff --git a/sentry/templates/sentry/partial/interfaces/stacktrace.html b/sentry/templates/sentry/partial/interfaces/stacktrace.html
index c25f5dd74b..994cf4662e 100644
--- a/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -1,48 +1,51 @@
-<div id="traceback">
-  <h2>Traceback</h2>
-  {% autoescape off %}
-  <div id="browserTraceback">
-    <ul class="traceback">
-      {% for frame in frames %}
-        <li class="frame">
-          <code>{{ frame.filename|escape }}</code> in <code>{{ frame.function|escape }}</code>
+{% load sentry_helpers %}
 
-          {% if frame.context_line %}
-            <div class="context" id="c{{ frame.id }}">
-              {% if frame.pre_context %}
-                <ol start="{{ frame.pre_context_lineno }}" class="pre-context" id="pre{{ frame.id }}">{% for line in frame.pre_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
-              {% endif %}
-              <ol start="{{ frame.lineno }}" class="context-line"><li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ frame.context_line|escape }} <span>...</span></li></ol>
-              {% if frame.post_context %}
-                <ol start='{{ frame.lineno + 1 }}' class="post-context" id="post{{ frame.id }}">{% for line in frame.post_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
-              {% endif %}
-            </div>
-          {% endif %}
+  <div id="traceback" class="module">
+      <h2>Stacktrace</h2>
+      <div class="module-content">
+          {% autoescape off %}
+          <div id="browserTraceback">
+          <ul class="traceback">
+            {% for frame in frames %}
+              <li class="frame">
+                <code>{{ frame.filename|escape }}</code> in <code>{{ frame.function|escape }}</code>
 
-          {% if frame.vars %}
-            <div class="commands">
-                <a href="#" onclick="return varToggle(this, '{{ frame.id }}')"><span>&#x25b6;</span> Local vars</a>
-            </div>
-            <table class="vars" id="v{{ frame.id }}">
-              <thead>
-                <tr>
-                  <th>Variable</th>
-                  <th>Value</th>
-                </tr>
-              </thead>
-              <tbody>
-              {% for var in frame.vars|dictsort(0) %}
-                <tr>
-                  <td>{{ var.0|escape }}</td>
-                  <td class="code"><pre>{{ var.1|pprint|escape }}</pre></td>
-                </tr>
-              {% endfor %}
-              </tbody>
-            </table>
-          {% endif %}
-        </li>
-      {% endfor %}
-    </ul>
-  </div>
-  {% endautoescape %}
-</div>
\ No newline at end of file
+                {% if frame.context_line %}
+                  <div class="context" id="c{{ frame.id }}">
+                    {% if frame.pre_context %}
+                      <ol start="{{ frame.pre_context_lineno }}" class="pre-context" id="pre{{ frame.id }}">{% for line in frame.pre_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
+                    {% endif %}
+                    <ol start="{{ frame.lineno }}" class="context-line"><li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ frame.context_line|escape }} <span>...</span></li></ol>
+                    {% if frame.post_context %}
+                      <ol start='{{ frame.lineno|plus:1 }}' class="post-context" id="post{{ frame.id }}">{% for line in frame.post_context %}<li onclick="toggle('pre{{ frame.id }}', 'post{{ frame.id }}')">{{ line|escape }}</li>{% endfor %}</ol>
+                    {% endif %}
+                  </div>
+                {% endif %}
+                <div class="commands">
+                  <a href="#" onclick="return varToggle(this, '{{ frame.id }}')"><span>&#x25b6;</span> Local vars</a>
+                </div>
+                <table class="vars" id="v{{ frame.id }}">
+                  <thead>
+                    <tr>
+                      <th>Variable</th>
+                      <th>Value</th>
+                    </tr>
+                  </thead>
+                  <tbody>
+                  {% if frame.vars %}
+                    {% for var in frame.vars|dictsort:"0" %}
+                      <tr>
+                        <td>{{ var.0|escape }}</td>
+                        <td class="code"><pre>{{ var.1|pprint|escape }}</pre></td>
+                      </tr>
+                    {% endfor %}
+                  {% endif %}
+                  </tbody>
+                </table>
+              </li>
+            {% endfor %}
+          </ul>
+          </div>
+          {% endautoescape %}
+      </div>
+  </div>
\ No newline at end of file
diff --git a/sentry/templates/sentry/partial/interfaces/template.html b/sentry/templates/sentry/partial/interfaces/template.html
new file mode 100644
index 0000000000..bdbaece946
--- /dev/null
+++ b/sentry/templates/sentry/partial/interfaces/template.html
@@ -0,0 +1,17 @@
+<div id="template" class="module">
+    <h2>Template error</h2>
+    <div class="module-content">
+        <p>In template <code>{{ filename }}</code>, error at line <strong>{{ lineno }}</strong></p>
+        {% if context_line %}
+            <ol start="{{ pre_context_lineno">
+                {% for num, line in pre_context %}
+                    <li value="{{ num }}"><pre>{{ line }}</pre></li>
+                {% endfor %}
+                <li value="{{ lineno }}" class="selected">{{ context_line }}</li>
+                {% for num, line in post_context %}
+                    <li value="{{ num }}"><pre>{{ line }}</pre></li>
+                {% endfor %}
+            </ol>
+        {% endif %}
+    </div>
+</div>
\ No newline at end of file
diff --git a/sentry/web/views.py b/sentry/web/views.py
index 6c738f1105..74889432f7 100644
--- a/sentry/web/views.py
+++ b/sentry/web/views.py
@@ -284,6 +284,7 @@ def search(request, project):
 
 @login_required
 def dashboard(request):
+    raise
     return render_to_response('sentry/dashboard.html', {
         'request': request,
     })
