commit 07587724c08f4d3c15df51edeb1b708791aecb97
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Oct 19 21:12:57 2014 +0200

    Replace shared team select

diff --git a/src/sentry/templates/sentry/bases/organization.html b/src/sentry/templates/sentry/bases/organization.html
new file mode 100644
index 0000000000..ee225dc2e2
--- /dev/null
+++ b/src/sentry/templates/sentry/bases/organization.html
@@ -0,0 +1,23 @@
+{% extends "sentry/layout.html" %}
+
+{% load crispy_forms_tags %}
+{% load i18n %}
+
+{% block bodyclass %}{% endblock %}
+{% block wrapperclass %}windowed{% endblock %}
+
+{% block title %}{% trans "Organization Settings" %} | {{ block.super }}{% endblock %}
+
+{% block page_header %}
+    <ul class="nav nav-tabs">
+        <li{% block org_teams_nav %}{% endblock %}>
+            <a href="{% url 'sentry-organization-teams' organization.id %}">{% trans "Teams" %}</a>
+        </li>
+        <li{% block org_settings_nav %}{% endblock %}>
+            <a href="{% url 'sentry-organization-settings' organization.id %}">{% trans "Settings" %}</a>
+        </li>
+        <li{% block org_members_nav %}{% endblock %}>
+            <a href="{% url 'sentry-organization-members' organization.id %}">{% trans "Admins" %}</a>
+        </li>
+    </ul>
+{% endblock %}
diff --git a/src/sentry/templates/sentry/organization-members.html b/src/sentry/templates/sentry/organization-members.html
index 99352ad33a..5b3c9bf0f0 100644
--- a/src/sentry/templates/sentry/organization-members.html
+++ b/src/sentry/templates/sentry/organization-members.html
@@ -1,18 +1,14 @@
-{% extends "sentry/bases/modal.html" %}
+{% extends "sentry/bases/organization.html" %}
 
 {% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "Admins" %} | {{ block.super }}{% endblock %}
 
-{% block bodyclass %}{% endblock %}
+{% block org_members_nav %} class="active"{% endblock %}
 
 {% block main %}
     <section class="body">
-        <div class="page-header">
-            <h2>{% trans "Admins" %}</h2>
-        </div>
-
         <table class="table table-striped">
             <colgroup>
                 <col>
diff --git a/src/sentry/templates/sentry/organization-settings.html b/src/sentry/templates/sentry/organization-settings.html
index 75cff81c30..85982f0815 100644
--- a/src/sentry/templates/sentry/organization-settings.html
+++ b/src/sentry/templates/sentry/organization-settings.html
@@ -1,11 +1,9 @@
-{% extends "sentry/bases/modal.html" %}
+{% extends "sentry/bases/organization.html" %}
 
 {% load crispy_forms_tags %}
 {% load i18n %}
 
-{% block title %}{% trans "Organization Settings" %} | {{ block.super }}{% endblock %}
-
-{% block bodyclass %}{% endblock %}
+{% block org_settings_nav %} class="active"{% endblock %}
 
 {% block main %}
     <section class="body">
diff --git a/src/sentry/templates/sentry/organization-teams.html b/src/sentry/templates/sentry/organization-teams.html
index 1829b33052..d75ffed751 100644
--- a/src/sentry/templates/sentry/organization-teams.html
+++ b/src/sentry/templates/sentry/organization-teams.html
@@ -1,39 +1,38 @@
-{% extends "sentry/bases/modal.html" %}
+{% extends "sentry/bases/organization.html" %}
 
-{% load crispy_forms_tags %}
 {% load i18n %}
 
-{% block title %}{% trans "Teams" %} | {{ block.super }}{% endblock %}
+{% block bodyclass %}team-index {{ block.super }}{% endblock %}
 
-{% block bodyclass %}{% endblock %}
+{% block org_teams_nav %} class="active"{% endblock %}
 
 {% block main %}
     <section class="body">
-        <div class="page-header">
-            <h2>{% trans "Teams" %}</h2>
-        </div>
-
-        <table class="table table-striped">
-            <colgroup>
-                <col>
-                <col style="width:100px;">
-            </colgroup>
-            <thead>
-                <tr>
-                    <th>{% trans "Name" %}</th>
-                    <th style="text-align:center;">{% trans "Status" %}</th>
-                </tr>
-            </thead>
-            <tbody>
-                {% for team in team_list %}
-                    <tr>
-                        <td>
-                            {{ team.name }}
-                        </td>
-                        <td style="text-align:center">{{ team.get_status_display }}</td>
-                    </tr>
-                {% endfor %}
-            </tbody>
-        </table>
+        <ul class="team-list">
+            {% for team, project_list in team_list %}
+                <li>
+                    <div class="chart" data-api-url="{% url 'sentry-api-0-team-stats' team.id %}">
+                        <div class="sparkline">
+                            <noscript>{% trans "Get yourself some JavaScripts dood" %}</noscript>
+                            <span class="loading">{% trans "Loading historical data..." %}</span>
+                        </div>
+                    </div>
+                    <h3><a href="{% url 'sentry' team.slug %}">{{ team.name }}</a></h3>
+                    <ul>
+                        {% for project in project_list %}
+                            <li><a href="{% url 'sentry-stream' team.slug project.slug %}">{{ project.name }}</a></li>
+                        {% endfor %}
+                    </ul>
+                </li>
+            {% endfor %}
+        </ul>
     </section>
 {% endblock %}
+
+{% block content_after %}
+    <script type="text/javascript">
+    $(function(){
+        new app.SelectTeamPage();
+    })
+    </script>
+{% endblock %}
diff --git a/src/sentry/templates/sentry/select_team.html b/src/sentry/templates/sentry/select_team.html
deleted file mode 100644
index 88a1d146b3..0000000000
--- a/src/sentry/templates/sentry/select_team.html
+++ /dev/null
@@ -1,49 +0,0 @@
-{% extends "sentry/bases/modal.html" %}
-
-{% load i18n %}
-
-{% block bodyclass %}team-index {{ block.super }}{% endblock %}
-
-{% block main %}
-    <section class="body">
-        {% if org_list %}
-            {% for org, team_list in org_list %}
-                {% if can_create_teams %}
-                <div class="pull-right">
-                    <a href="{% url 'sentry-organization-settings' org.id %}" class="btn btn-default">{% trans "Settings" %}</a>
-                    <a href="{% url 'sentry-new-team' org.id %}" class="btn btn-default">{% trans "New Team" %}</a>
-                </div>
-                {% endif %}
-                <h2>{{ org.name }}</h2>
-                <ul class="team-list">
-                    {% for team, project_list in team_list %}
-                        <li>
-                            <div class="chart" data-api-url="{% url 'sentry-api-0-team-stats' team.id %}">
-                                <div class="sparkline">
-                                    <noscript>{% trans "Get yourself some JavaScripts dood" %}</noscript>
-                                    <span class="loading">{% trans "Loading historical data..." %}</span>
-                                </div>
-                            </div>
-                            <h3><a href="{% url 'sentry' team.slug %}">{{ team.name }}</a></h3>
-                            <ul>
-                                {% for project in project_list %}
-                                    <li><a href="{% url 'sentry-stream' team.slug project.slug %}">{{ project.name }}</a></li>
-                                {% endfor %}
-                            </ul>
-                        </li>
-                    {% endfor %}
-                </ul>
-            {% endfor %}
-        {% else %}
-            <div class="alert alert-info">{% trans "You are not a member of any teams." %}</div>
-        {% endif %}
-    </section>
-{% endblock %}
-
-{% block content_after %}
-    <script type="text/javascript">
-    $(function(){
-        new app.SelectTeamPage();
-    })
-    </script>
-{% endblock %}
diff --git a/src/sentry/web/frontend/base.py b/src/sentry/web/frontend/base.py
index a89f899637..3869398fb8 100644
--- a/src/sentry/web/frontend/base.py
+++ b/src/sentry/web/frontend/base.py
@@ -32,21 +32,23 @@ class OrganizationMixin(object):
                     )
                 except Organization.DoesNotExist:
                     return None
-            else:
-                organizations = Organization.objects.get_for_user(
-                    user=request.user,
-                    access=access,
-                )
 
-                try:
-                    active_organization = (
-                        o for o in organizations
-                        if o.id == organization_id
-                    ).next()
-                except StopIteration:
-                    if is_implicit:
-                        del request.session['activeorg']
-                    active_organization = None
+        if active_organization is None:
+            organizations = Organization.objects.get_for_user(
+                user=request.user,
+                access=access,
+            )
+
+        if active_organization is None and organization_id:
+            try:
+                active_organization = (
+                    o for o in organizations
+                    if o.id == organization_id
+                ).next()
+            except StopIteration:
+                if is_implicit:
+                    del request.session['activeorg']
+                active_organization = None
 
         if active_organization is None:
             if not is_implicit:
diff --git a/src/sentry/web/frontend/generic.py b/src/sentry/web/frontend/generic.py
index 5ad9ffe79e..ef904e29f8 100644
--- a/src/sentry/web/frontend/generic.py
+++ b/src/sentry/web/frontend/generic.py
@@ -19,23 +19,6 @@ from sentry.web.decorators import login_required
 from sentry.web.helpers import render_to_response
 
 
-@login_required
-def dashboard(request, template='dashboard.html'):
-    org_list = []
-    for org in Organization.objects.get_for_user(request.user):
-        team_list = Team.objects.get_for_user(
-            organization=org,
-            user=request.user,
-            with_projects=True,
-        )
-        org_list.append((org, team_list.values()))
-
-    return render_to_response('sentry/select_team.html', {
-        'org_list': org_list,
-        'can_create_teams': can_create_teams(request.user),
-    }, request)
-
-
 def static_media(request, **kwargs):
     """
     Serve static files below a given point in the directory structure.
diff --git a/src/sentry/web/frontend/home.py b/src/sentry/web/frontend/home.py
new file mode 100644
index 0000000000..bd2df789da
--- /dev/null
+++ b/src/sentry/web/frontend/home.py
@@ -0,0 +1,17 @@
+from __future__ import absolute_import
+
+from django.core.urlresolvers import reverse
+from django.http import HttpResponseRedirect
+
+from sentry.web.frontend.base import BaseView
+
+
+class HomeView(BaseView):
+    def get(self, request):
+        # TODO(dcramer): deal with no orgs
+        organization = self.get_active_organization(request)
+        url = reverse('sentry-organization-teams', args=[organization.id])
+        return HttpResponseRedirect(url)
+
+
+
diff --git a/src/sentry/web/frontend/organization_teams.py b/src/sentry/web/frontend/organization_teams.py
index 711c7098f5..e203b48c36 100644
--- a/src/sentry/web/frontend/organization_teams.py
+++ b/src/sentry/web/frontend/organization_teams.py
@@ -8,8 +8,14 @@ class OrganizationTeamsView(OrganizationView):
     required_access = OrganizationMemberType.ADMIN
 
     def get(self, request, organization):
+        team_list = Team.objects.get_for_user(
+            organization=organization,
+            user=request.user,
+            with_projects=True,
+        ).values()
+
         context = {
-            'team_list': Team.objects.filter(organization=organization),
+            'team_list': team_list,
         }
 
         return self.respond('sentry/organization-teams.html', context)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 5a183b2ee3..7da438a3b5 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -34,6 +34,7 @@ import sentry.web.frontend.projects.tags
 
 __all__ = ('urlpatterns',)
 
+from sentry.web.frontend.home import HomeView
 from sentry.web.frontend.organization_members import OrganizationMembersView
 from sentry.web.frontend.organization_settings import OrganizationSettingsView
 from sentry.web.frontend.organization_teams import OrganizationTeamsView
@@ -231,7 +232,7 @@ urlpatterns += patterns('',
         name='sentry-new-project-rule'),
 
     # Generic
-    url(r'^$', generic.dashboard,
+    url(r'^$', HomeView.as_view(),
         name='sentry'),
 
     # Admin
