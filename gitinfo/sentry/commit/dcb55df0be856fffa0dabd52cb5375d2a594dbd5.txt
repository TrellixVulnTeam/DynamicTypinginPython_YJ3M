commit dcb55df0be856fffa0dabd52cb5375d2a594dbd5
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Thu Aug 30 10:34:02 2018 -0700

    feat(integrations): Direct users to new integrations from old repo page (#9514)

diff --git a/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx b/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
index 9f72197929..b7862e2fbb 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationRepositories/organizationRepositories.jsx
@@ -4,9 +4,11 @@ import React from 'react';
 import styled from 'react-emotion';
 
 import {t, tct} from 'app/locale';
+import AlertLink from 'app/components/alertLink';
 import Button from 'app/components/button';
 import Confirm from 'app/components/confirm';
 import DropdownLink from 'app/components/dropdownLink';
+import Feature from 'app/components/feature';
 import MenuItem from 'app/components/menuItem';
 import SpreadLayout from 'app/components/spreadLayout';
 import {Panel, PanelBody, PanelHeader} from 'app/components/panels';
@@ -64,28 +66,54 @@ export default class OrganizationRepositories extends React.Component {
         <SettingsPageHeader
           title={t('Repositories')}
           action={
-            <DropdownLink
-              anchorRight
-              className="btn btn-primary btn-sm"
-              title={t('Add Repository')}
+            <Feature
+              feature={['bitbucket-integration', 'github-enterprise']}
+              requireAll={false}
             >
-              {repoConfig &&
-                repoConfig.providers &&
-                repoConfig.providers.map(provider => {
-                  return (
-                    <MenuItem noAnchor={true} key={provider.id}>
-                      <AddRepositoryLink
-                        provider={provider}
-                        orgId={orgId}
-                        onSuccess={onAddRepo}
-                      />
-                    </MenuItem>
-                  );
-                })}
-            </DropdownLink>
+              {({hasFeature}) => {
+                return (
+                  !hasFeature && (
+                    <DropdownLink
+                      anchorRight
+                      className="btn btn-primary btn-sm"
+                      title={t('Add Repository')}
+                    >
+                      {repoConfig &&
+                        repoConfig.providers &&
+                        repoConfig.providers.map(provider => {
+                          return (
+                            <MenuItem noAnchor={true} key={provider.id}>
+                              <AddRepositoryLink
+                                provider={provider}
+                                orgId={orgId}
+                                onSuccess={onAddRepo}
+                              />
+                            </MenuItem>
+                          );
+                        })}
+                    </DropdownLink>
+                  )
+                );
+              }}
+            </Feature>
           }
         />
-
+        <Feature
+          feature={['bitbucket-integration', 'github-enterprise']}
+          requireAll={false}
+        >
+          {({hasFeature}) => {
+            return (
+              hasFeature && (
+                <AlertLink to={`/settings/${orgId}/integrations/`}>
+                  {t(
+                    'Want to add a repository to start tracking commits? Install or configure your version control integration here.'
+                  )}
+                </AlertLink>
+              )
+            );
+          }}
+        </Feature>
         {!hasItemList && (
           <div className="m-b-2">
             <TextBlock>
diff --git a/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap b/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
index ff239058df..b81d7e0190 100644
--- a/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
+++ b/tests/js/spec/views/settings/__snapshots__/organizationRepositories.spec.jsx.snap
@@ -4,42 +4,31 @@ exports[`OrganizationRepositories renders with a repository 1`] = `
 <div>
   <SettingsPageHeading
     action={
-      <DropdownLink
-        alwaysRenderMenu={true}
-        anchorRight={true}
-        caret={true}
-        className="btn btn-primary btn-sm"
-        disabled={false}
-        title="Add Repository"
+      <FeatureContainer
+        feature={
+          Array [
+            "bitbucket-integration",
+            "github-enterprise",
+          ]
+        }
+        requireAll={false}
       >
-        <MenuItem
-          noAnchor={true}
-        >
-          <AddRepositoryLink
-            orgId="org-slug"
-            provider={
-              Object {
-                "config": Array [
-                  Object {
-                    "help": "Enter your repository name, including the owner.",
-                    "label": "Repository Name",
-                    "name": "name",
-                    "placeholder": "e.g. getsentry/sentry",
-                    "required": true,
-                    "type": "text",
-                  },
-                ],
-                "id": "github",
-                "key": "github",
-                "name": "GitHub",
-              }
-            }
-          />
-        </MenuItem>
-      </DropdownLink>
+        [Function]
+      </FeatureContainer>
     }
     title="Repositories"
   />
+  <FeatureContainer
+    feature={
+      Array [
+        "bitbucket-integration",
+        "github-enterprise",
+      ]
+    }
+    requireAll={false}
+  >
+    <Component />
+  </FeatureContainer>
   <Panel>
     <PanelHeader
       disablePadding={true}
@@ -122,42 +111,31 @@ exports[`OrganizationRepositories renders with github provider 1`] = `
 <div>
   <SettingsPageHeading
     action={
-      <DropdownLink
-        alwaysRenderMenu={true}
-        anchorRight={true}
-        caret={true}
-        className="btn btn-primary btn-sm"
-        disabled={false}
-        title="Add Repository"
+      <FeatureContainer
+        feature={
+          Array [
+            "bitbucket-integration",
+            "github-enterprise",
+          ]
+        }
+        requireAll={false}
       >
-        <MenuItem
-          noAnchor={true}
-        >
-          <AddRepositoryLink
-            orgId="org-slug"
-            provider={
-              Object {
-                "config": Array [
-                  Object {
-                    "help": "Enter your repository name, including the owner.",
-                    "label": "Repository Name",
-                    "name": "name",
-                    "placeholder": "e.g. getsentry/sentry",
-                    "required": true,
-                    "type": "text",
-                  },
-                ],
-                "id": "github",
-                "key": "github",
-                "name": "GitHub",
-              }
-            }
-          />
-        </MenuItem>
-      </DropdownLink>
+        [Function]
+      </FeatureContainer>
     }
     title="Repositories"
   />
+  <FeatureContainer
+    feature={
+      Array [
+        "bitbucket-integration",
+        "github-enterprise",
+      ]
+    }
+    requireAll={false}
+  >
+    <Component />
+  </FeatureContainer>
   <div
     className="m-b-2"
   >
@@ -220,17 +198,31 @@ exports[`OrganizationRepositories renders without providers 1`] = `
 <div>
   <SettingsPageHeading
     action={
-      <DropdownLink
-        alwaysRenderMenu={true}
-        anchorRight={true}
-        caret={true}
-        className="btn btn-primary btn-sm"
-        disabled={false}
-        title="Add Repository"
-      />
+      <FeatureContainer
+        feature={
+          Array [
+            "bitbucket-integration",
+            "github-enterprise",
+          ]
+        }
+        requireAll={false}
+      >
+        [Function]
+      </FeatureContainer>
     }
     title="Repositories"
   />
+  <FeatureContainer
+    feature={
+      Array [
+        "bitbucket-integration",
+        "github-enterprise",
+      ]
+    }
+    requireAll={false}
+  >
+    <Component />
+  </FeatureContainer>
   <div
     className="m-b-2"
   >
