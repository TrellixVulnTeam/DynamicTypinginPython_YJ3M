commit 36cf37a2b70545d6698a45172ce485c2eaa2bff3
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 24 10:35:43 2015 -0800

    Add feature helper

diff --git a/src/sentry/testutils/cases.py b/src/sentry/testutils/cases.py
index 1c62789f85..80515bbec7 100644
--- a/src/sentry/testutils/cases.py
+++ b/src/sentry/testutils/cases.py
@@ -33,7 +33,7 @@ from sentry.rules import EventState
 from sentry.utils import json
 
 from .fixtures import Fixtures
-from .helpers import get_auth_header
+from .helpers import Feature, get_auth_header
 
 
 def create_redis_conn():
@@ -68,6 +68,13 @@ class BaseTestCase(Fixtures, Exam):
 
         self.session = session
 
+    def feature(self, name, active=True):
+        """
+        >>> with self.feature('feature:name')
+        >>>     # ...
+        """
+        return Feature(name, active)
+
     def save_session(self):
         self.session.save()
 
diff --git a/src/sentry/testutils/helpers/__init__.py b/src/sentry/testutils/helpers/__init__.py
index 077bb02f5a..ec9e14ebed 100644
--- a/src/sentry/testutils/helpers/__init__.py
+++ b/src/sentry/testutils/helpers/__init__.py
@@ -8,4 +8,5 @@ sentry.testutils.helpers
 from __future__ import absolute_import
 
 from .auth_header import *  # NOQA
+from .features import *  # NOQA
 from .link_header import *  # NOQA
diff --git a/src/sentry/testutils/helpers/features.py b/src/sentry/testutils/helpers/features.py
new file mode 100644
index 0000000000..d80d300b72
--- /dev/null
+++ b/src/sentry/testutils/helpers/features.py
@@ -0,0 +1,13 @@
+from __future__ import absolute_import
+
+__all__ = ['Feature']
+
+from contextlib import contextmanager
+from mock import patch
+
+
+@contextmanager
+def Feature(name, active=True):
+    with patch('sentry.features.has') as features_has:
+        features_has.side_effect = lambda x, *a, **k: active and x == name
+        yield
