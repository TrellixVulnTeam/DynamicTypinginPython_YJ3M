commit f5d36ec43945412cd31c7ea29f399b0b42a25c81
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Aug 9 23:26:55 2015 -0700

    Fix rendering on non-HTML pages

diff --git a/src/sentry/debug/middleware.py b/src/sentry/debug/middleware.py
index 33945431ae..5c78694c2d 100644
--- a/src/sentry/debug/middleware.py
+++ b/src/sentry/debug/middleware.py
@@ -85,14 +85,15 @@ class DebugMiddleware(object):
         if 'text/html' not in response['Content-Type']:
             if 'application/json' in response['Content-Type']:
                 content = json.dumps(json.loads(content), indent=2)
+            content = TEMPLATE.format(content)
             response['Content-Type'] = 'text/html'
-            response.content = TEMPLATE.format(content)
 
         # Insert the toolbar in the response.
         bits = self._body_regexp.split(content)
         if len(bits) > 1:
             bits[-2] += toolbar.render_toolbar()
-            response.content = '</body>'.join(bits)
+            content = '</body>'.join(bits)
 
-        response['Content-Length'] = len(response.content)
+        response.content = content
+        response['Content-Length'] = len(content)
         return response
diff --git a/src/sentry/templates/debug_toolbar/base.html b/src/sentry/templates/debug_toolbar/base.html
deleted file mode 100644
index 8d402a89d7..0000000000
--- a/src/sentry/templates/debug_toolbar/base.html
+++ /dev/null
@@ -1,57 +0,0 @@
-{% load i18n %}{% load static from staticfiles %}
-<link rel="stylesheet" href="{% static 'debug_toolbar/css/print.css' %}" type="text/css" media="print" />
-<link rel="stylesheet" href="{% static 'debug_toolbar/css/toolbar.css' %}" type="text/css" />
-<script>var djdt = {jQuery: jQuery};</script>
-<script src="{% static 'debug_toolbar/js/toolbar.js' %}"></script>
-<div id="djDebug" hidden="hidden" dir="ltr"
-     data-store-id="{{ toolbar.store_id }}" data-render-panel-url="{% url 'djdt:render_panel' %}"
-     {{ toolbar.config.ROOT_TAG_EXTRA_ATTRS|safe }}>
-    <div hidden="hidden" id="djDebugToolbar">
-        <ul id="djDebugPanelList">
-            <li><a id="djHideToolBarButton" href="#" title="{% trans "Hide toolbar" %}">{% trans "Hide" %} &#187;</a></li>
-            {% for panel in toolbar.panels %}
-                <li class="djDebugPanelButton">
-                    <input type="checkbox" data-cookie="djdt{{ panel.panel_id }}" {% if panel.enabled %}checked="checked" title="{% trans "Disable for next and successive requests" %}"{% else %}title="{% trans "Enable for next and successive requests" %}"{% endif %} />
-                    {% if panel.has_content and panel.enabled %}
-                        <a href="#" title="{{ panel.title }}" class="{{ panel.panel_id }}">
-                    {% else %}
-                        <div class="djdt-contentless{% if not panel.enabled %} djdt-disabled{% endif %}">
-                    {% endif %}
-                    {{ panel.nav_title }}
-                    {% if panel.enabled %}
-                    {% with panel.nav_subtitle as subtitle %}
-                        {% if subtitle %}<br /><small>{{ subtitle }}</small>{% endif %}
-                    {% endwith %}
-                    {% endif %}
-                    {% if panel.has_content and panel.enabled %}
-                        </a>
-                    {% else %}
-                        </div>
-                    {% endif %}
-                </li>
-            {% endfor %}
-        </ul>
-    </div>
-    <div hidden="hidden" id="djDebugToolbarHandle">
-        <span title="{% trans "Show toolbar" %}" id="djShowToolBarButton">&#171;</span>
-    </div>
-    {% for panel in toolbar.panels %}
-        {% if panel.has_content and panel.enabled %}
-            <div id="{{ panel.panel_id }}" class="djdt-panelContent">
-                <div class="djDebugPanelTitle">
-                    <a href="" class="djDebugClose"></a>
-                    <h3>{{ panel.title|safe }}</h3>
-                </div>
-                <div class="djDebugPanelContent">
-                    {% if toolbar.store_id %}
-                    <img src="{% static 'debug_toolbar/img/ajax-loader.gif' %}" alt="loading" class="djdt-loader" />
-                    <div class="djdt-scroll"></div>
-                    {% else %}
-                    <div class="djdt-scroll">{{ panel.content }}</div>
-                    {% endif %}
-                </div>
-            </div>
-        {% endif %}
-    {% endfor %}
-    <div id="djDebugWindow" class="djdt-panelContent"></div>
-</div>
