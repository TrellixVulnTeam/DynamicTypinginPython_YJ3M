commit e68ab9b8c4e64b9c7f59f232b14730bd77c63bc0
Author: Ted Kaemming <ted@kaemming.com>
Date:   Tue Feb 9 15:26:50 2016 -0800

    Fix shadowing behavior that resulted in incorrect routing for frequencies.

diff --git a/src/sentry/tsdb/redis.py b/src/sentry/tsdb/redis.py
index 9fddec7fdb..68079beea7 100644
--- a/src/sentry/tsdb/redis.py
+++ b/src/sentry/tsdb/redis.py
@@ -329,9 +329,12 @@ class RedisTSDB(BaseTSDB):
                 for member, score in items.items():
                     arguments.extend((score, member))
 
-                commands[key] = [(CountMinScript, keys, arguments)] + [
-                    ('EXPIREAT', key, exp) for key, exp in expirations.items()
-                ]
+                # Since we're essentially merging dictionaries, we need to
+                # append this to any value that already exists at the key.
+                cmds = commands.setdefault(key, [])
+                cmds.append((CountMinScript, keys, arguments))
+                for k, t in expirations.items():
+                    cmds.append(('EXPIREAT', k, t))
 
         self.cluster.execute_commands(commands)
 
