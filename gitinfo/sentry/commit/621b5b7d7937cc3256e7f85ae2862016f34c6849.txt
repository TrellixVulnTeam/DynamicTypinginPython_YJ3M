commit 621b5b7d7937cc3256e7f85ae2862016f34c6849
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jan 6 14:57:40 2016 -0800

    Safely handle invalid request in get_user_context

diff --git a/src/sentry/templatetags/sentry_api.py b/src/sentry/templatetags/sentry_api.py
index 30f548564e..39770cc515 100644
--- a/src/sentry/templatetags/sentry_api.py
+++ b/src/sentry/templatetags/sentry_api.py
@@ -1,6 +1,7 @@
 from __future__ import absolute_import
 
 from django import template
+from django.http import HttpRequest
 from django.utils.html import mark_safe
 
 from sentry.api.serializers.base import serialize as serialize_func
@@ -49,13 +50,16 @@ def serialize_detailed_org(context, obj):
 
 @register.simple_tag
 def get_user_context(request, escape=False):
-    user = getattr(request, 'user', None)
-    result = {'ip_address': request.META['REMOTE_ADDR']}
-    if user and user.is_authenticated():
-        result.update({
-            'email': user.email,
-            'id': user.id,
-        })
-        if user.name:
-            result['name'] = user.name
+    if isinstance(request, HttpRequest):
+        user = getattr(request, 'user', None)
+        result = {'ip_address': request.META['REMOTE_ADDR']}
+        if user and user.is_authenticated():
+            result.update({
+                'email': user.email,
+                'id': user.id,
+            })
+            if user.name:
+                result['name'] = user.name
+    else:
+        result = {}
     return mark_safe(json.dumps(result))
