commit 6278cdec89063aab054d8a10c06489bbd31c6064
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Mar 7 14:58:21 2018 -0800

    fix(environments): Fix release stats sidebar (#7493)
    
    Group from props will be the filtered by environment one now so we need to fetch for all environments

diff --git a/src/sentry/static/sentry/app/components/group/releaseStats.jsx b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
index 030fea9fe1..dd3cbd7108 100644
--- a/src/sentry/static/sentry/app/components/group/releaseStats.jsx
+++ b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
@@ -17,8 +17,6 @@ import MenuItem from '../menuItem';
 import SeenInfo from './seenInfo';
 import {t} from '../../locale';
 
-// TODO(dcramer): this should listen to EnvironmentStore
-// changes
 const GroupReleaseStats = createReactClass({
   displayName: 'GroupReleaseStats',
 
@@ -52,11 +50,7 @@ const GroupReleaseStats = createReactClass({
   },
 
   componentWillMount() {
-    if (this.state.loading) {
-      this.fetchData();
-    }
-    // onLatestContextChange might not be triggered when component mounted
-    this.onLatestContextChange(LatestContextStore.getInitialState());
+    this.fetchData();
   },
 
   shouldComponentUpdate(nextProps, nextState) {
@@ -96,6 +90,8 @@ const GroupReleaseStats = createReactClass({
     let stats = group.stats['24h'];
     let until = stats[stats.length - 1][0] + 1;
 
+    // TODO(lyn): We might not need to make this request anymore since the group
+    // endpoint now accepts the environment parameter
     this.api.request(`/issues/${group.id}/environments/${env.urlRoutingName}/`, {
       query: {
         until,
diff --git a/src/sentry/static/sentry/app/components/group/sidebar.jsx b/src/sentry/static/sentry/app/components/group/sidebar.jsx
index ebbb67009a..765331c233 100644
--- a/src/sentry/static/sentry/app/components/group/sidebar.jsx
+++ b/src/sentry/static/sentry/app/components/group/sidebar.jsx
@@ -58,6 +58,20 @@ const GroupSidebar = createReactClass({
         });
       },
     });
+    // Fetch group data for all environments since the one in GroupState is filtered for the selected environment
+    // The charts rely on having all environment data as well as the data for the selected env
+    this.api.request(`/issues/${group.id}/`, {
+      success: data => {
+        this.setState({
+          allEnvironmentsGroupData: data,
+        });
+      },
+      error: () => {
+        this.setState({
+          error: true,
+        });
+      },
+    });
   },
 
   subscriptionReasons: {
@@ -202,8 +216,9 @@ const GroupSidebar = createReactClass({
     return (
       <div className="group-stats">
         <SuggestedOwners event={this.props.event} />
-
-        <GroupReleaseStats group={group} location={this.context.location} />
+        {this.state.allEnvironmentsGroupData && (
+          <GroupReleaseStats group={this.state.allEnvironmentsGroupData} />
+        )}
 
         {this.renderPluginIssue()}
 
