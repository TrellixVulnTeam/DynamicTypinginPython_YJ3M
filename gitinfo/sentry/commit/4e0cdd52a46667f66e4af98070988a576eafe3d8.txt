commit 4e0cdd52a46667f66e4af98070988a576eafe3d8
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu May 30 10:58:53 2019 -0700

    fix(events-v2): Fix search filter (#13454)
    
    Prevent double translation of tag keys in search queries

diff --git a/src/sentry/api/endpoints/organization_events.py b/src/sentry/api/endpoints/organization_events.py
index e2dbc9958a..086fc558e2 100644
--- a/src/sentry/api/endpoints/organization_events.py
+++ b/src/sentry/api/endpoints/organization_events.py
@@ -91,7 +91,8 @@ class OrganizationEventsEndpoint(OrganizationEventsEndpointBase):
             }, status=400)
 
         data_fn = partial(
-            lambda *args, **kwargs: transform_aliases_and_query(*args, **kwargs)['data'],
+            lambda **kwargs: transform_aliases_and_query(
+                skip_conditions=True, **kwargs)['data'],
             referrer='api.organization-events-v2',
             **snuba_args
         )
diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 599ad80f90..a5c10b267e 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -371,7 +371,7 @@ def get_arrayjoin(column):
         return match.groups()[0]
 
 
-def transform_aliases_and_query(*args, **kwargs):
+def transform_aliases_and_query(skip_conditions=False, **kwargs):
     """
     Convert aliases in selected_columns, groupby, aggregation, conditions,
     orderby and arrayjoin fields to their internal Snuba format and post the
@@ -441,7 +441,8 @@ def transform_aliases_and_query(*args, **kwargs):
         return cond
 
     if conditions:
-        kwargs['conditions'] = [handle_condition(condition) for condition in conditions]
+        kwargs['conditions'] = ([handle_condition(condition) for condition in conditions]
+                                if skip_conditions is False else conditions)
 
     if orderby:
         order_by_column = orderby.lstrip('-')
@@ -453,7 +454,7 @@ def transform_aliases_and_query(*args, **kwargs):
 
     kwargs['arrayjoin'] = arrayjoin_map.get(arrayjoin, arrayjoin)
 
-    result = raw_query(*args, **kwargs)
+    result = raw_query(**kwargs)
 
     # Translate back columns that were converted to snuba format
     for col in result['meta']:
