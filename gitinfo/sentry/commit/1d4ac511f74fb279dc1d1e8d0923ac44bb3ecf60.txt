commit 1d4ac511f74fb279dc1d1e8d0923ac44bb3ecf60
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Feb 3 10:20:28 2020 +0100

    feat: Better validation for PII config (#16719)

diff --git a/src/sentry/api/endpoints/project_details.py b/src/sentry/api/endpoints/project_details.py
index eb01162dbf..10dd52a76c 100644
--- a/src/sentry/api/endpoints/project_details.py
+++ b/src/sentry/api/endpoints/project_details.py
@@ -10,6 +10,7 @@ from django.db import IntegrityError, transaction
 from django.utils import timezone
 from rest_framework import serializers, status
 from rest_framework.response import Response
+from sentry_relay import validate_pii_config
 
 from sentry import features
 from sentry.utils.data_filters import FilterTypes
@@ -175,8 +176,6 @@ class ProjectAdminSerializer(ProjectMemberSerializer):
         if not value:
             return value
 
-        from sentry import features
-
         organization = self.context["project"].organization
         request = self.context["request"]
         has_datascrubbers_v2 = features.has(
@@ -186,6 +185,12 @@ class ProjectAdminSerializer(ProjectMemberSerializer):
             raise serializers.ValidationError(
                 "Organization does not have the datascrubbers-v2 feature enabled"
             )
+
+        try:
+            validate_pii_config(value)
+        except ValueError as e:
+            raise serializers.ValidationError(e)
+
         return value
 
     def validate_builtinSymbolSources(self, value):
diff --git a/src/sentry/static/sentry/app/data/forms/projectGeneralSettings.jsx b/src/sentry/static/sentry/app/data/forms/projectGeneralSettings.jsx
index 0b3bb1aad4..ac47374584 100644
--- a/src/sentry/static/sentry/app/data/forms/projectGeneralSettings.jsx
+++ b/src/sentry/static/sentry/app/data/forms/projectGeneralSettings.jsx
@@ -359,6 +359,9 @@ export const fields = {
     ),
     visible: ({features}) => features.has('datascrubbers-v2'),
     validate: ({id, form}) => {
+      if (form[id] === '') {
+        return [];
+      }
       try {
         JSON.parse(form[id]);
       } catch (e) {
