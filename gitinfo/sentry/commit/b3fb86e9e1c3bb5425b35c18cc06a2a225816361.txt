commit b3fb86e9e1c3bb5425b35c18cc06a2a225816361
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Nov 27 14:34:11 2012 -0800

    Use npm package for coffeescript and less

diff --git a/Makefile b/Makefile
index 261fb6aea1..ef315ed504 100644
--- a/Makefile
+++ b/Makefile
@@ -9,7 +9,8 @@ COFFEE ?= `which coffee`
 WATCHR ?= `which watchr`
 
 develop: update-submodules bootstrap-tests
-	npm install coffee-script
+	npm install coffee-script@1.4.0
+	npm install less@1.3.1
 	pip install -e . --use-mirrors
 
 build: static coffee locale
diff --git a/package.json b/package.json
new file mode 100644
index 0000000000..db8de74333
--- /dev/null
+++ b/package.json
@@ -0,0 +1,8 @@
+{
+    "name": "Sentry",
+    "version": "0.1.0",
+    "dependencies": {
+        "less": "1.3.1",
+        "coffee-script": "1.4.0"
+    }
+}
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index d7f47621da..a09922e18d 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -162,14 +162,22 @@ INSTALLED_APPS = (
 STATIC_ROOT = os.path.join(PROJECT_ROOT, 'static')
 STATIC_URL = '/_static/'
 
+NPM_ROOT = os.path.abspath(os.path.join(PROJECT_ROOT, os.pardir, os.pardir, 'node_modules'))
+if os.path.exists(NPM_ROOT):
+    LESS_BIN = os.path.join(NPM_ROOT, 'less', 'bin', 'lessc')
+    COFFEESCRIPT_BIN = os.path.join(NPM_ROOT, 'coffee-script', 'bin', 'coffee')
+else:
+    LESS_BIN = 'less'
+    COFFEESCRIPT_BIN = 'coffee'
+
 # XXX: There is a bug in django-compressor that causes it to incorrectly handle
 # relative URLs in precompiled files (less) when compression is disabled
 COMPRESS_ENABLED = True
 COMPRESS_URL = STATIC_URL
 COMPRESS_OUTPUT_DIR = 'CACHE'
 COMPRESS_PRECOMPILERS = (
-    ('text/coffeescript', 'coffee --compile --stdio'),
-    ('text/less', 'lessc --strict-imports {infile} {outfile}'),
+    ('text/coffeescript', '%s --compile --stdio' % (COFFEESCRIPT_BIN,)),
+    ('text/less', '%s --strict-imports {infile} {outfile}' % (LESS_BIN,)),
 )
 
 STATICFILES_FINDERS = (
