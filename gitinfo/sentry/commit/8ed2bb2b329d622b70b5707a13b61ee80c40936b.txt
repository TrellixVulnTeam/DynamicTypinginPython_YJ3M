commit 8ed2bb2b329d622b70b5707a13b61ee80c40936b
Author: Dena Mwangi <dena@getsentry.com>
Date:   Wed Oct 3 10:50:53 2018 -0700

    feat(releases): Add endpoint for project release setup completion status (#9934)

diff --git a/src/sentry/api/endpoints/project_release_setup.py b/src/sentry/api/endpoints/project_release_setup.py
new file mode 100644
index 0000000000..fcd1ca1237
--- /dev/null
+++ b/src/sentry/api/endpoints/project_release_setup.py
@@ -0,0 +1,56 @@
+from __future__ import absolute_import
+
+from sentry.api.bases.project import ProjectEndpoint, ProjectReleasePermission
+from sentry.models import Group, ReleaseCommit, Repository, Deploy
+from rest_framework.response import Response
+
+
+class ProjectReleaseSetupCompletionEndpoint(ProjectEndpoint):
+    permission_classes = (ProjectReleasePermission, )
+
+    def get(self, request, project):
+        """
+        Get list with release setup progress for a project
+        1. tag an error
+        2. link a repo
+        3. associate commits
+        4. tell sentry about a deploy
+        """
+
+        tag = Group.objects.filter(
+            project=project.id,
+            first_release__isnull=False,
+        ).exists()
+
+        repo = Repository.objects.filter(
+            organization_id=project.organization_id,
+        ).exists()
+
+        commit = ReleaseCommit.objects.filter(
+            organization_id=project.organization_id,
+            release__projects=project.id,
+        ).exists()
+
+        deploy = Deploy.objects.filter(
+            organization_id=project.organization_id,
+            release__projects=project.id,
+        ).exists()
+
+        return Response([
+            {
+                'step': 'tag',
+                'complete': bool(tag),
+            },
+            {
+                'step': 'repo',
+                'complete': bool(repo),
+            },
+            {
+                'step': 'commit',
+                'complete': bool(commit),
+            },
+            {
+                'step': 'deploy',
+                'complete': bool(deploy),
+            }
+        ])
diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index ee9e6547e2..1406d5c549 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -123,6 +123,7 @@ from .endpoints.project_release_files import ProjectReleaseFilesEndpoint
 from .endpoints.project_release_file_details import ProjectReleaseFileDetailsEndpoint
 from .endpoints.project_release_commits import ProjectReleaseCommitsEndpoint
 from .endpoints.project_releases import ProjectReleasesEndpoint
+from .endpoints.project_release_setup import ProjectReleaseSetupCompletionEndpoint
 from .endpoints.project_releases_token import ProjectReleasesTokenEndpoint
 from .endpoints.project_rules import ProjectRulesEndpoint
 from .endpoints.project_rules_configuration import ProjectRulesConfigurationEndpoint
@@ -810,6 +811,11 @@ urlpatterns = patterns(
         ProjectReleasesTokenEndpoint.as_view(),
         name='sentry-api-0-project-releases-token'
     ),
+    url(
+        r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/releases/completion/$',
+        ProjectReleaseSetupCompletionEndpoint.as_view(),
+        name='sentry-api-0-project-releases-completion-status'
+    ),
     url(
         r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/releases/(?P<version>[^/]+)/$',
         ProjectReleaseDetailsEndpoint.as_view(),
diff --git a/tests/sentry/api/endpoints/test_project_release_setup.py b/tests/sentry/api/endpoints/test_project_release_setup.py
new file mode 100644
index 0000000000..e8c3946bac
--- /dev/null
+++ b/tests/sentry/api/endpoints/test_project_release_setup.py
@@ -0,0 +1,49 @@
+from __future__ import absolute_import
+
+from django.core.urlresolvers import reverse
+
+from sentry.models import Commit, ReleaseCommit, Repository
+from sentry.testutils import APITestCase
+
+
+class ProjectReleaseSetupCompletionTest(APITestCase):
+    def test_simple(self):
+        project = self.create_project()
+        release = self.create_release(project, self.user)
+        self.create_group(project=project, first_release=release)
+
+        repo = Repository.objects.create(
+            organization_id=project.organization_id,
+            name=project.name,
+        )
+
+        commit = Commit.objects.create(
+            organization_id=project.organization_id,
+            repository_id=repo.id,
+            key='b' * 40,
+        )
+
+        ReleaseCommit.objects.create(
+            organization_id=project.organization_id,
+            release=release,
+            commit=commit,
+            order=0,
+        )
+
+        url = reverse(
+            'sentry-api-0-project-releases-completion-status',
+            kwargs={
+                'organization_slug': project.organization.slug,
+                'project_slug': project.slug,
+            }
+        )
+
+        self.login_as(user=self.user)
+
+        response = self.client.get(url)
+        assert response.status_code == 200, response.content
+        assert len(response.data) == 4
+        assert response.data[2]['step'] == 'commit'
+        assert response.data[2]['complete'] is True
+        assert response.data[3]['step'] == 'deploy'
+        assert response.data[3]['complete'] is False
