commit b20ce21d116b5a7a224bb4ed18c46cf091c1f786
Author: Dena Mwangi <dena@getsentry.com>
Date:   Wed Aug 16 16:34:00 2017 -0500

    Add schedule_jobs function (#5870)
    
    * Add function to make it easier to schedule jobs

diff --git a/src/sentry/models/scheduledjob.py b/src/sentry/models/scheduledjob.py
index 69202aae69..cb698ed783 100644
--- a/src/sentry/models/scheduledjob.py
+++ b/src/sentry/models/scheduledjob.py
@@ -4,7 +4,17 @@ from django.db import models
 from django.utils import timezone
 from jsonfield import JSONField
 
-from sentry.db.models import Model, sane_repr
+from sentry.db.models import (Model, sane_repr)
+
+
+def schedule_jobs(jobs):
+    ScheduledJob.objects.bulk_create(
+        [
+            ScheduledJob(payload=payload, name=name, date_scheduled=date_scheduled)
+            for (payload, name, date_scheduled) in jobs
+        ]
+    )
+    return True
 
 
 class ScheduledJob(Model):
diff --git a/tests/sentry/tasks/test_enqueue_scheduled_jobs.py b/tests/sentry/tasks/test_enqueue_scheduled_jobs.py
index 3f3875b945..ddc62e48ad 100644
--- a/tests/sentry/tasks/test_enqueue_scheduled_jobs.py
+++ b/tests/sentry/tasks/test_enqueue_scheduled_jobs.py
@@ -2,9 +2,13 @@ from __future__ import absolute_import, print_function
 
 from datetime import timedelta
 from django.utils import timezone
+from django.core.exceptions import ValidationError
 from mock import patch
 
+import pytest
+
 from sentry.models import ScheduledJob
+from sentry.models.scheduledjob import schedule_jobs
 from sentry.testutils import TestCase
 from sentry.tasks.scheduler import enqueue_scheduled_jobs
 
@@ -41,3 +45,38 @@ class EnqueueScheduledJobsTest(TestCase):
             'sentry.tasks.enqueue_scheduled_jobs',
             kwargs={'foo': 'bar'},
         )
+
+    def test_schedule_job(self):
+        job = [
+            (
+                {
+                    'foo': 'baz'
+                }, 'sentry.tasks.enqueue_scheduled_jobs', timezone.now() + timedelta(days=1)
+            ), (
+                {
+                    'foo': 'baz'
+                }, 'sentry.tasks.enqueue_scheduled_jobs_followup',
+                timezone.now() + timedelta(days=1)
+            )
+        ]
+        schedule_jobs(job)
+        assert set(
+            ScheduledJob.objects.filter(
+                payload={'foo': 'baz'},
+            ).values_list('name', flat=True)
+        ) == set(
+            ['sentry.tasks.enqueue_scheduled_jobs', 'sentry.tasks.enqueue_scheduled_jobs_followup']
+        )
+
+    def test_schedule_job_order(self):
+        with pytest.raises(
+            ValidationError, message="ValidationError raised. Check order of inputs"
+        ):
+            job = [
+                (
+                    'sentry.tasks.enqueue_scheduled_jobs', {
+                        'foo': 'baz'
+                    }, timezone.now() + timedelta(days=1)
+                )
+            ]
+            schedule_jobs(job)
