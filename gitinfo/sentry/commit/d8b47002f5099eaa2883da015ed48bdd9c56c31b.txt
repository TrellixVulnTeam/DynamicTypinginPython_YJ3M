commit d8b47002f5099eaa2883da015ed48bdd9c56c31b
Author: Guilherme Souza <guivideojob@gmail.com>
Date:   Tue Apr 16 14:01:16 2013 -0300

    Allowing endpoint settings

diff --git a/src/sentry/conf/defaults.py b/src/sentry/conf/defaults.py
index 52510c8726..2f48b5fa20 100644
--- a/src/sentry/conf/defaults.py
+++ b/src/sentry/conf/defaults.py
@@ -161,3 +161,6 @@ AUTH_PROVIDERS = {
 # Default alerting threshold values
 DEFAULT_ALERT_PROJECT_THRESHOLD = (500, 100)  # 500%, 100 events
 DEFAULT_ALERT_GROUP_THRESHOLD = (1000, 100)  # 1000%, 100 events
+
+ENDPOINT = None
+PUBLIC_ENDPOINT = None
diff --git a/src/sentry/models.py b/src/sentry/models.py
index bd82b44ac7..6ba2943763 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -340,10 +340,12 @@ class ProjectKey(Model):
         # TODO: change the DSN to use project slug once clients are compatible
         if not public:
             key = '%s:%s' % (self.public_key, self.secret_key)
+            url = settings.ENDPOINT
         else:
             key = self.public_key
+            url = settings.PUBLIC_ENDPOINT
 
-        urlparts = urlparse.urlparse(settings.URL_PREFIX)
+        urlparts = urlparse.urlparse(url or settings.URL_PREFIX)
 
         return '%s://%s@%s/%s' % (
             urlparts.scheme,
diff --git a/tests/sentry/models/tests.py b/tests/sentry/models/tests.py
index 54724ddfba..126e169621 100644
--- a/tests/sentry/models/tests.py
+++ b/tests/sentry/models/tests.py
@@ -56,6 +56,16 @@ class ProjectKeyTest(TestCase):
         with self.Settings(SENTRY_URL_PREFIX='http://example.com:81'):
             self.assertEquals(key.get_dsn(), 'http://public:secret@example.com:81/1')
 
+    def test_get_dsn_with_public_endpoint_setting(self):
+        key = ProjectKey(project_id=1, public_key='public', secret_key='secret')
+        with self.Settings(SENTRY_PUBLIC_ENDPOINT='http://public_endpoint.com'):
+            self.assertEquals(key.get_dsn(public=True), 'http://public@public_endpoint.com/1')
+
+    def test_get_dsn_with_endpoint_setting(self):
+        key = ProjectKey(project_id=1, public_key='public', secret_key='secret')
+        with self.Settings(SENTRY_ENDPOINT='http://endpoint.com'):
+            self.assertEquals(key.get_dsn(), 'http://public:secret@endpoint.com/1')
+
     def test_key_is_created_for_project_with_existing_team(self):
         user = User.objects.create(username='admin')
         team = Team.objects.create(name='Test', slug='test', owner=user)
