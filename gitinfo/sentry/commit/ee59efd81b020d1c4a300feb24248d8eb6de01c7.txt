commit ee59efd81b020d1c4a300feb24248d8eb6de01c7
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 28 08:45:16 2014 -0800

    Log a warning when a resolve happens on a large amount of rows..
    
    because you can never trust users.

diff --git a/src/sentry/db/models/query.py b/src/sentry/db/models/query.py
index 804cf18651..e6589d736b 100644
--- a/src/sentry/db/models/query.py
+++ b/src/sentry/db/models/query.py
@@ -36,9 +36,9 @@ def update(self, using=None, **kwargs):
         setattr(self, k, v)
     if affected == 1:
         post_save.send(sender=self.__class__, instance=self, created=False)
-        return True
+        return affected
     elif affected == 0:
-        return False
+        return affected
     elif affected < 0:
         raise ValueError("Somehow we have updated a negative amount of rows, you seem to have a problem with your db backend.")
     else:
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index 3d342d864d..4f0dc5bf8f 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -557,9 +557,12 @@ def clear(request, team, project):
 
     # TODO: should we record some kind of global event in Activity?
     event_list = response['event_list']
-    happened = event_list.update(status=STATUS_RESOLVED)
+    rows_affected = event_list.update(status=STATUS_RESOLVED)
+    if rows_affected > 1000:
+        logger.warning(
+            'Large resolve on %s of %s rows', project.slug, rows_affected)
 
-    if happened:
+    if rows_affected:
         Activity.objects.create(
             project=project,
             type=Activity.SET_RESOLVED,
