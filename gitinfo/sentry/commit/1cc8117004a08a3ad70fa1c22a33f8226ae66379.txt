commit 1cc8117004a08a3ad70fa1c22a33f8226ae66379
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Apr 22 17:18:12 2012 -0700

    Add sorting of projects by events

diff --git a/sentry/templates/sentry/admin/projects/list.html b/sentry/templates/sentry/admin/projects/list.html
index a5392e26fd..a868e1916e 100644
--- a/sentry/templates/sentry/admin/projects/list.html
+++ b/sentry/templates/sentry/admin/projects/list.html
@@ -25,6 +25,10 @@
             </div>
         </form>
 
+        {% if sort == "events" %}
+            <p class="alert alert-info">{% trans "You are viewing projects sorted by the number of events created in the last 30 days. Projects that have not sent any data are not shown in this view." %}</p>
+        {% endif %}
+
         {% querystring from request without sort as sort_querystring %}
 
         {% if project_list.paginator.objects %}
@@ -38,7 +42,7 @@
                 <thead>
                     <tr>
                         <th><a href="?{{ sort_querystring }}&amp;sort=name">{% trans "Project" %}</a></th>
-                        <th style="text-align:center;">{% trans "Daily Events" %}</th>
+                        <th style="text-align:center;"><a href="?{{ sort_querystring }}&amp;sort=events">{% trans "Daily Events" %}</a></th>
                         <th style="text-align:center;"><a href="?{{ sort_querystring }}&amp;sort=date">{% trans "Date Added" %}</a></th>
                     </tr>
                 </thead>
diff --git a/sentry/web/frontend/admin.py b/sentry/web/frontend/admin.py
index f3a71289a6..14e864d4b2 100644
--- a/sentry/web/frontend/admin.py
+++ b/sentry/web/frontend/admin.py
@@ -66,6 +66,11 @@ def manage_projects(request):
         order_by = '-date_added'
     elif sort == 'name':
         order_by = 'name'
+    elif sort == 'events':
+        project_list = project_list.annotate(
+            events=Sum('projectcountbyminute__times_seen'),
+        ).filter(projectcountbyminute__date__gte=datetime.datetime.now() - datetime.timedelta(days=30))
+        order_by = '-events'
 
     project_list = project_list.order_by(order_by)
 
