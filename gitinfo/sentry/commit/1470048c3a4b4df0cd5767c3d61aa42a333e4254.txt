commit 1470048c3a4b4df0cd5767c3d61aa42a333e4254
Author: Daniel Griesser <daniel.griesser.86@gmail.com>
Date:   Mon Feb 27 21:44:44 2017 +0100

    Alias server.py settings, Change fetch_file signature to accept more parameters

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index e57c2b2b20..75a5513c8e 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -969,12 +969,15 @@ SENTRY_GRAVATAR_BASE_URL = 'https://secure.gravatar.com'
 
 # Timeout (in seconds) for fetching remote source files (e.g. JS)
 SENTRY_FETCH_TIMEOUT = 5
+SENTRY_SOURCE_FETCH_TIMEOUT = SENTRY_FETCH_TIMEOUT
 
 # Timeout (in seconds) for socket operations when fetching remote source files
 SENTRY_FETCH_SOCKET_TIMEOUT = 2
+SENTRY_SOURCE_FETCH_TIMEOUT = SENTRY_FETCH_SOCKET_TIMEOUT
 
 # Maximum content length for source files before we abort fetching
 SENTRY_FETCH_MAX_SIZE = 40 * 1024 * 1024
+SENTRY_SOURCE_FETCH_MAX_SIZE = SENTRY_FETCH_MAX_SIZE
 
 # List of IP subnets which should not be accessible
 SENTRY_DISALLOWED_IPS = ()
diff --git a/src/sentry/http.py b/src/sentry/http.py
index b56a591d5c..f234b920fa 100644
--- a/src/sentry/http.py
+++ b/src/sentry/http.py
@@ -234,7 +234,9 @@ def expose_url(url):
     return url
 
 
-def fetch_file(url, headers=None, domain_lock_enabled=True, outfile=None):
+def fetch_file(url, domain_lock_enabled=True, outfile=None,
+               headers=None, allow_redirects=True, verify_ssl=False,
+               timeout=settings.SENTRY_FETCH_SOCKET_TIMEOUT, **kwargs):
     """
     Pull down a URL, returning a UrlResult object.
     """
@@ -253,16 +255,18 @@ def fetch_file(url, headers=None, domain_lock_enabled=True, outfile=None):
 
     http_session = build_session()
     response = None
+
     try:
         try:
             start = time.time()
             response = http_session.get(
                 url,
-                allow_redirects=True,
-                verify=False,
+                allow_redirects=allow_redirects,
+                verify=verify_ssl,
                 headers=headers,
-                timeout=settings.SENTRY_FETCH_SOCKET_TIMEOUT,
+                timeout=timeout,
                 stream=True,
+                **kwargs
             )
 
             try:
diff --git a/src/sentry/lang/javascript/processor.py b/src/sentry/lang/javascript/processor.py
index e75dd14b46..0180b85c6e 100644
--- a/src/sentry/lang/javascript/processor.py
+++ b/src/sentry/lang/javascript/processor.py
@@ -313,7 +313,7 @@ def fetch_file(url, project=None, release=None, allow_scraping=True):
                 headers[token_header] = token
 
         with metrics.timer('sourcemaps.fetch'):
-            result = http.fetch_file(url, headers)
+            result = http.fetch_file(url, headers=headers)
             z_body = zlib.compress(result.body)
             cache.set(cache_key, (url, result.headers, z_body, result.status, result.encoding), 60)
 
