commit c49036f9abd22ef5152f067fe54c4dd09dfff6ff
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 15 00:47:47 2014 -0800

    Dont attempt to add someone who is already a member

diff --git a/src/sentry/web/frontend/accept_organization_invite.py b/src/sentry/web/frontend/accept_organization_invite.py
index 9ad5468f2c..2006060fed 100644
--- a/src/sentry/web/frontend/accept_organization_invite.py
+++ b/src/sentry/web/frontend/accept_organization_invite.py
@@ -81,28 +81,38 @@ class AcceptOrganizationInviteView(BaseView):
 
         form = self.get_form(request)
         if form.is_valid():
-            om.user = request.user
-            om.email = None
-            om.save()
-
-            AuditLogEntry.objects.create(
-                organization=organization,
-                actor=request.user,
-                ip_address=request.META['REMOTE_ADDR'],
-                target_object=om.id,
-                target_user=request.user,
-                event=AuditLogEntryEvent.MEMBER_ACCEPT,
-                data=om.get_audit_log_data(),
-            )
+            if OrganizationMember.objects.filter(user=request.user).exists():
+                messages.add_message(
+                    request, messages.SUCCESS,
+                    _('You are already a member of the %r organization.') % (
+                        organization.name.encode('utf-8'),
+                    )
+                )
 
-            request.session.pop('can_register', None)
+                om.delete()
+            else:
+                om.user = request.user
+                om.email = None
+                om.save()
+
+                AuditLogEntry.objects.create(
+                    organization=organization,
+                    actor=request.user,
+                    ip_address=request.META['REMOTE_ADDR'],
+                    target_object=om.id,
+                    target_user=request.user,
+                    event=AuditLogEntryEvent.MEMBER_ACCEPT,
+                    data=om.get_audit_log_data(),
+                )
 
-            messages.add_message(
-                request, messages.SUCCESS,
-                _('You have been added to the %r organization.') % (
-                    organization.name.encode('utf-8'),
+                messages.add_message(
+                    request, messages.SUCCESS,
+                    _('You have been added to the %r organization.') % (
+                        organization.name.encode('utf-8'),
+                    )
                 )
-            )
+
+            request.session.pop('can_register', None)
 
             return self.redirect(reverse('sentry-organization-home', args=[organization.slug]))
 
