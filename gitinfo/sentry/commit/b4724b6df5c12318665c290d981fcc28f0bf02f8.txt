commit b4724b6df5c12318665c290d981fcc28f0bf02f8
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Thu Oct 19 15:15:14 2017 -0500

    fix(cleanup): Fix threads_per_proc math, which effects number of processes created (#6377)

diff --git a/src/sentry/runner/commands/cleanup.py b/src/sentry/runner/commands/cleanup.py
index 4be13df6ce..059068a0d9 100644
--- a/src/sentry/runner/commands/cleanup.py
+++ b/src/sentry/runner/commands/cleanup.py
@@ -281,9 +281,9 @@ def cleanup(days, project, concurrency, max_procs, silent, model, router, timed)
         else:
             if concurrency > 1:
                 shard_ids = range(concurrency)
-                num_procs = min(concurrency, max_procs)
+                num_procs = min(multiprocessing.cpu_count(), max_procs)
                 threads_per_proc = int(math.ceil(
-                    num_procs / float(multiprocessing.cpu_count())))
+                    concurrency / float(num_procs)))
 
                 pids = []
                 for shard_id_chunk in chunker(shard_ids, threads_per_proc):
