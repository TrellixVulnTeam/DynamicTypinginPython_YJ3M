commit c0fa2aa122fd09549085ec133f843d5bfca46ea0
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Tue May 26 15:05:54 2020 -0700

    fix(alerts): Temporarily translate user -> tags[sentry:user] (#19026)

diff --git a/src/sentry/static/sentry/app/views/settings/incidentRules/metricField.tsx b/src/sentry/static/sentry/app/views/settings/incidentRules/metricField.tsx
index 1d51ca66ee..cf358f7888 100644
--- a/src/sentry/static/sentry/app/views/settings/incidentRules/metricField.tsx
+++ b/src/sentry/static/sentry/app/views/settings/incidentRules/metricField.tsx
@@ -35,10 +35,10 @@ const cannedAggregates = [
     default: 'count()',
   },
   {
-    match: /^count_unique\(user(\.id)?\)/,
+    match: /^count_unique\(tags\[sentry:user\]\)/,
     name: 'Users affected',
     validDataset: [Dataset.ERRORS],
-    default: 'count_unique(user)',
+    default: 'count_unique(tags[sentry:user])',
   },
   {
     match: /^(p[0-9]{2,3}|percentile\(transaction\.duration,[^)]+\))/,
@@ -98,7 +98,17 @@ const getFieldOptionConfig = (dataset: Dataset) => {
   const aggregations = Object.fromEntries(
     config.aggregations.map(key => [key, AGGREGATIONS[key]])
   );
-  const fields = Object.fromEntries(config.fields.map(key => [key, FIELDS[key]]));
+  const fields = Object.fromEntries(
+    config.fields.map(key => {
+      // XXX(epurkhiser): Temporary hack while we handle the translation of user ->
+      // tags[sentry:user].
+      if (key === 'user') {
+        return ['tags[sentry:user]', 'string'];
+      }
+
+      return [key, FIELDS[key]];
+    })
+  );
 
   return {aggregations, fields};
 };
