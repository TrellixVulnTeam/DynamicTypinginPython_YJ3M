commit b493b8c1e52ae983ef299b9357e2397769999088
Author: Daniel Griesser <daniel.griesser.86@gmail.com>
Date:   Tue Apr 18 09:27:51 2017 +0200

    Add check for token before showing link

diff --git a/src/sentry/api/endpoints/project_processingissues.py b/src/sentry/api/endpoints/project_processingissues.py
index de0cf94e76..89074d943e 100644
--- a/src/sentry/api/endpoints/project_processingissues.py
+++ b/src/sentry/api/endpoints/project_processingissues.py
@@ -51,14 +51,13 @@ class ProjectProcessingIssuesEndpoint(ProjectEndpoint):
         reprocessing_issues = ReprocessingReport.objects \
             .filter(project_id=project.id).count()
 
-        data = {
-            'hasIssues': num_issues > 0,
-            'numIssues': num_issues,
-            'lastSeen': last_seen and serialize(last_seen.datetime) or None,
-            'resolveableIssues': len(resolveable_issues),
-            'hasMoreResolveableIssues': has_more,
-            'issuesProcessing': reprocessing_issues,
-            'signedLink': generate_signed_link(
+        tokens = [x for x in ApiToken.objects.filter(
+            user=request.user
+        ).all() if 'project:releases' in x.get_scopes()]
+
+        signedLink = None
+        if tokens and tokens[0]:
+            signedLink = generate_signed_link(
                 request.user,
                 'sentry-api-0-project-fix-processing-issues',
                 kwargs={
@@ -66,6 +65,15 @@ class ProjectProcessingIssuesEndpoint(ProjectEndpoint):
                     'organization_slug': project.organization.slug,
                 }
             )
+
+        data = {
+            'hasIssues': num_issues > 0,
+            'numIssues': num_issues,
+            'lastSeen': last_seen and serialize(last_seen.datetime) or None,
+            'resolveableIssues': len(resolveable_issues),
+            'hasMoreResolveableIssues': has_more,
+            'issuesProcessing': reprocessing_issues,
+            'signedLink': signedLink
         }
 
         if request.GET.get('detailed') == '1':
diff --git a/src/sentry/static/sentry/app/views/projectProcessingIssues.jsx b/src/sentry/static/sentry/app/views/projectProcessingIssues.jsx
index 58dc163c3a..c5002ea5e0 100644
--- a/src/sentry/static/sentry/app/views/projectProcessingIssues.jsx
+++ b/src/sentry/static/sentry/app/views/projectProcessingIssues.jsx
@@ -256,18 +256,23 @@ const ProjectProcessingIssues = React.createClass({
   renderResults() {
     const fixLink = this.state.processingIssues
       ? this.state.processingIssues.signedLink
-      : '';
-    return (
-      <div>
-        <div className="alert alert-block alert-info">
-          <div className="form-group" style={{marginBottom: 0}}>
-            <label>{t('Paste this command into your shell:')}</label>
-            <div className="form-control disabled auto-select" style={{marginBottom: 6}}>
-              curl -sL {fixLink} | bash
-            </div>
-            <i>{t('It will try to upload missing symbols from your system.')}</i>
+      : false;
+
+    let fixLinkBlock = null;
+    if (fixLink) {
+      fixLinkBlock = <div className="alert alert-block alert-info">
+        <div className="form-group" style={{marginBottom: 0}}>
+          <label>{t('Paste this command into your shell:')}</label>
+          <div className="form-control disabled auto-select" style={{marginBottom: 6}}>
+            curl -sL {fixLink} | bash
           </div>
+          <i>{t('It will try to upload missing symbols from your system.')}</i>
         </div>
+      </div>
+    }
+    return (
+      <div>
+        {fixLinkBlock}
         <table className="table processing-issues">
           <thead>
             <tr>
