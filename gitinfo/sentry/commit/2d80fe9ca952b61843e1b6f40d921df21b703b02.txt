commit 2d80fe9ca952b61843e1b6f40d921df21b703b02
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Dec 3 18:00:16 2015 -0800

    Leverage get_server_hostname within LostPasswordHash

diff --git a/src/sentry/models/lostpasswordhash.py b/src/sentry/models/lostpasswordhash.py
index 95a98a813a..3569850bec 100644
--- a/src/sentry/models/lostpasswordhash.py
+++ b/src/sentry/models/lostpasswordhash.py
@@ -12,7 +12,6 @@ from django.conf import settings
 from django.core.urlresolvers import reverse
 from django.db import models
 from django.utils import timezone
-from urlparse import urlparse
 
 from sentry.db.models import FlexibleForeignKey, Model, sane_repr
 from sentry.utils.http import absolute_uri
@@ -46,12 +45,12 @@ class LostPasswordHash(Model):
         return self.date_added > timezone.now() - timedelta(hours=48)
 
     def send_recover_mail(self):
-        from sentry import options
+        from sentry.http import get_server_hostname
         from sentry.utils.email import MessageBuilder
 
         context = {
             'user': self.user,
-            'domain': urlparse(options.get('system.url-prefix')).hostname,
+            'domain': get_server_hostname(),
             'url': absolute_uri(reverse(
                 'sentry-account-recover-confirm',
                 args=[self.user.id, self.hash]
