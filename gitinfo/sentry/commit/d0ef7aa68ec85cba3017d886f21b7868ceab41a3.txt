commit d0ef7aa68ec85cba3017d886f21b7868ceab41a3
Author: Ben Vinegar <benvinegar@users.noreply.github.com>
Date:   Thu Jan 19 17:01:10 2017 -0800

    Fix integrity error in load-mocks (#4793)

diff --git a/bin/load-mocks b/bin/load-mocks
index be84b75a3c..b4c9411651 100755
--- a/bin/load-mocks
+++ b/bin/load-mocks
@@ -287,19 +287,6 @@ def main(num_events=1):
                         )
                     release.add_project(project)
 
-            ReleaseFile.objects.get_or_create(
-                organization_id=project.organization_id,
-                release=release,
-                name='an-example.js',
-                file=File.objects.get_or_create(
-                    name='an-example.js',
-                    type='release.file',
-                    checksum='abcde' * 8,
-                    size=13043,
-                )[0],
-                defaults={'organization_id': project.organization_id}
-            )
-
             raw_commits = [
                 {
                     'key': '6fb7672bee9c469a8aa074f52ed72eddc939ae7d',
@@ -330,25 +317,42 @@ def main(num_events=1):
                 },
             ]
 
+            repo = Repository.objects.get_or_create(
+                organization_id=org.id,
+                name='Example Repo',
+                provider='github',
+                external_id='example/example',
+            )
+
             for commit_index, raw_commit in enumerate(raw_commits):
                 commit = Commit.objects.get_or_create(
                     organization_id=org.id,
-                    repository_id=Repository.objects.get_or_create(
-                        organization_id=org.id,
-                        name='Example Repo',
-                        provider='github',
-                        external_id='example/example',
-                    )[0].id,
+                    repository_id=repo[0].id,
                     key=raw_commit['key'],
-                    author=CommitAuthor.objects.get_or_create(
-                        organization_id=org.id,
-                        name=raw_commit['author'][0],
-                        email=raw_commit['author'][1],
-                    )[0],
-                    message=raw_commit['message'],
+                    defaults={
+                        'author': CommitAuthor.objects.get_or_create(
+                            organization_id=org.id,
+                            name=raw_commit['author'][0],
+                            email=raw_commit['author'][1],
+                        )[0],
+                        'message': raw_commit['message'],
+                    },
                 )[0]
 
                 for file in raw_commit['files']:
+                    ReleaseFile.objects.get_or_create(
+                        organization_id=project.organization_id,
+                        release=release,
+                        name=file[0],
+                        file=File.objects.get_or_create(
+                            name=file[0],
+                            type='release.file',
+                            checksum='abcde' * 8,
+                            size=13043,
+                        )[0],
+                        defaults={'organization_id': project.organization_id}
+                    )
+
                     CommitFileChange.objects.get_or_create(
                         organization_id=org.id,
                         commit=commit,
@@ -356,6 +360,7 @@ def main(num_events=1):
                         type=file[1],
                     )
 
+
                 ReleaseCommit.objects.get_or_create(
                     organization_id=org.id,
                     release=release,
