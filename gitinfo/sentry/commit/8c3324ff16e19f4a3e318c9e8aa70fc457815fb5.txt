commit 8c3324ff16e19f4a3e318c9e8aa70fc457815fb5
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Mon Apr 27 10:18:26 2020 -0700

    ref(ui): Handle 404s from `/issues/id/events/latest/` (#18381)
    
    This catches 404s from `fetchGroupEventAndMarkSeen` action and records it to Sentry. This does not change anything except the error is now considered handled in Sentry. Also updates to use promises.

diff --git a/src/sentry/static/sentry/app/views/organizationGroupDetails/groupEventDetails/groupEventDetails.tsx b/src/sentry/static/sentry/app/views/organizationGroupDetails/groupEventDetails/groupEventDetails.tsx
index 3befa6354e..7af2fc9726 100644
--- a/src/sentry/static/sentry/app/views/organizationGroupDetails/groupEventDetails/groupEventDetails.tsx
+++ b/src/sentry/static/sentry/app/views/organizationGroupDetails/groupEventDetails/groupEventDetails.tsx
@@ -1,3 +1,4 @@
+import * as Sentry from '@sentry/browser';
 import {browserHistory} from 'react-router';
 import isEqual from 'lodash/isEqual';
 import PropTypes from 'prop-types';
@@ -120,7 +121,7 @@ class GroupEventDetails extends React.Component<Props, State> {
     api.clear();
   }
 
-  fetchData = () => {
+  fetchData = async () => {
     const {api, group, project, organization, params, environments} = this.props;
     const eventId = params.eventId || 'latest';
     const groupId = group.id;
@@ -135,32 +136,45 @@ class GroupEventDetails extends React.Component<Props, State> {
 
     const envNames = environments.map(e => e.name);
 
-    api
-      .requestPromise(`/projects/${orgSlug}/${projSlug}/releases/completion/`)
-      .then(data => {
-        this.setState({
-          releasesCompletion: data,
-        });
-      });
-
-    fetchGroupEventAndMarkSeen(api, orgSlug, projSlug, groupId, eventId, envNames)
-      .then(data => {
-        this.setState({
-          event: data,
-          error: false,
-          loading: false,
-        });
-      })
-      .catch(() => {
-        this.setState({
-          event: null,
-          error: true,
-          loading: false,
-        });
-      });
+    /**
+     * Perform below requests in parallel
+     */
+    const releasesCompletionPromise = api.requestPromise(
+      `/projects/${orgSlug}/${projSlug}/releases/completion/`
+    );
+    const fetchGroupEventPromise = fetchGroupEventAndMarkSeen(
+      api,
+      orgSlug,
+      projSlug,
+      groupId,
+      eventId,
+      envNames
+    );
 
     fetchSentryAppInstallations(api, orgSlug);
     fetchSentryAppComponents(api, orgSlug, projectId);
+
+    const releasesCompletion = await releasesCompletionPromise;
+    this.setState({
+      releasesCompletion,
+    });
+
+    try {
+      const event = await fetchGroupEventPromise;
+      this.setState({
+        event,
+        error: false,
+        loading: false,
+      });
+    } catch (err) {
+      // This is an expected error, capture to Sentry so that it is not considered as an unhandled error
+      Sentry.captureException(err);
+      this.setState({
+        event: null,
+        error: true,
+        loading: false,
+      });
+    }
   };
 
   get showExampleCommit() {
diff --git a/src/sentry/static/sentry/app/views/organizationGroupDetails/utils.jsx b/src/sentry/static/sentry/app/views/organizationGroupDetails/utils.jsx
index fed4114a21..3e799ba94e 100644
--- a/src/sentry/static/sentry/app/views/organizationGroupDetails/utils.jsx
+++ b/src/sentry/static/sentry/app/views/organizationGroupDetails/utils.jsx
@@ -9,7 +9,7 @@ import {Client} from 'app/api';
  * @param {String} eventId eventId or "latest" or "oldest"
  * @returns {Promise<Object>}
  */
-export function fetchGroupEventAndMarkSeen(
+export async function fetchGroupEventAndMarkSeen(
   api,
   orgId,
   projectId,
@@ -27,9 +27,8 @@ export function fetchGroupEventAndMarkSeen(
     query.environment = envNames;
   }
 
-  const promise = api.requestPromise(url, {query});
-
-  promise.then(data => {
+  try {
+    const data = await api.requestPromise(url, {query});
     api.bulkUpdate({
       orgId,
       projectId,
@@ -38,9 +37,9 @@ export function fetchGroupEventAndMarkSeen(
       data: {hasSeen: true},
     });
     return data;
-  });
-
-  return promise;
+  } catch (err) {
+    throw err;
+  }
 }
 
 export function fetchGroupUserReports(groupId, query) {
