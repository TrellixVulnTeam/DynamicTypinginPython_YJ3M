commit 512e904c6515814fbe799d15a44bd098bd8de775
Author: Dena Mwangi <dena@getsentry.com>
Date:   Thu Jan 10 12:48:34 2019 -0800

    chore(experiments): Turn off Sample event experiment v2 (#11423)

diff --git a/src/sentry/static/sentry/app/components/createSampleEvent.jsx b/src/sentry/static/sentry/app/components/createSampleEvent.jsx
index 0a0018b078..d353a87a34 100644
--- a/src/sentry/static/sentry/app/components/createSampleEvent.jsx
+++ b/src/sentry/static/sentry/app/components/createSampleEvent.jsx
@@ -29,18 +29,15 @@ const CreateSampleEvent = createReactClass({
     let {projectId} = this.props.params;
     let {organization} = this.context;
     let project = organization.projects.find(proj => proj.slug === projectId);
+
+    if (!project) return;
+
     let data = {
       org_id: parseInt(organization.id, 10),
       source: this.props.source,
+      project_id: parseInt(project.id, 10),
     };
-
-    if (!project) {
-      data.project_slug = projectId;
-      analytics('sample_event.button_viewed2', data);
-    } else {
-      data.project_id = parseInt(project.id, 10);
-      analytics('sample_event.button_viewed', data);
-    }
+    analytics('sample_event.button_viewed', data);
   },
 
   createSampleEvent() {
@@ -75,13 +72,7 @@ const CreateSampleEvent = createReactClass({
   },
 
   render() {
-    let {source} = this.props;
-
-    return source === 'waiting' ? (
-      <StyledButton priority="link" onClick={this.createSampleEvent}>
-        Or See Sample Event
-      </StyledButton>
-    ) : (
+    return (
       <div className="pull-right">
         <StyledButton priority="primary" onClick={this.createSampleEvent}>
           Or See Sample Event
diff --git a/src/sentry/static/sentry/app/stores/hookStore.jsx b/src/sentry/static/sentry/app/stores/hookStore.jsx
index 58d1411efd..f4a457344a 100644
--- a/src/sentry/static/sentry/app/stores/hookStore.jsx
+++ b/src/sentry/static/sentry/app/stores/hookStore.jsx
@@ -23,8 +23,6 @@ const validHookNames = new Set([
   'utils:onboarding-survey-url',
   'component:org-auth-view',
   'component:org-members-view',
-  'component:create-sample-event',
-  'component:install-prompt-banner',
 
   // Additional settings
   'settings:organization-navigation',
diff --git a/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx b/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
index a2118b2dd9..93bd2b009f 100644
--- a/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
+++ b/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
@@ -5,7 +5,7 @@ import * as Sentry from '@sentry/browser';
 
 import {analytics, amplitude} from 'app/utils/analytics';
 import ApiMixin from 'app/mixins/apiMixin';
-import Hook from 'app/components/hook';
+import CreateSampleEvent from 'app/components/createSampleEvent';
 import ProjectContext from 'app/views/projects/projectContext';
 import ProjectDocsContext from 'app/views/projectInstall/docsContext';
 import ProjectInstallPlatform from 'app/views/projectInstall/platform';
@@ -130,19 +130,13 @@ const Configure = createReactClass({
     let {orgId, projectId} = this.props.params;
     let {hasSentRealEvent} = this.state;
 
-    let data = {
-      params: this.props.params,
-      organization: this.context.organization,
-      source: 'header',
-    };
-
     return (
       <div>
         <div className="onboarding-Configure">
           <h2 style={{marginBottom: 30}}>
             Configure your application
             {!hasSentRealEvent && (
-              <Hook name="component:create-sample-event" params={data} key="header" />
+              <CreateSampleEvent params={this.props.params} source="header" />
             )}
           </h2>
           <ProjectContext projectId={projectId} orgId={orgId} style={{marginBottom: 30}}>
@@ -158,12 +152,7 @@ const Configure = createReactClass({
               />
             </ProjectDocsContext>
           </ProjectContext>
-          <Waiting
-            skip={this.submit}
-            hasEvent={this.state.hasSentRealEvent}
-            params={this.props.params}
-            organization={this.context.organization}
-          />
+          <Waiting skip={this.submit} hasEvent={hasSentRealEvent} />
         </div>
       </div>
     );
diff --git a/src/sentry/static/sentry/app/views/onboarding/configure/waiting.jsx b/src/sentry/static/sentry/app/views/onboarding/configure/waiting.jsx
index bcc12f41b4..6bab753870 100644
--- a/src/sentry/static/sentry/app/views/onboarding/configure/waiting.jsx
+++ b/src/sentry/static/sentry/app/views/onboarding/configure/waiting.jsx
@@ -4,27 +4,22 @@ import {t} from 'app/locale';
 import styled from 'react-emotion';
 
 import Button from 'app/components/button';
-import Hook from 'app/components/hook';
-import SentryTypes from 'app/sentryTypes';
 
 class Waiting extends React.Component {
   static propTypes = {
     skip: PropTypes.func,
     hasEvent: PropTypes.bool.isRequired,
-    params: PropTypes.object,
-    organization: SentryTypes.Organization,
   };
 
   render() {
-    let {hasEvent, organization, params} = this.props;
-    let data = {params, organization, source: 'waiting'};
+    let {hasEvent} = this.props;
 
     return (
       <div className="awaiting-event">
         <div className="row">
           <div className="col-sm-10">
             <div className="wrap waiting-text">
-              {!this.props.hasEvent ? (
+              {!hasEvent ? (
                 <h3 className="animated-ellipsis">{t('Waiting to receive an error')}</h3>
               ) : (
                 <h3>{t("You've successfully sent an error")}</h3>
@@ -43,9 +38,6 @@ class Waiting extends React.Component {
               >
                 {t('All done!')}
               </Button>
-              {!hasEvent && (
-                <Hook name="component:create-sample-event" params={data} key="waiting" />
-              )}
             </div>
           </CenteredButtons>
         </div>
diff --git a/src/sentry/static/sentry/app/views/organizationDetails.jsx b/src/sentry/static/sentry/app/views/organizationDetails.jsx
index 5bb830c9ea..9264cb8167 100644
--- a/src/sentry/static/sentry/app/views/organizationDetails.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDetails.jsx
@@ -8,7 +8,7 @@ import {Client} from 'app/api';
 import OrganizationContext from 'app/views/organizationContext';
 import NarrowLayout from 'app/components/narrowLayout';
 import Footer from 'app/components/footer';
-import Hook from 'app/components/hook';
+import InstallPromptBanner from 'app/components/installPromptBanner';
 import {t, tct} from 'app/locale';
 
 class DeletionInProgress extends Component {
@@ -135,11 +135,7 @@ class OrganizationDetailsBody extends Component {
       }
     return (
       <React.Fragment>
-        <Hook
-          name="component:install-prompt-banner"
-          params={{organization}}
-          key="banner"
-        />
+        <InstallPromptBanner organization={organization} />
         <ErrorBoundary>{this.props.children}</ErrorBoundary>
         <Footer />
       </React.Fragment>
diff --git a/tests/acceptance/test_dashboard.py b/tests/acceptance/test_dashboard.py
index bd7d8ef472..57f733f26f 100644
--- a/tests/acceptance/test_dashboard.py
+++ b/tests/acceptance/test_dashboard.py
@@ -3,7 +3,7 @@ from __future__ import absolute_import
 from django.utils import timezone
 
 from sentry.testutils import AcceptanceTestCase
-from sentry.models import GroupAssignee, Release, Environment, Deploy, ReleaseProjectEnvironment
+from sentry.models import GroupAssignee, Release, Environment, Deploy, ReleaseProjectEnvironment, OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 from sentry.utils.samples import create_sample_event
 from datetime import datetime
 
@@ -80,6 +80,11 @@ class DashboardTest(AcceptanceTestCase):
             group=event.group,
             project=self.project,
         )
+        OrganizationOnboardingTask.objects.create_or_update(
+            organization_id=self.project.organization_id,
+            task=OnboardingTask.FIRST_EVENT,
+            status=OnboardingTaskStatus.COMPLETE,
+        )
         self.project.update(first_event=timezone.now())
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading-indicator')
diff --git a/tests/acceptance/test_project_overview.py b/tests/acceptance/test_project_overview.py
index 3317a9cf82..84da0bd637 100644
--- a/tests/acceptance/test_project_overview.py
+++ b/tests/acceptance/test_project_overview.py
@@ -3,6 +3,7 @@ from __future__ import absolute_import
 from django.utils import timezone
 
 from sentry.testutils import AcceptanceTestCase
+from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectOverviewTest(AcceptanceTestCase):
@@ -28,6 +29,11 @@ class ProjectOverviewTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
+        OrganizationOnboardingTask.objects.create_or_update(
+            organization_id=self.project.organization_id,
+            task=OnboardingTask.FIRST_EVENT,
+            status=OnboardingTaskStatus.COMPLETE,
+        )
         self.browser.get(self.path)
         self.browser.wait_until('.chart-wrapper')
         self.browser.wait_until_not('.loading')
diff --git a/tests/acceptance/test_project_releases.py b/tests/acceptance/test_project_releases.py
index 88b81f00d1..bba643b7f5 100644
--- a/tests/acceptance/test_project_releases.py
+++ b/tests/acceptance/test_project_releases.py
@@ -1,6 +1,7 @@
 from __future__ import absolute_import
 
 from sentry.testutils import AcceptanceTestCase
+from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectReleasesTest(AcceptanceTestCase):
@@ -30,6 +31,11 @@ class ProjectReleasesTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
+        OrganizationOnboardingTask.objects.create_or_update(
+            organization_id=self.project.organization_id,
+            task=OnboardingTask.FIRST_EVENT,
+            status=OnboardingTaskStatus.COMPLETE,
+        )
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading')
         self.browser.wait_until('.ref-project-releases')
@@ -64,6 +70,11 @@ class ProjectReleaseDetailsTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
+        OrganizationOnboardingTask.objects.create_or_update(
+            organization_id=self.project.organization_id,
+            task=OnboardingTask.FIRST_EVENT,
+            status=OnboardingTaskStatus.COMPLETE,
+        )
         self.login_as(self.user)
         self.path = u'/{}/{}/releases/{}/'.format(
             self.org.slug, self.project.slug, self.release.version)
diff --git a/tests/acceptance/test_project_user_feedback.py b/tests/acceptance/test_project_user_feedback.py
index 5ab29aee89..9c9e265534 100644
--- a/tests/acceptance/test_project_user_feedback.py
+++ b/tests/acceptance/test_project_user_feedback.py
@@ -3,6 +3,7 @@ from __future__ import absolute_import
 from django.utils import timezone
 
 from sentry.testutils import AcceptanceTestCase
+from sentry.models import OrganizationOnboardingTask, OnboardingTask, OnboardingTaskStatus
 
 
 class ProjectUserFeedbackTest(AcceptanceTestCase):
@@ -28,6 +29,11 @@ class ProjectUserFeedbackTest(AcceptanceTestCase):
             project=self.project,
             message='Foo bar',
         )
+        OrganizationOnboardingTask.objects.create_or_update(
+            organization_id=self.project.organization_id,
+            task=OnboardingTask.FIRST_EVENT,
+            status=OnboardingTaskStatus.COMPLETE,
+        )
         self.create_userreport(group=self.group, project=self.project, event=self.event)
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading')
diff --git a/tests/js/spec/components/events/interfaces/utils.spec.jsx b/tests/js/spec/components/events/interfaces/utils.spec.jsx
index c293b1670d..c5918ab7e2 100644
--- a/tests/js/spec/components/events/interfaces/utils.spec.jsx
+++ b/tests/js/spec/components/events/interfaces/utils.spec.jsx
@@ -109,7 +109,7 @@ describe('components/interfaces/utils', function() {
       getCurlCommand(eventWithProxy);
 
       // This may need to change, but we should aim to keep this low
-      expect(spy).toHaveBeenCalledTimes(172);
+      expect(spy.mock.calls.length).toBeLessThan(200);
     });
   });
 
diff --git a/tests/js/spec/views/onboarding/configure/__snapshots__/index.spec.jsx.snap b/tests/js/spec/views/onboarding/configure/__snapshots__/index.spec.jsx.snap
index 0835858f24..edf087c13b 100644
--- a/tests/js/spec/views/onboarding/configure/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/views/onboarding/configure/__snapshots__/index.spec.jsx.snap
@@ -13,28 +13,15 @@ exports[`Configure should render correctly render() should redirect to if no mat
       }
     >
       Configure your application
-      <Hook
-        key="header"
-        name="component:create-sample-event"
+      <createSampleEvent
         params={
           Object {
-            "organization": Object {
-              "id": "1337",
-              "slug": "testOrg",
-              "teams": Array [
-                Array [
-                  "project-slug",
-                ],
-              ],
-            },
-            "params": Object {
-              "orgId": "testOrg",
-              "platform": "other",
-              "projectId": "project-slug",
-            },
-            "source": "header",
+            "orgId": "testOrg",
+            "platform": "other",
+            "projectId": "project-slug",
           }
         }
+        source="header"
       />
     </h2>
     <withProjects(withRouter(ProjectContext))
@@ -66,24 +53,6 @@ exports[`Configure should render correctly render() should redirect to if no mat
     </withProjects(withRouter(ProjectContext))>
     <Waiting
       hasEvent={false}
-      organization={
-        Object {
-          "id": "1337",
-          "slug": "testOrg",
-          "teams": Array [
-            Array [
-              "project-slug",
-            ],
-          ],
-        }
-      }
-      params={
-        Object {
-          "orgId": "testOrg",
-          "platform": "other",
-          "projectId": "project-slug",
-        }
-      }
       skip={[Function]}
     />
   </div>
@@ -113,55 +82,74 @@ exports[`Configure should render correctly render() should render platform docs
         }
       >
         Configure your application
-        <Hook
-          key="header"
-          name="component:create-sample-event"
+        <createSampleEvent
           params={
             Object {
-              "organization": Object {
-                "id": "1337",
-                "projects": Array [
-                  Object {
-                    "hasAccess": true,
-                    "id": "testProject",
-                    "isBookmarked": false,
-                    "isMember": true,
-                    "name": "Test Project",
-                    "slug": "project-slug",
-                    "teams": Array [
-                      Object {
-                        "hasAccess": true,
-                        "id": "coolteam",
-                        "slug": "coolteam",
-                      },
-                    ],
-                  },
-                ],
-                "slug": "testOrg",
-                "teams": Array [
-                  Object {
-                    "hasAccess": true,
-                    "id": "coolteam",
-                    "projects": Array [
-                      Object {
-                        "id": "testProject",
-                        "name": "Test Project",
-                        "slug": "project-slug",
-                      },
-                    ],
-                    "slug": "coolteam",
-                  },
-                ],
-              },
-              "params": Object {
-                "orgId": "testOrg",
-                "platform": "node",
-                "projectId": "project-slug",
-              },
-              "source": "header",
+              "orgId": "testOrg",
+              "platform": "node",
+              "projectId": "project-slug",
             }
           }
-        />
+          source="header"
+        >
+          <div
+            className="pull-right"
+          >
+            <StyledButton
+              onClick={[Function]}
+              priority="primary"
+            >
+              <Button
+                className="css-1lewl16-StyledButton eadl9o50"
+                disabled={false}
+                onClick={[Function]}
+                priority="primary"
+              >
+                <StyledButton
+                  aria-label="Or See Sample Event"
+                  className="css-1lewl16-StyledButton eadl9o50"
+                  disabled={false}
+                  onClick={[Function]}
+                  priority="primary"
+                  role="button"
+                >
+                  <Component
+                    aria-label="Or See Sample Event"
+                    className="eadl9o50 css-w2sk1s-StyledButton-getColors-StyledButton eqrebog0"
+                    disabled={false}
+                    onClick={[Function]}
+                    priority="primary"
+                    role="button"
+                  >
+                    <button
+                      aria-label="Or See Sample Event"
+                      className="eadl9o50 css-w2sk1s-StyledButton-getColors-StyledButton eqrebog0"
+                      disabled={false}
+                      onClick={[Function]}
+                      priority="primary"
+                      role="button"
+                    >
+                      <ButtonLabel
+                        priority="primary"
+                      >
+                        <Component
+                          className="css-ga4b18-ButtonLabel eqrebog1"
+                          priority="primary"
+                        >
+                          <span
+                            className="css-ga4b18-ButtonLabel eqrebog1"
+                          >
+                            Or See Sample Event
+                          </span>
+                        </Component>
+                      </ButtonLabel>
+                    </button>
+                  </Component>
+                </StyledButton>
+              </Button>
+            </StyledButton>
+          </div>
+        </createSampleEvent>
       </h2>
       <withProjects(withRouter(ProjectContext))
         orgId="testOrg"
@@ -560,50 +548,6 @@ exports[`Configure should render correctly render() should render platform docs
       </withProjects(withRouter(ProjectContext))>
       <Waiting
         hasEvent={false}
-        organization={
-          Object {
-            "id": "1337",
-            "projects": Array [
-              Object {
-                "hasAccess": true,
-                "id": "testProject",
-                "isBookmarked": false,
-                "isMember": true,
-                "name": "Test Project",
-                "slug": "project-slug",
-                "teams": Array [
-                  Object {
-                    "hasAccess": true,
-                    "id": "coolteam",
-                    "slug": "coolteam",
-                  },
-                ],
-              },
-            ],
-            "slug": "testOrg",
-            "teams": Array [
-              Object {
-                "hasAccess": true,
-                "id": "coolteam",
-                "projects": Array [
-                  Object {
-                    "id": "testProject",
-                    "name": "Test Project",
-                    "slug": "project-slug",
-                  },
-                ],
-                "slug": "coolteam",
-              },
-            ],
-          }
-        }
-        params={
-          Object {
-            "orgId": "testOrg",
-            "platform": "node",
-            "projectId": "project-slug",
-          }
-        }
         skip={[Function]}
       >
         <div
@@ -691,55 +635,6 @@ exports[`Configure should render correctly render() should render platform docs
                       </Component>
                     </StyledButton>
                   </Button>
-                  <Hook
-                    key="waiting"
-                    name="component:create-sample-event"
-                    params={
-                      Object {
-                        "organization": Object {
-                          "id": "1337",
-                          "projects": Array [
-                            Object {
-                              "hasAccess": true,
-                              "id": "testProject",
-                              "isBookmarked": false,
-                              "isMember": true,
-                              "name": "Test Project",
-                              "slug": "project-slug",
-                              "teams": Array [
-                                Object {
-                                  "hasAccess": true,
-                                  "id": "coolteam",
-                                  "slug": "coolteam",
-                                },
-                              ],
-                            },
-                          ],
-                          "slug": "testOrg",
-                          "teams": Array [
-                            Object {
-                              "hasAccess": true,
-                              "id": "coolteam",
-                              "projects": Array [
-                                Object {
-                                  "id": "testProject",
-                                  "name": "Test Project",
-                                  "slug": "project-slug",
-                                },
-                              ],
-                              "slug": "coolteam",
-                            },
-                          ],
-                        },
-                        "params": Object {
-                          "orgId": "testOrg",
-                          "platform": "node",
-                          "projectId": "project-slug",
-                        },
-                        "source": "waiting",
-                      }
-                    }
-                  />
                 </div>
               </div>
             </CenteredButtons>
@@ -764,28 +659,15 @@ exports[`Configure should render correctly render() shouldn't redirect for a fou
       }
     >
       Configure your application
-      <Hook
-        key="header"
-        name="component:create-sample-event"
+      <createSampleEvent
         params={
           Object {
-            "organization": Object {
-              "id": "1337",
-              "slug": "testOrg",
-              "teams": Array [
-                Array [
-                  "project-slug",
-                ],
-              ],
-            },
-            "params": Object {
-              "orgId": "testOrg",
-              "platform": "node",
-              "projectId": "project-slug",
-            },
-            "source": "header",
+            "orgId": "testOrg",
+            "platform": "node",
+            "projectId": "project-slug",
           }
         }
+        source="header"
       />
     </h2>
     <withProjects(withRouter(ProjectContext))
@@ -817,24 +699,6 @@ exports[`Configure should render correctly render() shouldn't redirect for a fou
     </withProjects(withRouter(ProjectContext))>
     <Waiting
       hasEvent={false}
-      organization={
-        Object {
-          "id": "1337",
-          "slug": "testOrg",
-          "teams": Array [
-            Array [
-              "project-slug",
-            ],
-          ],
-        }
-      }
-      params={
-        Object {
-          "orgId": "testOrg",
-          "platform": "node",
-          "projectId": "project-slug",
-        }
-      }
       skip={[Function]}
     />
   </div>
