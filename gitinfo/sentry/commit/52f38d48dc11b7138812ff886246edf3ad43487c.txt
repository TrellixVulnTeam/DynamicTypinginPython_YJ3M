commit 52f38d48dc11b7138812ff886246edf3ad43487c
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Fri Feb 15 10:10:39 2019 -0800

    feat(email): Pass project in querystring where relevant (#12062)
    
    Email links preselect the correct project where relevant. Passing an
    active project filtes also ensures that default will be applied to the
    environment and datetime values and prior selections will not be used.

diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index 4a96845372..cb7eb29d52 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -283,6 +283,8 @@ class Group(Model):
         from sentry import features
         if features.has('organizations:sentry10', self.organization):
             url = reverse('sentry-organization-issue', args=[self.organization.slug, self.id])
+            params = {} if params is None else params
+            params['project'] = self.id
         else:
             url = reverse('sentry-group', args=[self.organization.slug, self.project.slug, self.id])
         if params:
diff --git a/src/sentry/plugins/sentry_mail/activity/release.py b/src/sentry/plugins/sentry_mail/activity/release.py
index 66eda0ed09..4233a69237 100644
--- a/src/sentry/plugins/sentry_mail/activity/release.py
+++ b/src/sentry/plugins/sentry_mail/activity/release.py
@@ -204,9 +204,10 @@ class ReleaseActivityEmail(ActivityEmail):
         if has_new_links:
             release_links = [
                 absolute_uri(
-                    u'/organizations/{}/releases/{}/'.format(
+                    u'/organizations/{}/releases/{}/?project={}'.format(
                         self.organization.slug,
                         self.release.version,
+                        p.id,
                     )
                 ) for p in projects
             ]
diff --git a/src/sentry/plugins/sentry_mail/activity/resolved_in_release.py b/src/sentry/plugins/sentry_mail/activity/resolved_in_release.py
index 8b93e20de2..e3a1b11cad 100644
--- a/src/sentry/plugins/sentry_mail/activity/resolved_in_release.py
+++ b/src/sentry/plugins/sentry_mail/activity/resolved_in_release.py
@@ -15,9 +15,10 @@ class ResolvedInReleaseActivityEmail(ActivityEmail):
         data = self.activity.data
 
         if features.has('organizations:sentry10', self.organization):
-            url = u'/organizations/{}/releases/{}/'.format(
+            url = u'/organizations/{}/releases/{}/?project={}'.format(
                 self.organization.slug,
-                data['version']
+                data['version'],
+                self.project.id,
             )
         else:
             url = u'/{}/{}/releases/{}/'.format(
diff --git a/src/sentry/templates/sentry/emails/_group.html b/src/sentry/templates/sentry/emails/_group.html
index 1741817e90..6e26a1e9a3 100644
--- a/src/sentry/templates/sentry/emails/_group.html
+++ b/src/sentry/templates/sentry/emails/_group.html
@@ -6,7 +6,7 @@
     <div class="event-type error">
       <h3>
         {% if metadata.type %}
-          {% include "sentry/emails/_group_link.html" with text=metadata.type|truncatechars:40 %}
+          <a href="{{group.get_absolute_url}}">{{metadata.type|truncatechars:40}}</a>
           {% if transaction %}
             <span class="event-subtitle">{{ transaction }}</span>
           {% endif %}
@@ -14,11 +14,11 @@
           {% if metadata.value %}
             <small>{{ metadata.value|truncatechars:100|soft_break:40 }}</small>
           {% endif %}
-        {% else %}
-          {% include "sentry/emails/_group_link.html" with text=metadata.value|truncatechars:40 %}
+          {% else %}
+          <a href="{{group.get_absolute_url}}">{{metadata.value|truncatechars:40}}</a>
           <br />
           {% if transaction %}
-            <span class="event-subtitle">{{ transaction }}</span>
+          <span class="event-subtitle">{{ transaction }}</span>
           {% endif %}
         {% endif %}
       </h3>
@@ -26,7 +26,7 @@
   {% elif type == "csp" %}
     <div class="event-type csp">
       <h3>
-        {% include "sentry/emails/_group_link.html" with text=metadata.directive|truncatechars:40 %}
+        <a href="{{group.get_absolute_url}}">{{metadata.directive|truncatechars:40}}</a>
         <br />
         {% if metadata.uri %}
           <span class="event-subtitle">{{ metadata.uri }}</span>
@@ -36,7 +36,7 @@
   {% else %}
     <div class="event-type default">
       <h3>
-        {% include "sentry/emails/_group_link.html" with text=group.title|truncatechars:40 %}
+        <a href="{{group.get_absolute_url}}">{{group.title|truncatechars:40}}</a>
         <br />
         {% if transaction %}
           <span class="event-subtitle">{{ transaction }}</span>
diff --git a/src/sentry/templates/sentry/emails/_group_link.html b/src/sentry/templates/sentry/emails/_group_link.html
deleted file mode 100644
index 3762400246..0000000000
--- a/src/sentry/templates/sentry/emails/_group_link.html
+++ /dev/null
@@ -1,11 +0,0 @@
-{% load sentry_helpers %}
-{% load sentry_features %}
-
-{% url_with_referrer 'sentry-group' group.organization.slug group.project.slug group.id as old_group_link %}
-{% url_with_referrer 'sentry-organization-issue' group.organization.slug group.id as new_group_link %}
-
-{% feature organizations:sentry10 group.organization %}
-    <a href="{% absolute_uri new_group_link %}">{{text}}</a>
-{% else %}
-    <a href="{% absolute_uri old_group_link %}">{{text}}</a>
-{% endfeature %}
diff --git a/src/sentry/web/frontend/debug/debug_new_release_email.py b/src/sentry/web/frontend/debug/debug_new_release_email.py
index d2d121e0c4..2fdd04849f 100644
--- a/src/sentry/web/frontend/debug/debug_new_release_email.py
+++ b/src/sentry/web/frontend/debug/debug_new_release_email.py
@@ -60,9 +60,10 @@ class DebugNewReleaseEmailView(View):
         if has_new_links:
             release_links = [
                 absolute_uri(
-                    u'/organizations/{}/releases/{}/'.format(
+                    u'/organizations/{}/releases/{}/?project={}'.format(
                         org.slug,
                         release.version,
+                        p.id,
                     )
                 ) for p in projects
             ]
