commit ce5ac2d584b1146dba25b897795f104d08b49e80
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Wed Aug 21 10:44:39 2019 -0700

    ref(ts): Convert tooltip (#14450)

diff --git a/src/sentry/static/sentry/app/components/tooltip.jsx b/src/sentry/static/sentry/app/components/tooltip.tsx
similarity index 84%
rename from src/sentry/static/sentry/app/components/tooltip.jsx
rename to src/sentry/static/sentry/app/components/tooltip.tsx
index f7faf19f67..4194cd724e 100644
--- a/src/sentry/static/sentry/app/components/tooltip.jsx
+++ b/src/sentry/static/sentry/app/components/tooltip.tsx
@@ -1,12 +1,36 @@
+import {Manager, Reference, Popper} from 'react-popper';
+import * as PopperJS from 'popper.js';
+import PropTypes from 'prop-types';
 import React from 'react';
 import ReactDOM from 'react-dom';
 import styled from 'react-emotion';
-import PropTypes from 'prop-types';
 
-import {Manager, Reference, Popper} from 'react-popper';
 import {domId} from 'app/utils/domId';
 
-class Tooltip extends React.Component {
+type Props = {
+  children: React.ReactElement;
+  disabled?: boolean;
+  title: React.ReactNode;
+  position: PopperJS.Placement;
+  popperStyle?: React.CSSProperties;
+  containerDisplayMode?: React.CSSProperties['display'];
+  delay?: number;
+};
+
+type State = {
+  isOpen: boolean;
+};
+
+// Using an inline-block solves the container being smaller
+// than the elements it is wrapping
+//
+// XXX(epurkhiser): We appease the typescript checker here by avoiding passing
+// props. I am not sure why this works.
+const Container = styled('span')`
+  display: ${(p: any) => p.containerDisplayMode};
+`;
+
+class Tooltip extends React.Component<Props, State> {
   static propTypes = {
     /**
      * Disable the tooltip display entirely
@@ -60,7 +84,7 @@ class Tooltip extends React.Component {
     containerDisplayMode: 'inline-block',
   };
 
-  constructor(props) {
+  constructor(props: Props) {
     super(props);
 
     let portal = document.getElementById('tooltip-portal');
@@ -80,11 +104,15 @@ class Tooltip extends React.Component {
     this.tooltipId = domId('tooltip-');
   }
 
+  portalEl: HTMLElement;
+  tooltipId: string = '';
+  delayTimeout: number | null = null;
+
   setOpen = () => {
     this.setState({isOpen: true});
   };
 
-  handleOpen = evt => {
+  handleOpen = () => {
     const {delay} = this.props;
 
     if (delay) {
@@ -94,7 +122,7 @@ class Tooltip extends React.Component {
     }
   };
 
-  handleClose = evt => {
+  handleClose = () => {
     this.setState({isOpen: false});
 
     if (this.delayTimeout) {
@@ -103,8 +131,8 @@ class Tooltip extends React.Component {
     }
   };
 
-  renderTrigger(children, ref) {
-    const propList = {
+  renderTrigger(children: React.ReactElement, ref: React.Ref<HTMLElement>) {
+    const propList: Partial<React.ComponentProps<typeof Container>> = {
       'aria-describedby': this.tooltipId,
       onFocus: this.handleOpen,
       onBlur: this.handleClose,
@@ -138,8 +166,8 @@ class Tooltip extends React.Component {
       return children;
     }
 
-    let tip = null;
-    const modifiers = {
+    let tip: React.ReactPortal | null = null;
+    const modifiers: PopperJS.Modifiers = {
       hide: {enabled: false},
       preventOverflow: {
         padding: 10,
@@ -156,7 +184,6 @@ class Tooltip extends React.Component {
               id={this.tooltipId}
               className="tooltip-content"
               aria-hidden={!isOpen}
-              isOpen={isOpen}
               innerRef={ref}
               style={style}
               data-placement={placement}
@@ -184,13 +211,7 @@ class Tooltip extends React.Component {
   }
 }
 
-// Using an inline-block solves the container being smaller
-// than the elements it is wrapping
-const Container = styled('span')`
-  display: ${p => p.containerDisplayMode};
-`;
-
-const TooltipContent = styled('div')`
+const TooltipContent = styled('div')<Pick<Props, 'popperStyle'>>`
   color: #fff;
   background: #000;
   opacity: 0.9;
@@ -207,7 +228,7 @@ const TooltipContent = styled('div')`
 
   margin: 6px;
   text-align: center;
-  ${props => props.popperStyle};
+  ${p => p.popperStyle as any};
 `;
 
 const TooltipArrow = styled('span')`
diff --git a/tests/js/spec/components/__snapshots__/createProject.spec.jsx.snap b/tests/js/spec/components/__snapshots__/createProject.spec.jsx.snap
index 93e3afddbf..141ecee1bf 100644
--- a/tests/js/spec/components/__snapshots__/createProject.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/createProject.spec.jsx.snap
@@ -1498,7 +1498,7 @@ exports[`CreateProject should deal with incorrect platform name if its provided
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -2474,7 +2474,7 @@ exports[`CreateProject should fill in platform name if its provided by url 1`] =
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -4150,7 +4150,7 @@ exports[`CreateProject should fill in project name if its empty when platform is
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
diff --git a/tests/js/spec/components/actions/__snapshots__/resolve.spec.jsx.snap b/tests/js/spec/components/actions/__snapshots__/resolve.spec.jsx.snap
index a2656a27dc..e62dd94c2f 100644
--- a/tests/js/spec/components/actions/__snapshots__/resolve.spec.jsx.snap
+++ b/tests/js/spec/components/actions/__snapshots__/resolve.spec.jsx.snap
@@ -256,7 +256,7 @@ exports[`ResolveActions with confirmation step renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
@@ -365,7 +365,7 @@ exports[`ResolveActions with confirmation step renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
@@ -474,7 +474,7 @@ exports[`ResolveActions with confirmation step renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
@@ -705,7 +705,7 @@ exports[`ResolveActions without confirmation renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
@@ -753,7 +753,7 @@ exports[`ResolveActions without confirmation renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
@@ -801,7 +801,7 @@ exports[`ResolveActions without confirmation renders 1`] = `
                             >
                               <span
                                 aria-describedby="tooltip-123456"
-                                className="css-zt6512-Container erna86q0"
+                                className="css-zt6512-Container eowlwvy0"
                                 onBlur={[Function]}
                                 onFocus={[Function]}
                                 onMouseEnter={[Function]}
diff --git a/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap b/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
index 62ed5b5f3d..8241ea528a 100644
--- a/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
+++ b/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
@@ -124,7 +124,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
               >
                 <span
                   aria-describedby="tooltip-123456"
-                  className="css-1m3e0hg-Container erna86q0"
+                  className="css-1m3e0hg-Container eowlwvy0"
                   onBlur={[Function]}
                   onFocus={[Function]}
                   onMouseEnter={[Function]}
@@ -272,7 +272,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -468,7 +468,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -664,7 +664,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -860,7 +860,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -1056,7 +1056,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -1304,7 +1304,7 @@ exports[`AvatarList renders with user avatars 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
@@ -1500,7 +1500,7 @@ exports[`AvatarList renders with user avatars 1`] = `
                       >
                         <span
                           aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
+                          className="css-1m3e0hg-Container eowlwvy0"
                           onBlur={[Function]}
                           onFocus={[Function]}
                           onMouseEnter={[Function]}
diff --git a/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap b/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
index db4c9b36ae..82a84c9612 100644
--- a/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
+++ b/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
@@ -146,7 +146,7 @@ exports[`CrashContent renders with meta data 1`] = `
                               >
                                 <span
                                   aria-describedby="tooltip-123456"
-                                  className="css-1m3e0hg-Container erna86q0"
+                                  className="css-1m3e0hg-Container eowlwvy0"
                                   onBlur={[Function]}
                                   onFocus={[Function]}
                                   onMouseEnter={[Function]}
diff --git a/tests/js/spec/views/__snapshots__/projectTags.spec.jsx.snap b/tests/js/spec/views/__snapshots__/projectTags.spec.jsx.snap
index 145d8473d2..f647253edb 100644
--- a/tests/js/spec/views/__snapshots__/projectTags.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/projectTags.spec.jsx.snap
@@ -1152,7 +1152,7 @@ exports[`ProjectTags renders 1`] = `
                                           >
                                             <span
                                               aria-describedby="tooltip-123456"
-                                              className="css-1m3e0hg-Container erna86q0"
+                                              className="css-1m3e0hg-Container eowlwvy0"
                                               onBlur={[Function]}
                                               onFocus={[Function]}
                                               onMouseEnter={[Function]}
@@ -1406,7 +1406,7 @@ exports[`ProjectTags renders 1`] = `
                                           >
                                             <span
                                               aria-describedby="tooltip-123456"
-                                              className="css-1m3e0hg-Container erna86q0"
+                                              className="css-1m3e0hg-Container eowlwvy0"
                                               onBlur={[Function]}
                                               onFocus={[Function]}
                                               onMouseEnter={[Function]}
diff --git a/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap b/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
index 7c4e387b83..e004264afa 100644
--- a/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
@@ -2588,7 +2588,7 @@ exports[`RuleBuilder renders with suggestions 1`] = `
                                                       >
                                                         <span
                                                           aria-describedby="tooltip-123456"
-                                                          className="css-1m3e0hg-Container erna86q0"
+                                                          className="css-1m3e0hg-Container eowlwvy0"
                                                           onBlur={[Function]}
                                                           onFocus={[Function]}
                                                           onMouseEnter={[Function]}
