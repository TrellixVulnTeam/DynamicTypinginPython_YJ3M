commit 43a6d5d6b261dd28d4ff8f3c8fba1c0a23d6a971
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 27 15:06:58 2017 -0800

    feat: Allow a user to reauthenticate for superuser

diff --git a/src/sentry/web/frontend/auth_login.py b/src/sentry/web/frontend/auth_login.py
index 17961f49f7..e4d3fd35ab 100644
--- a/src/sentry/web/frontend/auth_login.py
+++ b/src/sentry/web/frontend/auth_login.py
@@ -159,7 +159,10 @@ class AuthLoginView(BaseView):
     def get(self, request, *args, **kwargs):
         next_uri = self.get_next_uri(request, *args, **kwargs)
         if request.user.is_authenticated():
-            return self.handle_authenticated(request, *args, **kwargs)
+            # if the user is a superuser, but not 'superuser authenticated'
+            # we allow them to re-authenticate to gain superuser status
+            if not request.user.is_superuser or request.is_superuser():
+                return self.handle_authenticated(request, *args, **kwargs)
 
         request.session.set_test_cookie()
 
diff --git a/tests/sentry/web/frontend/test_auth_login.py b/tests/sentry/web/frontend/test_auth_login.py
index b6c831b982..942adfc5cf 100644
--- a/tests/sentry/web/frontend/test_auth_login.py
+++ b/tests/sentry/web/frontend/test_auth_login.py
@@ -143,3 +143,10 @@ class AuthLoginTest(TestCase):
         assert resp.status_code == 302
         assert next not in resp['Location']
         assert resp['Location'] == 'http://testserver/auth/login/'
+
+    def test_doesnt_redirect_with_superuser(self):
+        self.login_as(self.user, superuser=False)
+
+        resp = self.client.get(self.path)
+
+        assert resp.status_code == 200
