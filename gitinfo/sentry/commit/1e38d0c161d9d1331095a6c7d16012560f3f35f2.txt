commit 1e38d0c161d9d1331095a6c7d16012560f3f35f2
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Jan 30 12:14:27 2019 -0800

    feat(issues): Support multiple environments in releases sidebar (#11755)
    
    Release stats on the organization issue page is filtered by environment.

diff --git a/src/sentry/static/sentry/app/components/group/releaseStats.jsx b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
index 91f4d64560..dfa092cc0a 100644
--- a/src/sentry/static/sentry/app/components/group/releaseStats.jsx
+++ b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
@@ -4,8 +4,9 @@ import Reflux from 'reflux';
 import createReactClass from 'create-react-class';
 import SentryTypes from 'app/sentryTypes';
 import ApiMixin from 'app/mixins/apiMixin';
-import EnvironmentStore from 'app/stores/environmentStore';
+import OrganizationEnvironmentsStore from 'app/stores/organizationEnvironmentsStore';
 import LatestContextStore from 'app/stores/latestContextStore';
+import GlobalSelectionStore from 'app/stores/globalSelectionStore';
 import LoadingIndicator from 'app/components/loadingIndicator';
 import OrganizationState from 'app/mixins/organizationState';
 import GroupReleaseChart from 'app/components/group/releaseChart';
@@ -16,8 +17,8 @@ const GroupReleaseStats = createReactClass({
   displayName: 'GroupReleaseStats',
 
   propTypes: {
-    group: SentryTypes.Group,
-    project: SentryTypes.Project,
+    group: SentryTypes.Group.isRequired,
+    project: SentryTypes.Project.isRequired,
     allEnvironments: PropTypes.object,
   },
 
@@ -29,33 +30,56 @@ const GroupReleaseStats = createReactClass({
     ApiMixin,
     OrganizationState,
     Reflux.listenTo(LatestContextStore, 'onLatestContextChange'),
+    Reflux.listenTo(GlobalSelectionStore, 'onGlobalSelectionChange'),
   ],
 
   getInitialState() {
-    let envList = EnvironmentStore.getActive();
+    let envList = OrganizationEnvironmentsStore.getActive();
+
+    let environments = [];
+    if (this.hasSentry10()) {
+      environments = envList.filter(env =>
+        GlobalSelectionStore.get().environments.includes(env.name)
+      );
+    } else {
+      const latestContextEnv = LatestContextStore.getInitialState().environment;
+      environments = latestContextEnv ? [latestContextEnv] : [];
+    }
 
     return {
       envList,
-      environment: LatestContextStore.getInitialState().environment,
+      environments,
     };
   },
 
-  getEnvironment(envName) {
-    let defaultEnv = EnvironmentStore.getDefault();
-    let queriedEnvironment = EnvironmentStore.getByName(envName);
-
-    return queriedEnvironment || defaultEnv;
+  hasSentry10() {
+    return this.getFeatures().has('sentry10');
   },
 
   onLatestContextChange(context) {
-    this.setState({environment: context.environment || null});
+    this.setState({environments: context.environment ? [context.environment] : []});
+  },
+
+  onGlobalSelectionChange(selection) {
+    const environments = OrganizationEnvironmentsStore.getActive().filter(env =>
+      selection.environments.includes(env.name)
+    );
+    this.setState({environments});
   },
 
   render() {
     let {group, project, allEnvironments} = this.props;
-    let {environment} = this.state;
+    let {environments} = this.state;
+
+    const environmentLabel = environments.length
+      ? environments.map(env => env.displayName).join(', ')
+      : t('All Environments');
+
+    const shortEnvironmentLabel =
+      environments.length > 1
+        ? t('selected environments')
+        : environments.length === 1 ? environments[0].displayName : null;
 
-    let envName = environment ? environment.displayName : t('All Environments');
     let projectId = project.slug;
     let orgId = this.getOrganization().slug;
     let hasRelease = new Set(project.features).has('releases');
@@ -64,7 +88,7 @@ const GroupReleaseStats = createReactClass({
     return (
       <div className="env-stats">
         <h6>
-          <span>{envName}</span>
+          <span>{environmentLabel}</span>
         </h6>
         <div className="env-content">
           {isLoading ? (
@@ -73,7 +97,7 @@ const GroupReleaseStats = createReactClass({
             <div>
               <GroupReleaseChart
                 group={allEnvironments}
-                environment={envName}
+                environment={environmentLabel}
                 environmentStats={group.stats}
                 release={group.currentRelease ? group.currentRelease.release : null}
                 releaseStats={group.currentRelease ? group.currentRelease.stats : null}
@@ -84,7 +108,7 @@ const GroupReleaseStats = createReactClass({
               />
               <GroupReleaseChart
                 group={allEnvironments}
-                environment={envName}
+                environment={environmentLabel}
                 environmentStats={group.stats}
                 release={group.currentRelease ? group.currentRelease.release : null}
                 releaseStats={group.currentRelease ? group.currentRelease.stats : null}
@@ -96,7 +120,7 @@ const GroupReleaseStats = createReactClass({
               />
               <h6>
                 <span>{t('First seen')}</span>
-                {environment ? <small>({environment.displayName})</small> : null}
+                {environments.length ? <small>({environmentLabel})</small> : null}
               </h6>
 
               <SeenInfo
@@ -105,14 +129,14 @@ const GroupReleaseStats = createReactClass({
                 date={group.firstSeen}
                 dateGlobal={allEnvironments.firstSeen}
                 hasRelease={hasRelease}
-                environment={environment ? environment.name : null}
+                environment={shortEnvironmentLabel}
                 release={group.firstRelease || null}
                 title={t('First seen')}
               />
 
               <h6>
                 <span>{t('Last seen')}</span>
-                {environment ? <small>({environment.displayName})</small> : null}
+                {environments.length ? <small>({environmentLabel})</small> : null}
               </h6>
               <SeenInfo
                 orgId={orgId}
@@ -120,7 +144,7 @@ const GroupReleaseStats = createReactClass({
                 date={group.lastSeen}
                 dateGlobal={allEnvironments.lastSeen}
                 hasRelease={hasRelease}
-                environment={environment ? environment.name : null}
+                environment={shortEnvironmentLabel}
                 release={group.lastRelease || null}
                 title={t('Last seen')}
               />
diff --git a/src/sentry/static/sentry/app/components/group/sidebar.jsx b/src/sentry/static/sentry/app/components/group/sidebar.jsx
index 09c206599c..70c81738aa 100644
--- a/src/sentry/static/sentry/app/components/group/sidebar.jsx
+++ b/src/sentry/static/sentry/app/components/group/sidebar.jsx
@@ -1,6 +1,6 @@
 import PropTypes from 'prop-types';
 import React from 'react';
-import _ from 'lodash';
+import {isEqual, pickBy, keyBy, isObject} from 'lodash';
 import createReactClass from 'create-react-class';
 import classNames from 'classnames';
 
@@ -24,8 +24,7 @@ const GroupSidebar = createReactClass({
     project: SentryTypes.Project,
     group: SentryTypes.Group,
     event: SentryTypes.Event,
-    // Currently only provided in the project version of the issue page
-    environment: SentryTypes.Environment,
+    environments: PropTypes.arrayOf(SentryTypes.Environment),
   },
 
   contextTypes: {
@@ -35,7 +34,7 @@ const GroupSidebar = createReactClass({
   mixins: [ApiMixin, OrganizationState],
 
   getInitialState() {
-    return {participants: [], environment: this.props.environment};
+    return {participants: [], environments: this.props.environments};
   },
 
   componentWillMount() {
@@ -72,8 +71,8 @@ const GroupSidebar = createReactClass({
   },
 
   componentWillReceiveProps(nextProps) {
-    if (nextProps.environment !== this.props.environment) {
-      this.setState({environment: nextProps.environment}, this.fetchTagData);
+    if (!isEqual(nextProps.environments, this.props.environments)) {
+      this.setState({environments: nextProps.environments}, this.fetchTagData);
     }
   },
 
@@ -82,13 +81,13 @@ const GroupSidebar = createReactClass({
 
     // Fetch the top values for the current group's top tags.
     this.api.request(`/issues/${group.id}/tags/`, {
-      query: _.pickBy({
+      query: pickBy({
         key: group.tags.map(data => data.key),
-        environment: this.state.environment && this.state.environment.name,
+        environment: this.state.environments.map(env => env.name),
       }),
       success: data => {
         this.setState({
-          tagsWithTopValues: _.keyBy(data, 'key'),
+          tagsWithTopValues: keyBy(data, 'key'),
         });
       },
       error: () => {
@@ -158,7 +157,7 @@ const GroupSidebar = createReactClass({
             <dt>{`${plugin.shortName || plugin.name || plugin.title}: `}</dt>
             <dd>
               <a href={issue.url}>
-                {_.isObject(issue.label) ? issue.label.id : issue.label}
+                {isObject(issue.label) ? issue.label.id : issue.label}
               </a>
             </dd>
           </dl>
@@ -276,10 +275,8 @@ const GroupSidebar = createReactClass({
           })}
         {group.tags.length === 0 && (
           <p data-test-id="no-tags">
-            {this.props.environment
-              ? tct('No tags found in the [env] environment', {
-                  env: this.props.environment.displayName,
-                })
+            {this.props.environments.length
+              ? t('No tags found in the selected environments')
               : t('No tags found')}
           </p>
         )}
diff --git a/src/sentry/static/sentry/app/stores/organizationEnvironmentsStore.jsx b/src/sentry/static/sentry/app/stores/organizationEnvironmentsStore.jsx
new file mode 100644
index 0000000000..6d55c9e5fe
--- /dev/null
+++ b/src/sentry/static/sentry/app/stores/organizationEnvironmentsStore.jsx
@@ -0,0 +1,34 @@
+import Reflux from 'reflux';
+import {toTitleCase} from 'app/utils';
+
+const DEFAULT_EMPTY_ENV_NAME = '(No Environment)';
+const DEFAULT_EMPTY_ROUTING_NAME = 'none';
+
+const OrganizationEnvironmentsStore = Reflux.createStore({
+  init() {
+    this.items = [];
+  },
+
+  makeEnvironment(item) {
+    return {
+      id: item.id,
+      name: item.name,
+      get displayName() {
+        return toTitleCase(item.name) || DEFAULT_EMPTY_ENV_NAME;
+      },
+      get urlRoutingName() {
+        return item.name || DEFAULT_EMPTY_ROUTING_NAME;
+      },
+    };
+  },
+
+  loadInitialData(environments) {
+    this.items = environments.map(this.makeEnvironment);
+  },
+
+  getActive() {
+    return this.items;
+  },
+});
+
+export default OrganizationEnvironmentsStore;
diff --git a/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx b/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
index fac4eeab69..2b1c89fe4f 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
@@ -10,11 +10,25 @@ import ResolutionBox from 'app/components/resolutionBox';
 import MutedBox from 'app/components/mutedBox';
 import withOrganization from 'app/utils/withOrganization';
 import withEnvironment from 'app/utils/withEnvironment';
+import withGlobalSelection from 'app/utils/withGlobalSelection';
+import OrganizationEnvironmentStore from 'app/stores/organizationEnvironmentsStore';
 
 import GroupEventToolbar from './eventToolbar';
 import {fetchGroupEventAndMarkSeen} from './utils';
 
-const GroupSidebarWithEnvironment = withEnvironment(GroupSidebar);
+const GroupSidebarWithLatestContextEnvironment = withEnvironment(props => {
+  const {environment, ...otherProps} = props;
+  return <GroupSidebar {...otherProps} environments={environment ? [environment] : []} />;
+});
+
+const GroupSidebarWithGlobalSelectionEnvironment = withGlobalSelection(props => {
+  const {selection, ...otherProps} = props;
+  const environments = OrganizationEnvironmentStore.getActive().filter(env =>
+    selection.environments.includes(env.name)
+  );
+
+  return <GroupSidebar {...otherProps} environments={environments} />;
+});
 
 class GroupEventDetails extends React.Component {
   static propTypes = {
@@ -74,11 +88,9 @@ class GroupEventDetails extends React.Component {
     const {group, project, organization, params} = this.props;
     const evt = withMeta(this.state.event);
 
-    // Sidebar doesn't support multiple environments yet so do not pass an
-    // environment in the org level variant of the sidebar
     const SidebarWithEnvironment = params.projectId
-      ? GroupSidebarWithEnvironment
-      : GroupSidebar;
+      ? GroupSidebarWithLatestContextEnvironment
+      : GroupSidebarWithGlobalSelectionEnvironment;
 
     return (
       <div>
diff --git a/src/sentry/static/sentry/app/views/organizationContext.jsx b/src/sentry/static/sentry/app/views/organizationContext.jsx
index 558711a988..e495567865 100644
--- a/src/sentry/static/sentry/app/views/organizationContext.jsx
+++ b/src/sentry/static/sentry/app/views/organizationContext.jsx
@@ -21,6 +21,8 @@ import Sidebar from 'app/components/sidebar';
 import TeamStore from 'app/stores/teamStore';
 import space from 'app/styles/space';
 import GlobalSelectionStore from 'app/stores/globalSelectionStore';
+import OrganizationEnvironmentsStore from 'app/stores/organizationEnvironmentsStore';
+import {fetchOrganizationEnvironments} from 'app/actionCreators/environments';
 
 let ERROR_TYPES = {
   ORG_NOT_FOUND: 'ORG_NOT_FOUND',
@@ -83,8 +85,13 @@ const OrganizationContext = createReactClass({
   },
 
   fetchData() {
-    this.api.request(this.getOrganizationDetailsEndpoint(), {
-      success: data => {
+    const promises = [
+      this.api.requestPromise(this.getOrganizationDetailsEndpoint()),
+      fetchOrganizationEnvironments(this.api, this.props.params.orgId),
+    ];
+
+    Promise.all(promises)
+      .then(([data, environments]) => {
         // Allow injection via getsentry et all
         let hooks = [];
         HookStore.get('organization:header').forEach(cb => {
@@ -96,6 +103,7 @@ const OrganizationContext = createReactClass({
         TeamStore.loadInitialData(data.teams);
         ProjectsStore.loadInitialData(data.projects);
         GlobalSelectionStore.loadInitialData(data, this.props.location.query);
+        OrganizationEnvironmentsStore.loadInitialData(environments);
 
         this.setState({
           organization: data,
@@ -104,17 +112,15 @@ const OrganizationContext = createReactClass({
           errorType: null,
           hooks,
         });
-      },
-
-      error: (err, textStatus, errorThrown) => {
+      })
+      .catch(err => {
         let errorType = null;
-        switch (errorThrown) {
+        switch (err.statusText) {
           case 'NOT FOUND':
             errorType = ERROR_TYPES.ORG_NOT_FOUND;
             break;
           default:
         }
-
         this.setState({
           loading: false,
           error: true,
@@ -129,8 +135,7 @@ const OrganizationContext = createReactClass({
         openSudo({
           retryRequest: () => Promise.resolve(this.fetchData()),
         });
-      },
-    });
+      });
   },
 
   getOrganizationDetailsEndpoint() {
diff --git a/tests/js/spec/components/group/sidebar.spec.jsx b/tests/js/spec/components/group/sidebar.spec.jsx
index f8d4e34bde..d1a65f1ef3 100644
--- a/tests/js/spec/components/group/sidebar.spec.jsx
+++ b/tests/js/spec/components/group/sidebar.spec.jsx
@@ -31,7 +31,7 @@ describe('GroupSidebar', function() {
         group={group}
         project={project}
         event={TestStubs.Event()}
-        environment={environment}
+        environments={[environment]}
       />,
       TestStubs.routerContext()
     );
@@ -75,7 +75,7 @@ describe('GroupSidebar', function() {
           group={group}
           project={project}
           event={TestStubs.Event()}
-          environment={environment}
+          environments={[environment]}
         />,
         TestStubs.routerContext()
       );
@@ -87,7 +87,7 @@ describe('GroupSidebar', function() {
 
     it('renders empty text', function() {
       expect(wrapper.find('[data-test-id="no-tags"]').text()).toBe(
-        'No tags found in the Production environment'
+        'No tags found in the selected environments'
       );
     });
   });
@@ -120,13 +120,13 @@ describe('GroupSidebar', function() {
     it('re-requests tags with correct environment', function() {
       const stagingEnv = {name: 'staging', displayName: 'Staging', id: '2'};
       expect(tagValuesMock).toHaveBeenCalledTimes(1);
-      wrapper.setProps({environment: stagingEnv});
+      wrapper.setProps({environments: [stagingEnv]});
       expect(tagValuesMock).toHaveBeenCalledTimes(2);
       expect(tagValuesMock).toHaveBeenCalledWith(
         '/issues/1/tags/',
         expect.objectContaining({
           query: expect.objectContaining({
-            environment: 'staging',
+            environment: ['staging'],
           }),
         })
       );
diff --git a/tests/js/spec/stores/organizationEnvironmentsStore.spec.jsx b/tests/js/spec/stores/organizationEnvironmentsStore.spec.jsx
new file mode 100644
index 0000000000..9daa506e07
--- /dev/null
+++ b/tests/js/spec/stores/organizationEnvironmentsStore.spec.jsx
@@ -0,0 +1,23 @@
+import OrganizationEnvironmentsStore from 'app/stores/organizationEnvironmentsStore';
+
+describe('OrganizationEnvironmentsStore', function() {
+  afterEach(function() {
+    OrganizationEnvironmentsStore.init();
+  });
+
+  it('getActive()', function() {
+    expect(OrganizationEnvironmentsStore.getActive()).toEqual([]);
+  });
+
+  it('loadInitialData()', async function() {
+    OrganizationEnvironmentsStore.loadInitialData(TestStubs.Environments());
+
+    await tick();
+
+    const environments = OrganizationEnvironmentsStore.getActive();
+
+    expect(environments.length).toBe(2);
+    expect(environments.map(env => env.name)).toEqual(['production', 'staging']);
+    expect(environments.map(env => env.displayName)).toEqual(['Production', 'Staging']);
+  });
+});
diff --git a/tests/js/spec/views/__snapshots__/organizationsDetails.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationsDetails.spec.jsx.snap
deleted file mode 100644
index fde8f4daec..0000000000
--- a/tests/js/spec/views/__snapshots__/organizationsDetails.spec.jsx.snap
+++ /dev/null
@@ -1,1467 +0,0 @@
-// Jest Snapshot v1, https://goo.gl/fbAQLP
-
-exports[`OrganizationDetails render() deletion in progress should render a deletion in progress prompt 1`] = `
-<div
-  class="app"
->
-  <div
-    class="css-5cf61n-StyledSidebar-responsiveFlex e1sgxx350"
-  >
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-jdsvwb-SidebarDropdownRoot e1fowdfw3"
-        >
-          <div
-            class="css-1d9hpgj-SidebarDropdownActor e1fowdfw7"
-            data-test-id="sidebar-dropdown"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <div
-              style="display:flex;align-items:flex-start"
-            >
-              <span
-                class="avatar e1fowdfw8 css-tmrp5m-StyledBaseAvatar-StyledAvatar e1z0ohzl0"
-                style="width:32px;height:32px"
-              >
-                <svg
-                  class="css-123ijso-Svg e1knxa8x0"
-                  viewBox="0 0 120 120"
-                >
-                  <rect
-                    fill="#4674ca"
-                    height="120"
-                    rx="15"
-                    ry="15"
-                    width="120"
-                    x="0"
-                    y="0"
-                  />
-                  <text
-                    fill="#FFFFFF"
-                    font-size="65"
-                    style="dominant-baseline:central"
-                    text-anchor="middle"
-                    x="50%"
-                    y="50%"
-                  >
-                    OS
-                  </text>
-                </svg>
-              </span>
-              <div
-                class="css-1mzb71u-OrgAndUserWrapper e1fowdfw4"
-              >
-                <div
-                  class="css-df1voe-TextOverflow-OrgOrUserName e1fowdfw5"
-                >
-                  Organization Name 
-                  <i
-                    class="icon-arrow-down"
-                  />
-                </div>
-                <div
-                  class="css-1b3lkmg-TextOverflow-UserNameOrEmail e1fowdfw6"
-                >
-                  Foo Bar
-                </div>
-              </div>
-            </div>
-          </div>
-        </div>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Projects
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Assigned to me
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Bookmarked issues
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Recently viewed
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Activity
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Stats
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Settings
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-1dvxhjs-HelpRoot e1q2bb9t0"
-        >
-          <div
-            class="css-d4wreg-HelpActor e1q2bb9t1"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <a
-              class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-            >
-              <div
-                class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-              >
-                <span
-                  class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-                >
-                  <svg
-                    class="css-ryh69w-StyledSvg e2idor0"
-                    height="1em"
-                    viewBox="[object Object]"
-                    width="1em"
-                  >
-                    <use
-                      href="#test"
-                    />
-                  </svg>
-                </span>
-                <span
-                  class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-                >
-                  <div
-                    class="css-179hf69-TextOverflow e8qi82q0"
-                  >
-                    Help
-                  </div>
-                </span>
-              </div>
-            </a>
-          </div>
-        </div>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-          data-test-id="sidebar-broadcasts"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="22px"
-                viewBox="[object Object]"
-                width="22px"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                What's new
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-1j3ay2q-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      />
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="e1sgxx354 css-ekfpov-StyledSidebarItem-SidebarCollapseItem e1qdnaq70"
-          data-test-id="sidebar-collapse"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="e1sgxx353 css-coblwz-StyledSvg-StyledInlineSvg-ExpandedIcon e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Collapse
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-  </div>
-  <div
-    class="app"
-  >
-    <div
-      class="pattern-bg"
-    />
-    <div
-      class="container"
-    >
-      <div
-        class="box box-modal"
-      >
-        <div
-          class="box-header"
-        >
-          <a
-            href="/"
-          >
-            <span
-              class="icon-sentry-logo"
-            />
-          </a>
-        </div>
-        <div
-          class="box-content with-padding"
-        >
-          <p>
-            <span>
-              <span>
-                The 
-              </span>
-              <strong>
-                org-slug
-              </strong>
-              <span>
-                 organization is currently in the process of being deleted from Sentry.
-              </span>
-            </span>
-          </p>
-        </div>
-      </div>
-    </div>
-  </div>
-</div>
-`;
-
-exports[`OrganizationDetails render() pending deletion should render a restoration prompt 1`] = `
-<div
-  class="app"
->
-  <div
-    class="css-5cf61n-StyledSidebar-responsiveFlex e1sgxx350"
-  >
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-jdsvwb-SidebarDropdownRoot e1fowdfw3"
-        >
-          <div
-            class="css-1d9hpgj-SidebarDropdownActor e1fowdfw7"
-            data-test-id="sidebar-dropdown"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <div
-              style="display:flex;align-items:flex-start"
-            >
-              <span
-                class="avatar e1fowdfw8 css-tmrp5m-StyledBaseAvatar-StyledAvatar e1z0ohzl0"
-                style="width:32px;height:32px"
-              >
-                <svg
-                  class="css-123ijso-Svg e1knxa8x0"
-                  viewBox="0 0 120 120"
-                >
-                  <rect
-                    fill="#4674ca"
-                    height="120"
-                    rx="15"
-                    ry="15"
-                    width="120"
-                    x="0"
-                    y="0"
-                  />
-                  <text
-                    fill="#FFFFFF"
-                    font-size="65"
-                    style="dominant-baseline:central"
-                    text-anchor="middle"
-                    x="50%"
-                    y="50%"
-                  >
-                    OS
-                  </text>
-                </svg>
-              </span>
-              <div
-                class="css-1mzb71u-OrgAndUserWrapper e1fowdfw4"
-              >
-                <div
-                  class="css-df1voe-TextOverflow-OrgOrUserName e1fowdfw5"
-                >
-                  Organization Name 
-                  <i
-                    class="icon-arrow-down"
-                  />
-                </div>
-                <div
-                  class="css-1b3lkmg-TextOverflow-UserNameOrEmail e1fowdfw6"
-                >
-                  Foo Bar
-                </div>
-              </div>
-            </div>
-          </div>
-        </div>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Projects
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Assigned to me
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Bookmarked issues
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Recently viewed
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Activity
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Stats
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Settings
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-1dvxhjs-HelpRoot e1q2bb9t0"
-        >
-          <div
-            class="css-d4wreg-HelpActor e1q2bb9t1"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <a
-              class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-            >
-              <div
-                class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-              >
-                <span
-                  class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-                >
-                  <svg
-                    class="css-ryh69w-StyledSvg e2idor0"
-                    height="1em"
-                    viewBox="[object Object]"
-                    width="1em"
-                  >
-                    <use
-                      href="#test"
-                    />
-                  </svg>
-                </span>
-                <span
-                  class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-                >
-                  <div
-                    class="css-179hf69-TextOverflow e8qi82q0"
-                  >
-                    Help
-                  </div>
-                </span>
-              </div>
-            </a>
-          </div>
-        </div>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-          data-test-id="sidebar-broadcasts"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="22px"
-                viewBox="[object Object]"
-                width="22px"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                What's new
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-1j3ay2q-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      />
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="e1sgxx354 css-ekfpov-StyledSidebarItem-SidebarCollapseItem e1qdnaq70"
-          data-test-id="sidebar-collapse"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="e1sgxx353 css-coblwz-StyledSvg-StyledInlineSvg-ExpandedIcon e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Collapse
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-  </div>
-  <div
-    class="app"
-  >
-    <div
-      class="pattern-bg"
-    />
-    <div
-      class="container"
-    >
-      <div
-        class="box box-modal"
-      >
-        <div
-          class="box-header"
-        >
-          <a
-            href="/"
-          >
-            <span
-              class="icon-sentry-logo"
-            />
-          </a>
-        </div>
-        <div
-          class="box-content with-padding"
-        >
-          <h3>
-            Deletion Scheduled
-          </h3>
-          <p>
-            <span>
-              <span>
-                The 
-              </span>
-              <strong>
-                org-slug
-              </strong>
-              <span>
-                 organization is currently scheduled for deletion.
-              </span>
-            </span>
-          </p>
-          <div>
-            <p>
-              Would you like to cancel this process and restore the organization back to the original state?
-            </p>
-            <p>
-              <button
-                aria-label="Restore Organization"
-                class="css-1msljz8-StyledButton-getColors eqrebog0"
-                priority="primary"
-                role="button"
-              >
-                <span
-                  class="css-ga4b18-ButtonLabel eqrebog1"
-                >
-                  Restore Organization
-                </span>
-              </button>
-            </p>
-          </div>
-          <p>
-            <small>
-              Note: Restoration is available until the process begins. Once it does, there's no recovering the data that has been removed.
-            </small>
-          </p>
-        </div>
-      </div>
-    </div>
-  </div>
-</div>
-`;
-
-exports[`OrganizationDetails render() pending deletion should render a restoration prompt without action for members 1`] = `
-<div
-  class="app"
->
-  <div
-    class="css-5cf61n-StyledSidebar-responsiveFlex e1sgxx350"
-  >
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-jdsvwb-SidebarDropdownRoot e1fowdfw3"
-        >
-          <div
-            class="css-1d9hpgj-SidebarDropdownActor e1fowdfw7"
-            data-test-id="sidebar-dropdown"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <div
-              style="display:flex;align-items:flex-start"
-            >
-              <span
-                class="avatar e1fowdfw8 css-tmrp5m-StyledBaseAvatar-StyledAvatar e1z0ohzl0"
-                style="width:32px;height:32px"
-              >
-                <svg
-                  class="css-123ijso-Svg e1knxa8x0"
-                  viewBox="0 0 120 120"
-                >
-                  <rect
-                    fill="#4674ca"
-                    height="120"
-                    rx="15"
-                    ry="15"
-                    width="120"
-                    x="0"
-                    y="0"
-                  />
-                  <text
-                    fill="#FFFFFF"
-                    font-size="65"
-                    style="dominant-baseline:central"
-                    text-anchor="middle"
-                    x="50%"
-                    y="50%"
-                  >
-                    OS
-                  </text>
-                </svg>
-              </span>
-              <div
-                class="css-1mzb71u-OrgAndUserWrapper e1fowdfw4"
-              >
-                <div
-                  class="css-df1voe-TextOverflow-OrgOrUserName e1fowdfw5"
-                >
-                  Organization Name 
-                  <i
-                    class="icon-arrow-down"
-                  />
-                </div>
-                <div
-                  class="css-1b3lkmg-TextOverflow-UserNameOrEmail e1fowdfw6"
-                >
-                  Foo Bar
-                </div>
-              </div>
-            </div>
-          </div>
-        </div>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Projects
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Assigned to me
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Bookmarked issues
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Recently viewed
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Activity
-              </div>
-            </span>
-          </div>
-        </a>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Stats
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Settings
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-    <div
-      class="css-1uxlgm0-SidebarSectionGroup-responsiveFlex e1sgxx351"
-    >
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <div
-          class="css-1dvxhjs-HelpRoot e1q2bb9t0"
-        >
-          <div
-            class="css-d4wreg-HelpActor e1q2bb9t1"
-            style="outline:none"
-            tabindex="-1"
-          >
-            <a
-              class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-            >
-              <div
-                class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-              >
-                <span
-                  class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-                >
-                  <svg
-                    class="css-ryh69w-StyledSvg e2idor0"
-                    height="1em"
-                    viewBox="[object Object]"
-                    width="1em"
-                  >
-                    <use
-                      href="#test"
-                    />
-                  </svg>
-                </span>
-                <span
-                  class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-                >
-                  <div
-                    class="css-179hf69-TextOverflow e8qi82q0"
-                  >
-                    Help
-                  </div>
-                </span>
-              </div>
-            </a>
-          </div>
-        </div>
-        <a
-          class="css-u8cmbr-StyledSidebarItem e1qdnaq70"
-          data-test-id="sidebar-broadcasts"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="css-ryh69w-StyledSvg e2idor0"
-                height="22px"
-                viewBox="[object Object]"
-                width="22px"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                What's new
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-      <div
-        class="css-1j3ay2q-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      />
-      <div
-        class="css-tlukoq-SidebarSectionGroup-responsiveFlex-SidebarSection e1sgxx352"
-      >
-        <a
-          class="e1sgxx354 css-ekfpov-StyledSidebarItem-SidebarCollapseItem e1qdnaq70"
-          data-test-id="sidebar-collapse"
-        >
-          <div
-            class="css-gn87gt-SidebarItemWrapper e1qdnaq71"
-          >
-            <span
-              class="css-1murlm5-SidebarItemIcon e1qdnaq72"
-            >
-              <svg
-                class="e1sgxx353 css-coblwz-StyledSvg-StyledInlineSvg-ExpandedIcon e2idor0"
-                height="1em"
-                viewBox="[object Object]"
-                width="1em"
-              >
-                <use
-                  href="#test"
-                />
-              </svg>
-            </span>
-            <span
-              class="css-1wgok4l-SidebarItemLabel e1qdnaq73"
-            >
-              <div
-                class="css-179hf69-TextOverflow e8qi82q0"
-              >
-                Collapse
-              </div>
-            </span>
-          </div>
-        </a>
-      </div>
-    </div>
-  </div>
-  <div
-    class="app"
-  >
-    <div
-      class="pattern-bg"
-    />
-    <div
-      class="container"
-    >
-      <div
-        class="box box-modal"
-      >
-        <div
-          class="box-header"
-        >
-          <a
-            href="/"
-          >
-            <span
-              class="icon-sentry-logo"
-            />
-          </a>
-        </div>
-        <div
-          class="box-content with-padding"
-        >
-          <h3>
-            Deletion Scheduled
-          </h3>
-          <p>
-            <span>
-              <span>
-                The 
-              </span>
-              <strong>
-                org-slug
-              </strong>
-              <span>
-                 organization is currently scheduled for deletion.
-              </span>
-            </span>
-          </p>
-          <p>
-            If this is a mistake, contact an organization owner and ask them to restore this organization.
-          </p>
-          <p>
-            <small>
-              Note: Restoration is available until the process begins. Once it does, there's no recovering the data that has been removed.
-            </small>
-          </p>
-        </div>
-      </div>
-    </div>
-  </div>
-</div>
-`;
diff --git a/tests/js/spec/views/organizationContext.spec.jsx b/tests/js/spec/views/organizationContext.spec.jsx
index b33c107716..fadf2b9349 100644
--- a/tests/js/spec/views/organizationContext.spec.jsx
+++ b/tests/js/spec/views/organizationContext.spec.jsx
@@ -22,6 +22,7 @@ describe('OrganizationContext', function() {
     projects: [TestStubs.Project()],
   });
   let getOrgMock;
+  let getEnvironmentsMock;
 
   beforeAll(function() {});
 
@@ -31,6 +32,10 @@ describe('OrganizationContext', function() {
       url: '/organizations/org-slug/',
       body: org,
     });
+    getEnvironmentsMock = MockApiClient.addMockResponse({
+      url: '/organizations/org-slug/environments/',
+      body: TestStubs.Environments(),
+    });
     jest.spyOn(TeamStore, 'loadInitialData');
     jest.spyOn(ProjectsStore, 'loadInitialData');
     jest.spyOn(GlobalSelectionStore, 'loadInitialData');
@@ -89,9 +94,10 @@ describe('OrganizationContext', function() {
       '/organizations/org-slug/',
       expect.anything()
     );
+    expect(getEnvironmentsMock).toHaveBeenCalled();
   });
 
-  it('shows loading error for non-superusers on 403s', function() {
+  it('shows loading error for non-superusers on 403s', async function() {
     getOrgMock = MockApiClient.addMockResponse({
       url: '/organizations/org-slug/',
       statusCode: 403,
@@ -102,10 +108,13 @@ describe('OrganizationContext', function() {
       </OrganizationContext>
     );
 
+    await tick();
+    wrapper.update();
+
     expect(wrapper.find('LoadingError')).toHaveLength(1);
   });
 
-  it('opens sudo modal for superusers on 403s', function() {
+  it('opens sudo modal for superusers on 403s', async function() {
     ConfigStore.get.mockImplementation(() => ({
       isSuperuser: true,
     }));
@@ -119,6 +128,9 @@ describe('OrganizationContext', function() {
       </OrganizationContext>
     );
 
+    await tick();
+    wrapper.update();
+
     expect(openSudo).toHaveBeenCalled();
   });
 });
diff --git a/tests/js/spec/views/organizationsDetails.spec.jsx b/tests/js/spec/views/organizationsDetails.spec.jsx
index 68d34a8929..64f95eb772 100644
--- a/tests/js/spec/views/organizationsDetails.spec.jsx
+++ b/tests/js/spec/views/organizationsDetails.spec.jsx
@@ -1,5 +1,5 @@
 import React from 'react';
-import {render} from 'enzyme';
+import {mount} from 'enzyme';
 
 import OrganizationDetails from 'app/views/organizationDetails';
 
@@ -10,11 +10,15 @@ describe('OrganizationDetails', function() {
       url: '/broadcasts/',
       body: [],
     });
+    MockApiClient.addMockResponse({
+      url: '/organizations/org-slug/environments/',
+      body: [],
+    });
   });
 
   describe('render()', function() {
     describe('pending deletion', () => {
-      it('should render a restoration prompt', function() {
+      it('should render a restoration prompt', async function() {
         MockApiClient.addMockResponse({
           url: '/organizations/org-slug/',
           body: TestStubs.Organization({
@@ -25,14 +29,21 @@ describe('OrganizationDetails', function() {
             },
           }),
         });
-        let tree = render(
+        let tree = mount(
           <OrganizationDetails params={{orgId: 'org-slug'}} location={{}} />,
           TestStubs.routerContext()
         );
-        expect(tree).toMatchSnapshot();
+        await tick();
+        await tick();
+        tree.update();
+        expect(tree.text()).toContain('Deletion Scheduled');
+        expect(tree.text()).toContain(
+          'Would you like to cancel this process and restore the organization back to the original state?'
+        );
+        expect(tree.find('button[aria-label="Restore Organization"]')).toHaveLength(1);
       });
 
-      it('should render a restoration prompt without action for members', function() {
+      it('should render a restoration prompt without action for members', async function() {
         MockApiClient.addMockResponse({
           url: '/organizations/org-slug/',
           body: TestStubs.Organization({
@@ -44,11 +55,20 @@ describe('OrganizationDetails', function() {
             },
           }),
         });
-        let tree = render(
+        let tree = mount(
           <OrganizationDetails params={{orgId: 'org-slug'}} location={{}} />,
           TestStubs.routerContext()
         );
-        expect(tree).toMatchSnapshot();
+        await tick();
+        await tick();
+        tree.update();
+        expect(tree.text()).toContain(
+          [
+            'The org-slug organization is currently scheduled for deletion.',
+            'If this is a mistake, contact an organization owner and ask them to restore this organization.',
+          ].join('')
+        );
+        expect(tree.find('button[aria-label="Restore Organization"]')).toHaveLength(0);
       });
     });
 
@@ -66,12 +86,17 @@ describe('OrganizationDetails', function() {
         });
       });
 
-      it('should render a deletion in progress prompt', function() {
-        let tree = render(
-          <OrganizationDetails params={{orgId: 'org-slug'}} location={{}} />,
-          TestStubs.routerContext()
+      it('should render a deletion in progress prompt', async function() {
+        let tree = mount(
+          <OrganizationDetails params={{orgId: 'org-slug'}} location={{}} />
+        );
+        await tick();
+        await tick();
+        tree.update();
+        expect(tree.text()).toContain(
+          'The org-slug organization is currently in the process of being deleted from Sentry'
         );
-        expect(tree).toMatchSnapshot();
+        expect(tree.find('button[aria-label="Restore Organization"]')).toHaveLength(0);
       });
     });
   });
