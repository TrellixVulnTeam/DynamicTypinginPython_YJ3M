commit 476e212e56b8981b14599b1287557322697ce8eb
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Wed Feb 7 15:54:20 2018 -0800

    ref(projects): Refactor project selector to use list of org projects instead of teams

diff --git a/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx b/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
index 696701c9e2..b37dc63b3d 100644
--- a/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
+++ b/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
@@ -77,32 +77,27 @@ const ProjectSelector = createReactClass({
     let org = this.props.organization;
     let filter = state.filter.toLowerCase();
     let projectList = [];
-    // since projects can be part of many teams,
-    // de-dupe projects
-    let includedProjects = new Set();
 
     let activeTeam;
     let activeProject;
-    org.teams.forEach(team => {
-      if (!team.isMember) {
+
+    org.projects.forEach(project => {
+      // TODO(jess): stop relying on this soon
+      let team = project.team;
+      if (!project.isMember) {
         return;
       }
-      team.projects.forEach(project => {
-        if (project.slug == this.props.projectId) {
-          activeProject = project;
-          activeTeam = team;
-        }
-        let fullName = [team.name, project.name, team.slug, project.slug]
-          .join(' ')
-          .toLowerCase();
-        if (filter && fullName.indexOf(filter) === -1) {
-          return;
-        }
-        if (!includedProjects.has(project.slug)) {
-          projectList.push([team, project]);
-          includedProjects.add(project.slug);
-        }
-      });
+      if (project.slug === this.props.projectId) {
+        activeProject = project;
+        activeTeam = project.team;
+      }
+      let fullName = [team.name, project.name, team.slug, project.slug]
+        .join(' ')
+        .toLowerCase();
+      if (filter && fullName.indexOf(filter) === -1) {
+        return;
+      }
+      projectList.push([team, project]);
     });
     return {
       projectList,
diff --git a/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap b/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
index cc3e6a549f..6bc9229580 100644
--- a/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
+++ b/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
@@ -6,6 +6,48 @@ exports[`ProjectSelector render() can filter projects by project name 1`] = `
     Object {
       "access": Array [],
       "id": "org",
+      "projects": Array [
+        Object {
+          "isMember": true,
+          "name": "Test Project",
+          "slug": "test-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+        Object {
+          "isMember": true,
+          "name": "Another Project",
+          "slug": "another-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+      ],
       "slug": "org",
       "teams": Array [
         Object {
@@ -155,6 +197,48 @@ exports[`ProjectSelector render() can filter projects by team name/project name
     Object {
       "access": Array [],
       "id": "org",
+      "projects": Array [
+        Object {
+          "isMember": true,
+          "name": "Test Project",
+          "slug": "test-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+        Object {
+          "isMember": true,
+          "name": "Another Project",
+          "slug": "another-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+      ],
       "slug": "org",
       "teams": Array [
         Object {
@@ -519,6 +603,48 @@ exports[`ProjectSelector render() shows empty filter message when filtering has
     Object {
       "access": Array [],
       "id": "org",
+      "projects": Array [
+        Object {
+          "isMember": true,
+          "name": "Test Project",
+          "slug": "test-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+        Object {
+          "isMember": true,
+          "name": "Another Project",
+          "slug": "another-project",
+          "team": Object {
+            "isMember": true,
+            "name": "Test Team",
+            "projects": Array [
+              Object {
+                "name": "Test Project",
+                "slug": "test-project",
+              },
+              Object {
+                "name": "Another Project",
+                "slug": "another-project",
+              },
+            ],
+            "slug": "test-team",
+          },
+        },
+      ],
       "slug": "org",
       "teams": Array [
         Object {
diff --git a/tests/js/spec/components/projectHeader/projectSelector.spec.jsx b/tests/js/spec/components/projectHeader/projectSelector.spec.jsx
index 8b3b36f092..b20607bf4b 100644
--- a/tests/js/spec/components/projectHeader/projectSelector.spec.jsx
+++ b/tests/js/spec/components/projectHeader/projectSelector.spec.jsx
@@ -24,6 +24,48 @@ describe('ProjectSelector', function() {
         ],
       },
     ],
+    projects: [
+      {
+        slug: 'test-project',
+        name: 'Test Project',
+        isMember: true,
+        team: {
+          name: 'Test Team',
+          slug: 'test-team',
+          isMember: true,
+          projects: [
+            {
+              slug: 'test-project',
+              name: 'Test Project',
+            },
+            {
+              slug: 'another-project',
+              name: 'Another Project',
+            },
+          ],
+        },
+      },
+      {
+        slug: 'another-project',
+        name: 'Another Project',
+        isMember: true,
+        team: {
+          name: 'Test Team',
+          slug: 'test-team',
+          isMember: true,
+          projects: [
+            {
+              slug: 'test-project',
+              name: 'Test Project',
+            },
+            {
+              slug: 'another-project',
+              name: 'Another Project',
+            },
+          ],
+        },
+      },
+    ],
     access: [],
   };
 
@@ -39,6 +81,7 @@ describe('ProjectSelector', function() {
             id: 'org',
             slug: 'org-slug',
             teams: [],
+            projects: [],
             access: [],
           }}
           projectId=""
@@ -57,6 +100,7 @@ describe('ProjectSelector', function() {
             id: 'org',
             slug: 'org-slug',
             teams: [],
+            projects: [],
             access: ['project:write'],
           }}
           projectId=""
