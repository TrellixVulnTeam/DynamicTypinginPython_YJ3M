commit db86797b3c09893da6d2bd7adf47ac63c8ef641c
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 24 10:04:43 2015 -0800

    Handle authentication errors

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index ce6dbc401a..9450a92991 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -3,10 +3,11 @@ from __future__ import absolute_import, print_function
 import logging
 
 from django.conf import settings
+from django.core.urlresolvers import reverse
+from django.contrib import messages
+from django.contrib.auth import login
 from django.db import transaction
 from django.http import HttpResponseRedirect
-from django.contrib.auth import login
-from django.core.urlresolvers import reverse
 from hashlib import md5
 
 from sentry.models import (
@@ -203,8 +204,17 @@ class AuthHelper(object):
         return HttpResponseRedirect(next_uri)
 
     def error(self, message):
-        # TODO
-        raise Exception(message)
+        session = self.request.session['auth']
+        if session['flow'] == self.FLOW_LOGIN:
+            # create identity and authenticate the user
+            redirect_uri = reverse('sentry-auth-organization', args=[self.organization.slug])
+
+        elif session['flow'] == self.FLOW_SETUP_PROVIDER:
+            redirect_uri = reverse('sentry-organization-auth-settings', args=[self.organization.slug])
+
+        messages.error(self.request, 'Authentication error: {}'.format(message))
+
+        return HttpResponseRedirect(redirect_uri)
 
     def bind_state(self, key, value):
         self.request.session['auth']['state'][key] = value
