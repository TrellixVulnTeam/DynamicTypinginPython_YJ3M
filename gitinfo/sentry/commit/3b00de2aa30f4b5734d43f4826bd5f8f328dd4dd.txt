commit 3b00de2aa30f4b5734d43f4826bd5f8f328dd4dd
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Fri Mar 9 10:42:08 2018 -0600

    fix: Don't add duplicate tags from interface.iter_tags (#7544)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 7b46639c00..5c8cff8dc4 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -579,6 +579,13 @@ class EventManager(object):
                 for key, value in added_tags:
                     tags.setdefault(key, value)
 
+        for path, iface in six.iteritems(event.interfaces):
+            for k, v in iface.iter_tags():
+                tags[k] = v
+            # Get rid of ephemeral interface data
+            if iface.ephemeral:
+                data.pop(iface.get_path(), None)
+
         # tags are stored as a tuple
         tags = tags.items()
 
@@ -588,12 +595,6 @@ class EventManager(object):
 
         data['fingerprint'] = fingerprint or ['{{ default }}']
 
-        for path, iface in six.iteritems(event.interfaces):
-            data['tags'].extend(iface.iter_tags())
-            # Get rid of ephemeral interface data
-            if iface.ephemeral:
-                data.pop(iface.get_path(), None)
-
         # prioritize fingerprint over checksum as its likely the client defaulted
         # a checksum whereas the fingerprint was explicit
         if fingerprint:
