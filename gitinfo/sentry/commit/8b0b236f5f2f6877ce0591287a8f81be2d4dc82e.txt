commit 8b0b236f5f2f6877ce0591287a8f81be2d4dc82e
Author: Priscila Oliveira <priscilawebdev@gmail.com>
Date:   Mon Jun 22 12:03:36 2020 +0200

    ref(pii): Replace formField with forms/field (#19417)

diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/eventIdField.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/eventIdField.tsx
index 02913fb929..5dacafb5e5 100644
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/eventIdField.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/eventIdField.tsx
@@ -5,8 +5,8 @@ import isEqual from 'lodash/isEqual';
 import TextField from 'app/components/forms/textField';
 import {t} from 'app/locale';
 import space from 'app/styles/space';
+import Field from 'app/views/settings/components/forms/field';
 
-import FormField from './formField';
 import EventIdFieldStatusIcon from './eventIdFieldStatusIcon';
 import {EventIdStatus, EventId} from '../types';
 
@@ -106,11 +106,15 @@ class EventIdField extends React.Component<Props, State> {
     const {value, status} = this.state;
 
     return (
-      <FormField
+      <Field
         label={t('Event ID (Optional)')}
-        tooltipInfo={t(
+        help={t(
           'Providing an event ID will automatically provide you a list of suggested sources'
         )}
+        inline={false}
+        flexibleControlStateSize
+        stacked
+        showHelpInTooltip
       >
         <FieldWrapper>
           <StyledTextField
@@ -131,7 +135,7 @@ class EventIdField extends React.Component<Props, State> {
             />
           </Status>
         </FieldWrapper>
-      </FormField>
+      </Field>
     );
   }
 }
diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/form.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/form.tsx
index 47762d34df..31326eaf98 100644
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/form.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/form.tsx
@@ -5,9 +5,9 @@ import sortBy from 'lodash/sortBy';
 import space from 'app/styles/space';
 import {t} from 'app/locale';
 import TextField from 'app/components/forms/textField';
+import Field from 'app/views/settings/components/forms/field';
 
 import EventIdField from './eventIdField';
-import FormField from './formField';
 import SelectField from './selectField';
 import SourceField from './sourceField';
 import {getRuleLabel, getMethodLabel} from '../utils';
@@ -42,9 +42,16 @@ const Form = ({
 }: Props<Rule, KeysOfUnion<Rule>>) => {
   const {source, type, method} = rule;
   return (
-    <Wrapper>
+    <React.Fragment>
       <GroupField hasTwoColumns={rule.method === MethodType.REPLACE}>
-        <FormField label={t('Method')} tooltipInfo={t('What to do')}>
+        <Field
+          label={t('Method')}
+          help={t('What to do')}
+          inline={false}
+          flexibleControlStateSize
+          stacked
+          showHelpInTooltip
+        >
           <SelectField
             placeholder={t('Select method')}
             name="method"
@@ -55,11 +62,15 @@ const Form = ({
             value={method}
             onChange={({value}) => onChange('method', value)}
           />
-        </FormField>
+        </Field>
         {rule.method === MethodType.REPLACE && (
-          <FormField
+          <Field
             label={t('Custom Placeholder (Optional)')}
-            tooltipInfo={t('It will replace the default placeholder [Filtered]')}
+            help={t('It will replace the default placeholder [Filtered]')}
+            inline={false}
+            flexibleControlStateSize
+            stacked
+            showHelpInTooltip
           >
             <StyledTextField
               name="placeholder"
@@ -69,15 +80,19 @@ const Form = ({
               }}
               value={rule.placeholder}
             />
-          </FormField>
+          </Field>
         )}
       </GroupField>
       <GroupField hasTwoColumns={rule.type === RuleType.PATTERN}>
-        <FormField
+        <Field
           label={t('Data Type')}
-          tooltipInfo={t(
+          help={t(
             'What to look for. Use an existing pattern or define your own using regular expressions.'
           )}
+          inline={false}
+          flexibleControlStateSize
+          stacked
+          showHelpInTooltip
         >
           <SelectField
             placeholder={t('Select type')}
@@ -89,11 +104,16 @@ const Form = ({
             value={type}
             onChange={({value}) => onChange('type', value)}
           />
-        </FormField>
+        </Field>
         {rule.type === RuleType.PATTERN && (
-          <FormField
+          <Field
             label={t('Regex matches')}
-            tooltipInfo={t('Custom Perl-style regex (PCRE)')}
+            help={t('Custom Perl-style regex (PCRE)')}
+            inline={false}
+            flexibleControlStateSize
+            stacked
+            required
+            showHelpInTooltip
           >
             <RegularExpression
               name="pattern"
@@ -105,17 +125,20 @@ const Form = ({
               onBlur={onValidate('pattern')}
               error={errors?.pattern}
             />
-          </FormField>
+          </Field>
         )}
       </GroupField>
       {onUpdateEventId && (
         <EventIdField onUpdateEventId={onUpdateEventId} eventId={eventId} />
       )}
-      <FormField
+      <Field
         label={t('Source')}
-        tooltipInfo={t(
-          'Where to look. In the simplest case this can be an attribute name.'
-        )}
+        help={t('Where to look. In the simplest case this can be an attribute name.')}
+        inline={false}
+        flexibleControlStateSize
+        stacked
+        required
+        showHelpInTooltip
       >
         <SourceField
           onChange={(value: string) => {
@@ -127,23 +150,20 @@ const Form = ({
           suggestions={sourceSuggestions}
           error={errors?.source}
         />
-      </FormField>
-    </Wrapper>
+      </Field>
+    </React.Fragment>
   );
 };
 
 export default Form;
 
-const Wrapper = styled('div')`
-  display: grid;
-  grid-row-gap: ${space(2)};
-`;
-
 const GroupField = styled('div')<{hasTwoColumns: boolean}>`
   display: grid;
-  grid-gap: ${space(2)};
+  margin-bottom: ${space(2)};
   @media (min-width: ${p => p.theme.breakpoints[0]}) {
+    grid-gap: ${space(2)};
     ${p => p.hasTwoColumns && `grid-template-columns: 1fr 1fr;`}
+    margin-bottom: ${p => (p.hasTwoColumns ? 0 : space(2))};
   }
 `;
 
diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/formField.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/formField.tsx
deleted file mode 100644
index 02084b6cc1..0000000000
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/formField.tsx
+++ /dev/null
@@ -1,43 +0,0 @@
-import React from 'react';
-import styled from '@emotion/styled';
-
-import QuestionTooltip from 'app/components/questionTooltip';
-import space from 'app/styles/space';
-
-type Props = {
-  label: string;
-  tooltipInfo: string;
-  children: React.ReactNode;
-  isFullWidth?: boolean;
-};
-
-const FormField = ({label, tooltipInfo, children, isFullWidth}: Props) => (
-  <Wrapper isFullWidth={isFullWidth}>
-    <Label>
-      <LabelDescription>{label}</LabelDescription>
-      <QuestionTooltip title={tooltipInfo} position="top" size="sm" />
-    </Label>
-    {children}
-  </Wrapper>
-);
-
-export default FormField;
-
-const Wrapper = styled('div')<{isFullWidth?: boolean}>`
-  ${p =>
-    p.isFullWidth &&
-    `
-      grid-column-start: 1;
-      grid-column-end: -1;
-    `}
-`;
-
-const Label = styled('div')`
-  display: flex;
-  align-items: center;
-  margin-bottom: ${space(0.5)};
-`;
-
-const LabelDescription = styled('span')`
-  margin-right: ${space(1)};
-`;
diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/selectField.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/selectField.tsx
index 0b52abac35..5211c1f001 100644
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/selectField.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/form/selectField.tsx
@@ -59,7 +59,6 @@ class SelectField extends React.Component<Props> {
           ),
         }}
         openOnFocus
-        required
       />
     );
   }
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldLabel.tsx b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldLabel.tsx
index e567ebc315..29f9843fe4 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldLabel.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldLabel.tsx
@@ -1,10 +1,16 @@
 import styled from '@emotion/styled';
 import isPropValid from '@emotion/is-prop-valid';
 
+import space from 'app/styles/space';
+
 const shouldForwardProp = p => p !== 'disabled' && isPropValid(p);
 
 const FieldLabel = styled('div', {shouldForwardProp})<{disabled?: boolean}>`
   color: ${p => (!p.disabled ? p.theme.gray800 : p.theme.gray500)};
+  display: grid;
+  grid-gap: ${space(0.5)};
+  grid-template-columns: repeat(2, max-content);
+  line-height: 16px;
 `;
 
 export default FieldLabel;
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldQuestion.tsx b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldQuestion.tsx
new file mode 100644
index 0000000000..5087fdf03f
--- /dev/null
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldQuestion.tsx
@@ -0,0 +1,8 @@
+import styled from '@emotion/styled';
+
+const FieldQuestion = styled('div')`
+  display: flex;
+  align-items: center;
+`;
+
+export default FieldQuestion;
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldRequiredBadge.tsx b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldRequiredBadge.tsx
index 0d8ce8f830..949a9ae7a9 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldRequiredBadge.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/field/fieldRequiredBadge.tsx
@@ -1,5 +1,7 @@
 import styled from '@emotion/styled';
 
+import space from 'app/styles/space';
+
 const FieldRequiredBadge = styled('div')`
   display: inline-block;
   background: ${p => p.theme.redLight};
@@ -9,6 +11,7 @@ const FieldRequiredBadge = styled('div')`
   border-radius: 5px;
   text-indent: -9999em;
   vertical-align: super;
+  margin-left: ${space(0.5)};
 `;
 
 export default FieldRequiredBadge;
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/field/index.tsx b/src/sentry/static/sentry/app/views/settings/components/forms/field/index.tsx
index 229d856c4c..9cc01e66f7 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/field/index.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/field/index.tsx
@@ -8,6 +8,7 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 
+import QuestionTooltip from 'app/components/questionTooltip';
 import ControlState from 'app/views/settings/components/forms/field/controlState';
 import FieldControl from 'app/views/settings/components/forms/field/fieldControl';
 import FieldDescription from 'app/views/settings/components/forms/field/fieldDescription';
@@ -19,6 +20,8 @@ import FieldWrapper, {
   Props as FieldWrapperProps,
 } from 'app/views/settings/components/forms/field/fieldWrapper';
 
+import FieldQuestion from './fieldQuestion';
+
 type ChildrenFunction = (props) => React.ReactNode;
 
 type Props = {
@@ -30,6 +33,7 @@ type Props = {
   flexibleControlStateSize?: boolean;
   label?: React.ReactNode;
   help?: React.ReactNode | React.ReactElement | Function;
+  showHelpInTooltip?: boolean;
   id?: string;
   children?: React.ReactNode | ChildrenFunction;
   controlClassName?: string;
@@ -76,6 +80,11 @@ class Field extends React.Component<Props> {
      */
     disabledReason: PropTypes.string,
 
+    /**
+     * Displays the help element in the tooltip
+     */
+    showHelpInTooltip: PropTypes.bool,
+
     /**
      * Error message
      */
@@ -141,6 +150,7 @@ class Field extends React.Component<Props> {
     disabled: false,
     required: false,
     visible: true,
+    showHelpInTooltip: false,
   };
 
   render() {
@@ -164,6 +174,7 @@ class Field extends React.Component<Props> {
       stacked,
       children,
       style,
+      showHelpInTooltip,
     } = otherProps;
     const isDisabled = typeof disabled === 'function' ? disabled(this.props) : disabled;
     const isVisible = typeof visible === 'function' ? visible(this.props) : visible;
@@ -211,10 +222,18 @@ class Field extends React.Component<Props> {
           <FieldDescription inline={inline} htmlFor={id}>
             {label && (
               <FieldLabel disabled={isDisabled}>
-                {label} {required && <FieldRequiredBadge />}
+                <span>
+                  {label}
+                  {required && <FieldRequiredBadge />}
+                </span>
+                {helpElement && showHelpInTooltip && (
+                  <FieldQuestion>
+                    <QuestionTooltip position="top" size="sm" title={helpElement} />
+                  </FieldQuestion>
+                )}
               </FieldLabel>
             )}
-            {helpElement && (
+            {helpElement && !showHelpInTooltip && (
               <FieldHelp stacked={stacked} inline={inline}>
                 {helpElement}
               </FieldHelp>
@@ -227,4 +246,5 @@ class Field extends React.Component<Props> {
     );
   }
 }
+
 export default Field;
diff --git a/tests/acceptance/test_organization_developer_settings.py b/tests/acceptance/test_organization_developer_settings.py
index 0d4e9fd5a1..c583137f43 100644
--- a/tests/acceptance/test_organization_developer_settings.py
+++ b/tests/acceptance/test_organization_developer_settings.py
@@ -35,7 +35,7 @@ class OrganizationDeveloperSettingsNewAcceptanceTest(AcceptanceTestCase):
 
         self.browser.click('[aria-label="Save Changes"]')
 
-        self.browser.wait_until(xpath="//div[contains(text(), 'Client ID')]", timeout=3)
+        self.browser.wait_until(xpath="//span[contains(text(), 'Client ID')]", timeout=3)
 
     def test_create_new_internal_integration(self):
         self.load_page(self.org_developer_settings_path)
diff --git a/tests/js/spec/components/__snapshots__/confirmDelete.spec.jsx.snap b/tests/js/spec/components/__snapshots__/confirmDelete.spec.jsx.snap
index 25c2f37830..15a3d99b53 100644
--- a/tests/js/spec/components/__snapshots__/confirmDelete.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/confirmDelete.spec.jsx.snap
@@ -67,6 +67,7 @@ exports[`ConfirmDelete renders 1`] = `
               ]
             }
             required={false}
+            showHelpInTooltip={false}
             visible={true}
           >
             <FieldWrapper
@@ -86,16 +87,17 @@ exports[`ConfirmDelete renders 1`] = `
                       disabled={false}
                     >
                       <div
-                        className="css-1c18lg-FieldLabel e16ushrl0"
+                        className="css-wufuns-FieldLabel e16ushrl0"
                       >
-                        Please enter 
-                        <code
-                          key="1"
-                        >
-                          CoolOrg
-                        </code>
-                         to confirm the deletion
-                         
+                        <span>
+                          Please enter 
+                          <code
+                            key="1"
+                          >
+                            CoolOrg
+                          </code>
+                           to confirm the deletion
+                        </span>
                       </div>
                     </FieldLabel>
                   </label>
diff --git a/tests/js/spec/components/forms/__snapshots__/formField.spec.jsx.snap b/tests/js/spec/components/forms/__snapshots__/formField.spec.jsx.snap
index b2c5ce8d44..422eeda49d 100644
--- a/tests/js/spec/components/forms/__snapshots__/formField.spec.jsx.snap
+++ b/tests/js/spec/components/forms/__snapshots__/formField.spec.jsx.snap
@@ -81,6 +81,7 @@ exports[`FormField + model renders with Form 1`] = `
               inline={true}
               name="fieldName"
               required={false}
+              showHelpInTooltip={false}
               type="text"
               visible={true}
             >
diff --git a/tests/js/spec/components/forms/__snapshots__/radioBooleanField.spec.jsx.snap b/tests/js/spec/components/forms/__snapshots__/radioBooleanField.spec.jsx.snap
index a35bd41978..ab5c61a883 100644
--- a/tests/js/spec/components/forms/__snapshots__/radioBooleanField.spec.jsx.snap
+++ b/tests/js/spec/components/forms/__snapshots__/radioBooleanField.spec.jsx.snap
@@ -30,6 +30,7 @@ exports[`RadioBooleanField render() renders new field without form context 1`] =
         name="fieldName"
         noLabel="No"
         required={false}
+        showHelpInTooltip={false}
         visible={true}
         yesLabel="Yes"
       >
diff --git a/tests/js/spec/components/forms/__snapshots__/tableField.spec.jsx.snap b/tests/js/spec/components/forms/__snapshots__/tableField.spec.jsx.snap
index dee79412c2..6410c30bea 100644
--- a/tests/js/spec/components/forms/__snapshots__/tableField.spec.jsx.snap
+++ b/tests/js/spec/components/forms/__snapshots__/tableField.spec.jsx.snap
@@ -153,6 +153,7 @@ exports[`TableField renders renders with form context 1`] = `
                 inline={true}
                 name="fieldName"
                 required={false}
+                showHelpInTooltip={false}
                 visible={true}
               >
                 <FieldWrapper
@@ -601,6 +602,7 @@ exports[`TableField renders renders without form context 1`] = `
           inline={true}
           name="fieldName"
           required={false}
+          showHelpInTooltip={false}
           visible={true}
         >
           <FieldWrapper
diff --git a/tests/js/spec/components/group/__snapshots__/externalIssueForm.spec.jsx.snap b/tests/js/spec/components/group/__snapshots__/externalIssueForm.spec.jsx.snap
index 06d43876a6..5bf77ba4bd 100644
--- a/tests/js/spec/components/group/__snapshots__/externalIssueForm.spec.jsx.snap
+++ b/tests/js/spec/components/group/__snapshots__/externalIssueForm.spec.jsx.snap
@@ -505,6 +505,7 @@ exports[`ExternalIssueForm link renders 1`] = `
                   onSelectResetsInput={false}
                   placeholder="--"
                   required={true}
+                  showHelpInTooltip={false}
                   small={false}
                   stacked={true}
                   type="select"
@@ -532,15 +533,16 @@ exports[`ExternalIssueForm link renders 1`] = `
                             disabled={false}
                           >
                             <div
-                              className="css-1c18lg-FieldLabel e16ushrl0"
+                              className="css-wufuns-FieldLabel e16ushrl0"
                             >
-                              GitHub Repository
-                               
-                              <FieldRequiredBadge>
-                                <div
-                                  className="css-z6v0fv-FieldRequiredBadge e1uclnuk0"
-                                />
-                              </FieldRequiredBadge>
+                              <span>
+                                GitHub Repository
+                                <FieldRequiredBadge>
+                                  <div
+                                    className="css-dp3tuo-FieldRequiredBadge e1uclnuk0"
+                                  />
+                                </FieldRequiredBadge>
+                              </span>
                             </div>
                           </FieldLabel>
                         </label>
@@ -2451,6 +2453,7 @@ exports[`ExternalIssueForm link renders 1`] = `
                   onSelectResetsInput={false}
                   placeholder="--"
                   required={true}
+                  showHelpInTooltip={false}
                   small={false}
                   stacked={true}
                   type="select"
@@ -2477,15 +2480,16 @@ exports[`ExternalIssueForm link renders 1`] = `
                             disabled={false}
                           >
                             <div
-                              className="css-1c18lg-FieldLabel e16ushrl0"
+                              className="css-wufuns-FieldLabel e16ushrl0"
                             >
-                              Issue
-                               
-                              <FieldRequiredBadge>
-                                <div
-                                  className="css-z6v0fv-FieldRequiredBadge e1uclnuk0"
-                                />
-                              </FieldRequiredBadge>
+                              <span>
+                                Issue
+                                <FieldRequiredBadge>
+                                  <div
+                                    className="css-dp3tuo-FieldRequiredBadge e1uclnuk0"
+                                  />
+                                </FieldRequiredBadge>
+                              </span>
                             </div>
                           </FieldLabel>
                         </label>
@@ -4256,6 +4260,7 @@ exports[`ExternalIssueForm link renders 1`] = `
                   label="Comment"
                   name="comment"
                   required={false}
+                  showHelpInTooltip={false}
                   stacked={true}
                   type="textarea"
                   visible={true}
@@ -4280,10 +4285,11 @@ exports[`ExternalIssueForm link renders 1`] = `
                             disabled={false}
                           >
                             <div
-                              className="css-1c18lg-FieldLabel e16ushrl0"
+                              className="css-wufuns-FieldLabel e16ushrl0"
                             >
-                              Comment
-                               
+                              <span>
+                                Comment
+                              </span>
                             </div>
                           </FieldLabel>
                           <FieldHelp
