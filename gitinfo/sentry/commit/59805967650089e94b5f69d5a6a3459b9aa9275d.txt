commit 59805967650089e94b5f69d5a6a3459b9aa9275d
Author: Mark Story <mark@sentry.io>
Date:   Wed May 13 15:34:05 2020 -0400

    feat(discover) Add daily total display (#18767)
    
    One of the features that users appreciated in discover1 and want to see
    in discover2 is daily totals. This adds daily total and top5 breakdowns
    to the discover2 results view.

diff --git a/src/sentry/static/sentry/app/utils/discover/types.tsx b/src/sentry/static/sentry/app/utils/discover/types.tsx
index c7b3ce2de8..a35649d810 100644
--- a/src/sentry/static/sentry/app/utils/discover/types.tsx
+++ b/src/sentry/static/sentry/app/utils/discover/types.tsx
@@ -6,13 +6,17 @@ export enum DisplayModes {
   PREVIOUS = 'previous',
   RELEASES = 'releases',
   TOP5 = 'top5',
+  DAILY = 'daily',
+  DAILYTOP5 = 'dailytop5',
 }
 
 export const DISPLAY_MODE_OPTIONS: SelectValue<string>[] = [
-  {value: DisplayModes.DEFAULT, label: t('Default')},
+  {value: DisplayModes.DEFAULT, label: t('Total Period')},
   {value: DisplayModes.PREVIOUS, label: t('Previous Period')},
   {value: DisplayModes.RELEASES, label: t('Release Markers')},
-  {value: DisplayModes.TOP5, label: t('Top 5 Breakdown')},
+  {value: DisplayModes.TOP5, label: t('Top 5 Period')},
+  {value: DisplayModes.DAILY, label: t('Total Daily')},
+  {value: DisplayModes.DAILYTOP5, label: t('Top 5 Daily')},
 ];
 
 // default list of yAxis options
diff --git a/src/sentry/static/sentry/app/views/events/eventsChart.jsx b/src/sentry/static/sentry/app/views/events/eventsChart.jsx
index a6a9da4405..68c007cc58 100644
--- a/src/sentry/static/sentry/app/views/events/eventsChart.jsx
+++ b/src/sentry/static/sentry/app/views/events/eventsChart.jsx
@@ -6,6 +6,7 @@ import {t} from 'app/locale';
 import {getInterval} from 'app/components/charts/utils';
 import ChartZoom from 'app/components/charts/chartZoom';
 import AreaChart from 'app/components/charts/areaChart';
+import BarChart from 'app/components/charts/barChart';
 import TransitionChart from 'app/components/charts/transitionChart';
 import ReleaseSeries from 'app/components/charts/releaseSeries';
 import SentryTypes from 'app/sentryTypes';
@@ -22,7 +23,7 @@ import EventsRequest from './utils/eventsRequest';
 const DURATION_AGGREGATE_PATTERN = /^(p75|p95|p99|percentile)|transaction\.duration/;
 const PERCENTAGE_AGGREGATE_PATTERN = /^(error_rate)/;
 
-class EventsAreaChart extends React.Component {
+class Chart extends React.Component {
   static propTypes = {
     loading: PropTypes.bool,
     reloading: PropTypes.bool,
@@ -33,6 +34,7 @@ class EventsAreaChart extends React.Component {
     previousTimeseriesData: PropTypes.object,
     currentSeriesName: PropTypes.string,
     previousSeriesName: PropTypes.string,
+    showDaily: PropTypes.bool,
   };
 
   shouldComponentUpdate(nextProps) {
@@ -62,6 +64,7 @@ class EventsAreaChart extends React.Component {
       showLegend,
       currentSeriesName,
       previousSeriesName,
+      showDaily,
       ...props
     } = this.props;
 
@@ -83,9 +86,10 @@ class EventsAreaChart extends React.Component {
     };
 
     const colors = theme.charts.getColorPalette(timeseriesData.length - 2);
+    const Component = showDaily ? BarChart : AreaChart;
 
     return (
-      <AreaChart
+      <Component
         {...props}
         {...zoomRenderProps}
         legend={legend}
@@ -125,6 +129,7 @@ class EventsChart extends React.Component {
     previousSeriesName: PropTypes.string,
     topEvents: PropTypes.number,
     field: PropTypes.arrayOf(PropTypes.string),
+    showDaily: PropTypes.bool,
     orderby: PropTypes.string,
   };
 
@@ -146,6 +151,7 @@ class EventsChart extends React.Component {
       currentSeriesName: currentName,
       previousSeriesName: previousName,
       field,
+      showDaily,
       topEvents,
       orderby,
       ...props
@@ -173,6 +179,9 @@ class EventsChart extends React.Component {
         return value;
       },
     };
+    const interval = showDaily
+      ? '1d'
+      : router?.location?.query?.interval || getInterval(this.props, true);
 
     let chartImplementation = ({
       zoomRenderProps,
@@ -196,7 +205,7 @@ class EventsChart extends React.Component {
       return (
         <TransitionChart loading={loading} reloading={reloading}>
           <TransparentLoadingMask visible={reloading} />
-          <EventsAreaChart
+          <Chart
             {...zoomRenderProps}
             tooltip={tooltip}
             loading={loading}
@@ -209,6 +218,7 @@ class EventsChart extends React.Component {
             currentSeriesName={currentSeriesName}
             previousSeriesName={previousSeriesName}
             stacked={typeof topEvents === 'number' && topEvents > 0}
+            showDaily={showDaily}
           />
         </TransitionChart>
       );
@@ -241,7 +251,7 @@ class EventsChart extends React.Component {
             environment={environments}
             start={start}
             end={end}
-            interval={router?.location?.query?.interval || getInterval(this.props, true)}
+            interval={interval}
             query={query}
             includePrevious={includePrevious}
             currentSeriesName={currentSeriesName}
@@ -284,4 +294,4 @@ const EventsChartContainer = withGlobalSelection(
 );
 
 export default EventsChartContainer;
-export {EventsChart, EventsAreaChart};
+export {EventsChart};
diff --git a/src/sentry/static/sentry/app/views/eventsV2/resultsChart.tsx b/src/sentry/static/sentry/app/views/eventsV2/resultsChart.tsx
index 799aec7764..3293cef717 100644
--- a/src/sentry/static/sentry/app/views/eventsV2/resultsChart.tsx
+++ b/src/sentry/static/sentry/app/views/eventsV2/resultsChart.tsx
@@ -52,7 +52,13 @@ class ResultsChart extends React.Component<ResultsChartProps> {
 
     const {utc} = getParams(location.query);
     const apiPayload = eventView.getEventsAPIPayload(location);
-    const isTopEvents = eventView.display === DisplayModes.TOP5;
+    const isTopEvents =
+      eventView.display === DisplayModes.TOP5 ||
+      eventView.display === DisplayModes.DAILYTOP5;
+
+    const isDaily =
+      eventView.display === DisplayModes.DAILYTOP5 ||
+      eventView.display === DisplayModes.DAILY;
 
     return (
       <React.Fragment>
@@ -73,6 +79,7 @@ class ResultsChart extends React.Component<ResultsChartProps> {
               disablePrevious={eventView.display !== DisplayModes.PREVIOUS}
               disableReleases={eventView.display !== DisplayModes.RELEASES}
               field={isTopEvents ? apiPayload.field : undefined}
+              showDaily={isDaily}
               topEvents={isTopEvents ? 5 : undefined}
               orderby={isTopEvents ? apiPayload.sort : undefined}
               utc={utc === 'true'}
diff --git a/tests/js/spec/views/events/eventsAreaChart.spec.jsx b/tests/js/spec/views/events/eventsAreaChart.spec.jsx
index 96b6827659..8e57719393 100644
--- a/tests/js/spec/views/events/eventsAreaChart.spec.jsx
+++ b/tests/js/spec/views/events/eventsAreaChart.spec.jsx
@@ -5,7 +5,7 @@ import {mockZoomRange} from 'sentry-test/charts';
 import {initializeOrg} from 'sentry-test/initializeOrg';
 import {mountWithTheme} from 'sentry-test/enzyme';
 
-describe('EventsChart > EventsAreaChart', function() {
+describe('EventsChart', function() {
   const {router, routerContext, org} = initializeOrg();
   let wrapper;
 
