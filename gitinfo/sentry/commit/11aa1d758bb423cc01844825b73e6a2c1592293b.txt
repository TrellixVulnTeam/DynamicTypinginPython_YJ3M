commit 11aa1d758bb423cc01844825b73e6a2c1592293b
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Apr 27 15:47:30 2017 -0700

    [ci] disable percy on push builds

diff --git a/setup.py b/setup.py
index 178da470d1..ddb34fd50f 100755
--- a/setup.py
+++ b/setup.py
@@ -116,7 +116,7 @@ install_requires = [
     'mock>=0.8.0,<1.1',
     'mmh3>=2.3.1,<2.4',
     'oauth2>=1.5.167',
-    'percy>=0.2.5',
+    'percy>=0.4.4',
     'petname>=2.0,<2.1',
     'Pillow>=3.2.0,<3.3.0',
     'progressbar2>=3.10,<3.11',
diff --git a/src/sentry/utils/pytest/selenium.py b/src/sentry/utils/pytest/selenium.py
index 4d813d86fc..008ca3fe0d 100644
--- a/src/sentry/utils/pytest/selenium.py
+++ b/src/sentry/utils/pytest/selenium.py
@@ -15,6 +15,12 @@ from selenium.webdriver.support.ui import WebDriverWait
 from selenium.webdriver.support import expected_conditions
 from six.moves.urllib.parse import quote, urlparse
 
+# if we're not running in a PR, we kill the PERCY_TOKEN because its a push
+# to a branch, and we dont want percy comparing things
+# we do need to ensure its run on master so that changes get updated
+if os.environ.get('TRAVIS_PULL_REQUEST', 'false') == 'false' and os.environ.get('TRAVIS_BRANCH', 'master') != 'master':
+    os.environ.setdefault('PERCY_ENABLE', '0')
+
 
 class Browser(object):
     def __init__(self, driver, live_server, percy):
