commit c64b882214436dca919b8dedc582e2b307ecaba0
Author: Jess MacQueen <jess@getsentry.com>
Date:   Mon Jul 10 18:20:51 2017 -0700

    fix a bunch of tests i broke when adding previous_group_id and feature flag

diff --git a/tests/sentry/api/endpoints/test_group_details.py b/tests/sentry/api/endpoints/test_group_details.py
index efc91ab32b..ee664d72a4 100644
--- a/tests/sentry/api/endpoints/test_group_details.py
+++ b/tests/sentry/api/endpoints/test_group_details.py
@@ -284,9 +284,10 @@ class GroupUpdateTest(APITestCase):
         url = '/api/0/issues/{}/'.format(group.id)
 
         with self.tasks():
-            resp = self.client.put(url, data={
-                'discard': True,
-            })
+            with self.feature('projects:custom-filters', True):
+                resp = self.client.put(url, data={
+                    'discard': True,
+                })
 
         assert resp.status_code == 204
         assert not Group.objects.filter(
diff --git a/tests/sentry/api/endpoints/test_group_tombstone.py b/tests/sentry/api/endpoints/test_group_tombstone.py
index bccc3e4104..6d1b3b210a 100644
--- a/tests/sentry/api/endpoints/test_group_tombstone.py
+++ b/tests/sentry/api/endpoints/test_group_tombstone.py
@@ -31,6 +31,7 @@ class GroupTombstoneTest(APITestCase):
             message=group.message,
             culprit=group.culprit,
             type=group.get_event_type(),
+            previous_group_id=group.id,
         )
         GroupHash.objects.create(
             project=group.project,
diff --git a/tests/sentry/api/endpoints/test_group_tombstone_details.py b/tests/sentry/api/endpoints/test_group_tombstone_details.py
index 4ca4d16ee7..17a88e214c 100644
--- a/tests/sentry/api/endpoints/test_group_tombstone_details.py
+++ b/tests/sentry/api/endpoints/test_group_tombstone_details.py
@@ -16,6 +16,7 @@ class GroupTombstoneDetailsTest(APITestCase):
             message=group.message,
             culprit=group.culprit,
             type=group.get_event_type(),
+            previous_group_id=group.id,
         )
         GroupHash.objects.create(
             project=group.project,
diff --git a/tests/sentry/api/endpoints/test_project_group_index.py b/tests/sentry/api/endpoints/test_project_group_index.py
index 544b1285d0..fe581242e3 100644
--- a/tests/sentry/api/endpoints/test_project_group_index.py
+++ b/tests/sentry/api/endpoints/test_project_group_index.py
@@ -1194,9 +1194,10 @@ class GroupUpdateTest(APITestCase):
             group1=group1,
         )
         with self.tasks():
-            response = self.client.put(url, data={
-                'discard': True,
-            })
+            with self.feature('projects:custom-filters', True):
+                response = self.client.put(url, data={
+                    'discard': True,
+                })
 
         assert response.status_code == 204
         assert not Group.objects.filter(
diff --git a/tests/sentry/api/serializers/test_group_tombstone.py b/tests/sentry/api/serializers/test_group_tombstone.py
index 0ec16604eb..ae71f6c5bf 100644
--- a/tests/sentry/api/serializers/test_group_tombstone.py
+++ b/tests/sentry/api/serializers/test_group_tombstone.py
@@ -26,6 +26,7 @@ class GroupTombstoneSerializerTest(TestCase):
             culprit=group.culprit,
             type=group.get_event_type(),
             actor_id=self.user.id,
+            previous_group_id=group.id,
         )
         GroupHash.objects.create(
             project=group.project,
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index a08d230ca0..ea6ff77aef 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -14,7 +14,7 @@ from time import time
 from sentry.app import tsdb
 from sentry.constants import MAX_CULPRIT_LENGTH, DEFAULT_LOGGER_NAME
 from sentry.event_manager import (
-    DiscardedHash, EventManager, EventUser, get_hashes_for_event, get_hashes_from_fingerprint,
+    HashDiscarded, EventManager, EventUser, get_hashes_for_event, get_hashes_from_fingerprint,
     generate_culprit, md5_from_hash
 )
 from sentry.models import (
@@ -775,6 +775,7 @@ class EventManagerTest(TransactionTestCase):
             message=group.message,
             culprit=group.culprit,
             type=group.get_event_type(),
+            previous_group_id=group.id,
         )
         GroupHash.objects.filter(
             group=group,
@@ -789,7 +790,7 @@ class EventManagerTest(TransactionTestCase):
         ))
 
         with self.tasks():
-            with self.assertRaises(DiscardedHash):
+            with self.assertRaises(HashDiscarded):
                 event = manager.save(1)
 
 
