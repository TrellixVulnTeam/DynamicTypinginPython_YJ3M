commit 9ad1b7c1a4ab38fe5658b3788b23ddee758339be
Author: Mark Story <mark@sentry.io>
Date:   Tue May 12 14:15:05 2020 -0400

    fix(api) Don't 500 on invalid per_page values (#18765)
    
    Instead return a 400 as the client has made a request we don't want to
    answer.
    
    Fixes SENTRY-GBY

diff --git a/src/sentry/api/base.py b/src/sentry/api/base.py
index 49f5b9ece4..b048fda5d6 100644
--- a/src/sentry/api/base.py
+++ b/src/sentry/api/base.py
@@ -253,7 +253,11 @@ class Endpoint(APIView):
             except ValueError:
                 raise ParseError(detail="Invalid cursor parameter.")
 
-        assert per_page <= max(max_per_page, default_per_page)
+        max_per_page = max(max_per_page, default_per_page)
+        if per_page > max_per_page:
+            raise ParseError(
+                detail="Invalid per_page value. Cannot exceed {}.".format(max_per_page)
+            )
 
         if not paginator:
             paginator = paginator_cls(**paginator_kwargs)
diff --git a/tests/sentry/api/test_base.py b/tests/sentry/api/test_base.py
index 9a8c61ca3c..49f9ab6a08 100644
--- a/tests/sentry/api/test_base.py
+++ b/tests/sentry/api/test_base.py
@@ -79,6 +79,11 @@ class PaginateTest(APITestCase):
         response = self.view(self.request)
         assert response.status_code == 400
 
+    def test_per_page_out_of_bounds(self):
+        self.request.GET = {"per_page": "101"}
+        response = self.view(self.request)
+        assert response.status_code == 400
+
 
 class EndpointJSONBodyTest(APITestCase):
     def setUp(self):
