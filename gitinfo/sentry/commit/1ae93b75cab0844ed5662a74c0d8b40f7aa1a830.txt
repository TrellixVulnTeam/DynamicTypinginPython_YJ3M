commit 1ae93b75cab0844ed5662a74c0d8b40f7aa1a830
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jul 10 10:27:24 2013 +0200

    Simple efficiency improvements for project deletion

diff --git a/src/sentry/models.py b/src/sentry/models.py
index 5c0a6e88ac..c835977e6b 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -242,8 +242,14 @@ class Project(Model):
         # This handles cascades properly
         # TODO: this doesn't clean up the index
         for model in (
-                Event, Group, TagKey, TagValue, GroupTag, GroupCountByMinute):
-            model.objects.filter(project=self).delete()
+                Event, Group, TagKey, TagValue, GroupTag, GroupCountByMinute,
+                ProjectCountByMinute, EventMapping):
+            has_results = True
+            while has_results:
+                has_results = False
+                for obj in model.objects.filter(project=self)[:1000]:
+                    obj.delete()
+                    has_results = True
         super(Project, self).delete()
 
     def merge_to(self, project):
