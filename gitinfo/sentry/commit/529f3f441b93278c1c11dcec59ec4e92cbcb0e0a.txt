commit 529f3f441b93278c1c11dcec59ec4e92cbcb0e0a
Author: maxbittker <maxbittker@gmail.com>
Date:   Fri Mar 3 14:55:17 2017 -0800

    flag works per-project

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 246cda8b39..b055795502 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -733,7 +733,7 @@ SENTRY_FEATURES = {
     'organizations:sso': True,
     'organizations:callsigns': False,
     'organizations:release-commits': False,
-    'organizations:similarity-view': True,
+    'projects:similarity-view': True,
     'projects:global-events': False,
     'projects:plugins': True,
     'projects:dsym': False,
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index 667ac3b86a..3897488321 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -14,7 +14,7 @@ default_manager.add('organizations:onboarding', OrganizationFeature)  # NOQA
 default_manager.add('organizations:callsigns', OrganizationFeature)  # NOQA
 default_manager.add('organizations:repos', OrganizationFeature)  # NOQA
 default_manager.add('organizations:release-commits', OrganizationFeature)  # NOQA
-default_manager.add('organizations:similarity-view', OrganizationFeature)  # NOQA
+default_manager.add('projects:similarity-view', ProjectFeature)  # NOQA
 default_manager.add('projects:global-events', ProjectFeature)  # NOQA
 default_manager.add('projects:plugins', ProjectPluginFeature)  # NOQA
 default_manager.add('workflow:release-emails', ProjectFeature)  # NOQA
diff --git a/src/sentry/static/sentry/app/views/groupDetails/header.jsx b/src/sentry/static/sentry/app/views/groupDetails/header.jsx
index 7eb7a92886..ad8ee2ff09 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/header.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/header.jsx
@@ -109,11 +109,9 @@ const GroupHeader = React.createClass({
     let groupId = group.id,
       projectId = this.getProject().slug,
       orgId = this.getOrganization().slug;
-
     let message = this.getMessage();
 
-    let hasSimView = ConfigStore.getConfig().features.has('organizations:similarity-view');
-
+    let hasSimView = ConfigStore.getConfig().features.has(`${orgId}:${projectId}:similarity-view`);
     return (
       <div className={className}>
         <div className="row">
diff --git a/src/sentry/templatetags/sentry_react.py b/src/sentry/templatetags/sentry_react.py
index 1881e0f0a8..09416ee244 100644
--- a/src/sentry/templatetags/sentry_react.py
+++ b/src/sentry/templatetags/sentry_react.py
@@ -11,7 +11,7 @@ from pkg_resources import parse_version
 
 from sentry import features, options
 from sentry.api.serializers.base import serialize
-from sentry.models import ProjectKey
+from sentry.models import ProjectKey, User, Project
 from sentry.utils import json
 from sentry.utils.email import is_smtp_enabled
 from sentry.utils.assets import get_asset_url
@@ -95,18 +95,20 @@ def get_react_config(context):
         messages = []
         is_superuser = False
 
+    enabled_features = []
+
     if user:
         user = extract_lazy_object(user)
-    org = user.get_orgs()[0]  # TODO MAX awful hack
-    enabled_features = []
+    if not user.is_anonymous():
+        enabled_features = [project.organization.slug + ':' + project.slug + ':similarity-view'
+            for project in Project.objects.filter(organization=User.objects.get(id=user.id).get_orgs()) if
+            features.has('projects:similarity-view', project=project)]
+
     if features.has('organizations:create', actor=user):
         enabled_features.append('organizations:create')
     if features.has('auth:register', actor=user):
         enabled_features.append('auth:register')
 
-    if features.has('organizations:similarity-view', actor=user, organization=org):
-        enabled_features.append('organizations:similarity-view')
-
     version_info = _get_version_info()
 
     needs_upgrade = False
