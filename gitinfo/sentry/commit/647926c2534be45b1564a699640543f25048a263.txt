commit 647926c2534be45b1564a699640543f25048a263
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 6 14:32:14 2018 -0700

    Correct tagstore v2 update clauses

diff --git a/src/sentry/tagstore/query.py b/src/sentry/tagstore/query.py
index 28682e93b7..cc10a3fcdb 100644
--- a/src/sentry/tagstore/query.py
+++ b/src/sentry/tagstore/query.py
@@ -4,6 +4,12 @@ from django.db.models import sql
 from django.db.models.query import QuerySet
 from sentry.db.models import BaseManager
 
+try:
+    # Django 1.7+
+    from django.db.models.sql.constants import CURSOR
+except ImportError:
+    CURSOR = None
+
 
 class NoTransactionUpdateQuerySet(QuerySet):
     def update(self, **kwargs):
@@ -22,7 +28,7 @@ class NoTransactionUpdateQuerySet(QuerySet):
         self._for_write = True
         query = self.query.clone(sql.UpdateQuery)
         query.add_update_values(kwargs)
-        rows = query.get_compiler(self.db).execute_sql(None)
+        rows = query.get_compiler(self.db).execute_sql(CURSOR)
         self._result_cache = None
         return rows
     update.alters_data = True
diff --git a/tests/sentry/tagstore/v2/test_backend.py b/tests/sentry/tagstore/v2/test_backend.py
index 687573ca32..3eb08168ac 100644
--- a/tests/sentry/tagstore/v2/test_backend.py
+++ b/tests/sentry/tagstore/v2/test_backend.py
@@ -381,6 +381,9 @@ class TagStorage(TestCase):
             status=TagKeyStatus.VISIBLE,
         ).count() == 2
 
+        assert tk1.status == TagKeyStatus.VISIBLE
+        assert tk2.status == TagKeyStatus.VISIBLE
+
         deleted = self.ts.delete_tag_key(self.proj1.id, self.key1)
         assert tk1 in deleted
         assert tk2 in deleted
