commit 5b3f48e0f11fce5467eac56911b0630ec65f8780
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jun 11 11:09:50 2015 -0700

    Enforce SENTRY_CONF in subcommands

diff --git a/src/sentry/management/commands/runserver.py b/src/sentry/management/commands/runserver.py
index a25d1aeb32..bc6f21f7f0 100644
--- a/src/sentry/management/commands/runserver.py
+++ b/src/sentry/management/commands/runserver.py
@@ -29,18 +29,28 @@ class Command(RunserverCommand):
 
     gulp_bin = os.path.join(cwd, 'node_modules', '.bin', 'gulp')
 
+    def get_env(self):
+        from sentry.app import env
+        result = os.environ.copy()
+        result.update({
+            'SENTRY_CONF': env.data['config'],
+        })
+        return result
+
     def run_watcher(self, verbosity, **options):
         if self.verbosity:
             self.stdout.write(self.style.HTTP_INFO('>> Running [gulp watch]'))
             stdout = None
         else:
             stdout = open('/dev/null', 'w')
-        return Popen([self.gulp_bin, 'watch'], cwd=self.cwd, stdout=stdout)
+        return Popen([self.gulp_bin, 'watch'], cwd=self.cwd, stdout=stdout,
+                     env=self.get_env())
 
     def run_server(self, verbosity, **options):
         if self.verbosity:
             self.stdout.write(self.style.HTTP_INFO('>> Launching webserver..'))
-        return Popen(sys.argv + ['--nowatcher'], env=os.environ, cwd=self.cwd)
+        return Popen(sys.argv + ['--nowatcher'], cwd=self.cwd,
+                     env=self.get_env())
 
     def run(self, *args, **options):
         self.style = color_style()
@@ -52,7 +62,8 @@ class Command(RunserverCommand):
                 stdout = None
             else:
                 stdout = open('/dev/null', 'w')
-            Popen([self.gulp_bin, 'dist'], cwd=self.cwd, stdout=stdout).wait()
+            Popen([self.gulp_bin, 'dist'], cwd=self.cwd, stdout=stdout,
+                  env=self.get_env()).wait()
 
             watcher = self.run_watcher(**options)
             server = self.run_server(**options)
