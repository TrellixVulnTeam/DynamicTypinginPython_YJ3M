commit 7311519b88f927f92e6a46cce18c58bae0fbeb51
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Mon Jun 18 12:56:29 2018 -0700

    ref(integrations): Add IntegrationProviderSerializer

diff --git a/src/sentry/api/endpoints/organization_config_integrations.py b/src/sentry/api/endpoints/organization_config_integrations.py
index 352423bcd2..8ebd68d5d8 100644
--- a/src/sentry/api/endpoints/organization_config_integrations.py
+++ b/src/sentry/api/endpoints/organization_config_integrations.py
@@ -4,6 +4,7 @@ from rest_framework.response import Response
 
 from sentry import integrations
 from sentry.api.bases.organization import OrganizationEndpoint
+from sentry.api.serializers import serialize, IntegrationProviderSerializer
 
 from sentry import features
 from django.conf import settings
@@ -11,7 +12,6 @@ from django.conf import settings
 
 class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
     def get(self, request, organization):
-        providers = []
         has_catchall = features.has('organizations:internal-catchall',
                                     organization,
                                     actor=request.user)
@@ -19,30 +19,19 @@ class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
                                        organization,
                                        actor=request.user)
 
+        providers = []
         for provider in integrations.all():
-            metadata = provider.metadata
-            metadata = metadata and metadata._asdict() or None
             internal_integrations = {
                 i for i in settings.SENTRY_INTERNAL_INTEGRATIONS if i != 'github' or not has_github_apps}
             if not has_catchall and provider.key in internal_integrations:
                 continue
-            providers.append(
-                {
-                    'key': provider.key,
-                    'name': provider.name,
-                    'metadata': metadata,
-                    'canAdd': provider.can_add,
-                    'canAddProject': provider.can_add_project,
-                    'setupDialog': dict(
-                        url='/organizations/{}/integrations/{}/setup/'.format(
-                            organization.slug,
-                            provider.key,
-                        ),
-                        **provider.setup_dialog_config
-                    )
-                }
-            )
-
-        return Response({
-            'providers': providers,
-        })
+
+            providers.append(provider)
+
+        serialized = serialize(
+            providers,
+            organization=organization,
+            serializer=IntegrationProviderSerializer(),
+        )
+
+        return Response({'providers': serialized})
diff --git a/src/sentry/api/serializers/models/integration.py b/src/sentry/api/serializers/models/integration.py
index fd151e376b..7a3bd0f615 100644
--- a/src/sentry/api/serializers/models/integration.py
+++ b/src/sentry/api/serializers/models/integration.py
@@ -93,6 +93,28 @@ class ProjectIntegrationSerializer(Serializer):
         return integration
 
 
+class IntegrationProviderSerializer(Serializer):
+    def serialize(self, obj, attrs, user, organization):
+        metadata = obj.metadata
+        metadata = metadata and metadata._asdict() or None
+
+        return {
+            'key': obj.key,
+            'name': obj.name,
+            'metadata': metadata,
+            'canAdd': obj.can_add,
+            'canAddProject': obj.can_add_project,
+            'features': [f.value for f in obj.features],
+            'setupDialog': dict(
+                url='/organizations/{}/integrations/{}/setup/'.format(
+                    organization.slug,
+                    obj.key,
+                ),
+                **obj.setup_dialog_config
+            )
+        }
+
+
 class IntegrationIssueConfigSerializer(IntegrationSerializer):
     def __init__(self, group, action, params=None):
         self.group = group
