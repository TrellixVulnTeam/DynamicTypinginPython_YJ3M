commit 9a09ddb285cd8e81c492d0f00ac54348243095d8
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Fri Dec 9 19:43:03 2016 +0100

    Fix an attribute error caused by sending a null stacktrace

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 93c4d5a8d5..7d26906780 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -162,8 +162,9 @@ def generate_culprit(data, platform=None):
             if e.get('stacktrace')
         ]
     except KeyError:
-        if 'sentry.interfaces.Stacktrace' in data:
-            stacktraces = [data['sentry.interfaces.Stacktrace']]
+        stacktrace = data.get('sentry.interfaces.Stacktrace')
+        if stacktrace:
+            stacktraces = [stacktrace]
         else:
             stacktraces = None
 
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index 29c89e4b43..eb834e0adf 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -839,6 +839,15 @@ class GenerateCulpritTest(TestCase):
         }
         assert generate_culprit(data) == 'PLZNOTME.py in ?'
 
+    def test_with_empty_stacktrace(self):
+        data = {
+            'sentry.interfaces.Stacktrace': None,
+            'sentry.interfaces.Http': {
+                'url': 'http://example.com'
+            },
+        }
+        assert generate_culprit(data) == 'http://example.com'
+
     def test_with_only_http_interface(self):
         data = {
             'sentry.interfaces.Http': {
