commit f8aef1fdc315b93d1232c89c01ac22e90e522e68
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Feb 28 15:47:43 2018 -0800

    ref(committers): Redesign suspected commits
    
    This utilizes the existing commit styling used in releases and expands the list to include all suspects.

diff --git a/src/sentry/api/endpoints/event_file_committers.py b/src/sentry/api/endpoints/event_file_committers.py
index 9bb40fe3fa..7bca5ec79b 100644
--- a/src/sentry/api/endpoints/event_file_committers.py
+++ b/src/sentry/api/endpoints/event_file_committers.py
@@ -89,10 +89,6 @@ class EventFileCommittersEndpoint(ProjectEndpoint):
         committer_commit_list = [
             serialize(commit) for commit in commits if commit.author.id == author_id
         ]
-
-        # filter out the author data
-        for c in committer_commit_list:
-            del c['author']
         return committer_commit_list
 
     def _get_committers(self, annotated_frames, commits):
diff --git a/src/sentry/static/sentry/app/components/activity/item.jsx b/src/sentry/static/sentry/app/components/activity/item.jsx
index bc457273aa..62f7375bff 100644
--- a/src/sentry/static/sentry/app/components/activity/item.jsx
+++ b/src/sentry/static/sentry/app/components/activity/item.jsx
@@ -3,9 +3,9 @@ import React from 'react';
 import {Link} from 'react-router';
 import marked from 'marked';
 
-import CommitLink from '../../views/releases/commitLink';
 import PullRequestLink from '../../views/releases/pullRequestLink';
 
+import CommitLink from '../../components/commitLink';
 import Duration from '../../components/duration';
 import Avatar from '../../components/avatar';
 import IssueLink from '../../components/issueLink';
diff --git a/src/sentry/static/sentry/app/views/releases/commitLink.jsx b/src/sentry/static/sentry/app/components/commitLink.jsx
similarity index 96%
rename from src/sentry/static/sentry/app/views/releases/commitLink.jsx
rename to src/sentry/static/sentry/app/components/commitLink.jsx
index 2cbfeaa9d8..8b0526f3dd 100644
--- a/src/sentry/static/sentry/app/views/releases/commitLink.jsx
+++ b/src/sentry/static/sentry/app/components/commitLink.jsx
@@ -1,7 +1,7 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 
-import InlineSvg from '../../components/inlineSvg';
+import InlineSvg from './inlineSvg';
 
 class CommitLink extends React.Component {
   static propTypes = {
diff --git a/src/sentry/static/sentry/app/components/events/eventCause.jsx b/src/sentry/static/sentry/app/components/events/eventCause.jsx
index 7d03afcdf0..c2be76afa7 100644
--- a/src/sentry/static/sentry/app/components/events/eventCause.jsx
+++ b/src/sentry/static/sentry/app/components/events/eventCause.jsx
@@ -1,34 +1,63 @@
+import idx from 'idx';
 import PropTypes from 'prop-types';
 import React from 'react';
 import createReactClass from 'create-react-class';
-import ReactDOMServer from 'react-dom/server';
 import moment from 'moment';
 
 import Avatar from '../avatar';
-import TooltipMixin from '../../mixins/tooltip';
 import ApiMixin from '../../mixins/apiMixin';
 import GroupState from '../../mixins/groupState';
 import TimeSince from '../timeSince';
-import {assignTo} from '../../actionCreators/group';
+import CommitLink from '../commitLink';
+import {t} from '../../locale';
+
+class Commit extends React.Component {
+  static propTypes = {
+    commit: PropTypes.object,
+  };
+
+  renderMessage = message => {
+    if (!message) {
+      return t('No message provided');
+    }
+
+    let firstLine = message.split(/\n/)[0];
+
+    return firstLine;
+  };
+
+  render() {
+    let {id, dateCreated, message, author, repository} = this.props.commit;
+    return (
+      <li className="list-group-item" key={id}>
+        <div className="row row-center-vertically">
+          <div className="col-xs-10 list-group-avatar">
+            <Avatar user={author} />
+            <h5 className="truncate">{this.renderMessage(message)}</h5>
+            <p>
+              <strong>{idx(author, _ => _.name) || t('Unknown author')}</strong> committed{' '}
+              <TimeSince date={dateCreated} />
+            </p>
+          </div>
+          <div className="col-xs-2 align-right">
+            <CommitLink commitId={id} repository={repository} />
+          </div>
+        </div>
+      </li>
+    );
+  }
+}
 
 export default createReactClass({
   displayName: 'EventCause',
 
   propTypes: {
-    event: PropTypes.object,
+    event: PropTypes.object.isRequired,
+    orgId: PropTypes.string.isRequired,
+    projectId: PropTypes.string.isRequired,
   },
 
-  mixins: [
-    ApiMixin,
-    GroupState,
-    TooltipMixin({
-      selector: '.tip',
-      html: true,
-      container: 'body',
-      template:
-        '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner tooltip-owners"></div></div>',
-    }),
-  ],
+  mixins: [ApiMixin, GroupState],
 
   getInitialState() {
     return {committers: undefined};
@@ -50,21 +79,12 @@ export default createReactClass({
     }
   },
 
-  componentDidUpdate(_, nextState) {
-    //this shallow equality should be OK because it's being mutated fetchData as a new object
-    if (this.state.owners !== nextState.owners) {
-      this.removeTooltips();
-      this.attachTooltips();
-    }
-  },
-
   fetchData(event) {
     // TODO(dcramer): this API request happens twice, and we need a store for it
     if (!event) return;
-    let org = this.getOrganization();
-    let project = this.getProject();
     this.api.request(
-      `/projects/${org.slug}/${project.slug}/events/${event.id}/committers/`,
+      `/projects/${this.props.orgId}/${this.props
+        .projectId}/events/${event.id}/committers/`,
       {
         success: (data, _, jqXHR) => {
           this.setState(data);
@@ -78,57 +98,6 @@ export default createReactClass({
     );
   },
 
-  assignTo(member) {
-    if (member.id !== undefined) {
-      assignTo({id: this.props.event.groupID, member});
-    }
-  },
-
-  renderCommitter(owner) {
-    let {author, commits} = owner;
-    return (
-      <span
-        key={author.id || author.email}
-        className="avatar-grid-item tip"
-        onClick={() => this.assignTo(author)}
-        title={ReactDOMServer.renderToStaticMarkup(
-          <div>
-            {author.id ? (
-              <div className="tooltip-owners-name">{author.name}</div>
-            ) : (
-              <div className="tooltip-owners-unknown">
-                <p className="tooltip-owners-unknown-email">
-                  <span className="icon icon-circle-cross" />
-                  <strong>{author.email}</strong>
-                </p>
-                <p>
-                  Sorry, we don't recognize this member. Make sure to link alternative
-                  emails in Account Settings.
-                </p>
-                <hr />
-              </div>
-            )}
-            <ul className="tooltip-owners-commits">
-              {commits.slice(0, 6).map(c => {
-                return (
-                  <li key={c.id} className="tooltip-owners-commit">
-                    {c.message}
-                    <span className="tooltip-owners-date">
-                      {' '}
-                      - {moment(c.dateCreated).fromNow()}
-                    </span>
-                  </li>
-                );
-              })}
-            </ul>
-          </div>
-        )}
-      >
-        <Avatar user={author} />
-      </span>
-    );
-  },
-
   render() {
     if (!(this.state.committers && this.state.committers.length)) {
       return null;
@@ -149,42 +118,18 @@ export default createReactClass({
         return firstSeen - a[0] - (firstSeen - b[0]);
       });
     if (!commitsWithAge.length) return null;
-
-    let probablyTheCommit = commitsWithAge[0][1];
-    let commitBits = probablyTheCommit.message.split('\n');
-    let subject = commitBits[0];
-    let message =
-      commitBits.length > 1
-        ? commitBits
-            .slice(1)
-            .join('\n')
-            .replace(/^\s+|\s+$/g, '')
-        : null;
     return (
       <div className="box">
         <div className="box-header">
-          <h3>Likely Culprit</h3>
-        </div>
-        <div style={{fontSize: '0.8em', fontWeight: 'bold', marginBottom: 10}}>
-          {subject}
-        </div>
-        {!!message && (
-          <pre
-            style={{marginBottom: 10, background: 'none', padding: 0, fontSize: '0.8em'}}
-          >
-            {message}
-          </pre>
-        )}
-        <div style={{marginBottom: 20, fontSize: '0.7em', color: '#999', lineHeight: 1}}>
-          {!!probablyTheCommit.author ? (
-            <strong>{probablyTheCommit.author.name}</strong>
-          ) : (
-            <strong>
-              <em>Unknown Author</em>
-            </strong>
-          )}{' '}
-          committed <TimeSince date={probablyTheCommit.dateCreated} />
+          <h3>
+            {t('Suspect Commits')} ({commitsWithAge.length})
+          </h3>
         </div>
+        <ul className="list-group list-group-lg commit-list">
+          {commitsWithAge.map(([age, commit]) => {
+            return <Commit key={commit.id} commit={commit} />;
+          })}
+        </ul>
       </div>
     );
   },
diff --git a/src/sentry/static/sentry/app/components/events/eventEntries.jsx b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
index 41af0cdaf5..99542fa48d 100644
--- a/src/sentry/static/sentry/app/components/events/eventEntries.jsx
+++ b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
@@ -4,6 +4,7 @@ import React from 'react';
 import createReactClass from 'create-react-class';
 
 import {logException} from '../../utils/logging';
+import EventCause from './eventCause';
 import EventContexts from './contexts';
 import EventContextSummary from './contextSummary';
 import EventDataSection from './eventDataSection';
@@ -15,6 +16,7 @@ import EventSdk from './sdk';
 import EventDevice from './device';
 import EventUserReport from './userReport';
 import SentryTypes from '../../proptypes';
+import GroupState from '../../mixins/groupState';
 import utils from '../../utils';
 import {t} from '../../locale';
 
@@ -53,6 +55,8 @@ const EventEntries = createReactClass({
     isShare: PropTypes.bool,
   },
 
+  mixins: [GroupState],
+
   getDefaultProps() {
     return {
       isShare: false,
@@ -67,7 +71,8 @@ const EventEntries = createReactClass({
 
   render() {
     let {group, isShare, project, event, orgId} = this.props;
-
+    let organization = this.getOrganization();
+    let features = organization ? new Set(organization.features) : new Set();
     let entries = event.entries.map((entry, entryIdx) => {
       try {
         let Component = this.interfaces[entry.type];
@@ -115,6 +120,13 @@ const EventEntries = createReactClass({
 
     return (
       <div className="entries">
+        {!utils.objectIsEmpty(event.errors) && (
+          <EventErrors group={group} event={event} />
+        )}{' '}
+        {!isShare &&
+          features.has('suggested-commits') && (
+            <EventCause event={event} orgId={orgId} projectId={project.slug} />
+          )}
         {event.userReport && (
           <EventUserReport
             report={event.userReport}
@@ -123,9 +135,6 @@ const EventEntries = createReactClass({
             issueId={group.id}
           />
         )}
-        {!utils.objectIsEmpty(event.errors) && (
-          <EventErrors group={group} event={event} />
-        )}
         {!utils.objectIsEmpty(event.sdk) &&
           event.sdk.upstream.isNewer && (
             <div className="alert-block alert-info box">
diff --git a/src/sentry/static/sentry/app/views/groupActivity/index.jsx b/src/sentry/static/sentry/app/views/groupActivity/index.jsx
index 0e95bbf10a..d353bce034 100644
--- a/src/sentry/static/sentry/app/views/groupActivity/index.jsx
+++ b/src/sentry/static/sentry/app/views/groupActivity/index.jsx
@@ -6,9 +6,9 @@ import createReactClass from 'create-react-class';
 import ApiMixin from '../../mixins/apiMixin';
 import GroupState from '../../mixins/groupState';
 
-import CommitLink from '../../views/releases/commitLink';
 import PullRequestLink from '../../views/releases/pullRequestLink';
 
+import CommitLink from '../../components/commitLink';
 import Duration from '../../components/duration';
 import Avatar from '../../components/avatar';
 import TimeSince from '../../components/timeSince';
diff --git a/src/sentry/static/sentry/app/views/groupEventDetails.jsx b/src/sentry/static/sentry/app/views/groupEventDetails.jsx
index a9fa0076d0..ff0f654cf5 100644
--- a/src/sentry/static/sentry/app/views/groupEventDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupEventDetails.jsx
@@ -2,7 +2,6 @@ import React from 'react';
 import createReactClass from 'create-react-class';
 import ApiMixin from '../mixins/apiMixin';
 import EventEntries from '../components/events/eventEntries';
-import EventCause from '../components/events/eventCause';
 import GroupEventToolbar from './groupDetails/eventToolbar';
 import GroupSidebar from '../components/group/sidebar';
 import GroupState from '../mixins/groupState';
@@ -13,6 +12,7 @@ import ResolutionBox from '../components/resolutionBox';
 
 const GroupEventDetails = createReactClass({
   displayName: 'GroupEventDetails',
+
   mixins: [ApiMixin, GroupState],
 
   getInitialState() {
@@ -76,7 +76,6 @@ const GroupEventDetails = createReactClass({
     let group = this.getGroup();
     let evt = this.state.event;
     let params = this.props.params;
-    let features = new Set(this.getOrganization().features);
 
     return (
       <div>
@@ -100,14 +99,6 @@ const GroupEventDetails = createReactClass({
                 )}
               </div>
             )}
-            {features.has('suggested-commits') && (
-              <EventCause
-                group={group}
-                event={evt}
-                orgId={params.orgId}
-                project={this.getProject()}
-              />
-            )}
             {this.state.loading ? (
               <LoadingIndicator />
             ) : this.state.error ? (
diff --git a/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx b/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
index d7a70bca43..089c55a034 100644
--- a/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
+++ b/src/sentry/static/sentry/app/views/releases/releaseCommits.jsx
@@ -11,7 +11,7 @@ import DropdownLink from '../../components/dropdownLink';
 import MenuItem from '../../components/menuItem';
 import ApiMixin from '../../mixins/apiMixin';
 
-import CommitLink from './commitLink';
+import CommitLink from '../../components/commitLink';
 
 import {t} from '../../locale';
 
