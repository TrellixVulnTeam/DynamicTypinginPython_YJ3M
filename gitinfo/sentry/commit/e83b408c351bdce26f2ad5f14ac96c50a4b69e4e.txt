commit e83b408c351bdce26f2ad5f14ac96c50a4b69e4e
Author: adhiraj <693121+adhiraj@users.noreply.github.com>
Date:   Mon Jul 9 13:02:55 2018 -0700

    feat(assistant): Fix hashtag assistant bugs (#8970)
    
    - #assistant works correctly on load now
    - dismissing a guide while the hash is active also works correctly now

diff --git a/src/sentry/static/sentry/app/stores/guideStore.jsx b/src/sentry/static/sentry/app/stores/guideStore.jsx
index b43b281df0..6ebcb2afe7 100644
--- a/src/sentry/static/sentry/app/stores/guideStore.jsx
+++ b/src/sentry/static/sentry/app/stores/guideStore.jsx
@@ -34,10 +34,11 @@ const GuideStore = Reflux.createStore({
     this.listenTo(ProjectActions.setActive, this.onSetActiveProject);
     this.listenTo(OrganizationsActions.changeSlug, this.onChangeSlug);
 
-    window.addEventListener('hashchange', this.onHashChange, false);
+    window.addEventListener('hashchange', this.onURLChange, false);
+    window.addEventListener('load', this.onURLChange, false);
   },
 
-  onHashChange() {
+  onURLChange() {
     this.state.forceShow = window.location.hash === '#assistant';
     this.updateCurrentGuide();
   },
@@ -71,6 +72,8 @@ const GuideStore = Reflux.createStore({
         })
       ].seen = true;
     }
+    // Don't continue to force show if the user dismissed the guide.
+    this.state.forceShow = false;
     this.updateCurrentGuide();
   },
 
diff --git a/tests/js/spec/stores/guideStore.spec.jsx b/tests/js/spec/stores/guideStore.spec.jsx
index 6c5bce3679..f3da550ac6 100644
--- a/tests/js/spec/stores/guideStore.spec.jsx
+++ b/tests/js/spec/stores/guideStore.spec.jsx
@@ -88,7 +88,11 @@ describe('GuideStore', function() {
     GuideStore.onRegisterAnchor(anchor2);
     GuideStore.state.forceShow = true;
     GuideStore.onFetchSucceeded(data);
-    expect(GuideStore.state.currentGuide).not.toEqual(null);
+    expect(GuideStore.state.currentGuide.id).toEqual(1);
+    GuideStore.onCloseGuideOrSupport();
+    expect(GuideStore.state.currentGuide.id).toEqual(2);
+    GuideStore.onCloseGuideOrSupport();
+    expect(GuideStore.state.currentGuide).toEqual(null);
   });
 
   it('should record analytics events when guide is cued', function() {
