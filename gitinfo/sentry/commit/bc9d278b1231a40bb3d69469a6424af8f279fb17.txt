commit bc9d278b1231a40bb3d69469a6424af8f279fb17
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Thu Aug 18 20:09:16 2016 +0200

    Added a test for address padding

diff --git a/tests/sentry/lang/native/test_plugin.py b/tests/sentry/lang/native/test_plugin.py
index 3185a36503..ab2f43a50d 100644
--- a/tests/sentry/lang/native/test_plugin.py
+++ b/tests/sentry/lang/native/test_plugin.py
@@ -4,6 +4,7 @@ from mock import patch
 
 from sentry.models import Event
 from sentry.testutils import requires_llvm_symbolizer, TestCase
+from sentry.lang.native.symbolizer import Symbolizer
 
 
 @requires_llvm_symbolizer
@@ -159,15 +160,23 @@ class BasicResolvingIntegrationTest(TestCase):
         assert frames[2].instruction_offset is None
         assert frames[2].in_app
 
-    @patch('sentry.lang.native.symbolizer.Symbolizer.symbolize_app_frame')
-    def test_frame_resolution_no_sdk_info(self, symbolize_frame):
+    def sym_app_frame(self, frame):
         object_name = (
             "/var/containers/Bundle/Application/"
             "B33C37A8-F933-4B6B-9FFA-152282BFDF13/"
             "SentryTest.app/SentryTest"
         )
-
-        symbolize_frame.return_value = {
+        if frame['instruction_addr'] == '0x1':
+            return {
+                'filename': 'Foo.swift',
+                'line': 82,
+                'column': 23,
+                'object_name': object_name,
+                'symbol_name': 'other_main',
+                'symbol_addr': '0x1',
+                "instruction_addr": '0x1',
+            }
+        return {
             'filename': 'Foo.swift',
             'line': 42,
             'column': 23,
@@ -177,6 +186,14 @@ class BasicResolvingIntegrationTest(TestCase):
             "instruction_addr": '0x100026330',
         }
 
+    @patch.object(Symbolizer, 'symbolize_app_frame', sym_app_frame)
+    def test_frame_resolution_no_sdk_info(self):
+        object_name = (
+            "/var/containers/Bundle/Application/"
+            "B33C37A8-F933-4B6B-9FFA-152282BFDF13/"
+            "SentryTest.app/SentryTest"
+        )
+
         event_data = {
             "sentry.interfaces.User": {
                 "ip_address": "31.172.207.97"
@@ -226,6 +243,12 @@ class BasicResolvingIntegrationTest(TestCase):
                                     "symbol_addr": 4295123616,
                                     "image_addr": 4295098368
                                 },
+                                {
+                                    "function": "other_main",
+                                    "instruction_addr": 1,
+                                    "symbol_addr": 1,
+                                    "image_addr": 4295098368
+                                },
                                 {
                                     "platform": "javascript",
                                     "function": "merge",
@@ -299,11 +322,20 @@ class BasicResolvingIntegrationTest(TestCase):
         assert frames[1].instruction_offset is None
         assert frames[1].in_app
 
-        assert frames[2].platform == 'javascript'
-        assert frames[2].abs_path == '/scripts/views.js'
-        assert frames[2].function == 'merge'
-        assert frames[2].lineno == 268
-        assert frames[2].colno == 16
-        assert frames[2].filename == '../../sentry/scripts/views.js'
+        assert frames[2].function == 'other_main'
+        assert frames[2].filename == 'Foo.swift'
+        assert frames[2].lineno == 82
+        assert frames[2].colno == 23
+        assert frames[2].package == object_name
+        assert frames[2].instruction_addr == '0x000000001'
         assert frames[2].instruction_offset is None
         assert frames[2].in_app
+
+        assert frames[3].platform == 'javascript'
+        assert frames[3].abs_path == '/scripts/views.js'
+        assert frames[3].function == 'merge'
+        assert frames[3].lineno == 268
+        assert frames[3].colno == 16
+        assert frames[3].filename == '../../sentry/scripts/views.js'
+        assert frames[3].instruction_offset is None
+        assert frames[3].in_app
