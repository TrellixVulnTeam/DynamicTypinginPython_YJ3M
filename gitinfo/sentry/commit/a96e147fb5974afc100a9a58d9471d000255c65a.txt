commit a96e147fb5974afc100a9a58d9471d000255c65a
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Fri Aug 16 10:45:00 2019 -0700

    feat: Reprocess event if a duplicate is found (#14375)
    
    Do not check for or skip duplicate processing outside of the caching
    window (which will be increased to 1 hour).
    
    Should not be merged before https://github.com/getsentry/sentry/pull/14363

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 747e74f01d..cba300c879 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -511,29 +511,6 @@ class EventManager(object):
             id=project.organization_id
         )
 
-        # Check to make sure we're not about to do a bunch of work that's
-        # already been done if we've processed an event with this ID. (This
-        # isn't a perfect solution -- this doesn't handle ``EventMapping`` and
-        # there's a race condition between here and when the event is actually
-        # saved, but it's an improvement. See GH-7677.)
-        try:
-            event = Event.objects.get(project_id=project.id, event_id=data["event_id"])
-        except Event.DoesNotExist:
-            pass
-        else:
-            # Make sure we cache on the project before returning
-            event._project_cache = project
-            logger.info(
-                "duplicate.found",
-                exc_info=True,
-                extra={
-                    "event_uuid": data["event_id"],
-                    "project_id": project.id,
-                    "model": Event.__name__,
-                },
-            )
-            return event
-
         # Pull out the culprit
         culprit = self.get_culprit()
 
@@ -781,7 +758,10 @@ class EventManager(object):
         if not is_sample:
             try:
                 with transaction.atomic(using=router.db_for_write(Event)):
-                    event.save()
+                    try:
+                        event = Event.objects.get(project_id=project.id, event_id=data["event_id"])
+                    except Event.DoesNotExist:
+                        event.save()
             except IntegrityError:
                 logger.info(
                     "duplicate.found",
