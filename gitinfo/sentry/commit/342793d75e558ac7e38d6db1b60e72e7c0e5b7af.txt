commit 342793d75e558ac7e38d6db1b60e72e7c0e5b7af
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Fri May 12 10:13:01 2017 -0700

    make sure to skip commits in backfilling too (#5378)

diff --git a/src/sentry/models/release.py b/src/sentry/models/release.py
index 0f0e129934..11d18a6d83 100644
--- a/src/sentry/models/release.py
+++ b/src/sentry/models/release.py
@@ -295,6 +295,12 @@ class Release(Model):
             Commit, CommitAuthor, Group, GroupCommitResolution, GroupResolution,
             GroupResolutionStatus, GroupStatus, ReleaseCommit, Repository
         )
+        from sentry.plugins.providers.repository import RepositoryProvider
+
+        commit_list = [
+            c for c in commit_list
+            if not RepositoryProvider.should_ignore_commit(c.get('message', ''))
+        ]
 
         with transaction.atomic():
             # TODO(dcramer): would be good to optimize the logic to avoid these
diff --git a/tests/sentry/models/test_release.py b/tests/sentry/models/test_release.py
index 059f222f86..c459486491 100644
--- a/tests/sentry/models/test_release.py
+++ b/tests/sentry/models/test_release.py
@@ -178,6 +178,13 @@ class SetCommitsTestCase(TestCase):
         }, {
             'id': commit2.key,
             'repository': repo.name,
+        }, {
+            'id': 'a' * 40,
+            'repository': repo.name,
+        }, {
+            'id': 'b' * 40,
+            'repository': repo.name,
+            'message': '#skipsentry',
         }])
 
         assert ReleaseCommit.objects.filter(commit=commit, release=release).exists()
@@ -188,3 +195,6 @@ class SetCommitsTestCase(TestCase):
             release=release,
         ).status == GroupResolutionStatus.RESOLVED
         assert Group.objects.get(id=group.id).status == GroupStatus.RESOLVED
+        # test that backfilling works
+        assert Commit.objects.filter(key='a' * 40, repository_id=repo.id).exists()
+        assert not Commit.objects.filter(key='b' * 40, repository_id=repo.id).exists()
