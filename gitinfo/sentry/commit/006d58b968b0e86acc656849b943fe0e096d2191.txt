commit 006d58b968b0e86acc656849b943fe0e096d2191
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Apr 9 09:41:43 2015 -0400

    Various task "fixes"

diff --git a/src/sentry/utils/pytest.py b/src/sentry/utils/pytest.py
index 4d5b7180df..6a0e87b2bf 100644
--- a/src/sentry/utils/pytest.py
+++ b/src/sentry/utils/pytest.py
@@ -66,7 +66,8 @@ def pytest_configure(config):
 
     # disable error reporting by default
     settings.SENTRY_REDIS_OPTIONS = {'hosts': {0: {'db': 9}}}
-    settings.BROKER_URL = 'redis://localhost:6379/8'
+    settings.BROKER_BACKEND = 'memory'
+    settings.BROKER_URL = None
 
     settings.SENTRY_ALLOW_ORIGIN = '*'
 
@@ -110,3 +111,7 @@ def pytest_runtest_teardown(item):
 
     client = StrictRedis(db=9)
     client.flushdb()
+
+    # TODO(dcramer): does not work at all
+    from celery.task.control import discard_all
+    discard_all()
diff --git a/tests/sentry/tasks/cleanup/tests.py b/tests/sentry/tasks/cleanup/tests.py
index 963e0816c4..e3c5740a0e 100644
--- a/tests/sentry/tasks/cleanup/tests.py
+++ b/tests/sentry/tasks/cleanup/tests.py
@@ -2,7 +2,6 @@
 
 from __future__ import absolute_import
 
-from celery.task import Task
 from sentry.models import Event, Group, GroupTagValue, TagValue, TagKey
 from sentry.tasks.cleanup import cleanup
 from sentry.testutils import TestCase
@@ -13,9 +12,6 @@ ALL_MODELS = (Event, Group, GroupTagValue, TagValue, TagKey)
 class SentryCleanupTest(TestCase):
     fixtures = ['tests/fixtures/cleanup.json']
 
-    def test_is_task(self):
-        self.assertTrue(isinstance(cleanup, Task))
-
     def test_simple(self):
         cleanup(days=1)
 
diff --git a/tests/sentry/tasks/process_buffer/tests.py b/tests/sentry/tasks/process_buffer/tests.py
index 4daedf16b0..b42eaa0999 100644
--- a/tests/sentry/tasks/process_buffer/tests.py
+++ b/tests/sentry/tasks/process_buffer/tests.py
@@ -4,15 +4,11 @@ from __future__ import absolute_import
 
 import mock
 
-from celery.task import Task
 from sentry.tasks.process_buffer import process_incr
 from sentry.testutils import TestCase
 
 
 class ProcessIncrTest(TestCase):
-    def test_is_task(self):
-        self.assertTrue(isinstance(process_incr, Task))
-
     @mock.patch('sentry.app.buffer.process')
     def test_calls_process(self, process):
         model = mock.Mock()
