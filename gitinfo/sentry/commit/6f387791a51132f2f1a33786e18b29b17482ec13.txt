commit 6f387791a51132f2f1a33786e18b29b17482ec13
Author: David Cramer <dcramer@gmail.com>
Date:   Sat May 3 14:00:58 2014 -0300

    Update team stats to summarize

diff --git a/src/sentry/api/endpoints/team_stats.py b/src/sentry/api/endpoints/team_stats.py
index 7f2ca5464e..d17256aee2 100644
--- a/src/sentry/api/endpoints/team_stats.py
+++ b/src/sentry/api/endpoints/team_stats.py
@@ -12,14 +12,20 @@ class TeamStatsEndpoint(BaseStatsEndpoint):
 
         assert_perm(team, request.user)
 
-        days = min(int(request.GET.get('days', 1)), 30)
-
         projects = Project.objects.get_for_user(request.user, team=team)
 
+        if not projects:
+            return Response([])
+
         data = tsdb.get_range(
             model=tsdb.models.project,
             keys=[p.id for p in projects],
             **self._parse_args(request)
-        )
+        ).values()
+
+        summarized = []
+        for n in xrange(len(data[0])):
+            total = sum(d[n][1] for d in data)
+            summarized.append((data[0][n][0], total))
 
-        return Response(data)
+        return Response(summarized)
diff --git a/tests/sentry/api/endpoints/test_team_stats.py b/tests/sentry/api/endpoints/test_team_stats.py
index 0174f9d5f5..a463b5dbd0 100644
--- a/tests/sentry/api/endpoints/test_team_stats.py
+++ b/tests/sentry/api/endpoints/test_team_stats.py
@@ -24,16 +24,7 @@ class TeamStatsTest(APITestCase):
         response = self.client.get(url, format='json')
 
         assert response.status_code == 200, response.content
-        assert project_1.id in response.data
-        assert response.data[project_1.id][-1][1] == 3, response.data
-        for point in response.data[project_1.id][:-1]:
+        assert response.data[-1][1] == 8, response.data
+        for point in response.data[:-1]:
             assert point[1] == 0
-        assert len(response.data[project_1.id]) == 24
-
-        assert project_2.id in response.data
-        assert response.data[project_2.id][-1][1] == 5, response.data
-        for point in response.data[project_2.id][:-1]:
-            assert point[1] == 0
-        assert len(response.data[project_2.id]) == 24
-
-        assert project_3.id not in response.data
+        assert len(response.data) == 24
