commit 8b29c8234bb51a81d5cab821a1f2ed4ea8e8bd88
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Aug 17 14:56:36 2017 -0700

    cloudflare: add metadata endpoint

diff --git a/src/sentry/api/endpoints/cloudflare_metadata.py b/src/sentry/api/endpoints/cloudflare_metadata.py
new file mode 100644
index 0000000000..1ca1bb8ab3
--- /dev/null
+++ b/src/sentry/api/endpoints/cloudflare_metadata.py
@@ -0,0 +1,23 @@
+from __future__ import absolute_import
+
+import six
+
+from rest_framework.response import Response
+
+from sentry.api.base import Endpoint
+from sentry.api.bases.user import UserPermission
+
+
+class CloudflareMetadataEndpoint(Endpoint):
+    permission_classes = (UserPermission, )
+
+    def get(self, request):
+        return Response(
+            {
+                'metadata': {
+                    'username': request.user.username,
+                    'userId': six.text_type(request.user.id),
+                    'email': request.user.email,
+                }
+            }
+        )
diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index 4261a218c2..a0bf28cb41 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -9,6 +9,7 @@ from .endpoints.api_tokens import ApiTokensEndpoint
 from .endpoints.auth_index import AuthIndexEndpoint
 from .endpoints.broadcast_index import BroadcastIndexEndpoint
 from .endpoints.catchall import CatchallEndpoint
+from .endpoints.cloudflare_metadata import CloudflareMetadataEndpoint
 from .endpoints.event_details import EventDetailsEndpoint
 from .endpoints.event_apple_crash_report import EventAppleCrashReportEndpoint
 from .endpoints.group_details import GroupDetailsEndpoint
@@ -151,6 +152,9 @@ urlpatterns = patterns(
     # Broadcasts
     url(r'^broadcasts/$', BroadcastIndexEndpoint.as_view(), name='sentry-api-0-broadcast-index'),
 
+    # Cloudflare Integration
+    url(r'^cloudflare/metadata/$', CloudflareMetadataEndpoint.as_view()),
+
     # Users
     url(r'^users/$', UserIndexEndpoint.as_view(), name='sentry-api-0-user-index'),
     url(
@@ -222,11 +226,13 @@ urlpatterns = patterns(
         r'^organizations/(?P<organization_slug>[^\/]+)/issues/new/$',
         OrganizationIssuesNewEndpoint.as_view(),
     ),
-    url(r'^organizations/(?P<organization_slug>[^\/]+)/integrations/$',
+    url(
+        r'^organizations/(?P<organization_slug>[^\/]+)/integrations/$',
         OrganizationIntegrationsEndpoint.as_view(),
         name='sentry-api-0-organization-integrations'
     ),
-    url(r'^organizations/(?P<organization_slug>[^\/]+)/members/$',
+    url(
+        r'^organizations/(?P<organization_slug>[^\/]+)/members/$',
         OrganizationMemberIndexEndpoint.as_view(),
         name='sentry-api-0-organization-member-index'
     ),
diff --git a/tests/sentry/api/endpoints/test_cloudflare_metdata.py b/tests/sentry/api/endpoints/test_cloudflare_metdata.py
new file mode 100644
index 0000000000..1cd7ccbb4b
--- /dev/null
+++ b/tests/sentry/api/endpoints/test_cloudflare_metdata.py
@@ -0,0 +1,21 @@
+from __future__ import absolute_import
+
+import six
+
+from sentry.testutils import APITestCase
+
+
+class CloudflareMetadataTest(APITestCase):
+    def test_simple(self):
+        user = self.create_user(email='a@example.com')
+
+        self.login_as(user=user)
+
+        resp = self.client.get('/api/0/cloudflare/metadata/', format='json')
+
+        assert resp.status_code == 200, resp.content
+        assert resp.data['metadata'] == {
+            'userId': six.text_type(user.id),
+            'username': user.username,
+            'email': user.email,
+        }
