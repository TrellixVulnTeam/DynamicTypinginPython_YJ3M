commit e8398fc09e62ce306dc1d2db5b659fae916b5344
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jul 30 21:51:11 2014 -0700

    Scrub values which also sort-of resemble credit cards

diff --git a/src/sentry/utils/data_scrubber.py b/src/sentry/utils/data_scrubber.py
index 2a8491f3a9..d7c2a0d2e7 100644
--- a/src/sentry/utils/data_scrubber.py
+++ b/src/sentry/utils/data_scrubber.py
@@ -44,7 +44,7 @@ class SensitiveDataFilter(object):
     FIELDS = frozenset([
         'password', 'secret', 'passwd', 'authorization', 'api_key', 'apikey'
     ])
-    VALUES_RE = re.compile(r'^(?:\d[ -]*?){13,16}$')
+    VALUES_RE = re.compile(r'\b(?:\d[ -]*?){13,16}\b')
 
     def apply(self, data):
         if 'stacktrace' in data:
@@ -61,7 +61,7 @@ class SensitiveDataFilter(object):
         if value is None:
             return
 
-        if isinstance(value, six.string_types) and self.VALUES_RE.match(value):
+        if isinstance(value, six.string_types) and self.VALUES_RE.search(value):
             return self.MASK
 
         if not key:  # key can be a NoneType
diff --git a/tests/sentry/utils/test_data_scrubber.py b/tests/sentry/utils/test_data_scrubber.py
index db9d1e428f..2a5fa98e8b 100644
--- a/tests/sentry/utils/test_data_scrubber.py
+++ b/tests/sentry/utils/test_data_scrubber.py
@@ -112,3 +112,12 @@ class SensitiveDataFilterTest(TestCase):
         proc = SensitiveDataFilter()
         result = proc.sanitize('foo', '424242424242424')
         self.assertEquals(result, proc.MASK)
+
+    def test_sanitize_credit_card_within_value(self):
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', "'4242424242424242'")
+        self.assertEquals(result, proc.MASK)
+
+        proc = SensitiveDataFilter()
+        result = proc.sanitize('foo', "foo 4242424242424242")
+        self.assertEquals(result, proc.MASK)
