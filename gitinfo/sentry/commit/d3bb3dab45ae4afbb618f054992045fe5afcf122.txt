commit d3bb3dab45ae4afbb618f054992045fe5afcf122
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Mar 4 18:09:37 2020 -0800

    test: Fix eventstream test (#17470)
    
    Since result cache has been turned on in Snuba (in getsentry/snuba#807), the second request to snuba.query() will yield the same result as the first. Since the first call didn't really test anything, just remove it.

diff --git a/tests/snuba/eventstream/test_eventstream.py b/tests/snuba/eventstream/test_eventstream.py
index 23755906fd..22be0037c0 100644
--- a/tests/snuba/eventstream/test_eventstream.py
+++ b/tests/snuba/eventstream/test_eventstream.py
@@ -55,16 +55,6 @@ class SnubaEventStreamTest(TestCase, SnubaTestCase):
     def test(self, mock_eventstream_insert):
         now = datetime.utcnow()
 
-        def _get_event_count():
-            return snuba.query(
-                start=now - timedelta(days=1),
-                end=now + timedelta(days=1),
-                groupby=["project_id"],
-                filter_keys={"project_id": [self.project.id]},
-            ).get(self.project.id, 0)
-
-        assert _get_event_count() == 0
-
         event = self.__build_event(now)
 
         # verify eventstream was called by EventManager
@@ -82,7 +72,12 @@ class SnubaEventStreamTest(TestCase, SnubaTestCase):
         }
 
         self.__produce_event(*insert_args, **insert_kwargs)
-        assert _get_event_count() == 1
+        assert snuba.query(
+            start=now - timedelta(days=1),
+            end=now + timedelta(days=1),
+            groupby=["project_id"],
+            filter_keys={"project_id": [self.project.id]},
+        ).get(self.project.id, 0) == 1
 
     @patch("sentry.eventstream.insert")
     def test_issueless(self, mock_eventstream_insert):
