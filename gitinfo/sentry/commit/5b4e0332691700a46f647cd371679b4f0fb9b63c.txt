commit 5b4e0332691700a46f647cd371679b4f0fb9b63c
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jun 8 15:31:10 2016 -0700

    Handle duplicate identities on merge
    
    @getsentry/infrastructure

diff --git a/src/sentry/models/user.py b/src/sentry/models/user.py
index 5dfd43e1d5..b3d262a098 100644
--- a/src/sentry/models/user.py
+++ b/src/sentry/models/user.py
@@ -125,6 +125,15 @@ class User(BaseModel, AbstractBaseUser):
             except IntegrityError:
                 pass
 
+        # remove any duplicate identities that exist on the current user that
+        # might conflict w/ the new users existing SSO
+        AuthIdentity.objects.filter(
+            user=from_user,
+            auth_provider__organization__in=AuthIdentity.objects.filter(
+                user=to_user,
+            ).values('auth_provider__organization')
+        ).delete()
+
         Activity.objects.filter(
             user=from_user,
         ).update(user=to_user)
