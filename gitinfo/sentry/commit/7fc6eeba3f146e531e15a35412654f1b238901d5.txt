commit 7fc6eeba3f146e531e15a35412654f1b238901d5
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Apr 19 18:49:34 2014 -0700

    Use project count for project charts

diff --git a/src/sentry/manager.py b/src/sentry/manager.py
index ec8f8c59fe..06d26e41f6 100644
--- a/src/sentry/manager.py
+++ b/src/sentry/manager.py
@@ -185,6 +185,7 @@ class ChartMixin(object):
         chart_qs = chart_qs.annotate(
             num=Sum('times_seen'),
         )
+
         if key:
             chart_qs = chart_qs.values_list(key, 'grouper', 'num').order_by(key, 'grouper')
         else:
@@ -774,6 +775,35 @@ class ProjectManager(BaseManager, ChartMixin):
 
         return sorted(projects, key=lambda x: x.name.lower())
 
+    def get_chart_data(self, instance, max_days=90, key=None):
+        if hasattr(instance, '_state'):
+            db = instance._state.db or 'default'
+        else:
+            db = 'default'
+
+        queryset = instance.projectcountbyminute_set
+
+        return self._get_chart_data(queryset, max_days, db, key=key)
+
+    def get_chart_data_for_group(self, instances, max_days=90, key=None):
+        if not instances:
+            if key is None:
+                return []
+            return {}
+
+        if hasattr(instances[0], '_state'):
+            db = instances[0]._state.db or 'default'
+        else:
+            db = 'default'
+
+        field = self.model.projectcountbyminute_set.related
+        column = field.field.name
+        queryset = field.model.objects.filter(**{
+            '%s__in' % column: instances,
+        })
+
+        return self._get_chart_data(queryset, max_days, db, key=key)
+
 
 class MetaManager(BaseManager):
     NOTSET = object()
@@ -805,7 +835,6 @@ class MetaManager(BaseManager):
         self.__metadata.pop(key, None)
 
     def set_value(self, key, value):
-        print key, value
         inst, _ = self.get_or_create(
             key=key,
             defaults={
