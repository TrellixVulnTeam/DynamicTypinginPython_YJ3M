commit 23e9423cc77e6530773ea73759697339df351de8
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Mar 16 16:20:50 2016 -0700

    Remove O(N) queries

diff --git a/src/sentry/api/serializers/models/organization.py b/src/sentry/api/serializers/models/organization.py
index 796bc59825..d007e06c3d 100644
--- a/src/sentry/api/serializers/models/organization.py
+++ b/src/sentry/api/serializers/models/organization.py
@@ -45,6 +45,8 @@ class DetailedOrganizationSerializer(OrganizationSerializer):
             organization=obj,
             status=TeamStatus.VISIBLE,
         ))
+        for team in team_list:
+            team._organization_cache = obj
 
         onboarding_tasks = list(OrganizationOnboardingTask.objects.filter(
             organization=obj,
diff --git a/src/sentry/api/serializers/models/project.py b/src/sentry/api/serializers/models/project.py
index ba3ec4073d..9810995432 100644
--- a/src/sentry/api/serializers/models/project.py
+++ b/src/sentry/api/serializers/models/project.py
@@ -1,7 +1,7 @@
 from __future__ import absolute_import
 
 from sentry.api.serializers import Serializer, register
-from sentry.models import Project, ProjectBookmark
+from sentry.models import Project, ProjectBookmark, ProjectOption
 
 
 @register(Project)
@@ -15,10 +15,19 @@ class ProjectSerializer(Serializer):
         else:
             bookmarks = set()
 
+        reviewed_callsigns = {
+            p.project_id: p.value
+            for p in ProjectOption.objects.filter(
+                project__in=item_list,
+                key='sentry:reviewed-callsign',
+            )
+        }
+
         result = {}
         for item in item_list:
             result[item] = {
                 'is_bookmarked': item.id in bookmarks,
+                'reviewed-callsign': reviewed_callsigns.get(item.id),
             }
         return result
 
@@ -40,7 +49,7 @@ class ProjectSerializer(Serializer):
             'color': obj.color,
             # TODO(mitsuhiko): eventually remove this when we will treat
             # all short names as reviewed.
-            'callSignReviewed': bool(obj.get_option('sentry:reviewed-callsign')),
+            'callSignReviewed': bool(attrs['reviewed-callsign']),
             'dateCreated': obj.date_added,
             'firstEvent': obj.first_event,
             'features': feature_list,
diff --git a/src/sentry/api/serializers/models/team.py b/src/sentry/api/serializers/models/team.py
index a7e8b24dea..a8ae5fd6e8 100644
--- a/src/sentry/api/serializers/models/team.py
+++ b/src/sentry/api/serializers/models/team.py
@@ -75,6 +75,13 @@ class TeamWithProjectsSerializer(TeamSerializer):
             status=ProjectStatus.VISIBLE,
         ).order_by('name', 'slug'))
 
+        team_map = {i.id: i for i in item_list}
+
+        for project in project_qs:
+            project._team_cache = team_map[project.team_id]
+            assert getattr(project.team, '_organization_cache', None)
+            project._organization_cache = project.team.organization
+
         project_map = defaultdict(list)
         for project, data in itertools.izip(project_qs, serialize(project_qs, user)):
             project_map[project.team_id].append(data)
