commit 0b06ebf7aa0b3cf06dbd4ea6122cdd2d62a4e099
Author: Jan Michael Auer <account@jauer.org>
Date:   Mon Apr 1 10:49:37 2019 +0200

    feat: Add symbolicator as optional devservice (#12577)
    
    This adds an option to enable the native symbolicator and adds it as an optional devservice.
    
    Also this adds the `system.internal-url-prefix` option. If set, it is used in place of `system.url-prefix` as the base URL when sending endpoint URLs to the symbolicator.

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index e009e431fb..7dcf98662b 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -1416,6 +1416,12 @@ SENTRY_DEVSERVICES = {
         'image': 'memcached:1.5-alpine',
         'ports': {'11211/tcp': 11211},
     },
+    'symbolicator': {
+        'image': 'us.gcr.io/sentryio/symbolicator:latest',
+        'pull': True,
+        'ports': {'3021/tcp': 3021},
+        'command': ['run'],
+    }
 }
 
 # Max file size for avatar photo uploads
diff --git a/src/sentry/options/defaults.py b/src/sentry/options/defaults.py
index 87f260075e..88ee554e1f 100644
--- a/src/sentry/options/defaults.py
+++ b/src/sentry/options/defaults.py
@@ -33,6 +33,7 @@ register('system.event-retention-days', default=0, flags=FLAG_ALLOW_EMPTY | FLAG
 register('system.secret-key', flags=FLAG_NOSTORE)
 # Absolute URL to the sentry root directory. Should not include a trailing slash.
 register('system.url-prefix', ttl=60, grace=3600, flags=FLAG_REQUIRED | FLAG_PRIORITIZE_DISK)
+register('system.internal-url-prefix', flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
 register('system.root-api-key', flags=FLAG_PRIORITIZE_DISK)
 register('system.logging-format', default=LoggingFormat.HUMAN, flags=FLAG_NOSTORE)
 # This is used for the chunk upload endpoint
@@ -113,6 +114,14 @@ register(
     flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK
 )
 
+# Symbolicator
+register('symbolicator.enabled', default=False, flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
+register(
+    'symbolicator.options',
+    default={'url': 'http://127.0.0.1:3021'},
+    flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK,
+)
+
 # Analytics
 register('analytics.backend', default='noop', flags=FLAG_NOSTORE)
 register('analytics.options', default={}, flags=FLAG_NOSTORE)
diff --git a/src/sentry/runner/commands/devservices.py b/src/sentry/runner/commands/devservices.py
index 8af40dfd6a..713fa87373 100644
--- a/src/sentry/runner/commands/devservices.py
+++ b/src/sentry/runner/commands/devservices.py
@@ -67,6 +67,7 @@ def up(project, exclude):
     configure()
 
     from django.conf import settings
+    from sentry import options as sentry_options
 
     import docker
     client = get_docker_client()
@@ -97,6 +98,9 @@ def up(project, exclude):
             fg='cyan')
         exclude |= {'kafka', 'zookeeper', 'snuba', 'clickhouse'}
 
+    if not sentry_options.get('symbolicator.enabled'):
+        exclude |= 'symbolicator'
+
     get_or_create(client, 'network', project)
 
     containers = {}
