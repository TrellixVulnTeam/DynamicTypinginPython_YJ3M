commit d934222cc6170778c56a2d0bb9fab73ddbc55e3b
Author: MeredithAnya <meredith.a.heller@gmail.com>
Date:   Tue Nov 26 10:34:56 2019 -0800

    ref(pagerduty): Add org feature flag (#15809)

diff --git a/src/sentry/api/endpoints/organization_config_integrations.py b/src/sentry/api/endpoints/organization_config_integrations.py
index 7e57b4a16e..d1f1a1bfd1 100644
--- a/src/sentry/api/endpoints/organization_config_integrations.py
+++ b/src/sentry/api/endpoints/organization_config_integrations.py
@@ -14,9 +14,12 @@ class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
         has_catchall = features.has(
             "organizations:internal-catchall", organization, actor=request.user
         )
+        has_pagerduty = features.has("organizations:pagerduty-v2", organization, actor=request.user)
 
         providers = []
         for provider in integrations.all():
+            if not has_pagerduty and provider.key == "pagerduty":
+                continue
             if not has_catchall and provider.key in settings.SENTRY_INTERNAL_INTEGRATIONS:
                 continue
 
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 15fa071a6d..51760a0f9a 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -819,6 +819,8 @@ SENTRY_FEATURES = {
     # Special feature flag primarily used on the sentry.io SAAS product for
     # easily enabling features while in early development.
     "organizations:internal-catchall": False,
+    # Enable v2 of pagerduty integration
+    "organizations:pagerduty-v2": False,
     # Enable inviting members to organizations.
     "organizations:invite-members": True,
     # Enable org-wide saved searches and user pinned search
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index c11dd29cd4..cb0760fff0 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -75,6 +75,7 @@ default_manager.add("organizations:large-debug-files", OrganizationFeature)  # N
 default_manager.add("organizations:monitors", OrganizationFeature)  # NOQA
 default_manager.add("organizations:onboarding", OrganizationFeature)  # NOQA
 default_manager.add("organizations:org-saved-searches", OrganizationFeature)  # NOQA
+default_manager.add("organizations:pagerduty-v2", OrganizationFeature)  # NOQA
 default_manager.add("organizations:relay", OrganizationFeature)  # NOQA
 default_manager.add("organizations:sso-basic", OrganizationFeature)  # NOQA
 default_manager.add("organizations:sso-rippling", OrganizationFeature)  # NOQA
