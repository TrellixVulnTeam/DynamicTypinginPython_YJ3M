commit bb0f73aacfe12bc1d7311157bd47465a9d3dcbb4
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jun 18 18:54:38 2013 -0700

    Expand user defined extra variable size to 2k

diff --git a/src/sentry/constants.py b/src/sentry/constants.py
index 90bf5877fc..1bedd06d12 100644
--- a/src/sentry/constants.py
+++ b/src/sentry/constants.py
@@ -154,10 +154,14 @@ PLATFORM_TITLES = {
 # accuracy provided.
 MINUTE_NORMALIZATION = 15
 
-# Prevent variables (e.g. context locals, extra data) from exceeding this size
-# in bytesish
+# Prevent variables (e.g. context locals, http data, etc) from exceeding this
+# size in characters
 MAX_VARIABLE_SIZE = 512
 
+# Prevent varabiesl within extra context from exceeding this size in
+# characters
+MAX_EXTRA_VARIABLE_SIZE = 2048
+
 # For various attributes we dont limit the entire attribute on size, but the
 # individual item. In those cases we also want to limit the maximum number of
 # keys
diff --git a/src/sentry/manager.py b/src/sentry/manager.py
index 0a6a93bb50..6dc400c79f 100644
--- a/src/sentry/manager.py
+++ b/src/sentry/manager.py
@@ -34,7 +34,9 @@ from django.utils.encoding import force_unicode
 from raven.utils.encoding import to_string
 from sentry import app
 from sentry.conf import settings
-from sentry.constants import STATUS_RESOLVED, STATUS_UNRESOLVED, MINUTE_NORMALIZATION
+from sentry.constants import (
+    STATUS_RESOLVED, STATUS_UNRESOLVED, MINUTE_NORMALIZATION,
+    MAX_EXTRA_VARIABLE_SIZE)
 from sentry.processors.base import send_group_processors
 from sentry.signals import regression_signal
 from sentry.tasks.index import index_event
@@ -425,7 +427,7 @@ class GroupManager(BaseManager, ChartMixin):
             # throw it away
             data['extra'] = {}
 
-        trim_dict(data['extra'])
+        trim_dict(data['extra'], max_size=MAX_EXTRA_VARIABLE_SIZE)
 
         # HACK: move this to interfaces code
         if 'sentry.interfaces.Stacktrace' in data:
diff --git a/src/sentry/utils/safe.py b/src/sentry/utils/safe.py
index f62531c927..2affc4a60c 100644
--- a/src/sentry/utils/safe.py
+++ b/src/sentry/utils/safe.py
@@ -80,6 +80,6 @@ def trim(value, max_size=MAX_VARIABLE_SIZE, max_depth=3, _depth=0, _size=0, **kw
 def trim_dict(value, max_items=MAX_DICTIONARY_ITEMS, **kwargs):
     max_items -= 1
     for idx, key in enumerate(value.keys()):
-        value[key] = trim(value[key])
+        value[key] = trim(value[key], **kwargs)
         if idx > max_items:
             del value[key]
