commit 0377fe33880a50924fb5be796914c43b01027238
Author: David Cramer <dcramer@gmail.com>
Date:   Sun May 4 11:37:51 2014 -0400

    clean up maybe_alert logic

diff --git a/src/sentry/models/alert.py b/src/sentry/models/alert.py
index 5c799f7b5d..86c2325b6a 100644
--- a/src/sentry/models/alert.py
+++ b/src/sentry/models/alert.py
@@ -57,13 +57,14 @@ class Alert(Model):
         # - an alert for the event hasn't been created in the last 60 minutes
 
         # TODO: there is a race condition if we're calling this function for the same project
-        if manager.filter(
-                project=project_id, datetime__gte=now - timedelta(minutes=60)).exists():
-            return
-
-        if manager.filter(
-                project=project_id, group=group_id,
-                datetime__gte=now - timedelta(minutes=60)).exists():
+        kwargs = {
+            'project_id': project_id,
+            'datetime__gte': now - timedelta(minutes=60),
+        }
+        if group_id:
+            kwargs['group'] = group_id
+
+        if manager.filter(**kwargs).exists():
             return
 
         alert = manager.create(
