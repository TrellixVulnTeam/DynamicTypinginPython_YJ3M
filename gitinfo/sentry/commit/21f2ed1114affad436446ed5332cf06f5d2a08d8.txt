commit 21f2ed1114affad436446ed5332cf06f5d2a08d8
Author: Ted Kaemming <ted@kaemming.com>
Date:   Mon Sep 21 17:32:14 2015 -0700

    Handle missing iteration counter (due to evictions.)

diff --git a/src/sentry/timelines/redis.py b/src/sentry/timelines/redis.py
index 499f3ee2f3..836e2bb2f0 100644
--- a/src/sentry/timelines/redis.py
+++ b/src/sentry/timelines/redis.py
@@ -244,8 +244,14 @@ class RedisBackend(Backend):
         if not records:
             logger.info('Retrieved timeline containing no records.')
 
-        # TODO: This should gracefully handle the iteration key being evicted.
-        iteration = int(connection.get(make_iteration_key(timeline_key)))
+        def get_iteration_count(default=0):
+            value = connection.get(make_iteration_key(timeline_key))
+            if not value:
+                logger.warning('Could not retrieve iteration counter for %s, defaulting to %s.', target, default)
+                return default
+            return int(value)
+
+        iteration = get_iteration_count()
 
         def get_records_for_digest():
             with connection.pipeline(transaction=False) as pipeline:
