commit ef6327bc5a95b664d2e0c71bfec5b33783335fa3
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Tue Dec 4 13:25:10 2018 -0800

    feat(discover): Update intro component with new examples (#10919)
    
    Clicking a query also runs the selected query

diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
index eb086ad3ab..58cf9934cc 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
@@ -130,6 +130,11 @@ export default class OrganizationDiscover extends React.Component {
     });
   };
 
+  updateAndRunQuery = query => {
+    this.updateFields(query);
+    this.runQuery();
+  };
+
   handleUpdateTime = ({relative, start, end}) => {
     this.updateFields({
       range: relative,
@@ -395,7 +400,7 @@ export default class OrganizationDiscover extends React.Component {
                     </Heading>
                   </HeadingContainer>
                 </div>
-                <Intro updateQuery={this.updateFields} />
+                <Intro updateQuery={this.updateAndRunQuery} />
               </React.Fragment>
             )}
             {isFetchingQuery && <ResultLoading />}
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/intro.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/intro.jsx
index 5bd2f6ff8c..95618f6843 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/intro.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/intro.jsx
@@ -6,7 +6,9 @@ import {Box, Flex} from 'grid-emotion';
 import {tct, t} from 'app/locale';
 
 import ExternalLink from 'app/components/externalLink';
-import Link from 'app/components/link';
+import Button from 'app/components/button';
+import {Panel} from 'app/components/panels';
+import space from 'app/styles/space';
 
 export default class Intro extends React.Component {
   static propTypes = {
@@ -16,32 +18,32 @@ export default class Intro extends React.Component {
   getExampleQueries() {
     return [
       {
-        description: t('Last 10 event IDs'),
+        title: t('Events by stack filename'),
+        description: 'What is my most problematic code?',
         query: {
-          fields: ['id'],
-          aggregations: [],
+          fields: ['stack.filename'],
+          aggregations: [['count()', null, 'count']],
           conditions: [],
-          limit: 10,
-          orderby: '-timestamp',
+          orderby: '-count',
         },
       },
       {
-        description: t('Events by project ID'),
+        title: t('Unique issues by user'),
+        description: t("Who's having the worst time?"),
         query: {
-          fields: ['project.id'],
-          aggregations: [['count()', null, 'count']],
+          fields: ['user.id', 'user.username', 'user.email', 'user.ip'],
+          aggregations: [['uniq', 'issue.id', 'uniq_issue_id']],
           conditions: [],
-          limit: 1000,
-          orderby: '-count',
+          orderby: '-uniq_issue_id',
         },
       },
       {
-        description: t('Top exception types'),
+        title: t('Events by geography'),
+        description: 'Are my services less reliable in some regions?',
         query: {
-          fields: ['error.type'],
+          fields: ['geo.country_code', 'geo.region', 'geo.city'],
           aggregations: [['count()', null, 'count']],
-          conditions: [['error.type', 'IS NOT NULL', null]],
-          limit: 1000,
+          conditions: [],
           orderby: '-count',
         },
       },
@@ -55,35 +57,31 @@ export default class Intro extends React.Component {
         align="center"
         justify="center"
       >
-        <Box w={500}>
+        <Box w={560}>
+          <Heading>{t('Discover lets you query raw event data in Sentry')}</Heading>
           <TextBlock>
             {tct(
-              `Welcome to [discover:Discover]. Discover lets you query raw
-              event data in Sentry.`,
+              `Getting started? Try running one of the example queries below.
+            To learn more about how to use the query builder, [docs:see the docs].`,
               {
-                discover: <strong />,
+                docs: <ExternalLink href="https://docs.sentry.io/product/discover/" />,
               }
             )}
           </TextBlock>
           <TextBlock>
-            {t(
-              `Getting started? Try running one of the example queries below.
-              Select the query you want to make, then click "Run Query".`
-            )}
-            <ul>
-              {this.getExampleQueries().map(({query, description}, idx) => (
-                <li key={idx}>
-                  <Link onClick={() => this.props.updateQuery(query)}>{description}</Link>
-                </li>
-              ))}
-            </ul>
-          </TextBlock>
-          <TextBlock>
-            {tct(
-              `To learn more about how to use the query builder, see the
-              [docs:docs].`,
-              {docs: <ExternalLink href="https://docs.sentry.io/product/discover/" />}
-            )}
+            {this.getExampleQueries().map(({title, description, query}, idx) => (
+              <ExampleQuery key={idx}>
+                <div>
+                  <div>{title}</div>
+                  <ExampleQueryDescription>{description}</ExampleQueryDescription>
+                </div>
+                <div>
+                  <Button size="small" onClick={() => this.props.updateQuery(query)}>
+                    {t('Run')}
+                  </Button>
+                </div>
+              </ExampleQuery>
+            ))}
           </TextBlock>
         </Box>
       </IntroContainer>
@@ -96,6 +94,23 @@ const IntroContainer = styled(Flex)`
   color: ${p => p.theme.gray5};
 `;
 
+const Heading = styled('div')`
+  font-size: ${p => p.theme.fontSizeExtraLarge};
+  font-weight: 700;
+  margin: 0 0 20px;
+`;
+
 const TextBlock = styled('div')`
   margin: 0 0 20px;
 `;
+
+const ExampleQuery = styled(Panel)`
+  display: flex;
+  justify-content: space-between;
+  align-items: center;
+  padding: ${space(2)};
+`;
+const ExampleQueryDescription = styled('div')`
+  font-size: ${p => p.theme.fontSizeSmall};
+  color: ${p => p.theme.gray1};
+`;
diff --git a/tests/js/spec/views/organizationDiscover/discover.spec.jsx b/tests/js/spec/views/organizationDiscover/discover.spec.jsx
index 41ef0a9e27..131940405e 100644
--- a/tests/js/spec/views/organizationDiscover/discover.spec.jsx
+++ b/tests/js/spec/views/organizationDiscover/discover.spec.jsx
@@ -452,23 +452,31 @@ describe('Discover', function() {
         />,
         TestStubs.routerContext()
       );
+
+      queryBuilder.fetch = jest.fn(() =>
+        Promise.resolve({timing: {}, data: [], meta: []})
+      );
     });
+
     it('renders example queries', function() {
-      const queries = wrapper.find('IntroContainer').find('li');
+      const queries = wrapper.find('IntroContainer').find('ExampleQuery');
       expect(queries).toHaveLength(3);
-      expect(queries.first().text()).toBe('Last 10 event IDs');
+      expect(queries.first().text()).toContain('Events by stack filename');
     });
 
-    it('updates query builder when clicked', function() {
-      const queries = wrapper.find('IntroContainer').find('li');
-      queries
+    it('runs example query', function() {
+      expect(queryBuilder.fetch).not.toHaveBeenCalled();
+      wrapper
+        .find('IntroContainer')
+        .find('ExampleQuery')
         .first()
-        .find('a')
+        .find('Button')
         .simulate('click');
-
       const query = queryBuilder.getInternal();
-      expect(query.fields).toEqual(['id']);
-      expect(query.limit).toEqual(10);
+      expect(query.fields).toEqual(['stack.filename']);
+      expect(query.aggregations).toEqual([['count()', null, 'count']]);
+      expect(query.conditions).toEqual([]);
+      expect(queryBuilder.fetch).toHaveBeenCalledTimes(2);
     });
   });
 
