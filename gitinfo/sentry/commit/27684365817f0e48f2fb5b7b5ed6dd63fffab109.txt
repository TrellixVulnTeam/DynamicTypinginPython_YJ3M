commit 27684365817f0e48f2fb5b7b5ed6dd63fffab109
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed May 25 12:32:12 2016 -0700

    Move reactivate redirect into get_login_redirect (#3336)
    
    This will make sure that both normal auth and SSO auth

diff --git a/src/sentry/utils/auth.py b/src/sentry/utils/auth.py
index c50950603f..b0a38c6104 100644
--- a/src/sentry/utils/auth.py
+++ b/src/sentry/utils/auth.py
@@ -62,6 +62,9 @@ def get_login_redirect(request, default=None):
     if default is None:
         default = reverse('sentry')
 
+    if not request.user.is_active:
+        return reverse('sentry-reactivate-account')
+
     # If there is a pending 2fa authentication bound to the session then
     # we need to go to the 2fa dialog.
     if has_pending_2fa(request):
diff --git a/src/sentry/web/frontend/auth_login.py b/src/sentry/web/frontend/auth_login.py
index cfbeec57de..d04885b093 100644
--- a/src/sentry/web/frontend/auth_login.py
+++ b/src/sentry/web/frontend/auth_login.py
@@ -91,9 +91,6 @@ class AuthLoginView(BaseView):
 
             request.session.pop('needs_captcha', None)
 
-            if not user.is_active:
-                return self.redirect(reverse('sentry-reactivate-account'))
-
             return self.redirect(auth.get_login_redirect(request))
 
         elif request.POST and not request.session.get('needs_captcha'):
diff --git a/tests/sentry/utils/auth/tests.py b/tests/sentry/utils/auth/tests.py
index 86997f3f02..7c7f1b8621 100644
--- a/tests/sentry/utils/auth/tests.py
+++ b/tests/sentry/utils/auth/tests.py
@@ -51,3 +51,9 @@ class GetLoginRedirectTest(TestCase):
     def test_no_value_uses_default(self):
         result = get_login_redirect(self.make_request())
         assert result == reverse('sentry')
+
+    def test_reactivate(self):
+        request = self.make_request()
+        request.user.is_active = False
+        result = get_login_redirect(request)
+        assert result == reverse('sentry-reactivate-account')
