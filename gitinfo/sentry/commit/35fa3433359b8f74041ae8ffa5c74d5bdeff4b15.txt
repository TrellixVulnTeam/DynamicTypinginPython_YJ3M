commit 35fa3433359b8f74041ae8ffa5c74d5bdeff4b15
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Apr 22 10:46:10 2016 -0700

    Bind ALLOWED_HOSTS to * by default

diff --git a/CHANGES b/CHANGES
index 945a553672..0d961a0984 100644
--- a/CHANGES
+++ b/CHANGES
@@ -5,6 +5,7 @@ Version 8.4 (Unreleased)
 - Organizaiton's can now opt-in to early adopter features (via organization settings).
 - User Feedback is now enabled by default.
 - Deprecated ``sentry start`` in favor of new ``sentry run``.
+- Access is no longer restricted by default to the domain matching ``system.url-prefix``. You must opt into this by setting ``ALLOWED_HOSTS`` explicitly.
 
 Version 8.3.2
 -------------
diff --git a/src/sentry/runner/hacks.py b/src/sentry/runner/hacks.py
deleted file mode 100644
index d7510c1263..0000000000
--- a/src/sentry/runner/hacks.py
+++ /dev/null
@@ -1,22 +0,0 @@
-"""
-sentry.runner.hacks
-~~~~~~~~~~~~~~~~~~~
-
-:copyright: (c) 2015 by the Sentry Team, see AUTHORS for more details.
-:license: BSD, see LICENSE for more details.
-"""
-from __future__ import absolute_import, print_function
-
-from sentry.http import get_server_hostname
-
-
-class AllowedHosts(object):
-    # HACK: This is a fake stub for settings.ALLOWED_HOSTS
-    # This is needing since ALLOWED_HOSTS is engrained
-    # in Django internals, so we want this "tuple" to respond
-    # to runtime changes based on our system.url-prefix Option
-    def __iter__(self):
-        yield get_server_hostname() or '*'
-
-    def __repr__(self):
-        return repr(tuple(self))
diff --git a/src/sentry/runner/initializer.py b/src/sentry/runner/initializer.py
index d48aeb718a..2375aceff6 100644
--- a/src/sentry/runner/initializer.py
+++ b/src/sentry/runner/initializer.py
@@ -323,8 +323,7 @@ def apply_legacy_settings(settings):
 
     # Set ALLOWED_HOSTS if it's not already available
     if not settings.ALLOWED_HOSTS:
-        from .hacks import AllowedHosts
-        settings.ALLOWED_HOSTS = AllowedHosts()
+        settings.ALLOWED_HOSTS = ['*']
 
     if hasattr(settings, 'SENTRY_ALLOW_REGISTRATION'):
         warnings.warn(DeprecatedSettingWarning('SENTRY_ALLOW_REGISTRATION', 'SENTRY_FEATURES["auth:register"]'))
diff --git a/tests/sentry/runner/test_initializer.py b/tests/sentry/runner/test_initializer.py
index e4efac6a4a..707a49fea3 100644
--- a/tests/sentry/runner/test_initializer.py
+++ b/tests/sentry/runner/test_initializer.py
@@ -159,6 +159,7 @@ def test_bootstrap_options_empty_file(settings, config_yml):
 
 
 def test_apply_legacy_settings(settings):
+    settings.ALLOWED_HOSTS = []
     settings.SENTRY_USE_QUEUE = True
     settings.SENTRY_ALLOW_REGISTRATION = True
     settings.SENTRY_ADMIN_EMAIL = 'admin-email'
@@ -179,6 +180,7 @@ def test_apply_legacy_settings(settings):
         'mail.from': 'mail-from',
     }
     assert settings.DEFAULT_FROM_EMAIL == 'mail-from'
+    assert settings.ALLOWED_HOSTS == ['*']
 
 
 def test_initialize_app(settings):
