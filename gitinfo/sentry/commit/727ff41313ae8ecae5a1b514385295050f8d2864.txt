commit 727ff41313ae8ecae5a1b514385295050f8d2864
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Fri Feb 8 12:21:27 2019 +0100

    fix: workaround for search_message in relay (#11997)

diff --git a/src/sentry/buffer/base.py b/src/sentry/buffer/base.py
index d1ca64108c..3d6d36f9e3 100644
--- a/src/sentry/buffer/base.py
+++ b/src/sentry/buffer/base.py
@@ -73,6 +73,10 @@ class Buffer(Service):
                 last_seen=update_kwargs['last_seen'],
             )
 
+        # HACK: temporary workaround
+        if model is Group and 'search_message' in update_kwargs:
+            update_kwargs['message'] = update_kwargs.pop('search_message')
+
         _, created = model.objects.create_or_update(values=update_kwargs, **filters)
 
         buffer_incr_complete.send_robust(
diff --git a/src/sentry/eventstream/kafka/protocol.py b/src/sentry/eventstream/kafka/protocol.py
index e532600f1e..9f8ffba8c5 100644
--- a/src/sentry/eventstream/kafka/protocol.py
+++ b/src/sentry/eventstream/kafka/protocol.py
@@ -28,6 +28,10 @@ def basic_protocol_handler(unsupported_operations):
             "%Y-%m-%dT%H:%M:%S.%fZ",
         ).replace(tzinfo=pytz.utc)
 
+        # workaround for temporarily bad events
+        if 'search_message' in event_data and not event_data.get('message'):
+            event_data['message'] = event_data['search_message']
+
         kwargs = {
             'event': Event(**{
                 name: event_data[name] for name in [
