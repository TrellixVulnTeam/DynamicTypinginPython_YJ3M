commit 2c020cbbb4249aaf56b3173409955bbc5920bf12
Author: MeredithAnya <meredith@getsentry.com>
Date:   Wed Jul 10 13:17:43 2019 -0700

    ref(app-platform): Pass through event for error.created (#13942)
    
    * ref(app-platform): Pass through event for error.created

diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index 5f7e0f01a5..5cda7007ce 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -207,8 +207,7 @@ def post_process_group(event, is_new, is_regression, is_sample, is_new_group_env
                 action='created',
                 sender='Error',
                 instance_id=event.event_id,
-                project_id=event.project_id,
-                group_id=event.group_id,
+                instance=event,
             )
         if is_new:
             process_resource_change_bound.delay(
diff --git a/src/sentry/tasks/sentry_apps.py b/src/sentry/tasks/sentry_apps.py
index 5ea682e36e..cf3e76c052 100644
--- a/src/sentry/tasks/sentry_apps.py
+++ b/src/sentry/tasks/sentry_apps.py
@@ -122,24 +122,16 @@ def send_alert_event(event, rule, sentry_app_id):
 def _process_resource_change(action, sender, instance_id, retryer=None, *args, **kwargs):
     # The class is serialized as a string when enqueueing the class.
     model = TYPES[sender]
-    # The Event model has different hooks for the differenct types. The sender
+    # The Event model has different hooks for the different event types. The sender
     # determines which type eg. Error and therefore the 'name' eg. error
     if issubclass(model, EventCommon):
-        if not kwargs.get('project_id'):
+        if not kwargs.get('instance'):
             extra = {
                 'sender': sender,
                 'action': action,
                 'event_id': instance_id,
             }
-            logger.info('process_resource_change.event_missing_project_id', extra=extra)
-            return
-        if not kwargs.get('group_id'):
-            extra = {
-                'sender': sender,
-                'action': action,
-                'event_id': instance_id,
-            }
-            logger.info('process_resource_change.event_missing_group_id', extra=extra)
+            logger.info('process_resource_change.event_missing_event', extra=extra)
             return
 
         name = sender.lower()
@@ -156,12 +148,11 @@ def _process_resource_change(action, sender, instance_id, retryer=None, *args, *
     # transaction that creates the Group has committed.
     try:
         if issubclass(model, EventCommon):
-            # 'from_event_id' is supported for both Event and SnubaEvent
-            # instance_id is the event.event_id NOT the event.id
-            instance = model.objects.from_event_id(
-                instance_id,
-                kwargs.get('project_id'),
-            )
+            # XXX:(Meredith): Passing through the entire event was an intentional choice
+            # to avoid having to query NodeStore again for data we had previously in
+            # post_process. While this is not ideal, changing this will most likely involve
+            # an overhaul of how we do things in post_process, not just this task alone.
+            instance = kwargs.get('instance')
         else:
             instance = model.objects.get(id=instance_id)
     except model.DoesNotExist as e:
@@ -191,9 +182,7 @@ def _process_resource_change(action, sender, instance_id, retryer=None, *args, *
     for installation in installations:
         data = {}
         if issubclass(model, EventCommon):
-            group_id = kwargs.get('group_id')
-            project_id = kwargs.get('project_id')
-            data[name] = _webhook_event_data(instance, group_id, project_id)
+            data[name] = _webhook_event_data(instance, instance.group_id, instance.project_id)
             # XXX(Meredith): this flag is in place for testing the load this task creates
             # and during testing we don't need to send the webhook.
             if features.has('organizations:integrations-event-hooks', organization=org):
diff --git a/tests/sentry/tasks/post_process/tests.py b/tests/sentry/tasks/post_process/tests.py
index a7c466c977..a6718742bc 100644
--- a/tests/sentry/tasks/post_process/tests.py
+++ b/tests/sentry/tasks/post_process/tests.py
@@ -429,8 +429,7 @@ class PostProcessGroupTest(TestCase):
         )
 
         kwargs = {
-            'project_id': self.project.id,
-            'group_id': event.group.id,
+            'instance': event,
         }
         delay.assert_called_once_with(
             action='created',
@@ -546,8 +545,7 @@ class PostProcessGroupTest(TestCase):
         )
 
         kwargs = {
-            'project_id': self.project.id,
-            'group_id': event.group.id,
+            'instance': event,
         }
 
         delay.assert_called_once_with(
