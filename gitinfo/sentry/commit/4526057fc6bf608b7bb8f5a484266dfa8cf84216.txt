commit 4526057fc6bf608b7bb8f5a484266dfa8cf84216
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Jun 22 10:10:51 2020 +0200

    fix(pii): Send correct casing for urlauth and usssn rules (#19478)
    
    We have an inconsistency in the data scrubbing format where @usssn:replace actually corresponds to {"type": "us_ssn", ...}. Same for urlauth vs url_auth.
    
    Right now we fail to save any data scrubbing settings that contain urlauth or usssn rules. Convert to the right casing when loading in the UI as that's the fastest way to get the fix out.

diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/convertRelayPiiConfig.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/convertRelayPiiConfig.tsx
index 552e821c0d..0b7916d88f 100644
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/convertRelayPiiConfig.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/convertRelayPiiConfig.tsx
@@ -25,11 +25,18 @@ function convertRelayPiiConfig(relayPiiConfig?: string) {
         //   method: "remove"
         // }
         if (rule[0] === '@') {
-          const [type, method] = rule.slice(1).split(':') as [
-            RuleDefault['type'],
-            RuleDefault['method']
-          ];
-          convertedRules.push({id, method, type, source});
+          const typeAndMethod = rule.slice(1).split(':');
+          let [type] = typeAndMethod;
+          const [, method] = typeAndMethod;
+          if (type === 'urlauth') type = 'url_auth';
+          if (type === 'usssn') type = 'us_ssn';
+
+          convertedRules.push({
+            id,
+            method: method as RuleDefault['method'],
+            type: type as RuleDefault['type'],
+            source,
+          });
         }
         continue;
       }
diff --git a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/types.tsx b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/types.tsx
index d9a05556aa..fd16ee1b9e 100644
--- a/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/types.tsx
+++ b/src/sentry/static/sentry/app/views/settings/components/dataScrubbing/types.tsx
@@ -7,8 +7,8 @@ export enum RuleType {
   EMAIL = 'email',
   UUID = 'uuid',
   PEMKEY = 'pemkey',
-  URLAUTH = 'urlauth',
-  USSSN = 'usssn',
+  URLAUTH = 'url_auth',
+  USSSN = 'us_ssn',
   USER_PATH = 'userpath',
   MAC = 'mac',
   ANYTHING = 'anything',
