commit ea0be2c98a37e4551efc8fa571ed95c26db282fa
Author: Mark Story <mark@sentry.io>
Date:   Fri Jun 7 16:27:46 2019 -0400

    fix(api) Don't 500 on invalid data (#13587)
    
    Our API shouldn't fail when given poorly formatted data.
    
    Fixes SENTRY-AZW

diff --git a/src/sentry/api/endpoints/project_key_stats.py b/src/sentry/api/endpoints/project_key_stats.py
index db8dfeff8e..a27a4c04f5 100644
--- a/src/sentry/api/endpoints/project_key_stats.py
+++ b/src/sentry/api/endpoints/project_key_stats.py
@@ -24,7 +24,10 @@ class ProjectKeyStatsEndpoint(ProjectEndpoint, StatsMixin):
         except ProjectKey.DoesNotExist:
             raise ResourceDoesNotExist
 
-        stat_args = self._parse_args(request)
+        try:
+            stat_args = self._parse_args(request)
+        except ValueError:
+            return Response({'detail': 'Invalid request data'}, status=400)
 
         stats = OrderedDict()
         for model, name in (
diff --git a/tests/sentry/api/endpoints/test_project_key_stats.py b/tests/sentry/api/endpoints/test_project_key_stats.py
index f9d5945bd7..656fb188aa 100644
--- a/tests/sentry/api/endpoints/test_project_key_stats.py
+++ b/tests/sentry/api/endpoints/test_project_key_stats.py
@@ -32,6 +32,11 @@ class ProjectKeyStatsTest(APITestCase):
             assert point['total'] == 0
         assert len(response.data) == 24
 
+    def test_invalid_parameters(self):
+        url = self.path + '?resolution=1x'
+        response = self.client.get(url)
+        assert response.status_code == 400
+
     # This test can be removed once the TSDB metrics that were stored
     # under str(key_id) have expired out of redis.
     def test_str_key_id(self):
