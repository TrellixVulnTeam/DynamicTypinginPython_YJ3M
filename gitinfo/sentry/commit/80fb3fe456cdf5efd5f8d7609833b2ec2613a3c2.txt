commit 80fb3fe456cdf5efd5f8d7609833b2ec2613a3c2
Author: William Mak <william@wmak.io>
Date:   Thu Apr 9 13:59:38 2020 -0400

    fix(perf-views) - Fix 404 on missing feature
    
    - Fixes SENTRY-FXH

diff --git a/src/sentry/discover/endpoints/discover_key_transactions.py b/src/sentry/discover/endpoints/discover_key_transactions.py
index 47e933af04..8d4a66f344 100644
--- a/src/sentry/discover/endpoints/discover_key_transactions.py
+++ b/src/sentry/discover/endpoints/discover_key_transactions.py
@@ -16,7 +16,7 @@ class IsKeyTransactionEndpoint(KeyTransactionBase):
     def get(self, request, organization):
         """ Get the Key Transactions for a user """
         if not self.has_feature(request, organization):
-            return self.response(status=404)
+            return Response(status=404)
 
         project = self.get_project(request, organization)
 
@@ -62,7 +62,7 @@ class KeyTransactionEndpoint(KeyTransactionBase):
     def get(self, request, organization):
         """ Get the Key Transactions for a user """
         if not self.has_feature(request, organization):
-            return self.response(status=404)
+            return Response(status=404)
 
         params = self.get_filter_params(request, organization)
         fields = request.GET.getlist("field")[:]
@@ -89,7 +89,7 @@ class KeyTransactionEndpoint(KeyTransactionBase):
     def delete(self, request, organization):
         """ Remove a Key transaction for a user """
         if not self.has_feature(request, organization):
-            return self.response(status=404)
+            return Response(status=404)
 
         project = self.get_project(request, organization)
         transaction = request.data["transaction"]
@@ -112,7 +112,7 @@ class KeyTransactionStatsEndpoint(KeyTransactionBase):
     def get(self, request, organization):
         """ Get the Key Transactions for a user """
         if not self.has_feature(request, organization):
-            return self.response(status=404)
+            return Response(status=404)
 
         queryset = KeyTransaction.objects.filter(organization=organization, owner=request.user)
 
diff --git a/tests/snuba/api/endpoints/test_discover_key_transactions.py b/tests/snuba/api/endpoints/test_discover_key_transactions.py
index c5a9156443..dc27e73513 100644
--- a/tests/snuba/api/endpoints/test_discover_key_transactions.py
+++ b/tests/snuba/api/endpoints/test_discover_key_transactions.py
@@ -694,3 +694,16 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
             [{"count": 0}],
             [{"count": 0}],
         ]
+
+    def test_key_transactions_without_feature(self):
+        url = reverse("sentry-api-0-organization-key-transactions", args=[self.org.slug])
+        functions = [self.client.get, self.client.post, self.client.delete]
+        for function in functions:
+            response = function(url)
+            assert response.status_code == 404
+        url = reverse("sentry-api-0-organization-is-key-transactions", args=[self.org.slug])
+        response = self.client.get(url)
+        assert response.status_code == 404
+        url = reverse("sentry-api-0-organization-key-transactions-stats", args=[self.org.slug])
+        response = self.client.get(url)
+        assert response.status_code == 404
