commit a400a7b17e42b3b7e1dd0a0b8e9b6b9601f84eb7
Author: Billy Vong <billy@sentry.io>
Date:   Fri May 18 11:21:37 2018 -0700

    feat(avatar): Use round avatars for users
    
    This also refactors `<Gravatar>` to code split MD5 library since it is only ever used for loading gravatars.
    * Fixes transparency issues with avatars, but changes default avatar type to letter (instead of gravatar when emails are used)
    
    Fixes #8047, closes #8243

diff --git a/src/sentry/static/sentry/app/components/avatar/baseAvatar.jsx b/src/sentry/static/sentry/app/components/avatar/baseAvatar.jsx
index 409837b8f3..ee4f432865 100644
--- a/src/sentry/static/sentry/app/components/avatar/baseAvatar.jsx
+++ b/src/sentry/static/sentry/app/components/avatar/baseAvatar.jsx
@@ -1,16 +1,18 @@
-import MD5 from 'crypto-js/md5';
 import PropTypes from 'prop-types';
 import React from 'react';
 import classNames from 'classnames';
 import qs from 'query-string';
 import styled from 'react-emotion';
 
-import ConfigStore from 'app/stores/configStore';
 import LetterAvatar from 'app/components/letterAvatar';
 import Tooltip from 'app/components/tooltip';
 
+import {imageStyle} from './styles';
+import Gravatar from './gravatar';
+
 const DEFAULT_GRAVATAR_SIZE = 64;
 const ALLOWED_SIZES = [20, 32, 36, 48, 52, 64, 80, 96, 120];
+const DEFAULT_REMOTE_SIZE = 120;
 
 class BaseAvatar extends React.Component {
   static propTypes = {
@@ -19,6 +21,9 @@ class BaseAvatar extends React.Component {
      * This is the size of the remote image to request.
      */
     remoteImageSize: PropTypes.oneOf(ALLOWED_SIZES),
+    /**
+     * Default gravatar to display
+     */
     default: PropTypes.string,
     hasTooltip: PropTypes.bool,
     type: PropTypes.string,
@@ -37,6 +42,10 @@ class BaseAvatar extends React.Component {
     title: PropTypes.string,
     tooltip: PropTypes.string,
     tooltipOptions: PropTypes.object,
+    /**
+     * Should avatar be round instead of a square
+     */
+    round: PropTypes.bool,
   };
 
   static defaultProps = {
@@ -48,8 +57,9 @@ class BaseAvatar extends React.Component {
     uploadPath: 'avatar',
   };
 
-  constructor(...args) {
-    super(...args);
+  constructor(props) {
+    super(props);
+
     this.state = {
       showBackupAvatar: false,
       loadError: false,
@@ -68,32 +78,16 @@ class BaseAvatar extends React.Component {
     return remoteImageSize || allowed || DEFAULT_GRAVATAR_SIZE;
   };
 
-  buildGravatarUrl = () => {
-    let {gravatarId} = this.props;
-    let url = ConfigStore.getConfig().gravatarBaseUrl + '/avatar/';
-
-    url += MD5(gravatarId);
-
-    let query = {
-      s: this.getRemoteImageSize() || undefined,
-      d: this.props.default || 'blank',
-    };
-
-    url += '?' + qs.stringify(query);
-
-    return url;
-  };
-
   buildUploadUrl = () => {
     let {uploadPath, uploadId} = this.props;
 
     return `/${uploadPath || 'avatar'}/${uploadId}/?${qs.stringify({
-      s: 120,
+      s: DEFAULT_REMOTE_SIZE,
     })}`;
   };
 
   handleLoad = () => {
-    this.setState({showBackupAvatar: true});
+    this.setState({showBackupAvatar: false});
   };
 
   handleError = () => {
@@ -105,26 +99,35 @@ class BaseAvatar extends React.Component {
       return null;
     }
 
-    let {type} = this.props;
+    let {type, round, gravatarId} = this.props;
 
-    let props = {
+    let eventProps = {
       onError: this.handleError,
       onLoad: this.handleLoad,
     };
+
     if (type === 'gravatar') {
-      return <img src={this.buildGravatarUrl()} {...props} />;
+      return (
+        <Gravatar
+          placeholder={this.props.default}
+          gravatarId={gravatarId}
+          round={round}
+          remoteSize={DEFAULT_REMOTE_SIZE}
+          {...eventProps}
+        />
+      );
     }
 
     if (type === 'upload') {
-      return <img src={this.buildUploadUrl()} {...props} />;
+      return <Image round={round} src={this.buildUploadUrl()} {...eventProps} />;
     }
 
     return this.renderLetterAvatar();
   };
 
   renderLetterAvatar() {
-    let {title, letterId} = this.props;
-    return <LetterAvatar displayName={title} identifier={letterId} />;
+    let {title, letterId, round} = this.props;
+    return <LetterAvatar round={round} displayName={title} identifier={letterId} />;
   }
 
   render() {
@@ -162,3 +165,7 @@ export default BaseAvatar;
 const StyledBaseAvatar = styled('span')`
   flex-shrink: 0;
 `;
+
+const Image = styled('img')`
+  ${imageStyle};
+`;
diff --git a/src/sentry/static/sentry/app/components/avatar/gravatar.jsx b/src/sentry/static/sentry/app/components/avatar/gravatar.jsx
new file mode 100644
index 0000000000..325d9dbcb3
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/avatar/gravatar.jsx
@@ -0,0 +1,76 @@
+import PropTypes from 'prop-types';
+import React from 'react';
+import qs from 'query-string';
+import styled from 'react-emotion';
+
+import ConfigStore from 'app/stores/configStore';
+
+import {imageStyle} from './styles';
+
+class Gravatar extends React.Component {
+  static propTypes = {
+    remoteSize: PropTypes.number,
+    gravatarId: PropTypes.string,
+    placeholder: PropTypes.string,
+    /**
+     * Should avatar be round instead of a square
+     */
+    round: PropTypes.bool,
+  };
+
+  static defaultProps = {};
+
+  constructor(props) {
+    super(props);
+    this.state = {
+      MD5: null,
+    };
+  }
+
+  componentDidMount() {
+    this._isMounted = true;
+
+    import(/*webpackChunkName: MD5*/ 'crypto-js/md5').then(MD5 => {
+      if (!this._isMounted) return;
+      this.setState({MD5});
+    });
+  }
+
+  componentWillUnmount() {
+    // Need to track mounted state because `React.isMounted()` is deprecated and because of
+    // dynamic imports
+    this._isMounted = false;
+  }
+
+  buildGravatarUrl = () => {
+    let {gravatarId, remoteSize, placeholder} = this.props;
+    let url = ConfigStore.getConfig().gravatarBaseUrl + '/avatar/';
+
+    url += this.state.MD5(gravatarId);
+
+    let query = {
+      s: remoteSize || undefined,
+      d: placeholder,
+    };
+
+    url += '?' + qs.stringify(query);
+
+    return url;
+  };
+
+  render() {
+    if (!this.state.MD5) {
+      return null;
+    }
+
+    let {round, ...props} = this.props;
+
+    return <Image round={round} src={this.buildGravatarUrl()} {...props} />;
+  }
+}
+
+export default Gravatar;
+
+const Image = styled('img')`
+  ${imageStyle};
+`;
diff --git a/src/sentry/static/sentry/app/components/avatar/styles.jsx b/src/sentry/static/sentry/app/components/avatar/styles.jsx
new file mode 100644
index 0000000000..1c817706e9
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/avatar/styles.jsx
@@ -0,0 +1,6 @@
+export const imageStyle = props => `
+  position: absolute;
+  top: 0px;
+  left: 0px;
+  border-radius: ${props.round ? '50%' : '3px'};
+`;
diff --git a/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx b/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
index 08be4ba99b..774a28324e 100644
--- a/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
+++ b/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
@@ -14,7 +14,11 @@ class UserAvatar extends React.Component {
   };
 
   static defaultProps = {
-    gravatar: true,
+    // Default gravatar to false in order to support transparent avatars
+    // Avatar falls through to letter avatars if a remote image fails to load,
+    // however gravatar sends back a transparent image when it does not find a gravatar,
+    // so there's little we have to control whether we need to fallback to letter avatar
+    gravatar: false,
   };
 
   getType = (user, gravatar) => {
@@ -49,6 +53,7 @@ class UserAvatar extends React.Component {
             : userDisplayName(user)
         }
         title={user.name || user.email || user.username || ''}
+        round
       />
     );
   }
diff --git a/src/sentry/static/sentry/app/components/letterAvatar.jsx b/src/sentry/static/sentry/app/components/letterAvatar.jsx
index 12407b2e54..e7ce128687 100644
--- a/src/sentry/static/sentry/app/components/letterAvatar.jsx
+++ b/src/sentry/static/sentry/app/components/letterAvatar.jsx
@@ -1,7 +1,9 @@
 import PropTypes from 'prop-types';
 import React from 'react';
-
 import createReactClass from 'create-react-class';
+import styled from 'react-emotion';
+
+import {imageStyle} from 'app/components/avatar/styles';
 
 /**
  * Also see avatar.py. Anything changed in this file (how colors
@@ -14,6 +16,7 @@ const LetterAvatar = createReactClass({
   propTypes: {
     identifier: PropTypes.string.isRequired,
     displayName: PropTypes.string.isRequired,
+    round: PropTypes.bool,
   },
 
   COLORS: [
@@ -53,7 +56,11 @@ const LetterAvatar = createReactClass({
 
   render() {
     return (
-      <svg viewBox="0 0 120 120" className={this.props.className}>
+      <Svg
+        viewBox="0 0 120 120"
+        round={this.props.round}
+        className={this.props.className}
+      >
         <rect
           x="0"
           y="0"
@@ -73,9 +80,13 @@ const LetterAvatar = createReactClass({
         >
           {this.getInitials()}
         </text>
-      </svg>
+      </Svg>
     );
   },
 });
 
 export default LetterAvatar;
+
+const Svg = styled('svg')`
+  ${imageStyle};
+`;
diff --git a/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx b/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
index bca27ce1c6..9af0d51517 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
@@ -106,7 +106,7 @@ export default class OrganizationMemberRow extends React.PureComponent {
     return (
       <PanelItem align="center" p={0} py={2}>
         <Box pl={2}>
-          <Avatar size={32} user={user ? user : {email}} />
+          <Avatar size={32} user={user ? user : {id: email, email}} />
         </Box>
 
         <Box pl={1} pr={2} flex="1">
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index f09716b328..437ca4168d 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -523,14 +523,6 @@ table.integrations {
   vertical-align: middle;
   position: relative;
   display: inline-block;
-
-  svg,
-  img {
-    position: absolute;
-    top: 0px;
-    left: 0px;
-    border-radius: 3px;
-  }
 }
 
 /**
diff --git a/tests/js/spec/components/avatar.spec.jsx b/tests/js/spec/components/avatar.spec.jsx
index 2655d08b51..d30c79d257 100644
--- a/tests/js/spec/components/avatar.spec.jsx
+++ b/tests/js/spec/components/avatar.spec.jsx
@@ -29,7 +29,7 @@ describe('Avatar', function() {
       expect(avatar.find('span.avatar')).toHaveLength(1);
     });
 
-    it('should show a gravatar when avatar type is gravatar', function() {
+    it('should show a gravatar when avatar type is gravatar', async function() {
       let user = Object.assign({}, USER, {
         avatar: {
           avatarType: 'gravatar',
@@ -39,7 +39,12 @@ describe('Avatar', function() {
       let avatar = mount(<Avatar user={user} />);
 
       expect(avatar.find('BaseAvatar').prop('type')).toBe('gravatar');
-      expect(avatar.find('BaseAvatar img').prop('src')).toMatch(
+
+      // Need update because Gravatar async imports a library
+      await tick();
+      avatar.update();
+
+      expect(avatar.find('BaseAvatar Gravatar Image').prop('src')).toMatch(
         'gravatarBaseUrl/avatar/'
       );
     });
@@ -100,15 +105,20 @@ describe('Avatar', function() {
       expect(avatar.find('BaseAvatar').prop('type')).toBe('letter_avatar');
     });
 
-    it('should show a gravatar when no avatar type is set and user has an email address', function() {
+    it('use letter avatar by default, when no avatar type is set and user has an email address', function() {
       let avatar = mount(<Avatar user={USER} />);
+      expect(avatar.find('BaseAvatar').prop('type')).toBe('letter_avatar');
+    });
+
+    it('should show a gravatar when no avatar type is set and user has an email address', function() {
+      let avatar = mount(<Avatar gravatar user={USER} />);
       expect(avatar.find('BaseAvatar').prop('type')).toBe('gravatar');
     });
 
     it('should not show a gravatar when no avatar type is set and user has no email address', function() {
       let user = Object.assign({}, USER);
       delete user.email;
-      let avatar = mount(<Avatar user={user} />);
+      let avatar = mount(<Avatar gravatar user={user} />);
 
       expect(avatar.find('BaseAvatar').prop('type')).toBe('letter_avatar');
     });
diff --git a/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap b/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
index a2719974d6..93ff9916a9 100644
--- a/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
+++ b/tests/js/spec/components/avatar/__snapshots__/avatarList.spec.jsx.snap
@@ -172,7 +172,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -197,11 +197,12 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -228,11 +229,45 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -284,7 +319,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -309,11 +344,12 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -340,11 +376,45 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -396,7 +466,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -421,11 +491,12 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -452,11 +523,45 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -508,7 +613,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -533,11 +638,12 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -564,11 +670,45 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -620,7 +760,7 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -645,11 +785,12 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -676,11 +817,45 @@ exports[`AvatarList renders with collapsed avatar count if > 5 users 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -786,7 +961,7 @@ exports[`AvatarList renders with user avatars 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -811,11 +986,12 @@ exports[`AvatarList renders with user avatars 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -842,11 +1018,45 @@ exports[`AvatarList renders with user avatars 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
@@ -898,7 +1108,7 @@ exports[`AvatarList renders with user avatars 1`] = `
           >
             <UserAvatar
               className="css-ptswrs-StyledAvatar-Circle e1axh4r50"
-              gravatar={true}
+              gravatar={false}
               hasTooltip={true}
               size={28}
               user={
@@ -923,11 +1133,12 @@ exports[`AvatarList renders with user avatars 1`] = `
                 gravatarId="foo@example.com"
                 hasTooltip={true}
                 letterId="foo@example.com"
+                round={true}
                 size={28}
                 style={Object {}}
                 title="Foo Bar"
                 tooltip="Foo Bar (foo@example.com)"
-                type="gravatar"
+                type="letter_avatar"
                 uploadPath="avatar"
               >
                 <Tooltip
@@ -954,11 +1165,45 @@ exports[`AvatarList renders with user avatars 1`] = `
                       }
                       title="Foo Bar (foo@example.com)"
                     >
-                      <img
-                        onError={[Function]}
-                        onLoad={[Function]}
-                        src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                      />
+                      <LetterAvatar
+                        displayName="Foo Bar"
+                        identifier="foo@example.com"
+                        round={true}
+                      >
+                        <Svg
+                          round={true}
+                          viewBox="0 0 120 120"
+                        >
+                          <svg
+                            className="css-1r4mnb9-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
+                          >
+                            <rect
+                              fill="#315cac"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              FB
+                            </text>
+                          </svg>
+                        </Svg>
+                      </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
                 </Tooltip>
diff --git a/tests/js/spec/components/group/__snapshots__/suggestedOwners.spec.jsx.snap b/tests/js/spec/components/group/__snapshots__/suggestedOwners.spec.jsx.snap
index 0173b60d52..1f4dde1bf5 100644
--- a/tests/js/spec/components/group/__snapshots__/suggestedOwners.spec.jsx.snap
+++ b/tests/js/spec/components/group/__snapshots__/suggestedOwners.spec.jsx.snap
@@ -90,7 +90,7 @@ exports[`SuggestedOwners render() should show owners when enable 1`] = `
             >
               <UserAvatar
                 className="tip"
-                gravatar={true}
+                gravatar={false}
                 hasTooltip={false}
                 title="<div><div class=\\"tooltip-owners-name\\">Jane Doe</div><ul class=\\"tooltip-owners-commits\\">Assigned based on your Project&#x27;s Issue Ownership settings</ul><ul class=\\"tooltip-owners-commits\\">path matched: sentry/tagstore/*</ul></div>"
                 user={
@@ -106,10 +106,11 @@ exports[`SuggestedOwners render() should show owners when enable 1`] = `
                   gravatarId="janedoe@example.com"
                   hasTooltip={false}
                   letterId="janedoe@example.com"
+                  round={true}
                   style={Object {}}
                   title="Jane Doe"
                   tooltip="Jane Doe (janedoe@example.com)"
-                  type="gravatar"
+                  type="letter_avatar"
                   uploadPath="avatar"
                 >
                   <Tooltip
@@ -124,11 +125,45 @@ exports[`SuggestedOwners render() should show owners when enable 1`] = `
                         className="avatar tip css-15umz1j-StyledBaseAvatar e1z0ohzl0"
                         style={Object {}}
                       >
-                        <img
-                          onError={[Function]}
-                          onLoad={[Function]}
-                          src="undefined/avatar/e1f3994f2632af3d1c8c2dcc168a10e6?d=blank&s=64"
-                        />
+                        <LetterAvatar
+                          displayName="Jane Doe"
+                          identifier="janedoe@example.com"
+                          round={true}
+                        >
+                          <Svg
+                            round={true}
+                            viewBox="0 0 120 120"
+                          >
+                            <svg
+                              className="css-1r4mnb9-Svg e1knxa8x0"
+                              viewBox="0 0 120 120"
+                            >
+                              <rect
+                                fill="#f868bc"
+                                height="120"
+                                rx="15"
+                                ry="15"
+                                width="120"
+                                x="0"
+                                y="0"
+                              />
+                              <text
+                                fill="#FFFFFF"
+                                fontSize="65"
+                                style={
+                                  Object {
+                                    "dominantBaseline": "central",
+                                  }
+                                }
+                                textAnchor="middle"
+                                x="50%"
+                                y="50%"
+                              >
+                                JD
+                              </text>
+                            </svg>
+                          </Svg>
+                        </LetterAvatar>
                       </span>
                     </StyledBaseAvatar>
                   </Tooltip>
diff --git a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
index e90817be6d..8cfac84a64 100644
--- a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
@@ -303,33 +303,38 @@ exports[`Sidebar SidebarDropdown can open Sidebar org/name dropdown menu 1`] = `
                         displayName="org slug"
                         identifier="org-slug"
                       >
-                        <svg
+                        <Svg
                           viewBox="0 0 120 120"
                         >
-                          <rect
-                            fill="#4674ca"
-                            height="120"
-                            rx="15"
-                            ry="15"
-                            width="120"
-                            x="0"
-                            y="0"
-                          />
-                          <text
-                            fill="#FFFFFF"
-                            fontSize="65"
-                            style={
-                              Object {
-                                "dominantBaseline": "central",
-                              }
-                            }
-                            textAnchor="middle"
-                            x="50%"
-                            y="50%"
+                          <svg
+                            className="css-123ijso-Svg e1knxa8x0"
+                            viewBox="0 0 120 120"
                           >
-                            OS
-                          </text>
-                        </svg>
+                            <rect
+                              fill="#4674ca"
+                              height="120"
+                              rx="15"
+                              ry="15"
+                              width="120"
+                              x="0"
+                              y="0"
+                            />
+                            <text
+                              fill="#FFFFFF"
+                              fontSize="65"
+                              style={
+                                Object {
+                                  "dominantBaseline": "central",
+                                }
+                              }
+                              textAnchor="middle"
+                              x="50%"
+                              y="50%"
+                            >
+                              OS
+                            </text>
+                          </svg>
+                        </Svg>
                       </LetterAvatar>
                     </span>
                   </StyledBaseAvatar>
@@ -692,7 +697,7 @@ exports[`Sidebar SidebarDropdown can open Sidebar org/name dropdown menu 1`] = `
                               >
                                 <UserAvatar
                                   className="css-1u6j7yz-StyledAvatar ev46mzr4"
-                                  gravatar={true}
+                                  gravatar={false}
                                   hasTooltip={false}
                                   size={32}
                                   user={
@@ -718,11 +723,12 @@ exports[`Sidebar SidebarDropdown can open Sidebar org/name dropdown menu 1`] = `
                                     gravatarId="foo@example.com"
                                     hasTooltip={false}
                                     letterId="foo@example.com"
+                                    round={true}
                                     size={32}
                                     style={Object {}}
                                     title="Foo Bar"
                                     tooltip="Foo Bar (foo@example.com)"
-                                    type="gravatar"
+                                    type="letter_avatar"
                                     uploadPath="avatar"
                                   >
                                     <Tooltip
@@ -747,11 +753,45 @@ exports[`Sidebar SidebarDropdown can open Sidebar org/name dropdown menu 1`] = `
                                             }
                                           }
                                         >
-                                          <img
-                                            onError={[Function]}
-                                            onLoad={[Function]}
-                                            src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                                          />
+                                          <LetterAvatar
+                                            displayName="Foo Bar"
+                                            identifier="foo@example.com"
+                                            round={true}
+                                          >
+                                            <Svg
+                                              round={true}
+                                              viewBox="0 0 120 120"
+                                            >
+                                              <svg
+                                                className="css-1r4mnb9-Svg e1knxa8x0"
+                                                viewBox="0 0 120 120"
+                                              >
+                                                <rect
+                                                  fill="#315cac"
+                                                  height="120"
+                                                  rx="15"
+                                                  ry="15"
+                                                  width="120"
+                                                  x="0"
+                                                  y="0"
+                                                />
+                                                <text
+                                                  fill="#FFFFFF"
+                                                  fontSize="65"
+                                                  style={
+                                                    Object {
+                                                      "dominantBaseline": "central",
+                                                    }
+                                                  }
+                                                  textAnchor="middle"
+                                                  x="50%"
+                                                  y="50%"
+                                                >
+                                                  FB
+                                                </text>
+                                              </svg>
+                                            </Svg>
+                                          </LetterAvatar>
                                         </span>
                                       </StyledBaseAvatar>
                                     </Tooltip>
@@ -1710,7 +1750,7 @@ exports[`Sidebar renders without org and router 1`] = `
                               >
                                 <UserAvatar
                                   className="css-1u6j7yz-StyledAvatar ev46mzr4"
-                                  gravatar={true}
+                                  gravatar={false}
                                   hasTooltip={false}
                                   size={32}
                                   user={
@@ -1736,11 +1776,12 @@ exports[`Sidebar renders without org and router 1`] = `
                                     gravatarId="foo@example.com"
                                     hasTooltip={false}
                                     letterId="foo@example.com"
+                                    round={true}
                                     size={32}
                                     style={Object {}}
                                     title="Foo Bar"
                                     tooltip="Foo Bar (foo@example.com)"
-                                    type="gravatar"
+                                    type="letter_avatar"
                                     uploadPath="avatar"
                                   >
                                     <Tooltip
@@ -1765,11 +1806,45 @@ exports[`Sidebar renders without org and router 1`] = `
                                             }
                                           }
                                         >
-                                          <img
-                                            onError={[Function]}
-                                            onLoad={[Function]}
-                                            src="undefined/avatar/b48def645758b95537d4424c84d1a9ff?d=blank&s=32"
-                                          />
+                                          <LetterAvatar
+                                            displayName="Foo Bar"
+                                            identifier="foo@example.com"
+                                            round={true}
+                                          >
+                                            <Svg
+                                              round={true}
+                                              viewBox="0 0 120 120"
+                                            >
+                                              <svg
+                                                className="css-1r4mnb9-Svg e1knxa8x0"
+                                                viewBox="0 0 120 120"
+                                              >
+                                                <rect
+                                                  fill="#315cac"
+                                                  height="120"
+                                                  rx="15"
+                                                  ry="15"
+                                                  width="120"
+                                                  x="0"
+                                                  y="0"
+                                                />
+                                                <text
+                                                  fill="#FFFFFF"
+                                                  fontSize="65"
+                                                  style={
+                                                    Object {
+                                                      "dominantBaseline": "central",
+                                                    }
+                                                  }
+                                                  textAnchor="middle"
+                                                  x="50%"
+                                                  y="50%"
+                                                >
+                                                  FB
+                                                </text>
+                                              </svg>
+                                            </Svg>
+                                          </LetterAvatar>
                                         </span>
                                       </StyledBaseAvatar>
                                     </Tooltip>
diff --git a/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap b/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
index 823cadbcd8..be131a4e51 100644
--- a/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/ruleBuilder.spec.jsx.snap
@@ -2299,7 +2299,7 @@ exports[`RuleBuilder renders with suggestions 1`] = `
                                         }
                                       >
                                         <UserAvatar
-                                          gravatar={true}
+                                          gravatar={false}
                                           hasTooltip={true}
                                           size={28}
                                           user={
@@ -2328,11 +2328,12 @@ exports[`RuleBuilder renders with suggestions 1`] = `
                                             gravatarId="janedoe@example.com"
                                             hasTooltip={true}
                                             letterId="janedoe@example.com"
+                                            round={true}
                                             size={28}
                                             style={Object {}}
                                             title="Jane Doe"
                                             tooltip="Jane Doe (janedoe@example.com)"
-                                            type="gravatar"
+                                            type="letter_avatar"
                                             uploadPath="avatar"
                                           >
                                             <Tooltip
@@ -2359,11 +2360,45 @@ exports[`RuleBuilder renders with suggestions 1`] = `
                                                   }
                                                   title="Jane Doe (janedoe@example.com)"
                                                 >
-                                                  <img
-                                                    onError={[Function]}
-                                                    onLoad={[Function]}
-                                                    src="undefined/avatar/e1f3994f2632af3d1c8c2dcc168a10e6?d=blank&s=32"
-                                                  />
+                                                  <LetterAvatar
+                                                    displayName="Jane Doe"
+                                                    identifier="janedoe@example.com"
+                                                    round={true}
+                                                  >
+                                                    <Svg
+                                                      round={true}
+                                                      viewBox="0 0 120 120"
+                                                    >
+                                                      <svg
+                                                        className="css-1r4mnb9-Svg e1knxa8x0"
+                                                        viewBox="0 0 120 120"
+                                                      >
+                                                        <rect
+                                                          fill="#f868bc"
+                                                          height="120"
+                                                          rx="15"
+                                                          ry="15"
+                                                          width="120"
+                                                          x="0"
+                                                          y="0"
+                                                        />
+                                                        <text
+                                                          fill="#FFFFFF"
+                                                          fontSize="65"
+                                                          style={
+                                                            Object {
+                                                              "dominantBaseline": "central",
+                                                            }
+                                                          }
+                                                          textAnchor="middle"
+                                                          x="50%"
+                                                          y="50%"
+                                                        >
+                                                          JD
+                                                        </text>
+                                                      </svg>
+                                                    </Svg>
+                                                  </LetterAvatar>
                                                 </span>
                                               </StyledBaseAvatar>
                                             </Tooltip>
