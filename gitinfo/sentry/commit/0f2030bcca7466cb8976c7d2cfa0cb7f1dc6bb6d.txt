commit 0f2030bcca7466cb8976c7d2cfa0cb7f1dc6bb6d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 25 08:54:33 2016 -0800

    Limit notification settings to membership

diff --git a/src/sentry/web/frontend/accounts.py b/src/sentry/web/frontend/accounts.py
index 9293005e28..446055e86e 100644
--- a/src/sentry/web/frontend/accounts.py
+++ b/src/sentry/web/frontend/accounts.py
@@ -20,7 +20,7 @@ from django.utils import timezone
 from sudo.decorators import sudo_required
 
 from sentry.models import (
-    LostPasswordHash, Organization, Project, Team, UserOption
+    LostPasswordHash, Project, UserOption
 )
 from sentry.plugins import plugins
 from sentry.web.decorators import login_required
@@ -175,24 +175,9 @@ def appearance_settings(request):
 def notification_settings(request):
     settings_form = NotificationSettingsForm(request.user, request.POST or None)
 
-    # TODO(dcramer): this is an extremely bad pattern and we need a more optimal
-    # solution for rendering this (that ideally plays well with the org data)
-    project_list = []
-    organization_list = Organization.objects.get_for_user(
-        user=request.user,
-    )
-    for organization in organization_list:
-        team_list = Team.objects.get_for_user(
-            user=request.user,
-            organization=organization,
-        )
-        for team in team_list:
-            project_list.extend(
-                Project.objects.get_for_user(
-                    user=request.user,
-                    team=team,
-                )
-            )
+    project_list = list(Project.objects.filter(
+        team__organizationmemberteam__is_active=True,
+    ).distinct())
 
     project_forms = [
         (project, ProjectEmailOptionsForm(
