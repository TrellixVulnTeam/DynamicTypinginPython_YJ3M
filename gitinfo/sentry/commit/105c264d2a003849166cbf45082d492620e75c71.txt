commit 105c264d2a003849166cbf45082d492620e75c71
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Sun Feb 3 18:24:15 2013 -0800

    Sourcemaps allow a prefix to thwart XSSI attacks
    
    See:
    https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6f
    AH0KY0k/edit#heading=h.h7yy76c5il9v

diff --git a/src/sentry/tasks/fetch_source.py b/src/sentry/tasks/fetch_source.py
index db33952917..6f132d0b0e 100644
--- a/src/sentry/tasks/fetch_source.py
+++ b/src/sentry/tasks/fetch_source.py
@@ -185,7 +185,13 @@ def fetch_javascript_source(event, **kwargs):
             if result == BAD_SOURCE:
                 continue
 
-            index = sourcemap_to_index(result.body)
+            body = result.body
+            # According to spec (https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit#heading=h.h7yy76c5il9v)
+            # A SouceMap may be prepended with ")]}'" to cause a Javascript error.
+            # If the file starts with that string, ignore the entire first line.
+            if body.startswith(")]}'"):
+                body = body.split('\n', 1)[1]
+            index = sourcemap_to_index(body)
             sourcemaps[sourcemap] = index
 
             # queue up additional source files for download
