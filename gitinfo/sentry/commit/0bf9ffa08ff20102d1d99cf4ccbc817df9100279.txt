commit 0bf9ffa08ff20102d1d99cf4ccbc817df9100279
Author: Danny Lee <dlee@sentry.io>
Date:   Fri May 29 11:12:10 2020 -0700

    ref(ts): Convert versionHoverCard (#19072)

diff --git a/src/sentry/static/sentry/app/components/events/eventTags/eventTagsPill.tsx b/src/sentry/static/sentry/app/components/events/eventTags/eventTagsPill.tsx
index a0ac30cb1a..56cf1219df 100644
--- a/src/sentry/static/sentry/app/components/events/eventTags/eventTagsPill.tsx
+++ b/src/sentry/static/sentry/app/components/events/eventTags/eventTagsPill.tsx
@@ -56,21 +56,22 @@ const EventTagsPill = ({
         </a>
       )}
       {isRelease && (
-        <VersionHoverCard
-          containerClassName="pill-icon"
-          version={tag.value}
-          orgId={orgId}
-          projectId={projectId}
-        >
-          <Link
-            to={{
-              pathname: `${releasesPath}${tag.value}/`,
-              search: locationSearch,
-            }}
+        <div className="pill-icon">
+          <VersionHoverCard
+            orgSlug={orgId}
+            projectSlug={projectId}
+            releaseVersion={tag.value}
           >
-            <InlineSvg src="icon-circle-info" size="14px" />
-          </Link>
-        </VersionHoverCard>
+            <Link
+              to={{
+                pathname: `${releasesPath}${tag.value}/`,
+                search: locationSearch,
+              }}
+            >
+              <InlineSvg src="icon-circle-info" size="14px" />
+            </Link>
+          </VersionHoverCard>
+        </div>
       )}
     </Pill>
   );
diff --git a/src/sentry/static/sentry/app/components/group/seenInfo.jsx b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
index b90ca4c989..7f109fb743 100644
--- a/src/sentry/static/sentry/app/components/group/seenInfo.jsx
+++ b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
@@ -105,9 +105,9 @@ class SeenInfo extends React.Component {
         {defined(release) ? (
           <dd key={5}>
             <VersionHoverCard
-              orgId={orgSlug}
-              projectId={projectSlug}
-              version={release.version}
+              orgSlug={orgSlug}
+              projectSlug={projectSlug}
+              releaseVersion={release.version}
             >
               <Version version={release.version} truncate projectId={projectId} />
             </VersionHoverCard>
diff --git a/src/sentry/static/sentry/app/components/versionHoverCard.jsx b/src/sentry/static/sentry/app/components/versionHoverCard.tsx
similarity index 80%
rename from src/sentry/static/sentry/app/components/versionHoverCard.jsx
rename to src/sentry/static/sentry/app/components/versionHoverCard.tsx
index d59cdf5b75..f33c3ec591 100644
--- a/src/sentry/static/sentry/app/components/versionHoverCard.jsx
+++ b/src/sentry/static/sentry/app/components/versionHoverCard.tsx
@@ -1,4 +1,3 @@
-import PropTypes from 'prop-types';
 import React from 'react';
 import styled from '@emotion/styled';
 
@@ -16,16 +15,27 @@ import withApi from 'app/utils/withApi';
 import Clipboard from 'app/components/clipboard';
 import {IconCopy} from 'app/icons';
 import Version from 'app/components/version';
+import {Client} from 'app/api';
+import {Release, Deploy} from 'app/types';
 
-class VersionHoverCard extends React.Component {
-  static propTypes = {
-    api: PropTypes.object,
-    version: PropTypes.string.isRequired,
-    orgId: PropTypes.string.isRequired,
-    projectId: PropTypes.string.isRequired,
-  };
+type Props = {
+  api: Client;
+  orgSlug: string;
+  projectSlug: string;
+  releaseVersion: string;
+};
+type State = {
+  loading: boolean;
+  error: boolean;
+  data: {};
+  visible: boolean;
+  hasRepos: boolean;
+  deploys: Deploy[];
+  release: Release | null;
+};
 
-  state = {
+class VersionHoverCard extends React.Component<Props, State> {
+  state: State = {
     loading: true,
     error: false,
     data: {},
@@ -40,24 +50,24 @@ class VersionHoverCard extends React.Component {
   }
 
   async fetchData() {
-    const {api, orgId, projectId, version} = this.props;
+    const {api, orgSlug, projectSlug, releaseVersion} = this.props;
 
     // releases
-    const releasePath = `/projects/${orgId}/${projectId}/releases/${encodeURIComponent(
-      version
+    const releasePath = `/projects/${orgSlug}/${projectSlug}/releases/${encodeURIComponent(
+      releaseVersion
     )}/`;
     const releaseRequest = api.requestPromise(releasePath, {
       method: 'GET',
     });
 
     // repos
-    const repoRequest = api.requestPromise(`/organizations/${orgId}/repos/`, {
+    const repoRequest = api.requestPromise(`/organizations/${orgSlug}/repos/`, {
       method: 'GET',
     });
 
     //deploys
-    const deployPath = `/organizations/${orgId}/releases/${encodeURIComponent(
-      version
+    const deployPath = `/organizations/${orgSlug}/releases/${encodeURIComponent(
+      releaseVersion
     )}/deploys/`;
     const deployRequest = api.requestPromise(deployPath, {
       method: 'GET',
@@ -87,8 +97,9 @@ class VersionHoverCard extends React.Component {
   }
 
   getRepoLink() {
-    const {orgId} = this.props;
+    const {orgSlug} = this.props;
     return {
+      header: null,
       body: (
         <ConnectRepo>
           <h5>{t('Releases are better with commit data!')}</h5>
@@ -97,7 +108,7 @@ class VersionHoverCard extends React.Component {
               'Connect a repository to see commit info, files changed, and authors involved in future releases.'
             )}
           </p>
-          <Button href={`/organizations/${orgId}/repos/`} priority="primary">
+          <Button href={`/organizations/${orgSlug}/repos/`} priority="primary">
             {t('Connect a repository')}
           </Button>
         </ConnectRepo>
@@ -106,10 +117,13 @@ class VersionHoverCard extends React.Component {
   }
 
   getBody() {
+    const {releaseVersion} = this.props;
     const {release, deploys} = this.state;
-    const {version} = this.props;
-    const lastCommit = release.lastCommit;
+    if (!release) {
+      return {header: null, body: null};
+    }
 
+    const {lastCommit} = release;
     const recentDeploysByEnvironment = deploys.reduce(function(dbe, deploy) {
       const {dateFinished, environment} = deploy;
       if (!dbe.hasOwnProperty(environment)) {
@@ -119,17 +133,19 @@ class VersionHoverCard extends React.Component {
       return dbe;
     }, {});
     let mostRecentDeploySlice = Object.keys(recentDeploysByEnvironment);
+
     if (Object.keys(recentDeploysByEnvironment).length > 3) {
       mostRecentDeploySlice = Object.keys(recentDeploysByEnvironment).slice(0, 3);
     }
+
     return {
       header: (
         <HeaderWrapper>
           {t('Release')}
           <VersionWrapper>
-            <StyledVersion version={version} truncate anchor={false} />
+            <StyledVersion version={releaseVersion} truncate anchor={false} />
 
-            <Clipboard value={version}>
+            <Clipboard value={releaseVersion}>
               <ClipboardIconWrapper>
                 <IconCopy size="xs" />
               </ClipboardIconWrapper>
@@ -154,7 +170,7 @@ class VersionHoverCard extends React.Component {
               <AvatarList
                 users={release.authors}
                 avatarSize={25}
-                tooltipOptions={{container: 'body'}}
+                tooltipOptions={{container: 'body'} as any}
                 typeMembers="authors"
               />
             </div>
@@ -185,14 +201,16 @@ class VersionHoverCard extends React.Component {
 
   render() {
     const {loading, error, hasRepos, release} = this.state;
-    let header = null;
-    let body = null;
+    let header: React.ReactNode = null;
+    let body: React.ReactNode = null;
+
     if (loading) {
       body = <LoadingIndicator mini />;
     } else if (error) {
       body = <LoadingError />;
     } else {
-      const renderObj = hasRepos && release ? this.getBody() : this.getRepoLink();
+      const renderObj: {[key: string]: React.ReactNode} =
+        hasRepos && release ? this.getBody() : this.getRepoLink();
       header = renderObj.header;
       body = renderObj.body;
     }
diff --git a/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.tsx b/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.tsx
index 82a1143f66..6c7486e114 100644
--- a/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.tsx
+++ b/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.tsx
@@ -70,7 +70,11 @@ class ActivityItem extends React.Component<Props, State> {
     ) : null;
 
     const versionLink = data.version ? (
-      <VersionHoverCard orgId={orgId} projectId={project.slug} version={data.version}>
+      <VersionHoverCard
+        orgSlug={orgId}
+        projectSlug={project.slug}
+        releaseVersion={data.version}
+      >
         <Version version={data.version} projectId={project.id} />
       </VersionHoverCard>
     ) : null;
