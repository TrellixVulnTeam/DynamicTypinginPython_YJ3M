commit 07da0859ce1fcc2b217cafb146bbb06e78df2e30
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Oct 10 10:50:50 2019 -0700

    test: Do not test legacy models (#15013)

diff --git a/tests/sentry/db/test_parse_query.py b/tests/sentry/db/test_parse_query.py
index e310b4bbcd..8bc064f029 100644
--- a/tests/sentry/db/test_parse_query.py
+++ b/tests/sentry/db/test_parse_query.py
@@ -74,108 +74,8 @@ class ParseQuery(TestCase):
                     u"time": u"0.000",
                 },
                 {u"sql": u'RELEASE SAVEPOINT "s47890194282880_x52"', u"time": u"0.000"},
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'level\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'error\'  AND "sentry_filtervalue"."key" = \'level\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'url\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'http://example.com\'  AND "sentry_filtervalue"."key" = \'url\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'sentry:user\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'ip:127.0.0.1\'  AND "sentry_filtervalue"."key" = \'sentry:user\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'os.name\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Windows 8\'  AND "sentry_filtervalue"."key" = \'os.name\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'browser.name\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Chrome\'  AND "sentry_filtervalue"."key" = \'browser.name\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filterkey"."id", "sentry_filterkey"."project_id", "sentry_filterkey"."key", "sentry_filterkey"."values_seen", "sentry_filterkey"."label", "sentry_filterkey"."status" FROM "sentry_filterkey" WHERE ("sentry_filterkey"."project_id" = 864  AND "sentry_filterkey"."key" = \'browser\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'SELECT "sentry_filtervalue"."id", "sentry_filtervalue"."project_id", "sentry_filtervalue"."key", "sentry_filtervalue"."value", "sentry_filtervalue"."data", "sentry_filtervalue"."times_seen", "sentry_filtervalue"."last_seen", "sentry_filtervalue"."first_seen" FROM "sentry_filtervalue" WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Chrome 28.0.1500\'  AND "sentry_filtervalue"."key" = \'browser\' )',
-                    u"time": u"0.000",
-                },
                 {u"sql": u'SAVEPOINT "s47890194282880_x54"', u"time": u"0.000"},
-                {
-                    u"sql": u'INSERT INTO "sentry_eventtag" ("project_id", "group_id", "event_id", "key_id", "value_id", "date_added") VALUES (864, 662, 454, 108, 108, \'2018-05-22 09:12:12+00:00\'), (864, 662, 454, 109, 109, \'2018-05-22 09:12:12+00:00\'), (864, 662, 454, 110, 110, \'2018-05-22 09:12:12+00:00\'), (864, 662, 454, 111, 111, \'2018-05-22 09:12:12+00:00\'), (864, 662, 454, 112, 112, \'2018-05-22 09:12:12+00:00\'), (864, 662, 454, 113, 113, \'2018-05-22 09:12:12+00:00\')',
-                    u"time": u"0.000",
-                },
                 {u"sql": u'RELEASE SAVEPOINT "s47890194282880_x54"', u"time": u"0.000"},
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'error\'  AND "sentry_filtervalue"."key" = \'level\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'error\'  AND "sentry_messagefiltervalue"."key" = \'level\' )',
-                    u"time": u"0.000",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'http://example.com\'  AND "sentry_filtervalue"."key" = \'url\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'http://example.com\'  AND "sentry_messagefiltervalue"."key" = \'url\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'ip:127.0.0.1\'  AND "sentry_filtervalue"."key" = \'sentry:user\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'ip:127.0.0.1\'  AND "sentry_messagefiltervalue"."key" = \'sentry:user\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Windows 8\'  AND "sentry_filtervalue"."key" = \'os.name\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'Windows 8\'  AND "sentry_messagefiltervalue"."key" = \'os.name\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Chrome\'  AND "sentry_filtervalue"."key" = \'browser.name\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'Chrome\'  AND "sentry_messagefiltervalue"."key" = \'browser.name\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_filtervalue" SET "times_seen" = "sentry_filtervalue"."times_seen" + 1, "data" = NULL, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_filtervalue"."project_id" = 864  AND "sentry_filtervalue"."value" = \'Chrome 28.0.1500\'  AND "sentry_filtervalue"."key" = \'browser\' )',
-                    u"time": u"0.001",
-                },
-                {
-                    u"sql": u'UPDATE "sentry_messagefiltervalue" SET "times_seen" = "sentry_messagefiltervalue"."times_seen" + 1, "project_id" = 864, "last_seen" = \'2018-05-22 09:12:12+00:00\' WHERE ("sentry_messagefiltervalue"."group_id" = 662  AND "sentry_messagefiltervalue"."value" = \'Chrome 28.0.1500\'  AND "sentry_messagefiltervalue"."key" = \'browser\' )',
-                    u"time": u"0.001",
-                },
                 {
                     u"sql": u'SELECT "sentry_groupedmessage"."id", "sentry_groupedmessage"."project_id", "sentry_groupedmessage"."logger", "sentry_groupedmessage"."level", "sentry_groupedmessage"."message", "sentry_groupedmessage"."view", "sentry_groupedmessage"."num_comments", "sentry_groupedmessage"."platform", "sentry_groupedmessage"."status", "sentry_groupedmessage"."times_seen", "sentry_groupedmessage"."last_seen", "sentry_groupedmessage"."first_seen", "sentry_groupedmessage"."first_release_id", "sentry_groupedmessage"."resolved_at", "sentry_groupedmessage"."active_at", "sentry_groupedmessage"."time_spent_total", "sentry_groupedmessage"."time_spent_count", "sentry_groupedmessage"."score", "sentry_groupedmessage"."is_public", "sentry_groupedmessage"."data", "sentry_groupedmessage"."short_id" FROM "sentry_groupedmessage" WHERE "sentry_groupedmessage"."id" = 662 ',
                     u"time": u"0.001",
@@ -196,11 +96,8 @@ class ParseQuery(TestCase):
         assert result == {
             "nodestore_node": 2,
             "sentry_environmentproject": 1,
-            "sentry_eventtag": 1,
             "sentry_eventuser": 1,
-            "sentry_filtervalue": 6,
             "sentry_groupedmessage": 1,
             "sentry_message": 1,
-            "sentry_messagefiltervalue": 6,
             "sentry_userreport": 1,
         }
