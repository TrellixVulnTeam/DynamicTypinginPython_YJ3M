commit 6b8ef44f0d7f75abc05ff2d0d405620066c4f34b
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 12 15:59:24 2013 -0800

    Tweak weighting so its more sensible based on two hour history

diff --git a/src/sentry/tasks/check_alerts.py b/src/sentry/tasks/check_alerts.py
index f39319330c..f94e89fc4c 100644
--- a/src/sentry/tasks/check_alerts.py
+++ b/src/sentry/tasks/check_alerts.py
@@ -38,6 +38,7 @@ from celery.task import periodic_task, task
 from celery.task.schedules import crontab
 from django.utils import timezone
 
+
 def fsteps(start, stop, steps):
     step = (stop - start) / steps
     while start <= stop:
@@ -88,10 +89,9 @@ def check_project_alerts(project_id, name, when, count, **kwargs):
         return False
 
     # take a weighted mean, where the oldest value is worth .5 and the newest is 1.0
-    previous = sum((k * v) for k, v in zip(data, fsteps(0.5, 1.0, intervals))) / intervals / MINUTE_NORMALIZATION
-    threshold = 300  # 200 percent
+    previous = sum((k * v) for k, v in zip(data, fsteps(0.7, 1.0, intervals))) / intervals / MINUTE_NORMALIZATION
+    threshold = 300
     if count / previous * 100 > threshold:
         # we could raise an alert here!
         return True
     return False
-
diff --git a/tests/sentry/tasks/check_alerts/tests.py b/tests/sentry/tasks/check_alerts/tests.py
index 66dfab62a9..5105dcc61b 100644
--- a/tests/sentry/tasks/check_alerts/tests.py
+++ b/tests/sentry/tasks/check_alerts/tests.py
@@ -33,7 +33,7 @@ class CheckProjectAlertsTest(TestCase):
             project_id=self.project.id,
             name='total',
             when=now,
-            count=15
+            count=20
         )
         assert can_alert is False
 
@@ -42,6 +42,6 @@ class CheckProjectAlertsTest(TestCase):
             project_id=self.project.id,
             name='total',
             when=now,
-            count=15
+            count=20
         )
         assert can_alert is True
