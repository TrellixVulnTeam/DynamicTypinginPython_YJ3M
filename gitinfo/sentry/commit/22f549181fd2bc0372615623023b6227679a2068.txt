commit 22f549181fd2bc0372615623023b6227679a2068
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 4 00:08:30 2012 -0700

    Dont enforce primary key on default project (seems to correct Postgres sequence behavior)

diff --git a/sentry/models.py b/sentry/models.py
index 321d2ed3d5..272de9365a 100644
--- a/sentry/models.py
+++ b/sentry/models.py
@@ -212,6 +212,9 @@ class Project(Model):
             fv.delete()
         self.delete()
 
+    def is_default_project(self):
+        return str(self.id) == str(settings.PROJECT) or str(self.slug) == str(settings.PROJECT)
+
 
 class ProjectKey(Model):
     project = models.ForeignKey(Project, related_name='key_set')
@@ -716,17 +719,15 @@ def create_default_project(created_models, verbosity=2, **kwargs):
         except IndexError:
             owner = None
 
-        project, created = Project.objects.get_or_create(
-            id=1,
-            defaults=dict(
-                public=True,
-                name='Default',
-                owner=owner,
-            )
-        )
-        if not created:
+        if Project.objects.exists():
             return
 
+        project = Project.objects.create(
+            public=True,
+            name='Default',
+            owner=owner,
+        )
+
         if verbosity > 0:
             print 'Created default Sentry project owned by %s' % owner
 
diff --git a/sentry/templates/sentry/projects/manage.html b/sentry/templates/sentry/projects/manage.html
index cef4b73858..e7eb82ea27 100644
--- a/sentry/templates/sentry/projects/manage.html
+++ b/sentry/templates/sentry/projects/manage.html
@@ -72,7 +72,7 @@
                 </fieldset>
                 <div class="form-actions">
                     <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
-                    {% if PROJECT_ID != project.pk %}
+                    {% if not project.is_default_project %}
                         <a href="{% url sentry-remove-project project.slug %}" class="btn btn-danger">{% trans "Remove Project" %}</a>
                     {% else %}
                         <a href="#" class="btn disabled btn-danger">{% trans "Cannot remove default project" %}</a>
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 5f8e56f1b0..b6da31e3fc 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -56,7 +56,7 @@ def new_project(request):
 @has_access(MEMBER_OWNER)
 @csrf_protect
 def remove_project(request, project):
-    if str(project.id) == str(settings.PROJECT):
+    if project.is_default_project():
         return HttpResponseRedirect(reverse('sentry-project-list'))
 
     if not can_remove_project(request.user, project):
diff --git a/sentry/web/helpers.py b/sentry/web/helpers.py
index 797cfde52a..b2f2fed750 100644
--- a/sentry/web/helpers.py
+++ b/sentry/web/helpers.py
@@ -104,7 +104,7 @@ def get_default_context(request, existing_context=None):
     context = {
         'HAS_SEARCH': settings.USE_SEARCH,
         'MESSAGES_PER_PAGE': settings.MESSAGES_PER_PAGE,
-        'PROJECT_ID': int(settings.PROJECT),
+        'PROJECT_ID': str(settings.PROJECT),
         'VIEWS': list(View.objects.all()),
         'URL_PREFIX': settings.URL_PREFIX,
         'PLUGINS': plugins,
