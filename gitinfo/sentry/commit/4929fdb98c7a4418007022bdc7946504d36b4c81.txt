commit 4929fdb98c7a4418007022bdc7946504d36b4c81
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Thu Oct 15 00:17:18 2015 +0200

    Send notifications from a celery task.

diff --git a/src/sentry/models/activity.py b/src/sentry/models/activity.py
index 2fa1800544..96eb270c98 100644
--- a/src/sentry/models/activity.py
+++ b/src/sentry/models/activity.py
@@ -19,6 +19,7 @@ from sentry.db.models import (
 )
 from sentry.utils.http import absolute_uri
 from sentry.utils.safe import safe_execute
+from sentry.tasks.base import instrumented_task
 
 
 def get_activity_notifiers(project):
@@ -37,6 +38,18 @@ def get_activity_notifiers(project):
     return results
 
 
+@instrumented_task(
+    name='sentry.models.activity.send_activity_notifications')
+def send_activity_notifications(activity_id):
+    try:
+        activity = Activity.objects.get(pk=activity_id)
+    except Activity.DoesNotExist:
+        return
+
+    for notifier in get_activity_notifiers(activity.project):
+        notifier.notify_about_activity(activity)
+
+
 class Activity(Model):
     __core__ = False
 
@@ -225,5 +238,4 @@ class Activity(Model):
         msg.add_users(send_to, project=self.project)
         msg.send_async()
 
-        for notifier in get_activity_notifiers(self.project):
-            notifier.notify_about_activity(self)
+        send_activity_notifications.delay(self.id)
