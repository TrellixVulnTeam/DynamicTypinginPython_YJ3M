commit 7172816b927fbec778c86872023a6dc36b1e07bc
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Feb 1 12:55:38 2015 -0800

    Support enabling/disabling project keys (fixes GH-1356)

diff --git a/src/sentry/templates/sentry/projects/keys.html b/src/sentry/templates/sentry/projects/keys.html
index c8ab4f27af..a297175e30 100644
--- a/src/sentry/templates/sentry/projects/keys.html
+++ b/src/sentry/templates/sentry/projects/keys.html
@@ -18,7 +18,7 @@
     <table class="table table-bordered table-striped">
         <colgroup>
             <col/>
-            <col width="100px"/>
+            <col width="200px"/>
         </colgroup>
         <thead>
             <tr>
@@ -41,13 +41,24 @@
                         {% endif %}
                     </td>
                     <td style="text-align:center; vertical-align:middle;">
+                        {% if key.can_edit %}
+                            {% if key.is_active %}
+                                <form method="POST" action="{% url 'sentry-disable-project-key' project.organization.slug project.slug key.id %}" style="display:inline">
+                                    {% csrf_token %}
+                                    <input type="submit" class="btn btn-primary btn-small" value="{% trans "Disable" %}">
+                                </form>
+                            {% else %}
+                                <form method="POST" action="{% url 'sentry-enable-project-key' project.organization.slug project.slug key.id %}" style="display:inline">
+                                    {% csrf_token %}
+                                    <input type="submit" class="btn btn-primary btn-small" value="{% trans "Enable" %}">
+                                </form>
+                            {% endif %}
+                        {% endif %}
                         {% if key.can_remove %}
                             <form method="POST" action="{% url 'sentry-remove-project-key' project.organization.slug project.slug key.id %}" style="display:inline">
                                 {% csrf_token %}
                                 <input type="submit" class="btn btn-danger btn-small" value="{% trans "Revoke" %}">
                             </form>
-                        {% else %}
-                            &mdash;
                         {% endif %}
                     </td>
                 </tr>
diff --git a/src/sentry/web/frontend/projects/keys.py b/src/sentry/web/frontend/projects/keys.py
index aae67d77d2..7f7368e226 100644
--- a/src/sentry/web/frontend/projects/keys.py
+++ b/src/sentry/web/frontend/projects/keys.py
@@ -16,7 +16,7 @@ from django.views.decorators.http import require_http_methods
 from django.utils.translation import ugettext_lazy as _
 
 from sentry.constants import MEMBER_ADMIN
-from sentry.models import ProjectKey
+from sentry.models import ProjectKey, ProjectKeyStatus
 from sentry.permissions import (
     can_remove_project_key, can_add_project_key, can_edit_project_key
 )
@@ -40,6 +40,7 @@ def manage_project_keys(request, organization, project):
     for key in key_list:
         key.project = project
         key.can_remove = can_remove_project_key(request.user, key),
+        key.can_edit = can_edit_project_key(request.user, key),
 
     context = csrf(request)
     context.update({
@@ -85,9 +86,9 @@ def edit_project_key(request, organization, project, key_id):
     form = EditProjectKeyForm(request.POST or None, instance=key)
     if form.is_valid():
         form.save()
-
         messages.add_message(
-            request, messages.SUCCESS, _('Changes to your API key were saved.'))
+            request, messages.SUCCESS,
+            _('Changes to the API key (%s) were saved.') % (key.public_key,))
         return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
 
     context = {
@@ -120,3 +121,45 @@ def remove_project_key(request, organization, project, key_id):
         _('The API key (%s) was revoked.') % (key.public_key,))
 
     return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+
+@require_http_methods(['POST'])
+@has_access(MEMBER_ADMIN)
+@csrf_protect
+def disable_project_key(request, organization, project, key_id):
+    try:
+        key = ProjectKey.objects.get(id=key_id)
+    except ProjectKey.DoesNotExist:
+        return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+    # we require removal permission for this
+    if not can_edit_project_key(request.user, key):
+        return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+    key.update(status=ProjectKeyStatus.INACTIVE)
+    messages.add_message(
+        request, messages.SUCCESS,
+        _('The API key (%s) was disabled.') % (key.public_key,))
+
+    return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+
+@require_http_methods(['POST'])
+@has_access(MEMBER_ADMIN)
+@csrf_protect
+def enable_project_key(request, organization, project, key_id):
+    try:
+        key = ProjectKey.objects.get(id=key_id)
+    except ProjectKey.DoesNotExist:
+        return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+    # we require removal permission for this
+    if not can_edit_project_key(request.user, key):
+        return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
+
+    key.update(status=ProjectKeyStatus.ACTIVE)
+    messages.add_message(
+        request, messages.SUCCESS,
+        _('The API key (%s) was enabled.') % (key.public_key,))
+
+    return HttpResponseRedirect(reverse('sentry-manage-project-keys', args=[project.organization.slug, project.slug]))
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index d367376e7f..3c7f13fe1c 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -188,6 +188,12 @@ urlpatterns += patterns('',
     url(r'^(?P<organization_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/keys/(?P<key_id>\d+)/remove/$',
         sentry.web.frontend.projects.keys.remove_project_key,
         name='sentry-remove-project-key'),
+    url(r'^(?P<organization_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/keys/(?P<key_id>\d+)/disable/$',
+        sentry.web.frontend.projects.keys.disable_project_key,
+        name='sentry-disable-project-key'),
+    url(r'^(?P<organization_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/keys/(?P<key_id>\d+)/enable/$',
+        sentry.web.frontend.projects.keys.enable_project_key,
+        name='sentry-enable-project-key'),
 
     url(r'^(?P<organization_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/plugins/$',
         sentry.web.frontend.projects.plugins.manage_plugins,
