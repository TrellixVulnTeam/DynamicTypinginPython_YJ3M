commit 41353d2ab262698226b7bf7852f3368f9640f145
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Oct 12 18:02:29 2014 +0100

    Functional assignee selector

diff --git a/src/sentry/api/serializers/models/group.py b/src/sentry/api/serializers/models/group.py
index 8a82bdd9a5..ffbfcee159 100644
--- a/src/sentry/api/serializers/models/group.py
+++ b/src/sentry/api/serializers/models/group.py
@@ -9,7 +9,7 @@ from sentry.api.serializers import Serializer, register
 from sentry.app import tsdb
 from sentry.constants import TAG_LABELS
 from sentry.models import (
-    Group, GroupBookmark, GroupTagKey, GroupSeen, GroupStatus
+    Group, GroupAssignee, GroupBookmark, GroupTagKey, GroupSeen, GroupStatus
 )
 from sentry.utils.db import attach_foreignkey
 from sentry.utils.http import absolute_uri
@@ -58,6 +58,13 @@ class GroupSerializer(Serializer):
             rollup=3600 * 24,
         )
 
+        assignees = dict(
+            (a.group_id, a.user)
+            for a in GroupAssignee.objects.filter(
+                group__in=item_list,
+            ).select_related('user')
+        )
+
         result = {}
         for item in item_list:
             active_date = item.active_at or item.last_seen
@@ -75,6 +82,7 @@ class GroupSerializer(Serializer):
                 }
 
             result[item] = {
+                'assigned_to': assignees.get(item),
                 'is_bookmarked': item.id in bookmarks,
                 'has_seen': seen_groups.get(item.id, active_date) > active_date,
                 'tags': tags,
@@ -117,6 +125,7 @@ class GroupSerializer(Serializer):
                 '24h': attrs['hourly_stats'],
                 '30d': attrs['daily_stats'],
             },
+            'assignedTo': attrs['assigned_to'],
             'isBookmarked': attrs['is_bookmarked'],
             'hasSeen': attrs['has_seen'],
             'tags': attrs['tags'],
diff --git a/src/sentry/static/sentry/app/directives/assigneeSelector.js b/src/sentry/static/sentry/app/directives/assigneeSelector.js
index 5ff6b51703..73c29089b8 100644
--- a/src/sentry/static/sentry/app/directives/assigneeSelector.js
+++ b/src/sentry/static/sentry/app/directives/assigneeSelector.js
@@ -6,10 +6,26 @@
       return {
         restrict: 'E',
         templateUrl: '/templates/assignee-selector.html',
+        link: function(scope, element, attrs) {
+          scope.group = scope.$eval(attrs.group);
+        },
         controller: ['$scope', 'projectMemberList', function($scope, projectMemberList){
           projectMemberList.success(function(data){
             $scope.projectMemberList = data;
           });
+
+          $scope.assignTo = function(user){
+            $.ajax({
+              url: '/api/0/groups/' + $scope.group.id + '/',
+              method: 'PUT',
+              data: {
+                assignedTo: user.id
+              },
+              success: function(data){
+                scope.group.assignedTo = user;
+              }
+            });
+          };
         }],
         controllerAs: 'assigneeSelector'
       };
diff --git a/src/sentry/static/sentry/app/templates/assignee-selector.html b/src/sentry/static/sentry/app/templates/assignee-selector.html
index 994dca2d2e..e599e7066e 100644
--- a/src/sentry/static/sentry/app/templates/assignee-selector.html
+++ b/src/sentry/static/sentry/app/templates/assignee-selector.html
@@ -1,14 +1,16 @@
 <div class="user-selector">
   <div class="btn-group">
     <a href="#" class="btn btn-sm btn-default dropdown-toggle">
-      <img src="http://github.com/benvinegar.png" class="avatar">
+      <span ng-if="group.asignedTo">
+        <img src="<% group.assignedTo.avatarUrl %>" class="avatar">
+      </span>
       <span aria-hidden="true" class="icon-arrow-down"></span>
     </a>
     <div class="dropdown-menu" ng-click="$event.stopPropagation()">
       <input type="text" class="form-control input-sm" placeholder="Filter people">
       <ul>
         <li ng-repeat="projectMember in projectMemberList">
-          <a href="#"><img src="<% projectMember.avatarUrl %>" class="avatar"> <% projectMember.name || projectMember.email %></a>
+          <a href="#" ng-click="assignTo(projectMember)"><img src="<% projectMember.avatarUrl %>" class="avatar"> <% projectMember.name || projectMember.email %></a>
         </li>
       </ul>
     </div>
diff --git a/src/sentry/templates/sentry/groups/details.html b/src/sentry/templates/sentry/groups/details.html
index 428af4901b..b63f9ee50d 100644
--- a/src/sentry/templates/sentry/groups/details.html
+++ b/src/sentry/templates/sentry/groups/details.html
@@ -32,7 +32,7 @@
             <div class="row">
               <div class="col-xs-4 assigned-to">
 
-                  <assignee-selector></assignee-selector>
+                  <assignee-selector group="group"></assignee-selector>
                   <div class="is-assigned"><span class="hidden-sm">is</span> assigned</div>
               </div>
               <div class="col-xs-4 event-count align-right">
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index fbfd6dd841..327f808ab9 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -158,7 +158,7 @@
               </div>
             </div>
             <div class="event-assignee event-cell hidden-xs hidden-sm">
-                <assignee-selector></assignee-selector>
+                <assignee-selector group="group"></assignee-selector>
             </div>
             <div class="hidden-sm hidden-xs event-graph align-right event-cell">
               <barchart data="group.activeChartData" options="chartOptions" class="sparkline"></barchart>
