commit bdae83e648712f330b5fdffac1b681e4792b3002
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jul 5 14:51:12 2012 +0200

    Support tags as a mapping and add tests

diff --git a/sentry/manager.py b/sentry/manager.py
index 881d9e1893..76a3e1c6f3 100644
--- a/sentry/manager.py
+++ b/sentry/manager.py
@@ -411,6 +411,10 @@ class GroupManager(BaseManager, ChartMixin):
         checksum = kwargs.pop('checksum', None)
         tags = kwargs.pop('tags', [])
 
+        # full support for dict syntax
+        if isinstance(tags, dict):
+            tags = tags.items()
+
         # We must convert date to local time so Django doesn't mess it up
         # based on TIME_ZONE
         date = utc_to_local(date)
diff --git a/tests/sentry/manager/tests.py b/tests/sentry/manager/tests.py
index 1df76d5a28..2490aaae57 100644
--- a/tests/sentry/manager/tests.py
+++ b/tests/sentry/manager/tests.py
@@ -165,6 +165,18 @@ class SentryManagerTest(TestCase):
         self.assertEquals(res.value, 'bar')
         self.assertEquals(res.times_seen, 1)
 
+    @mock.patch('sentry.manager.GroupManager.add_tags')
+    def test_tags_as_list(self, add_tags):
+        event = Group.objects.from_kwargs(1, message='foo', tags=[('foo', 'bar')])
+        group = event.group
+        add_tags.assert_called_once_with(group, [('foo', 'bar'), ('logger', 'root')])
+
+    @mock.patch('sentry.manager.GroupManager.add_tags')
+    def test_tags_as_dict(self, add_tags):
+        event = Group.objects.from_kwargs(1, message='foo', tags={'foo': 'bar'})
+        group = event.group
+        add_tags.assert_called_once_with(group, [('foo', 'bar'), ('logger', 'root')])
+
     def test_dupe_message_id(self):
         event = Group.objects.from_kwargs(1, event_id=1, message='foo')
         self.assertEquals(event.message, 'foo')
