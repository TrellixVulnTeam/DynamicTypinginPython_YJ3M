commit 974c16f4c829a1708c86d3305fee209b6c408a9d
Author: Matej Minar <matej.minar@sentry.io>
Date:   Mon Mar 30 09:59:37 2020 +0200

    ref(ui): Simplified release v2 list data (#17960)

diff --git a/src/sentry/static/sentry/app/types/index.tsx b/src/sentry/static/sentry/app/types/index.tsx
index 831190f208..469f9ab1a3 100644
--- a/src/sentry/static/sentry/app/types/index.tsx
+++ b/src/sentry/static/sentry/app/types/index.tsx
@@ -162,15 +162,14 @@ export type ProjectRelease = {
   authors: User[];
   newGroups: number;
   healthData: Health | null;
-  projectSlug: string;
-  projectId: number;
+  project: ReleaseProject;
 };
 
 export type Health = {
   totalUsers: number;
-  totalUsers24h: number;
+  totalUsers24h: number | null;
   totalSessions: number;
-  totalSessions24h: number;
+  totalSessions24h: number | null;
   crashFreeUsers: number | null;
   crashFreeSessions: number | null;
   stats: HealthGraphData;
@@ -178,10 +177,11 @@ export type Health = {
   sessionsErrored: number;
   adoption: number | null;
   hasHealthData: boolean;
+  durationP50: number | null;
+  durationP90: number | null;
 };
-export type HealthGraphData = {
-  [key: string]: [number, number][];
-};
+
+export type HealthGraphData = Record<string, [number, number][]>;
 
 export type Team = {
   id: string;
@@ -859,7 +859,9 @@ export type ReleaseProject = {
   slug: string;
   name: string;
   id: number;
-  healthData?: Health | null;
+  platform: string;
+  platforms: string[];
+  healthData: Health;
 };
 
 export type BaseRelease = {
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/index.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/index.tsx
index 5e6a9786aa..7610558b72 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/index.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/index.tsx
@@ -112,8 +112,6 @@ class ReleaseOverview extends AsyncView<Props> {
                         crashFreeTimeBreakdown={crashFreeTimeBreakdown}
                       />
                     )}
-                    {/* TODO(releasesV2): hidden for now */}
-                    {/* <SessionDuration /> */}
                   </Sidebar>
                 </ContentBox>
               )}
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/sessionDuration.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/sessionDuration.tsx
deleted file mode 100644
index c5636c6ade..0000000000
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/sessionDuration.tsx
+++ /dev/null
@@ -1,33 +0,0 @@
-import React from 'react';
-import styled from '@emotion/styled';
-
-import {t} from 'app/locale';
-
-import HealthStatsChart from '../../list/healthStatsChart';
-import {mockData} from '../../list/mock';
-import {SectionHeading, Wrapper} from './styles';
-
-type Props = {};
-
-// TODO(releasesV2): waiting for API
-const SessionDuration = ({}: Props) => (
-  <StyledWrapper>
-    <SectionHeading>{t('Session Duration')}</SectionHeading>
-    <HealthStatsChart
-      data={{'24h': mockData[0].graphData['24h'].slice(0, 15)}}
-      period="24h"
-      subject="sessions"
-      height={50}
-    />
-  </StyledWrapper>
-);
-
-const StyledWrapper = styled(Wrapper)`
-  /* TODO(releasesV2): this will be changed */
-  g > .barchart-rect {
-    background: ${p => p.theme.offWhite2};
-    fill: ${p => p.theme.offWhite2};
-  }
-`;
-
-export default SessionDuration;
diff --git a/src/sentry/static/sentry/app/views/releasesV2/list/adoptionTooltip.tsx b/src/sentry/static/sentry/app/views/releasesV2/list/adoptionTooltip.tsx
index a9fbb2cf65..a11ab6eefc 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/list/adoptionTooltip.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/list/adoptionTooltip.tsx
@@ -7,9 +7,9 @@ import Count from 'app/components/count';
 
 type Props = {
   totalUsers: number;
-  totalUsers24h: number;
+  totalUsers24h: number | null;
   totalSessions: number;
-  totalSessions24h: number;
+  totalSessions24h: number | null;
 };
 
 const AdoptionTooltip = ({
@@ -29,7 +29,7 @@ const AdoptionTooltip = ({
       <Row>
         <Title>{t('Total Users')}:</Title>
         <Value>
-          <Count value={totalUsers ?? 0} />
+          <Count value={totalUsers} />
         </Value>
       </Row>
       <Divider />
@@ -43,7 +43,7 @@ const AdoptionTooltip = ({
       <Row>
         <Title>{t('Total Sessions')}:</Title>
         <Value>
-          <Count value={totalSessions ?? 0} />
+          <Count value={totalSessions} />
         </Value>
       </Row>
     </Wrapper>
diff --git a/src/sentry/static/sentry/app/views/releasesV2/list/index.tsx b/src/sentry/static/sentry/app/views/releasesV2/list/index.tsx
index 0390d972a5..81dcc81413 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/list/index.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/list/index.tsx
@@ -21,7 +21,6 @@ import {PageContent, PageHeader} from 'app/styles/organization';
 import EmptyStateWarning from 'app/components/emptyStateWarning';
 import ReleaseCard from 'app/views/releasesV2/list/releaseCard';
 import GlobalSelectionHeader from 'app/components/organizations/globalSelectionHeader';
-import Projects from 'app/utils/projects';
 import {getRelativeSummary} from 'app/components/organizations/timeRangeSelector/utils';
 import {DEFAULT_STATS_PERIOD} from 'app/constants';
 
@@ -122,28 +121,10 @@ class ReleasesList extends AsyncView<Props, State> {
   transformToProjectRelease(releases: Release[]): ProjectRelease[] {
     return releases.flatMap(release =>
       release.projects.map(project => {
-        const {
-          version,
-          dateCreated,
-          dateReleased,
-          commitCount,
-          authors,
-          lastEvent,
-          newGroups,
-        } = release;
-        const {slug, id, healthData} = project;
         return {
-          version,
-          dateCreated,
-          dateReleased,
-          commitCount,
-          authors,
-          lastEvent,
-          newGroups,
-          healthData: healthData!,
-          projectSlug: slug,
-          projectId: id,
-          // TODO(releasesv2): make api send also project platform
+          ...release,
+          healthData: project.healthData,
+          project,
         };
       })
     );
@@ -181,7 +162,7 @@ class ReleasesList extends AsyncView<Props, State> {
   }
 
   renderInnerBody() {
-    const {organization, location} = this.props;
+    const {location} = this.props;
     const {loading, releases, reloading} = this.state;
 
     if ((loading && !reloading) || (loading && !releases.length)) {
@@ -194,21 +175,15 @@ class ReleasesList extends AsyncView<Props, State> {
 
     const projectReleases = this.transformToProjectRelease(releases);
 
-    return (
-      <Projects orgId={organization.slug} slugs={projectReleases.map(r => r.projectSlug)}>
-        {({projects}) =>
-          projectReleases.map((release: ProjectRelease) => (
-            <ReleaseCard
-              key={`${release.version}-${release.projectSlug}`}
-              release={release}
-              project={projects.find(p => p.slug === release.projectSlug)}
-              location={location}
-              reloading={reloading}
-            />
-          ))
-        }
-      </Projects>
-    );
+    return projectReleases.map((release: ProjectRelease) => (
+      <ReleaseCard
+        key={`${release.version}-${release.project.slug}`}
+        release={release}
+        project={release.project}
+        location={location}
+        reloading={reloading}
+      />
+    ));
   }
 
   renderBody() {
diff --git a/src/sentry/static/sentry/app/views/releasesV2/list/mock.ts b/src/sentry/static/sentry/app/views/releasesV2/list/mock.ts
deleted file mode 100644
index 4721c1654b..0000000000
--- a/src/sentry/static/sentry/app/views/releasesV2/list/mock.ts
+++ /dev/null
@@ -1,37 +0,0 @@
-const mock = () => ({
-  crashFreeUsersPercent: Math.floor(Math.random() * 100),
-  crashFreeUsersSessionsPercent: Math.floor(Math.random() * 100),
-  crashes: Math.floor(Math.random() * 10000),
-  errors: Math.floor(Math.random() * 10000),
-  dailyActiveUsers: Math.floor(Math.random() * 100),
-  graphData: {
-    '24h': [
-      [1578996000, 2718],
-      [1578999600, 3555],
-      [1579003200, 3787],
-      [1579006800, 4480],
-      [1579010400, 4961],
-      [1579014000, 5067],
-      [1579017600, 4443],
-      [1579021200, 3311],
-      [1579024800, 3226],
-      [1579028400, 3065],
-      [1579032000, 3181],
-      [1579035600, 3216],
-      [1579039200, 2859],
-      [1579042800, 3670],
-      [1579046400, 3643],
-      [1579050000, 3571],
-      [1579053600, 3715],
-      [1579057200, 3686],
-      [1579060800, 2655],
-      [1579064400, 2310],
-      [1579068000, 2030],
-      [1579071600, 1925],
-      [1579075200, 2218],
-      [1579078800, 1136],
-    ],
-  } as any,
-});
-
-export const mockData = [...Array(20)].map(mock);
diff --git a/src/sentry/static/sentry/app/views/releasesV2/list/releaseCard.tsx b/src/sentry/static/sentry/app/views/releasesV2/list/releaseCard.tsx
index 35c9242005..0a0642299b 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/list/releaseCard.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/list/releaseCard.tsx
@@ -7,7 +7,7 @@ import Count from 'app/components/count';
 import Version from 'app/components/version';
 import {Panel, PanelBody, PanelItem} from 'app/components/panels';
 import ReleaseStats from 'app/components/releaseStats';
-import {Project, AvatarProject, ProjectRelease} from 'app/types';
+import {ProjectRelease, ReleaseProject} from 'app/types';
 import TimeSince from 'app/components/timeSince';
 import {t, tn} from 'app/locale';
 import {AvatarListWrapper} from 'app/components/avatar/avatarList';
@@ -18,7 +18,7 @@ import ReleaseHealth from './releaseHealth';
 
 type Props = {
   release: ProjectRelease;
-  project?: Project | AvatarProject;
+  project: ReleaseProject;
   location: Location;
   reloading: boolean;
 };
@@ -61,7 +61,7 @@ const ReleaseCard = ({release, project, location, reloading}: Props) => (
                 // preserveGlobalSelection
                 tooltipRawVersion
                 truncate
-                projectId={String(release.projectId)}
+                projectId={String(project.id)}
                 v2
               />
               <TimeWithIcon date={release.dateReleased || release.dateCreated} />
@@ -69,9 +69,7 @@ const ReleaseCard = ({release, project, location, reloading}: Props) => (
           </VersionColumn>
 
           <ProjectsColumn>
-            {project && (
-              <ProjectBadge project={project} avatarSize={14} key={project?.slug} />
-            )}
+            <ProjectBadge project={project} avatarSize={14} key={project?.slug} />
           </ProjectsColumn>
 
           <CommitsColumn>
