commit c44f77845e790fcec15d96be8c2905cc36f18807
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jul 27 16:28:33 2015 -0700

    Fix queue admin rendering

diff --git a/src/sentry/static/sentry/app/components/flotChart.jsx b/src/sentry/static/sentry/app/components/flotChart.jsx
index 63c4e9dd56..88c53fe55c 100644
--- a/src/sentry/static/sentry/app/components/flotChart.jsx
+++ b/src/sentry/static/sentry/app/components/flotChart.jsx
@@ -33,7 +33,7 @@ var timeUnitSize = {
 };
 
 var tickFormatter = (value, axis) => {
-  var d = moment(value);
+  var d = moment(parseInt(value, 10));
 
   var t = axis.tickSize[0] * timeUnitSize[axis.tickSize[1]];
   var span = axis.max - axis.min;
@@ -90,11 +90,15 @@ var FlotChart = React.createClass({
       tooltip: true,
       tooltipOpts: {
         content: (label, xval, yval, flotItem) => {
-          xval = parseInt(xval, 10);
-          if(typeof yval.toLocaleString == "function") {
-              return yval.toLocaleString() + ' events ' + flotItem.series.label.toLowerCase() + '<br>' + moment(xval).format('llll');
+          var xLabel = moment(parseInt(xval, 10)).format('llll');
+          var ySuffix = (flotItem.series.label || '').toLowerCase();
+          var yLabel;
+          if (typeof yval.toLocaleString === "function") {
+            yLabel = yval.toLocaleString();
+          } else {
+            yLabel = yval;
           }
-          return yval + ' events<br>' + moment(xval).format('llll');
+          return yLabel + ' ' + ySuffix + '<br>' + xLabel;
         },
         defaultTheme: false
       },
diff --git a/src/sentry/static/sentry/app/views/organizationStats.jsx b/src/sentry/static/sentry/app/views/organizationStats.jsx
index 4d3313e875..2a6883b537 100644
--- a/src/sentry/static/sentry/app/views/organizationStats.jsx
+++ b/src/sentry/static/sentry/app/views/organizationStats.jsx
@@ -335,7 +335,7 @@ var OrganizationStats = React.createClass({
     return [
       {
         data: stats.accepted,
-        label: 'Accepted',
+        label: 'Events Accepted',
         color: 'rgba(86, 175, 232, 1)',
         shadowSize: 0,
         stack: true,
@@ -349,7 +349,7 @@ var OrganizationStats = React.createClass({
         data: stats.rejected,
         color: 'rgba(244, 63, 32, 1)',
         shadowSize: 0,
-        label: 'Rejected',
+        label: 'Events Rejected',
         stack: true,
         lines: {
           lineWidth: 2,
@@ -382,7 +382,9 @@ var OrganizationStats = React.createClass({
             : (this.state.statsError ?
               <LoadingError onRetry={this.fetchData} />
             :
-              <FlotChart plotData={this.getChartPlotData()} className="chart" />
+              <div style={{height: 250}}>
+                <FlotChart plotData={this.getChartPlotData()} className="chart" />
+              </div>
             )}
           </div>
         </div>
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index 652a513f96..f2591312fa 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -479,7 +479,7 @@ table.integrations {
 }
 
 /**
-* Org Selector
+* Loading Indicator
 * ============================================================================
 */
 
@@ -981,10 +981,11 @@ table.integrations {
 * ============================================================================
 */
 
+
 .chart {
+  display: block;
   position: relative;
-  min-height: 200px;
-  max-height: 250px;
+  height: 100%;
   margin-bottom: 20px;
 
   > .title {
@@ -1004,13 +1005,13 @@ table.integrations {
     position: absolute;
     left: 0;
     top: 0;
-    width: 40px;
+    white-space: nowrap;
     padding-left: 10px;
     height: 100%;
     text-align: left;
     color: @linkColor;
     .legendLabel {
-      padding: 0 10px 0 0;
+      padding: 0 5px;
     }
   }
 }
diff --git a/src/sentry/templates/sentry/admin-queue.html b/src/sentry/templates/sentry/admin-queue.html
index a5131049f2..8f232f05cb 100644
--- a/src/sentry/templates/sentry/admin-queue.html
+++ b/src/sentry/templates/sentry/admin-queue.html
@@ -7,7 +7,7 @@
 
 {% block title %}{% trans "Queue" %} | {{ block.super }}{% endblock %}
 
-{% block inner %}
+{% block main %}
   <div class="page-header">
     <ul class="nav nav-pills pull-right" id="duration">
       <li class="active"><a href="#">1h</a></li>
@@ -18,17 +18,16 @@
   </div>
 
   <h3>Global Throughput</h3>
-  <div class="chart" style="height:250px" data-metric="jobs.all.started" data-label="Jobs started"></div>
+  <div class="chart-loader" style="height:250px" data-metric="jobs.all.started" data-label="Jobs started"></div>
 
   <h3>Tasks</h3>
-  <ul class="task-list">
+  <ul class="task-list unstyled">
     {% for task_name in task_list %}
       <li>
         <strong>{{ task_name }}</strong>
-        <div class="chart" style="height:80px"
+        <div class="chart-loader" style="height:80px"
              data-metric="jobs.started.{{ task_name }}"
-             data-labels="false"
-             data-legend="false"></div>
+             data-label="Jobs started"></div>
       </li>
     {% endfor %}
   </ul>
@@ -46,15 +45,14 @@
     });
 
     var redrawCharts = function(){
-      $('.chart').each(function(){
-        var $chart = $(this);
+      $('.chart-loader').each(function(){
+        var chart = this;
+        var $chart = $(chart);
         var chartType = $chart.data('chart');
         var metric = $chart.data('metric');
-        var endpoint = app.config.urlPrefix + '/api/0/internal/stats/';
+        var endpoint = '{{ URL_PREFIX }}/api/0/internal/stats/';
         var since = new Date().getTime() / 1000;
         var resolution;
-        var showLegend = $chart.data('legend') !== false;
-        var showLabels = $chart.data('labels') !== false;
 
         switch(selectedDuration) {
           case '1h':
@@ -73,7 +71,13 @@
             throw new Error('Invalid duration: ' + selectedDuration);
         }
 
-        $chart.html('<div class="loading">Loading...</div>');
+        $chart.html(
+          '<div class="loading">' +
+            '<div className="loading-mask"></div>' +
+            '<div className="loading-indicator"></div>' +
+            '<div className="loading-message">Loading</div>' +
+          '</div>'
+        );
 
         $.ajax({
           url: endpoint,
@@ -85,11 +89,9 @@
             key: metric
           },
           success: function(data){
-            renderChart($chart, {
+            renderChart(chart, {
               label: $chart.data('label'),
-              points: processData(data),
-              showLegend: showLegend,
-              showLabels: showLabels
+              points: processData(data)
             });
           },
           error: function(data) {
@@ -111,18 +113,7 @@
       return result;
     };
 
-    var countFormatter = function(value) {
-      if (value > 999999) {
-        return (value / 1000000) + 'mm';
-      }
-      if (value > 999) {
-        return (value / 1000) + 'k';
-      }
-      return value;
-    };
-    var emptyFormatter = function() { return ''; };
-
-    var renderChart = function($chart, data) {
+    var renderChart = function(parent, data) {
       var points = [
         {
           data: data.points,
@@ -138,51 +129,10 @@
         }
       ];
 
-      var options = {
-        xaxis: {
-          mode: "time",
-          // minTickSize: [10, "second"],
-          tickFormatter: Sentry.charts.tickFormatter
-        },
-        yaxis: {
-          min: 0,
-          tickFormatter: countFormatter
-        },
-        tooltip: true,
-        tooltipOpts: {
-          content: function(label, xval, yval, flotItem) {
-            xval = parseInt(xval, 10);
-            if(typeof yval.toLocaleString == "function") {
-              if (flotItem.series.label)
-                return yval.toLocaleString() + ' ' + flotItem.series.label.toLowerCase() + '<br>' + moment(xval).format('llll');
-              return yval.toLocaleString() + '<br>' + moment(xval).format('llll');
-            }
-            return yval + '<br>' + moment(xval).format('llll');
-          },
-          defaultTheme: false
-        },
-        grid: {
-          show: true,
-          hoverable: true,
-          backgroundColor: '#ffffff',
-          borderColor: '#DEE3E9',
-          borderWidth: 2,
-          tickColor: '#f0f0f0'
-        },
-        hoverable: false,
-        legend: {
-          show: data.showLegend,
-          noColumns: 2,
-          position: 'nw'
-        },
-        lines: { show: false }
-      };
-
-      $.plot($chart, points, options);
-
-      $(window).resize(function(){
-        $.plot($chart, points, options);
-      });
+      React.render(React.createFactory(Sentry.FlotChart)({
+        className: "chart",
+        plotData: points
+      }), parent);
     }
   });
   </script>
@@ -190,6 +140,7 @@
   <style>
   .task-list {
     margin-left: 0;
+    padding-left: 0;
   }
   .task-list li {
     width: 49%;
@@ -202,7 +153,8 @@
     display: block;
   }
   .task-list .flot-y-axis,
-  .task-list .flot-x-axis {
+  .task-list .flot-x-axis,
+  .task-list .legend {
     display: none !important;
   }
   </style>
