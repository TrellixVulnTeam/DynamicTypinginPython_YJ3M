commit e1ed230c9c192d7f366841deeb9da309c7f75561
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Nov 25 15:24:00 2012 -0800

    More concise registration tests

diff --git a/tests/sentry/web/frontend/accounts/tests.py b/tests/sentry/web/frontend/accounts/tests.py
index 3c9037ee2a..be2979098d 100644
--- a/tests/sentry/web/frontend/accounts/tests.py
+++ b/tests/sentry/web/frontend/accounts/tests.py
@@ -54,21 +54,28 @@ class RegisterTest(TestCase):
     def path(self):
         return reverse('sentry-register')
 
+    def test_redirects_if_registration_disabled(self):
+        with self.Settings(SENTRY_ALLOW_REGISTRATION=False):
+            resp = self.client.get(self.path)
+            self.assertEquals(resp.status_code, 302)
+
     def test_renders_correct_template(self):
-        resp = self.client.get(self.path)
-        self.assertEquals(resp.status_code, 200)
-        self.assertTemplateUsed('sentry/register.html')
+        with self.Settings(SENTRY_ALLOW_REGISTRATION=True):
+            resp = self.client.get(self.path)
+            self.assertEquals(resp.status_code, 200)
+            self.assertTemplateUsed('sentry/register.html')
 
     def test_with_required_params(self):
-        resp = self.client.post(self.path, {
-            'username': 'test',
-            'email': 'test@example.com',
-            'password': 'foobar',
-        })
-        self.assertEquals(resp.status_code, 302)
-        user = User.objects.get(username='test')
-        self.assertEquals(user.email, 'test@example.com')
-        self.assertTrue(user.check_password('foobar'))
+        with self.Settings(SENTRY_ALLOW_REGISTRATION=True):
+            resp = self.client.post(self.path, {
+                'username': 'test',
+                'email': 'test@example.com',
+                'password': 'foobar',
+            })
+            self.assertEquals(resp.status_code, 302)
+            user = User.objects.get(username='test')
+            self.assertEquals(user.email, 'test@example.com')
+            self.assertTrue(user.check_password('foobar'))
 
 
 class AppearanceSettingsTest(TestCase):
