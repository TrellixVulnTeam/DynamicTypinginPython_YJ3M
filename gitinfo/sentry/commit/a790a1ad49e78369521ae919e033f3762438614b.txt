commit a790a1ad49e78369521ae919e033f3762438614b
Author: Dan Fuller <dfuller@sentry.io>
Date:   Fri Mar 20 11:02:57 2020 -0700

    perf(incidents): Remove stats from incident serializer
    
    These make loading the incident list slow, removing them so that we can load them separately in
    another endpoint. This will be merged after the frontend changes are made

diff --git a/src/sentry/api/serializers/models/incident.py b/src/sentry/api/serializers/models/incident.py
index 775d0dc807..208d922981 100644
--- a/src/sentry/api/serializers/models/incident.py
+++ b/src/sentry/api/serializers/models/incident.py
@@ -5,8 +5,6 @@ from collections import defaultdict
 import six
 
 from sentry.api.serializers import Serializer, register, serialize
-from sentry.api.serializers.snuba import SnubaTSResultSerializer
-from sentry.incidents.logic import bulk_get_incident_stats
 from sentry.incidents.models import (
     Incident,
     IncidentGroup,
@@ -15,7 +13,6 @@ from sentry.incidents.models import (
     IncidentSubscription,
 )
 from sentry.utils.db import attach_foreignkey
-from sentry.utils.compat import zip
 
 
 @register(Incident)
@@ -28,18 +25,12 @@ class IncidentSerializer(Serializer):
             incident_projects[incident_project.incident_id].append(incident_project.project.slug)
 
         results = {}
-        for incident, stats in zip(item_list, bulk_get_incident_stats(item_list, prewindow=True)):
-            results[incident] = {
-                "projects": incident_projects.get(incident.id, []),
-                "event_stats": stats["event_stats"],
-                "total_events": stats["total_events"],
-                "unique_users": stats["unique_users"],
-            }
+        for incident in item_list:
+            results[incident] = {"projects": incident_projects.get(incident.id, [])}
 
         return results
 
     def serialize(self, obj, attrs, user):
-        serializer = SnubaTSResultSerializer(obj.organization, None, user)
         return {
             "id": six.text_type(obj.id),
             "identifier": six.text_type(obj.identifier),
@@ -54,9 +45,6 @@ class IncidentSerializer(Serializer):
             "dateDetected": obj.date_detected,
             "dateCreated": obj.date_added,
             "dateClosed": obj.date_closed,
-            "eventStats": serializer.serialize(attrs["event_stats"]),
-            "totalEvents": attrs["total_events"],
-            "uniqueUsers": attrs["unique_users"],
         }
 
 
diff --git a/tests/sentry/api/endpoints/test_organization_incident_details.py b/tests/sentry/api/endpoints/test_organization_incident_details.py
index a1e4d8e45c..47501f4f0a 100644
--- a/tests/sentry/api/endpoints/test_organization_incident_details.py
+++ b/tests/sentry/api/endpoints/test_organization_incident_details.py
@@ -67,7 +67,6 @@ class OrganizationIncidentDetailsTest(BaseIncidentDetailsTest, APITestCase):
         assert resp.data["dateDetected"] == expected["dateDetected"]
         assert resp.data["dateCreated"] == expected["dateCreated"]
         assert resp.data["projects"] == expected["projects"]
-        assert resp.data["eventStats"] == expected["eventStats"]
         assert resp.data["seenBy"] == seen_by
 
 
diff --git a/tests/sentry/api/serializers/test_incident.py b/tests/sentry/api/serializers/test_incident.py
index 2481e21268..e8556946d2 100644
--- a/tests/sentry/api/serializers/test_incident.py
+++ b/tests/sentry/api/serializers/test_incident.py
@@ -35,10 +35,6 @@ class IncidentSerializerTest(TestCase):
         assert result["dateDetected"] == incident.date_detected
         assert result["dateCreated"] == incident.date_added
         assert result["dateClosed"] == incident.date_closed
-        assert len(result["eventStats"]["data"]) == 61
-        assert [data[1] for data in result["eventStats"]["data"]] == [[]] * 61
-        assert result["totalEvents"] == 0
-        assert result["uniqueUsers"] == 0
 
 
 class DetailedIncidentSerializerTest(TestCase):
