commit 6e5645a66e2adf1bb9adc84bb0bb82ddcc475b4d
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Apr 22 22:59:08 2014 -0700

    Restrict tag counts to be slightly less taxing on the database

diff --git a/src/sentry/templatetags/sentry_helpers.py b/src/sentry/templatetags/sentry_helpers.py
index 99a90e925d..a706e73736 100644
--- a/src/sentry/templatetags/sentry_helpers.py
+++ b/src/sentry/templatetags/sentry_helpers.py
@@ -8,11 +8,11 @@ sentry.templatetags.sentry_helpers
 # XXX: Import django-paging's template tags so we don't have to worry about
 #      INSTALLED_APPS
 
-import datetime
 import os.path
 import pytz
 
 from collections import namedtuple
+from datetime import timedelta
 from paging.helpers import paginate as paginate_func
 from pkg_resources import parse_version as Version
 from urllib import quote
@@ -154,7 +154,7 @@ def timesince(value, now=None):
         now = timezone.now()
     if not value:
         return _('never')
-    if value < (now - datetime.timedelta(days=5)):
+    if value < (now - timedelta(days=5)):
         return value.date()
     value = (' '.join(timesince(value, now).split(' ')[0:2])).strip(',')
     if value == _('0 minutes'):
@@ -353,6 +353,7 @@ def render_tag_widget(group, tag):
     total = GroupTagValue.objects.filter(
         group=group,
         key=tag,
+        last_seen__gte=timezone.now() - timedelta(days=7),
     ).aggregate(t=Sum('times_seen'))['t'] or 0
 
     return {
