commit 675d3934b2de120777e8a22d59e9697b9e8c0a6c
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Mar 15 12:20:11 2018 -0700

    feat(api): Summarize projects on list endpoints

diff --git a/src/sentry/api/endpoints/organization_projects.py b/src/sentry/api/endpoints/organization_projects.py
index 4bf005f7f5..020b1155af 100644
--- a/src/sentry/api/endpoints/organization_projects.py
+++ b/src/sentry/api/endpoints/organization_projects.py
@@ -6,7 +6,7 @@ from sentry.api.base import DocSection
 from sentry.api.bases.organization import OrganizationEndpoint
 from sentry.api.paginator import OffsetPaginator
 from sentry.api.serializers import serialize
-from sentry.api.serializers.models.project import ProjectWithTeamSerializer
+from sentry.api.serializers.models.project import ProjectSummarySerializer
 from sentry.models import Project, Team
 from sentry.utils.apidocs import scenario, attach_scenarios
 
@@ -83,7 +83,7 @@ class OrganizationProjectsEndpoint(OrganizationEndpoint):
             request=request,
             queryset=queryset,
             order_by='slug',
-            on_results=lambda x: serialize(x, request.user, ProjectWithTeamSerializer(
+            on_results=lambda x: serialize(x, request.user, ProjectSummarySerializer(
                 stats_period=stats_period,
             )),
             paginator_cls=OffsetPaginator,
diff --git a/src/sentry/api/endpoints/team_project_index.py b/src/sentry/api/endpoints/team_project_index.py
index ef38fa02b6..e09235305e 100644
--- a/src/sentry/api/endpoints/team_project_index.py
+++ b/src/sentry/api/endpoints/team_project_index.py
@@ -6,11 +6,13 @@ from rest_framework.response import Response
 
 from sentry.api.base import DocSection
 from sentry.api.bases.team import TeamEndpoint, TeamPermission
-from sentry.api.serializers import serialize
+from sentry.api.serializers import serialize, ProjectSummarySerializer
 from sentry.models import Project, ProjectStatus, AuditLogEntryEvent
 from sentry.signals import project_created
 from sentry.utils.apidocs import scenario, attach_scenarios
 
+ERR_INVALID_STATS_PERIOD = "Invalid stats_period. Valid choices are '', '24h', '14d', and '30d'"
+
 
 @scenario('ListTeamProjects')
 def list_team_projects_scenario(runner):
@@ -77,7 +79,27 @@ class TeamProjectIndexEndpoint(TeamEndpoint):
                 status=ProjectStatus.VISIBLE,
             ))
 
-        return Response(serialize(results, request.user))
+        stats_period = request.GET.get('statsPeriod')
+        if stats_period not in (None, '', '24h', '14d', '30d'):
+            return Response(
+                {
+                    'error': {
+                        'params': {
+                            'stats_period': {
+                                'message': ERR_INVALID_STATS_PERIOD
+                            },
+                        },
+                    }
+                },
+                status=400
+            )
+        elif not stats_period:
+            # disable stats
+            stats_period = None
+
+        return Response(serialize(results, request.user, ProjectSummarySerializer(
+            stats_period=stats_period,
+        )))
 
     @attach_scenarios([create_project_scenario])
     def post(self, request, team):
diff --git a/src/sentry/api/serializers/models/project.py b/src/sentry/api/serializers/models/project.py
index b87120df8e..014ad322b9 100644
--- a/src/sentry/api/serializers/models/project.py
+++ b/src/sentry/api/serializers/models/project.py
@@ -235,7 +235,7 @@ class ProjectWithTeamSerializer(ProjectSerializer):
 
 class ProjectSummarySerializer(ProjectWithTeamSerializer):
     def serialize(self, obj, attrs, user):
-        return {
+        context = {
             'team': attrs['teams'][0] if attrs['teams'] else None,
             'teams': attrs['teams'],
             'id': six.text_type(obj.id),
@@ -245,6 +245,9 @@ class ProjectSummarySerializer(ProjectWithTeamSerializer):
             'isMember': attrs['is_member'],
             'hasAccess': attrs['has_access'],
         }
+        if 'stats' in attrs:
+            context['stats'] = attrs['stats']
+        return context
 
 
 class DetailedProjectSerializer(ProjectWithTeamSerializer):
