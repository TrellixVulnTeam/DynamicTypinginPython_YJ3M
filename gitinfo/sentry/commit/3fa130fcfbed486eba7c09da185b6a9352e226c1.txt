commit 3fa130fcfbed486eba7c09da185b6a9352e226c1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 28 17:26:46 2013 -0800

    Require either filename, function, OR module in stacktrace

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index 3b177b1dfb..14db065ecc 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -234,6 +234,16 @@ class Stacktrace(Interface):
     ``filename``
       The relative filepath to the call
 
+    OR
+
+    ``function``
+      The name of the function being called
+
+    OR
+
+    ``module``
+      Platform-specific module path (e.g. sentry.interfaces.Stacktrace)
+
     The following additional attributes are supported:
 
     ``lineno``
@@ -242,10 +252,6 @@ class Stacktrace(Interface):
       The column number of the call
     ``abs_path``
       The absolute path to filename
-    ``function``
-      The name of the function being called
-    ``module``
-      Platform-specific module path (e.g. sentry.interfaces.Stacktrace)
     ``context_line``
       Source code in filename at lineno
     ``pre_context``
@@ -293,7 +299,7 @@ class Stacktrace(Interface):
                 frame['filename'] = frame.pop('abs_path', None)
 
             # ensure we've got the correct required values
-            assert frame.get('filename')
+            assert frame.get('filename') or frame.get('function') or frame.get('module')
 
             # lineno should be an int
             if 'lineno' in frame:
@@ -313,8 +319,8 @@ class Stacktrace(Interface):
             if 'in_app' in frame:
                 frame['in_app'] = bool(frame['in_app'])
 
-            abs_path = frame.get('abs_path') or frame['filename']
-            if abs_path.startswith(('http:', 'https:')):
+            abs_path = frame.get('abs_path') or frame.get('filename')
+            if abs_path and abs_path.startswith(('http:', 'https:')):
                 urlparts = urlparse.urlparse(abs_path)
                 if urlparts.path:
                     frame['abs_path'] = abs_path
@@ -341,7 +347,7 @@ class Stacktrace(Interface):
         output = []
         if frame.get('module'):
             output.append(frame['module'])
-        else:
+        elif frame.get('filename'):
             output.append(frame['filename'])
 
         if frame.get('context_line'):
@@ -405,7 +411,7 @@ class Stacktrace(Interface):
 
             frame_data = {
                 'abs_path': frame.get('abs_path'),
-                'filename': frame['filename'],
+                'filename': frame.get('filename'),
                 'function': frame.get('function'),
                 'start_lineno': start_lineno,
                 'lineno': lineno,
diff --git a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 6b0e40236d..66c28e0cb3 100644
--- a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -23,8 +23,17 @@
             {% for frame in frames %}
                 <li class="frame{% if not frame.in_app %} system-frame{% endif %} frame-{{ forloop.counter0 }}">
                     <p>
-                        <code{% if frame.abs_path and frame.abs_path != filename %} title="{{ frame.abs_path }}"{% endif %}>{{ frame.filename }}</code>{% if frame.sourcemap %} <a href="#" class="annotation tip" rel="tooltip" data-placement="right" data-title="Occurred in {{ frame.orig_filename }} (line {{ frame.orig_lineno }})<br>(via {{ frame.sourcemap }})">?</a>{% endif %}
-                        {% if frame.function %} in <code>{{ frame.function }}</code>{% endif %}
+                        {% if frame.filename %}
+                            <code{% if frame.abs_path and frame.abs_path != filename %} title="{{ frame.abs_path }}"{% endif %}>{{ frame.filename }}</code>
+                        {% elif frame.module %}
+                            <code>{{ frame.module }}</code>
+                        {% endif %}
+                        {% if frame.sourcemap %}
+                             <a href="#" class="annotation tip" rel="tooltip" data-placement="right" data-title="Occurred in {{ frame.orig_filename }} (line {{ frame.orig_lineno }})<br>(via {{ frame.sourcemap }})">?</a>
+                        {% endif %}
+                        {% if frame.function %}
+                             {% if frame.filename or frame.module %}in {% endif %}<code>{{ frame.function }}</code>
+                        {% endif %}
                         {% if not frame.context and frame.lineno %} at line <code>{{ frame.lineno }}</code>{% endif %}
                         {% if system_frames and frame.in_app %}
                             <span class="tag-app">(application)</span>
