commit 4bf42a2a6dd0344351f78aff979176af1fbbfcdf
Author: adhiraj <693121+adhiraj@users.noreply.github.com>
Date:   Tue Oct 9 11:55:15 2018 -0700

    feat(analytics): Add an amplitude logging hook (#10051)
    
    This is mostly a refactor, just adds a hook for logging things to amplitude.

diff --git a/src/sentry/static/sentry/app/actionCreators/guides.jsx b/src/sentry/static/sentry/app/actionCreators/guides.jsx
index 379d81e9a6..4224b58bd5 100644
--- a/src/sentry/static/sentry/app/actionCreators/guides.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/guides.jsx
@@ -1,6 +1,6 @@
 import {Client} from 'app/api';
 import GuideActions from 'app/actions/guideActions';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 
 const api = new Client();
 
diff --git a/src/sentry/static/sentry/app/components/errorRobot.jsx b/src/sentry/static/sentry/app/components/errorRobot.jsx
index c2653c34dc..72ce002ac1 100644
--- a/src/sentry/static/sentry/app/components/errorRobot.jsx
+++ b/src/sentry/static/sentry/app/components/errorRobot.jsx
@@ -4,7 +4,7 @@ import {Link, browserHistory} from 'react-router';
 import createReactClass from 'create-react-class';
 import styled from 'react-emotion';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ApiMixin from 'app/mixins/apiMixin';
 import {t} from 'app/locale';
 
diff --git a/src/sentry/static/sentry/app/components/events/eventEntries.jsx b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
index 9cf9413a3b..e43c5f71a5 100644
--- a/src/sentry/static/sentry/app/components/events/eventEntries.jsx
+++ b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
@@ -3,7 +3,7 @@ import React from 'react';
 
 import createReactClass from 'create-react-class';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import {logException} from 'app/utils/logging';
 import EventAttachments from 'app/components/events/eventAttachments';
 import EventCause from 'app/components/events/eventCause';
diff --git a/src/sentry/static/sentry/app/components/modals/commandPalette.jsx b/src/sentry/static/sentry/app/components/modals/commandPalette.jsx
index e558caa0d9..72395c13bb 100644
--- a/src/sentry/static/sentry/app/components/modals/commandPalette.jsx
+++ b/src/sentry/static/sentry/app/components/modals/commandPalette.jsx
@@ -6,7 +6,7 @@ import {t} from 'app/locale';
 import Search from 'app/components/search';
 import SearchResult from 'app/components/search/searchResult';
 import SearchResultWrapper from 'app/components/search/searchResultWrapper';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 
 const dropdownStyle = css`
   width: 100%;
diff --git a/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx b/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
index fbdeaf80ed..8074ac33c1 100644
--- a/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
+++ b/src/sentry/static/sentry/app/components/onboardingWizard/toDoItem.jsx
@@ -6,7 +6,7 @@ import classNames from 'classnames';
 
 import {t, tct} from 'app/locale';
 import sdk from 'app/utils/sdk';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import OrganizationState from 'app/mixins/organizationState';
 import Confirmation from 'app/components/onboardingWizard/confirmation';
 
diff --git a/src/sentry/static/sentry/app/components/organizations/multipleProjectSelector.jsx b/src/sentry/static/sentry/app/components/organizations/multipleProjectSelector.jsx
index 8f39ba7367..2b020b5a19 100644
--- a/src/sentry/static/sentry/app/components/organizations/multipleProjectSelector.jsx
+++ b/src/sentry/static/sentry/app/components/organizations/multipleProjectSelector.jsx
@@ -43,13 +43,7 @@ export default class MultipleProjectSelector extends React.Component {
   };
 
   render() {
-    const {
-      className,
-      anchorRight,
-      value,
-      projects,
-      onChange,
-    } = this.props;
+    const {className, anchorRight, value, projects, onChange} = this.props;
     const selectedProjectIds = new Set(value);
 
     const projectList = projects
@@ -68,10 +62,7 @@ export default class MultipleProjectSelector extends React.Component {
     });
 
     return (
-      <HeaderItem
-        className={className}
-        label={t('Project(s)')}
-      >
+      <HeaderItem className={className} label={t('Project(s)')}>
         <DropdownLink
           title={<Title>{summary}</Title>}
           anchorRight={anchorRight}
@@ -98,7 +89,6 @@ export default class MultipleProjectSelector extends React.Component {
   }
 }
 
-
 const Title = styled.span`
   padding-right: 40px;
-`;
\ No newline at end of file
+`;
diff --git a/src/sentry/static/sentry/app/components/resourceCard.jsx b/src/sentry/static/sentry/app/components/resourceCard.jsx
index 80e99b05ad..a6ab33a1a6 100644
--- a/src/sentry/static/sentry/app/components/resourceCard.jsx
+++ b/src/sentry/static/sentry/app/components/resourceCard.jsx
@@ -2,7 +2,7 @@ import React from 'react';
 import PropTypes from 'prop-types';
 import styled from 'react-emotion';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ConfigStore from 'app/stores/configStore';
 import ExternalLink from 'app/components/externalLink';
 import {Panel} from 'app/components/panels';
diff --git a/src/sentry/static/sentry/app/components/search/index.jsx b/src/sentry/static/sentry/app/components/search/index.jsx
index beefa061dd..3a7d34c875 100644
--- a/src/sentry/static/sentry/app/components/search/index.jsx
+++ b/src/sentry/static/sentry/app/components/search/index.jsx
@@ -7,7 +7,7 @@ import {debounce} from 'lodash';
 
 import {navigateTo} from 'app/actionCreators/navigation';
 import {t} from 'app/locale';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import AutoComplete from 'app/components/autoComplete';
 import LoadingIndicator from 'app/components/loadingIndicator';
 import SearchResult from 'app/components/search/searchResult';
diff --git a/src/sentry/static/sentry/app/components/sidebar/onboardingStatus.jsx b/src/sentry/static/sentry/app/components/sidebar/onboardingStatus.jsx
index 15093f932b..65daec4153 100644
--- a/src/sentry/static/sentry/app/components/sidebar/onboardingStatus.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/onboardingStatus.jsx
@@ -1,7 +1,7 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import {t} from '../../locale';
 import SidebarPanel from './sidebarPanel';
 import TodoList from '../onboardingWizard/todos';
diff --git a/src/sentry/static/sentry/app/stores/guideStore.jsx b/src/sentry/static/sentry/app/stores/guideStore.jsx
index 8a15ef04e1..80de9265d9 100644
--- a/src/sentry/static/sentry/app/stores/guideStore.jsx
+++ b/src/sentry/static/sentry/app/stores/guideStore.jsx
@@ -2,7 +2,7 @@ import {browserHistory} from 'react-router';
 import Reflux from 'reflux';
 import GuideActions from 'app/actions/guideActions';
 import OrganizationsActions from 'app/actions/organizationsActions';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ProjectActions from 'app/actions/projectActions';
 import {Client} from 'app/api';
 import ConfigStore from 'app/stores/configStore';
diff --git a/src/sentry/static/sentry/app/stores/hookStore.jsx b/src/sentry/static/sentry/app/stores/hookStore.jsx
index 4c1cb20dc2..0bfc23182d 100644
--- a/src/sentry/static/sentry/app/stores/hookStore.jsx
+++ b/src/sentry/static/sentry/app/stores/hookStore.jsx
@@ -18,7 +18,7 @@ let validHookNames = new Set([
   'project:custom-inbound-filters:disabled',
   'project:discard-groups:disabled',
   'issue:secondary-column',
-  'analytics:onboarding-complete',
+  'amplitude:event',
   'analytics:event',
   'analytics:log-experiment',
   'sidebar:organization-dropdown-menu',
diff --git a/src/sentry/static/sentry/app/utils/analytics.jsx b/src/sentry/static/sentry/app/utils/analytics.jsx
index 68112d54d1..401d0c9ad2 100644
--- a/src/sentry/static/sentry/app/utils/analytics.jsx
+++ b/src/sentry/static/sentry/app/utils/analytics.jsx
@@ -1,12 +1,18 @@
 import HookStore from 'app/stores/hookStore';
 
 /**
- * Note, you will need to add the event `name` to the inclusion list in redash
- * See: https://github.com/getsentry/reload/blob/master/reload_app/app.py#L20
+ * If the backend for `analytics` is reload, you will need to add the event `name`
+ * to the inclusion list in https://github.com/getsentry/reload/blob/master/reload_app/events.py
  *
  * @param {String} name The name of the event
  * @param {Object} data Additional event data to record
  */
-export default function analytics(name, data) {
+function analytics(name, data) {
   HookStore.get('analytics:event').forEach(cb => cb(name, data));
 }
+
+function amplitude(name, organization_id, data) {
+  HookStore.get('amplitude:event').forEach(cb => cb(name, organization_id, data));
+}
+
+export {amplitude, analytics};
diff --git a/src/sentry/static/sentry/app/views/groupDetails.jsx b/src/sentry/static/sentry/app/views/groupDetails.jsx
index a77078dba8..959db5810d 100644
--- a/src/sentry/static/sentry/app/views/groupDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails.jsx
@@ -5,7 +5,7 @@ import Reflux from 'reflux';
 import {browserHistory} from 'react-router';
 import DocumentTitle from 'react-document-title';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ApiMixin from 'app/mixins/apiMixin';
 import GroupHeader from 'app/views/groupDetails/header';
 import GroupStore from 'app/stores/groupStore';
diff --git a/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx b/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
index 152d6eff22..3a97a4c99a 100644
--- a/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
+++ b/src/sentry/static/sentry/app/views/onboarding/configure/index.jsx
@@ -3,9 +3,8 @@ import createReactClass from 'create-react-class';
 import {browserHistory} from 'react-router';
 
 import sdk from 'app/utils/sdk';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ApiMixin from 'app/mixins/apiMixin';
-import HookStore from 'app/stores/hookStore';
 import ProjectContext from 'app/views/projects/projectContext';
 import ProjectDocsContext from 'app/views/projectInstall/docsContext';
 import ProjectInstallPlatform from 'app/views/projectInstall/platform';
@@ -89,7 +88,6 @@ const Configure = createReactClass({
   },
 
   submit() {
-    HookStore.get('analytics:onboarding-complete').forEach(cb => cb());
     analytics('onboarding.complete', {project: this.props.params.projectId});
     this.redirectUrl();
   },
diff --git a/src/sentry/static/sentry/app/views/onboarding/project/index.jsx b/src/sentry/static/sentry/app/views/onboarding/project/index.jsx
index 094aa46813..1449b943da 100644
--- a/src/sentry/static/sentry/app/views/onboarding/project/index.jsx
+++ b/src/sentry/static/sentry/app/views/onboarding/project/index.jsx
@@ -2,7 +2,7 @@ import PropTypes from 'prop-types';
 import React from 'react';
 import classnames from 'classnames';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import PlatformPicker from 'app/views/onboarding/project/platformpicker';
 import PlatformiconTile from 'app/views/onboarding/project/platformiconTile';
 import SelectField from 'app/components/forms/selectField';
diff --git a/src/sentry/static/sentry/app/views/onboarding/project/platformpicker.jsx b/src/sentry/static/sentry/app/views/onboarding/project/platformpicker.jsx
index 5320fa9379..5fdb71b2d3 100644
--- a/src/sentry/static/sentry/app/views/onboarding/project/platformpicker.jsx
+++ b/src/sentry/static/sentry/app/views/onboarding/project/platformpicker.jsx
@@ -3,7 +3,7 @@ import React from 'react';
 import classnames from 'classnames';
 import _ from 'lodash';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ListLink from 'app/components/listLink';
 import NavTabs from 'app/components/navTabs';
 import {flattenedPlatforms, categoryList} from 'app/views/onboarding/utils';
diff --git a/src/sentry/static/sentry/app/views/organizationDashboard/resources.jsx b/src/sentry/static/sentry/app/views/organizationDashboard/resources.jsx
index 85bc4d2513..9c3505ed77 100644
--- a/src/sentry/static/sentry/app/views/organizationDashboard/resources.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDashboard/resources.jsx
@@ -2,7 +2,7 @@ import React from 'react';
 import {Flex} from 'grid-emotion';
 import styled from 'react-emotion';
 
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import ResourceCard from 'app/components/resourceCard';
 import SentryTypes from 'app/sentryTypes';
 import ErrorRobot from 'app/components/errorRobot';
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/analytics.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/analytics.jsx
index 3c73243506..f4d782a6c9 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/analytics.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/analytics.jsx
@@ -1,4 +1,4 @@
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 
 /**
  * Takes an organization and query and tracks in Redash as discover.query.
diff --git a/src/sentry/static/sentry/app/views/stream/stream.jsx b/src/sentry/static/sentry/app/views/stream/stream.jsx
index c0b24515f3..3b64568647 100644
--- a/src/sentry/static/sentry/app/views/stream/stream.jsx
+++ b/src/sentry/static/sentry/app/views/stream/stream.jsx
@@ -30,7 +30,7 @@ import StreamFilters from 'app/views/stream/filters';
 import StreamGroup from 'app/components/stream/group';
 import StreamSidebar from 'app/views/stream/sidebar';
 import TimeSince from 'app/components/timeSince';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 import parseApiError from 'app/utils/parseApiError';
 import parseLinkHeader from 'app/utils/parseLinkHeader';
 import queryString from 'app/utils/queryString';
diff --git a/tests/js/spec/views/organizationDiscover/analytics.spec.jsx b/tests/js/spec/views/organizationDiscover/analytics.spec.jsx
index dc1bde32b1..0ec22e8d3a 100644
--- a/tests/js/spec/views/organizationDiscover/analytics.spec.jsx
+++ b/tests/js/spec/views/organizationDiscover/analytics.spec.jsx
@@ -1,7 +1,7 @@
 import {trackQuery} from 'app/views/organizationDiscover/analytics';
-import analytics from 'app/utils/analytics';
+import {analytics} from 'app/utils/analytics';
 
-jest.mock('app/utils/analytics', () => jest.fn(fn => fn));
+jest.mock('app/utils/analytics');
 
 describe('Analytics', function() {
   beforeEach(function() {
