commit a9a252bfba7684768f778d85e9c7acfd09f19a1b
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Jun 8 17:40:54 2016 -0700

    Fix bad type on message (#3452)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 03c9fa483b..8be8a2426c 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -17,7 +17,7 @@ from django.conf import settings
 from django.db import connection, IntegrityError, router, transaction
 from django.db.models import Q
 from django.utils import timezone
-from django.utils.encoding import force_bytes
+from django.utils.encoding import force_bytes, force_text
 from hashlib import md5
 from uuid import uuid4
 
@@ -480,8 +480,11 @@ class EventManager(object):
 
         if not message:
             message = ''
+        elif not isinstance(message, basestring):
+            message = force_text(message)
+
         for value in event_metadata.itervalues():
-            value_u = unicode(value)
+            value_u = force_text(value, errors='replace')
             if value_u not in message:
                 message = u'{} {}'.format(message, value_u)
 
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index 6916b2652d..ab4d6a328a 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -605,7 +605,7 @@ class EventManagerTest(TransactionTestCase):
     def test_no_message(self):
         # test that the message is handled gracefully
         manager = EventManager(self.make_event(**{
-            'message': '',
+            'message': None,
             'sentry.interfaces.Message': {
                 'message': 'hello world',
             },
@@ -615,6 +615,19 @@ class EventManagerTest(TransactionTestCase):
 
         assert event.message == 'hello world'
 
+    def test_bad_message(self):
+        # test that the message is handled gracefully
+        manager = EventManager(self.make_event(**{
+            'message': 1234,
+            'sentry.interfaces.Message': {
+                'message': 'hello world',
+            },
+        }))
+        manager.normalize()
+        event = manager.save(self.project.id)
+
+        assert event.message == '1234 hello world'
+
 
 class GetHashesFromEventTest(TestCase):
     @patch('sentry.interfaces.stacktrace.Stacktrace.compute_hashes')
