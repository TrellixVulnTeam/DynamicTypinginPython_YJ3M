commit cf2599c42bdaf41e03a12e3a80b8c8830369fb8c
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Aug 24 12:26:32 2013 -0700

    Add tests for discover_sourcemap

diff --git a/tests/sentry/tasks/fetch_source/tests.py b/tests/sentry/tasks/fetch_source/tests.py
index 78d00d64ab..d5498c40e4 100644
--- a/tests/sentry/tasks/fetch_source/tests.py
+++ b/tests/sentry/tasks/fetch_source/tests.py
@@ -4,10 +4,40 @@ from __future__ import absolute_import
 
 import mock
 
-from sentry.tasks.fetch_source import expand_javascript_source
+from sentry.tasks.fetch_source import (
+    UrlResult, expand_javascript_source, discover_sourcemap)
 from sentry.testutils import TestCase
 
 
+class DiscoverSourcemapTest(TestCase):
+    # discover_sourcemap(result)
+    def test_simple(self):
+        result = UrlResult('http://example.com', {}, '')
+        assert discover_sourcemap(result) is None
+
+        result = UrlResult('http://example.com', {
+            'x-sourcemap': 'http://example.com/source.map.js'
+        }, '')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+        result = UrlResult('http://example.com', {
+            'sourcemap': 'http://example.com/source.map.js'
+        }, '')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+        result = UrlResult('http://example.com', {}, '//@ sourceMappingURL=http://example.com/source.map.js\nconsole.log(true)')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+        result = UrlResult('http://example.com', {}, '//# sourceMappingURL=http://example.com/source.map.js\nconsole.log(true)')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+        result = UrlResult('http://example.com', {}, 'console.log(true)\n//@ sourceMappingURL=http://example.com/source.map.js')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+        result = UrlResult('http://example.com', {}, 'console.log(true)\n//# sourceMappingURL=http://example.com/source.map.js')
+        assert discover_sourcemap(result) == 'http://example.com/source.map.js'
+
+
 class ExpandJavascriptSourceTest(TestCase):
     @mock.patch('sentry.models.Event.update')
     @mock.patch('sentry.tasks.fetch_source.fetch_url')
