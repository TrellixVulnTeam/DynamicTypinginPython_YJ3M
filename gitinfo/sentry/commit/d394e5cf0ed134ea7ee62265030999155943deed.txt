commit d394e5cf0ed134ea7ee62265030999155943deed
Author: Dan Fuller <dfuller@sentry.io>
Date:   Wed Apr 22 13:45:10 2020 -0700

    fix(mail): Fix issue with "None" string in some rule actions (#18413)
    
    After the migration we have "None" in some actions in rules, where it should be None or an integer.
    This works around the issue

diff --git a/src/sentry/mail/actions.py b/src/sentry/mail/actions.py
index ef40dd1f0b..ea9c8a9b49 100644
--- a/src/sentry/mail/actions.py
+++ b/src/sentry/mail/actions.py
@@ -2,7 +2,6 @@ from __future__ import absolute_import
 
 from django import forms
 
-from sentry.db.models.fields.bounded import BoundedBigIntegerField
 from sentry.mail.adapter import ActionTargetType, MailAdapter
 from sentry.models import Project, User
 from sentry.rules.actions.base import EventAction
@@ -18,7 +17,7 @@ CHOICES = [
 
 class NotifyEmailForm(forms.Form):
     targetType = forms.ChoiceField(choices=CHOICES)
-    targetIdentifier = BoundedBigIntegerField().formfield(
+    targetIdentifier = forms.CharField(
         required=False, help_text="Only required if 'Member' or 'Team' is selected"
     )
 
@@ -26,6 +25,18 @@ class NotifyEmailForm(forms.Form):
         super(NotifyEmailForm, self).__init__(*args, **kwargs)
         self.project = project
 
+    def clean_targetIdentifier(self):
+        targetIdentifier = self.cleaned_data.get("targetIdentifier")
+        # XXX: Clean up some bad data in the database
+        if targetIdentifier == "None":
+            targetIdentifier = None
+        if targetIdentifier:
+            try:
+                targetIdentifier = int(targetIdentifier)
+            except ValueError:
+                raise forms.ValidationError("targetIdentifier must be an integer")
+        return targetIdentifier
+
     def clean(self):
         cleaned_data = super(NotifyEmailForm, self).clean()
         try:
diff --git a/tests/sentry/mail/test_actions.py b/tests/sentry/mail/test_actions.py
index 1b6f3959ed..d2fda5d1a4 100644
--- a/tests/sentry/mail/test_actions.py
+++ b/tests/sentry/mail/test_actions.py
@@ -85,6 +85,12 @@ class NotifyEmailFormTest(TestCase):
         form = self.form_from_values(ActionTargetType.MEMBER.value, self.inactive_user)
         assert not form.is_valid()
 
+    def test_none_target_identifier(self):
+        json = {self.TARGET_TYPE_KEY: ActionTargetType.ISSUE_OWNERS.value}
+        json[self.TARGET_IDENTIFIER_KEY] = "None"
+        form = self.form_from_json(json)
+        assert form.is_valid()
+
 
 class NotifyEmailTest(RuleTestCase):
     rule_cls = NotifyEmailAction
