commit b6c6c673aac9e81aa9d1b2b71cec36483ceeb398
Author: NisanthanNanthakumar <nisanthan.nanthakumar@sentry.io>
Date:   Thu Mar 12 14:04:54 2020 -0700

    feat(IntegrationDirectory): Update integrationListDirectory to use experiment variant (#17601)
    
    Objective
    Control which version of the sort is used in the Integration Directory with the IntegrationDirectorySortWeightExperiment Planout experiment.
    
    Associate PR in GetSentry: getsentry/getsentry#3658

diff --git a/src/sentry/static/sentry/app/types/index.tsx b/src/sentry/static/sentry/app/types/index.tsx
index 945f1084fa..63bf15781d 100644
--- a/src/sentry/static/sentry/app/types/index.tsx
+++ b/src/sentry/static/sentry/app/types/index.tsx
@@ -839,6 +839,7 @@ export type SentryAppComponent = {
 export type ActiveExperiments = {
   TrialUpgradeV2Experiment: 'upgrade' | 'trial' | -1;
   AlertDefaultsExperiment: 'controlV1' | '2OptionsV1' | '3OptionsV2';
+  IntegrationDirectorySortWeightExperiment: '1' | '0';
 };
 
 type SavedQueryVersions = 1 | 2;
diff --git a/src/sentry/static/sentry/app/utils/integrationUtil.tsx b/src/sentry/static/sentry/app/utils/integrationUtil.tsx
index 585829628f..f816e60cb3 100644
--- a/src/sentry/static/sentry/app/utils/integrationUtil.tsx
+++ b/src/sentry/static/sentry/app/utils/integrationUtil.tsx
@@ -28,8 +28,17 @@ export const clearAnalyticsSession = () => {
 export const getAnalyticsSessionId = () =>
   window.sessionStorage.getItem(INTEGRATIONS_ANALYTICS_SESSION_KEY);
 
-export const getSortIntegrationsByWeightActive = () =>
-  localStorage.getItem(SORT_INTEGRATIONS_BY_WEIGHT) === '1';
+export const getSortIntegrationsByWeightActive = (organization?: Organization) => {
+  const variant = organization?.experiments?.IntegrationDirectorySortWeightExperiment;
+  switch (localStorage.getItem(SORT_INTEGRATIONS_BY_WEIGHT)) {
+    case '1':
+      return true;
+    case '0':
+      return false;
+    default:
+      return variant && variant === '1';
+  }
+};
 
 export type SingleIntegrationEvent = {
   eventKey:
diff --git a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationListDirectory.tsx b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationListDirectory.tsx
index 6d3ac43f09..880ad6d7b2 100644
--- a/src/sentry/static/sentry/app/views/organizationIntegrations/integrationListDirectory.tsx
+++ b/src/sentry/static/sentry/app/views/organizationIntegrations/integrationListDirectory.tsx
@@ -28,6 +28,7 @@ import withOrganization from 'app/utils/withOrganization';
 import SearchInput from 'app/components/forms/searchInput';
 import {createFuzzySearch} from 'app/utils/createFuzzySearch';
 import space from 'app/styles/space';
+import {logExperiment} from 'app/utils/analytics';
 
 import {POPULARITY_WEIGHT} from './constants';
 import IntegrationRow from './integrationRow';
@@ -79,6 +80,16 @@ export class OrganizationIntegrations extends AsyncComponent<
     organization: SentryTypes.Organization,
   };
 
+  componentDidMount() {
+    logExperiment({
+      organization: this.props.organization,
+      key: 'IntegrationDirectorySortWeightExperiment',
+      unitName: 'org_id',
+      unitId: parseInt(this.props.organization.id, 10),
+      param: 'variant',
+    });
+  }
+
   getDefaultState() {
     return {
       ...super.getDefaultState(),
@@ -224,7 +235,7 @@ export class OrganizationIntegrations extends AsyncComponent<
     this.getInstallValue(b) - this.getInstallValue(a);
 
   sortIntegrations(integrations: AppOrProviderOrPlugin[]) {
-    if (getSortIntegrationsByWeightActive()) {
+    if (getSortIntegrationsByWeightActive(this.props.organization)) {
       return integrations
         .sort(this.sortByName)
         .sort(this.sortByPopularity)
