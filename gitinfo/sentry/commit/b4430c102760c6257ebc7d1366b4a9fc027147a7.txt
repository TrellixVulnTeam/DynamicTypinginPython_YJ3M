commit b4430c102760c6257ebc7d1366b4a9fc027147a7
Author: David Cramer <dcramer@gmail.com>
Date:   Tue May 17 13:29:07 2016 -0500

    Handle issues migration URLs in API docs

diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index 5fdeae539f..06ba45ad2c 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -174,10 +174,10 @@ urlpatterns = patterns(
     url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/$',
         TeamDetailsEndpoint.as_view(),
         name='sentry-api-0-team-details'),
-    url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/(?:groups|issues)/new/$',
+    url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/(?:issues|groups)/new/$',
         TeamGroupsNewEndpoint.as_view(),
         name='sentry-api-0-team-groups-new'),
-    url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/(?:groups|issues)/trending/$',
+    url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/(?:issues|groups)/trending/$',
         TeamGroupsTrendingEndpoint.as_view(),
         name='sentry-api-0-team-groups-trending'),
     url(r'^teams/(?P<organization_slug>[^\/]+)/(?P<team_slug>[^\/]+)/members/$',
@@ -214,10 +214,10 @@ urlpatterns = patterns(
     url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/events/(?P<event_id>[\w-]+)/$',
         ProjectEventDetailsEndpoint.as_view(),
         name='sentry-api-0-project-event-details'),
-    url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/(?:groups|issues)/$',
+    url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/(?:issues|groups)/$',
         ProjectGroupIndexEndpoint.as_view(),
         name='sentry-api-0-project-group-index'),
-    url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/(?:groups|issues)/stats/$',
+    url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/(?:issues|groups)/stats/$',
         ProjectGroupStatsEndpoint.as_view(),
         name='sentry-api-0-project-group-stats'),
     url(r'^projects/(?P<organization_slug>[^\/]+)/(?P<project_slug>[^\/]+)/keys/$',
@@ -279,44 +279,44 @@ urlpatterns = patterns(
         name='sentry-api-0-project-user-reports'),
 
     # Groups
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/$',
         GroupDetailsEndpoint.as_view(),
         name='sentry-api-0-group-details'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/events/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/events/$',
         GroupEventsEndpoint.as_view(),
         name='sentry-api-0-group-events'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/events/latest/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/events/latest/$',
         GroupEventsLatestEndpoint.as_view(),
         name='sentry-api-0-group-events-latest'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/events/oldest/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/events/oldest/$',
         GroupEventsOldestEndpoint.as_view(),
         name='sentry-api-0-group-events-oldest'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/(?:notes|comments)/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/(?:notes|comments)/$',
         GroupNotesEndpoint.as_view(),
         name='sentry-api-0-group-notes'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/(?:notes|comments)/(?P<note_id>[^\/]+)/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/(?:notes|comments)/(?P<note_id>[^\/]+)/$',
         GroupNotesDetailsEndpoint.as_view(),
         name='sentry-api-0-group-notes-details'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/hashes/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/hashes/$',
         GroupHashesEndpoint.as_view(),
         name='sentry-api-0-group-events'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/stats/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/stats/$',
         GroupStatsEndpoint.as_view(),
         name='sentry-api-0-group-stats'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/tags/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/tags/$',
         GroupTagsEndpoint.as_view(),
         name='sentry-api-0-group-tags'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/tags/(?P<key>[^/]+)/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/tags/(?P<key>[^/]+)/$',
         GroupTagKeyDetailsEndpoint.as_view(),
         name='sentry-api-0-group-tagkey-details'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/tags/(?P<key>[^/]+)/values/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/tags/(?P<key>[^/]+)/values/$',
         GroupTagKeyValuesEndpoint.as_view(),
         name='sentry-api-0-group-tagkey-values'),
-    url(r'^(?:groups|issues)/(?P<issue_id>\d+)/user-reports/$',
+    url(r'^(?:issues|groups)/(?P<issue_id>\d+)/user-reports/$',
         GroupUserReportsEndpoint.as_view(),
         name='sentry-api-0-group-user-reports'),
 
-    url(r'^shared/(?:groups|issues)/(?P<share_id>[^\/]+)/$',
+    url(r'^shared/(?:issues|groups)/(?P<share_id>[^\/]+)/$',
         SharedGroupDetailsEndpoint.as_view(),
         name='sentry-api-0-shared-group-details'),
 
diff --git a/src/sentry/utils/apidocs.py b/src/sentry/utils/apidocs.py
index b9f760af2b..8ee8aa559d 100644
--- a/src/sentry/utils/apidocs.py
+++ b/src/sentry/utils/apidocs.py
@@ -19,9 +19,11 @@ from django.conf import settings
 # Do not import from sentry here!  Bad things will happen
 
 
-optional_group_matcher = re.compile(r'\(\?\:(.+)\)')
+optional_group_matcher = re.compile(r'\(\?\:([^\)]+)\)')
 named_group_matcher = re.compile(r'\(\?P<(\w+)>[^\)]+\)')
-non_named_group_matcher = re.compile(r'\(.*?\)')
+non_named_group_matcher = re.compile(r'\([^\)]+\)')
+# [foo|bar|baz]
+either_option_matcher = re.compile(r'\[([^\]]+)\|([^\]]+)\]')
 camel_re = re.compile(r'([A-Z]+)([a-z])')
 
 
@@ -45,6 +47,9 @@ def simplify_regex(pattern):
     # handle non-named groups
     pattern = non_named_group_matcher.sub("{var}", pattern)
 
+    # handle optional params
+    pattern = either_option_matcher.sub(lambda m: m.group(1), pattern)
+
     # clean up any outstanding regex-y characters.
     pattern = pattern.replace('^', '').replace('$', '') \
         .replace('?', '').replace('//', '/').replace('\\', '')
