commit 07651776c5557e2782045271c2c6dffb7ba5f2e5
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Dec 14 14:18:27 2014 -0800

    Restrict organization nav based on access

diff --git a/src/sentry/templates/sentry/bases/organization.html b/src/sentry/templates/sentry/bases/organization.html
index d32363e2e0..a78521e8cd 100644
--- a/src/sentry/templates/sentry/bases/organization.html
+++ b/src/sentry/templates/sentry/bases/organization.html
@@ -32,16 +32,17 @@
         {% trans "Teams" %}
       </a>
     </li>
-    <li class="{% block org_members_nav %}{% endblock %}">
-      <a href="{% url 'sentry-organization-members' organization.slug %}">
-        {% trans "Members" %}
-      </a>
-    </li>
     <li class="{% block org_stats_nav %}{% endblock %}">
       <a href="{% url 'sentry-organization-stats' organization.slug %}">
         {% trans "Stats" %}
       </a>
     </li>
+    {% if ACCESS.is_global and ACCESS.is_admin %}
+    <li class="{% block org_members_nav %}{% endblock %}">
+      <a href="{% url 'sentry-organization-members' organization.slug %}">
+        {% trans "Members" %}
+      </a>
+    </li>
     <li class="{% block org_auditlog_nav %}{% endblock %}">
       <a href="{% url 'sentry-organization-audit-log' organization.slug %}">
         {% trans "Audit Log" %}
@@ -52,6 +53,7 @@
         {% trans "Settings" %}
       </a>
     </li>
+    {% endif %}
   </ul>
   {% block org_sidebar_nav_extra %}
     {% comment %}This block is used by getsentry.com{% endcomment %}
diff --git a/src/sentry/web/frontend/base.py b/src/sentry/web/frontend/base.py
index bb10a0dd48..6375c525e5 100644
--- a/src/sentry/web/frontend/base.py
+++ b/src/sentry/web/frontend/base.py
@@ -10,10 +10,29 @@ from django.views.decorators.csrf import csrf_protect
 from django.views.generic import View
 from sudo.views import redirect_to_sudo
 
-from sentry.models import Organization, Project, Team
+from sentry.models import (
+    Organization, OrganizationMember, OrganizationMemberType, Project, Team
+)
 from sentry.web.helpers import get_login_url, render_to_response
 
 
+class Access(object):
+    def __init__(self, is_global, type):
+        self.is_global = is_global
+        self.type = type
+
+    def has_access(self, type):
+        return self.type <= type
+
+    @property
+    def is_admin(self):
+        return self.has_access(OrganizationMemberType.ADMIN)
+
+    @property
+    def is_owner(self):
+        return self.has_access(OrganizationMemberType.OWNER)
+
+
 class OrganizationMixin(object):
     def get_active_organization(self, request, organization_slug=None,
                                 access=None):
@@ -176,6 +195,16 @@ class OrganizationView(BaseView):
         context['organization'] = organization
         context['TEAM_LIST'] = self.get_team_list(request.user, organization)
 
+        if request.user.is_superuser:
+            access = Access(is_global=True, type=OrganizationMemberType.OWNER)
+        else:
+            om = OrganizationMember.objects.get(
+                user=request.user, organization=organization
+            )
+            access = Access(is_global=om.has_global_access, type=om.type)
+
+        context['ACCESS'] = access
+
         return context
 
     def has_permission(self, request, organization, *args, **kwargs):
@@ -260,7 +289,6 @@ class ProjectView(BaseView):
         context['project'] = project
         context['team'] = team
         context['TEAM_LIST'] = self.get_team_list(request.user, organization)
-
         return context
 
     def has_permission(self, request, organization, team, project, *args, **kwargs):
