commit 23b9ececfba6deab270568db12cbf77ef109e57d
Author: ted kaemming <ted@kaemming.com>
Date:   Mon Jun 25 11:22:11 2018 -0700

    fix(snuba): Add `orderby` to `tagstore.get_group_event_filter` (#8803)

diff --git a/src/sentry/tagstore/snuba/backend.py b/src/sentry/tagstore/snuba/backend.py
index bd0a9698e3..e9c4b46fea 100644
--- a/src/sentry/tagstore/snuba/backend.py
+++ b/src/sentry/tagstore/snuba/backend.py
@@ -383,13 +383,16 @@ class SnubaTagStorage(TagStorage):
 
         conditions = [[['tags[{}]'.format(k), '=', v] for (k, v) in tags.items()]]
 
-        result = snuba.query(start, end, groupby=['event_id'], conditions=conditions,
-                             filter_keys=filters, limit=1000, referrer='tagstore.get_group_event_filter')
+        result = snuba.raw_query(start, end, selected_columns=['event_id'],
+                                 conditions=conditions, orderby='-timestamp', filter_keys=filters,
+                                 limit=1000, referrer='tagstore.get_group_event_filter')
 
-        if not result:
+        event_id_set = set(row['event_id'] for row in result['data'])
+
+        if not event_id_set:
             return None
 
-        return {'event_id__in': set(result.keys())}
+        return {'event_id__in': event_id_set}
 
     def get_group_ids_for_search_filter(
             self, project_id, environment_id, tags, candidates=None, limit=1000):
diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 3f968e5a24..e346d50aeb 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -43,7 +43,7 @@ _snuba_pool = urllib3.connectionpool.connection_from_url(
 )
 
 
-def raw_query(start, end, groupby, conditions=None, filter_keys=None,
+def raw_query(start, end, groupby=None, conditions=None, filter_keys=None,
               aggregations=None, rollup=None, arrayjoin=None, limit=None, orderby=None,
               having=None, referrer=None, is_grouprelease=False, selected_columns=None,):
     """
