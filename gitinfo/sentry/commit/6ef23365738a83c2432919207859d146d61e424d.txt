commit 6ef23365738a83c2432919207859d146d61e424d
Author: evanh <evanh@users.noreply.github.com>
Date:   Mon Apr 27 15:41:16 2020 -0400

    fix(discover) Fix rare nan edge case (#18487)
    
    It is possible to get a 'nan' value back from snuba if there are no results in
    the query sent and the query uses a duration aggregate on the events table.
    Handle this by coercing to 0.

diff --git a/src/sentry/snuba/discover.py b/src/sentry/snuba/discover.py
index a178b4c1de..e236002c09 100644
--- a/src/sentry/snuba/discover.py
+++ b/src/sentry/snuba/discover.py
@@ -1,5 +1,6 @@
 from __future__ import absolute_import
 
+import math
 import six
 
 from collections import namedtuple
@@ -425,7 +426,12 @@ def transform_results(result, translated_columns, snuba_filter, selected_columns
     result["meta"] = meta
 
     def get_row(row):
-        transformed = {translated_columns.get(key, key): value for key, value in row.items()}
+        transformed = {}
+        for key, value in row.items():
+            if isinstance(value, float) and math.isnan(value):
+                value = 0
+            transformed[translated_columns.get(key, key)] = value
+
         if has_user:
             for field in user_fields:
                 if field in transformed and transformed[field]:
