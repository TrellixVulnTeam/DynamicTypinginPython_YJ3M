commit f8986e0b252977ea788920f6da1504000e2fa57f
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Apr 5 12:16:03 2016 -0700

    Add more test coverage for merging

diff --git a/tests/sentry/tasks/test_merge.py b/tests/sentry/tasks/test_merge.py
index 317e539141..df785a91a1 100644
--- a/tests/sentry/tasks/test_merge.py
+++ b/tests/sentry/tasks/test_merge.py
@@ -1,7 +1,7 @@
 from __future__ import absolute_import
 
 from sentry.tasks.merge import merge_group, rehash_group_events
-from sentry.models import Event, Group, GroupRedirect, GroupTagKey
+from sentry.models import Event, Group, GroupRedirect, GroupTagKey, GroupTagValue
 from sentry.testutils import TestCase
 
 
@@ -68,17 +68,43 @@ class MergeGroupTest(TestCase):
                 key='foo',
                 values_seen=5,
             )
+            GroupTagValue.objects.create(
+                project=project,
+                group=group,
+                key='key1',
+                times_seen=1,
+            )
+            GroupTagValue.objects.create(
+                project=project,
+                group=group,
+                key='key2',
+                times_seen=5,
+            )
 
         with self.tasks():
             merge_group(groups[0].id, groups[1].id)
 
         assert not Group.objects.filter(id=groups[0].id).exists()
         assert not GroupTagKey.objects.filter(group_id=groups[0].id).exists()
+        assert not GroupTagValue.objects.filter(group_id=groups[0].id).exists()
 
         assert GroupTagKey.objects.get(
             group_id=groups[1].id,
             key='sentry:user',
         ).values_seen == 2
+        assert GroupTagKey.objects.get(
+            group_id=groups[1].id,
+            key='foo',
+        ).values_seen == 10
+
+        assert GroupTagValue.objects.get(
+            group_id=groups[1].id,
+            key='key1',
+        ).times_seen == 2
+        assert GroupTagValue.objects.get(
+            group_id=groups[1].id,
+            key='key2',
+        ).times_seen == 10
 
 
 class RehashGroupEventsTest(TestCase):
