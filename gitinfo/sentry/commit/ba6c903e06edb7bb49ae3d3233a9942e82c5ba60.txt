commit ba6c903e06edb7bb49ae3d3233a9942e82c5ba60
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Nov 15 01:41:19 2012 -0800

    Ensure elements stay sorted correctly

diff --git a/tests/js/spec/OrderedElementsViewSpec.js b/tests/js/spec/OrderedElementsViewSpec.js
index 6ad3fc275a..71256b18ab 100644
--- a/tests/js/spec/OrderedElementsViewSpec.js
+++ b/tests/js/spec/OrderedElementsViewSpec.js
@@ -20,12 +20,17 @@ function make_group(data) {
 
 describe("OrderedElementsView", function() {
   var view;
+  var group1;
+  var group2;
+  var group3;
+  var group4;
 
   beforeEach(function() {
     view = new app.OrderedElementsView({
         id: 'foo',
         maxItems: 3
     });
+    view.$parent = $('<ul></ul>');
   });
 
   it("should bind a collection", function() {
@@ -47,6 +52,20 @@ describe("OrderedElementsView", function() {
       expect(view.collection.length).toBe(1);
     });
 
+    it("truncated to max items", function(){
+      group1 = make_group({id: 1, score: 3});
+      group2 = make_group({id: 2, score: 5});
+      group3 = make_group({id: 3, score: 2});
+      group4 = make_group({id: 4, score: 6});
+
+      view.addMember(group1);
+      view.addMember(group2);
+      view.addMember(group3);
+      view.addMember(group4);
+
+      expect(view.collection.length).toBe(3);
+    });
+
     it("sorts members by score after insert", function(){
       view.addMember(make_group({id: 1, score: 3}));
       view.addMember(make_group({id: 2, score: 5}));
@@ -57,31 +76,24 @@ describe("OrderedElementsView", function() {
   });
 
   describe("renderMemberInContainer", function() {
-    var group1;
-    var group2;
-    var group3;
-    var group4;
-
-    beforeEach(function() {
+    beforeEach(function(){
       group1 = make_group({id: 1, score: 3});
       group2 = make_group({id: 2, score: 5});
       group3 = make_group({id: 3, score: 2});
-      group4 = make_group({id: 4, score: 6});
-
-      view = new app.OrderedElementsView({
-          id: 'dummy',
-          maxItems: 3
-      });
-      view.$parent = $('<ul></ul>');
 
       view.addMember(group1);
       view.addMember(group2);
       view.addMember(group3);
-      view.addMember(group4);
     });
 
-    it("truncated to max items", function(){
-      expect(view.collection.length).toBe(3);
+    it("has the correct number of elements", function(){
+      expect(view.$parent.find('li').length).toBe(view.collection.models.length);
+    });
+
+    it("has list elements sorted correctly", function(){
+      view.$parent.find('li').each(function(_, el){
+        expect(this.id).toBe('foo' + view.collection.models[_].id);
+      });
     });
   });
 });
\ No newline at end of file
