commit 616ef9685d348087909d4979a9a8d75a19593f89
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Apr 8 07:16:41 2015 -0500

    Add basics of single organization mode

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index b5905ff482..9d795401f1 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -567,6 +567,10 @@ SENTRY_ADMIN_EMAIL = ''
 # Allow access to Sentry without authentication.
 SENTRY_PUBLIC = False
 
+# Instruct Sentry that this install intends to be run by a single organization
+# and thus various UI optimizations should be enabled.
+SENTRY_SINGLE_ORGANIZATION = False
+
 # Login url (defaults to LOGIN_URL)
 SENTRY_LOGIN_URL = None
 
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index 14b912b5c3..b8a985dc1e 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -113,29 +113,49 @@
                                 {% block account_nav %}
                                     {% if request.user.is_authenticated %}
                                         <li><a href="{% url 'sentry-help' %}">{% trans "Docs" %}</a></li>
-                                        <li class="dropdown org-dropdown">
-                                          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
-                                            {% if organization %}
-                                              {{ organization.name }}
-                                            {% else %}
-                                              {% trans "Organizations" %}
-                                            {% endif %}
-                                            <span class="caret"></span>
-                                          </a>
-                                          <ul class="dropdown-menu">
+                                        {% with organization_list=request.user|list_organizations %}
+                                        {% if organiation_list %}
+                                            <li class="dropdown org-dropdown">
+                                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
+                                                {% if organization %}
+                                                  {{ organization.name }}
+                                                {% else %}
+                                                  {% trans "Organizations" %}
+                                                {% endif %}
+                                                <span class="caret"></span>
+                                              </a>
+                                              <ul class="dropdown-menu">
+                                                {% feature organizations:create %}
+                                                  <li><h6><a href="{% url 'sentry-create-organization' %}" class="new pull-right"><span class="icon-plus"></span></a>{% trans "Organizations" %}</h6></li>
+                                                {% endfeature %}
+                                                {% for o in organization_list %}
+                                                    <li{% if o == organization %} class="active"{% endif %}>
+                                                        <a href="{% url 'sentry-organization-home' o.slug %}">{{ o.name }}</a>
+                                                        {% if request.user|can_manage_org:o %}
+                                                            <a href="{% url 'sentry-organization-settings' o.slug %}" class="org-settings"><span class="icon-cog"></span></a>
+                                                        {% endif %}
+                                                    </li>
+                                                {% endfor %}
+                                              </ul>
+                                            </li>
+                                        {% else %}
                                             {% feature organizations:create %}
-                                              <li><h6><a href="{% url 'sentry-create-organization' %}" class="new pull-right"><span class="icon-plus"></span></a>{% trans "Organizations" %}</h6></li>
-                                            {% endfeature %}
-                                            {% for o in request.user|list_organizations %}
-                                                <li{% if o == organization %} class="active"{% endif %}>
-                                                    <a href="{% url 'sentry-organization-home' o.slug %}">{{ o.name }}</a>
-                                                    {% if request.user|can_manage_org:o %}
-                                                        <a href="{% url 'sentry-organization-settings' o.slug %}" class="org-settings"><span class="icon-cog"></span></a>
+                                            <li class="dropdown org-dropdown">
+                                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
+                                                    {% if organization %}
+                                                        {{ organization.name }}
+                                                    {% else %}
+                                                        {% trans "Organizations" %}
                                                     {% endif %}
-                                                </li>
-                                            {% endfor %}
-                                          </ul>
-                                        </li>
+                                                    <span class="caret"></span>
+                                                </a>
+                                                <ul class="dropdown-menu">
+                                                    <li><h6><a href="{% url 'sentry-create-organization' %}" class="new pull-right"><span class="icon-plus"></span></a>{% trans "Organizations" %}</h6></li>
+                                                </ul>
+                                            </li>
+                                            {% endfeature %}
+                                        {% endif %}}
+                                        {% endwith %}
                                         <li class="dropdown">
                                             <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img class="avatar" src="{% gravatar_url user.email size 20 %}"> <span class="caret"></span></a>
                                             <ul class="dropdown-menu">
diff --git a/src/sentry/utils/runner.py b/src/sentry/utils/runner.py
index f0b4f18891..06fdf5d6af 100644
--- a/src/sentry/utils/runner.py
+++ b/src/sentry/utils/runner.py
@@ -64,6 +64,10 @@ SENTRY_USE_BIG_INTS = True
 # SENTRY_ADMIN_EMAIL = 'your.name@example.com'
 SENTRY_ADMIN_EMAIL = ''
 
+# Instruct Sentry that this install intends to be run by a single organization
+# and thus various UI optimizations should be enabled.
+SENTRY_SINGLE_ORGANIZATION = True
+
 ###########
 ## Redis ##
 ###########
@@ -325,6 +329,10 @@ def initialize_app(config):
                       'This is not recommended within production environments. '
                       'See http://sentry.readthedocs.org/en/latest/queue/index.html for more information.')
 
+    if settings.SENTRY_SINGLE_ORGANIZATION:
+        # Update default features
+        settings.SENTRY_FEATURES['organizations:create'] = False
+
     initialize_receivers()
 
 
