commit 9fdb5708938a40fd074a9e1a2a6d12ed8e522ddd
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Jun 6 10:09:57 2019 -0700

    ref(ui): Refactor GroupSidebar to not rely on old stores (#13549)
    
    This simplifies `<GroupSidebar>` and `<GroupReleaseStats>` a bit so that they take an environments prop (instead of state and a combination of different stores). This also removes the use of mixins.

diff --git a/src/sentry/static/sentry/app/components/group/releaseStats.jsx b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
index 371364b451..3ef4bab54c 100644
--- a/src/sentry/static/sentry/app/components/group/releaseStats.jsx
+++ b/src/sentry/static/sentry/app/components/group/releaseStats.jsx
@@ -1,13 +1,8 @@
 import PropTypes from 'prop-types';
 import React from 'react';
-import Reflux from 'reflux';
 import createReactClass from 'create-react-class';
 import SentryTypes from 'app/sentryTypes';
-import OrganizationEnvironmentsStore from 'app/stores/organizationEnvironmentsStore';
-import LatestContextStore from 'app/stores/latestContextStore';
-import GlobalSelectionStore from 'app/stores/globalSelectionStore';
 import LoadingIndicator from 'app/components/loadingIndicator';
-import OrganizationState from 'app/mixins/organizationState';
 import GroupReleaseChart from 'app/components/group/releaseChart';
 import SeenInfo from 'app/components/group/seenInfo';
 import {t} from 'app/locale';
@@ -18,45 +13,13 @@ const GroupReleaseStats = createReactClass({
   propTypes: {
     group: SentryTypes.Group.isRequired,
     project: SentryTypes.Project.isRequired,
+    organization: SentryTypes.Organization.isRequired,
+    environments: PropTypes.arrayOf(SentryTypes.Environment),
     allEnvironments: PropTypes.object,
   },
 
-  contextTypes: {
-    organization: PropTypes.object,
-  },
-
-  mixins: [
-    OrganizationState,
-    Reflux.listenTo(LatestContextStore, 'onLatestContextChange'),
-    Reflux.listenTo(GlobalSelectionStore, 'onGlobalSelectionChange'),
-  ],
-
-  getInitialState() {
-    const envList = OrganizationEnvironmentsStore.getActive();
-    const environments = envList.filter(env =>
-      GlobalSelectionStore.get().environments.includes(env.name)
-    );
-
-    return {
-      envList,
-      environments,
-    };
-  },
-
-  onLatestContextChange(context) {
-    this.setState({environments: context.environment ? [context.environment] : []});
-  },
-
-  onGlobalSelectionChange(selection) {
-    const environments = OrganizationEnvironmentsStore.getActive().filter(env =>
-      selection.environments.includes(env.name)
-    );
-    this.setState({environments});
-  },
-
   render() {
-    const {group, project, allEnvironments} = this.props;
-    const {environments} = this.state;
+    const {group, organization, project, environments, allEnvironments} = this.props;
 
     const environmentLabel = environments.length
       ? environments.map(env => env.displayName).join(', ')
@@ -70,15 +33,16 @@ const GroupReleaseStats = createReactClass({
         : null;
 
     const projectId = project.slug;
-    const orgId = this.getOrganization().slug;
+    const orgId = organization.slug;
     const hasRelease = new Set(project.features).has('releases');
     const isLoading = !group || !allEnvironments;
 
     return (
       <div className="env-stats">
         <h6>
-          <span>{environmentLabel}</span>
+          <span data-test-id="env-label">{environmentLabel}</span>
         </h6>
+
         <div className="env-content">
           {isLoading ? (
             <LoadingIndicator />
diff --git a/src/sentry/static/sentry/app/components/group/sidebar.jsx b/src/sentry/static/sentry/app/components/group/sidebar.jsx
index 637cdfcac8..f57af77537 100644
--- a/src/sentry/static/sentry/app/components/group/sidebar.jsx
+++ b/src/sentry/static/sentry/app/components/group/sidebar.jsx
@@ -9,7 +9,6 @@ import withApi from 'app/utils/withApi';
 import SuggestedOwners from 'app/components/group/suggestedOwners';
 import GroupParticipants from 'app/components/group/participants';
 import GroupReleaseStats from 'app/components/group/releaseStats';
-import OrganizationState from 'app/mixins/organizationState';
 import IndicatorStore from 'app/stores/indicatorStore';
 import TagDistributionMeter from 'app/components/group/tagDistributionMeter';
 import LoadingError from 'app/components/loadingError';
@@ -23,6 +22,7 @@ const GroupSidebar = createReactClass({
 
   propTypes: {
     api: PropTypes.object,
+    organization: SentryTypes.Organization,
     project: SentryTypes.Project,
     group: SentryTypes.Group,
     event: SentryTypes.Event,
@@ -30,12 +30,6 @@ const GroupSidebar = createReactClass({
     sentryAppInstallations: PropTypes.array,
   },
 
-  contextTypes: {
-    location: PropTypes.object,
-  },
-
-  mixins: [OrganizationState],
-
   getInitialState() {
     return {participants: [], environments: this.props.environments};
   },
@@ -87,7 +81,7 @@ const GroupSidebar = createReactClass({
       query: pickBy({
         key: group.tags.map(data => data.key),
         environment: this.state.environments.map(env => env.name),
-        enable_snuba: this.getFeatures().has('sentry10') ? '1' : '0',
+        enable_snuba: '1',
       }),
       success: data => {
         this.setState({
@@ -115,13 +109,12 @@ const GroupSidebar = createReactClass({
   },
 
   toggleSubscription() {
-    const {group, project} = this.props;
-    const org = this.getOrganization();
+    const {group, project, organization} = this.props;
     const loadingIndicator = IndicatorStore.add(t('Saving changes..'));
 
     this.props.api.bulkUpdate(
       {
-        orgId: org.slug,
+        orgId: organization.slug,
         projectId: project.slug,
         itemIds: [group.id],
         data: {
@@ -235,9 +228,14 @@ const GroupSidebar = createReactClass({
   },
 
   render() {
-    const {group, project, sentryAppInstallations} = this.props;
+    const {
+      group,
+      organization,
+      project,
+      environments,
+      sentryAppInstallations,
+    } = this.props;
     const projectId = project.slug;
-    const organization = this.getOrganization();
 
     return (
       <div className="group-stats">
@@ -245,6 +243,8 @@ const GroupSidebar = createReactClass({
         <GroupReleaseStats
           group={this.props.group}
           project={project}
+          environments={environments}
+          organization={organization}
           allEnvironments={this.state.allEnvironmentsGroupData}
         />
 
@@ -307,6 +307,4 @@ const GroupSidebar = createReactClass({
   },
 });
 
-export {GroupSidebar};
-
 export default withApi(GroupSidebar);
diff --git a/src/sentry/static/sentry/app/views/groupDetails/shared/groupDetails.jsx b/src/sentry/static/sentry/app/views/groupDetails/shared/groupDetails.jsx
index 23c9a5e202..bd4fd93da4 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/shared/groupDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/shared/groupDetails.jsx
@@ -203,7 +203,7 @@ const GroupDetails = createReactClass({
   },
 
   renderContent(shouldShowGlobalHeader) {
-    const {params} = this.props;
+    const {params, environments} = this.props;
     const {group, project} = this.state;
 
     const Content = (
@@ -211,6 +211,7 @@ const GroupDetails = createReactClass({
         <div className={this.props.className}>
           <GroupHeader params={params} project={project} group={group} />
           {React.cloneElement(this.props.children, {
+            environments,
             group,
             project,
           })}
diff --git a/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx b/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
index 9d128606b4..cacb52cd5a 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/shared/groupEventDetails.jsx
@@ -163,6 +163,7 @@ class GroupEventDetails extends React.Component {
           </div>
           <div className="secondary">
             <GroupSidebar
+              organization={organization}
               project={project}
               group={group}
               event={evt}
diff --git a/tests/js/fixtures/environments.js b/tests/js/fixtures/environments.js
index 35693a5a04..6dd4de12aa 100644
--- a/tests/js/fixtures/environments.js
+++ b/tests/js/fixtures/environments.js
@@ -3,8 +3,8 @@ export function Environments(hidden) {
     return [{id: '1', name: 'zzz', isHidden: true}];
   } else {
     return [
-      {id: '1', name: 'production', isHidden: false},
-      {id: '2', name: 'staging', isHidden: false},
+      {id: '1', name: 'production', displayName: 'Production', isHidden: false},
+      {id: '2', name: 'staging', displayName: 'Staging', isHidden: false},
     ];
   }
 }
diff --git a/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap b/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap
deleted file mode 100644
index 8bdb79a8d4..0000000000
--- a/tests/js/spec/components/group/__snapshots__/releaseStats.spec.jsx.snap
+++ /dev/null
@@ -1,1581 +0,0 @@
-// Jest Snapshot v1, https://goo.gl/fbAQLP
-
-exports[`GroupReleaseStats renders 1`] = `
-<GroupReleaseStats
-  allEnvironments={
-    Object {
-      "activity": Array [],
-      "annotations": Array [],
-      "assignedTo": null,
-      "count": "327482",
-      "culprit": "fetchData(app/components/group/suggestedOwners)",
-      "firstRelease": null,
-      "firstSeen": "2019-04-05T19:44:05.963Z",
-      "hasSeen": false,
-      "id": "1",
-      "isBookmarked": false,
-      "isPublic": false,
-      "isSubscribed": false,
-      "lastRelease": null,
-      "lastSeen": "2019-04-11T01:08:59Z",
-      "level": "warning",
-      "logger": null,
-      "metadata": Object {
-        "function": "fetchData",
-        "type": "RequestError",
-      },
-      "numComments": 0,
-      "participants": Array [],
-      "permalink": "https://foo.io/organizations/foo/issues/1234/",
-      "platform": "javascript",
-      "pluginActions": Array [],
-      "pluginContexts": Array [],
-      "pluginIssues": Array [],
-      "project": Object {
-        "id": "2",
-        "platform": "javascript",
-        "slug": "project-slug",
-      },
-      "seenBy": Array [],
-      "shareId": null,
-      "shortId": "JAVASCRIPT-6QS",
-      "stats": Object {
-        "24h": Array [
-          Array [
-            1517281200,
-            2,
-          ],
-          Array [
-            1517310000,
-            1,
-          ],
-        ],
-        "30d": Array [
-          Array [
-            1514764800,
-            1,
-          ],
-          Array [
-            1515024000,
-            122,
-          ],
-        ],
-      },
-      "status": "unresolved",
-      "statusDetails": Object {},
-      "subscriptionDetails": null,
-      "tags": Array [],
-      "title": "RequestError: GET /issues/ 404",
-      "type": "error",
-      "userCount": 35097,
-      "userReportCount": 0,
-    }
-  }
-  group={
-    Object {
-      "activity": Array [],
-      "annotations": Array [],
-      "assignedTo": null,
-      "count": "327482",
-      "culprit": "fetchData(app/components/group/suggestedOwners)",
-      "firstRelease": null,
-      "firstSeen": "2019-04-05T19:44:05.963Z",
-      "hasSeen": false,
-      "id": "1",
-      "isBookmarked": false,
-      "isPublic": false,
-      "isSubscribed": false,
-      "lastRelease": null,
-      "lastSeen": "2019-04-11T01:08:59Z",
-      "level": "warning",
-      "logger": null,
-      "metadata": Object {
-        "function": "fetchData",
-        "type": "RequestError",
-      },
-      "numComments": 0,
-      "participants": Array [],
-      "permalink": "https://foo.io/organizations/foo/issues/1234/",
-      "platform": "javascript",
-      "pluginActions": Array [],
-      "pluginContexts": Array [],
-      "pluginIssues": Array [],
-      "project": Object {
-        "id": "2",
-        "platform": "javascript",
-        "slug": "project-slug",
-      },
-      "seenBy": Array [],
-      "shareId": null,
-      "shortId": "JAVASCRIPT-6QS",
-      "stats": Object {
-        "24h": Array [
-          Array [
-            1517281200,
-            2,
-          ],
-          Array [
-            1517310000,
-            1,
-          ],
-        ],
-        "30d": Array [
-          Array [
-            1514764800,
-            1,
-          ],
-          Array [
-            1515024000,
-            122,
-          ],
-        ],
-      },
-      "status": "unresolved",
-      "statusDetails": Object {},
-      "subscriptionDetails": null,
-      "tags": Array [],
-      "title": "RequestError: GET /issues/ 404",
-      "type": "error",
-      "userCount": 35097,
-      "userReportCount": 0,
-    }
-  }
-  location={
-    Object {
-      "pathame": "/mock-pathname/",
-      "query": Object {},
-    }
-  }
-  project={
-    Object {
-      "environments": Array [],
-      "hasAccess": true,
-      "id": "2",
-      "isBookmarked": false,
-      "isMember": true,
-      "name": "Project Name",
-      "slug": "project-slug",
-      "teams": Array [],
-    }
-  }
->
-  <div
-    className="env-stats"
-  >
-    <h6>
-      <span>
-        All Environments
-      </span>
-    </h6>
-    <div
-      className="env-content"
-    >
-      <div>
-        <GroupReleaseChart
-          environment="All Environments"
-          environmentStats={
-            Object {
-              "24h": Array [
-                Array [
-                  1517281200,
-                  2,
-                ],
-                Array [
-                  1517310000,
-                  1,
-                ],
-              ],
-              "30d": Array [
-                Array [
-                  1514764800,
-                  1,
-                ],
-                Array [
-                  1515024000,
-                  122,
-                ],
-              ],
-            }
-          }
-          firstSeen="2019-04-05T19:44:05.963Z"
-          group={
-            Object {
-              "activity": Array [],
-              "annotations": Array [],
-              "assignedTo": null,
-              "count": "327482",
-              "culprit": "fetchData(app/components/group/suggestedOwners)",
-              "firstRelease": null,
-              "firstSeen": "2019-04-05T19:44:05.963Z",
-              "hasSeen": false,
-              "id": "1",
-              "isBookmarked": false,
-              "isPublic": false,
-              "isSubscribed": false,
-              "lastRelease": null,
-              "lastSeen": "2019-04-11T01:08:59Z",
-              "level": "warning",
-              "logger": null,
-              "metadata": Object {
-                "function": "fetchData",
-                "type": "RequestError",
-              },
-              "numComments": 0,
-              "participants": Array [],
-              "permalink": "https://foo.io/organizations/foo/issues/1234/",
-              "platform": "javascript",
-              "pluginActions": Array [],
-              "pluginContexts": Array [],
-              "pluginIssues": Array [],
-              "project": Object {
-                "id": "2",
-                "platform": "javascript",
-                "slug": "project-slug",
-              },
-              "seenBy": Array [],
-              "shareId": null,
-              "shortId": "JAVASCRIPT-6QS",
-              "stats": Object {
-                "24h": Array [
-                  Array [
-                    1517281200,
-                    2,
-                  ],
-                  Array [
-                    1517310000,
-                    1,
-                  ],
-                ],
-                "30d": Array [
-                  Array [
-                    1514764800,
-                    1,
-                  ],
-                  Array [
-                    1515024000,
-                    122,
-                  ],
-                ],
-              },
-              "status": "unresolved",
-              "statusDetails": Object {},
-              "subscriptionDetails": null,
-              "tags": Array [],
-              "title": "RequestError: GET /issues/ 404",
-              "type": "error",
-              "userCount": 35097,
-              "userReportCount": 0,
-            }
-          }
-          lastSeen="2019-04-11T01:08:59Z"
-          release={null}
-          releaseStats={null}
-          statsPeriod="24h"
-          title="Last 24 Hours"
-        >
-          <div
-            className="bar-chart group-chart "
-          >
-            <h6>
-              <span>
-                Last 24 Hours
-              </span>
-            </h6>
-            <StackedBarChart
-              barClasses={
-                Array [
-                  "release",
-                  "environment",
-                  "inactive",
-                ]
-              }
-              className="sparkline"
-              gap={0.75}
-              height={40}
-              label="events"
-              markers={
-                Array [
-                  Object {
-                    "className": "first-seen",
-                    "fill": "#F868BC",
-                    "label": "First seen",
-                    "offset": -7.5,
-                    "x": 1554493445.963,
-                  },
-                  Object {
-                    "className": "last-seen",
-                    "fill": "#57be8c",
-                    "label": "Last seen",
-                    "x": 1554944939,
-                  },
-                ]
-              }
-              minHeights={
-                Array [
-                  0,
-                  0,
-                  5,
-                ]
-              }
-              points={
-                Array [
-                  Object {
-                    "x": 1517281200,
-                    "y": Array [
-                      0,
-                      2,
-                      0,
-                    ],
-                  },
-                  Object {
-                    "x": 1517310000,
-                    "y": Array [
-                      0,
-                      1,
-                      0,
-                    ],
-                  },
-                ]
-              }
-              series={Array []}
-              tooltip={[Function]}
-              width={null}
-            >
-              <StyledFigure
-                className="sparkline barchart"
-                style={
-                  Object {
-                    "height": 40,
-                    "width": null,
-                  }
-                }
-              >
-                <figure
-                  className="sparkline barchart css-lg2nde-StyledFigure e5t71581"
-                  style={
-                    Object {
-                      "height": 40,
-                      "width": null,
-                    }
-                  }
-                >
-                  <span
-                    className="max-y"
-                  >
-                    <Count
-                      value={10}
-                    >
-                      <span>
-                        10
-                      </span>
-                    </Count>
-                  </span>
-                  <span
-                    className="min-y"
-                  >
-                    0
-                  </span>
-                  <SvgContainer>
-                    <div
-                      className="css-1jg1opr-SvgContainer e5t71582"
-                    >
-                      <StyledSvg
-                        overflow="visible"
-                        preserveAspectRatio="none"
-                        viewBox="0 0 100 400"
-                      >
-                        <svg
-                          className="css-e6bn68-StyledSvg e5t71580"
-                          overflow="visible"
-                          preserveAspectRatio="none"
-                          viewBox="0 0 100 400"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            key="1517281200"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "150px",
-                                  }
-                                }
-                              >
-                                <div
-                                  className="time-label"
-                                >
-                                  <span>
-                                    Jan 29th, 7:00 pm
-                                    &#8594
-                                    Jan 30th, 2:59 am
-                                  </span>
-                                </div>
-                                <dl
-                                  className="legend"
-                                >
-                                  <dt
-                                    className="inactive"
-                                  >
-                                    <span />
-                                  </dt>
-                                  <dd>
-                                    2
-                                     event
-                                    s
-                                  </dd>
-                                  <React.Fragment>
-                                    <dt
-                                      className="environment"
-                                    >
-                                      <span />
-                                    </dt>
-                                    <dd>
-                                      2
-                                       event
-                                      s
-                                      <small>
-                                        in 
-                                        All Environments
-                                      </small>
-                                    </dd>
-                                  </React.Fragment>
-                                </dl>
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <g
-                                    aria-describedby="tooltip-123456"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                  >
-                                    <rect
-                                      height="100%"
-                                      opacity="0"
-                                      width="51.17%"
-                                      x="-0.75%"
-                                    />
-                                    <rect
-                                      className="release barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="0%"
-                                      key="0"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="100%"
-                                    >
-                                      0
-                                    </rect>
-                                    <rect
-                                      className="environment barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="19.8%"
-                                      key="1"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="80.2%"
-                                    >
-                                      2
-                                    </rect>
-                                    <rect
-                                      className="inactive barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="5%"
-                                      key="2"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="75.2%"
-                                    >
-                                      0
-                                    </rect>
-                                  </g>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            key="1517310000"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "150px",
-                                  }
-                                }
-                              >
-                                <div
-                                  className="time-label"
-                                >
-                                  <span>
-                                    Jan 30th, 3:00 am
-                                    &#8594
-                                    Jan 30th, 10:59 am
-                                  </span>
-                                </div>
-                                <dl
-                                  className="legend"
-                                >
-                                  <dt
-                                    className="inactive"
-                                  >
-                                    <span />
-                                  </dt>
-                                  <dd>
-                                    1
-                                     event
-                                    
-                                  </dd>
-                                  <React.Fragment>
-                                    <dt
-                                      className="environment"
-                                    >
-                                      <span />
-                                    </dt>
-                                    <dd>
-                                      1
-                                       event
-                                      
-                                      <small>
-                                        in 
-                                        All Environments
-                                      </small>
-                                    </dd>
-                                  </React.Fragment>
-                                </dl>
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <g
-                                    aria-describedby="tooltip-123456"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                  >
-                                    <rect
-                                      height="100%"
-                                      opacity="0"
-                                      width="51.17%"
-                                      x="49.67%"
-                                    />
-                                    <rect
-                                      className="release barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="0%"
-                                      key="0"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="100%"
-                                    >
-                                      0
-                                    </rect>
-                                    <rect
-                                      className="environment barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="9.9%"
-                                      key="1"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="90.1%"
-                                    >
-                                      1
-                                    </rect>
-                                    <rect
-                                      className="inactive barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="5%"
-                                      key="2"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="85.1%"
-                                    >
-                                      0
-                                    </rect>
-                                  </g>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </StyledSvg>
-                      <CircleSvg
-                        key="m-first-seen-1554493445.963"
-                        left={100.84}
-                        offset={-7.5}
-                        size={10}
-                        viewBox="0 0 10 10"
-                      >
-                        <svg
-                          className="css-m7l75b-CircleSvg e5t71583"
-                          offset={-7.5}
-                          size={10}
-                          viewBox="0 0 10 10"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "130px",
-                                  }
-                                }
-                              >
-                                First seen
-                                <br />
-                                Apr 5, 2019 12:44 PM
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <circle
-                                    aria-describedby="tooltip-123456"
-                                    cx="50%"
-                                    cy="50%"
-                                    data-test-id="chart-column"
-                                    fill="#F868BC"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                    r="4"
-                                    stroke="#fff"
-                                    strokeWidth="2"
-                                  >
-                                    First seen
-                                  </circle>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </CircleSvg>
-                      <CircleSvg
-                        key="m-last-seen-1554944939"
-                        left={100.84}
-                        offset={0}
-                        size={10}
-                        viewBox="0 0 10 10"
-                      >
-                        <svg
-                          className="css-1yt4gr0-CircleSvg e5t71583"
-                          offset={0}
-                          size={10}
-                          viewBox="0 0 10 10"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "130px",
-                                  }
-                                }
-                              >
-                                Last seen
-                                <br />
-                                Apr 10, 2019 6:08 PM
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <circle
-                                    aria-describedby="tooltip-123456"
-                                    cx="50%"
-                                    cy="50%"
-                                    data-test-id="chart-column"
-                                    fill="#57be8c"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                    r="4"
-                                    stroke="#fff"
-                                    strokeWidth="2"
-                                  >
-                                    Last seen
-                                  </circle>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </CircleSvg>
-                    </div>
-                  </SvgContainer>
-                </figure>
-              </StyledFigure>
-            </StackedBarChart>
-          </div>
-        </GroupReleaseChart>
-        <GroupReleaseChart
-          className="bar-chart-small"
-          environment="All Environments"
-          environmentStats={
-            Object {
-              "24h": Array [
-                Array [
-                  1517281200,
-                  2,
-                ],
-                Array [
-                  1517310000,
-                  1,
-                ],
-              ],
-              "30d": Array [
-                Array [
-                  1514764800,
-                  1,
-                ],
-                Array [
-                  1515024000,
-                  122,
-                ],
-              ],
-            }
-          }
-          firstSeen="2019-04-05T19:44:05.963Z"
-          group={
-            Object {
-              "activity": Array [],
-              "annotations": Array [],
-              "assignedTo": null,
-              "count": "327482",
-              "culprit": "fetchData(app/components/group/suggestedOwners)",
-              "firstRelease": null,
-              "firstSeen": "2019-04-05T19:44:05.963Z",
-              "hasSeen": false,
-              "id": "1",
-              "isBookmarked": false,
-              "isPublic": false,
-              "isSubscribed": false,
-              "lastRelease": null,
-              "lastSeen": "2019-04-11T01:08:59Z",
-              "level": "warning",
-              "logger": null,
-              "metadata": Object {
-                "function": "fetchData",
-                "type": "RequestError",
-              },
-              "numComments": 0,
-              "participants": Array [],
-              "permalink": "https://foo.io/organizations/foo/issues/1234/",
-              "platform": "javascript",
-              "pluginActions": Array [],
-              "pluginContexts": Array [],
-              "pluginIssues": Array [],
-              "project": Object {
-                "id": "2",
-                "platform": "javascript",
-                "slug": "project-slug",
-              },
-              "seenBy": Array [],
-              "shareId": null,
-              "shortId": "JAVASCRIPT-6QS",
-              "stats": Object {
-                "24h": Array [
-                  Array [
-                    1517281200,
-                    2,
-                  ],
-                  Array [
-                    1517310000,
-                    1,
-                  ],
-                ],
-                "30d": Array [
-                  Array [
-                    1514764800,
-                    1,
-                  ],
-                  Array [
-                    1515024000,
-                    122,
-                  ],
-                ],
-              },
-              "status": "unresolved",
-              "statusDetails": Object {},
-              "subscriptionDetails": null,
-              "tags": Array [],
-              "title": "RequestError: GET /issues/ 404",
-              "type": "error",
-              "userCount": 35097,
-              "userReportCount": 0,
-            }
-          }
-          lastSeen="2019-04-11T01:08:59Z"
-          release={null}
-          releaseStats={null}
-          statsPeriod="30d"
-          title="Last 30 Days"
-        >
-          <div
-            className="bar-chart group-chart bar-chart-small"
-          >
-            <h6>
-              <span>
-                Last 30 Days
-              </span>
-            </h6>
-            <StackedBarChart
-              barClasses={
-                Array [
-                  "release",
-                  "environment",
-                  "inactive",
-                ]
-              }
-              className="sparkline"
-              gap={0.75}
-              height={40}
-              label="events"
-              markers={
-                Array [
-                  Object {
-                    "className": "first-seen",
-                    "fill": "#F868BC",
-                    "label": "First seen",
-                    "offset": -7.5,
-                    "x": 1554493445.963,
-                  },
-                  Object {
-                    "className": "last-seen",
-                    "fill": "#57be8c",
-                    "label": "Last seen",
-                    "x": 1554944939,
-                  },
-                ]
-              }
-              minHeights={
-                Array [
-                  0,
-                  0,
-                  5,
-                ]
-              }
-              points={
-                Array [
-                  Object {
-                    "x": 1514764800,
-                    "y": Array [
-                      0,
-                      1,
-                      0,
-                    ],
-                  },
-                  Object {
-                    "x": 1515024000,
-                    "y": Array [
-                      0,
-                      122,
-                      0,
-                    ],
-                  },
-                ]
-              }
-              series={Array []}
-              tooltip={[Function]}
-              width={null}
-            >
-              <StyledFigure
-                className="sparkline barchart"
-                style={
-                  Object {
-                    "height": 40,
-                    "width": null,
-                  }
-                }
-              >
-                <figure
-                  className="sparkline barchart css-lg2nde-StyledFigure e5t71581"
-                  style={
-                    Object {
-                      "height": 40,
-                      "width": null,
-                    }
-                  }
-                >
-                  <span
-                    className="max-y"
-                  >
-                    <Count
-                      value={122}
-                    >
-                      <span>
-                        122
-                      </span>
-                    </Count>
-                  </span>
-                  <span
-                    className="min-y"
-                  >
-                    0
-                  </span>
-                  <SvgContainer>
-                    <div
-                      className="css-1jg1opr-SvgContainer e5t71582"
-                    >
-                      <StyledSvg
-                        overflow="visible"
-                        preserveAspectRatio="none"
-                        viewBox="0 0 100 400"
-                      >
-                        <svg
-                          className="css-e6bn68-StyledSvg e5t71580"
-                          overflow="visible"
-                          preserveAspectRatio="none"
-                          viewBox="0 0 100 400"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            key="1514764800"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "150px",
-                                  }
-                                }
-                              >
-                                <div
-                                  className="time-label"
-                                >
-                                  <span>
-                                    Dec 31st, 4:00 pm
-                                    &#8594
-                                    Jan 3rd, 3:59 pm
-                                  </span>
-                                </div>
-                                <dl
-                                  className="legend"
-                                >
-                                  <dt
-                                    className="inactive"
-                                  >
-                                    <span />
-                                  </dt>
-                                  <dd>
-                                    1
-                                     event
-                                    
-                                  </dd>
-                                  <React.Fragment>
-                                    <dt
-                                      className="environment"
-                                    >
-                                      <span />
-                                    </dt>
-                                    <dd>
-                                      1
-                                       event
-                                      
-                                      <small>
-                                        in 
-                                        All Environments
-                                      </small>
-                                    </dd>
-                                  </React.Fragment>
-                                </dl>
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <g
-                                    aria-describedby="tooltip-123456"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                  >
-                                    <rect
-                                      height="100%"
-                                      opacity="0"
-                                      width="51.17%"
-                                      x="-0.75%"
-                                    />
-                                    <rect
-                                      className="release barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="0%"
-                                      key="0"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="100%"
-                                    >
-                                      0
-                                    </rect>
-                                    <rect
-                                      className="environment barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="0.81%"
-                                      key="1"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="99.19%"
-                                    >
-                                      1
-                                    </rect>
-                                    <rect
-                                      className="inactive barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="5%"
-                                      key="2"
-                                      width="49.67%"
-                                      x="0%"
-                                      y="94.19%"
-                                    >
-                                      0
-                                    </rect>
-                                  </g>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            key="1515024000"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "150px",
-                                  }
-                                }
-                              >
-                                <div
-                                  className="time-label"
-                                >
-                                  <span>
-                                    Jan 3rd, 4:00 pm
-                                    &#8594
-                                    Jan 6th, 3:59 pm
-                                  </span>
-                                </div>
-                                <dl
-                                  className="legend"
-                                >
-                                  <dt
-                                    className="inactive"
-                                  >
-                                    <span />
-                                  </dt>
-                                  <dd>
-                                    122
-                                     event
-                                    s
-                                  </dd>
-                                  <React.Fragment>
-                                    <dt
-                                      className="environment"
-                                    >
-                                      <span />
-                                    </dt>
-                                    <dd>
-                                      122
-                                       event
-                                      s
-                                      <small>
-                                        in 
-                                        All Environments
-                                      </small>
-                                    </dd>
-                                  </React.Fragment>
-                                </dl>
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <g
-                                    aria-describedby="tooltip-123456"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                  >
-                                    <rect
-                                      height="100%"
-                                      opacity="0"
-                                      width="51.17%"
-                                      x="49.67%"
-                                    />
-                                    <rect
-                                      className="release barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="0%"
-                                      key="0"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="100%"
-                                    >
-                                      0
-                                    </rect>
-                                    <rect
-                                      className="environment barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="99%"
-                                      key="1"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="1%"
-                                    >
-                                      122
-                                    </rect>
-                                    <rect
-                                      className="inactive barchart-rect"
-                                      data-test-id="chart-column"
-                                      height="5%"
-                                      key="2"
-                                      width="49.67%"
-                                      x="50.42%"
-                                      y="-4%"
-                                    >
-                                      0
-                                    </rect>
-                                  </g>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </StyledSvg>
-                      <CircleSvg
-                        key="m-first-seen-1554493445.963"
-                        left={100.84}
-                        offset={-7.5}
-                        size={10}
-                        viewBox="0 0 10 10"
-                      >
-                        <svg
-                          className="css-m7l75b-CircleSvg e5t71583"
-                          offset={-7.5}
-                          size={10}
-                          viewBox="0 0 10 10"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "130px",
-                                  }
-                                }
-                              >
-                                First seen
-                                <br />
-                                Apr 5, 2019 12:44 PM
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <circle
-                                    aria-describedby="tooltip-123456"
-                                    cx="50%"
-                                    cy="50%"
-                                    data-test-id="chart-column"
-                                    fill="#F868BC"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                    r="4"
-                                    stroke="#fff"
-                                    strokeWidth="2"
-                                  >
-                                    First seen
-                                  </circle>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </CircleSvg>
-                      <CircleSvg
-                        key="m-last-seen-1554944939"
-                        left={100.84}
-                        offset={0}
-                        size={10}
-                        viewBox="0 0 10 10"
-                      >
-                        <svg
-                          className="css-1yt4gr0-CircleSvg e5t71583"
-                          offset={0}
-                          size={10}
-                          viewBox="0 0 10 10"
-                        >
-                          <Tooltip
-                            containerDisplayMode="inline-block"
-                            position="bottom"
-                            title={
-                              <div
-                                style={
-                                  Object {
-                                    "width": "130px",
-                                  }
-                                }
-                              >
-                                Last seen
-                                <br />
-                                Apr 10, 2019 6:08 PM
-                              </div>
-                            }
-                          >
-                            <Manager>
-                              <Reference>
-                                <InnerReference
-                                  setReferenceNode={[Function]}
-                                >
-                                  <circle
-                                    aria-describedby="tooltip-123456"
-                                    cx="50%"
-                                    cy="50%"
-                                    data-test-id="chart-column"
-                                    fill="#57be8c"
-                                    onBlur={[Function]}
-                                    onFocus={[Function]}
-                                    onMouseEnter={[Function]}
-                                    onMouseLeave={[Function]}
-                                    r="4"
-                                    stroke="#fff"
-                                    strokeWidth="2"
-                                  >
-                                    Last seen
-                                  </circle>
-                                </InnerReference>
-                              </Reference>
-                            </Manager>
-                          </Tooltip>
-                        </svg>
-                      </CircleSvg>
-                    </div>
-                  </SvgContainer>
-                </figure>
-              </StyledFigure>
-            </StackedBarChart>
-          </div>
-        </GroupReleaseChart>
-        <h6>
-          <span>
-            First seen
-          </span>
-        </h6>
-        <SeenInfo
-          date="2019-04-05T19:44:05.963Z"
-          dateGlobal="2019-04-05T19:44:05.963Z"
-          environment={null}
-          hasRelease={false}
-          orgId="org-slug"
-          projectId="project-slug"
-          release={null}
-          title="First seen"
-        >
-          <dl
-            className="seen-info"
-          >
-            <dt
-              key="0"
-            >
-              When
-              :
-            </dt>
-            <dd
-              key="1"
-            >
-              <Tooltip
-                containerDisplayMode="inline-block"
-                position="top"
-                title={
-                  <div
-                    style={
-                      Object {
-                        "width": "170px",
-                      }
-                    }
-                  >
-                    <div
-                      className="time-label"
-                    >
-                      First seen
-                    </div>
-                    <dl
-                      className="flat"
-                    >
-                      <dt>
-                        Globally:
-                      </dt>
-                      <dd>
-                        <TimeSince
-                          date="2019-04-05T19:44:05.963Z"
-                          suffix="ago"
-                        />
-                        <br />
-                      </dd>
-                    </dl>
-                  </div>
-                }
-              >
-                <Manager>
-                  <Reference>
-                    <InnerReference
-                      setReferenceNode={[Function]}
-                    >
-                      <Container
-                        aria-describedby="tooltip-123456"
-                        containerDisplayMode="inline-block"
-                        innerRef={[Function]}
-                        onBlur={[Function]}
-                        onFocus={[Function]}
-                        onMouseEnter={[Function]}
-                        onMouseLeave={[Function]}
-                      >
-                        <span
-                          aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
-                          onBlur={[Function]}
-                          onFocus={[Function]}
-                          onMouseEnter={[Function]}
-                          onMouseLeave={[Function]}
-                        >
-                          <TimeSince
-                            className="dotted-underline"
-                            date="2019-04-05T19:44:05.963Z"
-                            suffix="ago"
-                          >
-                            <time
-                              className="dotted-underline"
-                              dateTime="2019-04-05T19:44:05.963Z"
-                              title="April 5, 2019 12:44 PM PDT"
-                            >
-                              in a year
-                            </time>
-                          </TimeSince>
-                        </span>
-                      </Container>
-                    </InnerReference>
-                  </Reference>
-                </Manager>
-              </Tooltip>
-              <br />
-              <small>
-                <DateTime
-                  date="2019-04-05T19:44:05.963Z"
-                  seconds={true}
-                >
-                  <time>
-                    Apr 5, 2019 12:44:05 PM PDT
-                  </time>
-                </DateTime>
-              </small>
-            </dd>
-            <dt
-              key="4"
-            >
-              Release
-              :
-            </dt>
-            <dd
-              key="5"
-            >
-              <small
-                style={
-                  Object {
-                    "fontStyle": "italic",
-                    "marginLeft": 5,
-                  }
-                }
-              >
-                <a
-                  href="/settings/org-slug/projects/project-slug/release-tracking/"
-                >
-                  not configured
-                </a>
-              </small>
-            </dd>
-          </dl>
-        </SeenInfo>
-        <h6>
-          <span>
-            Last seen
-          </span>
-        </h6>
-        <SeenInfo
-          date="2019-04-11T01:08:59Z"
-          dateGlobal="2019-04-11T01:08:59Z"
-          environment={null}
-          hasRelease={false}
-          orgId="org-slug"
-          projectId="project-slug"
-          release={null}
-          title="Last seen"
-        >
-          <dl
-            className="seen-info"
-          >
-            <dt
-              key="0"
-            >
-              When
-              :
-            </dt>
-            <dd
-              key="1"
-            >
-              <Tooltip
-                containerDisplayMode="inline-block"
-                position="top"
-                title={
-                  <div
-                    style={
-                      Object {
-                        "width": "170px",
-                      }
-                    }
-                  >
-                    <div
-                      className="time-label"
-                    >
-                      Last seen
-                    </div>
-                    <dl
-                      className="flat"
-                    >
-                      <dt>
-                        Globally:
-                      </dt>
-                      <dd>
-                        <TimeSince
-                          date="2019-04-11T01:08:59Z"
-                          suffix="ago"
-                        />
-                        <br />
-                      </dd>
-                    </dl>
-                  </div>
-                }
-              >
-                <Manager>
-                  <Reference>
-                    <InnerReference
-                      setReferenceNode={[Function]}
-                    >
-                      <Container
-                        aria-describedby="tooltip-123456"
-                        containerDisplayMode="inline-block"
-                        innerRef={[Function]}
-                        onBlur={[Function]}
-                        onFocus={[Function]}
-                        onMouseEnter={[Function]}
-                        onMouseLeave={[Function]}
-                      >
-                        <span
-                          aria-describedby="tooltip-123456"
-                          className="css-1m3e0hg-Container erna86q0"
-                          onBlur={[Function]}
-                          onFocus={[Function]}
-                          onMouseEnter={[Function]}
-                          onMouseLeave={[Function]}
-                        >
-                          <TimeSince
-                            className="dotted-underline"
-                            date="2019-04-11T01:08:59Z"
-                            suffix="ago"
-                          >
-                            <time
-                              className="dotted-underline"
-                              dateTime="2019-04-11T01:08:59.000Z"
-                              title="April 10, 2019 6:08 PM PDT"
-                            >
-                              in a year
-                            </time>
-                          </TimeSince>
-                        </span>
-                      </Container>
-                    </InnerReference>
-                  </Reference>
-                </Manager>
-              </Tooltip>
-              <br />
-              <small>
-                <DateTime
-                  date="2019-04-11T01:08:59Z"
-                  seconds={true}
-                >
-                  <time>
-                    Apr 10, 2019 6:08:59 PM PDT
-                  </time>
-                </DateTime>
-              </small>
-            </dd>
-            <dt
-              key="4"
-            >
-              Release
-              :
-            </dt>
-            <dd
-              key="5"
-            >
-              <small
-                style={
-                  Object {
-                    "fontStyle": "italic",
-                    "marginLeft": 5,
-                  }
-                }
-              >
-                <a
-                  href="/settings/org-slug/projects/project-slug/release-tracking/"
-                >
-                  not configured
-                </a>
-              </small>
-            </dd>
-          </dl>
-        </SeenInfo>
-      </div>
-    </div>
-  </div>
-</GroupReleaseStats>
-`;
diff --git a/tests/js/spec/components/group/releaseStats.spec.jsx b/tests/js/spec/components/group/releaseStats.spec.jsx
index 9748b2a2a8..923becd8ff 100644
--- a/tests/js/spec/components/group/releaseStats.spec.jsx
+++ b/tests/js/spec/components/group/releaseStats.spec.jsx
@@ -1,13 +1,14 @@
-import React from 'react';
 import {mount} from 'enzyme';
+import React from 'react';
 
+import {initializeOrg} from 'app-test/helpers/initializeOrg';
 import ConfigStore from 'app/stores/configStore';
 import GroupReleaseStats from 'app/components/group/releaseStats';
-import EnvironmentStore from 'app/stores/environmentStore';
 
 describe('GroupReleaseStats', function() {
-  let component;
-  beforeEach(function() {
+  const {organization, project, routerContext} = initializeOrg();
+
+  beforeAll(function() {
     // Set timezone for snapshot
     ConfigStore.loadInitialData({
       user: {
@@ -16,24 +17,32 @@ describe('GroupReleaseStats', function() {
         },
       },
     });
+  });
 
-    component = mount(
+  const createWrapper = props =>
+    mount(
       <GroupReleaseStats
         group={TestStubs.Group()}
-        project={TestStubs.Project()}
+        project={project}
+        organization={organization}
         allEnvironments={TestStubs.Group()}
-        location={TestStubs.location()}
+        environments={[]}
+        {...props}
       />,
-      {
-        context: {
-          organization: TestStubs.Organization(),
-        },
-      }
+      routerContext
     );
+
+  it('renders all environments', function() {
+    const wrapper = createWrapper();
+    expect(wrapper.find('[data-test-id="env-label"]').text()).toBe('All Environments');
+    expect(wrapper.find('GroupReleaseChart')).toHaveLength(2);
+    expect(wrapper.find('SeenInfo')).toHaveLength(2);
   });
 
-  it('renders', function() {
-    EnvironmentStore.loadInitialData(TestStubs.Environments());
-    expect(component).toMatchSnapshot();
+  it('renders specific environments', function() {
+    const wrapper = createWrapper({environments: TestStubs.Environments()});
+    expect(wrapper.find('[data-test-id="env-label"]').text()).toBe('Production, Staging');
+    expect(wrapper.find('GroupReleaseChart')).toHaveLength(2);
+    expect(wrapper.find('SeenInfo')).toHaveLength(2);
   });
 });
diff --git a/tests/js/spec/components/group/sidebar.spec.jsx b/tests/js/spec/components/group/sidebar.spec.jsx
index b0fa97bd29..34b108fddf 100644
--- a/tests/js/spec/components/group/sidebar.spec.jsx
+++ b/tests/js/spec/components/group/sidebar.spec.jsx
@@ -1,11 +1,12 @@
 import React from 'react';
-import {mount, shallow} from 'enzyme';
 
-import {GroupSidebar} from 'app/components/group/sidebar';
+import {initializeOrg} from 'app-test/helpers/initializeOrg';
+import {mount} from 'enzyme';
+import GroupSidebar from 'app/components/group/sidebar';
 
 describe('GroupSidebar', function() {
   let group = TestStubs.Group({tags: TestStubs.Tags()});
-  const project = TestStubs.Project();
+  const {organization, project, routerContext} = initializeOrg();
   const environment = {name: 'production', displayName: 'Production', id: '1'};
   let wrapper;
   let tagsMock;
@@ -46,13 +47,13 @@ describe('GroupSidebar', function() {
 
     wrapper = mount(
       <GroupSidebar
-        api={new MockApiClient()}
         group={group}
         project={project}
+        organization={organization}
         event={TestStubs.Event()}
         environments={[environment]}
       />,
-      TestStubs.routerContext()
+      routerContext
     );
   });
 
@@ -90,15 +91,16 @@ describe('GroupSidebar', function() {
         body: [],
       });
 
-      wrapper = shallow(
+      wrapper = mount(
         <GroupSidebar
           api={new MockApiClient()}
           group={group}
+          organization={organization}
           project={project}
           event={TestStubs.Event()}
           environments={[environment]}
         />,
-        TestStubs.routerContext()
+        routerContext
       );
     });
 
