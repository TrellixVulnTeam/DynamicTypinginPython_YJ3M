commit b8cc9576e198d608f2dd30c7d34c04c0ca45b8a8
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Mar 22 14:15:07 2018 -0700

    feat(environments): Filter release issue list by environment (#7741)
    
    Release details issue lists have environment filter
    
    Add environment querystring to release pages

diff --git a/src/sentry/static/sentry/app/components/groupList.jsx b/src/sentry/static/sentry/app/components/groupList.jsx
index 9e193af247..10b5066f47 100644
--- a/src/sentry/static/sentry/app/components/groupList.jsx
+++ b/src/sentry/static/sentry/app/components/groupList.jsx
@@ -4,6 +4,7 @@ import createReactClass from 'create-react-class';
 import Reflux from 'reflux';
 import jQuery from 'jquery';
 
+import SentryTypes from '../proptypes';
 import ApiMixin from '../mixins/apiMixin';
 import GroupListHeader from '../components/groupListHeader';
 import GroupStore from '../stores/groupStore';
@@ -23,6 +24,7 @@ const GroupList = createReactClass({
     orgId: PropTypes.string.isRequired,
     projectId: PropTypes.string.isRequired,
     bulkActions: PropTypes.bool.isRequired,
+    environment: SentryTypes.Environment,
   },
 
   contextTypes: {
@@ -100,6 +102,13 @@ const GroupList = createReactClass({
     queryParams.limit = 50;
     queryParams.sort = 'new';
     queryParams.query = this.props.query;
+
+    if (this.props.environment) {
+      queryParams.environment = this.props.environment.name;
+    } else {
+      delete queryParams.environment;
+    }
+
     let querystring = jQuery.param(queryParams);
 
     let props = this.props;
diff --git a/src/sentry/static/sentry/app/views/releaseAllEvents.jsx b/src/sentry/static/sentry/app/views/releaseAllEvents.jsx
index 93eb7cd7dd..ee3927ee72 100644
--- a/src/sentry/static/sentry/app/views/releaseAllEvents.jsx
+++ b/src/sentry/static/sentry/app/views/releaseAllEvents.jsx
@@ -1,10 +1,17 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 import {Link} from 'react-router';
+
+import SentryTypes from '../proptypes';
+import withEnvironmentInQueryString from '../utils/withEnvironmentInQueryString';
 import GroupList from '../components/groupList';
 import {t} from '../locale';
 
 class ReleaseAllEvents extends React.Component {
+  static propTypes = {
+    environment: SentryTypes.Environment,
+  };
+
   static contextTypes = {
     release: PropTypes.object,
   };
@@ -30,10 +37,11 @@ class ReleaseAllEvents extends React.Component {
           query={'release:"' + this.context.release.version + '"'}
           canSelectGroups={false}
           bulkActions={false}
+          environment={this.props.environment}
         />
       </div>
     );
   }
 }
 
-export default ReleaseAllEvents;
+export default withEnvironmentInQueryString(ReleaseAllEvents);
diff --git a/src/sentry/static/sentry/app/views/releaseNewEvents.jsx b/src/sentry/static/sentry/app/views/releaseNewEvents.jsx
index 8aea415ff9..e25e94ab2b 100644
--- a/src/sentry/static/sentry/app/views/releaseNewEvents.jsx
+++ b/src/sentry/static/sentry/app/views/releaseNewEvents.jsx
@@ -1,10 +1,17 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 import {Link} from 'react-router';
+
+import SentryTypes from '../proptypes';
 import GroupList from '../components/groupList';
 import {t} from '../locale';
+import withEnvironmentInQueryString from '../utils/withEnvironmentInQueryString';
 
 class ReleaseNewEvents extends React.Component {
+  static propTypes = {
+    environment: SentryTypes.Environment,
+  };
+
   static contextTypes = {
     release: PropTypes.object,
   };
@@ -30,10 +37,11 @@ class ReleaseNewEvents extends React.Component {
           query={'first-release:"' + this.context.release.version + '"'}
           canSelectGroups={false}
           bulkActions={false}
+          environment={this.props.environment}
         />
       </div>
     );
   }
 }
 
-export default ReleaseNewEvents;
+export default withEnvironmentInQueryString(ReleaseNewEvents);
diff --git a/src/sentry/static/sentry/app/views/releases/releaseOverview.jsx b/src/sentry/static/sentry/app/views/releases/releaseOverview.jsx
index e5fdd8b929..77c1e75950 100644
--- a/src/sentry/static/sentry/app/views/releases/releaseOverview.jsx
+++ b/src/sentry/static/sentry/app/views/releases/releaseOverview.jsx
@@ -3,6 +3,7 @@ import React from 'react';
 
 import createReactClass from 'create-react-class';
 
+import withEnvironmentInQueryString from '../../utils/withEnvironmentInQueryString';
 import LoadingIndicator from '../../components/loadingIndicator';
 import LoadingError from '../../components/loadingError';
 import IconOpen from '../../icons/icon-open';
@@ -61,6 +62,8 @@ const ReleaseOverview = createReactClass({
 
     if (this.props.environment) {
       query.environment = this.props.environment.name;
+    } else {
+      delete query.environment;
     }
 
     let path = `/organizations/${orgId}/releases/${encodeURIComponent(
@@ -185,6 +188,9 @@ const ReleaseOverview = createReactClass({
     }, {});
 
     let deploys = this.state.deploys;
+
+    let query = this.props.environment ? {environment: this.props.environment.name} : {};
+
     return (
       <div>
         <div className="row" style={{paddingTop: 10}}>
@@ -194,6 +200,7 @@ const ReleaseOverview = createReactClass({
               endpoint={`/projects/${orgId}/${projectId}/releases/${encodeURIComponent(
                 version
               )}/resolved/`}
+              query={query}
               pagination={false}
               renderEmpty={() => (
                 <div className="box empty m-b-2" key="none">
@@ -209,6 +216,7 @@ const ReleaseOverview = createReactClass({
             <IssueList
               endpoint={`/projects/${orgId}/${projectId}/issues/`}
               query={{
+                ...query,
                 query: 'first-release:"' + version + '"',
                 limit: 5,
               }}
@@ -292,10 +300,10 @@ const ReleaseOverview = createReactClass({
 
                     // TODO(lyn): Remove when environment feature switched on
                     if (!this.getFeatures().has('environments')) {
-                      let query = encodeURIComponent(
+                      let q = encodeURIComponent(
                         `environment:${deploy.environment} release:${version}`
                       );
-                      href = `/${orgId}/${projectId}/?query=${query}`;
+                      href = `/${orgId}/${projectId}/?query=${q}`;
                     }
                     // End remove block
 
@@ -334,4 +342,4 @@ const ReleaseOverview = createReactClass({
   },
 });
 
-export default ReleaseOverview;
+export default withEnvironmentInQueryString(ReleaseOverview);
