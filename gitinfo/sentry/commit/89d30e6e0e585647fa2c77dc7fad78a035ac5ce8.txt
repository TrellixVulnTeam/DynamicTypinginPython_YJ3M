commit 89d30e6e0e585647fa2c77dc7fad78a035ac5ce8
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 8 11:51:25 2016 -0800

    Cache lookups for EventUser on event creation
    
    This ensures that low cardinality (or high throughput) scenarios defer most IntegrityError scenarios, which can become very common.

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 3fd6554c83..2de4761334 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -35,6 +35,7 @@ from sentry.signals import regression_signal
 from sentry.utils.logging import suppress_exceptions
 from sentry.tasks.merge import merge_group
 from sentry.tasks.post_process import post_process_group
+from sentry.utils.cache import default_cache
 from sentry.utils.db import get_db_engine
 from sentry.utils.safe import safe_execute, trim, trim_dict
 from sentry.utils.strings import truncatechars
@@ -542,11 +543,18 @@ class EventManager(object):
         if not euser.tag_value:
             return
 
-        try:
-            with transaction.atomic():
-                euser.save()
-        except IntegrityError:
-            pass
+        cache_key = 'euser:{}:{}'.format(
+            project.id,
+            md5(euser.tag_value).hexdigest(),
+        )
+        cached = default_cache.get(cache_key)
+        if cached is None:
+            try:
+                with transaction.atomic():
+                    euser.save()
+            except IntegrityError:
+                pass
+            default_cache.set(cache_key, '', 3600)
 
         return euser
 
