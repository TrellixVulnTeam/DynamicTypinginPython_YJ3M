commit da2fe34a4bb9c44104ce1d84bf19a8fc137cec75
Author: Mark Story <mark@sentry.io>
Date:   Wed Jul 24 09:54:29 2019 -0400

    fix(azuredevops) Don't fail when a user account is deleted (#14118)
    
    When the integration bridge user is deleted in active directory we
    shouldn't 500 when handling webhooks. Instead the azure issue should not
    be transitioned to a new state and we can log the failure.
    
    Fixes SENTRY-9xf

diff --git a/src/sentry/integrations/vsts/issues.py b/src/sentry/integrations/vsts/issues.py
index 0c1a6cc065..5b8e83c772 100644
--- a/src/sentry/integrations/vsts/issues.py
+++ b/src/sentry/integrations/vsts/issues.py
@@ -246,7 +246,15 @@ class VstsIssueSync(IssueSyncMixin):
 
     def get_done_states(self, project):
         client = self.get_client()
-        all_states = client.get_work_item_states(self.instance, project)['value']
+        try:
+            all_states = client.get_work_item_states(self.instance, project)['value']
+        except ApiError as err:
+            self.logger.info('vsts.get-done-states.failed', extra={
+                'integration_id': self.model.id,
+                'exception': err
+            })
+            return []
+
         done_states = [
             state['name'] for state in all_states if state['category'] in self.done_categories
         ]
diff --git a/tests/sentry/integrations/vsts/test_issues.py b/tests/sentry/integrations/vsts/test_issues.py
index b1fadf5c88..2752e8d847 100644
--- a/tests/sentry/integrations/vsts/test_issues.py
+++ b/tests/sentry/integrations/vsts/test_issues.py
@@ -310,6 +310,22 @@ class VstsIssueSyncTest(VstsIssueBase):
         })
         assert should_resolve is False
 
+    @responses.activate
+    def test_should_resolve_done_status_failure(self):
+        responses.reset()
+        responses.add(
+            responses.GET,
+            'https://fabrikam-fiber-inc.visualstudio.com/c0bf429a-c03c-4a99-9336-d45be74db5a6/_apis/wit/workitemtypes/Bug/states',
+            status=403,
+            json={'error': 'The requested operation is not allowed. Your account is pending deletion.'}
+        )
+        should_resolve = self.integration.should_resolve({
+            'project': self.project_id_with_states,
+            'old_state': 'Active',
+            'new_state': 'Resolved',
+        })
+        assert should_resolve is False
+
     @responses.activate
     def test_should_unresolve_active_to_resolved(self):
         should_unresolve = self.integration.should_unresolve({
