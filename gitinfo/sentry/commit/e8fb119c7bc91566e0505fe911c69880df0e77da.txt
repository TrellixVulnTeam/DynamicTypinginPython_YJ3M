commit e8fb119c7bc91566e0505fe911c69880df0e77da
Author: David Cramer <dcramer@gmail.com>
Date:   Wed May 2 16:43:35 2018 -0700

    fix cache in tests

diff --git a/src/sentry/models/useroption.py b/src/sentry/models/useroption.py
index b9ea80092c..f20a904c60 100644
--- a/src/sentry/models/useroption.py
+++ b/src/sentry/models/useroption.py
@@ -135,13 +135,13 @@ class UserOptionManager(BaseManager):
             self.__metadata[metakey] = result
         return self.__metadata.get(metakey, {})
 
-    def clear_cache(self, **kwargs):
+    def clear_local_cache(self, **kwargs):
         self.__metadata = {}
 
     def contribute_to_class(self, model, name):
         super(UserOptionManager, self).contribute_to_class(model, name)
-        task_postrun.connect(self.clear_cache)
-        request_finished.connect(self.clear_cache)
+        task_postrun.connect(self.clear_local_cache)
+        request_finished.connect(self.clear_local_cache)
 
 
 # TODO(dcramer): the NULL UNIQUE constraint here isnt valid, and instead has to
diff --git a/src/sentry/utils/pytest/sentry.py b/src/sentry/utils/pytest/sentry.py
index 5ade0826a8..602dfac674 100644
--- a/src/sentry/utils/pytest/sentry.py
+++ b/src/sentry/utils/pytest/sentry.py
@@ -237,3 +237,7 @@ def pytest_runtest_teardown(item):
 
     from celery.task.control import discard_all
     discard_all()
+
+    from sentry.models import OrganizationOption, ProjectOption, UserOption
+    for model in (OrganizationOption, ProjectOption, UserOption):
+        model.objects.clear_local_cache()
diff --git a/tests/sentry/api/serializers/test_group.py b/tests/sentry/api/serializers/test_group.py
index d516486173..358862f11a 100644
--- a/tests/sentry/api/serializers/test_group.py
+++ b/tests/sentry/api/serializers/test_group.py
@@ -209,7 +209,7 @@ class GroupSerializerTest(TestCase):
 
         for options, (is_subscribed, subscription_details) in combinations:
             default_value, project_value = options
-            UserOption.objects.clear_cache()
+            UserOption.objects.clear_local_cache()
             maybe_set_value(None, default_value)
             maybe_set_value(group.project, project_value)
             result = serialize(group, user)
