commit 9b0eb2dce763b74bb3a19054b50de93846d2b575
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 24 10:47:46 2015 -0800

    Feature gate SSO

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 75bd8ed13f..34d24dc3a9 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -527,6 +527,7 @@ SENTRY_FEATURES = {
     'auth:register': True,
     'social-auth:register': True,
     'organizations:create': True,
+    'organizations:sso': True,
     'teams:create': True,
 }
 
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index 1487a82b54..535d3b639e 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -8,6 +8,7 @@ default_manager = FeatureManager()
 default_manager.add('auth:register')
 default_manager.add('social-auth:register')
 default_manager.add('organizations:create')
+default_manager.add('organizations:sso', OrganizationFeature)
 default_manager.add('teams:create', OrganizationFeature)
 
 # expose public api
diff --git a/src/sentry/templates/sentry/bases/organization.html b/src/sentry/templates/sentry/bases/organization.html
index c733739d92..9340d0d3e5 100644
--- a/src/sentry/templates/sentry/bases/organization.html
+++ b/src/sentry/templates/sentry/bases/organization.html
@@ -2,6 +2,7 @@
 
 {% load crispy_forms_tags %}
 {% load i18n %}
+{% load sentry_features %}
 {% load sentry_helpers %}
 
 {% block title %}{% trans "Organization Settings" %} | {{ block.super }}{% endblock %}
@@ -54,11 +55,13 @@
         {% trans "Members" %}
       </a>
     </li>
+    {% feature organizations:sso organization %}
     <li class="{% block org_auth_settings_nav %}{% endblock %}">
       <a href="{% url 'sentry-organization-auth-settings' organization.slug %}">
         {% trans "Auth" %}
       </a>
     </li>
+    {% endfeature %}
     <li class="{% block org_settings_nav %}{% endblock %}">
       <a href="{% url 'sentry-organization-settings' organization.slug %}">
         {% trans "Settings" %}
diff --git a/src/sentry/web/frontend/organization_auth_settings.py b/src/sentry/web/frontend/organization_auth_settings.py
index 4794558ca5..3917cd4f69 100644
--- a/src/sentry/web/frontend/organization_auth_settings.py
+++ b/src/sentry/web/frontend/organization_auth_settings.py
@@ -1,8 +1,10 @@
 from __future__ import absolute_import
 
+from django.contrib import messages
 from django.core.urlresolvers import reverse
-from django.http import HttpResponse
+from django.http import HttpResponse, HttpResponseRedirect
 
+from sentry import features
 from sentry.auth import manager
 from sentry.auth.helper import AuthHelper
 from sentry.models import AuthProvider, OrganizationMemberType
@@ -10,6 +12,9 @@ from sentry.utils.http import absolute_uri
 from sentry.web.frontend.base import OrganizationView
 
 
+ERR_NO_SSO = 'The SSO feature is not enabled for this organization.'
+
+
 class OrganizationAuthSettingsView(OrganizationView):
     required_access = OrganizationMemberType.OWNER
 
@@ -50,6 +55,10 @@ class OrganizationAuthSettingsView(OrganizationView):
         return helper.next_step()
 
     def handle(self, request, organization):
+        if not features.has('organizations:sso', organization, actor=request.user):
+            messages.error(request, ERR_NO_SSO)
+            return HttpResponseRedirect(reverse('sentry-organization-home', args=[organization.slug]))
+
         try:
             auth_provider = AuthProvider.objects.get(
                 organization=organization,
