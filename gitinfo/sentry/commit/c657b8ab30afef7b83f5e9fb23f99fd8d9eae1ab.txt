commit c657b8ab30afef7b83f5e9fb23f99fd8d9eae1ab
Author: ted kaemming <ted@kaemming.com>
Date:   Wed Jan 10 17:17:10 2018 -0800

    Fix type inconsistency in `ProjectGroupIndexEndpoint`. (#6947)
    
    Fixes SENTRY-5PW.

diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index a01adf7ec0..81dfa76328 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -33,7 +33,7 @@ from sentry.signals import advanced_search, issue_resolved_in_release
 from sentry.tasks.deletion import delete_group
 from sentry.tasks.merge import merge_group
 from sentry.utils.apidocs import attach_scenarios, scenario
-from sentry.utils.cursors import Cursor
+from sentry.utils.cursors import Cursor, CursorResult
 from sentry.utils.functional import extract_lazy_object
 
 delete_logger = logging.getLogger('sentry.deletions.api')
@@ -328,7 +328,9 @@ class ProjectGroupIndexEndpoint(ProjectEndpoint, EnvironmentMixin):
             environment_id = self._get_environment_id_from_request(
                 request, project.organization_id)
         except Environment.DoesNotExist:
-            cursor_result = []
+            # XXX: The 1000 magic number for `max_hits` is an abstraction leak
+            # from `sentry.api.paginator.BasePaginator.get_result`.
+            cursor_result = CursorResult([], None, None, hits=0, max_hits=1000)
         else:
             cursor_result = search.query(
                 count_hits=True,
diff --git a/tests/sentry/api/endpoints/test_project_group_index.py b/tests/sentry/api/endpoints/test_project_group_index.py
index 8903e3b37e..43189aec11 100644
--- a/tests/sentry/api/endpoints/test_project_group_index.py
+++ b/tests/sentry/api/endpoints/test_project_group_index.py
@@ -153,6 +153,17 @@ class GroupListTest(APITestCase):
         response = self.client.get('{}?statsPeriod=48h'.format(self.path), format='json')
         assert response.status_code == 400
 
+    def test_environment(self):
+        self.create_event(tags={'environment': 'production'})
+
+        self.login_as(user=self.user)
+
+        response = self.client.get(self.path + '?environment=production', format='json')
+        assert response.status_code == 200
+
+        response = self.client.get(self.path + '?environment=garbage', format='json')
+        assert response.status_code == 200
+
     def test_auto_resolved(self):
         project = self.project
         project.update_option('sentry:resolve_age', 1)
