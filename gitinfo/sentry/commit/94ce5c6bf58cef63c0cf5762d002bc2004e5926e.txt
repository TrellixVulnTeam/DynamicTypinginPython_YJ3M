commit 94ce5c6bf58cef63c0cf5762d002bc2004e5926e
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Mon Oct 21 23:48:09 2019 +0300

    build(docker): Remove the redundant -onbuild images (#15200)

diff --git a/docker/cloudbuild.yaml b/docker/cloudbuild.yaml
index d38fc85c10..727c331df5 100644
--- a/docker/cloudbuild.yaml
+++ b/docker/cloudbuild.yaml
@@ -8,15 +8,6 @@ steps:
     '-f', './docker/Dockerfile'
   ]
   timeout: 900s
-# Derive the -onbuild variant
-- name: 'gcr.io/kaniko-project/executor:latest'
-  args: [
-    '--cache=true',
-    '--build-arg', 'SENTRY_IMAGE=us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA',
-    '--destination=us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA-onbuild',
-    '--destination=us.gcr.io/$PROJECT_ID/sentry:$SHORT_SHA-onbuild',
-    '-f', './docker/onbuild/Dockerfile'
-  ]
 # Smoke tests
 - name: 'gcr.io/$PROJECT_ID/docker-compose'
   entrypoint: 'bash'
@@ -51,8 +42,6 @@ steps:
     if [ "$BRANCH_NAME" == "master" ]; then
       docker tag us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA us.gcr.io/$PROJECT_ID/sentry:latest
       docker push us.gcr.io/$PROJECT_ID/sentry:latest
-      docker tag us.gcr.io/$PROJECT_ID/sentry:$COMMIT_SHA-onbuild us.gcr.io/$PROJECT_ID/sentry:latest-onbuild
-      docker push us.gcr.io/$PROJECT_ID/sentry:latest-onbuild
     fi
 timeout: 2400s
 options:
diff --git a/docker/onbuild/Dockerfile b/docker/onbuild/Dockerfile
deleted file mode 100644
index 4709dec81c..0000000000
--- a/docker/onbuild/Dockerfile
+++ /dev/null
@@ -1,18 +0,0 @@
-ARG SENTRY_IMAGE
-FROM ${SENTRY_IMAGE:-getsentry/sentry:latest}
-
-WORKDIR /usr/src/sentry
-
-# Add WORKDIR to PYTHONPATH so local python files don't need to be installed
-ENV PYTHONPATH /usr/src/sentry
-ONBUILD COPY . /usr/src/sentry
-
-# Hook for installing additional plugins
-ONBUILD RUN if [ -s requirements.txt ]; then pip install -r requirements.txt; fi
-
-# Hook for installing a local app as an addon
-ONBUILD RUN if [ -s setup.py ]; then pip install -e .; fi
-
-# Hook for staging in custom configs
-ONBUILD RUN if [ -s sentry.conf.py ]; then cp sentry.conf.py $SENTRY_CONF/; fi \
-	&& if [ -s config.yml ]; then cp config.yml $SENTRY_CONF/; fi
