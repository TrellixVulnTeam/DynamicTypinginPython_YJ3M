commit b4f9a148f87d9d807bacd8e588c3b4858f1b4471
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Wed Feb 26 14:48:35 2020 +0100

    ref(processing): Decrease hard timeout for process_event and make it configurable (#17306)

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 4a742501c9..425d0d29ed 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -1763,3 +1763,10 @@ MIGRATIONS_TEST_MIGRATE = os.environ.get("MIGRATIONS_TEST_MIGRATE", "0") == "1"
 MIGRATIONS_LOCKFILE_APP_WHITELIST = ()
 # Where to write the lockfile to.
 MIGRATIONS_LOCKFILE_PATH = os.path.join(PROJECT_ROOT, os.path.pardir, os.path.pardir)
+
+# Log error and abort processing (without dropping event) when process_event is
+# taking more than n seconds to process event
+SYMBOLICATOR_PROCESS_EVENT_HARD_TIMEOUT = 1800
+
+# Log warning when process_event is taking more than n seconds to process event
+SYMBOLICATOR_PROCESS_EVENT_WARN_TIMEOUT = 120
diff --git a/src/sentry/tasks/store.py b/src/sentry/tasks/store.py
index 68efc8da8e..b1e37fb967 100644
--- a/src/sentry/tasks/store.py
+++ b/src/sentry/tasks/store.py
@@ -6,6 +6,7 @@ from datetime import datetime
 
 from time import time
 from django.utils import timezone
+from django.conf import settings
 
 from sentry_relay.processing import StoreNormalizer
 
@@ -224,12 +225,12 @@ def _do_process_event(cache_key, start_time, event_id, process_task, data=None):
             has_changed = True
             data = new_data
     except RetrySymbolication as e:
-        if start_time and (time() - start_time) > 120:
+        if start_time and (time() - start_time) > settings.SYMBOLICATOR_PROCESS_EVENT_WARN_TIMEOUT:
             error_logger.warning(
                 "process.slow", extra={"project_id": project_id, "event_id": event_id}
             )
 
-        if start_time and (time() - start_time) > 3600:
+        if start_time and (time() - start_time) > settings.SYMBOLICATOR_PROCESS_EVENT_HARD_TIMEOUT:
             # Do not drop event but actually continue with rest of pipeline
             # (persisting unsymbolicated event)
             error_logger.exception(
