commit c03d5bc56963c38779c29877d16b84acd34232a7
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Mar 23 13:01:37 2015 -0700

    Avoid serialization large objects for buffers

diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index 9fff2d60b6..eedb33439d 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -51,7 +51,7 @@ class GroupManager(BaseManager):
     def add_tags(self, group, tags):
         from sentry.models import TagValue, GroupTagValue
 
-        project = group.project
+        project_id = group.project_id
         date = group.last_seen
 
         tsdb_keys = []
@@ -71,7 +71,7 @@ class GroupManager(BaseManager):
             buffer.incr(TagValue, {
                 'times_seen': 1,
             }, {
-                'project': project,
+                'project_id': project_id,
                 'key': key,
                 'value': value,
             }, {
@@ -82,8 +82,8 @@ class GroupManager(BaseManager):
             buffer.incr(GroupTagValue, {
                 'times_seen': 1,
             }, {
-                'group': group,
-                'project': project,
+                'group_id': group.id,
+                'project_id': project_id,
                 'key': key,
                 'value': value,
             }, {
diff --git a/src/sentry/receivers/core.py b/src/sentry/receivers/core.py
index 3d07f0678c..53cf3c45d1 100644
--- a/src/sentry/receivers/core.py
+++ b/src/sentry/receivers/core.py
@@ -176,10 +176,15 @@ def record_project_tag_count(filters, created, **kwargs):
     if not created:
         return
 
+    # TODO(dcramer): remove in 7.6.x
+    project_id = filters.get('project_id')
+    if not project_id:
+        project_id = filters['project'].id
+
     app.buffer.incr(TagKey, {
         'values_seen': 1,
     }, {
-        'project': filters['project'],
+        'project_id': project_id,
         'key': filters['key'],
     })
 
@@ -191,11 +196,20 @@ def record_group_tag_count(filters, created, **kwargs):
     if not created:
         return
 
+    # TODO(dcramer): remove in 7.6.x
+    project_id = filters.get('project_id')
+    if not project_id:
+        project_id = filters['project'].id
+
+    group_id = filters.get('group_id')
+    if not group_id:
+        group_id = filters['group'].id
+
     app.buffer.incr(GroupTagKey, {
         'values_seen': 1,
     }, {
-        'project': filters['project'],
-        'group': filters['group'],
+        'project_id': project_id,
+        'group_id': group_id,
         'key': filters['key'],
     })
 
