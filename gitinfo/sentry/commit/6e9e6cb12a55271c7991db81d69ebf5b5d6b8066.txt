commit 6e9e6cb12a55271c7991db81d69ebf5b5d6b8066
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 19 19:04:04 2015 -0800

    Initial work on React + Flot

diff --git a/package.json b/package.json
index 2d9d2fc0a5..ef9905aa55 100644
--- a/package.json
+++ b/package.json
@@ -20,6 +20,7 @@
     "gulp-uglify": "^1.0.2",
     "gulp-util": "^3.0.1",
     "gulp-watch": "^3.0.0",
+    "imports-loader": "^0.6.3",
     "jquery": "^2.1.3",
     "jshint": "~2.5.0",
     "jsx": "^0.9.89",
diff --git a/src/sentry/static/sentry/app/components/aggregateChart.jsx b/src/sentry/static/sentry/app/components/aggregateChart.jsx
new file mode 100644
index 0000000000..a0f52ec521
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/aggregateChart.jsx
@@ -0,0 +1,28 @@
+/*** @jsx React.DOM */
+var React = require("react");
+
+var FlotChart = require("./flotChart");
+
+var AggregateChart = React.createClass({
+  propTypes: {
+    aggregate: React.PropTypes.shape({
+      id: React.PropTypes.string.isRequired
+    }).isRequired,
+    project: React.PropTypes.shape({
+      id: React.PropTypes.string.isRequired
+    }).isRequired
+  },
+
+  render: function() {
+    var points = [{x: 1421722207, y: 50}, {x: 1421722267, y: 150}];
+
+    return (
+      <FlotChart
+          points={points}
+          className="chart" />
+    );
+  }
+
+});
+
+module.exports = AggregateChart;
diff --git a/src/sentry/static/sentry/app/components/flotChart.jsx b/src/sentry/static/sentry/app/components/flotChart.jsx
new file mode 100644
index 0000000000..6fe41c196d
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/flotChart.jsx
@@ -0,0 +1,176 @@
+/*** @jsx React.DOM */
+var React = require('react');
+var $ = require('jquery');
+var moment = require('moment');
+
+// we need flot and the various plugins
+require('flot');
+require('flot/jquery.flot.resize');
+require('flot/jquery.flot.time');
+
+var average = function(a) {
+  var r = {mean: 0, variance: 0, deviation: 0}, t = a.length;
+  for (var m, s = 0, l = t; l--; s += a[l]);
+  for (m = r.mean = s / t, l = t, s = 0; l--; s += Math.pow(a[l] - m, 2));
+  r.deviation = Math.sqrt(r.variance = s / t);
+  return r;
+};
+
+var percentile = function(a, nth) {
+  a = a.sort();
+  a.slice(0, a.length - Math.floor(nth / a.length));
+  return average(a);
+};
+
+var timeUnitSize = {
+  "second": 1000,
+  "minute": 60 * 1000,
+  "hour": 60 * 60 * 1000,
+  "day": 24 * 60 * 60 * 1000,
+  "month": 30 * 24 * 60 * 60 * 1000,
+  "quarter": 3 * 30 * 24 * 60 * 60 * 1000,
+  "year": 365.2425 * 24 * 60 * 60 * 1000
+};
+
+var tickFormatter = function (value, axis) {
+  var d = moment(value);
+
+  var t = axis.tickSize[0] * timeUnitSize[axis.tickSize[1]];
+  var span = axis.max - axis.min;
+  var fmt;
+
+  if (t < timeUnitSize.minute) {
+    fmt = 'LT';
+  } else if (t < timeUnitSize.day) {
+    fmt = 'LT';
+    if (span < 2 * timeUnitSize.day) {
+      fmt = 'LT';
+    } else {
+      fmt = 'MMM D LT';
+    }
+  } else if (t < timeUnitSize.month) {
+    fmt = 'MMM D';
+  } else if (t < timeUnitSize.year) {
+    if (span < timeUnitSize.year) {
+      fmt = 'MMM';
+    } else {
+      fmt = 'MMM YY';
+    }
+  } else {
+    fmt = 'YY';
+  }
+
+  return d.format(fmt);
+};
+
+var FlotChart = React.createClass({
+  propTypes: {
+    points: React.PropTypes.arrayOf(React.PropTypes.shape({
+      x: React.PropTypes.number.isRequired,
+      y: React.PropTypes.number.isRequired
+    })),
+  },
+
+  renderChart: function(options) {
+    var $el = $(this.refs.chartNode.getDOMNode());
+
+    var points = [];
+    var p95Inputs = [];
+    this.props.points.forEach(function(point){
+      p95Inputs.push(point.y);
+      points.push([point.x * 1000, point.y]);
+    });
+
+    var p95th = percentile(p95Inputs);
+    var dataAvg = [];
+    points.forEach(function(point){
+      dataAvg.push([point[0], p95th.mean]);
+    });
+
+    var plotData = [
+      {
+        data: points,
+        color: 'rgba(86, 175, 232, 1)',
+        shadowSize: 0,
+        lines: {
+          lineWidth: 2,
+          show: true,
+          fill: false
+        }
+      }
+      // {
+      //   data: dataAvg,
+      //   color: 'rgba(244, 63, 32, .4)',
+      //   // color: '#000000',
+      //   shadowSize: 0,
+      //   dashes: {
+      //     lineWidth: 2,
+      //     show: true,
+      //     fill: false
+      //   }
+      // }
+    ];
+    var plotOptions = {
+      xaxis: {
+        mode: "time",
+        tickFormatter: tickFormatter
+      },
+      yaxis: {
+        min: 0,
+        tickFormatter: function(value) {
+          if (value > 999999) {
+            return (value / 1000000) + 'mm';
+          }
+          if (value > 999) {
+            return (value / 1000) + 'k';
+          }
+          return value;
+        }
+      },
+      // tooltip: true,
+      // tooltipOpts: {
+      //   content: function(label, xval, yval, flotItem) {
+      //     return yval + ' events<br>' + moment(xval).format('llll');
+      //   },
+      //   defaultTheme: false
+      // },
+      grid: {
+        show: true,
+        // hoverable: true,
+        backgroundColor: '#ffffff',
+        borderColor: '#DEE3E9',
+        borderWidth: 2,
+        tickColor: '#DEE3E9'
+      },
+      hoverable: false,
+      legend: {
+        noColumns: 5
+      },
+      lines: { show: false }
+    };
+
+    $(function(){
+      $.plot($el, plotData, plotOptions);
+    });
+
+    // $(window).resize(function(){
+    //   this.renderChart();
+    // }.bind(this));
+  },
+  shouldComponentUpdate: function(nextProps, nextState) {
+    return nextProps.points.length > 0;
+  },
+  componentDidUpdate: function() {
+    this.renderChart();
+  },
+  componentDidMount: function() {
+    this.renderChart();
+  },
+  render: function() {
+    return (
+      <figure className={this.props.className} ref="chartNode" />
+    );
+  }
+});
+
+module.exports = FlotChart;
diff --git a/src/sentry/static/sentry/app/main.jsx b/src/sentry/static/sentry/app/main.jsx
index feaba28b85..9422c50bd9 100644
--- a/src/sentry/static/sentry/app/main.jsx
+++ b/src/sentry/static/sentry/app/main.jsx
@@ -50,5 +50,6 @@ module.exports = {
   React: require("react"),
 
   Alerts: require("./components/alerts"),
-  Stream: require("./components/stream")
+  Stream: require("./components/stream"),
+  AggregateChart: require("./components/aggregateChart")
 };
diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 1b1b43d72c..6475206e33 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -1146,6 +1146,7 @@ footer {
 
 .chart {
   position: relative;
+  min-height: 150px;
   max-height: 200px;
 
   > .title {
diff --git a/src/sentry/templates/sentry/groups/details.html b/src/sentry/templates/sentry/groups/details.html
index 070d6bb4f2..4f687562d4 100644
--- a/src/sentry/templates/sentry/groups/details.html
+++ b/src/sentry/templates/sentry/groups/details.html
@@ -116,14 +116,17 @@
 
             {% if group|has_charts %}
                 <div class="box">
-                    <div class="box-content with-padding">
-                        <div id="chart" class="chart" data-api-url="{% url 'sentry-api-0-group-stats' group.id %}">
-                            <div class="sparkline">
-                                <span class="loading">{% trans "Loading historical data..." %}</span>
-                                <noscript>{% trans "Get yourself some JavaScripts dood" %}</noscript>
-                            </div>
-                        </div>
-                    </div>
+                  <div class="box-content with-padding">
+                    <div id="blk_group_chart"></div>
+                    <script>
+                    $(function(){
+                      React.render(React.createFactory(AggregateChart)({
+                        aggregate: {% serialize group %},
+                        project: {% serialize project %}
+                      }), document.getElementById('blk_group_chart'));
+                    });
+                    </script>
+                  </div>
                 </div>
             {% endif %}
 
diff --git a/webpack.config.js b/webpack.config.js
index 55569bcbd8..b807fd8e8e 100644
--- a/webpack.config.js
+++ b/webpack.config.js
@@ -15,7 +15,17 @@ function vendorFile(name) {
 module.exports = {
   entry: {
     "app": file("app/main.jsx"),
-    "vendor": ["react/addons", "react-bootstrap", "reflux", "jquery", "moment"]
+    "vendor": [
+      "flot",
+      "flot/jquery.flot.resize",
+      "flot/jquery.flot.time",
+      "jquery",
+      "moment",
+
+      "react/addons",
+      "react-bootstrap",
+      "reflux"
+    ]
   },
   module: {
     loaders: [
@@ -26,7 +36,11 @@ module.exports = {
     ]
   },
   plugins: [
-    new webpack.optimize.CommonsChunkPlugin("vendor", distPath + "/vendor.js")
+    new webpack.optimize.CommonsChunkPlugin("vendor", distPath + "/vendor.js"),
+    new webpack.ProvidePlugin({
+        $: 'jquery',
+        jQuery: 'jquery',
+    })
   ],
   resolve: {
     modulesDirectories: [distPath, "node_modules"],
