commit b3b6f9235a92108868f05f1b7b57b63e2c9ddd1b
Author: Anton Ovchinnikov <anton@tonyo.info>
Date:   Thu Dec 12 19:00:20 2019 +0100

    feat(relay): Log project ids with big project configs (#16014)

diff --git a/src/sentry/api/endpoints/relay_projectconfigs.py b/src/sentry/api/endpoints/relay_projectconfigs.py
index f31a4ed27b..6f8f4faedb 100644
--- a/src/sentry/api/endpoints/relay_projectconfigs.py
+++ b/src/sentry/api/endpoints/relay_projectconfigs.py
@@ -1,5 +1,6 @@
 from __future__ import absolute_import
 
+import logging
 import six
 from rest_framework.response import Response
 
@@ -13,6 +14,11 @@ from sentry.relay import config
 from sentry.models import Project, ProjectKey, Organization, OrganizationOption
 from sentry.utils import metrics, json
 
+logger = logging.getLogger(__name__)
+
+# We'll log project IDS if their config size is larger than this value
+PROJECT_CONFIG_SIZE_THRESHOLD = 10000
+
 
 class RelayProjectConfigsEndpoint(Endpoint):
     authentication_classes = (RelayAuthentication,)
@@ -95,6 +101,14 @@ class RelayProjectConfigsEndpoint(Endpoint):
                     )
 
             configs[six.text_type(project_id)] = serialized_config = project_config.to_dict()
-            metrics.timing("relay_project_configs.config_size", len(json.dumps(serialized_config)))
+            config_size = len(json.dumps(serialized_config))
+            metrics.timing("relay_project_configs.config_size", config_size)
+
+            # Log if we see huge project configs
+            if config_size >= PROJECT_CONFIG_SIZE_THRESHOLD:
+                logger.info(
+                    "relay.project_config.huge_config",
+                    extra={"project_id": project_id, "size": config_size},
+                )
 
         return Response({"configs": configs}, status=200)
