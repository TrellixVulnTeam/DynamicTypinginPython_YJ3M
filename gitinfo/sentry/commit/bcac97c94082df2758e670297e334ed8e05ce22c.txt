commit bcac97c94082df2758e670297e334ed8e05ce22c
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Jan 28 13:57:08 2019 +0100

    fix: Another None reference in UA parsing (#11739)

diff --git a/src/sentry/utils/contexts_normalization.py b/src/sentry/utils/contexts_normalization.py
index c1d174754b..aa45a09cfd 100644
--- a/src/sentry/utils/contexts_normalization.py
+++ b/src/sentry/utils/contexts_normalization.py
@@ -2,7 +2,7 @@ from __future__ import absolute_import
 import re
 
 from ua_parser.user_agent_parser import Parse
-from sentry.utils.safe import setdefault_path
+from sentry.utils.safe import get_path, setdefault_path
 
 # Environment.OSVersion (GetVersionEx) or RuntimeInformation.OSDescription, on Windows
 _windows_re = re.compile('^(Microsoft )?Windows (NT )?(?P<version>\d+\.\d+\.\d+).*$')
@@ -91,16 +91,8 @@ def _get_version(user_agent):
 
 
 def _parse_user_agent(data):
-    http = data.get('request')
-    if not http:
-        return None
-
-    headers = http.get('headers')
-    if not headers:
-        return None
-
     try:
-        for key, value in headers:
+        for key, value in get_path(data, 'request', 'headers', filter=True) or ():
             if key != 'User-Agent':
                 continue
             if not value:
