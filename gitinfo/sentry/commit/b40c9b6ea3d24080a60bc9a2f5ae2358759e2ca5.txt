commit b40c9b6ea3d24080a60bc9a2f5ae2358759e2ca5
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Thu May 24 16:25:23 2018 -0500

    feat(integrations): Add configuration to project integrations

diff --git a/src/sentry/api/endpoints/organization_config_integrations.py b/src/sentry/api/endpoints/organization_config_integrations.py
index b060e6396f..0869bfd2db 100644
--- a/src/sentry/api/endpoints/organization_config_integrations.py
+++ b/src/sentry/api/endpoints/organization_config_integrations.py
@@ -27,6 +27,7 @@ class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
                     'name': provider.name,
                     'metadata': metadata,
                     'canAdd': provider.can_add,
+                    'canAddProject': provider.can_add_project,
                     'setupDialog': dict(
                         url='/organizations/{}/integrations/{}/setup/'.format(
                             organization.slug,
diff --git a/src/sentry/api/serializers/models/integration.py b/src/sentry/api/serializers/models/integration.py
index 97b818c439..fd151e376b 100644
--- a/src/sentry/api/serializers/models/integration.py
+++ b/src/sentry/api/serializers/models/integration.py
@@ -15,7 +15,7 @@ class IntegrationSerializer(Serializer):
             'id': six.text_type(obj.id),
             'name': obj.name,
             'icon': obj.metadata.get('icon'),
-            'domain_name': obj.metadata.get('domain_name'),
+            'domainName': obj.metadata.get('domain_name'),
             'provider': {
                 'key': provider.key,
                 'name': provider.name,
@@ -28,8 +28,8 @@ class IntegrationConfigSerializer(IntegrationSerializer):
         data = super(IntegrationConfigSerializer, self).serialize(obj, attrs, user)
 
         data.update({
-            'config_organization': [],
-            'config_project': [],
+            'configOrganization': [],
+            'configProject': [],
         })
 
         try:
@@ -40,8 +40,8 @@ class IntegrationConfigSerializer(IntegrationSerializer):
             pass
         else:
             data.update({
-                'config_organization': install.get_organization_config(),
-                'config_project': install.get_project_config(),
+                'configOrganization': install.get_organization_config(),
+                'configProject': install.get_project_config(),
             })
 
         return data
@@ -75,8 +75,8 @@ class OrganizationIntegrationSerializer(Serializer):
         # API request for config options.
         integration = serialize(obj.integration, user, IntegrationConfigSerializer())
         integration.update({
-            'config_data': obj.config,
-            'config_data_projects': attrs['project_configs'],
+            'configData': obj.config,
+            'configDataProjects': attrs['project_configs'],
         })
 
         return integration
@@ -87,7 +87,7 @@ class ProjectIntegrationSerializer(Serializer):
     def serialize(self, obj, attrs, user, organization=None, project=None):
         integration = serialize(obj.integration, user, IntegrationConfigSerializer())
         integration.update({
-            'config_data': obj.config,
+            'configData': obj.config,
         })
 
         return integration
diff --git a/src/sentry/integrations/base.py b/src/sentry/integrations/base.py
index 608454af7f..a75df4a3ca 100644
--- a/src/sentry/integrations/base.py
+++ b/src/sentry/integrations/base.py
@@ -77,6 +77,9 @@ class IntegrationProvider(PipelineProvider):
     # whether or not the integration installation be initiated from Sentry
     can_add = True
 
+    # can the integration be enabled specifically for projects?
+    can_add_project = False
+
     # can be any number of IntegrationFeatures
     features = frozenset()
 
diff --git a/src/sentry/integrations/jira/integration.py b/src/sentry/integrations/jira/integration.py
index 1ae58d26e0..68faa1c9a7 100644
--- a/src/sentry/integrations/jira/integration.py
+++ b/src/sentry/integrations/jira/integration.py
@@ -295,6 +295,7 @@ class JiraIntegrationProvider(IntegrationProvider):
     features = frozenset([IntegrationFeatures.ISSUE_SYNC])
 
     can_add = False
+    can_add_project = True
 
     def get_pipeline_views(self):
         return []
diff --git a/src/sentry/static/sentry/app/views/organizationIntegration/index.jsx b/src/sentry/static/sentry/app/views/organizationIntegration/index.jsx
index 2e41855d7a..0eee0d667e 100644
--- a/src/sentry/static/sentry/app/views/organizationIntegration/index.jsx
+++ b/src/sentry/static/sentry/app/views/organizationIntegration/index.jsx
@@ -89,6 +89,17 @@ export default class OrganizationIntegration extends AsyncView {
     ];
   }
 
+  mergeIntegration(integration) {
+    // Merge the new integration into the list. If we're updating an
+    // integration overwrite the old integration.
+    const keyedItems = keyBy(this.state.integrations, i => i.id);
+    const integrations = sortArray(
+      Object.values({...keyedItems, [integration.id]: integration}),
+      i => i.name
+    );
+    this.setState({integrations});
+  }
+
   handleAddIntegration = provider => {
     const name = 'sentryAddIntegration';
 
@@ -122,16 +133,8 @@ export default class OrganizationIntegration extends AsyncView {
       return;
     }
 
-    // Merge the new integration into the list. If we're updating an
-    // integration ovewrrite the old integration.
-    const keyedItems = keyBy(this.state.integrations, i => i.id);
-    const integrations = sortArray(
-      Object.values({...keyedItems, [data.id]: data}),
-      i => i.name
-    );
-
+    this.mergeIntegration(data);
     IndicatorStore.addSuccess(t('Integration Added'));
-    this.setState({integrations});
   };
 
   handleDeleteIntegration = integration => {
@@ -155,6 +158,64 @@ export default class OrganizationIntegration extends AsyncView {
     this.api.request(`/organizations/${orgId}/integrations/${integration.id}/`, options);
   };
 
+  handleRemoveProjectIntegration = integration => {
+    const {orgId, projectId} = this.props.params;
+    const saveIndicator = IndicatorStore.add(t('Disabling integration for project'));
+
+    const options = {
+      method: 'DELETE',
+      success: () => {
+        delete integration.configDataProjects[projectId];
+        this.mergeIntegration(integration);
+
+        IndicatorStore.addSuccess(t('Integration disabled for project'));
+      },
+      error: () =>
+        IndicatorStore.addError(t('Failed to disable integration for project')),
+      complete: () => IndicatorStore.remove(saveIndicator),
+    };
+
+    this.api.request(
+      `/projects/${orgId}/${projectId}/integrations/${integration.id}/`,
+      options
+    );
+  };
+
+  handleEnableProjectIntegration = integration => {
+    const {orgId, projectId} = this.props.params;
+    const saveIndicator = IndicatorStore.add(t('Enabling integration for project'));
+
+    const options = {
+      method: 'PUT',
+      success: () => {
+        // XXX(epurkhiser): Right now we just add the project to the
+        // configDataProjects list within the integration object. Later this
+        // may have been populated and we actually need to reload the
+        // integration. Probably when the integration has an enabled field and
+        // PUTing enables or disables the ProjectIntegration.
+        integration.configDataProjects[projectId] = {};
+        this.mergeIntegration(integration);
+
+        IndicatorStore.addSuccess(t('Integration enabled for project'));
+      },
+      error: () => IndicatorStore.addError(t('Failed to enable integration for project')),
+      complete: () => IndicatorStore.remove(saveIndicator),
+    };
+
+    this.api.request(
+      `/projects/${orgId}/${projectId}/integrations/${integration.id}/`,
+      options
+    );
+  };
+
+  handleToggleProjectIntegration = (integration, enabled) => {
+    if (enabled) {
+      this.handleEnableProjectIntegration(integration);
+    } else {
+      this.handleRemoveProjectIntegration(integration);
+    }
+  };
+
   renderAlertLink(provider) {
     const config = provider.metadata.aspects.alert_link;
 
@@ -201,6 +262,8 @@ export default class OrganizationIntegration extends AsyncView {
       </PanelHeader>
     );
 
+    const {orgId, projectId} = this.props.params;
+
     const integrationList =
       integrations.length === 0 ? (
         <EmptyMessage>{t('No %s integrations configured.', provider.name)}</EmptyMessage>
@@ -208,8 +271,11 @@ export default class OrganizationIntegration extends AsyncView {
         integrations.map(integration => (
           <InstalledIntegration
             key={integration.id}
+            orgId={orgId}
+            projectId={projectId}
             provider={provider}
             integration={integration}
+            onToggleEnabled={e => this.handleToggleProjectIntegration(integration, e)}
             onRemove={() => this.handleDeleteIntegration(integration)}
           />
         ))
diff --git a/src/sentry/static/sentry/app/views/organizationIntegration/installedIntegration.jsx b/src/sentry/static/sentry/app/views/organizationIntegration/installedIntegration.jsx
index 7d64c401f3..b43efb3aff 100644
--- a/src/sentry/static/sentry/app/views/organizationIntegration/installedIntegration.jsx
+++ b/src/sentry/static/sentry/app/views/organizationIntegration/installedIntegration.jsx
@@ -1,12 +1,16 @@
-import {Box} from 'grid-emotion';
+import {Box, Flex} from 'grid-emotion';
 import PropTypes from 'prop-types';
 import React from 'react';
 import styled from 'react-emotion';
 
+import {PanelItem, PanelAlert} from 'app/components/panels';
 import {t} from 'app/locale';
 import Button from 'app/components/buttons/button';
 import Confirm from 'app/components/confirm';
-import {PanelItem} from 'app/components/panels';
+import Switch from 'app/components/switch';
+import Tooltip from 'app/components/tooltip';
+import FieldFromConfig from 'app/views/settings/components/forms/fieldFromConfig';
+import Form from 'app/views/settings/components/forms/form';
 
 const IntegrationIcon = styled.img`
   height: 32px;
@@ -27,36 +31,144 @@ const DomainName = styled.div`
 
 export default class InstalledIntegration extends React.Component {
   static propTypes = {
+    orgId: PropTypes.string.isRequired,
+    projectId: PropTypes.string.isRequired,
     provider: PropTypes.object.isRequired,
     integration: PropTypes.object.isRequired,
     onRemove: PropTypes.func.isRequired,
+    onToggleEnabled: PropTypes.func.isRequired,
   };
 
-  render() {
-    const {integration} = this.props;
+  constructor() {
+    super();
+    this.state = {configuring: false};
+  }
+
+  onConfigure = () => this.setState({configuring: !this.state.configuring});
+
+  renderConfiguration() {
+    const {integration, orgId, projectId} = this.props;
+    const {configProject, configOrganization} = integration;
+
+    // Since integrations currently live under project settings, we have the
+    // context needed to display both organizatoon-level integration
+    // configuration, as well as project-level integration configuration. We
+    // make the seperation clear with an alert for now.
+
+    const formProps = {
+      hideFooter: true,
+      saveOnBlur: true,
+      allowUndo: true,
+      apiMethod: 'POST',
+      dataTransformer: data => ({config: data}),
+    };
 
     return (
-      <PanelItem p={0} py={2} key={integration.id}>
-        <Box pl={2}>
-          <IntegrationIcon src={integration.icon} />
-        </Box>
-        <Box px={2} flex={1}>
-          <IntegrationName>{integration.name}</IntegrationName>
-          <DomainName>{integration.domain_name}</DomainName>
-        </Box>
-        <Box mr={1} pr={2}>
-          <Confirm
-            message={t(
-              'Removing this inegration will disable the integration for all projects. Are you sure you want to remove this integration?'
-            )}
-            onConfirm={() => this.props.onRemove()}
+      <React.Fragment>
+        {configProject.length > 0 && (
+          <Form
+            {...formProps}
+            initialData={integration.configDataProjects[projectId]}
+            apiEndpoint={`/projects/${orgId}/${projectId}/integrations/${integration.id}/`}
           >
-            <Button size="small">
-              <span className="icon icon-trash" style={{margin: 0}} />
-            </Button>
-          </Confirm>
-        </Box>
-      </PanelItem>
+            {configProject.map(field => (
+              <FieldFromConfig key={field.name} field={field} />
+            ))}
+          </Form>
+        )}
+        {configOrganization.length > 0 && (
+          <React.Fragment>
+            <PanelAlert type="info">
+              {t(
+                'The following configurations are organization-scoped. Changing these will change the settings globally.'
+              )}
+            </PanelAlert>
+            <Form
+              {...formProps}
+              initialData={integration.configData}
+              apiEndpoint={`/organizations/${this.props
+                .orgId}/integrations/${integration.id}/`}
+            >
+              {configOrganization.map(field => (
+                <FieldFromConfig key={field.name} field={field} />
+              ))}
+            </Form>
+          </React.Fragment>
+        )}
+      </React.Fragment>
+    );
+  }
+
+  isEnabledForProject() {
+    return this.props.integration.configDataProjects[this.props.projectId] !== undefined;
+  }
+
+  hasConfiguration() {
+    return (
+      this.props.integration.configProject.length > 0 ||
+      this.props.integration.configOrganization.length > 0
+    );
+  }
+
+  render() {
+    const {integration, provider} = this.props;
+    const enabled = this.isEnabledForProject();
+
+    return (
+      <React.Fragment>
+        <PanelItem p={0} py={2} key={integration.id} align="center">
+          <Box pl={2}>
+            <IntegrationIcon src={integration.icon} />
+          </Box>
+          <Box px={2} flex={1}>
+            <IntegrationName>{integration.name}</IntegrationName>
+            <DomainName>{integration.domainName}</DomainName>
+          </Box>
+          {provider.canAddProject && (
+            <Flex mr={1}>
+              <Tooltip title={t('Enable for this Project')}>
+                <Switch
+                  size="lg"
+                  isActive={enabled}
+                  toggle={() => this.props.onToggleEnabled(!enabled)}
+                />
+              </Tooltip>
+            </Flex>
+          )}
+          {this.hasConfiguration() && (
+            <Box mr={1}>
+              <Button
+                size="small"
+                disabled={!this.isEnabledForProject()}
+                priority={this.state.configuring ? 'primary' : undefined}
+                onClick={this.onConfigure}
+              >
+                Configure
+              </Button>
+            </Box>
+          )}
+          <Box mr={1} pr={2}>
+            <Confirm
+              message={t(
+                'Removing this inegration will disable the integration for all projects. Are you sure you want to remove this integration?'
+              )}
+              onConfirm={() => this.props.onRemove()}
+            >
+              <Button size="small">
+                <span className="icon icon-trash" style={{margin: 0}} />
+              </Button>
+            </Confirm>
+          </Box>
+        </PanelItem>
+        <div
+          style={{
+            display:
+              this.state.configuring && this.isEnabledForProject() ? 'block' : 'none',
+          }}
+        >
+          {this.renderConfiguration()}
+        </div>
+      </React.Fragment>
     );
   }
 }
diff --git a/tests/js/setup.js b/tests/js/setup.js
index 392688597e..df9ef686cb 100644
--- a/tests/js/setup.js
+++ b/tests/js/setup.js
@@ -469,6 +469,7 @@ window.TestStubs = {
       key: 'github',
       name: 'GitHub',
       canAdd: true,
+      canAddProject: false,
       config: [],
       setupDialog: {
         url: '/github-integration-setup-uri/',
@@ -494,7 +495,7 @@ window.TestStubs = {
 
   GitHubIntegration: params => {
     return {
-      domain_name: 'gtithub.com/test-integration',
+      domainName: 'gtithub.com/test-integration',
       icon: 'http://example.com/integration_icon.png',
       id: '1',
       name: 'Test Integration',
@@ -502,6 +503,10 @@ window.TestStubs = {
         name: 'GitHub',
         key: 'github',
       },
+      configOrganization: [],
+      configProject: [],
+      configData: {},
+      configDataProjects: {},
       ...params,
     };
   },
diff --git a/tests/js/spec/views/organizationIntegration/__snapshots__/index.spec.jsx.snap b/tests/js/spec/views/organizationIntegration/__snapshots__/index.spec.jsx.snap
index e1bf4c5f98..aff58812a8 100644
--- a/tests/js/spec/views/organizationIntegration/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/views/organizationIntegration/__snapshots__/index.spec.jsx.snap
@@ -1,655 +1,135 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
 exports[`OrganizationIntegration render() with one integration renders 1`] = `
-<OrganizationIntegration
-  params={
-    Object {
-      "orgId": "org-slug",
-      "providerKey": "github",
-    }
-  }
+<SideEffect(DocumentTitle)
+  title="GitHub Integration - Sentry"
 >
-  <SideEffect(DocumentTitle)
-    title="GitHub Integration - Sentry"
-  >
-    <DocumentTitle
-      title="GitHub Integration - Sentry"
-    >
-      <SettingsPageHeading
-        icon={
-          <PluginIcon
-            pluginId="github"
-            size={28}
-          />
-        }
-        title="GitHub"
-      >
-        <Wrapper>
-          <div
-            className="css-1pnrn3o-Wrapper e1kblvez0"
-          >
-            <Flex
-              align="center"
-            >
-              <Base
-                align="center"
-                className="css-5ipae5"
-              >
-                <div
-                  className="css-5ipae5"
-                  is={null}
-                >
-                  <Box
-                    pr={1}
-                  >
-                    <Base
-                      className="css-ioegso"
-                      pr={1}
-                    >
-                      <div
-                        className="css-ioegso"
-                        is={null}
-                      >
-                        <PluginIcon
-                          pluginId="github"
-                          size={28}
-                        >
-                          <IntegrationIcon
-                            image={Object {}}
-                            size={28}
-                          >
-                            <div
-                              className="css-1g0dosy-IntegrationIcon e1bhjds90"
-                              size={28}
-                            />
-                          </IntegrationIcon>
-                        </PluginIcon>
-                      </div>
-                    </Base>
-                  </Box>
-                  <Title>
-                    <div
-                      className="css-zmdcxu-Title e1kblvez1"
-                    >
-                      GitHub
-                    </div>
-                  </Title>
-                </div>
-              </Base>
-            </Flex>
-          </div>
-        </Wrapper>
-      </SettingsPageHeading>
-      <Panel>
-        <StyledPanel>
-          <div
-            className="css-17lswg2-StyledPanel e1laxa7d0"
-          >
-            <PanelHeader
-              disablePadding={true}
-              hasButtons={true}
-            >
-              <StyledPanelHeader
-                disablePadding={true}
-                hasButtons={true}
-              >
-                <Component
-                  className="css-72tw6l-StyledPanelHeader-getPadding e1p8v8nv0"
-                  disablePadding={true}
-                  hasButtons={true}
-                >
-                  <Flex
-                    align="center"
-                    className="css-72tw6l-StyledPanelHeader-getPadding e1p8v8nv0"
-                    justify="space-between"
-                  >
-                    <Base
-                      align="center"
-                      className="e1p8v8nv0 css-ce5pxn-StyledPanelHeader-getPadding"
-                      justify="space-between"
-                    >
-                      <div
-                        className="e1p8v8nv0 css-ce5pxn-StyledPanelHeader-getPadding"
-                        is={null}
-                      >
-                        <Box
-                          px={2}
-                        >
-                          <Base
-                            className="css-17pfgr6"
-                            px={2}
-                          >
-                            <div
-                              className="css-17pfgr6"
-                              is={null}
-                            >
-                              Installation
-                            </div>
-                          </Base>
-                        </Box>
-                        <Box
-                          mr={1}
-                        >
-                          <Base
-                            className="css-xgysgc"
-                            mr={1}
-                          >
-                            <div
-                              className="css-xgysgc"
-                              is={null}
-                            >
-                              <Button
-                                disabled={false}
-                                onClick={[Function]}
-                                size="xsmall"
-                              >
-                                <StyledButton
-                                  disabled={false}
-                                  onClick={[Function]}
-                                  role="button"
-                                  size="xsmall"
-                                >
-                                  <Component
-                                    className="css-dkprmi-StyledButton-getColors e17811v30"
-                                    disabled={false}
-                                    onClick={[Function]}
-                                    role="button"
-                                    size="xsmall"
-                                  >
-                                    <button
-                                      className="css-dkprmi-StyledButton-getColors e17811v30"
-                                      disabled={false}
-                                      onClick={[Function]}
-                                      role="button"
-                                      size="xsmall"
-                                    >
-                                      <ButtonLabel
-                                        size="xsmall"
-                                      >
-                                        <Component
-                                          className="css-9vplug-ButtonLabel e17811v31"
-                                          size="xsmall"
-                                        >
-                                          <Flex
-                                            align="center"
-                                            className="css-9vplug-ButtonLabel e17811v31"
-                                            size="xsmall"
-                                          >
-                                            <Base
-                                              align="center"
-                                              className="e17811v31 css-esdzbq-ButtonLabel"
-                                              size="xsmall"
-                                            >
-                                              <div
-                                                className="e17811v31 css-esdzbq-ButtonLabel"
-                                                is={null}
-                                                size="xsmall"
-                                              >
-                                                <span
-                                                  className="icon icon-add"
-                                                />
-                                                 
-                                                Add Installation
-                                              </div>
-                                            </Base>
-                                          </Flex>
-                                        </Component>
-                                      </ButtonLabel>
-                                    </button>
-                                  </Component>
-                                </StyledButton>
-                              </Button>
-                            </div>
-                          </Base>
-                        </Box>
-                      </div>
-                    </Base>
-                  </Flex>
-                </Component>
-              </StyledPanelHeader>
-            </PanelHeader>
-            <PanelBody
-              direction="column"
-              disablePadding={true}
-              flex={false}
-            >
-              <div
-                className="css-9vq8an-textStyles"
-              >
-                <InstalledIntegration
-                  integration={
-                    Object {
-                      "domain_name": "gtithub.com/test-integration",
-                      "icon": "http://example.com/integration_icon.png",
-                      "id": "1",
-                      "name": "Test Integration",
-                      "provider": Object {
-                        "key": "github",
-                        "name": "GitHub",
-                      },
-                    }
-                  }
-                  key="1"
-                  onRemove={[Function]}
-                  provider={
-                    Object {
-                      "canAdd": true,
-                      "config": Array [],
-                      "key": "github",
-                      "metadata": Object {
-                        "aspects": Object {
-                          "alert_link": Object {
-                            "link": "/url/with/params/{orgId}/",
-                            "text": "This is a *alert link* with markdown formatting",
-                          },
-                        },
-                        "author": "Morty",
-                        "description": "*markdown* formatted _description_",
-                        "issue_url": "http://example.com/integration_issue_url",
-                        "noun": "Installation",
-                        "source_url": "http://example.com/integration_source_url",
-                      },
-                      "name": "GitHub",
-                      "setupDialog": Object {
-                        "height": 100,
-                        "url": "/github-integration-setup-uri/",
-                        "width": 100,
-                      },
-                    }
-                  }
-                >
-                  <PanelItem
-                    key="1"
-                    p={0}
-                    py={2}
-                  >
-                    <StyledPanelItem
-                      p={0}
-                      py={2}
-                    >
-                      <Base
-                        className="css-1uon4oe-StyledPanelItem eo8n7lk0"
-                        p={0}
-                        py={2}
-                      >
-                        <div
-                          className="css-1uon4oe-StyledPanelItem eo8n7lk0"
-                          is={null}
-                        >
-                          <Box
-                            pl={2}
-                          >
-                            <Base
-                              className="css-wwmrss"
-                              pl={2}
-                            >
-                              <div
-                                className="css-wwmrss"
-                                is={null}
-                              >
-                                <IntegrationIcon
-                                  src="http://example.com/integration_icon.png"
-                                >
-                                  <img
-                                    className="css-lx37iq-IntegrationIcon e13u596k0"
-                                    src="http://example.com/integration_icon.png"
-                                  />
-                                </IntegrationIcon>
-                              </div>
-                            </Base>
-                          </Box>
-                          <Box
-                            flex={1}
-                            px={2}
-                          >
-                            <Base
-                              className="css-pcjga5"
-                              flex={1}
-                              px={2}
-                            >
-                              <div
-                                className="css-pcjga5"
-                                is={null}
-                              >
-                                <IntegrationName>
-                                  <div
-                                    className="css-1daz7ru-IntegrationName e13u596k1"
-                                  >
-                                    Test Integration
-                                  </div>
-                                </IntegrationName>
-                                <DomainName>
-                                  <div
-                                    className="css-1ay0cji-DomainName e13u596k2"
-                                  >
-                                    gtithub.com/test-integration
-                                  </div>
-                                </DomainName>
-                              </div>
-                            </Base>
-                          </Box>
-                          <Box
-                            mr={1}
-                            pr={2}
-                          >
-                            <Base
-                              className="css-3n6m02"
-                              mr={1}
-                              pr={2}
-                            >
-                              <div
-                                className="css-3n6m02"
-                                is={null}
-                              >
-                                <Confirm
-                                  cancelText="Cancel"
-                                  confirmText="Confirm"
-                                  message="Removing this inegration will disable the integration for all projects. Are you sure you want to remove this integration?"
-                                  onConfirm={[Function]}
-                                  priority="primary"
-                                >
-                                  <Button
-                                    disabled={false}
-                                    onClick={[Function]}
-                                    size="small"
-                                  >
-                                    <StyledButton
-                                      disabled={false}
-                                      onClick={[Function]}
-                                      role="button"
-                                      size="small"
-                                    >
-                                      <Component
-                                        className="css-dkprmi-StyledButton-getColors e17811v30"
-                                        disabled={false}
-                                        onClick={[Function]}
-                                        role="button"
-                                        size="small"
-                                      >
-                                        <button
-                                          className="css-dkprmi-StyledButton-getColors e17811v30"
-                                          disabled={false}
-                                          onClick={[Function]}
-                                          role="button"
-                                          size="small"
-                                        >
-                                          <ButtonLabel
-                                            size="small"
-                                          >
-                                            <Component
-                                              className="css-179w01k-ButtonLabel e17811v31"
-                                              size="small"
-                                            >
-                                              <Flex
-                                                align="center"
-                                                className="css-179w01k-ButtonLabel e17811v31"
-                                                size="small"
-                                              >
-                                                <Base
-                                                  align="center"
-                                                  className="e17811v31 css-8mahft-ButtonLabel"
-                                                  size="small"
-                                                >
-                                                  <div
-                                                    className="e17811v31 css-8mahft-ButtonLabel"
-                                                    is={null}
-                                                    size="small"
-                                                  >
-                                                    <span
-                                                      className="icon icon-trash"
-                                                      style={
-                                                        Object {
-                                                          "margin": 0,
-                                                        }
-                                                      }
-                                                    />
-                                                  </div>
-                                                </Base>
-                                              </Flex>
-                                            </Component>
-                                          </ButtonLabel>
-                                        </button>
-                                      </Component>
-                                    </StyledButton>
-                                  </Button>
-                                  <Modal
-                                    animation={false}
-                                    autoFocus={true}
-                                    backdrop={true}
-                                    bsClass="modal"
-                                    dialogComponentClass={[Function]}
-                                    enforceFocus={true}
-                                    keyboard={true}
-                                    manager={
-                                      ModalManager {
-                                        "add": [Function],
-                                        "containers": Array [],
-                                        "data": Array [],
-                                        "handleContainerOverflow": true,
-                                        "hideSiblingNodes": true,
-                                        "isTopModal": [Function],
-                                        "modals": Array [],
-                                        "remove": [Function],
-                                      }
-                                    }
-                                    onHide={[Function]}
-                                    renderBackdrop={[Function]}
-                                    restoreFocus={true}
-                                    show={false}
-                                  >
-                                    <Modal
-                                      autoFocus={true}
-                                      backdrop={true}
-                                      backdropClassName="modal-backdrop"
-                                      containerClassName="modal-open"
-                                      enforceFocus={true}
-                                      keyboard={true}
-                                      manager={
-                                        ModalManager {
-                                          "add": [Function],
-                                          "containers": Array [],
-                                          "data": Array [],
-                                          "handleContainerOverflow": true,
-                                          "hideSiblingNodes": true,
-                                          "isTopModal": [Function],
-                                          "modals": Array [],
-                                          "remove": [Function],
-                                        }
-                                      }
-                                      onEntering={[Function]}
-                                      onExited={[Function]}
-                                      onHide={[Function]}
-                                      renderBackdrop={[Function]}
-                                      restoreFocus={true}
-                                      show={false}
-                                    />
-                                  </Modal>
-                                </Confirm>
-                              </div>
-                            </Base>
-                          </Box>
-                        </div>
-                      </Base>
-                    </StyledPanelItem>
-                  </PanelItem>
-                </InstalledIntegration>
-              </div>
-            </PanelBody>
-          </div>
-        </StyledPanel>
-      </Panel>
-      <AlertLink
-        to="/url/with/params/org-slug/"
+  <React.Fragment>
+    <SettingsPageHeading
+      icon={
+        <PluginIcon
+          pluginId="github"
+          size={28}
+        />
+      }
+      title="GitHub"
+    />
+    <Panel>
+      <PanelHeader
+        disablePadding={true}
+        hasButtons={true}
       >
-        <Component
-          className="css-bvjbpd-AlertLink e1fthm6j2"
-          to="/url/with/params/org-slug/"
+        <Box
+          px={2}
         >
-          <Link
-            className="css-bvjbpd-AlertLink e1fthm6j2"
-            to="/url/with/params/org-slug/"
+          Installation
+        </Box>
+        <Box
+          mr={1}
+        >
+          <Button
+            disabled={false}
+            onClick={[Function]}
+            size="xsmall"
           >
-            <Link
-              className="css-bvjbpd-AlertLink e1fthm6j2"
-              onlyActiveOnIndex={false}
-              style={Object {}}
-              to="/url/with/params/org-slug/"
-            >
-              <a
-                className="css-bvjbpd-AlertLink e1fthm6j2"
-                onClick={[Function]}
-                style={Object {}}
-              >
-                <AlertLinkText>
-                  <div
-                    className="css-19z7wog-AlertLinkText e1fthm6j0"
-                  >
-                    <span
-                      dangerouslySetInnerHTML={
-                        Object {
-                          "__html": "This is a <em>alert link</em> with markdown formatting",
-                        }
-                      }
-                    />
-                  </div>
-                </AlertLinkText>
-                <InlineSvg
-                  size="1em"
-                  src="icon-chevron-right"
-                >
-                  <StyledSvg
-                    height="1em"
-                    viewBox={Object {}}
-                    width="1em"
-                  >
-                    <svg
-                      className="css-ryh69w-StyledSvg e2idor0"
-                      height="1em"
-                      viewBox={Object {}}
-                      width="1em"
-                    >
-                      <use
-                        href="#test"
-                        xlinkHref="#test"
-                      />
-                    </svg>
-                  </StyledSvg>
-                </InlineSvg>
-              </a>
-            </Link>
-          </Link>
-        </Component>
-      </AlertLink>
-      <hr />
-      <h5>
-        GitHub Integration
-      </h5>
-      <IntegrationDetails
-        author="Morty"
-        links={
-          Array [
+            <span
+              className="icon icon-add"
+            />
+             
+            Add Installation
+          </Button>
+        </Box>
+      </PanelHeader>
+      <PanelBody
+        direction="column"
+        disablePadding={true}
+        flex={false}
+      >
+        <InstalledIntegration
+          integration={
             Object {
-              "href": "http://example.com/integration_issue_url",
-              "title": "Report an Issue",
-            },
+              "configData": Object {},
+              "configDataProjects": Object {},
+              "configOrganization": Array [],
+              "configProject": Array [],
+              "domainName": "gtithub.com/test-integration",
+              "icon": "http://example.com/integration_icon.png",
+              "id": "1",
+              "name": "Test Integration",
+              "provider": Object {
+                "key": "github",
+                "name": "GitHub",
+              },
+            }
+          }
+          key="1"
+          onRemove={[Function]}
+          onToggleEnabled={[Function]}
+          orgId="org-slug"
+          projectId="project-slug"
+          provider={
             Object {
-              "href": "http://example.com/integration_source_url",
-              "title": "View Source",
-            },
-          ]
+              "canAdd": true,
+              "canAddProject": false,
+              "config": Array [],
+              "key": "github",
+              "metadata": Object {
+                "aspects": Object {
+                  "alert_link": Object {
+                    "link": "/url/with/params/{orgId}/",
+                    "text": "This is a *alert link* with markdown formatting",
+                  },
+                },
+                "author": "Morty",
+                "description": "*markdown* formatted _description_",
+                "issue_url": "http://example.com/integration_issue_url",
+                "noun": "Installation",
+                "source_url": "http://example.com/integration_source_url",
+              },
+              "name": "GitHub",
+              "setupDialog": Object {
+                "height": 100,
+                "url": "/github-integration-setup-uri/",
+                "width": 100,
+              },
+            }
+          }
+        />
+      </PanelBody>
+    </Panel>
+    <AlertLink
+      to="/url/with/params/org-slug/"
+    >
+      <span
+        dangerouslySetInnerHTML={
+          Object {
+            "__html": "This is a <em>alert link</em> with markdown formatting",
+          }
         }
-        markdownDescription="*markdown* formatted _description_"
-      >
-        <Details>
-          <Base
-            className="css-16wp28j-Details e58h7zp0"
-          >
-            <div
-              className="css-16wp28j-Details e58h7zp0"
-              is={null}
-            >
-              <Box
-                width={0.625}
-              >
-                <Base
-                  className="css-dydpyx"
-                  width={0.625}
-                >
-                  <div
-                    className="css-dydpyx"
-                    is={null}
-                  >
-                    <Description
-                      dangerouslySetInnerHTML={
-                        Object {
-                          "__html": "<p><em>markdown</em> formatted <em>description</em></p>
-",
-                        }
-                      }
-                    >
-                      <div
-                        className="css-i2iqfw-Description e58h7zp1"
-                        dangerouslySetInnerHTML={
-                          Object {
-                            "__html": "<p><em>markdown</em> formatted <em>description</em></p>
-",
-                          }
-                        }
-                      />
-                    </Description>
-                    <AuthorName>
-                      <div
-                        className="css-agaydm-AuthorName e58h7zp2"
-                      >
-                        By Morty
-                      </div>
-                    </AuthorName>
-                  </div>
-                </Base>
-              </Box>
-              <Box
-                ml={60}
-              >
-                <Base
-                  className="css-vgctkd"
-                  ml={60}
-                >
-                  <div
-                    className="css-vgctkd"
-                    is={null}
-                  >
-                    <MetadataLink
-                      href="http://example.com/integration_issue_url"
-                      key="http://example.com/integration_issue_url"
-                    >
-                      <a
-                        className="css-5qmaie-MetadataLink e58h7zp3"
-                        href="http://example.com/integration_issue_url"
-                      >
-                        Report an Issue
-                      </a>
-                    </MetadataLink>
-                    <MetadataLink
-                      href="http://example.com/integration_source_url"
-                      key="http://example.com/integration_source_url"
-                    >
-                      <a
-                        className="css-5qmaie-MetadataLink e58h7zp3"
-                        href="http://example.com/integration_source_url"
-                      >
-                        View Source
-                      </a>
-                    </MetadataLink>
-                  </div>
-                </Base>
-              </Box>
-            </div>
-          </Base>
-        </Details>
-      </IntegrationDetails>
-    </DocumentTitle>
-  </SideEffect(DocumentTitle)>
-</OrganizationIntegration>
+      />
+    </AlertLink>
+    <hr />
+    <h5>
+      GitHub Integration
+    </h5>
+    <IntegrationDetails
+      author="Morty"
+      links={
+        Array [
+          Object {
+            "href": "http://example.com/integration_issue_url",
+            "title": "Report an Issue",
+          },
+          Object {
+            "href": "http://example.com/integration_source_url",
+            "title": "View Source",
+          },
+        ]
+      }
+      markdownDescription="*markdown* formatted _description_"
+    />
+  </React.Fragment>
+</SideEffect(DocumentTitle)>
 `;
 
 exports[`OrganizationIntegration render() without any integrations Displays an error for an invalid provider key 1`] = `
diff --git a/tests/js/spec/views/organizationIntegration/index.spec.jsx b/tests/js/spec/views/organizationIntegration/index.spec.jsx
index bf2c05880c..201542fcff 100644
--- a/tests/js/spec/views/organizationIntegration/index.spec.jsx
+++ b/tests/js/spec/views/organizationIntegration/index.spec.jsx
@@ -12,10 +12,12 @@ describe('OrganizationIntegration', function() {
 
   describe('render()', function() {
     const org = TestStubs.Organization();
+    const project = TestStubs.Project();
     const provider = TestStubs.GitHubIntegrationProvider();
     const integration = TestStubs.GitHubIntegration();
     const params = {
       orgId: org.slug,
+      projectId: project.slug,
       providerKey: provider.key,
     };
     const routerContext = TestStubs.routerContext();
@@ -67,7 +69,10 @@ describe('OrganizationIntegration', function() {
       });
 
       it('renders', function() {
-        const wrapper = mount(<OrganizationIntegration params={params} />, routerContext);
+        const wrapper = shallow(
+          <OrganizationIntegration params={params} />,
+          routerContext
+        );
         expect(wrapper).toMatchSnapshot();
       });
 
@@ -94,13 +99,12 @@ describe('OrganizationIntegration', function() {
           origin: 'null',
           data: {
             success: true,
-            data: {
+            data: Object.assign({}, integration, {
               id: '2',
               domain_name: 'new-integration.github.com',
               icon: 'http://example.com/new-integration-icon.png',
               name: 'New Integration',
-              provider: integration.provider,
-            },
+            }),
           },
         });
 
@@ -110,13 +114,12 @@ describe('OrganizationIntegration', function() {
       it('Merges existing integrations', function() {
         const wrapper = mount(<OrganizationIntegration params={params} />, routerContext);
 
-        const updatedIntegration = {
+        const updatedIntegration = Object.assign({}, integration, {
           id: '1',
           domain_name: 'updated-integration.github.com',
           icon: 'http://example.com/updated-integration-icon.png',
           name: 'Updated Integration',
-          provider: integration.provider,
-        };
+        });
 
         wrapper.instance().receiveMessage({
           source: null,
diff --git a/tests/sentry/api/endpoints/test_group_integration_details.py b/tests/sentry/api/endpoints/test_group_integration_details.py
index ce0d0d44ce..c260c4ab53 100644
--- a/tests/sentry/api/endpoints/test_group_integration_details.py
+++ b/tests/sentry/api/endpoints/test_group_integration_details.py
@@ -26,7 +26,7 @@ class GroupIntegrationDetailsTest(APITestCase):
             'id': six.text_type(integration.id),
             'name': integration.name,
             'icon': integration.metadata.get('icon'),
-            'domain_name': integration.metadata.get('domain_name'),
+            'domainName': integration.metadata.get('domain_name'),
             'provider': {
                 'key': integration.get_provider().key,
                 'name': integration.get_provider().name,
@@ -58,7 +58,7 @@ class GroupIntegrationDetailsTest(APITestCase):
             'id': six.text_type(integration.id),
             'name': integration.name,
             'icon': integration.metadata.get('icon'),
-            'domain_name': integration.metadata.get('domain_name'),
+            'domainName': integration.metadata.get('domain_name'),
             'provider': {
                 'key': integration.get_provider().key,
                 'name': integration.get_provider().name,
diff --git a/tests/sentry/api/endpoints/test_group_integrations.py b/tests/sentry/api/endpoints/test_group_integrations.py
index 911d543e72..24e6991324 100644
--- a/tests/sentry/api/endpoints/test_group_integrations.py
+++ b/tests/sentry/api/endpoints/test_group_integrations.py
@@ -39,7 +39,7 @@ class GroupIntegrationsTest(APITestCase):
             'id': six.text_type(integration.id),
             'name': integration.name,
             'icon': integration.metadata.get('icon'),
-            'domain_name': integration.metadata.get('domain_name'),
+            'domainName': integration.metadata.get('domain_name'),
             'provider': {
                 'key': integration.get_provider().key,
                 'name': integration.get_provider().name,
diff --git a/tests/sentry/api/endpoints/test_organization_integration_details.py b/tests/sentry/api/endpoints/test_organization_integration_details.py
index 1c78d21d5a..ba65316700 100644
--- a/tests/sentry/api/endpoints/test_organization_integration_details.py
+++ b/tests/sentry/api/endpoints/test_organization_integration_details.py
@@ -25,7 +25,7 @@ class OrganizationIntegrationDetailsTest(APITestCase):
 
         assert response.status_code == 200, response.content
         assert response.data['id'] == six.text_type(self.integration.id)
-        assert response.data['config_data'] == {'setting': 'value'}
+        assert response.data['configData'] == {'setting': 'value'}
 
     def test_removal(self):
         team = self.create_team(organization=self.org, name='Mariachi Band')
diff --git a/tests/sentry/api/endpoints/test_project_integration_details.py b/tests/sentry/api/endpoints/test_project_integration_details.py
index dded64973b..57b6303bf7 100644
--- a/tests/sentry/api/endpoints/test_project_integration_details.py
+++ b/tests/sentry/api/endpoints/test_project_integration_details.py
@@ -36,7 +36,7 @@ class ProjectIntegrationDetailsTest(APITestCase):
 
         assert response.status_code == 200, response.content
         assert response.data['id'] == six.text_type(self.integration.id)
-        assert response.data['config_data'] == config
+        assert response.data['configData'] == config
 
     def test_enable(self):
         response = self.client.put(self.path, format='json')
