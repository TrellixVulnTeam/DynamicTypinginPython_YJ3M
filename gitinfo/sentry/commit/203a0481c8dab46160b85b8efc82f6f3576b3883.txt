commit 203a0481c8dab46160b85b8efc82f6f3576b3883
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Wed Feb 8 13:04:37 2017 -0800

    fix avatars for org members, go back to defaulting to letter avatar even if type is gravatar (#4887)
    
    * fix avatars for org members, go back to defaulting to letter avatar even if type is gravatar
    
    * fix false/true swap

diff --git a/src/sentry/templates/sentry/partial/avatar.html b/src/sentry/templates/sentry/partial/avatar.html
index 118e9a0d6c..816fafdbfd 100644
--- a/src/sentry/templates/sentry/partial/avatar.html
+++ b/src/sentry/templates/sentry/partial/avatar.html
@@ -1,14 +1,19 @@
 {% load sentry_avatars %}
 <span class="avatar">
-  {% if avatar_type == 'letter_avatar' %}
+  {% if avatar_type == 'upload' %}
+    <img src="{% profile_photo_url user_id size size %}">
+  {% else %}
     {% if for_email %}
-      {% email_avatar display_name label size size try_gravatar False %}
+      {% if avatar_type == 'letter_avatar' %}
+        {% email_avatar display_name label size size try_gravatar False %}
+      {% else %}
+        {% email_avatar display_name label size size try_gravatar True %}
+      {% endif %}
     {% else %}
       {% letter_avatar_svg display_name label size size %}
+      {% if avatar_type == 'gravatar' %}
+        <img src="{% gravatar_url email size size default 'blank' %}">
+      {% endif %}
     {% endif %}
-  {% elif avatar_type == 'upload' %}
-    <img src="{% profile_photo_url user_id size size %}">
-  {% else %}
-    <img src="{% gravatar_url email size size default 'blank' %}">
   {% endif %}
 </span>
diff --git a/src/sentry/templatetags/sentry_avatars.py b/src/sentry/templatetags/sentry_avatars.py
index a3505cbf07..55c3f9f9c4 100644
--- a/src/sentry/templatetags/sentry_avatars.py
+++ b/src/sentry/templatetags/sentry_avatars.py
@@ -7,7 +7,7 @@ from six.moves.urllib.parse import urlencode
 from templatetag_sugar.parser import Constant, Optional, Variable
 from templatetag_sugar.register import tag
 
-from sentry.models import UserAvatar
+from sentry.models import User, UserAvatar
 from sentry.utils.avatar import (
     get_email_avatar, get_gravatar_url, get_letter_avatar
 )
@@ -58,9 +58,18 @@ def email_avatar(context, display_name, identifier, size=None, try_gravatar=True
 
 @register.inclusion_tag('sentry/partial/avatar.html')
 def avatar(user, size=36):
+    # user can be User or OrganizationMember
+    if isinstance(user, User):
+        user_id = user.id
+        email = user.email
+    else:
+        user_id = user.user_id
+        email = user.email
+        if user_id:
+            email = user.user.email
     return {
-        'email': user.email,
-        'user_id': user.id,
+        'email': email,
+        'user_id': user_id,
         'size': size,
         'avatar_type': user.get_avatar_type(),
         'display_name': user.get_display_name(),
@@ -70,10 +79,19 @@ def avatar(user, size=36):
 
 @register.inclusion_tag('sentry/partial/avatar.html')
 def avatar_for_email(user, size=36):
+    # user can be User or OrganizationMember
+    if isinstance(user, User):
+        user_id = user.id
+        email = user.email
+    else:
+        user_id = user.user_id
+        email = user.email
+        if user_id:
+            email = user.user.email
     return {
         'for_email': True,
-        'email': user.email,
-        'user_id': user.id,
+        'email': email,
+        'user_id': user_id,
         'size': size,
         'avatar_type': user.get_avatar_type(),
         'display_name': user.get_display_name(),
