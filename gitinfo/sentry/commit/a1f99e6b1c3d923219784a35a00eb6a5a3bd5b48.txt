commit a1f99e6b1c3d923219784a35a00eb6a5a3bd5b48
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Fri Aug 24 10:38:14 2018 -0700

    feat(discover): Check feature access for discover endpoint (#9503)

diff --git a/src/sentry/api/endpoints/organization_discover.py b/src/sentry/api/endpoints/organization_discover.py
index 3c8df1c5d9..a968ce45c8 100644
--- a/src/sentry/api/endpoints/organization_discover.py
+++ b/src/sentry/api/endpoints/organization_discover.py
@@ -10,6 +10,7 @@ from sentry.api.bases import OrganizationEndpoint
 from sentry.models import Project, ProjectStatus, OrganizationMember, OrganizationMemberTeam
 from sentry.utils import snuba
 from sentry import roles
+from sentry import features
 
 
 class OrganizationDiscoverPermission(OrganizationPermission):
@@ -122,6 +123,10 @@ class OrganizationDiscoverEndpoint(OrganizationEndpoint):
         return snuba_results
 
     def post(self, request, organization):
+
+        if not features.has('organizations:discover', organization, actor=request.user):
+            return self.respond(status=404)
+
         serializer = DiscoverSerializer(
             data=request.DATA, context={
                 'organization': organization, 'user': request.user})
