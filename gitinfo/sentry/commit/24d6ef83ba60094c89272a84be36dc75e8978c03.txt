commit 24d6ef83ba60094c89272a84be36dc75e8978c03
Author: ted kaemming <ted@kaemming.com>
Date:   Tue Aug 22 10:02:47 2017 -0700

    Fix unmerge test that wasn't using relative timestamps. (#5942)

diff --git a/src/sentry/similarity/features.py b/src/sentry/similarity/features.py
index c3ad77e6fe..a15159f245 100644
--- a/src/sentry/similarity/features.py
+++ b/src/sentry/similarity/features.py
@@ -138,7 +138,7 @@ class FeatureSet(object):
             scope,
             key,
             items,
-            timestamp=to_timestamp(event.datetime),
+            timestamp=int(to_timestamp(event.datetime)),
         )
 
     def classify(self, events):
@@ -181,7 +181,7 @@ class FeatureSet(object):
             self.index.classify(
                 scope,
                 items,
-                timestamp=to_timestamp(event.datetime),
+                timestamp=int(to_timestamp(event.datetime)),
             ),
         )
 
diff --git a/tests/sentry/tasks/test_unmerge.py b/tests/sentry/tasks/test_unmerge.py
index 677e9f84ce..db1697a3c8 100644
--- a/tests/sentry/tasks/test_unmerge.py
+++ b/tests/sentry/tasks/test_unmerge.py
@@ -8,6 +8,7 @@ from collections import OrderedDict
 from datetime import datetime, timedelta
 
 import pytz
+from django.utils import timezone
 
 from sentry.app import tsdb
 from sentry.event_manager import ScoreClause
@@ -152,11 +153,11 @@ class UnmergeTestCase(TestCase):
         }
 
     def test_unmerge(self):
-        now = datetime(2017, 5, 3, 6, 6, 6, tzinfo=pytz.utc)
-
         def shift(i):
             return timedelta(seconds=1 << i)
 
+        now = timezone.now().replace(microsecond=0) - shift(16)
+
         project = self.create_project()
         source = self.create_group(project)
 
