commit dc5e1ccb6400afa8700ed2b24e52c7a0634b6058
Author: Daniel Griesser <daniel.griesser.86@gmail.com>
Date:   Fri Jun 16 14:21:55 2017 +0200

    Add test for in_app detection

diff --git a/tests/sentry/lang/native/test_plugin.py b/tests/sentry/lang/native/test_plugin.py
index 2448610041..3495f732bc 100644
--- a/tests/sentry/lang/native/test_plugin.py
+++ b/tests/sentry/lang/native/test_plugin.py
@@ -721,3 +721,163 @@ class InAppHonoringResolvingIntegrationTest(TestCase):
         assert long_frames[0]['instructionAddr'] == '0x002ac28b8'
         assert long_frames[1]['instructionAddr'] == '0x100020014'
         assert long_frames[2]['instructionAddr'] == '0x10002001c'
+
+    @patch.object(Symbolizer, '_symbolize_app_frame', sym_app_frame)
+    def test_in_app_function_name(self):
+        object_name = (
+            "/var/containers/Bundle/Application/"
+            "B33C37A8-F933-4B6B-9FFA-152282BFDF13/"
+            "SentryTest.app/SentryTest"
+        )
+        # '/var/containers/Bundle/Application/',
+        # '/private/var/containers/Bundle/Application/',
+        # (kscm_|kscrash_|KSCrash |SentryClient |RNSentry )
+        event_data = {
+            "sentry.interfaces.User": {
+                "ip_address": "31.172.207.97"
+            },
+            "extra": {},
+            "project": self.project.id,
+            "platform": "cocoa",
+            "debug_meta": {
+                "images": [
+                    {
+                        "type": "apple",
+                        "cpu_subtype": 0,
+                        "uuid": "C05B4DDD-69A7-3840-A649-32180D341587",
+                        "image_vmaddr": 4294967296,
+                        "image_addr": 4295098368,
+                        "cpu_type": 16777228,
+                        "image_size": 32768,
+                        "name": object_name,
+                    }
+                ]
+            },
+            "contexts": {
+                "os": {
+                    "name": "iOS",
+                    "version": "9.3.0"
+                }
+            },
+            "sentry.interfaces.Exception": {
+                "values": [
+                    {
+                        "stacktrace": {
+                            "frames": [
+                                {
+                                    "function": "[RNSentry ]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[SentryClient ]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[kscrash_]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[kscm_]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[KSCrash ]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[KSCrash]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                                {
+                                    "function": "[KSCrashy]",
+                                    "abs_path": None,
+                                    "package": "/usr/lib/system/libdyld.dylib",
+                                    "filename": None,
+                                    "symbol_addr": "0x002ac28b4",
+                                    "lineno": None,
+                                    "instruction_addr": 4295098388,
+                                },
+                            ]
+                        },
+                        "type": "NSRangeException",
+                        "mechanism": {
+                            "posix_signal": {
+                                "signal": 6,
+                                "code": 0,
+                                "name": "SIGABRT",
+                                "code_name": None
+                            },
+                            "type": "cocoa",
+                            "mach_exception": {
+                                "subcode": 0,
+                                "code": 0,
+                                "exception": 10,
+                                "exception_name": "EXC_CRASH"
+                            }
+                        },
+                        "value": (
+                            "*** -[__NSArray0 objectAtIndex:]: index 3 "
+                            "beyond bounds for empty NSArray"
+                        )
+                    }
+                ]
+            },
+            "contexts": {
+                "device": {
+                    "model_id": "N102AP",
+                    "model": "iPod7,1",
+                    "arch": "arm64",
+                    "family": "iPod"
+                },
+                "os": {
+                    "version": "9.3.2",
+                    "rooted": False,
+                    "build": "13F69",
+                    "name": "iOS"
+                }
+            }
+        }
+        resp = self._postWithHeader(event_data)
+        assert resp.status_code == 200
+
+        event = Event.objects.get()
+
+        bt = event.interfaces['sentry.interfaces.Exception'].values[0].stacktrace
+        frames = bt.frames
+        assert not frames[0].in_app
+        assert not frames[1].in_app
+        assert not frames[2].in_app
+        assert not frames[3].in_app
+        assert not frames[4].in_app
+        assert frames[5].in_app
+        assert frames[6].in_app
