commit bb53b57df59ae4f1645e44a2f7ac0067d72a4ba4
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Apr 18 16:03:49 2016 -0700

    Add CSP endpoint to Client Keys page

diff --git a/src/sentry/api/serializers/models/project_key.py b/src/sentry/api/serializers/models/project_key.py
index d461886e58..3f3f9bdd40 100644
--- a/src/sentry/api/serializers/models/project_key.py
+++ b/src/sentry/api/serializers/models/project_key.py
@@ -1,10 +1,7 @@
 from __future__ import absolute_import
 
-from django.core.urlresolvers import reverse
-
 from sentry.api.serializers import Serializer, register
 from sentry.models import ProjectKey
-from sentry.utils.http import absolute_uri
 
 
 @register(ProjectKey)
@@ -18,12 +15,7 @@ class ProjectKeySerializer(Serializer):
             'dsn': {
                 'secret': obj.dsn_private,
                 'public': obj.dsn_public,
-                'csp': '{}?sentry_key={}'.format(
-                    absolute_uri(reverse('sentry-api-csp-report', args=[
-                        obj.project_id,
-                    ])),
-                    obj.public_key,
-                ),
+                'csp': obj.csp_endpoint,
             },
             'dateCreated': obj.date_added,
         }
diff --git a/src/sentry/models/projectkey.py b/src/sentry/models/projectkey.py
index fe9efdd677..be802be493 100644
--- a/src/sentry/models/projectkey.py
+++ b/src/sentry/models/projectkey.py
@@ -15,6 +15,7 @@ from urlparse import urlparse
 from uuid import uuid4
 
 from django.conf import settings
+from django.core.urlresolvers import reverse
 from django.db import models
 from django.utils import timezone
 from django.utils.translation import ugettext_lazy as _
@@ -142,6 +143,18 @@ class ProjectKey(Model):
     def dsn_public(self):
         return self.get_dsn(public=True)
 
+    @property
+    def csp_endpoint(self):
+        endpoint = settings.SENTRY_PUBLIC_ENDPOINT or settings.SENTRY_ENDPOINT
+        if not endpoint:
+            endpoint = options.get('system.url-prefix')
+
+        return '%s%s?sentry_key=%s' % (
+            endpoint,
+            reverse('sentry-api-csp-report', args=[self.project_id]),
+            self.public_key,
+        )
+
     def get_allowed_origins(self):
         from sentry.utils.http import get_origins
         return get_origins(self.project)
diff --git a/src/sentry/templates/sentry/projects/keys.html b/src/sentry/templates/sentry/projects/keys.html
index 1647397f69..4e7b72ce72 100644
--- a/src/sentry/templates/sentry/projects/keys.html
+++ b/src/sentry/templates/sentry/projects/keys.html
@@ -2,6 +2,7 @@
 
 {% load i18n %}
 {% load sentry_helpers %}
+{% load sentry_features %}
 
 {% block title %}{% trans "Client Keys" %} | {{ block.super }}{% endblock %}
 
@@ -59,6 +60,14 @@
             <div class="form-control disabled auto-select">{{ key.dsn_public }}</div>
             <div class="help-block">{% blocktrans with 'https://github.com/getsentry/raven-js' as link %}Use your public DSN with browser-based clients such as <a href="{{ link }}">raven-js</a>.{% endblocktrans %}</div>
           </div>
+
+          {% feature projects:csp project %}
+          <div class="form-group">
+            <label>{% trans "CSP Endpoint" %}</label>
+            <div class="form-control disabled auto-select">{{ key.csp_endpoint }}</div>
+            <div class="help-block">{% blocktrans %}Use your CSP endpoint in the <code>report-uri</code> directive in your <code>Content-Security-Policy</code> header.{% endblocktrans %}</div>
+          </div>
+          {% endfeature %}
         </div>
       {% endfor %}
     </div>
