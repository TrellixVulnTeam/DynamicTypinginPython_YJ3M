commit 3350c89fe2750034200d090e6d8506185c1dd404
Author: Mark Story <mark@mark-story.com>
Date:   Mon Oct 29 20:49:23 2018 +0000

    ref(ui) Extract logout API calls into an action (#10288)
    
    Create an actionCreator function for the logout API request. I hope to
    do more of these kinds of changes but wanted to start small.
    
    Pass client instance into action creator. This allows the functions
    to be stateless and allows calling components to clear inflight
    requests should they be unmounted.

diff --git a/src/sentry/static/sentry/app/actionCreators/account.jsx b/src/sentry/static/sentry/app/actionCreators/account.jsx
index 2dde77a207..85eac708f1 100644
--- a/src/sentry/static/sentry/app/actionCreators/account.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/account.jsx
@@ -23,3 +23,9 @@ export function updateUser(user) {
   // Ideally we'd fire an action but this is gonna get refactored soon anyway
   ConfigStore.set('user', user);
 }
+
+export function logout(api) {
+  return api.requestPromise('/auth/', {
+    method: 'DELETE',
+  });
+}
diff --git a/src/sentry/static/sentry/app/components/narrowLayout.jsx b/src/sentry/static/sentry/app/components/narrowLayout.jsx
index f09ced8b4f..2af62011bc 100644
--- a/src/sentry/static/sentry/app/components/narrowLayout.jsx
+++ b/src/sentry/static/sentry/app/components/narrowLayout.jsx
@@ -3,6 +3,7 @@ import React from 'react';
 import PropTypes from 'prop-types';
 
 import {t} from 'app/locale';
+import {logout} from 'app/actionCreators/account';
 import {Client} from 'app/api';
 import styled from 'react-emotion';
 
@@ -22,12 +23,7 @@ class NarrowLayout extends React.Component {
   }
 
   handleLogout = () => {
-    this.api.request('/auth/', {
-      method: 'DELETE',
-      success: () => {
-        window.location = '/auth/login';
-      },
-    });
+    logout(this.api).then(() => (window.location = '/auth/login'));
   };
 
   render() {
diff --git a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
index ad3b3e3e58..e2008968ca 100644
--- a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
@@ -16,6 +16,7 @@ import SidebarOrgSummary from 'app/components/sidebar/sidebarOrgSummary';
 import SidebarMenuItem from 'app/components/sidebar/sidebarMenuItem';
 import SidebarDropdownMenu from 'app/components/sidebar/sidebarDropdownMenu.styled';
 import withApi from 'app/utils/withApi.jsx';
+import {logout} from 'app/actionCreators/account';
 
 import SwitchOrganization from './switchOrganization';
 import Divider from './divider.styled';
@@ -37,13 +38,7 @@ const SidebarDropdown = withApi(
     };
 
     handleLogout = (...args) => {
-      let {api} = this.props;
-      api.request('/auth/', {
-        method: 'DELETE',
-        success: res => {
-          window.location = '/auth/login';
-        },
-      });
+      logout(this.props.api).then(() => (window.location = '/auth/login'));
     };
 
     render() {
