commit 2037c7fc4536f6b62ef49a368c755c8bef7100a4
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jun 14 23:23:34 2012 -0700

    Correct handling on numeric slugs (fixes GH-521)

diff --git a/sentry/web/decorators.py b/sentry/web/decorators.py
index 000c23f5f5..c3096f3fa5 100644
--- a/sentry/web/decorators.py
+++ b/sentry/web/decorators.py
@@ -49,7 +49,14 @@ def has_access(group_or_func=None):
                     try:
                         project = Project.objects.get_from_cache(**lookup_kwargs)
                     except Project.DoesNotExist:
-                        return HttpResponseRedirect(reverse('sentry'))
+                        if project_id.isdigit():
+                            # It could be a numerical slug
+                            try:
+                                project = Project.objects.get_from_cache(slug=project_id)
+                            except Project.DoesNotExist:
+                                return HttpResponseRedirect(reverse('sentry'))
+                        else:
+                            return HttpResponseRedirect(reverse('sentry'))
                 else:
                     project = None
                 return func(request, project, *args, **kwargs)
diff --git a/tests/sentry/web/frontend/tests.py b/tests/sentry/web/frontend/tests.py
index b16047c38f..154428dd3d 100644
--- a/tests/sentry/web/frontend/tests.py
+++ b/tests/sentry/web/frontend/tests.py
@@ -61,13 +61,13 @@ class SentryViewsTest(TestCase):
 
     def test_index(self):
         self.client.login(username='admin', password='admin')
-        resp = self.client.get(reverse('sentry', kwargs={'project_id': 1}) + '?sort=freq', follow=True)
+        resp = self.client.get(reverse('sentry', kwargs={'project_id': 1}) + '?sort=freq', follow=False)
         self.assertEquals(resp.status_code, 200)
         self.assertTemplateUsed(resp, 'sentry/groups/group_list.html')
 
     def test_group_details(self):
         self.client.login(username='admin', password='admin')
-        resp = self.client.get(reverse('sentry-group', kwargs={'project_id': 1, 'group_id': 2}), follow=True)
+        resp = self.client.get(reverse('sentry-group', kwargs={'project_id': 1, 'group_id': 2}), follow=False)
         self.assertEquals(resp.status_code, 200, resp.content)
         self.assertTemplateUsed(resp, 'sentry/groups/details.html')
         self.assertTrue('group' in resp.context)
@@ -76,7 +76,7 @@ class SentryViewsTest(TestCase):
 
     def test_group_event_list(self):
         self.client.login(username='admin', password='admin')
-        resp = self.client.get(reverse('sentry-group-events', kwargs={'project_id': 1, 'group_id': 2}), follow=True)
+        resp = self.client.get(reverse('sentry-group-events', kwargs={'project_id': 1, 'group_id': 2}), follow=False)
         self.assertEquals(resp.status_code, 200, resp.content)
         self.assertTemplateUsed(resp, 'sentry/groups/event_list.html')
         self.assertTrue('group' in resp.context)
