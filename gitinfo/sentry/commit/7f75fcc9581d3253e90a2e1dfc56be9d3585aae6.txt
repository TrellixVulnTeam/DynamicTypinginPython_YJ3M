commit 7f75fcc9581d3253e90a2e1dfc56be9d3585aae6
Author: Chris Adams <chris@improbable.org>
Date:   Mon Mar 7 18:18:37 2011 -0500

    create_sort_index: handle running outside of transaction management
    
    This avoids sentry causing an unhandled exception during syncdb when running
    unit tests and using postgres by calling rollback_unless_managed instead of a
    simple rollback()

diff --git a/sentry/models.py b/sentry/models.py
index a2771ac16c..134ec09924 100644
--- a/sentry/models.py
+++ b/sentry/models.py
@@ -156,7 +156,7 @@ class GroupedMessage(MessageBase):
             cursor.execute("create index sentry_groupedmessage_score on sentry_groupedmessage ((%s))" % (cls.get_score_clause(),))
             cursor.close()
         except:
-            transaction.rollback()
+            transaction.rollback_unless_managed()
         
     @classmethod
     def get_score_clause(cls):
