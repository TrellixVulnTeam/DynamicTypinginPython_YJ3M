commit c392863d3085ba4f00595ff8130601e76d0db024
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Mar 1 22:32:16 2016 +0100

    Added endpoint for absent global files

diff --git a/src/sentry/api/endpoints/dsym_files.py b/src/sentry/api/endpoints/dsym_files.py
index c35fc55d04..5b4160d486 100644
--- a/src/sentry/api/endpoints/dsym_files.py
+++ b/src/sentry/api/endpoints/dsym_files.py
@@ -103,5 +103,14 @@ class UnknownDSymFilesEndpoint(ProjectEndpoint):
 
     def get(self, request, project):
         checksums = request.GET.getlist('checksums')
-        missing = find_missing_dsym_files(project, checksums)
+        missing = find_missing_dsym_files(checksums, project=project)
+        return Response({'missing': missing})
+
+
+class UnknownGlobalDSymFilesEndpoint(Endpoint):
+    permission_classes = (SystemPermission,)
+
+    def get(self, request):
+        checksums = request.GET.getlist('checksums')
+        missing = find_missing_dsym_files(checksums, project=None)
         return Response({'missing': missing})
diff --git a/src/sentry/api/urls.py b/src/sentry/api/urls.py
index f2e7cf9d4e..00f6748e6b 100644
--- a/src/sentry/api/urls.py
+++ b/src/sentry/api/urls.py
@@ -61,7 +61,7 @@ from .endpoints.release_details import ReleaseDetailsEndpoint
 from .endpoints.release_files import ReleaseFilesEndpoint
 from .endpoints.release_file_details import ReleaseFileDetailsEndpoint
 from .endpoints.dsym_files import DSymFilesEndpoint, GlobalDSymFilesEndpoint, \
-    UnknownDSymFilesEndpoint
+    UnknownDSymFilesEndpoint, UnknownGlobalDSymFilesEndpoint
 from .endpoints.shared_group_details import SharedGroupDetailsEndpoint
 from .endpoints.system_health import SystemHealthEndpoint
 from .endpoints.system_options import SystemOptionsEndpoint
@@ -303,6 +303,9 @@ urlpatterns = patterns(
     url(r'^system/global-dsyms/$',
         GlobalDSymFilesEndpoint.as_view(),
         name='sentry-api-0-global-dsym-files'),
+    url(r'^system/global-dsyms/unknown/$',
+        UnknownGlobalDSymFilesEndpoint.as_view(),
+        name='sentry-api-0-unknown-global-dsym-files'),
 
     # Internal
     url(r'^internal/health/$',
diff --git a/src/sentry/models/dsymfile.py b/src/sentry/models/dsymfile.py
index 4c9409d2f3..af9368ed78 100644
--- a/src/sentry/models/dsymfile.py
+++ b/src/sentry/models/dsymfile.py
@@ -179,20 +179,21 @@ def find_dsym_file(project, image_uuid):
         return None
 
 
-def find_missing_dsym_files(project, checksums):
+def find_missing_dsym_files(checksums, project=None):
     checksums = [x.lower() for x in checksums]
+    missing = set(checksums)
 
-    found = ProjectDSymFile.objects.filter(
-        file__checksum__in=checksums,
-        project=project
-    ).values('file__checksum')
+    if project is not None:
+        found = ProjectDSymFile.objects.filter(
+            file__checksum__in=checksums,
+            project=project
+        ).values('file__checksum')
 
-    missing = set(checksums)
-    for values in found:
-        missing.discard(values.values()[0])
+        for values in found:
+            missing.discard(values.values()[0])
 
-    if not missing:
-        return []
+        if not missing:
+            return []
 
     found = GlobalDSymFile.objects.filter(
         file__checksum__in=list(missing),
