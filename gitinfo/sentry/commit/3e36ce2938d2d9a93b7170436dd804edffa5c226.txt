commit 3e36ce2938d2d9a93b7170436dd804edffa5c226
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 16 15:29:25 2012 -0700

    Support slugs correctly in ensure_valid_project_id

diff --git a/sentry/coreapi.py b/sentry/coreapi.py
index fd01d69399..83b2d5b3d7 100644
--- a/sentry/coreapi.py
+++ b/sentry/coreapi.py
@@ -151,10 +151,10 @@ def project_from_api_key_and_id(api_key, project_id):
 
     if str(project_id).isdigit():
         if str(pk.project_id) != str(project_id):
-            raise APIUnauthorized()
+            raise APIUnauthorized('Invalid project id')
     else:
         if str(pk.project.slug) != str(project_id):
-            raise APIUnauthorized()
+            raise APIUnauthorized('Invalid project id')
 
     project = Project.objects.get_from_cache(pk=pk.project_id)
 
@@ -243,7 +243,7 @@ def safely_load_json_string(json_string):
 def ensure_valid_project_id(desired_project, data):
     # Confirm they're using either the master key, or their specified project
     # matches with the signed project.
-    if desired_project and str(data.get('project', '')) != str(desired_project.pk):
+    if desired_project and str(data.get('project', '')) not in [str(desired_project.pk), desired_project.slug]:
         raise APIForbidden('Invalid credentials')
     elif not desired_project:
         data['project'] = 1
diff --git a/setup.py b/setup.py
index bae076c92f..335023f98d 100755
--- a/setup.py
+++ b/setup.py
@@ -50,7 +50,7 @@ install_requires = [
 
 setup(
     name='sentry',
-    version='4.0.6',
+    version='4.0.7',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/sentry',
