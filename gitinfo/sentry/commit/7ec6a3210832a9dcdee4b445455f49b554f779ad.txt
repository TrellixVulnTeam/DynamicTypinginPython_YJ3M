commit 7ec6a3210832a9dcdee4b445455f49b554f779ad
Author: Matte Noble <me@mattenoble.com>
Date:   Mon May 20 10:26:57 2019 -0700

    ref(app-platform): Transaction with statement (#13275)
    
    Changes Mediators to use the `with transaction.atomic()` syntax, instead
    of the decorator, in an attempt to include `BEGIN` and `COMMIT`
    statements in Sentry Breadcrumbs.

diff --git a/src/sentry/mediators/mediator.py b/src/sentry/mediators/mediator.py
index 01409918b8..ddf4d99095 100644
--- a/src/sentry/mediators/mediator.py
+++ b/src/sentry/mediators/mediator.py
@@ -153,15 +153,15 @@ class Mediator(object):
             param.setup(cls, name)
 
     @classmethod
-    @transaction.atomic
     def run(cls, *args, **kwargs):
-        obj = cls(*args, **kwargs)
-
-        with obj.log():
-            result = obj.call()
-            obj.audit()
-            obj.record_analytics()
-            return result
+        with transaction.atomic():
+            obj = cls(*args, **kwargs)
+
+            with obj.log():
+                result = obj.call()
+                obj.audit()
+                obj.record_analytics()
+                return result
 
     def __init__(self, *args, **kwargs):
         self.kwargs = kwargs
