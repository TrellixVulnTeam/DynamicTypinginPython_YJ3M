commit b09f0f42cdf3854c605054006d9d1358650110b2
Author: Oliver Bristow <evilumbrella+github@gmail.com>
Date:   Mon Nov 26 13:43:08 2018 -0600

    add X-Sentry-Environment header to email notifications (#6567)

diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index 1cd171d0fc..5e8e5886f1 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -19,7 +19,7 @@ from django.utils.encoding import force_text
 from django.utils.safestring import mark_safe
 
 from sentry import features, options
-from sentry.models import ProjectOwnership, User
+from sentry.models import Environment, ProjectOwnership, User
 
 from sentry.digests.utilities import get_digest_metadata, get_personalized_digests
 from sentry.plugins import register
@@ -271,6 +271,7 @@ class MailPlugin(NotificationPlugin):
             'X-Sentry-Logger-Level': group.get_level_display(),
             'X-Sentry-Project': project.slug,
             'X-Sentry-Reply-To': group_id_to_email(group.id),
+            'X-Sentry-Environment': Environment.get_name_or_default(event.get_tag('environment')),
         }
 
         for user_id in self.get_send_to(project=project, event=event):
