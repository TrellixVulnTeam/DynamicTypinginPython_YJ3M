commit b0a6eb4c2c7777013f41c4687f5e2325cd0525bc
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Aug 26 11:39:32 2015 -0700

    Add test proving fingerprint works as expected

diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index c0de962dd1..22c6acbf56 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -116,7 +116,8 @@ class EventManagerTest(TransactionTestCase):
             message='foo', event_id='a' * 32,
             fingerprint=['a' * 32],
         ))
-        event = manager.save(1)
+        with self.tasks():
+            event = manager.save(1)
 
         manager = EventManager(self.make_event(
             message='foo bar', event_id='b' * 32,
@@ -131,6 +132,23 @@ class EventManagerTest(TransactionTestCase):
         assert group.last_seen.replace(microsecond=0) == event.datetime.replace(microsecond=0)
         assert group.message == event2.message
 
+    def test_differentiates_with_fingerprint(self):
+        manager = EventManager(self.make_event(
+            message='foo', event_id='a' * 32,
+            fingerprint=['{{ default }}', 'a' * 32],
+        ))
+        with self.tasks():
+            event = manager.save(1)
+
+        manager = EventManager(self.make_event(
+            message='foo bar', event_id='b' * 32,
+            fingerprint=['a' * 32],
+        ))
+        with self.tasks():
+            event2 = manager.save(1)
+
+        assert event.group_id != event2.group_id
+
     def test_unresolves_group(self):
         # N.B. EventManager won't unresolve the group unless the event2 has a
         # later timestamp than event1. MySQL doesn't support microseconds.
