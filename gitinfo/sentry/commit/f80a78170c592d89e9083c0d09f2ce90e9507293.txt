commit f80a78170c592d89e9083c0d09f2ce90e9507293
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Oct 9 10:56:59 2017 -0700

    fix(auth): Handle case when username or password is empty
    
    Fixes SENTRY-4WH

diff --git a/src/sentry/web/forms/accounts.py b/src/sentry/web/forms/accounts.py
index 45af0999fa..c88c63d572 100644
--- a/src/sentry/web/forms/accounts.py
+++ b/src/sentry/web/forms/accounts.py
@@ -134,6 +134,13 @@ class AuthenticationForm(forms.Form):
 
     def clean(self):
         username = self.cleaned_data.get('username')
+        password = self.cleaned_data.get('password')
+
+        if not (username and password):
+            raise forms.ValidationError(
+                self.error_messages['invalid_login'] %
+                {'username': self.username_field.verbose_name}
+            )
 
         if self.is_rate_limited():
             logger.info(
@@ -145,15 +152,13 @@ class AuthenticationForm(forms.Form):
             )
             raise forms.ValidationError(self.error_messages['rate_limited'])
 
-        password = self.cleaned_data.get('password')
+        self.user_cache = authenticate(username=username, password=password)
+        if self.user_cache is None:
+            raise forms.ValidationError(
+                self.error_messages['invalid_login'] %
+                {'username': self.username_field.verbose_name}
+            )
 
-        if username and password:
-            self.user_cache = authenticate(username=username, password=password)
-            if self.user_cache is None:
-                raise forms.ValidationError(
-                    self.error_messages['invalid_login'] %
-                    {'username': self.username_field.verbose_name}
-                )
         self.check_for_test_cookie()
         return self.cleaned_data
 
