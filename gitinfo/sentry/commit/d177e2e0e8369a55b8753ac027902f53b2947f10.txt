commit d177e2e0e8369a55b8753ac027902f53b2947f10
Author: William Mak <william@wmak.io>
Date:   Tue Jun 23 15:49:02 2020 -0400

    fix(discover): Fix flakey KeyTransactions test
    
    - Continues the work from #19341, where "Some tests were failing because
      it wasn't including the last bucket because we were no longer adding
      the rollup."
    - These tests have an hour long interval so backing them up by an hour
      moves them to the previous bucket

diff --git a/tests/snuba/api/endpoints/test_discover_key_transactions.py b/tests/snuba/api/endpoints/test_discover_key_transactions.py
index 46b6676cb8..aac722f47e 100644
--- a/tests/snuba/api/endpoints/test_discover_key_transactions.py
+++ b/tests/snuba/api/endpoints/test_discover_key_transactions.py
@@ -632,7 +632,9 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
     def test_key_transaction_stats(self, mock_now):
         mock_now.return_value = before_now().replace(tzinfo=pytz.utc)
         data = load_data(
-            "transaction", timestamp=before_now(minutes=30), start_timestamp=before_now(minutes=31)
+            "transaction",
+            timestamp=before_now(hours=1, minutes=30),
+            start_timestamp=before_now(hours=1, minutes=31),
         )
         event_ids = ["d" * 32, "e" * 32, "f" * 32]
         for event_id in event_ids:
@@ -673,8 +675,8 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
             "spans": [],
             "contexts": {"trace": {"op": "foobar", "trace_id": "a" * 32, "span_id": "a" * 16}},
             "tags": {"important": "yes"},
-            "timestamp": iso_format(before_now(minutes=30)),
-            "start_timestamp": iso_format(before_now(minutes=31)),
+            "timestamp": iso_format(before_now(hours=1, minutes=30)),
+            "start_timestamp": iso_format(before_now(hours=1, minutes=31)),
         }
         fixtures = (("d" * 32, "yes"), ("e" * 32, "no"), ("f" * 32, "yes"))
         for fixture in fixtures:
@@ -713,7 +715,9 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
     def test_key_transaction_stats_with_no_key_transactions(self, mock_now):
         mock_now.return_value = before_now().replace(tzinfo=pytz.utc)
         data = load_data(
-            "transaction", timestamp=before_now(minutes=30), start_timestamp=before_now(minutes=31)
+            "transaction",
+            timestamp=before_now(hours=1, minutes=30),
+            start_timestamp=before_now(hours=1, minutes=31),
         )
         event_ids = ["d" * 32, "e" * 32, "f" * 32]
         for event_id in event_ids:
@@ -745,7 +749,9 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
     def test_key_transaction_stats_with_multi_yaxis(self, mock_now):
         mock_now.return_value = before_now().replace(tzinfo=pytz.utc)
         data = load_data(
-            "transaction", timestamp=before_now(minutes=30), start_timestamp=before_now(minutes=31)
+            "transaction",
+            timestamp=before_now(hours=1, minutes=30),
+            start_timestamp=before_now(hours=1, minutes=31),
         )
         event_ids = ["d" * 32, "e" * 32, "f" * 32]
         for event_id in event_ids:
@@ -788,7 +794,9 @@ class KeyTransactionTest(APITestCase, SnubaTestCase):
     def test_key_transaction_stats_with_multi_yaxis_no_key_transactions(self, mock_now):
         mock_now.return_value = before_now().replace(tzinfo=pytz.utc)
         data = load_data(
-            "transaction", timestamp=before_now(minutes=30), start_timestamp=before_now(minutes=31)
+            "transaction",
+            timestamp=before_now(hours=1, minutes=30),
+            start_timestamp=before_now(hours=1, minutes=31),
         )
         event_ids = ["d" * 32, "e" * 32, "f" * 32]
         for event_id in event_ids:
