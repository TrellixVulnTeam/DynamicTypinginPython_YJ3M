commit 59524c5394ac4bcf91c42bd03d2b6ea1fa49e363
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Jan 28 15:41:08 2016 -0800

    Only spit out crossorigin script tags when cross origin
    
    Fixes GH-2612

diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index 435fcba01c..18d376a518 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -31,8 +31,8 @@
   <title>{% block title %}Sentry{% endblock %}</title>
 
   {% block scripts %}
-  <script src="{% asset_url "sentry" "dist/vendor.js" %}" crossorigin="anonymous"></script>
-  <script src="{% asset_url "sentry" "dist/app.js" %}" crossorigin="anonymous"></script>
+  <script src="{% asset_url "sentry" "dist/vendor.js" %}"{% crossorigin %}></script>
+  <script src="{% asset_url "sentry" "dist/app.js" %}"{% crossorigin %}></script>
 
   <script>
     for (var n in window.exports) {
diff --git a/src/sentry/templatetags/sentry_assets.py b/src/sentry/templatetags/sentry_assets.py
index 3b10b72cf9..6121a751f5 100644
--- a/src/sentry/templatetags/sentry_assets.py
+++ b/src/sentry/templatetags/sentry_assets.py
@@ -1,7 +1,9 @@
 from __future__ import absolute_import
 
+from django.conf import settings
 from django.template import Library
 
+from sentry import options
 from sentry.utils.assets import get_asset_url
 from sentry.utils.http import absolute_uri
 
@@ -21,3 +23,15 @@ def absolute_asset_url(module, path):
       =>  "http://sentry.example.com/_static/74d127b78dc7daf2c51f/sentry/dist/sentry.css"
     """
     return absolute_uri(get_asset_url(module, path))
+
+
+@register.simple_tag
+def crossorigin():
+    """
+    Returns an additional crossorigin="anonymous" snippet for use in a <script> tag if
+    our asset urls are from a different domain than the system.url-prefix.
+    """
+    if absolute_uri(settings.STATIC_URL).startswith(options.get('system.url-prefix')):
+        # They share the same domain prefix, so we don't need CORS
+        return ''
+    return ' crossorigin="anonymous"'
