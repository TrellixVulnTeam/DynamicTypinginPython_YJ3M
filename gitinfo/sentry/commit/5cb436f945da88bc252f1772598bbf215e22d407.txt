commit 5cb436f945da88bc252f1772598bbf215e22d407
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Thu Mar 3 20:46:36 2016 +0100

    Added task for deleting old dsym cache entries

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 86f951db8d..746776f924 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -483,6 +483,13 @@ CELERYBEAT_SCHEDULE = {
             'expires': 300,
         },
     },
+    'clear-old-cached-dsyms': {
+        'task': 'sentry.tasks.clear_old_cached_dsyms',
+        'schedule': timedelta(minutes=60),
+        'options': {
+            'expires': 3600,
+        },
+    },
 }
 
 LOGGING = {
diff --git a/src/sentry/lang/native/dsymcache.py b/src/sentry/lang/native/dsymcache.py
index 0ed7923638..1468c089aa 100644
--- a/src/sentry/lang/native/dsymcache.py
+++ b/src/sentry/lang/native/dsymcache.py
@@ -8,6 +8,7 @@ from sentry.models import find_dsym_file
 
 
 ONE_DAY = 60 * 60 * 24
+ONE_DAY_AND_A_HALF = int(ONE_DAY * 1.5)
 
 
 class DSymCache(object):
@@ -71,5 +72,31 @@ class DSymCache(object):
 
         return dsym
 
+    def clear_old_entries(self):
+        try:
+            cache_folders = os.listdir(settings.DSYM_CACHE_PATH)
+        except OSError:
+            pass
+
+        cutoff = int(time.time()) - ONE_DAY_AND_A_HALF
+
+        for cache_folder in cache_folders:
+            cache_folder = os.path.join(settings.DSYM_CACHE_PATH, cache_folder)
+            try:
+                items = os.listdir(cache_folder)
+            except OSError:
+                continue
+            for cached_file in items:
+                cached_file = os.path.join(cache_folder, cached_file)
+                try:
+                    mtime = os.path.getmtime(cached_file)
+                except OSError:
+                    continue
+                if mtime < cutoff:
+                    try:
+                        os.remove(cached_file)
+                    except OSError:
+                        pass
+
 
 dsymcache = DSymCache()
