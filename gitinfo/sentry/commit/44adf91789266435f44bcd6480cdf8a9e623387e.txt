commit 44adf91789266435f44bcd6480cdf8a9e623387e
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jun 17 20:04:42 2015 -0700

    Save EventMapping before Event

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index ed83bf2067..b896333f45 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -349,6 +349,14 @@ class EventManager(object):
         safe_execute(Group.objects.add_tags, group, tags,
                      _with_transaction=False)
 
+        try:
+            with transaction.atomic():
+                EventMapping.objects.create(
+                    project=project, group=group, event_id=event_id)
+        except IntegrityError:
+            self.logger.info('Duplicate EventMapping found for event_id=%s', event_id)
+            return event
+
         # save the event unless its been sampled
         if not is_sample:
             try:
@@ -358,14 +366,6 @@ class EventManager(object):
                 self.logger.info('Duplicate Event found for event_id=%s', event_id)
                 return event
 
-        try:
-            with transaction.atomic():
-                EventMapping.objects.create(
-                    project=project, group=group, event_id=event_id)
-        except IntegrityError:
-            self.logger.info('Duplicate EventMapping found for event_id=%s', event_id)
-            return event
-
         if not raw:
             post_process_group.delay(
                 group=group,
