commit 26ed549243c6bc5eba53ebeb174e6e5bc8241fd9
Author: Mark Story <mark@mark-story.com>
Date:   Fri Apr 5 16:28:08 2019 -0400

    feat(tests) Add acceptance tests for creating teams and members (#12662)
    
    * Add test for creating a team.
    * Add acceptance test for creating organization members.

diff --git a/src/sentry/api/endpoints/organization_member_index.py b/src/sentry/api/endpoints/organization_member_index.py
index e0fa34c910..536a5820f3 100644
--- a/src/sentry/api/endpoints/organization_member_index.py
+++ b/src/sentry/api/endpoints/organization_member_index.py
@@ -159,7 +159,6 @@ class OrganizationMemberIndexEndpoint(OrganizationEndpoint):
             om.send_invite_email()
             member_invited.send_robust(member=om, user=request.user, sender=self,
                                        referrer=request.DATA.get('referrer'))
-
         self.create_audit_entry(
             request=request,
             organization_id=organization.id,
diff --git a/src/sentry/static/sentry/app/components/dropdownAutoCompleteMenu.jsx b/src/sentry/static/sentry/app/components/dropdownAutoCompleteMenu.jsx
index a40c2776b1..2b2f218439 100644
--- a/src/sentry/static/sentry/app/components/dropdownAutoCompleteMenu.jsx
+++ b/src/sentry/static/sentry/app/components/dropdownAutoCompleteMenu.jsx
@@ -405,7 +405,10 @@ class DropdownAutoCompleteMenu extends React.Component {
                   <div>
                     {menuHeader && <LabelWithPadding>{menuHeader}</LabelWithPadding>}
 
-                    <StyledItemList maxHeight={maxHeight}>
+                    <StyledItemList
+                      data-test-id="autocomplete-list"
+                      maxHeight={maxHeight}
+                    >
                       {showNoItems && <EmptyMessage>{emptyMessage}</EmptyMessage>}
                       {showNoResultsMessage && (
                         <EmptyMessage>
diff --git a/src/sentry/static/sentry/app/views/settings/components/teamSelect.jsx b/src/sentry/static/sentry/app/views/settings/components/teamSelect.jsx
index f11b6b21e4..43f8dd7ec7 100644
--- a/src/sentry/static/sentry/app/views/settings/components/teamSelect.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/teamSelect.jsx
@@ -97,7 +97,12 @@ class TeamSelect extends React.Component {
         disabled={isDisabled}
       >
         {({isOpen}) => (
-          <DropdownButton isOpen={isOpen} size="xsmall" disabled={isDisabled}>
+          <DropdownButton
+            aria-label={t('Add Team')}
+            isOpen={isOpen}
+            size="xsmall"
+            disabled={isDisabled}
+          >
             {t('Add Team')}
           </DropdownButton>
         )}
diff --git a/tests/acceptance/test_create_organization_member.py b/tests/acceptance/test_create_organization_member.py
index b14177ee4a..6daec9bbd1 100644
--- a/tests/acceptance/test_create_organization_member.py
+++ b/tests/acceptance/test_create_organization_member.py
@@ -26,15 +26,22 @@ class CreateOrganizationMemberTest(AcceptanceTestCase):
         )
         self.login_as(self.user)
 
-    def test_invite(self):
-        """
-        Add by email
-        """
-        self.browser.get(
-            u'/organizations/{}/members/new/'.format(self.org.slug))
+    def test_invite_new_member(self):
+        self.browser.get('/organizations/{}/members/new/'.format(self.org.slug))
         self.browser.wait_until_not('.loading')
 
-        self.browser.element(
-            'input#id-email').send_keys('test@gmail.com, invalidemail')
+        email = 'test@example.com'
+        self.browser.element('input#id-email').send_keys(email)
+
+        # Open team select dropdown, and click the first team
+        self.browser.click('[aria-label="Add Team"]')
+        self.browser.click('[data-test-id="autocomplete-list"] div')
 
         self.browser.snapshot(name='invite organization member')
+
+        # Submit the form
+        self.browser.click('[aria-label="Add Member"]')
+
+        # Verify new member on member list.
+        self.browser.wait_until_test_id('org-member-list')
+        assert self.browser.find_element_by_link_text(email)
diff --git a/tests/acceptance/test_create_team.py b/tests/acceptance/test_create_team.py
new file mode 100644
index 0000000000..ae0f5e799a
--- /dev/null
+++ b/tests/acceptance/test_create_team.py
@@ -0,0 +1,46 @@
+from __future__ import absolute_import
+
+from sentry.models import Team
+from sentry.testutils import AcceptanceTestCase
+
+
+class CreateTeamTest(AcceptanceTestCase):
+    def setUp(self):
+        super(CreateTeamTest, self).setUp()
+        self.user = self.create_user('foo@example.com')
+        self.org = self.create_organization(
+            name='Rowdy Tiger',
+            owner=None,
+        )
+        self.team = self.create_team(organization=self.org, name='Mariachi Band')
+        self.project = self.create_project(
+            organization=self.org,
+            teams=[self.team],
+            name='Bengal',
+        )
+        self.create_member(
+            user=self.user,
+            organization=self.org,
+            role='owner',
+            teams=[self.team],
+        )
+        self.login_as(self.user)
+        self.path = u'/settings/{}/teams/'.format(self.org.slug)
+
+    def test_create(self):
+        self.browser.get(self.path)
+        self.browser.wait_until('.team-list')
+
+        # Open the modal
+        self.browser.click('button[aria-label="Create Team"]')
+        self.browser.wait_until('.modal-header')
+        self.browser.element('input[id="slug"]').send_keys('new-team')
+        self.browser.click('.modal-dialog button[aria-label="Create Team"]')
+
+        # Wait for modal to go away.
+        self.browser.save_screenshot('create-team.png')
+        self.browser.wait_until_not('.modal-header')
+
+        # New team should be in dom
+        assert self.browser.find_element_by_xpath("//span[contains(text(), 'new-team')]")
+        assert Team.objects.filter(slug='new-team', organization=self.org).exists()
diff --git a/tests/js/spec/components/__snapshots__/dropdownAutoCompleteMenu.spec.jsx.snap b/tests/js/spec/components/__snapshots__/dropdownAutoCompleteMenu.spec.jsx.snap
index f25ca711be..518320b69d 100644
--- a/tests/js/spec/components/__snapshots__/dropdownAutoCompleteMenu.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/dropdownAutoCompleteMenu.spec.jsx.snap
@@ -114,10 +114,12 @@ exports[`DropdownAutoCompleteMenu renders with a group 1`] = `
                 </StyledInputWrapper>
                 <div>
                   <StyledItemList
+                    data-test-id="autocomplete-list"
                     maxHeight={300}
                   >
                     <div
                       className="css-5kh8cy-StyledItemList ejumqxq9"
+                      data-test-id="autocomplete-list"
                     >
                       <LabelWithBorder
                         key="countries"
@@ -291,10 +293,12 @@ exports[`DropdownAutoCompleteMenu renders without a group 1`] = `
                 </StyledInputWrapper>
                 <div>
                   <StyledItemList
+                    data-test-id="autocomplete-list"
                     maxHeight={300}
                   >
                     <div
                       className="css-5kh8cy-StyledItemList ejumqxq9"
+                      data-test-id="autocomplete-list"
                     >
                       <AutoCompleteItem
                         highlightedIndex={0}
diff --git a/tests/js/spec/views/inviteMember/__snapshots__/inviteMember.spec.jsx.snap b/tests/js/spec/views/inviteMember/__snapshots__/inviteMember.spec.jsx.snap
index a9beec0144..743325a219 100644
--- a/tests/js/spec/views/inviteMember/__snapshots__/inviteMember.spec.jsx.snap
+++ b/tests/js/spec/views/inviteMember/__snapshots__/inviteMember.spec.jsx.snap
@@ -497,28 +497,33 @@ exports[`InviteMember should render roles when available and allowed, and handle
                                             tabIndex={-1}
                                           >
                                             <DropdownButton
+                                              aria-label="Add Team"
                                               disabled={true}
                                               isOpen={false}
                                               size="xsmall"
                                             >
                                               <StyledButton
+                                                aria-label="Add Team"
                                                 disabled={true}
                                                 isOpen={false}
                                                 size="xsmall"
                                               >
                                                 <Component
+                                                  aria-label="Add Team"
                                                   className="css-w99oc4-StyledButton e1yghndz1"
                                                   disabled={true}
                                                   isOpen={false}
                                                   size="xsmall"
                                                 >
                                                   <Button
+                                                    aria-label="Add Team"
                                                     className="css-w99oc4-StyledButton e1yghndz1"
                                                     disabled={true}
                                                     size="xsmall"
                                                   >
                                                     <StyledButton
                                                       aria-disabled={true}
+                                                      aria-label="Add Team"
                                                       className="css-w99oc4-StyledButton e1yghndz1"
                                                       disabled={true}
                                                       href={null}
@@ -529,6 +534,7 @@ exports[`InviteMember should render roles when available and allowed, and handle
                                                     >
                                                       <Component
                                                         aria-disabled={true}
+                                                        aria-label="Add Team"
                                                         className="e1yghndz1 css-10lmrhm-StyledButton-getColors-StyledButton eqrebog0"
                                                         href={null}
                                                         onClick={[Function]}
@@ -538,6 +544,7 @@ exports[`InviteMember should render roles when available and allowed, and handle
                                                       >
                                                         <button
                                                           aria-disabled={true}
+                                                          aria-label="Add Team"
                                                           className="e1yghndz1 css-10lmrhm-StyledButton-getColors-StyledButton eqrebog0"
                                                           href={null}
                                                           onClick={[Function]}
