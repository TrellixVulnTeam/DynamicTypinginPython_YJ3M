commit 5162f0a87e46c448e445bf7f1e46351706330d0d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 7 18:39:22 2015 -0800

    Improve error handling for system options

diff --git a/src/sentry/api/endpoints/system_options.py b/src/sentry/api/endpoints/system_options.py
index 82b01e2cd8..85d12626e9 100644
--- a/src/sentry/api/endpoints/system_options.py
+++ b/src/sentry/api/endpoints/system_options.py
@@ -33,10 +33,17 @@ class SystemOptionsEndpoint(Endpoint):
         return Response(results)
 
     def put(self, request):
-        try:
-            for k, v in request.DATA.iteritems():
+        # TODO(dcramer): this should validate options before saving them
+        for k, v in request.DATA.iteritems():
+            try:
                 options.set(k, v)
-        except Exception as e:
-            return Response(unicode(e), status=400)
+            except options.UnknownOption:
+                # TODO(dcramer): unify API errors
+                return Response({
+                    'error': 'unknown_option',
+                    'errorDetail': {
+                        'option': k,
+                    },
+                }, status=400)
         options.set('sentry:version-configured', sentry.get_version())
         return Response(status=200)
diff --git a/src/sentry/options/__init__.py b/src/sentry/options/__init__.py
index 60148aa846..9716154912 100644
--- a/src/sentry/options/__init__.py
+++ b/src/sentry/options/__init__.py
@@ -11,11 +11,11 @@ from .store import OptionsStore
 from .manager import OptionsManager
 from .manager import (  # NOQA
     DEFAULT_FLAGS, FLAG_IMMUTABLE, FLAG_NOSTORE, FLAG_STOREONLY,
-    FLAG_REQUIRED, FLAG_PRIORITIZE_DISK,
+    FLAG_REQUIRED, FLAG_PRIORITIZE_DISK, UnknownOption
 )
 
 __all__ = (
-    'get', 'set', 'delete', 'register',
+    'get', 'set', 'delete', 'register', 'UnknownOption',
 )
 
 default_store = OptionsStore()
diff --git a/src/sentry/static/sentry/app/views/adminSettings.jsx b/src/sentry/static/sentry/app/views/adminSettings.jsx
index e70e3dd90f..74d0beca1c 100644
--- a/src/sentry/static/sentry/app/views/adminSettings.jsx
+++ b/src/sentry/static/sentry/app/views/adminSettings.jsx
@@ -157,7 +157,7 @@ const AdminSettings = React.createClass({
         :
           <div>
             {submitError &&
-              <p>{t('We were unable to submit your changes to the Sentry server. Please take a look at the service logs.')}</p>
+              <div className="alert alert-block alert-error">{t('We were unable to submit your changes to the Sentry server. Please take a look at the service logs.')}</div>
             }
             <SettingsList
                 options={options}
diff --git a/src/sentry/static/sentry/app/views/installWizard.jsx b/src/sentry/static/sentry/app/views/installWizard.jsx
index 663bcb0aaa..f5a6083ddb 100644
--- a/src/sentry/static/sentry/app/views/installWizard.jsx
+++ b/src/sentry/static/sentry/app/views/installWizard.jsx
@@ -93,6 +93,7 @@ const InstallWizard = React.createClass({
       error: false,
       options: {},
       submitError: false,
+      submitErrorType: null,
       submitInProgress: false,
     };
   },
@@ -150,10 +151,27 @@ const InstallWizard = React.createClass({
         });
         this.props.onConfigured();
       },
-      error: () => {
+      error: (xhr, textStatus, errorThrown) => {
+        let err = {};
+        try {
+          err = xhr.responseJSON;
+        } catch(ex) {
+          // ...
+        }
+        let errorMessage = '';
+        switch (err.error) {
+          case 'unknown_option':
+            errorMessage = t('An invalid option (%s) was passed to the server. Please report this issue to the Sentry team.',
+                             err.errorDetail.option);
+            break;
+          default:
+            errorMessage = t('An unknown error occurred. Please take a look at the service logs.');
+        }
         this.setState({
           submitInProgress: false,
           submitError: true,
+          submitErrorMessage: errorMessage,
+          submitErrorType: err.error,
         });
       },
       complete: () => {
@@ -163,7 +181,7 @@ const InstallWizard = React.createClass({
   },
 
   render() {
-    let {error, loading, options, submitError, submitInProgress} = this.state;
+    let {error, loading, options, submitError, submitErrorMessage, submitInProgress} = this.state;
     let version = ConfigStore.get('version');
     return (
       <DocumentTitle title="Sentry Setup">
@@ -186,7 +204,9 @@ const InstallWizard = React.createClass({
             :
               <div>
                 {submitError &&
-                  <p>{t('We were unable to submit your changes to the Sentry server. Please take a look at the service logs.')}</p>
+                  <div className="alert alert-block alert-error">
+                    {submitErrorMessage}
+                  </div>
                 }
                 <InstallWizardSettings
                     options={options}
