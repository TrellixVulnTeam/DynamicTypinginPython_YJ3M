commit 39cb099ae71fa5483c79118fa9dac25291658b83
Author: David Cramer <cramer@dropbox.com>
Date:   Mon Dec 30 16:02:52 2013 -0800

    Improve data normalization code

diff --git a/src/sentry/constants.py b/src/sentry/constants.py
index 0f844012bc..66fbdb3bd9 100644
--- a/src/sentry/constants.py
+++ b/src/sentry/constants.py
@@ -171,7 +171,7 @@ MINUTE_NORMALIZATION = 15
 
 MAX_TAG_KEY_LENGTH = 32
 MAX_TAG_VALUE_LENGTH = 200
-MAX_CULPRIT_LENGTH = 2004
+MAX_CULPRIT_LENGTH = 200
 
 # Team slugs which may not be used. Generally these are top level URL patterns
 # which we don't want to worry about conflicts on.
diff --git a/src/sentry/manager.py b/src/sentry/manager.py
index ef244a4025..d3d3b7e45c 100644
--- a/src/sentry/manager.py
+++ b/src/sentry/manager.py
@@ -258,8 +258,6 @@ class GroupManager(BaseManager, ChartMixin):
             tags = list(tags)
 
         data['tags'] = tags
-        data['message'] = strip(data['message'])
-        data['culprit'] = strip(data['culprit'])
 
         if not isinstance(data['extra'], dict):
             # throw it away
@@ -319,9 +317,13 @@ class GroupManager(BaseManager, ChartMixin):
 
             # default the culprit to the url
             if not data['culprit']:
-                data['culprit'] = trim(strip(http_data.get('url')), MAX_CULPRIT_LENGTH)
+                data['culprit'] = strip(http_data.get('url'))
 
-        data['culprit'] = trim(data['culprit'], MAX_CULPRIT_LENGTH)
+        if data['culprit']:
+            data['culprit'] = trim(strip(data['culprit']), MAX_CULPRIT_LENGTH)
+
+        if data['message']:
+            data['message'] = strip(data['message'])
 
         return data
 
