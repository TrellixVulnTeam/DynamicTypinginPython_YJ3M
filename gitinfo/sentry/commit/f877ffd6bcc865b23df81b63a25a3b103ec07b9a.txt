commit f877ffd6bcc865b23df81b63a25a3b103ec07b9a
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 1 19:02:21 2019 -0700

    fix(wizard): Correct default behavior for field values

diff --git a/src/sentry/static/sentry/app/views/installWizard.jsx b/src/sentry/static/sentry/app/views/installWizard.jsx
index eca8318238..beb6c0c658 100644
--- a/src/sentry/static/sentry/app/views/installWizard.jsx
+++ b/src/sentry/static/sentry/app/views/installWizard.jsx
@@ -61,7 +61,13 @@ export default class InstallWizard extends AsyncView {
     const data = {};
     Object.keys(options).forEach(optionName => {
       const option = options[optionName];
-      if (!option.field.isSet) {
+      // XXX(dcramer): we need the user to explicitly choose beacon.anonymous
+      // vs using an implied default so effectively this is binding
+      // all values to their server-defaults (as client-side defaults dont really work)
+      if (
+        option.value !== undefined &&
+        (option.field.isSet || optionName != 'beacon.anonymous')
+      ) {
         data[optionName] = option.value;
       }
     });
diff --git a/tests/js/spec/views/installWizard.spec.jsx b/tests/js/spec/views/installWizard.spec.jsx
index c5d2198549..07e3ed38d6 100644
--- a/tests/js/spec/views/installWizard.spec.jsx
+++ b/tests/js/spec/views/installWizard.spec.jsx
@@ -31,7 +31,7 @@ describe('InstallWizard', function() {
     expect(wrapper).toMatchSnapshot();
   });
 
-  it('has "Send my contact information..." when beacon.anonymous is false', function() {
+  it('has no option selected when beacon.anonymous is unset', function() {
     MockApiClient.addMockResponse({
       url: '/internal/options/?query=is:required',
       body: TestStubs.InstallWizard({
@@ -50,6 +50,34 @@ describe('InstallWizard', function() {
     });
     const wrapper = mount(<InstallWizard onConfigured={jest.fn()} />);
 
+    expect(
+      wrapper.find('input[name="beacon.anonymous"][value="false"]').prop('checked')
+    ).toBe(false);
+
+    expect(
+      wrapper.find('input[name="beacon.anonymous"][value="true"]').prop('checked')
+    ).toBe(false);
+  });
+
+  it('has "Send my contact information..." when beacon.anonymous is false', function() {
+    MockApiClient.addMockResponse({
+      url: '/internal/options/?query=is:required',
+      body: TestStubs.InstallWizard({
+        'beacon.anonymous': {
+          field: {
+            disabledReason: null,
+            default: false,
+            required: true,
+            disabled: false,
+            allowEmpty: true,
+            isSet: true,
+          },
+          value: false,
+        },
+      }),
+    });
+    const wrapper = mount(<InstallWizard onConfigured={jest.fn()} />);
+
     expect(
       wrapper.find('input[name="beacon.anonymous"][value="false"]').prop('checked')
     ).toBe(true);
@@ -70,7 +98,7 @@ describe('InstallWizard', function() {
             required: true,
             disabled: false,
             allowEmpty: true,
-            isSet: false,
+            isSet: true,
           },
           value: true,
         },
