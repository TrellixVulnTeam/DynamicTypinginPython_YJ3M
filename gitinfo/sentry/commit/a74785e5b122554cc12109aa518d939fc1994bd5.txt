commit a74785e5b122554cc12109aa518d939fc1994bd5
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Aug 10 00:32:18 2012 -0700

    Add merge_account util

diff --git a/sentry/utils/models.py b/sentry/utils/models.py
index d8d6feee31..4fb3fef46e 100644
--- a/sentry/utils/models.py
+++ b/sentry/utils/models.py
@@ -19,6 +19,25 @@ from sentry.utils.db import resolve_expression_node
 logger = logging.getLogger(__name__)
 
 
+def merge_account(from_user, to_user):
+    # TODO: we could discover relations automatically and make this useful
+    from sentry.models import GroupBookmark, Project, ProjectKey, Team, TeamMember, \
+      UserOption
+
+    for obj in ProjectKey.objects.filter(user=from_user):
+        obj.update(user=to_user)
+    for obj in TeamMember.objects.filter(user=from_user):
+        obj.update(user=to_user)
+    for obj in Project.objects.filter(owner=from_user):
+        obj.update(owner=to_user)
+    for obj in Team.objects.filter(owner=from_user):
+        obj.update(owner=to_user)
+    for obj in GroupBookmark.objects.filter(user=from_user):
+        obj.update(user=to_user)
+    for obj in UserOption.objects.filter(user=from_user):
+        obj.update(user=to_user)
+
+
 def update(self, using=None, **kwargs):
     """
     Updates specified attributes on the current instance.
