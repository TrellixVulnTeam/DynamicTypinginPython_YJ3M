commit e8f357b460512039cdccc69a176c74863c2985f6
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Dec 11 17:26:16 2014 -0800

    Add organization stats to tsdb

diff --git a/src/sentry/tsdb/base.py b/src/sentry/tsdb/base.py
index 41f7c24d23..f096c7ac3a 100644
--- a/src/sentry/tsdb/base.py
+++ b/src/sentry/tsdb/base.py
@@ -36,6 +36,11 @@ class TSDBModel(Enum):
     # the number of events rejected due to rate limiting
     project_total_rejected = 101
 
+    # the number of events sent to the server
+    organization_total_received = 200
+    # the number of events rejected due to rate limiting
+    organization_total_rejected = 201
+
 
 class BaseTSDB(object):
     models = TSDBModel
diff --git a/src/sentry/tsdb/dummy.py b/src/sentry/tsdb/dummy.py
index b8f3325101..332ed0cf85 100644
--- a/src/sentry/tsdb/dummy.py
+++ b/src/sentry/tsdb/dummy.py
@@ -15,7 +15,7 @@ class DummyTSDB(BaseTSDB):
     A no-op time-series storage.
     """
     def incr(self, model, key, timestamp=None, count=1):
-        pass
+        assert isinstance(key, (int, long)), 'Key is not an int'
 
     def get_range(self, model, keys, start, end, rollup=None):
         return dict((k, []) for k in keys)
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index 052b9f9791..9c33e9a110 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -321,10 +321,15 @@ class StoreView(APIView):
             app.tsdb.incr_multi([
                 (app.tsdb.models.project_total_received, project.id),
                 (app.tsdb.models.project_total_rejected, project.id),
+                (app.tsdb.models.organization_total_received, project.organization_id),
+                (app.tsdb.models.organization_total_rejected, project.organization_id),
             ])
             raise APIRateLimited(rate_limit.retry_after)
         else:
-            app.tsdb.incr(app.tsdb.models.project_total_received, project.id)
+            app.tsdb.incr_multi([
+                (app.tsdb.models.project_total_received, project.id),
+                (app.tsdb.models.organization_total_received, project.organization_id),
+            ])
 
         result = plugins.first('has_perm', request.user, 'create_event', project)
         if result is False:
