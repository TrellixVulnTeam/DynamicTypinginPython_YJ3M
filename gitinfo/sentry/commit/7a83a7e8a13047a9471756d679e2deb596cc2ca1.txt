commit 7a83a7e8a13047a9471756d679e2deb596cc2ca1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 26 18:23:39 2015 -0800

    Ensure we pass correct value for is_regression
    
    - Revert changes to is_new and is_sample to conform behavior

diff --git a/src/sentry/rules/processor.py b/src/sentry/rules/processor.py
index b32d344757..c14639f0ee 100644
--- a/src/sentry/rules/processor.py
+++ b/src/sentry/rules/processor.py
@@ -16,16 +16,15 @@ RuleFuture = namedtuple('RuleFuture', ['rule', 'kwargs'])
 class RuleProcessor(object):
     logger = logging.getLogger('sentry.rules')
 
-    def __init__(self, event):
+    def __init__(self, event, is_new, is_regression, is_sample):
         self.event = event
         self.group = event.group
         self.project = event.project
 
-        # these should be more or less correct, though
-        # we may want to make them explicit in the future
-        self.is_sample = event.id is None
-        self.is_new = event.group.times_seen == 1
-        self.is_regression = event.group.times_seen != 1
+        self.is_new = is_new
+        self.is_regression = is_regression
+        # TODO(dcramer): lets remove is_sample
+        self.is_sample = is_sample
 
         self.futures_by_cb = defaultdict(list)
 
diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index f2c9f4f77f..ee317315e8 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -50,7 +50,7 @@ def post_process_group(event, is_new, is_regression, is_sample, **kwargs):
             expires=300,
         )
 
-    rp = RuleProcessor(event)
+    rp = RuleProcessor(event, is_new, is_regression, is_sample)
     # TODO(dcramer): ideally this would fanout, but serializing giant
     # objects back and forth isn't super efficient
     for callback, futures in rp.apply():
diff --git a/tests/sentry/rules/test_processor.py b/tests/sentry/rules/test_processor.py
index db1ac84fbf..294303b234 100644
--- a/tests/sentry/rules/test_processor.py
+++ b/tests/sentry/rules/test_processor.py
@@ -29,7 +29,7 @@ class RuleProcessorTest(TestCase):
             }
         )
 
-        rp = RuleProcessor(event)
+        rp = RuleProcessor(event, is_new=True, is_regression=True, is_sample=False)
         results = list(rp.apply())
         assert len(results) == 1
         callback, futures = results[0]
diff --git a/tests/sentry/tasks/post_process/tests.py b/tests/sentry/tasks/post_process/tests.py
index f553b0f320..613baf7ca1 100644
--- a/tests/sentry/tasks/post_process/tests.py
+++ b/tests/sentry/tasks/post_process/tests.py
@@ -90,7 +90,7 @@ class PostProcessGroupTest(TestCase):
             is_sample=False,
         )
 
-        mock_processor.assert_called_once_with(event)
+        mock_processor.assert_called_once_with(event, True, False, False)
         mock_processor.return_value.apply.assert_called_once_with()
 
         mock_callback.assert_called_once_with(event, mock_futures)
