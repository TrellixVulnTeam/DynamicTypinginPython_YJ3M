commit e37fd984d8c5b78e5c955f67e808de8aff89d643
Author: David Cramer <dcramer@gmail.com>
Date:   Tue May 17 17:14:13 2011 -0700

    Safely handle failures on repr(value)

diff --git a/sentry/utils/__init__.py b/sentry/utils/__init__.py
index 8dc1350932..f73ceb019b 100644
--- a/sentry/utils/__init__.py
+++ b/sentry/utils/__init__.py
@@ -114,7 +114,12 @@ def transform(value, stack=[], context=None):
         value = getattr(value, '%s__func' % pre)(*getattr(value, '%s__args' % pre), **getattr(value, '%s__kw' % pre))
         return transform(value)
     elif not isinstance(value, (int, bool)) and value is not None:
-        ret = transform(repr(value))
+        try:
+            ret = transform(repr(value))
+        except:
+            # It's common case that a model's __unicode__ definition may try to query the database
+            # which if it was not cleaned up correctly, would hit a transaction aborted exception
+            ret = u'<BadRepr: %s>' % type(value)
     else:
         ret = value
     del context[objid]
