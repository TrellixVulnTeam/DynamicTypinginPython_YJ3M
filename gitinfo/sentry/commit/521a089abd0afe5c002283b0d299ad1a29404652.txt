commit 521a089abd0afe5c002283b0d299ad1a29404652
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu May 10 10:40:56 2018 -0700

    feat(environments): Add environment to alert email (#8367)

diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index 1fd96e7314..8b35df1300 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -34,6 +34,8 @@ from sentry.utils.linksign import generate_signed_link
 
 from .activity import emails
 
+from six.moves.urllib.parse import urlencode
+
 NOTSET = object()
 
 logger = logging.getLogger(__name__)
@@ -195,6 +197,8 @@ class MailPlugin(NotificationPlugin):
 
         event = notification.event
 
+        environment = event.get_tag('environment')
+
         group = event.group
         project = group.project
         org = group.organization
@@ -203,6 +207,9 @@ class MailPlugin(NotificationPlugin):
 
         link = group.get_absolute_url()
 
+        if environment:
+            link = link + '?' + urlencode({'environment': environment})
+
         template = 'sentry/emails/error.txt'
         html_template = 'sentry/emails/error.html'
 
@@ -241,6 +248,7 @@ class MailPlugin(NotificationPlugin):
             'rules': rules,
             'enhanced_privacy': enhanced_privacy,
             'commits': sorted(commits.values(), key=lambda x: x['score'], reverse=True),
+            'environment': environment
         }
 
         # if the organization has enabled enhanced privacy controls we dont send
diff --git a/src/sentry/templates/sentry/emails/error.html b/src/sentry/templates/sentry/emails/error.html
index a96427b203..46dd347e98 100644
--- a/src/sentry/templates/sentry/emails/error.html
+++ b/src/sentry/templates/sentry/emails/error.html
@@ -16,6 +16,7 @@
 {% block main %}
     <h2 style="margin-bottom: 15px">
         New alert from <a href="{% absolute_uri '/{}/{}/' group.project.organization.slug group.project.slug %}">{{ project_label }}</a>
+        {% if environment %} in {{ environment }}{% endif %}
     </h2>
 
     {% if enhanced_privacy %}
