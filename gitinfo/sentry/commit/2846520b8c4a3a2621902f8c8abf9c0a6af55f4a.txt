commit 2846520b8c4a3a2621902f8c8abf9c0a6af55f4a
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Apr 29 17:55:14 2014 -0300

    Calculate end after rollup

diff --git a/src/sentry/tsdb/redis.py b/src/sentry/tsdb/redis.py
index 1c372ec5f2..53f03d076e 100644
--- a/src/sentry/tsdb/redis.py
+++ b/src/sentry/tsdb/redis.py
@@ -117,11 +117,11 @@ class RedisTSDB(BaseTSDB):
         normalize_to_rollup = self.normalize_to_rollup
         make_key = self.make_key
 
-        end = end + timedelta(seconds=1)
-
         if rollup is None:
             rollup = self.get_optimal_rollup(start, end)
 
+        end = end + timedelta(seconds=1)
+
         results = []
         with self.conn.map() as conn:
             timestamp = start
