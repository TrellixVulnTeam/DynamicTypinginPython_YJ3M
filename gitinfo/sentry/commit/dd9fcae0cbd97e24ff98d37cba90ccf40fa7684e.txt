commit dd9fcae0cbd97e24ff98d37cba90ccf40fa7684e
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Mon May 14 11:17:33 2018 -0700

    feat(integrations): Add way to discern what features an integration has

diff --git a/src/sentry/api/endpoints/group_integration_details.py b/src/sentry/api/endpoints/group_integration_details.py
index f52a2baa7e..5714fa7518 100644
--- a/src/sentry/api/endpoints/group_integration_details.py
+++ b/src/sentry/api/endpoints/group_integration_details.py
@@ -7,6 +7,7 @@ from rest_framework.response import Response
 from sentry.api.bases import GroupEndpoint
 from sentry.api.serializers import serialize
 from sentry.api.serializers.models.integration import IntegrationIssueSerializer
+from sentry.integrations.base import IntegrationFeatures
 from sentry.models import ExternalIssue, GroupLink, OrganizationIntegration
 
 
@@ -30,6 +31,10 @@ class GroupIntegrationDetails(GroupEndpoint):
         except OrganizationIntegration.DoesNotExist:
             return Response(status=404)
 
+        if not integration.has_feature(IntegrationFeatures.ISSUE_SYNC):
+            return Response(
+                {'detail': 'This feature is not supported for this integration.'}, status=400)
+
         # TODO(jess): add create issue config to serializer
         return Response(
             serialize(integration, request.user, IntegrationIssueSerializer(group, action))
@@ -52,6 +57,10 @@ class GroupIntegrationDetails(GroupEndpoint):
         except OrganizationIntegration.DoesNotExist:
             return Response(status=404)
 
+        if not integration.has_feature(IntegrationFeatures.ISSUE_SYNC):
+            return Response(
+                {'detail': 'This feature is not supported for this integration.'}, status=400)
+
         # TODO(jess): some validation from provider to ensure this
         # issue id is valid and also maybe to fetch the title/description
         # should go here
diff --git a/src/sentry/integrations/base.py b/src/sentry/integrations/base.py
index af74689a76..6e8b3b37f4 100644
--- a/src/sentry/integrations/base.py
+++ b/src/sentry/integrations/base.py
@@ -1,9 +1,10 @@
 from __future__ import absolute_import
 
-__all__ = ['Integration', 'IntegrationProvider', 'IntegrationMetadata']
+__all__ = ['Integration', 'IntegrationFeatures', 'IntegrationProvider', 'IntegrationMetadata']
 
 import logging
 from collections import namedtuple
+from enum import Enum
 
 from sentry.pipeline import PipelineProvider
 
@@ -18,6 +19,12 @@ IntegrationMetadata = namedtuple('IntegrationMetadata', [
 ])
 
 
+class IntegrationFeatures(Enum):
+    NOTIFICATION = 'notification'
+    ISSUE_SYNC = 'issue_sync'
+    COMMITS = 'commits'
+
+
 class IntegrationProvider(PipelineProvider):
     """
     An integration provider describes a third party that can be registered within Sentry.
@@ -54,6 +61,9 @@ class IntegrationProvider(PipelineProvider):
     # whether or not the integration installation be initiated from Sentry
     can_add = True
 
+    # can be any number of IntegrationFeatures
+    features = frozenset()
+
     @classmethod
     def get_installation(cls, model, **kwargs):
         if cls.integration_cls is None:
diff --git a/src/sentry/integrations/example/integration.py b/src/sentry/integrations/example/integration.py
index b2e404bfd3..16ef17489a 100644
--- a/src/sentry/integrations/example/integration.py
+++ b/src/sentry/integrations/example/integration.py
@@ -1,7 +1,9 @@
 from __future__ import absolute_import
 
 from django.http import HttpResponse
-from sentry.integrations import Integration, IntegrationProvider, IntegrationMetadata
+from sentry.integrations import (
+    Integration, IntegrationFeatures, IntegrationMetadata, IntegrationProvider
+)
 from sentry.pipeline import PipelineView
 
 
@@ -63,6 +65,8 @@ class ExampleIntegrationProvider(IntegrationProvider):
 
     integration_cls = ExampleIntegration
 
+    features = frozenset([IntegrationFeatures.ISSUE_SYNC])
+
     def get_pipeline_views(self):
         return [
             ExampleSetupView(),
diff --git a/src/sentry/models/integration.py b/src/sentry/models/integration.py
index 9e16409cd5..bc8bd415ee 100644
--- a/src/sentry/models/integration.py
+++ b/src/sentry/models/integration.py
@@ -66,6 +66,9 @@ class Integration(Model):
     def get_installation(self):
         return self.get_provider().get_installation(self)
 
+    def has_feature(self, feature):
+        return feature in self.get_provider().features
+
     def add_organization(self, organization_id, default_auth_id=None, config=None):
         """
         Add an organization to this integration.
