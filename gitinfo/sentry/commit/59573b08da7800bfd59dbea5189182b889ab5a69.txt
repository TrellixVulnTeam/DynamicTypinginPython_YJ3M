commit 59573b08da7800bfd59dbea5189182b889ab5a69
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 10 19:59:57 2012 -0800

    Update remaining uses of non_field_errors to use crispy form helpers

diff --git a/src/sentry/templates/sentry/account/appearance.html b/src/sentry/templates/sentry/account/appearance.html
index a693a5dd04..188cb984a3 100644
--- a/src/sentry/templates/sentry/account/appearance.html
+++ b/src/sentry/templates/sentry/account/appearance.html
@@ -1,5 +1,6 @@
 {% extends "sentry/account/base.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 {% load sentry_helpers %}
 
@@ -18,16 +19,8 @@
 {% block inner %}
     <form action="" method="post">
         {% csrf_token %}
-        {% if form.non_field_errors %}
-            <div class="alert alert-block alert-error">
-                <p>{% trans "There were errors saving your changes:" %}</p>
-                <ul>
-                    {% for error in form.non_field_errors %}
-                        <li>{{ error }}</li>
-                    {% endfor %}
-                </ul>
-            </div>
-        {% endif %}
+
+        {{ form|as_crispy_errors }}
 
         <fieldset>
             <div><legend>{% trans "Events" %}</legend></div>
diff --git a/src/sentry/templates/sentry/account/notifications.html b/src/sentry/templates/sentry/account/notifications.html
index c5099c23f1..786f818981 100644
--- a/src/sentry/templates/sentry/account/notifications.html
+++ b/src/sentry/templates/sentry/account/notifications.html
@@ -19,17 +19,9 @@
 {% block inner %}
     <form action="" method="post">
         {% csrf_token %}
-        {% for form, helper in forms %}
-            {% if form.non_field_errors %}
-                <div class="alert alert-block alert-error">
-                    <p>{% trans "There were errors saving your changes:" %}</p>
-                    <ul>
-                        {% for error in form.non_field_errors %}
-                            <li>{{ error }}</li>
-                        {% endfor %}
-                    </ul>
-                </div>
-            {% endif %}
+        {% for form in forms %}
+            {{ form|as_crispy_errors }}
+
             <fieldset>
                 <div><legend>{{ form.get_title }}</legend></div>
                 {% with form.get_description as description %}
@@ -37,7 +29,9 @@
                         {{ description|linebreaks }}
                     {% endif %}
                 {% endwith %}
-                {% crispy form helper %}
+                {% for field in form %}
+                    {{ field|as_crispy_field }}
+                {% endfor %}
             </fieldset>
         {% endfor %}
         <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/account/settings.html b/src/sentry/templates/sentry/account/settings.html
index 55ca53a98b..861ed80688 100644
--- a/src/sentry/templates/sentry/account/settings.html
+++ b/src/sentry/templates/sentry/account/settings.html
@@ -1,5 +1,6 @@
 {% extends "sentry/account/base.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 {% load sentry_helpers %}
 
@@ -18,16 +19,7 @@
 {% block inner %}
     <form action="" method="post">
         {% csrf_token %}
-        {% if form.non_field_errors %}
-            <div class="alert alert-block alert-error">
-                <p>{% trans "There were errors saving your changes:" %}</p>
-                <ul>
-                    {% for error in form.non_field_errors %}
-                        <li>{{ error }}</li>
-                    {% endfor %}
-                </ul>
-            </div>
-        {% endif %}
+        {{ form|as_crispy_errors }}
         <p>{% trans "To make changes to your account, you must first enter your current password." %}</p>
         {% with form.old_password as field %}
             {% include "sentry/partial/_form_field.html" %}
diff --git a/src/sentry/templates/sentry/admin/status/mail.html b/src/sentry/templates/sentry/admin/status/mail.html
index 39c2af2d44..fa4a8494e1 100644
--- a/src/sentry/templates/sentry/admin/status/mail.html
+++ b/src/sentry/templates/sentry/admin/status/mail.html
@@ -2,6 +2,7 @@
 
 {% block admin-nav-queue %} class="active"{% endblock %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 {% load sentry_helpers %}
 
@@ -47,16 +48,7 @@
 
         <p>{% trans "Send an email to your account's email address to confirm that everything is configured correctly." %}</p>
 
-        {% if form.non_field_errors %}
-            <div class="alert alert-block alert-error">
-                <p>{% trans "There was an error sending a test email:" %}</p>
-                <ul>
-                    {% for error in form.non_field_errors %}
-                        <li>{{ error }}</li>
-                    {% endfor %}
-                </ul>
-            </div>
-        {% endif %}
+        {{ form|as_crispy_errors }}
 
         {% for field in form %}
             {% include "sentry/partial/_form_field.html" %}
diff --git a/src/sentry/templates/sentry/admin/users/edit.html b/src/sentry/templates/sentry/admin/users/edit.html
index 8914decae0..4ccbb6c6ca 100644
--- a/src/sentry/templates/sentry/admin/users/edit.html
+++ b/src/sentry/templates/sentry/admin/users/edit.html
@@ -1,5 +1,6 @@
 {% extends "sentry/admin/users/list.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 {% load sentry_admin_helpers %}
 {% load sentry_helpers %}
@@ -16,16 +17,7 @@
     <section class="body">
         <form action="" method="post">
             {% csrf_token %}
-            {% if form.non_field_errors %}
-                <div class="alert alert-block alert-error">
-                    <p>{% trans "There were errors saving your changes:" %}</p>
-                    <ul>
-                        {% for error in form.non_field_errors %}
-                            <li>{{ error }}</li>
-                        {% endfor %}
-                    </ul>
-                </div>
-            {% endif %}
+            {{ form|as_crispy_errors }}
             {% for field in form %}
                 {% include "sentry/partial/_form_field.html" %}
             {% endfor %}
diff --git a/src/sentry/templates/sentry/admin/users/remove.html b/src/sentry/templates/sentry/admin/users/remove.html
index 2c9c24a46d..84333937a5 100644
--- a/src/sentry/templates/sentry/admin/users/remove.html
+++ b/src/sentry/templates/sentry/admin/users/remove.html
@@ -1,5 +1,6 @@
 {% extends "sentry/admin/users/edit.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "Remove User" %} | {{ block.super }}{% endblock %}
@@ -14,16 +15,7 @@
     <section class="body">
         <form action="" method="post">
             {% csrf_token %}
-            {% if form.non_field_errors %}
-                <div class="alert alert-block alert-error">
-                    <p>{% trans "There were errors saving your changes:" %}</p>
-                    <ul>
-                        {% for error in form.non_field_errors %}
-                            <li>{{ error }}</li>
-                        {% endfor %}
-                    </ul>
-                </div>
-            {% endif %}
+            {{ form|as_crispy_errors }}
             {% for field in form %}
                 {% include "sentry/partial/_form_field.html" %}
             {% endfor %}
diff --git a/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html b/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
index 361e4ce1fd..14862ed8d9 100644
--- a/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
+++ b/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
@@ -1,5 +1,6 @@
 {% extends "sentry/groups/details.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{{ title }} | {{ block.super }}{% endblock %}
@@ -10,16 +11,7 @@
             <h3>{{ title }}</h3>
         </div>
 
-        {% if form.non_field_errors %}
-            <div class="alert alert-block alert-error">
-                <ul>
-                    {% for error in form.non_field_errors %}
-                        <li>{{ error }}</li>
-                    {% endfor %}
-                </ul>
-            </div>
-        {% endif %}
-
+        {{ form|as_crispy_errors }}
 
         <form class="form-stacked" action="" method="post">
             {% csrf_token %}
diff --git a/src/sentry/templates/sentry/projects/remove.html b/src/sentry/templates/sentry/projects/remove.html
index 2dffcaf851..f35cbf83cf 100644
--- a/src/sentry/templates/sentry/projects/remove.html
+++ b/src/sentry/templates/sentry/projects/remove.html
@@ -1,5 +1,6 @@
 {% extends "sentry/projects/manage.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "Remove Project" %} | {{ block.super }}{% endblock %}
@@ -14,16 +15,7 @@
     <section class="body">
         <form action="" method="post">
             {% csrf_token %}
-            {% if form.non_field_errors %}
-                <div class="alert alert-block alert-error">
-                    <p>{% trans "There were errors saving your changes:" %}</p>
-                    <ul>
-                        {% for error in form.non_field_errors %}
-                            <li>{{ error }}</li>
-                        {% endfor %}
-                    </ul>
-                </div>
-            {% endif %}
+            {{ form|as_crispy_errors }}
             {% for field in form %}
                 {% include "sentry/partial/_form_field.html" %}
             {% endfor %}
diff --git a/src/sentry/templates/sentry/teams/remove.html b/src/sentry/templates/sentry/teams/remove.html
index 2bc5d53ecb..9b99cdfc1e 100644
--- a/src/sentry/templates/sentry/teams/remove.html
+++ b/src/sentry/templates/sentry/teams/remove.html
@@ -1,5 +1,6 @@
 {% extends "sentry/teams/manage.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "Remove Team" %} | {{ block.super }}{% endblock %}
@@ -15,16 +16,7 @@
         <form action="" method="post">
             <p>{% trans "Are you sure you wish to remove this team? This change is permanent!" %}</p>
             {% csrf_token %}
-            {% if form.non_field_errors %}
-                <div class="alert alert-block alert-error">
-                    <p>{% trans "There were errors saving your changes:" %}</p>
-                    <ul>
-                        {% for error in form.non_field_errors %}
-                            <li>{{ error }}</li>
-                        {% endfor %}
-                    </ul>
-                </div>
-            {% endif %}
+            {{ form|as_crispy_errors }}
             {% for field in form %}
                 {% include "sentry/partial/_form_field.html" %}
             {% endfor %}
diff --git a/src/sentry/web/frontend/accounts.py b/src/sentry/web/frontend/accounts.py
index 8d454a8105..2d006c51ee 100644
--- a/src/sentry/web/frontend/accounts.py
+++ b/src/sentry/web/frontend/accounts.py
@@ -161,20 +161,16 @@ def notification_settings(request):
             form = safe_execute(form, plugin, request.user, request.POST or None)
             if not form:
                 continue
-            helper = FormHelper()
-            helper.form_tag = False
-            forms.append((form, helper))
+            forms.append(form)
 
     # Ensure our form comes first
-    helper = FormHelper()
-    helper.form_tag = False
     forms = [
-        (NotificationSettingsForm(request.user, request.POST or None), helper),
+        NotificationSettingsForm(request.user, request.POST or None),
     ] + forms
 
     if request.POST:
         if all(f.is_valid() for f, h in forms):
-            for form, helper in forms:
+            for form in forms:
                 form.save()
             messages.add_message(request, messages.SUCCESS, 'Your settings were saved.')
             return HttpResponseRedirect(request.path)
