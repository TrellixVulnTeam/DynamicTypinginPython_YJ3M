commit a91e373e3428317788090979a55e994a4d171dcd
Author: Mark Story <mark@sentry.io>
Date:   Thu Sep 6 10:24:09 2018 -0400

    feat(auth) Use auth API for logout
    
    Update the ui to use the DELETE API endpoint to logout instead of the
    web frontend.

diff --git a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
index fb3489e2ff..6f8c683331 100644
--- a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
@@ -15,11 +15,12 @@ import ConfigStore from 'app/stores/configStore';
 import SidebarOrgSummary from 'app/components/sidebar/sidebarOrgSummary';
 import SidebarMenuItem from 'app/components/sidebar/sidebarMenuItem';
 import SidebarDropdownMenu from 'app/components/sidebar/sidebarDropdownMenu.styled';
+import withApi from 'app/utils/withApi.jsx';
 
 import SwitchOrganization from './switchOrganization';
 import Divider from './divider.styled';
 
-class SidebarDropdown extends React.Component {
+const SidebarDropdown = withApi(class SidebarDropdown extends React.Component {
   static propTypes = {
     orientation: PropTypes.oneOf(['top', 'left']),
     collapsed: PropTypes.bool,
@@ -33,6 +34,17 @@ class SidebarDropdown extends React.Component {
     onClick: () => {},
   };
 
+  handleLogout = (...args) => {
+    let {api} = this.props;
+
+    api.request('/auth/', {
+      method: 'DELETE',
+      success: (res) => {
+        window.location = '/auth/login';
+      }
+    });
+  };
+
   render() {
     let {org, orientation, collapsed, config, user, onClick} = this.props;
     let hasOrganization = !!org;
@@ -140,7 +152,7 @@ class SidebarDropdown extends React.Component {
                         {user.isSuperuser && (
                           <SidebarMenuItem to={'/manage/'}>{t('Admin')}</SidebarMenuItem>
                         )}
-                        <SidebarMenuItem href="/auth/logout/">
+                        <SidebarMenuItem onClick={this.handleLogout}>
                           {t('Sign out')}
                         </SidebarMenuItem>
                       </div>
@@ -154,7 +166,7 @@ class SidebarDropdown extends React.Component {
       </DropdownMenu>
     );
   }
-}
+});
 
 export default SidebarDropdown;
 
diff --git a/src/sentry/templates/sentry/bases/modal.html b/src/sentry/templates/sentry/bases/modal.html
index cc6a0eb36c..47eca5cdfd 100644
--- a/src/sentry/templates/sentry/bases/modal.html
+++ b/src/sentry/templates/sentry/bases/modal.html
@@ -11,7 +11,7 @@
 <section class="org-login">
   <div class="box box-modal">
     <div class="box-header">
-      {% block modal_header%}
+      {% block modal_header %}
         {% block modal_header_signout %}
           {% if request.user.is_authenticated %}
             <div class="pull-right">
diff --git a/tests/sentry/web/frontend/test_auth_logout.py b/tests/sentry/web/frontend/test_auth_logout.py
index 4dd053be4b..307720cc56 100644
--- a/tests/sentry/web/frontend/test_auth_logout.py
+++ b/tests/sentry/web/frontend/test_auth_logout.py
@@ -12,6 +12,13 @@ class AuthLogoutTest(TestCase):
     def path(self):
         return reverse('sentry-logout')
 
+    def test_get_shows_page(self):
+        self.login_as(self.user)
+
+        resp = self.client.get(self.path)
+        assert resp.status_code == 200
+        assert self.client.session.keys(), 'Not logged out yet'
+
     def test_logs_user_out(self):
         self.login_as(self.user)
 
