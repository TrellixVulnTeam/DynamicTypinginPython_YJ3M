commit e2cfe0df886eecd31ba9320607d8a61d04c750a0
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Aug 4 14:47:20 2013 -0700

    Revert "Update tests and correct fetch_source"
    
    This reverts commit 7cd2c1e920c5c0fd61b6c8d327d506dc3aa6b5be.

diff --git a/src/sentry/tasks/fetch_source.py b/src/sentry/tasks/fetch_source.py
index bc25d2184d..38d8de6786 100644
--- a/src/sentry/tasks/fetch_source.py
+++ b/src/sentry/tasks/fetch_source.py
@@ -180,13 +180,11 @@ def expand_javascript_source(data, **kwargs):
         return
 
     # build list of frames that we can actually grab source for
-    frames = []
-    for stacktrace in stacktraces:
-        frames.extend([
-            f for f in stacktrace.frames
-            if f.lineno is not None
-            and f.is_url()
-        ])
+    frames = [
+        f for f in stacktrace.frames
+        if f.lineno is not None
+        and f.is_url()
+    ]
 
     if not frames:
         logger.debug('Event %r has no frames with enough context to fetch remote source', data['event_id'])
diff --git a/tests/sentry/tasks/fetch_source/tests.py b/tests/sentry/tasks/fetch_source/tests.py
index 21529ef286..9e39223023 100644
--- a/tests/sentry/tasks/fetch_source/tests.py
+++ b/tests/sentry/tasks/fetch_source/tests.py
@@ -54,26 +54,22 @@ class ExpandJavascriptSourceTest(TestCase):
     @mock.patch('sentry.tasks.fetch_source.fetch_sourcemap')
     def test_new_style(self, fetch_sourcemap, fetch_url, update):
         data = {
-            'sentry.interfaces.Exception': {
-                'values': [{
-                    'stacktrace': {
-                        'frames': [
-                            {
-                                'abs_path': 'http://example.com/foo.js',
-                                'filename': 'foo.js',
-                                'lineno': 4,
-                                'colno': 0,
-                            },
-                            {
-                                'abs_path': 'http://example.com/foo.js',
-                                'filename': 'foo.js',
-                                'lineno': 1,
-                                'colno': 0,
-                            },
-                        ],
+            'sentry.interfaces.Stacktrace': {
+                'frames': [
+                    {
+                        'abs_path': 'http://example.com/foo.js',
+                        'filename': 'foo.js',
+                        'lineno': 4,
+                        'colno': 0,
+                    },
+                    {
+                        'abs_path': 'http://example.com/foo.js',
+                        'filename': 'foo.js',
+                        'lineno': 1,
+                        'colno': 0,
                     },
-                }],
-            }
+                ],
+            },
         }
         fetch_sourcemap.return_value = None
         fetch_url.return_value.body = '\n'.join('hello world')
@@ -82,7 +78,7 @@ class ExpandJavascriptSourceTest(TestCase):
 
         fetch_url.assert_called_once_with('http://example.com/foo.js')
 
-        frame_list = data['sentry.interfaces.Exception']['values'][0]['stacktrace']['frames']
+        frame_list = data['sentry.interfaces.Stacktrace']['frames']
         frame = frame_list[0]
         assert frame['pre_context'] == ['h', 'e', 'l']
         assert frame['context_line'] == 'l'
