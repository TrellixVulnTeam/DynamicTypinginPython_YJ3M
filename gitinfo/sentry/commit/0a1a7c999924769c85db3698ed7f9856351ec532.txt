commit 0a1a7c999924769c85db3698ed7f9856351ec532
Author: James Cunningham <cunninghamjt09@gmail.com>
Date:   Fri Oct 4 13:21:31 2019 -0700

    perf(db): Cache positive/negative hit on having any release for a project. (#14931)
    
    * perf(db): Cache positive/negative hit on having any release for a project.
    
    * Remove implicit project lookup.
    
    * actually use this correctly
    
    * set to false instead of 0
    
    * explicitly re-get obj
    
    * use a boolean
    
    * remove extra caching
    
    * switch test project name to rule out conflation with other projects
    
    * Revert "switch test project name to rule out conflation with other projects"
    
    This reverts commit 3f21a5e5b435a3009133a9e4aff92a8c9fe1d68b.
    
    * fix mutli-pass cache condition

diff --git a/src/sentry/integrations/slack/utils.py b/src/sentry/integrations/slack/utils.py
index 948e9f2cf9..2202c72ca8 100644
--- a/src/sentry/integrations/slack/utils.py
+++ b/src/sentry/integrations/slack/utils.py
@@ -2,6 +2,7 @@ from __future__ import absolute_import
 
 import logging
 
+from django.core.cache import cache
 from django.core.urlresolvers import reverse
 
 from sentry import tagstore
@@ -11,11 +12,13 @@ from sentry.incidents.models import IncidentStatus
 from sentry.utils import json
 from sentry.utils.assets import get_asset_url
 from sentry.utils.dates import to_timestamp
+from sentry.utils.hashlib import hash_values
 from sentry.utils.http import absolute_uri
 from sentry.models import (
     GroupStatus,
     GroupAssignee,
     OrganizationMember,
+    Project,
     User,
     Identity,
     Team,
@@ -172,9 +175,18 @@ def build_group_attachment(group, event=None, tags=None, identity=None, actions=
 
     ignore_button = {"name": "status", "value": "ignored", "type": "button", "text": "Ignore"}
 
-    has_releases = Release.objects.filter(
-        projects=group.project, organization_id=group.project.organization_id
-    ).exists()
+    project = Project.objects.get_from_cache(id=group.project_id)
+
+    cache_key = "has_releases:1:%s" % hash_values([project.id, project.organization_id])
+    has_releases = cache.get(cache_key)
+    if has_releases is None:
+        has_releases = Release.objects.filter(
+            projects=project, organization_id=project.organization_id
+        ).exists()
+        if has_releases:
+            cache.set(cache_key, True, 3600)
+        else:
+            cache.set(cache_key, False, 60)
 
     if not has_releases:
         resolve_button.update({"name": "status", "text": "Resolve", "value": "resolved"})
@@ -247,7 +259,7 @@ def build_group_attachment(group, event=None, tags=None, identity=None, actions=
 
     obj = event if event is not None else group
     return {
-        "fallback": u"[{}] {}".format(obj.project.slug, obj.title),
+        "fallback": u"[{}] {}".format(project.slug, obj.title),
         "title": build_attachment_title(obj),
         "title_link": group.get_absolute_url(params={"referrer": "slack"}),
         "text": text,
