commit e36a91cac63663c3add04c7fa9d780ba9834e191
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Oct 6 23:23:06 2016 -0700

    [sudo] Fix behavior with unusable passwords (#4299)

diff --git a/src/sentry/constants.py b/src/sentry/constants.py
index a13e2c30c0..97a9e55b42 100644
--- a/src/sentry/constants.py
+++ b/src/sentry/constants.py
@@ -58,10 +58,6 @@ STATUS_CHOICES = {
     'muted': STATUS_MUTED,
 }
 
-# A list of values which represent an unset or empty password on
-# a User instance.
-EMPTY_PASSWORD_VALUES = ('!', '', '$')
-
 # Normalize counts to the 15 minute marker. This value MUST be less than 60. A
 # value of 0 would store counts for every minute, and is the lowest level of
 # accuracy provided.
diff --git a/src/sentry/middleware/sudo.py b/src/sentry/middleware/sudo.py
index 81a339682d..6c63a910d5 100644
--- a/src/sentry/middleware/sudo.py
+++ b/src/sentry/middleware/sudo.py
@@ -9,14 +9,12 @@ from __future__ import absolute_import
 
 from sudo.middleware import SudoMiddleware as BaseSudoMiddleware
 
-from sentry.constants import EMPTY_PASSWORD_VALUES
-
 
 class SudoMiddleware(BaseSudoMiddleware):
     def has_sudo_privileges(self, request):
         # Users without a password are assumed to always have sudo powers
         user = request.user
-        if user.is_authenticated() and user.password in EMPTY_PASSWORD_VALUES:
+        if user.is_authenticated() and not user.has_usable_password():
             return True
 
         return super(SudoMiddleware, self).has_sudo_privileges(request)
