commit 9344e18b5d6f5333fa38ca1b2aacbf0c25b9cf55
Author: David Cramer <dcramer@gmail.com>
Date:   Wed May 27 16:25:19 2015 +0200

    Add member scopes

diff --git a/src/sentry/api/endpoints/organization_member_details.py b/src/sentry/api/endpoints/organization_member_details.py
index 90d9691ebf..83164bbc5d 100644
--- a/src/sentry/api/endpoints/organization_member_details.py
+++ b/src/sentry/api/endpoints/organization_member_details.py
@@ -27,13 +27,13 @@ class OrganizationMemberSerializer(serializers.Serializer):
 
 class RelaxedOrganizationPermission(OrganizationPermission):
     scope_map = {
-        'GET': ['org:read', 'org:write', 'org:delete'],
-        'POST': ['org:write', 'org:delete'],
-        'PUT': ['org:write', 'org:delete'],
+        'GET': ['member:read', 'member:write', 'member:delete'],
+        'POST': ['member:write', 'member:delete'],
+        'PUT': ['member:write', 'member:delete'],
 
         # DELETE checks for role comparison as you can either remove a member
         # with a lower access role, or yourself, without having the req. scope
-        'DELETE': ['org:read', 'org:write', 'org:delete'],
+        'DELETE': ['member:read', 'member:write', 'member:delete'],
     }
 
 
diff --git a/src/sentry/api/endpoints/organization_member_index.py b/src/sentry/api/endpoints/organization_member_index.py
index 8f23843468..a77e1b22c6 100644
--- a/src/sentry/api/endpoints/organization_member_index.py
+++ b/src/sentry/api/endpoints/organization_member_index.py
@@ -2,12 +2,25 @@ from __future__ import absolute_import
 
 from rest_framework.response import Response
 
-from sentry.api.bases.organization import OrganizationEndpoint
+from sentry.api.bases.organization import (
+    OrganizationEndpoint, OrganizationPermission
+)
 from sentry.api.serializers import serialize
 from sentry.models import OrganizationMember
 
 
+class MemberPermission(OrganizationPermission):
+    scope_map = {
+        'GET': ['member:read', 'member:write', 'member:delete'],
+        'POST': ['member:write', 'member:delete'],
+        'PUT': ['member:write', 'member:delete'],
+        'DELETE': ['member:delete'],
+    }
+
+
 class OrganizationMemberIndexEndpoint(OrganizationEndpoint):
+    permission_classes = (MemberPermission,)
+
     def get(self, request, organization):
         queryset = OrganizationMember.objects.filter(
             organization=organization,
diff --git a/src/sentry/auth/access.py b/src/sentry/auth/access.py
index 40465997aa..81823241e2 100644
--- a/src/sentry/auth/access.py
+++ b/src/sentry/auth/access.py
@@ -10,6 +10,9 @@ SCOPES = set([
     'org:read',
     'org:write',
     'org:delete',
+    'member:read',
+    'member:write',
+    'member:delete',
     'team:read',
     'team:write',
     'team:delete',
diff --git a/src/sentry/models/apikey.py b/src/sentry/models/apikey.py
index 55736d68fa..8da867e17b 100644
--- a/src/sentry/models/apikey.py
+++ b/src/sentry/models/apikey.py
@@ -44,6 +44,9 @@ class ApiKey(Model):
         ('org:read', 'org:read'),
         ('org:write', 'org:write'),
         ('org:delete', 'org:delete'),
+        ('member:read', 'member:read'),
+        ('member:write', 'member:write'),
+        ('member:delete', 'member:delete'),
     ))
     status = BoundedPositiveIntegerField(default=0, choices=(
         (ApiKeyStatus.ACTIVE, _('Active')),
diff --git a/src/sentry/models/organizationmember.py b/src/sentry/models/organizationmember.py
index a04ab8f013..58b5375441 100644
--- a/src/sentry/models/organizationmember.py
+++ b/src/sentry/models/organizationmember.py
@@ -147,6 +147,7 @@ class OrganizationMember(Model):
             scopes.extend([
                 'event:read', 'event:write', 'event:delete',
                 'org:read', 'project:read', 'team:read',
+                'member:read',
             ])
         if self.type <= OrganizationMemberType.ADMIN:
             scopes.extend(['project:write', 'team:write'])
@@ -154,9 +155,9 @@ class OrganizationMember(Model):
             scopes.extend(['project:delete', 'team:delete'])
         if self.has_global_access:
             if self.type <= OrganizationMemberType.ADMIN:
-                scopes.extend(['org:write'])
+                scopes.extend(['org:write', 'member:write'])
             if self.type <= OrganizationMemberType.OWNER:
-                scopes.extend(['org:delete'])
+                scopes.extend(['org:delete', 'member:delete'])
         return scopes
 
     def send_invite_email(self):
diff --git a/src/sentry/web/frontend/organization_api_keys.py b/src/sentry/web/frontend/organization_api_keys.py
index 773b2fdd62..23723f292f 100644
--- a/src/sentry/web/frontend/organization_api_keys.py
+++ b/src/sentry/web/frontend/organization_api_keys.py
@@ -14,6 +14,7 @@ DEFAULT_SCOPES = [
     'event:read',
     'team:read',
     'org:read',
+    'member:read',
 ]
 
 
