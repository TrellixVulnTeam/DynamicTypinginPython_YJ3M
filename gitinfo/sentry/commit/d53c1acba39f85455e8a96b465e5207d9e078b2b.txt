commit d53c1acba39f85455e8a96b465e5207d9e078b2b
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Sep 1 18:14:45 2016 -0700

    Revert "Don't fire off a stampeded of Team/Project deletion tasks (#4006)" (#4067)
    
    This reverts commit 373562702009df1692da6eb80a933139f29e094b.
    
    Revert "Don't explicitly say continuous=False when deleting teams and projects (#4052)"
    
    This reverts commit 3916932c015cbadeeb5cbe3f416d73380647773a.

diff --git a/src/sentry/tasks/deletion.py b/src/sentry/tasks/deletion.py
index cccd46978c..bbb4a64cca 100644
--- a/src/sentry/tasks/deletion.py
+++ b/src/sentry/tasks/deletion.py
@@ -38,9 +38,9 @@ def delete_organization(object_id, transaction_id=None, continuous=True, **kwarg
         o.update(status=OrganizationStatus.DELETION_IN_PROGRESS)
         pending_delete.send(sender=Organization, instance=o)
 
-    for team in Team.objects.filter(organization=o).exclude(status=TeamStatus.DELETION_IN_PROGRESS).order_by('id')[:1]:
+    for team in Team.objects.filter(organization=o).order_by('id')[:1]:
         team.update(status=TeamStatus.DELETION_IN_PROGRESS)
-        delete_team(team.id, transaction_id=transaction_id)
+        delete_team(team.id, transaction_id=transaction_id, continuous=False)
         if continuous:
             delete_organization.apply_async(
                 kwargs={'object_id': object_id, 'transaction_id': transaction_id},
@@ -86,9 +86,9 @@ def delete_team(object_id, transaction_id=None, continuous=True, **kwargs):
         t.update(status=TeamStatus.DELETION_IN_PROGRESS)
 
     # Delete 1 project at a time since this is expensive by itself
-    for project in Project.objects.filter(team=t).exclude(status=ProjectStatus.DELETION_IN_PROGRESS).order_by('id')[:1]:
+    for project in Project.objects.filter(team=t).order_by('id')[:1]:
         project.update(status=ProjectStatus.DELETION_IN_PROGRESS)
-        delete_project(project.id, transaction_id=transaction_id)
+        delete_project(project.id, transaction_id=transaction_id, continuous=False)
         if continuous:
             delete_team.apply_async(
                 kwargs={'object_id': object_id, 'transaction_id': transaction_id},
