commit 38fff31a341770376e1d0fb991a108aaac0933f2
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Dec 22 11:22:57 2010 -0800

    Ensure we truncate the message top after a certain number of characters

diff --git a/sentry/templates/sentry/group/details.html b/sentry/templates/sentry/group/details.html
index 388f329469..f440131b31 100644
--- a/sentry/templates/sentry/group/details.html
+++ b/sentry/templates/sentry/group/details.html
@@ -38,7 +38,7 @@
         <ul class="messages" id="message_list">
             <li class="{% cycle 'row1' 'row2' %} level-{{ group.level }} active" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
                 <span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
-                <h3>{% if group.view %}{{ group.view }}{% else %}{{ group.message_top }}{% endif %}</h3>
+                <h3>{% if group.view %}{{ group.view }}{% else %}{{ group.message_top|truncatechars:100 }}{% endif %}</h3>
                 <span class="last_seen">{{ group.last_seen|timesince }}</span>
                 <span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
                 <p class="message">
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index 9502679230..43c3331eac 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -2,7 +2,7 @@
 
 <li class="{% cycle 'row1' 'row2' %} level-{{ group.level }}{% if priority %} priority-{{ priority }}{% endif %}" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
     <span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
-    <h3><a href="{% url sentry-group group.pk %}">{% if group.view %}{{ group.view }}{% else %}{{ group.message_top }}{% endif %}</a></h3>
+    <h3><a href="{% url sentry-group group.pk %}">{% if group.view %}{{ group.view }}{% else %}{{ group.message_top|truncatechars:100 }}{% endif %}</a></h3>
     <span class="last_seen">{{ group.last_seen|timesince }}</span>
     <span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
     <p class="message">
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 3dfbdefc36..d5b8362e5a 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -1,6 +1,7 @@
 from django import template
 from django.db.models import Count
 from django.utils import simplejson
+from django.template.defaultfilters import stringfilter
 
 from sentry.helpers import get_db_engine
 from sentry.plugins import GroupActionProvider
@@ -141,3 +142,20 @@ def timesince(value):
     if value == '1 day':
         return 'Yesterday'
     return value + ' ago'
+
+@register.filter(name='truncatechars')
+@stringfilter
+def truncatechars(value, arg):
+    """
+    Truncates a string after a certain number of chars.
+
+    Argument: Number of chars to truncate after.
+    """
+    try:
+        length = int(arg)
+    except ValueError: # Invalid literal for int().
+        return value # Fail silently.
+    if len(value) > length:
+        return value[:length] + '...'
+    return value
+truncatechars.is_safe = True
\ No newline at end of file
