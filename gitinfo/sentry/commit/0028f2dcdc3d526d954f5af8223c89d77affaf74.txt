commit 0028f2dcdc3d526d954f5af8223c89d77affaf74
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Wed Oct 4 17:35:13 2017 -0700

    feat(react): Add loader to <Button> (#6172)
    
    * feat(react): Add loader to <Button>
    
    * feat(react): Remove loading indicator in `<Button>`
    
    * feat(react): Add tooltips to `<Button>`
    
    * build(storybook): Change addon order

diff --git a/.storybook/addons.js b/.storybook/addons.js
index 218bf7a5e6..2efe80ebff 100644
--- a/.storybook/addons.js
+++ b/.storybook/addons.js
@@ -1,2 +1,2 @@
-import '@storybook/addon-actions/register';
 import '@storybook/addon-knobs/register';
+import '@storybook/addon-actions/register';
diff --git a/docs-ui/components/button.stories.js b/docs-ui/components/button.stories.js
index 0504f7bb91..309a60e6ee 100644
--- a/docs-ui/components/button.stories.js
+++ b/docs-ui/components/button.stories.js
@@ -2,6 +2,7 @@ import React from 'react';
 import {storiesOf} from '@storybook/react';
 import {withInfo} from '@storybook/addon-info';
 import {action} from '@storybook/addon-actions';
+import {boolean} from '@storybook/addon-knobs';
 
 import Button from 'sentry-ui/buttons/button';
 
@@ -68,4 +69,44 @@ storiesOf('Buttons', module)
         </Item>
       </div>
     ))
+  )
+  .add(
+    'states',
+    withInfo('Different button states')(() => (
+      <div style={{display: 'flex', alignItems: 'center'}}>
+        <Item>
+          <Button
+            busy={boolean('Extra Small Busy', true)}
+            priority="primary"
+            size="xsmall">
+            Extra Small
+          </Button>
+        </Item>
+
+        <Item>
+          <Button busy={boolean('Small Busy', true)} priority="primary" size="small">
+            Small
+          </Button>
+        </Item>
+
+        <Item>
+          <Button busy={boolean('Normal Busy', true)} priority="primary">
+            Normal
+          </Button>
+        </Item>
+
+        <Item>
+          <Button busy={boolean('Large Busy', true)} priority="primary" size="large">
+            Large
+          </Button>
+        </Item>
+
+        <Item>
+          <Button priority="primary" disabled onClick={action('click disabled')}>
+            Disabled Button
+          </Button>
+        </Item>
+
+      </div>
+    ))
   );
diff --git a/src/sentry/static/sentry/app/components/buttons/button.jsx b/src/sentry/static/sentry/app/components/buttons/button.jsx
index 65e2f0a811..bba452087d 100644
--- a/src/sentry/static/sentry/app/components/buttons/button.jsx
+++ b/src/sentry/static/sentry/app/components/buttons/button.jsx
@@ -1,8 +1,10 @@
+import {Link} from 'react-router';
 import PropTypes from 'prop-types';
 import React from 'react';
-import {Link} from 'react-router';
 import classNames from 'classnames';
 
+import FlowLayout from '../flowLayout';
+
 import '../../../less/components/button.less';
 
 const Button = React.createClass({
@@ -10,6 +12,7 @@ const Button = React.createClass({
     priority: PropTypes.oneOf(['primary', 'danger']),
     size: PropTypes.oneOf(['small', 'xsmall', 'large']),
     disabled: PropTypes.bool,
+    busy: PropTypes.bool,
     /**
      * Use this prop if button is a react-router link
      */
@@ -18,6 +21,10 @@ const Button = React.createClass({
      * Use this prop if button should use a normal (non-react-router) link
      */
     href: PropTypes.string,
+    /**
+     * Tooltip text
+     */
+    title: PropTypes.string,
     onClick: PropTypes.func
   },
 
@@ -29,8 +36,11 @@ const Button = React.createClass({
 
   // Intercept onClick and propagate
   handleClick(...args) {
-    let {disabled, onClick} = this.props;
-    if (disabled) return;
+    let {disabled, busy, onClick} = this.props;
+
+    // Don't allow clicks when disabled or busy
+    if (disabled || busy) return;
+
     if (typeof onClick !== 'function') return;
 
     onClick(...args);
@@ -45,6 +55,8 @@ const Button = React.createClass({
       children,
       className,
       disabled,
+      busy,
+      title,
 
       // destructure from `buttonProps`
       // not necessary, but just in case someone re-orders props
@@ -53,64 +65,58 @@ const Button = React.createClass({
       ...buttonProps
     } = this.props;
 
-    let isPrimary = priority === 'primary';
-    let isDanger = priority === 'danger';
+    let isPrimary = priority === 'primary' && !disabled;
+    let isDanger = priority === 'danger' && !disabled;
+
     let cx = classNames(className, 'button', {
+      tip: !!title,
       'button-primary': isPrimary,
       'button-danger': isDanger,
       'button-default': !isPrimary && !isDanger,
       'button-sm': size === 'small',
       'button-xs': size === 'xsmall',
       'button-lg': size === 'large',
+      'button-busy': busy,
       'button-disabled': disabled
     });
 
+    // This container is useless now, but leaves room for when we need to add
+    // components (i.e. icons, busy indicator, etc)
+    let childContainer = (
+      <FlowLayout truncate={false}>
+        <span className="button-label">
+          {children}
+        </span>
+      </FlowLayout>
+    );
+
     // Buttons come in 3 flavors: Link, anchor, and regular buttons. Let's
     // use props to determine which to serve up, so we don't have to think
     // about it. As a bonus, let's ensure all buttons appear as a button
     // control to screen readers. Note: you must still handle tabindex manually.
 
+    // Props common to all elements
+    let componentProps = {
+      disabled,
+      ...buttonProps,
+      onClick: this.handleClick,
+      className: cx,
+      role: 'button',
+      children: childContainer
+    };
+
     // Handle react-router Links
     if (to) {
-      return (
-        <Link
-          to={to}
-          disabled={disabled}
-          {...buttonProps}
-          onClick={this.handleClick}
-          className={cx}
-          role="button">
-          {children}
-        </Link>
-      );
+      return <Link to={to} {...componentProps} />;
     }
 
     // Handle traditional links
     if (href) {
-      return (
-        <a
-          href={href}
-          disabled={disabled}
-          {...buttonProps}
-          onClick={this.handleClick}
-          className={cx}
-          role="button">
-          {children}
-        </a>
-      );
+      return <a href={href} {...componentProps} />;
     }
 
     // Otherwise, fall back to basic button element
-    return (
-      <button
-        disabled={disabled}
-        {...buttonProps}
-        onClick={this.handleClick}
-        className={cx}
-        role="button">
-        {children}
-      </button>
-    );
+    return <button {...componentProps} />;
   }
 });
 
diff --git a/src/sentry/static/sentry/app/components/loadingIndicator.jsx b/src/sentry/static/sentry/app/components/loadingIndicator.jsx
index 422fd5ffef..26cc0e2eeb 100644
--- a/src/sentry/static/sentry/app/components/loadingIndicator.jsx
+++ b/src/sentry/static/sentry/app/components/loadingIndicator.jsx
@@ -3,17 +3,18 @@ import React from 'react';
 import classNames from 'classnames';
 
 function LoadingIndicator(props) {
-  let {mini, triangle} = props;
-  let classes = {
+  let {mini, triangle, children, className} = props;
+  let cx = classNames(className, {
     loading: true,
     mini,
     triangle
-  };
+  });
 
   return (
-    <div className={classNames(props.className, classes)}>
+    <div className={cx}>
       <div className="loading-indicator" />
-      <div className="loading-message">{props.children}</div>
+
+      <div className="loading-message">{children}</div>
     </div>
   );
 }
diff --git a/src/sentry/static/sentry/less/components/button.less b/src/sentry/static/sentry/less/components/button.less
index fdf6a6c256..7c4e55c08e 100644
--- a/src/sentry/static/sentry/less/components/button.less
+++ b/src/sentry/static/sentry/less/components/button.less
@@ -8,7 +8,11 @@
   box-shadow: 0 2px rgba(0,0,0, .05);
   cursor: pointer;
   font-size: 14px;
-  padding: 12px 16px;
+  padding: 0;
+
+  .button-label {
+    padding: 12px 16px;
+  }
 
   &:active {
     box-shadow: inset 0 2px rgba(0,0,0, .05);
@@ -53,6 +57,10 @@
   }
 }
 
+.button-busy {
+  opacity: 0.65;
+}
+
 .button-disabled {
   // old values: color: @50, border: @trim
   // changed to match `.btn.disabled`
@@ -74,17 +82,26 @@
 // - Padding and font size
 
 .button-xs {
-  padding: 6px 10px;
   font-size: 12px;
+
+  .button-label {
+    padding: 6px 10px;
+  }
 }
 
 .button-sm {
-  padding: 8px 12px;
   font-size: 12px;
+
+  .button-label {
+    padding: 8px 12px;
+  }
 }
 
 .button-lg {
   font-size: 16px;
-  padding: 14px 20px;
+
+  .button-label {
+    padding: 14px 20px;
+  }
 }
 
diff --git a/tests/js/spec/components/__snapshots__/button.spec.jsx.snap b/tests/js/spec/components/__snapshots__/button.spec.jsx.snap
index 251caaa9bf..ded9dcee05 100644
--- a/tests/js/spec/components/__snapshots__/button.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/button.spec.jsx.snap
@@ -7,7 +7,15 @@ exports[`Button renders 1`] = `
   onClick={[Function]}
   role="button"
 >
-  Button
+  <FlowLayout
+    truncate={false}
+  >
+    <span
+      className="button-label"
+    >
+      Button
+    </span>
+  </FlowLayout>
 </button>
 `;
 
@@ -19,7 +27,15 @@ exports[`Button renders normal link 1`] = `
   onClick={[Function]}
   role="button"
 >
-  Normal Link
+  <FlowLayout
+    truncate={false}
+  >
+    <span
+      className="button-label"
+    >
+      Normal Link
+    </span>
+  </FlowLayout>
 </a>
 `;
 
@@ -33,6 +49,14 @@ exports[`Button renders react-router link 1`] = `
   style={Object {}}
   to="/some/route"
 >
-  Router Link
+  <FlowLayout
+    truncate={false}
+  >
+    <span
+      className="button-label"
+    >
+      Router Link
+    </span>
+  </FlowLayout>
 </Link>
 `;
diff --git a/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap b/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
index c6187bb24e..281025685b 100644
--- a/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/groupMergedView.spec.jsx.snap
@@ -405,7 +405,19 @@ exports[`Issues -> Merged View renders with mocked data 1`] = `
                               }
                             }
                           >
-                            Compare
+                            <FlowLayout
+                              truncate={false}
+                            >
+                              <div
+                                className="flow-layout"
+                              >
+                                <span
+                                  className="button-label"
+                                >
+                                  Compare
+                                </span>
+                              </div>
+                            </FlowLayout>
                           </button>
                         </Button>
                       </div>
@@ -428,7 +440,19 @@ exports[`Issues -> Merged View renders with mocked data 1`] = `
                             onClick={[Function]}
                             role="button"
                           >
-                            Collapse All
+                            <FlowLayout
+                              truncate={false}
+                            >
+                              <div
+                                className="flow-layout"
+                              >
+                                <span
+                                  className="button-label"
+                                >
+                                  Collapse All
+                                </span>
+                              </div>
+                            </FlowLayout>
                           </button>
                         </Button>
                       </div>
@@ -1769,7 +1793,19 @@ exports[`Issues -> Merged View renders with mocked data 2`] = `
                               }
                             }
                           >
-                            Compare
+                            <FlowLayout
+                              truncate={false}
+                            >
+                              <div
+                                className="flow-layout"
+                              >
+                                <span
+                                  className="button-label"
+                                >
+                                  Compare
+                                </span>
+                              </div>
+                            </FlowLayout>
                           </button>
                         </Button>
                       </div>
@@ -1792,7 +1828,19 @@ exports[`Issues -> Merged View renders with mocked data 2`] = `
                             onClick={[Function]}
                             role="button"
                           >
-                            Collapse All
+                            <FlowLayout
+                              truncate={false}
+                            >
+                              <div
+                                className="flow-layout"
+                              >
+                                <span
+                                  className="button-label"
+                                >
+                                  Collapse All
+                                </span>
+                              </div>
+                            </FlowLayout>
                           </button>
                         </Button>
                       </div>
diff --git a/tests/js/spec/views/__snapshots__/organizationIntegrations.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationIntegrations.spec.jsx.snap
index e97795f8fb..6845690d89 100644
--- a/tests/js/spec/views/__snapshots__/organizationIntegrations.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationIntegrations.spec.jsx.snap
@@ -183,7 +183,19 @@ exports[`OrganizationIntegrations render() with a provider renders 1`] = `
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -208,7 +220,19 @@ exports[`OrganizationIntegrations render() with a provider renders 1`] = `
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -757,7 +781,19 @@ exports[`OrganizationIntegrations render() with a provider renders with a reposi
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -782,7 +818,19 @@ exports[`OrganizationIntegrations render() with a provider renders with a reposi
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -1472,7 +1520,19 @@ exports[`OrganizationIntegrations render() without any providers renders 1`] = `
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -1497,7 +1557,19 @@ exports[`OrganizationIntegrations render() without any providers renders 1`] = `
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
diff --git a/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
index 800d7af76f..30a8d1f29a 100644
--- a/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
@@ -187,7 +187,19 @@ exports[`OrganizationRepositories render() with a provider renders 1`] = `
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -212,7 +224,19 @@ exports[`OrganizationRepositories render() with a provider renders 1`] = `
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -836,7 +860,19 @@ exports[`OrganizationRepositories render() with a provider renders with a reposi
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -861,7 +897,19 @@ exports[`OrganizationRepositories render() with a provider renders with a reposi
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -1339,9 +1387,21 @@ exports[`OrganizationRepositories render() with a provider renders with a reposi
                                   onClick={[Function]}
                                   role="button"
                                 >
-                                  <span
-                                    className="icon icon-trash"
-                                  />
+                                  <FlowLayout
+                                    truncate={false}
+                                  >
+                                    <div
+                                      className="flow-layout"
+                                    >
+                                      <span
+                                        className="button-label"
+                                      >
+                                        <span
+                                          className="icon icon-trash"
+                                        />
+                                      </span>
+                                    </div>
+                                  </FlowLayout>
                                 </button>
                               </Button>
                               <Modal
@@ -1652,7 +1712,19 @@ exports[`OrganizationRepositories render() without any providers renders 1`] = `
                     }
                   }
                 >
-                  New Project
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Project
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
@@ -1677,7 +1749,19 @@ exports[`OrganizationRepositories render() without any providers renders 1`] = `
                   role="button"
                   style={Object {}}
                 >
-                  New Team
+                  <FlowLayout
+                    truncate={false}
+                  >
+                    <div
+                      className="flow-layout"
+                    >
+                      <span
+                        className="button-label"
+                      >
+                        New Team
+                      </span>
+                    </div>
+                  </FlowLayout>
                 </a>
               </Link>
             </Button>
