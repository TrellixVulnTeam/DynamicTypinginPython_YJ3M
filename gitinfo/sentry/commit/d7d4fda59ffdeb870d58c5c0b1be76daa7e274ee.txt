commit d7d4fda59ffdeb870d58c5c0b1be76daa7e274ee
Author: Roger Hu <rhu@hearsaycorp.com>
Date:   Thu Apr 9 11:54:20 2015 -0700

    test_access.py
    
    Fix issue if an Anonymous user is passed to the from_user() function.

diff --git a/src/sentry/auth/access.py b/src/sentry/auth/access.py
index d3966af2ae..2731142aa3 100644
--- a/src/sentry/auth/access.py
+++ b/src/sentry/auth/access.py
@@ -69,6 +69,9 @@ def from_user(user, organization):
     if not organization:
         return DEFAULT
 
+    if user.is_anonymous():
+        return DEFAULT
+
     try:
         om = OrganizationMember.objects.get(
             user=user,
diff --git a/tests/sentry/auth/test_access.py b/tests/sentry/auth/test_access.py
index 1ec18e576e..36ae2e4853 100644
--- a/tests/sentry/auth/test_access.py
+++ b/tests/sentry/auth/test_access.py
@@ -78,6 +78,15 @@ class FromUserTest(TestCase):
         result = access.from_user(user, organization)
         assert result.sso_is_valid
 
+    def test_anonymous_user(self):
+        from django.contrib.auth.models import AnonymousUser
+        user = self.create_user()
+        anon_user = AnonymousUser()
+        organization = self.create_organization(owner=user)
+        result = access.from_user(anon_user, organization)
+
+        assert not result.is_active
+
 
 class DefaultAccessTest(TestCase):
     def test_no_access(self):
