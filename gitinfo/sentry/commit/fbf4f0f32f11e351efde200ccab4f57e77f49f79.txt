commit fbf4f0f32f11e351efde200ccab4f57e77f49f79
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 27 14:07:35 2016 -0700

    Add tests for device context in JS

diff --git a/tests/sentry/lang/javascript/test_plugin.py b/tests/sentry/lang/javascript/test_plugin.py
index a4b75d9558..79ea645252 100644
--- a/tests/sentry/lang/javascript/test_plugin.py
+++ b/tests/sentry/lang/javascript/test_plugin.py
@@ -21,7 +21,7 @@ def load_fixture(name):
 
 
 class JavascriptIntegrationTest(TestCase):
-    def test_adds_contexts(self):
+    def test_adds_contexts_without_device(self):
         data = {
             'message': 'hello',
             'platform': 'javascript',
@@ -49,6 +49,40 @@ class JavascriptIntegrationTest(TestCase):
         }
         assert contexts.get('device') is None
 
+    def test_adds_contexts_with_device(self):
+        data = {
+            'message': 'hello',
+            'platform': 'javascript',
+            'sentry.interfaces.Http': {
+                'url': 'http://example.com',
+                'headers': [
+                    ['User-Agent', 'Mozilla/5.0 (Linux; U; Android 4.3; en-us; SCH-R530U Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 USCC-R530U'],
+                ],
+            }
+        }
+
+        resp = self._postWithHeader(data)
+        assert resp.status_code, 200
+
+        event = Event.objects.get()
+        contexts = event.interfaces['contexts'].to_json()
+        assert contexts.get('os') == {
+            'name': 'Android',
+            'type': 'os',
+            'version': '4.3',
+        }
+        assert contexts['browser'] == {
+            'name': 'Android',
+            'type': 'browser',
+            'version': '4.3',
+        }
+        assert contexts.get('device') == {
+            'family': 'Samsung SCH-R530U',
+            'type': 'device',
+            'model': 'SCH-R530U',
+            'brand': 'Samsung',
+        }
+
     @patch('sentry.lang.javascript.processor.fetch_file')
     def test_source_expansion(self, mock_fetch_file):
         data = {
