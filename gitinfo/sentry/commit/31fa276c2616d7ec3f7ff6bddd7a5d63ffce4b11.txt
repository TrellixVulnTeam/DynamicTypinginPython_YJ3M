commit 31fa276c2616d7ec3f7ff6bddd7a5d63ffce4b11
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Sep 11 15:39:07 2017 -0700

    ref(build): Move requirements into pip files

diff --git a/MANIFEST.in b/MANIFEST.in
index 9a68c69d12..e08b684048 100644
--- a/MANIFEST.in
+++ b/MANIFEST.in
@@ -1,4 +1,5 @@
 include setup.py src/sentry/assets.json README.rst MANIFEST.in LICENSE AUTHORS
+recursive-include ./ requirements*.txt
 recursive-include src/sentry/templates *
 recursive-include src/sentry/locale *
 recursive-include src/sentry/data *
diff --git a/requirements-base.txt b/requirements-base.txt
new file mode 100644
index 0000000000..04c044b93e
--- /dev/null
+++ b/requirements-base.txt
@@ -0,0 +1,58 @@
+botocore<1.5.71
+boto3>=1.4.1,<1.4.6
+celery>=3.1.8,<3.1.19
+click>=5.0,<7.0
+# 'cryptography>=1.3,<1.4
+cssutils>=0.9.9,<0.10.0
+Django>=1.6.0,<1.7
+django-crispy-forms>=1.4.0,<1.5.0
+django-jsonfield>=0.9.13,<0.9.14
+django-picklefield>=0.3.0,<0.4.0
+django-sudo>=2.1.0,<3.0.0
+django-templatetag-sugar>=0.1.0
+djangorestframework>=2.4.8,<2.5.0
+email-reply-parser>=0.2.0,<0.3.0
+enum34>=0.9.18,<1.2.0
+exam>=0.5.1
+# broken on python3
+hiredis>=0.1.0,<0.2.0
+honcho>=0.7.0,<0.8.0
+kombu==3.0.35
+ipaddress>=1.0.16,<1.1.0
+libsourcemap>=0.7.2,<0.8.0
+loremipsum>=1.0.5,<1.1.0
+lxml>=3.4.1
+mock>=0.8.0,<1.1
+mmh3>=2.3.1,<2.4
+oauth2>=1.5.167
+percy>=0.4.5
+petname>=2.0,<2.1
+Pillow>=3.2.0,<3.3.0
+progressbar2>=3.10,<3.11
+psycopg2>=2.6.0,<2.7.0
+pytest>=3.1.2,<3.2.0
+pytest-django>=2.9.1,<2.10.0
+pytest-html>=1.9.0,<1.10.0
+python-dateutil>=2.0.0,<3.0.0
+python-memcached>=1.53,<2.0.0
+python-openid>=2.2
+PyYAML>=3.11,<3.12
+raven>=5.29.0,<6.0.0
+redis>=2.10.3,<2.10.6
+requests[security]>=2.9.1,<2.13.0
+selenium==3.4.3
+simplejson>=3.2.0,<3.9.0
+six>=1.10.0,<1.11.0
+setproctitle>=1.1.7,<1.2.0
+statsd>=3.1.0,<3.2.0
+structlog==16.1.0
+sqlparse>=0.1.16,<0.2.0
+symsynd>=3.0.0,<4.0.0
+toronado>=0.0.11,<0.1.0
+ua-parser>=0.6.1,<0.8.0
+urllib3>=1.14,<1.17
+uwsgi>2.0.0,<2.1.0
+rb>=1.7.0,<2.0.0
+qrcode>=5.2.2,<6.0.0
+python-u2flib-server>=4.0.1,<4.1.0
+redis-py-cluster>=1.3.4,<1.4.0
diff --git a/requirements-dev.txt b/requirements-dev.txt
new file mode 100644
index 0000000000..baf0cb545f
--- /dev/null
+++ b/requirements-dev.txt
@@ -0,0 +1,5 @@
+autopep8
+Babel
+flake8>=2.6,<2.7
+pycodestyle>=2.0,<2.1
+isort>=4.2.2,<4.3.0
diff --git a/requirements-saml.txt b/requirements-saml.txt
new file mode 100644
index 0000000000..7224ceb46c
--- /dev/null
+++ b/requirements-saml.txt
@@ -0,0 +1 @@
+python3-saml>=1.2.6,<1.3
diff --git a/requirements-test.txt b/requirements-test.txt
new file mode 100644
index 0000000000..34d336784c
--- /dev/null
+++ b/requirements-test.txt
@@ -0,0 +1,14 @@
+# cassandra
+blist
+# TODO(dcramer): figure out why Travis needs this
+cassandra-driver<=3.5.0
+casscache
+cqlsh
+# /cassandra
+datadog
+msgpack-python<0.5.0
+pytest-cov>=2.5.1,<2.6.0
+pytest-timeout>=0.5.0,<0.6.0
+pytest-xdist>=1.18.0,<1.19.0
+# responses 0.6.2 has a bug that causes our tests to fail.
+responses<0.6.2
diff --git a/setup.py b/setup.py
index 022f5122e9..20d7c14364 100755
--- a/setup.py
+++ b/setup.py
@@ -62,95 +62,17 @@ for m in ('multiprocessing', 'billiard'):
 
 IS_LIGHT_BUILD = os.environ.get('SENTRY_LIGHT_BUILD') == '1'
 
-dev_requires = [
-    'autopep8',
-    'Babel',
-    'flake8>=2.6,<2.7',
-    'pycodestyle>=2.0,<2.1',
-    'isort>=4.2.2,<4.3.0',
-]
-
-tests_require = [
-    # cassandra
-    'blist',
-    # TODO(dcramer): figure out why Travis needs this
-    'cassandra-driver<=3.5.0',
-    'casscache',
-    'cqlsh',
-    # /cassandra
-    'datadog',
-    'msgpack-python<0.5.0',
-    'pytest-cov>=2.5.1,<2.6.0',
-    'pytest-timeout>=0.5.0,<0.6.0',
-    'pytest-xdist>=1.18.0,<1.19.0',
-    'responses<0.6.2',  # 0.6.2 has a bug that causes our tests to fail.
-]
-
-
-install_requires = [
-    'botocore<1.5.71',
-    'boto3>=1.4.1,<1.4.6',
-    'celery>=3.1.8,<3.1.19',
-    'click>=5.0,<7.0',
-    # 'cryptography>=1.3,<1.4',
-    'cssutils>=0.9.9,<0.10.0',
-    'Django>=1.6.0,<1.7',
-    'django-crispy-forms>=1.4.0,<1.5.0',
-    'django-jsonfield>=0.9.13,<0.9.14',
-    'django-picklefield>=0.3.0,<0.4.0',
-    'django-sudo>=2.1.0,<3.0.0',
-    'django-templatetag-sugar>=0.1.0',
-    'djangorestframework>=2.4.8,<2.5.0',
-    'email-reply-parser>=0.2.0,<0.3.0',
-    'enum34>=0.9.18,<1.2.0',
-    'exam>=0.5.1',
-    # broken on python3
-    'hiredis>=0.1.0,<0.2.0',
-    'honcho>=0.7.0,<0.8.0',
-    'kombu==3.0.35',
-    'ipaddress>=1.0.16,<1.1.0',
-    'libsourcemap>=0.7.2,<0.8.0',
-    'loremipsum>=1.0.5,<1.1.0',
-    'lxml>=3.4.1',
-    'mock>=0.8.0,<1.1',
-    'mmh3>=2.3.1,<2.4',
-    'oauth2>=1.5.167',
-    'percy>=0.4.5',
-    'petname>=2.0,<2.1',
-    'Pillow>=3.2.0,<3.3.0',
-    'progressbar2>=3.10,<3.11',
-    'psycopg2>=2.6.0,<2.7.0',
-    'pytest>=3.1.2,<3.2.0',
-    'pytest-django>=2.9.1,<2.10.0',
-    'pytest-html>=1.9.0,<1.10.0',
-    'python-dateutil>=2.0.0,<3.0.0',
-    'python-memcached>=1.53,<2.0.0',
-    'python-openid>=2.2',
-    'PyYAML>=3.11,<3.12',
-    'raven>=5.29.0,<6.0.0',
-    'redis>=2.10.3,<2.10.6',
-    'requests[security]>=2.9.1,<2.13.0',
-    'selenium==3.4.3',
-    'simplejson>=3.2.0,<3.9.0',
-    'six>=1.10.0,<1.11.0',
-    'setproctitle>=1.1.7,<1.2.0',
-    'statsd>=3.1.0,<3.2.0',
-    'structlog==16.1.0',
-    'sqlparse>=0.1.16,<0.2.0',
-    'symsynd>=3.0.0,<4.0.0',
-    'toronado>=0.0.11,<0.1.0',
-    'ua-parser>=0.6.1,<0.8.0',
-    'urllib3>=1.14,<1.17',
-    'uwsgi>2.0.0,<2.1.0',
-    'rb>=1.7.0,<2.0.0',
-    'qrcode>=5.2.2,<6.0.0',
-    'python-u2flib-server>=4.0.1,<4.1.0',
-    'redis-py-cluster>=1.3.4,<1.4.0',
-]
-
-saml_requires = [
-    'python3-saml>=1.2.6,<1.3',
-]
+
+# we use pip requirements files to improve Docker layer caching
+def get_requirements(env):
+    with open('requirements-{}.txt'.format(env)) as fp:
+        return [x.strip() for x in fp.read().split('\n') if not x.startswith('#')]
+
+
+install_requires = get_requirements('base')
+dev_requires = get_requirements('dev')
+saml_requires = get_requirements('saml')
+tests_require = get_requirements('test')
 
 
 class SentrySDistCommand(SDistCommand):
@@ -162,7 +84,6 @@ class SentrySDistCommand(SDistCommand):
 
 
 class SentryBuildCommand(BuildCommand):
-
     def run(self):
         BuildCommand.run(self)
         if not IS_LIGHT_BUILD:
@@ -171,7 +92,6 @@ class SentryBuildCommand(BuildCommand):
 
 
 class SentryDevelopCommand(DevelopCommand):
-
     def run(self):
         DevelopCommand.run(self)
         if not IS_LIGHT_BUILD:
