commit 7ded22e5f0a8065c07530a8ab6fab1a8c1a387e1
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Feb 11 15:54:20 2016 -0800

    Add sdist script

diff --git a/scripts/Dockerfile b/scripts/Dockerfile
new file mode 100644
index 0000000000..69f153ba3a
--- /dev/null
+++ b/scripts/Dockerfile
@@ -0,0 +1,48 @@
+FROM python:2.7.11-slim
+
+RUN apt-get update && apt-get install -y --no-install-recommends \
+        curl \
+        gcc \
+        git \
+        libffi-dev \
+        libpq-dev \
+        libxml2-dev \
+        libxslt-dev \
+        libyaml-dev \
+    && rm -rf /var/lib/apt/lists/*
+
+# Sane defaults for pip
+ENV PIP_NO_CACHE_DIR off
+ENV PIP_DISABLE_PIP_VERSION_CHECK on
+
+# gpg keys listed at https://github.com/nodejs/node
+RUN set -ex \
+  && for key in \
+    9554F04D7259F04124DE6B476D5A82AC7E37093B \
+    94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \
+    0034A06D9D9B0064CE8ADF6BF1747F4AD2306D93 \
+    FD3A5288F042B6850C66B31F09FE44734EB7990E \
+    71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \
+    DD8F2338BAE7501E3DD5AC78C273792F7D83545D \
+    B9AE9905FFD7803F25714661B63B535A4C206CA9 \
+    C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \
+  ; do \
+    gpg --keyserver ha.pool.sks-keyservers.net --recv-keys "$key"; \
+  done
+
+ENV NODE_VERSION 0.12.9
+ENV NPM_VERSION 2.14.17
+
+RUN curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.gz" \
+    && curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc" \
+    && gpg --verify SHASUMS256.txt.asc \
+    && grep " node-v$NODE_VERSION-linux-x64.tar.gz\$" SHASUMS256.txt.asc | sha256sum -c - \
+    && tar -xzf "node-v$NODE_VERSION-linux-x64.tar.gz" -C /usr/local --strip-components=1 \
+    && rm "node-v$NODE_VERSION-linux-x64.tar.gz" SHASUMS256.txt.asc \
+    && npm install -g "npm@${NPM_VERSION}" \
+    && npm cache clear
+
+WORKDIR /usr/src/sentry
+
+CMD python setup.py sdist bdist_wheel \
+    && mv dist/* /dist/
diff --git a/scripts/sdist b/scripts/sdist
new file mode 100755
index 0000000000..686880fa6b
--- /dev/null
+++ b/scripts/sdist
@@ -0,0 +1,9 @@
+#!/bin/bash
+set -ex
+
+ARTIFACTS_PATH=${ARTIFACTS_PATH:-dist}
+CLONE_PATH=${CLONE_PATH:-${PWD}}
+COMMIT=${COMMIT:-UNKNOWN}
+
+docker build --rm -t sentry-release -f scripts/Dockerfile .
+docker run --rm -v ${ARTIFACTS_PATH}:/dist -v ${CLONE_PATH}:/usr/src/sentry -e SENTRY_BUILD=${COMMIT} sentry-release
diff --git a/src/sentry/__init__.py b/src/sentry/__init__.py
index 5d03559737..e44dbeb655 100644
--- a/src/sentry/__init__.py
+++ b/src/sentry/__init__.py
@@ -33,6 +33,8 @@ def get_revision():
     :returns: Revision number of this branch/checkout, if available. None if
         no revision number can be determined.
     """
+    if 'SENTRY_BUILD' in os.environ:
+        return os.environ['SENTRY_BUILD']
     package_dir = os.path.dirname(__file__)
     checkout_dir = os.path.normpath(os.path.join(package_dir, os.pardir, os.pardir))
     path = os.path.join(checkout_dir, '.git')
