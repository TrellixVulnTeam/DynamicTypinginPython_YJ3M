commit f3ee59c60f0ea1a5f5204e7303c4793b8c41d3dc
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Mon Apr 23 10:30:04 2018 -0700

    fix(ui): Fix Issue Diff when no stacktrace for event (APP-114) (#8099)

diff --git a/.storybook/config.js b/.storybook/config.js
index dd202e7400..1be7dd1753 100644
--- a/.storybook/config.js
+++ b/.storybook/config.js
@@ -1,6 +1,7 @@
 import React from 'react';
-import {configure, setAddon, addDecorator} from '@storybook/react';
 import {ThemeProvider} from 'emotion-theming';
+import {configure, setAddon, getStorybook, addDecorator} from '@storybook/react';
+import createPercyAddon from '@percy-io/percy-storybook';
 import infoAddon, {setDefaults} from '@storybook/addon-info';
 import {withKnobs} from '@storybook/addon-knobs';
 import theme from '../src/sentry/static/sentry/app/utils/theme';
@@ -8,6 +9,9 @@ import './storybook.less';
 
 const withTheme = storyFn => <ThemeProvider theme={theme}>{storyFn()}</ThemeProvider>;
 
+const {percyAddon, serializeStories} = createPercyAddon();
+setAddon(percyAddon);
+
 setDefaults({
   inline: true,
   header: false,
@@ -26,6 +30,4 @@ configure(function() {
   req.keys().forEach(filename => req(filename));
 }, module);
 
-// For percy integration
-if (typeof window === 'object')
-  window.__storybook_stories__ = require('@storybook/react').getStorybook();
+serializeStories(getStorybook);
diff --git a/package.json b/package.json
index a38314a738..4189ed09a5 100644
--- a/package.json
+++ b/package.json
@@ -141,7 +141,7 @@
     ]
   },
   "devDependencies": {
-    "@percy-io/react-percy-storybook": "^1.1.5",
+    "@percy-io/percy-storybook": "^1.3.3",
     "@storybook/addon-actions": "^3.2.17",
     "@storybook/addon-info": "^3.2.17",
     "@storybook/addon-knobs": "^3.2.17",
diff --git a/requirements-base.txt b/requirements-base.txt
index 43e69e74ba..97298148c6 100644
--- a/requirements-base.txt
+++ b/requirements-base.txt
@@ -28,7 +28,7 @@ mock>=0.8.0,<1.1
 mmh3>=2.3.1,<2.4
 oauth2>=1.5.167
 parsimonious==0.8.0
-percy>=0.4.5
+percy>=1.1.2
 petname>=2.0,<2.1
 Pillow>=3.2.0,<=4.2.1
 progressbar2>=3.10,<3.11
diff --git a/src/sentry/static/sentry/app/components/issueDiff.jsx b/src/sentry/static/sentry/app/components/issueDiff.jsx
index 1eeebe7909..1145f581a4 100644
--- a/src/sentry/static/sentry/app/components/issueDiff.jsx
+++ b/src/sentry/static/sentry/app/components/issueDiff.jsx
@@ -83,6 +83,7 @@ class IssueDiff extends React.Component {
     if (!exc || !exc.data) return [];
 
     return exc.data.values
+      .filter(value => !!value.stacktrace)
       .map(value => rawStacktraceContent(value.stacktrace, event.platform, value))
       .reduce((acc, value) => {
         return acc.concat(value);
diff --git a/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap b/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
index 9821c3d71f..ce9747f75c 100644
--- a/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/issueDiff.spec.jsx.snap
@@ -12,7 +12,7 @@ exports[`IssueDiff can dynamically import SplitDiff 1`] = `
     loading={false}
   >
     <div
-      className="css-no1ym5-IssueDiffWrapper css-dlc86z0"
+      className="css-no1ym5-IssueDiffWrapper css-18w0het0"
     >
       <SplitDiff
         base="SyntaxError: Unexpected token else
diff --git a/yarn.lock b/yarn.lock
index bdae11c9c7..5d8ca7bb95 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -29,29 +29,30 @@
   version "3.0.9"
   resolved "https://registry.yarnpkg.com/@hypnosphi/fuse.js/-/fuse.js-3.0.9.tgz#ea99f6121b4a8f065b4c71f85595db2714498807"
 
-"@percy-io/react-percy-api-client@^0.2.0":
-  version "0.2.5"
-  resolved "https://registry.yarnpkg.com/@percy-io/react-percy-api-client/-/react-percy-api-client-0.2.5.tgz#c98974d8c1bc53e2ae38c1549b0ec967fdde628f"
+"@percy-io/percy-storybook@^1.3.3":
+  version "1.3.3"
+  resolved "https://registry.yarnpkg.com/@percy-io/percy-storybook/-/percy-storybook-1.3.3.tgz#f2972e072f03b60b128bef600c00a8cc71a5c829"
   dependencies:
+    "@percy-io/react-percy-api-client" "^0.3.0"
     babel-runtime "^6.26.0"
     debug "^2.6.3"
-    es6-promise-pool "^2.4.4"
-    mime-types "^2.1.14"
-    percy-client "^2.1.0"
-    slugify "^1.1.0"
-
-"@percy-io/react-percy-storybook@^1.1.5":
-  version "1.1.5"
-  resolved "https://registry.yarnpkg.com/@percy-io/react-percy-storybook/-/react-percy-storybook-1.1.5.tgz#80e138afe01441aaafa8dfdd59ead8b0329b9ca7"
-  dependencies:
-    "@percy-io/react-percy-api-client" "^0.2.0"
-    debug "^2.6.3"
     es6-error "^4.0.2"
     es6-promise-pool "^2.4.4"
     jsdom "^9.12.0"
     walk "^2.3.9"
     yargs "^7.0.2"
 
+"@percy-io/react-percy-api-client@^0.3.0":
+  version "0.3.0"
+  resolved "https://registry.yarnpkg.com/@percy-io/react-percy-api-client/-/react-percy-api-client-0.3.0.tgz#e28141b4afc418508e866e51aed22fec96333c4b"
+  dependencies:
+    babel-runtime "^6.26.0"
+    debug "^2.6.3"
+    es6-promise-pool "^2.4.4"
+    mime-types "^2.1.14"
+    percy-client "^2.3.0"
+    slugify "^1.1.0"
+
 "@storybook/addon-actions@^3.2.17":
   version "3.2.17"
   resolved "https://registry.yarnpkg.com/@storybook/addon-actions/-/addon-actions-3.2.17.tgz#e85d38f743125157fdaf6669708e089bc2008e50"
@@ -6682,9 +6683,9 @@ pbkdf2@^3.0.3:
     safe-buffer "^5.0.1"
     sha.js "^2.4.8"
 
-percy-client@^2.1.0:
-  version "2.5.0"
-  resolved "https://registry.yarnpkg.com/percy-client/-/percy-client-2.5.0.tgz#54f981a827013c7d7a9e9fdb289ec9671f0f8bea"
+percy-client@^2.3.0:
+  version "2.8.1"
+  resolved "https://registry.yarnpkg.com/percy-client/-/percy-client-2.8.1.tgz#938a59dac672a9adab6caa994edefde0dfa3130f"
   dependencies:
     base64-js "^1.1.2"
     bluebird "^3.5.1"
