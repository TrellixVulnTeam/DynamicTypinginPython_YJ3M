commit c8f82da1b1563a31aa2f1084a516561950cdb305
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Tue Jul 24 11:04:38 2018 -0700

    feat(discover): Use react-virtualized for rendering table of results (#9165)
    
    Current table implementation (no library) is causing the browser to crash when handling > ~1000 table cells.

diff --git a/package.json b/package.json
index 11a82aac90..a3047e6638 100644
--- a/package.json
+++ b/package.json
@@ -77,6 +77,7 @@
     "react-router": "3.2.0",
     "react-select": "^1.2.1",
     "react-sparklines": "1.7.0",
+    "react-virtualized": "^9.20.1",
     "reflux": "0.4.1",
     "scroll-to-element": "^2.0.0",
     "sprintf-js": "1.0.3",
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
index d0bca2f2cd..e96e364861 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/result/table.jsx
@@ -1,4 +1,5 @@
 import React from 'react';
+import {MultiGrid} from 'react-virtualized';
 import PropTypes from 'prop-types';
 import styled from 'react-emotion';
 import {Box} from 'grid-emotion';
@@ -15,30 +16,36 @@ export default class Result extends React.Component {
     result: PropTypes.object.isRequired,
   };
 
+  cellRenderer = ({key, rowIndex, columnIndex, style}) => {
+    const {meta, data} = this.props.result;
+
+    const colName = meta[columnIndex].name;
+
+    return (
+      <Cell key={key} style={style}>
+        {rowIndex === 0 ? (
+          <strong>{colName}</strong>
+        ) : (
+          <AutoSelectText>{getDisplayValue(data[rowIndex - 1][colName])}</AutoSelectText>
+        )}
+      </Cell>
+    );
+  };
+
   renderTable() {
     const {meta, data} = this.props.result;
 
     return (
-      <StyledTable className="table table-bordered table-hover">
-        <thead>
-          <tr>{meta.map(({name}, idx) => <th key={idx}>{name}</th>)}</tr>
-        </thead>
-        <tbody>
-          {data.map((row, rowIdx) => {
-            return (
-              <tr key={rowIdx}>
-                {meta.map((val, colIdx) => (
-                  <td key={colIdx}>
-                    <AutoSelectText>
-                      {getDisplayValue(row[meta[colIdx].name])}
-                    </AutoSelectText>
-                  </td>
-                ))}
-              </tr>
-            );
-          })}
-        </tbody>
-      </StyledTable>
+      <MultiGrid
+        width={800}
+        height={300}
+        rowCount={data.length + 1} // Add 1 for header row
+        columnCount={meta.length}
+        fixedRowCount={1}
+        rowHeight={30}
+        columnWidth={100}
+        cellRenderer={this.cellRenderer}
+      />
     );
   }
 
@@ -50,7 +57,7 @@ export default class Result extends React.Component {
     }
 
     return (
-      <div style={{overflowX: 'scroll'}}>
+      <div>
         <Summary mb={1}>
           snuba query time: {timing.duration_ms}ms, {data.length} rows
         </Summary>
@@ -60,16 +67,12 @@ export default class Result extends React.Component {
   }
 }
 
-const Summary = styled(Box)`
-  font-size: 12px;
+const Cell = styled('div')`
+  overflow: scroll;
+  font-size: 14px;
+  padding: 1px;
 `;
 
-const StyledTable = styled.table`
-  font-size: 14px;
-  tbody > tr > td,
-  thead > tr > th {
-    padding: 8px;
-    max-width: 100px;
-    overflow: scroll;
-  }
+const Summary = styled(Box)`
+  font-size: 12px;
 `;
diff --git a/yarn.lock b/yarn.lock
index 39f4b87ac1..88da117d68 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -2466,6 +2466,10 @@ classnames@2.2.0:
   version "2.2.0"
   resolved "https://registry.yarnpkg.com/classnames/-/classnames-2.2.0.tgz#8f61df81f356c45d18a31d83fde4dfb194ea8722"
 
+classnames@^2.2.3:
+  version "2.2.6"
+  resolved "https://registry.yarnpkg.com/classnames/-/classnames-2.2.6.tgz#43935bffdd291f326dad0a205309b38d00f650ce"
+
 classnames@^2.2.4, classnames@^2.2.5:
   version "2.2.5"
   resolved "https://registry.yarnpkg.com/classnames/-/classnames-2.2.5.tgz#fb3801d453467649ef3603c7d61a02bd129bde6d"
@@ -3331,14 +3335,14 @@ doctrine@^2.0.0:
   dependencies:
     esutils "^2.0.2"
 
+"dom-helpers@^2.4.0 || ^3.0.0", dom-helpers@^3.2.1:
+  version "3.3.1"
+  resolved "https://registry.yarnpkg.com/dom-helpers/-/dom-helpers-3.3.1.tgz#fc1a4e15ffdf60ddde03a480a9c0fece821dd4a6"
+
 dom-helpers@^3.2.0:
   version "3.2.1"
   resolved "https://registry.yarnpkg.com/dom-helpers/-/dom-helpers-3.2.1.tgz#3203e07fed217bd1f424b019735582fc37b2825a"
 
-dom-helpers@^3.2.1:
-  version "3.3.1"
-  resolved "https://registry.yarnpkg.com/dom-helpers/-/dom-helpers-3.3.1.tgz#fc1a4e15ffdf60ddde03a480a9c0fece821dd4a6"
-
 dom-serializer@0, dom-serializer@~0.1.0:
   version "0.1.0"
   resolved "https://registry.yarnpkg.com/dom-serializer/-/dom-serializer-0.1.0.tgz#073c697546ce0780ce23be4a28e293e40bc30c82"
@@ -5779,6 +5783,10 @@ js-tokens@^3.0.0, js-tokens@^3.0.2:
   version "3.0.2"
   resolved "https://registry.yarnpkg.com/js-tokens/-/js-tokens-3.0.2.tgz#9866df395102130e38f7f996bceb65443209c25b"
 
+"js-tokens@^3.0.0 || ^4.0.0":
+  version "4.0.0"
+  resolved "https://registry.yarnpkg.com/js-tokens/-/js-tokens-4.0.0.tgz#19203fb59991df98e3a287050d4647cdeaf32499"
+
 js-yaml@^3.4.3, js-yaml@^3.7.0, js-yaml@^3.9.0, js-yaml@^3.9.1, js-yaml@~3.10.0:
   version "3.10.0"
   resolved "https://registry.yarnpkg.com/js-yaml/-/js-yaml-3.10.0.tgz#2e78441646bd4682e963f22b6e92823c309c62dc"
@@ -6280,6 +6288,12 @@ loose-envify@^1.0.0, loose-envify@^1.1.0, loose-envify@^1.2.0, loose-envify@^1.3
   dependencies:
     js-tokens "^3.0.0"
 
+loose-envify@^1.3.0:
+  version "1.4.0"
+  resolved "https://registry.yarnpkg.com/loose-envify/-/loose-envify-1.4.0.tgz#71ee51fa7be4caec1a63839f7e682d8132d30caf"
+  dependencies:
+    js-tokens "^3.0.0 || ^4.0.0"
+
 loud-rejection@^1.0.0:
   version "1.6.0"
   resolved "https://registry.yarnpkg.com/loud-rejection/-/loud-rejection-1.6.0.tgz#5b46f80147edee578870f086d04821cf998e551f"
@@ -8169,6 +8183,10 @@ react-lazyload@^2.3.0:
   version "2.3.0"
   resolved "https://registry.yarnpkg.com/react-lazyload/-/react-lazyload-2.3.0.tgz#ccb134223012447074a96543954f44b055dc6185"
 
+react-lifecycles-compat@^3.0.4:
+  version "3.0.4"
+  resolved "https://registry.yarnpkg.com/react-lifecycles-compat/-/react-lifecycles-compat-3.0.4.tgz#4f1a273afdfc8f3488a8c516bfda78f872352362"
+
 react-mentions@^1.2.0:
   version "1.2.2"
   resolved "https://registry.yarnpkg.com/react-mentions/-/react-mentions-1.2.2.tgz#db09e5ec84f3cf40d5a56bbc9fcc0f81c4c8c60b"
@@ -8326,6 +8344,17 @@ react-treebeard@^2.0.3:
     shallowequal "^0.2.2"
     velocity-react "^1.3.1"
 
+react-virtualized@^9.20.1:
+  version "9.20.1"
+  resolved "https://registry.yarnpkg.com/react-virtualized/-/react-virtualized-9.20.1.tgz#02dc08fe9070386b8c48e2ac56bce7af0208d22d"
+  dependencies:
+    babel-runtime "^6.26.0"
+    classnames "^2.2.3"
+    dom-helpers "^2.4.0 || ^3.0.0"
+    loose-envify "^1.3.0"
+    prop-types "^15.6.0"
+    react-lifecycles-compat "^3.0.4"
+
 react@16.3.2:
   version "16.3.2"
   resolved "https://registry.yarnpkg.com/react/-/react-16.3.2.tgz#fdc8420398533a1e58872f59091b272ce2f91ea9"
