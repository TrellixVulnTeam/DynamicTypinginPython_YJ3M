commit 29f0ef03a8f4e9d82ccc108990721b0fc4e58727
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Nov 3 12:42:47 2011 -0700

    Added raw traceback view

diff --git a/sentry/models.py b/sentry/models.py
index 0a65bbdbf0..1a2d75e6e5 100644
--- a/sentry/models.py
+++ b/sentry/models.py
@@ -103,6 +103,37 @@ class MessageBase(Model):
     shortened_traceback.short_description = _('traceback')
     shortened_traceback.admin_order_field = 'traceback'
 
+    def get_traceback(self):
+        if self.traceback:
+            return self.traceback
+
+        data = self.data
+        if '__sentry__' not in data:
+            return
+
+        sentry_data = data['__sentry__']
+
+        if 'exc' in sentry_data:
+            module, args, frames = sentry_data['exc']
+        elif 'exception' in sentry_data:
+            (module, args), frames = sentry_data['exception'], sentry_data.get('frames')
+        else:
+            module, args, frames = None, None, sentry_data.get('frames')
+
+        if not frames:
+            return
+
+        result = ['Traceback (most recent call last):', '']
+        for frame in sentry_data['frames']:
+            result.append('  File "%(filename)s", line %(lineno)s, in %(function)s' % frame)
+            result.append('    %s' % frame['context_line'].strip())
+            result.append('')
+
+        if module and args:
+            result.append('%(class_name)s: %(message)s' % dict(class_name=self.class_name, message=self.message))
+
+        return '\n'.join(result)
+
     def error(self):
         if self.message:
             message = smart_unicode(self.message)
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index b157469223..16acdd65c0 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -108,6 +108,7 @@ pre {
 .module {
     margin-bottom: 10px;
     overflow: auto;
+    position: relative;
 }
 .module h2 {
     color: #fff;
@@ -123,6 +124,12 @@ pre {
     background: -webkit-gradient(linear, left top, left bottom, from(#4da2e5), to(#3079d0)); /* for webkit browsers */
     background: -moz-linear-gradient(top,  #4da2e5,  #3079d0); /* for firefox 3.6+ */
 }
+.module h2 span {
+    margin-left: 5px;
+    font-size: 0.8em;
+    color: #eee;
+}
+.module h2 span a { color: inherit; }
 .module-content {
     -moz-box-shadow: inset 0 0 1px #22579b, 0 1px 0 #fff;
     -webkit-box-shadow: inset 0 0 1px #22579b, 0 1px 0 #fff;
@@ -762,3 +769,9 @@ h2 .morelink { text-decoration: none; }
 table.inline tr {
     display: inline-block;
 }
+
+#popup {
+    background: #fff;
+    padding: 10px;
+    margin: 10px;
+}
\ No newline at end of file
diff --git a/sentry/templates/sentry/group/details.html b/sentry/templates/sentry/group/details.html
index 1e9bbc7605..8e5161c828 100644
--- a/sentry/templates/sentry/group/details.html
+++ b/sentry/templates/sentry/group/details.html
@@ -139,7 +139,7 @@
 
             {% if frames %}
                 <div id="traceback" class="module">
-                    <h2>Traceback</h2>
+                    <h2>Traceback <span><a href="javascript:void(0)" class="popup" data-container="#raw_traceback">Raw Traceback</a></span></h2>
                     <div class="module-content">
                         {% autoescape off %}
                         <div id="browserTraceback">
@@ -273,7 +273,22 @@
             </div>
         </div>
     {% endblock %}
+    <div id="raw_traceback" style="display: none;">
+        {% if frames or message.traceback %}
+            <pre>{{ message.get_traceback }}</pre>
+        {% endif %}
+    </div>
     <script type="text/javascript">
+    $('.popup').click(function(){
+        var $this = $(this);
+        var $window = $(window);
+        var $container = $($this.attr('data-container'));
+        var content = $container.html();
+        var height = Math.min($window.height() - 100, $container.height() + 40);
+        var width = Math.min($window.width() - 100, $container.width() + 40);
+        var w = window.open("about:blank", "dsqApiExpand", "toolbar=0,status=0,location=0,menubar=0,height=" + height + ",width=" + width);
+        w.document.write("<!DOCTYPE html><html><title>Traceback</title><head><link href=\"{% url sentry-media "styles/global.css" %}\" rel=\"stylesheet\" type=\"text/css\"/></head><body><div id=\"popup\">" + content + "</div></body></html>");
+    });
     $(document).ready(function() {
         if (!$('#chart').length) return;
 
diff --git a/sentry/web/views.py b/sentry/web/views.py
index 5169f5a85d..b77925352d 100644
--- a/sentry/web/views.py
+++ b/sentry/web/views.py
@@ -401,6 +401,7 @@ def group(request, group_id):
     return render_to_response('sentry/group/details.html', {
         'page': 'details',
         'group': group,
+        'message': obj,
         'json_data': iter_data(obj),
         'user_data': user_data,
         'version_data': version_data,
