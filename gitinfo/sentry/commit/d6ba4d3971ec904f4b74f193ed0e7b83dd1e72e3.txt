commit d6ba4d3971ec904f4b74f193ed0e7b83dd1e72e3
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Wed Feb 20 22:33:25 2019 +0100

    feat: Added better virtualenv config (#12110)

diff --git a/.vscode/settings.json b/.vscode/settings.json
index 3ab42ddd62..52b3e0797e 100644
--- a/.vscode/settings.json
+++ b/.vscode/settings.json
@@ -46,7 +46,7 @@
   "python.formatting.provider": "autopep8",
   "python.formatting.autopep8Args": ["--global-config", "${workspaceRoot}/setup.cfg"],
   // https://github.com/DonJayamanne/pythonVSCode/issues/992
-  "python.pythonPath": "/usr/local/opt/python@2/bin/python2.7",
+  "python.pythonPath": ".venv/bin/python",
   // test discovery is sluggish and the UI around running
   // tests is often in your way and misclicked
   "python.unitTest.pyTestEnabled": false,
diff --git a/Makefile b/Makefile
index 44bb91f8c1..7d216924a4 100644
--- a/Makefile
+++ b/Makefile
@@ -11,10 +11,13 @@ PIP = LDFLAGS="$(LDFLAGS)" pip
 WEBPACK = NODE_ENV=production ./node_modules/.bin/webpack
 YARN_VERSION = 1.13.0
 
-develop: setup-git develop-only
+develop: setup-git ensure-venv develop-only
 develop-only: update-submodules install-system-pkgs install-yarn-pkgs install-sentry-dev
 test: develop lint test-js test-python test-cli
 
+ensure-venv:
+	@./scripts/ensure-venv.sh
+
 build: locale
 
 reset-db:
diff --git a/scripts/ensure-venv.sh b/scripts/ensure-venv.sh
new file mode 100755
index 0000000000..2a9f9effa3
--- /dev/null
+++ b/scripts/ensure-venv.sh
@@ -0,0 +1,16 @@
+#!/bin/bash
+set -xe
+
+# if we already have a venv, we can leave
+if .venv/bin/python --version &> /dev/null; then
+  exit 0
+fi
+
+# do we have a WORKON_HOME? Prime from there
+if [ "x$WORKON_HOME" != x ]; then
+  ln -s "${WORKON_HOME}/sentry" .venv
+  exit 0
+fi
+
+# otherwise make a new virtualenv from scratch
+virtualenv -ppython2.7 .venv
