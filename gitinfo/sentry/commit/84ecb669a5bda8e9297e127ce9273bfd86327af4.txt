commit 84ecb669a5bda8e9297e127ce9273bfd86327af4
Author: Alex Hofsteede <alex@hofsteede.com>
Date:   Mon Nov 12 16:36:06 2018 -0800

    fix: keys can be a set (#10545)

diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index e7c7c0a705..1f94e4be98 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -254,7 +254,7 @@ def raw_query(start, end, groupby=None, conditions=None, filter_keys=None,
 
     if 'project_id' in filter_keys:
         # If we are given a set of project ids, use those directly.
-        project_ids = filter_keys['project_id']
+        project_ids = list(set(filter_keys['project_id']))
     elif filter_keys:
         # Otherwise infer the project_ids from any related models
         with timer('get_related_project_ids'):
@@ -265,7 +265,7 @@ def raw_query(start, end, groupby=None, conditions=None, filter_keys=None,
 
     for col, keys in six.iteritems(forward(filter_keys.copy())):
         if keys:
-            if len(keys) == 1 and keys[0] is None:
+            if len(keys) == 1 and None in keys:
                 conditions.append((col, 'IS NULL', None))
             else:
                 conditions.append((col, 'IN', keys))
diff --git a/tests/snuba/test_util.py b/tests/snuba/test_util.py
index 7e4e128ff0..7f33cb7852 100644
--- a/tests/snuba/test_util.py
+++ b/tests/snuba/test_util.py
@@ -47,6 +47,19 @@ class SnubaUtilTest(TestCase):
         ]
         assert set(snuba.all_referenced_columns(conditions)) == set(['a', 'b', 'c', 'd'])
 
+    def test_filter_keys_set(self):
+        snuba.raw_query(
+            start=datetime.now(),
+            end=datetime.now(),
+            filter_keys={
+                'project_id': set([1]),
+                'logger': set(['asdf']),
+            },
+            aggregations=[
+                ['count()', '', 'count'],
+            ],
+        )
+
     def test_shrink_timeframe(self):
         now = datetime.now()
         year_ago = now - timedelta(days=365)
