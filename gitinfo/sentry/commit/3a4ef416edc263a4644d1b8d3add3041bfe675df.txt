commit 3a4ef416edc263a4644d1b8d3add3041bfe675df
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 20 11:37:47 2017 -0800

    [avatars] fix avatars in security emails

diff --git a/src/sentry/templates/sentry/emails/security_base.html b/src/sentry/templates/sentry/emails/security_base.html
index fdaca8d7b2..3735238016 100644
--- a/src/sentry/templates/sentry/emails/security_base.html
+++ b/src/sentry/templates/sentry/emails/security_base.html
@@ -10,7 +10,7 @@
   <table>
     <tr>
       <td style="width:36px;vertical-align:top;padding-right:15px;">
-        {% avatar account 36 %}
+        {% avatar_for_email account 36 %}
       </td>
       <td>
         <strong>{{ account.email }}</strong><br />
diff --git a/src/sentry/templates/sentry/partial/avatar.html b/src/sentry/templates/sentry/partial/avatar.html
index 9bd36c7a8b..118e9a0d6c 100644
--- a/src/sentry/templates/sentry/partial/avatar.html
+++ b/src/sentry/templates/sentry/partial/avatar.html
@@ -1,9 +1,14 @@
 {% load sentry_avatars %}
 <span class="avatar">
-  {% letter_avatar_svg display_name label %}
-  {% if avatar_type == 'upload' %}
+  {% if avatar_type == 'letter_avatar' %}
+    {% if for_email %}
+      {% email_avatar display_name label size size try_gravatar False %}
+    {% else %}
+      {% letter_avatar_svg display_name label size size %}
+    {% endif %}
+  {% elif avatar_type == 'upload' %}
     <img src="{% profile_photo_url user_id size size %}">
-  {% elif avatar_type == 'gravatar' %}
+  {% else %}
     <img src="{% gravatar_url email size size default 'blank' %}">
   {% endif %}
 </span>
diff --git a/src/sentry/templatetags/sentry_avatars.py b/src/sentry/templatetags/sentry_avatars.py
index 6b4d79fb4d..a3505cbf07 100644
--- a/src/sentry/templatetags/sentry_avatars.py
+++ b/src/sentry/templatetags/sentry_avatars.py
@@ -66,3 +66,16 @@ def avatar(user, size=36):
         'display_name': user.get_display_name(),
         'label': user.get_label(),
     }
+
+
+@register.inclusion_tag('sentry/partial/avatar.html')
+def avatar_for_email(user, size=36):
+    return {
+        'for_email': True,
+        'email': user.email,
+        'user_id': user.id,
+        'size': size,
+        'avatar_type': user.get_avatar_type(),
+        'display_name': user.get_display_name(),
+        'label': user.get_label(),
+    }
