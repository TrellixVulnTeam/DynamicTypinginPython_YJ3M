commit 7f8efc1ce524296f7ed7d49fce34c874d907c4a0
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 12 18:51:52 2013 -0800

    Add min events to alert thresholds

diff --git a/src/sentry/conf/defaults.py b/src/sentry/conf/defaults.py
index 178f97f77f..90f340f29f 100644
--- a/src/sentry/conf/defaults.py
+++ b/src/sentry/conf/defaults.py
@@ -181,5 +181,5 @@ AUTH_PROVIDERS = {
 
 
 # Default alerting threshold values
-DEFAULT_ALERT_PROJECT_THRESHOLD = 300  # 300%
-DEFAULT_ALERT_GROUP_THRESHOLD = 1000  # 1000%
+DEFAULT_ALERT_PROJECT_THRESHOLD = (300, 100)  # 300%, 100 events
+DEFAULT_ALERT_GROUP_THRESHOLD = (1000, 100)  # 1000%, 100 events
diff --git a/src/sentry/tasks/check_alerts.py b/src/sentry/tasks/check_alerts.py
index a56f7365bb..7a38b7e8cd 100644
--- a/src/sentry/tasks/check_alerts.py
+++ b/src/sentry/tasks/check_alerts.py
@@ -83,11 +83,14 @@ def check_project_alerts(project_id, when, count, **kwargs):
     from sentry.models import ProjectCountByMinute, ProjectOption, Alert
 
     try:
-        threshold = ProjectOption.objects.get(project=project_id, key='project_alert_pct')
+        threshold, min_events = ProjectOption.objects.get(project=project_id, key='project_alert_pct')
     except ProjectOption.DoesNotExist:
-        threshold = settings.DEFAULT_ALERT_PROJECT_THRESHOLD
+        threshold, min_events = settings.DEFAULT_ALERT_PROJECT_THRESHOLD
 
-    if not threshold:
+    if not threshold and min_events:
+        return
+
+    if min_events > count:
         return
 
     # number of 15 minute intervals to capture
diff --git a/tests/sentry/tasks/check_alerts/tests.py b/tests/sentry/tasks/check_alerts/tests.py
index db88dcf52f..a19db576a9 100644
--- a/tests/sentry/tasks/check_alerts/tests.py
+++ b/tests/sentry/tasks/check_alerts/tests.py
@@ -65,7 +65,7 @@ class CheckProjectAlertsTest(TestCase):
         check_project_alerts(
             project_id=self.project.id,
             when=now,
-            count=20
+            count=100
         )
         assert not Alert.objects.filter(project=self.project).exists()
 
@@ -73,6 +73,6 @@ class CheckProjectAlertsTest(TestCase):
         check_project_alerts(
             project_id=self.project.id,
             when=now,
-            count=20
+            count=100
         )
-        assert Alert.objects.filter(project=self.project).exists()
\ No newline at end of file
+        assert Alert.objects.filter(project=self.project).exists()
