commit 70ee0cbc6e09b8c01c1204cb9eeade7fa30b392d
Author: Matej Minar <matej.minar@sentry.io>
Date:   Tue May 12 12:20:25 2020 +0200

    feat(ui): Release detail page improvements (#18717)
    
    * feat(ui): Add errors to release header
    
    * feat(ui): Add last deploy to release details
    
    * feat(ui): Deploy on detail page use Tag component
    
    * feat(ui): Change other projects in this release to ProjectBadge
    
    * feat(ui): Hide release errors from the UI
    
    * feat(ui): Add environment into last deploy tooltip

diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/otherProjects.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/otherProjects.tsx
index 423298f205..c3b36f3f54 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/otherProjects.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/otherProjects.tsx
@@ -7,8 +7,8 @@ import space from 'app/styles/space';
 import Link from 'app/components/links/link';
 import overflowEllipsis from 'app/styles/overflowEllipsis';
 import {ReleaseProject} from 'app/types';
-import {IconProject} from 'app/icons';
 import Button from 'app/components/button';
+import ProjectBadge from 'app/components/idBadge/projectBadge';
 
 import {SectionHeading, Wrapper} from './styles';
 
@@ -57,15 +57,14 @@ class OtherProjects extends React.Component<Props, State> {
         </SectionHeading>
         {projectsToRender.map(project => (
           <Row key={project.id}>
-            <Link
+            <StyledLink
               to={{
                 pathname: location.pathname,
                 query: {...location.query, project: project.id, yAxis: undefined},
               }}
             >
-              <StyledIconProject size="sm" />
-              {project.slug}
-            </Link>
+              <ProjectBadge project={project} avatarSize={16} key={project.slug} />
+            </StyledLink>
           </Row>
         ))}
         {numberOfCollapsedProjects > 0 && (
@@ -88,16 +87,14 @@ class OtherProjects extends React.Component<Props, State> {
 }
 
 const Row = styled('div')`
-  margin-bottom: ${space(0.75)};
+  margin-bottom: ${space(0.25)};
   font-size: ${p => p.theme.fontSizeMedium};
   color: ${p => p.theme.blue};
   ${overflowEllipsis}
 `;
 
-const StyledIconProject = styled(IconProject)`
-  margin-right: ${space(1)};
-  position: relative;
-  top: ${space(0.25)};
+const StyledLink = styled(Link)`
+  display: inline-block;
 `;
 
 const CollapseToggle = styled(Button)`
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/projectReleaseDetails.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/projectReleaseDetails.tsx
index 9ef892f1e5..57ab1c000e 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/projectReleaseDetails.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/projectReleaseDetails.tsx
@@ -7,6 +7,7 @@ import {Release} from 'app/types';
 import Version from 'app/components/version';
 import TimeSince from 'app/components/timeSince';
 import DateTime from 'app/components/dateTime';
+import Tooltip from 'app/components/tooltip';
 
 import {SectionHeading, Wrapper} from './styles';
 
@@ -15,7 +16,7 @@ type Props = {
 };
 
 const ProjectReleaseDetails = ({release}: Props) => {
-  const {version, dateCreated, firstEvent, lastEvent} = release;
+  const {version, dateCreated, firstEvent, lastEvent, lastDeploy} = release;
 
   return (
     <Wrapper>
@@ -29,6 +30,17 @@ const ProjectReleaseDetails = ({release}: Props) => {
             </TagValue>
           </StyledTr>
 
+          {lastDeploy?.dateFinished && (
+            <StyledTr>
+              <TagKey>{t('Last Deploy')}</TagKey>
+              <TagValue>
+                <Tooltip title={lastDeploy.environment}>
+                  <DateTime date={lastDeploy.dateFinished} seconds={false} />
+                </Tooltip>
+              </TagValue>
+            </StyledTr>
+          )}
+
           <StyledTr>
             <TagKey>{t('Version')}</TagKey>
             <TagValue>
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/releaseHeader.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/releaseHeader.tsx
index d8e5be898c..09209fdd7d 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/releaseHeader.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/releaseHeader.tsx
@@ -13,7 +13,7 @@ import Version from 'app/components/version';
 import Clipboard from 'app/components/clipboard';
 import {IconCopy, IconOpen} from 'app/icons';
 import Tooltip from 'app/components/tooltip';
-import Badge from 'app/components/badge';
+import Tag from 'app/views/settings/components/tag';
 import Count from 'app/components/count';
 import TimeSince from 'app/components/timeSince';
 import {formatVersion} from 'app/utils/formatters';
@@ -32,7 +32,7 @@ type Props = {
 
 const ReleaseHeader = ({location, orgId, release, deploys, project}: Props) => {
   const {version, newGroups, url} = release;
-  const {healthData} = project;
+  const {hasHealthData, sessionsCrashed} = project.healthData;
 
   const releasePath = `/organizations/${orgId}/releases/${encodeURIComponent(version)}/`;
 
@@ -72,26 +72,22 @@ const ReleaseHeader = ({location, orgId, release, deploys, project}: Props) => {
                         version
                       )}&environment=${encodeURIComponent(deploy.environment)}`}
                     >
-                      <StyledBadge text={deploy.environment} />
+                      <StyledBadge>{deploy.environment}</StyledBadge>
                     </Link>
                   </Tooltip>
                 ))}
               </DeploysWrapper>
             </ReleaseStat>
           )}
-          {healthData?.hasHealthData && (
+          {hasHealthData && (
             <ReleaseStat label={t('Crashes')}>
-              <Count value={healthData?.sessionsCrashed ?? 0} />
+              <Count value={sessionsCrashed} />
             </ReleaseStat>
           )}
           <ReleaseStat label={t('New Issues')}>
             <Count value={newGroups} />
           </ReleaseStat>
-          <ReleaseActions
-            version={version}
-            orgId={orgId}
-            hasHealthData={healthData?.hasHealthData}
-          />
+          <ReleaseActions version={version} orgId={orgId} hasHealthData={hasHealthData} />
         </StatsWrapper>
       </Layout>
 
@@ -166,12 +162,16 @@ const StatsWrapper = styled('div')`
 const DeploysWrapper = styled('div')`
   display: flex;
   margin-top: ${space(0.5)};
+  @media (max-width: ${p => p.theme.breakpoints[0]}) {
+    flex-wrap: wrap;
+  }
 `;
 
-const StyledBadge = styled(Badge)`
+const StyledBadge = styled(Tag)`
   background-color: ${p => p.theme.gray4};
   font-size: ${p => p.theme.fontSizeSmall};
-  font-weight: 400;
+  color: ${p => p.theme.white};
+  margin-left: ${space(0.5)};
 `;
 
 const ReleaseName = styled('div')`
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/releaseStat.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/releaseStat.tsx
index ebc570fa25..8fe02236dc 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/releaseStat.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/releaseStat.tsx
@@ -28,6 +28,7 @@ const Label = styled('div')`
   color: ${p => p.theme.gray2};
   line-height: 1.3;
   margin-bottom: ${space(0.25)};
+  white-space: nowrap;
 `;
 const Value = styled('div')`
   font-size: ${p => p.theme.fontSizeExtraLarge};
