commit d0554a17ceeb6ec247ae9751f75a6c073f05682e
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu May 2 11:23:27 2019 -0700

    test(sentry10): Update email tests for Sentry 10 (#13033)
    
    Update email tests for Sentry 10. This will allow mainlining
    Sentry 10 in future without breaking these tests.

diff --git a/tests/acceptance/test_emails.py b/tests/acceptance/test_emails.py
index 1691d46c24..ca17031f07 100644
--- a/tests/acceptance/test_emails.py
+++ b/tests/acceptance/test_emails.py
@@ -63,17 +63,18 @@ class EmailTestCase(AcceptanceTestCase):
         )
 
     def test_emails(self):
-        for url, name in EMAILS:
-            # HTML output is captured as a snapshot
-            self.browser.get(self.build_url(url, 'html'))
-            self.browser.wait_until('#preview')
-            self.browser.snapshot(u'{} email html'.format(name))
+        with self.feature('organizations:sentry10'):
+            for url, name in EMAILS:
+                # HTML output is captured as a snapshot
+                self.browser.get(self.build_url(url, 'html'))
+                self.browser.wait_until('#preview')
+                self.browser.snapshot(u'{} email html'.format(name))
 
-            # Text output is asserted against static fixture files
-            self.browser.get(self.build_url(url, 'txt'))
-            self.browser.wait_until('#preview')
-            elem = self.browser.find_element_by_css_selector('#preview pre')
-            text_src = elem.get_attribute('innerHTML')
+                # Text output is asserted against static fixture files
+                self.browser.get(self.build_url(url, 'txt'))
+                self.browser.wait_until('#preview')
+                elem = self.browser.find_element_by_css_selector('#preview pre')
+                text_src = elem.get_attribute('innerHTML')
 
-            fixture_src = read_txt_email_fixture(name)
-            assert fixture_src == text_src
+                fixture_src = read_txt_email_fixture(name)
+                assert fixture_src == text_src
diff --git a/tests/fixtures/emails/assigned.txt b/tests/fixtures/emails/assigned.txt
index 4e04e31a10..2d63f6b339 100644
--- a/tests/fixtures/emails/assigned.txt
+++ b/tests/fixtures/emails/assigned.txt
@@ -7,7 +7,7 @@ foo@example.com assigned an issue to foo@example.com
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=AssignedActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=AssignedActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/assigned_self.txt b/tests/fixtures/emails/assigned_self.txt
index 092aa774c8..70e63f46fa 100644
--- a/tests/fixtures/emails/assigned_self.txt
+++ b/tests/fixtures/emails/assigned_self.txt
@@ -7,7 +7,7 @@ foo@example.com assigned an issue to themselves
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=AssignedActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=AssignedActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/digest.txt b/tests/fixtures/emails/digest.txt
index 31967dd93b..8e1cfbbe92 100644
--- a/tests/fixtures/emails/digest.txt
+++ b/tests/fixtures/emails/digest.txt
@@ -4,22 +4,22 @@ June 8, 2016, 7:25 a.m. UTC to July 4, 2016, 2:11 p.m. UTC
 Rule #1
 
 * CursusError: nibh curabitur (9729 events, 5901 users)
-  http://testserver/example/example/issues/9/?referrer=digest_email
+  http://testserver/organizations/example/issues/9/?referrer=digest_email
 
 * CuraeError: pulvinar fames suspendisse erat integer ad magna (7555 events, 4549 users)
-  http://testserver/example/example/issues/15/?referrer=digest_email
+  http://testserver/organizations/example/issues/15/?referrer=digest_email
 
 * erat pellentesque enim imperdiet tortor (3180 events, 276 users)
-  http://testserver/example/example/issues/16/?referrer=digest_email
+  http://testserver/organizations/example/issues/16/?referrer=digest_email
 
 * NecVivamusError: consequat ipsum proin gravida inceptos scelerisque inceptos iaculis libero vulputate (2824 events, 1188 users)
-  http://testserver/example/example/issues/14/?referrer=digest_email
+  http://testserver/organizations/example/issues/14/?referrer=digest_email
 
 * LectusDapibusTacitiError: semper porta curae luctus fermentum molestie praesent ac auctor (2358 events, 7906 users)
-  http://testserver/example/example/issues/2/?referrer=digest_email
+  http://testserver/organizations/example/issues/2/?referrer=digest_email
 
 * VelTorquentError: porttitor praesent ridiculus (562 events, 8950 users)
-  http://testserver/example/example/issues/13/?referrer=digest_email
+  http://testserver/organizations/example/issues/13/?referrer=digest_email
 
 
 
diff --git a/tests/fixtures/emails/note.txt b/tests/fixtures/emails/note.txt
index 764dc889d6..69e7c621b1 100644
--- a/tests/fixtures/emails/note.txt
+++ b/tests/fixtures/emails/note.txt
@@ -9,6 +9,6 @@ metus volutpat
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/activity/?referrer=NoteActivityEmail
+http://testserver/organizations/organization/issues/1/activity/?project=1&amp;referrer=NoteActivityEmail
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/regression.txt b/tests/fixtures/emails/regression.txt
index d6e79e70a1..c0359c333b 100644
--- a/tests/fixtures/emails/regression.txt
+++ b/tests/fixtures/emails/regression.txt
@@ -7,7 +7,7 @@ Sentry marked an issue as a regression
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=RegressionActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=RegressionActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/regression_with_version.txt b/tests/fixtures/emails/regression_with_version.txt
index dc428cdbb1..ea5733ab2d 100644
--- a/tests/fixtures/emails/regression_with_version.txt
+++ b/tests/fixtures/emails/regression_with_version.txt
@@ -7,7 +7,7 @@ Sentry marked an issue as a regression in abcdef
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=RegressionActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=RegressionActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/release.txt b/tests/fixtures/emails/release.txt
index 8cf65db98f..3a99b0b2f1 100644
--- a/tests/fixtures/emails/release.txt
+++ b/tests/fixtures/emails/release.txt
@@ -1,9 +1,9 @@
 Version 6c998f7 was deployed to production on Oct. 12, 2016, 3:39 p.m.
 
 
-    http://testserver/organization/project/releases/6c998f755f304593a4713abd123eaf8833a2de5e/
+    http://testserver/organizations/organization/releases/6c998f755f304593a4713abd123eaf8833a2de5e/?project=1
 
-    http://testserver/organization/another-project/releases/6c998f755f304593a4713abd123eaf8833a2de5e/
+    http://testserver/organizations/organization/releases/6c998f755f304593a4713abd123eaf8833a2de5e/?project=2
 
-    http://testserver/organization/yet-another-project/releases/6c998f755f304593a4713abd123eaf8833a2de5e/
+    http://testserver/organizations/organization/releases/6c998f755f304593a4713abd123eaf8833a2de5e/?project=3
 
diff --git a/tests/fixtures/emails/resolved.txt b/tests/fixtures/emails/resolved.txt
index dcad5d5ce4..29b95a0eae 100644
--- a/tests/fixtures/emails/resolved.txt
+++ b/tests/fixtures/emails/resolved.txt
@@ -7,7 +7,7 @@ Sentry marked an issue as resolved
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=ResolvedActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=ResolvedActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/resolved_in_release.txt b/tests/fixtures/emails/resolved_in_release.txt
index d93957b211..88524d86c4 100644
--- a/tests/fixtures/emails/resolved_in_release.txt
+++ b/tests/fixtures/emails/resolved_in_release.txt
@@ -7,7 +7,7 @@ Sentry marked an issue as resolved in abcdef
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=ResolvedInReleaseActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=ResolvedInReleaseActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/resolved_in_release_upcoming.txt b/tests/fixtures/emails/resolved_in_release_upcoming.txt
index ae76342333..d4edf50daf 100644
--- a/tests/fixtures/emails/resolved_in_release_upcoming.txt
+++ b/tests/fixtures/emails/resolved_in_release_upcoming.txt
@@ -7,7 +7,7 @@ Sentry marked an issue as resolved in an upcoming release
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=ResolvedInReleaseActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=ResolvedInReleaseActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
diff --git a/tests/fixtures/emails/unassigned.txt b/tests/fixtures/emails/unassigned.txt
index 8eca8792dc..31a7105ef6 100644
--- a/tests/fixtures/emails/unassigned.txt
+++ b/tests/fixtures/emails/unassigned.txt
@@ -7,7 +7,7 @@ foo@example.com unassigned an issue
 
 ornare elit pulvinar nisl integer cum ad massa
 
-http://testserver/organization/project/issues/1/?referrer=UnassignedActivityEmail
+http://testserver/organizations/organization/issues/1/?project=1&amp;referrer=UnassignedActivityEmail
 
 
 Unsubscribe: javascript:alert("This is a preview page, what did you expect to happen?");
