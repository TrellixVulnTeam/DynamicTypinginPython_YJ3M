commit 06fb4a9f3ff3ead92dc7a68735079ae6aa1c7f8a
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Nov 7 11:24:45 2015 -0800

    Fix membership links

diff --git a/src/sentry/admin.py b/src/sentry/admin.py
index 655211d27b..a18ce6e447 100644
--- a/src/sentry/admin.py
+++ b/src/sentry/admin.py
@@ -18,7 +18,8 @@ from django.utils.translation import ugettext, ugettext_lazy as _
 from pprint import saferepr
 from sentry.models import (
     ApiKey, AuthIdentity, AuthProvider, AuditLogEntry, Broadcast, HelpPage,
-    Option, Organization, OrganizationMember, Project, Team, User
+    Option, Organization, OrganizationMember, OrganizationMemberTeam, Project,
+    Team, User
 )
 
 csrf_protect_m = method_decorator(csrf_protect)
@@ -149,14 +150,13 @@ class TeamAdmin(admin.ModelAdmin):
             organization=obj.organization,
         )
 
+        # TODO(dcramer): maintain memberships where possible
         # remove invalid team links
-        queryset = OrganizationMember.objects.filter(
-            teams=obj,
+        OrganizationMemberTeam.objects.filter(
+            team=obj,
         ).exclude(
-            organization=obj.organization,
-        )
-        for member in queryset:
-            member.teams.remove(obj)
+            organizationmember__organization=obj.organization,
+        ).delete()
 
 admin.site.register(Team, TeamAdmin)
 
