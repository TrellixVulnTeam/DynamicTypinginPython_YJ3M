commit 6c4759398437c9c95f466089c4731757508e9083
Author: Dena Mwangi <dena@getsentry.com>
Date:   Mon Nov 19 12:38:34 2018 -0800

    fix(analytics): Change query param from source to referrer (#10657)

diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index 764c0f5d1b..7cef87d7d9 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -183,11 +183,11 @@ class MailPlugin(NotificationPlugin):
 
         return send_to_list
 
-    def add_unsubscribe_link(self, context, user_id, project, source):
+    def add_unsubscribe_link(self, context, user_id, project, referrer):
         context['unsubscribe_link'] = generate_signed_link(
             user_id,
             'sentry-account-email-unsubscribe-project',
-            source,
+            referrer,
             kwargs={
                 'project_id': project.id,
             }
@@ -208,7 +208,7 @@ class MailPlugin(NotificationPlugin):
 
         link = group.get_absolute_url()
 
-        query_params = {'source': 'alert_email'}
+        query_params = {'referrer': 'alert_email'}
         if environment:
             query_params['environment'] = environment
 
diff --git a/src/sentry/utils/linksign.py b/src/sentry/utils/linksign.py
index b2d09ca976..30d20e270a 100644
--- a/src/sentry/utils/linksign.py
+++ b/src/sentry/utils/linksign.py
@@ -14,7 +14,7 @@ def get_signer():
     return signing.TimestampSigner(salt='sentry-link-signature')
 
 
-def generate_signed_link(user, viewname, source=None, args=None, kwargs=None):
+def generate_signed_link(user, viewname, referrer=None, args=None, kwargs=None):
     """This returns an absolute URL where the given user is signed in for
     the given viewname with args and kwargs.  This returns a redirect link
     that if followed sends the user to another URL which carries another
@@ -32,8 +32,8 @@ def generate_signed_link(user, viewname, source=None, args=None, kwargs=None):
     item = '%s|%s|%s' % (options.get('system.url-prefix'), path, base36_encode(user_id))
     signature = ':'.join(get_signer().sign(item).rsplit(':', 2)[1:])
     signed_link = '%s?_=%s:%s' % (absolute_uri(path), base36_encode(user_id), signature, )
-    if source:
-        signed_link = signed_link + '&' + urlencode({'source': source})
+    if referrer:
+        signed_link = signed_link + '&' + urlencode({'referrer': referrer})
     return signed_link
 
 
