commit ec2e42eb66a3b98b6257139761dd510da1ba5f01
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri May 27 13:03:46 2016 -0700

    Show link to SaaS (#3350)

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index d857682142..cdb5c82378 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -969,6 +969,8 @@ SENTRY_MAX_AVATAR_SIZE = 5000000
 STATUS_PAGE_ID = None
 STATUS_PAGE_API_HOST = 'statuspage.io'
 
+SENTRY_ONPREMISE = True
+
 
 def get_raven_config():
     return {
diff --git a/src/sentry/constants.py b/src/sentry/constants.py
index 599c291274..b9eb6c4c38 100644
--- a/src/sentry/constants.py
+++ b/src/sentry/constants.py
@@ -75,7 +75,7 @@ MAX_CULPRIT_LENGTH = 200
 RESERVED_ORGANIZATION_SLUGS = (
     'admin', 'manage', 'login', 'account', 'register', 'api',
     'accept', 'organizations', 'teams', 'projects', 'help',
-    'docs', 'logout', '404', '500', '_static',
+    'docs', 'logout', '404', '500', '_static', 'out',
 )
 
 RESERVED_TEAM_SLUGS = RESERVED_ORGANIZATION_SLUGS
diff --git a/src/sentry/static/sentry/app/components/footer.jsx b/src/sentry/static/sentry/app/components/footer.jsx
index 2630991c16..eba57b30fe 100644
--- a/src/sentry/static/sentry/app/components/footer.jsx
+++ b/src/sentry/static/sentry/app/components/footer.jsx
@@ -25,6 +25,9 @@ const Footer = React.createClass({
             <a href={config.urlPrefix + '/api/'}>{t('API')}</a>
             <a href={config.urlPrefix + '/docs/'}>{t('Docs')}</a>
             <a href="https://github.com/getsentry/sentry">{t('Contribute')}</a>
+            {config.isOnPremise &&
+              <a href={config.urlPrefix + '/out/'}>{t('Migrate to SaaS')}</a>
+            }
           </div>
           <div className="version pull-left">
             {'Sentry'} {config.version.current}
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index 143c63fd71..1554a660e9 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -187,6 +187,7 @@
           <a href="https://docs.getsentry.com/hosted/api/">{% trans "API" %}</a>
           <a href="https://docs.getsentry.com">{% trans "Docs" %}</a>
           <a href="https://github.com/getsentry/sentry">{% trans "Contribute" %}</a>
+          {% if ONPREMISE %}<a href="/out/">{% trans "Migrate to SaaS" %}</a>{% endif %}
         </div>
         <div class="version pull-left">Sentry {{ sentry_version.current }} {% if sentry_version.update_available %}<a href="#" title="You're running an old version of Sentry, did you know {{ sentry_version.latest }} is available?" class="tip icon-circle-arrow-up">&nbsp;</a>{% endif %}</div>
         <a href="/" class="icon-sentry-logo"></a>
diff --git a/src/sentry/templatetags/sentry_react.py b/src/sentry/templatetags/sentry_react.py
index 5f61dc5b4b..15e5307c41 100644
--- a/src/sentry/templatetags/sentry_react.py
+++ b/src/sentry/templatetags/sentry_react.py
@@ -123,6 +123,7 @@ def get_react_config(context):
             'message': msg.message,
             'level': msg.tags,
         } for msg in messages],
+        'isOnPremise': settings.SENTRY_ONPREMISE,
     }
     if user and user.is_authenticated():
         context.update({
diff --git a/src/sentry/web/frontend/out.py b/src/sentry/web/frontend/out.py
new file mode 100644
index 0000000000..fc1fae3b20
--- /dev/null
+++ b/src/sentry/web/frontend/out.py
@@ -0,0 +1,20 @@
+from __future__ import absolute_import
+
+from django.conf import settings
+from django.http import Http404, HttpResponseRedirect
+from django.views.generic import View
+
+from sentry import options
+
+
+class OutView(View):
+    def get(self, request):
+        if not settings.SENTRY_ONPREMISE:
+            raise Http404
+
+        install_id = options.get('sentry:install-id')
+        if install_id:
+            query = '?install_id=' + install_id
+        else:
+            query = ''
+        return HttpResponseRedirect('https://getsentry.com/from/self-hosted/' + query)
diff --git a/src/sentry/web/helpers.py b/src/sentry/web/helpers.py
index a51956dc44..ebda986706 100644
--- a/src/sentry/web/helpers.py
+++ b/src/sentry/web/helpers.py
@@ -54,6 +54,7 @@ def get_default_context(request, existing_context=None, team=None):
         'SINGLE_ORGANIZATION': settings.SENTRY_SINGLE_ORGANIZATION,
         'PLUGINS': plugins,
         'ALLOWED_HOSTS': list(settings.ALLOWED_HOSTS),
+        'ONPREMISE': settings.SENTRY_ONPREMISE,
     }
 
     if existing_context:
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index e0b8ccbb8c..9ced9d745e 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -46,6 +46,7 @@ from sentry.web.frontend.organization_auth_settings import \
     OrganizationAuthSettingsView
 from sentry.web.frontend.organization_member_settings import \
     OrganizationMemberSettingsView
+from sentry.web.frontend.out import OutView
 from sentry.web.frontend.organization_members import OrganizationMembersView
 from sentry.web.frontend.organization_settings import OrganizationSettingsView
 from sentry.web.frontend.project_issue_tracking import ProjectIssueTrackingView
@@ -268,6 +269,8 @@ urlpatterns += patterns(
     url(r'^api/$', react_page_view, name='sentry-api'),
     url(r'^api/new-token/$', react_page_view),
 
+    url(r'^out/$', OutView.as_view()),
+
     # Organizations
     url(r'^(?P<organization_slug>[\w_-]+)/$', react_page_view,
         name='sentry-organization-home'),
