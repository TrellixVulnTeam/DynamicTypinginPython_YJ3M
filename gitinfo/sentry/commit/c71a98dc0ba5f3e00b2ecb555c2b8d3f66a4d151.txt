commit c71a98dc0ba5f3e00b2ecb555c2b8d3f66a4d151
Author: Jan Michael Auer <jan.auer@sentry.io>
Date:   Fri Feb 14 14:46:21 2020 +0100

    fix(relay): Return proper project config in fast-path (#17049)

diff --git a/src/sentry/relay/config.py b/src/sentry/relay/config.py
index d25d2842f2..ad28dd94de 100644
--- a/src/sentry/relay/config.py
+++ b/src/sentry/relay/config.py
@@ -93,7 +93,7 @@ def get_project_config(project, org_options=None, full_config=True, project_keys
         scope.set_tag("project", project.id)
 
     if project.status != ObjectStatus.VISIBLE:
-        return {"disabled": True}
+        return ProjectConfig(project, disabled=True)
 
     public_keys = get_public_key_configs(project, full_config, project_keys=project_keys)
 
diff --git a/tests/sentry/api/endpoints/test_relay_projectconfigs.py b/tests/sentry/api/endpoints/test_relay_projectconfigs.py
index 60ae0776cf..7a87272be1 100644
--- a/tests/sentry/api/endpoints/test_relay_projectconfigs.py
+++ b/tests/sentry/api/endpoints/test_relay_projectconfigs.py
@@ -10,6 +10,7 @@ from uuid import uuid4
 from django.core.urlresolvers import reverse
 
 from sentry import quotas
+from sentry.constants import ObjectStatus
 from sentry.utils import safe
 from sentry.models.relay import Relay
 from sentry.models import Project
@@ -311,3 +312,21 @@ def test_relay_nonexistent_project(call_endpoint, projectconfig_cache_set, task_
     assert http_cfg == {"disabled": True}
 
     assert projectconfig_cache_set == [{six.text_type(wrong_id): http_cfg}]
+
+
+@pytest.mark.django_db
+def test_relay_disabled_project(
+    call_endpoint, default_project, projectconfig_cache_set, task_runner
+):
+    default_project.update(status=ObjectStatus.PENDING_DELETION)
+
+    wrong_id = default_project.id
+
+    with task_runner():
+        result, status_code = call_endpoint(full_config=True, projects=[wrong_id])
+        assert status_code < 400
+
+    http_cfg, = six.itervalues(result["configs"])
+    assert http_cfg == {"disabled": True}
+
+    assert projectconfig_cache_set == [{six.text_type(wrong_id): http_cfg}]
