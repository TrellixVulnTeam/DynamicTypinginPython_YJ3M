commit ce8dc94f0946d0c220ee319177b3d265e4bc79c9
Author: David Cramer <dcramer@gmail.com>
Date:   Thu May 3 17:51:43 2012 -0700

    Improve client configuration page

diff --git a/bootstrap/sentry.less b/bootstrap/sentry.less
index 237cb94a23..a220534d01 100644
--- a/bootstrap/sentry.less
+++ b/bootstrap/sentry.less
@@ -445,6 +445,7 @@ code {
   padding-left: 17px;
   line-height: 17px;
   position: relative;
+  overflow: hidden;
   object {
     position: absolute;
     left: 0;
diff --git a/sentry/models.py b/sentry/models.py
index e50720918a..d9d074ca63 100644
--- a/sentry/models.py
+++ b/sentry/models.py
@@ -238,13 +238,18 @@ class ProjectKey(Model):
             self.secret_key = ProjectKey.generate_api_key()
         super(ProjectKey, self).save(*args, **kwargs)
 
-    def get_dsn(self, domain=None, secure=True):
+    def get_dsn(self, domain=None, secure=True, public=False):
         # TODO: change the DSN to use project slug once clients are compatible
+        if not public:
+            key = '%s:%s' % (self.public_key, self.secret_key)
+        else:
+            key = self.public_key
+
         urlparts = urlparse.urlparse(settings.URL_PREFIX)
-        return '%s://%s:%s@%s/%s' % (
+
+        return '%s://%s@%s/%s' % (
             urlparts.scheme,
-            self.public_key,
-            self.secret_key,
+            key,
             urlparts.netloc + urlparts.path,
             self.project_id,
         )
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index 9136810533..6b95b69d0a 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -3849,6 +3849,7 @@ code {
   padding-left: 17px;
   line-height: 17px;
   position: relative;
+  overflow: hidden;
 }
 .clippy object {
   position: absolute;
diff --git a/sentry/static/styles/global.min.css b/sentry/static/styles/global.min.css
index 65173252c5..d9629710c2 100644
--- a/sentry/static/styles/global.min.css
+++ b/sentry/static/styles/global.min.css
@@ -671,7 +671,7 @@ code{border:0;background-color:inherit;color:#666666;}
 .nav-tabs>li.pull-right{float:right;}
 .table th{vertical-align:top;}
 .table td{vertical-align:middle;}
-.clippy{display:inline-block;vertical-align:middle;padding-left:17px;line-height:17px;position:relative;}.clippy object{position:absolute;left:0;width:12px;height:12px;}
+.clippy{display:inline-block;vertical-align:middle;padding-left:17px;line-height:17px;position:relative;overflow:hidden;}.clippy object{position:absolute;left:0;width:12px;height:12px;}
 ol.context{margin:0;list-style-position:inside;border:1px solid #ccc;border:1px solid rgba(0, 0, 0, 0.15);-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;}ol.context>li{padding-left:20px;font-family:monospace;white-space:pre;color:rgba(0, 0, 0, 0.75);background-color:#f5f5f5;}ol.context>li>pre{background-color:inherit;color:rgba(0, 0, 0, 0.5);margin:0;padding:0;border:0;display:inline;line-height:18px;font-size:12px;white-space:pre;white-space:pre-wrap;word-wrap:break-word;}
 ol.context>li.active{background-color:#ddd;}ol.context>li.active pre{color:#000000;}
 ol.context-line>li>span{float:right;}
diff --git a/sentry/templates/sentry/partial/client_config/javascript.html b/sentry/templates/sentry/partial/client_config/javascript.html
index 06342d87de..0a97216257 100644
--- a/sentry/templates/sentry/partial/client_config/javascript.html
+++ b/sentry/templates/sentry/partial/client_config/javascript.html
@@ -11,7 +11,7 @@
 <p>{% trans "Configure the client:" %}</p>
 
 <pre>&lt;script type="text/javascript"&gt;
-Raven.config('{% if dsn %}{{ dsn }}{% else %}<strong>SENTRY_DSN</strong>{% endif %}');
+Raven.config('{% if dsn_public %}{{ dsn_public }}{% else %}<strong>SENTRY_DSN</strong>{% endif %}');
 &lt;/script&gt;</pre>
 
 <p>{% trans "Now call out to the raven client to capture events:" %}</p>
diff --git a/sentry/templates/sentry/projects/client_help.html b/sentry/templates/sentry/projects/client_help.html
new file mode 100644
index 0000000000..0e84e2b707
--- /dev/null
+++ b/sentry/templates/sentry/projects/client_help.html
@@ -0,0 +1,23 @@
+{% extends "sentry/projects/manage.html" %}
+
+{% load i18n %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Client Configuration" %}</h2>
+    </div>
+    {% if key %}
+        <p>{% trans "To start sending events, configure your client with the following DSN value:" %}</p>
+        <p><code class="clippy">{{ dsn }}</code></p>
+        <p>{% blocktrans with 'https://github.com/lincolnloop/raven-js' as link %}If this is a client that only needs public access (like <a href="{{ link }}">raven-js</a>), you can use the following public DSN:{% endblocktrans %}</p>
+        <p><code class="clippy">{{ dsn_public }}</code></p>
+        <div class="page-header">
+            <h3>{% trans "Platform Instructions" %}</h3>
+        </div>
+        <p>{% trans "Choose your platform for quick setup instructions:" %}</p>
+        {% include "sentry/partial/_client_config.html" %}
+    {% else %}
+        <p>{% trans "There is no key configured for your account with access to this project." %}</p>
+    {% endif %}
+{% endblock %}
+
diff --git a/sentry/templates/sentry/projects/manage.html b/sentry/templates/sentry/projects/manage.html
index e41019f4fc..1b266b0db3 100644
--- a/sentry/templates/sentry/projects/manage.html
+++ b/sentry/templates/sentry/projects/manage.html
@@ -26,6 +26,9 @@
             <li class="pull-right{% if page == 'plugins' %} active{% endif %}">
                 <a href="{% url sentry-manage-project-plugins project.slug %}">{% trans "Manage Plugins" %} ({{ PLUGINS|length }})</a>
             </li>
+            <li class="pull-right{% if page == 'client_help' %} active{% endif %}">
+                <a href="{% url sentry-project-client-help project.slug %}">{% trans "Client Configuration" %}</a>
+            </li>
         </ul>
         {% block inner %}
             <p>{% trans "Here you can edit project information, as well as control the access list for a project with fine-grained permissions." %}</p>
@@ -107,18 +110,6 @@
                     {% endfor %}
                 </tbody>
             </table>
-            {% if key %}
-                <div class="page-header">
-                    <h2>{% trans "Client Configuration" %}</h2>
-                </div>
-                {% with key.get_dsn as project_dsn %}
-                    <p>{% trans "To start sending events, configure your client with the following DSN value:" %}</p>
-                    <p><code class="clippy">{{ project_dsn }}</code></p>
-                    <p>{% trans "Choose your platform for quick setup instructions:" %}</p>
-                    {% include "sentry/partial/_client_config.html" %}
-                    <p>{% blocktrans with 'http://sentry.readthedocs.org' as link %}For more information, please see the <a href="{{ link }}">documentation</a>.{% endblocktrans %}</p>
-                {% endwith %}
-            {% endif %}
         {% endblock %}
     </section>
 {% endblock %}
diff --git a/sentry/web/frontend/docs.py b/sentry/web/frontend/docs.py
index a2072ca34a..a6c3d8de0a 100644
--- a/sentry/web/frontend/docs.py
+++ b/sentry/web/frontend/docs.py
@@ -35,6 +35,7 @@ def client_guide(request, project, platform):
 
     key = ProjectKey.objects.get(user=request.user, project=project)
     dsn = key.get_dsn()
+    dsn_public = key.get_dsn(public=True)
 
     template = 'sentry/partial/client_config/%s.html' % (platform,)
 
@@ -43,6 +44,7 @@ def client_guide(request, project, platform):
         'platform_title': platform.title(),
         'project': project,
         'dsn': dsn,
+        'dsn_public': dsn_public,
     }
 
     if request.is_ajax():
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 9e768a239c..5ec8274f6f 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -112,16 +112,10 @@ def manage_project(request, project):
     else:
         member_list = [(tm, tm.user) for tm in project.team.member_set.select_related('user')]
 
-    try:
-        key = ProjectKey.objects.get(user=request.user, project=project)
-    except ProjectKey.DoesNotExist:
-        key = None  # superuser
-
     context = csrf(request)
     context.update({
         'can_remove_project': can_remove_project(request.user, project),
         'page': 'details',
-        'key': key,
         'form': form,
         'project': project,
         'member_list': member_list,
@@ -131,6 +125,28 @@ def manage_project(request, project):
     return render_to_response('sentry/projects/manage.html', context, request)
 
 
+@login_required
+@has_access
+def client_help(request, project):
+    try:
+        key = ProjectKey.objects.get(user=request.user, project=project)
+    except ProjectKey.DoesNotExist:
+        key = None  # superuser
+
+    context = {
+        'can_remove_project': can_remove_project(request.user, project),
+        'page': 'client_help',
+        'project': project,
+        'key': key,
+    }
+    if key:
+        context.update({
+            'dsn': key.get_dsn(),
+            'dsn_public': key.get_dsn(public=True),
+        })
+    return render_to_response('sentry/projects/client_help.html', context, request)
+
+
 @login_required
 @has_access(MEMBER_OWNER)
 @csrf_protect
diff --git a/sentry/web/urls.py b/sentry/web/urls.py
index 688266063b..3bc9d58a95 100644
--- a/sentry/web/urls.py
+++ b/sentry/web/urls.py
@@ -77,6 +77,10 @@ urlpatterns = patterns('',
     url(r'^account/projects/new/$', projects.new_project, name='sentry-new-project'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/edit/$', projects.manage_project,
         name='sentry-manage-project'),
+    url(r'^account/projects/(?P<project_id>[\w_-]+)/docs/$', projects.client_help,
+        name='sentry-project-client-help'),
+    url(r'^account/projects/(?P<project_id>[\w_-]+)/docs/(?P<platform>%s)/$' % ('|'.join(re.escape(r) for r in docs.PLATFORM_LIST),),
+        docs.client_guide, name='sentry-docs-client'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/plugins/$', projects.manage_plugins,
         name='sentry-manage-project-plugins'),
     url(r'^account/projects/(?P<project_id>[\w_-]+)/plugins/(?P<slug>[\w_-]+)/$', projects.configure_project_plugin,
@@ -119,10 +123,6 @@ urlpatterns = patterns('',
 
     # Project specific
 
-    # url(r'^(?P<project_id>[\w_-]+)/docs/$', groups.search, name='sentry-search'),
-    url(r'^(?P<project_id>[\w_-]+)/docs/(?P<platform>%s)/$' % ('|'.join(re.escape(r) for r in docs.PLATFORM_LIST),), docs.client_guide,
-        name='sentry-docs-client'),
-
     url(r'^(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/$', groups.group, name='sentry-group'),
     url(r'^(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/json/$', groups.group_json, name='sentry-group-json'),
     url(r'^(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/$', groups.group_event_list, name='sentry-group-events'),
