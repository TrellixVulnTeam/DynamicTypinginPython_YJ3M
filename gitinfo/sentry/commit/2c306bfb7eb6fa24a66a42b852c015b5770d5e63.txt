commit 2c306bfb7eb6fa24a66a42b852c015b5770d5e63
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 16 15:36:55 2012 -0700

    Ensure validate data handles slugs -> ids

diff --git a/sentry/coreapi.py b/sentry/coreapi.py
index 83b2d5b3d7..d52b816699 100644
--- a/sentry/coreapi.py
+++ b/sentry/coreapi.py
@@ -243,8 +243,10 @@ def safely_load_json_string(json_string):
 def ensure_valid_project_id(desired_project, data):
     # Confirm they're using either the master key, or their specified project
     # matches with the signed project.
-    if desired_project and str(data.get('project', '')) not in [str(desired_project.pk), desired_project.slug]:
-        raise APIForbidden('Invalid credentials')
+    if desired_project:
+        if str(data.get('project', '')) not in [str(desired_project.pk), desired_project.slug]:
+            raise APIForbidden('Invalid credentials')
+        data['project'] = desired_project.pk
     elif not desired_project:
         data['project'] = 1
 
diff --git a/setup.py b/setup.py
index 335023f98d..be091dd089 100755
--- a/setup.py
+++ b/setup.py
@@ -50,7 +50,7 @@ install_requires = [
 
 setup(
     name='sentry',
-    version='4.0.7',
+    version='4.0.8',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/sentry',
diff --git a/tests/sentry/coreapi/tests.py b/tests/sentry/coreapi/tests.py
index 797f4fef0a..338d0d1199 100644
--- a/tests/sentry/coreapi/tests.py
+++ b/tests/sentry/coreapi/tests.py
@@ -261,6 +261,7 @@ class ValidateDataTest(BaseAPITest):
             'message': 'foo',
         })
 
+
     def test_invalid_project_id(self):
         self.assertRaises(APIForbidden, validate_data, self.project, {
             'project': self.project.id + 1,
@@ -301,9 +302,9 @@ class ValidateDataTest(BaseAPITest):
         })
         self.assertEquals(data['level'], 40)
 
-    def test_invalid_modules(self):
-        self.assertRaises(InvalidData, validate_data, self.project, {
-            'project': self.project.id,
+    def test_project_slug(self):
+        data = validate_data(self.project, {
+            'project': self.project.slug,
             'message': 'foo',
-            'modules': [('foo', 'bar')],
         })
+        self.assertEquals(data['project'], self.project.id)
