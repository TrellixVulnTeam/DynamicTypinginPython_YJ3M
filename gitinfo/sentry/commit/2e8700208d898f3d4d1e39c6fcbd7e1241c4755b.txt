commit 2e8700208d898f3d4d1e39c6fcbd7e1241c4755b
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jan 24 15:42:58 2013 -0800

    Handle case when first_seen and last_seen may not be set

diff --git a/src/sentry/migrations/0083_migrate_dupe_groups.py b/src/sentry/migrations/0083_migrate_dupe_groups.py
index 087c73662e..d77ab2c727 100644
--- a/src/sentry/migrations/0083_migrate_dupe_groups.py
+++ b/src/sentry/migrations/0083_migrate_dupe_groups.py
@@ -74,16 +74,20 @@ class Migration(DataMigration):
 
             # migrate tags
             for (key, value), data in tag_updates.iteritems():
+                defaults = {
+                    'times_seen': F('times_seen') + data['times_seen'],
+                }
+                if 'last_seen' in data:
+                    defaults['last_seen'] = data['last_seen']
+                if 'first_seen' in data:
+                    defaults['first_seen'] = data['first_seen']
+
                 create_or_update(orm['sentry.MessageFilterValue'],
                     project=group.project,
                     group=group,
                     key=key,
                     value=value,
-                    defaults={
-                        'times_seen': F('times_seen') + data['times_seen'],
-                        'last_seen': data['first_seen'],
-                        'first_seen': data['last_seen'],
-                    }
+                    defaults=defaults
                 )
 
             db.commit_transaction()
