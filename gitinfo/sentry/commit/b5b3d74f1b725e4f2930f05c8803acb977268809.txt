commit b5b3d74f1b725e4f2930f05c8803acb977268809
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 18 21:52:31 2014 -0700

    Various improvements to logging/imports

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 2b55a3547b..18b86afbc6 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -352,7 +352,9 @@ LOGGING = {
     'disable_existing_loggers': True,
     'handlers': {
         'console': {
-            'class': 'logging.StreamHandler'
+            'level': 'WARNING',
+            'class': 'logging.StreamHandler',
+            'formatter': 'simple',
         },
         'sentry': {
             'level': 'ERROR',
@@ -360,25 +362,24 @@ LOGGING = {
         }
     },
     'formatters': {
+        'simple': {
+            'format': '[%(levelname)s] %(message)s',
+        },
         'client_info': {
-            'format': '%(name)s %(levelname)s %(project_slug)s/%(team_slug)s %(message)s'
-        }
+            'format': '[%(levelname)s] %(project_slug)s/%(team_slug)s %(message)s',
+        },
     },
     'root': {
-        'level': 'WARNING',
         'handlers': ['console', 'sentry'],
     },
     'loggers': {
         'sentry': {
             'level': 'ERROR',
-            'handlers': ['console', 'sentry'],
-            'propagate': False,
         },
         'sentry.coreapi': {
             'formatter': 'client_info',
         },
         'sentry.errors': {
-            'level': 'ERROR',
             'handlers': ['console'],
             'propagate': False,
         },
diff --git a/src/sentry/constants.py b/src/sentry/constants.py
index d55fd91626..62e6b9aadc 100644
--- a/src/sentry/constants.py
+++ b/src/sentry/constants.py
@@ -8,6 +8,8 @@ web-server
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import logging
 import os.path
 
diff --git a/src/sentry/coreapi.py b/src/sentry/coreapi.py
index f45637d0a9..173592c8c0 100644
--- a/src/sentry/coreapi.py
+++ b/src/sentry/coreapi.py
@@ -8,6 +8,7 @@ sentry.coreapi
 # TODO: We should make the API a class, and UDP/HTTP just inherit from it
 #       This will make it so we can more easily control logging with various
 #       metadata (rather than generic log messages which aren't useful).
+from __future__ import absolute_import, print_function
 
 import base64
 import logging
@@ -34,7 +35,7 @@ from sentry.utils.compat import StringIO
 from sentry.utils.strings import decompress
 
 
-logger = logging.getLogger('sentry.coreapi.errors')
+logger = logging.getLogger('sentry.coreapi')
 
 LOG_LEVEL_REVERSE_MAP = dict((v, k) for k, v in LOG_LEVELS.iteritems())
 
diff --git a/src/sentry/db/models/fields/gzippeddict.py b/src/sentry/db/models/fields/gzippeddict.py
index c67aa7a141..406bdb720d 100644
--- a/src/sentry/db/models/fields/gzippeddict.py
+++ b/src/sentry/db/models/fields/gzippeddict.py
@@ -6,7 +6,7 @@ sentry.db.models.fields.gzippeddict
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
diff --git a/src/sentry/db/models/fields/node.py b/src/sentry/db/models/fields/node.py
index 8552de4df1..6d1a0ff9e2 100644
--- a/src/sentry/db/models/fields/node.py
+++ b/src/sentry/db/models/fields/node.py
@@ -6,7 +6,7 @@ sentry.db.models.fields.node
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import collections
 import logging
diff --git a/src/sentry/db/models/manager.py b/src/sentry/db/models/manager.py
index 6b2e59631c..6b3e6feaae 100644
--- a/src/sentry/db/models/manager.py
+++ b/src/sentry/db/models/manager.py
@@ -6,7 +6,7 @@ sentry.db.models.manager
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import hashlib
 import logging
diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 02ac29be04..2a2b22aa48 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -5,6 +5,7 @@ sentry.event_manager
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import logging
 import six
@@ -25,6 +26,7 @@ from sentry.constants import (
 from sentry.models import Event, EventMapping, Group, GroupHash, Project
 from sentry.plugins import plugins
 from sentry.signals import regression_signal
+from sentry.utils.logging import suppress_exceptions
 from sentry.tasks.index import index_event
 from sentry.tasks.merge import merge_group
 from sentry.tasks.post_process import post_process_group
@@ -202,6 +204,7 @@ class EventManager(object):
 
         return data
 
+    @suppress_exceptions
     @transaction.commit_on_success
     def save(self, project, raw=False):
         # TODO: culprit should default to "most recent" frame in stacktraces when
diff --git a/src/sentry/management/commands/cleanup.py b/src/sentry/management/commands/cleanup.py
index 2c03e1e214..29aec9826e 100644
--- a/src/sentry/management/commands/cleanup.py
+++ b/src/sentry/management/commands/cleanup.py
@@ -5,6 +5,8 @@ sentry.management.commands.cleanup
 :copyright: (c) 2012 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 from django.core.management.base import BaseCommand
 from optparse import make_option
 
diff --git a/src/sentry/middleware/maintenance.py b/src/sentry/middleware/maintenance.py
index 91525ffebf..1a34cc64c2 100644
--- a/src/sentry/middleware/maintenance.py
+++ b/src/sentry/middleware/maintenance.py
@@ -5,6 +5,8 @@ sentry.middleware.maintenance
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import logging
 
 from django.conf import settings
diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index 1fb6b88567..d390cf822d 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -5,6 +5,8 @@ sentry.models.group
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import logging
 import math
 import time
diff --git a/src/sentry/models/pendingteammember.py b/src/sentry/models/pendingteammember.py
index a614963fac..9aa3d5cc90 100644
--- a/src/sentry/models/pendingteammember.py
+++ b/src/sentry/models/pendingteammember.py
@@ -5,6 +5,7 @@ sentry.models.pendingteammember
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import logging
 
diff --git a/src/sentry/plugins/base.py b/src/sentry/plugins/base.py
index b946c5cb98..4c71d6d2f4 100644
--- a/src/sentry/plugins/base.py
+++ b/src/sentry/plugins/base.py
@@ -5,6 +5,7 @@ sentry.plugins.base
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 __all__ = ('Plugin', 'plugins', 'register', 'unregister')
 
diff --git a/src/sentry/plugins/bases/notify.py b/src/sentry/plugins/bases/notify.py
index b69dc46e13..84bef79c0b 100644
--- a/src/sentry/plugins/bases/notify.py
+++ b/src/sentry/plugins/bases/notify.py
@@ -5,6 +5,8 @@ sentry.plugins.bases.notify
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import logging
 
 from django import forms
diff --git a/src/sentry/services/smtp.py b/src/sentry/services/smtp.py
index db0d9aee62..90fd062fa5 100644
--- a/src/sentry/services/smtp.py
+++ b/src/sentry/services/smtp.py
@@ -5,6 +5,7 @@ sentry.services.smtp
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import asyncore
 import email
diff --git a/src/sentry/tasks/check_update.py b/src/sentry/tasks/check_update.py
index 270974daca..d989baa51e 100644
--- a/src/sentry/tasks/check_update.py
+++ b/src/sentry/tasks/check_update.py
@@ -6,7 +6,7 @@ sentry.tasks.check_version
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import json
 import logging
diff --git a/src/sentry/tasks/email.py b/src/sentry/tasks/email.py
index d5434bf5d4..9a23d6ecab 100644
--- a/src/sentry/tasks/email.py
+++ b/src/sentry/tasks/email.py
@@ -6,7 +6,7 @@ sentry.tasks.email
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
diff --git a/src/sentry/tasks/fetch_source.py b/src/sentry/tasks/fetch_source.py
index f7948ef1b1..028f1f9dbd 100644
--- a/src/sentry/tasks/fetch_source.py
+++ b/src/sentry/tasks/fetch_source.py
@@ -5,6 +5,7 @@ sentry.tasks.fetch_source
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import itertools
 import logging
diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index 0b96fe2a74..3786c053e6 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -6,7 +6,7 @@ sentry.tasks.post_process
 :license: BSD, see LICENSE for more details.
 """
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
@@ -21,7 +21,7 @@ from sentry.utils.cache import cache
 from sentry.utils.safe import safe_execute
 
 
-rules_logger = logging.getLogger('sentry.errors.rules')
+rules_logger = logging.getLogger('sentry.errors')
 
 
 def condition_matches(project, condition, event, state):
diff --git a/src/sentry/tasks/process_buffer.py b/src/sentry/tasks/process_buffer.py
index c438c4c4cb..c8d593b185 100644
--- a/src/sentry/tasks/process_buffer.py
+++ b/src/sentry/tasks/process_buffer.py
@@ -8,6 +8,7 @@ sentry.tasks.process_buffer
 
 from __future__ import absolute_import
 
+from sentry.utils.logging import suppress_exceptions
 from sentry.tasks.base import instrumented_task
 
 
@@ -24,6 +25,7 @@ def process_pending():
 
 @instrumented_task(
     name='sentry.tasks.process_buffer.process_incr')
+@suppress_exceptions
 def process_incr(**kwargs):
     """
     Processes a buffer event.
diff --git a/src/sentry/templatetags/sentry_stream_filters.py b/src/sentry/templatetags/sentry_stream_filters.py
index 5cab148232..ebe237d0d2 100644
--- a/src/sentry/templatetags/sentry_stream_filters.py
+++ b/src/sentry/templatetags/sentry_stream_filters.py
@@ -5,7 +5,7 @@ sentry.templatetags.sentry_stream_filters
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
@@ -26,7 +26,7 @@ def get_filters(project, request):
         try:
             filter_cls = import_string(class_path)
         except Exception:
-            logger = logging.getLogger('sentry.errors.filters')
+            logger = logging.getLogger('sentry.errors')
             logger.exception('Unable to import %s', class_path)
             continue
         filter_list.append(filter_cls(request, project))
diff --git a/src/sentry/utils/cache.py b/src/sentry/utils/cache.py
index 6af86899c5..338137f0b2 100644
--- a/src/sentry/utils/cache.py
+++ b/src/sentry/utils/cache.py
@@ -5,6 +5,8 @@ sentry.utils.cache
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import functools
 import logging
 import random
diff --git a/src/sentry/utils/logging.py b/src/sentry/utils/logging.py
new file mode 100644
index 0000000000..23c5063d25
--- /dev/null
+++ b/src/sentry/utils/logging.py
@@ -0,0 +1,35 @@
+"""
+sentry.utils.logging
+~~~~~~~~~~~~~~~~~
+
+:copyright: (c) 2010-2013 by the Sentry Team, see AUTHORS for more details.
+:license: BSD, see LICENSE for more details.
+"""
+from __future__ import absolute_import, print_function
+
+import logging
+
+from functools import wraps
+
+
+def suppress_exceptions(func=None):
+    cm = WithoutRavenManager()
+    if not func:
+        return cm
+
+    @wraps(func)
+    def wrapped(*args, **kwargs):
+        with cm:
+            return func(*args, **kwargs)
+    return wrapped
+
+
+class WithoutRavenManager(object):
+    def __enter__(self):
+        pass
+
+    def __exit__(self, exc_type, exc_value, exc_traceback):
+        if all([exc_type, exc_value, exc_traceback]):
+            logger = logging.getLogger('sentry.errors')
+            logger.exception(unicode(exc_value))
+        return True
diff --git a/src/sentry/utils/managers.py b/src/sentry/utils/managers.py
index 3c6128c1c8..6ecf594181 100644
--- a/src/sentry/utils/managers.py
+++ b/src/sentry/utils/managers.py
@@ -5,6 +5,7 @@ sentry.utils.db
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import logging
 
diff --git a/src/sentry/utils/safe.py b/src/sentry/utils/safe.py
index 75d486c18b..cf43874609 100644
--- a/src/sentry/utils/safe.py
+++ b/src/sentry/utils/safe.py
@@ -5,6 +5,7 @@ sentry.utils.safe
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import logging
 
@@ -25,7 +26,7 @@ def safe_execute(func, *args, **kwargs):
             cls = func.im_class
         else:
             cls = func.__class__
-        logger = logging.getLogger('sentry.errors.plugins')
+        logger = logging.getLogger('sentry.errors')
         logger.error('Error processing %r on %r: %s', func.__name__, cls.__name__, e, extra={
             'func_module': cls.__module__,
             'func_args': args,
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index ccc9ef8ad5..60f5d4761f 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -5,6 +5,8 @@ sentry.web.views
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import datetime
 import logging
 from functools import wraps
@@ -53,8 +55,8 @@ from sentry.web.decorators import has_access
 from sentry.web.frontend.groups import _get_group_list
 from sentry.web.helpers import render_to_response
 
-error_logger = logging.getLogger('sentry.errors.api.http')
-logger = logging.getLogger('sentry.api.http')
+error_logger = logging.getLogger('sentry.errors')
+logger = logging.getLogger('sentry.api')
 
 # Transparent 1x1 gif
 # See http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever
diff --git a/src/sentry/web/frontend/admin.py b/src/sentry/web/frontend/admin.py
index 1f075ed1e4..e6a43daa89 100644
--- a/src/sentry/web/frontend/admin.py
+++ b/src/sentry/web/frontend/admin.py
@@ -5,6 +5,8 @@ sentry.web.frontend.admin
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
+
 import datetime
 import logging
 import pkg_resources
diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index 848b302a0a..f04d3e098a 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import, print_function
+
 import logging
 
 from django.utils.safestring import mark_safe
diff --git a/src/sentry/web/helpers.py b/src/sentry/web/helpers.py
index bebc9ab849..9835e58b55 100644
--- a/src/sentry/web/helpers.py
+++ b/src/sentry/web/helpers.py
@@ -5,6 +5,7 @@ sentry.web.helpers
 :copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
+from __future__ import absolute_import, print_function
 
 import logging
 import warnings
diff --git a/tests/integration/tests.py b/tests/integration/tests.py
index 4692a68e6f..0797d0ab5e 100644
--- a/tests/integration/tests.py
+++ b/tests/integration/tests.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import datetime
 import json
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index 357100235a..ff9436b1ab 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
@@ -10,7 +10,7 @@ from django.conf import settings
 
 from sentry.constants import MAX_CULPRIT_LENGTH
 from sentry.event_manager import EventManager, get_hashes_for_event
-from sentry.models import Event, Group, Project, EventMapping
+from sentry.models import Event, Group, EventMapping
 from sentry.testutils import TestCase
 
 
@@ -48,11 +48,6 @@ class EventManagerTest(TestCase):
         assert EventMapping.objects.filter(
             group=event.group, event_id=event_id).exists()
 
-    def test_invalid_project(self):
-        manager = EventManager(self.make_event())
-        with self.assertRaises(Project.DoesNotExist):
-            event = manager.save(2)
-
     @patch('sentry.manager.GroupManager.add_tags')
     def test_tags_as_list(self, add_tags):
         manager = EventManager(self.make_event(tags=[('foo', 'bar')]))
diff --git a/tests/sentry/web/frontend/projects/tests.py b/tests/sentry/web/frontend/projects/tests.py
index ab17088d5b..f18f7bb793 100644
--- a/tests/sentry/web/frontend/projects/tests.py
+++ b/tests/sentry/web/frontend/projects/tests.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import mock
 import logging
diff --git a/tests/sentry/web/frontend/users/tests.py b/tests/sentry/web/frontend/users/tests.py
index 8d4cce25fa..8ad24eb8d8 100644
--- a/tests/sentry/web/frontend/users/tests.py
+++ b/tests/sentry/web/frontend/users/tests.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
 
-from __future__ import absolute_import
+from __future__ import absolute_import, print_function
 
 import logging
 
diff --git a/tests/sentry/web/views.py b/tests/sentry/web/views.py
index 86b834f71f..924d65b0a1 100644
--- a/tests/sentry/web/views.py
+++ b/tests/sentry/web/views.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import, print_function
+
 from django.http import HttpResponse
 from django.shortcuts import get_object_or_404, render_to_response
 
