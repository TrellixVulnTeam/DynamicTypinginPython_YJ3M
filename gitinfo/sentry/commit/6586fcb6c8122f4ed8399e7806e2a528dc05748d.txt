commit 6586fcb6c8122f4ed8399e7806e2a528dc05748d
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Mon Nov 12 12:17:05 2018 -0800

    ref(features): Improve FeatureDisabled (#10524)
    
    - It can now accept multiple features and will add configuration lines
       for each feature flag to upgrade.
    
     - It will now highlight the configuration code when clicked
    
     - Turning on hideHelpToggle will cause the description to be rendered.

diff --git a/docs-ui/components/featureDisabled.stories.js b/docs-ui/components/featureDisabled.stories.js
index 0616fe1de7..eebd8c7fb6 100644
--- a/docs-ui/components/featureDisabled.stories.js
+++ b/docs-ui/components/featureDisabled.stories.js
@@ -8,7 +8,10 @@ storiesOf('UI|FeatureDisabled', module)
   .add(
     'basic style',
     withInfo('A disabled feature component')(() => (
-      <FeatureDisabled name="Example Feature" feature="organization:example-feature" />
+      <FeatureDisabled
+        name="Example Feature"
+        features={['organization:example-feature', 'organization:example-feature-2']}
+      />
     ))
   )
   .add(
@@ -16,7 +19,7 @@ storiesOf('UI|FeatureDisabled', module)
     withInfo('A disabled feature wrapped in an alert')(() => (
       <FeatureDisabled
         name="Example Feature"
-        feature="organization:example-feature"
+        features={['organization:example-feature']}
         alert
       />
     ))
diff --git a/src/sentry/static/sentry/app/components/acl/featureDisabled.jsx b/src/sentry/static/sentry/app/components/acl/featureDisabled.jsx
index 8331884269..8d30fe9a7e 100644
--- a/src/sentry/static/sentry/app/components/acl/featureDisabled.jsx
+++ b/src/sentry/static/sentry/app/components/acl/featureDisabled.jsx
@@ -3,6 +3,7 @@ import PropTypes from 'prop-types';
 import React from 'react';
 import styled from 'react-emotion';
 
+import {selectText} from 'app/utils/selectText';
 import {t, tct} from 'app/locale';
 import Alert from 'app/components/alert';
 import Button from 'app/components/button';
@@ -11,6 +12,11 @@ import space from 'app/styles/space';
 
 const CONFIG_DOCS_URL = 'https://docs.sentry.io/server/config/';
 
+const installText = (features, featureName) =>
+  `# ${t('Enables the %s feature', featureName)}\n${features
+    .map(f => `SENTRY_FEATURES['${f}'] = True`)
+    .join('\n')}`;
+
 /**
  * DisabledInfo renders a component informing that a feature has been disabled.
  *
@@ -21,15 +27,15 @@ const CONFIG_DOCS_URL = 'https://docs.sentry.io/server/config/';
 class FeatureDisabled extends React.Component {
   static propTypes = {
     /**
-     * The feature flag key that should be uwed in the code example for
+     * The feature flag keys that should be awed in the code example for
      * enabling the feature.
      */
-    feature: PropTypes.string,
+    features: PropTypes.arrayOf(PropTypes.string).isRequired,
     /**
-     * The english name of the feature. This is used in the comment that will
+     * The English name of the feature. This is used in the comment that will
      * be outputted above the example line of code to enable the feature.
      */
-    featureName: PropTypes.string,
+    featureName: PropTypes.string.isRequired,
     /**
      * Render the disabled message within a warning Alert. A custom Alert
      * component may be provided.
@@ -39,7 +45,7 @@ class FeatureDisabled extends React.Component {
      */
     alert: PropTypes.oneOfType([PropTypes.bool, PropTypes.func]),
     /**
-     * Do not show the help toggle.
+     * Do not show the help toggle. The description will always be rendered.
      */
     hideHelpToggle: PropTypes.bool,
     /**
@@ -63,7 +69,8 @@ class FeatureDisabled extends React.Component {
 
   render() {
     const {showHelp} = this.state;
-    const {message, feature, featureName, hideHelpToggle, alert} = this.props;
+    const {message, features, featureName, hideHelpToggle, alert} = this.props;
+    const showDescription = hideHelpToggle || showHelp;
 
     const featureDisabled = (
       <React.Fragment>
@@ -80,7 +87,7 @@ class FeatureDisabled extends React.Component {
             </HelpButton>
           )}
         </Flex>
-        {showHelp && (
+        {showDescription && (
           <HelpDescription>
             <p>
               {tct(
@@ -94,9 +101,8 @@ class FeatureDisabled extends React.Component {
                 }
               )}
             </p>
-            <pre>
-              <code
-              >{`# Enables the ${featureName} feature\nSENTRY_FEATURES['${feature}'] = True`}</code>
+            <pre onClick={e => selectText(e.target)}>
+              <code>{installText(features, featureName)}</code>
             </pre>
           </HelpDescription>
         )}
@@ -127,8 +133,10 @@ const HelpDescription = styled(Box)`
     line-height: 1.5em;
   }
 
-  pre {
+  pre,
+  code {
     margin-bottom: 0;
+    white-space: pre;
   }
 `;
 
diff --git a/src/sentry/static/sentry/app/views/groupDetails/actions.jsx b/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
index 4ae4d2c4e4..4eb17304ab 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/actions.jsx
@@ -34,7 +34,7 @@ class DeleteActions extends React.Component {
     children({
       ...props,
       renderDisabled: ({features}) => (
-        <FeatureDisabled alert featureName="Discard and Delete" feature={features[0]} />
+        <FeatureDisabled alert featureName="Discard and Delete" features={features} />
       ),
     });
 
diff --git a/src/sentry/static/sentry/app/views/projectDataForwarding.jsx b/src/sentry/static/sentry/app/views/projectDataForwarding.jsx
index b42f42e606..67a443763d 100644
--- a/src/sentry/static/sentry/app/views/projectDataForwarding.jsx
+++ b/src/sentry/static/sentry/app/views/projectDataForwarding.jsx
@@ -144,11 +144,7 @@ class ProjectDataForwarding extends AsyncComponent {
             </Alert>
 
             {!hasFeature && (
-              <FeatureDisabled
-                alert
-                featureName="Data Forwarding"
-                feature={features[0]}
-              />
+              <FeatureDisabled alert featureName="Data Forwarding" features={features} />
             )}
 
             <DataForwardingStats params={params} />
diff --git a/src/sentry/static/sentry/app/views/settings/project/projectFilters/projectFiltersSettings.jsx b/src/sentry/static/sentry/app/views/settings/project/projectFilters/projectFiltersSettings.jsx
index e5e5fe5e0a..71c4356e3d 100644
--- a/src/sentry/static/sentry/app/views/settings/project/projectFilters/projectFiltersSettings.jsx
+++ b/src/sentry/static/sentry/app/views/settings/project/projectFilters/projectFiltersSettings.jsx
@@ -181,7 +181,7 @@ class ProjectFiltersSettings extends AsyncComponent {
 
   renderDisabledCustomFilters = p => (
     <FeatureDisabled
-      feature={p.features[0]}
+      features={p.features}
       alert={PanelAlert}
       name={t('Custom Inbound Filters')}
       message={t(
diff --git a/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx b/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
index 19f1491282..911b6fda13 100644
--- a/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
+++ b/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
@@ -199,7 +199,7 @@ class KeyRateLimitsForm extends React.Component {
     let disabledAlert = ({features}) => (
       <FeatureDisabled
         alert={PanelAlert}
-        feature={features[0]}
+        features={features}
         featureName={t('Key Rate Limits')}
       />
     );
diff --git a/tests/js/spec/components/acl/featureDisabled.spec.jsx b/tests/js/spec/components/acl/featureDisabled.spec.jsx
index c74119aab7..2fc82806bd 100644
--- a/tests/js/spec/components/acl/featureDisabled.spec.jsx
+++ b/tests/js/spec/components/acl/featureDisabled.spec.jsx
@@ -9,7 +9,10 @@ describe('FeatureDisabled', function() {
 
   it('renders', function() {
     const wrapper = mount(
-      <FeatureDisabled feature={'organization:my-feature'} featureName="Some Feature" />,
+      <FeatureDisabled
+        features={['organization:my-features']}
+        featureName="Some Feature"
+      />,
       routerContext
     );
 
@@ -29,7 +32,7 @@ describe('FeatureDisabled', function() {
     const wrapper = mount(
       <FeatureDisabled
         message={customMessage}
-        feature={'organization:my-feature'}
+        features={['organization:my-features']}
         featureName="Some Feature"
       />,
       routerContext
@@ -47,7 +50,7 @@ describe('FeatureDisabled', function() {
     const wrapper = mount(
       <FeatureDisabled
         alert
-        feature={'organization:my-feature'}
+        features={['organization:my-features']}
         featureName="Some Feature"
       />,
       routerContext
@@ -60,7 +63,7 @@ describe('FeatureDisabled', function() {
     const wrapper = mount(
       <FeatureDisabled
         alert={PanelAlert}
-        feature={'organization:my-feature'}
+        features={['organization:my-features']}
         featureName="Some Feature"
       />,
       routerContext
@@ -73,7 +76,7 @@ describe('FeatureDisabled', function() {
     const wrapper = mount(
       <FeatureDisabled
         alert
-        feature={'organization:my-feature'}
+        features={['organization:my-features']}
         featureName="Some Feature"
       />,
       routerContext
