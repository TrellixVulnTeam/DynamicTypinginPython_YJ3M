commit edaee3e2041679bd42cd114a10f87d6b4b8a0483
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Sun Mar 6 17:21:12 2016 -0800

    Explicitly don't cache static files if DEBUG is on

diff --git a/src/sentry/web/frontend/generic.py b/src/sentry/web/frontend/generic.py
index 5875a9eee3..c8944b7146 100644
--- a/src/sentry/web/frontend/generic.py
+++ b/src/sentry/web/frontend/generic.py
@@ -7,10 +7,14 @@ sentry.web.frontend.generic
 """
 from __future__ import absolute_import
 
+from django.conf import settings
 from django.views.generic import TemplateView as BaseTemplateView
 
 from sentry.web.helpers import render_to_response
 
+FOREVER_CACHE = 'max-age=315360000'
+NEVER_CACHE = 'max-age=0, no-cache, no-store, must-revalidate'
+
 
 def static_media(request, **kwargs):
     """
@@ -31,9 +35,12 @@ def static_media(request, **kwargs):
     if path.endswith(('.js', '.ttf', '.ttc', '.otf', '.eot', '.woff', '.woff2')):
         response['Access-Control-Allow-Origin'] = '*'
 
-    # If we have a version, we can cache it FOREVER
-    if version is not None:
-        response['Cache-Control'] = 'max-age=315360000'
+    # If we have a version and not DEBUG, we can cache it FOREVER
+    if version is not None and not settings.DEBUG:
+        response['Cache-Control'] = FOREVER_CACHE
+    else:
+        # Otherwise, we explicitly don't want to cache at all
+        response['Cache-Control'] = NEVER_CACHE
 
     return response
 
diff --git a/tests/sentry/web/frontend/generic/test_static_media.py b/tests/sentry/web/frontend/generic/test_static_media.py
index 52c7d42f63..7c8bd8f995 100644
--- a/tests/sentry/web/frontend/generic/test_static_media.py
+++ b/tests/sentry/web/frontend/generic/test_static_media.py
@@ -1,36 +1,48 @@
 from __future__ import absolute_import
 
+from django.test.utils import override_settings
 from sentry.testutils import TestCase
+from sentry.web.frontend.generic import FOREVER_CACHE, NEVER_CACHE
 
 
 class StaticMediaTest(TestCase):
+    @override_settings(DEBUG=False)
     def test_basic(self):
         url = '/_static/sentry/app/index.js'
         response = self.client.get(url)
         assert response.status_code == 200, response
-        assert 'Cache-Control' not in response
+        assert response['Cache-Control'] == NEVER_CACHE
         assert 'Vary' not in response
         assert response['Access-Control-Allow-Origin'] == '*'
 
+    @override_settings(DEBUG=False)
     def test_versioned(self):
         url = '/_static/1234567890/sentry/app/index.js'
         response = self.client.get(url)
         assert response.status_code == 200, response
-        assert 'Cache-Control' in response
+        assert response['Cache-Control'] == FOREVER_CACHE
         assert 'Vary' not in response
         assert response['Access-Control-Allow-Origin'] == '*'
 
         url = '/_static/a43db3b08ddd4918972f80739f15344b/sentry/app/index.js'
         response = self.client.get(url)
         assert response.status_code == 200, response
-        assert 'Cache-Control' in response
+        assert response['Cache-Control'] == FOREVER_CACHE
         assert 'Vary' not in response
         assert response['Access-Control-Allow-Origin'] == '*'
 
+        with override_settings(DEBUG=True):
+            response = self.client.get(url)
+            assert response.status_code == 200, response
+            assert response['Cache-Control'] == NEVER_CACHE
+            assert 'Vary' not in response
+            assert response['Access-Control-Allow-Origin'] == '*'
+
+    @override_settings(DEBUG=False)
     def test_no_cors(self):
         url = '/_static/sentry/images/favicon.ico'
         response = self.client.get(url)
         assert response.status_code == 200, response
-        assert 'Cache-Control' not in response
+        assert response['Cache-Control'] == NEVER_CACHE
         assert 'Vary' not in response
         assert 'Access-Control-Allow-Origin' not in response
