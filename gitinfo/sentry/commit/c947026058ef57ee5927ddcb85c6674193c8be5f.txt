commit c947026058ef57ee5927ddcb85c6674193c8be5f
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 20 13:55:39 2015 -0700

    Basics for api creation/settings

diff --git a/src/sentry/templates/sentry/organization-api-key-settings.html b/src/sentry/templates/sentry/organization-api-key-settings.html
index 7169d15562..5d350a139e 100644
--- a/src/sentry/templates/sentry/organization-api-key-settings.html
+++ b/src/sentry/templates/sentry/organization-api-key-settings.html
@@ -4,38 +4,40 @@
 {% load i18n %}
 {% load sentry_helpers %}
 
-{% block title %}{% trans "API Keys" %} | {{ block.super }}{% endblock %}
+{% block title %}{% trans "API Key Settings" %} | {{ block.super }}{% endblock %}
 
 {% block org_apikeys_nav %}active{% endblock %}
 
 {% block inner %}
   <div class="page-header">
-    <h2>{% trans "API Keys" %}</h2>
+    <h2>{% trans "API Key Settings" %}</h2>
   </div>
 
-  <table class="table simple-list table-bordered member-list">
-    <colgroup>
-      <col width="30%"/>
-      <col width="25%" />
-      <col width="20%"/>
-      <col width="20%"/>
-      <col width="5%"/>
-    </colgroup>
-    <thead>
-      <tr>
-        <th>Key</th>
-        <th>&nbsp;</th>
-      </tr>
-    </thead>
-    <tbody>
-      {% for key in key_list %}
-        <tr>
-          <td>
-            <a href="{% url 'sentry-organization-api-key-settings' organization.slug key.id %}">{{ key.label }}</a>
-          </td>
-          <td></td>
-        </tr>
-      {% endfor %}
-    </tbody>
-  </table>
+  <form class="form-stacked" action="" method="post">
+    {% csrf_token %}
+
+    {% if form.errors %}
+      <div class="alert alert-error">{% trans "Please correct the errors below." %}</div>
+    {% endif %}
+
+    {{ form|as_crispy_errors }}
+
+    <fieldset>
+      <div class="control-group">
+        <label>{% trans "Key" %}</label>
+        <div class="controls">
+          <code class="clippy">{{ key.key }}</code>
+        </div>
+      </div>
+
+      {{ form.label|as_crispy_field }}
+      {{ form.scopes|as_crispy_field }}
+      {{ form.allowed_origins|as_crispy_field }}
+
+    </fieldset>
+
+    <div class="form-actions">
+      <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
+    </div>
+  </form>
 {% endblock %}
diff --git a/src/sentry/templates/sentry/organization-api-keys.html b/src/sentry/templates/sentry/organization-api-keys.html
index 4302baf4ee..2ba6aacef0 100644
--- a/src/sentry/templates/sentry/organization-api-keys.html
+++ b/src/sentry/templates/sentry/organization-api-keys.html
@@ -10,6 +10,12 @@
 
 {% block inner %}
   <div class="page-header">
+    <form class="pull-right" method="POST" action=".">
+      {% csrf_token %}
+      <input type="hidden" name="op" value="newkey" />
+      <button type="submit" class="btn btn-primary">New API Key</button>
+    </form>
+
     <h2>{% trans "API Keys" %}</h2>
   </div>
 
@@ -36,7 +42,7 @@
       {% else %}
         <tr>
           <td colspan="2">
-            <p class="alert-block">You haven't yet created any API keys for this organization. Get started by <a href="#">registering a new api key</a>.</p>
+            <p class="alert-block">You haven't yet created any API keys for this organization.</p>
           </td>
         </tr>
       {% endif %}
diff --git a/src/sentry/web/frontend/organization_api_key_settings.py b/src/sentry/web/frontend/organization_api_key_settings.py
index 7a1d1b4559..8ffed534be 100644
--- a/src/sentry/web/frontend/organization_api_key_settings.py
+++ b/src/sentry/web/frontend/organization_api_key_settings.py
@@ -1,17 +1,28 @@
 from __future__ import absolute_import
 
+from django import forms
+
 from sentry.models import ApiKey, OrganizationMemberType
 from sentry.web.frontend.base import OrganizationView
 
 
+class ApiKeyForm(forms.ModelForm):
+    class Meta:
+        model = ApiKey
+        fields = ('label', 'scopes', 'allowed_origins')
+
+
 class OrganizationApiKeySettingsView(OrganizationView):
     required_access = OrganizationMemberType.ADMIN
 
     def handle(self, request, organization, key_id):
         key = ApiKey.objects.get(organization=organization, id=key_id)
 
+        form = ApiKeyForm(request.POST or None, instance=key)
+
         context = {
             'key': key,
+            'form': form,
         }
 
         return self.respond('sentry/organization-api-key-settings.html', context)
diff --git a/src/sentry/web/frontend/organization_api_keys.py b/src/sentry/web/frontend/organization_api_keys.py
index a19908cc77..2e6ffef027 100644
--- a/src/sentry/web/frontend/organization_api_keys.py
+++ b/src/sentry/web/frontend/organization_api_keys.py
@@ -1,5 +1,8 @@
 from __future__ import absolute_import
 
+from django.core.urlresolvers import reverse
+from django.http import HttpResponseRedirect
+
 from sentry.models import ApiKey, OrganizationMemberType
 from sentry.web.frontend.base import OrganizationView
 
@@ -8,6 +11,13 @@ class OrganizationApiKeysView(OrganizationView):
     required_access = OrganizationMemberType.ADMIN
 
     def handle(self, request, organization):
+        if request.POST.get('op') == 'newkey':
+            key = ApiKey.objects.create(organization=organization)
+            redirect_uri = reverse('sentry-organization-api-key-settings', args=[
+                organization.slug, key.id,
+            ])
+            return HttpResponseRedirect(redirect_uri)
+
         key_list = sorted(ApiKey.objects.filter(
             organization=organization,
         ), key=lambda x: x.label)
