commit b32648465501ac1d64d06be172f25e5758bba75d
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Oct 1 12:11:15 2015 -0700

    Gracefully handle users without identifiers

diff --git a/src/sentry/models/eventuser.py b/src/sentry/models/eventuser.py
index 18d4693006..81db2805ce 100644
--- a/src/sentry/models/eventuser.py
+++ b/src/sentry/models/eventuser.py
@@ -4,7 +4,6 @@ from django.db import models
 from django.utils import timezone
 
 from sentry.db.models import FlexibleForeignKey, Model, sane_repr
-from sentry.utils.cache import memoize
 from sentry.utils.hashlib import md5
 
 
@@ -42,14 +41,11 @@ class EventUser(Model):
         value = self.ident or self.username or self.email or self.ip_address
         return md5(value).hexdigest()
 
-    @memoize
+    @property
     def tag_value(self):
         """
         Return the identifier used with tags to link this user.
         """
-        assert self.ident or self.username or self.email or self.ip_address, \
-            'No identifying value found for user'
-
         if self.ident:
             return u'id:{}'.format(self.ident)
         if self.email:
diff --git a/src/sentry/tasks/post_process.py b/src/sentry/tasks/post_process.py
index cb7508195e..fd9b239e4b 100644
--- a/src/sentry/tasks/post_process.py
+++ b/src/sentry/tasks/post_process.py
@@ -108,6 +108,12 @@ def record_affected_user(event, **kwargs):
         ip_address=user_data.get('ip_address'),
     )
 
+    if not euser.tag_value:
+        # no ident, bail
+        logger.info('No identifying value found for user on event_id=%s',
+                    event.event_id)
+        return
+
     try:
         with transaction.atomic():
             euser.save()
