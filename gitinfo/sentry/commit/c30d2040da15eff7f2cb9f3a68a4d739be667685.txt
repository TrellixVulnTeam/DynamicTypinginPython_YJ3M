commit c30d2040da15eff7f2cb9f3a68a4d739be667685
Author: Chris Adams <chris@improbable.org>
Date:   Wed Sep 15 17:03:54 2010 -0400

    views: better handling of incomplete inputs
    
    * jsapi now returns a HTTP 400 (bad request) instead of an exception
      when no op is specified
    * group now returns a 404 rather than an exception if an invalid gid is
      passed to the view

diff --git a/sentry/views.py b/sentry/views.py
index a24b4f321b..3885ea3385 100644
--- a/sentry/views.py
+++ b/sentry/views.py
@@ -17,8 +17,9 @@ from django.conf import settings as dj_settings
 from django.core.context_processors import csrf
 from django.core.urlresolvers import reverse
 from django.db.models import Count
-from django.http import HttpResponse, HttpResponseForbidden, HttpResponseRedirect
-from django.shortcuts import render_to_response
+from django.http import HttpResponse, HttpResponseBadRequest, \
+    HttpResponseForbidden, HttpResponseRedirect
+from django.shortcuts import render_to_response, get_object_or_404
 from django.template.loader import render_to_string
 from django.utils import simplejson
 from django.utils.datastructures import SortedDict
@@ -125,6 +126,7 @@ def index(request):
 @login_required
 def ajax_handler(request):
     op = request.REQUEST.get('op')
+
     if op == 'poll':
         message_list = GroupedMessage.objects.extra(
             select={
@@ -159,6 +161,8 @@ def ajax_handler(request):
                 'html': render_to_string('sentry/partial/_group.html', {'group': m}),
                 'count': m.times_seen,
             }) for m in [group]]
+    else:
+        return HttpResponseBadRequest()
         
     response = HttpResponse(simplejson.dumps(data))
     response['Content-Type'] = 'application/json'
@@ -166,7 +170,7 @@ def ajax_handler(request):
 
 @login_required
 def group(request, group_id):
-    group = GroupedMessage.objects.get(pk=group_id)
+    group = get_object_or_404(GroupedMessage, pk=group_id)
 
     message_list = group.message_set.all()
     
@@ -237,4 +241,4 @@ def store(request):
 
     GroupedMessage.objects.from_kwargs(**data)
     
-    return HttpResponse()
\ No newline at end of file
+    return HttpResponse()
