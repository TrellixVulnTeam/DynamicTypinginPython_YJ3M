commit b2eb7084ae68aed4b92fab83b688352245960baf
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Dec 5 10:03:45 2014 -0800

    Ensure users can create new organizations

diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index d6c000cfbc..99b87c150c 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -103,15 +103,19 @@
                             <ul class="nav pull-right">
                                 {% block account_nav %}
                                     {% if request.user.is_authenticated %}
-                                        {% if organization and request.user|can_manage_org:organization %}
+                                        {% if organization %}
                                             <li class="dropdown org-dropdown">
                                               <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ organization.name }} <span class="caret"></span></a>
                                               <ul class="dropdown-menu">
-                                                <li><h6><a href="{% url 'sentry-create-organization' %}" class="new pull-right"><span class="icon-plus"></span></a>Organizations</h6></li>
+                                                {% if request.user|can_create_organizations %}
+                                                    <li><h6><a href="{% url 'sentry-create-organization' %}" class="new pull-right"><span class="icon-plus"></span></a>Organizations</h6></li>
+                                                {% endif %}
                                                 {% for o in request.user|list_organizations %}
                                                     <li{% if o == organization %} class="active"{% endif %}>
                                                         <a href="{% url 'sentry-organization-home' o.id %}">{{ o.name }}</a>
-                                                        <a href="{% url 'sentry-organization-settings' o.id %}" class="org-settings"><span class="icon-cog"></span></a>
+                                                        {% if request.user|can_manage_org:o %}
+                                                            <a href="{% url 'sentry-organization-settings' o.id %}" class="org-settings"><span class="icon-cog"></span></a>
+                                                        {% endif %}
                                                     </li>
                                                 {% endfor %}
                                               </ul>
diff --git a/src/sentry/templatetags/sentry_permissions.py b/src/sentry/templatetags/sentry_permissions.py
index 7da03e0c6d..2ae36760ab 100644
--- a/src/sentry/templatetags/sentry_permissions.py
+++ b/src/sentry/templatetags/sentry_permissions.py
@@ -11,14 +11,15 @@ from django import template
 
 from sentry.models import AccessGroup
 from sentry.permissions import (
-    can_create_teams, can_create_projects, can_remove_team, can_remove_project,
-    can_manage_team, can_manage_org
+    can_create_organizations, can_create_teams, can_create_projects,
+    can_remove_team, can_remove_project, can_manage_team, can_manage_org
 )
 
 register = template.Library()
 
 # TODO: Django doesn't seem to introspect function args correctly for filters
 # so we can't just register.filter(can_add_team_member)
+register.filter('can_create_organizations')(lambda a: can_create_organizations(a))
 register.filter('can_create_teams')(lambda a, b: can_create_teams(a, b))
 register.filter('can_create_projects')(lambda a, b: can_create_projects(a, b))
 register.filter('can_manage_team')(lambda a, b: can_manage_team(a, b))
