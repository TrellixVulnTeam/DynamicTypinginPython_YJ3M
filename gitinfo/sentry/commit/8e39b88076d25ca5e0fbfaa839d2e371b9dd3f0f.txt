commit 8e39b88076d25ca5e0fbfaa839d2e371b9dd3f0f
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 30 11:30:49 2015 -0800

    Automatically create default team/membership for new orgs

diff --git a/src/sentry/web/frontend/create_organization.py b/src/sentry/web/frontend/create_organization.py
index 364891b895..4389aecd74 100644
--- a/src/sentry/web/frontend/create_organization.py
+++ b/src/sentry/web/frontend/create_organization.py
@@ -7,7 +7,8 @@ from django.utils.translation import ugettext_lazy as _
 
 from sentry import features, roles
 from sentry.models import (
-    AuditLogEntry, AuditLogEntryEvent, Organization, OrganizationMember
+    AuditLogEntry, AuditLogEntryEvent, Organization, OrganizationMember,
+    OrganizationMemberTeam
 )
 from sentry.web.frontend.base import BaseView
 
@@ -33,12 +34,22 @@ class CreateOrganizationView(BaseView):
         if form.is_valid():
             org = form.save()
 
-            OrganizationMember.objects.create(
+            om = OrganizationMember.objects.create(
                 organization=org,
                 user=request.user,
                 role=roles.get_top_dog().id,
             )
 
+            team = org.team_set.create(
+                name=org.name,
+            )
+
+            OrganizationMemberTeam.objects.create(
+                team=team,
+                organizationmember=om,
+                is_active=True
+            )
+
             AuditLogEntry.objects.create(
                 organization=org,
                 actor=request.user,
@@ -48,9 +59,9 @@ class CreateOrganizationView(BaseView):
                 data=org.get_audit_log_data(),
             )
 
-            url = reverse('sentry-create-team', args=[org.slug])
+            url = reverse('sentry-create-project', args=[org.slug])
 
-            return HttpResponseRedirect(url)
+            return HttpResponseRedirect('{}?team={}'.format(url, team.slug))
 
         context = {
             'form': form,
diff --git a/tests/sentry/web/frontend/test_create_organization.py b/tests/sentry/web/frontend/test_create_organization.py
index 782159bc49..59f89d7cd8 100644
--- a/tests/sentry/web/frontend/test_create_organization.py
+++ b/tests/sentry/web/frontend/test_create_organization.py
@@ -34,5 +34,9 @@ class CreateOrganizationTest(TestCase):
             role='owner',
         ).exists()
 
-        redirect_uri = reverse('sentry-create-team', args=[org.slug])
-        assert resp['Location'] == 'http://testserver%s' % (redirect_uri,)
+        team = org.team_set.get()
+
+        redirect_uri = reverse('sentry-create-project', args=[org.slug])
+        assert resp['Location'] == 'http://testserver%s?team=%s' % (
+            redirect_uri, team.slug,
+        )
