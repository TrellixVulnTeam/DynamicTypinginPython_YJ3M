commit 9f083b7f7c86992fe392dc6c82009b1e70f8e965
Author: Alberto Leal <mail4alberto@gmail.com>
Date:   Thu Oct 31 10:54:58 2019 -0400

    feat(discover2): Allow tags to be saved in Saved Queries (#15359)

diff --git a/src/sentry/api/serializers/models/discoversavedquery.py b/src/sentry/api/serializers/models/discoversavedquery.py
index 6726deae1c..df9952d30f 100644
--- a/src/sentry/api/serializers/models/discoversavedquery.py
+++ b/src/sentry/api/serializers/models/discoversavedquery.py
@@ -23,6 +23,7 @@ class DiscoverSavedQuerySerializer(Serializer):
             "orderby",
             "limit",
             "version",
+            "tags",
         ]
 
         data = {
diff --git a/src/sentry/discover/endpoints/serializers.py b/src/sentry/discover/endpoints/serializers.py
index 785736454a..3cb2bc75a6 100644
--- a/src/sentry/discover/endpoints/serializers.py
+++ b/src/sentry/discover/endpoints/serializers.py
@@ -160,9 +160,10 @@ class DiscoverSavedQuerySerializer(serializers.Serializer):
     environment = ListField(child=serializers.CharField(), required=False, allow_null=True)
     fieldnames = ListField(child=serializers.CharField(), required=False, allow_null=True)
     query = serializers.CharField(required=False, allow_null=True)
+    tags = ListField(child=serializers.CharField(), required=False, allow_null=True)
 
     disallowed_fields = {
-        1: set(["environment", "fieldnames", "query"]),
+        1: set(["environment", "fieldnames", "query", "tags"]),
         2: set(["groupby", "rollup", "aggregations", "conditions", "limit"]),
     }
 
@@ -198,6 +199,7 @@ class DiscoverSavedQuerySerializer(serializers.Serializer):
             "end",
             "orderby",
             "limit",
+            "tags",
         ]
 
         for key in query_keys:
diff --git a/src/sentry/static/sentry/app/stores/discoverSavedQueriesStore.tsx b/src/sentry/static/sentry/app/stores/discoverSavedQueriesStore.tsx
index 8d388d3267..107be5a478 100644
--- a/src/sentry/static/sentry/app/stores/discoverSavedQueriesStore.tsx
+++ b/src/sentry/static/sentry/app/stores/discoverSavedQueriesStore.tsx
@@ -16,6 +16,7 @@ export type NewQuery = {
   start?: string;
   end?: string;
   environment?: Readonly<string[]>;
+  tags?: Readonly<string[]>;
 };
 
 export type SavedQuery = NewQuery & {
diff --git a/src/sentry/static/sentry/app/views/eventsV2/eventView.tsx b/src/sentry/static/sentry/app/views/eventsV2/eventView.tsx
index e7a71e2a16..a825aa6096 100644
--- a/src/sentry/static/sentry/app/views/eventsV2/eventView.tsx
+++ b/src/sentry/static/sentry/app/views/eventsV2/eventView.tsx
@@ -411,7 +411,12 @@ class EventView {
       start: saved.start,
       end: saved.end,
       sorts: fromSorts(saved.orderby),
-      tags: [],
+      tags: collectQueryStringByKey(
+        {
+          tags: (saved as SavedQuery).tags as string[],
+        },
+        'tags'
+      ),
       statsPeriod: saved.range,
       environment: collectQueryStringByKey(
         {
@@ -475,7 +480,7 @@ class EventView {
       fields: this.getFields(),
       fieldnames: this.getFieldNames(),
       orderby,
-      // TODO: tags?
+      tags: this.tags,
       query: this.query || '',
       projects: this.project,
       start: this.start,
diff --git a/tests/js/spec/views/eventsV2/eventView.spec.jsx b/tests/js/spec/views/eventsV2/eventView.spec.jsx
index f01bfda96c..ae4ee8bc72 100644
--- a/tests/js/spec/views/eventsV2/eventView.spec.jsx
+++ b/tests/js/spec/views/eventsV2/eventView.spec.jsx
@@ -534,6 +534,7 @@ describe('EventView.toNewQuery()', function() {
       end: '2019-10-02T00:00:00',
       range: '14d',
       environment: ['staging'],
+      tags: ['foo', 'bar'],
     };
 
     expect(output).toEqual(expected);
@@ -562,6 +563,7 @@ describe('EventView.toNewQuery()', function() {
       end: '2019-10-02T00:00:00',
       range: '14d',
       environment: ['staging'],
+      tags: ['foo', 'bar'],
     };
 
     expect(output).toEqual(expected);
@@ -590,6 +592,7 @@ describe('EventView.toNewQuery()', function() {
       end: '2019-10-02T00:00:00',
       range: '14d',
       environment: ['staging'],
+      tags: ['foo', 'bar'],
     };
 
     expect(output).toEqual(expected);
diff --git a/tests/snuba/api/endpoints/test_discover_saved_queries.py b/tests/snuba/api/endpoints/test_discover_saved_queries.py
index fe5e79809e..3a20eb0f1d 100644
--- a/tests/snuba/api/endpoints/test_discover_saved_queries.py
+++ b/tests/snuba/api/endpoints/test_discover_saved_queries.py
@@ -169,6 +169,7 @@ class DiscoverSavedQueriesVersion2Test(DiscoverSavedQueryBase):
                     "fieldnames": ["event title", "total", "project"],
                     "query": "event.type:error browser.name:Firefox",
                     "range": "24h",
+                    "tags": ["release", "environment"],
                     "version": 2,
                 },
             )
@@ -179,6 +180,7 @@ class DiscoverSavedQueriesVersion2Test(DiscoverSavedQueryBase):
         assert data["range"] == "24h"
         assert data["environment"] == ["dev"]
         assert data["query"] == "event.type:error browser.name:Firefox"
+        assert data["tags"] == ["release", "environment"]
 
     def test_post_success_no_fieldnames(self):
         with self.feature(self.feature_name):
