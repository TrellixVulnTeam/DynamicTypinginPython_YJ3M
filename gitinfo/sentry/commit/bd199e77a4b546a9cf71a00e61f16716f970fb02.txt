commit bd199e77a4b546a9cf71a00e61f16716f970fb02
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 11 19:18:52 2015 -0700

    Add test for disabled plugins

diff --git a/tests/sentry/web/frontend/test_release_webhook.py b/tests/sentry/web/frontend/test_release_webhook.py
index ea6078d41e..a28153527a 100644
--- a/tests/sentry/web/frontend/test_release_webhook.py
+++ b/tests/sentry/web/frontend/test_release_webhook.py
@@ -46,6 +46,7 @@ class ReleaseWebhookTest(TestCase):
     @patch('sentry.plugins.plugins.get')
     def test_valid_signature(self, mock_plugin_get):
         MockPlugin = mock_plugin_get.return_value
+        MockPlugin.is_enabled.return_value = True
         MockReleaseHook = MockPlugin.get_release_hook.return_value
         resp = self.client.post(self.path)
         assert resp.status_code == 204
@@ -53,3 +54,13 @@ class ReleaseWebhookTest(TestCase):
         MockPlugin.get_release_hook.assert_called_once_with()
         MockReleaseHook.assert_called_once_with(self.project)
         MockReleaseHook.return_value.handle.assert_called_once()
+
+    @patch('sentry.plugins.plugins.get')
+    def test_disabled_plugin(self, mock_plugin_get):
+        MockPlugin = mock_plugin_get.return_value
+        MockPlugin.is_enabled.return_value = False
+        MockReleaseHook = MockPlugin.get_release_hook.return_value
+        resp = self.client.post(self.path)
+        assert resp.status_code == 403
+        mock_plugin_get.assert_called_once_with('dummy')
+        assert not MockPlugin.get_release_hook.called
