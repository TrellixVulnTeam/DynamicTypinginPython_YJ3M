commit a2e58742dad6cdbb8a2178ce2d763cc0e69bb486
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Oct 2 14:37:35 2015 -0700

    Enforce check on field name for user attributes

diff --git a/src/sentry/api/endpoints/project_users.py b/src/sentry/api/endpoints/project_users.py
index 12aea0648c..18ed516317 100644
--- a/src/sentry/api/endpoints/project_users.py
+++ b/src/sentry/api/endpoints/project_users.py
@@ -7,13 +7,6 @@ from sentry.api.bases.project import ProjectEndpoint
 from sentry.api.serializers import serialize
 from sentry.models import EventUser
 
-KEYWORD_MAP = {
-    'id': 'ident',
-    'email': 'email',
-    'username': 'username',
-    'ip': 'ip_address',
-}
-
 
 class ProjectUsersEndpoint(ProjectEndpoint):
     doc_section = DocSection.PROJECTS
@@ -44,7 +37,7 @@ class ProjectUsersEndpoint(ProjectEndpoint):
                 return Response([])
             try:
                 queryset = queryset.filter(**{
-                    '{}__icontains'.format(KEYWORD_MAP[pieces[0]]): pieces[1]
+                    '{}__icontains'.format(EventUser.attr_from_keyword(pieces[0])): pieces[1]
                 })
             except KeyError:
                 return Response([])
diff --git a/src/sentry/models/eventuser.py b/src/sentry/models/eventuser.py
index 81db2805ce..c83ef18be3 100644
--- a/src/sentry/models/eventuser.py
+++ b/src/sentry/models/eventuser.py
@@ -6,6 +6,13 @@ from django.utils import timezone
 from sentry.db.models import FlexibleForeignKey, Model, sane_repr
 from sentry.utils.hashlib import md5
 
+KEYWORD_MAP = {
+    'id': 'ident',
+    'email': 'email',
+    'username': 'username',
+    'ip': 'ip_address',
+}
+
 
 class EventUser(Model):
     __core__ = False
@@ -30,6 +37,10 @@ class EventUser(Model):
 
     __repr__ = sane_repr('project_id', 'ident', 'email', 'username', 'ip_address')
 
+    @classmethod
+    def attr_from_keyword(cls, keyword):
+        return KEYWORD_MAP[keyword]
+
     def save(self, *args, **kwargs):
         assert self.ident or self.username or self.email or self.ip_address, \
             'No identifying value found for user'
diff --git a/src/sentry/search/utils.py b/src/sentry/search/utils.py
index 488af414c1..8748bbf2f3 100644
--- a/src/sentry/search/utils.py
+++ b/src/sentry/search/utils.py
@@ -6,12 +6,7 @@ from sentry.utils.auth import find_users
 
 
 def get_user_tag(project, key, value):
-    if key == 'id':
-        lookup = 'ident'
-    elif key == 'ip':
-        lookup = 'ip_address'
-    else:
-        lookup = key
+    lookup = EventUser.attr_from_keyword(key)
 
     # TODO(dcramer): do something with case of multiple matches
     try:
