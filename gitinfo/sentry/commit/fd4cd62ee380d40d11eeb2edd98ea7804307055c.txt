commit fd4cd62ee380d40d11eeb2edd98ea7804307055c
Author: Mark Story <mark@sentry.io>
Date:   Wed Jun 5 12:05:57 2019 -0400

    feat(events-v2) Add raw JSON event URL (#13520)
    
    I also fixed the doubly encoded JSON response in the endpoint.
    
    Refs SEN-708

diff --git a/src/sentry/api/endpoints/project_event_details.py b/src/sentry/api/endpoints/project_event_details.py
index 9e34e4f381..8141a47159 100644
--- a/src/sentry/api/endpoints/project_event_details.py
+++ b/src/sentry/api/endpoints/project_event_details.py
@@ -1,7 +1,5 @@
 from __future__ import absolute_import
 
-import json
-
 from datetime import datetime
 from rest_framework.response import Response
 
@@ -96,4 +94,4 @@ class EventJsonEndpoint(ProjectEndpoint):
         if isinstance(event_dict['datetime'], datetime):
             event_dict['datetime'] = event_dict['datetime'].isoformat()
 
-        return Response(json.dumps(event_dict), status=200)
+        return Response(event_dict, status=200)
diff --git a/src/sentry/static/sentry/app/views/organizationEventsV2/eventDetails.jsx b/src/sentry/static/sentry/app/views/organizationEventsV2/eventDetails.jsx
index d9b5e239b8..12ad971053 100644
--- a/src/sentry/static/sentry/app/views/organizationEventsV2/eventDetails.jsx
+++ b/src/sentry/static/sentry/app/views/organizationEventsV2/eventDetails.jsx
@@ -36,6 +36,7 @@ class EventDetails extends AsyncComponent {
   handleTabChange = tab => this.setState({activeTab: tab});
 
   renderBody() {
+    const {orgId} = this.props.params;
     const [projectId, _] = this.props.eventSlug.split(':');
     return (
       <ModalContainer>
@@ -45,6 +46,7 @@ class EventDetails extends AsyncComponent {
           event={this.state.event}
           activeTab={this.state.activeTab}
           projectId={projectId}
+          orgId={orgId}
         />
       </ModalContainer>
     );
diff --git a/src/sentry/static/sentry/app/views/organizationEventsV2/eventModalContent.jsx b/src/sentry/static/sentry/app/views/organizationEventsV2/eventModalContent.jsx
index 7a59e17b34..3ae788edb4 100644
--- a/src/sentry/static/sentry/app/views/organizationEventsV2/eventModalContent.jsx
+++ b/src/sentry/static/sentry/app/views/organizationEventsV2/eventModalContent.jsx
@@ -76,7 +76,10 @@ ActiveTab.propTypes = {
  * Controlled by the EventDetails View.
  */
 const EventModalContent = props => {
-  const {event, activeTab, projectId, onTabChange} = props;
+  const {event, activeTab, projectId, orgId, onTabChange} = props;
+  const eventJsonUrl = `/api/0/projects/${orgId}/${projectId}/events/${
+    event.eventID
+  }/json/`;
 
   return (
     <ColumnGrid>
@@ -129,7 +132,7 @@ const EventModalContent = props => {
       </ContentColumn>
       <SidebarColumn>
         {event.groupID && <LinkedIssuePreview groupId={event.groupID} />}
-        <EventMetadata event={event} />
+        <EventMetadata event={event} eventJsonUrl={eventJsonUrl} />
         <SidebarBlock>
           <TagsTable tags={event.tags} />
         </SidebarBlock>
@@ -140,6 +143,7 @@ const EventModalContent = props => {
 EventModalContent.propTypes = {
   ...ActiveTab.propTypes,
   onTabChange: PropTypes.func.isRequired,
+  orgId: PropTypes.string.isRequired,
 };
 
 /**
@@ -162,8 +166,7 @@ EventHeader.propTypes = {
  * Render metadata about the event and provide a link to the JSON blob
  */
 const EventMetadata = props => {
-  const jsonUrl = 'TODO build this';
-  const {event} = props;
+  const {event, eventJsonUrl} = props;
 
   return (
     <SidebarBlock withSeparator>
@@ -172,7 +175,7 @@ const EventMetadata = props => {
         <DateTime
           date={getDynamicText({value: event.dateCreated, fixed: 'Dummy timestamp'})}
         />
-        <ExternalLink href={jsonUrl} className="json-link">
+        <ExternalLink href={eventJsonUrl} className="json-link">
           JSON (<FileSize bytes={event.size} />)
         </ExternalLink>
       </MetadataContainer>
@@ -181,6 +184,7 @@ const EventMetadata = props => {
 };
 EventMetadata.propTypes = {
   event: SentryTypes.Event.isRequired,
+  eventJsonUrl: PropTypes.string.isRequired,
 };
 
 const MetadataContainer = styled('div')`
diff --git a/tests/snuba/api/endpoints/test_project_event_details.py b/tests/snuba/api/endpoints/test_project_event_details.py
index 7c9cd65eda..7d910c240b 100644
--- a/tests/snuba/api/endpoints/test_project_event_details.py
+++ b/tests/snuba/api/endpoints/test_project_event_details.py
@@ -1,6 +1,5 @@
 from __future__ import absolute_import
 
-import json
 import six
 
 from datetime import timedelta
@@ -156,7 +155,6 @@ class ProjectEventJsonEndpointTest(APITestCase, SnubaTestCase):
         )
 
     def assert_event(self, data):
-        data = json.loads(data.decode('utf-8'))
         assert data['event_id'] == self.event_id
         assert data['user']['email'] == self.user.email
         assert data['datetime'][:19] == self.min_ago
