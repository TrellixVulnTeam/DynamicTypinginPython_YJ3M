commit 3135d32bdf27691e6266cd3021bf8cbcd911ce3b
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 11 20:52:54 2016 -0800

    Support multiple Postgres databases for migrations

diff --git a/src/sentry/runner/initializer.py b/src/sentry/runner/initializer.py
index 977cd5769b..dddd526f13 100644
--- a/src/sentry/runner/initializer.py
+++ b/src/sentry/runner/initializer.py
@@ -187,13 +187,13 @@ def validate_options(settings):
 
 
 def fix_south(settings):
-    # South needs an adapter defined conditionally
-    if settings.DATABASES['default']['ENGINE'] != 'sentry.db.postgres':
-        return
+    settings.SOUTH_DATABASE_ADAPTERS = {}
 
-    settings.SOUTH_DATABASE_ADAPTERS = {
-        'default': 'south.db.postgresql_psycopg2'
-    }
+    # South needs an adapter defined conditionally
+    for key, value in settings.DATABASES.iteritems():
+        if value['ENGINE'] != 'sentry.db.postgres':
+            continue
+        settings.SOUTH_DATABASE_ADAPTERS[key] = 'south.db.postgresql_psycopg2'
 
 
 def show_big_error(message):
