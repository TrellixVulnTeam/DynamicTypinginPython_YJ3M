commit 7f9e117df7e685c8496f6fcecd3e91d9c8005032
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Sep 18 18:41:30 2017 -0700

    feat(south): Add flag to skip over running dangerous migrations automatically

diff --git a/src/south/management/commands/datamigration.py b/src/south/management/commands/datamigration.py
index 2d7e4a1c38..b772659efb 100644
--- a/src/south/management/commands/datamigration.py
+++ b/src/south/management/commands/datamigration.py
@@ -126,6 +126,10 @@ from django.db import models
 
 class Migration(DataMigration):
 
+    # Flag to indicate if this migration is too risky
+    # to run online and needs to be coordinated for offline
+    is_dangerous = False
+
     def forwards(self, orm):
         db.commit_transaction()
         try:
diff --git a/src/south/management/commands/schemamigration.py b/src/south/management/commands/schemamigration.py
index ed2f298ef1..4deb31b23d 100644
--- a/src/south/management/commands/schemamigration.py
+++ b/src/south/management/commands/schemamigration.py
@@ -232,6 +232,10 @@ from django.db import models
 
 class Migration(SchemaMigration):
 
+    # Flag to indicate if this migration is too risky
+    # to run online and needs to be coordinated for offline
+    is_dangerous = False
+
     def forwards(self, orm):
 %(forwards)s
 
diff --git a/src/south/migration/migrators.py b/src/south/migration/migrators.py
index 5fd782eff3..0f116d5d98 100644
--- a/src/south/migration/migrators.py
+++ b/src/south/migration/migrators.py
@@ -5,6 +5,7 @@ import datetime
 import inspect
 import sys
 import traceback
+import os
 
 from django.core.management import call_command
 from django.core.management.commands import loaddata
@@ -279,6 +280,16 @@ class Forwards(Migrator):
     def orm(migration):
         return migration.orm()
 
+    def run(self, migration, database):
+        if os.environ.get('SOUTH_SKIP_DANGEROUS', '0') == '1' and getattr(
+                migration.migration_instance(), 'is_dangerous', False):
+            # Don't actually run, just record as if ran
+            self.record(migration, database)
+            if self.verbosity:
+                print('   (too dangerous)')
+            return
+        return super(Forwards, self).run(migration, database)
+
     def forwards(self, migration):
         return self._wrap_direction(migration.forwards(), migration.orm())
 
