commit ac248af8e58c6fd318fff5a53352ab0f3853c4eb
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Feb 10 20:58:51 2014 -0800

    test for subscribe_by_default

diff --git a/tests/sentry/plugins/mail/tests.py b/tests/sentry/plugins/mail/tests.py
index aa700bbe2f..9fe8fbc30f 100644
--- a/tests/sentry/plugins/mail/tests.py
+++ b/tests/sentry/plugins/mail/tests.py
@@ -181,10 +181,23 @@ class MailPluginTest(TestCase):
                 sorted(self.plugin.get_sendable_users(project)))
 
         # disabled user2
-        UserOption.objects.create(key='mail:alert', value=0, project=project, user=user2)
+        UserOption.objects.create(key='mail:alert', value=0,
+                                  project=project, user=user2)
 
         assert user2.pk not in self.plugin.get_sendable_users(project)
 
+        user4 = User.objects.create(username='baz4', email='bar@example.com',
+                                    is_active=True)
+        project.team.member_set.get_or_create(user=user4)
+
+        assert user4.pk in self.plugin.get_sendable_users(project)
+
+        # disabled by default user4
+        UserOption.objects.create(key='subscribe_by_default', value='0',
+                                  project=project, user=user4)
+
+        assert user4.pk not in self.plugin.get_sendable_users(project)
+
     @mock.patch('sentry.plugins.sentry_mail.models.MailPlugin._send_mail')
     def test_on_alert(self, _send_mail):
         alert = Alert.objects.create(message='This is a test alert', project=self.project)
