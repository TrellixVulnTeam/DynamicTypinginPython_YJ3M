commit 56c3f1cb4dd242b623fd579c1ec725a7df3c1f0f
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Feb 4 01:23:05 2012 -0800

    Refactor status page to be many separate pages

diff --git a/sentry/templates/sentry/admin/base.html b/sentry/templates/sentry/admin/base.html
index c9d71f03b2..81d7fc7ac3 100644
--- a/sentry/templates/sentry/admin/base.html
+++ b/sentry/templates/sentry/admin/base.html
@@ -6,28 +6,39 @@
 
 {% block page_header %}
     <ul class="breadcrumb">
-        <li><a href="#">Admin</a></li>
+        <li><a href="#">{% trans "Admin" %}</a></li>
         {% block breadcrumb %}{% endblock %}
     </ul>
 {% endblock %}
 
 {% block sidebar %}
-    <h6>Overview</h6>
+    <h6>{% trans "Overview" %}</h6>
     <ul class="nav nav-tabs nav-stacked">
-        <li><a href="{% url sentry-admin-users %}">Users</a></li>
+        <li><a href="{% url sentry-admin-users %}">{% trans "Users" %}</a></li>
     </ul>
 
-    <h6>Plugins</h6>
+    {% with PLUGINS.for_site as plugins %}
+        {% if plugins %}
+            <h6>{% trans "Plugins" %}</h6>
+            <ul class="nav nav-tabs nav-stacked">
+                {% for p in PLUGINS.for_site %}
+                    <li{% if plugin and plugin.slug == p.slug %} class="active"{% endif %}>
+                        <a href="{% url sentry-admin-configure-plugin p.slug %}">{{ p.get_conf_title }}</a>
+                    </li>
+                {% endfor %}
+            </ul>
+        {% endif %}
+    {% endwith %}
+
+    <h6>{% trans "Server Status" %}</h6>
     <ul class="nav nav-tabs nav-stacked">
-        {% for p in PLUGINS.for_site %}
-            <li{% if plugin and plugin.slug == p.slug %} class="active"{% endif %}>
-                <a href="{% url sentry-admin-configure-plugin p.slug %}">{{ p.get_conf_title }}</a>
-            </li>
-        {% endfor %}
+        <li{% block admin-nav-status %}{% endblock %}><a href="{% url sentry-admin-status %}">{% trans "Environment" %}</a></li>
+        <li{% block admin-nav-packages %}{% endblock %}><a href="{% url sentry-admin-packages-status %}">{% trans "Packages" %}</a></li>
+        <li{% block admin-nav-queue %}{% endblock %}><a href="{% url sentry-admin-queue-status %}">{% trans "Queue" %}</a></li>
     </ul>
-    <h6>Utilities</h6>
+    <h6>{% trans "Statistics" %}</h6>
     <ul class="nav nav-tabs nav-stacked">
-        <li{% block admin-nav-status %}{% endblock %}><a href="{% url sentry-admin-status %}">Server Status</a></li>
+        <li{% block admin-nav-stats %}{% endblock %}><a href="{% url sentry-admin-stats %}">{% trans "Overview" %}</a></li>
     </ul>
 {% endblock %}
 
diff --git a/sentry/templates/sentry/admin/stats.html b/sentry/templates/sentry/admin/stats.html
new file mode 100644
index 0000000000..cddffe9233
--- /dev/null
+++ b/sentry/templates/sentry/admin/stats.html
@@ -0,0 +1,32 @@
+{% extends "sentry/admin/base.html" %}
+
+{% block admin-nav-stats %} class="active"{% endblock %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Stats" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    <li class="divider">/</li>
+    <li><a href="{% url sentry-admin-stats %}">{% trans "Stats"</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Statistics" %}</h2>
+    </div>
+    <table class="table vars table-bordered table-zebra">
+        <colgroup>
+            <col style="width:220px">
+        </colgroup>
+        <tbody>
+            {% for key, value in statistics %}
+                <tr>
+                    <td>{{ key }}</td>
+                    <td>{{ value }}</td>
+                </tr>
+            {% endfor %}
+        </tbody>
+    </table>
+{% endblock %}
diff --git a/sentry/templates/sentry/admin/status.html b/sentry/templates/sentry/admin/status.html
deleted file mode 100644
index 7388f2f6ea..0000000000
--- a/sentry/templates/sentry/admin/status.html
+++ /dev/null
@@ -1,210 +0,0 @@
-{% extends "sentry/admin/base.html" %}
-
-{% block admin-nav-status %} class="active"{% endblock %}
-
-{% load i18n %}
-{% load sentry_helpers %}
-
-{% block title %}{% trans "Server Status" %} | {{ block.super }}{% endblock %}
-
-{% block breadcrumb %}
-    <li class="divider">/</li>
-    <li><a href="{% url sentry-admin-status %}">Server Status</a></li>
-{% endblock %}
-
-{% block inner %}
-    <ul class="nav nav-tabs" data-tabs="tabs">
-        <li class="active"><a href="#main" data-toggle="tab">{% trans "Environment" %}</a></li>
-        <li><a href="#packages" data-toggle="tab">{% trans "Packages" %}</a></li>
-        <li><a href="#workers" data-toggle="tab">{% trans "Workers" %}</a></li>
-        <li><a href="#statistics" data-toggle="tab">{% trans "Statistics" %}</a></li>
-    </ul>
-    <div class="tab-content">
-        <div id="main" class="active tab-pane">
-            <div class="page-header">
-                <h2>{% trans "Environment" %}</h2>
-            </div>
-            {% if environment %}
-                <table class="table vars table-bordered table-zebra">
-                    <colgroup>
-                        <col style="width:220px">
-                    </colgroup>
-                    <tbody>
-                        <tr>
-                            <th>{% trans "Server Version" %}</th>
-                            <td>{% sentry_version %}</td>
-                        </tr>
-                        <tr>
-                            <th>{% trans "Python Version" %}</th>
-                            <td>{{ python_version }}</td>
-                        </tr>
-                        <tr>
-                            <th>{% trans "Configuration File" %}</th>
-                            <td>{{ environment.config }}</td>
-                        </tr>
-                        <tr>
-                            <th>{% trans "Uptime" %}</th>
-                            <td>{{ environment.start_date|timesince }} (since {{ environment.start_date|date }})</td>
-                        </tr>
-                    </tbody>
-                </table>
-            {% else %}
-                <p>{% trans "Environment not found (are you using the builtin Sentry webserver?)." %}</p>
-            {% endif %}
-
-            <div class="page-header">
-                <h2>{% trans "Configuration" %}{% if environment.config %} <small>{{ environment.config }}</small>{% endif %}</h2>
-            </div>
-            <table class="table vars table-bordered table-zebra">
-                <colgroup>
-                    <col style="width:220px">
-                </colgroup>
-                <tbody>
-                    {% for key, value in config %}
-                        <tr>
-                            <th>{{ key }}</th>
-                            <td class="code"><pre>{{ value|pprint }}</pre></td>
-                        </tr>
-                    {% endfor %}
-                </tbody>
-            </table>
-        </div>
-        <div id="packages" class="tab-pane">
-            <div class="page-header">
-                <h2>{% trans "Extensions" %}</h2>
-            </div>
-            {% if extensions %}
-                <table class="table vars table-bordered table-zebra">
-                    <colgroup>
-                        <col style="width:220px">
-                    </colgroup>
-                    <tbody>
-                        {% for key, value in extensions %}
-                            <tr>
-                                <th>{{ key }}</th>
-                                <td>{{ value }}</td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            {% else %}
-                <p>{% trans "No extensions registered." %}</p>
-            {% endif %}
-            <div class="page-header">
-                <h2>{% trans "Views" %}</h2>
-            </div>
-            {% if views %}
-                <table class="table vars table-bordered table-zebra">
-                    <colgroup>
-                        <col style="width:220px">
-                    </colgroup>
-                    <tbody>
-                        {% for key, value in views %}
-                            <tr>
-                                <th>{{ key }}</th>
-                                <td>{{ value }}</td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            {% else %}
-                <p>{% trans "No views registered." %}</p>
-            {% endif %}
-            <div class="page-header">
-                <h2>{% trans "Processors" %}</h2>
-            </div>
-            {% if processors %}
-                <table class="table vars table-bordered table-zebra">
-                    <colgroup>
-                        <col style="width:220px">
-                    </colgroup>
-                    <tbody>
-                        {% for key, value in processors %}
-                            <tr>
-                                <th>{{ key }}</th>
-                                <td>{{ value }}</td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            {% else %}
-                <p>{% trans "No event processors registered." %}</p>
-            {% endif %}
-            <div class="page-header">
-                <h2>{% trans "Modules" %}</h2>
-            </div>
-            <table class="table vars table-bordered table-zebra">
-                <colgroup>
-                    <col style="width:220px">
-                </colgroup>
-                <tbody>
-                    {% for key, value in modules %}
-                        <tr>
-                            <th>{{ key }}</th>
-                            <td>{{ value }}</td>
-                        </tr>
-                    {% endfor %}
-                </tbody>
-            </table>
-        </div>
-        {% if worker_status %}
-            <div id="workers" class="tab-pane">
-                <div class="page-header">
-                    <h2>{% trans "Background Processes" %}</h2>
-                </div>
-                {% if background_procs %}
-                    <table class="table vars table-bordered table-zebra">
-                        <colgroup>
-                            <col style="width:220px">
-                        </colgroup>
-                        <tbody>
-                        </tbody>
-                    </table>
-                {% else %}
-                    <p>{% trans "No information available." %}</p>
-                {% endif %}
-                <div class="page-header">
-                    <h2>{% trans "Pending Tasks" %}</h2>
-                </div>
-                <table class="table vars table-bordered table-zebra">
-                    <colgroup>
-                        <col>
-                        <col style="width:150px">
-                    </colgroup>
-                    <thead>
-                        <tr>
-                            <th>{% trans "Queue" %}</th>
-                            <th>{% trans "Pending Tasks" %}</th>
-                        </tr>
-                    </thead>
-                    <tbody>
-                        {% for queue, num_pending in pending_tasks %}
-                            <tr>
-                                <td>{{ queue }}</td>
-                                <td>{{ num_pending }}</td>
-                            </tr>
-                        {% endfor %}
-                    </tbody>
-                </table>
-            </div>
-        {% endif %}
-        <div id="statistics" class="tab-pane">
-            <div class="page-header">
-                <h2>{% trans "Statistics" %}</h2>
-            </div>
-            <table class="table vars table-bordered table-zebra">
-                <colgroup>
-                    <col style="width:220px">
-                </colgroup>
-                <tbody>
-                    {% for key, value in statistics %}
-                        <tr>
-                            <td>{{ key }}</td>
-                            <td>{{ value }}</td>
-                        </tr>
-                    {% endfor %}
-                </tbody>
-            </table>
-        </div>
-    </div>
-{% endblock %}
diff --git a/sentry/templates/sentry/admin/status/env.html b/sentry/templates/sentry/admin/status/env.html
new file mode 100644
index 0000000000..d3fc106c88
--- /dev/null
+++ b/sentry/templates/sentry/admin/status/env.html
@@ -0,0 +1,63 @@
+{% extends "sentry/admin/base.html" %}
+
+{% block admin-nav-status %} class="active"{% endblock %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Server Status" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    <li class="divider">/</li>
+    <li><a href="{% url sentry-admin-status %}">{% trans "Server Status" %}</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Environment" %}</h2>
+    </div>
+    {% if environment %}
+        <table class="table vars table-bordered table-zebra">
+            <colgroup>
+                <col style="width:220px">
+            </colgroup>
+            <tbody>
+                <tr>
+                    <th>{% trans "Server Version" %}</th>
+                    <td>{% sentry_version %}</td>
+                </tr>
+                <tr>
+                    <th>{% trans "Python Version" %}</th>
+                    <td>{{ python_version }}</td>
+                </tr>
+                <tr>
+                    <th>{% trans "Configuration File" %}</th>
+                    <td>{{ environment.config }}</td>
+                </tr>
+                <tr>
+                    <th>{% trans "Uptime" %}</th>
+                    <td>{{ environment.start_date|timesince }} (since {{ environment.start_date|date }})</td>
+                </tr>
+            </tbody>
+        </table>
+    {% else %}
+        <p>{% trans "Environment not found (are you using the builtin Sentry webserver?)." %}</p>
+    {% endif %}
+
+    <div class="page-header">
+        <h2>{% trans "Configuration" %}{% if environment.config %} <small>{{ environment.config }}</small>{% endif %}</h2>
+    </div>
+    <table class="table vars table-bordered table-zebra">
+        <colgroup>
+            <col style="width:220px">
+        </colgroup>
+        <tbody>
+            {% for key, value in config %}
+                <tr>
+                    <th>{{ key }}</th>
+                    <td class="code"><pre>{{ value|pprint }}</pre></td>
+                </tr>
+            {% endfor %}
+        </tbody>
+    </table>
+{% endblock %}
diff --git a/sentry/templates/sentry/admin/status/packages.html b/sentry/templates/sentry/admin/status/packages.html
new file mode 100644
index 0000000000..aa829d16f6
--- /dev/null
+++ b/sentry/templates/sentry/admin/status/packages.html
@@ -0,0 +1,92 @@
+{% extends "sentry/admin/base.html" %}
+
+{% block admin-nav-packages %} class="active"{% endblock %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Packages" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    <li class="divider">/</li>
+    <li><a href="{% url sentry-admin-packages-status %}">{% trans "Packages" %}</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Extensions" %}</h2>
+    </div>
+    {% if extensions %}
+        <table class="table vars table-bordered table-zebra">
+            <colgroup>
+                <col style="width:220px">
+            </colgroup>
+            <tbody>
+                {% for key, value in extensions %}
+                    <tr>
+                        <th>{{ key }}</th>
+                        <td>{{ value }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% else %}
+        <p>{% trans "No extensions registered." %}</p>
+    {% endif %}
+    <div class="page-header">
+        <h2>{% trans "Views" %}</h2>
+    </div>
+    {% if views %}
+        <table class="table vars table-bordered table-zebra">
+            <colgroup>
+                <col style="width:220px">
+            </colgroup>
+            <tbody>
+                {% for key, value in views %}
+                    <tr>
+                        <th>{{ key }}</th>
+                        <td>{{ value }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% else %}
+        <p>{% trans "No views registered." %}</p>
+    {% endif %}
+    <div class="page-header">
+        <h2>{% trans "Processors" %}</h2>
+    </div>
+    {% if processors %}
+        <table class="table vars table-bordered table-zebra">
+            <colgroup>
+                <col style="width:220px">
+            </colgroup>
+            <tbody>
+                {% for key, value in processors %}
+                    <tr>
+                        <th>{{ key }}</th>
+                        <td>{{ value }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    {% else %}
+        <p>{% trans "No event processors registered." %}</p>
+    {% endif %}
+    <div class="page-header">
+        <h2>{% trans "Modules" %}</h2>
+    </div>
+    <table class="table vars table-bordered table-zebra">
+        <colgroup>
+            <col style="width:220px">
+        </colgroup>
+        <tbody>
+            {% for key, value in modules %}
+                <tr>
+                    <th>{{ key }}</th>
+                    <td>{{ value }}</td>
+                </tr>
+            {% endfor %}
+        </tbody>
+    </table>
+{% endblock %}
diff --git a/sentry/templates/sentry/admin/status/queue.html b/sentry/templates/sentry/admin/status/queue.html
new file mode 100644
index 0000000000..183f2e934b
--- /dev/null
+++ b/sentry/templates/sentry/admin/status/queue.html
@@ -0,0 +1,55 @@
+{% extends "sentry/admin/base.html" %}
+
+{% block admin-nav-queue %} class="active"{% endblock %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Queue Status" %} | {{ block.super }}{% endblock %}
+
+{% block breadcrumb %}
+    <li class="divider">/</li>
+    <li><a href="{% url sentry-admin-queue-status %}">{% trans "Queue Status" %}</a></li>
+{% endblock %}
+
+{% block inner %}
+    <div id="workers" class="tab-pane">
+        <div class="page-header">
+            <h2>{% trans "Background Processes" %}</h2>
+        </div>
+        {% if background_procs %}
+            <table class="table vars table-bordered table-zebra">
+                <colgroup>
+                    <col style="width:220px">
+                </colgroup>
+                <tbody>
+                </tbody>
+            </table>
+        {% else %}
+            <p>{% trans "No information available." %}</p>
+        {% endif %}
+        <div class="page-header">
+            <h2>{% trans "Pending Tasks" %}</h2>
+        </div>
+        <table class="table vars table-bordered table-zebra">
+            <colgroup>
+                <col>
+                <col style="width:150px">
+            </colgroup>
+            <thead>
+                <tr>
+                    <th>{% trans "Queue" %}</th>
+                    <th>{% trans "Pending Tasks" %}</th>
+                </tr>
+            </thead>
+            <tbody>
+                {% for queue, num_pending in pending_tasks %}
+                    <tr>
+                        <td>{{ queue }}</td>
+                        <td>{{ num_pending }}</td>
+                    </tr>
+                {% endfor %}
+            </tbody>
+        </table>
+    </div>
+{% endblock %}
diff --git a/sentry/web/frontend/admin.py b/sentry/web/frontend/admin.py
index 4199aee13f..65e2a42327 100644
--- a/sentry/web/frontend/admin.py
+++ b/sentry/web/frontend/admin.py
@@ -170,7 +170,26 @@ def remove_user(request, user_id):
 
 
 @requires_admin
-def status(request):
+def status_env(request):
+    config = []
+    for k in sorted(dir(settings)):
+        if k == 'KEY':
+            continue
+        if k.startswith('_'):
+            continue
+        if k.upper() != k:
+            continue
+        config.append((k, getattr(settings, k)))
+
+    return render_to_response('sentry/admin/status/env.html', {
+        'python_version': sys.version,
+        'config': config,
+        'environment': environment,
+    }, request)
+
+
+@requires_admin
+def status_packages(request):
     from sentry.views import View
 
     config = []
@@ -183,6 +202,15 @@ def status(request):
             continue
         config.append((k, getattr(settings, k)))
 
+    return render_to_response('sentry/admin/status/packages.html', {
+        'modules': sorted([(p.project_name, p.version) for p in pkg_resources.working_set]),
+        'extensions': [(p.get_title(), '%s.%s' % (p.__module__, p.__class__.__name__)) for p in plugins.all()],
+        'views': [(x.__class__.__name__, x.__module__) for x in View.objects.all()],
+    }, request)
+
+
+@requires_admin
+def status_queue(request):
     worker_status = (settings.QUEUE['transport'] == 'djkombu.transport.DatabaseTransport')
     if worker_status:
         pending_tasks = list(Queue.objects.filter(
@@ -195,6 +223,14 @@ def status(request):
     else:
         pending_tasks = None
 
+    return render_to_response('sentry/admin/status/queue.html', {
+        'pending_tasks': pending_tasks,
+        'worker_status': worker_status,
+    }, request)
+
+
+@requires_admin
+def stats(request):
     statistics = (
         ('Projects', Project.objects.count()),
         ('Projects (24h)', Project.objects.filter(
@@ -206,14 +242,6 @@ def status(request):
         ).aggregate(x=Sum('times_seen'))['x'] or 0)
     )
 
-    return render_to_response('sentry/admin/status.html', {
-        'config': config,
-        'environment': environment,
-        'python_version': sys.version,
-        'modules': sorted([(p.project_name, p.version) for p in pkg_resources.working_set]),
-        'extensions': [(p.get_title(), '%s.%s' % (p.__module__, p.__class__.__name__)) for p in plugins.all()],
-        'views': [(x.__class__.__name__, x.__module__) for x in View.objects.all()],
-        'pending_tasks': pending_tasks,
-        'worker_status': worker_status,
+    return render_to_response('sentry/admin/stats.html', {
         'statistics': statistics,
     }, request)
diff --git a/sentry/web/urls.py b/sentry/web/urls.py
index a03d19c8b6..0e6b81cd8e 100644
--- a/sentry/web/urls.py
+++ b/sentry/web/urls.py
@@ -56,7 +56,10 @@ urlpatterns = patterns('',
     # Global
 
     url(r'^$', generic.dashboard, name='sentry'),
-    url(r'^manage/status/$', admin.status, name='sentry-admin-status'),
+    url(r'^manage/status/$', admin.status_env, name='sentry-admin-status'),
+    url(r'^manage/status/packages/$', admin.status_packages, name='sentry-admin-packages-status'),
+    url(r'^manage/status/queue/$', admin.status_queue, name='sentry-admin-queue-status'),
+    url(r'^manage/stats/$', admin.stats, name='sentry-admin-stats'),
     url(r'^manage/users/$', admin.manage_users, name='sentry-admin-users'),
     url(r'^manage/users/new/$', admin.create_new_user, name='sentry-admin-new-user'),
     url(r'^manage/users/(?P<user_id>\d+)/$', admin.edit_user, name='sentry-admin-edit-user'),
