commit e404faa519dd242596cc2d2c3d50db07f90e9287
Author: Mark Story <mark@mark-story.com>
Date:   Wed Aug 29 13:51:32 2018 -0700

    feat(config) Add mail transport timeout
    
    Add ability to define a mail transport timeout. This allows small instances of Sentry where our email is handled externally by Office365, somewhere in `smtplib` a timeout is being hit, either during connection or whilst sending email. On the application level, I've solved this by upping the timeouts to 30 seconds. Thought it would be useful to other Sentry users if this was something we could set in the config file. Setting the default value to 10 seconds.

diff --git a/src/sentry/options/defaults.py b/src/sentry/options/defaults.py
index 2d55719c5b..841d4bbc08 100644
--- a/src/sentry/options/defaults.py
+++ b/src/sentry/options/defaults.py
@@ -16,7 +16,7 @@ from sentry.options import (
     FLAG_ALLOW_EMPTY,
     register,
 )
-from sentry.utils.types import Bool, Dict, String, Sequence
+from sentry.utils.types import Bool, Dict, String, Sequence, Int
 
 # Cache
 # register('cache.backend', flags=FLAG_NOSTORE)
@@ -72,6 +72,7 @@ register('mail.list-namespace', type=String, default='localhost', flags=FLAG_NOS
 register('mail.enable-replies', default=False, flags=FLAG_PRIORITIZE_DISK)
 register('mail.reply-hostname', default='', flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
 register('mail.mailgun-api-key', default='', flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
+register('mail.timeout', default=10, type=Int, flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
 
 # SMS
 register('sms.twilio-account', default='', flags=FLAG_ALLOW_EMPTY | FLAG_PRIORITIZE_DISK)
diff --git a/src/sentry/utils/email.py b/src/sentry/utils/email.py
index 3a16cdc93e..741acfe403 100644
--- a/src/sentry/utils/email.py
+++ b/src/sentry/utils/email.py
@@ -463,6 +463,7 @@ def get_connection(fail_silently=False):
         username=options.get('mail.username'),
         password=options.get('mail.password'),
         use_tls=options.get('mail.use-tls'),
+        timeout=options.get('mail.timeout'),
         fail_silently=fail_silently,
     )
 
