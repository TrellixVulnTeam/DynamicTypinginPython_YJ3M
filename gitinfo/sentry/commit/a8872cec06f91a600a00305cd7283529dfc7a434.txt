commit a8872cec06f91a600a00305cd7283529dfc7a434
Author: William Mak <william@wmak.io>
Date:   Tue Nov 26 11:15:40 2019 -0500

    fix(apple-crash-report): Updating deprecated debug_image fields (#15749)
    
    * fix(apple-crash-report): Name was deprecated for code file
    
    - Updates use of `name` to `code_file`
    - Since `code_file` is optional, using the same .get() or unknown
      pattern.

diff --git a/src/sentry/lang/native/applecrashreport.py b/src/sentry/lang/native/applecrashreport.py
index 413989af05..e2b64f890f 100644
--- a/src/sentry/lang/native/applecrashreport.py
+++ b/src/sentry/lang/native/applecrashreport.py
@@ -173,8 +173,8 @@ class AppleCrashReport(object):
         return "%s - %s %s %s  <%s> %s" % (
             hex(image_addr),
             hex(image_addr + debug_image["image_size"] - 1),
-            image_name(debug_image["name"]),
+            image_name(debug_image.get("code_file") or NATIVE_UNKNOWN_STRING),
             self.context["device"]["arch"],
             (debug_image.get("id") or debug_image.get("uuid")).replace("-", "").lower(),
-            debug_image["name"],
+            debug_image.get("code_file") or NATIVE_UNKNOWN_STRING,
         )
diff --git a/tests/sentry/lang/native/test_applecrashreport.py b/tests/sentry/lang/native/test_applecrashreport.py
index f3769b6357..c0686e73e0 100644
--- a/tests/sentry/lang/native/test_applecrashreport.py
+++ b/tests/sentry/lang/native/test_applecrashreport.py
@@ -1,5 +1,6 @@
 from __future__ import absolute_import
 
+from sentry.constants import NATIVE_UNKNOWN_STRING
 from sentry.lang.native.applecrashreport import AppleCrashReport
 
 
@@ -374,33 +375,27 @@ def test_get_binary_images_apple_string():
     acr = AppleCrashReport(
         debug_images=[
             {
-                "cpu_subtype": 3,
-                "cpu_type": 16777223,
                 "image_addr": "0x141c5000",
                 "image_size": 20480,
                 "image_vmaddr": "0x0",
-                "name": "/Users/haza/Library/Developer/CoreSimulator/Devices/DDB32F4C-97CF-4E2B-BD10-EB940553F223/data/Containers/Bundle/Application/8C286977-D498-44FF-B7BE-42BFE3DE38BD/SwiftExample.app/Frameworks/libswiftContacts.dylib",
-                "type": "apple",
+                "code_file": "/Users/haza/Library/Developer/CoreSimulator/Devices/DDB32F4C-97CF-4E2B-BD10-EB940553F223/data/Containers/Bundle/Application/8C286977-D498-44FF-B7BE-42BFE3DE38BD/SwiftExample.app/Frameworks/libswiftContacts.dylib",
+                "type": "native",
                 "uuid": "4B5A054F-B7A1-3AD0-81E1-513B4DBE2A33",
             },
             {
-                "cpu_subtype": 3,
-                "cpu_type": 16777223,
                 "image_addr": "0x1400c000",
                 "image_size": 266240,
                 "image_vmaddr": "0x0",
-                "name": "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/PrivateFrameworks/ContentIndex.framework/ContentIndex",
-                "type": "apple",
+                "code_file": "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/PrivateFrameworks/ContentIndex.framework/ContentIndex",
+                "type": "native",
                 "uuid": "766DFB14-72EE-32D2-8961-687D32548F2B",
             },
             {
-                "cpu_subtype": 3,
-                "cpu_type": 16777223,
                 "image_addr": "0x1406f000",
                 "image_size": 913408,
                 "image_vmaddr": "0x0",
-                "name": "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/PrivateFrameworks/CorePDF.framework/CorePDF",
-                "type": "apple",
+                "code_file": "/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/PrivateFrameworks/CorePDF.framework/CorePDF",
+                "type": "native",
                 "uuid": "BE602DC1-D3A0-3389-B8F4-922C37DEA3DC",
             },
         ],
@@ -437,6 +432,66 @@ def test_get_binary_images_apple_string():
     )
 
 
+def test_binary_images_without_code_file():
+    acr = AppleCrashReport(
+        debug_images=[
+            {
+                "image_addr": "0x141c5000",
+                "image_size": 20480,
+                "image_vmaddr": "0x0",
+                "type": "native",
+                "uuid": "4B5A054F-B7A1-3AD0-81E1-513B4DBE2A33",
+            },
+            {
+                "image_addr": "0x1400c000",
+                "image_size": 266240,
+                "image_vmaddr": "0x0",
+                "type": "native",
+                "uuid": "766DFB14-72EE-32D2-8961-687D32548F2B",
+            },
+            {
+                "image_addr": "0x1406f000",
+                "image_size": 913408,
+                "image_vmaddr": "0x0",
+                "type": "native",
+                "uuid": "BE602DC1-D3A0-3389-B8F4-922C37DEA3DC",
+            },
+        ],
+        context={
+            "device": {
+                "arch": "x86",
+                "family": "iPhone",
+                "freeMemory": 169684992,
+                "memorySize": 17179869184,
+                "model": "iPhone9,1",
+                "simulator": True,
+                "storageSize": 249695305728,
+                "type": "device",
+                "usableMemory": 14919622656,
+            },
+            "os": {
+                "build": "16C67",
+                "bundleID": "com.rokkincat.SentryExample",
+                "bundleVersion": "2",
+                "kernel_version": "Darwin Kernel Version 16.3.0: Thu Nov 17 20:23:58 PST 2016; root:xnu-3789.31.2~1/RELEASE_X86_64",
+                "name": "iOS",
+                "type": "os",
+                "version": "10.2",
+            },
+        },
+    )
+    binary_images = acr.get_binary_images_apple_string()
+    assert (
+        binary_images
+        == "Binary Images:\n\
+0x1400c000 - 0x1404cfff {0} x86  <766dfb1472ee32d28961687d32548f2b> {0}\n\
+0x1406f000 - 0x1414dfff {0} x86  <be602dc1d3a03389b8f4922c37dea3dc> {0}\n\
+0x141c5000 - 0x141c9fff {0} x86  <4b5a054fb7a13ad081e1513b4dbe2a33> {0}".format(
+            NATIVE_UNKNOWN_STRING
+        )
+    )
+
+
 def test__convert_debug_meta_to_binary_image_row():
     acr = AppleCrashReport(
         context={
@@ -469,7 +524,7 @@ def test__convert_debug_meta_to_binary_image_row():
             "image_addr": "0xd69a000",
             "image_size": 495616,
             "image_vmaddr": "0x0",
-            "name": "/Users/haza/Library/Developer/CoreSimulator/Devices/DDB32F4C-97CF-4E2B-BD10-EB940553F223/data/Containers/Bundle/Application/8F8140DF-B25B-4088-B5FB-57F474A49CD6/SwiftExample.app/Frameworks/SentrySwift.framework/SentrySwift",
+            "code_file": "/Users/haza/Library/Developer/CoreSimulator/Devices/DDB32F4C-97CF-4E2B-BD10-EB940553F223/data/Containers/Bundle/Application/8F8140DF-B25B-4088-B5FB-57F474A49CD6/SwiftExample.app/Frameworks/SentrySwift.framework/SentrySwift",
             "type": "apple",
             "uuid": "B427AE1D-BF36-3B50-936F-D78A7D1C8340",
         }
