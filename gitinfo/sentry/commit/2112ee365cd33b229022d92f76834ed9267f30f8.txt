commit 2112ee365cd33b229022d92f76834ed9267f30f8
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Tue Feb 26 14:59:07 2019 -0800

    ref(tagstore): Support passing start and end to get_groups_user_counts for snuba

diff --git a/src/sentry/tagstore/base.py b/src/sentry/tagstore/base.py
index ef388d302d..bf9fea132c 100644
--- a/src/sentry/tagstore/base.py
+++ b/src/sentry/tagstore/base.py
@@ -353,9 +353,11 @@ class TagStorage(Service):
         """
         raise NotImplementedError
 
-    def get_groups_user_counts(self, project_ids, group_ids, environment_ids):
+    def get_groups_user_counts(self, project_ids, group_ids, environment_ids,
+                               start=None, end=None):
         """
         >>> get_groups_user_counts([1, 2], [2, 3], [4, 5])
+        `start` and `end` are only used by the snuba backend
         """
         raise NotImplementedError
 
diff --git a/src/sentry/tagstore/legacy/backend.py b/src/sentry/tagstore/legacy/backend.py
index 82d96a8a23..d9b717dc1a 100644
--- a/src/sentry/tagstore/legacy/backend.py
+++ b/src/sentry/tagstore/legacy/backend.py
@@ -499,7 +499,7 @@ class LegacyTagStorage(TagStorage):
 
         return {'id__in': set(matches)}
 
-    def get_groups_user_counts(self, project_ids, group_ids, environment_ids):
+    def get_groups_user_counts(self, project_ids, group_ids, environment_ids, start=None, end=None):
         # only the snuba backend supports multi project
         if len(project_ids) > 1:
             raise NotImplementedError
diff --git a/src/sentry/tagstore/snuba/backend.py b/src/sentry/tagstore/snuba/backend.py
index c0c1adad4d..4e39e17ee2 100644
--- a/src/sentry/tagstore/snuba/backend.py
+++ b/src/sentry/tagstore/snuba/backend.py
@@ -523,8 +523,9 @@ class SnubaTagStorage(TagStorage):
                 )
         return values
 
-    def get_groups_user_counts(self, project_ids, group_ids, environment_ids):
-        start, end = self.get_time_range()
+    def get_groups_user_counts(self, project_ids, group_ids, environment_ids, start=None, end=None):
+        if start is None or end is None:
+            start, end = self.get_time_range()
         filters = {
             'project_id': project_ids,
             'issue': group_ids,
diff --git a/src/sentry/tagstore/v2/backend.py b/src/sentry/tagstore/v2/backend.py
index dbd475f55a..7b76954929 100644
--- a/src/sentry/tagstore/v2/backend.py
+++ b/src/sentry/tagstore/v2/backend.py
@@ -757,7 +757,7 @@ class V2TagStorage(TagStorage):
 
         return {'id__in': set(matches)}
 
-    def get_groups_user_counts(self, project_ids, group_ids, environment_ids):
+    def get_groups_user_counts(self, project_ids, group_ids, environment_ids, start=None, end=None):
         # only the snuba backend supports multi project/env
         if len(project_ids) > 1 or environment_ids and len(environment_ids) > 1:
             raise NotImplementedError
diff --git a/tests/snuba/tagstore/test_tagstore_backend.py b/tests/snuba/tagstore/test_tagstore_backend.py
index 61e3f032c2..b38fc46507 100644
--- a/tests/snuba/tagstore/test_tagstore_backend.py
+++ b/tests/snuba/tagstore/test_tagstore_backend.py
@@ -257,6 +257,15 @@ class TagStorageTest(SnubaTestCase):
             self.proj1group2.id: 1,
         }
 
+        # test filtering by date range where there shouldn't be results
+        assert self.ts.get_groups_user_counts(
+            project_ids=[self.proj1.id],
+            group_ids=[self.proj1group1.id, self.proj1group2.id],
+            environment_ids=[self.proj1env1.id],
+            start=self.now - timedelta(days=5),
+            end=self.now - timedelta(days=4),
+        ) == {}
+
     def test_get_releases(self):
         assert self.ts.get_first_release(
             project_id=self.proj1.id,
