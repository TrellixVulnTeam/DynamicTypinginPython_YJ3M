commit d060834232602ed8e0681bd8c60de058f59f6bf9
Author: Mark Story <mark@sentry.io>
Date:   Mon Jul 22 09:45:33 2019 -0400

    fix(ui) Fix missing conditions in tag bars (#14063)
    
    The tag distribution bars were not being passed the view query prefix
    resulting in CSP totals always being incorrect.
    
    Fixes SEN-847

diff --git a/src/sentry/static/sentry/app/views/organizationEventsV2/tags.jsx b/src/sentry/static/sentry/app/views/organizationEventsV2/tags.jsx
index 680a378c7e..c377156943 100644
--- a/src/sentry/static/sentry/app/views/organizationEventsV2/tags.jsx
+++ b/src/sentry/static/sentry/app/views/organizationEventsV2/tags.jsx
@@ -56,7 +56,7 @@ class Tags extends React.Component {
           api,
           organization.slug,
           tag,
-          location.query
+          getQuery(view, location)
         );
 
         this.setState(state => ({tags: {...state.tags, [tag]: val}}));
diff --git a/tests/js/spec/views/organizationEventsV2/tags.spec.jsx b/tests/js/spec/views/organizationEventsV2/tags.spec.jsx
index 43dfad776b..771f216258 100644
--- a/tests/js/spec/views/organizationEventsV2/tags.spec.jsx
+++ b/tests/js/spec/views/organizationEventsV2/tags.spec.jsx
@@ -18,7 +18,7 @@ describe('Tags', function() {
         },
       },
       {
-        predicate: (url, options) => {
+        predicate: (_, options) => {
           return options.query.key === 'release';
         },
       }
@@ -35,8 +35,11 @@ describe('Tags', function() {
         },
       },
       {
-        predicate: (url, options) => {
-          return options.query.key === 'environment';
+        predicate: (_, options) => {
+          return (
+            options.query.key === 'environment' &&
+            options.query.query === 'event.type:csp'
+          );
         },
       }
     );
@@ -58,7 +61,9 @@ describe('Tags', function() {
     const view = {
       id: 'test',
       name: 'Test',
-      data: {},
+      data: {
+        query: 'event.type:csp',
+      },
       tags: ['release', 'environment'],
     };
     const wrapper = mount(
