commit a28d9b0465d8aaf2a08318c3607e6fa29699e3c1
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Dec 5 10:44:03 2014 -0800

    Add sudo_required attribute to BaseView

diff --git a/src/sentry/web/frontend/base.py b/src/sentry/web/frontend/base.py
index 52e8ba2f05..23e25a88e1 100644
--- a/src/sentry/web/frontend/base.py
+++ b/src/sentry/web/frontend/base.py
@@ -8,6 +8,8 @@ from django.http import HttpResponseRedirect
 from django.utils.decorators import method_decorator
 from django.views.decorators.csrf import csrf_protect
 from django.views.generic import View
+from sudo.utils import has_sudo_privileges
+from sudo.views import redirect_to_sudo
 
 from sentry.models import Organization, Project, Team
 from sentry.web.helpers import get_login_url, render_to_response
@@ -121,6 +123,8 @@ class OrganizationMixin(object):
 
 class BaseView(View, OrganizationMixin):
     auth_required = True
+    # TODO(dcramer): change sudo so it can be required only on POST
+    sudo_required = False
 
     @method_decorator(csrf_protect)
     def dispatch(self, request, *args, **kwargs):
@@ -128,6 +132,9 @@ class BaseView(View, OrganizationMixin):
             request.session['_next'] = request.get_full_path()
             return self.redirect(get_login_url())
 
+        if self.sudo_required and not has_sudo_privileges(request):
+            return redirect_to_sudo(request.get_full_path())
+
         args, kwargs = self.convert_args(request, *args, **kwargs)
 
         if not self.has_permission(request, *args, **kwargs):
