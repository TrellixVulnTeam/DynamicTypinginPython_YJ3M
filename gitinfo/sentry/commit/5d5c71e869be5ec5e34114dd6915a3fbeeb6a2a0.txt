commit 5d5c71e869be5ec5e34114dd6915a3fbeeb6a2a0
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Jan 10 16:00:13 2019 -0800

    feat(user): Add "activeorg" to initial react payload (#9849)
    
    This will add the users last "active" org to the initial react payload. Use this only on an initial load to a view that does not have an organization in context.

diff --git a/src/sentry/static/sentry/app/utils/withLatestContext.jsx b/src/sentry/static/sentry/app/utils/withLatestContext.jsx
index 180210e6c5..3a36dceb05 100644
--- a/src/sentry/static/sentry/app/utils/withLatestContext.jsx
+++ b/src/sentry/static/sentry/app/utils/withLatestContext.jsx
@@ -3,9 +3,10 @@ import React from 'react';
 import Reflux from 'reflux';
 import createReactClass from 'create-react-class';
 
-import getDisplayName from 'app/utils/getDisplayName';
+import ConfigStore from 'app/stores/configStore';
 import LatestContextStore from 'app/stores/latestContextStore';
 import SentryTypes from 'app/sentryTypes';
+import getDisplayName from 'app/utils/getDisplayName';
 import withOrganizations from 'app/utils/withOrganizations';
 
 // HoC that returns most usable organization + project
@@ -31,7 +32,11 @@ const withLatestContext = WrappedComponent =>
         // of orgs but not full org details
         let latestOrganization =
           organization ||
-          (organizations && organizations.length ? organizations[0] : null);
+          (organizations && organizations.length
+            ? organizations.find(
+                ({slug}) => slug === ConfigStore.get('lastOrganization')
+              ) || organizations[0]
+            : null);
 
         // TODO(billy): Below is going to be wrong if component is passed project, it will override
         // project from `latestContext`
diff --git a/src/sentry/templatetags/sentry_react.py b/src/sentry/templatetags/sentry_react.py
index 9558804aa5..d7d4f92956 100644
--- a/src/sentry/templatetags/sentry_react.py
+++ b/src/sentry/templatetags/sentry_react.py
@@ -72,6 +72,7 @@ def get_react_config(context):
     if 'request' in context:
         user = getattr(context['request'], 'user', None) or AnonymousUser()
         messages = get_messages(context['request'])
+        session = getattr(context['request'], 'session', None)
         try:
             is_superuser = context['request'].is_superuser()
         except AttributeError:
@@ -117,6 +118,10 @@ def get_react_config(context):
         'gravatarBaseUrl': settings.SENTRY_GRAVATAR_BASE_URL,
         'termsUrl': settings.TERMS_URL,
         'privacyUrl': settings.PRIVACY_URL,
+        # Note `lastOrganization` should not be expected to update throughout frontend app lifecycle
+        # It should only be used on a fresh browser nav to a path where an
+        # organization is not in context
+        'lastOrganization': session['activeorg'] if session and 'activeorg' in session else None,
     }
     if user and user.is_authenticated():
         context.update({
