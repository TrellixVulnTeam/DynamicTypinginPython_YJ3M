commit f0f9bac0dbd474e0f6f4ccea2dc769b66d67a9c8
Author: josh <josh@jrl.ninja>
Date:   Wed Oct 9 11:35:11 2019 -0700

    py3(pytest): bump pytest and friends to last 2.7 supported versions (#14997)

diff --git a/Makefile b/Makefile
index 996ca0dc69..fc6e3b13e8 100644
--- a/Makefile
+++ b/Makefile
@@ -96,7 +96,7 @@ install-yarn-pkgs:
 
 install-sentry-dev:
 	@echo "--> Installing Sentry (for development)"
-	$(PIP) install -e ".[dev,tests,optional]" $(PIP_OPTS)
+	$(PIP) install -e ".[dev,optional]" $(PIP_OPTS)
 
 build-js-po: node-version-check
 	mkdir -p build
diff --git a/requirements-dev.txt b/requirements-dev.txt
index 63facf935c..5038e812fe 100644
--- a/requirements-dev.txt
+++ b/requirements-dev.txt
@@ -1,9 +1,14 @@
 Babel
+datadog
 docker>=3.7.0,<3.8.0
 exam>=0.5.1
+freezegun==0.3.11
 honcho>=1.0.0,<1.1.0
 isort>=4.3.4,<4.4.0
-pytest>=3.5.0,<3.6.0
-pytest-django>=2.9.1,<2.10.0
-pytest-html>=1.9.0,<1.10.0
+pytest==4.6.5
+pytest-cov==2.5.1
+pytest-django==3.5.1
+pytest-html==1.22.0
+responses>=0.8.1,<0.9.0
 sentry-flake8==0.1.1
+werkzeug==0.15.5
diff --git a/requirements-test.txt b/requirements-test.txt
deleted file mode 100644
index 48495e9276..0000000000
--- a/requirements-test.txt
+++ /dev/null
@@ -1,5 +0,0 @@
-datadog
-freezegun==0.3.11
-pytest-cov>=2.5.1,<2.6.0
-responses>=0.8.1,<0.9.0
-werkzeug==0.15.5
diff --git a/setup.py b/setup.py
index a222bff508..123ba7c163 100755
--- a/setup.py
+++ b/setup.py
@@ -73,7 +73,6 @@ def get_requirements(env):
 
 install_requires = get_requirements("base")
 dev_requires = get_requirements("dev")
-tests_require = get_requirements("test")
 optional_requires = get_requirements("optional")
 
 # override django version in requirements file if DJANGO_VERSION is set
@@ -139,7 +138,6 @@ setup(
     extras_require={
         "dev": dev_requires,
         "postgres": [],
-        "tests": tests_require,
         "optional": optional_requires,
     },
     cmdclass=cmdclass,
diff --git a/src/sentry/utils/pytest/selenium.py b/src/sentry/utils/pytest/selenium.py
index 5854cf4dc1..9e771ce035 100644
--- a/src/sentry/utils/pytest/selenium.py
+++ b/src/sentry/utils/pytest/selenium.py
@@ -370,7 +370,7 @@ def browser(request, percy, live_server):
 def _environment(request):
     config = request.config
     # add environment details to the pytest-html plugin
-    config._environment.append(("Driver", config.option.selenium_driver))
+    config._metadata.update({"Driver": config.option.selenium_driver})
 
 
 @pytest.hookimpl(tryfirst=True, hookwrapper=True)
diff --git a/tests/sentry/event_manager/interfaces/snapshots/test_stacktrace/test_get_stacktrace_with_only_filename.pysnap b/tests/sentry/event_manager/interfaces/snapshots/test_stacktrace/test_get_stacktrace_with_only_filename.pysnap
new file mode 100644
index 0000000000..a15953dfef
--- /dev/null
+++ b/tests/sentry/event_manager/interfaces/snapshots/test_stacktrace/test_get_stacktrace_with_only_filename.pysnap
@@ -0,0 +1,15 @@
+---
+created: '2019-10-09T18:09:55.047738Z'
+creator: sentry
+source: tests/sentry/event_manager/interfaces/test_stacktrace.py
+---
+errors: null
+get_stacktrace: "Stacktrace (most recent call last):\n\n  File \"foo\"\n  File \"\
+  bar\""
+to_json:
+  frames:
+  - abs_path: foo
+    filename: foo
+  - abs_path: bar
+    filename: bar
+to_string: "Stacktrace (most recent call last):\n\n  File \"foo\"\n  File \"bar\""
diff --git a/tests/sentry/event_manager/interfaces/test_stacktrace.py b/tests/sentry/event_manager/interfaces/test_stacktrace.py
index 549e44e252..99c3b5417d 100644
--- a/tests/sentry/event_manager/interfaces/test_stacktrace.py
+++ b/tests/sentry/event_manager/interfaces/test_stacktrace.py
@@ -117,7 +117,7 @@ def test_to_string_returns_stacktrace(make_stacktrace_snapshot):
 
 
 @mock.patch("sentry.interfaces.stacktrace.is_newest_frame_first", mock.Mock(return_value=False))
-def test_get_stacktrace_with_only_filename():
+def test_get_stacktrace_with_only_filename(make_stacktrace_snapshot):
     make_stacktrace_snapshot(dict(frames=[{"filename": "foo"}, {"filename": "bar"}]))
 
 
