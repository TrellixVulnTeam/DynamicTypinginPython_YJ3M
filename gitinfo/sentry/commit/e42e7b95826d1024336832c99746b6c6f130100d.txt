commit e42e7b95826d1024336832c99746b6c6f130100d
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Dec 17 14:29:30 2015 -0800

    Make sure config file is in a sane shape before trying to use it

diff --git a/src/sentry/runner/initializer.py b/src/sentry/runner/initializer.py
index 01b9f92c20..977cd5769b 100644
--- a/src/sentry/runner/initializer.py
+++ b/src/sentry/runner/initializer.py
@@ -80,12 +80,24 @@ def bootstrap_options(settings, config):
     if config is None:
         return
     from sentry.utils.yaml import safe_load
+    from yaml.parser import ParserError
+    from yaml.scanner import ScannerError
     try:
         with open(config, 'rb') as fp:
             options = safe_load(fp)
     except IOError:
         # Gracefully fail if yaml file doesn't exist
         return
+    except (AttributeError, ParserError, ScannerError) as e:
+        from .importer import ConfigurationError
+        raise ConfigurationError('Malformed config.yml file: %s' % unicode(e))
+    # Empty options file, so fail gracefully
+    if options is None:
+        return
+    # Options needs to be a dict
+    if not isinstance(options, dict):
+        from .importer import ConfigurationError
+        raise ConfigurationError('Malformed config.yml file')
     # First move options from settings into options
     for k, v in options_mapper.iteritems():
         if hasattr(settings, v):
