commit b4e2599ea302c18667e7e89ad90f5b08ebfda038
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Wed Jul 1 11:01:32 2020 +0200

    ref(pii): Add referrer to data scrubber snuba query (#19640)
    
    * ref(pii): Add referrer to data scrubber snuba query
    
    * prefix referrer

diff --git a/src/sentry/api/endpoints/data_scrubbing_selector_suggestions.py b/src/sentry/api/endpoints/data_scrubbing_selector_suggestions.py
index 9755fcb1ea..5af1258579 100644
--- a/src/sentry/api/endpoints/data_scrubbing_selector_suggestions.py
+++ b/src/sentry/api/endpoints/data_scrubbing_selector_suggestions.py
@@ -33,8 +33,15 @@ class DataScrubbingSelectorSuggestionsEndpoint(OrganizationEndpoint):
 
         event_id = request.GET.get("eventId", None)
 
+        # For organization settings we access all projects the user has access
+        # to. For the project level, `get_projects` will give us back a single
+        # project.
+        #
         # Filtering by the projects that self.get_projects returns deals with
-        # permission concerns
+        # permission concerns.
+        #
+        # The org-wide search for the event ID is quite slow, but we cannot fix
+        # that without product redesign.
         projects = self.get_projects(request, organization)
         project_ids = [project.id for project in projects]
 
@@ -42,9 +49,8 @@ class DataScrubbingSelectorSuggestionsEndpoint(OrganizationEndpoint):
 
         if event_id:
             for event in eventstore.get_events(
-                filter=eventstore.Filter(
-                    conditions=[["id", "=", event_id]], project_ids=project_ids
-                )
+                filter=eventstore.Filter(event_ids=[event_id], project_ids=project_ids),
+                referrer="api.data_scrubbing_selector_suggestions",
             ):
                 for selector in pii_selector_suggestions_from_event(dict(event.data)):
                     examples_ = suggestions.setdefault(selector["path"], [])
