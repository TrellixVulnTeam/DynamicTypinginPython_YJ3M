commit 9f9a6271f39026ac516ad9bfc1bcf42372aceccb
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Jan 26 15:56:48 2013 -0800

    Various fixes for details page

diff --git a/src/sentry/templates/sentry/partial/event_nav.html b/src/sentry/templates/sentry/partial/event_nav.html
index 183ae1f60e..6b1ed14490 100644
--- a/src/sentry/templates/sentry/partial/event_nav.html
+++ b/src/sentry/templates/sentry/partial/event_nav.html
@@ -5,7 +5,7 @@
 <div id="event_nav">
     <div class="event_nav_wrap">
         <ul class="nav nav-pills">
-            {% with event.group|get_panels:request as panel_list %}
+            {% with group|get_panels:request as panel_list %}
                 {% if panel_list %}
                     <li class="dropdown pull-right">
                         <a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown">
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 1b7ff76df4..cf10b276ee 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -16,6 +16,7 @@ import logging
 import re
 
 from django.core.urlresolvers import reverse
+from django.db.models import Q
 from django.http import HttpResponse, HttpResponseRedirect, Http404
 from django.shortcuts import get_object_or_404
 from django.utils import timezone
@@ -278,12 +279,21 @@ def group_list(request, team, project):
 
 
 def render_with_group_context(group, template, context, request=None, event=None):
+    activity = Activity.objects.filter(
+        group=group,
+    ).order_by('-datetime').select_related('user')
+    if event:
+        activity = activity.filter(Q(event__isnull=True) | Q(event=event))
+
+    activity = list(activity)
+
     context.update({
         'team': group.project.team,
         'project': group.project,
         'group': group,
         'can_admin_event': can_admin_group(request.user, group),
         'SECTION': 'events',
+        'activity': activity,
     })
 
     if event:
@@ -315,10 +325,6 @@ def render_with_group_context(group, template, context, request=None, event=None
 
 @has_group_access
 def group(request, team, project, group):
-    activity = Activity.objects.filter(
-        group=group,
-    ).order_by('-datetime').select_related('user')
-
     # It's possible that a message would not be created under certain
     # circumstances (such as a post_save signal failing)
     event = group.get_latest_event() or Event()
@@ -326,7 +332,6 @@ def group(request, team, project, group):
 
     return render_with_group_context(group, 'sentry/groups/details.html', {
         'page': 'details',
-        'activity': activity,
     }, request, event=event)
 
 
diff --git a/tests/js/index.html b/tests/js/index.html
index 27dcdb0d34..52a2e140ae 100644
--- a/tests/js/index.html
+++ b/tests/js/index.html
@@ -23,10 +23,6 @@
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/lib/select2/select2.js"></script>
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/lib/bootstrap.js"></script>
 
-  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.core.js"></script>
-  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.charts.js"></script>
-  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.stream.js"></script>
-
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/core.js"></script>
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/models.js"></script>
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/templates.js"></script>
@@ -36,6 +32,10 @@
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/views.js"></script>
   <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/app.js"></script>
 
+  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.core.js"></script>
+  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.charts.js"></script>
+  <script type="text/javascript" src="../../src/sentry/static/sentry/scripts/sentry.stream.js"></script>
+
   <!-- include spec files here... -->
   <script type="text/javascript" src="spec/OrderedElementsViewSpec.js"></script>
   <script type="text/javascript" src="spec/floatFormat.js"></script>
