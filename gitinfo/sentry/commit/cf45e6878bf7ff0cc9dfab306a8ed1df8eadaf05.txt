commit cf45e6878bf7ff0cc9dfab306a8ed1df8eadaf05
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Aug 30 11:41:33 2017 -0400

    fix(saml): return http 404 on missing provider
    
    Before the provider is setup, if you tried to ping the metadata url, it
    would just error.
    
    Fixes SENTRY-4BB

diff --git a/src/sentry/auth/providers/saml2.py b/src/sentry/auth/providers/saml2.py
index c2eba347af..b5d7a6e13b 100644
--- a/src/sentry/auth/providers/saml2.py
+++ b/src/sentry/auth/providers/saml2.py
@@ -2,7 +2,10 @@ from __future__ import absolute_import, print_function
 
 from django.conf import settings
 from django.core.urlresolvers import reverse
-from django.http import (HttpResponse, HttpResponseRedirect, HttpResponseServerError)
+from django.http import (
+    HttpResponse, HttpResponseRedirect, HttpResponseServerError,
+    Http404,
+)
 from django.utils.decorators import method_decorator
 from django.views.decorators.csrf import csrf_exempt
 from six.moves.urllib.parse import urlparse
@@ -31,16 +34,16 @@ def get_provider(organization_slug):
     try:
         organization = Organization.objects.get(slug=organization_slug)
     except Organization.DoesNotExist:
-        return HttpResponseRedirect(reverse('sentry-login'))
+        return None
 
     if organization.status != OrganizationStatus.VISIBLE:
-        return HttpResponseRedirect(reverse('sentry-login'))
+        return None
 
     try:
         auth_provider = AuthProvider.objects.get(organization=organization)
         return auth_provider.get_provider()
     except AuthProvider.DoesNotExist:
-        return HttpResponseRedirect(reverse('sentry-login'))
+        return None
 
 
 class SAML2LoginView(AuthView):
@@ -55,6 +58,9 @@ class SAML2ACSView(AuthView):
     @method_decorator(csrf_exempt)
     def dispatch(self, request, organization_slug):
         provider = get_provider(organization_slug)
+        if provider is None:
+            raise Http404
+
         organization = Organization.objects.get(slug=organization_slug)
         saml_config = provider.build_saml_config(organization_slug)
 
@@ -148,6 +154,8 @@ class SAML2ACSView(AuthView):
 class SAML2MetadataView(AuthView):
     def dispatch(self, request, organization_slug):
         provider = get_provider(organization_slug)
+        if provider is None:
+            raise Http404
 
         saml_config = provider.build_saml_config(organization_slug)
         saml_settings = OneLogin_Saml2_Settings(settings=saml_config, sp_validation_only=True)
