commit 6b84059d213f64a7d6ea88cf9cb363caa5d2e664
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 26 05:54:19 2011 -0800

    Lots of cleanup around details/interfaces.
    
    - Request now shows query string, body, and http headers.
    - Tweaked page-header to be main-header, and using page-header on interfaces.
    - Stacktrace/Template now use a standardized context rendering.
    - Removed some old unused JS.

diff --git a/bootstrap/lib/sentry.less b/bootstrap/lib/sentry.less
index f33391920b..240e9282fc 100644
--- a/bootstrap/lib/sentry.less
+++ b/bootstrap/lib/sentry.less
@@ -66,14 +66,85 @@
   }
 }
 
-// Sparkline (page header)
-
-.page-header {
+// Main header
+.main-header {
+  background-color: #f5f5f5;
+  padding: 10px 20px 0px;
+  margin: -20px -20px 20px;
+  border-bottom: 1px solid #ddd;
+  .box-shadow(0 1px 0 rgba(255,255,255,.5));
   position: relative;
+  h1 {
+    margin-bottom: (@baseline / 2) - 1px;
+  }
 }
+
+// Sparkline (page header)
+
 .sparkline {
   left: 0;
   position: absolute;
   width: 100%;
   .opacity(60);
+}
+
+// Code styles
+
+ol.context {
+  margin: 0;
+  list-style-position: inside;
+  border: 1px solid #ccc;
+  border: 1px solid rgba(0,0,0,.15);
+  .border-radius(3px);
+  > li {
+    padding-left: 20px;
+    font-family:monospace;
+    white-space:pre;
+    color:rgba(0,0,0,.75);
+    background-color: #f5f5f5;
+    > pre {
+      background-color: inherit;
+      color: rgba(0,0,0,.5);
+      margin: 0;
+      padding: 0;
+      border: 0;
+      display: block;
+      line-height: @baseline;
+      font-size: 12px;
+      white-space: pre;
+      white-space: pre-wrap;
+      word-wrap: break-word;
+    }
+  }
+  > li.active {
+    background-color: #ddd;
+    pre {
+      color: @black;
+    }
+  }
+}
+ol.context-line {
+  > li {
+    > span {
+      float: right;
+    }
+  }
+}
+
+.expandable {
+  cursor: pointer;
+  .closed {
+    display: none;
+  }
+}
+
+table.vars {
+  .condensed-table;
+}
+
+.module {
+  margin-bottom: 20px;
+}
+.module-content table pre {
+  margin-bottom: 0;
 }
\ No newline at end of file
diff --git a/bootstrap/lib/variables.less b/bootstrap/lib/variables.less
index 34000d0669..a6bca4c373 100644
--- a/bootstrap/lib/variables.less
+++ b/bootstrap/lib/variables.less
@@ -32,7 +32,7 @@
 // Griditude
 // Modify the grid styles in mixins.less
 @gridColumns:       16;
-@gridColumnWidth:   40px;
+@gridColumnWidth:   50px;
 @gridGutterWidth:   20px;
 @extraSpace:        (@gridGutterWidth * 2); // For our grid calculations
 @siteWidth:         (@gridColumns * @gridColumnWidth) + (@gridGutterWidth * (@gridColumns - 1));
diff --git a/sentry/interfaces.py b/sentry/interfaces.py
index 9748f7b93c..9f4cc135ff 100644
--- a/sentry/interfaces.py
+++ b/sentry/interfaces.py
@@ -26,6 +26,30 @@ def unserialize(klass, data):
     return value
 
 
+def get_context(lineno, context_line, pre_context=None, post_context=None):
+    context = []
+    start_lineno = lineno - len(pre_context or [])
+    if pre_context:
+        start_lineno = lineno - len(pre_context)
+        at_lineno = start_lineno
+        for line in pre_context:
+            context.append((at_lineno, line))
+            at_lineno += 1
+    else:
+        start_lineno = lineno
+        at_lineno = lineno
+
+    context.append((at_lineno, context_line))
+    at_lineno += 1
+
+    if post_context:
+        for line in post_context:
+            context.append((at_lineno, line))
+            at_lineno += 1
+
+    return context
+
+
 class Interface(object):
     """
     An interface is a structured represntation of data, which may
@@ -91,9 +115,21 @@ class Stacktrace(Interface):
         }
 
     def to_html(self, event):
+        frames = []
+        for frame in self.frames:
+            context = get_context(frame['lineno'], frame['context_line'], frame.get('pre_context'), frame.get('post_context'))
+            frames.append({
+                'filename': frame.get('filename'),
+                'function': frame.get('function'),
+                'start_lineno': context[0][0],
+                'lineno': frame.get('lineno'),
+                'context': context,
+                'vars': frame.get('vars') or {},
+            })
+
         return render_to_string('sentry/partial/interfaces/stacktrace.html', {
             'event': event,
-            'frames': self.frames,
+            'frames': frames,
         })
 
     def to_string(self, event):
@@ -210,16 +246,16 @@ class Template(Interface):
         }
 
     def to_html(self, event):
+        context = get_context(self.lineno, self.context_line, self.pre_context, self.post_context)
+
         return render_to_string('sentry/partial/interfaces/template.html', {
             'event': event,
             'filename': self.filename,
-            'context_line': self.context_line,
             'lineno': self.lineno,
-            'pre_context': self.pre_context,
-            'pre_context_lineno': self.lineno - len(self.pre_context),
-            'post_context': self.post_context,
+            'start_lineno': context[0][0],
+            'context': context,
         })
 
 
 class User(Interface):
-    pass
\ No newline at end of file
+    pass
diff --git a/sentry/static/scripts/global.js b/sentry/static/scripts/global.js
index 369a316c0a..b407502910 100644
--- a/sentry/static/scripts/global.js
+++ b/sentry/static/scripts/global.js
@@ -1,40 +1,6 @@
-function getElementsByClassName(oElm, strTagName, strClassName){
-    // Written by Jonathan Snook, http://www.snook.ca/jon; Add-ons by Robert Nyman, http://www.robertnyman.com
-    var arrElements = (strTagName == "*" && document.all)? document.all :
-    oElm.getElementsByTagName(strTagName);
-    var arrReturnElements = new Array();
-    strClassName = strClassName.replace(/\-/g, "\\-");
-    var oRegExp = new RegExp("(^|\\s)" + strClassName + "(\\s|$)");
-    var oElement;
-    for(var i=0; i<arrElements.length; i++){
-        oElement = arrElements[i];
-        if(oRegExp.test(oElement.className)){
-            arrReturnElements.push(oElement);
-        }
-    }
-    return (arrReturnElements);
-}
-function hideAll(elems) {
-    for (var e = 0; e < elems.length; e++) {
-        elems[e].style.display = 'none';
-    }
-}
-$(window).load(function() {
-    $('.frame table.vars').hide();
-    $('ol.pre-context').hide();
-    $('ol.post-context').hide();
-});
-function toggle() {
-    for (var i = 0; i < arguments.length; i++) {
-        var e = document.getElementById(arguments[i]);
-        if (e) {
-            e.style.display = e.style.display == 'none' ? 'block' : 'none';
-        }
-    }
-    return false;
-}
+
 function varToggle(link, id) {
-    toggle('v' + id);
+    $('#v' + id).toggle();
     var s = link.getElementsByTagName('span')[0];
     var uarr = String.fromCharCode(0x25b6);
     var darr = String.fromCharCode(0x25bc);
diff --git a/sentry/static/styles/bootstrap.css b/sentry/static/styles/bootstrap.css
index e5df7a0145..15019cf263 100644
--- a/sentry/static/styles/bootstrap.css
+++ b/sentry/static/styles/bootstrap.css
@@ -6,7 +6,7 @@
  * http://www.apache.org/licenses/LICENSE-2.0
  *
  * Designed and built with all the love in the world @twitter by @mdo and @fat.
- * Date: Mon Dec 26 04:35:56 PST 2011
+ * Date: Mon Dec 26 05:54:01 PST 2011
  */
 /* Reset.less
  * Props to Eric Meyer (meyerweb.com) for his CSS reset file. We're using an adapted version here	that cuts out some of the reset HTML elements we will never need here (i.e., dfn, samp, etc).
@@ -190,7 +190,7 @@ body {
   color: #404040;
 }
 .container {
-  width: 940px;
+  width: 1100px;
   margin-left: auto;
   margin-right: auto;
   zoom: 1;
@@ -267,112 +267,112 @@ a:hover {
   margin-left: 20px;
 }
 .span1 {
-  width: 40px;
+  width: 50px;
 }
 .span2 {
-  width: 100px;
+  width: 120px;
 }
 .span3 {
-  width: 160px;
+  width: 190px;
 }
 .span4 {
-  width: 220px;
+  width: 260px;
 }
 .span5 {
-  width: 280px;
+  width: 330px;
 }
 .span6 {
-  width: 340px;
+  width: 400px;
 }
 .span7 {
-  width: 400px;
+  width: 470px;
 }
 .span8 {
-  width: 460px;
+  width: 540px;
 }
 .span9 {
-  width: 520px;
+  width: 610px;
 }
 .span10 {
-  width: 580px;
+  width: 680px;
 }
 .span11 {
-  width: 640px;
+  width: 750px;
 }
 .span12 {
-  width: 700px;
+  width: 820px;
 }
 .span13 {
-  width: 760px;
+  width: 890px;
 }
 .span14 {
-  width: 820px;
+  width: 960px;
 }
 .span15 {
-  width: 880px;
+  width: 1030px;
 }
 .span16 {
-  width: 940px;
+  width: 1100px;
 }
 .span17 {
-  width: 1000px;
+  width: 1170px;
 }
 .span18 {
-  width: 1060px;
+  width: 1240px;
 }
 .span19 {
-  width: 1120px;
+  width: 1310px;
 }
 .span20 {
-  width: 1180px;
+  width: 1380px;
 }
 .span21 {
-  width: 1240px;
+  width: 1450px;
 }
 .span22 {
-  width: 1300px;
+  width: 1520px;
 }
 .span23 {
-  width: 1360px;
+  width: 1590px;
 }
 .span24 {
-  width: 1420px;
+  width: 1660px;
 }
 .row > .offset1 {
-  margin-left: 80px;
+  margin-left: 90px;
 }
 .row > .offset2 {
-  margin-left: 140px;
+  margin-left: 160px;
 }
 .row > .offset3 {
-  margin-left: 200px;
+  margin-left: 230px;
 }
 .row > .offset4 {
-  margin-left: 260px;
+  margin-left: 300px;
 }
 .row > .offset5 {
-  margin-left: 320px;
+  margin-left: 370px;
 }
 .row > .offset6 {
-  margin-left: 380px;
+  margin-left: 440px;
 }
 .row > .offset7 {
-  margin-left: 440px;
+  margin-left: 510px;
 }
 .row > .offset8 {
-  margin-left: 500px;
+  margin-left: 580px;
 }
 .row > .offset9 {
-  margin-left: 560px;
+  margin-left: 650px;
 }
 .row > .offset10 {
-  margin-left: 620px;
+  margin-left: 720px;
 }
 .row > .offset11 {
-  margin-left: 680px;
+  margin-left: 790px;
 }
 .row > .offset12 {
-  margin-left: 740px;
+  margin-left: 860px;
 }
 .span-one-third {
   width: 300px;
@@ -816,97 +816,97 @@ textarea.xxlarge {
 input.span1, textarea.span1 {
   display: inline-block;
   float: none;
-  width: 30px;
+  width: 40px;
   margin-left: 0;
 }
 input.span2, textarea.span2 {
   display: inline-block;
   float: none;
-  width: 90px;
+  width: 110px;
   margin-left: 0;
 }
 input.span3, textarea.span3 {
   display: inline-block;
   float: none;
-  width: 150px;
+  width: 180px;
   margin-left: 0;
 }
 input.span4, textarea.span4 {
   display: inline-block;
   float: none;
-  width: 210px;
+  width: 250px;
   margin-left: 0;
 }
 input.span5, textarea.span5 {
   display: inline-block;
   float: none;
-  width: 270px;
+  width: 320px;
   margin-left: 0;
 }
 input.span6, textarea.span6 {
   display: inline-block;
   float: none;
-  width: 330px;
+  width: 390px;
   margin-left: 0;
 }
 input.span7, textarea.span7 {
   display: inline-block;
   float: none;
-  width: 390px;
+  width: 460px;
   margin-left: 0;
 }
 input.span8, textarea.span8 {
   display: inline-block;
   float: none;
-  width: 450px;
+  width: 530px;
   margin-left: 0;
 }
 input.span9, textarea.span9 {
   display: inline-block;
   float: none;
-  width: 510px;
+  width: 600px;
   margin-left: 0;
 }
 input.span10, textarea.span10 {
   display: inline-block;
   float: none;
-  width: 570px;
+  width: 670px;
   margin-left: 0;
 }
 input.span11, textarea.span11 {
   display: inline-block;
   float: none;
-  width: 630px;
+  width: 740px;
   margin-left: 0;
 }
 input.span12, textarea.span12 {
   display: inline-block;
   float: none;
-  width: 690px;
+  width: 810px;
   margin-left: 0;
 }
 input.span13, textarea.span13 {
   display: inline-block;
   float: none;
-  width: 750px;
+  width: 880px;
   margin-left: 0;
 }
 input.span14, textarea.span14 {
   display: inline-block;
   float: none;
-  width: 810px;
+  width: 950px;
   margin-left: 0;
 }
 input.span15, textarea.span15 {
   display: inline-block;
   float: none;
-  width: 870px;
+  width: 1020px;
   margin-left: 0;
 }
 input.span16, textarea.span16 {
   display: inline-block;
   float: none;
-  width: 930px;
+  width: 1090px;
   margin-left: 0;
 }
 input[disabled],
@@ -1163,52 +1163,52 @@ table tbody th {
   border-radius: 0 0 4px 0;
 }
 table .span1 {
-  width: 20px;
+  width: 30px;
 }
 table .span2 {
-  width: 60px;
+  width: 90px;
 }
 table .span3 {
-  width: 100px;
+  width: 150px;
 }
 table .span4 {
-  width: 140px;
+  width: 210px;
 }
 table .span5 {
-  width: 180px;
+  width: 270px;
 }
 table .span6 {
-  width: 220px;
+  width: 330px;
 }
 table .span7 {
-  width: 260px;
+  width: 390px;
 }
 table .span8 {
-  width: 300px;
+  width: 450px;
 }
 table .span9 {
-  width: 340px;
+  width: 510px;
 }
 table .span10 {
-  width: 380px;
+  width: 570px;
 }
 table .span11 {
-  width: 420px;
+  width: 630px;
 }
 table .span12 {
-  width: 460px;
+  width: 690px;
 }
 table .span13 {
-  width: 500px;
+  width: 750px;
 }
 table .span14 {
-  width: 540px;
+  width: 810px;
 }
 table .span15 {
-  width: 580px;
+  width: 870px;
 }
 table .span16 {
-  width: 620px;
+  width: 930px;
 }
 .zebra-striped tbody tr:nth-child(odd) td, .zebra-striped tbody tr:nth-child(odd) th {
   background-color: #f9f9f9;
@@ -2593,9 +2593,19 @@ button.btn::-moz-focus-inner, input[type=submit].btn::-moz-focus-inner {
   color: #bfbfbf;
   text-shadow: none;
 }
-.page-header {
+.main-header {
+  background-color: #f5f5f5;
+  padding: 10px 20px 0px;
+  margin: -20px -20px 20px;
+  border-bottom: 1px solid #ddd;
+  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
+  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
+  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
   position: relative;
 }
+.main-header h1 {
+  margin-bottom: 8px;
+}
 .sparkline {
   left: 0;
   position: absolute;
@@ -2605,3 +2615,56 @@ button.btn::-moz-focus-inner, input[type=submit].btn::-moz-focus-inner {
   -moz-opacity: 0.6;
   opacity: 0.6;
 }
+ol.context {
+  margin: 0;
+  list-style-position: inside;
+  border: 1px solid #ccc;
+  border: 1px solid rgba(0, 0, 0, 0.15);
+  -webkit-border-radius: 3px;
+  -moz-border-radius: 3px;
+  border-radius: 3px;
+}
+ol.context > li {
+  padding-left: 20px;
+  font-family: monospace;
+  white-space: pre;
+  color: rgba(0, 0, 0, 0.75);
+  background-color: #f5f5f5;
+}
+ol.context > li > pre {
+  background-color: inherit;
+  color: rgba(0, 0, 0, 0.5);
+  margin: 0;
+  padding: 0;
+  border: 0;
+  display: block;
+  line-height: 18px;
+  font-size: 12px;
+  white-space: pre;
+  white-space: pre-wrap;
+  word-wrap: break-word;
+}
+ol.context > li.active {
+  background-color: #ddd;
+}
+ol.context > li.active pre {
+  color: #000000;
+}
+ol.context-line > li > span {
+  float: right;
+}
+.expandable {
+  cursor: pointer;
+}
+.expandable .closed {
+  display: none;
+}
+table.vars th, table.vars td {
+  padding: 5px 5px 4px;
+}
+.module {
+  margin-bottom: 20px;
+}
+.module-content table pre {
+  margin-bottom: 0;
+}
diff --git a/sentry/static/styles/bootstrap.min.css b/sentry/static/styles/bootstrap.min.css
index 6ad6c666c5..45a412b816 100644
--- a/sentry/static/styles/bootstrap.min.css
+++ b/sentry/static/styles/bootstrap.min.css
@@ -21,7 +21,7 @@ input[type="search"]{-webkit-appearance:textfield;-webkit-box-sizing:content-box
 input[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}
 textarea{overflow:auto;vertical-align:top;}
 body{background-color:#ffffff;margin:0;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:13px;font-weight:normal;line-height:18px;color:#404040;}
-.container{width:940px;margin-left:auto;margin-right:auto;zoom:1;}.container:before,.container:after{display:table;content:"";zoom:1;}
+.container{width:1100px;margin-left:auto;margin-right:auto;zoom:1;}.container:before,.container:after{display:table;content:"";zoom:1;}
 .container:after{clear:both;}
 .container-fluid{position:relative;min-width:940px;padding-left:20px;padding-right:20px;zoom:1;}.container-fluid:before,.container-fluid:after{display:table;content:"";zoom:1;}
 .container-fluid:after{clear:both;}
@@ -35,42 +35,42 @@ a{color:#0069d6;text-decoration:none;line-height:inherit;font-weight:inherit;}a:
 .row{zoom:1;margin-left:-20px;}.row:before,.row:after{display:table;content:"";zoom:1;}
 .row:after{clear:both;}
 .row>[class*="span"]{display:inline;float:left;margin-left:20px;}
-.span1{width:40px;}
-.span2{width:100px;}
-.span3{width:160px;}
-.span4{width:220px;}
-.span5{width:280px;}
-.span6{width:340px;}
-.span7{width:400px;}
-.span8{width:460px;}
-.span9{width:520px;}
-.span10{width:580px;}
-.span11{width:640px;}
-.span12{width:700px;}
-.span13{width:760px;}
-.span14{width:820px;}
-.span15{width:880px;}
-.span16{width:940px;}
-.span17{width:1000px;}
-.span18{width:1060px;}
-.span19{width:1120px;}
-.span20{width:1180px;}
-.span21{width:1240px;}
-.span22{width:1300px;}
-.span23{width:1360px;}
-.span24{width:1420px;}
-.row>.offset1{margin-left:80px;}
-.row>.offset2{margin-left:140px;}
-.row>.offset3{margin-left:200px;}
-.row>.offset4{margin-left:260px;}
-.row>.offset5{margin-left:320px;}
-.row>.offset6{margin-left:380px;}
-.row>.offset7{margin-left:440px;}
-.row>.offset8{margin-left:500px;}
-.row>.offset9{margin-left:560px;}
-.row>.offset10{margin-left:620px;}
-.row>.offset11{margin-left:680px;}
-.row>.offset12{margin-left:740px;}
+.span1{width:50px;}
+.span2{width:120px;}
+.span3{width:190px;}
+.span4{width:260px;}
+.span5{width:330px;}
+.span6{width:400px;}
+.span7{width:470px;}
+.span8{width:540px;}
+.span9{width:610px;}
+.span10{width:680px;}
+.span11{width:750px;}
+.span12{width:820px;}
+.span13{width:890px;}
+.span14{width:960px;}
+.span15{width:1030px;}
+.span16{width:1100px;}
+.span17{width:1170px;}
+.span18{width:1240px;}
+.span19{width:1310px;}
+.span20{width:1380px;}
+.span21{width:1450px;}
+.span22{width:1520px;}
+.span23{width:1590px;}
+.span24{width:1660px;}
+.row>.offset1{margin-left:90px;}
+.row>.offset2{margin-left:160px;}
+.row>.offset3{margin-left:230px;}
+.row>.offset4{margin-left:300px;}
+.row>.offset5{margin-left:370px;}
+.row>.offset6{margin-left:440px;}
+.row>.offset7{margin-left:510px;}
+.row>.offset8{margin-left:580px;}
+.row>.offset9{margin-left:650px;}
+.row>.offset10{margin-left:720px;}
+.row>.offset11{margin-left:790px;}
+.row>.offset12{margin-left:860px;}
 .span-one-third{width:300px;}
 .span-two-thirds{width:620px;}
 .row>.offset-one-third{margin-left:340px;}
@@ -141,22 +141,22 @@ form .clearfix.success .input-prepend .add-on,form .clearfix.success .input-appe
 .input-xlarge,input.xlarge,textarea.xlarge,select.xlarge{width:270px;}
 .input-xxlarge,input.xxlarge,textarea.xxlarge,select.xxlarge{width:530px;}
 textarea.xxlarge{overflow-y:auto;}
-input.span1,textarea.span1{display:inline-block;float:none;width:30px;margin-left:0;}
-input.span2,textarea.span2{display:inline-block;float:none;width:90px;margin-left:0;}
-input.span3,textarea.span3{display:inline-block;float:none;width:150px;margin-left:0;}
-input.span4,textarea.span4{display:inline-block;float:none;width:210px;margin-left:0;}
-input.span5,textarea.span5{display:inline-block;float:none;width:270px;margin-left:0;}
-input.span6,textarea.span6{display:inline-block;float:none;width:330px;margin-left:0;}
-input.span7,textarea.span7{display:inline-block;float:none;width:390px;margin-left:0;}
-input.span8,textarea.span8{display:inline-block;float:none;width:450px;margin-left:0;}
-input.span9,textarea.span9{display:inline-block;float:none;width:510px;margin-left:0;}
-input.span10,textarea.span10{display:inline-block;float:none;width:570px;margin-left:0;}
-input.span11,textarea.span11{display:inline-block;float:none;width:630px;margin-left:0;}
-input.span12,textarea.span12{display:inline-block;float:none;width:690px;margin-left:0;}
-input.span13,textarea.span13{display:inline-block;float:none;width:750px;margin-left:0;}
-input.span14,textarea.span14{display:inline-block;float:none;width:810px;margin-left:0;}
-input.span15,textarea.span15{display:inline-block;float:none;width:870px;margin-left:0;}
-input.span16,textarea.span16{display:inline-block;float:none;width:930px;margin-left:0;}
+input.span1,textarea.span1{display:inline-block;float:none;width:40px;margin-left:0;}
+input.span2,textarea.span2{display:inline-block;float:none;width:110px;margin-left:0;}
+input.span3,textarea.span3{display:inline-block;float:none;width:180px;margin-left:0;}
+input.span4,textarea.span4{display:inline-block;float:none;width:250px;margin-left:0;}
+input.span5,textarea.span5{display:inline-block;float:none;width:320px;margin-left:0;}
+input.span6,textarea.span6{display:inline-block;float:none;width:390px;margin-left:0;}
+input.span7,textarea.span7{display:inline-block;float:none;width:460px;margin-left:0;}
+input.span8,textarea.span8{display:inline-block;float:none;width:530px;margin-left:0;}
+input.span9,textarea.span9{display:inline-block;float:none;width:600px;margin-left:0;}
+input.span10,textarea.span10{display:inline-block;float:none;width:670px;margin-left:0;}
+input.span11,textarea.span11{display:inline-block;float:none;width:740px;margin-left:0;}
+input.span12,textarea.span12{display:inline-block;float:none;width:810px;margin-left:0;}
+input.span13,textarea.span13{display:inline-block;float:none;width:880px;margin-left:0;}
+input.span14,textarea.span14{display:inline-block;float:none;width:950px;margin-left:0;}
+input.span15,textarea.span15{display:inline-block;float:none;width:1020px;margin-left:0;}
+input.span16,textarea.span16{display:inline-block;float:none;width:1090px;margin-left:0;}
 input[disabled],select[disabled],textarea[disabled],input[readonly],select[readonly],textarea[readonly]{background-color:#f5f5f5;border-color:#ddd;cursor:not-allowed;}
 .actions{background:#f5f5f5;margin-top:18px;margin-bottom:18px;padding:17px 20px 18px 150px;border-top:1px solid #ddd;-webkit-border-radius:0 0 3px 3px;-moz-border-radius:0 0 3px 3px;border-radius:0 0 3px 3px;}.actions .secondary-action{float:right;}.actions .secondary-action a{line-height:30px;}.actions .secondary-action a:hover{text-decoration:underline;}
 .help-inline,.help-block{font-size:13px;line-height:18px;color:#bfbfbf;}
@@ -193,22 +193,22 @@ table tbody th{border-top:1px solid #ddd;vertical-align:top;}
 .bordered-table thead tr:first-child th:last-child,.bordered-table tbody tr:first-child td:last-child{-webkit-border-radius:0 4px 0 0;-moz-border-radius:0 4px 0 0;border-radius:0 4px 0 0;}
 .bordered-table tbody tr:last-child td:first-child{-webkit-border-radius:0 0 0 4px;-moz-border-radius:0 0 0 4px;border-radius:0 0 0 4px;}
 .bordered-table tbody tr:last-child td:last-child{-webkit-border-radius:0 0 4px 0;-moz-border-radius:0 0 4px 0;border-radius:0 0 4px 0;}
-table .span1{width:20px;}
-table .span2{width:60px;}
-table .span3{width:100px;}
-table .span4{width:140px;}
-table .span5{width:180px;}
-table .span6{width:220px;}
-table .span7{width:260px;}
-table .span8{width:300px;}
-table .span9{width:340px;}
-table .span10{width:380px;}
-table .span11{width:420px;}
-table .span12{width:460px;}
-table .span13{width:500px;}
-table .span14{width:540px;}
-table .span15{width:580px;}
-table .span16{width:620px;}
+table .span1{width:30px;}
+table .span2{width:90px;}
+table .span3{width:150px;}
+table .span4{width:210px;}
+table .span5{width:270px;}
+table .span6{width:330px;}
+table .span7{width:390px;}
+table .span8{width:450px;}
+table .span9{width:510px;}
+table .span10{width:570px;}
+table .span11{width:630px;}
+table .span12{width:690px;}
+table .span13{width:750px;}
+table .span14{width:810px;}
+table .span15{width:870px;}
+table .span16{width:930px;}
 .zebra-striped tbody tr:nth-child(odd) td,.zebra-striped tbody tr:nth-child(odd) th{background-color:#f9f9f9;}
 .zebra-striped tbody tr:hover td,.zebra-striped tbody tr:hover th{background-color:#f5f5f5;}
 table .header{cursor:pointer;}table .header:after{content:"";float:right;margin-top:7px;border-width:0 4px 4px;border-style:solid;border-color:#000 transparent;visibility:hidden;}
@@ -371,5 +371,12 @@ button.btn::-moz-focus-inner,input[type=submit].btn::-moz-focus-inner{padding:0;
 .topbar input::-webkit-input-placeholder{color:#404040;}
 .topbar input:hover{background-color:#444;background-color:rgba(255, 255, 255, 0.3);color:#404040;}
 .topbar input:focus,.topbar input.focused{background-color:#444;background-color:rgba(255, 255, 255, 0.3);font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:normal;font-weight:13px;line-height:1;padding:4px 9px;color:#ffffff;color:rgba(255, 255, 255, 0.75);border:1px solid #111;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-box-shadow:inset 0 1px 2px rgba(0, 0, 0, 0.1),0 1px 0px rgba(255, 255, 255, 0.25);-moz-box-shadow:inset 0 1px 2px rgba(0, 0, 0, 0.1),0 1px 0px rgba(255, 255, 255, 0.25);box-shadow:inset 0 1px 2px rgba(0, 0, 0, 0.1),0 1px 0px rgba(255, 255, 255, 0.25);-webkit-transition:none;-moz-transition:none;-ms-transition:none;-o-transition:none;transition:none;color:#bfbfbf;text-shadow:none;}
-.page-header{position:relative;}
+.main-header{background-color:#f5f5f5;padding:10px 20px 0px;margin:-20px -20px 20px;border-bottom:1px solid #ddd;-webkit-box-shadow:0 1px 0 rgba(255, 255, 255, 0.5);-moz-box-shadow:0 1px 0 rgba(255, 255, 255, 0.5);box-shadow:0 1px 0 rgba(255, 255, 255, 0.5);position:relative;}.main-header h1{margin-bottom:8px;}
 .sparkline{left:0;position:absolute;width:100%;filter:alpha(opacity=60);-khtml-opacity:0.6;-moz-opacity:0.6;opacity:0.6;}
+ol.context{margin:0;list-style-position:inside;border:1px solid #ccc;border:1px solid rgba(0, 0, 0, 0.15);-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;}ol.context>li{padding-left:20px;font-family:monospace;white-space:pre;color:rgba(0, 0, 0, 0.75);background-color:#f5f5f5;}ol.context>li>pre{background-color:inherit;color:rgba(0, 0, 0, 0.5);margin:0;padding:0;border:0;display:block;line-height:18px;font-size:12px;white-space:pre;white-space:pre-wrap;word-wrap:break-word;}
+ol.context>li.active{background-color:#ddd;}ol.context>li.active pre{color:#000000;}
+ol.context-line>li>span{float:right;}
+.expandable{cursor:pointer;}.expandable .closed{display:none;}
+table.vars th,table.vars td{padding:5px 5px 4px;}
+.module{margin-bottom:20px;}
+.module-content table pre{margin-bottom:0;}
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index 08e2803b15..033f1c6bd9 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -25,12 +25,6 @@ footer {
     -moz-box-shadow: 0 1px 2px rgba(0,0,0,.15);
     box-shadow: 0 1px 2px rgba(0,0,0,.15);
 }
-/* Page header tweaks */
-.page-header {
-    background-color: #f5f5f5;
-    padding: 10px 20px 0px;
-    margin: -20px -20px 20px;
-}
 /* Give a quick and non-cross-browser friendly divider */
 .topbar .btn {
     border: 0;
@@ -168,7 +162,7 @@ a:visited { color: inherit; }*/
 #chart { margin-bottom: 15px; overflow: hidden; }
 
 /* tracebacks */
-.frame table.vars { margin:5px 0 2px 40px; }
+.frame table.vars { margin:5px 0 2px 35px; }
 table.vars tbody td:first-child { padding-right: 20px; }
 table.vars td { font-family:monospace; }
 table.vars td.code { overflow: hidden; }
@@ -182,24 +176,9 @@ table.source th { color:#666; }
 table.source td { font-family:monospace; white-space:pre; border-bottom:1px solid #eee; }
 ul.traceback { list-style-type: none; margin-left: 0;}
 ul.traceback li.frame { margin-bottom: 1em; overflow: hidden; position: relative; }
-div.context { margin: 10px 0; }
-div.context ol { padding-left: 20px; margin:0 0px; list-style-position: inside; }
-div.context ol li { font-family:monospace; white-space:pre; color:#666; cursor:pointer; }
-div.context ol.context-line li { color:black; background-color:#ccc; }
-div.context ol.context-line li span { float: right; }
-div.commands { margin-left: 20px; }
+div.commands { margin-top: 10px; margin-left: 20px; }
 div.commands a { color:black; text-decoration:none; }
-#template, #template-not-exist { overflow: hidden; }
-#template li {
-    margin-left: 38px;
-    line-height: 1.5em;
-    font-family: monospace;
-}
-#template pre {
-    color: #000;
-    margin-bottom: 0;
-}
-#template-not-exist ul { margin: 0 0 0 20px; }
+div.commands span { font-size: 0.9em; }
 #unicode-hint { background:#eee; }
 #summary { margin-bottom: 15px; }
 #summary table, #summary pre { margin-bottom: 0; }
diff --git a/sentry/templates/sentry/groups/details.html b/sentry/templates/sentry/groups/details.html
index 6334d4d03a..32a03e340a 100644
--- a/sentry/templates/sentry/groups/details.html
+++ b/sentry/templates/sentry/groups/details.html
@@ -88,7 +88,9 @@
 
         {% if version_data %}
             <div id="versioninfo" class="module">
-                <h2>{% trans "Module Versions" %}</h2>
+                <div class="page-header">
+                    <h2>{% trans "Module Versions" %}</h2>
+                </div>
                 <div class="module-content">
                     <table class="inline">
                         {% for k, v in version_data %}
@@ -108,7 +110,9 @@
 
         {% if group|has_charts %}
             <div class="module">
-                <h2>{% trans "Frequency" %}</h2>
+                <div class="page-header">
+                    <h2>{% trans "Frequency" %}</h2>
+                </div>
                 <div class="module-content">
                     <div id="chart">
                         <noscript>{% trans "Get yourself some JavaScripts dood" %}</noscript>
diff --git a/sentry/templates/sentry/groups/group_list.html b/sentry/templates/sentry/groups/group_list.html
index 8d47fd92c8..3a7fc439aa 100644
--- a/sentry/templates/sentry/groups/group_list.html
+++ b/sentry/templates/sentry/groups/group_list.html
@@ -85,6 +85,7 @@
 {% block content_after %}
     <script type="text/javascript">
     $(document).ready(function() {
+        $sparkline = $('#sparkline');
         $.ajax({
             url: Sentry.options.apiUrl,
             type: 'get',
@@ -95,7 +96,6 @@
             },
             success: function(data){
                 if (!data.length) {
-                    $('#sparkline').html('No data currently available.');
                     return;
                 }
 
@@ -107,8 +107,8 @@
                 for (var i=0; i<data.length; i++) {
                     pairs.push([start + (3600 * 1000) * i, data[i]]);
                 }
-                $('#sparkline').height($('.page-header').height());
-                $.plot($("#sparkline"), [
+                $sparkline.height($sparkline.parent().height());
+                $.plot($sparkline, [
                     {
                         data: pairs,
                         color: '#3079d0',
diff --git a/sentry/templates/sentry/layout.html b/sentry/templates/sentry/layout.html
index 78132237ba..f68b94a1db 100644
--- a/sentry/templates/sentry/layout.html
+++ b/sentry/templates/sentry/layout.html
@@ -71,7 +71,7 @@
         <section id="content">
             <div class="container">
                 <div class="content">
-                    <div class="page-header">
+                    <div class="main-header">
                         {% block page_header %}
                             <h1>{% block heading %}Sentry <small>Supporting text or tagline</small>{% endblock %}</h1>
                         {% endblock %}
diff --git a/sentry/templates/sentry/partial/interfaces/http.html b/sentry/templates/sentry/partial/interfaces/http.html
index fa123ba16e..a20fbe6a28 100644
--- a/sentry/templates/sentry/partial/interfaces/http.html
+++ b/sentry/templates/sentry/partial/interfaces/http.html
@@ -1,16 +1,79 @@
+{% load i18n %}
+
 <div id="request" class="module">
-    <h2>Request</h2>
+    <div class="page-header">
+      <h2>{% trans "Request" %}</h2>
+    </div>
     <div class="module-content">
-        <table class="meta">
-            <tr>
-                <th>URL:</th>
-                <td><a href="{{ url }}">{{ url|escape }}</a></td>
-            </tr>
-            <tr>
-                <th>Method:</th>
-                <td>{{ method }}</td>
-            </tr>
+        <table class="bordered-table">
+            <colgroup>
+                <col style="width:60px;">
+            </colgroup>
+            <tbody>
+                <tr>
+                    <th>URL:</th>
+                    <td><a href="{{ url }}">{{ url|escape }}</a></td>
+                </tr>
+                <tr>
+                    <th>Method:</th>
+                    <td>{{ method }}</td>
+                </tr>
+                <tr>
+                    <th>Query:</th>
+                    <td>{{ query_string }}</td>
+                </tr>
+                <tr>
+                    <th>Body:</th>
+                    <td>
+                        {% if data %}
+                            {% if data|length > 5 %}
+                                <a href="#" onclick="return varToggle(this, 'HttpBody')"><span>&#x25b6;</span> Body</a>
+                                <div id="vHttpBody" style="display:none;">
+                                    <pre>{{ printed_data|escape }}</pre>
+                                </div>
+                            {% else %}
+                                <pre>{{ data|pprint|escape }}</pre>
+                            {% endif %}
+                        {% else %}
+                            <em>No post body.</em>
+                        {% endif %}
+                    </td>
+                </tr>
+                <tr>
+                    <th>Env:</th>
+                    <td>
+                        {% if env %}
+                            {% if env|length > 5 %}
+                                <a href="#" onclick="return varToggle(this, 'HttpEnv')"><span>&#x25b6;</span> Environment and Headers</a>
+                                <table class="vars" id="vHttpEnv" style="display:none;">
+                                  <tbody>
+                                    {% for key, value in env.iteritems %}
+                                      <tr>
+                                        <td>{{ key|escape }}</td>
+                                        <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                                      </tr>
+                                    {% endfor %}
+                                  </tbody>
+                                </table>
+                            {% else %}
+                                <table class="vars">
+                                  <tbody>
+                                    {% for key, value in env.iteritems %}
+                                      <tr>
+                                        <td>{{ key|escape }}</td>
+                                        <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                                      </tr>
+                                    {% endfor %}
+                                  </tbody>
+                                </table>
+                            {% endif %}
+                        {% else %}
+                            <em>No environment recorded.</em>
+                        {% endif %}
+                    </td>
+                </tr>
+            </tbody>
         </table>
-        <p><a href="{% url sentry-replay event.project_id event.id %}">Replay this request</a></p>
+        <a href="{% url sentry-replay event.project_id event.id %}" class="btn">Replay this request</a>
     </div>
 </div>
\ No newline at end of file
diff --git a/sentry/templates/sentry/partial/interfaces/stacktrace.html b/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 0323029af0..f6394f3a32 100644
--- a/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -1,47 +1,47 @@
-{% load sentry_helpers %}
+{% load i18n %}
 
 <div id="traceback" class="module">
-    <h2>Stacktrace</h2>
+    <div class="page-header">
+      <h2>{% trans "Stacktrace" %}</h2>
+    </div>
     <div class="module-content">
         {% autoescape off %}
         <div id="browserTraceback">
         <ul class="traceback">
           {% for frame in frames %}
             <li class="frame">
-              <code>{{ frame.filename|escape }}</code> in <code>{{ frame.function|escape }}</code>
+              <p><code>{{ frame.filename|escape }}</code> in <code>{{ frame.function|escape }}</code></p>
 
-              {% if frame.context_line %}
-                <div class="context" id="c{{ forloop.counter0 }}">
-                  {% if frame.pre_context %}{% with num_lines=frame.pre_context|length %}
-                    <ol start="{{ frame.lineno|subtract:num_lines }}" class="pre-context" id="pre{{ forloop.counter0 }}">{% for line in frame.pre_context %}<li onclick="toggle('pre{{ forloop.parentloop.counter0 }}', 'post{{ forloop.parentloop.counter0 }}')">{{ line|escape }}</li>{% endfor %}</ol>
-                  {% endwith %}{% endif %}
-                  <ol start="{{ frame.lineno }}" class="context-line"><li onclick="toggle('pre{{ forloop.counter0 }}', 'post{{ forloop.counter0 }}')">{{ frame.context_line|escape }} <span>...</span></li></ol>
-                  {% if frame.post_context %}
-                    <ol start='{{ frame.lineno|add:1 }}' class="post-context" id="post{{ forloop.counter0 }}">{% for line in frame.post_context %}<li onclick="toggle('pre{{ forloop.parentloop.counter0 }}', 'post{{ forloop.parentloop.counter0 }}')">{{ line|escape }}</li>{% endfor %}</ol>
-                  {% endif %}
-                </div>
+              {% if frame.context %}
+                  <ol start="{{ frame.start_lineno }}" class="context expandable" id="c{{ forloop.counter0 }}">
+                      {% for num, line in frame.context %}
+                          <li{% if num == frame.lineno %} class="active"{% else %} class="stack{{ forloop.parentloop.counter0 }} closed"{% endif %} onclick="$('.stack{{ forloop.parentloop.counter0 }}').toggle()"><pre>{{ line|escape }}</pre></li>
+                      {% endfor %}
+                  </ol>
               {% endif %}
-              <div class="commands">
-                <a href="#" onclick="return varToggle(this, '{{ forloop.counter0 }}')"><span>&#x25b6;</span> Local vars</a>
-              </div>
-              <table class="vars" id="v{{ forloop.counter0 }}">
-                <thead>
-                  <tr>
-                    <th>Variable</th>
-                    <th>Value</th>
-                  </tr>
-                </thead>
-                <tbody>
-                {% if frame.vars %}
-                  {% for key, value in frame.vars.iteritems %}
+              {% if frame.vars %}
+                <div class="commands">
+                  <a href="#" onclick="return varToggle(this, '{{ forloop.counter0 }}')"><span>&#x25b6;</span> Local vars</a>
+                </div>
+                <table class="vars" id="v{{ forloop.counter0 }}" style="display:none;">
+                  <thead>
                     <tr>
-                      <td>{{ key|escape }}</td>
-                      <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                      <th>Variable</th>
+                      <th>Value</th>
                     </tr>
-                  {% endfor %}
-                {% endif %}
-                </tbody>
-              </table>
+                  </thead>
+                  <tbody>
+                  {% if frame.vars %}
+                    {% for key, value in frame.vars.iteritems %}
+                      <tr>
+                        <td>{{ key|escape }}</td>
+                        <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                      </tr>
+                    {% endfor %}
+                  {% endif %}
+                  </tbody>
+                </table>
+              {% endif %}
             </li>
           {% endfor %}
         </ul>
diff --git a/sentry/templates/sentry/partial/interfaces/template.html b/sentry/templates/sentry/partial/interfaces/template.html
index bae67114d9..38d6d4c76e 100644
--- a/sentry/templates/sentry/partial/interfaces/template.html
+++ b/sentry/templates/sentry/partial/interfaces/template.html
@@ -2,14 +2,10 @@
     <h2>Template error</h2>
     <div class="module-content">
         <p>In template <code>{{ filename }}</code>, error at line <strong>{{ lineno }}</strong></p>
-        {% if context_line %}
-            <ol start="{{ pre_context_lineno">
-                {% for line in pre_context %}
-                    <li><pre>{{ line }}</pre></li>
-                {% endfor %}
-                <li value="{{ lineno }}" class="selected"><pre>{{ context_line }}</pre></li>
-                {% for line in post_context %}
-                    <li><pre>{{ line }}</pre></li>
+        {% if context %}
+            <ol start="{{ start_lineno }}" class="context expandable">
+                {% for num, line in context %}
+                    <li{% if num == lineno %} class="active"{% else %} class="template{{ forloop.parentloop.counter0 }} closed"{% endif %} onclick="$('.template{{ forloop.parentloop.counter0 }}').toggle()"><pre>{{ line }}</pre></li>
                 {% endfor %}
             </ol>
         {% endif %}
