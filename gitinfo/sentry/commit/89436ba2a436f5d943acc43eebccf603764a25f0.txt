commit 89436ba2a436f5d943acc43eebccf603764a25f0
Author: Matte Noble <me@mattenoble.com>
Date:   Wed Aug 29 13:15:35 2018 -0700

    fix(integrations): Disabled unmigratable repos (#9552)
    
    Don't show "Unmigratable Repos" for Integrations that have been
    disabled.
    
    Fixes SENTRY-78N

diff --git a/src/sentry/api/endpoints/organization_repositories.py b/src/sentry/api/endpoints/organization_repositories.py
index 29640cffbb..e356a8a994 100644
--- a/src/sentry/api/endpoints/organization_repositories.py
+++ b/src/sentry/api/endpoints/organization_repositories.py
@@ -61,7 +61,7 @@ class OrganizationRepositoriesEndpoint(OrganizationEndpoint):
             )
 
             integrations = Integration.objects.filter(
-                id__in=org_integrations,
+                id__in=org_integrations.values('integration_id'),
                 provider__in=('bitbucket', 'github', 'vsts'),
             )
 
diff --git a/tests/sentry/api/endpoints/test_organization_repositories.py b/tests/sentry/api/endpoints/test_organization_repositories.py
index 3d3f4295c6..be464d35c8 100644
--- a/tests/sentry/api/endpoints/test_organization_repositories.py
+++ b/tests/sentry/api/endpoints/test_organization_repositories.py
@@ -60,6 +60,28 @@ class OrganizationRepositoriesListTest(APITestCase):
             assert response.status_code == 200, response.content
             assert response.data[0]['name'] == unmigratable_repo.name
 
+    def test_status_unmigratable_missing_org_integration(self):
+        self.url = self.url + '?status=unmigratable'
+
+        Integration.objects.create(
+            provider='github',
+        )
+
+        unmigratable_repo = Repository.objects.create(
+            name='NotConnected/foo',
+            organization_id=self.org.id,
+        )
+
+        with patch('sentry.integrations.github.GitHubIntegration.get_unmigratable_repositories') as f:
+            f.return_value = [unmigratable_repo]
+
+            response = self.client.get(self.url, format='json')
+
+            # Doesn't return anything when the OrganizatioIntegration doesn't
+            # exist (the Integration has been disabled)
+            assert response.status_code == 200, response.content
+            assert len(response.data) == 0
+
 
 class OrganizationRepositoriesCreateTest(APITestCase):
     def test_simple(self):
