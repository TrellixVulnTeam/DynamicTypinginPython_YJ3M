commit e990cd55efee277b53f0f92d8de896791e30296f
Author: David Cramer <dcramer@gmail.com>
Date:   Tue May 16 17:25:43 2017 -0700

    [tests] disable south for local testing

diff --git a/Makefile b/Makefile
index 74e077cbc4..36d592daa8 100644
--- a/Makefile
+++ b/Makefile
@@ -120,7 +120,7 @@ test-acceptance:
 
 test-python-coverage:
 	@echo "--> Running Python tests"
-	coverage run --source=src/sentry -m py.test tests/integration tests/sentry
+	SOUTH_TESTS_MIGRATE=1 coverage run --source=src/sentry -m py.test tests/integration tests/sentry
 	@echo ""
 
 lint: lint-python lint-js
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 5bf45b07d8..4241bd6edb 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -1213,3 +1213,5 @@ DEPRECATED_SDKS = {
     # The Ruby SDK used to go by the name 'sentry-raven'...
     'sentry-raven': 'raven-ruby',
 }
+
+SOUTH_TESTS_MIGRATE = os.environ.get('SOUTH_TESTS_MIGRATE', '0') == '1'
diff --git a/src/sentry/utils/pytest/sentry.py b/src/sentry/utils/pytest/sentry.py
index 04993758a5..a95a96cd1a 100644
--- a/src/sentry/utils/pytest/sentry.py
+++ b/src/sentry/utils/pytest/sentry.py
@@ -23,7 +23,6 @@ def pytest_configure(config):
                 'HOST': '127.0.0.1',
             })
             # mysql requires running full migration all the time
-            settings.SOUTH_TESTS_MIGRATE = True
         elif test_db == 'postgres':
             settings.DATABASES['default'].update({
                 'ENGINE': 'sentry.db.postgres',
@@ -33,13 +32,11 @@ def pytest_configure(config):
             # postgres requires running full migration all the time
             # since it has to install stored functions which come from
             # an actual migration.
-            settings.SOUTH_TESTS_MIGRATE = True
         elif test_db == 'sqlite':
             settings.DATABASES['default'].update({
                 'ENGINE': 'django.db.backends.sqlite3',
                 'NAME': ':memory:',
             })
-            settings.SOUTH_TESTS_MIGRATE = os.environ.get('SENTRY_SOUTH_TESTS_MIGRATE', '1') == '1'
         else:
             raise RuntimeError('oops, wrong database: %r' % test_db)
 
