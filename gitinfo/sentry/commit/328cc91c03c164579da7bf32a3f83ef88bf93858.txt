commit 328cc91c03c164579da7bf32a3f83ef88bf93858
Author: Colleen O'Rourke <colleen@sentry.io>
Date:   Thu Jun 4 09:42:09 2020 -0700

    feat(email): Add integration call to action at email bottom (#19182)
    
    * Add integration cta to bottom of emails

diff --git a/src/sentry/mail/adapter.py b/src/sentry/mail/adapter.py
index 2789f98ed4..69329f5a35 100644
--- a/src/sentry/mail/adapter.py
+++ b/src/sentry/mail/adapter.py
@@ -18,6 +18,7 @@ from sentry.models import (
     Group,
     GroupSubscription,
     GroupSubscriptionReason,
+    Integration,
     ProjectOption,
     ProjectOwnership,
     Release,
@@ -25,6 +26,7 @@ from sentry.models import (
     User,
 )
 from sentry.plugins.base.structs import Notification
+from sentry.plugins.base import plugins
 from sentry.tasks.digests import deliver_digest
 from sentry.utils import metrics
 from sentry.utils.cache import cache
@@ -321,12 +323,17 @@ class MailAdapter(object):
                         commit_data["subject"] = commit_data["message"].split("\n", 1)[0]
                         commits[commit["id"]] = commit_data
 
+        project_plugins = plugins.for_project(project, version=1)
+        organization_integrations = Integration.objects.filter(organizations=org).first()
+        has_integrations = bool(project_plugins or organization_integrations)
+
         context = {
             "project_label": project.get_full_name(),
             "group": group,
             "event": event,
             "link": link,
             "rules": rules,
+            "has_integrations": has_integrations,
             "enhanced_privacy": enhanced_privacy,
             "commits": sorted(commits.values(), key=lambda x: x["score"], reverse=True),
             "environment": environment,
@@ -359,7 +366,6 @@ class MailAdapter(object):
             event=event,
         ):
             self.add_unsubscribe_link(context, user_id, project, "alert_email")
-
             self._send_mail(
                 subject=subject,
                 template=template,
diff --git a/src/sentry/static/sentry/app/plugins/components/pluginIcon.tsx b/src/sentry/static/sentry/app/plugins/components/pluginIcon.tsx
index 038b48a3cd..8af3a449a8 100644
--- a/src/sentry/static/sentry/app/plugins/components/pluginIcon.tsx
+++ b/src/sentry/static/sentry/app/plugins/components/pluginIcon.tsx
@@ -41,6 +41,7 @@ import twilio from 'app/../images/logos/logo-twilio.svg';
 import visualstudio from 'app/../images/logos/logo-visualstudio.svg';
 import vsts from 'app/../images/logos/logo-azure.svg';
 import youtrack from 'app/../images/logos/logo-youtrack.svg';
+import victorops from 'app/../images/logos/logo-victorops.svg';
 import zulip from 'app/../images/logos/logo-zulip.svg';
 
 // Map of plugin id -> logo filename
@@ -96,6 +97,7 @@ export const ICON_PATHS = {
   visualstudio,
   vsts,
   youtrack,
+  victorops,
   zulip,
 };
 
diff --git a/src/sentry/static/sentry/images/logos/logo-victorops.svg b/src/sentry/static/sentry/images/logos/logo-victorops.svg
new file mode 100644
index 0000000000..857e3913a1
--- /dev/null
+++ b/src/sentry/static/sentry/images/logos/logo-victorops.svg
@@ -0,0 +1 @@
+<svg xmlns="http://www.w3.org/2000/svg" id="Layer_3" data-name="Layer 3" viewBox="0 0 55.08 55.32"><defs><style>.cls-1{fill:#fbb040;}</style></defs><circle cx="27.54" cy="27.66" r="27.47" class="cls-1"/><path d="M41.12 28.25L39.32 25l3.9-5.23-11 5-.22-1.5 3.2-4.9-.44-.94 1.47-5.72-5.78 5.7-.33-3.1 1.72-4.77-2.28.73-2-5.72-2 5.72-2.28-.73 1.72 4.8-.33 3.1-5.78-5.7 1.45 5.72-.44.94 3.2 4.9-.22 1.5-11-5 3.88 5.2L14 28.25l8.47 4 .14 1.33-6.35-1.9 3.2 3.8.23 1.2 3.92 1.7.4 1-1.8-.62L26.84 44a62.22 62.22 0 0 1 .3 8.13h.8a62.22 62.22 0 0 1 .32-8.13l4.67-5.24-1.8.62.42-1.06 3.92-1.7.23-1.18 3.2-3.8-6.38 1.9.14-1.34z"/></svg>
diff --git a/src/sentry/templates/sentry/emails/email-styles.html b/src/sentry/templates/sentry/emails/email-styles.html
index 74d4b75366..3aace474dd 100644
--- a/src/sentry/templates/sentry/emails/email-styles.html
+++ b/src/sentry/templates/sentry/emails/email-styles.html
@@ -134,7 +134,7 @@
     box-shadow: 0 2px 0 rgba(0, 0, 0, 0.05);
   }
 
-  .container {
+  .container  {
     max-width: 600px;
     margin: 0 auto;
     text-align: left;
@@ -810,6 +810,23 @@
     color: inherit;
   }
 
+  /* Integration Logos */
+
+  .logo-container {
+    text-align: center;
+    margin-bottom: 15px;
+  }
+
+  .logo {
+      margin:5px;
+      padding:8px;
+      max-width: 25px;
+      border-radius: 5px;
+      border:1px solid #CCC;
+      width:125px;
+      height:29px;
+  }
+
   /* Commit list */
 
   .inner table.table.commit-list h4 {
diff --git a/src/sentry/templates/sentry/emails/error.html b/src/sentry/templates/sentry/emails/error.html
index d50a4e5289..a8744491f4 100644
--- a/src/sentry/templates/sentry/emails/error.html
+++ b/src/sentry/templates/sentry/emails/error.html
@@ -3,7 +3,7 @@
 {% load sentry_avatars %}
 {% load sentry_helpers %}
 {% load sentry_features %}
-{% load i18n %}
+{% load i18n static %}
 
 {% block preheader %}
   New alert from {{ project_label }}.
@@ -148,6 +148,21 @@
         </p>
     {% endif %}
 
+    {% if not has_integrations %}
+        <div class="logo-container">
+            <img src="{% static 'sentry/images/logos/logo-slack.svg' %}" class="logo" alt="Slack"/>
+            <img src="{% static 'sentry/images/logos/logo-pagerduty.svg' %}" class="logo" alt="PagerDuty"/>
+            <img src="{% static 'sentry/images/logos/logo-msteams.svg' %}" class="logo" alt="MS Teams"/>
+            <img src="{% static 'sentry/images/logos/logo-opsgenie.svg' %}" class="logo" alt="OpsGenie"/>
+            <img src="{% static 'sentry/images/logos/logo-twilio.svg' %}" class="logo" alt="Twilio"/>
+            <img src="{% static 'sentry/images/logos/logo-victorops.svg' %}" class="logo" alt="VictorOps"/>
+            <img src="{% static 'sentry/images/logos/logo-amixr.svg' %}" class="logo" alt="Amixr"/>
+        </div>
+        <p class="align-center">
+            <a href="{% absolute_uri 'settings/{}/integrations/?referrer=alert_email' group.project.organization.slug %}">{{ "Get this alert wherever you work" }}</a>
+        </p>
+    {% endif %}
+
     {# support for gmail actions #}
     <div itemscope itemtype="http://schema.org/EmailMessage">
       <meta itemprop="description" content="View Issue Details in Sentry"/>
