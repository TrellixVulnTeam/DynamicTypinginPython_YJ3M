commit 66fedad2b92e26e870ec8533345396283c147f95
Author: David Cramer <cramer@dropbox.com>
Date:   Sat Dec 28 16:31:49 2013 -0800

    Fix send_notification

diff --git a/src/sentry/models/activity.py b/src/sentry/models/activity.py
index b61054bc41..4cb0d82fce 100644
--- a/src/sentry/models/activity.py
+++ b/src/sentry/models/activity.py
@@ -76,7 +76,7 @@ class Activity(Model):
                 self.event.update(num_comments=F('num_comments') + 1)
 
     def send_notification(self):
-        from sentry.models import User, UserOption
+        from sentry.models import User, UserOption, ProjectOption
         from sentry.utils.email import MessageBuilder, group_id_to_email
 
         if self.type != Activity.NOTE or not self.group:
@@ -121,10 +121,10 @@ class Activity(Model):
 
         author = self.user.first_name or self.user.username
 
-        subject_prefix = self.get_option('subject_prefix', self.project) or \
-            settings.EMAIL_SUBJECT_PREFIX
+        subject_prefix = ProjectOption.objects.get_value(
+            self.project, 'subject_prefix', settings.EMAIL_SUBJECT_PREFIX)
         if subject_prefix:
-            subject_prefix = subject_prefix + ' '
+            subject_prefix = subject_prefix.rstrip() + ' '
 
         subject = '%s[%s] %s: %s' % (
             subject_prefix,
