commit 3d59501c3a6de29b49cb97fb312a0281647c65c9
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Mar 2 23:51:39 2012 -0800

    Correct how mail uses URL_PREFIX (fixes GH-369)

diff --git a/sentry/plugins/sentry_mail/__init__.py b/sentry/plugins/sentry_mail/__init__.py
index eb9dfa90e5..04e70094ac 100644
--- a/sentry/plugins/sentry_mail/__init__.py
+++ b/sentry/plugins/sentry_mail/__init__.py
@@ -130,7 +130,7 @@ class MailProcessor(Plugin):
         if event.site:
             subject = '[%s] %s' % (event.site, subject)
 
-        link = '%s%s' % (settings.URL_PREFIX, group.get_absolute_url())
+        link = '%s/%d/group/%d/' % (settings.URL_PREFIX, group.project_id, group.id)
 
         body = render_to_string('sentry/emails/error.txt', {
             'group': group,
diff --git a/tests/sentry/plugins/mail/tests.py b/tests/sentry/plugins/mail/tests.py
index 161ded5860..83928b3597 100644
--- a/tests/sentry/plugins/mail/tests.py
+++ b/tests/sentry/plugins/mail/tests.py
@@ -58,7 +58,8 @@ class MailProcessorTest(TestCase):
     def test_mail_members_renders_interfaces(self, _send_mail):
         group = Mock(spec=Group)
         group.first_seen = datetime.datetime.now()
-        group.get_absolute_url.return_value = '/example'
+        group.project_id = 1
+        group.id = 2
         stacktrace = Mock(spec=Stacktrace)
         stacktrace.to_string.return_value = 'foo bar'
         stacktrace.get_title.return_value = 'Stacktrace'
