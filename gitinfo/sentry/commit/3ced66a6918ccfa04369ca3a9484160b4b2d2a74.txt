commit 3ced66a6918ccfa04369ca3a9484160b4b2d2a74
Author: Jess MacQueen <jess@getsentry.com>
Date:   Mon Sep 18 11:46:45 2017 -0700

    test(deletion): Add test for repo deletion when org is deleted

diff --git a/tests/sentry/tasks/test_deletion.py b/tests/sentry/tasks/test_deletion.py
index 6e5c40a192..a6e09dc828 100644
--- a/tests/sentry/tasks/test_deletion.py
+++ b/tests/sentry/tasks/test_deletion.py
@@ -1,6 +1,7 @@
 from __future__ import absolute_import
 
 from datetime import datetime, timedelta
+from mock import patch
 from uuid import uuid4
 
 import pytest
@@ -14,6 +15,7 @@ from sentry.models import (
     OrganizationStatus, Project, ProjectStatus, Release, ReleaseCommit, ReleaseEnvironment,
     Repository, TagKey, TagValue, Team, TeamStatus
 )
+from sentry.plugins.providers.dummy.repository import DummyRepositoryProvider
 from sentry.tasks.deletion import (
     delete_api_application, delete_group, delete_organization, delete_project, delete_repository,
     delete_tag_key, delete_team, generic_delete, revoke_api_tokens
@@ -27,6 +29,7 @@ class DeleteOrganizationTest(TestCase):
             name='test',
             status=OrganizationStatus.PENDING_DELETION,
         )
+        user = self.create_user()
         self.create_team(organization=org, name='test1')
         self.create_team(organization=org, name='test2')
         release = Release.objects.create(version='a' * 32, organization_id=org.id)
@@ -59,7 +62,9 @@ class DeleteOrganizationTest(TestCase):
         )
 
         with self.tasks():
-            delete_organization(object_id=org.id)
+            with patch.object(DummyRepositoryProvider, 'delete_repository') as mock_delete_repo:
+                delete_organization(object_id=org.id, actor_id=user.id)
+                mock_delete_repo.assert_called_once()  # NOQA
 
         assert not Organization.objects.filter(id=org.id).exists()
         assert not Environment.objects.filter(id=env.id).exists()
