commit 8387498bebf843f0b3a9001035bc8e8800876fa5
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Sep 2 16:16:20 2015 -0700

    Improve/fix ref tests
    
    Conflicts:
            tests/sentry/models/tests.py

diff --git a/tests/sentry/models/tests.py b/tests/sentry/models/tests.py
index 65a16769ab..c964934814 100644
--- a/tests/sentry/models/tests.py
+++ b/tests/sentry/models/tests.py
@@ -127,11 +127,16 @@ class EventNodeStoreTest(TestCase):
         assert event.data.id == node_id
 
     def test_screams_bloody_murder_when_ref_fails(self):
-        invalid_event = self.create_event()
-        event = self.create_event()
+        group1 = self.create_group()
+        invalid_event = self.create_event(group1)
+        group2 = self.create_group()
+        event = self.create_event(group2)
         event.data.bind_ref(invalid_event)
         event.save()
 
+        assert event.data.get_ref(event) == event.group.id
+        assert event.data.get_ref(invalid_event) == invalid_event.group.id
+
         with pytest.raises(NodeIntegrityFailure):
             Event.objects.bind_nodes([event], 'data')
 
@@ -144,3 +149,7 @@ class EventNodeStoreTest(TestCase):
         Event.objects.bind_nodes([event], 'data')
 
         assert event.data.ref == event.group.id
+
+    def test_basic_ref_binding(self):
+        event = self.create_event()
+        assert event.data.get_ref(event) == event.group.id
