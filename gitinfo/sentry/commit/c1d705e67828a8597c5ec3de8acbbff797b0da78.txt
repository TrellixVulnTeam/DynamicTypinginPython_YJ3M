commit c1d705e67828a8597c5ec3de8acbbff797b0da78
Author: Alberto Leal <mail4alberto@gmail.com>
Date:   Tue Jun 9 12:11:28 2020 -0400

    fix(discover2): Fix withSorts() by matching fields to their aggregated aliases (#19235)

diff --git a/src/sentry/static/sentry/app/utils/discover/eventView.tsx b/src/sentry/static/sentry/app/utils/discover/eventView.tsx
index 53eb93fff9..cc3ca3cc67 100644
--- a/src/sentry/static/sentry/app/utils/discover/eventView.tsx
+++ b/src/sentry/static/sentry/app/utils/discover/eventView.tsx
@@ -563,7 +563,7 @@ class EventView {
 
   withSorts(sorts: Sort[]): EventView {
     const newEventView = this.clone();
-    const fields = newEventView.fields.map(field => field.field);
+    const fields = newEventView.fields.map(field => getAggregateAlias(field.field));
     newEventView.sorts = sorts.filter(sort => fields.includes(sort.field));
 
     return newEventView;
diff --git a/tests/js/spec/utils/discover/eventView.spec.jsx b/tests/js/spec/utils/discover/eventView.spec.jsx
index 8f2957a516..c96210dd75 100644
--- a/tests/js/spec/utils/discover/eventView.spec.jsx
+++ b/tests/js/spec/utils/discover/eventView.spec.jsx
@@ -1979,10 +1979,10 @@ describe('EventView.withSorts()', function() {
       fields: [{field: 'p50()'}],
     });
     const updated = eventView.withSorts([
-      {kind: 'desc', field: 'p50()'},
+      {kind: 'desc', field: 'p50'},
       {kind: 'asc', field: 'unknown'},
     ]);
-    expect(updated.sorts).toEqual([{kind: 'desc', field: 'p50()'}]);
+    expect(updated.sorts).toEqual([{kind: 'desc', field: 'p50'}]);
   });
 });
 
