commit 2cf661eb4ade523bc619ed3f7e60062d25963ebf
Author: William Mak <william@wmak.io>
Date:   Thu Apr 30 14:14:39 2020 -0400

    feat(snuba) - Adding more data to the snuba span (#18523)
    
    * feat(snuba) - Moving query data to the snuba span
    
    - Right now the json body of the query is set as the description, but
      many of our queries gut truncated cause they're longer than the 200
      character description limit
    - Using referrer as span description
    - Adding everything from query_params onto the span via set_data

diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 394e2f1407..283210f9d5 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -556,10 +556,13 @@ def bulk_raw_query(snuba_param_list, referrer=None):
         try:
             with timer("snuba_query"):
                 body = json.dumps(query_params)
+                referrer = headers.get("referer", "<unknown>")
                 with thread_hub.start_span(
-                    op="snuba", description=u"query {}".format(body)
+                    op="snuba", description=u"query {}".format(referrer)
                 ) as span:
-                    span.set_tag("referrer", headers.get("referer", "<unknown>"))
+                    span.set_tag("referrer", referrer)
+                    for param_key, param_data in six.iteritems(query_params):
+                        span.set_data(param_key, param_data)
                     return (
                         _snuba_pool.urlopen("POST", "/query", body=body, headers=headers),
                         forward,
