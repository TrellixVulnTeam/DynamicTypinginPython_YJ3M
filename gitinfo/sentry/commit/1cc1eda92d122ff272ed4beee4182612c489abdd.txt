commit 1cc1eda92d122ff272ed4beee4182612c489abdd
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Dec 14 15:46:34 2017 -0800

    feat(ui): Add tooltip to Member row (#6757)

diff --git a/docs-ui/components/tooltip.stories.js b/docs-ui/components/tooltip.stories.js
new file mode 100644
index 0000000000..1c446a9f25
--- /dev/null
+++ b/docs-ui/components/tooltip.stories.js
@@ -0,0 +1,31 @@
+import React from 'react';
+import {storiesOf} from '@storybook/react';
+import {withInfo} from '@storybook/addon-info';
+
+import Tooltip from 'sentry-ui/tooltip';
+import Button from 'sentry-ui/buttons/button';
+
+storiesOf('Tooltip', module).add(
+  'default',
+  withInfo('Description')(() => (
+    <div>
+      <h1>Test</h1>
+      <div>
+        <Tooltip title="My tooltip">
+          <Button>Custom React Component</Button>
+        </Tooltip>
+      </div>
+
+      <div>
+        <Tooltip
+          title="My tooltip with options"
+          tooltipOptions={{
+            placement: 'bottom',
+          }}
+        >
+          <button>Native button</button>
+        </Tooltip>
+      </div>
+    </div>
+  ))
+);
diff --git a/src/sentry/static/sentry/app/components/tooltip.jsx b/src/sentry/static/sentry/app/components/tooltip.jsx
new file mode 100644
index 0000000000..e9dd4b4995
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/tooltip.jsx
@@ -0,0 +1,68 @@
+import React from 'react';
+import ReactDOM from 'react-dom';
+import PropTypes from 'prop-types';
+import classNames from 'classnames';
+import 'bootstrap/js/tooltip';
+
+// Non-mixin way to get Tooltips
+// Right now this just wraps Bootstrap's tooltip
+class Tooltip extends React.Component {
+  static propTypes = {
+    children: PropTypes.node.isRequired,
+    tooltipOptions: PropTypes.object,
+    title: PropTypes.node,
+  };
+
+  handleMount = ref => {
+    if (ref && !this.ref) {
+      // eslint-disable-next-line react/no-find-dom-node
+      this.$ref = $(ReactDOM.findDOMNode(ref));
+      this.attachTooltips(this.$ref);
+    } else if (!ref && this.ref) {
+      this.removeTooltips(this.$ref);
+      this.$ref = null;
+    }
+
+    this.ref = ref;
+  };
+
+  attachTooltips = $el => {
+    let {title, tooltipOptions} = this.props;
+    let options =
+      typeof tooltipOptions === 'function'
+        ? tooltipOptions.call(this)
+        : tooltipOptions || {};
+    $el.tooltip({
+      title,
+      ...options,
+    });
+  };
+
+  removeTooltips = $el => {
+    let {tooltipOptions} = this.props;
+    $el
+      .tooltip('destroy') // destroy tooltips on parent ...
+      .find(tooltipOptions && tooltipOptions.selector)
+      .tooltip('destroy'); // ... and descendents
+  };
+
+  render() {
+    let {
+      className,
+      title,
+      children,
+      // eslint-disable-next-line no-unused-vars
+      tooltipOptions,
+      ...props
+    } = this.props;
+
+    return React.cloneElement(children, {
+      ...props,
+      ref: this.handleMount,
+      className: classNames('tip', children.props && children.props.className, className),
+      title,
+    });
+  }
+}
+
+export default Tooltip;
diff --git a/src/sentry/static/sentry/app/views/settings/organization/members/organizationMemberRow.jsx b/src/sentry/static/sentry/app/views/settings/organization/members/organizationMemberRow.jsx
index f1ab71a699..8229cc22bb 100644
--- a/src/sentry/static/sentry/app/views/settings/organization/members/organizationMemberRow.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organization/members/organizationMemberRow.jsx
@@ -8,6 +8,7 @@ import Avatar from '../../../../components/avatar';
 import Button from '../../../../components/buttons/button';
 import Confirm from '../../../../components/confirm';
 import Link from '../../../../components/link';
+import Tooltip from '../../../../components/tooltip';
 import LoadingIndicator from '../../../../components/loadingIndicator';
 import SentryTypes from '../../../../proptypes';
 import recreateRoute from '../../../../utils/recreateRoute';
@@ -156,11 +157,9 @@ export default class OrganizationMemberRow extends React.PureComponent {
           ) : (
             <div>
               {!has2fa ? (
-                <span
-                  style={{color: '#B64236'}}
-                  className="icon-exclamation tip"
-                  title={t('Two-factor auth not enabled')}
-                />
+                <Tooltip title={t('Two-factor auth not enabled')}>
+                  <span style={{color: '#B64236'}} className="icon-exclamation" />
+                </Tooltip>
               ) : (
                 <span style={{color: 'green'}} className="icon-check" />
               )}
diff --git a/tests/js/spec/components/__snapshots__/tooltip.spec.jsx.snap b/tests/js/spec/components/__snapshots__/tooltip.spec.jsx.snap
new file mode 100644
index 0000000000..adff1f78b2
--- /dev/null
+++ b/tests/js/spec/components/__snapshots__/tooltip.spec.jsx.snap
@@ -0,0 +1,14 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`Tooltip renders 1`] = `
+<Tooltip
+  title="test"
+>
+  <span
+    className="tip"
+    title="test"
+  >
+    My Button
+  </span>
+</Tooltip>
+`;
diff --git a/tests/js/spec/components/tooltip.spec.jsx b/tests/js/spec/components/tooltip.spec.jsx
new file mode 100644
index 0000000000..fc79ddf36e
--- /dev/null
+++ b/tests/js/spec/components/tooltip.spec.jsx
@@ -0,0 +1,14 @@
+import React from 'react';
+import {mount} from 'enzyme';
+import Tooltip from 'app/components/tooltip';
+
+describe('Tooltip', function() {
+  it('renders', function() {
+    let wrapper = mount(
+      <Tooltip title="test">
+        <span>My Button</span>
+      </Tooltip>
+    );
+    expect(wrapper).toMatchSnapshot();
+  });
+});
diff --git a/tests/js/spec/views/__snapshots__/organizationMembersView.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationMembersView.spec.jsx.snap
index e8c9c11a22..8afe7f142c 100644
--- a/tests/js/spec/views/__snapshots__/organizationMembersView.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationMembersView.spec.jsx.snap
@@ -560,15 +560,19 @@ exports[`OrganizationMembersView No Require Link does not have 2fa warning if us
                             is={null}
                           >
                             <div>
-                              <span
-                                className="icon-exclamation tip"
-                                style={
-                                  Object {
-                                    "color": "#B64236",
-                                  }
-                                }
+                              <Tooltip
                                 title="Two-factor auth not enabled"
-                              />
+                              >
+                                <span
+                                  className="tip icon-exclamation"
+                                  style={
+                                    Object {
+                                      "color": "#B64236",
+                                    }
+                                  }
+                                  title="Two-factor auth not enabled"
+                                />
+                              </Tooltip>
                             </div>
                           </div>
                         </Base>
diff --git a/tests/js/spec/views/organizationMemberRow.spec.jsx b/tests/js/spec/views/organizationMemberRow.spec.jsx
index 90315e2a56..d18d92aa82 100644
--- a/tests/js/spec/views/organizationMemberRow.spec.jsx
+++ b/tests/js/spec/views/organizationMemberRow.spec.jsx
@@ -1,8 +1,7 @@
 import React from 'react';
 import {shallow} from 'enzyme';
 
-import OrganizationMemberRow
-  from 'app/views/settings/organization/members/organizationMemberRow';
+import OrganizationMemberRow from 'app/views/settings/organization/members/organizationMemberRow';
 
 const findWithText = (wrapper, text) =>
   wrapper.filterWhere(n => n.prop('children') && n.prop('children').includes(text));
@@ -15,18 +14,18 @@ describe('OrganizationMemberRow', function() {
     roleName: '',
     pending: false,
     flags: {
-      'sso:linked': false
+      'sso:linked': false,
     },
     user: {
       id: '',
       has2fa: false,
-      name: 'sentry@test.com'
-    }
+      name: 'sentry@test.com',
+    },
   };
 
   let currentUser = {
     id: '2',
-    email: 'currentUser@email.com'
+    email: 'currentUser@email.com',
   };
 
   let defaultProps = {
@@ -42,7 +41,7 @@ describe('OrganizationMemberRow', function() {
     currentUser,
     onSendInvite: () => {},
     onRemove: () => {},
-    onLeave: () => {}
+    onLeave: () => {},
   };
 
   beforeEach(function() {});
@@ -55,12 +54,12 @@ describe('OrganizationMemberRow', function() {
           ...member,
           user: {
             ...member.user,
-            has2fa: true
-          }
+            has2fa: true,
+          },
         }}
       />
     );
-    expect(wrapper.find('.icon-exclamation.tip')).toHaveLength(0);
+    expect(wrapper.find('.icon-exclamation')).toHaveLength(0);
   });
 
   it('has 2fa warning if user does not have 2fa enabled', function() {
@@ -71,12 +70,12 @@ describe('OrganizationMemberRow', function() {
           ...member,
           user: {
             ...member.user,
-            has2fa: false
-          }
+            has2fa: false,
+          },
         }}
       />
     );
-    expect(wrapper.find('.icon-exclamation.tip')).toHaveLength(1);
+    expect(wrapper.find('.icon-exclamation')).toHaveLength(1);
   });
 
   describe('Pending user', function() {
@@ -84,8 +83,8 @@ describe('OrganizationMemberRow', function() {
       ...defaultProps,
       member: {
         ...member,
-        pending: true
-      }
+        pending: true,
+      },
     };
 
     it('has "Invited" status, no "Resend Invite"', function() {
@@ -94,7 +93,7 @@ describe('OrganizationMemberRow', function() {
           {...props}
           member={{
             ...member,
-            pending: true
+            pending: true,
           }}
         />
       );
@@ -142,9 +141,9 @@ describe('OrganizationMemberRow', function() {
     let props = {
       ...defaultProps,
       flags: {
-        'sso:link': false
+        'sso:link': false,
       },
-      requireLink: true
+      requireLink: true,
     };
 
     it('shows "Invited" status if user has not registered and not linked', function() {
@@ -153,7 +152,7 @@ describe('OrganizationMemberRow', function() {
           {...props}
           member={{
             ...member,
-            pending: true
+            pending: true,
           }}
         />
       );
@@ -168,7 +167,7 @@ describe('OrganizationMemberRow', function() {
         <OrganizationMemberRow
           {...props}
           member={{
-            ...member
+            ...member,
           }}
         />
       );
@@ -184,7 +183,7 @@ describe('OrganizationMemberRow', function() {
           {...props}
           canAddMembers={true}
           member={{
-            ...member
+            ...member,
           }}
         />
       );
@@ -199,16 +198,16 @@ describe('OrganizationMemberRow', function() {
           member={{
             ...member,
             flags: {
-              'sso:linked': true
+              'sso:linked': true,
             },
             user: {
               ...member.user,
-              has2fa: false
-            }
+              has2fa: false,
+            },
           }}
         />
       );
-      expect(wrapper.find('.icon-exclamation.tip')).toHaveLength(1);
+      expect(wrapper.find('.icon-exclamation')).toHaveLength(1);
     });
   });
 
@@ -217,8 +216,8 @@ describe('OrganizationMemberRow', function() {
       ...defaultProps,
       member: {
         ...member,
-        email: 'currentUser@email.com'
-      }
+        email: 'currentUser@email.com',
+      },
     };
 
     it('has button to leave organization and no button to remove', function() {
@@ -230,16 +229,18 @@ describe('OrganizationMemberRow', function() {
     it('has disabled button to leave organization and no button to remove when member can not leave', function() {
       let wrapper = shallow(<OrganizationMemberRow {...props} memberCanLeave={false} />);
       expect(findWithText(wrapper.find('Button'), 'Leave')).toHaveLength(1);
-      expect(findWithText(wrapper.find('Button'), 'Leave').first().prop('disabled')).toBe(
-        true
-      );
+      expect(
+        findWithText(wrapper.find('Button'), 'Leave')
+          .first()
+          .prop('disabled')
+      ).toBe(true);
       expect(findWithText(wrapper.find('Button'), 'Remove')).toHaveLength(0);
     });
   });
 
   describe('Not Current User', function() {
     let props = {
-      ...defaultProps
+      ...defaultProps,
     };
 
     it('does not have Leave button', function() {
