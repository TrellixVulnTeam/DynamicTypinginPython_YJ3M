commit 861a74a0fda3db7edf45c6772c6f4e3b8022c56d
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Jan 22 14:26:25 2019 +0100

    feat: Added percent project opt-in code path (#11638)

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 986bd62672..87bf4d786b 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -450,6 +450,11 @@ class EventManager(object):
                 return False
             if self._project.id in options.get('store.projects-normalize-in-rust-opt-in'):
                 return True
+            opt_in_rate = options.get('store.projects-normalize-in-rust-percent-opt-in')
+            if opt_in_rate > 0.0:
+                bucket = ((self._project.id * 2654435761) % (2 ** 32)) % 1000
+                return bucket <= (opt_in_rate * 1000)
+
         return ENABLE_RUST
 
     def normalize(self):
