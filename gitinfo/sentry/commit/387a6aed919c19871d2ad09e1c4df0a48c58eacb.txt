commit 387a6aed919c19871d2ad09e1c4df0a48c58eacb
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 1 23:54:15 2013 -0700

    Event resolution and normalization of resolution

diff --git a/src/sentry/models.py b/src/sentry/models.py
index e6601b08c0..21fae94243 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -1075,7 +1075,7 @@ class Alert(Model):
         return cls.objects.filter(
             project=project_id,
             group_id__isnull=True,
-            datetime__gte=timezone.now() - timedelta(minutes=30),
+            datetime__gte=timezone.now() - timedelta(minutes=60),
             status=STATUS_UNRESOLVED,
         ).order_by('-datetime')
 
@@ -1089,7 +1089,7 @@ class Alert(Model):
 
         # TODO: there is a race condition if we're calling this function for the same project
         if manager.filter(
-                project=project_id, datetime__gte=now - timedelta(minutes=30),
+                project=project_id, datetime__gte=now - timedelta(minutes=60),
                 status=STATUS_UNRESOLVED).exists():
             return
 
@@ -1117,6 +1117,11 @@ class Alert(Model):
 
         return alert
 
+    @property
+    def is_resolved(self):
+        return (self.status == STATUS_RESOLVED
+                or self.datetime < timezone.now() - timedelta(minutes=60))
+
 
 class AlertRelatedGroup(Model):
     group = models.ForeignKey(Group)
diff --git a/src/sentry/templates/sentry/alerts/details.html b/src/sentry/templates/sentry/alerts/details.html
index 089176eb00..11a7599337 100644
--- a/src/sentry/templates/sentry/alerts/details.html
+++ b/src/sentry/templates/sentry/alerts/details.html
@@ -6,25 +6,24 @@
 
 {% block title %}{{ alert.datetime }} | {{ block.super }}{% endblock %}
 
-{% block bodyclass %}{% endblock %}
-
 {% block breadcrumb %}
     {{ block.super }}
     <li class="divider"></li>
-    <li><a href="{% url 'sentry-project-alert-details' project.team.slug project.slug alert.id %}">
+    <li><a href="{% url 'sentry-alert-details' project.team.slug project.slug alert.id %}">
         {% blocktrans with alert.datetime as datetime %}Alert at {{ datetime }}{% endblocktrans %}</a></li>
 {% endblock %}
 
+{% block bodyclass %} with-sidebar{% endblock %}
+
 {% block main %}
     <section class="body">
         <div class="page-header">
-            <h2>{% blocktrans with alert.datetime as datetime %}Alert at {{ datetime }}{% endblocktrans %}</h2>
+            <h2>
+                {% blocktrans with alert.datetime as datetime %}Alert at {{ datetime }}{% endblocktrans %}
+                <small style="color: {% if alert.is_resolved %}green{% else %}red{% endif %};">{{ alert.get_status_display }}</small>
+            </h2>
         </div>
         {{ alert.message|linebreaks }}
-        <dl>
-            <dt>{% trans "When:" %}</dt>
-            <dd><span class="pretty-date" title="{{ alert.datetime|date:"c" }}Z">{{ alert.datetime|timesince }}</span> ({{ alert.datetime }})</dd>
-        </dl>
 
         <div class="page-header">
             <h3>{% trans "Related Events" %} <small>{% trans "Trending at time of alert" %}</small></h3>
@@ -48,3 +47,16 @@
         {% endif %}
     </section>
 {% endblock %}
+
+{% block sidebar %}
+    {% if not alert.is_resolved %}
+        <a href="{% url 'sentry-resolve-alert' project.team.slug project.slug alert.id %}" class="btn btn-primary" style="display: block">Resolve Alert</a>
+        <br>
+    {% endif %}
+    <h6>{% trans "Meta" %}</h6>
+    <dl>
+        <dt>{% trans "When:" %}</dt>
+        <dd><span class="pretty-date" title="{{ alert.datetime|date:"c" }}Z">{{ alert.datetime|timesince }}</span><br>
+            <small>{{ alert.datetime }} {{ alert.datetime.tzinfo }}</small></dd>
+    </dl>
+{% endblock %}
\ No newline at end of file
diff --git a/src/sentry/templates/sentry/alerts/list.html b/src/sentry/templates/sentry/alerts/list.html
index 2c76d5e546..96a1aee9d2 100644
--- a/src/sentry/templates/sentry/alerts/list.html
+++ b/src/sentry/templates/sentry/alerts/list.html
@@ -11,7 +11,7 @@
 {% block breadcrumb %}
     {{ block.super }}
     <li class="divider"></li>
-    <li><a href="{% url 'sentry-project-alerts' project.team.slug project.slug %}">{% trans "Alerts" %}</a></li>
+    <li><a href="{% url 'sentry-alerts' project.team.slug project.slug %}">{% trans "Alerts" %}</a></li>
 {% endblock %}
 
 {% block main %}
@@ -23,7 +23,7 @@
         <ul>
             {% for alert in alert_list %}
                 <li>
-                    <h4><a href="{% url 'sentry-project-alert-details' project.team.slug project.slug alert.id %}">{{ alert.datetime }}</a> <small> &mdash; <span class="pretty-date" title="{{ alert.datetime|date:"c" }}Z">{{ alert.datetime|timesince }}</span></small></h4>
+                    <h4><a href="{% url 'sentry-alert-details' project.team.slug project.slug alert.id %}">{{ alert.datetime }}</a> <small> &mdash; <span class="pretty-date" title="{{ alert.datetime|date:"c" }}Z">{{ alert.datetime|timesince }}</span></small></h4>
                     {{ alert.message|linebreaks }}
                 </li>
             {% endfor %}
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index 3831a3f89e..9f89c4b15f 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -134,7 +134,7 @@
             {% for alert in recent_alerts %}
                 <li class="alert alert-error">
                     <a class="close" data-dismiss="alert">Ã—</a>
-                    <a href="{% url 'sentry-project-alert-details' project.team.slug project.slug alert.id %}">{{ alert.message }}</a>
+                    <a href="{% url 'sentry-alert-details' project.team.slug project.slug alert.id %}">{{ alert.message }}</a>
                     <small>&mdash; {{ alert.datetime|timesince }}</small>
                 </li>
             {% endfor %}
diff --git a/src/sentry/web/frontend/alerts.py b/src/sentry/web/frontend/alerts.py
index a11b47fd12..44cad5dee8 100644
--- a/src/sentry/web/frontend/alerts.py
+++ b/src/sentry/web/frontend/alerts.py
@@ -7,13 +7,11 @@ sentry.web.frontend.alerts
 """
 from __future__ import division
 
-
 from django.core.urlresolvers import reverse
 from django.http import HttpResponseRedirect
 
-
+from sentry.constants import STATUS_RESOLVED
 from sentry.models import Alert
-
 from sentry.web.decorators import has_access, login_required
 from sentry.web.helpers import render_to_response
 
@@ -37,7 +35,7 @@ def alert_details(request, team, project, alert_id):
     try:
         alert = Alert.objects.get(id=alert_id, project=project)
     except Alert.DoesNotExist:
-        return HttpResponseRedirect(reverse('sentry-project-alerts', args=[team.slug, project.slug]))
+        return HttpResponseRedirect(reverse('sentry-alerts', args=[team.slug, project.slug]))
 
     related_group_list = list(alert.related_groups.order_by('-score', '-times_seen'))
 
@@ -48,3 +46,16 @@ def alert_details(request, team, project, alert_id):
         'related_group_list': related_group_list,
         'SECTION': 'events',
     }, request)
+
+
+@login_required
+@has_access
+def resolve_alert(request, team, project, alert_id):
+    try:
+        alert = Alert.objects.get(id=alert_id, project=project)
+    except Alert.DoesNotExist:
+        return HttpResponseRedirect(reverse('sentry-alerts', args=[team.slug, project.slug]))
+
+    alert.update(status=STATUS_RESOLVED)
+
+    return HttpResponseRedirect(reverse('sentry-alert-details', args=[team.slug, project.slug, alert.id]))
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 691637ecc1..944a6d5030 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -266,9 +266,11 @@ urlpatterns = patterns('',
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/search/$', groups.search,
         name='sentry-search'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/alerts/$', alerts.alert_list,
-        name='sentry-project-alerts'),
+        name='sentry-alerts'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/alerts/(?P<alert_id>\d+)/$', alerts.alert_details,
-        name='sentry-project-alert-details'),
+        name='sentry-alert-details'),
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/alerts/(?P<alert_id>\d+)/resolve/$', alerts.resolve_alert,
+        name='sentry-resolve-alert'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/stream/$', groups.group_list),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/$', groups.group_list,
         name='sentry-stream'),
