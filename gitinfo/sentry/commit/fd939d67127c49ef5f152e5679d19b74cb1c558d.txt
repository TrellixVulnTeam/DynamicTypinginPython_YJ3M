commit fd939d67127c49ef5f152e5679d19b74cb1c558d
Author: MeredithAnya <meredith.a.heller@gmail.com>
Date:   Wed Aug 1 15:54:04 2018 -0700

    fix(integrations): Fix BitBucket issue link/create, add get_issue_url (#9230)
    
    * fix(integrations): Fix bitbucket issue link/create, add get_issue_url

diff --git a/src/sentry/integrations/bitbucket/issues.py b/src/sentry/integrations/bitbucket/issues.py
index 233e107a92..2321223937 100644
--- a/src/sentry/integrations/bitbucket/issues.py
+++ b/src/sentry/integrations/bitbucket/issues.py
@@ -21,15 +21,18 @@ ERR_404 = (
 
 class BitbucketIssueBasicMixin(IssueBasicMixin):
 
+    def get_issue_url(self, key):
+        repo, issue_id = key.split('#')
+        return 'https://bitbucket.org/{}/issues/{}'.format(repo, issue_id)
+
     def get_repo_choices(self, **kwargs):
-        client = self.get_client()
 
         try:
-            repos = client.get_repos(self.username)
+            repos = self.get_repositories()
         except ApiError:
             repo_choices = []
         else:
-            repo_choices = [(repo['uuid'], repo['full_name']) for repo in repos['values']]
+            repo_choices = [(repo['identifier'], repo['name']) for repo in repos]
 
         params = kwargs.get('params', {})
         default_repo = params.get('repo', repo_choices[0][0])
@@ -99,6 +102,7 @@ class BitbucketIssueBasicMixin(IssueBasicMixin):
             'key': issue['id'],
             'title': issue['title'],
             'description': issue['content']['html'],  # users content rendered as html
+            'repo': data.get('repo'),
         }
 
     def get_issue(self, issue_id, **kwargs):
