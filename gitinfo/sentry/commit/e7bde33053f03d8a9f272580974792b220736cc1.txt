commit e7bde33053f03d8a9f272580974792b220736cc1
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Oct 19 17:53:22 2011 -0700

    Change counts to truncate the number and append a suffix based on range

diff --git a/CHANGES b/CHANGES
index de55a8dcf7..9a09da63ba 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,3 +1,7 @@
+1.13.2
+
+* Counts will now render differently with large values (e.g. 13000 will now be 13k)
+
 1.13.1
 
 * Search by message_id will now display a list of results if there are multiple matches.
diff --git a/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/index.html b/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/index.html
index fa24b68cee..0f338c0962 100644
--- a/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/index.html
+++ b/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/index.html
@@ -12,7 +12,7 @@
     </div>
     <ul class="server-list">
         {% for server_name, times_seen in server_list.objects %}
-            <li><span class="count">{{ times_seen }}</span> <a href="{% url sentry %}?server_name={{ server_name }}">{{ server_name }}</a></li>
+            <li><span class="count">{{ times_seen|small_count }}</span> <a href="{% url sentry %}?server_name={{ server_name }}">{{ server_name }}</a></li>
         {% endfor %}
     </ul>
     <div class="paging-wrap">
diff --git a/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/widget.html b/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/widget.html
index 1db7693ecb..a8696c9183 100644
--- a/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/widget.html
+++ b/sentry/plugins/sentry_servers/templates/sentry/plugins/sentry_servers/widget.html
@@ -6,7 +6,7 @@
 
         <ul class="server-list">
             {% for server, priority in unique_servers|with_priority:1 %}
-                <li class="priority-{{ priority }}"><span class="count">{{ server.1 }}</span> <a href="{% url sentry %}?server_name={{ server.0 }}">{{ server.0 }}</a></li>
+                <li class="priority-{{ priority }}"><span class="count">{{ server.1|small_count }}</span> <a href="{% url sentry %}?server_name={{ server.0 }}">{{ server.0 }}</a></li>
             {% endfor %}
         </ul>
     {% endif %}
diff --git a/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/index.html b/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/index.html
index 6ed849b2df..895b3b26b3 100644
--- a/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/index.html
+++ b/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/index.html
@@ -12,7 +12,7 @@
     </div>
     <ul class="server-list">
         {% for site, times_seen in site_list.objects %}
-            <li><span class="count">{{ times_seen }}</span> <a href="{% url sentry %}?site={{ site }}">{{ site }}</a></li>
+            <li><span class="count">{{ times_seen|small_count }}</span> <a href="{% url sentry %}?site={{ site }}">{{ site }}</a></li>
         {% endfor %}
     </ul>
     <div class="paging-wrap">
diff --git a/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/widget.html b/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/widget.html
index 91cb45610a..ad8585c9c4 100644
--- a/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/widget.html
+++ b/sentry/plugins/sentry_sites/templates/sentry/plugins/sentry_sites/widget.html
@@ -6,7 +6,7 @@
 
         <ul class="server-list">
             {% for site, priority in unique_sites|with_priority:1 %}
-                <li class="priority-{{ priority }}"><span class="count">{{ site.1 }}</span> <a href="{% url sentry %}?site={{ site.0 }}">{{ site.0 }}</a></li>
+                <li class="priority-{{ priority }}"><span class="count">{{ site.1|small_count }}</span> <a href="{% url sentry %}?site={{ site.0 }}">{{ site.0 }}</a></li>
             {% endfor %}
         </ul>
     {% endif %}
diff --git a/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/index.html b/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/index.html
index 1ef90dd807..f7b063396c 100644
--- a/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/index.html
+++ b/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/index.html
@@ -12,7 +12,7 @@
     </div>
     <ul class="url-list">
         {% for url, times_seen in url_list.objects %}
-            <li><span class="count">{{ times_seen }}</span> <a href="{{ url }}">{{ url }}</a></li>
+            <li><span class="count">{{ times_seen|small_count }}</span> <a href="{{ url }}">{{ url }}</a></li>
         {% endfor %}
     </ul>
     <div class="paging-wrap">
diff --git a/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/widget.html b/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/widget.html
index 3e16d94cfe..0d1b4e6f11 100644
--- a/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/widget.html
+++ b/sentry/plugins/sentry_urls/templates/sentry/plugins/sentry_urls/widget.html
@@ -6,7 +6,7 @@
 
         <ul class="url-list">
             {% for link, priority in unique_urls|with_priority:1 %}
-                <li class="priority-{{ priority }}"><span class="count">{{ link.1 }}</span> <a href="{{ link.0 }}">{{ link.0 }}</a></li>
+                <li class="priority-{{ priority }}"><span class="count">{{ link.1|small_count }}</span> <a href="{{ link.0 }}">{{ link.0 }}</a></li>
             {% endfor %}
         </ul>
     {% endif %}
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index 940d52b4f6..b157469223 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -429,11 +429,18 @@ dl.flat dd {
     padding-bottom: 5px;
 }
 /* messages generic */
-.count { background: #000; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; padding: 0 5px; margin-right: 3px; line-height: 19px; color: #fff; display: inline-block; }
-.count-digits-4 { font-size: 0.8em; }
-.count-digits-5 { font-size: 0.7em; }
-.count-digits-6 { font-size: 0.6em; }
-.count-digits-7 { font-size: 0.5em; }
+.count {
+    background: #000;
+    -moz-border-radius: 5px;
+    -webkit-border-radius: 5px;
+    border-radius: 5px;
+    padding: 0 5px;
+    margin-right: 3px;
+    line-height: 19px;
+    color: #fff;
+    display: inline-block;
+    font-size: 0.8em;
+}
 
 /* message list */
 .messages { list-style: none; margin-left: 0; }
diff --git a/sentry/templates/sentry/group/details.html b/sentry/templates/sentry/group/details.html
index 0aa33af36c..f2cf07852d 100644
--- a/sentry/templates/sentry/group/details.html
+++ b/sentry/templates/sentry/group/details.html
@@ -44,7 +44,7 @@
 {% block main %}
     <ul class="messages" id="message_list">
         <li class="{% cycle 'row1' 'row2' %} level-{{ group.level }} active" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
-            <span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
+            <span class="count">{{ group.times_seen|small_count }}</span>
             <h3>{% if group.view %}{{ group.view }}{% else %}{{ group.message_top }}{% endif %}</h3>
             <span class="last_seen" title="{{ group.last_seen }}">{{ group.last_seen|timesince }}</span>
             <span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index e2d8851754..83aee12785 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -1,16 +1,16 @@
 {% load sentry_helpers %}
 
 <li class="{% cycle 'row1' 'row2' %} level-{{ group.level }}{% if priority %} priority-{{ priority }}{% endif %}" id="group_{{ group.pk }}" data-sentry-count="{{ group.times_seen }}">
-    <span class="count count-digits-{{ group.times_seen|num_digits }}">{{ group.times_seen }}</span>
+    <span class="count">{{ group.times_seen|small_count }}</span>
     <h3><a href="{% url sentry-group group.pk %}">{% if group.view %}{{ group.view }}{% else %}{{ group.message_top|truncatechars:100 }}{% endif %}</a></h3>
     <span class="last_seen">{{ group.last_seen|timesince }}</span>
     <span class="status status-{{ group.status }}">{{ group.get_status_display }}</span>
     <p class="message">
-        <span class="tag tag-level">{{ group.get_level_display }}</span> 
-        <span class="tag tag-logger">{{ group.logger }}</span> 
+        <span class="tag tag-level">{{ group.get_level_display }}</span>
+        <span class="tag tag-logger">{{ group.logger }}</span>
         {% with group.get_version as version %}
             {% if version %}
-                <span class="tag tag-version">{{ version.0 }} {{ version.1 }}</span> 
+                <span class="tag tag-version">{{ version.0 }} {{ version.1 }}</span>
             {% endif %}
         {% endwith %}
         {% for tag in group|get_tags:request %}<span class="tag">{{ tag }}</span> {% endfor %}
diff --git a/sentry/templates/sentry/partial/_notification.html b/sentry/templates/sentry/partial/_notification.html
index c05e380122..f8639e44cc 100644
--- a/sentry/templates/sentry/partial/_notification.html
+++ b/sentry/templates/sentry/partial/_notification.html
@@ -1,7 +1,7 @@
 <doctype html>
 <html>
     <head>
-        <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
+        <meta http-equiv="content-type" content="text/html; charset=utf-8">
         <meta name="robots" content="NONE,NOARCHIVE">
         <link href="{% url sentry-media "images/sentry.png" %}" rel="shortcut icon"/>
         <style type="text/css">
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 6448876103..ccb4d750c1 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -47,6 +47,20 @@ def as_sorted(value):
 def is_dict(value):
     return isinstance(value, dict)
 
+@register.filter
+def small_count(v):
+    z = [
+        (1000000000, _('b')),
+        (1000000, _('m')),
+        (10, _('k')),
+    ]
+    v = int(v)
+    for x, y in z:
+        o, p = divmod(v, x)
+        if o > 1:
+            return '%.1f%s' % (v / float(x), y)
+    return v
+
 @register.filter
 def with_priority(result_list, key='score'):
     if result_list:
diff --git a/setup.py b/setup.py
index bf5e51e95d..623c29a291 100755
--- a/setup.py
+++ b/setup.py
@@ -36,7 +36,7 @@ if sys.version_info[:2] < (2, 5):
 
 setup(
     name='django-sentry',
-    version='1.13.1',
+    version='1.13.2',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/django-sentry',
