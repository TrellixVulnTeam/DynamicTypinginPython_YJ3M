commit 38be67672538713addae2d846d00ee16943d7c44
Author: Bruno Garcia <github@brunogarcia.com>
Date:   Thu Mar 21 14:21:17 2019 +0100

    fix: Missing threads with pcallstack (#12493)

diff --git a/src/sentry/lang/native/unreal.py b/src/sentry/lang/native/unreal.py
index 754d4f3ab2..199363a8e6 100644
--- a/src/sentry/lang/native/unreal.py
+++ b/src/sentry/lang/native/unreal.py
@@ -8,7 +8,7 @@ import re
 import uuid
 
 _portable_callstack_regexp = re.compile(
-    r'((?P<package>[\w]+) )?(?P<baseaddr>0x[\da-fA-F]+) \+ (?P<offset>[\da-fA-F]+)')
+    r'(?P<package>[\w]+) (?P<baseaddr>0x[\da-fA-F]+) \+ (?P<offset>[\da-fA-F]+)')
 
 
 def process_unreal_crash(payload, user_id, environment, event):
@@ -136,7 +136,6 @@ def merge_unreal_context_event(unreal_context, event, project):
         portable_callstack = runtime_prop.pop('portable_call_stack', None)
         if portable_callstack is not None:
             frames = []
-
             images = get_path(event, 'debug_meta', 'images', filter=True, default=())
             for match in _portable_callstack_regexp.finditer(portable_callstack):
                 baseaddr = int(match.group('baseaddr'), 16)
diff --git a/tests/sentry/lang/native/test_unreal.py b/tests/sentry/lang/native/test_unreal.py
index bc9bc63557..74231ecee1 100644
--- a/tests/sentry/lang/native/test_unreal.py
+++ b/tests/sentry/lang/native/test_unreal.py
@@ -68,6 +68,17 @@ class UnrealIntegrationTest(TestCase):
             assert 'YetAnother' == event['stacktrace']['frames'][2]['package']
             assert 'YetAnother' == event['stacktrace']['frames'][2]['package']
 
+    def test_merge_unreal_context_event_pcallstack_no_threads(self):
+        event = {}
+        unreal_context = {
+            'runtime_properties': {
+                'portable_call_stack': '0x00000000fc440000 + ffffffff PackageA 0x000000003fb70000 + e23831 PackageA 0x000000003fb70000 + 495d7b PackageA 0x000000003fb70000 + 1cbb89',
+                'threads': [],
+            }
+        }
+        merge_unreal_context_event(unreal_context, event, self.project)
+        assert event.get('threads') is None
+
     def test_merge_unreal_context_event_without_user(self):
         expected_message = 'user comments'
         context = {
