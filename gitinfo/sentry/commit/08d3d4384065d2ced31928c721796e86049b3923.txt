commit 08d3d4384065d2ced31928c721796e86049b3923
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Thu Aug 2 14:36:15 2018 -0700

    fix(integrations): Remove project integration model from installation (#9277)
    
    fixes SENTRY-73V

diff --git a/src/sentry/api/serializers/models/integration.py b/src/sentry/api/serializers/models/integration.py
index 6f12637911..c5f9896737 100644
--- a/src/sentry/api/serializers/models/integration.py
+++ b/src/sentry/api/serializers/models/integration.py
@@ -50,7 +50,6 @@ class IntegrationConfigSerializer(IntegrationSerializer):
         try:
             install = obj.get_installation(
                 organization_id=self.organization_id,
-                project_id=self.project_id,
             )
         except NotImplementedError:
             # The integration may not implement a Installed Integration object
diff --git a/src/sentry/integrations/base.py b/src/sentry/integrations/base.py
index 54d18ae163..8de646d17c 100644
--- a/src/sentry/integrations/base.py
+++ b/src/sentry/integrations/base.py
@@ -16,7 +16,7 @@ from .exceptions import (
     ApiHostError, ApiError, ApiUnauthorized, IntegrationError, UnsupportedResponseType
 )
 from .constants import ERR_UNAUTHORIZED, ERR_INTERNAL, ERR_UNSUPPORTED_RESPONSE_TYPE
-from sentry.models import Identity, OrganizationIntegration, ProjectIntegration
+from sentry.models import Identity, OrganizationIntegration
 
 IntegrationMetadata = namedtuple('IntegrationMetadata', [
     'description',  # A markdown description of the integration
@@ -86,11 +86,11 @@ class IntegrationProvider(PipelineProvider):
     features = frozenset()
 
     @classmethod
-    def get_installation(cls, model, organization_id, project_id=None, **kwargs):
+    def get_installation(cls, model, organization_id, **kwargs):
         if cls.integration_cls is None:
             raise NotImplementedError
 
-        return cls.integration_cls(model, organization_id, project_id, **kwargs)
+        return cls.integration_cls(model, organization_id, **kwargs)
 
     def get_logger(self):
         return logging.getLogger('sentry.integration.%s' % (self.key, ))
@@ -163,19 +163,11 @@ class Integration(object):
 
     logger = logging.getLogger('sentry.integrations')
 
-    def __init__(self, model, organization_id, project_id=None):
+    def __init__(self, model, organization_id):
         self.model = model
         self.organization_id = organization_id
         self._org_integration = None
 
-        if project_id is not None:
-            self.project_integration = ProjectIntegration.objects.get(
-                project_id=project_id,
-                integration_id=model.id,
-            )
-        else:
-            self.project_integration = None
-
     @property
     def org_integration(self):
         if self._org_integration is None:
diff --git a/src/sentry/models/integration.py b/src/sentry/models/integration.py
index 497b31eede..ee40445fc8 100644
--- a/src/sentry/models/integration.py
+++ b/src/sentry/models/integration.py
@@ -87,8 +87,8 @@ class Integration(Model):
         from sentry import integrations
         return integrations.get(self.provider)
 
-    def get_installation(self, organization_id, project_id=None, **kwargs):
-        return self.get_provider().get_installation(self, organization_id, project_id, **kwargs)
+    def get_installation(self, organization_id, **kwargs):
+        return self.get_provider().get_installation(self, organization_id, **kwargs)
 
     def has_feature(self, feature):
         return feature in self.get_provider().features
diff --git a/src/sentry/tasks/integrations.py b/src/sentry/tasks/integrations.py
index 49447afbaf..9f61a81dee 100644
--- a/src/sentry/tasks/integrations.py
+++ b/src/sentry/tasks/integrations.py
@@ -93,7 +93,6 @@ def sync_status_outbound(group_id, external_issue_id, **kwargs):
     integration = Integration.objects.get(id=external_issue.integration_id)
     installation = integration.get_installation(
         organization_id=external_issue.organization_id,
-        project_id=group.project_id,
     )
     if installation.should_sync('outbound_status'):
         installation.sync_status_outbound(
diff --git a/tests/sentry/integrations/test_base.py b/tests/sentry/integrations/test_base.py
index 82a69311f0..12d75288fa 100644
--- a/tests/sentry/integrations/test_base.py
+++ b/tests/sentry/integrations/test_base.py
@@ -35,12 +35,9 @@ class IntegrationTestCase(TestCase):
         integration = Integration(self.model, self.organization.id)
         integration.name = 'Base'
 
-        assert integration.project_integration is None
-
     def test_with_context(self):
-        integration = Integration(self.model, self.organization.id, self.project.id)
+        integration = Integration(self.model, self.organization.id)
 
         assert integration.model == self.model
         assert integration.org_integration == self.org_integration
-        assert integration.project_integration == self.project_integration
         assert integration.get_default_identity() == self.identity
diff --git a/tests/sentry/integrations/vsts/test_webhooks.py b/tests/sentry/integrations/vsts/test_webhooks.py
index 92a5dc1374..7cca9ea32a 100644
--- a/tests/sentry/integrations/vsts/test_webhooks.py
+++ b/tests/sentry/integrations/vsts/test_webhooks.py
@@ -57,7 +57,7 @@ class VstsWebhookWorkItemTest(APITestCase):
         }
         self.org_integration.save()
         self.project_integration = self.model.add_project(self.project.id)
-        self.integration = VstsIntegration(self.model, self.organization.id, self.project.id)
+        self.integration = VstsIntegration(self.model, self.organization.id)
 
         self.user_to_assign = self.create_user('sentryuseremail@email.com')
 
