commit df73da581a3559c79698090ba056c2cf56de5cca
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 2 20:04:25 2014 -0700

    Add get_sums helper

diff --git a/src/sentry/tsdb/base.py b/src/sentry/tsdb/base.py
index 8079006fef..f022df5592 100644
--- a/src/sentry/tsdb/base.py
+++ b/src/sentry/tsdb/base.py
@@ -91,9 +91,19 @@ class BaseTSDB(object):
 
         Both ``start`` and ``end`` are inclusive.
 
+        Returns a mapping of key => [(timestamp, count), ...].
+
         >>> now = timezone.now()
         >>> get_keys(TimeSeriesModel.group, [1, 2, 3],
         >>>          start=now - timedelta(days=1),
         >>>          end=now)
         """
         raise NotImplementedError
+
+    def get_sums(self, model, keys, start, end, rollup=None):
+        range_set = self.get_range(model, keys, start, end, rollup)
+        sum_set = dict(
+            (key, sum(p for _, p in points))
+            for (key, points) in range_set.iteritems()
+        )
+        return sum_set
diff --git a/tests/sentry/tsdb/test_redis.py b/tests/sentry/tsdb/test_redis.py
index 4a0d46ddf0..54c0c9ac98 100644
--- a/tests/sentry/tsdb/test_redis.py
+++ b/tests/sentry/tsdb/test_redis.py
@@ -73,3 +73,9 @@ class RedisTSDBTest(TestCase):
         assert results == {
             2: [(1368889200, 0), (1368892800, 0), (1368896400, 0), (1368900000, 4)],
         }
+
+        results = self.db.get_sums(TSDBModel.project, [1, 2], start, end)
+        assert results == {
+            1: 9,
+            2: 4,
+        }
