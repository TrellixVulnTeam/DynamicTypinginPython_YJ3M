commit e44b4ecf2dcc61238a9eac3661deca29cb0ff30f
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Jun 29 15:12:53 2020 +0200

    fix(store): Wipe attachment cache unconditionally (#19546)
    
    I believe the old logic was in place from a time where we stackwalked minidumps in the store endpoint. There the logic makes perfect sense as a project without the event attachments feature would never have anything in the attachments cache.

diff --git a/src/sentry/tasks/store.py b/src/sentry/tasks/store.py
index c335d5823c..a1c9835092 100644
--- a/src/sentry/tasks/store.py
+++ b/src/sentry/tasks/store.py
@@ -761,12 +761,11 @@ def _do_save_event(
             )
             return
 
-        event = None
         try:
             with metrics.timer("tasks.store.do_save_event.event_manager.save"):
                 manager = EventManager(data)
                 # event.project.organization is populated after this statement.
-                event = manager.save(
+                manager.save(
                     project_id, assume_normalized=True, start_time=start_time, cache_key=cache_key
                 )
 
@@ -779,12 +778,7 @@ def _do_save_event(
                     event_processing_store.delete_by_key(cache_key)
 
                 with metrics.timer("tasks.store.do_save_event.delete_attachment_cache"):
-                    # For the unlikely case that we did not manage to persist the
-                    # event we also delete the key always.
-                    if event is None or features.has(
-                        "organizations:event-attachments", event.project.organization, actor=None
-                    ):
-                        attachment_cache.delete(cache_key)
+                    attachment_cache.delete(cache_key)
 
             if start_time:
                 metrics.timing(
