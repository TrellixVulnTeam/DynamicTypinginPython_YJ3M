commit 26f283d4ec5d16978952e78ca3673eebe96e65db
Author: Mark Story <mark@sentry.io>
Date:   Thu Jul 2 10:04:27 2020 -0400

    chore: Remove discover sidebar assistant (#19616)
    
    With the eventsv1 page quickly coming to its final days for most
    customers we can stop communicating that folks should use discover2.
    This restores the guide filtering logic to what it was back in 8c3f3d86511
    before the discover sidebar was added.
    
    This should also help speed up acceptance tests as we don't need to
    dismiss the assistant anymore.

diff --git a/src/sentry/assistant/guides.py b/src/sentry/assistant/guides.py
index bbdca8f718..bd655be7fc 100644
--- a/src/sentry/assistant/guides.py
+++ b/src/sentry/assistant/guides.py
@@ -110,18 +110,4 @@ GUIDES = {
             }
         ],
     },
-    "discover_sidebar": {
-        "id": 4,
-        "required_targets": ["discover_sidebar"],
-        "steps": [
-            {
-                "title": _("Event Pages have moved"),
-                "message": _(
-                    "These are now in our powerful new query builder, Discover "
-                    '<a href="https://docs.sentry.io/performance-monitoring/discover-queries/" target="_blank">Learn more about its advanced features</a>. '
-                ),
-                "target": "discover_sidebar",
-            }
-        ],
-    },
 }
diff --git a/src/sentry/static/sentry/app/components/assistant/getGuidesContent.tsx b/src/sentry/static/sentry/app/components/assistant/getGuidesContent.tsx
index 34281f8074..1209d099e6 100644
--- a/src/sentry/static/sentry/app/components/assistant/getGuidesContent.tsx
+++ b/src/sentry/static/sentry/app/components/assistant/getGuidesContent.tsx
@@ -100,24 +100,5 @@ export default function getGuidesContent(): GuidesContent {
         },
       ],
     },
-    {
-      guide: 'discover_sidebar',
-      requiredTargets: ['discover_sidebar'],
-      steps: [
-        {
-          title: t('Event Pages have moved'),
-          target: 'discover_sidebar',
-          description: tct(
-            `These are now in our powerful new query builder, Discover.
-            [link:Learn more about its advanced features].`,
-            {
-              link: (
-                <ExternalLink href="https://docs.sentry.io/performance-monitoring/discover-queries/" />
-              ),
-            }
-          ),
-        },
-      ],
-    },
   ];
 }
diff --git a/src/sentry/static/sentry/app/components/sidebar/index.tsx b/src/sentry/static/sentry/app/components/sidebar/index.tsx
index 979d7f66e5..14c83de3cc 100644
--- a/src/sentry/static/sentry/app/components/sidebar/index.tsx
+++ b/src/sentry/static/sentry/app/components/sidebar/index.tsx
@@ -29,7 +29,6 @@ import {hideSidebar, showSidebar} from 'app/actionCreators/preferences';
 import {t} from 'app/locale';
 import ConfigStore from 'app/stores/configStore';
 import Feature from 'app/components/acl/feature';
-import GuideAnchor from 'app/components/assistant/guideAnchor';
 import HookStore from 'app/stores/hookStore';
 import PreferencesStore from 'app/stores/preferencesStore';
 import localStorage from 'app/utils/localStorage';
@@ -384,21 +383,19 @@ class Sidebar extends React.Component<Props, State> {
                       features={['discover-basic']}
                       organization={organization}
                     >
-                      <GuideAnchor position="right" target="discover_sidebar">
-                        <SidebarItem
-                          {...sidebarItemProps}
-                          onClick={(_id, evt) =>
-                            this.navigateWithGlobalSelection(
-                              getDiscoverLandingUrl(organization),
-                              evt
-                            )
-                          }
-                          icon={<IconTelescope size="md" />}
-                          label={t('Discover')}
-                          to={getDiscoverLandingUrl(organization)}
-                          id="discover-v2"
-                        />
-                      </GuideAnchor>
+                      <SidebarItem
+                        {...sidebarItemProps}
+                        onClick={(_id, evt) =>
+                          this.navigateWithGlobalSelection(
+                            getDiscoverLandingUrl(organization),
+                            evt
+                          )
+                        }
+                        icon={<IconTelescope size="md" />}
+                        label={t('Discover')}
+                        to={getDiscoverLandingUrl(organization)}
+                        id="discover-v2"
+                      />
                     </Feature>
                   )}
                   <Feature
diff --git a/src/sentry/static/sentry/app/stores/guideStore.tsx b/src/sentry/static/sentry/app/stores/guideStore.tsx
index 5100f51fe1..d367ecc326 100644
--- a/src/sentry/static/sentry/app/stores/guideStore.tsx
+++ b/src/sentry/static/sentry/app/stores/guideStore.tsx
@@ -185,28 +185,11 @@ const guideStoreConfig: Reflux.StoreDefinition & GuideStoreInterface = {
 
     const user = ConfigStore.get('user');
     const assistantThreshold = new Date(2019, 6, 1);
-    const discoverDate = new Date(2020, 1, 6);
     const userDateJoined = new Date(user?.dateJoined);
 
     if (!forceShow) {
-      guideOptions = guideOptions.filter(({guide, seen}) =>
-        seen
-          ? false
-          : user?.isSuperuser
-          ? true
-          : guide === 'discover_sidebar' && userDateJoined >= discoverDate
-          ? false
-          : userDateJoined > assistantThreshold
-      );
-    }
-
-    // do not force show the "events moved" guide
-    // since it's not relevant for new users
-    if (forceShow) {
-      guideOptions = guideOptions.filter(({guide, seen}) =>
-        guide === 'discover_sidebar' && (seen || userDateJoined >= discoverDate)
-          ? false
-          : true
+      guideOptions = guideOptions.filter(({seen}) =>
+        seen ? false : user?.isSuperuser ? true : userDateJoined > assistantThreshold
       );
     }
 
diff --git a/src/sentry/testutils/cases.py b/src/sentry/testutils/cases.py
index 1b982b6d9e..2354677d35 100644
--- a/src/sentry/testutils/cases.py
+++ b/src/sentry/testutils/cases.py
@@ -718,7 +718,7 @@ class AcceptanceTestCase(TransactionTestCase):
 
     def dismiss_assistant(self, which=None):
         if which is None:
-            which = ("discover_sidebar", "issue", "issue_stream")
+            which = ("issue", "issue_stream")
         if isinstance(which, six.string_types):
             which = [which]
 
diff --git a/tests/acceptance/test_dashboard.py b/tests/acceptance/test_dashboard.py
index 21fdea967e..fe85a5aaf3 100644
--- a/tests/acceptance/test_dashboard.py
+++ b/tests/acceptance/test_dashboard.py
@@ -41,7 +41,6 @@ class DashboardTest(AcceptanceTestCase, SnubaTestCase):
         )
 
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
         self.path = u"/organizations/{}/projects/".format(self.organization.slug)
 
     def create_sample_event(self):
@@ -104,7 +103,6 @@ class EmptyDashboardTest(AcceptanceTestCase):
     def setUp(self):
         super(EmptyDashboardTest, self).setUp()
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
         self.path = u"/organizations/{}/projects/".format(self.organization.slug)
 
     def test_new_dashboard_empty(self):
diff --git a/tests/acceptance/test_organization_activity.py b/tests/acceptance/test_organization_activity.py
index 4534e782d6..612a4ad5ef 100644
--- a/tests/acceptance/test_organization_activity.py
+++ b/tests/acceptance/test_organization_activity.py
@@ -16,7 +16,6 @@ class OrganizationActivityTest(AcceptanceTestCase):
         self.project = self.create_project(organization=self.org, teams=[self.team], name="Bengal")
         self.group = self.create_group(project=self.project)
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
         self.path = u"/organizations/{}/activity/".format(self.org.slug)
         self.project.update(first_event=timezone.now())
 
diff --git a/tests/acceptance/test_organization_discover.py b/tests/acceptance/test_organization_discover.py
index b98870d02f..5a9996d97f 100644
--- a/tests/acceptance/test_organization_discover.py
+++ b/tests/acceptance/test_organization_discover.py
@@ -51,7 +51,6 @@ class OrganizationDiscoverTest(AcceptanceTestCase, SnubaTestCase):
             project_id=self.project.id,
         )
         self.path = u"/organizations/{}/discover/".format(self.org.slug)
-        self.dismiss_assistant("discover_sidebar")
 
     def test_no_access(self):
         self.browser.get(self.path)
diff --git a/tests/acceptance/test_organization_document_integration_detailed_view.py b/tests/acceptance/test_organization_document_integration_detailed_view.py
index 1db4bb7d22..5f50ad617e 100644
--- a/tests/acceptance/test_organization_document_integration_detailed_view.py
+++ b/tests/acceptance/test_organization_document_integration_detailed_view.py
@@ -13,7 +13,6 @@ class OrganizationDocumentIntegrationDetailView(AcceptanceTestCase):
         self.login_as(self.user)
 
     def load_page(self, slug):
-        self.dismiss_assistant("discover_sidebar")
         url = u"/settings/{}/document-integrations/{}/".format(self.organization.slug, slug)
         self.browser.get(url)
         self.browser.wait_until_not(".loading-indicator")
diff --git a/tests/acceptance/test_organization_events_v2.py b/tests/acceptance/test_organization_events_v2.py
index b56bd810d9..4d0a4e0227 100644
--- a/tests/acceptance/test_organization_events_v2.py
+++ b/tests/acceptance/test_organization_events_v2.py
@@ -140,8 +140,6 @@ class OrganizationEventsV2Test(AcceptanceTestCase, SnubaTestCase):
         self.landing_path = u"/organizations/{}/discover/queries/".format(self.org.slug)
         self.result_path = u"/organizations/{}/discover/results/".format(self.org.slug)
 
-        self.dismiss_assistant("discover_sidebar")
-
     def wait_until_loaded(self):
         self.browser.wait_until_not(".loading-indicator")
         self.browser.wait_until_not('[data-test-id="loading-placeholder"]')
diff --git a/tests/acceptance/test_organization_integration_detail_view.py b/tests/acceptance/test_organization_integration_detail_view.py
index 28761af760..2170de40db 100644
--- a/tests/acceptance/test_organization_integration_detail_view.py
+++ b/tests/acceptance/test_organization_integration_detail_view.py
@@ -23,7 +23,6 @@ class OrganizationIntegrationDetailView(AcceptanceTestCase):
         self.login_as(self.user)
 
     def load_page(self, slug, configuration_tab=False):
-        self.dismiss_assistant("discover_sidebar")
         url = u"/settings/{}/integrations/{}/".format(self.organization.slug, slug)
         if configuration_tab:
             url += "?tab=configurations"
diff --git a/tests/acceptance/test_organization_integration_directory.py b/tests/acceptance/test_organization_integration_directory.py
index 9f842fe220..787141c0d9 100644
--- a/tests/acceptance/test_organization_integration_directory.py
+++ b/tests/acceptance/test_organization_integration_directory.py
@@ -7,7 +7,6 @@ class OrganizationIntegrationDirectoryTest(AcceptanceTestCase):
     def setUp(self):
         super(OrganizationIntegrationDirectoryTest, self).setUp()
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
 
     def test_all_integrations_list(self):
         path = u"/settings/{}/integrations/".format(self.organization.slug)
diff --git a/tests/acceptance/test_organization_plugin_detail_view.py b/tests/acceptance/test_organization_plugin_detail_view.py
index 061eb598fa..f1d5f2cf44 100644
--- a/tests/acceptance/test_organization_plugin_detail_view.py
+++ b/tests/acceptance/test_organization_plugin_detail_view.py
@@ -20,7 +20,6 @@ class OrganizationPluginDetailedView(AcceptanceTestCase):
         self.project = self.create_project(organization=self.organization, name="Back end")
         self.create_project(organization=self.organization, name="Front End")
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
 
     def load_page(self, slug, configuration_tab=False):
         url = u"/settings/{}/plugins/{}/".format(self.organization.slug, slug)
diff --git a/tests/acceptance/test_organization_sentry_app_detailed_view.py b/tests/acceptance/test_organization_sentry_app_detailed_view.py
index 8ab357925e..73c4b26b52 100644
--- a/tests/acceptance/test_organization_sentry_app_detailed_view.py
+++ b/tests/acceptance/test_organization_sentry_app_detailed_view.py
@@ -19,7 +19,6 @@ class OrganizationSentryAppDetailedView(AcceptanceTestCase):
             name="Super Awesome App",
         )
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
 
     def load_page(self, slug):
         url = u"/settings/{}/sentry-apps/{}/".format(self.organization.slug, slug)
diff --git a/tests/acceptance/test_performance_overview.py b/tests/acceptance/test_performance_overview.py
index 803828ac7a..90fb5887ec 100644
--- a/tests/acceptance/test_performance_overview.py
+++ b/tests/acceptance/test_performance_overview.py
@@ -31,7 +31,6 @@ class PerformanceOverviewTest(AcceptanceTestCase):
         self.path = u"/organizations/{}/performance/".format(self.org.slug)
 
         self.page = BasePage(self.browser)
-        self.dismiss_assistant("discover_sidebar")
 
     @patch("django.utils.timezone.now")
     def test_onboarding(self, mock_now):
diff --git a/tests/acceptance/test_performance_summary.py b/tests/acceptance/test_performance_summary.py
index cb218a8f58..48a91d614b 100644
--- a/tests/acceptance/test_performance_summary.py
+++ b/tests/acceptance/test_performance_summary.py
@@ -35,7 +35,6 @@ class PerformanceSummaryTest(AcceptanceTestCase):
         )
 
         self.page = TransactionSummaryPage(self.browser)
-        self.dismiss_assistant("discover_sidebar")
 
     @patch("django.utils.timezone.now")
     def test_with_data(self, mock_now):
diff --git a/tests/acceptance/test_project_ownership.py b/tests/acceptance/test_project_ownership.py
index f1a4f88428..8d3eedc2f5 100644
--- a/tests/acceptance/test_project_ownership.py
+++ b/tests/acceptance/test_project_ownership.py
@@ -7,7 +7,6 @@ class ProjectOwnershipTest(AcceptanceTestCase):
     def setUp(self):
         super(ProjectOwnershipTest, self).setUp()
         self.login_as(self.user)
-        self.dismiss_assistant("discover_sidebar")
         self.path = u"/settings/{}/projects/{}/ownership/".format(
             self.organization.slug, self.project.slug
         )
diff --git a/tests/js/spec/stores/guideStore.spec.jsx b/tests/js/spec/stores/guideStore.spec.jsx
index 5727e64e58..4b55d0a6e6 100644
--- a/tests/js/spec/stores/guideStore.spec.jsx
+++ b/tests/js/spec/stores/guideStore.spec.jsx
@@ -104,83 +104,4 @@ describe('GuideStore', function() {
     expect(GuideStore.state.guides.length).toBe(1);
     expect(GuideStore.state.guides[0].guide).toBe(data[0].guide);
   });
-
-  describe('discover sidebar guide', function() {
-    beforeEach(function() {
-      data = [
-        {
-          guide: 'discover_sidebar',
-          seen: false,
-        },
-      ];
-
-      GuideStore.onRegisterAnchor('discover_sidebar');
-    });
-
-    it('does not render without user', function() {
-      ConfigStore.config = {};
-      GuideStore.onFetchSucceeded(data);
-      expect(GuideStore.state.currentGuide).toBe(null);
-    });
-
-    it('shows discover sidebar guide to superusers', function() {
-      ConfigStore.config = {
-        user: {
-          isSuperuser: true,
-        },
-      };
-      GuideStore.onFetchSucceeded(data);
-      expect(GuideStore.state.currentGuide.guide).toBe('discover_sidebar');
-    });
-
-    it('shows discover sidebar guide to previously existing users', function() {
-      ConfigStore.config = {
-        user: {
-          isSuperuser: false,
-          dateJoined: new Date(2020, 0, 1),
-        },
-      };
-      GuideStore.onFetchSucceeded(data);
-      expect(GuideStore.state.currentGuide.guide).toBe('discover_sidebar');
-    });
-
-    it('does not show discover sidebar guide to new users', function() {
-      ConfigStore.config = {
-        user: {
-          isSuperuser: false,
-          dateJoined: new Date(2020, 1, 22),
-        },
-      };
-      GuideStore.onFetchSucceeded(data);
-      expect(GuideStore.state.currentGuide).toBe(null);
-    });
-
-    it('hides discover sidebar guide once seen', function() {
-      data[0].seen = true;
-      // previous user
-      ConfigStore.config = {
-        user: {
-          isSuperuser: false,
-          dateJoined: new Date(2020, 0, 1),
-        },
-      };
-      GuideStore.onFetchSucceeded(data);
-      expect(GuideStore.state.currentGuide).toBe(null);
-    });
-
-    it('does not force show the discover sidebar guide once seen', function() {
-      data[0].seen = true;
-      // previous user
-      ConfigStore.config = {
-        user: {
-          isSuperuser: false,
-          dateJoined: new Date(2020, 0, 1),
-        },
-      };
-      GuideStore.onFetchSucceeded(data);
-      window.location.hash = '#assistant';
-      GuideStore.onURLChange();
-      expect(GuideStore.state.currentGuide).toBe(null);
-    });
-  });
 });
