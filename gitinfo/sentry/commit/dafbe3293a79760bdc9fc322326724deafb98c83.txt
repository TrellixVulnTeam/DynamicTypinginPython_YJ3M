commit dafbe3293a79760bdc9fc322326724deafb98c83
Author: Chris Fuller <cfuller@sentry.io>
Date:   Wed Apr 22 16:28:07 2020 -0400

    fix(workflow): Fixing some logic around auto resolving incidents (#18415)
    
    * Fixing auto resolve logic

diff --git a/src/sentry/api/serializers/models/incident.py b/src/sentry/api/serializers/models/incident.py
index 0003e55233..db980e1273 100644
--- a/src/sentry/api/serializers/models/incident.py
+++ b/src/sentry/api/serializers/models/incident.py
@@ -38,7 +38,7 @@ class IncidentSerializer(Serializer):
             "organizationId": six.text_type(obj.organization_id),
             "projects": attrs["projects"],
             "status": obj.status,
-            "status_method": obj.status_method,
+            "statusMethod": obj.status_method,
             "type": obj.type,
             "title": obj.title,
             "query": obj.query,
diff --git a/src/sentry/incidents/logic.py b/src/sentry/incidents/logic.py
index 828fb4dbdb..c2e7f7a4ac 100644
--- a/src/sentry/incidents/logic.py
+++ b/src/sentry/incidents/logic.py
@@ -606,7 +606,7 @@ def snapshot_alert_rule(alert_rule):
 
     # Change the incident status asynchronously, which could take awhile with many incidents due to snapshot creations.
     tasks.auto_resolve_snapshot_incidents.apply_async(
-        kwargs={"alert_rule_id": alert_rule_snapshot.id}
+        kwargs={"alert_rule_id": alert_rule_snapshot.id}, countdown=3
     )
 
 
diff --git a/src/sentry/incidents/tasks.py b/src/sentry/incidents/tasks.py
index 5c5f1b4602..25ccbd5f65 100644
--- a/src/sentry/incidents/tasks.py
+++ b/src/sentry/incidents/tasks.py
@@ -147,7 +147,7 @@ def handle_trigger_action(action_id, incident_id, project_id, method):
 @instrumented_task(
     name="sentry.incidents.tasks.auto_resolve_snapshot_incidents",
     queue="incidents",
-    default_retry_delay=60 * 5,
+    default_retry_delay=60,
     max_retries=2,
 )
 def auto_resolve_snapshot_incidents(alert_rule_id, **kwargs):
diff --git a/src/sentry/static/sentry/app/views/alerts/details/activity/statusItem.tsx b/src/sentry/static/sentry/app/views/alerts/details/activity/statusItem.tsx
index 63d38cc6cc..7c80993e11 100644
--- a/src/sentry/static/sentry/app/views/alerts/details/activity/statusItem.tsx
+++ b/src/sentry/static/sentry/app/views/alerts/details/activity/statusItem.tsx
@@ -5,7 +5,13 @@ import {t, tct} from 'app/locale';
 import ActivityItem from 'app/components/activity/item';
 import getDynamicText from 'app/utils/getDynamicText';
 
-import {Incident, IncidentActivityType, IncidentStatus, ActivityType} from '../../types';
+import {
+  Incident,
+  IncidentActivityType,
+  IncidentStatus,
+  ActivityType,
+  IncidentStatusMethod,
+} from '../../types';
 
 type Props = {
   activity: ActivityType;
@@ -66,7 +72,7 @@ class StatusItem extends React.Component<Props> {
                 currentTrigger: <StatusValue>{currentTrigger}</StatusValue>,
               })}
             {isClosed &&
-              !activity.user &&
+              incident?.statusMethod === IncidentStatusMethod.RULE_UPDATED &&
               t(
                 'This alert has been auto-resolved because the rule that triggered it has been modified or deleted.'
               )}
diff --git a/tests/sentry/api/serializers/test_incident.py b/tests/sentry/api/serializers/test_incident.py
index 8e9888fb7f..d8945102f7 100644
--- a/tests/sentry/api/serializers/test_incident.py
+++ b/tests/sentry/api/serializers/test_incident.py
@@ -27,7 +27,7 @@ class IncidentSerializerTest(TestCase):
         assert result["organizationId"] == six.text_type(incident.organization_id)
         assert result["projects"] == [p.slug for p in incident.projects.all()]
         assert result["status"] == incident.status
-        assert result["status_method"] == incident.status_method
+        assert result["statusMethod"] == incident.status_method
         assert result["type"] == incident.type
         assert result["title"] == incident.title
         assert result["query"] == incident.query
