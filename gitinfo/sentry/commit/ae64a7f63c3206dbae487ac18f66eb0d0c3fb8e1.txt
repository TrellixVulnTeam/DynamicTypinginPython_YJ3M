commit ae64a7f63c3206dbae487ac18f66eb0d0c3fb8e1
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Mon Sep 24 12:22:23 2018 -0700

    fix(integrations): Handle missing changelog in jira webhook
    fixes SENTRY-787
    APP-530

diff --git a/src/sentry/integrations/jira/webhooks.py b/src/sentry/integrations/jira/webhooks.py
index 97c04651e0..7566dabb02 100644
--- a/src/sentry/integrations/jira/webhooks.py
+++ b/src/sentry/integrations/jira/webhooks.py
@@ -41,7 +41,7 @@ class JiraIssueUpdatedWebhook(Endpoint):
             )
         except StopIteration:
             logger.info(
-                'missing-changelog', extra={
+                'missing-changelog-status', extra={
                     'issue_key': issue_key,
                     'integration_id': integration.id,
                 }
@@ -62,8 +62,24 @@ class JiraIssueUpdatedWebhook(Endpoint):
         except (KeyError, IndexError):
             return self.respond(status=400)
 
+        try:
+            integration = get_integration_from_jwt(
+                token, request.path, 'jira', request.GET, method='POST'
+            )
+        except AtlassianConnectValidationError:
+            return self.respond(status=400)
+
         data = request.DATA
 
+        if not data.get('changelog'):
+            logger.info(
+                'missing-changelog', extra={
+                    'integration_id': integration.id,
+                    'data': data,
+                }
+            )
+            return self.respond()
+
         assignee_changed = any(
             item for item in data['changelog']['items'] if item['field'] == 'assignee'
         )
@@ -73,13 +89,6 @@ class JiraIssueUpdatedWebhook(Endpoint):
         )
 
         if assignee_changed or status_changed:
-            try:
-                integration = get_integration_from_jwt(
-                    token, request.path, 'jira', request.GET, method='POST'
-                )
-            except AtlassianConnectValidationError:
-                return self.respond(status=400)
-
             if assignee_changed:
                 self.handle_assignee_change(integration, data)
 
diff --git a/tests/sentry/integrations/jira/test_webhooks.py b/tests/sentry/integrations/jira/test_webhooks.py
index 08abbf6368..880e97e634 100644
--- a/tests/sentry/integrations/jira/test_webhooks.py
+++ b/tests/sentry/integrations/jira/test_webhooks.py
@@ -85,6 +85,8 @@ SAMPLE_EDIT_ISSUE_PAYLOAD_STATUS = """
 }
 """
 
+SAMPLE_MISSING_CHANGELOG = '{}'
+
 
 class JiraWebhooksTest(APITestCase):
     @patch('sentry.integrations.jira.webhooks.sync_group_assignee_inbound')
@@ -177,3 +179,22 @@ class JiraWebhooksTest(APITestCase):
                     }, u'key': u'APP-123',
                 },
             })
+
+    def test_missing_changelog(self):
+        org = self.organization
+
+        integration = Integration.objects.create(
+            provider='jira',
+            name='Example Jira',
+        )
+        integration.add_organization(org, self.user)
+
+        path = reverse('sentry-extensions-jira-issue-updated')
+
+        with patch('sentry.integrations.jira.webhooks.get_integration_from_jwt', return_value=integration):
+            resp = self.client.post(
+                path,
+                data=json.loads(SAMPLE_MISSING_CHANGELOG.strip()),
+                HTTP_AUTHORIZATION='JWT anexampletoken',
+            )
+            assert resp.status_code == 200
