commit ff4785ad73546bad8eac3eb41955d2d041a29c03
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Mon Oct 15 15:35:56 2018 -0700

    fix(api): Make snuba searches not case sensitive (#10134)

diff --git a/src/sentry/api/endpoints/organization_events.py b/src/sentry/api/endpoints/organization_events.py
index a6dfb8de4b..0f26236f4b 100644
--- a/src/sentry/api/endpoints/organization_events.py
+++ b/src/sentry/api/endpoints/organization_events.py
@@ -58,7 +58,8 @@ class OrganizationEventsEndpoint(OrganizationEndpoint):
         query = request.GET.get('query')
         conditions = []
         if query:
-            conditions.append(['message', 'LIKE', '%%%s%%' % (query,)])
+            conditions.append(
+                [['positionCaseInsensitive', ['message', "'%s'" % (query,)]], '!=', 0])
 
         now = timezone.now()
 
diff --git a/src/sentry/api/endpoints/project_events.py b/src/sentry/api/endpoints/project_events.py
index d9c3c79d77..89e4195736 100644
--- a/src/sentry/api/endpoints/project_events.py
+++ b/src/sentry/api/endpoints/project_events.py
@@ -59,7 +59,8 @@ class ProjectEventsEndpoint(ProjectEndpoint):
         query = request.GET.get('query')
         conditions = []
         if query:
-            conditions.append(['message', 'LIKE', u'%{}%'.format(query)])
+            conditions.append(
+                [['positionCaseInsensitive', ['message', "'%s'" % (query,)]], '!=', 0])
 
         now = timezone.now()
         data_fn = partial(
diff --git a/tests/snuba/api/endpoints/test_organization_events.py b/tests/snuba/api/endpoints/test_organization_events.py
index a749aee58b..9e21a4e0d3 100644
--- a/tests/snuba/api/endpoints/test_organization_events.py
+++ b/tests/snuba/api/endpoints/test_organization_events.py
@@ -48,7 +48,7 @@ class OrganizationEventsTest(APITestCase, SnubaTestCase):
         event_2 = self.create_event(
             'y' * 32,
             group=group,
-            message="delet the data",
+            message="Delet the Data",
             datetime=self.min_ago)
 
         url = reverse(
@@ -62,7 +62,7 @@ class OrganizationEventsTest(APITestCase, SnubaTestCase):
         assert response.status_code == 200, response.content
         assert len(response.data) == 1
         assert response.data[0]['eventID'] == event_2.event_id
-        assert response.data[0]['message'] == 'delet the data'
+        assert response.data[0]['message'] == 'Delet the Data'
 
     def test_project_filtering(self):
         user = self.create_user()
diff --git a/tests/snuba/api/endpoints/test_project_events.py b/tests/snuba/api/endpoints/test_project_events.py
index 1c33b94038..e4a3510fe2 100644
--- a/tests/snuba/api/endpoints/test_project_events.py
+++ b/tests/snuba/api/endpoints/test_project_events.py
@@ -48,7 +48,7 @@ class ProjectEventsTest(APITestCase, SnubaTestCase):
         event_2 = self.create_event(
             'y' * 32,
             group=group,
-            message="delet the data",
+            message="Delet the Data",
             datetime=self.min_ago)
 
         url = reverse(
@@ -63,7 +63,7 @@ class ProjectEventsTest(APITestCase, SnubaTestCase):
         assert response.status_code == 200, response.content
         assert len(response.data) == 1
         assert response.data[0]['eventID'] == event_2.event_id
-        assert response.data[0]['message'] == 'delet the data'
+        assert response.data[0]['message'] == 'Delet the Data'
 
     def test_filters_based_on_retention(self):
         self.login_as(user=self.user)
