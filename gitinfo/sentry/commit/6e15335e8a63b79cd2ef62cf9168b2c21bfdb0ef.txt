commit 6e15335e8a63b79cd2ef62cf9168b2c21bfdb0ef
Author: Anton Ovchinnikov <anton@tonyo.info>
Date:   Mon Oct 8 17:19:20 2018 +0200

    feat(attachments): Add a few metrics to BaseAttachmentCache (#10029)
    
    * feat(attachments): Add a few metrics to BaseAttachmentCache
    
    * fix: Pass metrics tags properly

diff --git a/src/sentry/attachments/base.py b/src/sentry/attachments/base.py
index 9bdd2d4c04..24d476cff6 100644
--- a/src/sentry/attachments/base.py
+++ b/src/sentry/attachments/base.py
@@ -10,6 +10,8 @@ from __future__ import absolute_import
 
 import zlib
 
+from sentry.utils import metrics
+
 
 class CachedAttachment(object):
     def __init__(self, name=None, content_type=None, type=None, data=None, load=None):
@@ -63,6 +65,11 @@ class BaseAttachmentCache(object):
             compressed = zlib.compress(attachment.data)
             self.inner.set(u'{}:{}'.format(key, index), compressed, timeout, raw=True)
 
+            metrics_tags = {'type': attachment.type}
+            metrics.incr('attachments.received', tags=metrics_tags)
+            metrics.timing('attachments.blob-size.raw', len(attachment.data), tags=metrics_tags)
+            metrics.timing('attachments.blob-size.compressed', len(compressed), tags=metrics_tags)
+
         meta = [attachment.meta() for attachment in attachments]
         self.inner.set(key, meta, timeout, raw=False)
 
