commit 9740f54738612bb3d930d74c4f754187c4592d02
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Dec 16 15:30:33 2015 -0800

    Consistently set name for Sentry

diff --git a/src/sentry/templates/sentry/includes/ravenjs.html b/src/sentry/templates/sentry/includes/ravenjs.html
index 8cab26e457..81f5457a7e 100644
--- a/src/sentry/templates/sentry/includes/ravenjs.html
+++ b/src/sentry/templates/sentry/includes/ravenjs.html
@@ -6,12 +6,5 @@ Raven.config('{% public_dsn %}', {
   release: '{{ sentry_version.build }}',
   whitelistUrls: {% convert_to_json ALLOWED_HOSTS %}
 }).install();
-
-{% if request.user.is_authenticated %}
-Raven.setUserContext({
-    email: '{{ request.user.email }}',
-    id: '{{ request.user.id }}',
-    ip_address: '{{ request.META.REMOTE_ADDR }}'
-});
-{% endif %}
+Raven.setUserContext({% get_user_context request %});
 </script>
diff --git a/src/sentry/templatetags/sentry_api.py b/src/sentry/templatetags/sentry_api.py
index 801596faed..30f548564e 100644
--- a/src/sentry/templatetags/sentry_api.py
+++ b/src/sentry/templatetags/sentry_api.py
@@ -45,3 +45,17 @@ def serialize_detailed_org(context, obj):
     )
 
     return mark_safe(json.dumps(context))
+
+
+@register.simple_tag
+def get_user_context(request, escape=False):
+    user = getattr(request, 'user', None)
+    result = {'ip_address': request.META['REMOTE_ADDR']}
+    if user and user.is_authenticated():
+        result.update({
+            'email': user.email,
+            'id': user.id,
+        })
+        if user.name:
+            result['name'] = user.name
+    return mark_safe(json.dumps(result))
diff --git a/src/sentry/web/frontend/error_500.py b/src/sentry/web/frontend/error_500.py
index 24726a3e6a..c20753fefb 100644
--- a/src/sentry/web/frontend/error_500.py
+++ b/src/sentry/web/frontend/error_500.py
@@ -32,7 +32,7 @@ class Error500View(View):
         if request.user.is_authenticated():
             try:
                 result.update({
-                    'userName': request.user.get_full_name(),
+                    'userName': request.user.name,
                     'userEmail': request.user.email,
                 })
             except Exception:
