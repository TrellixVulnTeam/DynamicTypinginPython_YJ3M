commit 5dc67f718d76ed57b0b9259f056bda89e566098a
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Aug 2 10:39:26 2013 -0700

    Correct team validation in has_access (fixes GH-954)

diff --git a/src/sentry/web/decorators.py b/src/sentry/web/decorators.py
index a9a33ec547..7a37cc533a 100644
--- a/src/sentry/web/decorators.py
+++ b/src/sentry/web/decorators.py
@@ -67,9 +67,6 @@ def has_access(access_or_func=None, team=None, access=None):
                 else:
                     lookup_kwargs = {'slug': project_id}
 
-                if team:
-                    lookup_kwargs['team'] = team
-
                 if request.user.is_superuser:
                     try:
                         project = Project.objects.get_from_cache(**lookup_kwargs)
@@ -95,6 +92,9 @@ def has_access(access_or_func=None, team=None, access=None):
             else:
                 project = None
 
+            if team and project.team != team:
+                return HttpResponseRedirect(reverse('sentry'))
+
             if has_project:
                 # ensure we're accessing this url correctly
                 if project and team:
