commit 48867e14345170ec67612d97e7baf7e6e19633c3
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 12 20:04:06 2013 -0800

    Dont include the current interval in calculations as its incorrect

diff --git a/src/sentry/tasks/check_alerts.py b/src/sentry/tasks/check_alerts.py
index 30ce76ac13..d932b94b6a 100644
--- a/src/sentry/tasks/check_alerts.py
+++ b/src/sentry/tasks/check_alerts.py
@@ -96,8 +96,8 @@ def check_project_alerts(project_id, when, count, **kwargs):
     # number of 15 minute intervals to capture
     intervals = 4
 
-    min_date = when
-    max_date = when - timedelta(minutes=(intervals * MINUTE_NORMALIZATION))
+    min_date = when - timedelta(minutes=MINUTE_NORMALIZATION)
+    max_date = min_date - timedelta(minutes=(intervals * MINUTE_NORMALIZATION))
 
     # get historical data
     data = list(ProjectCountByMinute.objects.filter(
@@ -111,6 +111,7 @@ def check_project_alerts(project_id, when, count, **kwargs):
         return
 
     previous = sum(data) / intervals / MINUTE_NORMALIZATION
+    print count, previous, count / previous * 100
 
     if count / previous * 100 > threshold:
         Alert.maybe_alert(
