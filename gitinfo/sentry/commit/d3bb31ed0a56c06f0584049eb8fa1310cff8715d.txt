commit d3bb31ed0a56c06f0584049eb8fa1310cff8715d
Author: Alberto Leal <mail4alberto@gmail.com>
Date:   Mon Jun 17 11:51:01 2019 -0400

    fix: Fix tooltip if either release commits has no author, or if an author's name/email of a commit contains just whitespace. (#13707)

diff --git a/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx b/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
index ae47d0e399..0619fe9d24 100644
--- a/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
+++ b/src/sentry/static/sentry/app/components/avatar/userAvatar.jsx
@@ -53,6 +53,8 @@ class UserAvatar extends React.Component {
         tooltip={
           typeof renderTooltip === 'function'
             ? renderTooltip(user)
+            : props.tooltip
+            ? props.tooltip
             : userDisplayName(user)
         }
         title={user.name || user.email || user.username || ''}
diff --git a/src/sentry/static/sentry/app/utils/formatters.jsx b/src/sentry/static/sentry/app/utils/formatters.jsx
index 18a0a00a4b..488a42ee95 100644
--- a/src/sentry/static/sentry/app/utils/formatters.jsx
+++ b/src/sentry/static/sentry/app/utils/formatters.jsx
@@ -1,6 +1,17 @@
+import {get} from 'lodash';
+
+import {t} from 'app/locale';
+
 export function userDisplayName(user) {
-  let displayName = user.name;
-  if (user.email && user.email !== user.name) {
+  let displayName = String(get(user, 'name', t('Unknown author'))).trim();
+
+  if (displayName.length <= 0) {
+    displayName = t('Unknown author');
+  }
+
+  const email = String(get(user, 'email', '')).trim();
+
+  if (email.length > 0 && email !== displayName) {
     displayName += ' (' + user.email + ')';
   }
   return displayName;
diff --git a/src/sentry/static/sentry/app/views/organizationReleases/detail/commitAuthorStats.jsx b/src/sentry/static/sentry/app/views/organizationReleases/detail/commitAuthorStats.jsx
index ccdab8a9a5..96eabb01e5 100644
--- a/src/sentry/static/sentry/app/views/organizationReleases/detail/commitAuthorStats.jsx
+++ b/src/sentry/static/sentry/app/views/organizationReleases/detail/commitAuthorStats.jsx
@@ -117,12 +117,7 @@ class CommitAuthorStats extends React.Component {
               return (
                 <PanelItem key={i} p={1} align="center">
                   <Flex>
-                    <Avatar
-                      user={author}
-                      size={20}
-                      hasTooltip
-                      tooltip={`${author.name} ${author.email}`}
-                    />
+                    <Avatar user={author} size={20} hasTooltip />
                   </Flex>
                   <Flex flex="1" px={1}>
                     <CommitBar
diff --git a/tests/js/spec/helpers/formatters.spec.jsx b/tests/js/spec/helpers/formatters.spec.jsx
index 2a655df1da..6ec11aba47 100644
--- a/tests/js/spec/helpers/formatters.spec.jsx
+++ b/tests/js/spec/helpers/formatters.spec.jsx
@@ -19,5 +19,34 @@ describe('formatters', function() {
         })
       ).toEqual('user (foo@bar.com)');
     });
+
+    it('should show unknown author with email, if email is only provided', function() {
+      expect(
+        userDisplayName({
+          email: 'foo@bar.com',
+        })
+      ).toEqual('Unknown author (foo@bar.com)');
+    });
+
+    it('should show unknown author, if author or email is just whitespace', function() {
+      expect(
+        userDisplayName({
+          // eslint-disable-next-line quotes
+          name: `\t\n `,
+        })
+      ).toEqual('Unknown author');
+
+      expect(
+        userDisplayName({
+          // eslint-disable-next-line quotes
+          email: `\t\n `,
+        })
+      ).toEqual('Unknown author');
+    });
+
+    it('should show unknown author, if user object is either not an object or incomplete', function() {
+      expect(userDisplayName()).toEqual('Unknown author');
+      expect(userDisplayName({})).toEqual('Unknown author');
+    });
   });
 });
