commit b918e0fee8b31920594f83b1e236b2306b864cbf
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Sep 27 15:36:45 2010 -0700

    Record the template loadname (relative path) as the view name with TemplateSyntaxError exceptions

diff --git a/runtests.py b/runtests.py
index 06bdae7134..7777ea5eec 100644
--- a/runtests.py
+++ b/runtests.py
@@ -44,6 +44,7 @@ if not settings.configured:
         BROKER_VHOST="/",
         CELERY_ALWAYS_EAGER=True,
         SENTRY_THRASHING_LIMIT=0,
+        TEMPLATE_DEBUG=True,
     )
     import djcelery
     djcelery.setup_loader()
diff --git a/sentry/__init__.py b/sentry/__init__.py
index 7062036ea6..629f5982ef 100644
--- a/sentry/__init__.py
+++ b/sentry/__init__.py
@@ -1 +1 @@
-__version__ = (1, 3, 5)
\ No newline at end of file
+__version__ = (1, 3, 6)
\ No newline at end of file
diff --git a/sentry/client/base.py b/sentry/client/base.py
index ff7512cd75..f842890e40 100644
--- a/sentry/client/base.py
+++ b/sentry/client/base.py
@@ -174,6 +174,7 @@ class SentryClient(object):
             data['__sentry__'].update({
                 'template': (origin.reload(), start, end, origin.name),
             })
+            kwargs['view'] = origin.loadname
         
         tb_message = '\n'.join(traceback.format_exception(exc_type, exc_value, exc_traceback))
 
diff --git a/sentry/tests/templates/sentry-tests/error.html b/sentry/tests/templates/sentry-tests/error.html
new file mode 100644
index 0000000000..7d36b9b214
--- /dev/null
+++ b/sentry/tests/templates/sentry-tests/error.html
@@ -0,0 +1 @@
+{% invalid template tag %}
\ No newline at end of file
diff --git a/sentry/tests/tests.py b/sentry/tests/tests.py
index ca2af70ff2..c4a934cbde 100644
--- a/sentry/tests/tests.py
+++ b/sentry/tests/tests.py
@@ -19,6 +19,7 @@ from django.core.signals import got_request_exception
 from django.core.servers import basehttp
 from django.test.client import Client
 from django.test import TestCase
+from django.template import TemplateSyntaxError
 from django.utils.encoding import smart_unicode
 from django.utils import simplejson
 
@@ -557,6 +558,13 @@ class SentryTestCase(TestCase):
         
         settings.INCLUDE_PATHS = []
 
+    def testTemplateNameAsView(self):
+        self.assertRaises(TemplateSyntaxError, self.client.get, reverse('sentry-template-exc'))
+        
+        last = Message.objects.get()
+        
+        self.assertEquals(last.view, 'sentry-tests/error.html')
+
 class SentryViewsTest(TestCase):
     urls = 'sentry.tests.urls'
     fixtures = ['sentry/tests/fixtures/views.json']
diff --git a/sentry/tests/urls.py b/sentry/tests/urls.py
index 94b30f8f6c..66aee68c26 100644
--- a/sentry/tests/urls.py
+++ b/sentry/tests/urls.py
@@ -8,5 +8,6 @@ urlpatterns = patterns('',
     url(r'^trigger-500$', 'sentry.tests.views.raise_exc', name='sentry-raise-exc'),
     url(r'^trigger-500-decorated$', 'sentry.tests.views.decorated_raise_exc', name='sentry-raise-exc-decor'),
     url(r'^trigger-500-django$', 'sentry.tests.views.django_exc', name='sentry-django-exc'),
+    url(r'^trigger-500-template$', 'sentry.tests.views.template_exc', name='sentry-template-exc'),
     url(r'', include('sentry.urls')),
 )
\ No newline at end of file
diff --git a/sentry/tests/views.py b/sentry/tests/views.py
index 69842f584f..95b6fe7b3a 100644
--- a/sentry/tests/views.py
+++ b/sentry/tests/views.py
@@ -1,4 +1,4 @@
-from django.shortcuts import get_object_or_404
+from django.shortcuts import get_object_or_404, render_to_response
 
 def django_exc(request):
     return get_object_or_404(Exception, pk=1)
@@ -7,4 +7,7 @@ def raise_exc(request):
     raise Exception(request.GET.get('message', 'view exception'))
 
 def decorated_raise_exc(request):
-    return raise_exc(request)
\ No newline at end of file
+    return raise_exc(request)
+
+def template_exc(request):
+    return render_to_response('sentry-tests/error.html')
\ No newline at end of file
