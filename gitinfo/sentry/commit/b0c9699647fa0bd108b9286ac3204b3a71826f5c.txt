commit b0c9699647fa0bd108b9286ac3204b3a71826f5c
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Dec 26 02:08:54 2011 -0800

    Sort options now are functional links

diff --git a/sentry/templates/sentry/groups/group_list.html b/sentry/templates/sentry/groups/group_list.html
index f880485227..d408a4e768 100644
--- a/sentry/templates/sentry/groups/group_list.html
+++ b/sentry/templates/sentry/groups/group_list.html
@@ -25,6 +25,7 @@
 
 {% block main %}
     {% paginator event_list from request as event_list per_page MESSAGES_PER_PAGE %}
+    {% querystring from request without sort as sort_querystring %}
 
     <ul class="options">
         <li class="prev{% if not event_list.paginator.has_previous %} disabled{% endif %}">
@@ -42,15 +43,15 @@
             {% endif %}
         </li>
         <li class="dropdown pull-right" data-dropdown="dropdown">
-            <a href="#" class="dropdown-toggle">{% trans "Sort by:" %} {% trans "Priority" %}</a>
+            <a href="#" class="dropdown-toggle">{% trans "Sort by:" %} {{ sort_label }}</a>
             <ul class="dropdown-menu">
-                <li value=""{% ifequal sort 'priority' %} class="active"{% endifequal %}><a href="#">{% trans "Priority" %}</a></li>
-                <li value="date"{% ifequal sort 'date' %} class="active"{% endifequal %}><a href="#">{% trans "Last Seen" %}</a></li>
-                <li value="new"{% ifequal sort 'new' %} class="active"{% endifequal %}><a href="#">{% trans "First Seen" %}</a></li>
-                <li value="freq"{% ifequal sort 'freq' %} class="active"{% endifequal %}><a href="#">{% trans "Frequency" %}</a></li>
+                <li{% ifequal sort 'priority' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}">{% trans "Priority" %}</a></li>
+                <li{% ifequal sort 'date' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=date">{% trans "Last Seen" %}</a></li>
+                <li{% ifequal sort 'new' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=new">{% trans "First Seen" %}</a></li>
+                <li{% ifequal sort 'freq' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=freq">{% trans "Frequency" %}</a></li>
                 <li class="divider"></li>
-                <li value="accel_15"{% ifequal sort 'accel_15' %} class="active"{% endifequal %}><a href="#">{% trans "Trending: 15 minutes" %}</a></li>
-                <li value="accel_60"{% ifequal sort 'accel_60' %} class="active"{% endifequal %}><a href="#">{% trans "Trending: 60 minutes" %}</a></li>
+                <li{% ifequal sort 'accel_15' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_15">{% trans "Trending: 15 minutes" %}</a></li>
+                <li{% ifequal sort 'accel_60' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_60">{% trans "Trending: 60 minutes" %}</a></li>
             </ul>
         </li>
         <li class="pull-right"><a href="{% url sentry-ajax %}?op=clear" onclick="Sentry.stream.clear();return false;">Clear Feed</a>
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 0f03b8b6f7..7b343ad952 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -220,3 +220,19 @@ def paginator(context, queryset_or_list, request, asvar=None, per_page=settings.
         context[asvar] = result
         return ''
     return result
+
+
+@tag(register, [Constant('from'), Variable('request'),
+                Optional([Constant('without'), Name('withoutvar')]),
+                Optional([Constant('as'), Name('asvar')])])
+def querystring(context, request, withoutvar, asvar=None):
+    params = request.GET.copy()
+
+    if withoutvar in params:
+        del params[withoutvar]
+
+    result = params.urlencode()
+    if asvar:
+        context[asvar] = result
+        return ''
+    return result
diff --git a/sentry/web/frontend/groups.py b/sentry/web/frontend/groups.py
index 6b6dd8901b..8b895758e5 100644
--- a/sentry/web/frontend/groups.py
+++ b/sentry/web/frontend/groups.py
@@ -208,6 +208,13 @@ def search(request, project):
     })
 
 
+SORT_CHOICES = (
+    ('priority', 'Priority'),
+    ('date', 'Last Seeen'),
+    ('new', 'First Seen'),
+    ('freq', 'Frequency'),
+)
+
 @login_required
 @can_manage('read_message')
 def group_list(request, project):
@@ -232,14 +239,20 @@ def group_list(request, project):
 
     sort = request.GET.get('sort')
     if sort == 'date':
+        sort_label = 'Last Seen'
         event_list = event_list.order_by('-last_seen')
     elif sort == 'new':
+        sort_label = 'First Seen'
         event_list = event_list.order_by('-first_seen')
     elif sort == 'freq':
+        sort_label = 'Frequency'
         event_list = event_list.order_by('-times_seen')
     elif sort and sort.startswith('accel_'):
-        event_list = Group.objects.get_accelerated(event_list, minutes=int(sort.split('_', 1)[1]))
+        minutes = int(sort.split('_', 1)[1])
+        sort_label = 'Trending: {0} minutes'.format(minutes)
+        event_list = Group.objects.get_accelerated(event_list, minutes=minutes)
     else:
+        sort_label = 'Priority'
         sort = 'priority'
         event_list = event_list.order_by('-score', '-last_seen')
 
@@ -253,6 +266,7 @@ def group_list(request, project):
         'event_list': event_list,
         'today': today,
         'sort': sort,
+        'sort_label': sort_label,
         'any_filter': any_filter,
         'request': request,
         'filters': filters,
