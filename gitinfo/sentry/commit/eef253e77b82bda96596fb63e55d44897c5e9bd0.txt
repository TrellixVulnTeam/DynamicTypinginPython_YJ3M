commit eef253e77b82bda96596fb63e55d44897c5e9bd0
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Jul 2 23:03:24 2019 -0700

    fix(snuba): Actually retry requests on POST
    
    Follow up to #11108 since that didn't actually do anything.

diff --git a/src/sentry/utils/snuba.py b/src/sentry/utils/snuba.py
index 67b095536d..68bc0bc4ff 100644
--- a/src/sentry/utils/snuba.py
+++ b/src/sentry/utils/snuba.py
@@ -229,7 +229,14 @@ def options_override(overrides):
 
 _snuba_pool = connection_from_url(
     settings.SENTRY_SNUBA,
-    retries=5,
+    retries=urllib3.Retry(
+        total=5,
+        # Expand our retries to POST since all of
+        # our requests are POST and they don't mutate, so they
+        # are safe to retry. Without this, we aren't
+        # actually retrying at all.
+        method_whitelist={'GET', 'POST'},
+    ),
     timeout=30,
     maxsize=10,
 )
