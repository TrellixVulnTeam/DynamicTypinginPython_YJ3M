commit b7ba69f4a4a79df19ccb04c6a5268e0c583cedd3
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Mon Jan 13 13:46:15 2020 -0800

    fix: Return None if Nodestore event is not yet in Snuba (#16422)
    
    Since events are written into Nodestore before Snuba, just return None
    if a requested event has not made it all the way into Snuba yet.
    
    This can come up on the embedded error page where user feedback can be
    submitted before the event makes it all the way through.
    
    Fixes SENTRY-E59

diff --git a/src/sentry/eventstore/snuba/backend.py b/src/sentry/eventstore/snuba/backend.py
index 2d786fdcdb..f4079f7187 100644
--- a/src/sentry/eventstore/snuba/backend.py
+++ b/src/sentry/eventstore/snuba/backend.py
@@ -4,6 +4,7 @@ import six
 
 from copy import deepcopy
 from datetime import datetime, timedelta
+import logging
 
 from sentry import options
 from sentry.eventstore.base import EventStorage
@@ -22,6 +23,8 @@ ASC_ORDERING = [TIMESTAMP, EVENT_ID]
 DEFAULT_LIMIT = 100
 DEFAULT_OFFSET = 0
 
+logger = logging.getLogger(__name__)
+
 
 def get_before_event_condition(event):
     return [
@@ -122,7 +125,14 @@ class SnubaEventStorage(EventStorage):
                 referrer="eventstore.get_event_by_id_nodestore",
             )
 
-            assert len(result["data"]) == 1
+            # Return None if the event from Nodestore was not yet written to Snuba
+            if len(result["data"]) != 1:
+                logger.warning(
+                    "eventstore.missing-snuba-event",
+                    extra={"project_id": project_id, "event_id": event_id},
+                )
+                return None
+
             event.group_id = result["data"][0]["group_id"]
 
         return event
