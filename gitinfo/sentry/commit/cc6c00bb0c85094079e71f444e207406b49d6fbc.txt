commit cc6c00bb0c85094079e71f444e207406b49d6fbc
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Apr 23 21:23:16 2014 -0700

    Keep all tags relative to 1-week in group widgets

diff --git a/src/sentry/models/group.py b/src/sentry/models/group.py
index 0d8eab9960..76d9e76f8a 100644
--- a/src/sentry/models/group.py
+++ b/src/sentry/models/group.py
@@ -142,14 +142,17 @@ class Group(Model):
         module = self.data.get('module', 'ver')
         return module, self.data['version']
 
-    def get_unique_tags(self, tag):
+    def get_unique_tags(self, tag, since=None):
         from sentry.models import GroupTagValue
 
-        return GroupTagValue.objects.filter(
+        queryset = GroupTagValue.objects.filter(
             group=self,
             project=self.project,
             key=tag,
-        ).values_list(
+        )
+        if since:
+            queryset = queryset.filter(last_seen__gte=since)
+        queryset = queryset.values_list(
             'value',
             'times_seen',
             'first_seen',
diff --git a/src/sentry/templatetags/sentry_helpers.py b/src/sentry/templatetags/sentry_helpers.py
index a706e73736..82e785f4f6 100644
--- a/src/sentry/templatetags/sentry_helpers.py
+++ b/src/sentry/templatetags/sentry_helpers.py
@@ -350,16 +350,18 @@ def with_metadata(group_list, request):
 
 @register.inclusion_tag('sentry/plugins/bases/tag/widget.html')
 def render_tag_widget(group, tag):
+    cutoff = timezone.now() - timedelta(days=7)
+
     total = GroupTagValue.objects.filter(
         group=group,
         key=tag,
-        last_seen__gte=timezone.now() - timedelta(days=7),
+        last_seen__gte=cutoff,
     ).aggregate(t=Sum('times_seen'))['t'] or 0
 
     return {
         'title': tag.replace('_', ' ').title(),
         'tag_name': tag,
-        'unique_tags': list(group.get_unique_tags(tag)[:10]),
+        'unique_tags': list(group.get_unique_tags(tag, cutoff)[:10]),
         'total_count': total,
         'group': group,
     }
