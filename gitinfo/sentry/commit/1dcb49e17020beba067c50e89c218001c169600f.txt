commit 1dcb49e17020beba067c50e89c218001c169600f
Author: ted kaemming <ted@kaemming.com>
Date:   Mon Oct 31 13:03:41 2016 -0700

    Fix race condition when a project is created during weekly report generation. (#4450)
    
    Fixes SENTRY-2BG.

diff --git a/src/sentry/tasks/reports.py b/src/sentry/tasks/reports.py
index ff86dc2c34..6b032d0c95 100644
--- a/src/sentry/tasks/reports.py
+++ b/src/sentry/tasks/reports.py
@@ -496,6 +496,9 @@ class RedisReportBackend(ReportBackend):
         return zlib.compress(json.dumps(list(report)))
 
     def __decode(self, value):
+        if value is None:
+            return None
+
         return Report(*json.loads(zlib.decompress(value)))
 
     def prepare(self, timestamp, duration, organization):
@@ -697,6 +700,7 @@ def deliver_organization_user_report(timestamp, duration, organization_id, user_
     projects = list(projects)
 
     inclusion_predicates = [
+        lambda interval, (project, report): report is not None,
         has_valid_aggregates,
     ]
 
@@ -705,7 +709,7 @@ def deliver_organization_user_report(timestamp, duration, organization_id, user_
             lambda item: all(predicate(interval, item) for predicate in inclusion_predicates),
             zip(
                 projects,
-                backend.fetch(  # TODO: This should handle missing data gracefully, maybe?
+                backend.fetch(
                     timestamp,
                     duration,
                     organization,
