commit 51aeafcb9983df2e46b4f0189112e4dda63b0ab2
Author: Chris Fuller <cfuller@sentry.io>
Date:   Tue Feb 11 11:28:06 2020 -0500

    fix(workflow): Remove unscubscribe link from alert email (#16762)
    
    * Remove unscubscribe link from alert email

diff --git a/src/sentry/incidents/action_handlers.py b/src/sentry/incidents/action_handlers.py
index ee2d588f9f..fd8462f81f 100644
--- a/src/sentry/incidents/action_handlers.py
+++ b/src/sentry/incidents/action_handlers.py
@@ -8,7 +8,6 @@ from django.core.urlresolvers import reverse
 from sentry.incidents.models import AlertRuleTriggerAction, QueryAggregations, TriggerStatus
 from sentry.utils.email import MessageBuilder
 from sentry.utils.http import absolute_uri
-from sentry.utils.linksign import generate_signed_link
 
 
 @six.add_metaclass(abc.ABCMeta)
@@ -76,11 +75,9 @@ class EmailActionHandler(ActionHandler):
     def email_users(self, status):
         email_context = self.generate_email_context(status)
         for user_id, email in self.get_targets():
-            email_context["unsubscribe_link"] = self.generate_unsubscribe_link(user_id)
             self.build_message(email_context, status, user_id).send_async(to=[email])
 
     def build_message(self, context, status, user_id):
-        context["unsubscribe_link"] = self.generate_unsubscribe_link(user_id)
         display = self.status_display[status]
         return MessageBuilder(
             subject=u"Incident Alert Rule {} for Project {}".format(display, self.project.slug),
@@ -90,13 +87,6 @@ class EmailActionHandler(ActionHandler):
             context=context,
         )
 
-    def generate_unsubscribe_link(self, user_id):
-        return generate_signed_link(
-            user_id,
-            "sentry-account-email-unsubscribe-project",
-            kwargs={"project_id": self.project.id},
-        )
-
     def generate_email_context(self, status):
         trigger = self.action.alert_rule_trigger
         alert_rule = trigger.alert_rule
diff --git a/src/sentry/incidents/tasks.py b/src/sentry/incidents/tasks.py
index b1df2c33c1..d4a3795c22 100644
--- a/src/sentry/incidents/tasks.py
+++ b/src/sentry/incidents/tasks.py
@@ -22,7 +22,6 @@ from sentry.snuba.query_subscription_consumer import register_subscriber
 from sentry.tasks.base import instrumented_task, retry
 from sentry.utils.email import MessageBuilder
 from sentry.utils.http import absolute_uri
-from sentry.utils.linksign import generate_signed_link
 from sentry.utils import metrics
 
 INCIDENTS_SNUBA_SUBSCRIPTION_TYPE = "incidents"
@@ -97,9 +96,6 @@ def build_activity_context(activity, user):
         + "?"
         + urlencode({"referrer": "incident_activity_email"}),
         "comment": activity.comment,
-        "unsubscribe_link": generate_signed_link(
-            user, "sentry-account-email-unsubscribe-incident", kwargs={"incident_id": incident.id}
-        ),
     }
 
 
diff --git a/src/sentry/templates/sentry/emails/incidents/trigger.txt b/src/sentry/templates/sentry/emails/incidents/trigger.txt
index 040f7d78c0..883f05445c 100644
--- a/src/sentry/templates/sentry/emails/incidents/trigger.txt
+++ b/src/sentry/templates/sentry/emails/incidents/trigger.txt
@@ -16,7 +16,5 @@ Threshold: {{ threshold }}
 
 {% endif %}
 
-Unsubscribe: {{ unsubscribe_link }}
-
 {% endautoescape %}
 {% endspaceless %}
diff --git a/tests/sentry/incidents/test_tasks.py b/tests/sentry/incidents/test_tasks.py
index 8527382c9a..a3096256a7 100644
--- a/tests/sentry/incidents/test_tasks.py
+++ b/tests/sentry/incidents/test_tasks.py
@@ -26,7 +26,6 @@ from sentry.incidents.tasks import (
     send_subscriber_notifications,
 )
 from sentry.testutils import TestCase
-from sentry.utils.linksign import generate_signed_link
 from sentry.utils.http import absolute_uri
 
 
@@ -113,11 +112,6 @@ class TestBuildActivityContext(BaseIncidentActivityTest, TestCase):
             + "?referrer=incident_activity_email"
         )
         assert context["comment"] == expected_comment
-        assert context["unsubscribe_link"] == generate_signed_link(
-            expected_recipient,
-            "sentry-account-email-unsubscribe-incident",
-            kwargs={"incident_id": incident.id},
-        )
 
     @freeze_time()
     def test_simple(self):
