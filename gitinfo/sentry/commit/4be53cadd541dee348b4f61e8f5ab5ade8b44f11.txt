commit 4be53cadd541dee348b4f61e8f5ab5ade8b44f11
Author: Matej Minar <matej.minar@sentry.io>
Date:   Thu Jul 9 13:03:38 2020 +0200

    fix(ui): Escape release discover query (#19785)

diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/chart/utils.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/chart/utils.tsx
index 477493f86d..7bbc7c8b2e 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/chart/utils.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/chart/utils.tsx
@@ -4,6 +4,7 @@ import {GlobalSelection} from 'app/types';
 import {formatVersion} from 'app/utils/formatters';
 import {getUtcDateString} from 'app/utils/dates';
 import {t} from 'app/locale';
+import {stringifyQueryObject} from 'app/utils/tokenizeSearch';
 
 // In minutes
 const FOURTEEN_DAYS = 20160;
@@ -30,7 +31,11 @@ export function getReleaseEventView(
     version: 2,
     name: `${t('Release')} ${formatVersion(version)}`,
     fields: ['title', 'count()', 'event.type', 'issue', 'last_seen()'],
-    query: `release:${version} !event.type:transaction`,
+    query: stringifyQueryObject({
+      query: [],
+      release: [version],
+      '!event.type': ['transaction'],
+    }),
     orderby: '-last_seen',
     range: period,
     environment: environments,
diff --git a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/issues.tsx b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/issues.tsx
index 173e11b18f..9baf22314a 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/detail/overview/issues.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/detail/overview/issues.tsx
@@ -10,17 +10,16 @@ import DiscoverButton from 'app/components/discoverButton';
 import GroupList from 'app/components/issues/groupList';
 import space from 'app/styles/space';
 import {Panel, PanelBody} from 'app/components/panels';
-import EventView from 'app/utils/discover/eventView';
-import {formatVersion} from 'app/utils/formatters';
 import EmptyStateWarning from 'app/components/emptyStateWarning';
 import {DEFAULT_RELATIVE_PERIODS} from 'app/constants';
 import {GlobalSelection} from 'app/types';
 import Feature from 'app/components/acl/feature';
 import {URL_PARAM} from 'app/constants/globalSelectionHeader';
-import {getUtcDateString} from 'app/utils/dates';
 import ButtonBar from 'app/components/buttonBar';
 import {stringifyQueryObject, QueryResults} from 'app/utils/tokenizeSearch';
 
+import {getReleaseEventView} from './chart/utils';
+
 enum IssuesType {
   NEW = 'new',
   RESOLVED = 'resolved',
@@ -51,24 +50,8 @@ class Issues extends React.Component<Props, State> {
 
   getDiscoverUrl() {
     const {version, orgId, selection} = this.props;
-    const {projects, environments, datetime} = selection;
-    const {start, end, period} = datetime;
-
-    const discoverQuery = {
-      id: undefined,
-      version: 2,
-      name: `${t('Release')} ${formatVersion(version)}`,
-      fields: ['title', 'count()', 'event.type', 'issue', 'last_seen()'],
-      query: `release:${version} !event.type:transaction`,
-      orderby: '-last_seen',
-      range: period,
-      environment: environments,
-      projects,
-      start: start ? getUtcDateString(start) : undefined,
-      end: end ? getUtcDateString(end) : undefined,
-    } as const;
-
-    const discoverView = EventView.fromSavedQuery(discoverQuery);
+    const discoverView = getReleaseEventView(selection, version);
+
     return discoverView.getResultsViewUrlTarget(orgId);
   }
 
