commit 64516f1d61706c23674e7198b84a8e65351ff3c7
Author: Dan Fuller <dfuller@sentry.io>
Date:   Thu Feb 6 14:44:14 2020 -0800

    fix(subscriptions): Log a warning if subscription returns a large number of rows
    
    Followup from https://github.com/getsentry/sentry/pull/16854

diff --git a/src/sentry/incidents/subscription_processor.py b/src/sentry/incidents/subscription_processor.py
index 9608dc7a3f..8a51d20f37 100644
--- a/src/sentry/incidents/subscription_processor.py
+++ b/src/sentry/incidents/subscription_processor.py
@@ -129,6 +129,16 @@ class SubscriptionProcessor(object):
 
         aggregation = QueryAggregations(self.alert_rule.aggregation)
         aggregation_name = query_aggregation_to_snuba[aggregation][2]
+        if len(subscription_update["values"]["data"]) > 1:
+            logger.warning(
+                "Subscription returned more than 1 row of data",
+                extra={
+                    "subscription_id": self.subscription.id,
+                    "dataset": self.subscription.dataset,
+                    "snuba_subscription_id": self.subscription.subscription_id,
+                    "result": subscription_update,
+                },
+            )
         aggregation_value = subscription_update["values"]["data"][0][aggregation_name]
 
         for trigger in self.triggers:
