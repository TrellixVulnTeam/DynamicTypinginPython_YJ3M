commit 9f91da46eade52c54e18a9a2f4353ac0400d7030
Author: Ben Vinegar <ben@benv.ca>
Date:   Tue Mar 1 14:17:49 2016 -0800

    Fix not building React in "production mode"

diff --git a/setup.py b/setup.py
index c648202a25..052feb6008 100755
--- a/setup.py
+++ b/setup.py
@@ -375,11 +375,11 @@ class BuildJavascriptCommand(Command):
         # By setting NODE_ENV=production, a few things happen
         #   * React optimizes out certain code paths
         #   * Webpack will add version strings to built/referenced assets
-        os.environ['NODE_ENV'] = 'production'
 
         log.info("running [webpack]")
         env = dict(os.environ)
         env['SENTRY_STATIC_DIST_PATH'] = self.sentry_static_dist_path
+        env['NODE_ENV'] = 'production'
         check_output(['node_modules/.bin/webpack', '-p', '--bail'],
                      cwd=work_path, env=env)
 
diff --git a/webpack.config.js b/webpack.config.js
index b6c1819737..998e703ce0 100644
--- a/webpack.config.js
+++ b/webpack.config.js
@@ -137,7 +137,11 @@ var config = {
     }),
     new ExtractTextPlugin('[name].css'),
     new webpack.IgnorePlugin(/^\.\/locale$/, /moment$/), // ignore moment.js locale files
-
+    new webpack.DefinePlugin({
+      'process.env': {
+        NODE_ENV: JSON.stringify(process.env.NODE_ENV)
+      }
+    }),
     // restrict translation files pulled into dist/app.js to only those specified
     // in locale/catalogs.json
     new webpack.ContextReplacementPlugin(
