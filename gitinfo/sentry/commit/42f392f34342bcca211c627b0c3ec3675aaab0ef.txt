commit 42f392f34342bcca211c627b0c3ec3675aaab0ef
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Oct 12 07:22:53 2014 -0700

    Update test to check queue behavior

diff --git a/tests/sentry/api/endpoints/test_project_details.py b/tests/sentry/api/endpoints/test_project_details.py
index 9c614378cc..79a520ef11 100644
--- a/tests/sentry/api/endpoints/test_project_details.py
+++ b/tests/sentry/api/endpoints/test_project_details.py
@@ -1,5 +1,9 @@
+from __future__ import absolute_import
+
 from django.core.urlresolvers import reverse
-from sentry.models import Project
+from mock import patch
+
+from sentry.models import Project, ProjectStatus
 from sentry.testutils import APITestCase
 
 
@@ -29,7 +33,8 @@ class ProjectUpdateTest(APITestCase):
 
 
 class ProjectDeleteTest(APITestCase):
-    def test_simple(self):
+    @patch('sentry.api.endpoints.project_details.delete_project')
+    def test_simple(self, delete_project):
         project = self.create_project()
 
         self.login_as(user=self.user)
@@ -40,7 +45,16 @@ class ProjectDeleteTest(APITestCase):
             response = self.client.delete(url)
 
         assert response.status_code == 204
-        assert not Project.objects.filter(id=project.id).exists()
+
+        project = Project.objects.get(id=project.id)
+
+        assert project.status == ProjectStatus.PENDING_DELETION
+
+        assert response.status_code == 204
+        delete_project.delay.assert_called_once_with(
+            object_id=project.id,
+            countdown=60 * 5,
+        )
 
     def test_internal_project(self):
         project = self.create_project()
