commit 8df6b777974e6a4dbdf1091cb334875510386f6c
Author: Matej Minar <matej.minar@sentry.io>
Date:   Tue Jun 9 12:50:30 2020 +0200

    fix(ui): Fix organization id/slug in switch releases analytics (#19220)
    
    Fixes JAVASCRIPT-22DD

diff --git a/src/sentry/static/sentry/app/views/releases/detail/index.jsx b/src/sentry/static/sentry/app/views/releases/detail/index.jsx
index 0b75909ad4..8cb870943b 100644
--- a/src/sentry/static/sentry/app/views/releases/detail/index.jsx
+++ b/src/sentry/static/sentry/app/views/releases/detail/index.jsx
@@ -109,10 +109,7 @@ class OrganizationReleaseDetails extends AsyncView {
   }
 
   renderBody() {
-    const {
-      location,
-      params: {orgId},
-    } = this.props;
+    const {location, organization} = this.props;
     const {release} = this.state;
 
     const query = pick(location.query, Object.values(URL_PARAM));
@@ -126,7 +123,7 @@ class OrganizationReleaseDetails extends AsyncView {
 
     return (
       <PageContent>
-        <ReleaseHeader release={release} orgId={orgId} />
+        <ReleaseHeader release={release} organization={organization} />
         {React.cloneElement(this.props.children, {
           release,
           query,
diff --git a/src/sentry/static/sentry/app/views/releases/detail/releaseDetailActions.jsx b/src/sentry/static/sentry/app/views/releases/detail/releaseDetailActions.jsx
index cd4c6693c2..996ae8fdfa 100644
--- a/src/sentry/static/sentry/app/views/releases/detail/releaseDetailActions.jsx
+++ b/src/sentry/static/sentry/app/views/releases/detail/releaseDetailActions.jsx
@@ -1,4 +1,3 @@
-import PropTypes from 'prop-types';
 import React from 'react';
 import {browserHistory} from 'react-router';
 import styled from '@emotion/styled';
@@ -18,16 +17,16 @@ import {deleteRelease} from './utils';
 
 export default class ReleaseDetailsActions extends React.Component {
   static propTypes = {
-    orgId: PropTypes.string.isRequired,
+    organization: SentryTypes.Organization.isRequired,
     release: SentryTypes.Release.isRequired,
   };
 
   handleDelete = () => {
-    const {orgId, release} = this.props;
-    const redirectPath = `/organizations/${orgId}/releases/`;
+    const {organization, release} = this.props;
+    const redirectPath = `/organizations/${organization.slug}/releases/`;
     addLoadingMessage(t('Deleting Release...'));
 
-    deleteRelease(orgId, release.version)
+    deleteRelease(organization.slug, release.version)
       .then(() => {
         browserHistory.push(redirectPath);
       })
@@ -39,7 +38,7 @@ export default class ReleaseDetailsActions extends React.Component {
   };
 
   render() {
-    const {orgId} = this.props;
+    const {organization} = this.props;
 
     return (
       <Wrapper>
@@ -56,7 +55,7 @@ export default class ReleaseDetailsActions extends React.Component {
           </Confirm>
 
           <Feature features={['releases-v2']}>
-            <SwitchReleasesButton version="2" orgId={orgId} />
+            <SwitchReleasesButton version="2" orgId={organization.id} />
           </Feature>
         </ButtonBar>
       </Wrapper>
diff --git a/src/sentry/static/sentry/app/views/releases/detail/releaseHeader.jsx b/src/sentry/static/sentry/app/views/releases/detail/releaseHeader.jsx
index 4bea02dd69..2f0d887738 100644
--- a/src/sentry/static/sentry/app/views/releases/detail/releaseHeader.jsx
+++ b/src/sentry/static/sentry/app/views/releases/detail/releaseHeader.jsx
@@ -13,13 +13,14 @@ import TextOverflow from 'app/components/textOverflow';
 import TimeSince from 'app/components/timeSince';
 import Version from 'app/components/version';
 import TextCopyInput from 'app/views/settings/components/forms/textCopyInput';
+import SentryTypes from 'app/sentryTypes';
 
 import ReleaseDetailsActions from './releaseDetailActions';
 
 export default class ReleaseHeader extends React.Component {
   static propTypes = {
     release: PropTypes.object.isRequired,
-    orgId: PropTypes.string.isRequired,
+    organization: SentryTypes.Organization.isRequired,
   };
 
   static contextTypes = {
@@ -27,11 +28,11 @@ export default class ReleaseHeader extends React.Component {
   };
 
   render() {
-    const {release, orgId} = this.props;
+    const {release, organization} = this.props;
 
-    const releasePath = `/organizations/${orgId}/releases/${encodeURIComponent(
-      release.version
-    )}/`;
+    const releasePath = `/organizations/${
+      organization.slug
+    }/releases/${encodeURIComponent(release.version)}/`;
 
     const links = [
       {title: t('Overview'), to: releasePath},
@@ -98,7 +99,11 @@ export default class ReleaseHeader extends React.Component {
             </div>
           </div>
         </div>
-        <ReleaseDetailsActions api={this.api} orgId={orgId} release={release} />
+        <ReleaseDetailsActions
+          api={this.api}
+          organization={organization}
+          release={release}
+        />
         <NavTabs>
           {links.map(link => (
             <ListLink
diff --git a/tests/js/spec/views/releases/detail/releaseDetails.spec.jsx b/tests/js/spec/views/releases/detail/releaseDetails.spec.jsx
index aeb9c43294..27d7e36f6b 100644
--- a/tests/js/spec/views/releases/detail/releaseDetails.spec.jsx
+++ b/tests/js/spec/views/releases/detail/releaseDetails.spec.jsx
@@ -36,7 +36,7 @@ describe('ReleaseDetails', function() {
   });
 
   it('shows release details', async function() {
-    const organization = TestStubs.Organization();
+    const organization = TestStubs.Organization({slug: 'acme'});
     const params = {
       orgId: 'acme',
       projectId: 'anvils',
@@ -51,7 +51,7 @@ describe('ReleaseDetails', function() {
     };
 
     const wrapper = mountWithTheme(
-      <ReleaseDetails location={location} params={params}>
+      <ReleaseDetails location={location} params={params} organization={organization}>
         <div>hi</div>
       </ReleaseDetails>,
       TestStubs.routerContext()
