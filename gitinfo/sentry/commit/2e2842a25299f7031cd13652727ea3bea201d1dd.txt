commit 2e2842a25299f7031cd13652727ea3bea201d1dd
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Tue Jan 10 19:49:11 2017 -0800

    dist: use yarn if available when building sdist

diff --git a/src/sentry/utils/distutils/commands/base.py b/src/sentry/utils/distutils/commands/base.py
index faf7ad0c56..b6db1f52d6 100644
--- a/src/sentry/utils/distutils/commands/base.py
+++ b/src/sentry/utils/distutils/commands/base.py
@@ -123,19 +123,26 @@ class BaseBuildCommand(Command):
 
     def _setup_npm(self):
         node_version = []
-        for app in 'node', 'npm':
+        for app in 'node', 'npm', 'yarn':
             try:
                 node_version.append(
                     self._run_command([app, '--version']).rstrip()
                 )
             except OSError:
-                log.fatal('Cannot find `{0}` executable. Please install {0}`'
-                          ' and try again.'.format(app))
-                sys.exit(1)
-
-        log.info('using node ({}) and npm ({})'.format(*node_version))
-
-        self._run_command(['npm', 'install', '--production', '--quiet'])
+                if app == 'yarn':
+                    # yarn is optional
+                    node_version.append(None)
+                else:
+                    log.fatal('Cannot find `{0}` executable. Please install {0}`'
+                              ' and try again.'.format(app))
+                    sys.exit(1)
+
+        if node_version[2] is not None:
+            log.info('using node ({0}) and yarn ({2})'.format(*node_version))
+            self._run_command(['yarn', 'install', '--production', '--pure-lockfile', '--ignore-optional'])
+        else:
+            log.info('using node ({0}) and npm ({1})'.format(*node_version))
+            self._run_command(['npm', 'install', '--production', '--quiet'])
 
     def _run_command(self, cmd, env=None):
         log.debug('running [%s]' % (' '.join(cmd),))
