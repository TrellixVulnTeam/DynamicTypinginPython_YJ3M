commit 9436951f2213d45814a122741494eacf9c880c5c
Author: josh <josh@jrl.ninja>
Date:   Mon Mar 9 19:12:51 2020 +0000

    dev(direnv): give advice rather than automatically initialize state (#17533)

diff --git a/.envrc b/.envrc
index 36c243bb95..da4733d329 100644
--- a/.envrc
+++ b/.envrc
@@ -47,13 +47,28 @@ EOF
     return 1
 }
 
-init_venv () {
+advice_init_venv () {
     deactivate 2>/dev/null || true
-    info "Creating a virtualenv for you."
+    info "To create a virtualenv, please type: python2.7 -m virtualenv .venv"
     require python2.7 || \
         die "You'll need to install python2.7, or make it available on your PATH.
 It's recommended to use pyenv - please refer to https://docs.sentry.io/development/contribute/environment"
-    python2.7 -m virtualenv .venv
+    return 1
+}
+
+advice_install_sentry () {
+    info "To install sentry, please type: make install-sentry-dev"
+    return 1
+}
+
+advice_install_pre_commit () {
+    info "To install pre-commit, please type: make setup-git"
+    return 1
+}
+
+advice_install_yarn_pkgs () {
+    info "To install yarn packages, please type: make install-yarn-pkgs"
+    return 1
 }
 
 ### Environment ###
@@ -98,12 +113,12 @@ if [ -n "$VIRTUAL_ENV" ]; then
     # we're enforcing that virtualenv be in .venv, since future tooling e.g. venv-update will rely on this.
     if [ "$VIRTUAL_ENV" != "${PWD}/.venv" ]; then
         info "You're in a virtualenv, but it's not in the expected location (${PWD}/.venv)"
-        init_venv
+        advice_init_venv
     fi
 else
     if [ ! -f ".venv/bin/activate" ]; then
         info "You don't seem to have a virtualenv."
-        init_venv
+        advice_init_venv
     fi
 fi
 
@@ -118,9 +133,10 @@ python -c "import sys; sys.exit(sys.version_info[:2] != (2, 7))" || \
     die "For some reason, the virtualenv isn't Python 2.7."
 
 if [ "$(command -v sentry)" != "${PWD}/.venv/bin/sentry" ]; then
-    info "Your .venv is activated, but sentry doesn't seem to be installed. Let's install it."
-    make ensure-pinned-pip
-    SENTRY_LIGHT_BUILD=1 make install-sentry-dev
+    info "Your .venv is activated, but sentry doesn't seem to be installed."
+    # XXX: if direnv fails, the venv won't be activated outside of direnv execution...
+    # So, it is critical that make install-sentry-dev is guarded by scripts/ensure-venv.
+    advice_install_sentry
 fi
 
 
@@ -129,8 +145,8 @@ fi
 info "Checking pre-commit..."
 
 if ! require pre-commit; then
-    info "Looks like you don't have pre-commit installed. Let's install it."
-    make setup-git
+    info "Looks like you don't have pre-commit installed."
+    advice_install_pre_commit
 fi
 
 
@@ -154,8 +170,8 @@ It's recommended to use volta - please refer to https://docs.sentry.io/developme
 fi
 
 if [ ! -x "node_modules/.bin/webpack" ]; then
-    info "You don't seem to have yarn packages installed. Let's install them."
-    make install-yarn-pkgs
+    info "You don't seem to have yarn packages installed."
+    advice_install_yarn_pkgs
 fi
 
 PATH_add node_modules/.bin
diff --git a/Makefile b/Makefile
index ebce4a34f9..85c2e8353f 100644
--- a/Makefile
+++ b/Makefile
@@ -80,7 +80,7 @@ install-yarn-pkgs: node-version-check
 	# Add an additional check against `node_modules`
 	$(YARN) check --verify-tree || $(YARN) install --check-files
 
-install-sentry-dev: ensure-venv
+install-sentry-dev: ensure-pinned-pip
 	@echo "--> Installing Sentry (for development)"
 	# SENTRY_LIGHT_BUILD=1 disables webpacking during setup.py.
 	# Webpacked assets are only necessary for devserver (which does it lazily anyways)
