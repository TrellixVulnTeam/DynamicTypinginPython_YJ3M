commit addeee86552fb45da35e8fa9b03412e69f7890c7
Author: Matej Minar <matej.minar@sentry.io>
Date:   Wed May 20 11:13:59 2020 +0200

    fix(ui): Fix exception order when toggling full/raw (#18911)

diff --git a/src/sentry/static/sentry/app/components/events/interfaces/exceptionContent.tsx b/src/sentry/static/sentry/app/components/events/interfaces/exceptionContent.tsx
index c8285b0e68..a5dfe62f5b 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/exceptionContent.tsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/exceptionContent.tsx
@@ -70,13 +70,7 @@ const ExceptionContent = ({
   values,
   type,
 }: Props) => {
-  const exceptionValues = values;
-
-  if (newestFirst) {
-    exceptionValues.reverse();
-  }
-
-  return exceptionValues.map((exc, excIdx) => (
+  const children = values.map((exc, excIdx) => (
     <div key={excIdx} className="exception">
       <ExceptionTitle type={exc.type} exceptionModule={exc?.module} />
       <Annotated object={exc} objectKey="value" required>
@@ -87,13 +81,19 @@ const ExceptionContent = ({
         data={type === 'original' ? exc.stacktrace : exc.rawStacktrace || exc.stacktrace}
         stackView={stackView}
         stacktrace={exc.stacktrace}
-        expandFirstFrame={excIdx === 0}
+        expandFirstFrame={excIdx === values.length - 1}
         platform={platform}
         newestFirst={newestFirst}
         event={event}
       />
     </div>
   ));
+
+  if (newestFirst) {
+    children.reverse();
+  }
+
+  return <div>{children}</div>;
 };
 
 export default ExceptionContent;
diff --git a/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap b/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
index c35539fbc4..6272207621 100644
--- a/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
+++ b/tests/js/spec/components/events/__snapshots__/crashContent.spec.jsx.snap
@@ -63,78 +63,65 @@ exports[`CrashContent renders with meta data 1`] = `
         ]
       }
     >
-      <div
-        className="exception"
-        key="0"
-      >
-        <ExceptionTitle
-          exceptionModule="exceptions"
-          type="ValueError"
+      <div>
+        <div
+          className="exception"
+          key="0"
         >
-          <Tooltip
-            containerDisplayMode="inline-block"
-            position="top"
-            title={
-              <span>
-                <span>
-                  from 
-                </span>
+          <ExceptionTitle
+            exceptionModule="exceptions"
+            type="ValueError"
+          >
+            <Tooltip
+              containerDisplayMode="inline-block"
+              position="top"
+              title={
                 <span>
-                  exceptions
+                  <span>
+                    from 
+                  </span>
+                  <span>
+                    exceptions
+                  </span>
                 </span>
-              </span>
-            }
-          >
-            <Manager>
-              <Reference>
-                <InnerReference
-                  setReferenceNode={[Function]}
-                >
-                  <Container
-                    aria-describedby="tooltip-123456"
-                    containerDisplayMode="inline-block"
-                    onBlur={[Function]}
-                    onFocus={[Function]}
-                    onMouseEnter={[Function]}
-                    onMouseLeave={[Function]}
+              }
+            >
+              <Manager>
+                <Reference>
+                  <InnerReference
+                    setReferenceNode={[Function]}
                   >
-                    <span
+                    <Container
                       aria-describedby="tooltip-123456"
-                      className="css-1y4rfpo-Container eowlwvy0"
+                      containerDisplayMode="inline-block"
                       onBlur={[Function]}
                       onFocus={[Function]}
                       onMouseEnter={[Function]}
                       onMouseLeave={[Function]}
                     >
-                      <Title>
-                        <h5
-                          className="css-dcmuoy-Title e1b96xrx0"
-                        >
-                          ValueError
-                        </h5>
-                      </Title>
-                    </span>
-                  </Container>
-                </InnerReference>
-              </Reference>
-            </Manager>
-          </Tooltip>
-        </ExceptionTitle>
-        <Annotated
-          object={
-            Object {
-              "module": "exceptions",
-              "stacktrace": Object {
-                "frames": Array [],
-              },
-              "type": "ValueError",
-              "value": "python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err",
-            }
-          }
-          objectKey="value"
-          required={true}
-        >
-          <MetaData
+                      <span
+                        aria-describedby="tooltip-123456"
+                        className="css-1y4rfpo-Container eowlwvy0"
+                        onBlur={[Function]}
+                        onFocus={[Function]}
+                        onMouseEnter={[Function]}
+                        onMouseLeave={[Function]}
+                      >
+                        <Title>
+                          <h5
+                            className="css-dcmuoy-Title e1b96xrx0"
+                          >
+                            ValueError
+                          </h5>
+                        </Title>
+                      </span>
+                    </Container>
+                  </InnerReference>
+                </Reference>
+              </Manager>
+            </Tooltip>
+          </ExceptionTitle>
+          <Annotated
             object={
               Object {
                 "module": "exceptions",
@@ -145,108 +132,96 @@ exports[`CrashContent renders with meta data 1`] = `
                 "value": "python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err",
               }
             }
-            prop="value"
+            objectKey="value"
             required={true}
           >
-            <ErrorBoundary
-              mini={true}
+            <MetaData
+              object={
+                Object {
+                  "module": "exceptions",
+                  "stacktrace": Object {
+                    "frames": Array [],
+                  },
+                  "type": "ValueError",
+                  "value": "python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err",
+                }
+              }
+              prop="value"
+              required={true}
             >
-              <StyledPre
-                className="exc-message"
+              <ErrorBoundary
+                mini={true}
               >
-                <pre
-                  className="exc-message css-1q8nviw-StyledPre e1jgwng30"
+                <StyledPre
+                  className="exc-message"
                 >
-                  <AnnotatedText
-                    meta={
-                      Object {
-                        "len": 29,
-                        "rem": Array [
-                          Array [
-                            "device_id",
-                            "p",
-                            11,
-                            51,
+                  <pre
+                    className="exc-message css-1q8nviw-StyledPre e1jgwng30"
+                  >
+                    <AnnotatedText
+                      meta={
+                        Object {
+                          "len": 29,
+                          "rem": Array [
+                            Array [
+                              "device_id",
+                              "p",
+                              11,
+                              51,
+                            ],
                           ],
-                        ],
+                        }
                       }
-                    }
-                    value="python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err"
-                  >
-                    <span>
-                      <Tooltip
-                        containerDisplayMode="inline-block"
-                        position="top"
-                        title="Pseudonymized because of PII rule \\"device_id\\""
-                      >
-                        <Manager>
-                          <Reference>
-                            <InnerReference
-                              setReferenceNode={[Function]}
-                            >
-                              <Container
-                                aria-describedby="tooltip-123456"
-                                containerDisplayMode="inline-block"
-                                onBlur={[Function]}
-                                onFocus={[Function]}
-                                onMouseEnter={[Function]}
-                                onMouseLeave={[Function]}
+                      value="python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err"
+                    >
+                      <span>
+                        <Tooltip
+                          containerDisplayMode="inline-block"
+                          position="top"
+                          title="Pseudonymized because of PII rule \\"device_id\\""
+                        >
+                          <Manager>
+                            <Reference>
+                              <InnerReference
+                                setReferenceNode={[Function]}
                               >
-                                <span
+                                <Container
                                   aria-describedby="tooltip-123456"
-                                  className="css-1y4rfpo-Container eowlwvy0"
+                                  containerDisplayMode="inline-block"
                                   onBlur={[Function]}
                                   onFocus={[Function]}
                                   onMouseEnter={[Function]}
                                   onMouseLeave={[Function]}
                                 >
-                                  <Redaction>
-                                    <span
-                                      className="css-1vnqw28-Redaction e186salf1"
-                                    >
-                                      python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err
-                                    </span>
-                                  </Redaction>
-                                </span>
-                              </Container>
-                            </InnerReference>
-                          </Reference>
-                        </Manager>
-                      </Tooltip>
-                    </span>
-                  </AnnotatedText>
-                </pre>
-              </StyledPre>
-            </ErrorBoundary>
-          </MetaData>
-        </Annotated>
-        <ExceptionStacktraceContent
-          data={
-            Object {
-              "frames": Array [],
-            }
-          }
-          event={
-            Object {
-              "dateCreated": "2019-05-21T18:01:48.762Z",
-              "eventID": "12345678901234567890123456789012",
-              "groupID": "1",
-              "id": "1",
-              "message": "ApiException",
-              "tags": Array [],
-              "title": "ApiException",
-            }
-          }
-          expandFirstFrame={true}
-          newestFirst={true}
-          stackView="full"
-          stacktrace={
-            Object {
-              "frames": Array [],
-            }
-          }
-        >
-          <StacktraceContent
+                                  <span
+                                    aria-describedby="tooltip-123456"
+                                    className="css-1y4rfpo-Container eowlwvy0"
+                                    onBlur={[Function]}
+                                    onFocus={[Function]}
+                                    onMouseEnter={[Function]}
+                                    onMouseLeave={[Function]}
+                                  >
+                                    <Redaction>
+                                      <span
+                                        className="css-1vnqw28-Redaction e186salf1"
+                                      >
+                                        python err A949AE01EBB07300D62AE0178F0944DD21F8C98C err
+                                      </span>
+                                    </Redaction>
+                                  </span>
+                                </Container>
+                              </InnerReference>
+                            </Reference>
+                          </Manager>
+                        </Tooltip>
+                      </span>
+                    </AnnotatedText>
+                  </pre>
+                </StyledPre>
+              </ErrorBoundary>
+            </MetaData>
+          </Annotated>
+          <ExceptionStacktraceContent
             data={
               Object {
                 "frames": Array [],
@@ -264,16 +239,43 @@ exports[`CrashContent renders with meta data 1`] = `
               }
             }
             expandFirstFrame={true}
-            includeSystemFrames={true}
             newestFirst={true}
+            stackView="full"
+            stacktrace={
+              Object {
+                "frames": Array [],
+              }
+            }
           >
-            <div
-              className=" traceback full-traceback"
+            <StacktraceContent
+              data={
+                Object {
+                  "frames": Array [],
+                }
+              }
+              event={
+                Object {
+                  "dateCreated": "2019-05-21T18:01:48.762Z",
+                  "eventID": "12345678901234567890123456789012",
+                  "groupID": "1",
+                  "id": "1",
+                  "message": "ApiException",
+                  "tags": Array [],
+                  "title": "ApiException",
+                }
+              }
+              expandFirstFrame={true}
+              includeSystemFrames={true}
+              newestFirst={true}
             >
-              <ul />
-            </div>
-          </StacktraceContent>
-        </ExceptionStacktraceContent>
+              <div
+                className=" traceback full-traceback"
+              >
+                <ul />
+              </div>
+            </StacktraceContent>
+          </ExceptionStacktraceContent>
+        </div>
       </div>
     </ExceptionContent>
   </ErrorBoundary>
