commit 54dbdcf09431437d891b3eb25ce288fdbe8bdeb5
Author: MeredithAnya <meredith.a.heller@gmail.com>
Date:   Thu May 31 12:54:07 2018 -0700

    feat(integrations): Add feature flag for GitHub Apps (#8602)
    
    * feat(integrations): Add feature flag for GitHub Apps
    
    * refactor
    
    * org integration config
    
    * correctly display integrations

diff --git a/src/sentry/api/endpoints/organization_config_integrations.py b/src/sentry/api/endpoints/organization_config_integrations.py
index 0869bfd2db..352423bcd2 100644
--- a/src/sentry/api/endpoints/organization_config_integrations.py
+++ b/src/sentry/api/endpoints/organization_config_integrations.py
@@ -15,11 +15,16 @@ class OrganizationConfigIntegrationsEndpoint(OrganizationEndpoint):
         has_catchall = features.has('organizations:internal-catchall',
                                     organization,
                                     actor=request.user)
+        has_github_apps = features.has('organizations:github-apps',
+                                       organization,
+                                       actor=request.user)
 
         for provider in integrations.all():
             metadata = provider.metadata
             metadata = metadata and metadata._asdict() or None
-            if not has_catchall and provider.key in settings.SENTRY_INTERNAL_INTEGRATIONS:
+            internal_integrations = {
+                i for i in settings.SENTRY_INTERNAL_INTEGRATIONS if i != 'github' or not has_github_apps}
+            if not has_catchall and provider.key in internal_integrations:
                 continue
             providers.append(
                 {
diff --git a/src/sentry/api/endpoints/organization_config_repositories.py b/src/sentry/api/endpoints/organization_config_repositories.py
index bce314e1b5..e59cad8110 100644
--- a/src/sentry/api/endpoints/organization_config_repositories.py
+++ b/src/sentry/api/endpoints/organization_config_repositories.py
@@ -12,23 +12,33 @@ class OrganizationConfigRepositoriesEndpoint(OrganizationEndpoint):
     def get(self, request, organization):
         provider_bindings = bindings.get('repository.provider')
         integrations_provider_bindings = bindings.get('integration-repository.provider')
+        has_catchall = features.has(
+            'organizations:internal-catchall',
+            organization,
+            actor=request.user)
+        has_github_apps = features.has('organizations:github-apps',
+                                       organization,
+                                       actor=request.user)
 
         providers = []
         for provider_id in provider_bindings:
             provider = provider_bindings.get(provider_id)(id=provider_id)
             # TODO(jess): figure out better way to exclude this
-            if provider_id != 'github_apps':
-                providers.append(
-                    {
-                        'id': provider_id,
-                        'name': provider.name,
-                        'config': provider.get_config(),
-                    }
-                )
-
-        if features.has('organizations:internal-catchall', organization, actor=request.user):
-            for provider_id in integrations_provider_bindings:
-                provider = integrations_provider_bindings.get(provider_id)(id=provider_id)
+            if provider_id == 'github_apps':
+                continue
+            if has_github_apps and provider_id == 'github':
+                continue
+            providers.append(
+                {
+                    'id': provider_id,
+                    'name': provider.name,
+                    'config': provider.get_config(),
+                }
+            )
+
+        for provider_id in integrations_provider_bindings:
+            provider = integrations_provider_bindings.get(provider_id)(id=provider_id)
+            if has_catchall or (has_github_apps and provider_id == 'integrations:github'):
                 providers.append(
                     {
                         'id': provider_id,
diff --git a/src/sentry/api/serializers/models/organization.py b/src/sentry/api/serializers/models/organization.py
index 7497ecf1c7..47921f0da4 100644
--- a/src/sentry/api/serializers/models/organization.py
+++ b/src/sentry/api/serializers/models/organization.py
@@ -105,6 +105,8 @@ class DetailedOrganizationSerializer(OrganizationSerializer):
             feature_list.append('api-keys')
         if features.has('organizations:group-unmerge', obj, actor=user):
             feature_list.append('group-unmerge')
+        if features.has('organizations:github-apps', obj, actor=user):
+            feature_list.append('github-apps')
         if features.has('organizations:integrations-v3', obj, actor=user):
             feature_list.append('integrations-v3')
         if features.has('organizations:new-settings', obj, actor=user):
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 1e27aecb52..830a084f52 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -752,6 +752,7 @@ SENTRY_FEATURES = {
     'organizations:sso-saml2': False,
     'organizations:sso-rippling': False,
     'organizations:group-unmerge': False,
+    'organizations:github-apps': False,
     'organizations:integrations-v3': False,
     'organizations:invite-members': True,
     'organizations:new-settings': True,
diff --git a/src/sentry/features/__init__.py b/src/sentry/features/__init__.py
index a3937251b6..5f72aff7bc 100644
--- a/src/sentry/features/__init__.py
+++ b/src/sentry/features/__init__.py
@@ -16,6 +16,7 @@ default_manager.add('organizations:repos', OrganizationFeature)  # NOQA
 default_manager.add('organizations:release-commits', OrganizationFeature)  # NOQA
 default_manager.add('organizations:suggested-commits', OrganizationFeature)  # NOQA
 default_manager.add('organizations:group-unmerge', OrganizationFeature)  # NOQA
+default_manager.add('organizations:github-apps', OrganizationFeature)  # NOQA
 default_manager.add('organizations:invite-members', OrganizationFeature)  # NOQA
 default_manager.add('organizations:new-settings', OrganizationFeature)  # NOQA
 default_manager.add('organizations:integrations-v3', OrganizationFeature)  # NOQA
diff --git a/src/sentry/static/sentry/app/views/projectPlugins/organizationIntegrations.jsx b/src/sentry/static/sentry/app/views/projectPlugins/organizationIntegrations.jsx
index 446ec5e83d..e847fa3ba4 100644
--- a/src/sentry/static/sentry/app/views/projectPlugins/organizationIntegrations.jsx
+++ b/src/sentry/static/sentry/app/views/projectPlugins/organizationIntegrations.jsx
@@ -39,7 +39,7 @@ export default class OrganizationIntegrations extends AsyncComponent {
   renderBody() {
     let {orgId, projectId} = this.props;
     let orgFeatures = new Set(this.state.organization.features);
-    let internalIntegrations = new Set(['jira', 'github']);
+    let internalIntegrations = new Set(['jira']);
 
     const integrations = this.state.config.providers
       .filter(provider => {
