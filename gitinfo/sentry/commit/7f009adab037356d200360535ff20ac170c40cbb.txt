commit 7f009adab037356d200360535ff20ac170c40cbb
Author: ted kaemming <ted@kaemming.com>
Date:   Thu Nov 2 17:32:57 2017 -0700

    fix(tsdb): Correct parameter validation when deleting distinct counters (#6506)
    
    Fixes SENTRY-535.

diff --git a/src/sentry/tsdb/redis.py b/src/sentry/tsdb/redis.py
index 5ac5972df9..42f06851e3 100644
--- a/src/sentry/tsdb/redis.py
+++ b/src/sentry/tsdb/redis.py
@@ -572,12 +572,12 @@ class RedisTSDB(BaseTSDB):
 
     def delete_distinct_counts(self, models, keys, start=None, end=None,
                                timestamp=None, environment_ids=None):
-        self.validate_arguments(models, environment_ids)
-
         environment_ids = (
             set(environment_ids) if environment_ids is not None else set()).union(
             [None])
 
+        self.validate_arguments(models, environment_ids)
+
         rollups = self.get_active_series(start, end, timestamp)
 
         for cluster, environment_ids in self.get_cluster_groups(environment_ids):
