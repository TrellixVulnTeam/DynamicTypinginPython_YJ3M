commit 99e957eea2deb53d273f04481859f42301b0ca2f
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Oct 19 19:11:35 2013 -0700

    Correct node deletions (they're not bound to projects)

diff --git a/src/sentry/tasks/cleanup.py b/src/sentry/tasks/cleanup.py
index c94b530cf8..2e9e0ee376 100644
--- a/src/sentry/tasks/cleanup.py
+++ b/src/sentry/tasks/cleanup.py
@@ -42,13 +42,20 @@ def cleanup(days=30, project=None, chunk_size=1000, **kwargs):
         (EventMapping, 'date_added'),
         # Group should probably be last
         (Group, 'last_seen'),
-        (Node, 'timestamp'),
     )
 
     log = cleanup.get_logger()
 
     ts = timezone.now() - datetime.timedelta(days=days)
 
+    log.info("Removing expired values for %r", LostPasswordHash)
+    LostPasswordHash.objects.filter(
+        date_added__lte=timezone.now() - datetime.timedelta(days=1)
+    ).delete()
+
+    log.info("Removing old Node values")
+    Node.objects.filter(timestamp__lte=ts)
+
     # Remove types which can easily be bound to project + date
     for model, date_col in GENERIC_DELETES:
         log.info("Removing %r for days=%s project=%r", model, days, project or '*')
@@ -60,8 +67,3 @@ def cleanup(days=30, project=None, chunk_size=1000, **kwargs):
             for obj in list(qs[:chunk_size]):
                 log.info("Removing %r", obj)
                 obj.delete()
-
-    log.info("Removing expired values for %r", LostPasswordHash)
-    LostPasswordHash.objects.filter(
-        date_added__lte=timezone.now() - datetime.timedelta(days=1)
-    ).delete()
