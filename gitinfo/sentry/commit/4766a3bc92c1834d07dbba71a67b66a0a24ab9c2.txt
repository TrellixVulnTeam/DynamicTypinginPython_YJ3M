commit 4766a3bc92c1834d07dbba71a67b66a0a24ab9c2
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jun 4 10:53:58 2015 +0100

    Improve handling of duplicate event datetimes

diff --git a/src/sentry/api/endpoints/event_details.py b/src/sentry/api/endpoints/event_details.py
index debc8ea6cc..8872cc49ba 100644
--- a/src/sentry/api/endpoints/event_details.py
+++ b/src/sentry/api/endpoints/event_details.py
@@ -30,17 +30,29 @@ class EventDetailsEndpoint(Endpoint):
 
         Event.objects.bind_nodes([event], 'data')
 
+        # HACK(dcramer): work around lack of unique sorting on datetime
         base_qs = Event.objects.filter(
             group=event.group_id,
         ).exclude(id=event.id)
         try:
-            next_event = base_qs.filter(datetime__gte=event.datetime).order_by('datetime')[0:1].get()
-        except Event.DoesNotExist:
+            next_event = sorted(
+                base_qs.filter(
+                    datetime__gte=event.datetime
+                ).order_by('datetime')[0:5],
+                key=lambda x: (x.datetime, x.id)
+            )[0]
+        except IndexError:
             next_event = None
 
         try:
-            prev_event = base_qs.filter(datetime__lte=event.datetime).order_by('-datetime')[0:1].get()
-        except Event.DoesNotExist:
+            prev_event = sorted(
+                base_qs.filter(
+                    datetime__lte=event.datetime,
+                ).order_by('-datetime')[0:5],
+                key=lambda x: (x.datetime, x.id),
+                reverse=True
+            )[0]
+        except IndexError:
             prev_event = None
 
         data = serialize(event, request.user)
