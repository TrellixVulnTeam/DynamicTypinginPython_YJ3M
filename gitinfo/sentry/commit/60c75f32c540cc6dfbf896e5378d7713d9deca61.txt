commit 60c75f32c540cc6dfbf896e5378d7713d9deca61
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Dec 9 16:35:55 2014 -0800

    Adjust project slug restrictions

diff --git a/src/sentry/db/models/utils.py b/src/sentry/db/models/utils.py
index 55d56f36da..bd4c7544cc 100644
--- a/src/sentry/db/models/utils.py
+++ b/src/sentry/db/models/utils.py
@@ -53,8 +53,9 @@ def resolve_expression_node(instance, node):
     return runner
 
 
-def slugify_instance(inst, label, reserved=(), **kwargs):
+def slugify_instance(inst, label, reserved=(), *args, **kwargs):
     base_slug = slugify(label)
+
     if base_slug in reserved:
         base_slug = None
     elif base_slug is not None:
@@ -66,6 +67,6 @@ def slugify_instance(inst, label, reserved=(), **kwargs):
     manager = type(inst).objects
     inst.slug = base_slug
     n = 0
-    while manager.filter(slug__iexact=inst.slug, **kwargs).exists():
+    while manager.filter(slug__iexact=inst.slug, *args, **kwargs).exists():
         n += 1
         inst.slug = base_slug + '-' + str(n)
diff --git a/src/sentry/migrations/0143_fill_project_orgs.py b/src/sentry/migrations/0143_fill_project_orgs.py
index d932d114a9..571fa428ce 100644
--- a/src/sentry/migrations/0143_fill_project_orgs.py
+++ b/src/sentry/migrations/0143_fill_project_orgs.py
@@ -19,7 +19,9 @@ class Migration(DataMigration):
         for project in queryset:
             project.organization = project.team.organization
             # we also need to update the slug here based on the new constraints
-            slugify_instance(project, project.name, organization=project.organization)
+            slugify_instance(project, project.name, (
+                models.Q(organization=project.organization) | models.Q(team=project.team),
+            ))
             project.save()
 
     def backwards(self, orm):
