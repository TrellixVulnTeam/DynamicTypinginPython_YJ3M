commit 6470b79a541e878f76b61d05fd6187727eff45a3
Author: David Cramer <cramer@dropbox.com>
Date:   Sat Dec 28 16:31:55 2013 -0800

    Basic tests for send_notification

diff --git a/src/sentry/testutils.py b/src/sentry/testutils.py
index 10c3b88e46..eccce0e49b 100644
--- a/src/sentry/testutils.py
+++ b/src/sentry/testutils.py
@@ -99,10 +99,7 @@ class BaseTestCase(Exam):
 
     @fixture
     def user(self):
-        user = User(username="admin", email="admin@localhost", is_staff=True, is_superuser=True)
-        user.set_password('admin')
-        user.save()
-        return user
+        return self.create_user('admin@localhost', username='admin')
 
     @fixture
     def team(self):
@@ -132,6 +129,17 @@ class BaseTestCase(Exam):
     def event(self):
         return self.create_event(event_id='a' * 32)
 
+    def create_user(self, email, **kwargs):
+        kwargs.setdefault('username', email)
+        kwargs.setdefault('is_staff', True)
+        kwargs.setdefault('is_superuser', True)
+
+        user = User(email=email, **kwargs)
+        user.set_password('admin')
+        user.save()
+
+        return user
+
     def create_event(self, event_id, **kwargs):
         if 'group' not in kwargs:
             kwargs['group'] = self.group
diff --git a/tests/sentry/models/activity/__init__.py b/tests/sentry/models/activity/__init__.py
new file mode 100644
index 0000000000..e69de29bb2
diff --git a/tests/sentry/models/activity/tests.py b/tests/sentry/models/activity/tests.py
new file mode 100644
index 0000000000..ad6ddd31cd
--- /dev/null
+++ b/tests/sentry/models/activity/tests.py
@@ -0,0 +1,31 @@
+from django.core import mail
+
+from sentry.models import Activity
+from sentry.testutils import TestCase
+
+
+class SendNotificationTest(TestCase):
+    def test_simple(self):
+        user_foo = self.create_user('foo@example.com')
+
+        activity = Activity.objects.create(
+            project=self.project,
+            group=self.group,
+            type=Activity.NOTE,
+            user=user_foo,
+            event=self.create_event('a' * 32, group=self.group),
+            data={
+                'text': 'sup guise',
+            },
+        )
+
+        self.project.team.member_set.create(user=user_foo)
+
+        activity.send_notification()
+
+        assert len(mail.outbox) == 1
+
+        msg = mail.outbox[0]
+
+        assert msg.subject == '[Sentry] [Bar] foo@example.com: sup guise'
+        assert msg.to == [self.user.email]
