commit 0bf1b7d58dd387e172fcfe535f34ec8d1226ac5f
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Aug 6 15:44:17 2015 -0700

    Add events in 24h to beacon stats

diff --git a/src/sentry/tasks/beacon.py b/src/sentry/tasks/beacon.py
index 07db4cdc38..85d82ecacc 100644
--- a/src/sentry/tasks/beacon.py
+++ b/src/sentry/tasks/beacon.py
@@ -12,10 +12,13 @@ import json
 import logging
 import sentry
 
+from datetime import timedelta
 from django.conf import settings
+from django.utils import timezone
 from hashlib import sha1
 from uuid import uuid4
 
+from sentry.app import tsdb
 from sentry.http import safe_urlopen, safe_urlread
 from sentry.tasks.base import instrumented_task
 
@@ -51,6 +54,14 @@ def send_beacon():
         id__in=internal_project_ids,
     ).values_list('platform', flat=True)))
 
+    end = timezone.now()
+    events_24h = tsdb.get_sums(
+        model=tsdb.models.internal,
+        keys=['events.total'],
+        start=end - timedelta(hours=24),
+        end=end,
+    )['events.total']
+
     payload = {
         'install_id': install_id,
         'version': sentry.get_version(),
@@ -63,6 +74,7 @@ def send_beacon():
             'projects': Project.objects.count(),
             'teams': Team.objects.count(),
             'organizations': Organization.objects.count(),
+            'events.24h': events_24h,
         }
     }
 
diff --git a/tests/sentry/tasks/test_beacon.py b/tests/sentry/tasks/test_beacon.py
index 732a8e9cbf..88ad3e9bfe 100644
--- a/tests/sentry/tasks/test_beacon.py
+++ b/tests/sentry/tasks/test_beacon.py
@@ -36,6 +36,7 @@ class SendBeaconTest(TestCase):
                 'users': 2,
                 'projects': 2,
                 'teams': 2,
+                'events.24h': 0,
             },
             'admin_email': 'foo@example.com',
         }, timeout=5)
