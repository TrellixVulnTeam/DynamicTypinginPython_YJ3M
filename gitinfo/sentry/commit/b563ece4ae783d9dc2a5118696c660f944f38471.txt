commit b563ece4ae783d9dc2a5118696c660f944f38471
Author: adhiraj <693121+adhiraj@users.noreply.github.com>
Date:   Wed Jul 25 16:14:35 2018 -0700

    fix(permissions): Use correct permission to check org creation (#9184)
    
    * fix(permissions): Use correct permission to check org creation

diff --git a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
index 4d1caa9ec8..df6f52e0bc 100644
--- a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/index.jsx
@@ -11,6 +11,7 @@ import Link from 'app/components/link';
 import SentryTypes from 'app/sentryTypes';
 import TextOverflow from 'app/components/textOverflow';
 import IdBadge from 'app/components/idBadge';
+import ConfigStore from 'app/stores/configStore';
 
 import SwitchOrganization from './switchOrganization';
 import SidebarOrgSummary from './sidebarOrgSummary';
@@ -41,9 +42,9 @@ class SidebarDropdown extends React.Component {
     // (which uses an org from organizations index endpoint versus details endpoint)
     // and does not have `access`
     let hasOrgRead = org && org.access && org.access.indexOf('org:read') > -1;
-    let hasOrgWrite = org && org.access && org.access.indexOf('org:write') > -1;
     let hasMemberRead = org && org.access && org.access.indexOf('member:read') > -1;
     let hasTeamRead = org && org.access && org.access.indexOf('team:read') > -1;
+    let canCreateOrg = ConfigStore.get('features').has('organizations:create');
 
     // Avatar to use: Organization --> user --> Sentry
     const avatar =
@@ -121,7 +122,7 @@ class SidebarDropdown extends React.Component {
 
                       {!config.singleOrganization && (
                         <SidebarMenuItem>
-                          <SwitchOrganization canCreateOrganization={hasOrgWrite} />
+                          <SwitchOrganization canCreateOrganization={canCreateOrg} />
                         </SidebarMenuItem>
                       )}
 
diff --git a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
index 93cd0b765d..296a212570 100644
--- a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
@@ -492,10 +492,10 @@ exports[`Sidebar SidebarDropdown can open Sidebar org/name dropdown menu 1`] = `
                 className="css-rkoh57-MenuItemLabel-MenuItemLabel ebifsjx0"
               >
                 <withOrganizations
-                  canCreateOrganization={true}
+                  canCreateOrganization={false}
                 >
                   <SwitchOrganization
-                    canCreateOrganization={true}
+                    canCreateOrganization={false}
                     organizations={Array []}
                   >
                     <DropdownMenu
diff --git a/tests/js/spec/components/sidebar/index.spec.jsx b/tests/js/spec/components/sidebar/index.spec.jsx
index d32aa354b3..16fe9681ef 100644
--- a/tests/js/spec/components/sidebar/index.spec.jsx
+++ b/tests/js/spec/components/sidebar/index.spec.jsx
@@ -2,6 +2,7 @@ import React from 'react';
 
 import {mount, shallow} from 'enzyme';
 import IncidentStore from 'app/stores/incidentStore';
+import ConfigStore from 'app/stores/configStore';
 import SidebarContainer, {Sidebar} from 'app/components/sidebar';
 
 describe('Sidebar', function() {
@@ -116,6 +117,7 @@ describe('Sidebar', function() {
     });
 
     it('can open "Switch Organization" sub-menu', function() {
+      ConfigStore.set('features', new Set(['organizations:create']));
       jest.useFakeTimers();
       wrapper = createWrapper();
       wrapper.find('SidebarDropdownActor').simulate('click');
