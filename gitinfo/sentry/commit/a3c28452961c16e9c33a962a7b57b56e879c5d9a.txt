commit a3c28452961c16e9c33a962a7b57b56e879c5d9a
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Oct 28 20:33:42 2014 -0700

    Show team counts with organization members

diff --git a/src/sentry/templates/sentry/organization-members.html b/src/sentry/templates/sentry/organization-members.html
index c17d83ddd0..4adcf0ec66 100644
--- a/src/sentry/templates/sentry/organization-members.html
+++ b/src/sentry/templates/sentry/organization-members.html
@@ -26,7 +26,7 @@
                 <col width="20px"/>
             </colgroup>
             <tbody>
-                {% for member in member_list %}
+                {% for member, team_list in member_list %}
                     <tr>
                         <td>
                             <img class="avatar" src="{% gravatar_url member.user.email size 20 %}">
@@ -35,35 +35,16 @@
                             {{ member.user.get_display_name }}
                         </td>
                         <td>
-                            <a href="#">3 teams</a>
-                        </td>
-                        <td>
-                            <a href=""><span class="icon icon-remove"></span></a>
-                        </td>
-                    </tr>
-                    <tr>
-                        <td>
-                            <img class="avatar" src="{% gravatar_url member.user.email size 20 %}">
-                        </td>
-                        <td>
-                            {{ member.user.get_display_name }}
-                        </td>
-                        <td>
-                            &infin;
-                        </td>
-                        <td>
-                            <a href=""><span class="icon icon-remove"></span></a>
-                        </td>
-                    </tr>
-                    <tr>
-                        <td>
-                            <img class="avatar" src="{% gravatar_url member.user.email size 20 %}">
-                        </td>
-                        <td>
-                            {{ member.user.get_display_name }}
-                        </td>
-                        <td>
-                            <a href="#">Backend</a>
+                            {% if member.has_global_access %}
+                                <span class="tip" title="Access to all teams">&infin;</span>
+                            {% elif team_list|length > 1 %}
+                                <span class="tip"
+                                      title="{% for team in team_list %}{{ team.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
+                                    {{ team_list|length }} teams
+                                </span>
+                            {% else %}
+                                {{ team_list.0.name }}
+                            {% endif %}
                         </td>
                         <td>
                             <a href=""><span class="icon icon-remove"></span></a>
diff --git a/src/sentry/web/frontend/organization_members.py b/src/sentry/web/frontend/organization_members.py
index 490ae6fa83..9e275b37af 100644
--- a/src/sentry/web/frontend/organization_members.py
+++ b/src/sentry/web/frontend/organization_members.py
@@ -1,17 +1,35 @@
 from __future__ import absolute_import
 
+from collections import defaultdict
+
 from sentry.models import OrganizationMember, OrganizationMemberType
 from sentry.web.frontend.base import OrganizationView
 
+OrganizationMemberTeams = OrganizationMember.teams.through
+
 
 class OrganizationMembersView(OrganizationView):
     required_access = OrganizationMemberType.ADMIN
 
     def get(self, request, organization):
+        queryset = OrganizationMemberTeams.objects.filter(
+            organizationmember__organization=organization,
+        ).select_related('team')
+
+        team_map = defaultdict(list)
+        for omt in queryset:
+            team_map[omt.organizationmember_id].append(omt.team)
+
+        queryset = OrganizationMember.objects.filter(
+            organization=organization,
+        ).select_related('user')
+
+        member_list = []
+        for om in queryset:
+            member_list.append((om, team_map[om.id]))
+
         context = {
-            'member_list': OrganizationMember.objects.filter(
-                organization=organization
-            ).select_related('user'),
+            'member_list': member_list,
         }
 
         return self.respond('sentry/organization-members.html', context)
