commit 90d11afa4e583b4d2e8b5370bed41cd9790063f7
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Mon May 8 13:29:03 2017 -0700

    fix unicode release versions in pagination fixes SENTRY-39H (#5338)
    
    * fix unicode release versions in pagination fixes SENTRY-39H
    
    * add test for build_cursor_link

diff --git a/src/sentry/api/base.py b/src/sentry/api/base.py
index f4fb2b7074..4ba157d2ae 100644
--- a/src/sentry/api/base.py
+++ b/src/sentry/api/base.py
@@ -66,7 +66,7 @@ class Endpoint(APIView):
             for k, v in six.iteritems(request.GET)
             if k != 'cursor'
         )
-        base_url = absolute_uri(request.path)
+        base_url = absolute_uri(urlquote(request.path))
         if querystring:
             base_url = '{0}?{1}'.format(base_url, querystring)
         else:
diff --git a/tests/sentry/api/bases/test_endpoint.py b/tests/sentry/api/bases/test_endpoint.py
new file mode 100644
index 0000000000..20354e50d9
--- /dev/null
+++ b/tests/sentry/api/bases/test_endpoint.py
@@ -0,0 +1,38 @@
+# -*- coding: utf-8 -*-
+from __future__ import absolute_import
+
+from mock import Mock
+
+from sentry.testutils import TestCase
+
+from sentry.api.base import Endpoint
+
+
+class EndpointTest(TestCase):
+    def test_simple(self):
+        request = Mock()
+        request.GET = {u'member': [u'1']}
+        request.method = 'GET'
+        request.path = '/api/0/organizations/'
+        endpoint = Endpoint()
+        result = endpoint.build_cursor_link(request, 'next', '1492107369532:0:0')
+
+        assert result == (
+            '<http://testserver/api/0/organizations/?'
+            'member=%5Bu%271%27%5D&cursor=1492107369532:0:0>;'
+            ' rel="next"; results="true"; cursor="1492107369532:0:0\"'
+        )
+
+    def test_unicode_path(self):
+        request = Mock()
+        request.GET = {u'member': [u'1']}
+        request.method = 'GET'
+        request.path = '/api/0/organizations/üuuuu/'
+        endpoint = Endpoint()
+        result = endpoint.build_cursor_link(request, 'next', '1492107369532:0:0')
+
+        assert result == (
+            '<http://testserver/api/0/organizations/%C3%BCuuuu/?'
+            'member=%5Bu%271%27%5D&cursor=1492107369532:0:0>;'
+            ' rel="next"; results="true"; cursor="1492107369532:0:0\"'
+        )
diff --git a/tests/sentry/api/endpoints/test_release_deploys.py b/tests/sentry/api/endpoints/test_release_deploys.py
index c5328e26fc..154110fe69 100644
--- a/tests/sentry/api/endpoints/test_release_deploys.py
+++ b/tests/sentry/api/endpoints/test_release_deploys.py
@@ -1,3 +1,5 @@
+# -*- coding: utf-8 -*-
+
 from __future__ import absolute_import
 
 import datetime
@@ -15,7 +17,8 @@ class ReleaseDeploysListTest(APITestCase):
         )
         release = Release.objects.create(
             organization_id=project.organization_id,
-            version='1',
+            # test unicode
+            version='1–0',
         )
         release.add_project(project)
         Deploy.objects.create(
