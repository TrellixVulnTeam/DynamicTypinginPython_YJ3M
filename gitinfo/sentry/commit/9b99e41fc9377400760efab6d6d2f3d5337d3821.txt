commit 9b99e41fc9377400760efab6d6d2f3d5337d3821
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Oct 12 18:16:22 2014 +0100

    Functional assignee selector

diff --git a/src/sentry/static/sentry/app.js b/src/sentry/static/sentry/app.js
index dfa2356b47..a92b1aa6ad 100644
--- a/src/sentry/static/sentry/app.js
+++ b/src/sentry/static/sentry/app.js
@@ -26,6 +26,45 @@ var SentryApp = angular.module('sentry', [
   $httpProvider.defaults.xsrfCookieName = 'csrftoken';
   $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
 
+  function getCookie(name) {
+    var cookieValue = null;
+    if (document.cookie && document.cookie !== '') {
+      var cookies = document.cookie.split(';');
+      for (var i = 0; i < cookies.length; i++) {
+        var cookie = jQuery.trim(cookies[i]);
+        // Does this cookie string begin with the name we want?
+        if (cookie.substring(0, name.length + 1) == (name + '=')) {
+          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
+          break;
+        }
+      }
+    }
+    return cookieValue;
+  }
+
+  function sameOrigin(url) {
+    // url could be relative or scheme relative or absolute
+    var host = document.location.host; // host + port
+    var protocol = document.location.protocol;
+    var sr_origin = '//' + host;
+    var origin = protocol + sr_origin;
+    // Allow absolute or scheme relative URLs to same origin
+    return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
+        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
+        // or any other URL that isn't scheme relative or absolute i.e relative.
+        !(/^(\/\/|http:|https:).*/.test(url));
+  }
+
+  function safeMethod(method) {
+    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
+  }
+
+  jQuery(document).ajaxSend(function(event, xhr, settings) {
+    if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
+      xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
+    }
+  });
+
   $provide.value('config', window.SentryConfig);
   $provide.value('selectedTeam', window.SentryConfig.selectedTeam);
   $provide.value('selectedProject', window.SentryConfig.selectedProject);
diff --git a/src/sentry/static/sentry/app/directives/assigneeSelector.js b/src/sentry/static/sentry/app/directives/assigneeSelector.js
index 73c29089b8..4db2836b4a 100644
--- a/src/sentry/static/sentry/app/directives/assigneeSelector.js
+++ b/src/sentry/static/sentry/app/directives/assigneeSelector.js
@@ -9,7 +9,7 @@
         link: function(scope, element, attrs) {
           scope.group = scope.$eval(attrs.group);
         },
-        controller: ['$scope', 'projectMemberList', function($scope, projectMemberList){
+        controller: ['$scope', '$timeout', 'projectMemberList', function($scope, $timeout, projectMemberList){
           projectMemberList.success(function(data){
             $scope.projectMemberList = data;
           });
@@ -18,11 +18,14 @@
             $.ajax({
               url: '/api/0/groups/' + $scope.group.id + '/',
               method: 'PUT',
-              data: {
-                assignedTo: user.id
-              },
+              data: JSON.stringify({
+                assignedTo: user.email
+              }),
+              contentType: 'application/json',
               success: function(data){
-                scope.group.assignedTo = user;
+                $timeout(function(){
+                  $scope.group.assignedTo = user;
+                });
               }
             });
           };
diff --git a/src/sentry/static/sentry/app/templates/assignee-selector.html b/src/sentry/static/sentry/app/templates/assignee-selector.html
index e599e7066e..87b512c474 100644
--- a/src/sentry/static/sentry/app/templates/assignee-selector.html
+++ b/src/sentry/static/sentry/app/templates/assignee-selector.html
@@ -1,7 +1,7 @@
 <div class="user-selector">
   <div class="btn-group">
     <a href="#" class="btn btn-sm btn-default dropdown-toggle">
-      <span ng-if="group.asignedTo">
+      <span ng-if="group.assignedTo">
         <img src="<% group.assignedTo.avatarUrl %>" class="avatar">
       </span>
       <span aria-hidden="true" class="icon-arrow-down"></span>
@@ -10,7 +10,7 @@
       <input type="text" class="form-control input-sm" placeholder="Filter people">
       <ul>
         <li ng-repeat="projectMember in projectMemberList">
-          <a href="#" ng-click="assignTo(projectMember)"><img src="<% projectMember.avatarUrl %>" class="avatar"> <% projectMember.name || projectMember.email %></a>
+          <a href="javascript:void(0)" ng-click="assignTo(projectMember)"><img src="<% projectMember.avatarUrl %>" class="avatar"> <% projectMember.name || projectMember.email %></a>
         </li>
       </ul>
     </div>
diff --git a/src/sentry/templates/sentry/groups/details.html b/src/sentry/templates/sentry/groups/details.html
index b63f9ee50d..06b37f37ed 100644
--- a/src/sentry/templates/sentry/groups/details.html
+++ b/src/sentry/templates/sentry/groups/details.html
@@ -32,7 +32,7 @@
             <div class="row">
               <div class="col-xs-4 assigned-to">
 
-                  <assignee-selector group="group"></assignee-selector>
+                  <assignee-selector group="selectedGroup"></assignee-selector>
                   <div class="is-assigned"><span class="hidden-sm">is</span> assigned</div>
               </div>
               <div class="col-xs-4 event-count align-right">
