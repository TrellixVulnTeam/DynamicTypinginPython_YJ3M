commit c0e01513efc6e39156d5b456ad8d1b76513ee98f
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 31 18:25:37 2012 -0800

    Force dates to utc when using the |date filter

diff --git a/sentry/templates/sentry/partial/_event.html b/sentry/templates/sentry/partial/_event.html
index 30afc60bab..0870d8af92 100644
--- a/sentry/templates/sentry/partial/_event.html
+++ b/sentry/templates/sentry/partial/_event.html
@@ -10,11 +10,13 @@
                     {{ event.message_top|truncatechars:100 }}
                 {% endif %}
             </a>
-            <span class="last_seen">{{ event.datetime|timesince }}</span>
+        </h3>
+        <div class="meta">
+            <span class="last-seen pretty-date" title="{{ event.datetime|date:"c" }}Z">{{ event.datetime|timesince }}</span>
             {% if event.time_spent %}
-                <span class="time_spent">{{ event.time_spent|duration }}</span>
+                <span class="time-spent">{{ event.time_spent|duration }}</span>
             {% endif %}
-        </h3>
+        </div>
         <p class="message" title="{{ event.message }}">
             <span class="tag tag-logger">{{ event.logger }}</span>
             {% with event.get_version as version %}
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index 2d92b5bc9f..d6aaf802b9 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -23,7 +23,7 @@
             {{ group.error }}
         </p>
         <div class="meta">
-            <span class="last-seen pretty-date" title="{{ group.last_seen|date:"Y-m-dTH:i:s" }}Z">{{ group.last_seen|timesince }}</span>
+            <span class="last-seen pretty-date" title="{{ group.last_seen|date:"c" }}Z">{{ group.last_seen|timesince }}</span>
             {% if group.avg_time_spent %}
                 <span class="time-spent">{{ group.avg_time_spent|duration }}</span>
             {% endif %}
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 6b3ba93216..fe540883c4 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -11,7 +11,7 @@ from paging.helpers import paginate as paginate_func
 from sentry.conf import settings
 from sentry.plugins import plugins
 from sentry.utils import json
-from sentry.utils.dates import utc_to_local
+from sentry.utils.dates import utc_to_local, local_to_utc
 from templatetag_sugar.register import tag
 from templatetag_sugar.parser import Name, Variable, Constant, Optional
 
@@ -322,3 +322,9 @@ def as_bookmarks(group_list, user):
 
     for g in group_list:
         yield g, g.pk in bookmarks
+
+
+@register.filter
+def date(datetime, arg=None):
+    from django.template.defaultfilters import date
+    return date(local_to_utc(datetime), arg)
diff --git a/sentry/utils/dates.py b/sentry/utils/dates.py
index a558b4fd11..c9fd6b640a 100644
--- a/sentry/utils/dates.py
+++ b/sentry/utils/dates.py
@@ -12,6 +12,9 @@ from django.conf import settings
 
 def utc_to_local(dt):
     tz = pytz.timezone(settings.TIME_ZONE)
-    # return datetime(*time.gmtime(time.mktime(dt.timetuple()))[:6])
-    # return dt.replace(tzinfo=pytz.utc)
     return dt.replace(tzinfo=pytz.utc).astimezone(tz).replace(tzinfo=None)
+
+
+def local_to_utc(dt):
+    tz = pytz.timezone(settings.TIME_ZONE)
+    return dt.replace(tzinfo=tz).astimezone(pytz.utc).replace(tzinfo=None)
