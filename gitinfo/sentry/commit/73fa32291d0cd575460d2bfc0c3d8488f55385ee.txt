commit 73fa32291d0cd575460d2bfc0c3d8488f55385ee
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 6 14:40:16 2018 -0700

    Correct BitField query behavior

diff --git a/src/bitfield/query.py b/src/bitfield/query.py
index 35747214df..939232ddbf 100644
--- a/src/bitfield/query.py
+++ b/src/bitfield/query.py
@@ -27,12 +27,10 @@ try:
 
     class BitQueryLookupWrapper(Exact):  # NOQA
         def process_lhs(self, qn, connection, lhs=None):
-            lhs_sql, params = super(BitQueryLookupWrapper, self).process_lhs(qn, connection, lhs)
-            if self.rhs:
-                lhs_sql = lhs_sql + ' & %s'
-            else:
-                lhs_sql = lhs_sql + ' | %s'
-            params.append(self.get_db_prep_lookup(self.rhs, connection)[1])
+            lhs_sql, params = super(BitQueryLookupWrapper, self).process_lhs(
+                qn, connection, lhs)
+            lhs_sql = lhs_sql + ' | %s'
+            params.extend(self.process_rhs(qn, connection)[1])
             return lhs_sql, params
 
         def get_db_prep_lookup(self, value, connection, prepared=False):
@@ -54,16 +52,8 @@ class BitQuerySaveWrapper(BitQueryLookupWrapper):
 
         This will be called by Where.as_sql()
         """
-        engine = connection.settings_dict['ENGINE'].rsplit('.', -1)[-1]
-        if engine.startswith('postgres'):
-            XOR_OPERATOR = '#'
-        elif engine.startswith('sqlite'):
-            raise NotImplementedError
-        else:
-            XOR_OPERATOR = '^'
-
         if self.bit:
             return ("%s.%s | %d" % (qn(self.table_alias), qn(self.column), self.bit.mask), [])
         return (
-            "%s.%s %s %d" % (qn(self.table_alias), qn(self.column), XOR_OPERATOR, self.bit.mask), []
+            "%s.%s & ~%d" % (qn(self.table_alias), qn(self.column), self.bit.mask), []
         )
