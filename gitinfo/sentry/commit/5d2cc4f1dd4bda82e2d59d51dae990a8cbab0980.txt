commit 5d2cc4f1dd4bda82e2d59d51dae990a8cbab0980
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jul 27 11:00:42 2015 -0700

    Add celery app version check

diff --git a/src/sentry/status_checks/__init__.py b/src/sentry/status_checks/__init__.py
index cb6cbbe800..6f70a1bf6f 100644
--- a/src/sentry/status_checks/__init__.py
+++ b/src/sentry/status_checks/__init__.py
@@ -3,10 +3,12 @@ from __future__ import absolute_import
 __all__ = ('check_all', 'Problem', 'StatusCheck')
 
 from .base import Problem, StatusCheck  # NOQA
-from .celery_ping import CeleryPingCheck
+from .celery_alive import CeleryAliveCheck
+from .celery_app_version import CeleryAppVersionCheck
 
 check_classes = [
-    CeleryPingCheck,
+    CeleryAliveCheck,
+    CeleryAppVersionCheck,
 ]
 
 
@@ -15,7 +17,8 @@ def check_all():
     problems = []
     for cls in check_classes:
         problem = cls().check()
-        problems.extend(problem)
+        if problem:
+            problems.extend(problem)
         checks[cls.__name__] = not bool(problem)
 
     return problems, checks
diff --git a/src/sentry/status_checks/celery_ping.py b/src/sentry/status_checks/celery_alive.py
similarity index 92%
rename from src/sentry/status_checks/celery_ping.py
rename to src/sentry/status_checks/celery_alive.py
index 248b4e08b8..a1377d9cb6 100644
--- a/src/sentry/status_checks/celery_ping.py
+++ b/src/sentry/status_checks/celery_alive.py
@@ -7,7 +7,7 @@ from sentry import options
 from .base import StatusCheck, Problem
 
 
-class CeleryPingCheck(StatusCheck):
+class CeleryAliveCheck(StatusCheck):
     def check(self):
         last_ping = options.get('sentry:last_worker_ping') or 0
         if last_ping >= time() - 300:
diff --git a/src/sentry/status_checks/celery_app_version.py b/src/sentry/status_checks/celery_app_version.py
new file mode 100644
index 0000000000..4331de3211
--- /dev/null
+++ b/src/sentry/status_checks/celery_app_version.py
@@ -0,0 +1,22 @@
+from __future__ import absolute_import
+
+import sentry
+
+from sentry import options
+
+from .base import StatusCheck, Problem
+
+
+class CeleryAppVersionCheck(StatusCheck):
+    def check(self):
+        version = options.get('sentry:last_worker_version')
+        if not version:
+            return []
+        if version == sentry.VERSION:
+            return []
+        return [
+            Problem("Celery workers are referencing a different version of Sentry ({version1} vs {version2})".format(
+                version1=sentry.VERSION,
+                version2=version,
+            )),
+        ]
diff --git a/src/sentry/tasks/ping.py b/src/sentry/tasks/ping.py
index 9b4d32efe3..c4ce875cbf 100644
--- a/src/sentry/tasks/ping.py
+++ b/src/sentry/tasks/ping.py
@@ -8,6 +8,8 @@ sentry.tasks.ping
 
 from __future__ import absolute_import, print_function
 
+import sentry
+
 from time import time
 
 from sentry import options
@@ -17,3 +19,4 @@ from sentry.tasks.base import instrumented_task
 @instrumented_task(name='sentry.tasks.send_ping')
 def send_ping():
     options.set('sentry:last_worker_ping', time())
+    options.set('sentry:last_worker_version', sentry.VERSION)
