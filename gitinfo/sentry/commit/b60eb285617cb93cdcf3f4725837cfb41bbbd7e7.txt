commit b60eb285617cb93cdcf3f4725837cfb41bbbd7e7
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Aug 7 13:03:21 2015 -0700

    Dont use locale middleware at all in API

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 2130755657..8211ac8704 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -191,6 +191,7 @@ TEMPLATE_LOADERS = (
 
 MIDDLEWARE_CLASSES = (
     'sentry.middleware.maintenance.ServicesUnavailableMiddleware',
+    'sentry.middleware.env.SentryEnvMiddleware',
     'sentry.middleware.proxy.SetRemoteAddrFromForwardedFor',
     'sentry.middleware.debug.NoIfModifiedSinceMiddleware',
     'django.middleware.common.CommonMiddleware',
@@ -200,7 +201,6 @@ MIDDLEWARE_CLASSES = (
     'sentry.middleware.sudo.SudoMiddleware',
     'sentry.middleware.locale.SentryLocaleMiddleware',
     'sentry.middleware.social_auth.SentrySocialAuthExceptionMiddleware',
-    'django.middleware.locale.LocaleMiddleware',
     'django.contrib.messages.middleware.MessageMiddleware',
 )
 
diff --git a/src/sentry/middleware/env.py b/src/sentry/middleware/env.py
new file mode 100644
index 0000000000..adf06ef805
--- /dev/null
+++ b/src/sentry/middleware/env.py
@@ -0,0 +1,16 @@
+from __future__ import absolute_import
+
+from django.conf import settings
+from django.core.urlresolvers import reverse
+
+from sentry.app import env
+
+
+class SentryEnvMiddleware(object):
+    def process_request(self, request):
+        # HACK: bootstrap some env crud if we haven't yet
+        if not settings.SENTRY_URL_PREFIX:
+            settings.SENTRY_URL_PREFIX = request.build_absolute_uri(reverse('sentry')).strip('/')
+
+        # bind request to env
+        env.request = request
diff --git a/src/sentry/middleware/locale.py b/src/sentry/middleware/locale.py
index af8b55a6a9..44679ee9fa 100644
--- a/src/sentry/middleware/locale.py
+++ b/src/sentry/middleware/locale.py
@@ -12,33 +12,28 @@ import pytz
 
 from django.conf import settings
 from django.core.urlresolvers import reverse
+from django.middleware.locale import LocaleMiddleware
 
-from sentry.app import env
 from sentry.models import UserOption
 from sentry.utils.safe import safe_execute
 
 
-class SentryLocaleMiddleware(object):
+class SentryLocaleMiddleware(LocaleMiddleware):
     def process_request(self, request):
-        # HACK: bootstrap some env crud if we haven't yet
-        if not settings.SENTRY_URL_PREFIX:
-            settings.SENTRY_URL_PREFIX = request.build_absolute_uri(reverse('sentry')).strip('/')
+        if settings.MAINTENANCE:
+            return
 
-        # bind request to env
-        env.request = request
+        if request.path.startswith(reverse('sentry-api-catchall')):
+            return
 
         safe_execute(self.load_user_conf, request)
 
-    def load_user_conf(self, request):
-        if settings.MAINTENANCE:
-            return
+        super(SentryLocaleMiddleware, self).process_request(request)
 
+    def load_user_conf(self, request):
         if not request.user.is_authenticated():
             return
 
-        if request.path.startswith(reverse('sentry-api-catchall')):
-            return
-
         language = UserOption.objects.get_value(
             user=request.user, project=None, key='language', default=None)
         if language:
