commit af63b4f57b1ecc9d2fb6a962b04801d0dfb26a8d
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Jan 29 16:20:44 2016 -0800

    Default ConnectionManager max_retries to match number of hosts

diff --git a/src/sentry/nodestore/riak/client.py b/src/sentry/nodestore/riak/client.py
index 162ba6bd50..b81eebb98c 100644
--- a/src/sentry/nodestore/riak/client.py
+++ b/src/sentry/nodestore/riak/client.py
@@ -140,15 +140,20 @@ class ConnectionManager(object):
     A thread-safe multi-host http connection manager.
     """
     def __init__(self, hosts=DEFAULT_NODES, strategy=RoundRobinStrategy, randomize=True,
-                 timeout=3, cooldown=5, max_retries=3, tcp_keepalive=True):
+                 timeout=3, cooldown=5, max_retries=None, tcp_keepalive=True):
         assert hosts
         self.strategy = strategy()
         self.dead_connections = []
         self.timeout = timeout
         self.cooldown = cooldown
-        self.max_retries = max_retries
         self.tcp_keepalive = tcp_keepalive
 
+        # Default max_retries to number of hosts
+        if max_retries is None:
+            self.max_retries = len(hosts)
+        else:
+            self.max_retries = max_retries
+
         self.connections = map(self.create_pool, hosts)
         # Shuffle up the order to prevent stampeding the same hosts
         if randomize:
