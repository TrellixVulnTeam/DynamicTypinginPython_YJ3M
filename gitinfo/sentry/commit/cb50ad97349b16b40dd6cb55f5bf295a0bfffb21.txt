commit cb50ad97349b16b40dd6cb55f5bf295a0bfffb21
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jan 21 15:31:23 2015 -0800

    Improved rollups
    
    - Correct hourly rollup to *actually* only store 7 days worth
    - Allow configuration via SENTRY_TSDB_ROLLUPS

diff --git a/src/sentry/api/base.py b/src/sentry/api/base.py
index dc5abcd531..9f93a13db3 100644
--- a/src/sentry/api/base.py
+++ b/src/sentry/api/base.py
@@ -10,7 +10,7 @@ from rest_framework.renderers import JSONRenderer
 from rest_framework.response import Response
 from rest_framework.views import APIView
 
-from sentry.tsdb.base import ROLLUPS
+from sentry.app import tsdb
 from sentry.utils.cursors import Cursor
 
 from .authentication import KeyAuthentication
@@ -89,7 +89,7 @@ class BaseStatsEndpoint(Endpoint):
         if resolution:
             resolution = self._parse_resolution(resolution)
 
-            assert any(r for r in ROLLUPS if r[0] == resolution)
+            assert any(r for r in tsdb.rollups if r[0] == resolution)
 
         end = request.GET.get('until')
         if end:
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index f3276e1ef9..b2d11450da 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -581,6 +581,14 @@ SENTRY_SEARCH_OPTIONS = {}
 SENTRY_TSDB = 'sentry.tsdb.dummy.DummyTSDB'
 SENTRY_TSDB_OPTIONS = {}
 
+# rollups must be ordered from highest granularity to lowest
+SENTRY_TSDB_ROLLUPS = (
+    # (time in seconds, samples to keep)
+    (10, 30),  # 5 minute at 10 seconds
+    (3600, 24 * 7),  # 7 days at 1 hour
+)
+
+
 # File storage
 SENTRY_FILESTORE = 'django.core.files.storage.FileSystemStorage'
 SENTRY_FILESTORE_OPTIONS = {'location': '/tmp/sentry-files'}
diff --git a/src/sentry/tsdb/base.py b/src/sentry/tsdb/base.py
index f096c7ac3a..ad9fd6a71d 100644
--- a/src/sentry/tsdb/base.py
+++ b/src/sentry/tsdb/base.py
@@ -7,6 +7,7 @@ sentry.tsdb.base
 """
 from __future__ import absolute_import
 
+from django.conf import settings
 from enum import Enum
 
 ONE_MINUTE = 60
@@ -14,14 +15,6 @@ ONE_HOUR = ONE_MINUTE * 60
 ONE_DAY = ONE_HOUR * 24
 
 
-# rollups must be ordered from highest granularity to lowest
-ROLLUPS = (
-    # (time in seconds, samples to keep)
-    (10, 30),  # 5 minute at 10 seconds
-    (ONE_HOUR, ONE_DAY * 7),  # 7 days at 1 hour
-)
-
-
 class TSDBModel(Enum):
     # number of events seen specific to grouping
     project = 1
@@ -45,7 +38,7 @@ class TSDBModel(Enum):
 class BaseTSDB(object):
     models = TSDBModel
 
-    def __init__(self, rollups=ROLLUPS):
+    def __init__(self, rollups=settings.SENTRY_TSDB_ROLLUPS):
         self.rollups = rollups
 
     def normalize_to_epoch(self, timestamp, seconds):
