commit a824f9d7952a30077492b20f01c301d405bd7293
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Mar 2 12:45:10 2012 -0800

    Correct how resolved is used within cleanup (fixes GH-370)

diff --git a/sentry/tasks/cleanup.py b/sentry/tasks/cleanup.py
index d7479e81e7..61610f9b6b 100644
--- a/sentry/tasks/cleanup.py
+++ b/sentry/tasks/cleanup.py
@@ -63,6 +63,10 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None,
         qs = qs.filter(level__gte=level)
     if project:
         qs = qs.filter(project=project)
+    if resolved is True:
+        qs = qs.filter(group__status=1)
+    elif resolved is False:
+        qs = qs.filter(group__status=0)
 
     groups_to_check = set()
     if resolved is None:
@@ -81,9 +85,9 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None,
         if project:
             qs = qs.filter(project=project)
         if resolved is True:
-            qs = qs.filter(status=1)
+            qs = qs.filter(group__status=1)
         elif resolved is False:
-            qs = qs.filter(status=0)
+            qs = qs.filter(group__status=0)
 
         for obj in RangeQuerySetWrapper(qs):
             print ">>> Removing <%s: id=%s>" % (obj.__class__.__name__, obj.pk)
@@ -97,10 +101,15 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None,
             qs = qs.filter(level__gte=level)
         if project:
             qs = qs.filter(project=project)
+        if resolved is True:
+            qs = qs.filter(status=1)
+        elif resolved is False:
+            qs = qs.filter(status=0)
 
         cleanup_groups(RangeQuerySetWrapper(qs))
 
     # Project counts
+    # TODO: these dont handle filters
     qs = SkinnyQuerySet(ProjectCountByMinute).filter(date__lte=ts)
     if project:
         qs = qs.filter(project=project)
