commit 825a1f16d7accaf1614a03b1d3d264e38ebbdb33
Author: Chris Clark <christopherchristopherclark@gmail.com>
Date:   Thu Mar 7 11:19:44 2019 -0800

    feat(stream): add project icons (#12209)
    
    * add project to issue list
    
    * fix alignment bug
    
    * move it over by assignee since it makes the most sense over there
    
    * add it to the header with a link
    
    * tooltips
    
    * better media query widths
    
    * use local variable instance of window.location
    
    * better better media queries
    
    * add avatar to shortId
    
    * prevent warnings
    
    * move avatar to eventOrGroupExtraDetails
    
    * check for project
    
    * revert layout changes now that there isn't a new column
    
    * 20 instead of 22
    
    * cx -> classNames

diff --git a/src/sentry/static/sentry/app/components/autoSelectText.jsx b/src/sentry/static/sentry/app/components/autoSelectText.jsx
index 93351ee8c6..e3f9a6b9dd 100644
--- a/src/sentry/static/sentry/app/components/autoSelectText.jsx
+++ b/src/sentry/static/sentry/app/components/autoSelectText.jsx
@@ -1,5 +1,6 @@
 import React from 'react';
 import PropTypes from 'prop-types';
+import classNames from 'classnames';
 
 import {selectText} from 'app/utils/selectText';
 
@@ -27,7 +28,7 @@ class AutoSelectText extends React.Component {
   };
 
   render() {
-    const {children, ...props} = this.props;
+    const {children, className, ...props} = this.props;
 
     if (typeof children === 'function') {
       return children({
@@ -41,7 +42,11 @@ class AutoSelectText extends React.Component {
     // div (including the div itself) which causes newlines to be selected
     // in chrome.
     return (
-      <div {...props} onClick={this.selectText} className="auto-select-text">
+      <div
+        {...props}
+        onClick={this.selectText}
+        className={classNames('auto-select-text', className)}
+      >
         <span ref={this.handleMount}>{children}</span>
       </div>
     );
diff --git a/src/sentry/static/sentry/app/components/eventOrGroupExtraDetails.jsx b/src/sentry/static/sentry/app/components/eventOrGroupExtraDetails.jsx
index 587fc06377..831c4dadae 100644
--- a/src/sentry/static/sentry/app/components/eventOrGroupExtraDetails.jsx
+++ b/src/sentry/static/sentry/app/components/eventOrGroupExtraDetails.jsx
@@ -9,6 +9,8 @@ import ShortId from 'app/components/shortId';
 import overflowEllipsis from 'app/styles/overflowEllipsis';
 import {t, tct} from 'app/locale';
 import InlineSvg from 'app/components/inlineSvg';
+import ProjectBadge from 'app/components/idBadge/projectBadge';
+import SentryTypes from 'app/sentryTypes';
 import space from 'app/styles/space';
 
 class EventOrGroupExtraDetails extends React.Component {
@@ -27,6 +29,7 @@ class EventOrGroupExtraDetails extends React.Component {
     }),
     showAssignee: PropTypes.bool,
     shortId: PropTypes.string,
+    project: SentryTypes.Project,
   };
 
   getIssuesPath() {
@@ -49,13 +52,23 @@ class EventOrGroupExtraDetails extends React.Component {
       annotations,
       showAssignee,
       shortId,
+      project,
     } = this.props;
 
     const issuesPath = this.getIssuesPath();
 
     return (
       <GroupExtra align="center">
-        {shortId && <GroupShortId shortId={shortId} />}
+        {shortId && (
+          <GroupShortId
+            shortId={shortId}
+            avatar={
+              project && (
+                <ProjectBadge project={project} avatarSize={14} hideName={true} />
+              )
+            }
+          />
+        )}
         <Times>
           <div css={overflowEllipsis}>
             {lastSeen && (
diff --git a/src/sentry/static/sentry/app/components/idBadge/baseBadge.jsx b/src/sentry/static/sentry/app/components/idBadge/baseBadge.jsx
index 8a08992859..9c3a073bf8 100644
--- a/src/sentry/static/sentry/app/components/idBadge/baseBadge.jsx
+++ b/src/sentry/static/sentry/app/components/idBadge/baseBadge.jsx
@@ -73,6 +73,7 @@ class BaseBadge extends React.PureComponent {
           <StyledAvatar
             css={avatarClassName}
             size={avatarSize}
+            hideName={hideName}
             {...avatarProps || {}}
             {...data}
           />
@@ -92,7 +93,7 @@ class BaseBadge extends React.PureComponent {
 export default BaseBadge;
 
 const StyledAvatar = styled(Avatar)`
-  margin-right: ${space(1)};
+  margin-right: ${p => (p.hideName ? 0 : space(1))};
   flex-shrink: 0;
 `;
 
diff --git a/src/sentry/static/sentry/app/components/platformList.jsx b/src/sentry/static/sentry/app/components/platformList.jsx
index 03d7d293d9..68b6c88056 100644
--- a/src/sentry/static/sentry/app/components/platformList.jsx
+++ b/src/sentry/static/sentry/app/components/platformList.jsx
@@ -3,7 +3,6 @@ import PropTypes from 'prop-types';
 import styled from 'react-emotion';
 
 import Platformicon from 'app/components/platformicon';
-import space from '../styles/space';
 
 class PlatformList extends React.Component {
   static propTypes = {
@@ -45,7 +44,7 @@ class PlatformList extends React.Component {
   };
 
   render() {
-    const {platforms, max, size, direction, consistentWidth} = this.props;
+    const {platforms, max, size, direction, consistentWidth, className} = this.props;
     const platformsPreview = platforms.slice(0, max);
     return (
       <PlatformIcons
@@ -53,6 +52,7 @@ class PlatformList extends React.Component {
         max={max}
         size={size}
         consistentWidth={consistentWidth}
+        className={className}
       >
         {platforms.length > 0 ? (
           this.getIcons(platformsPreview)
@@ -67,7 +67,6 @@ class PlatformList extends React.Component {
 const getOverlapWidth = size => Math.round(size / 4);
 
 const PlatformIcons = styled('div')`
-  margin-right: ${space(0.5)};
   display: flex;
   flex-shrink: 0;
   flex-direction: row;
diff --git a/src/sentry/static/sentry/app/components/shortId.jsx b/src/sentry/static/sentry/app/components/shortId.jsx
index f43364b670..c5a70cc8eb 100644
--- a/src/sentry/static/sentry/app/components/shortId.jsx
+++ b/src/sentry/static/sentry/app/components/shortId.jsx
@@ -1,12 +1,14 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 import styled from 'react-emotion';
+import isPropValid from '@emotion/is-prop-valid';
 
 import AutoSelectText from 'app/components/autoSelectText';
 
 export default class ShortId extends React.Component {
   static propTypes = {
     shortId: PropTypes.string,
+    avatar: PropTypes.node,
   };
   preventPropagation(e) {
     // this is a hack for the stream so the click handler doesn't
@@ -15,13 +17,16 @@ export default class ShortId extends React.Component {
   }
 
   render() {
-    const shortId = this.props.shortId;
+    const {shortId, avatar} = this.props;
+
     if (!shortId) {
       return null;
     }
+
     return (
       <StyledShortId onClick={this.preventPropagation} {...this.props}>
-        <AutoSelectText>{shortId}</AutoSelectText>
+        {avatar}
+        <StyledAutoSelectText avatar={!!avatar}>{shortId}</StyledAutoSelectText>
       </StyledShortId>
     );
   }
@@ -29,4 +34,10 @@ export default class ShortId extends React.Component {
 
 const StyledShortId = styled.div`
   font-family: ${p => p.theme.text.familyMono};
+  display: inline-flex;
+  align-items: center;
+`;
+
+const StyledAutoSelectText = styled(AutoSelectText, {shouldForwardProp: isPropValid})`
+  margin-left: ${p => p.avatar && '0.5em'};
 `;
diff --git a/src/sentry/static/sentry/app/views/groupDetails/shared/header.jsx b/src/sentry/static/sentry/app/views/groupDetails/shared/header.jsx
index 40ccac2482..30a1857c6d 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/shared/header.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/shared/header.jsx
@@ -13,6 +13,7 @@ import ShortId from 'app/components/shortId';
 import EventOrGroupTitle from 'app/components/eventOrGroupTitle';
 import GuideAnchor from 'app/components/assistant/guideAnchor';
 import OrganizationState from 'app/mixins/organizationState';
+import ProjectBadge from 'app/components/idBadge/projectBadge';
 import Tooltip from 'app/components/tooltip';
 import {t} from 'app/locale';
 import SentryTypes from 'app/sentryTypes';
@@ -106,8 +107,9 @@ const GroupHeader = createReactClass({
     }
 
     const {memberList} = this.state;
+    const {organization, location} = this.context;
     const groupId = group.id;
-    const orgId = this.context.organization.slug;
+    const orgId = organization.slug;
     const message = this.getMessage();
 
     const hasSimilarView = projectFeatures.has('similarity-view');
@@ -169,7 +171,12 @@ const GroupHeader = createReactClass({
                       </a>
                     </Tooltip>
                   </h6>
-                  <ShortId shortId={group.shortId} />
+                  <ShortId
+                    shortId={group.shortId}
+                    avatar={
+                      <ProjectBadge project={project} avatarSize={20} hideName={true} />
+                    }
+                  />
                 </div>
               )}
               <div className="count align-right m-l-1">
@@ -202,7 +209,7 @@ const GroupHeader = createReactClass({
             to={`${baseUrl}${groupId}/`}
             isActive={() => {
               const rootGroupPath = `${baseUrl}${groupId}/`;
-              const pathname = this.context.location.pathname;
+              const pathname = location.pathname;
 
               // Because react-router 1.0 removes router.isActive(route)
               return pathname === rootGroupPath || /events\/\w+\/$/.test(pathname);
diff --git a/tests/js/mocks/issues.js b/tests/js/mocks/issues.js
index 27e0a176d3..ccbb092782 100644
--- a/tests/js/mocks/issues.js
+++ b/tests/js/mocks/issues.js
@@ -23,7 +23,7 @@ export default [
     level: 'error',
     isSubscribed: true,
     isBookmarked: false,
-    project: {name: 'Internal', slug: 'project-slug'},
+    project: {name: 'Internal', slug: 'project-slug', id: '123'},
     statusDetails: {},
   },
   {
@@ -50,7 +50,7 @@ export default [
     level: 'error',
     isSubscribed: true,
     isBookmarked: false,
-    project: {name: 'Internal', slug: 'project-slug'},
+    project: {name: 'Internal', slug: 'project-slug', id: '123'},
     statusDetails: {},
   },
   {
@@ -80,7 +80,7 @@ export default [
     level: 'error',
     isSubscribed: true,
     isBookmarked: false,
-    project: {name: 'Internal', slug: 'project-slug'},
+    project: {name: 'Internal', slug: 'project-slug', id: '123'},
     statusDetails: {},
   },
   {
@@ -123,7 +123,7 @@ export default [
     level: 'error',
     isSubscribed: true,
     isBookmarked: false,
-    project: {name: 'Internal', slug: 'project-slug'},
+    project: {name: 'Internal', slug: 'project-slug', id: '123'},
     statusDetails: {},
   },
 ];
diff --git a/tests/js/spec/views/groupDetails/__snapshots__/groupSimilar.spec.jsx.snap b/tests/js/spec/views/groupDetails/__snapshots__/groupSimilar.spec.jsx.snap
index ef0552968a..ca1156931d 100644
--- a/tests/js/spec/views/groupDetails/__snapshots__/groupSimilar.spec.jsx.snap
+++ b/tests/js/spec/views/groupDetails/__snapshots__/groupSimilar.spec.jsx.snap
@@ -83,6 +83,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
               "numComments": 0,
               "permalink": "http://localhost:8000/sentry/project-slug/issues/274/",
               "project": Object {
+                "id": "123",
                 "name": "Internal",
                 "slug": "project-slug",
               },
@@ -133,6 +134,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
               "numComments": 0,
               "permalink": "http://localhost:8000/sentry/project-slug/issues/275/",
               "project": Object {
+                "id": "123",
                 "name": "Internal",
                 "slug": "project-slug",
               },
@@ -207,6 +209,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
               "numComments": 0,
               "permalink": "http://localhost:8000/sentry/project-slug/issues/216/",
               "project": Object {
+                "id": "123",
                 "name": "Internal",
                 "slug": "project-slug",
               },
@@ -269,6 +272,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
               "numComments": 0,
               "permalink": "http://localhost:8000/sentry/project-slug/issues/271/",
               "project": Object {
+                "id": "123",
                 "name": "Internal",
                 "slug": "project-slug",
               },
@@ -586,6 +590,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                 "numComments": 0,
                 "permalink": "http://localhost:8000/sentry/project-slug/issues/271/",
                 "project": Object {
+                  "id": "123",
                   "name": "Internal",
                   "slug": "project-slug",
                 },
@@ -690,6 +695,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                                 "numComments": 0,
                                 "permalink": "http://localhost:8000/sentry/project-slug/issues/271/",
                                 "project": Object {
+                                  "id": "123",
                                   "name": "Internal",
                                   "slug": "project-slug",
                                 },
@@ -727,6 +733,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                                   "numComments": 0,
                                   "permalink": "http://localhost:8000/sentry/project-slug/issues/271/",
                                   "project": Object {
+                                    "id": "123",
                                     "name": "Internal",
                                     "slug": "project-slug",
                                   },
@@ -903,6 +910,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                                                 "numComments": 0,
                                                 "permalink": "http://localhost:8000/sentry/project-slug/issues/271/",
                                                 "project": Object {
+                                                  "id": "123",
                                                   "name": "Internal",
                                                   "slug": "project-slug",
                                                 },
@@ -1068,6 +1076,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                             permalink="http://localhost:8000/sentry/project-slug/issues/271/"
                             project={
                               Object {
+                                "id": "123",
                                 "name": "Internal",
                                 "slug": "project-slug",
                               }
@@ -1118,6 +1127,7 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                               permalink="http://localhost:8000/sentry/project-slug/issues/271/"
                               project={
                                 Object {
+                                  "id": "123",
                                   "name": "Internal",
                                   "slug": "project-slug",
                                 }
@@ -1214,31 +1224,238 @@ exports[`Issues Similar View renders with mocked data 1`] = `
                                     is={null}
                                   >
                                     <GroupShortId
+                                      avatar={
+                                        <ProjectBadge
+                                          avatarSize={14}
+                                          hideAvatar={false}
+                                          hideName={true}
+                                          hideOverflow={true}
+                                          project={
+                                            Object {
+                                              "id": "123",
+                                              "name": "Internal",
+                                              "slug": "project-slug",
+                                            }
+                                          }
+                                        />
+                                      }
                                       shortId="INTERNAL-4G"
                                     >
                                       <ShortId
+                                        avatar={
+                                          <ProjectBadge
+                                            avatarSize={14}
+                                            hideAvatar={false}
+                                            hideName={true}
+                                            hideOverflow={true}
+                                            project={
+                                              Object {
+                                                "id": "123",
+                                                "name": "Internal",
+                                                "slug": "project-slug",
+                                              }
+                                            }
+                                          />
+                                        }
                                         className="css-yd3bt1-GroupShortId eec9orn4"
                                         shortId="INTERNAL-4G"
                                       >
                                         <StyledShortId
+                                          avatar={
+                                            <ProjectBadge
+                                              avatarSize={14}
+                                              hideAvatar={false}
+                                              hideName={true}
+                                              hideOverflow={true}
+                                              project={
+                                                Object {
+                                                  "id": "123",
+                                                  "name": "Internal",
+                                                  "slug": "project-slug",
+                                                }
+                                              }
+                                            />
+                                          }
                                           className="css-yd3bt1-GroupShortId eec9orn4"
                                           onClick={[Function]}
                                           shortId="INTERNAL-4G"
                                         >
                                           <div
-                                            className="eec9orn4 css-77itmv-StyledShortId-GroupShortId ebuncw00"
+                                            className="eec9orn4 css-zds1k7-StyledShortId-GroupShortId ebuncw00"
                                             onClick={[Function]}
                                           >
-                                            <AutoSelectText>
-                                              <div
-                                                className="auto-select-text"
-                                                onClick={[Function]}
+                                            <ProjectBadge
+                                              avatarSize={14}
+                                              hideAvatar={false}
+                                              hideName={true}
+                                              hideOverflow={true}
+                                              project={
+                                                Object {
+                                                  "id": "123",
+                                                  "name": "Internal",
+                                                  "slug": "project-slug",
+                                                }
+                                              }
+                                            >
+                                              <BaseBadge
+                                                avatarProps={Object {}}
+                                                avatarSize={14}
+                                                displayName={
+                                                  <BadgeDisplayName
+                                                    hideOverflow={true}
+                                                  >
+                                                    project-slug
+                                                  </BadgeDisplayName>
+                                                }
+                                                hideAvatar={false}
+                                                hideName={true}
+                                                project={
+                                                  Object {
+                                                    "id": "123",
+                                                    "name": "Internal",
+                                                    "slug": "project-slug",
+                                                  }
+                                                }
                                               >
-                                                <span>
-                                                  INTERNAL-4G
-                                                </span>
-                                              </div>
-                                            </AutoSelectText>
+                                                <Flex
+                                                  align="center"
+                                                >
+                                                  <Base
+                                                    align="center"
+                                                    className="css-5ipae5"
+                                                  >
+                                                    <div
+                                                      className="css-5ipae5"
+                                                      is={null}
+                                                    >
+                                                      <StyledAvatar
+                                                        className="css-0"
+                                                        hideName={true}
+                                                        project={
+                                                          Object {
+                                                            "id": "123",
+                                                            "name": "Internal",
+                                                            "slug": "project-slug",
+                                                          }
+                                                        }
+                                                        size={14}
+                                                      >
+                                                        <Avatar
+                                                          className="css-f5iyic-StyledAvatar e165dl3i0"
+                                                          hasTooltip={false}
+                                                          hideName={true}
+                                                          project={
+                                                            Object {
+                                                              "id": "123",
+                                                              "name": "Internal",
+                                                              "slug": "project-slug",
+                                                            }
+                                                          }
+                                                          size={14}
+                                                        >
+                                                          <ProjectAvatar
+                                                            className="css-f5iyic-StyledAvatar e165dl3i0"
+                                                            hasTooltip={false}
+                                                            hideName={true}
+                                                            project={
+                                                              Object {
+                                                                "id": "123",
+                                                                "name": "Internal",
+                                                                "slug": "project-slug",
+                                                              }
+                                                            }
+                                                            size={14}
+                                                          >
+                                                            <PlatformList
+                                                              className="css-f5iyic-StyledAvatar e165dl3i0"
+                                                              consistentWidth={false}
+                                                              direction="right"
+                                                              hasTooltip={false}
+                                                              hideName={true}
+                                                              max={1}
+                                                              platforms={Array []}
+                                                              size={14}
+                                                            >
+                                                              <PlatformIcons
+                                                                className="css-f5iyic-StyledAvatar e165dl3i0"
+                                                                consistentWidth={false}
+                                                                direction="right"
+                                                                max={1}
+                                                                size={14}
+                                                              >
+                                                                <div
+                                                                  className="e165dl3i0 css-7hp7lr-PlatformIcons-StyledAvatar ezvce7z0"
+                                                                  direction="right"
+                                                                  max={1}
+                                                                  size={14}
+                                                                >
+                                                                  <StyledPlatformIcon
+                                                                    platform="default"
+                                                                    size={14}
+                                                                  >
+                                                                    <Component
+                                                                      className="css-15yyc0n-StyledPlatformIcon ezvce7z1"
+                                                                      platform="default"
+                                                                      size={14}
+                                                                    >
+                                                                      <Platformicon
+                                                                        className="css-15yyc0n-StyledPlatformIcon ezvce7z1"
+                                                                        platform="default"
+                                                                        size="14px"
+                                                                      >
+                                                                        <img
+                                                                          className="css-15yyc0n-StyledPlatformIcon ezvce7z1"
+                                                                          height="14px"
+                                                                          src={
+                                                                            Object {
+                                                                              "default": Object {
+                                                                                "id": "test",
+                                                                                "viewBox": Object {},
+                                                                              },
+                                                                            }
+                                                                          }
+                                                                          width="14px"
+                                                                        />
+                                                                      </Platformicon>
+                                                                    </Component>
+                                                                  </StyledPlatformIcon>
+                                                                </div>
+                                                              </PlatformIcons>
+                                                            </PlatformList>
+                                                          </ProjectAvatar>
+                                                        </Avatar>
+                                                      </StyledAvatar>
+                                                      <DisplayNameAndDescription>
+                                                        <Base
+                                                          className="css-1h9j57p-DisplayNameAndDescription e165dl3i1"
+                                                        >
+                                                          <div
+                                                            className="css-1h9j57p-DisplayNameAndDescription e165dl3i1"
+                                                            is={null}
+                                                          />
+                                                        </Base>
+                                                      </DisplayNameAndDescription>
+                                                    </div>
+                                                  </Base>
+                                                </Flex>
+                                              </BaseBadge>
+                                            </ProjectBadge>
+                                            <StyledAutoSelectText
+                                              avatar={true}
+                                            >
+                                              <AutoSelectText
+                                                className="css-1iocdui-StyledAutoSelectText ebuncw01"
+                                              >
+                                                <div
+                                                  className="auto-select-text css-1iocdui-StyledAutoSelectText ebuncw01"
+                                                  onClick={[Function]}
+                                                >
+                                                  <span>
+                                                    INTERNAL-4G
+                                                  </span>
+                                                </div>
+                                              </AutoSelectText>
+                                            </StyledAutoSelectText>
                                           </div>
                                         </StyledShortId>
                                       </ShortId>
diff --git a/tests/js/spec/views/organizationProjectsDashboard/__snapshots__/projectCard.spec.jsx.snap b/tests/js/spec/views/organizationProjectsDashboard/__snapshots__/projectCard.spec.jsx.snap
index da24971d65..27fbca41c7 100644
--- a/tests/js/spec/views/organizationProjectsDashboard/__snapshots__/projectCard.spec.jsx.snap
+++ b/tests/js/spec/views/organizationProjectsDashboard/__snapshots__/projectCard.spec.jsx.snap
@@ -341,13 +341,14 @@ exports[`ProjectCard renders 1`] = `
                                           size={24}
                                         >
                                           <PlatformIcons
+                                            className="css-robds0-StyledAvatar e165dl3i0"
                                             consistentWidth={false}
                                             direction="right"
                                             max={1}
                                             size={24}
                                           >
                                             <div
-                                              className="css-12u7e6y-PlatformIcons ezvce7z0"
+                                              className="e165dl3i0 css-1cou1l3-PlatformIcons-StyledAvatar ezvce7z0"
                                               direction="right"
                                               max={1}
                                               size={24}
