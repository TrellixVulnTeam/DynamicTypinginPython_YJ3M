commit 5fcb4dbc3f2afd90a69fb920479c5939c2365a99
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 29 17:55:53 2010 -0800

    Automatically collapse lists with > 6 elements into a select widget

diff --git a/sentry/filters/__init__.py b/sentry/filters/__init__.py
index 96a67d4647..400251e69e 100644
--- a/sentry/filters/__init__.py
+++ b/sentry/filters/__init__.py
@@ -26,8 +26,8 @@ class ChoiceWidget(Widget):
         query_string = self.get_query_string()
         column = self.filter.get_query_param()
 
-        output = ['<ul class="%s-list filter-list sidebar-module">' % (self.filter.column,)]
-        output.append('<li%(active)s><a href="%(query_string)s&amp;%(column)s">Any %(label)s</a></li>' % dict(
+        output = ['<ul class="%s-list filter-list sidebar-module" rel="%s">' % (self.filter.column, column)]
+        output.append('<li%(active)s><a href="%(query_string)s">Any %(label)s</a></li>' % dict(
             active=not value and ' class="active"' or '',
             query_string=query_string,
             label=self.filter.label,
@@ -35,7 +35,7 @@ class ChoiceWidget(Widget):
         ))
         for key, val in choices.iteritems():
             key = unicode(key)
-            output.append('<li%(active)s><a href="%(query_string)s&amp;%(column)s=%(key)s">%(value)s</a></li>' % dict(
+            output.append('<li%(active)s rel="%(key)s"><a href="%(query_string)s&amp;%(column)s=%(key)s">%(value)s</a></li>' % dict(
                 active=value == key and ' class="active"' or '',
                 column=column,
                 key=key,
diff --git a/sentry/media/scripts/global.js b/sentry/media/scripts/global.js
index 1dd7373106..6e14cdeb12 100644
--- a/sentry/media/scripts/global.js
+++ b/sentry/media/scripts/global.js
@@ -149,4 +149,24 @@ $(document).ready(function(){
             sentryRealtime = false;
         }
     });
+    $('#sidebar .filter-list').each(function(_, el){
+        var el = $(el);
+        if (el.find('li').length > 6) {
+            // rebuild this widget as a dropdown select
+            var select = $('<select></select>');
+            var parent = $('<div class="filter-select sidebar-module">').appendTo(el.parent());
+
+            el.find('li a').each(function(_, a){
+                a = $(a);
+                var opt = $('<option value="' + a.attr('href') + '">' + a.text() + '</option>').appendTo(select);
+                if (a.parent().hasClass('active')) {
+                    opt.attr('selected', 'selected');
+                }
+            });
+            el.remove();
+            select.appendTo(parent).change(function(){
+                window.location.href = $(this).val();
+            });
+       }
+    });
 });
\ No newline at end of file
diff --git a/sentry/media/styles/global.css b/sentry/media/styles/global.css
index 9725114f48..c8242eb2e1 100644
--- a/sentry/media/styles/global.css
+++ b/sentry/media/styles/global.css
@@ -210,6 +210,12 @@ pre.exception_value { font-family: sans-serif; color: #666; font-size: 1.5em; ma
 .server-list li, .url-list li { padding-bottom: 10px; }
 .url-list li a { line-height: 18px; }
 .filter-list { margin-left: 0; text-transform: lowercase; }
+.filter-select {
+    padding: 10px;
+}
+.filter-select select {
+    width: 100%;
+}
 .filter-list li a {
     display: block; padding: 10px; text-decoration: none;
     border-bottom: 1px solid rgba(0,0,0, .05);
