commit 3c25dbb74e3037ce6345b9033a4addab0f7b871e
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Dec 15 02:11:21 2012 -0800

    Improved display of stacktraces
    
    http://dl.dropbox.com/u/116385/Slingshot/Pictures/Screen%20Shot%202012-12-15%20at%202.11.09%20AM.png

diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 14ea1f95f6..3ca6e0e629 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -785,11 +785,90 @@ td .clippy {
 
 // Code styles
 
+.frame {
+  padding: 5px;
+  border: 1px solid #fff;
+  margin: -6px -6px 0 -6px;
+
+  &.system-frame {
+    color: #999;
+  }
+
+  code {
+    color: inherit;
+  }
+
+  div.commands {
+    position: absolute;
+    right: 10px;
+    top: 6px;
+    font-size: 0.9em;
+    a {
+      color: #666;
+      text-decoration: none;
+      span {
+        font-size: 9px;
+        margin-right: 5px;
+      }
+    }
+  }
+
+  .context {
+    margin-bottom: 5px;
+  }
+
+  table.vars {
+    margin-bottom: 5px;
+  }
+
+  &.expanded {
+    color: #000;
+    border-color: darken(@infoBorder, 5%);
+
+    > p {
+      color: #000;
+      margin: -5px -5px 5px -5px;
+      padding: 5px;
+      background: @infoBackground;
+    }
+
+    // .context li {
+    //   color: darken(@infoText, 20%);
+    //   background: lighten(@infoBackground, 5%);
+    //   pre {
+    //     color: inherit;
+    //   }
+    //   &.active {
+    //     background: @infoBackground;
+    //     color: #000;
+    //   }
+    // }
+  
+    .commands a {
+      color: @infoText;
+    }
+
+    .expandable {
+      display: block;
+    }
+    table.expandable {
+      display: table;
+    }
+    li.expandable {
+      display: list-item;
+    }
+  }
+}
+
+
+.expandable {
+  display: none;
+}
+
 ol.context {
+  cursor: pointer;
   margin: 0;
   list-style-position: inside;
-  border: 1px solid #ccc;
-  border: 1px solid rgba(0,0,0,.15);
   .border-radius(3px);
   > li {
     padding-left: 20px;
@@ -826,30 +905,36 @@ ol.context-line {
   }
 }
 
-.expandable {
-  cursor: pointer;
-  .closed {
-    height: 0;
-    overflow: hidden;
-  }
-}
-
-
 // Vars display
 table.vars {
   .table-condensed;
+  .table-striped;
+
+  &.closed {
+    display: none;
+  }
+
+  td, th {
+    border: 0;
+  }
 }
+  
+td table.vars {
+  margin-bottom: 0;
+}
+
+
 td.code {
+  overflow: hidden;
+
   > pre {
     background-color: inherit;
     color: rgba(0,0,0,.75);
     padding: 1px 3px;
     border: 0;
+    margin-bottom: 0;
   }
 }
-td table.vars {
-  margin-bottom: 0;
-}
 
 // Generic module stuff
 
@@ -869,16 +954,10 @@ td table.vars {
 #chart { margin-bottom: 15px; overflow: hidden; }
 
 /* tracebacks */
-.frame table.vars { margin:5px 0 0 35px; }
-table.vars td.code { overflow: hidden; }
-table.vars td.code pre { margin-bottom: 0; }
 div.pastebin textarea { padding: 10px; background: #f9f9f9; border-color: #ddd; }
 
 ul.traceback { list-style-type: none; margin-left: 0; }
 ul.traceback li.frame { margin-bottom: 10px; overflow: hidden; position: relative; }
-div.commands { font-size: 12px; margin-top: 10px; margin-left: 20px; }
-div.commands a { color: black; text-decoration:none; }
-div.commands span { margin-right: 5px; font-size: 10px; }
 
 #versioninfo {
   th { text-align: left; font-family: monospace; padding-right: 20px; }
diff --git a/src/sentry/static/sentry/scripts/sentry.core.js b/src/sentry/static/sentry/scripts/sentry.core.js
index c967341363..958717728b 100644
--- a/src/sentry/static/sentry/scripts/sentry.core.js
+++ b/src/sentry/static/sentry/scripts/sentry.core.js
@@ -2,7 +2,7 @@
 function varToggle(link, id) {
     "use strict";
 
-    jQuery('#v' + id).toggle();
+    jQuery('.' + id).toggle();
     var s = link.getElementsByTagName('span')[0];
     var uarr = String.fromCharCode(0x25b6);
     var darr = String.fromCharCode(0x25bc);
diff --git a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 00f445c7ca..a64f955f3d 100644
--- a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -14,26 +14,30 @@
     <div class="module-content">
         <ul class="traceback">
             {% for frame in frames %}
-                <li class="frame{% if not frame.in_app %} system-frame{% endif %}">
+                <li class="frame{% if not frame.in_app %} system-frame{% endif %} frame-{{ forloop.counter0 }}">
                     <p>
                         <code>{{ frame.filename }}</code>
                         {% if frame.function %} in <code>{{ frame.function }}</code>{% endif %}
                         {% if not frame.context and frame.lineno %} at line <code>{{ frame.lineno }}</code>{% endif %}
                     </p>
 
+                    {% if frame.context or frame.vars %}
+                        <div class="commands">
+                            <a href="javascript:void(0)" onclick="$('.frame-{{ forloop.counter0 }}').toggleClass('expanded')">{% trans "Details" %}</a>
+                        </div>
+                    {% endif %}
+
                     {% if frame.context %}
-                        <ol start="{{ frame.start_lineno }}" class="context expandable" id="c{{ forloop.counter0 }}">
+                        <ol start="{{ frame.start_lineno }}" class="context">
                         {% for num, line in frame.context %}
-                            <li{% if num == frame.lineno %} class="active"{% else %} class="stack{{ forloop.parentloop.counter0 }} closed"{% endif %} onclick="$('.stack{{ forloop.parentloop.counter0 }}').toggleClass('closed')"><pre>{{ line }}</pre></li>
+                            <li{% if num == frame.lineno %} class="active"{% else %} class="expandable"{% endif %} onclick="$('.frame-{{ forloop.parentloop.counter0 }}').toggleClass('expanded')"><pre>{{ line }}</pre></li>
                         {% endfor %}
                         </ol>
                     {% endif %}
+
                     {% if frame.vars %}
-                        <div class="commands">
-                            <a href="#" onclick="return varToggle(this, '{{ forloop.counter0 }}')"><span>&#x25b6;</span> {% trans "Context" %}</a>
-                        </div>
                         {% if frame.vars|is_dict %}
-                            <table class="table vars" id="v{{ forloop.counter0 }}" style="display:none;">
+                            <table class="table vars stack{{ forloop.counter0 }} expandable">
                                 <colgroup>
                                     <col style="width:100px;">
                                 </colgroup>
