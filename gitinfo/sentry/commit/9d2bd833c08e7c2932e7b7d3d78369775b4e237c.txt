commit 9d2bd833c08e7c2932e7b7d3d78369775b4e237c
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue May 12 23:23:01 2015 +0200

    Added new user info for old templates.

diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index 373396115b..92f59f6967 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -102,7 +102,7 @@
         <div class="user-nav">
           <img src="{% gravatar_url user.email size 72 %}" class="avatar">
           <div class="user-details">
-            <span class="user-name">{{ request.user.username }}</span>
+            <span class="user-name">{{ request.user|format_userinfo }}</span>
             <ul>
               <li><a href="{% url 'sentry-account-settings' %}">{% trans "Account" %}</a></li>
               <li><a href="{% url 'sentry-logout' %}">{% trans "Sign out" %}</a></li>
diff --git a/src/sentry/templatetags/sentry_helpers.py b/src/sentry/templatetags/sentry_helpers.py
index 4145c548dc..d7ce90216e 100644
--- a/src/sentry/templatetags/sentry_helpers.py
+++ b/src/sentry/templatetags/sentry_helpers.py
@@ -421,3 +421,16 @@ def count_pending_access_requests(organization):
     return OrganizationAccessRequest.objects.filter(
         team__organization=organization,
     ).count()
+
+
+@register.filter
+def format_userinfo(user):
+    parts = user.username.split('@')
+    if len(parts) == 1:
+        username = user.username
+    else:
+        username = parts[0].lower()
+    return mark_safe('<span title="%s">%s</span>' % (
+        escape(user.username),
+        escape(username),
+    ))
