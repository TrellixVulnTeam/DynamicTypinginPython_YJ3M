commit 0ed905e6c0c1924764314937a84d7b8fb3315d52
Author: David Cramer <dcramer@gmail.com>
Date:   Fri May 4 23:16:30 2012 -0700

    Ensure admins can edit 'owner' on Projects

diff --git a/sentry/web/forms/__init__.py b/sentry/web/forms/__init__.py
index 5a760cdd2b..272de3a46e 100644
--- a/sentry/web/forms/__init__.py
+++ b/sentry/web/forms/__init__.py
@@ -68,10 +68,7 @@ class NewProjectForm(forms.ModelForm):
         model = Project
 
 
-class NewProjectAdminForm(forms.ModelForm):
-    name = forms.CharField(max_length=200, widget=forms.TextInput(attrs={'placeholder': _('e.g. My Project Name')}))
-    slug = forms.SlugField(help_text=_('A slug is a URL-safe word and must be unique across all projects.'),
-        widget=forms.TextInput(attrs={'placeholder': _('e.g. my-project-name')}))
+class NewProjectAdminForm(NewProjectForm):
     owner = UserField(required=False)
 
     class Meta:
@@ -120,6 +117,14 @@ class EditProjectForm(forms.ModelForm):
         return values
 
 
+class EditProjectAdminForm(EditProjectForm):
+    owner = UserField(required=False)
+
+    class Meta:
+        fields = ('name', 'public', 'team', 'owner')
+        model = Project
+
+
 class ReplayForm(forms.Form):
     url = forms.URLField(widget=forms.TextInput(attrs={'class': 'span8'}))
     method = forms.ChoiceField(choices=((k, k) for k in Http.METHODS))
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 5ec8274f6f..b83e412ec3 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -17,7 +17,8 @@ from sentry.permissions import can_create_projects, can_remove_project
 from sentry.plugins import plugins
 from sentry.plugins.helpers import set_option, get_option
 from sentry.web.decorators import login_required, has_access
-from sentry.web.forms import EditProjectForm, RemoveProjectForm
+from sentry.web.forms import EditProjectForm, RemoveProjectForm, \
+  EditProjectAdminForm
 from sentry.web.helpers import render_to_response, get_project_list, \
   plugin_config, get_team_list
 
@@ -98,8 +99,14 @@ def manage_project(request, project):
 
     team_list = get_team_list(request.user)
 
-    form = EditProjectForm(request, team_list, request.POST or None, instance=project, initial={
+    if request.user.has_perm('sentry.can_change_project'):
+        form_cls = EditProjectAdminForm
+    else:
+        form_cls = EditProjectForm
+
+    form = form_cls(request, team_list, request.POST or None, instance=project, initial={
         'origins': '\n'.join(get_option('sentry:origins', project) or []),
+        'owner': project.owner_id,
     })
 
     if form.is_valid():
