commit 76fb034fd38ad717bff9b2be7ce1e1b8dbcb513f
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Wed May 8 09:48:46 2019 -0700

    ref(activity): Refactor NoteInput styles (#13101)
    
    Move style object closer to NoteInput, remove emotion styles that get overridden by react-mentions

diff --git a/src/sentry/static/sentry/app/components/activity/note/input.jsx b/src/sentry/static/sentry/app/components/activity/note/input.jsx
index 124e2b1c0f..ec11eb9e7d 100644
--- a/src/sentry/static/sentry/app/components/activity/note/input.jsx
+++ b/src/sentry/static/sentry/app/components/activity/note/input.jsx
@@ -2,17 +2,18 @@ import {MentionsInput, Mention} from 'react-mentions';
 import PropTypes from 'prop-types';
 import React from 'react';
 import marked from 'marked';
-import styled, {css} from 'react-emotion';
+import styled from 'react-emotion';
 
 import {t} from 'app/locale';
 import Button from 'app/components/button';
 import NavTabs from 'app/components/navTabs';
 import SentryTypes from 'app/sentryTypes';
-import mentionsStyle from 'app/../styles/mentions-styles';
 import space from 'app/styles/space';
 import textStyles from 'app/styles/text';
 import withApi from 'app/utils/withApi';
 
+import mentionStyle from './mentionStyle';
+
 const buildUserId = id => `user:${id}`;
 const buildTeamId = id => `team:${id}`;
 
@@ -38,6 +39,11 @@ class NoteInput extends React.Component {
     placeholder: PropTypes.string,
     busy: PropTypes.bool,
 
+    /**
+     * minimum height of the textarea
+     */
+    minHeight: PropTypes.number,
+
     onEditFinish: PropTypes.func,
     onUpdate: PropTypes.func,
     onCreate: PropTypes.func,
@@ -47,6 +53,7 @@ class NoteInput extends React.Component {
   static defaultProps = {
     placeholder: t('Add a comment.\nTag users with @, or teams with #'),
     defaultText: '',
+    minHeight: 140,
     busy: false,
   };
 
@@ -184,7 +191,7 @@ class NoteInput extends React.Component {
 
   render() {
     const {preview, value} = this.state;
-    const {busy, item, error, placeholder, errorJSON} = this.props;
+    const {busy, item, error, placeholder, minHeight, errorJSON} = this.props;
 
     const existingItem = !!item;
     const btnText = existingItem ? t('Save Comment') : t('Post Comment');
@@ -224,11 +231,12 @@ class NoteInput extends React.Component {
         <NoteInputBody>
           {preview ? (
             <NotePreview
+              minHeight={minHeight}
               dangerouslySetInnerHTML={{__html: marked(this.cleanMarkdown(value))}}
             />
           ) : (
             <MentionsInput
-              style={mentionsStyle}
+              style={mentionStyle({minHeight})}
               placeholder={placeholder}
               onChange={this.handleChange}
               onBlur={this.handleBlur}
@@ -282,17 +290,18 @@ export {NoteInput};
 export default withApi(NoteInput);
 
 // This styles both the note preview and the note editor input
-const notePreviewCss = css`
-  display: block;
-  width: 100%;
-  min-height: 140px;
+const getNotePreviewCss = p => {
+  const {minHeight, padding, overflow, border} = mentionStyle(p)['&multiLine'].input;
+
+  return `
   max-height: 1000px;
   max-width: 100%;
-  margin: 0;
-  border: 0;
-  padding: ${space(1.5)} ${space(2)} 0;
-  overflow: auto;
+  ${(minHeight && `min-height: ${minHeight}px`) || ''};
+  padding: ${padding};
+  overflow: ${overflow};
+  border: ${border};
 `;
+};
 
 const getNoteInputErrorStyles = p => {
   if (!p.error) {
@@ -339,10 +348,6 @@ const NoteInputForm = styled('form')`
   transition: padding 0.2s ease-in-out;
 
   ${getNoteInputErrorStyles}
-
-  textarea {
-    ${notePreviewCss};
-  }
 `;
 
 const NoteInputBody = styled('div')`
@@ -417,7 +422,6 @@ const MarkdownIcon = styled('span')`
 `;
 
 const NotePreview = styled('div')`
-  ${notePreviewCss};
-
+  ${getNotePreviewCss};
   padding-bottom: ${space(1)};
 `;
diff --git a/src/sentry/static/sentry/app/components/activity/note/mentionStyle.jsx b/src/sentry/static/sentry/app/components/activity/note/mentionStyle.jsx
new file mode 100644
index 0000000000..1080d48d83
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/activity/note/mentionStyle.jsx
@@ -0,0 +1,74 @@
+import space from 'app/styles/space';
+
+/**
+ * Note this is an object for `react-mentions` component and
+ * not a styled component/emotion style
+ */
+export default function mentionStyle({minHeight} = {minHeight: 140}) {
+  return {
+    control: {
+      backgroundColor: '#fff',
+      fontSize: 15,
+      fontWeight: 'normal',
+    },
+
+    input: {
+      margin: 0,
+    },
+
+    '&singleLine': {
+      control: {
+        display: 'inline-block',
+
+        width: 130,
+      },
+
+      highlighter: {
+        padding: 1,
+        border: '2px inset transparent',
+      },
+
+      input: {
+        padding: 1,
+        border: '2px inset',
+      },
+    },
+
+    '&multiLine': {
+      control: {
+        fontFamily: 'Rubik, Avenir Next, Helvetica Neue, sans-serif',
+      },
+
+      highlighter: {
+        padding: 20,
+      },
+
+      input: {
+        padding: `${space(1.5)} ${space(2)} 0`,
+        minHeight,
+        overflow: 'auto',
+        outline: 0,
+        border: 0,
+      },
+    },
+
+    suggestions: {
+      list: {
+        maxHeight: 150,
+        overflow: 'auto',
+        backgroundColor: 'white',
+        border: '1px solid rgba(0,0,0,0.15)',
+        fontSize: 12,
+      },
+
+      item: {
+        padding: '5px 15px',
+        borderBottom: '1px solid rgba(0,0,0,0.15)',
+
+        '&focused': {
+          backgroundColor: '#f8f6f9',
+        },
+      },
+    },
+  };
+}
diff --git a/src/sentry/static/sentry/styles/mentions-styles.jsx b/src/sentry/static/sentry/styles/mentions-styles.jsx
deleted file mode 100644
index fbfa08acc3..0000000000
--- a/src/sentry/static/sentry/styles/mentions-styles.jsx
+++ /dev/null
@@ -1,66 +0,0 @@
-export default {
-  control: {
-    backgroundColor: '#fff',
-    fontSize: 15,
-    fontWeight: 'normal',
-  },
-
-  input: {
-    margin: 0,
-  },
-
-  '&singleLine': {
-    control: {
-      display: 'inline-block',
-
-      width: 130,
-    },
-
-    highlighter: {
-      padding: 1,
-      border: '2px inset transparent',
-    },
-
-    input: {
-      padding: 1,
-      border: '2px inset',
-    },
-  },
-
-  '&multiLine': {
-    control: {
-      fontFamily: 'Rubik, Avenir Next, Helvetica Neue, sans-serif',
-    },
-
-    highlighter: {
-      padding: 20,
-    },
-
-    input: {
-      padding: '15px 20px 0',
-      minHeight: 140,
-      overflow: 'auto',
-      outline: 0,
-      border: 0,
-    },
-  },
-
-  suggestions: {
-    list: {
-      maxHeight: 150,
-      overflow: 'auto',
-      backgroundColor: 'white',
-      border: '1px solid rgba(0,0,0,0.15)',
-      fontSize: 12,
-    },
-
-    item: {
-      padding: '5px 15px',
-      borderBottom: '1px solid rgba(0,0,0,0.15)',
-
-      '&focused': {
-        backgroundColor: '#f8f6f9',
-      },
-    },
-  },
-};
