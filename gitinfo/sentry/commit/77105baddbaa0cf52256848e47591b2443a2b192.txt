commit 77105baddbaa0cf52256848e47591b2443a2b192
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 22 19:17:22 2013 -0700

    Remove duplicate group view code (corrects invalid public template for event details)

diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 2b47b07569..92ab857899 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -363,15 +363,25 @@ def group_list(request, team, project):
 
 
 @has_group_access
-def group(request, team, project, group):
+def group(request, team, project, group, event_id=None):
     # It's possible that a message would not be created under certain
     # circumstances (such as a post_save signal failing)
-    event = group.get_latest_event() or Event()
+    activity_qs = Activity.objects.order_by('-datetime').select_related('user')
+    if event_id:
+        event = get_object_or_404(group.event_set, id=event_id)
+        activity_qs = activity_qs.filter(
+            Q(event=event) | Q(event__isnull=True),
+        )
+    else:
+        event = group.get_latest_event() or Event()
+
+    # bind params to group in case they get hit
     event.group = group
+    event.project = project
 
-    activity = list(Activity.objects.filter(
+    activity = list(activity_qs.filter(
         group=group,
-    ).order_by('-datetime').select_related('user')[:10])
+    )[:10])
 
     context = {
         'page': 'details',
@@ -444,22 +454,6 @@ def group_event_list_json(request, team, project, group_id):
     return HttpResponse(json.dumps([event.as_dict() for event in events]), mimetype='application/json')
 
 
-@has_group_access
-def group_event_details(request, team, project, group, event_id):
-    event = get_object_or_404(group.event_set, id=event_id)
-
-    activity = list(Activity.objects.filter(
-        group=group,
-    ).filter(
-        Q(event=event) | Q(event__isnull=True),
-    ).order_by('-datetime').select_related('user')[:10])
-
-    return render_with_group_context(group, 'sentry/groups/details.html', {
-        'page': 'details',
-        'activity': activity,
-    }, request, event=event)
-
-
 @has_access(MEMBER_USER)
 def group_event_details_json(request, team, project, group_id, event_id_or_latest):
     group = get_object_or_404(Group, pk=group_id, project=project)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index a470ebdd03..d14f1566b3 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -252,7 +252,7 @@ urlpatterns = patterns('',
         name='sentry-group-events'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/json/$', groups.group_event_list_json,
         name='sentry-group-events-json'),
-    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/(?P<event_id>\d+)/$', groups.group_event_details,
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/(?P<event_id>\d+)/$', groups.group,
         name='sentry-group-event'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/events/(?P<event_id_or_latest>(\d+|latest))/json/$', groups.group_event_details_json,
         name='sentry-group-event-json'),
