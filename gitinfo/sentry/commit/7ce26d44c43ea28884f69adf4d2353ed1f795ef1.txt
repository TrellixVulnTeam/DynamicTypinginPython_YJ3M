commit 7ce26d44c43ea28884f69adf4d2353ed1f795ef1
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Sep 7 03:50:09 2012 -0700

    Initial 'real data' display (missing side components)

diff --git a/src/sentry/manager.py b/src/sentry/manager.py
index 2895d0ff94..bb07298275 100644
--- a/src/sentry/manager.py
+++ b/src/sentry/manager.py
@@ -346,9 +346,8 @@ class ChartMixin(object):
 
         results = []
         for point in xrange(points, -1, -1):
-            import random
             dt = today - datetime.timedelta(**{d_type: point * modifier})
-            results.append((int((dt).strftime('%s')) * 1000, rows.get(dt, random.randint(0, 1000))))
+            results.append((int((dt).strftime('%s')) * 1000, rows.get(dt, 0)))
         return results
 
 
diff --git a/src/sentry/static/sentry/styles/wall.css b/src/sentry/static/sentry/styles/wall.css
index 1f3ef0e2d8..42679df543 100644
--- a/src/sentry/static/sentry/styles/wall.css
+++ b/src/sentry/static/sentry/styles/wall.css
@@ -4739,19 +4739,20 @@ legend {
 body {
   color: #ffffff;
   background: #232428;
+  font-family: "proxima-nova", "helvetica neue", helvetica, sans-serif;
 }
 #stats {
   background: #1f2022;
   padding: 30px 50px 30px;
   color: #464752;
   font-size: 12pt;
-  font-family: "proxima-nova", "helvetica neue", helvetica, sans-serif;
 }
 #stats big {
   text-shadow: 0px 0px 3px #fff;
   color: #ffffff;
   font-size: 50pt;
   line-height: 56pt;
+  font-weight: 200;
 }
 #stats strong {
   color: #a6a8b7;
@@ -4763,3 +4764,86 @@ body {
   margin-right: -20px;
   height: 50px;
 }
+#events {
+  padding: 20px 30px;
+}
+#events .nav-labels {
+  *zoom: 1;
+  margin-left: 10px;
+}
+#events .nav-labels:before,
+#events .nav-labels:after {
+  display: table;
+  content: "";
+}
+#events .nav-labels:after {
+  clear: both;
+}
+#events .nav-labels > li {
+  float: left;
+}
+#events .nav-labels > li > a {
+  text-transform: uppercase;
+  font-size: 15pt;
+  color: #464752;
+  padding-right: 12px;
+  padding-left: 12px;
+  margin-right: 20px;
+  line-height: 16pt;
+  letter-spacing: -1px;
+}
+#events .nav-labels > li > a:hover,
+#events .nav-labels > li.active a {
+  background: inherit;
+  color: #a6a8b7;
+}
+#events .events {
+  border-top: none;
+}
+#events .event {
+  -webkit-border-radius: 4px;
+  -moz-border-radius: 4px;
+  border-radius: 4px;
+  -webkit-box-shadow: none;
+  -moz-box-shadow: none;
+  box-shadow: none;
+  border-color: #232428;
+  border-width: 2px;
+  padding-top: 12px;
+  padding-bottom: 12px;
+}
+#events .event:hover {
+  background: #292b2f;
+  border-color: #44454f;
+  text-decoration: none;
+}
+#events .event h3 {
+  font-size: 17pt;
+  margin: 0;
+  font-weight: bold;
+}
+#events .event .meta {
+  position: relative;
+  right: auto;
+  top: auto;
+  color: #464752;
+}
+#events .event .tag {
+  background: inherit;
+  border: none;
+  color: inherit;
+}
+#events .event h3,
+#events .event .meta,
+#events .event .message {
+  line-height: 21px;
+}
+#events .event .count {
+  margin-top: 1px;
+}
+#events .event .message {
+  color: #a6a8b7;
+}
+#events .event .actions {
+  display: none;
+}
diff --git a/src/sentry/static/sentry/styles/wall.min.css b/src/sentry/static/sentry/styles/wall.min.css
index 9ecf3ac254..72ca8c64a0 100644
--- a/src/sentry/static/sentry/styles/wall.min.css
+++ b/src/sentry/static/sentry/styles/wall.min.css
@@ -779,7 +779,20 @@ legend{margin-bottom:18px;}
 .alert-block>ul{margin-bottom:9px;}
 [class*="icon-"]{background-image:url(../images/glyphicons-halflings.png);}
 .icon-white{background-image:url(../images/glyphicons-halflings-white.png);}
-body{color:#ffffff;background:#232428;}
-#stats{background:#1f2022;padding:30px 50px 30px;color:#464752;font-size:12pt;font-family:"proxima-nova","helvetica neue",helvetica,sans-serif;}#stats big{text-shadow:0px 0px 3px #fff;color:#ffffff;font-size:50pt;line-height:56pt;}
+body{color:#ffffff;background:#232428;font-family:"proxima-nova","helvetica neue",helvetica,sans-serif;}
+#stats{background:#1f2022;padding:30px 50px 30px;color:#464752;font-size:12pt;}#stats big{text-shadow:0px 0px 3px #fff;color:#ffffff;font-size:50pt;line-height:56pt;font-weight:200;}
 #stats strong{color:#a6a8b7;font-weight:normal;}
 #chart .chart{background:#1f2022;margin-left:-20px;margin-right:-20px;height:50px;}
+#events{padding:20px 30px;}#events .nav-labels{*zoom:1;margin-left:10px;}#events .nav-labels:before,#events .nav-labels:after{display:table;content:"";}
+#events .nav-labels:after{clear:both;}
+#events .nav-labels>li{float:left;}#events .nav-labels>li>a{text-transform:uppercase;font-size:15pt;color:#464752;padding-right:12px;padding-left:12px;margin-right:20px;line-height:16pt;letter-spacing:-1px;}
+#events .nav-labels>li>a:hover,#events .nav-labels>li.active a{background:inherit;color:#a6a8b7;}
+#events .events{border-top:none;}
+#events .event{-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;border-color:#232428;border-width:2px;padding-top:12px;padding-bottom:12px;}#events .event:hover{background:#292b2f;border-color:#44454f;text-decoration:none;}
+#events .event h3{font-size:17pt;margin:0;font-weight:bold;}
+#events .event .meta{position:relative;right:auto;top:auto;color:#464752;}
+#events .event .tag{background:inherit;border:none;color:inherit;}
+#events .event h3,#events .event .meta,#events .event .message{line-height:21px;}
+#events .event .count{margin-top:1px;}
+#events .event .message{color:#a6a8b7;}
+#events .event .actions{display:none;}
diff --git a/src/sentry/templates/sentry/wall.html b/src/sentry/templates/sentry/wall.html
index c2ba75566d..4b85a094fc 100644
--- a/src/sentry/templates/sentry/wall.html
+++ b/src/sentry/templates/sentry/wall.html
@@ -30,20 +30,16 @@
     </head>
 
     <body>
-        <div class="container-fluid" id="stats">
+        <div class="container-fluid" id="stats" data-uri="{% url sentry-api-stats %}?minutes=1440">
             <div class="row-fluid">
-                <div class="span4">
-                    <big>234</big>
-                    <div><strong>Exceptions</strong> in the last 24 hours</div>
+                <div class="span4" data-stat="events">
+                    <big>???</big>
+                    <div><strong>Events</strong> in the last 24 hours</div>
                 </div>
-                <div class="span4">
-                    <big>112</big>
+                <div class="span4" data-stat="resolved">
+                    <big>???</big>
                     <div><strong>Resolved</strong> in the last 24 hours</div>
                 </div>
-                <div class="span4">
-                    <big>234</big>
-                    <div><strong>Exceptions</strong> in the last 24 hours</div>
-                </div>
             </div>
         </div>
         <div class="container-fluid" id="chart">
@@ -55,15 +51,17 @@
         </div>
         <div class="container-fluid" id="events">
             <div class="row-fluid">
-                <ul class="nav">
-                    <li><a href="#trending">{% trans "Trending" %}</a></li>
-                    <li><a href="#new">{% trans "New" %}</a></li>
-                    <li><a href="#resolved">{% trans "Resolved" %}</a></li>
-                </ul>
-                <div class="tab-content">
-                    <div class="tab-pane active" id="trending"><p>Loading ...</p></div>
-                    <div class="tab-pane" id="new"></div>
-                    <div class="tab-pane" id="resolved"></div>
+                <div class="span7">
+                    <ul class="nav nav-labels">
+                        <li class="active"><a href="#trending" data-toggle="ajtab" data-uri="{% url sentry-api-groups-trends %}?minutes=1440&amp;limit=5">{% trans "Trending" %}</a></li>
+                        <li><a href="#new" data-toggle="ajtab" data-uri="{% url sentry-api-groups-new %}?minutes=1440&amp;limit=5">{% trans "New" %}</a></li>
+                        <li><a href="#resolved" data-toggle="ajtab" data-uri="{% url sentry-api-groups-resolved %}?minutes=1440&amp;limit=5">{% trans "Resolved" %}</a></li>
+                    </ul>
+                    <div class="tab-content">
+                        <div class="tab-pane active" id="trending"><p>Loading ...</p></div>
+                        <div class="tab-pane" id="new"></div>
+                        <div class="tab-pane" id="resolved"></div>
+                    </div>
                 </div>
             </div>
         </div>
@@ -88,7 +86,7 @@
                             color: '#52566c',
                             shadowSize: 0,
                             lines: {
-                                lineWidth: 1,
+                                lineWidth: 2,
                                 show: true,
                                 fill: true,
                                 fillColor: '#232428'
@@ -131,9 +129,12 @@
                         dataType: 'json',
                         success: function(data){
                             if (data.length) {
+                                var $group;
                                 var $ul = $('<ul class="events"></ul>');
                                 $.each(data, function(_, group){
-                                    $ul.append($(group.html));
+                                    $group = $(group.html);
+                                    $group.removeClass('event-small');
+                                    $ul.append($group);
                                 });
                                 $cont.html($ul);
                             } else {
@@ -149,6 +150,18 @@
                     $el.click();
                 }
             });
+            var $stats = $('#stats');
+
+            $.ajax({
+                url: $stats.attr('data-uri'),
+                dataType: 'json',
+                success: function(data){
+                    $stats.find('[data-stat]').each(function(){
+                        var $this = $(this);
+                        $this.find('big').text(data[$this.attr('data-stat')]);
+                    });
+                }
+            });
         });
         </script>
     </body>
diff --git a/src/sentry/web/api.py b/src/sentry/web/api.py
index de0bbf3271..7142053c4c 100644
--- a/src/sentry/web/api.py
+++ b/src/sentry/web/api.py
@@ -9,6 +9,7 @@ import datetime
 import logging
 
 from django.core.urlresolvers import reverse
+from django.db.models import Sum
 from django.http import HttpResponse, HttpResponseBadRequest, \
   HttpResponseForbidden, HttpResponseRedirect
 from django.utils import timezone
@@ -22,7 +23,8 @@ from sentry.exceptions import InvalidData
 from sentry.coreapi import project_from_auth_vars, project_from_id, \
   decode_and_decompress_data, safely_load_json_string, validate_data, \
   insert_data_to_database, APIError, APIUnauthorized, extract_auth_vars
-from sentry.models import Group, GroupBookmark, Project, View, MEMBER_USER
+from sentry.models import Group, GroupBookmark, Project, ProjectCountByMinute, \
+  View, MEMBER_USER
 from sentry.templatetags.sentry_helpers import as_bookmarks
 from sentry.utils import json
 from sentry.utils.cache import cache
@@ -464,3 +466,69 @@ def get_new_groups(request, project=None):
     response['Content-Type'] = 'application/json'
 
     return response
+
+
+@never_cache
+@csrf_exempt
+@has_access
+def get_resolved_groups(request, project=None):
+    minutes = int(request.REQUEST.get('minutes', 15))
+    limit = min(100, int(request.REQUEST.get('limit', 10)))
+
+    if project:
+        project_list = [project]
+    else:
+        project_list = get_project_list(request.user).values()
+
+    cutoff = datetime.timedelta(minutes=minutes)
+    cutoff_dt = timezone.now() - cutoff
+
+    group_list = Group.objects.filter(
+        project__in=project_list,
+        status=1,
+        resolved_at__gte=cutoff_dt,
+    ).select_related('project').order_by('-score')[:limit]
+
+    data = transform_groups(request, group_list, template='sentry/partial/_group_small.html')
+
+    response = HttpResponse(json.dumps(data))
+    response['Content-Type'] = 'application/json'
+
+    return response
+
+
+@never_cache
+@csrf_exempt
+@has_access
+def get_stats(request, project=None):
+    minutes = int(request.REQUEST.get('minutes', 15))
+
+    if project:
+        project_list = [project]
+    else:
+        project_list = get_project_list(request.user).values()
+
+    cutoff = datetime.timedelta(minutes=minutes)
+    cutoff_dt = timezone.now() - cutoff
+
+    num_events = ProjectCountByMinute.objects.filter(
+        project__in=project_list,
+        date__gte=cutoff_dt,
+    ).aggregate(t=Sum('times_seen'))['t'] or 0
+
+    # XXX: This is too slow if large amounts of groups are resolved
+    num_resolved = Group.objects.filter(
+        project__in=project_list,
+        status=1,
+        resolved_at__gte=cutoff_dt,
+    ).aggregate(t=Sum('times_seen'))['t'] or 0
+
+    data = {
+        'events': num_events,
+        'resolved': num_resolved,
+    }
+
+    response = HttpResponse(json.dumps(data))
+    response['Content-Type'] = 'application/json'
+
+    return response
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 0aca4e05a7..43cfa7b00a 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -133,8 +133,10 @@ urlpatterns = patterns('',
     url(r'^api/(?P<project_id>[\w_-]+)/group/(?P<group_id>[\w_-]+)/remove/$', api.remove_group, name='sentry-api-remove-group'),
     url(r'^api/(?:(?P<project_id>[\w_-]+)/)?groups/trends/$', api.get_group_trends, name='sentry-api-groups-trends'),
     url(r'^api/(?:(?P<project_id>[\w_-]+)/)?groups/newest/$', api.get_new_groups, name='sentry-api-groups-new'),
+    url(r'^api/(?:(?P<project_id>[\w_-]+)/)?groups/resolved/$', api.get_resolved_groups, name='sentry-api-groups-resolved'),
     url(r'^api/(?P<project_id>[\w_-]+)/group/(?P<group_id>[\w_-]+)/set/public/$', api.make_group_public, name='sentry-api-set-group-public'),
     url(r'^api/(?P<project_id>[\w_-]+)/group/(?P<group_id>[\w_-]+)/set/private/$', api.make_group_private, name='sentry-api-set-group-private'),
+    url(r'^api/(?:(?P<project_id>[\w_-]+)/)?stats/$', api.get_stats, name='sentry-api-stats'),
 
     # Project specific
 
diff --git a/src/wall.less b/src/wall.less
index 27905d0033..a2143934ab 100644
--- a/src/wall.less
+++ b/src/wall.less
@@ -11,8 +11,9 @@
 /* =============================  Global  ============================== */
 
 body {
-  color: @white;
-  background: #232428;
+    color: @white;
+    background: #232428;
+    font-family: "proxima-nova", "helvetica neue", helvetica, sans-serif;
 }
 
 #stats {
@@ -20,13 +21,13 @@ body {
     padding: 30px 50px 30px;
     color: @grayDark;
     font-size: 12pt;
-    font-family: "proxima-nova", "helvetica neue", helvetica, sans-serif;
 
     big {
         text-shadow: 0px 0px 3px #fff;
         color: @white;
         font-size: 50pt;
         line-height: 56pt;
+        font-weight: 200;
     }
     strong {
         color: @gray;
@@ -42,3 +43,82 @@ body {
         height: 50px;
     }
 }
+
+#events {
+    padding: 20px 30px;
+
+    .nav-labels {
+        .clearfix();
+        margin-left: 10px;
+        > li {
+            float: left;
+            > a {
+                text-transform: uppercase;
+                font-size: 15pt;
+                color: @grayDark;
+                padding-right: 12px;
+                padding-left: 12px;
+                margin-right: 20px;
+                line-height: 16pt;
+                letter-spacing: -1px;
+            }
+            > a:hover,
+            &.active a {
+                background: inherit;
+                color: @gray;
+            }
+        }
+    }
+
+    .events {
+        border-top: none;
+    }
+    .event {
+        .border-radius(4px);
+        .box-shadow(none);
+        border-color: #232428;
+        border-width: 2px;
+        padding-top: 12px;
+        padding-bottom: 12px;
+
+        &:hover {
+            background: #292b2f;
+            border-color: #44454f;
+        }
+
+        h3 {
+            font-size: 17pt;
+            margin: 0;
+            font-weight: bold;
+        }
+
+        .meta {
+            position: relative;
+            right: auto;
+            top: auto;
+            color: @grayDark;
+        }
+
+        .tag {
+            background: inherit;
+            border: none;
+            color: inherit;
+        }
+
+        h3, .meta, .message {
+            line-height: 21px;
+        }
+
+        .count {
+            margin-top: 1px;
+        }
+
+        .message {
+            color: @gray;
+        }
+
+        .actions {
+            display: none;
+        }
+    }
+}
\ No newline at end of file
