commit 61798f15760dab57ce8b9fcf038895b6798d5748
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Tue Feb 6 10:29:11 2018 -0800

    feat(ui): Add AccountDetails view for new settings (#7067)
    
    * Handle form validation via json
    * Improve error handling of API requests via forms
    * Allow form json to mutate entire data payload before submit
    * Combine account details + appearance + avatar - password
    * change settingsIndicator to not always have undo
    * refactor settings avatar to use user from props
    * remove avatar/appearance routes

diff --git a/src/sentry/static/sentry/app/actionCreators/account.jsx b/src/sentry/static/sentry/app/actionCreators/account.jsx
index b017d1f671..820c00f18a 100644
--- a/src/sentry/static/sentry/app/actionCreators/account.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/account.jsx
@@ -1,4 +1,5 @@
 import {Client} from '../api';
+import ConfigStore from '../stores/configStore';
 import IndicatorStore from '../stores/indicatorStore';
 
 export function disconnectIdentity(identity) {
@@ -17,3 +18,8 @@ export function disconnectIdentity(identity) {
 
   return request;
 }
+
+export function updateUser(user) {
+  // Ideally we'd fire an action but this is gonna get refactored soon anyway
+  ConfigStore.set('user', user);
+}
diff --git a/src/sentry/static/sentry/app/actionCreators/settingsIndicator.jsx b/src/sentry/static/sentry/app/actionCreators/settingsIndicator.jsx
index 34e9be2980..e81f3b26c1 100644
--- a/src/sentry/static/sentry/app/actionCreators/settingsIndicator.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/settingsIndicator.jsx
@@ -11,6 +11,14 @@ export function undo() {
   SettingsIndicatorActions.undo();
 }
 
+/**
+ *
+ * @params {string} msg Message
+ * @params {string} type ['success', 'error', '']
+ * @params {object} options
+ * @params {boolean} options.disableUndo Disables undo (default false)
+ * @params {number} options.duration Duration to show indicator, default in constants
+ */
 export function addMessage(msg, type, options = {}) {
   let {duration} = options;
 
diff --git a/src/sentry/static/sentry/app/data/forms/accountDetails.jsx b/src/sentry/static/sentry/app/data/forms/accountDetails.jsx
new file mode 100644
index 0000000000..4cb1b46eca
--- /dev/null
+++ b/src/sentry/static/sentry/app/data/forms/accountDetails.jsx
@@ -0,0 +1,37 @@
+export const route = '/settings/account/details/';
+
+// For fields that are
+const getUserIsManaged = ({user}) => user.isManaged;
+
+const formGroups = [
+  {
+    // Form "section"/"panel"
+    title: 'Account Details',
+    fields: [
+      {
+        name: 'name',
+        type: 'string',
+        required: true,
+
+        // additional data/props that is related to rendering of form field rather than data
+        label: 'Name',
+        placeholder: 'e.g. John Doe',
+        help: 'Your full name',
+      },
+      {
+        name: 'username',
+        type: 'string',
+        required: true,
+
+        autoComplete: 'username',
+        label: 'Username',
+        placeholder: 'e.g. name@example.com',
+        help: '',
+        disabled: getUserIsManaged,
+        visible: ({user}) => user.email !== user.username,
+      },
+    ],
+  },
+];
+
+export default formGroups;
diff --git a/src/sentry/static/sentry/app/data/forms/accountAppearance.jsx b/src/sentry/static/sentry/app/data/forms/accountPreferences.jsx
similarity index 75%
rename from src/sentry/static/sentry/app/data/forms/accountAppearance.jsx
rename to src/sentry/static/sentry/app/data/forms/accountPreferences.jsx
index 1314f308c5..cd561ec05e 100644
--- a/src/sentry/static/sentry/app/data/forms/accountAppearance.jsx
+++ b/src/sentry/static/sentry/app/data/forms/accountPreferences.jsx
@@ -2,12 +2,15 @@ import timezones from '../timezones';
 import languages from '../languages';
 
 // Export route to make these forms searchable by label/help
-export const route = '/settings/account/appearance/';
+export const route = '/settings/account/details/';
+
+// Called before sending API request, these fields need to be sent as an `options` object
+const transformOptions = data => ({options: data});
 
 const formGroups = [
   {
     // Form "section"/"panel"
-    title: 'Events',
+    title: 'Preferences',
     fields: [
       {
         name: 'stacktraceOrder',
@@ -22,30 +25,28 @@ const formGroups = [
         // additional data/props that is related to rendering of form field rather than data
         label: 'Stacktrace Order',
         help: 'Choose the default ordering of frames in stacktraces',
+        getData: transformOptions,
       },
-    ],
-  },
-
-  {
-    title: 'Localization',
-    fields: [
       {
         name: 'language',
         type: 'choice',
         label: 'Language',
         // seems weird to have choices in initial form data
         choices: languages,
+        getData: transformOptions,
       },
       {
         name: 'timezone',
         type: 'choice',
         label: 'Timezone',
         choices: timezones,
+        getData: transformOptions,
       },
       {
         name: 'clock24Hours',
         type: 'boolean',
         label: 'Use a 24-hour clock',
+        getData: transformOptions,
       },
     ],
   },
diff --git a/src/sentry/static/sentry/app/routes.jsx b/src/sentry/static/sentry/app/routes.jsx
index 72070fbdd1..1e7bbd8315 100644
--- a/src/sentry/static/sentry/app/routes.jsx
+++ b/src/sentry/static/sentry/app/routes.jsx
@@ -124,7 +124,16 @@ function appendTrailingSlash(nextState, replace) {
 const lazyLoad = cb => m => cb(null, m.default);
 
 const accountSettingsRoutes = [
-  <IndexRedirect key="account-settings-index" to="notifications/" />,
+  <IndexRedirect key="account-settings-index" to="details/" />,
+
+  <Route
+    key="details/"
+    path="details/"
+    name="Details"
+    componentPromise={() => import('./views/settings/account/accountDetails')}
+    component={errorHandler(LazyLoad)}
+  />,
+
   <Route key="notifications/" path="notifications/" name="Notifications">
     <IndexRoute
       componentPromise={() => import('./views/settings/account/accountNotifications')}
@@ -145,22 +154,6 @@ const accountSettingsRoutes = [
     componentPromise={() => import('./views/settings/account/accountEmails')}
     component={errorHandler(LazyLoad)}
   />,
-  <Route
-    key="avatar/"
-    path="avatar/"
-    name="Avatar"
-    componentPromise={() => import('./views/settings/account/avatar')}
-    component={errorHandler(LazyLoad)}
-  />,
-
-  <Route
-    key="appearance/"
-    path="appearance/"
-    name="Appearance"
-    componentPromise={() =>
-      import(/*webpackChunkName: "AccountAppearance"*/ './views/settings/account/accountAppearance')}
-    component={errorHandler(LazyLoad)}
-  />,
 
   <Route
     key="authorizations/"
diff --git a/src/sentry/static/sentry/app/stores/settingsIndicatorStore.jsx b/src/sentry/static/sentry/app/stores/settingsIndicatorStore.jsx
index f1feffa90a..53cc0b1d5f 100644
--- a/src/sentry/static/sentry/app/stores/settingsIndicatorStore.jsx
+++ b/src/sentry/static/sentry/app/stores/settingsIndicatorStore.jsx
@@ -1,5 +1,6 @@
 import Reflux from 'reflux';
 
+import {defined} from '../utils';
 import SettingsIndicatorActions from '../actions/settingsIndicatorActions';
 
 const SettingsIndicatorStore = Reflux.createStore({
@@ -19,6 +20,12 @@ const SettingsIndicatorStore = Reflux.createStore({
     this.id = options.id;
 
     this.state = {
+      options: {
+        ...options,
+
+        // Use options, else default to disable if model does not exist
+        disableUndo: defined(options.disableUno) ? options.disableUndo : !options.model,
+      },
       message,
       type,
     };
diff --git a/src/sentry/static/sentry/app/views/settings/account/accountAppearance.jsx b/src/sentry/static/sentry/app/views/settings/account/accountAppearance.jsx
deleted file mode 100644
index 043d91bcea..0000000000
--- a/src/sentry/static/sentry/app/views/settings/account/accountAppearance.jsx
+++ /dev/null
@@ -1,35 +0,0 @@
-import {Box} from 'grid-emotion';
-import React from 'react';
-
-import AsyncView from '../../asyncView';
-import Form from '../components/forms/form';
-import JsonForm from '../components/forms/jsonForm';
-import formData from '../../../data/forms/accountAppearance';
-
-const ENDPOINT = '/users/me/appearance/';
-
-class AccountAppearance extends AsyncView {
-  getEndpoints() {
-    return [['appearance', ENDPOINT]];
-  }
-
-  renderBody() {
-    return (
-      <div>
-        <Form
-          apiMethod="PUT"
-          apiEndpoint={ENDPOINT}
-          saveOnBlur
-          allowUndo
-          initialData={this.state.appearance}
-        >
-          <Box>
-            <JsonForm location={this.props.location} forms={formData} />
-          </Box>
-        </Form>
-      </div>
-    );
-  }
-}
-
-export default AccountAppearance;
diff --git a/src/sentry/static/sentry/app/views/settings/account/accountDetails.jsx b/src/sentry/static/sentry/app/views/settings/account/accountDetails.jsx
new file mode 100644
index 0000000000..3d666f5962
--- /dev/null
+++ b/src/sentry/static/sentry/app/views/settings/account/accountDetails.jsx
@@ -0,0 +1,64 @@
+import React from 'react';
+
+import {updateUser} from '../../../actionCreators/account';
+import AccountAvatar from '../account/avatar';
+import AsyncView from '../../asyncView';
+import Form from '../components/forms/form';
+import JsonForm from '../components/forms/jsonForm';
+import SettingsPageHeader from '../components/settingsPageHeader';
+import accountDetailsFields from '../../../data/forms/accountDetails';
+import accountPreferencesFields from '../../../data/forms/accountPreferences';
+
+const ENDPOINT = '/users/me/';
+
+class AccountDetails extends AsyncView {
+  getEndpoints() {
+    return [['user', ENDPOINT]];
+  }
+
+  handleSubmitSuccess = user => {
+    updateUser(user);
+    this.setState({user});
+  };
+
+  handleSubmitError = (resp, model, id) => {};
+
+  renderBody() {
+    let {user} = this.state;
+
+    return (
+      <div>
+        <SettingsPageHeader title="Account Details" />
+
+        <Form
+          apiMethod="PUT"
+          apiEndpoint={ENDPOINT}
+          saveOnBlur
+          initialData={user}
+          onSubmitSuccess={this.handleSubmitSuccess}
+          onSubmitError={this.handleSubmitError}
+        >
+          <JsonForm
+            location={this.props.location}
+            forms={accountDetailsFields}
+            additionalFieldProps={{user}}
+          />
+        </Form>
+
+        <Form
+          apiMethod="PUT"
+          apiEndpoint={ENDPOINT}
+          saveOnBlur
+          allowUndo
+          initialData={this.state.user.options}
+        >
+          <JsonForm location={this.props.location} forms={accountPreferencesFields} />
+        </Form>
+
+        <AccountAvatar onSave={this.handleSubmitSuccess} user={user} />
+      </div>
+    );
+  }
+}
+
+export default AccountDetails;
diff --git a/src/sentry/static/sentry/app/views/settings/account/avatar.jsx b/src/sentry/static/sentry/app/views/settings/account/avatar.jsx
index 9db3adf310..f9d0f1be5b 100644
--- a/src/sentry/static/sentry/app/views/settings/account/avatar.jsx
+++ b/src/sentry/static/sentry/app/views/settings/account/avatar.jsx
@@ -1,45 +1,53 @@
 import PropTypes from 'prop-types';
 import React from 'react';
-import styled from 'react-emotion';
 import createReactClass from 'create-react-class';
+import styled from 'react-emotion';
 
-import Panel from '../components/panel';
-import PanelBody from '../components/panelBody';
-import PanelHeader from '../components/panelHeader';
-import AlertActions from '../../../actions/alertActions';
+import {
+  addErrorMessage,
+  addSuccessMessage,
+} from '../../../actionCreators/settingsIndicator';
+import {t} from '../../../locale';
 import ApiMixin from '../../../mixins/apiMixin';
+import Avatar from '../../../components/avatar';
 import AvatarCropper from '../../../components/avatarCropper';
-import RadioGroup from '../components/forms/radioGroup';
 import LoadingError from '../../../components/loadingError';
 import LoadingIndicator from '../../../components/loadingIndicator';
-import {t} from '../../../locale';
+import Panel from '../components/panel';
+import PanelBody from '../components/panelBody';
+import PanelHeader from '../components/panelHeader';
+import RadioGroup from '../components/forms/radioGroup';
+import SentryTypes from '../../../proptypes';
 
-const AvatarSettings = createReactClass({
-  displayName: 'AvatarSettings',
+const AccountAvatar = createReactClass({
+  displayName: 'AccountAvatar',
 
   propTypes: {
     userId: PropTypes.number,
+    user: SentryTypes.User,
+    onSave: PropTypes.func,
   },
 
   mixins: [ApiMixin],
 
+  getDefaultProps() {
+    return {
+      onSave: () => {},
+    };
+  },
+
   getInitialState() {
     return {
-      user: null,
+      user: this.props.user,
       savedDataUrl: null,
       dataUrl: null,
       hasError: false,
     };
   },
 
-  componentDidMount() {
-    this.api.request(this.getEndpoint(), {
-      method: 'GET',
-      success: this.updateUserState,
-      error: () => {
-        this.setState({hasError: true});
-      },
-    });
+  componentWillReceiveProps(nextProps) {
+    // Update local state if defined in props
+    this.setState({user: nextProps.user});
   },
 
   getEndpoint() {
@@ -55,18 +63,15 @@ const AvatarSettings = createReactClass({
   },
 
   handleError(msg) {
-    AlertActions.addAlert({
-      message: t(msg),
-      type: 'error',
-    });
+    addErrorMessage(t(msg));
   },
 
   handleSuccess(user) {
+    let {onSave} = this.props;
     this.setState({user});
-    AlertActions.addAlert({
-      message: t('Successfully saved avatar preferences'),
-      type: 'success',
-      expireAfrer: 3000,
+    onSave(user);
+    addSuccessMessage(t('Successfully saved avatar preferences'), undefined, {
+      disableUndo: true,
     });
   },
 
@@ -113,21 +118,34 @@ const AvatarSettings = createReactClass({
       </div>
     );
 
+    let isLetter = this.state.user.avatar.avatarType == 'letter_avatar';
+
     return (
       <Panel>
         <PanelHeader>Avatar</PanelHeader>
         <PanelBody>
           <AvatarForm>
-            <RadioGroup
-              choices={[
-                ['letter_avatar', 'Use my initials'],
-                ['upload', 'Upload a Photo'],
-                ['gravatar', 'Use Gravatar'],
-              ]}
-              value={this.state.user.avatar.avatarType || 'letter_avatar'}
-              label="Avatar Type"
-              onChange={id => this.handleChange(id)}
-            />
+            <AvatarGroup inline={isLetter}>
+              <RadioGroup
+                style={{flex: 1}}
+                choices={[
+                  ['letter_avatar', 'Use my initials'],
+                  ['upload', 'Upload a Photo'],
+                  ['gravatar', 'Use Gravatar'],
+                ]}
+                value={this.state.user.avatar.avatarType || 'letter_avatar'}
+                label="Avatar Type"
+                onChange={id => this.handleChange(id)}
+              />
+
+              {isLetter && (
+                <Avatar
+                  gravatar={false}
+                  style={{width: 90, height: 90}}
+                  user={this.state.user}
+                />
+              )}
+            </AvatarGroup>
 
             <AvatarUploadSection>
               {this.state.user.avatar.avatarType === 'gravatar' && gravatarMessage}
@@ -142,7 +160,7 @@ const AvatarSettings = createReactClass({
               )}
               <AvatarSubmit className="form-actions">
                 <button className="btn btn-primary" onClick={this.saveSettings}>
-                  {t('Done')}
+                  {t('Save Avatar')}
                 </button>
               </AvatarSubmit>
             </AvatarUploadSection>
@@ -153,6 +171,11 @@ const AvatarSettings = createReactClass({
   },
 });
 
+const AvatarGroup = styled.div`
+  display: flex;
+  flex-direction: ${p => (p.inline ? 'row' : 'column')};
+`;
+
 const AvatarForm = styled('form')`
   line-height: 1.5em;
   padding: 1em 1.25em;
@@ -166,4 +189,4 @@ const AvatarUploadSection = styled('div')`
   margin-top: 1em;
 `;
 
-export default AvatarSettings;
+export default AccountAvatar;
diff --git a/src/sentry/static/sentry/app/views/settings/account/navigationConfiguration.jsx b/src/sentry/static/sentry/app/views/settings/account/navigationConfiguration.jsx
index 08798510e4..8115171487 100644
--- a/src/sentry/static/sentry/app/views/settings/account/navigationConfiguration.jsx
+++ b/src/sentry/static/sentry/app/views/settings/account/navigationConfiguration.jsx
@@ -7,12 +7,8 @@ const accountNavigation = [
     name: t('Account'),
     items: [
       {
-        path: `${pathPrefix}/avatar`,
-        title: t('Avatar'),
-      },
-      {
-        path: `${pathPrefix}/appearance/`,
-        title: t('Appearance'),
+        path: `${pathPrefix}/details/`,
+        title: t('Account Details'),
       },
       {
         path: `${pathPrefix}/notifications/`,
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/fieldFromConfig.jsx b/src/sentry/static/sentry/app/views/settings/components/forms/fieldFromConfig.jsx
index 49660d7c30..7c0c8673c1 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/fieldFromConfig.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/fieldFromConfig.jsx
@@ -2,9 +2,6 @@ import PropTypes from 'prop-types';
 import React from 'react';
 
 import BooleanField from './booleanField';
-// import EmailField from './emailField';
-// import NumberField from './numberField';
-import PasswordField from './passwordField';
 // import RangeField from './rangeField';
 // import Select2FieldAutocomplete from './select2FieldAutocomplete';
 import Select2Field from './select2Field';
@@ -12,12 +9,21 @@ import Select2Field from './select2Field';
 import TextField from './textField';
 import TextareaField from './textareaField';
 import RadioField from './radioField';
+import InputField from './inputField';
 
 export default class FieldFromConfig extends React.Component {
   static propTypes = {
     field: PropTypes.shape({
       name: PropTypes.string,
-      type: PropTypes.oneOf(['string', 'array', 'boolean', 'radio', 'choice', 'select']),
+      type: PropTypes.oneOf([
+        'secret',
+        'string',
+        'array',
+        'boolean',
+        'radio',
+        'choice',
+        'select',
+      ]),
       required: PropTypes.bool,
       multiline: PropTypes.bool,
       label: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),
@@ -43,14 +49,14 @@ export default class FieldFromConfig extends React.Component {
 
     switch (field.type) {
       case 'secret':
-        return <PasswordField {...props} />;
+        return <InputField {...props} type="password" />;
       // case 'range':
       // return <RangeField {...props} />;
       case 'bool':
       case 'boolean':
         return <BooleanField {...props} />;
-      // case 'email':
-      // return <EmailField {...props} />;
+      case 'email':
+        return <InputField {...props} type="email" />;
       case 'string':
       case 'text':
       case 'url':
@@ -59,8 +65,8 @@ export default class FieldFromConfig extends React.Component {
         }
         // if (props.choices) return <Select2TextField {...props} />;
         return <TextField {...props} />;
-      // case 'number':
-      // return <NumberField {...props} />;
+      case 'number':
+        return <InputField {...props} type="number" />;
       case 'textarea':
         return <TextareaField {...props} />;
       case 'choice':
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/formField/index.jsx b/src/sentry/static/sentry/app/views/settings/components/forms/formField/index.jsx
index f44b2fc1cf..d4fb0fe922 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/formField/index.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/formField/index.jsx
@@ -99,7 +99,6 @@ class FormField extends React.Component {
 
     label: PropTypes.string,
     defaultValue: PropTypes.any,
-    disabled: PropTypes.oneOfType([PropTypes.bool, PropTypes.func]),
     disabledReason: PropTypes.string,
     showReturnButton: PropTypes.bool,
     help: PropTypes.oneOfType([PropTypes.string, PropTypes.element]),
@@ -108,6 +107,15 @@ class FormField extends React.Component {
     highlighted: PropTypes.bool,
     alignRight: PropTypes.bool,
 
+    /**
+     * Should field be disabled?
+     */
+    disabled: PropTypes.oneOfType([PropTypes.bool, PropTypes.func]),
+    /**
+     * Should field be visible
+     */
+    visible: PropTypes.oneOfType([PropTypes.bool, PropTypes.func]),
+
     /**
      * Should control be inline with field label
      */
@@ -128,6 +136,7 @@ class FormField extends React.Component {
     inline: true,
     disabled: false,
     required: false,
+    visible: true,
   };
 
   static contextTypes = {
@@ -247,10 +256,16 @@ class FormField extends React.Component {
       hideErrorMessage,
       help,
       alignRight,
+      visible,
     } = this.props;
     let id = this.getId();
     let model = this.getModel();
     let isDisabled = typeof disabled === 'function' ? disabled(this.props) : disabled;
+    let isVisible = typeof visible === 'function' ? visible(this.props) : visible;
+
+    if (!isVisible) {
+      return null;
+    }
 
     return (
       <FormFieldWrapper inline={inline} highlighted={highlighted}>
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/jsonForm.jsx b/src/sentry/static/sentry/app/views/settings/components/forms/jsonForm.jsx
index 330c8c99b1..849281d334 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/jsonForm.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/jsonForm.jsx
@@ -20,6 +20,11 @@ class JsonForm extends React.Component {
       })
     ).isRequired,
     access: PropTypes.object,
+    additionalFieldProps: PropTypes.object,
+  };
+
+  static defaultProps = {
+    additionalFieldProps: {},
   };
 
   static contextTypes = {
@@ -59,7 +64,7 @@ class JsonForm extends React.Component {
   }
 
   render() {
-    let {forms, access, ...otherProps} = this.props;
+    let {forms, access, additionalFieldProps, ...otherProps} = this.props;
 
     return (
       <Box>
@@ -73,6 +78,7 @@ class JsonForm extends React.Component {
                     access={access}
                     key={field.name}
                     {...otherProps}
+                    {...additionalFieldProps}
                     field={field}
                     highlighted={this.state.highlighted === `#${field.name}`}
                   />
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/model.jsx b/src/sentry/static/sentry/app/views/settings/components/forms/model.jsx
index 66983e3ce6..6cb0eef853 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/model.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/model.jsx
@@ -4,6 +4,7 @@ import _ from 'lodash';
 import {Client} from '../../../../api';
 import {defined} from '../../../../utils';
 import FormState from '../../../../components/forms/state';
+import {addErrorMessage} from '../../../../actionCreators/settingsIndicator';
 
 class FormModel {
   /**
@@ -178,7 +179,21 @@ class FormModel {
   }
 
   isValidField(id) {
-    return this.isValidRequiredField(id);
+    let validate = this.getDescriptor(id, 'validate');
+    let errors = [];
+
+    if (typeof validate === 'function') {
+      // Returns "tuples" of [id, error string]
+      errors = validate({model: this, id, form: this.getData().toJSON()}) || [];
+    }
+
+    errors
+      .filter(([, errorMessage]) => !!errorMessage)
+      .forEach(([field, errorMessage]) => {
+        this.setError(field, errorMessage);
+      });
+
+    return !errors.length && this.isValidRequiredField(id);
   }
 
   doApiRequest({apiEndpoint, apiMethod, data}) {
@@ -247,12 +262,24 @@ class FormModel {
     // Save field + value
     this.setSaving(id, true);
 
-    // Transform data before saving, this uses `getValue` defined when declaring the form
     let fieldDescriptor = this.fieldDescriptor.get(id);
+
+    // Check if field needs to handle
+    let getData =
+      typeof fieldDescriptor.getData === 'function' ? fieldDescriptor.getData : a => a;
+
+    // Transform data before saving, this uses `getValue` defined when declaring the form
     let serializer =
       typeof fieldDescriptor.getValue === 'function' ? fieldDescriptor.getValue : a => a;
 
-    return this.doApiRequest({data: {[id]: serializer(newValue)}})
+    let request = this.doApiRequest({
+      data: getData(
+        {[id]: serializer(newValue)},
+        {model: this, id, form: this.getData().toJSON()}
+      ),
+    });
+
+    request
       .then(data => {
         this.setSaving(id, false);
 
@@ -267,16 +294,36 @@ class FormModel {
 
         return {old: oldValue, new: newValue};
       })
-      .catch(error => {
+      .catch(resp => {
         // should we revert field value to last known state?
-
         saveSnapshot = null;
-        this.setError(id, 'Failed to save');
+
+        // API can return a JSON object with either:
+        // 1) map of {[fieldName] => Array<ErrorMessages>}
+        // 2) {'non_field_errors' => Array<ErrorMessages>}
+        if (resp && resp.responseJSON) {
+          // Show resp msg from API endpoint if possible
+          if (Array.isArray(resp.responseJSON[id]) && resp.responseJSON[id].length) {
+            // Just take first resp for now
+            this.setError(id, resp.responseJSON[id][0]);
+          } else if (
+            Array.isArray(resp.responseJSON.non_field_errors) &&
+            resp.responseJSON.non_field_errors.length
+          ) {
+            addErrorMessage(resp.responseJSON.non_field_errors[0], 10000);
+            // Reset saving state
+            this.setError(id, '');
+          }
+        } else {
+          // Default error behavior
+          this.setError(id, 'Failed to save');
+        }
 
         // eslint-disable-next-line no-console
-        console.error(error);
-        throw error;
+        console.error('Error saving form field', resp && resp.responseJSON);
       });
+
+    return request;
   }
 
   /**
diff --git a/src/sentry/static/sentry/app/views/settings/components/forms/radioGroup.jsx b/src/sentry/static/sentry/app/views/settings/components/forms/radioGroup.jsx
index 0be190c5cc..e655239487 100644
--- a/src/sentry/static/sentry/app/views/settings/components/forms/radioGroup.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/forms/radioGroup.jsx
@@ -4,13 +4,13 @@ import PropTypes from 'prop-types';
 
 import {growIn} from './styled/animations';
 
-const RadioGroup = ({value, choices, label, onChange}) => {
+const RadioGroup = ({value, choices, label, onChange, ...props}) => {
   const isSelected = id => {
     return value ? value === id : id === 0;
   };
 
   return (
-    <div role="radiogroup" aria-labelledby={label}>
+    <div {...props} role="radiogroup" aria-labelledby={label}>
       {(choices || []).map(([id, name], index) => (
         <RadioLineItem
           key={index}
diff --git a/src/sentry/static/sentry/app/views/settings/components/settingsActivity.jsx b/src/sentry/static/sentry/app/views/settings/components/settingsActivity.jsx
index 7201e30af4..35c6ef09c0 100644
--- a/src/sentry/static/sentry/app/views/settings/components/settingsActivity.jsx
+++ b/src/sentry/static/sentry/app/views/settings/components/settingsActivity.jsx
@@ -51,7 +51,10 @@ const SettingsActivity = createReactClass({
       return null;
     }
 
-    let showUndo = activity.type !== 'error' && activity.type !== 'undo';
+    let showUndo =
+      !activity.options.disableUndo &&
+      activity.type !== 'error' &&
+      activity.type !== 'undo';
 
     return (
       <Container type={activity.type}>
diff --git a/tests/js/setup.js b/tests/js/setup.js
index 9a1a825c58..1c93b365d3 100644
--- a/tests/js/setup.js
+++ b/tests/js/setup.js
@@ -354,6 +354,31 @@ window.TestStubs = {
     };
   },
 
+  ProjectAlertRule: () => {
+    return {
+      id: '1',
+    };
+  },
+
+  ProjectAlertRuleConfiguration: () => {
+    return {
+      actions: [
+        {
+          html: 'Send a notification for all services',
+          id: 'sentry.rules.actions.notify1',
+          label: 'Send a notification for all services',
+        },
+      ],
+      conditions: [
+        {
+          html: 'An event is seen',
+          id: 'sentry.rules.conditions.1',
+          label: 'An event is seen',
+        },
+      ],
+    };
+  },
+
   Repository: params => {
     return {
       id: '4',
@@ -428,29 +453,38 @@ window.TestStubs = {
       ...params,
     };
   },
-  ProjectAlertRule: () => {
-    return {
-      id: '1',
-    };
-  },
-  ProjectAlertRuleConfiguration: () => {
-    return {
-      actions: [
-        {
-          html: 'Send a notification for all services',
-          id: 'sentry.rules.actions.notify1',
-          label: 'Send a notification for all services',
-        },
-      ],
-      conditions: [
-        {
-          html: 'An event is seen',
-          id: 'sentry.rules.conditions.1',
-          label: 'An event is seen',
-        },
-      ],
-    };
-  },
+
+  UserDetails: params => ({
+    username: 'billyfirefoxusername@test.com',
+    emails: [
+      {is_verified: false, id: '20', email: 'billyfirefox@test.com2'},
+      {is_verified: true, id: '8', email: 'billyfirefox2@test.com'},
+      {is_verified: false, id: '7', email: 'billyfirefox@test.com'},
+    ],
+    isManaged: false,
+    lastActive: '2018-01-25T21:00:19.946Z',
+    identities: [],
+    id: '4',
+    isActive: true,
+    has2fa: false,
+    name: 'Firefox Billy',
+    avatarUrl:
+      'https://secure.gravatar.com/avatar/5df53e28e63099658c1ba89b8e9a7cf4?s=32&d=mm',
+    authenticators: [],
+    dateJoined: '2018-01-11T00:30:41.366Z',
+    options: {
+      timezone: 'UTC',
+      seenReleaseBroadcast: null,
+      stacktraceOrder: 'default',
+      language: 'en',
+      clock24Hours: false,
+    },
+    avatar: {avatarUuid: null, avatarType: 'letter_avatar'},
+    lastLogin: '2018-01-25T19:57:46.973Z',
+    permissions: [],
+    email: 'billyfirefox@test.com',
+    ...params,
+  }),
 };
 
 // this is very commonly used, so expose it globally
diff --git a/tests/js/spec/components/forms/__snapshots__/radioGroup.spec.jsx.snap b/tests/js/spec/components/forms/__snapshots__/radioGroup.spec.jsx.snap
index 02eb088d0e..138c3713aa 100644
--- a/tests/js/spec/components/forms/__snapshots__/radioGroup.spec.jsx.snap
+++ b/tests/js/spec/components/forms/__snapshots__/radioGroup.spec.jsx.snap
@@ -2,6 +2,7 @@
 
 exports[`RadioGroup render() can select a different item 1`] = `
 <div
+  name="radio"
   role="radiogroup"
 >
   <RadioLineItem
@@ -52,6 +53,7 @@ exports[`RadioGroup render() can select a different item 1`] = `
 
 exports[`RadioGroup render() renders 1`] = `
 <div
+  name="radio"
   role="radiogroup"
 >
   <RadioLineItem
diff --git a/tests/js/spec/views/__snapshots__/accountAppearance.spec.jsx.snap b/tests/js/spec/views/__snapshots__/accountAppearance.spec.jsx.snap
deleted file mode 100644
index 2261e71b2b..0000000000
--- a/tests/js/spec/views/__snapshots__/accountAppearance.spec.jsx.snap
+++ /dev/null
@@ -1,1865 +0,0 @@
-// Jest Snapshot v1, https://goo.gl/fbAQLP
-
-exports[`AccountAppearance renders 1`] = `
-<SideEffect(DocumentTitle)
-  title="Sentry"
->
-  <div>
-    <Form
-      allowUndo={true}
-      apiEndpoint="/users/me/appearance/"
-      apiMethod="PUT"
-      cancelLabel="Cancel"
-      className="form-stacked"
-      footerClass="form-actions align-right"
-      initialData={
-        Object {
-          "clock_24_hours": true,
-          "language": "en",
-          "stacktrace_order": "2",
-          "timezone": "US/Pacific",
-        }
-      }
-      onSubmit={[Function]}
-      onSubmitError={[Function]}
-      onSubmitSuccess={[Function]}
-      requireChanges={false}
-      saveOnBlur={true}
-      submitDisabled={false}
-      submitLabel="Save Changes"
-    >
-      <Box>
-        <JsonForm
-          forms={
-            Array [
-              Object {
-                "fields": Array [
-                  Object {
-                    "choices": Array [
-                      Array [
-                        "-1",
-                        "Default (let Sentry decide)",
-                      ],
-                      Array [
-                        "1",
-                        "Most recent call last",
-                      ],
-                      Array [
-                        "2",
-                        "Most recent call first",
-                      ],
-                    ],
-                    "help": "Choose the default ordering of frames in stacktraces",
-                    "label": "Stacktrace Order",
-                    "name": "stacktraceOrder",
-                    "required": false,
-                    "type": "choice",
-                  },
-                ],
-                "title": "Events",
-              },
-              Object {
-                "fields": Array [
-                  Object {
-                    "choices": Array [
-                      Array [
-                        "ja",
-                        "Japanese",
-                      ],
-                      Array [
-                        "it",
-                        "Italian",
-                      ],
-                      Array [
-                        "zh-tw",
-                        "Traditional Chinese",
-                      ],
-                      Array [
-                        "cs",
-                        "Czech",
-                      ],
-                      Array [
-                        "ru",
-                        "Russian",
-                      ],
-                      Array [
-                        "zh-cn",
-                        "Simplified Chinese",
-                      ],
-                      Array [
-                        "bg",
-                        "Bulgarian",
-                      ],
-                      Array [
-                        "de",
-                        "German",
-                      ],
-                      Array [
-                        "fi",
-                        "Finnish",
-                      ],
-                      Array [
-                        "fr",
-                        "French",
-                      ],
-                      Array [
-                        "es",
-                        "Spanish",
-                      ],
-                      Array [
-                        "en",
-                        "English",
-                      ],
-                    ],
-                    "label": "Language",
-                    "name": "language",
-                    "type": "choice",
-                  },
-                  Object {
-                    "choices": Array [
-                      Array [
-                        "Pacific/Midway",
-                        "(UTC-1100) Pacific/Midway",
-                      ],
-                      Array [
-                        "Pacific/Niue",
-                        "(UTC-1100) Pacific/Niue",
-                      ],
-                      Array [
-                        "Pacific/Pago_Pago",
-                        "(UTC-1100) Pacific/Pago_Pago",
-                      ],
-                      Array [
-                        "America/Adak",
-                        "(UTC-1000) America/Adak",
-                      ],
-                      Array [
-                        "Pacific/Honolulu",
-                        "(UTC-1000) Pacific/Honolulu",
-                      ],
-                      Array [
-                        "Pacific/Johnston",
-                        "(UTC-1000) Pacific/Johnston",
-                      ],
-                      Array [
-                        "Pacific/Rarotonga",
-                        "(UTC-1000) Pacific/Rarotonga",
-                      ],
-                      Array [
-                        "Pacific/Tahiti",
-                        "(UTC-1000) Pacific/Tahiti",
-                      ],
-                      Array [
-                        "US/Hawaii",
-                        "(UTC-1000) US/Hawaii",
-                      ],
-                      Array [
-                        "Pacific/Marquesas",
-                        "(UTC-0930) Pacific/Marquesas",
-                      ],
-                      Array [
-                        "America/Anchorage",
-                        "(UTC-0900) America/Anchorage",
-                      ],
-                      Array [
-                        "America/Juneau",
-                        "(UTC-0900) America/Juneau",
-                      ],
-                      Array [
-                        "America/Metlakatla",
-                        "(UTC-0900) America/Metlakatla",
-                      ],
-                      Array [
-                        "America/Nome",
-                        "(UTC-0900) America/Nome",
-                      ],
-                      Array [
-                        "America/Sitka",
-                        "(UTC-0900) America/Sitka",
-                      ],
-                      Array [
-                        "America/Yakutat",
-                        "(UTC-0900) America/Yakutat",
-                      ],
-                      Array [
-                        "Pacific/Gambier",
-                        "(UTC-0900) Pacific/Gambier",
-                      ],
-                      Array [
-                        "US/Alaska",
-                        "(UTC-0900) US/Alaska",
-                      ],
-                      Array [
-                        "America/Dawson",
-                        "(UTC-0800) America/Dawson",
-                      ],
-                      Array [
-                        "America/Los_Angeles",
-                        "(UTC-0800) America/Los_Angeles",
-                      ],
-                      Array [
-                        "America/Tijuana",
-                        "(UTC-0800) America/Tijuana",
-                      ],
-                      Array [
-                        "America/Vancouver",
-                        "(UTC-0800) America/Vancouver",
-                      ],
-                      Array [
-                        "America/Whitehorse",
-                        "(UTC-0800) America/Whitehorse",
-                      ],
-                      Array [
-                        "Canada/Pacific",
-                        "(UTC-0800) Canada/Pacific",
-                      ],
-                      Array [
-                        "Pacific/Pitcairn",
-                        "(UTC-0800) Pacific/Pitcairn",
-                      ],
-                      Array [
-                        "US/Pacific",
-                        "(UTC-0800) US/Pacific",
-                      ],
-                      Array [
-                        "America/Boise",
-                        "(UTC-0700) America/Boise",
-                      ],
-                      Array [
-                        "America/Cambridge_Bay",
-                        "(UTC-0700) America/Cambridge_Bay",
-                      ],
-                      Array [
-                        "America/Chihuahua",
-                        "(UTC-0700) America/Chihuahua",
-                      ],
-                      Array [
-                        "America/Creston",
-                        "(UTC-0700) America/Creston",
-                      ],
-                      Array [
-                        "America/Dawson_Creek",
-                        "(UTC-0700) America/Dawson_Creek",
-                      ],
-                      Array [
-                        "America/Denver",
-                        "(UTC-0700) America/Denver",
-                      ],
-                      Array [
-                        "America/Edmonton",
-                        "(UTC-0700) America/Edmonton",
-                      ],
-                      Array [
-                        "America/Fort_Nelson",
-                        "(UTC-0700) America/Fort_Nelson",
-                      ],
-                      Array [
-                        "America/Hermosillo",
-                        "(UTC-0700) America/Hermosillo",
-                      ],
-                      Array [
-                        "America/Inuvik",
-                        "(UTC-0700) America/Inuvik",
-                      ],
-                      Array [
-                        "America/Mazatlan",
-                        "(UTC-0700) America/Mazatlan",
-                      ],
-                      Array [
-                        "America/Ojinaga",
-                        "(UTC-0700) America/Ojinaga",
-                      ],
-                      Array [
-                        "America/Phoenix",
-                        "(UTC-0700) America/Phoenix",
-                      ],
-                      Array [
-                        "America/Yellowknife",
-                        "(UTC-0700) America/Yellowknife",
-                      ],
-                      Array [
-                        "Canada/Mountain",
-                        "(UTC-0700) Canada/Mountain",
-                      ],
-                      Array [
-                        "US/Arizona",
-                        "(UTC-0700) US/Arizona",
-                      ],
-                      Array [
-                        "US/Mountain",
-                        "(UTC-0700) US/Mountain",
-                      ],
-                      Array [
-                        "America/Bahia_Banderas",
-                        "(UTC-0600) America/Bahia_Banderas",
-                      ],
-                      Array [
-                        "America/Belize",
-                        "(UTC-0600) America/Belize",
-                      ],
-                      Array [
-                        "America/Chicago",
-                        "(UTC-0600) America/Chicago",
-                      ],
-                      Array [
-                        "America/Costa_Rica",
-                        "(UTC-0600) America/Costa_Rica",
-                      ],
-                      Array [
-                        "America/El_Salvador",
-                        "(UTC-0600) America/El_Salvador",
-                      ],
-                      Array [
-                        "America/Guatemala",
-                        "(UTC-0600) America/Guatemala",
-                      ],
-                      Array [
-                        "America/Indiana/Knox",
-                        "(UTC-0600) America/Indiana/Knox",
-                      ],
-                      Array [
-                        "America/Indiana/Tell_City",
-                        "(UTC-0600) America/Indiana/Tell_City",
-                      ],
-                      Array [
-                        "America/Managua",
-                        "(UTC-0600) America/Managua",
-                      ],
-                      Array [
-                        "America/Matamoros",
-                        "(UTC-0600) America/Matamoros",
-                      ],
-                      Array [
-                        "America/Menominee",
-                        "(UTC-0600) America/Menominee",
-                      ],
-                      Array [
-                        "America/Merida",
-                        "(UTC-0600) America/Merida",
-                      ],
-                      Array [
-                        "America/Mexico_City",
-                        "(UTC-0600) America/Mexico_City",
-                      ],
-                      Array [
-                        "America/Monterrey",
-                        "(UTC-0600) America/Monterrey",
-                      ],
-                      Array [
-                        "America/North_Dakota/Beulah",
-                        "(UTC-0600) America/North_Dakota/Beulah",
-                      ],
-                      Array [
-                        "America/North_Dakota/Center",
-                        "(UTC-0600) America/North_Dakota/Center",
-                      ],
-                      Array [
-                        "America/North_Dakota/New_Salem",
-                        "(UTC-0600) America/North_Dakota/New_Salem",
-                      ],
-                      Array [
-                        "America/Rainy_River",
-                        "(UTC-0600) America/Rainy_River",
-                      ],
-                      Array [
-                        "America/Rankin_Inlet",
-                        "(UTC-0600) America/Rankin_Inlet",
-                      ],
-                      Array [
-                        "America/Regina",
-                        "(UTC-0600) America/Regina",
-                      ],
-                      Array [
-                        "America/Resolute",
-                        "(UTC-0600) America/Resolute",
-                      ],
-                      Array [
-                        "America/Swift_Current",
-                        "(UTC-0600) America/Swift_Current",
-                      ],
-                      Array [
-                        "America/Tegucigalpa",
-                        "(UTC-0600) America/Tegucigalpa",
-                      ],
-                      Array [
-                        "America/Winnipeg",
-                        "(UTC-0600) America/Winnipeg",
-                      ],
-                      Array [
-                        "Canada/Central",
-                        "(UTC-0600) Canada/Central",
-                      ],
-                      Array [
-                        "Pacific/Galapagos",
-                        "(UTC-0600) Pacific/Galapagos",
-                      ],
-                      Array [
-                        "US/Central",
-                        "(UTC-0600) US/Central",
-                      ],
-                      Array [
-                        "America/Atikokan",
-                        "(UTC-0500) America/Atikokan",
-                      ],
-                      Array [
-                        "America/Bogota",
-                        "(UTC-0500) America/Bogota",
-                      ],
-                      Array [
-                        "America/Cancun",
-                        "(UTC-0500) America/Cancun",
-                      ],
-                      Array [
-                        "America/Cayman",
-                        "(UTC-0500) America/Cayman",
-                      ],
-                      Array [
-                        "America/Detroit",
-                        "(UTC-0500) America/Detroit",
-                      ],
-                      Array [
-                        "America/Eirunepe",
-                        "(UTC-0500) America/Eirunepe",
-                      ],
-                      Array [
-                        "America/Guayaquil",
-                        "(UTC-0500) America/Guayaquil",
-                      ],
-                      Array [
-                        "America/Havana",
-                        "(UTC-0500) America/Havana",
-                      ],
-                      Array [
-                        "America/Indiana/Indianapolis",
-                        "(UTC-0500) America/Indiana/Indianapolis",
-                      ],
-                      Array [
-                        "America/Indiana/Marengo",
-                        "(UTC-0500) America/Indiana/Marengo",
-                      ],
-                      Array [
-                        "America/Indiana/Petersburg",
-                        "(UTC-0500) America/Indiana/Petersburg",
-                      ],
-                      Array [
-                        "America/Indiana/Vevay",
-                        "(UTC-0500) America/Indiana/Vevay",
-                      ],
-                      Array [
-                        "America/Indiana/Vincennes",
-                        "(UTC-0500) America/Indiana/Vincennes",
-                      ],
-                      Array [
-                        "America/Indiana/Winamac",
-                        "(UTC-0500) America/Indiana/Winamac",
-                      ],
-                      Array [
-                        "America/Iqaluit",
-                        "(UTC-0500) America/Iqaluit",
-                      ],
-                      Array [
-                        "America/Jamaica",
-                        "(UTC-0500) America/Jamaica",
-                      ],
-                      Array [
-                        "America/Kentucky/Louisville",
-                        "(UTC-0500) America/Kentucky/Louisville",
-                      ],
-                      Array [
-                        "America/Kentucky/Monticello",
-                        "(UTC-0500) America/Kentucky/Monticello",
-                      ],
-                      Array [
-                        "America/Lima",
-                        "(UTC-0500) America/Lima",
-                      ],
-                      Array [
-                        "America/Nassau",
-                        "(UTC-0500) America/Nassau",
-                      ],
-                      Array [
-                        "America/New_York",
-                        "(UTC-0500) America/New_York",
-                      ],
-                      Array [
-                        "America/Nipigon",
-                        "(UTC-0500) America/Nipigon",
-                      ],
-                      Array [
-                        "America/Panama",
-                        "(UTC-0500) America/Panama",
-                      ],
-                      Array [
-                        "America/Pangnirtung",
-                        "(UTC-0500) America/Pangnirtung",
-                      ],
-                      Array [
-                        "America/Port-au-Prince",
-                        "(UTC-0500) America/Port-au-Prince",
-                      ],
-                      Array [
-                        "America/Rio_Branco",
-                        "(UTC-0500) America/Rio_Branco",
-                      ],
-                      Array [
-                        "America/Thunder_Bay",
-                        "(UTC-0500) America/Thunder_Bay",
-                      ],
-                      Array [
-                        "America/Toronto",
-                        "(UTC-0500) America/Toronto",
-                      ],
-                      Array [
-                        "Canada/Eastern",
-                        "(UTC-0500) Canada/Eastern",
-                      ],
-                      Array [
-                        "Pacific/Easter",
-                        "(UTC-0500) Pacific/Easter",
-                      ],
-                      Array [
-                        "US/Eastern",
-                        "(UTC-0500) US/Eastern",
-                      ],
-                      Array [
-                        "America/Caracas",
-                        "(UTC-0430) America/Caracas",
-                      ],
-                      Array [
-                        "America/Anguilla",
-                        "(UTC-0400) America/Anguilla",
-                      ],
-                      Array [
-                        "America/Antigua",
-                        "(UTC-0400) America/Antigua",
-                      ],
-                      Array [
-                        "America/Aruba",
-                        "(UTC-0400) America/Aruba",
-                      ],
-                      Array [
-                        "America/Barbados",
-                        "(UTC-0400) America/Barbados",
-                      ],
-                      Array [
-                        "America/Blanc-Sablon",
-                        "(UTC-0400) America/Blanc-Sablon",
-                      ],
-                      Array [
-                        "America/Boa_Vista",
-                        "(UTC-0400) America/Boa_Vista",
-                      ],
-                      Array [
-                        "America/Curacao",
-                        "(UTC-0400) America/Curacao",
-                      ],
-                      Array [
-                        "America/Dominica",
-                        "(UTC-0400) America/Dominica",
-                      ],
-                      Array [
-                        "America/Glace_Bay",
-                        "(UTC-0400) America/Glace_Bay",
-                      ],
-                      Array [
-                        "America/Goose_Bay",
-                        "(UTC-0400) America/Goose_Bay",
-                      ],
-                      Array [
-                        "America/Grand_Turk",
-                        "(UTC-0400) America/Grand_Turk",
-                      ],
-                      Array [
-                        "America/Grenada",
-                        "(UTC-0400) America/Grenada",
-                      ],
-                      Array [
-                        "America/Guadeloupe",
-                        "(UTC-0400) America/Guadeloupe",
-                      ],
-                      Array [
-                        "America/Guyana",
-                        "(UTC-0400) America/Guyana",
-                      ],
-                      Array [
-                        "America/Halifax",
-                        "(UTC-0400) America/Halifax",
-                      ],
-                      Array [
-                        "America/Kralendijk",
-                        "(UTC-0400) America/Kralendijk",
-                      ],
-                      Array [
-                        "America/La_Paz",
-                        "(UTC-0400) America/La_Paz",
-                      ],
-                      Array [
-                        "America/Lower_Princes",
-                        "(UTC-0400) America/Lower_Princes",
-                      ],
-                      Array [
-                        "America/Manaus",
-                        "(UTC-0400) America/Manaus",
-                      ],
-                      Array [
-                        "America/Marigot",
-                        "(UTC-0400) America/Marigot",
-                      ],
-                      Array [
-                        "America/Martinique",
-                        "(UTC-0400) America/Martinique",
-                      ],
-                      Array [
-                        "America/Moncton",
-                        "(UTC-0400) America/Moncton",
-                      ],
-                      Array [
-                        "America/Montserrat",
-                        "(UTC-0400) America/Montserrat",
-                      ],
-                      Array [
-                        "America/Port_of_Spain",
-                        "(UTC-0400) America/Port_of_Spain",
-                      ],
-                      Array [
-                        "America/Porto_Velho",
-                        "(UTC-0400) America/Porto_Velho",
-                      ],
-                      Array [
-                        "America/Puerto_Rico",
-                        "(UTC-0400) America/Puerto_Rico",
-                      ],
-                      Array [
-                        "America/Santo_Domingo",
-                        "(UTC-0400) America/Santo_Domingo",
-                      ],
-                      Array [
-                        "America/St_Barthelemy",
-                        "(UTC-0400) America/St_Barthelemy",
-                      ],
-                      Array [
-                        "America/St_Kitts",
-                        "(UTC-0400) America/St_Kitts",
-                      ],
-                      Array [
-                        "America/St_Lucia",
-                        "(UTC-0400) America/St_Lucia",
-                      ],
-                      Array [
-                        "America/St_Thomas",
-                        "(UTC-0400) America/St_Thomas",
-                      ],
-                      Array [
-                        "America/St_Vincent",
-                        "(UTC-0400) America/St_Vincent",
-                      ],
-                      Array [
-                        "America/Thule",
-                        "(UTC-0400) America/Thule",
-                      ],
-                      Array [
-                        "America/Tortola",
-                        "(UTC-0400) America/Tortola",
-                      ],
-                      Array [
-                        "Atlantic/Bermuda",
-                        "(UTC-0400) Atlantic/Bermuda",
-                      ],
-                      Array [
-                        "Canada/Atlantic",
-                        "(UTC-0400) Canada/Atlantic",
-                      ],
-                      Array [
-                        "America/St_Johns",
-                        "(UTC-0330) America/St_Johns",
-                      ],
-                      Array [
-                        "Canada/Newfoundland",
-                        "(UTC-0330) Canada/Newfoundland",
-                      ],
-                      Array [
-                        "America/Araguaina",
-                        "(UTC-0300) America/Araguaina",
-                      ],
-                      Array [
-                        "America/Argentina/Buenos_Aires",
-                        "(UTC-0300) America/Argentina/Buenos_Aires",
-                      ],
-                      Array [
-                        "America/Argentina/Catamarca",
-                        "(UTC-0300) America/Argentina/Catamarca",
-                      ],
-                      Array [
-                        "America/Argentina/Cordoba",
-                        "(UTC-0300) America/Argentina/Cordoba",
-                      ],
-                      Array [
-                        "America/Argentina/Jujuy",
-                        "(UTC-0300) America/Argentina/Jujuy",
-                      ],
-                      Array [
-                        "America/Argentina/La_Rioja",
-                        "(UTC-0300) America/Argentina/La_Rioja",
-                      ],
-                      Array [
-                        "America/Argentina/Mendoza",
-                        "(UTC-0300) America/Argentina/Mendoza",
-                      ],
-                      Array [
-                        "America/Argentina/Rio_Gallegos",
-                        "(UTC-0300) America/Argentina/Rio_Gallegos",
-                      ],
-                      Array [
-                        "America/Argentina/Salta",
-                        "(UTC-0300) America/Argentina/Salta",
-                      ],
-                      Array [
-                        "America/Argentina/San_Juan",
-                        "(UTC-0300) America/Argentina/San_Juan",
-                      ],
-                      Array [
-                        "America/Argentina/San_Luis",
-                        "(UTC-0300) America/Argentina/San_Luis",
-                      ],
-                      Array [
-                        "America/Argentina/Tucuman",
-                        "(UTC-0300) America/Argentina/Tucuman",
-                      ],
-                      Array [
-                        "America/Argentina/Ushuaia",
-                        "(UTC-0300) America/Argentina/Ushuaia",
-                      ],
-                      Array [
-                        "America/Asuncion",
-                        "(UTC-0300) America/Asuncion",
-                      ],
-                      Array [
-                        "America/Bahia",
-                        "(UTC-0300) America/Bahia",
-                      ],
-                      Array [
-                        "America/Belem",
-                        "(UTC-0300) America/Belem",
-                      ],
-                      Array [
-                        "America/Campo_Grande",
-                        "(UTC-0300) America/Campo_Grande",
-                      ],
-                      Array [
-                        "America/Cayenne",
-                        "(UTC-0300) America/Cayenne",
-                      ],
-                      Array [
-                        "America/Cuiaba",
-                        "(UTC-0300) America/Cuiaba",
-                      ],
-                      Array [
-                        "America/Fortaleza",
-                        "(UTC-0300) America/Fortaleza",
-                      ],
-                      Array [
-                        "America/Godthab",
-                        "(UTC-0300) America/Godthab",
-                      ],
-                      Array [
-                        "America/Maceio",
-                        "(UTC-0300) America/Maceio",
-                      ],
-                      Array [
-                        "America/Miquelon",
-                        "(UTC-0300) America/Miquelon",
-                      ],
-                      Array [
-                        "America/Montevideo",
-                        "(UTC-0300) America/Montevideo",
-                      ],
-                      Array [
-                        "America/Paramaribo",
-                        "(UTC-0300) America/Paramaribo",
-                      ],
-                      Array [
-                        "America/Recife",
-                        "(UTC-0300) America/Recife",
-                      ],
-                      Array [
-                        "America/Santarem",
-                        "(UTC-0300) America/Santarem",
-                      ],
-                      Array [
-                        "America/Santiago",
-                        "(UTC-0300) America/Santiago",
-                      ],
-                      Array [
-                        "Antarctica/Palmer",
-                        "(UTC-0300) Antarctica/Palmer",
-                      ],
-                      Array [
-                        "Antarctica/Rothera",
-                        "(UTC-0300) Antarctica/Rothera",
-                      ],
-                      Array [
-                        "Atlantic/Stanley",
-                        "(UTC-0300) Atlantic/Stanley",
-                      ],
-                      Array [
-                        "America/Noronha",
-                        "(UTC-0200) America/Noronha",
-                      ],
-                      Array [
-                        "America/Sao_Paulo",
-                        "(UTC-0200) America/Sao_Paulo",
-                      ],
-                      Array [
-                        "Atlantic/South_Georgia",
-                        "(UTC-0200) Atlantic/South_Georgia",
-                      ],
-                      Array [
-                        "America/Scoresbysund",
-                        "(UTC-0100) America/Scoresbysund",
-                      ],
-                      Array [
-                        "Atlantic/Azores",
-                        "(UTC-0100) Atlantic/Azores",
-                      ],
-                      Array [
-                        "Atlantic/Cape_Verde",
-                        "(UTC-0100) Atlantic/Cape_Verde",
-                      ],
-                      Array [
-                        "Africa/Abidjan",
-                        "(UTC+0000) Africa/Abidjan",
-                      ],
-                      Array [
-                        "Africa/Accra",
-                        "(UTC+0000) Africa/Accra",
-                      ],
-                      Array [
-                        "Africa/Bamako",
-                        "(UTC+0000) Africa/Bamako",
-                      ],
-                      Array [
-                        "Africa/Banjul",
-                        "(UTC+0000) Africa/Banjul",
-                      ],
-                      Array [
-                        "Africa/Bissau",
-                        "(UTC+0000) Africa/Bissau",
-                      ],
-                      Array [
-                        "Africa/Casablanca",
-                        "(UTC+0000) Africa/Casablanca",
-                      ],
-                      Array [
-                        "Africa/Conakry",
-                        "(UTC+0000) Africa/Conakry",
-                      ],
-                      Array [
-                        "Africa/Dakar",
-                        "(UTC+0000) Africa/Dakar",
-                      ],
-                      Array [
-                        "Africa/El_Aaiun",
-                        "(UTC+0000) Africa/El_Aaiun",
-                      ],
-                      Array [
-                        "Africa/Freetown",
-                        "(UTC+0000) Africa/Freetown",
-                      ],
-                      Array [
-                        "Africa/Lome",
-                        "(UTC+0000) Africa/Lome",
-                      ],
-                      Array [
-                        "Africa/Monrovia",
-                        "(UTC+0000) Africa/Monrovia",
-                      ],
-                      Array [
-                        "Africa/Nouakchott",
-                        "(UTC+0000) Africa/Nouakchott",
-                      ],
-                      Array [
-                        "Africa/Ouagadougou",
-                        "(UTC+0000) Africa/Ouagadougou",
-                      ],
-                      Array [
-                        "Africa/Sao_Tome",
-                        "(UTC+0000) Africa/Sao_Tome",
-                      ],
-                      Array [
-                        "America/Danmarkshavn",
-                        "(UTC+0000) America/Danmarkshavn",
-                      ],
-                      Array [
-                        "Antarctica/Troll",
-                        "(UTC+0000) Antarctica/Troll",
-                      ],
-                      Array [
-                        "Atlantic/Canary",
-                        "(UTC+0000) Atlantic/Canary",
-                      ],
-                      Array [
-                        "Atlantic/Faroe",
-                        "(UTC+0000) Atlantic/Faroe",
-                      ],
-                      Array [
-                        "Atlantic/Madeira",
-                        "(UTC+0000) Atlantic/Madeira",
-                      ],
-                      Array [
-                        "Atlantic/Reykjavik",
-                        "(UTC+0000) Atlantic/Reykjavik",
-                      ],
-                      Array [
-                        "Atlantic/St_Helena",
-                        "(UTC+0000) Atlantic/St_Helena",
-                      ],
-                      Array [
-                        "Europe/Dublin",
-                        "(UTC+0000) Europe/Dublin",
-                      ],
-                      Array [
-                        "Europe/Guernsey",
-                        "(UTC+0000) Europe/Guernsey",
-                      ],
-                      Array [
-                        "Europe/Isle_of_Man",
-                        "(UTC+0000) Europe/Isle_of_Man",
-                      ],
-                      Array [
-                        "Europe/Jersey",
-                        "(UTC+0000) Europe/Jersey",
-                      ],
-                      Array [
-                        "Europe/Lisbon",
-                        "(UTC+0000) Europe/Lisbon",
-                      ],
-                      Array [
-                        "Europe/London",
-                        "(UTC+0000) Europe/London",
-                      ],
-                      Array [
-                        "GMT",
-                        "(UTC+0000) GMT",
-                      ],
-                      Array [
-                        "UTC",
-                        "(UTC+0000) UTC",
-                      ],
-                      Array [
-                        "Africa/Algiers",
-                        "(UTC+0100) Africa/Algiers",
-                      ],
-                      Array [
-                        "Africa/Bangui",
-                        "(UTC+0100) Africa/Bangui",
-                      ],
-                      Array [
-                        "Africa/Brazzaville",
-                        "(UTC+0100) Africa/Brazzaville",
-                      ],
-                      Array [
-                        "Africa/Ceuta",
-                        "(UTC+0100) Africa/Ceuta",
-                      ],
-                      Array [
-                        "Africa/Douala",
-                        "(UTC+0100) Africa/Douala",
-                      ],
-                      Array [
-                        "Africa/Kinshasa",
-                        "(UTC+0100) Africa/Kinshasa",
-                      ],
-                      Array [
-                        "Africa/Lagos",
-                        "(UTC+0100) Africa/Lagos",
-                      ],
-                      Array [
-                        "Africa/Libreville",
-                        "(UTC+0100) Africa/Libreville",
-                      ],
-                      Array [
-                        "Africa/Luanda",
-                        "(UTC+0100) Africa/Luanda",
-                      ],
-                      Array [
-                        "Africa/Malabo",
-                        "(UTC+0100) Africa/Malabo",
-                      ],
-                      Array [
-                        "Africa/Ndjamena",
-                        "(UTC+0100) Africa/Ndjamena",
-                      ],
-                      Array [
-                        "Africa/Niamey",
-                        "(UTC+0100) Africa/Niamey",
-                      ],
-                      Array [
-                        "Africa/Porto-Novo",
-                        "(UTC+0100) Africa/Porto-Novo",
-                      ],
-                      Array [
-                        "Africa/Tunis",
-                        "(UTC+0100) Africa/Tunis",
-                      ],
-                      Array [
-                        "Arctic/Longyearbyen",
-                        "(UTC+0100) Arctic/Longyearbyen",
-                      ],
-                      Array [
-                        "Europe/Amsterdam",
-                        "(UTC+0100) Europe/Amsterdam",
-                      ],
-                      Array [
-                        "Europe/Andorra",
-                        "(UTC+0100) Europe/Andorra",
-                      ],
-                      Array [
-                        "Europe/Belgrade",
-                        "(UTC+0100) Europe/Belgrade",
-                      ],
-                      Array [
-                        "Europe/Berlin",
-                        "(UTC+0100) Europe/Berlin",
-                      ],
-                      Array [
-                        "Europe/Bratislava",
-                        "(UTC+0100) Europe/Bratislava",
-                      ],
-                      Array [
-                        "Europe/Brussels",
-                        "(UTC+0100) Europe/Brussels",
-                      ],
-                      Array [
-                        "Europe/Budapest",
-                        "(UTC+0100) Europe/Budapest",
-                      ],
-                      Array [
-                        "Europe/Busingen",
-                        "(UTC+0100) Europe/Busingen",
-                      ],
-                      Array [
-                        "Europe/Copenhagen",
-                        "(UTC+0100) Europe/Copenhagen",
-                      ],
-                      Array [
-                        "Europe/Gibraltar",
-                        "(UTC+0100) Europe/Gibraltar",
-                      ],
-                      Array [
-                        "Europe/Ljubljana",
-                        "(UTC+0100) Europe/Ljubljana",
-                      ],
-                      Array [
-                        "Europe/Luxembourg",
-                        "(UTC+0100) Europe/Luxembourg",
-                      ],
-                      Array [
-                        "Europe/Madrid",
-                        "(UTC+0100) Europe/Madrid",
-                      ],
-                      Array [
-                        "Europe/Malta",
-                        "(UTC+0100) Europe/Malta",
-                      ],
-                      Array [
-                        "Europe/Monaco",
-                        "(UTC+0100) Europe/Monaco",
-                      ],
-                      Array [
-                        "Europe/Oslo",
-                        "(UTC+0100) Europe/Oslo",
-                      ],
-                      Array [
-                        "Europe/Paris",
-                        "(UTC+0100) Europe/Paris",
-                      ],
-                      Array [
-                        "Europe/Podgorica",
-                        "(UTC+0100) Europe/Podgorica",
-                      ],
-                      Array [
-                        "Europe/Prague",
-                        "(UTC+0100) Europe/Prague",
-                      ],
-                      Array [
-                        "Europe/Rome",
-                        "(UTC+0100) Europe/Rome",
-                      ],
-                      Array [
-                        "Europe/San_Marino",
-                        "(UTC+0100) Europe/San_Marino",
-                      ],
-                      Array [
-                        "Europe/Sarajevo",
-                        "(UTC+0100) Europe/Sarajevo",
-                      ],
-                      Array [
-                        "Europe/Skopje",
-                        "(UTC+0100) Europe/Skopje",
-                      ],
-                      Array [
-                        "Europe/Stockholm",
-                        "(UTC+0100) Europe/Stockholm",
-                      ],
-                      Array [
-                        "Europe/Tirane",
-                        "(UTC+0100) Europe/Tirane",
-                      ],
-                      Array [
-                        "Europe/Vaduz",
-                        "(UTC+0100) Europe/Vaduz",
-                      ],
-                      Array [
-                        "Europe/Vatican",
-                        "(UTC+0100) Europe/Vatican",
-                      ],
-                      Array [
-                        "Europe/Vienna",
-                        "(UTC+0100) Europe/Vienna",
-                      ],
-                      Array [
-                        "Europe/Warsaw",
-                        "(UTC+0100) Europe/Warsaw",
-                      ],
-                      Array [
-                        "Europe/Zagreb",
-                        "(UTC+0100) Europe/Zagreb",
-                      ],
-                      Array [
-                        "Europe/Zurich",
-                        "(UTC+0100) Europe/Zurich",
-                      ],
-                      Array [
-                        "Africa/Blantyre",
-                        "(UTC+0200) Africa/Blantyre",
-                      ],
-                      Array [
-                        "Africa/Bujumbura",
-                        "(UTC+0200) Africa/Bujumbura",
-                      ],
-                      Array [
-                        "Africa/Cairo",
-                        "(UTC+0200) Africa/Cairo",
-                      ],
-                      Array [
-                        "Africa/Gaborone",
-                        "(UTC+0200) Africa/Gaborone",
-                      ],
-                      Array [
-                        "Africa/Harare",
-                        "(UTC+0200) Africa/Harare",
-                      ],
-                      Array [
-                        "Africa/Johannesburg",
-                        "(UTC+0200) Africa/Johannesburg",
-                      ],
-                      Array [
-                        "Africa/Kigali",
-                        "(UTC+0200) Africa/Kigali",
-                      ],
-                      Array [
-                        "Africa/Lubumbashi",
-                        "(UTC+0200) Africa/Lubumbashi",
-                      ],
-                      Array [
-                        "Africa/Lusaka",
-                        "(UTC+0200) Africa/Lusaka",
-                      ],
-                      Array [
-                        "Africa/Maputo",
-                        "(UTC+0200) Africa/Maputo",
-                      ],
-                      Array [
-                        "Africa/Maseru",
-                        "(UTC+0200) Africa/Maseru",
-                      ],
-                      Array [
-                        "Africa/Mbabane",
-                        "(UTC+0200) Africa/Mbabane",
-                      ],
-                      Array [
-                        "Africa/Tripoli",
-                        "(UTC+0200) Africa/Tripoli",
-                      ],
-                      Array [
-                        "Africa/Windhoek",
-                        "(UTC+0200) Africa/Windhoek",
-                      ],
-                      Array [
-                        "Asia/Amman",
-                        "(UTC+0200) Asia/Amman",
-                      ],
-                      Array [
-                        "Asia/Beirut",
-                        "(UTC+0200) Asia/Beirut",
-                      ],
-                      Array [
-                        "Asia/Damascus",
-                        "(UTC+0200) Asia/Damascus",
-                      ],
-                      Array [
-                        "Asia/Gaza",
-                        "(UTC+0200) Asia/Gaza",
-                      ],
-                      Array [
-                        "Asia/Hebron",
-                        "(UTC+0200) Asia/Hebron",
-                      ],
-                      Array [
-                        "Asia/Jerusalem",
-                        "(UTC+0200) Asia/Jerusalem",
-                      ],
-                      Array [
-                        "Asia/Nicosia",
-                        "(UTC+0200) Asia/Nicosia",
-                      ],
-                      Array [
-                        "Europe/Athens",
-                        "(UTC+0200) Europe/Athens",
-                      ],
-                      Array [
-                        "Europe/Bucharest",
-                        "(UTC+0200) Europe/Bucharest",
-                      ],
-                      Array [
-                        "Europe/Chisinau",
-                        "(UTC+0200) Europe/Chisinau",
-                      ],
-                      Array [
-                        "Europe/Helsinki",
-                        "(UTC+0200) Europe/Helsinki",
-                      ],
-                      Array [
-                        "Europe/Istanbul",
-                        "(UTC+0200) Europe/Istanbul",
-                      ],
-                      Array [
-                        "Europe/Kaliningrad",
-                        "(UTC+0200) Europe/Kaliningrad",
-                      ],
-                      Array [
-                        "Europe/Kiev",
-                        "(UTC+0200) Europe/Kiev",
-                      ],
-                      Array [
-                        "Europe/Mariehamn",
-                        "(UTC+0200) Europe/Mariehamn",
-                      ],
-                      Array [
-                        "Europe/Riga",
-                        "(UTC+0200) Europe/Riga",
-                      ],
-                      Array [
-                        "Europe/Sofia",
-                        "(UTC+0200) Europe/Sofia",
-                      ],
-                      Array [
-                        "Europe/Tallinn",
-                        "(UTC+0200) Europe/Tallinn",
-                      ],
-                      Array [
-                        "Europe/Uzhgorod",
-                        "(UTC+0200) Europe/Uzhgorod",
-                      ],
-                      Array [
-                        "Europe/Vilnius",
-                        "(UTC+0200) Europe/Vilnius",
-                      ],
-                      Array [
-                        "Europe/Zaporozhye",
-                        "(UTC+0200) Europe/Zaporozhye",
-                      ],
-                      Array [
-                        "Africa/Addis_Ababa",
-                        "(UTC+0300) Africa/Addis_Ababa",
-                      ],
-                      Array [
-                        "Africa/Asmara",
-                        "(UTC+0300) Africa/Asmara",
-                      ],
-                      Array [
-                        "Africa/Dar_es_Salaam",
-                        "(UTC+0300) Africa/Dar_es_Salaam",
-                      ],
-                      Array [
-                        "Africa/Djibouti",
-                        "(UTC+0300) Africa/Djibouti",
-                      ],
-                      Array [
-                        "Africa/Juba",
-                        "(UTC+0300) Africa/Juba",
-                      ],
-                      Array [
-                        "Africa/Kampala",
-                        "(UTC+0300) Africa/Kampala",
-                      ],
-                      Array [
-                        "Africa/Khartoum",
-                        "(UTC+0300) Africa/Khartoum",
-                      ],
-                      Array [
-                        "Africa/Mogadishu",
-                        "(UTC+0300) Africa/Mogadishu",
-                      ],
-                      Array [
-                        "Africa/Nairobi",
-                        "(UTC+0300) Africa/Nairobi",
-                      ],
-                      Array [
-                        "Antarctica/Syowa",
-                        "(UTC+0300) Antarctica/Syowa",
-                      ],
-                      Array [
-                        "Asia/Aden",
-                        "(UTC+0300) Asia/Aden",
-                      ],
-                      Array [
-                        "Asia/Baghdad",
-                        "(UTC+0300) Asia/Baghdad",
-                      ],
-                      Array [
-                        "Asia/Bahrain",
-                        "(UTC+0300) Asia/Bahrain",
-                      ],
-                      Array [
-                        "Asia/Kuwait",
-                        "(UTC+0300) Asia/Kuwait",
-                      ],
-                      Array [
-                        "Asia/Qatar",
-                        "(UTC+0300) Asia/Qatar",
-                      ],
-                      Array [
-                        "Asia/Riyadh",
-                        "(UTC+0300) Asia/Riyadh",
-                      ],
-                      Array [
-                        "Europe/Minsk",
-                        "(UTC+0300) Europe/Minsk",
-                      ],
-                      Array [
-                        "Europe/Moscow",
-                        "(UTC+0300) Europe/Moscow",
-                      ],
-                      Array [
-                        "Europe/Simferopol",
-                        "(UTC+0300) Europe/Simferopol",
-                      ],
-                      Array [
-                        "Europe/Volgograd",
-                        "(UTC+0300) Europe/Volgograd",
-                      ],
-                      Array [
-                        "Indian/Antananarivo",
-                        "(UTC+0300) Indian/Antananarivo",
-                      ],
-                      Array [
-                        "Indian/Comoro",
-                        "(UTC+0300) Indian/Comoro",
-                      ],
-                      Array [
-                        "Indian/Mayotte",
-                        "(UTC+0300) Indian/Mayotte",
-                      ],
-                      Array [
-                        "Asia/Tehran",
-                        "(UTC+0330) Asia/Tehran",
-                      ],
-                      Array [
-                        "Asia/Baku",
-                        "(UTC+0400) Asia/Baku",
-                      ],
-                      Array [
-                        "Asia/Dubai",
-                        "(UTC+0400) Asia/Dubai",
-                      ],
-                      Array [
-                        "Asia/Muscat",
-                        "(UTC+0400) Asia/Muscat",
-                      ],
-                      Array [
-                        "Asia/Tbilisi",
-                        "(UTC+0400) Asia/Tbilisi",
-                      ],
-                      Array [
-                        "Asia/Yerevan",
-                        "(UTC+0400) Asia/Yerevan",
-                      ],
-                      Array [
-                        "Europe/Samara",
-                        "(UTC+0400) Europe/Samara",
-                      ],
-                      Array [
-                        "Indian/Mahe",
-                        "(UTC+0400) Indian/Mahe",
-                      ],
-                      Array [
-                        "Indian/Mauritius",
-                        "(UTC+0400) Indian/Mauritius",
-                      ],
-                      Array [
-                        "Indian/Reunion",
-                        "(UTC+0400) Indian/Reunion",
-                      ],
-                      Array [
-                        "Asia/Kabul",
-                        "(UTC+0430) Asia/Kabul",
-                      ],
-                      Array [
-                        "Antarctica/Mawson",
-                        "(UTC+0500) Antarctica/Mawson",
-                      ],
-                      Array [
-                        "Asia/Aqtau",
-                        "(UTC+0500) Asia/Aqtau",
-                      ],
-                      Array [
-                        "Asia/Aqtobe",
-                        "(UTC+0500) Asia/Aqtobe",
-                      ],
-                      Array [
-                        "Asia/Ashgabat",
-                        "(UTC+0500) Asia/Ashgabat",
-                      ],
-                      Array [
-                        "Asia/Dushanbe",
-                        "(UTC+0500) Asia/Dushanbe",
-                      ],
-                      Array [
-                        "Asia/Karachi",
-                        "(UTC+0500) Asia/Karachi",
-                      ],
-                      Array [
-                        "Asia/Oral",
-                        "(UTC+0500) Asia/Oral",
-                      ],
-                      Array [
-                        "Asia/Samarkand",
-                        "(UTC+0500) Asia/Samarkand",
-                      ],
-                      Array [
-                        "Asia/Tashkent",
-                        "(UTC+0500) Asia/Tashkent",
-                      ],
-                      Array [
-                        "Asia/Yekaterinburg",
-                        "(UTC+0500) Asia/Yekaterinburg",
-                      ],
-                      Array [
-                        "Indian/Kerguelen",
-                        "(UTC+0500) Indian/Kerguelen",
-                      ],
-                      Array [
-                        "Indian/Maldives",
-                        "(UTC+0500) Indian/Maldives",
-                      ],
-                      Array [
-                        "Asia/Colombo",
-                        "(UTC+0530) Asia/Colombo",
-                      ],
-                      Array [
-                        "Asia/Kolkata",
-                        "(UTC+0530) Asia/Kolkata",
-                      ],
-                      Array [
-                        "Asia/Kathmandu",
-                        "(UTC+0545) Asia/Kathmandu",
-                      ],
-                      Array [
-                        "Antarctica/Vostok",
-                        "(UTC+0600) Antarctica/Vostok",
-                      ],
-                      Array [
-                        "Asia/Almaty",
-                        "(UTC+0600) Asia/Almaty",
-                      ],
-                      Array [
-                        "Asia/Bishkek",
-                        "(UTC+0600) Asia/Bishkek",
-                      ],
-                      Array [
-                        "Asia/Dhaka",
-                        "(UTC+0600) Asia/Dhaka",
-                      ],
-                      Array [
-                        "Asia/Novosibirsk",
-                        "(UTC+0600) Asia/Novosibirsk",
-                      ],
-                      Array [
-                        "Asia/Omsk",
-                        "(UTC+0600) Asia/Omsk",
-                      ],
-                      Array [
-                        "Asia/Qyzylorda",
-                        "(UTC+0600) Asia/Qyzylorda",
-                      ],
-                      Array [
-                        "Asia/Thimphu",
-                        "(UTC+0600) Asia/Thimphu",
-                      ],
-                      Array [
-                        "Asia/Urumqi",
-                        "(UTC+0600) Asia/Urumqi",
-                      ],
-                      Array [
-                        "Indian/Chagos",
-                        "(UTC+0600) Indian/Chagos",
-                      ],
-                      Array [
-                        "Asia/Rangoon",
-                        "(UTC+0630) Asia/Rangoon",
-                      ],
-                      Array [
-                        "Indian/Cocos",
-                        "(UTC+0630) Indian/Cocos",
-                      ],
-                      Array [
-                        "Antarctica/Davis",
-                        "(UTC+0700) Antarctica/Davis",
-                      ],
-                      Array [
-                        "Asia/Bangkok",
-                        "(UTC+0700) Asia/Bangkok",
-                      ],
-                      Array [
-                        "Asia/Ho_Chi_Minh",
-                        "(UTC+0700) Asia/Ho_Chi_Minh",
-                      ],
-                      Array [
-                        "Asia/Hovd",
-                        "(UTC+0700) Asia/Hovd",
-                      ],
-                      Array [
-                        "Asia/Jakarta",
-                        "(UTC+0700) Asia/Jakarta",
-                      ],
-                      Array [
-                        "Asia/Krasnoyarsk",
-                        "(UTC+0700) Asia/Krasnoyarsk",
-                      ],
-                      Array [
-                        "Asia/Novokuznetsk",
-                        "(UTC+0700) Asia/Novokuznetsk",
-                      ],
-                      Array [
-                        "Asia/Phnom_Penh",
-                        "(UTC+0700) Asia/Phnom_Penh",
-                      ],
-                      Array [
-                        "Asia/Pontianak",
-                        "(UTC+0700) Asia/Pontianak",
-                      ],
-                      Array [
-                        "Asia/Vientiane",
-                        "(UTC+0700) Asia/Vientiane",
-                      ],
-                      Array [
-                        "Indian/Christmas",
-                        "(UTC+0700) Indian/Christmas",
-                      ],
-                      Array [
-                        "Antarctica/Casey",
-                        "(UTC+0800) Antarctica/Casey",
-                      ],
-                      Array [
-                        "Asia/Brunei",
-                        "(UTC+0800) Asia/Brunei",
-                      ],
-                      Array [
-                        "Asia/Choibalsan",
-                        "(UTC+0800) Asia/Choibalsan",
-                      ],
-                      Array [
-                        "Asia/Hong_Kong",
-                        "(UTC+0800) Asia/Hong_Kong",
-                      ],
-                      Array [
-                        "Asia/Irkutsk",
-                        "(UTC+0800) Asia/Irkutsk",
-                      ],
-                      Array [
-                        "Asia/Kuala_Lumpur",
-                        "(UTC+0800) Asia/Kuala_Lumpur",
-                      ],
-                      Array [
-                        "Asia/Kuching",
-                        "(UTC+0800) Asia/Kuching",
-                      ],
-                      Array [
-                        "Asia/Macau",
-                        "(UTC+0800) Asia/Macau",
-                      ],
-                      Array [
-                        "Asia/Makassar",
-                        "(UTC+0800) Asia/Makassar",
-                      ],
-                      Array [
-                        "Asia/Manila",
-                        "(UTC+0800) Asia/Manila",
-                      ],
-                      Array [
-                        "Asia/Shanghai",
-                        "(UTC+0800) Asia/Shanghai",
-                      ],
-                      Array [
-                        "Asia/Singapore",
-                        "(UTC+0800) Asia/Singapore",
-                      ],
-                      Array [
-                        "Asia/Taipei",
-                        "(UTC+0800) Asia/Taipei",
-                      ],
-                      Array [
-                        "Asia/Ulaanbaatar",
-                        "(UTC+0800) Asia/Ulaanbaatar",
-                      ],
-                      Array [
-                        "Australia/Perth",
-                        "(UTC+0800) Australia/Perth",
-                      ],
-                      Array [
-                        "Asia/Pyongyang",
-                        "(UTC+0830) Asia/Pyongyang",
-                      ],
-                      Array [
-                        "Australia/Eucla",
-                        "(UTC+0845) Australia/Eucla",
-                      ],
-                      Array [
-                        "Asia/Chita",
-                        "(UTC+0900) Asia/Chita",
-                      ],
-                      Array [
-                        "Asia/Dili",
-                        "(UTC+0900) Asia/Dili",
-                      ],
-                      Array [
-                        "Asia/Jayapura",
-                        "(UTC+0900) Asia/Jayapura",
-                      ],
-                      Array [
-                        "Asia/Khandyga",
-                        "(UTC+0900) Asia/Khandyga",
-                      ],
-                      Array [
-                        "Asia/Seoul",
-                        "(UTC+0900) Asia/Seoul",
-                      ],
-                      Array [
-                        "Asia/Tokyo",
-                        "(UTC+0900) Asia/Tokyo",
-                      ],
-                      Array [
-                        "Asia/Yakutsk",
-                        "(UTC+0900) Asia/Yakutsk",
-                      ],
-                      Array [
-                        "Pacific/Palau",
-                        "(UTC+0900) Pacific/Palau",
-                      ],
-                      Array [
-                        "Australia/Darwin",
-                        "(UTC+0930) Australia/Darwin",
-                      ],
-                      Array [
-                        "Antarctica/DumontDUrville",
-                        "(UTC+1000) Antarctica/DumontDUrville",
-                      ],
-                      Array [
-                        "Asia/Magadan",
-                        "(UTC+1000) Asia/Magadan",
-                      ],
-                      Array [
-                        "Asia/Sakhalin",
-                        "(UTC+1000) Asia/Sakhalin",
-                      ],
-                      Array [
-                        "Asia/Ust-Nera",
-                        "(UTC+1000) Asia/Ust-Nera",
-                      ],
-                      Array [
-                        "Asia/Vladivostok",
-                        "(UTC+1000) Asia/Vladivostok",
-                      ],
-                      Array [
-                        "Australia/Brisbane",
-                        "(UTC+1000) Australia/Brisbane",
-                      ],
-                      Array [
-                        "Australia/Lindeman",
-                        "(UTC+1000) Australia/Lindeman",
-                      ],
-                      Array [
-                        "Pacific/Chuuk",
-                        "(UTC+1000) Pacific/Chuuk",
-                      ],
-                      Array [
-                        "Pacific/Guam",
-                        "(UTC+1000) Pacific/Guam",
-                      ],
-                      Array [
-                        "Pacific/Port_Moresby",
-                        "(UTC+1000) Pacific/Port_Moresby",
-                      ],
-                      Array [
-                        "Pacific/Saipan",
-                        "(UTC+1000) Pacific/Saipan",
-                      ],
-                      Array [
-                        "Australia/Adelaide",
-                        "(UTC+1030) Australia/Adelaide",
-                      ],
-                      Array [
-                        "Australia/Broken_Hill",
-                        "(UTC+1030) Australia/Broken_Hill",
-                      ],
-                      Array [
-                        "Antarctica/Macquarie",
-                        "(UTC+1100) Antarctica/Macquarie",
-                      ],
-                      Array [
-                        "Asia/Srednekolymsk",
-                        "(UTC+1100) Asia/Srednekolymsk",
-                      ],
-                      Array [
-                        "Australia/Currie",
-                        "(UTC+1100) Australia/Currie",
-                      ],
-                      Array [
-                        "Australia/Hobart",
-                        "(UTC+1100) Australia/Hobart",
-                      ],
-                      Array [
-                        "Australia/Lord_Howe",
-                        "(UTC+1100) Australia/Lord_Howe",
-                      ],
-                      Array [
-                        "Australia/Melbourne",
-                        "(UTC+1100) Australia/Melbourne",
-                      ],
-                      Array [
-                        "Australia/Sydney",
-                        "(UTC+1100) Australia/Sydney",
-                      ],
-                      Array [
-                        "Pacific/Bougainville",
-                        "(UTC+1100) Pacific/Bougainville",
-                      ],
-                      Array [
-                        "Pacific/Efate",
-                        "(UTC+1100) Pacific/Efate",
-                      ],
-                      Array [
-                        "Pacific/Guadalcanal",
-                        "(UTC+1100) Pacific/Guadalcanal",
-                      ],
-                      Array [
-                        "Pacific/Kosrae",
-                        "(UTC+1100) Pacific/Kosrae",
-                      ],
-                      Array [
-                        "Pacific/Norfolk",
-                        "(UTC+1100) Pacific/Norfolk",
-                      ],
-                      Array [
-                        "Pacific/Noumea",
-                        "(UTC+1100) Pacific/Noumea",
-                      ],
-                      Array [
-                        "Pacific/Pohnpei",
-                        "(UTC+1100) Pacific/Pohnpei",
-                      ],
-                      Array [
-                        "Asia/Anadyr",
-                        "(UTC+1200) Asia/Anadyr",
-                      ],
-                      Array [
-                        "Asia/Kamchatka",
-                        "(UTC+1200) Asia/Kamchatka",
-                      ],
-                      Array [
-                        "Pacific/Funafuti",
-                        "(UTC+1200) Pacific/Funafuti",
-                      ],
-                      Array [
-                        "Pacific/Kwajalein",
-                        "(UTC+1200) Pacific/Kwajalein",
-                      ],
-                      Array [
-                        "Pacific/Majuro",
-                        "(UTC+1200) Pacific/Majuro",
-                      ],
-                      Array [
-                        "Pacific/Nauru",
-                        "(UTC+1200) Pacific/Nauru",
-                      ],
-                      Array [
-                        "Pacific/Tarawa",
-                        "(UTC+1200) Pacific/Tarawa",
-                      ],
-                      Array [
-                        "Pacific/Wake",
-                        "(UTC+1200) Pacific/Wake",
-                      ],
-                      Array [
-                        "Pacific/Wallis",
-                        "(UTC+1200) Pacific/Wallis",
-                      ],
-                      Array [
-                        "Antarctica/McMurdo",
-                        "(UTC+1300) Antarctica/McMurdo",
-                      ],
-                      Array [
-                        "Pacific/Auckland",
-                        "(UTC+1300) Pacific/Auckland",
-                      ],
-                      Array [
-                        "Pacific/Enderbury",
-                        "(UTC+1300) Pacific/Enderbury",
-                      ],
-                      Array [
-                        "Pacific/Fakaofo",
-                        "(UTC+1300) Pacific/Fakaofo",
-                      ],
-                      Array [
-                        "Pacific/Fiji",
-                        "(UTC+1300) Pacific/Fiji",
-                      ],
-                      Array [
-                        "Pacific/Tongatapu",
-                        "(UTC+1300) Pacific/Tongatapu",
-                      ],
-                      Array [
-                        "Pacific/Chatham",
-                        "(UTC+1345) Pacific/Chatham",
-                      ],
-                      Array [
-                        "Pacific/Apia",
-                        "(UTC+1400) Pacific/Apia",
-                      ],
-                      Array [
-                        "Pacific/Kiritimati",
-                        "(UTC+1400) Pacific/Kiritimati",
-                      ],
-                    ],
-                    "label": "Timezone",
-                    "name": "timezone",
-                    "type": "choice",
-                  },
-                  Object {
-                    "label": "Use a 24-hour clock",
-                    "name": "clock24Hours",
-                    "type": "boolean",
-                  },
-                ],
-                "title": "Localization",
-              },
-            ]
-          }
-          location={Object {}}
-        />
-      </Box>
-    </Form>
-  </div>
-</SideEffect(DocumentTitle)>
-`;
diff --git a/tests/js/spec/views/__snapshots__/accountEmails.spec.jsx.snap b/tests/js/spec/views/__snapshots__/accountEmails.spec.jsx.snap
index 9e540af16b..190dad1e86 100644
--- a/tests/js/spec/views/__snapshots__/accountEmails.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/accountEmails.spec.jsx.snap
@@ -57,6 +57,7 @@ exports[`AccountEmails renders with emails 1`] = `
       submitLabel="Save Changes"
     >
       <JsonForm
+        additionalFieldProps={Object {}}
         forms={
           Array [
             Object {
diff --git a/tests/js/spec/views/accountAppearance.spec.jsx b/tests/js/spec/views/accountAppearance.spec.jsx
deleted file mode 100644
index 283b44a08e..0000000000
--- a/tests/js/spec/views/accountAppearance.spec.jsx
+++ /dev/null
@@ -1,34 +0,0 @@
-import PropTypes from 'prop-types';
-import React from 'react';
-
-import {Client} from 'app/api';
-import {shallow} from 'enzyme';
-import AccountAppearance from 'app/views/settings/account/accountAppearance';
-
-jest.mock('app/api');
-jest.mock('jquery');
-jest.mock('scroll-to-element', () => 'scroll-to-element');
-
-describe('AccountAppearance', function() {
-  beforeEach(function() {
-    Client.clearMockResponses();
-    Client.addMockResponse({
-      url: '/users/me/appearance/',
-      method: 'GET',
-      body: TestStubs.AccountAppearance(),
-    });
-  });
-
-  it('renders', function() {
-    let wrapper = shallow(<AccountAppearance location={{}} />, {
-      context: {
-        router: TestStubs.router(),
-      },
-      childContextTypes: {
-        router: PropTypes.object,
-      },
-    });
-
-    expect(wrapper).toMatchSnapshot();
-  });
-});
diff --git a/tests/js/spec/views/accountDetail.spec.jsx b/tests/js/spec/views/accountDetail.spec.jsx
new file mode 100644
index 0000000000..4cc22e329a
--- /dev/null
+++ b/tests/js/spec/views/accountDetail.spec.jsx
@@ -0,0 +1,62 @@
+import React from 'react';
+
+import {mount} from 'enzyme';
+import AccountDetails from 'app/views/settings/account/accountDetails';
+
+jest.mock('jquery');
+jest.mock('scroll-to-element', () => 'scroll-to-element');
+
+const mockUserDetails = params => {
+  MockApiClient.clearMockResponses();
+
+  MockApiClient.addMockResponse({
+    url: '/users/me/',
+    method: 'GET',
+    body: TestStubs.UserDetails(params),
+  });
+};
+
+describe('AccountDetails', function() {
+  beforeEach(function() {
+    mockUserDetails();
+  });
+
+  it('renders', function() {
+    let wrapper = mount(<AccountDetails location={{}} />, TestStubs.routerContext());
+
+    expect(wrapper.find('input[name="name"]')).toHaveLength(1);
+
+    // Stacktrace order, language, timezone
+    expect(wrapper.find('select')).toHaveLength(3);
+
+    expect(wrapper.find('BooleanField')).toHaveLength(1);
+    expect(wrapper.find('RadioGroup')).toHaveLength(1);
+  });
+
+  it('has username field if it is different than email', function() {
+    mockUserDetails({username: 'different@example.com'});
+    let wrapper = mount(<AccountDetails location={{}} />, TestStubs.routerContext());
+
+    expect(wrapper.find('input[name="username"]')).toHaveLength(1);
+    expect(wrapper.find('input[name="username"]').prop('disabled')).toBe(false);
+  });
+
+  describe('Managed User', function() {
+    it.skip('does not have password fields', function() {
+      mockUserDetails({isManaged: true});
+      let wrapper = mount(<AccountDetails location={{}} />, TestStubs.routerContext());
+
+      expect(wrapper.find('input[name="name"]')).toHaveLength(1);
+      expect(wrapper.find('input[name="password"]')).toHaveLength(0);
+      expect(wrapper.find('input[name="passwordVierfy"]')).toHaveLength(0);
+    });
+
+    it('has disabled username field if it is different than email', function() {
+      mockUserDetails({isManaged: true, username: 'different@example.com'});
+      let wrapper = mount(<AccountDetails location={{}} />, TestStubs.routerContext());
+
+      expect(wrapper.find('input[name="username"]')).toHaveLength(1);
+      expect(wrapper.find('input[name="username"]').prop('disabled')).toBe(true);
+    });
+  });
+});
