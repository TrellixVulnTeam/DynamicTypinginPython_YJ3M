commit 9d9a46acb6b96a1c940b58604fdb13624b6d6877
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Feb 11 16:34:43 2013 -0800

    Handle values_seen in FilterKey and GroupTagKey

diff --git a/src/sentry/manager.py b/src/sentry/manager.py
index 672462aeaf..2bdf3f592f 100644
--- a/src/sentry/manager.py
+++ b/src/sentry/manager.py
@@ -651,7 +651,7 @@ class GroupManager(BaseManager, ChartMixin):
         })
 
     def add_tags(self, group, tags):
-        from sentry.models import FilterValue, FilterKey, GroupTag
+        from sentry.models import FilterValue, GroupTag
 
         project = group.project
         date = group.last_seen
@@ -664,11 +664,6 @@ class GroupManager(BaseManager, ChartMixin):
             if len(value) > MAX_TAG_LENGTH:
                 continue
 
-            FilterKey.objects.get_or_create(
-                project=project,
-                key=key,
-            )
-
             app.buffer.incr(FilterValue, {
                 'times_seen': 1,
             }, {
diff --git a/src/sentry/models.py b/src/sentry/models.py
index a6a388cb8b..8d8d6ff805 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -1156,6 +1156,37 @@ def set_language_on_logon(request, user, **kwargs):
         request.session['django_language'] = language
 
 
+@buffer_incr_complete.connect(sender=FilterValue, weak=False)
+def record_project_tag_count(filters, created, **kwargs):
+    from sentry import app
+
+    if not created:
+        return
+
+    app.buffer.incr(FilterKey, {
+        'values_seen': 1,
+    }, {
+        'project': filters['project'],
+        'key': filters['key'],
+    })
+
+
+@buffer_incr_complete.connect(sender=GroupTag, weak=False)
+def record_group_tag_count(filters, created, **kwargs):
+    from sentry import app
+
+    if not created:
+        return
+
+    app.buffer.incr(GroupTagKey, {
+        'values_seen': 1,
+    }, {
+        'project': filters['project'],
+        'group': filters['group'],
+        'key': filters['key'],
+    })
+
+
 @buffer_incr_complete.connect(sender=AffectedUserByGroup, weak=False)
 def record_user_count(filters, created, **kwargs):
     from sentry import app
