commit 8425c3e5881da5134c8ec91f7226fb2f0344361d
Author: 0x6a6f7368 <joshua.r.li.98@gmail.com>
Date:   Wed May 30 11:22:37 2018 -0700

    build(travis): directly cache virtualenv instead of pip wheels (#8499)

diff --git a/.travis.yml b/.travis.yml
index 8e42df0367..07371025c3 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -11,10 +11,10 @@ branches:
   - master
 
 cache:
-  pip: true
   yarn: true
   directories:
     - node_modules
+    - "${HOME}/virtualenv/python$(python -c 'import platform; print(platform.python_version())')"
     - $HOME/google-cloud-sdk
 
 addons:
diff --git a/Makefile b/Makefile
index cf100dc9b1..50f49ffd47 100644
--- a/Makefile
+++ b/Makefile
@@ -7,7 +7,7 @@ ifneq "$(wildcard /usr/local/opt/openssl/lib)" ""
 	LDFLAGS += -L/usr/local/opt/openssl/lib
 endif
 
-PIP = LDFLAGS="$(LDFLAGS)" pip -q
+PIP = LDFLAGS="$(LDFLAGS)" pip
 WEBPACK = NODE_ENV=production ./node_modules/.bin/webpack
 
 test: develop lint test-js test-python test-cli
@@ -81,7 +81,7 @@ locale: build-js-po
 	cd src/sentry && sentry django compilemessages
 
 update-transifex: build-js-po
-	pip install -q transifex-client
+	$(PIP) install transifex-client
 	cd src/sentry && sentry django makemessages -i static -l en
 	./bin/merge-catalogs en
 	tx push -s
@@ -146,12 +146,6 @@ lint-js:
 	bin/lint --js --parseable
 	@echo ""
 
-scan-python:
-	@echo "--> Running Python vulnerability scanner"
-	python -m pip install -q safety
-	bin/scan
-	@echo ""
-
 publish:
 	python setup.py sdist bdist_wheel upload
 
@@ -186,6 +180,12 @@ travis-test-dist:
 	@ls -lh dist/
 
 # Scan steps
+scan-python:
+	@echo "--> Running Python vulnerability scanner"
+	$(PIP) install safety
+	bin/scan
+	@echo ""
+
 travis-scan-sqlite: scan-python
 travis-scan-postgres: scan-python
 travis-scan-mysql: scan-python
diff --git a/requirements-base.txt b/requirements-base.txt
index a7660ade24..6ead8054a1 100644
--- a/requirements-base.txt
+++ b/requirements-base.txt
@@ -25,7 +25,7 @@ ipaddress>=1.0.16,<1.1.0
 loremipsum>=1.0.5,<1.1.0
 jsonschema==2.6.0
 lxml>=3.4.1
-mock>=0.8.0,<1.1
+mock==2.0.0
 mmh3>=2.3.1,<2.4
 oauth2>=1.5.167
 parsimonious==0.8.0
diff --git a/tests/sentry/buffer/redis/tests.py b/tests/sentry/buffer/redis/tests.py
index b66dbbdc52..7df139345d 100644
--- a/tests/sentry/buffer/redis/tests.py
+++ b/tests/sentry/buffer/redis/tests.py
@@ -85,7 +85,7 @@ class RedisBufferTest(TestCase):
             'e+foo': "S'bar'\np1\n.",
             'f': "(dp1\nS'pk'\np2\nI1\ns.",
             'i+times_seen': '1',
-            'm': 'mock.Mock',
+            'm': 'mock.mock.Mock',
         }
         pending = client.zrange('b:p', 0, -1)
         assert pending == ['foo']
@@ -95,7 +95,7 @@ class RedisBufferTest(TestCase):
             'e+foo': "S'bar'\np1\n.",
             'f': "(dp1\nS'pk'\np2\nI1\ns.",
             'i+times_seen': '2',
-            'm': 'mock.Mock',
+            'm': 'mock.mock.Mock',
         }
         pending = client.zrange('b:p', 0, -1)
         assert pending == ['foo']
