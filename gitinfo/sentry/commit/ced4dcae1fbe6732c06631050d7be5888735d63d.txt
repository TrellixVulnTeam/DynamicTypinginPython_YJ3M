commit ced4dcae1fbe6732c06631050d7be5888735d63d
Author: ted kaemming <ted@kaemming.com>
Date:   Thu Mar 15 12:31:18 2018 -0700

    ref: Only pass environment to search backend when `organizations:environments` switch enabled (#7647)

diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index a1b8deee9b..b0c7f55cdf 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -230,10 +230,11 @@ class ProjectGroupIndexEndpoint(ProjectEndpoint, EnvironmentMixin):
             query_kwargs.update(extra_query_kwargs)
 
         try:
-            query_kwargs['environment'] = self._get_environment_from_request(
-                request,
-                project.organization_id,
-            )
+            if features.has('organizations:environments', project, actor=request.user):
+                query_kwargs['environment'] = self._get_environment_from_request(
+                    request,
+                    project.organization_id,
+                )
         except Environment.DoesNotExist:
             # XXX: The 1000 magic number for `max_hits` is an abstraction leak
             # from `sentry.api.paginator.BasePaginator.get_result`.
