commit 5eb4bfd56c145a568ad92d1ff328f9901ff9d40d
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed May 22 14:55:50 2019 -0700

    feat(events-v2): Fix no projects case, add test (#13338)

diff --git a/src/sentry/api/endpoints/organization_events.py b/src/sentry/api/endpoints/organization_events.py
index abbfa40fb0..d6138c4ab9 100644
--- a/src/sentry/api/endpoints/organization_events.py
+++ b/src/sentry/api/endpoints/organization_events.py
@@ -76,9 +76,7 @@ class OrganizationEventsEndpoint(OrganizationEventsEndpointBase):
         except OrganizationEventsError as exc:
             return Response({'detail': exc.message}, status=400)
         except NoProjects:
-            # return empty result if org doesn't have projects
-            # or user doesn't have access to projects in org
-            data_fn = lambda *args, **kwargs: []
+            return Response([])
         else:
             data_fn = partial(
                 lambda *args, **kwargs: transform_aliases_and_query(*args, **kwargs)['data'],
diff --git a/tests/snuba/api/endpoints/test_organization_events_v2.py b/tests/snuba/api/endpoints/test_organization_events_v2.py
index bb9ed32f4d..49879edec9 100644
--- a/tests/snuba/api/endpoints/test_organization_events_v2.py
+++ b/tests/snuba/api/endpoints/test_organization_events_v2.py
@@ -23,6 +23,14 @@ class OrganizationEventsTestBase(APITestCase, SnubaTestCase):
 
 
 class OrganizationEventsV2EndpointTest(OrganizationEventsTestBase):
+    def test_no_projects(self):
+        self.login_as(user=self.user)
+        with self.feature('organizations:events-v2'):
+            response = self.client.get(self.url, format='json')
+
+        assert response.status_code == 200, response.content
+        assert len(response.data) == 0
+
     def test_raw_data(self):
         self.login_as(user=self.user)
         project = self.create_project()
