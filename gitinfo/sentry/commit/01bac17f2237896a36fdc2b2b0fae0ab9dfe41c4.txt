commit 01bac17f2237896a36fdc2b2b0fae0ab9dfe41c4
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Nov 26 13:53:20 2018 +0100

    fix: Normalize log level to string (#10743)
    
    * fix: Normalize log level to string
    
    * fix: Tests

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 4687ada488..50166108dd 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -621,7 +621,9 @@ class EventManager(object):
             level = data.get('level') or DEFAULT_LOG_LEVEL
             if isinstance(level, int) or (isinstance(level, six.string_types) and level.isdigit()):
                 level = LOG_LEVELS.get(int(level), DEFAULT_LOG_LEVEL)
-            data['level'] = LOG_LEVELS_MAP.get(level, LOG_LEVELS_MAP[DEFAULT_LOG_LEVEL])
+            if level not in LOG_LEVELS_MAP:
+                level = DEFAULT_LOG_LEVEL
+            data['level'] = level
 
             if data.get('dist') and not data.get('release'):
                 data['dist'] = None
diff --git a/tests/sentry/event_manager/test_validate_data.py b/tests/sentry/event_manager/test_validate_data.py
index aac9edef4a..5e4df64bfa 100644
--- a/tests/sentry/event_manager/test_validate_data.py
+++ b/tests/sentry/event_manager/test_validate_data.py
@@ -114,12 +114,17 @@ def test_does_expand_list():
 
 def test_log_level_as_string():
     data = validate_and_normalize({"message": "foo", "level": "error"})
-    assert data["level"] == 40
+    assert data["level"] == "error"
+
+
+def test_log_level_as_int():
+    data = validate_and_normalize({"message": "foo", "level": 40})
+    assert data["level"] == "error"
 
 
 def test_invalid_log_level():
     data = validate_and_normalize({"message": "foo", "level": "foobar"})
-    assert data["level"] == 40
+    assert data["level"] == "error"
     assert len(data["errors"]) == 1
     assert data["errors"][0]["type"] == "invalid_data"
     assert data["errors"][0]["name"] == "level"
