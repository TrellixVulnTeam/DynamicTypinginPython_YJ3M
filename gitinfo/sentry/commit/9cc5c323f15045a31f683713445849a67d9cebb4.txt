commit 9cc5c323f15045a31f683713445849a67d9cebb4
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 26 17:11:04 2017 -0700

    ci: fix jest tests

diff --git a/.babelrc b/.babelrc
index 7aa193ff76..139bac848b 100644
--- a/.babelrc
+++ b/.babelrc
@@ -28,7 +28,20 @@
       "presets": [
         "react",
         "latest"
-      ]
+      ],
+      "plugins": [
+        "transform-class-properties",
+        "transform-object-rest-spread",
+        [
+          "babel-plugin-transform-builtin-extend",
+          {
+            "globals": [
+              "Array"
+            ]
+          }
+        ],
+        "idx"
+      ],
     }
   }
 }
diff --git a/.eslintrc b/.eslintrc
index 3a4a7a40cd..6267cb94cd 100644
--- a/.eslintrc
+++ b/.eslintrc
@@ -14,6 +14,7 @@
     "require": false,
     "expect": false,
     "sinon": false,
+    "TestStubs": true,
     "Raven": true,
     "jest": true
   },
diff --git a/tests/js/setup.js b/tests/js/setup.js
index caa2426a9a..6be5333364 100644
--- a/tests/js/setup.js
+++ b/tests/js/setup.js
@@ -5,3 +5,16 @@ window.$ = window.jQuery = jQuery;
 
 import sinon from 'sinon';
 window.sinon = sinon;
+
+window.TestStubs = {
+  // react-router's 'router' context
+  router: () => ({
+    push: sinon.spy(),
+    replace: sinon.spy(),
+    go: sinon.spy(),
+    goBack: sinon.spy(),
+    goForward: sinon.spy(),
+    setRouteLeaveHook: sinon.spy(),
+    isActive: sinon.spy()
+  })
+};
diff --git a/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
index 7b1e54a28f..61b2524eec 100644
--- a/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
@@ -1,37 +1,38 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
 exports[`OrganizationCreate render() renders correctly 1`] = `
-<NarryLayout>
-  <h3>
-    Create a New Organization
-  </h3>
-  <p>
-    Organizations represent the top level in your hierarchy. You'll be able to bundle a collection of teams within an organization as well as give organization-wide permissions to users.
-  </p>
-  <ApiForm
-    apiEndpoint="/organizations/"
-    apiMethod="POST"
-    className="form-stacked"
-    fields={
-      Array [
+<DocumentTitle
+  title="Create Organization"
+>
+  <NarryLayout>
+    <h3>
+      Create a New Organization
+    </h3>
+    <p>
+      Organizations represent the top level in your hierarchy. You'll be able to bundle a collection of teams within an organization as well as give organization-wide permissions to users.
+    </p>
+    <ApiForm
+      apiEndpoint="/organizations/"
+      apiMethod="POST"
+      className="form-stacked"
+      footerClass="form-actions align-right"
+      initialData={
         Object {
-          "component": [Function],
-          "label": "Organization Name",
-          "name": "name",
-          "placeholder": "e.g. My Company",
-          "required": true,
-        },
-      ]
-    }
-    footerClass="form-actions align-right"
-    initialData={
-      Object {
-        "defaultTeam": true,
+          "defaultTeam": true,
+        }
       }
-    }
-    onSubmitSuccess={[Function]}
-    submitDisabled={false}
-    submitLabel="Create Organization"
-  />
-</NarryLayout>
+      onSubmitSuccess={[Function]}
+      submitDisabled={false}
+      submitLabel="Create Organization"
+    >
+      <TextField
+        disabled={false}
+        label="Organization Name"
+        name="name"
+        placeholder="e.g. My Company"
+        required={true}
+      />
+    </ApiForm>
+  </NarryLayout>
+</DocumentTitle>
 `;
diff --git a/tests/js/spec/views/__snapshots__/teamCreate.spec.jsx.snap b/tests/js/spec/views/__snapshots__/teamCreate.spec.jsx.snap
index 41a55a0a2e..12847c45d9 100644
--- a/tests/js/spec/views/__snapshots__/teamCreate.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/teamCreate.spec.jsx.snap
@@ -1,32 +1,33 @@
 // Jest Snapshot v1, https://goo.gl/fbAQLP
 
 exports[`TeamCreate render() renders correctly 1`] = `
-<NarryLayout>
-  <h3>
-    Create a New Team
-  </h3>
-  <p>
-    Teams group members' access to a specific focus, e.g. a major product or application that may have sub-projects.
-  </p>
-  <ApiForm
-    apiEndpoint="/organizations/org/teams/"
-    apiMethod="POST"
-    className="form-stacked"
-    fields={
-      Array [
-        Object {
-          "component": [Function],
-          "label": "Team Name",
-          "name": "name",
-          "placeholder": "e.g. Operations, Web, Desktop",
-          "required": true,
-        },
-      ]
-    }
-    footerClass="form-actions align-right"
-    onSubmitSuccess={[Function]}
-    submitDisabled={false}
-    submitLabel="Save Changes"
-  />
-</NarryLayout>
+<DocumentTitle
+  title="Create Team"
+>
+  <NarryLayout>
+    <h3>
+      Create a New Team
+    </h3>
+    <p>
+      Teams group members' access to a specific focus, e.g. a major product or application that may have sub-projects.
+    </p>
+    <ApiForm
+      apiEndpoint="/organizations/org/teams/"
+      apiMethod="POST"
+      className="form-stacked"
+      footerClass="form-actions align-right"
+      onSubmitSuccess={[Function]}
+      submitDisabled={false}
+      submitLabel="Save Changes"
+    >
+      <TextField
+        disabled={false}
+        label="Team Name"
+        name="name"
+        placeholder="e.g. Operations, Web, Desktop"
+        required={true}
+      />
+    </ApiForm>
+  </NarryLayout>
+</DocumentTitle>
 `;
diff --git a/tests/js/spec/views/organizationCreate.spec.jsx b/tests/js/spec/views/organizationCreate.spec.jsx
index e7f9ab5159..f3cbae030a 100644
--- a/tests/js/spec/views/organizationCreate.spec.jsx
+++ b/tests/js/spec/views/organizationCreate.spec.jsx
@@ -7,7 +7,9 @@ import OrganizationCreate from 'app/views/organizationCreate';
 describe('OrganizationCreate', function() {
   describe('render()', function() {
     it('renders correctly', function() {
-      let wrapper = shallow(<OrganizationCreate />);
+      let wrapper = shallow(<OrganizationCreate />, {
+        context: {router: TestStubs.router()}
+      });
       expect(toJson(wrapper)).toMatchSnapshot();
     });
   });
diff --git a/tests/js/spec/views/teamCreate.spec.jsx b/tests/js/spec/views/teamCreate.spec.jsx
index 3820b1b00d..1f38e1c106 100644
--- a/tests/js/spec/views/teamCreate.spec.jsx
+++ b/tests/js/spec/views/teamCreate.spec.jsx
@@ -12,7 +12,10 @@ describe('TeamCreate', function() {
           params={{
             orgId: 'org'
           }}
-        />
+        />,
+        {
+          context: {router: TestStubs.router()}
+        }
       );
       expect(toJson(wrapper)).toMatchSnapshot();
     });
diff --git a/yarn.lock b/yarn.lock
index 88e608e4d8..9d586f3336 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -367,17 +367,7 @@ babel-helper-explode-assignable-expression@^6.18.0:
     babel-traverse "^6.18.0"
     babel-types "^6.18.0"
 
-babel-helper-function-name@^6.18.0, babel-helper-function-name@^6.8.0:
-  version "6.18.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-function-name/-/babel-helper-function-name-6.18.0.tgz#68ec71aeba1f3e28b2a6f0730190b754a9bf30e6"
-  dependencies:
-    babel-helper-get-function-arity "^6.18.0"
-    babel-runtime "^6.0.0"
-    babel-template "^6.8.0"
-    babel-traverse "^6.18.0"
-    babel-types "^6.18.0"
-
-babel-helper-function-name@^6.24.1:
+babel-helper-function-name@^6.18.0, babel-helper-function-name@^6.24.1, babel-helper-function-name@^6.8.0:
   version "6.24.1"
   resolved "https://registry.yarnpkg.com/babel-helper-function-name/-/babel-helper-function-name-6.24.1.tgz#d3475b8c03ed98242a25b48351ab18399d3580a9"
   dependencies:
@@ -387,14 +377,7 @@ babel-helper-function-name@^6.24.1:
     babel-traverse "^6.24.1"
     babel-types "^6.24.1"
 
-babel-helper-get-function-arity@^6.18.0:
-  version "6.18.0"
-  resolved "https://registry.yarnpkg.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.18.0.tgz#a5b19695fd3f9cdfc328398b47dafcd7094f9f24"
-  dependencies:
-    babel-runtime "^6.0.0"
-    babel-types "^6.18.0"
-
-babel-helper-get-function-arity@^6.24.1:
+babel-helper-get-function-arity@^6.18.0, babel-helper-get-function-arity@^6.24.1:
   version "6.24.1"
   resolved "https://registry.yarnpkg.com/babel-helper-get-function-arity/-/babel-helper-get-function-arity-6.24.1.tgz#8f7782aa93407c41d3aa50908f89b031b1b6853d"
   dependencies:
@@ -897,17 +880,7 @@ babel-runtime@^6.2.0, babel-runtime@^6.20.0:
     core-js "^2.4.0"
     regenerator-runtime "^0.10.0"
 
-babel-template@^6.14.0, babel-template@^6.15.0, babel-template@^6.16.0, babel-template@^6.3.0, babel-template@^6.8.0:
-  version "6.16.0"
-  resolved "https://registry.yarnpkg.com/babel-template/-/babel-template-6.16.0.tgz#e149dd1a9f03a35f817ddbc4d0481988e7ebc8ca"
-  dependencies:
-    babel-runtime "^6.9.0"
-    babel-traverse "^6.16.0"
-    babel-types "^6.16.0"
-    babylon "^6.11.0"
-    lodash "^4.2.0"
-
-babel-template@^6.24.1:
+babel-template@^6.14.0, babel-template@^6.15.0, babel-template@^6.24.1, babel-template@^6.8.0:
   version "6.25.0"
   resolved "https://registry.yarnpkg.com/babel-template/-/babel-template-6.25.0.tgz#665241166b7c2aa4c619d71e192969552b10c071"
   dependencies:
@@ -917,7 +890,17 @@ babel-template@^6.24.1:
     babylon "^6.17.2"
     lodash "^4.2.0"
 
-babel-traverse@^6.15.0, babel-traverse@^6.16.0, babel-traverse@^6.18.0, babel-traverse@^6.20.0, babel-traverse@^6.21.0:
+babel-template@^6.16.0, babel-template@^6.3.0:
+  version "6.16.0"
+  resolved "https://registry.yarnpkg.com/babel-template/-/babel-template-6.16.0.tgz#e149dd1a9f03a35f817ddbc4d0481988e7ebc8ca"
+  dependencies:
+    babel-runtime "^6.9.0"
+    babel-traverse "^6.16.0"
+    babel-types "^6.16.0"
+    babylon "^6.11.0"
+    lodash "^4.2.0"
+
+babel-traverse@^6.15.0, babel-traverse@^6.16.0, babel-traverse@^6.21.0:
   version "6.21.0"
   resolved "https://registry.yarnpkg.com/babel-traverse/-/babel-traverse-6.21.0.tgz#69c6365804f1a4f69eb1213f85b00a818b8c21ad"
   dependencies:
@@ -931,7 +914,7 @@ babel-traverse@^6.15.0, babel-traverse@^6.16.0, babel-traverse@^6.18.0, babel-tr
     invariant "^2.2.0"
     lodash "^4.2.0"
 
-babel-traverse@^6.24.1, babel-traverse@^6.25.0:
+babel-traverse@^6.18.0, babel-traverse@^6.20.0, babel-traverse@^6.24.1, babel-traverse@^6.25.0:
   version "6.25.0"
   resolved "https://registry.yarnpkg.com/babel-traverse/-/babel-traverse-6.25.0.tgz#2257497e2fcd19b89edc13c4c91381f9512496f1"
   dependencies:
@@ -945,7 +928,7 @@ babel-traverse@^6.24.1, babel-traverse@^6.25.0:
     invariant "^2.2.0"
     lodash "^4.2.0"
 
-babel-types@^6.15.0, babel-types@^6.16.0, babel-types@^6.18.0, babel-types@^6.19.0, babel-types@^6.20.0, babel-types@^6.21.0, babel-types@^6.8.0, babel-types@^6.9.0:
+babel-types@^6.15.0, babel-types@^6.16.0, babel-types@^6.21.0:
   version "6.21.0"
   resolved "https://registry.yarnpkg.com/babel-types/-/babel-types-6.21.0.tgz#314b92168891ef6d3806b7f7a917fdf87c11a4b2"
   dependencies:
@@ -954,7 +937,7 @@ babel-types@^6.15.0, babel-types@^6.16.0, babel-types@^6.18.0, babel-types@^6.19
     lodash "^4.2.0"
     to-fast-properties "^1.0.1"
 
-babel-types@^6.24.1, babel-types@^6.25.0:
+babel-types@^6.18.0, babel-types@^6.19.0, babel-types@^6.20.0, babel-types@^6.24.1, babel-types@^6.25.0, babel-types@^6.8.0, babel-types@^6.9.0:
   version "6.25.0"
   resolved "https://registry.yarnpkg.com/babel-types/-/babel-types-6.25.0.tgz#70afb248d5660e5d18f811d91c8303b54134a18e"
   dependencies:
