commit 5e73eb62c4d4d9e071f5187ef4ff757292da4a5b
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Jun 9 14:06:08 2011 -0700

    More correct handling of recursion errors (refs GH-176)

diff --git a/sentry/utils/__init__.py b/sentry/utils/__init__.py
index f73ceb019b..9a88c28fa2 100644
--- a/sentry/utils/__init__.py
+++ b/sentry/utils/__init__.py
@@ -85,14 +85,17 @@ def transform(value, stack=[], context=None):
     # TODO: dont coerce strings to unicode, leave them as strings
     if context is None:
         context = {}
+
     objid = id(value)
     if objid in context:
         return '<...>'
+
     context[objid] = 1
+    transform_rec = lambda o: transform(o, stack + [value], context)
+
     if any(value is s for s in stack):
         ret = 'cycle'
-    transform_rec = lambda o: transform(o, stack + [value], context)
-    if isinstance(value, (tuple, list, set, frozenset)):
+    elif isinstance(value, (tuple, list, set, frozenset)):
         ret = type(value)(transform_rec(o) for o in value)
     elif isinstance(value, uuid.UUID):
         ret = repr(value)
