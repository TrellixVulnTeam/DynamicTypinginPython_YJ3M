commit 767f801acc2cd8ab7b338bf9427bf3e764afc3e6
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Nov 29 17:37:06 2010 -0800

    Adjust trash count so it will catch value errors as well (credit to niran)

diff --git a/sentry/client/base.py b/sentry/client/base.py
index 269d2be474..f3a41f5daf 100644
--- a/sentry/client/base.py
+++ b/sentry/client/base.py
@@ -32,11 +32,16 @@ class SentryClient(object):
         if conf.THRASHING_TIMEOUT and conf.THRASHING_LIMIT:
             cache_key = 'sentry:%s:%s' % (kwargs.get('class_name') or '', checksum)
             added = cache.add(cache_key, 1, conf.THRASHING_TIMEOUT)
-            try:
-                if not added and cache.incr(cache_key) > conf.THRASHING_LIMIT:
+            if not added:
+                try:
+                    thrash_count = cache.incr(cache_key)
+                except (KeyError, ValueError):
+                    # cache.incr can fail. Assume we aren't thrashing yet, and
+                    # if we are, hope that the next error has a successful
+                    # cache.incr call.
+                    thrash_count = 0
+                if thrash_count > conf.THRASHING_LIMIT:
                     return
-            except KeyError:
-                pass
 
         for filter_ in get_filters():
             kwargs = filter_(None).process(kwargs) or kwargs
