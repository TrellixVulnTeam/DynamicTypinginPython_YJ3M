commit 81b37bbd15161c57ce1c88e6db8a54e37595ef5d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 6 19:30:16 2013 -0700

    Various cleanup

diff --git a/conftest.py b/conftest.py
index 4d09c23d4d..d1a6ae275b 100644
--- a/conftest.py
+++ b/conftest.py
@@ -33,6 +33,23 @@ def pytest_configure(config):
             'NAME': ':memory:',
         })
 
+    # http://djangosnippets.org/snippets/646/
+    class InvalidVarException(object):
+        def __mod__(self, missing):
+            try:
+                missing_str = unicode(missing)
+            except:
+                missing_str = 'Failed to create string representation'
+            raise Exception('Unknown template variable %r %s' % (missing, missing_str))
+
+        def __contains__(self, search):
+            if search == '%s':
+                return True
+            return False
+
+    settings.TEMPLATE_DEBUG = True
+    # settings.TEMPLATE_STRING_IF_INVALID = InvalidVarException()
+
     # Disable static compiling in tests
     settings.STATIC_BUNDLES = {}
 
diff --git a/src/sentry/templates/sentry/account/appearance.html b/src/sentry/templates/sentry/account/appearance.html
index 2f12257d60..8c60aac359 100644
--- a/src/sentry/templates/sentry/account/appearance.html
+++ b/src/sentry/templates/sentry/account/appearance.html
@@ -27,7 +27,7 @@
             <div><legend>{% trans "Events" %}</legend></div>
 
             {% with form.stacktrace_order as field %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endwith %}
         </fieldset>
 
@@ -36,7 +36,7 @@
             <div><legend>{% trans "Localization" %}</legend></div>
 
             {% with form.language as field %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endwith %}
         </fieldset>
 
diff --git a/src/sentry/templates/sentry/account/settings.html b/src/sentry/templates/sentry/account/settings.html
index 698dcea0ac..d7daca27bf 100644
--- a/src/sentry/templates/sentry/account/settings.html
+++ b/src/sentry/templates/sentry/account/settings.html
@@ -24,7 +24,7 @@
         <p>{% trans "To make changes to your account, you must first enter your current password." %}</p>
         {% with form.old_password as field %}
             {% if field %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endif %}
         {% endwith %}
         <hr>
@@ -35,10 +35,10 @@
             </div>
         </fieldset>
         {% with form.first_name as field %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endwith %}
         {% with form.email as field %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endwith %}
         <fieldset class="control-group">
             <label>Avatar</label>
@@ -50,7 +50,7 @@
         <hr>
         <p>{% trans "You may also optionally change your password." %}</p>
         {% with form.new_password as field %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endwith %}
 
         <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/admin/status/mail.html b/src/sentry/templates/sentry/admin/status/mail.html
index bec37398d4..f2a4b2e35a 100644
--- a/src/sentry/templates/sentry/admin/status/mail.html
+++ b/src/sentry/templates/sentry/admin/status/mail.html
@@ -52,7 +52,7 @@
         {{ form|as_crispy_errors }}
 
         {% for field in form %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endfor %}
 
         <input type="submit" class="btn" value="{% blocktrans with request.user.email as email %}Send a test email to {{ email }}{% endblocktrans %}">
diff --git a/src/sentry/templates/sentry/admin/users/edit.html b/src/sentry/templates/sentry/admin/users/edit.html
index 293d687134..80f72cfb98 100644
--- a/src/sentry/templates/sentry/admin/users/edit.html
+++ b/src/sentry/templates/sentry/admin/users/edit.html
@@ -20,7 +20,7 @@
             {% csrf_token %}
             {{ form|as_crispy_errors }}
             {% for field in form %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endfor %}
             <fieldset class="form-actions">
                 <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
diff --git a/src/sentry/templates/sentry/admin/users/remove.html b/src/sentry/templates/sentry/admin/users/remove.html
index d43134e199..46be52b6a9 100644
--- a/src/sentry/templates/sentry/admin/users/remove.html
+++ b/src/sentry/templates/sentry/admin/users/remove.html
@@ -18,7 +18,7 @@
             {% csrf_token %}
             {{ form|as_crispy_errors }}
             {% for field in form %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endfor %}
             <fieldset class="form-actions">
                 <button type="submit" class="btn btn-danger">{% trans "Confirm" %}</button> <a href="{% url 'sentry-admin-edit-user' the_user.pk %}" class="btn">{% trans "Cancel" %}</a>
diff --git a/src/sentry/templates/sentry/events/replay_request.html b/src/sentry/templates/sentry/events/replay_request.html
index 4e12190f49..e8e1f606d0 100644
--- a/src/sentry/templates/sentry/events/replay_request.html
+++ b/src/sentry/templates/sentry/events/replay_request.html
@@ -1,5 +1,6 @@
 {% extends "sentry/groups/details.html" %}
 
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "Replay Request" %} | {{ block.super }}{% endblock %}
@@ -29,8 +30,9 @@
 
                 <form action="" method="post">
                     {% csrf_token %}
+                    {{ form|as_crispy_errors }}
                     {% for field in form %}
-                        {% include "sentry/partial/_form_field.html" %}
+                        {{ field|as_crispy_field }}
                     {% endfor %}
                     <fieldset class="form-actions">
                         <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
diff --git a/src/sentry/templates/sentry/layout.html b/src/sentry/templates/sentry/layout.html
index ba344f5221..d68a34a71c 100644
--- a/src/sentry/templates/sentry/layout.html
+++ b/src/sentry/templates/sentry/layout.html
@@ -28,7 +28,6 @@
             app.config.popupCss = '{% url 'sentry-media' "sentry" 'styles/popup.css' %}';
             app.config.mediaUrl = '{% url 'sentry-media' "sentry" '' %}';
             app.config.urlPrefix = {{ URL_PREFIX|to_json|safe }};
-            app.config.hasRealtime = {{ hasRealtime|to_json|safe  }} || false;
             {% if project %}
                 app.config.projectId = {{ project.slug|to_json|safe }};
                 app.config.teamId = {{ project.team.slug|to_json|safe }};
diff --git a/src/sentry/templates/sentry/login.html b/src/sentry/templates/sentry/login.html
index 6367356804..754248b903 100644
--- a/src/sentry/templates/sentry/login.html
+++ b/src/sentry/templates/sentry/login.html
@@ -26,7 +26,7 @@
                     {% csrf_token %}
 
                     {% for field in form %}
-                        {% include "sentry/partial/_form_field.html" %}
+                        {{ field|as_crispy_field }}
                     {% endfor %}
 
                     <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/partial/_form.html b/src/sentry/templates/sentry/partial/_form.html
index 747cf137c3..417879c616 100644
--- a/src/sentry/templates/sentry/partial/_form.html
+++ b/src/sentry/templates/sentry/partial/_form.html
@@ -6,7 +6,7 @@
     {{ form|as_crispy_errors }}
 
     {% for field in form %}
-        {% include "sentry/partial/_form_field.html" %}
+        {{ field|as_crispy_field }}
     {% endfor %}
 
     <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html b/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
index 14862ed8d9..fde3e33b00 100644
--- a/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
+++ b/src/sentry/templates/sentry/plugins/bases/issue/create_issue.html
@@ -15,10 +15,11 @@
 
         <form class="form-stacked" action="" method="post">
             {% csrf_token %}
+            {{ form|as_crispy_errors }}
             <input type="hidden" name="next" value="{{ next }}" />
             <fieldset>
                 {% for field in form %}
-                    {% include "sentry/partial/_form_field.html" %}
+                    {{ field|as_crispy_field }}
                 {% endfor %}
             </fieldset>
             <p class="actions">
diff --git a/src/sentry/templates/sentry/projects/remove.html b/src/sentry/templates/sentry/projects/remove.html
index 6bb2fed6bc..d79d753e9c 100644
--- a/src/sentry/templates/sentry/projects/remove.html
+++ b/src/sentry/templates/sentry/projects/remove.html
@@ -18,7 +18,7 @@
             {% csrf_token %}
             {{ form|as_crispy_errors }}
             {% for field in form %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endfor %}
             <fieldset class="form-actions">
                 <button type="submit" class="btn btn-danger">{% trans "Confirm" %}</button> <a href="{% url 'sentry-manage-project' project.team.slug project.slug %}" class="btn">{% trans "Cancel" %}</a>
diff --git a/src/sentry/templates/sentry/register.html b/src/sentry/templates/sentry/register.html
index 565992717b..d67be622d4 100644
--- a/src/sentry/templates/sentry/register.html
+++ b/src/sentry/templates/sentry/register.html
@@ -20,9 +20,9 @@
                         <legend>{% trans "Create a new account" %}</legend>
                     </fieldset>
                     {% csrf_token %}
-
+                    {{ form|as_crispy_errors }}
                     {% for field in form %}
-                        {% include "sentry/partial/_form_field.html" %}
+                        {{ field|as_crispy_field }}
                     {% endfor %}
 
                     <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/teams/groups/details.html b/src/sentry/templates/sentry/teams/groups/details.html
index 9f751a16d4..3093a76caa 100644
--- a/src/sentry/templates/sentry/teams/groups/details.html
+++ b/src/sentry/templates/sentry/teams/groups/details.html
@@ -48,7 +48,7 @@
         {{ form|as_crispy_errors }}
 
         {% for field in form %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endfor %}
 
         <fieldset class="form-actions">
diff --git a/src/sentry/templates/sentry/teams/groups/remove.html b/src/sentry/templates/sentry/teams/groups/remove.html
index 62c84c7d41..6e5670e269 100644
--- a/src/sentry/templates/sentry/teams/groups/remove.html
+++ b/src/sentry/templates/sentry/teams/groups/remove.html
@@ -19,7 +19,7 @@
             {% csrf_token %}
             {{ form|as_crispy_errors }}
             {% for field in form %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endfor %}
             <fieldset class="form-actions">
                 <button type="submit" class="btn btn-danger">{% trans "Confirm" %}</button> <a href="{% url 'sentry-manage-access-groups' group.team.slug %}" class="btn">{% trans "Cancel" %}</a>
diff --git a/src/sentry/templates/sentry/teams/members/edit.html b/src/sentry/templates/sentry/teams/members/edit.html
index 6dc03b0a1e..6923c57f58 100644
--- a/src/sentry/templates/sentry/teams/members/edit.html
+++ b/src/sentry/templates/sentry/teams/members/edit.html
@@ -33,7 +33,7 @@
         <br/>
         <legend>{% trans "Access" %}</legend>
         {% for field in form %}
-            {% include "sentry/partial/_form_field.html" %}
+            {{ field|as_crispy_field }}
         {% endfor %}
         <div class="form-actions">
             <button type="submit" class="btn btn-primary">{% trans "Save Changes" %}</button>
diff --git a/src/sentry/templates/sentry/teams/new.html b/src/sentry/templates/sentry/teams/new.html
index 6e402bc66a..30f14c391f 100644
--- a/src/sentry/templates/sentry/teams/new.html
+++ b/src/sentry/templates/sentry/teams/new.html
@@ -1,6 +1,7 @@
 {% extends "sentry/teams/base.html" %}
 
 {% load url from future %}
+{% load crispy_forms_tags %}
 {% load i18n %}
 
 {% block title %}{% trans "New Team" %} | {{ block.super }}{% endblock %}
@@ -24,8 +25,9 @@
         <form class="form-stacked" action="" method="post">
             {% csrf_token %}
             <fieldset>
+                {{ form|as_crispy_errors }}
                 {% for field in form %}
-                    {% include "sentry/partial/_form_field.html" %}
+                    {{ field|as_crispy_field }}
                 {% endfor %}
             </fieldset>
             <div class="actions">
diff --git a/src/sentry/templates/sentry/teams/remove.html b/src/sentry/templates/sentry/teams/remove.html
index 9e73cc19bb..cd98901e24 100644
--- a/src/sentry/templates/sentry/teams/remove.html
+++ b/src/sentry/templates/sentry/teams/remove.html
@@ -19,7 +19,7 @@
             {% csrf_token %}
             {{ form|as_crispy_errors }}
             {% for field in form %}
-                {% include "sentry/partial/_form_field.html" %}
+                {{ field|as_crispy_field }}
             {% endfor %}
             <fieldset class="form-actions">
                 <button type="submit" class="btn btn-danger">{% trans "Confirm" %}</button> <a href="{% url 'sentry-manage-team' team.slug %}" class="btn">{% trans "Cancel" %}</a>
