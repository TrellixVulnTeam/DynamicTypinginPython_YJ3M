commit 076b7e9d8ffa95f0a7b44a0875a7014e28e0b251
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Mar 28 12:16:35 2012 -0700

    Support DATABASE_URL as defined by Heroku

diff --git a/sentry/conf/server.py b/sentry/conf/server.py
index 8f383c5e0b..3812927ea0 100644
--- a/sentry/conf/server.py
+++ b/sentry/conf/server.py
@@ -44,6 +44,27 @@ DATABASES = {
     }
 }
 
+if 'DATABASE_URL' in os.environ:
+    url = urlparse.urlparse(os.environ['DATABASE_URL'])
+
+    # Ensure default database exists.
+    DATABASES['default'] = DATABASES.get('default', {})
+
+    # Update with environment configuration.
+    DATABASES['default'].update({
+        'NAME': url.path[1:],
+        'USER': url.username,
+        'PASSWORD': url.password,
+        'HOST': url.hostname,
+        'PORT': url.port,
+    })
+    if url.scheme == 'postgres':
+        DATABASES['default']['ENGINE'] = 'django.db.backends.postgresql_psycopg2'
+
+    if url.scheme == 'mysql':
+        DATABASES['default']['ENGINE'] = 'django.db.backends.mysql'
+
+
 # Local time zone for this installation. Choices can be found here:
 # http://en.wikipedia.org/wiki/List_of_tz_zones_by_name
 # although not all choices may be available on all operating systems.
