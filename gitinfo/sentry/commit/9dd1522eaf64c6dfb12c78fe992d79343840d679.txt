commit 9dd1522eaf64c6dfb12c78fe992d79343840d679
Author: Jess MacQueen <jess@getsentry.com>
Date:   Mon Apr 18 10:28:09 2016 -0700

    fix IndexError when there are trailing spaces in display names

diff --git a/src/sentry/utils/avatar.py b/src/sentry/utils/avatar.py
index cab6710ad8..979be69007 100644
--- a/src/sentry/utils/avatar.py
+++ b/src/sentry/utils/avatar.py
@@ -64,7 +64,7 @@ def get_letter_avatar_color(identifier):
 
 
 def get_letter_avatar(display_name, identifier, size=None, use_svg=True):
-    display_name = display_name or '?'
+    display_name = (display_name or '').strip() or '?'
     names = display_name.split(' ')
     initials = '%s%s' % (names[0][0], names[-1][0] if len(names) > 1 else '')
     initials = escape(initials.upper())
diff --git a/tests/sentry/utils/test_letter_avatar.py b/tests/sentry/utils/test_letter_avatar.py
index 3a03a216ab..8df0887828 100644
--- a/tests/sentry/utils/test_letter_avatar.py
+++ b/tests/sentry/utils/test_letter_avatar.py
@@ -18,6 +18,11 @@ def test_letter_avatar():
     assert '?' in letter_avatar
     assert '#E35141' in letter_avatar
 
+    # Test display name with trailing spaces
+    letter_avatar = get_letter_avatar('johnsmith@example.com ', 2)
+    assert 'J' in letter_avatar
+    assert '#6FBA57' in letter_avatar
+
     # Test name as display name and email as identifier for html
     letter_avatar = get_letter_avatar('Jane Doe', 'janedoe@example.com', use_svg=False)
     assert 'JD' in letter_avatar
