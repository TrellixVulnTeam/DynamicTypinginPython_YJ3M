commit 056727d9df02e7013bd05e786fca47116fb84fd8
Author: ted kaemming <ted@kaemming.com>
Date:   Tue Jul 11 13:14:31 2017 -0700

    Correct interval calculation in `RedisQuota`. (#5706)
    
    This fixes an issue that was introduced with GH-5530 that caused some quotas to be set to expire before the end of the quota window.

diff --git a/src/sentry/quotas/redis.py b/src/sentry/quotas/redis.py
index 3630042f78..1502ff9611 100644
--- a/src/sentry/quotas/redis.py
+++ b/src/sentry/quotas/redis.py
@@ -145,7 +145,7 @@ class RedisQuota(Quota):
 
         def get_next_period_start(interval, shift):
             """Return the timestamp when the next rate limit period begins for an interval."""
-            return ((timestamp // interval) + 1) * interval - shift
+            return (((timestamp - shift) // interval) + 1) * interval + shift
 
         keys = []
         args = []
