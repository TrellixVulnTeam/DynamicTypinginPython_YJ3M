commit 2cd5e2d6b90ad15ad35cb37d8eeaa0f8dbfddc6f
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Fri Jan 27 19:15:08 2017 +0100

    Explicitly pass in project to processors and defer creation

diff --git a/src/sentry/lang/javascript/plugin.py b/src/sentry/lang/javascript/plugin.py
index ddbf2c7704..9a82e02fa7 100644
--- a/src/sentry/lang/javascript/plugin.py
+++ b/src/sentry/lang/javascript/plugin.py
@@ -134,4 +134,4 @@ class JavascriptPlugin(Plugin2):
     def get_stacktrace_processors(self, data, stacktrace_infos,
                                   platforms, **kwargs):
         if 'javascript' in platforms:
-            return [JavaScriptStacktraceProcessor(data, stacktrace_infos)]
+            return [JavaScriptStacktraceProcessor]
diff --git a/src/sentry/lang/native/plugin.py b/src/sentry/lang/native/plugin.py
index f40bf38b08..da351d1cb4 100644
--- a/src/sentry/lang/native/plugin.py
+++ b/src/sentry/lang/native/plugin.py
@@ -345,13 +345,13 @@ def preprocess_apple_crash_event(data):
 
 class NativeStacktraceProcessor(StacktraceProcessor):
 
-    def __init__(self, data, stacktrace_infos):
-        StacktraceProcessor.__init__(self, data, stacktrace_infos)
-        debug_meta = data.get('debug_meta')
+    def __init__(self, *args, **kwargs):
+        StacktraceProcessor.__init__(self, *args, **kwargs)
+        debug_meta = self.data.get('debug_meta')
         if debug_meta:
             self.available = True
             self.debug_meta = debug_meta
-            self.sdk_info = get_sdk_from_event(data)
+            self.sdk_info = get_sdk_from_event(self.data)
         else:
             self.available = False
 
@@ -464,4 +464,4 @@ class NativePlugin(Plugin2):
     def get_stacktrace_processors(self, data, stacktrace_infos,
                                   platforms, **kwargs):
         if 'cocoa' in platforms:
-            return [NativeStacktraceProcessor(data, stacktrace_infos)]
+            return [NativeStacktraceProcessor]
diff --git a/src/sentry/stacktraces.py b/src/sentry/stacktraces.py
index acfb67e97d..ad2b6ab98d 100644
--- a/src/sentry/stacktraces.py
+++ b/src/sentry/stacktraces.py
@@ -16,12 +16,12 @@ StacktraceInfo = namedtuple('StacktraceInfo', [
 
 class StacktraceProcessor(object):
 
-    def __init__(self, data, stacktrace_infos):
+    def __init__(self, data, stacktrace_infos, project=None):
         self.data = data
         self.stacktrace_infos = stacktrace_infos
-        self.project = Project.objects.get_from_cache(
-            id=data['project']
-        )
+        if project is None:
+            project = Project.objects.get_from_cache(id=data['project'])
+        self.project = project
 
     def close(self):
         pass
@@ -103,6 +103,10 @@ def get_processors_for_stacktraces(data, infos):
                                        platforms=platforms,
                                        _with_transaction=False) or ())
 
+    if processors:
+        project = Project.objects.get_from_cache(id=data['project'])
+        processors = [x(data, infos, project) for x in processors]
+
     return processors
 
 
