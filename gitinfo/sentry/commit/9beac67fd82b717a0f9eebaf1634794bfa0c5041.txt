commit 9beac67fd82b717a0f9eebaf1634794bfa0c5041
Author: Ryan Skonnord <ryan.skonnord@sentry.io>
Date:   Mon Jun 1 14:22:06 2020 -0700

    perf(serializers): Finer spans on GroupSerializerBase._get_permalink (#19116)

diff --git a/src/sentry/api/serializers/models/group.py b/src/sentry/api/serializers/models/group.py
index 6a807ec7d8..902246c0bb 100644
--- a/src/sentry/api/serializers/models/group.py
+++ b/src/sentry/api/serializers/models/group.py
@@ -405,12 +405,24 @@ class GroupSerializerBase(Serializer):
                 request.auth, obj.organization
             )
 
-        if (
-            is_superuser
-            or (user.is_authenticated() and user.get_orgs().filter(id=obj.organization.id).exists())
-            or is_valid_sentryapp
-        ):
-            return obj.get_absolute_url()
+        with sentry_sdk.start_span(op="GroupSerializerBase.serialize.permalink.check") as span:
+
+            def user_is_in_org():
+                exists = user.get_orgs().filter(id=obj.organization.id).exists()
+                span.set_data("user_is_in_org", exists)
+                return exists
+
+            permalink_is_visible = (
+                is_superuser or (user.is_authenticated() and user_is_in_org()) or is_valid_sentryapp
+            )
+
+            span.set_data("is_superuser", is_superuser)
+            span.set_data("is_valid_sentryapp", is_valid_sentryapp)
+            span.set_data("permalink_is_visible", permalink_is_visible)
+
+        if permalink_is_visible:
+            with sentry_sdk.start_span(op="GroupSerializerBase.serialize.permalink.build"):
+                return obj.get_absolute_url()
         else:
             return None
 
