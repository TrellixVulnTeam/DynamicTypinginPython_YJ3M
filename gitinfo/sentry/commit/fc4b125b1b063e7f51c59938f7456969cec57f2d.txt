commit fc4b125b1b063e7f51c59938f7456969cec57f2d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Sep 26 15:24:28 2011 -0700

    Add a test to ensure stacks dont get recorded when the flag is not set

diff --git a/tests/tests.py b/tests/tests.py
index 094342adb2..4d84d5f1dd 100644
--- a/tests/tests.py
+++ b/tests/tests.py
@@ -220,6 +220,16 @@ class SentryTest(BaseTestCase):
         self.assertTrue('__sentry__' in last.data)
         self.assertTrue('frames' in last.data['__sentry__'])
 
+        # test no stacks
+        logger.info('This is a test of no stacks', extra={'stack': False})
+        self.assertEquals(Message.objects.count(), 8)
+        self.assertEquals(GroupedMessage.objects.count(), 7)
+        last = Message.objects.all().order_by('-id')[0:1].get()
+        self.assertEquals(last.class_name, None)
+        self.assertEquals(last.message, 'This is a test of no stacks')
+        self.assertTrue('__sentry__' in last.data)
+        self.assertFalse('frames' in last.data['__sentry__'])
+
         self.tearDownHandler()
 
     # def test_404_middleware(self):
