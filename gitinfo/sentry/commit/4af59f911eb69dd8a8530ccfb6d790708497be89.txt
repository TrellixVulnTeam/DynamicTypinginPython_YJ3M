commit 4af59f911eb69dd8a8530ccfb6d790708497be89
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Jul 19 14:19:36 2018 -0700

    tests(js): Fix flakey Onboarding Configure test (#9111)
    
    Async/timing issue, sometimes `loadEnvironments` does not get called.

diff --git a/tests/js/spec/views/onboarding/configure/index.spec.jsx b/tests/js/spec/views/onboarding/configure/index.spec.jsx
index 75253e282b..8ae16d1e90 100644
--- a/tests/js/spec/views/onboarding/configure/index.spec.jsx
+++ b/tests/js/spec/views/onboarding/configure/index.spec.jsx
@@ -1,7 +1,6 @@
 import React from 'react';
 import {shallow, mount} from 'enzyme';
 
-import {Client} from 'app/api';
 import Configure from 'app/views/onboarding/configure';
 import ProjectsStore from 'app/stores/projectsStore';
 
@@ -10,23 +9,23 @@ describe('Configure should render correctly', function() {
 
   beforeEach(function() {
     sandbox = sinon.sandbox.create();
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/',
       body: TestStubs.Project(),
     });
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/events/',
       body: {},
     });
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/members/',
       body: [],
     });
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/environments/',
-      body: {},
+      body: [],
     });
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/docs/',
       body: {
         dsn: 'https://9ed7cdc60:20e868d7b@sentry.io/300733',
@@ -47,7 +46,7 @@ describe('Configure should render correctly', function() {
         dsnPublic: 'https://9ed7cdc6581145bcb46044b77bd82aa0@sentry.io/300733',
       },
     });
-    Client.addMockResponse({
+    MockApiClient.addMockResponse({
       url: '/projects/testOrg/project-slug/docs/node/',
       body: {},
     });
@@ -75,6 +74,10 @@ describe('Configure should render correctly', function() {
     ProjectsStore.loadInitialData([]);
   });
 
+  afterAll(function() {
+    MockApiClient.clearMockResponses();
+  });
+
   describe('render()', function() {
     const baseProps = {
       next: () => {},
@@ -134,7 +137,7 @@ describe('Configure should render correctly', function() {
       expect(handleSubmitStub.callCount).toEqual(1);
     });
 
-    it('should render platform docs', function(done) {
+    it('should render platform docs', async function() {
       let props = {
         ...baseProps,
       };
@@ -182,11 +185,11 @@ describe('Configure should render correctly', function() {
         ])
       );
 
-      setTimeout(() => {
-        wrapper.update();
-        expect(wrapper).toMatchSnapshot();
-        done();
-      });
+      await tick();
+      // Not sure exactly why but without a second tick, test is flakey and can cause false positives
+      await tick();
+      wrapper.update();
+      expect(wrapper).toMatchSnapshot();
     });
   });
 });
