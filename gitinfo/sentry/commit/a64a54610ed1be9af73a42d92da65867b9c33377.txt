commit a64a54610ed1be9af73a42d92da65867b9c33377
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 19 14:45:03 2015 -0800

    Automatically create organization membership

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index 6af35e8b93..c1902e2729 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -9,7 +9,9 @@ from django.contrib.auth import login
 from django.core.urlresolvers import reverse
 from hashlib import md5
 
-from sentry.models import AuthIdentity, AuthProvider, Organization, User
+from sentry.models import (
+    AuthIdentity, AuthProvider, Organization, OrganizationMember, User
+)
 from sentry.utils.auth import get_login_redirect
 
 from . import manager
@@ -138,10 +140,12 @@ class AuthHelper(object):
         return response
 
     def _finish_login_pipeline(self, identity):
+        auth_provider = self.auth_provider
+
         with transaction.atomic():
             try:
                 auth_identity = AuthIdentity.objects.get(
-                    auth_provider=self.auth_provider,
+                    auth_provider=auth_provider,
                     ident=identity['id'],
                 )
             except AuthIdentity.DoesNotExist:
@@ -152,10 +156,17 @@ class AuthHelper(object):
                 )
 
                 AuthIdentity.objects.create(
-                    auth_provider=self.auth_provider,
+                    auth_provider=auth_provider,
                     user=user,
                     ident=identity['id'],
                 )
+
+                OrganizationMember.objects.create(
+                    has_global_access=True,
+                    organization=self.organization,
+                    type=auth_provider.default_role,
+                    user=user,
+                )
             else:
                 if auth_identity.data != identity.get('data', {}):
                     auth_identity.update(data=identity['data'])
diff --git a/src/sentry/models/authprovider.py b/src/sentry/models/authprovider.py
index 3cc4c7e461..b7b6ffa935 100644
--- a/src/sentry/models/authprovider.py
+++ b/src/sentry/models/authprovider.py
@@ -7,6 +7,8 @@ from sentry.db.models import (
     BoundedPositiveIntegerField, FlexibleForeignKey, GzippedDictField, Model
 )
 
+from .organizationmember import OrganizationMemberType
+
 
 class AuthProvider(Model):
     provider = models.CharField(max_length=128)
@@ -17,6 +19,9 @@ class AuthProvider(Model):
     sync_time = BoundedPositiveIntegerField(null=True)
     last_sync = models.DateTimeField(null=True)
 
+    # TODO(dcramer): Make this and other member settings configurable
+    default_role = OrganizationMemberType.MEMBER
+
     class Meta:
         app_label = 'sentry'
         db_table = 'sentry_authprovider'
