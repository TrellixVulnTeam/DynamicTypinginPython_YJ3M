commit 63e0124de711e4dc52925c054808a51e07d43db4
Author: Burak Yigit Kaya <byk@sentry.io>
Date:   Thu Oct 24 21:19:15 2019 +0300

    build(docker): Bake sentry-plugins into images (#15249)

diff --git a/.dockerignore b/.dockerignore
index 092bbe9656..2e95d07349 100644
--- a/.dockerignore
+++ b/.dockerignore
@@ -19,6 +19,8 @@ test.conf
 pip-log.txt
 celerybeat-schedule
 sentry-package.json
+/docker/Dockerfile
+/docker/cloudbuild.yaml
 /.artifacts
 /coverage/
 /cover
diff --git a/docker/Dockerfile b/docker/Dockerfile
index 5171c20a36..144a261029 100644
--- a/docker/Dockerfile
+++ b/docker/Dockerfile
@@ -14,6 +14,7 @@ RUN apt-get update && apt-get install -y --no-install-recommends \
     gnupg \
     # Needed for fetching stuff
     wget \
+    libarchive-tools \
     && rm -rf /var/lib/apt/lists/*
 
 # Fetch trusted keys
@@ -77,6 +78,9 @@ COPY . /usr/src/sentry/
 RUN export YARN_CACHE_FOLDER="$(mktemp -d)" \
     && cd /usr/src/sentry \
     && python setup.py bdist_wheel \
+    && wget -qO- https://github.com/getsentry/sentry-plugins/archive/master.zip | bsdtar -xvf- \
+    && cd sentry-plugins-master \
+    && PYTHONPATH=/usr/src/sentry/src python setup.py bdist_wheel -d ../dist \
     && rm -r "$YARN_CACHE_FOLDER" \
     && mv /usr/src/sentry/dist /dist
 
