commit dab8c73a744ac8dc0df45a0ee95cd8a7ad3b8bda
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Jan 17 00:00:55 2017 +0100

    Tried to align behavior for JS closer to what it was before

diff --git a/src/sentry/lang/javascript/processor.py b/src/sentry/lang/javascript/processor.py
index e8442eafef..b1190a5f55 100644
--- a/src/sentry/lang/javascript/processor.py
+++ b/src/sentry/lang/javascript/processor.py
@@ -139,7 +139,7 @@ def trim_line(line, column=0):
 
 def get_source_context(source, lineno, colno, context=LINES_OF_CONTEXT):
     if not source:
-        return [], '', []
+        return [], None, []
 
     # lineno's in JS are 1-indexed
     # just in case. sometimes math is hard
@@ -796,12 +796,12 @@ class JavaScriptStacktraceProcessor(StacktraceProcessor):
             new_frame['module'] = generate_module(frame['abs_path'])
             changed_module = True
 
-        if sourcemap_applied or changed_module or all_errors or \
-           self.process_raw_frame(raw_frame):
+        processed_raw_frame = sourcemap_applied and self.process_raw_frame(raw_frame)
+        if sourcemap_applied or changed_module or all_errors or processed_raw_frame:
             if in_app is not None:
                 new_frame['in_app'] = in_app
                 raw_frame['in_app'] = in_app
-            return [new_frame], [raw_frame], all_errors
+            return [new_frame], [raw_frame] if processed_raw_frame else None, all_errors
 
     def process_raw_frame(self, frame):
         if frame.get('lineno') is not None:
diff --git a/tests/sentry/lang/javascript/test_plugin.py b/tests/sentry/lang/javascript/test_plugin.py
index b68d156cc7..f121eedb66 100644
--- a/tests/sentry/lang/javascript/test_plugin.py
+++ b/tests/sentry/lang/javascript/test_plugin.py
@@ -164,7 +164,7 @@ class JavascriptIntegrationTest(TestCase):
         assert frame.post_context == ['o', ' ', 'w', 'o', 'r']
 
         frame = frame_list[1]
-        assert frame.pre_context is None
+        assert not frame.pre_context
         assert frame.context_line == 'h'
         assert frame.post_context == ['e', 'l', 'l', 'o', ' ']
 
@@ -650,9 +650,9 @@ class JavascriptIntegrationTest(TestCase):
         frame = frame_list[0]
 
         # no context information ...
-        assert frame.pre_context is None
-        assert frame.context_line is None
-        assert frame.post_context is None
+        assert not frame.pre_context
+        assert not frame.context_line
+        assert not frame.post_context
 
         # ... but line, column numbers are still correctly mapped
         assert frame.lineno == 3
