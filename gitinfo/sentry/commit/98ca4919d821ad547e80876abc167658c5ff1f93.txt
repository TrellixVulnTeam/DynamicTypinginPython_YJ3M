commit 98ca4919d821ad547e80876abc167658c5ff1f93
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Thu Mar 5 13:50:40 2020 -0800

    fix(workflow): Fix clearing environments in Alert Rules (#17471)
    
    This makes sure that `environment` is a valid value when we add or update alert rules. This fixes an issue where the select component would change the environment value to null when you cleared its value.

diff --git a/src/sentry/static/sentry/app/views/settings/incidentRules/actions.tsx b/src/sentry/static/sentry/app/views/settings/incidentRules/actions.tsx
index 51e4b6bcee..cb0084d9b0 100644
--- a/src/sentry/static/sentry/app/views/settings/incidentRules/actions.tsx
+++ b/src/sentry/static/sentry/app/views/settings/incidentRules/actions.tsx
@@ -27,7 +27,13 @@ export async function addOrUpdateRule(
 
   return api.requestPromise(endpoint, {
     method,
-    data: rule,
+    data: {
+      ...rule,
+
+      // Clearing environments from the UI will result in a null value
+      // which will error in API, make sure we normalize to empty array
+      environment: rule.environment ?? [],
+    },
   });
 }
 
