commit 3c2e87573d3bd16f61cf08fece0638cc47a4fc22
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 12 16:26:19 2008 +0000

    initial working code

diff --git a/djangodblog/__init__.py b/djangodblog/__init__.py
new file mode 100644
index 0000000000..519098fbcc
--- /dev/null
+++ b/djangodblog/__init__.py
@@ -0,0 +1,35 @@
+from models import Error, ErrorBatch
+
+import traceback
+import socket
+import warnings
+import md5
+
+class DBLogMiddleware(object):
+    def process_exception(self, request, exception):
+        server_name = socket.gethostname()
+        tb_text     = traceback.format_exc()
+        class_name  = exception.__class__.__name__
+        checksum    = md5.new(tb_text).hexdigest()
+
+        defaults = dict(
+            class_name  = class_name,
+            message     = exception.message,
+            url         = request.build_absolute_uri(),
+            server_name = server_name,
+            traceback   = tb_text,
+        )
+
+        try:
+            Error.objects.create(**defaults)
+            batch, created = ErrorBatch.objects.get_or_create(
+                class_name = class_name,
+                server_name = server_name,
+                checksum = checksum,
+                defaults = defaults
+            )
+            if not created:
+                batch.times_seen += 1
+                batch.save()
+        except Exception, exc:
+            warnings.warn(unicode(exc))
\ No newline at end of file
diff --git a/djangodblog/models.py b/djangodblog/models.py
new file mode 100644
index 0000000000..9388e4aaef
--- /dev/null
+++ b/djangodblog/models.py
@@ -0,0 +1,36 @@
+from django.db import models
+from django.utils.translation import ugettext_lazy as _
+
+import datetime
+
+class ErrorBatch(models.Model):
+    class_name      = models.CharField(_('Type'), max_length=128)
+    message         = models.TextField()
+    traceback       = models.TextField()
+    times_seen      = models.PositiveIntegerField(default=1)
+    last_seen       = models.DateTimeField(default=datetime.datetime.now)
+    first_seen      = models.DateTimeField(default=datetime.datetime.now)
+    url             = models.URLField(verify_exists=False, null=True, blank=True)
+    server_name     = models.CharField(max_length=128, db_index=True)
+    checksum        = models.CharField(max_length=32, db_index=True)
+
+    class Admin:
+        list_display    = ('class_name', 'message', 'last_seen', 'times_seen', 'url', 'server_name')
+        list_filter     = ('class_name', 'times_seen', 'server_name')
+        ordering        = ('-last_seen',)
+        
+    class Meta:
+        unique_together = (('class_name', 'server_name', 'checksum'),)
+
+class Error(models.Model):
+    class_name      = models.CharField(_('type'), max_length=128)
+    message         = models.TextField()
+    traceback       = models.TextField()
+    datetime        = models.DateTimeField(default=datetime.datetime.now)
+    url             = models.URLField(verify_exists=False, null=True, blank=True)
+    server_name     = models.CharField(max_length=128, db_index=True)
+    
+    class Admin:
+        list_display    = ('class_name', 'message', 'datetime', 'url', 'server_name')
+        list_filter     = ('class_name', 'datetime', 'server_name')
+        ordering        = ('-datetime',)
\ No newline at end of file
