commit afe94d8aaaed779aea64f15afeb99223b8ee940f
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Jul 1 10:19:22 2016 -0700

    Add the ability to explicitly set public/secret on project keys (#3615)

diff --git a/src/sentry/api/endpoints/project_keys.py b/src/sentry/api/endpoints/project_keys.py
index 550ad69fd7..3ad3749fbd 100644
--- a/src/sentry/api/endpoints/project_keys.py
+++ b/src/sentry/api/endpoints/project_keys.py
@@ -33,6 +33,8 @@ def create_key_scenario(runner):
 
 class KeySerializer(serializers.Serializer):
     name = serializers.CharField(max_length=200, required=False)
+    public = serializers.RegexField(r'^[a-f0-9]{32}$', required=False)
+    secret = serializers.RegexField(r'^[a-f0-9]{32}$', required=False)
 
 
 class ProjectKeysEndpoint(ProjectEndpoint):
@@ -65,7 +67,7 @@ class ProjectKeysEndpoint(ProjectEndpoint):
         ```````````````````````
 
         Create a new client key bound to a project.  The key's secret and
-        public key are generated by the server and cannot be customized.
+        public key are generated by the server.
 
         :pparam string organization_slug: the slug of the organization the
                                           client keys belong to.
@@ -81,6 +83,8 @@ class ProjectKeysEndpoint(ProjectEndpoint):
             key = ProjectKey.objects.create(
                 project=project,
                 label=result.get('name'),
+                public_key=result.get('public'),
+                secret_key=result.get('secret'),
             )
 
             self.create_audit_entry(
diff --git a/tests/sentry/api/endpoints/test_project_keys.py b/tests/sentry/api/endpoints/test_project_keys.py
index eae06e708c..7e94877a86 100644
--- a/tests/sentry/api/endpoints/test_project_keys.py
+++ b/tests/sentry/api/endpoints/test_project_keys.py
@@ -47,3 +47,19 @@ class CreateProjectKeyTest(APITestCase):
         assert resp.status_code == 201, resp.content
         key = ProjectKey.objects.get(public_key=resp.data['public'])
         assert key.label
+
+    def test_keys(self):
+        project = self.create_project()
+        self.login_as(user=self.user)
+        url = reverse('sentry-api-0-project-keys', kwargs={
+            'organization_slug': project.organization.slug,
+            'project_slug': project.slug,
+        })
+        resp = self.client.post(url, data={
+            'public': 'a' * 32,
+            'secret': 'b' * 32,
+        })
+        assert resp.status_code == 201, resp.content
+        key = ProjectKey.objects.get(public_key=resp.data['public'])
+        assert key.public_key == resp.data['public'] == 'a' * 32
+        assert key.secret_key == resp.data['secret'] == 'b' * 32
