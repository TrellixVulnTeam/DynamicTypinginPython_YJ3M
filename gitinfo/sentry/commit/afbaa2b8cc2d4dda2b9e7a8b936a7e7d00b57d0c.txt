commit afbaa2b8cc2d4dda2b9e7a8b936a7e7d00b57d0c
Author: Jay Soffian <jaysoffian@gmail.com>
Date:   Wed Nov 19 18:03:23 2014 -0500

    Fix TeamDetailsEndpoint.delete() to properly defer deletion
    
    The countdown argument is used with Task.apply_async(). When calling
    it on Task.delay it's just passed through direectly to delete_team()
    where it is never used.

diff --git a/src/sentry/api/endpoints/team_details.py b/src/sentry/api/endpoints/team_details.py
index 6f55981690..3713c58821 100644
--- a/src/sentry/api/endpoints/team_details.py
+++ b/src/sentry/api/endpoints/team_details.py
@@ -84,8 +84,8 @@ class TeamDetailsEndpoint(Endpoint):
 
         team.update(status=TeamStatus.PENDING_DELETION)
 
-        # TODO(dcramer): set status to pending deletion
         # we delay the task for 5 minutes so we can implement an undo
-        delete_team.delay(object_id=team.id, countdown=60 * 5)
+        kwargs = {'object_id': team.id}
+        delete_team.apply_async(kwargs=kwargs, countdown=60 * 5)
 
         return Response(status=204)
diff --git a/tests/sentry/api/endpoints/test_team_details.py b/tests/sentry/api/endpoints/test_team_details.py
index 5f84caf5be..abb78f2a79 100644
--- a/tests/sentry/api/endpoints/test_team_details.py
+++ b/tests/sentry/api/endpoints/test_team_details.py
@@ -89,8 +89,8 @@ class TeamDeleteTest(APITestCase):
         assert team.status == TeamStatus.PENDING_DELETION
 
         assert response.status_code == 204
-        delete_team.delay.assert_called_once_with(
-            object_id=team.id,
+        delete_team.apply_async.assert_called_once_with(
+            kwargs={"object_id": team.id},
             countdown=60 * 5,
         )
 
