commit 625f0a05d89f81aaba2560d540fb55d7205e6c4c
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jun 4 00:51:52 2012 -0700

    Add full database testing for sqlite, mysql, and postgresql to CI

diff --git a/.travis.yml b/.travis.yml
index 91f9b356af..d2bb94b640 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -3,9 +3,15 @@ python:
   - "2.6"
   - "2.7"
 env:
-  - DJANGO=1.2.7
-  - DJANGO=1.3.1
-  - DJANGO=1.4
+  - DJANGO=1.2.7 DB=sqlite
+  - DJANGO=1.2.7 DB=mysql
+  - DJANGO=1.2.7 DB=postgres
+  - DJANGO=1.3.1 DB=sqlite
+  - DJANGO=1.3.1 DB=mysql
+  - DJANGO=1.3.1 DB=postgres
+before_script:
+  - mysql -e 'create database sentry;'
+  - psql -c 'create database sentry;' -U postgres
 install:
   - pip install -q Django==$DJANGO --use-mirrors
   - pip install pep8 --use-mirrors
diff --git a/runtests.py b/runtests.py
index 8b2ab8087c..612ee36265 100644
--- a/runtests.py
+++ b/runtests.py
@@ -15,6 +15,27 @@ from django.conf import settings
 if not settings.configured:
     os.environ['DJANGO_SETTINGS_MODULE'] = 'sentry.conf.server'
 
+test_db = os.environ.get('DB', 'sqlite')
+if test_db == 'mysql':
+    settings.DATABASES['default'].update({
+        'ENGINE': 'django.db.backends.mysql',
+        'NAME': 'sentry',
+    })
+elif test_db == 'postgres':
+    settings.DATABASES['default'].update({
+        'ENGINE': 'django.db.backends.postgresql_psycopg2',
+        'USER': 'postgres',
+        'NAME': 'sentry',
+        'OPTIONS': {
+            'autocommit': True,
+        }
+    })
+elif test_db == 'sqlite':
+    settings.DATABASES['default'].update({
+        'ENGINE': 'django.db.backends.sqlite3',
+        'NAME': ':memory:',
+    })
+
 # override a few things with our test specifics
 settings.INSTALLED_APPS = tuple(settings.INSTALLED_APPS) + (
     'tests',
diff --git a/setup.py b/setup.py
index f47a38b4b2..9c5f124495 100755
--- a/setup.py
+++ b/setup.py
@@ -34,7 +34,7 @@ except ImportError:
     pass
 
 tests_require = [
-    'django-nose==0.1.3',
+    'django-nose==1.1',
     'eventlet==0.9.16',
     'nose==1.1.2',
     'nydus==0.8.2',
