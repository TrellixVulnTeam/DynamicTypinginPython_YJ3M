commit 9887361b4681479d83df569f418054659878fba7
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Feb 23 22:25:34 2012 -0800

    Updates to permissions and translation tags

diff --git a/sentry/templates/sentry/admin/users/list.html b/sentry/templates/sentry/admin/users/list.html
index 9cc84cd249..703e6edbb8 100644
--- a/sentry/templates/sentry/admin/users/list.html
+++ b/sentry/templates/sentry/admin/users/list.html
@@ -13,7 +13,7 @@
 {% endblock %}
 
 {% block page_header %}
-    <a href="{% url sentry-admin-new-user %}" class="btn pull-right btn-primary">+ {% trans "Create a new user" %}</a>
+    <a href="{% url sentry-admin-new-user %}" class="btn pull-right btn-primary">{% trans "Create a new user" %}</a>
     {{ block.super }}
 {% endblock %}
 
diff --git a/sentry/templates/sentry/projects/list.html b/sentry/templates/sentry/projects/list.html
index db0df21454..dbec818de4 100644
--- a/sentry/templates/sentry/projects/list.html
+++ b/sentry/templates/sentry/projects/list.html
@@ -7,7 +7,9 @@
 {% block bodyclass %}{% endblock %}
 
 {% block page_header %}
-    <a href="{% url sentry-new-project %}" class="btn pull-right btn-primary">+ Create a new project</a>
+    {% if can_create_projects %}
+        <a href="{% url sentry-new-project %}" class="btn pull-right btn-primary">{% trans "Create a new project" %}</a>
+    {% endif %}
     {{ block.super }}
 {% endblock %}
 
@@ -18,7 +20,7 @@
 {% block content %}
     <section class="body">
         {% if project_list %}
-            <p>The following is a list of projects that you are a member of.</p>
+            <p>{% trans "The following is a list of projects that you are a member of." %}</p>
             <table class="table table-zebra table-bordered">
                 <colgroup>
                     <col>
@@ -28,10 +30,10 @@
                 </colgroup>
                 <thead>
                     <tr>
-                        <th>Name</th>
-                        <th style="text-align:center;">Membership</th>
-                        <th style="text-align:center;">Owner</th>
-                        <th style="text-align:center;">Status</th>
+                        <th>{% trans "Name" %}</th>
+                        <th style="text-align:center;">{% trans "Membership" %}</th>
+                        <th style="text-align:center;">{% trans "Owner" %}</th>
+                        <th style="text-align:center;">{% trans "Status" %}</th>
                     </tr>
                 </thead>
                 <tbody>
@@ -48,7 +50,7 @@
                                 {% if project.owner %}
                                     {{ project.owner.username }}
                                 {% else %}
-                                    <em>no owner</em>
+                                    <em>{% trans "no owner" %}</em>
                                 {% endif %}
                             </td>
                             <td style="text-align:center;vertical-align:middle;">{{ project.get_status_display }}</td>
@@ -60,7 +62,7 @@
             {% if can_create_projects %}
                 <div class="alert alert-info">You do not have access to any projects. Would you like to <a href="{% url sentry-new-project %}">create a new project</a>?</div>
             {% else %}
-                <div class="alert alert-notice">You do not have access to any projects. Ask an administrator to add you as a member.</div>
+                <div class="alert alert-notice">{% trans "You do not have access to any projects. Ask an administrator to add you as a member." %}</div>
             {% endif %}
         {% endif %}
     </section>
diff --git a/sentry/templates/sentry/projects/manage.html b/sentry/templates/sentry/projects/manage.html
index 5c8b9f3202..64b8584d0f 100644
--- a/sentry/templates/sentry/projects/manage.html
+++ b/sentry/templates/sentry/projects/manage.html
@@ -7,7 +7,7 @@
 {% block breadcrumb %}
     {{ block.super }}
     <li class="divider">/</li>
-    <li><a href="{% url sentry-manage-project project.pk %}">Manage</a></li>
+    <li><a href="{% url sentry-manage-project project.pk %}">{% trans "Manage" %}</a></li>
 {% endblock %}
 
 {% block main %}
@@ -52,7 +52,9 @@
                 </fieldset>
             </form>
             <div class="page-header">
-                <a href="{% url sentry-new-project-member project.pk %}" class="btn pull-right small btn-primary">{% trans "+ New Member" %}</a>
+                {% if can_add_member %}
+                    <a href="{% url sentry-new-project-member project.pk %}" class="btn pull-right small btn-primary">{% trans "New Member" %}</a>
+                {% endif %}
                 <h2>{% trans "Members" %}</h2>
             </div>
             <table class="table table-bordered table-zebra">
@@ -77,7 +79,7 @@
                             </td>
                             <td style="text-align:center;">
                                 {% if user == project.owner %}
-                                    <em>owner</em>
+                                    <em>{% trans "owner" %}</em>
                                 {% else %}
                                     <a href="{% url sentry-remove-project-member project.pk member.pk %}">{% trans "Revoke" %}</a>
                                 {% endif %}
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 07b7074527..6d62250162 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -22,6 +22,20 @@ from sentry.web.helpers import render_to_response, get_project_list, \
   plugin_config
 
 
+def _can_add_project_member(user, project):
+    result = plugins.first('has_perm', user, 'add_project_member', project)
+    if result is False and not user.has_perm('sentry.can_add_projectmember'):
+        return False
+    return True
+
+
+def _can_remove_project(user, project):
+    result = plugins.first('has_perm', user, 'remove_project', project)
+    if result is False and not user.has_perm('sentry.can_remove_project'):
+        return False
+    return True
+
+
 @login_required
 def project_list(request):
     project_list = get_project_list(request.user, hidden=True)
@@ -75,8 +89,7 @@ def remove_project(request, project):
     if str(project.id) == str(settings.PROJECT):
         return HttpResponseRedirect(reverse('sentry-project-list'))
 
-    result = plugins.first('has_perm', request.user, 'remove_project', project)
-    if result is False and not request.user.has_perm('sentry.can_remove_project'):
+    if not _can_remove_project(request.user, project):
         return HttpResponseRedirect(reverse('sentry'))
 
     project_list = filter(lambda x: x != project, get_project_list(request.user).itervalues())
@@ -125,6 +138,8 @@ def manage_project(request, project):
 
     context = csrf(request)
     context.update({
+        'can_add_member': _can_add_project_member(request.user, project),
+        'can_remove_project': _can_remove_project(request.user, project),
         'page': 'details',
         'form': form,
         'project': project,
@@ -137,8 +152,8 @@ def manage_project(request, project):
 @csrf_protect
 @has_access(MEMBER_OWNER)
 def new_project_member(request, project):
-    result = plugins.first('has_perm', request.user, 'add_project_member', project)
-    if result is False and not request.user.has_perm('sentry.can_add_projectmember'):
+    can_add_member = _can_add_project_member(request.user, project)
+    if not can_add_member:
         return HttpResponseRedirect(reverse('sentry'))
 
     form = NewProjectMemberForm(project, request.POST or None, initial={
