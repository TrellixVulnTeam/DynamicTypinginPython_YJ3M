commit f59ef4c84c436f6ea8a092d63f8bc3974f9fb15b
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jun 17 00:45:20 2012 -0700

    Dont rely on Django's cache_page decorator (as we want to use our internal cache backend)

diff --git a/sentry/web/api.py b/sentry/web/api.py
index 0d6d212a0a..6bf1820193 100644
--- a/sentry/web/api.py
+++ b/sentry/web/api.py
@@ -11,7 +11,7 @@ import logging
 from django.core.urlresolvers import reverse
 from django.http import HttpResponse, HttpResponseBadRequest, \
   HttpResponseForbidden, HttpResponseRedirect
-from django.views.decorators.cache import cache_page, never_cache
+from django.views.decorators.cache import never_cache
 from django.views.decorators.csrf import csrf_exempt
 from django.views.decorators.http import require_http_methods
 from django.views.decorators.vary import vary_on_cookie
@@ -24,6 +24,7 @@ from sentry.coreapi import project_from_auth_vars, project_from_id, \
 from sentry.models import Group, GroupBookmark, Project, View
 from sentry.templatetags.sentry_helpers import as_bookmarks
 from sentry.utils import json
+from sentry.utils.cache import cache
 from sentry.utils.db import has_trending
 from sentry.utils.http import is_same_domain, is_valid_origin, apply_access_control_headers
 from sentry.web.decorators import has_access
@@ -329,13 +330,11 @@ def clear(request, project):
 
 
 @vary_on_cookie
-@cache_page(60 * 5)
 @csrf_exempt
 @has_access
 def chart(request, project=None):
     gid = request.REQUEST.get('gid')
     days = int(request.REQUEST.get('days', '90'))
-
     if gid:
         try:
             group = Group.objects.get(pk=gid)
@@ -346,8 +345,13 @@ def chart(request, project=None):
     elif project:
         data = Project.objects.get_chart_data(project, max_days=days)
     else:
-        project_list = get_project_list(request.user).values()
-        data = Project.objects.get_chart_data_for_group(project_list, max_days=days)
+        cache_key = 'api.chart:user=%s,days=%s' % (request.user.id, days)
+
+        data = cache.get(cache_key)
+        if data is None:
+            project_list = get_project_list(request.user).values()
+            data = Project.objects.get_chart_data_for_group(project_list, max_days=days)
+            cache.set(cache_key, data, 300)
 
     response = HttpResponse(json.dumps(data))
     response['Content-Type'] = 'application/json'
diff --git a/setup.py b/setup.py
index 145b3b87db..bef1fcc8ec 100755
--- a/setup.py
+++ b/setup.py
@@ -73,7 +73,7 @@ dependency_links = [
 
 setup(
     name='sentry',
-    version='4.7.2',
+    version='4.7.3',
     author='David Cramer',
     author_email='dcramer@gmail.com',
     url='http://github.com/dcramer/sentry',
