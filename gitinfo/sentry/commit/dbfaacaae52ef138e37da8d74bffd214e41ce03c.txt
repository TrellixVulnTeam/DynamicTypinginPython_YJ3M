commit dbfaacaae52ef138e37da8d74bffd214e41ce03c
Author: Mark Story <mark@sentry.io>
Date:   Mon May 27 13:42:36 2019 -0400

    ref(github) Consolidate query building logic
    
    Consolidate three copies of code into a function.

diff --git a/src/sentry/integrations/github/integration.py b/src/sentry/integrations/github/integration.py
index 73fa7a7c69..080c483832 100644
--- a/src/sentry/integrations/github/integration.py
+++ b/src/sentry/integrations/github/integration.py
@@ -85,6 +85,11 @@ API_ERRORS = {
 }
 
 
+def build_repository_query(metadata, name, query):
+    account_type = 'user' if metadata['account_type'] == 'User' else 'org'
+    return (u'%s:%s %s' % (account_type, name, query)).encode('utf-8')
+
+
 class GitHubIntegration(IntegrationInstallation, GitHubIssueBasic, RepositoryMixin):
     repo_search = True
 
@@ -98,8 +103,7 @@ class GitHubIntegration(IntegrationInstallation, GitHubIssueBasic, RepositoryMix
                 'identifier': i['full_name']
             } for i in self.get_client().get_repositories()]
 
-        account_type = 'user' if self.model.metadata['account_type'] == 'User' else 'org'
-        full_query = (u'%s:%s %s' % (account_type, self.model.name, query)).encode('utf-8')
+        full_query = build_repository_query(self.model.metadata, self.model.name, query)
         response = self.get_client().search_repositories(full_query)
         return [{
             'name': i['name'],
diff --git a/src/sentry/integrations/github/search.py b/src/sentry/integrations/github/search.py
index c2f0e40972..24cadc5cd2 100644
--- a/src/sentry/integrations/github/search.py
+++ b/src/sentry/integrations/github/search.py
@@ -4,6 +4,7 @@ from rest_framework.response import Response
 
 from sentry.api.bases.integration import IntegrationEndpoint
 from sentry.integrations.exceptions import ApiError
+from sentry.integrations.github.integration import build_repository_query
 from sentry.models import Integration
 
 
@@ -45,9 +46,7 @@ class GitHubSearchEndpoint(IntegrationEndpoint):
             } for i in response.get('items', [])])
 
         if field == 'repo':
-            account_type = 'user' if integration.metadata['account_type'] == 'User' else 'org'
-            full_query = (u'%s:%s %s' % (account_type, integration.name, query)).encode('utf-8')
-
+            full_query = build_repository_query(integration.metadata, integration.name, query)
             try:
                 response = installation.get_client().search_repositories(full_query)
             except ApiError as err:
diff --git a/src/sentry/integrations/github_enterprise/integration.py b/src/sentry/integrations/github_enterprise/integration.py
index 0e30eb9de0..cb31531579 100644
--- a/src/sentry/integrations/github_enterprise/integration.py
+++ b/src/sentry/integrations/github_enterprise/integration.py
@@ -14,7 +14,7 @@ from sentry.integrations.exceptions import ApiError
 from sentry.integrations.repositories import RepositoryMixin
 from sentry.pipeline import NestedPipelineView, PipelineView
 from sentry.utils.http import absolute_uri
-from sentry.integrations.github.integration import GitHubIntegrationProvider
+from sentry.integrations.github.integration import GitHubIntegrationProvider, build_repository_query
 from sentry.integrations.github.issues import GitHubIssueBasic
 from sentry.integrations.github.utils import get_jwt
 
@@ -114,8 +114,7 @@ class GitHubEnterpriseIntegration(IntegrationInstallation, GitHubIssueBasic, Rep
                 'identifier': i['full_name']
             } for i in self.get_client().get_repositories()]
 
-        account_type = 'user' if self.model.metadata['account_type'] == 'User' else 'org'
-        full_query = (u'%s:%s %s' % (account_type, self.model.name, query)).encode('utf-8')
+        full_query = build_repository_query(self.model.metadata, self.model.name, query)
         response = self.get_client().search_repositories(full_query)
         return [{
             'name': i['name'],
