commit 3137bc26ee89565996986cb56575bc9fe8c7da4b
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Wed Aug 22 14:35:19 2018 -0700

    fix(discover): Querybuilder always rejects with an Error (#9470)
    
    Reject with an error if there are no projects selected

diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/queryBuilder.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/queryBuilder.jsx
index 09a9db1d45..07568da55f 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/queryBuilder.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/queryBuilder.jsx
@@ -175,7 +175,7 @@ export default function createQueryBuilder(initial = {}, organization) {
 
     // Reject immediately if no projects are available
     if (!data.projects.length) {
-      return Promise.reject(t('No projects selected'));
+      return Promise.reject(new Error(t('No projects selected')));
     }
 
     return api
diff --git a/tests/js/spec/views/organizationDiscover/queryBuilder.spec.jsx b/tests/js/spec/views/organizationDiscover/queryBuilder.spec.jsx
index c0fb1c6079..c40abeb126 100644
--- a/tests/js/spec/views/organizationDiscover/queryBuilder.spec.jsx
+++ b/tests/js/spec/views/organizationDiscover/queryBuilder.spec.jsx
@@ -121,7 +121,9 @@ describe('Query Builder', function() {
 
     it('handles no projects', async function() {
       const result = queryBuilder.fetch({projects: []});
-      await expect(result).rejects.toEqual('No projects selected');
+      await expect(result).rejects.toMatchObject({
+        message: 'No projects selected',
+      });
       expect(discoverMock).not.toHaveBeenCalled();
     });
   });
