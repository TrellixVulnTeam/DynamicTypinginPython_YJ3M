commit 386b8b90c32299dc9b43cf33bb3201c9ec5e0812
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Nov 23 12:16:37 2012 -0800

    Hide system frames by default and allow them to be shown via a checkbox

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index e1f6758f85..7cc3eca059 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -295,6 +295,7 @@ class Stacktrace(Interface):
         return output
 
     def to_html(self, event):
+        system_frames = 0
         frames = []
         for frame in self.frames:
             if frame.get('context_line') and frame.get('lineno') is not None:
@@ -315,6 +316,8 @@ class Stacktrace(Interface):
             else:
                 lineno = None
 
+            in_app = bool(frame.get('in_app', True))
+
             frames.append({
                 'abs_path': frame.get('abs_path'),
                 'filename': frame['filename'],
@@ -323,8 +326,12 @@ class Stacktrace(Interface):
                 'lineno': lineno,
                 'context': context,
                 'vars': context_vars,
+                'in_app': in_app,
             })
 
+            if not in_app:
+                system_frames += 1
+
         if env.request and env.request.user.is_authenticated():
             display = UserOption.objects.get_value(
                 user=env.request.user,
@@ -336,6 +343,7 @@ class Stacktrace(Interface):
                 frames.reverse()
 
         return render_to_string('sentry/partial/interfaces/stacktrace.html', {
+            'system_frames': system_frames,
             'event': event,
             'frames': frames,
             'stacktrace': self.get_traceback(event),
diff --git a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
index 7e658bc262..00f445c7ca 100644
--- a/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
+++ b/src/sentry/templates/sentry/partial/interfaces/stacktrace.html
@@ -3,13 +3,18 @@
 
 <div id="traceback" class="module">
     <div class="page-header">
-      <a href="javascript:void(0)" data-container="#raw_stacktrace" data-title="Stacktrace" class="popup btn small pull-right">{% trans "Raw" %}</a>
-      <h2>{% trans "Stacktrace" %}</h2>
+        <a href="javascript:void(0)" data-container="#raw_stacktrace" data-title="Stacktrace" class="popup btn small pull-right">{% trans "Raw" %}</a>
+        {% if system_frames %}
+            <form class="pull-right" style="margin:8px 20px 0 0;">
+                <label class="checkbox"><input type="checkbox" id="show_hidden_frames"> Show {{ system_frames }} hidden frames</label>
+            </form>
+        {% endif %}
+        <h2>{% trans "Stacktrace" %}</h2>
     </div>
     <div class="module-content">
         <ul class="traceback">
             {% for frame in frames %}
-                <li class="frame">
+                <li class="frame{% if not frame.in_app %} system-frame{% endif %}">
                     <p>
                         <code>{{ frame.filename }}</code>
                         {% if frame.function %} in <code>{{ frame.function }}</code>{% endif %}
@@ -56,3 +61,16 @@
 <div id="raw_stacktrace" style="display: none;">
     <pre>{{ stacktrace }}</pre>
 </div>
+
+{% if system_frames %}
+    <script type="text/javascript">
+    $('#show_hidden_frames').change(function(e){
+        var $el = $(e.target);
+        if ($el.is(':checked')) {
+            $('.traceback li.system-frame').show();
+        } else {
+            $('.traceback li.system-frame').hide();
+        }
+    }).change();
+    </script>
+{% endif %}
\ No newline at end of file
