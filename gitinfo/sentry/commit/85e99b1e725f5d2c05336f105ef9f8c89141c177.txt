commit 85e99b1e725f5d2c05336f105ef9f8c89141c177
Author: Matej Minar <matej.minar@sentry.io>
Date:   Tue Feb 18 13:14:37 2020 +0100

    fix(ui): Added projectId when navigating to release detail (for non global-views) (#17050)
    
    * fix(ui): preserve global selection when navigating to release detail
    
    * fix(ui): Fixed the way we link to release detail for non global-views user
    
    * import order
    
    * review
    
    * Update src/sentry/static/sentry/app/components/version.tsx
    
    * changed router import

diff --git a/src/sentry/static/sentry/app/components/actions/resolve.jsx b/src/sentry/static/sentry/app/components/actions/resolve.jsx
index b48b714eb4..eb1e06ad93 100644
--- a/src/sentry/static/sentry/app/components/actions/resolve.jsx
+++ b/src/sentry/static/sentry/app/components/actions/resolve.jsx
@@ -8,6 +8,7 @@ import DropdownLink from 'app/components/dropdownLink';
 import ActionLink from 'app/components/actions/actionLink';
 import Tooltip from 'app/components/tooltip';
 import GuideAnchor from 'app/components/assistant/guideAnchor';
+import {formatVersion} from 'app/utils/formatters';
 
 export default class ResolveActions extends React.Component {
   static propTypes = {
@@ -184,7 +185,10 @@ export default class ResolveActions extends React.Component {
                       }}
                     >
                       {latestRelease
-                        ? t('The current release (%s)', latestRelease.version)
+                        ? t(
+                            'The current release (%s)',
+                            formatVersion(latestRelease.version)
+                          )
                         : t('The current release')}
                     </ActionLink>
                   </Tooltip>
diff --git a/src/sentry/static/sentry/app/components/charts/releaseSeries.jsx b/src/sentry/static/sentry/app/components/charts/releaseSeries.jsx
index b0cc021fb1..0c4c5a670d 100644
--- a/src/sentry/static/sentry/app/components/charts/releaseSeries.jsx
+++ b/src/sentry/static/sentry/app/components/charts/releaseSeries.jsx
@@ -113,9 +113,12 @@ class ReleaseSeries extends React.Component {
           name: formatVersion(release.version, true),
           value: formatVersion(release.version, true),
           onClick: () => {
-            router.push(
-              `/organizations/${organization.slug}/releases/${release.version}/`
-            );
+            router.push({
+              pathname: `/organizations/${organization.slug}/releases/${release.version}/`,
+              query: new Set(organization.features).has('global-views')
+                ? undefined
+                : {project: router.location.query.project},
+            });
           },
           label: {
             formatter: () => formatVersion(release.version, true),
diff --git a/src/sentry/static/sentry/app/components/group/seenInfo.jsx b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
index 65432d573e..d418cdd186 100644
--- a/src/sentry/static/sentry/app/components/group/seenInfo.jsx
+++ b/src/sentry/static/sentry/app/components/group/seenInfo.jsx
@@ -99,7 +99,7 @@ class SeenInfo extends React.Component {
               projectId={projectId}
               version={release.version}
             >
-              <Version orgId={orgId} version={release.version} truncate />
+              <Version version={release.version} truncate />
             </VersionHoverCard>
           </dd>
         ) : !this.props.hasRelease ? (
diff --git a/src/sentry/static/sentry/app/components/resolutionBox.jsx b/src/sentry/static/sentry/app/components/resolutionBox.jsx
index 989d9731fa..24e87f9696 100644
--- a/src/sentry/static/sentry/app/components/resolutionBox.jsx
+++ b/src/sentry/static/sentry/app/components/resolutionBox.jsx
@@ -18,11 +18,10 @@ const StyledTimeSince = styled(TimeSince)`
 export default class ResolutionBox extends React.Component {
   static propTypes = {
     statusDetails: PropTypes.object.isRequired,
-    orgId: PropTypes.string.isRequired,
   };
 
   renderReason = () => {
-    const {orgId, statusDetails} = this.props;
+    const {statusDetails} = this.props;
     const actor = statusDetails.actor ? (
       <strong>
         <UserAvatar user={statusDetails.actor} size={20} className="avatar" />
@@ -39,15 +38,11 @@ export default class ResolutionBox extends React.Component {
     } else if (statusDetails.inRelease && statusDetails.actor) {
       return tct('[actor] marked this issue as resolved in version [version].', {
         actor,
-        version: (
-          <Version version={statusDetails.inRelease} orgId={orgId} tooltipRawVersion />
-        ),
+        version: <Version version={statusDetails.inRelease} tooltipRawVersion />,
       });
     } else if (statusDetails.inRelease) {
       return tct('This issue has been marked as resolved in version [version].', {
-        version: (
-          <Version version={statusDetails.inRelease} orgId={orgId} tooltipRawVersion />
-        ),
+        version: <Version version={statusDetails.inRelease} tooltipRawVersion />,
       });
     } else if (!!statusDetails.inCommit) {
       return tct('This issue has been marked as resolved by [commit]', {
diff --git a/src/sentry/static/sentry/app/components/version.tsx b/src/sentry/static/sentry/app/components/version.tsx
index 4dab15c77d..fadf48c2ed 100644
--- a/src/sentry/static/sentry/app/components/version.tsx
+++ b/src/sentry/static/sentry/app/components/version.tsx
@@ -1,7 +1,11 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 import styled from '@emotion/styled';
+import {withRouter} from 'react-router';
+import {WithRouterProps} from 'react-router/lib/withRouter';
 
+import {Organization} from 'app/types';
+import SentryTypes from 'app/sentryTypes';
 import GlobalSelectionLink from 'app/components/globalSelectionLink';
 import Link from 'app/components/links/link';
 import Tooltip from 'app/components/tooltip';
@@ -10,6 +14,7 @@ import Clipboard from 'app/components/clipboard';
 import overflowEllipsis from 'app/styles/overflowEllipsis';
 import space from 'app/styles/space';
 import {formatVersion} from 'app/utils/formatters';
+import withOrganization from 'app/utils/withOrganization';
 
 type Props = {
   /**
@@ -17,15 +22,15 @@ type Props = {
    */
   version: string;
   /**
-   * Should the version be a link to the release page
+   *  Organization injected by withOrganization HOC
    */
-  anchor?: boolean;
+  organization: Organization;
   /**
-   * Organization id needed for linking to release page
+   * Should the version be a link to the release page
    */
-  orgId?: string;
+  anchor?: boolean;
   /**
-   * Should link to Release preserve user's global selection values
+   * Should link to release page preserve user's global selection values
    */
   preserveGlobalSelection?: boolean;
   /**
@@ -37,7 +42,8 @@ type Props = {
    */
   withPackage?: boolean;
   /**
-   * Will add project project ID to the linked url
+   * Will add project ID to the linked url (can be overriden by preserveGlobalSelection).
+   * If not provided and user does not have global-views enabled, it will try to take it from current url query.
    */
   projectId?: string;
   /**
@@ -49,25 +55,39 @@ type Props = {
 
 const Version = ({
   version,
-  orgId,
+  organization,
   anchor = true,
   preserveGlobalSelection,
   tooltipRawVersion,
   withPackage,
   projectId,
-  className,
   truncate,
-}: Props) => {
+  className,
+  location,
+}: WithRouterProps & Props) => {
   const LinkComponent = preserveGlobalSelection ? GlobalSelectionLink : Link;
   const versionToDisplay = formatVersion(version, withPackage);
 
+  let releaseDetailProjectId: null | undefined | string | string[];
+  if (!preserveGlobalSelection) {
+    if (projectId) {
+      // if user specifically sets projectId and not preserveGlobalSelection, use that
+      releaseDetailProjectId = projectId;
+    } else if (!new Set(organization.features).has('global-views')) {
+      // we need this for users without global-views, otherwise they might get `This release may not be in your selected project`
+      releaseDetailProjectId = location.query.project;
+    }
+  }
+
   const renderVersion = () => {
-    if (anchor && orgId) {
+    if (anchor && organization.slug) {
       return (
         <LinkComponent
           to={{
-            pathname: `/organizations/${orgId}/releases/${encodeURIComponent(version)}/`,
-            query: projectId ? {project: projectId} : undefined,
+            pathname: `/organizations/${organization.slug}/releases/${encodeURIComponent(
+              version
+            )}/`,
+            query: releaseDetailProjectId ? {project: releaseDetailProjectId} : undefined,
           }}
           className={className}
         >
@@ -115,16 +135,14 @@ const Version = ({
 
 Version.propTypes = {
   version: PropTypes.string.isRequired,
-  orgId: PropTypes.string,
+  organization: SentryTypes.Organization.isRequired,
   anchor: PropTypes.bool,
-  /**
-   * Should link to Release preserve user's global selection values
-   */
   preserveGlobalSelection: PropTypes.bool,
   tooltipRawVersion: PropTypes.bool,
-  className: PropTypes.string,
+  withPackage: PropTypes.bool,
   projectId: PropTypes.string,
   truncate: PropTypes.bool,
+  className: PropTypes.string,
 };
 
 const VersionText = styled('span')<{truncate?: boolean}>`
@@ -156,4 +174,8 @@ const TooltipClipboardIconWrapper = styled('span')`
   }
 `;
 
-export default Version;
+type PropsWithoutOrg = Omit<Props, 'organization'>;
+
+export default withOrganization(withRouter(Version)) as React.ComponentClass<
+  PropsWithoutOrg
+>;
diff --git a/src/sentry/static/sentry/app/components/versionHoverCard.jsx b/src/sentry/static/sentry/app/components/versionHoverCard.jsx
index 9420d3861b..1a5253e838 100644
--- a/src/sentry/static/sentry/app/components/versionHoverCard.jsx
+++ b/src/sentry/static/sentry/app/components/versionHoverCard.jsx
@@ -127,7 +127,7 @@ class VersionHoverCard extends React.Component {
         <HeaderWrapper>
           {t('Release')}
           <VersionWrapper>
-            <StyledVersion version={version} truncate />
+            <StyledVersion version={version} truncate anchor={false} />
 
             <Clipboard value={version}>
               <ClipboardIconWrapper>
diff --git a/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.jsx b/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.jsx
index 908c43d7c4..d0d6bc0e33 100644
--- a/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.jsx
+++ b/src/sentry/static/sentry/app/views/organizationActivity/activityFeedItem.jsx
@@ -73,7 +73,7 @@ class ActivityItem extends React.Component {
 
     const versionLink = data.version ? (
       <VersionHoverCard orgId={orgId} projectId={project.slug} version={data.version}>
-        <Version version={data.version} orgId={orgId} />
+        <Version version={data.version} projectId={project.id} />
       </VersionHoverCard>
     ) : null;
 
diff --git a/src/sentry/static/sentry/app/views/organizationGroupDetails/groupActivityItem.jsx b/src/sentry/static/sentry/app/views/organizationGroupDetails/groupActivityItem.jsx
index 2dfb18a16f..25a925e86e 100644
--- a/src/sentry/static/sentry/app/views/organizationGroupDetails/groupActivityItem.jsx
+++ b/src/sentry/static/sentry/app/views/organizationGroupDetails/groupActivityItem.jsx
@@ -14,11 +14,10 @@ class GroupActivityItem extends React.Component {
     author: PropTypes.node,
     item: PropTypes.object,
     orgId: PropTypes.string,
-    projectId: PropTypes.string,
   };
 
   render() {
-    const {author, item, orgId, projectId} = this.props;
+    const {author, item, orgId} = this.props;
     const {data} = item;
 
     const issuesLink = `/organizations/${orgId}/issues/`;
@@ -36,7 +35,7 @@ class GroupActivityItem extends React.Component {
         return data.version
           ? t('%(author)s marked this issue as resolved in %(version)s', {
               author,
-              version: <Version version={data.version} orgId={orgId} tooltipRawVersion />,
+              version: <Version version={data.version} tooltipRawVersion />,
             })
           : t('%s marked this issue as resolved in the upcoming release', author);
       case 'set_resolved_in_commit':
@@ -107,14 +106,7 @@ class GroupActivityItem extends React.Component {
         return data.version
           ? t('%(author)s marked this issue as a regression in %(version)s', {
               author,
-              version: (
-                <Version
-                  version={data.version}
-                  orgId={orgId}
-                  projectId={projectId}
-                  tooltipRawVersion
-                />
-              ),
+              version: <Version version={data.version} tooltipRawVersion />,
             })
           : t('%s marked this issue as a regression', author);
       case 'create_issue':
diff --git a/src/sentry/static/sentry/app/views/projectsDashboard/deploys.jsx b/src/sentry/static/sentry/app/views/projectsDashboard/deploys.jsx
index 7a2ebcd3c5..210cc87455 100644
--- a/src/sentry/static/sentry/app/views/projectsDashboard/deploys.jsx
+++ b/src/sentry/static/sentry/app/views/projectsDashboard/deploys.jsx
@@ -54,11 +54,10 @@ class Deploy extends React.Component {
   static propTypes = {
     deploy: SentryTypes.Deploy.isRequired,
     project: SentryTypes.Project.isRequired,
-    organization: SentryTypes.Organization.isRequired,
   };
 
   render() {
-    const {deploy, organization, project} = this.props;
+    const {deploy, project} = this.props;
 
     return (
       <DeployRow justifyContent="space-between">
@@ -67,7 +66,6 @@ class Deploy extends React.Component {
         <StyledTextOverflow>
           <Version
             version={deploy.version}
-            orgId={organization.slug}
             projectId={project.id}
             tooltipRawVersion
             truncate
diff --git a/src/sentry/static/sentry/app/views/releases/list/releaseList.jsx b/src/sentry/static/sentry/app/views/releases/list/releaseList.jsx
index ce8a49fcb7..93651b4cb3 100644
--- a/src/sentry/static/sentry/app/views/releases/list/releaseList.jsx
+++ b/src/sentry/static/sentry/app/views/releases/list/releaseList.jsx
@@ -42,7 +42,6 @@ const ReleaseList = props => {
                   <VersionColumn>
                     <VersionWrapper>
                       <Version
-                        orgId={orgId}
                         version={release.version}
                         preserveGlobalSelection
                         tooltipRawVersion
diff --git a/src/sentry/static/sentry/app/views/releasesV2/list/releasesV2TableRow.tsx b/src/sentry/static/sentry/app/views/releasesV2/list/releasesV2TableRow.tsx
index a394aba25d..85a9cac668 100644
--- a/src/sentry/static/sentry/app/views/releasesV2/list/releasesV2TableRow.tsx
+++ b/src/sentry/static/sentry/app/views/releasesV2/list/releasesV2TableRow.tsx
@@ -30,7 +30,6 @@ const ReleasesV2TableRow = ({
   crashes,
   errors,
   releaseAdoptionPercent,
-  organizationId,
 }: Props) => {
   return (
     <StyledPanelItem key={release.name}>
@@ -41,7 +40,6 @@ const ReleasesV2TableRow = ({
 
         <Column>
           <StyledVersion
-            orgId={organizationId}
             version={release.name}
             preserveGlobalSelection
             tooltipRawVersion
diff --git a/tests/js/spec/components/__snapshots__/resolutionBox.spec.jsx.snap b/tests/js/spec/components/__snapshots__/resolutionBox.spec.jsx.snap
index 5016acd08e..11e40ae8cf 100644
--- a/tests/js/spec/components/__snapshots__/resolutionBox.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/resolutionBox.spec.jsx.snap
@@ -236,9 +236,8 @@ exports[`ResolutionBox render() handles inRelease 1`] = `
       >
         This issue has been marked as resolved in version 
       </span>
-      <Version
+      <WithOrganizationMockWrapper
         key="1"
-        orgId="org"
         tooltipRawVersion={true}
         version="1.0"
       />
@@ -315,9 +314,8 @@ exports[`ResolutionBox render() handles inRelease with actor 1`] = `
       >
          marked this issue as resolved in version 
       </span>
-      <Version
+      <WithOrganizationMockWrapper
         key="2"
-        orgId="org"
         tooltipRawVersion={true}
         version="1.0"
       />
diff --git a/tests/js/spec/components/__snapshots__/version.spec.jsx.snap b/tests/js/spec/components/__snapshots__/version.spec.jsx.snap
new file mode 100644
index 0000000000..2befa1d779
--- /dev/null
+++ b/tests/js/spec/components/__snapshots__/version.spec.jsx.snap
@@ -0,0 +1,169 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`Version renders 1`] = `
+<WithOrganizationMockWrapper
+  version="foo.bar.Baz@1.0.0+20200101"
+>
+  <withRouter(Version)
+    organization={
+      Object {
+        "access": Array [
+          "org:read",
+          "org:write",
+          "org:admin",
+          "org:integrations",
+          "project:read",
+          "project:write",
+          "project:admin",
+          "team:read",
+          "team:write",
+          "team:admin",
+        ],
+        "features": Array [],
+        "id": "3",
+        "name": "Organization Name",
+        "onboardingTasks": Array [],
+        "projects": Array [],
+        "scrapeJavaScript": true,
+        "slug": "org-slug",
+        "status": Object {
+          "id": "active",
+          "name": "active",
+        },
+        "teams": Array [],
+      }
+    }
+    version="foo.bar.Baz@1.0.0+20200101"
+  >
+    <Version
+      location={
+        Object {
+          "query": Object {},
+        }
+      }
+      organization={
+        Object {
+          "access": Array [
+            "org:read",
+            "org:write",
+            "org:admin",
+            "org:integrations",
+            "project:read",
+            "project:write",
+            "project:admin",
+            "team:read",
+            "team:write",
+            "team:admin",
+          ],
+          "features": Array [],
+          "id": "3",
+          "name": "Organization Name",
+          "onboardingTasks": Array [],
+          "projects": Array [],
+          "scrapeJavaScript": true,
+          "slug": "org-slug",
+          "status": Object {
+            "id": "active",
+            "name": "active",
+          },
+          "teams": Array [],
+        }
+      }
+      router={
+        Object {
+          "createHref": [MockFunction] {
+            "calls": Array [
+              Array [
+                Object {
+                  "pathname": "/organizations/org-slug/releases/foo.bar.Baz%401.0.0%2B20200101/",
+                  "query": undefined,
+                },
+              ],
+            ],
+            "results": Array [
+              Object {
+                "type": "return",
+                "value": undefined,
+              },
+            ],
+          },
+          "go": [MockFunction],
+          "goBack": [MockFunction],
+          "goForward": [MockFunction],
+          "isActive": [MockFunction],
+          "listen": [MockFunction],
+          "location": Object {
+            "query": Object {},
+          },
+          "push": [MockFunction],
+          "replace": [MockFunction],
+          "setRouteLeaveHook": [MockFunction],
+        }
+      }
+      version="foo.bar.Baz@1.0.0+20200101"
+    >
+      <Tooltip
+        containerDisplayMode="inline-block"
+        disabled={true}
+        isHoverable={true}
+        position="top"
+        title={
+          <ForwardRef(render)
+            onClick={[Function]}
+          >
+            <ForwardRef(render)>
+              foo.bar.Baz@1.0.0+20200101
+            </ForwardRef(render)>
+            <Clipboard
+              errorMessage="Error copying to clipboard"
+              hideMessages={false}
+              successMessage="Copied to clipboard"
+              value="foo.bar.Baz@1.0.0+20200101"
+            >
+              <ForwardRef(render)>
+                <IconCopy
+                  color="white"
+                  size="xs"
+                />
+              </ForwardRef(render)>
+            </Clipboard>
+          </ForwardRef(render)>
+        }
+      >
+        <Link
+          to={
+            Object {
+              "pathname": "/organizations/org-slug/releases/foo.bar.Baz%401.0.0%2B20200101/",
+              "query": undefined,
+            }
+          }
+        >
+          <Link
+            onlyActiveOnIndex={false}
+            style={Object {}}
+            to={
+              Object {
+                "pathname": "/organizations/org-slug/releases/foo.bar.Baz%401.0.0%2B20200101/",
+                "query": undefined,
+              }
+            }
+          >
+            <a
+              onClick={[Function]}
+              style={Object {}}
+            >
+              <VersionText>
+                <span
+                  className="css-16sjfe2-VersionText e19pxt500"
+                >
+                  1.0.0 (20200101)
+                </span>
+              </VersionText>
+            </a>
+          </Link>
+        </Link>
+      </Tooltip>
+    </Version>
+  </withRouter(Version)>
+</WithOrganizationMockWrapper>
+`;
diff --git a/tests/js/spec/components/__snapshots__/versionV2.spec.jsx.snap b/tests/js/spec/components/__snapshots__/versionV2.spec.jsx.snap
deleted file mode 100644
index 45c12a3f8b..0000000000
--- a/tests/js/spec/components/__snapshots__/versionV2.spec.jsx.snap
+++ /dev/null
@@ -1,63 +0,0 @@
-// Jest Snapshot v1, https://goo.gl/fbAQLP
-
-exports[`Version renders 1`] = `
-<Version
-  orgId="sentry"
-  version="foo.bar.Baz@1.0.0+20200101"
->
-  <Tooltip
-    containerDisplayMode="inline-block"
-    disabled={true}
-    isHoverable={true}
-    position="top"
-    title={
-      <ForwardRef(render)
-        onClick={[Function]}
-      >
-        <ForwardRef(render)>
-          foo.bar.Baz@1.0.0+20200101
-        </ForwardRef(render)>
-        <Clipboard
-          errorMessage="Error copying to clipboard"
-          hideMessages={false}
-          successMessage="Copied to clipboard"
-          value="foo.bar.Baz@1.0.0+20200101"
-        >
-          <ForwardRef(render)>
-            <IconCopy
-              color="white"
-              size="xs"
-            />
-          </ForwardRef(render)>
-        </Clipboard>
-      </ForwardRef(render)>
-    }
-  >
-    <Link
-      to={
-        Object {
-          "pathname": "/organizations/sentry/releases/foo.bar.Baz%401.0.0%2B20200101/",
-          "query": undefined,
-        }
-      }
-    >
-      <a
-        href={
-          Object {
-            "pathname": "/organizations/sentry/releases/foo.bar.Baz%401.0.0%2B20200101/",
-            "query": undefined,
-          }
-        }
-      >
-        <VersionText>
-          <span
-            className="css-16sjfe2-VersionText e19pxt500"
-          >
-            1.0.0 (20200101)
-          </span>
-        </VersionText>
-      </a>
-    </Link>
-  </Tooltip>
-</Version>
-`;
diff --git a/tests/js/spec/components/versionV2.spec.jsx b/tests/js/spec/components/version.spec.jsx
similarity index 55%
rename from tests/js/spec/components/versionV2.spec.jsx
rename to tests/js/spec/components/version.spec.jsx
index 54e00ec5f6..e0c6895038 100644
--- a/tests/js/spec/components/versionV2.spec.jsx
+++ b/tests/js/spec/components/version.spec.jsx
@@ -3,32 +3,38 @@ import {mount} from 'sentry-test/enzyme';
 import Version from 'app/components/version';
 
 const VERSION = 'foo.bar.Baz@1.0.0+20200101';
-const ORG_ID = 'sentry';
 
 describe('Version', () => {
+  const routerContext = TestStubs.routerContext();
+
   it('renders', () => {
-    const wrapper = mount(<Version version={VERSION} orgId={ORG_ID} />);
+    const wrapper = mount(<Version version={VERSION} />, routerContext);
     expect(wrapper).toMatchSnapshot();
   });
 
   it('shows correct parsed version', () => {
     // component uses @sentry/release-parser package for parsing versions
-    const wrapper = mount(<Version version={VERSION} orgId={ORG_ID} />);
+    const wrapper = mount(<Version version={VERSION} />, routerContext);
 
     expect(wrapper.text()).toBe('1.0.0 (20200101)');
   });
 
   it('links to release page', () => {
-    const wrapper = mount(<Version version={VERSION} orgId={ORG_ID} projectId="1" />);
-
-    expect(wrapper.find('Link').prop('to')).toEqual({
-      pathname: '/organizations/sentry/releases/foo.bar.Baz%401.0.0%2B20200101/',
+    const wrapper = mount(<Version version={VERSION} projectId="1" />, routerContext);
+
+    expect(
+      wrapper
+        .find('Link')
+        .first()
+        .prop('to')
+    ).toEqual({
+      pathname: '/organizations/org-slug/releases/foo.bar.Baz%401.0.0%2B20200101/',
       query: {project: '1'},
     });
   });
 
   it('shows raw version in tooltip', () => {
-    const wrapper = mount(<Version version={VERSION} orgId={ORG_ID} tooltipRawVersion />);
+    const wrapper = mount(<Version version={VERSION} tooltipRawVersion />, routerContext);
 
     const tooltipContent = mount(wrapper.find('Tooltip').prop('title'));
 
