commit ba0c2978b98ab4d8454df54564a49959047720ce
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Nov 7 12:45:27 2012 -0800

    Always look for usernames first in auth flows

diff --git a/src/sentry/utils/auth.py b/src/sentry/utils/auth.py
index f4fba77b68..8720e81fc6 100644
--- a/src/sentry/utils/auth.py
+++ b/src/sentry/utils/auth.py
@@ -51,14 +51,15 @@ class EmailAuthBackend(ModelBackend):
     def authenticate(self, username=None, password=None):
         try:
             # Assume username is a login and attempt to login.
-            if '@' not in username:
-                user = User.objects.get(username__iexact=username)
-
-            # Treat username as an e-mail address and attempt to login.
-            elif '@' in username:
-                user = User.objects.get(email__iexact=username)
+            user = User.objects.get(username__iexact=username)
         except User.DoesNotExist:
-            return None
+            if '@' in username:
+                try:
+                    user = User.objects.get(email__iexact=username)
+                except user.DoesNotExist:
+                    return None
+            else:
+                return None
 
         if user.check_password(password):
             return user
