commit bf2f984d911bf0946dcc7ff6b4caed8556c266f6
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jul 15 19:26:32 2013 -0700

    Add compatible with_eager_tasks

diff --git a/src/sentry/testutils.py b/src/sentry/testutils.py
index 863180406f..b86c7ed339 100644
--- a/src/sentry/testutils.py
+++ b/src/sentry/testutils.py
@@ -267,3 +267,19 @@ class TransactionTestCase(BaseTestCase, TransactionTestCase):
     def _fixture_teardown(self):
         for db in self._get_databases():
             call_command('flush', verbosity=0, interactive=False, database=db)
+
+
+def with_eager_tasks(func):
+    @wraps(func)
+    def wrapped(*args, **kwargs):
+        from celery.app import app_or_default
+
+        app = app_or_default()
+        prev = app.conf.CELERY_ALWAYS_EAGER
+        app.conf.CELERY_ALWAYS_EAGER = True
+
+        try:
+            return func(*args, **kwargs)
+        finally:
+            app.conf.CELERY_ALWAYS_EAGER = prev
+    return func
