commit fdce89d34d77b37b0008b552f44180e89f2bdc34
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Fri Mar 1 09:30:52 2019 -0800

    fix(api): Org group index permissions should be consistent with project perms
    
    fixes ISSUE-349

diff --git a/src/sentry/api/bases/organization.py b/src/sentry/api/bases/organization.py
index 3d4399d66a..465c429ea6 100644
--- a/src/sentry/api/bases/organization.py
+++ b/src/sentry/api/bases/organization.py
@@ -54,6 +54,14 @@ class OrganizationPermission(SentryPermission):
         return any(request.access.has_scope(s) for s in allowed_scopes)
 
 
+class OrganizationEventPermission(OrganizationPermission):
+    scope_map = {
+        'GET': ['event:read', 'event:write', 'event:admin'],
+        'POST': ['event:write', 'event:admin'],
+        'PUT': ['event:write', 'event:admin'],
+        'DELETE': ['event:admin'],
+    }
+
 # These are based on ProjectReleasePermission
 # additional checks to limit actions to releases
 # associated with projects people have access to
diff --git a/src/sentry/api/endpoints/organization_group_index.py b/src/sentry/api/endpoints/organization_group_index.py
index 8ef45ce632..1e608fc63a 100644
--- a/src/sentry/api/endpoints/organization_group_index.py
+++ b/src/sentry/api/endpoints/organization_group_index.py
@@ -7,7 +7,7 @@ from django.conf import settings
 
 from rest_framework.response import Response
 
-from sentry.api.bases import OrganizationEventsEndpointBase
+from sentry.api.bases import OrganizationEventsEndpointBase, OrganizationEventPermission
 from sentry.api.helpers.group_index import (
     build_query_params_from_request, delete_groups, get_by_short_id, update_groups, ValidationError
 )
@@ -25,6 +25,7 @@ search = SnubaSearchBackend(**settings.SENTRY_SEARCH_OPTIONS)
 
 
 class OrganizationGroupIndexEndpoint(OrganizationEventsEndpointBase):
+    permission_classes = (OrganizationEventPermission, )
 
     def _search(self, request, organization, projects, environments, extra_query_kwargs=None):
         query_kwargs = build_query_params_from_request(
diff --git a/tests/snuba/api/endpoints/test_organization_group_index.py b/tests/snuba/api/endpoints/test_organization_group_index.py
index a3555a78e9..66763b016e 100644
--- a/tests/snuba/api/endpoints/test_organization_group_index.py
+++ b/tests/snuba/api/endpoints/test_organization_group_index.py
@@ -253,7 +253,11 @@ class GroupListTest(APITestCase, SnubaTestCase):
 
         self.login_as(user=user)
 
-        response = self.get_valid_response(organization.slug, project=project.id, query=short_id, shortIdLookup=1)
+        response = self.get_valid_response(
+            organization.slug,
+            project=project.id,
+            query=short_id,
+            shortIdLookup=1)
         assert len(response.data) == 1
 
     def test_lookup_by_short_id_no_perms(self):
@@ -364,7 +368,7 @@ class GroupListTest(APITestCase, SnubaTestCase):
         assert len(response.data) == 0
 
     def test_token_auth(self):
-        token = ApiToken.objects.create(user=self.user, scope_list=['org:read'])
+        token = ApiToken.objects.create(user=self.user, scope_list=['event:read'])
         response = self.client.get(
             reverse('sentry-api-0-organization-group-index', args=[self.project.organization.slug]),
             format='json',
