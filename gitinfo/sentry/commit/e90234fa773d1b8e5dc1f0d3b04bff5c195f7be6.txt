commit e90234fa773d1b8e5dc1f0d3b04bff5c195f7be6
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Oct 8 17:14:32 2014 -0700

    Update lost password hash to expire after 48 hours

diff --git a/src/sentry/models/lostpasswordhash.py b/src/sentry/models/lostpasswordhash.py
index cc6010f08b..aaadafadaa 100644
--- a/src/sentry/models/lostpasswordhash.py
+++ b/src/sentry/models/lostpasswordhash.py
@@ -41,7 +41,7 @@ class LostPasswordHash(Model):
         self.hash = hashlib.md5(str(random.randint(1, 10000000))).hexdigest()
 
     def is_valid(self):
-        return self.date_added > timezone.now() - timedelta(days=1)
+        return self.date_added > timezone.now() - timedelta(hours=48)
 
     def send_recover_mail(self):
         from sentry.utils.email import MessageBuilder
diff --git a/src/sentry/tasks/cleanup.py b/src/sentry/tasks/cleanup.py
index b7271218c8..918c974ee8 100644
--- a/src/sentry/tasks/cleanup.py
+++ b/src/sentry/tasks/cleanup.py
@@ -55,7 +55,7 @@ def cleanup(days=30, project=None, chunk_size=1000, concurrency=1, **kwargs):
 
     log.info("Removing expired values for LostPasswordHash")
     LostPasswordHash.objects.filter(
-        date_added__lte=timezone.now() - datetime.timedelta(days=1)
+        date_added__lte=timezone.now() - datetime.timedelta(hours=48)
     ).delete()
 
     # TODO: we should move this into individual backends
diff --git a/src/sentry/templates/sentry/emails/recover_account.txt b/src/sentry/templates/sentry/emails/recover_account.txt
index dbd47c5ba6..38ffc90f4a 100644
--- a/src/sentry/templates/sentry/emails/recover_account.txt
+++ b/src/sentry/templates/sentry/emails/recover_account.txt
@@ -4,3 +4,5 @@ this, you may simply ignore this email.
 To continue with your password reset, simply follow the link below, and you will be able to change your password.
 
 {{ url|safe }}
+
+This link will expire in 48 hours.
diff --git a/src/sentry/web/frontend/accounts.py b/src/sentry/web/frontend/accounts.py
index 734d2e484e..f4a5b399b8 100644
--- a/src/sentry/web/frontend/accounts.py
+++ b/src/sentry/web/frontend/accounts.py
@@ -135,7 +135,6 @@ def recover(request):
             password_hash.date_added = timezone.now()
             password_hash.set_hash()
 
-    if form.is_valid():
         password_hash.send_recover_mail()
 
         request.session.pop('needs_captcha', None)
