commit 734e64559e6e71dd3a431d61a281ab44f93579f1
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 30 22:36:40 2012 -0800

    Only admins creation of projects owned by arbitrary users

diff --git a/sentry/web/forms.py b/sentry/web/forms.py
index 036b1737e6..5ef14e0b1d 100644
--- a/sentry/web/forms.py
+++ b/sentry/web/forms.py
@@ -82,6 +82,18 @@ class NewProjectForm(forms.ModelForm):
         model = Project
 
 
+class NewProjectAdminForm(forms.ModelForm):
+    owner = forms.ModelChoiceField(queryset=User.objects.all(), widget=forms.TextInput(
+        attrs={
+            'placeholder': 'username',
+        }
+    ))
+
+    class Meta:
+        fields = ('name', 'owner')
+        model = Project
+
+
 class EditProjectForm(forms.ModelForm):
     class Meta:
         fields = ('name', 'status', 'public')
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 37bbf1b4cc..13c5c58e86 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -8,7 +8,8 @@ from sentry.models import MEMBER_USER, MEMBER_OWNER
 from sentry.plugins import plugins
 from sentry.web.decorators import login_required, has_access
 from sentry.web.forms import EditProjectForm, NewProjectForm, \
-  EditProjectMemberForm, NewProjectMemberForm, RemoveProjectForm
+  EditProjectMemberForm, NewProjectMemberForm, RemoveProjectForm, \
+  NewProjectAdminForm
 from sentry.web.helpers import render_to_response, get_project_list, \
   plugin_config
 
@@ -23,13 +24,19 @@ def project_list(request):
 @login_required
 @csrf_protect
 def new_project(request):
-    if not (settings.ALLOW_PROJECT_CREATION or request.user.has_perm('sentry.add_project')):
+    if not (settings.ALLOW_PROJECT_CREATION or request.user.has_perm('sentry.can_add_project')):
         return HttpResponseRedirect(reverse('sentry'))
 
-    form = NewProjectForm(request.POST or None)
+    if request.user.has_perm('sentry.can_admin_project'):
+        form_cls = NewProjectAdminForm
+    else:
+        form_cls = NewProjectForm
+
+    form = form_cls(request.POST or None)
     if form.is_valid():
         project = form.save(commit=False)
-        project.owner = request.user
+        if not project.owner:
+            project.owner = request.user
         project.save()
         return HttpResponseRedirect(reverse('sentry-manage-project', args=[project.pk]))
 
