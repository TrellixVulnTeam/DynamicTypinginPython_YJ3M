commit 9cdefff66c0e0e38c621d426c50919b6b384803c
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Mon Apr 9 12:58:58 2018 -0500

    perf: Increase chunk_size for EventTag BulkDeleteQuery (#7973)

diff --git a/src/sentry/runner/commands/cleanup.py b/src/sentry/runner/commands/cleanup.py
index 220f3e2b10..749d73cce0 100644
--- a/src/sentry/runner/commands/cleanup.py
+++ b/src/sentry/runner/commands/cleanup.py
@@ -249,7 +249,13 @@ def cleanup(days, project, concurrency, max_procs, silent, model, router, timed)
                 click.echo(
                     "NodeStore backend does not support cleanup operation", err=True)
 
-    for model, dtfield, order_by in BULK_QUERY_DELETES:
+    for bqd in BULK_QUERY_DELETES:
+        if len(bqd) == 4:
+            model, dtfield, order_by, chunk_size = bqd
+        else:
+            chunk_size = 10000
+            model, dtfield, order_by = bqd
+
         if not silent:
             click.echo(
                 "Removing {model} for days={days} project={project}".format(
@@ -268,7 +274,7 @@ def cleanup(days, project, concurrency, max_procs, silent, model, router, timed)
                 days=days,
                 project_id=project_id,
                 order_by=order_by,
-            ).execute()
+            ).execute(chunk_size=chunk_size)
 
     for model, dtfield, order_by in DELETES:
         if not silent:
diff --git a/src/sentry/tagstore/legacy/backend.py b/src/sentry/tagstore/legacy/backend.py
index 3773e0fb94..172bfb4493 100644
--- a/src/sentry/tagstore/legacy/backend.py
+++ b/src/sentry/tagstore/legacy/backend.py
@@ -54,7 +54,7 @@ class LegacyTagStorage(TagStorage):
         cleanup.EXTRA_BULK_QUERY_DELETES += [
             (GroupTagValue, 'last_seen', None),
             (TagValue, 'last_seen', None),
-            (EventTag, 'date_added', 'date_added'),
+            (EventTag, 'date_added', 'date_added', 50000),
         ]
 
     def setup_deletions(self):
