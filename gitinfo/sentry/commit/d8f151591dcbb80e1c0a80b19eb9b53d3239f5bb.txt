commit d8f151591dcbb80e1c0a80b19eb9b53d3239f5bb
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Wed Apr 19 13:46:02 2017 +0200

    Added distribution to event processing

diff --git a/src/sentry/coreapi.py b/src/sentry/coreapi.py
index aca59ddac9..98741eb8c8 100644
--- a/src/sentry/coreapi.py
+++ b/src/sentry/coreapi.py
@@ -691,6 +691,18 @@ class ClientApiHelper(object):
                 })
                 del data['release']
 
+        if data.get('distribution'):
+            data['distribution'] = six.text_type(data['distribution'])
+            if not data.get('release'):
+                data['distribution'] = None
+            elif len(data['distribution']) > 64:
+                data['errors'].append({
+                    'type': EventError.VALUE_TOO_LONG,
+                    'name': 'distribution',
+                    'value': data['distribution'],
+                })
+                del data['distribution']
+
         if data.get('environment'):
             data['environment'] = six.text_type(data['environment'])
             if len(data['environment']) > 64:
diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 77e40ede0e..03a52926ff 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -30,7 +30,7 @@ from sentry.constants import (
 from sentry.interfaces.base import get_interface
 from sentry.models import (
     Activity, Environment, Event, EventMapping, EventUser, Group, GroupHash,
-    GroupRelease, GroupResolution, GroupStatus, Project, Release,
+    GroupRelease, GroupResolution, GroupStatus, Project, Release, Distribution,
     ReleaseEnvironment, ReleaseProject, TagKey, UserReport
 )
 from sentry.plugins import plugins
@@ -279,6 +279,7 @@ class EventManager(object):
         data.setdefault('checksum', None)
         data.setdefault('fingerprint', None)
         data.setdefault('platform', None)
+        data.setdefault('distribution', None)
         data.setdefault('environment', None)
         data.setdefault('extra', {})
         data.setdefault('errors', [])
@@ -414,6 +415,7 @@ class EventManager(object):
         fingerprint = data.pop('fingerprint', None)
         platform = data.pop('platform', None)
         release = data.pop('release', None)
+        distribution = data.pop('distribution', None)
         environment = data.pop('environment', None)
 
         # unused
@@ -471,6 +473,15 @@ class EventManager(object):
 
             tags['sentry:release'] = release.version
 
+        if distribution and release:
+            distribution = Distribution.get_or_create(
+                release=release,
+                name=distribution,
+                date_added=date
+            )
+        else:
+            distribution = None
+
         event_user = self._get_event_user(project, data)
         if event_user:
             # dont allow a conflicting 'user' tag
