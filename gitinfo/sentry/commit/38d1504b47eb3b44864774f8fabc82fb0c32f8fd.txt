commit 38d1504b47eb3b44864774f8fabc82fb0c32f8fd
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Apr 6 02:06:20 2012 -0700

    Ensure we return default when the state is empty

diff --git a/sentry/manager.py b/sentry/manager.py
index 809611b99f..6d9fff3803 100644
--- a/sentry/manager.py
+++ b/sentry/manager.py
@@ -246,7 +246,7 @@ class ModuleProxyCache(dict):
 class ChartMixin(object):
     def get_chart_data(self, instance, max_days=90):
         if hasattr(instance, '_state'):
-            db = instance._state.db
+            db = instance._state.db or 'default'
         else:
             db = 'default'
 
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index fdd80a5a2f..6ce7a92172 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -52,7 +52,7 @@ def subtract(value, amount):
 def has_charts(group):
     from sentry.utils.db import has_charts
     if hasattr(group, '_state'):
-        db = group._state.db
+        db = group._state.db or 'default'
     else:
         db = 'default'
     return has_charts(db)
