commit 9d5be1503b6707c72d27d0de2f58f688104032cf
Author: Matthew L Daniel <md@stoi.cc>
Date:   Sat May 14 17:17:54 2016 -0700

    Guard against forwarded-for with port numbers
    
    Updated `SetRemoteAddrFromForwardedFor` to remove any port-number found
    for IPv4 addresses only (since I don't know what an IPv6 forwarded-for
    with a port number would look like)

diff --git a/src/sentry/middleware/proxy.py b/src/sentry/middleware/proxy.py
index 973bb34bb4..c82373510f 100644
--- a/src/sentry/middleware/proxy.py
+++ b/src/sentry/middleware/proxy.py
@@ -1,4 +1,5 @@
 from __future__ import absolute_import
+import re
 
 
 class SetRemoteAddrFromForwardedFor(object):
@@ -11,6 +12,9 @@ class SetRemoteAddrFromForwardedFor(object):
             # HTTP_X_FORWARDED_FOR can be a comma-separated list of IPs.
             # Take just the first one.
             real_ip = real_ip.split(",")[0]
+            if real_ip.count(':') == 1:
+                # if the count > 1 it's ipv6 and count < 1 there's no port
+                real_ip = re.sub(r':\d+$', '', real_ip)
             request.META['REMOTE_ADDR'] = real_ip
 
 
