commit c282d5ab2de7c65902675c71187671f44c59b982
Author: adhiraj <693121+adhiraj@users.noreply.github.com>
Date:   Mon Aug 27 15:34:30 2018 -0700

    feat(identity): Update delete-identity code to consider VSTS (#9512)
    
    Be careful with deleting VSTS identities as they can be used for login now.

diff --git a/src/sentry/integrations/pipeline.py b/src/sentry/integrations/pipeline.py
index 245cc00f7c..3bae9cb358 100644
--- a/src/sentry/integrations/pipeline.py
+++ b/src/sentry/integrations/pipeline.py
@@ -124,7 +124,7 @@ class IntegrationPipeline(Pipeline):
                 # identities and recreate it, except in the case of Github
                 # where we need to be more careful because users may be using
                 # those identities to log in.
-                if idp.type == 'github':
+                if idp.type in ('github', 'vsts'):
                     try:
                         other_identity = Identity.objects.get(
                             idp=idp,
@@ -138,11 +138,12 @@ class IntegrationPipeline(Pipeline):
                         # The external_id is linked to a different user. If that user doesn't
                         # have a password, we don't delete the link as it may lock them out.
                         if not other_identity.user.has_usable_password():
+                            proper_name = 'GitHub' if idp.type == 'github' else 'VSTS'
                             return self._dialog_response({
                                 'error': _(
-                                    'The provided Github account is linked to a different user. '
-                                    'Please try again with a different Github account.'
-                                )},
+                                    'The provided %s account is linked to a different user. '
+                                    'Please try again with a different %s account.'
+                                ) % (proper_name, proper_name)},
                                 False,
                             )
                 identity_model = Identity.reattach(
diff --git a/tests/sentry/integrations/github/test_integration.py b/tests/sentry/integrations/github/test_integration.py
index 6c0d4a380c..c014349a21 100644
--- a/tests/sentry/integrations/github/test_integration.py
+++ b/tests/sentry/integrations/github/test_integration.py
@@ -247,7 +247,7 @@ class GitHubIntegrationTest(IntegrationTestCase):
         Identity.objects.get().update(user=user2)
         resp = self.assert_setup_flow()
         assert '"success":false' in resp.content
-        assert 'The provided Github account is linked to a different user' in resp.content
+        assert 'The provided GitHub account is linked to a different user' in resp.content
 
     @responses.activate
     def test_reinstall_flow(self):
