commit ab31a9a3dc21091863b1601bbb6325a5101d37c2
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Sep 28 11:53:14 2016 -0700

    [breadcrumbs] handle non-strings in data (#4233)

diff --git a/src/sentry/interfaces/breadcrumbs.py b/src/sentry/interfaces/breadcrumbs.py
index 04fb9a41c7..3885924d55 100644
--- a/src/sentry/interfaces/breadcrumbs.py
+++ b/src/sentry/interfaces/breadcrumbs.py
@@ -13,6 +13,7 @@ __all__ = ('Breadcrumbs',)
 import six
 
 from sentry.interfaces.base import Interface, InterfaceValidationError
+from sentry.utils import json
 from sentry.utils.safe import trim
 from sentry.utils.dates import to_timestamp, to_datetime, parse_timestamp
 
@@ -85,6 +86,9 @@ class Breadcrumbs(Interface):
             rv['event_id'] = event_id
 
         if 'data' in crumb:
+            for key, value in six.iteritems(crumb['data']):
+                if not isinstance(value, six.string_types):
+                    crumb['data'][key] = json.dumps(value)
             rv['data'] = trim(crumb['data'], 4096)
 
         return rv
diff --git a/tests/sentry/interfaces/test_breadcrumbs.py b/tests/sentry/interfaces/test_breadcrumbs.py
index c092334f32..bff2c4fa28 100644
--- a/tests/sentry/interfaces/test_breadcrumbs.py
+++ b/tests/sentry/interfaces/test_breadcrumbs.py
@@ -24,3 +24,14 @@ class BreadcrumbsTest(TestCase):
         assert int(ts) == 1458857193
         assert abs(ts - 1458857193.973275) < 0.001
         assert result.values[0]['data'] == {'message': 'Whats up dawg?'}
+
+    def test_non_string_keys(self):
+        result = Breadcrumbs.to_python(dict(values=[{
+            'type': 'message',
+            'timestamp': 1458857193.973275,
+            'data': {
+                'extra': {'foo': 'bar'},
+            },
+        }]))
+        assert len(result.values) == 1
+        assert result.values[0]['data'] == {'extra': '{"foo":"bar"}'}
