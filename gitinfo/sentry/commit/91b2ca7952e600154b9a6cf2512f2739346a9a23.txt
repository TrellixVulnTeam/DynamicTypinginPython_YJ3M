commit 91b2ca7952e600154b9a6cf2512f2739346a9a23
Author: David Wang <davidw1339@gmail.com>
Date:   Wed Nov 20 16:20:45 2019 -0800

    perf(ui): Organization projects endpoint improved (#15727)
    
    The organization/{orgid}/projects endpoint was suspiciously slow in fetching all projects due to the fact that it was continually fetching the same organization instead of caching it (select_related) and also pre-fetched teams twice because the serializer already prefetches teams.

diff --git a/src/sentry/api/endpoints/organization_projects.py b/src/sentry/api/endpoints/organization_projects.py
index 1e33b34d7f..88e47a4c70 100644
--- a/src/sentry/api/endpoints/organization_projects.py
+++ b/src/sentry/api/endpoints/organization_projects.py
@@ -51,19 +51,17 @@ class OrganizationProjectsEndpoint(OrganizationEndpoint, EnvironmentMixin):
             # TODO: remove this, no longer supported probably
             if hasattr(request.auth, "project"):
                 team_list = list(request.auth.project.teams.all())
-                queryset = Project.objects.filter(id=request.auth.project.id).prefetch_related(
-                    "teams"
-                )
+                queryset = Project.objects.filter(id=request.auth.project.id)
             elif request.auth.organization is not None:
                 org = request.auth.organization
                 team_list = list(Team.objects.filter(organization=org))
-                queryset = Project.objects.filter(teams__in=team_list).prefetch_related("teams")
+                queryset = Project.objects.filter(teams__in=team_list)
             else:
                 return Response(
                     {"detail": "Current access does not point to " "organization."}, status=400
                 )
         else:
-            queryset = Project.objects.filter(organization=organization).prefetch_related("teams")
+            queryset = Project.objects.filter(organization=organization)
 
         order_by = ["slug"]
 
@@ -108,7 +106,7 @@ class OrganizationProjectsEndpoint(OrganizationEndpoint, EnvironmentMixin):
         get_all_projects = request.GET.get("all_projects") == "1"
 
         if get_all_projects:
-            queryset = queryset.order_by("slug")
+            queryset = queryset.order_by("slug").select_related("organization")
             return Response(serialize(list(queryset), request.user, ProjectSummarySerializer()))
         else:
             return self.paginate(
