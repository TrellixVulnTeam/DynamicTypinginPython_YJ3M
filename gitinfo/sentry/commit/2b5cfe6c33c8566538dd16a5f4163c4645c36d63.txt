commit 2b5cfe6c33c8566538dd16a5f4163c4645c36d63
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Mar 11 11:38:56 2015 -0700

    Correct remaining foreign key references (fixes GH-1450)

diff --git a/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py b/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
index 9e866c0289..7611b5beea 100644
--- a/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
+++ b/src/sentry/migrations/0157_auto__add_authidentity__add_unique_authidentity_auth_provider_ident__a.py
@@ -407,7 +407,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py b/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
index 2b3169db8c..b0e7115033 100644
--- a/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
+++ b/src/sentry/migrations/0158_auto__add_unique_authidentity_auth_provider_user.py
@@ -377,7 +377,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py b/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
index 968326b76d..2a76ccd39a 100644
--- a/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
+++ b/src/sentry/migrations/0159_auto__add_field_authidentity_last_verified__add_field_organizationmemb.py
@@ -389,7 +389,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py b/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
index c3dc19ffcc..f55b50669d 100644
--- a/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
+++ b/src/sentry/migrations/0160_auto__add_field_authprovider_default_global_access.py
@@ -3,6 +3,7 @@ from south.utils import datetime_utils as datetime
 from south.db import db
 from south.v2 import SchemaMigration
 from django.db import models
+from sentry.db.models import FlexibleForeignKey
 
 
 class Migration(SchemaMigration):
@@ -17,8 +18,8 @@ class Migration(SchemaMigration):
         m2m_table_name = db.shorten_name('sentry_authprovider_default_teams')
         db.create_table(m2m_table_name, (
             ('id', models.AutoField(verbose_name='ID', primary_key=True, auto_created=True)),
-            ('authprovider', models.ForeignKey(orm['sentry.authprovider'], null=False)),
-            ('team', models.ForeignKey(orm['sentry.team'], null=False))
+            ('authprovider', FlexibleForeignKey(orm['sentry.authprovider'], null=False)),
+            ('team', FlexibleForeignKey(orm['sentry.team'], null=False))
         ))
         db.create_unique(m2m_table_name, ['authprovider_id', 'team_id'])
 
@@ -395,7 +396,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py b/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
index 3f7694809c..5ef1f44ac6 100644
--- a/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
+++ b/src/sentry/migrations/0161_auto__chg_field_authprovider_config.py
@@ -381,7 +381,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py b/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
index 2a1e0c5ad6..25088ebf1c 100644
--- a/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
+++ b/src/sentry/migrations/0162_auto__chg_field_authidentity_data.py
@@ -381,7 +381,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py b/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
index 4709fcc08d..a8c76ed7df 100644
--- a/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
+++ b/src/sentry/migrations/0163_auto__add_field_authidentity_last_synced.py
@@ -384,7 +384,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py b/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
index de6e42eb11..e141d5d05e 100644
--- a/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
+++ b/src/sentry/migrations/0164_auto__add_releasefile__add_unique_releasefile_release_ident__add_field.py
@@ -426,7 +426,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py b/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
index 27884a85cc..915a09e553 100644
--- a/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
+++ b/src/sentry/migrations/0165_auto__del_unique_file_name_checksum.py
@@ -392,7 +392,7 @@ class Migration(SchemaMigration):
             'date_joined': ('django.db.models.fields.DateTimeField', [], {'default': 'datetime.datetime.now'}),
             'email': ('django.db.models.fields.EmailField', [], {'max_length': '75', 'blank': 'True'}),
             'first_name': ('django.db.models.fields.CharField', [], {'max_length': '30', 'blank': 'True'}),
-            'id': ('sentry.db.models.fields.bounded.BoundedBigAutoField', [], {'primary_key': 'True'}),
+            'id': ('django.db.models.fields.AutoField', [], {'primary_key': 'True'}),
             'is_active': ('django.db.models.fields.BooleanField', [], {'default': 'True'}),
             'is_managed': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
             'is_staff': ('django.db.models.fields.BooleanField', [], {'default': 'False'}),
diff --git a/src/sentry/models/authidentity.py b/src/sentry/models/authidentity.py
index b3e11dacb4..c6f01a5aeb 100644
--- a/src/sentry/models/authidentity.py
+++ b/src/sentry/models/authidentity.py
@@ -1,6 +1,7 @@
 from __future__ import absolute_import, print_function
 
 from datetime import timedelta
+from django.conf import settings
 from django.db import models
 from django.utils import timezone
 from jsonfield import JSONField
@@ -9,7 +10,7 @@ from sentry.db.models import FlexibleForeignKey, Model
 
 
 class AuthIdentity(Model):
-    user = FlexibleForeignKey('sentry.User')
+    user = FlexibleForeignKey(settings.AUTH_USER_MODEL)
     auth_provider = FlexibleForeignKey('sentry.AuthProvider')
     ident = models.CharField(max_length=128)
     data = JSONField()
diff --git a/src/sentry/models/authprovider.py b/src/sentry/models/authprovider.py
index 1419d485db..c72f067dfa 100644
--- a/src/sentry/models/authprovider.py
+++ b/src/sentry/models/authprovider.py
@@ -28,6 +28,9 @@ class AuthProvider(Model):
         default=_organizationemmber_type_field.default
     )
     default_global_access = models.BooleanField(default=True)
+    # TODO(dcramer): ManyToMany has the same issue as ForeignKey and we need
+    # to either write our own which works w/ BigAuto or switch this to use
+    # through.
     default_teams = models.ManyToManyField('sentry.Team', blank=True)
 
     class Meta:
diff --git a/src/sentry/models/user.py b/src/sentry/models/user.py
index a32acef630..7f17aa477a 100644
--- a/src/sentry/models/user.py
+++ b/src/sentry/models/user.py
@@ -14,14 +14,15 @@ from django.db import models
 from django.utils import timezone
 from django.utils.translation import ugettext_lazy as _
 
-from sentry.db.models import BaseManager, Model
+from sentry.db.models import BaseManager, BaseModel, BoundedAutoField
 
 
 class UserManager(BaseManager, UserManager):
     pass
 
 
-class User(Model, AbstractBaseUser):
+class User(BaseModel, AbstractBaseUser):
+    id = BoundedAutoField(primary_key=True)
     username = models.CharField(_('username'), max_length=128, unique=True)
     first_name = models.CharField(_('first name'), max_length=30, blank=True)
     last_name = models.CharField(_('last name'), max_length=30, blank=True)
