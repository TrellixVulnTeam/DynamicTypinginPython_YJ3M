commit 9e18907ae23652fc78ad52987f8787cae77e1d62
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Mar 1 02:30:26 2012 -0800

    Add project list to user edit page

diff --git a/sentry/templates/sentry/admin/users/edit.html b/sentry/templates/sentry/admin/users/edit.html
index a5993367d3..f4676a4453 100644
--- a/sentry/templates/sentry/admin/users/edit.html
+++ b/sentry/templates/sentry/admin/users/edit.html
@@ -1,6 +1,7 @@
 {% extends "sentry/admin/users/list.html" %}
 
 {% load i18n %}
+{% load sentry_admin_helpers %}
 {% load sentry_helpers %}
 
 {% block title %}{% trans "Change User" %} | {{ block.super }}{% endblock %}
@@ -37,5 +38,35 @@
                 {% endif %}
             </fieldset>
         </form>
+        {% if project_list %}
+            <h3>Projects</h3>
+            <br/>
+            <table class="table table-bordered">
+                <colgroup>
+                    <col>
+                    <col style="width:150px;">
+                    <col style="width:150px;">
+                </colgroup>
+                <thead>
+                    <tr>
+                        <th>{% trans "Project" %}</th>
+                        <th style="text-align:center;">{% trans "Daily Events" %}</th>
+                    </tr>
+                </thead>
+                <tbody>
+                    {% for project in project_list %}
+                        <tr>
+                            <td>
+                                {{ project.name }} <a href="{% url sentry project.pk %}">[view]</a>
+                                </a>
+                            </td>
+                            <td style="text-align:center; vertical-align:middle;">
+                                <em>~{{ project|avg_events_per_day }}</em>
+                            </td>
+                        </tr>
+                    {% endfor %}
+                </tbody>
+            </table>
+        {% endif %}
     </section>
 {% endblock %}
diff --git a/sentry/web/frontend/admin.py b/sentry/web/frontend/admin.py
index 72df0ad402..0998bb25ce 100644
--- a/sentry/web/frontend/admin.py
+++ b/sentry/web/frontend/admin.py
@@ -159,9 +159,20 @@ def edit_user(request, user_id):
         user = form.save()
         return HttpResponseRedirect(reverse('sentry-admin-users'))
 
+    project_list = Project.objects.filter(
+        status=0,
+        member_set__user=user,
+    ).exclude(
+        projectcountbyminute__date__lte=datetime.datetime.now() - datetime.timedelta(days=30),
+    ).annotate(
+        avg_events_per_n=Sum('projectcountbyminute__times_seen'),
+        n_value=Count('projectcountbyminute__times_seen')
+    ).order_by('-date_added')
+
     context = {
         'form': form,
         'the_user': user,
+        'project_list': project_list,
     }
     context.update(csrf(request))
 
