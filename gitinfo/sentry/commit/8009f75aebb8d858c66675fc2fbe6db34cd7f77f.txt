commit 8009f75aebb8d858c66675fc2fbe6db34cd7f77f
Author: Danny Lee <dlee@sentry.io>
Date:   Fri Oct 4 10:13:27 2019 -0700

    ref(app-platform): Upgrade echarts to latest version (#14596)
    
    * ref(app-platform): Upgrade echarts to latest version
    
    - Attempted to identify root cause of SEN-942
    - Small code-style improvements on related graphing components
    
    Refs SEN-942

diff --git a/package.json b/package.json
index 126a086e0a..5bcddf2044 100644
--- a/package.json
+++ b/package.json
@@ -23,7 +23,7 @@
     "@types/classnames": "^2.2.0",
     "@types/clipboard": "^2.0.1",
     "@types/create-react-class": "^15.6.2",
-    "@types/echarts": "^4.1.10",
+    "@types/echarts": "^4.1.11",
     "@types/jest": "^24.0.17",
     "@types/jquery": "^2.0.53",
     "@types/js-cookie": "^2.2.2",
@@ -56,8 +56,8 @@
     "crypto-js": "3.1.5",
     "css-loader": "^2.0.1",
     "diff": "^3.5.0",
-    "echarts": "^4.1.0",
-    "echarts-for-react": "^2.0.13",
+    "echarts": "4.2.1",
+    "echarts-for-react": "2.0.14",
     "emotion": "9.2.12",
     "emotion-theming": "9.2.9",
     "file-loader": "^3.0.1",
diff --git a/src/sentry/static/sentry/app/views/events/utils/eventsRequest.tsx b/src/sentry/static/sentry/app/views/events/utils/eventsRequest.tsx
index 86d7e715c4..00ef371942 100644
--- a/src/sentry/static/sentry/app/views/events/utils/eventsRequest.tsx
+++ b/src/sentry/static/sentry/app/views/events/utils/eventsRequest.tsx
@@ -132,8 +132,8 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
     includeTransformedData: PropTypes.bool,
 
     /**
-     * Include a dataset transform that will aggregate count values for each timestamp.
-     * Be sure to supply a name to `timeAggregationSeriesName`
+     * Include a dataset transform that will aggregate count values for each
+     * timestamp. Be sure to supply a name to `timeAggregationSeriesName`
      */
     includeTimeAggregation: PropTypes.bool,
 
@@ -181,12 +181,14 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
   componentDidMount() {
     this.fetchData();
   }
+
   componentDidUpdate(prevProps: EventsRequestProps) {
     if (isEqual(omitIgnoredProps(prevProps), omitIgnoredProps(this.props))) {
       return;
     }
     this.fetchData();
   }
+
   componentWillUnmount() {
     this.unmounting = true;
   }
@@ -195,10 +197,12 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
 
   fetchData = async () => {
     const {api, ...props} = this.props;
-    let timeseriesData: EventsStats | null;
+    let timeseriesData: EventsStats | null = null;
+
     this.setState(state => ({
       reloading: state.timeseriesData !== null,
     }));
+
     try {
       timeseriesData = await doEventsRequest(api, props);
     } catch (resp) {
@@ -207,19 +211,22 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
       } else {
         addErrorMessage(t('Error loading chart data'));
       }
-      timeseriesData = null;
     }
+
     if (this.unmounting) {
       return;
     }
+
     this.setState({
       reloading: false,
       timeseriesData,
     });
   };
+
   /**
-   * Retrieves data set for the current period (since data can potentially contain previous period's data), as
-   * well as the previous period if possible.
+   * Retrieves data set for the current period (since data can potentially
+   * contain previous period's data), as well as the previous period if
+   * possible.
    *
    * Returns `null` if data does not exist
    */
@@ -238,26 +245,28 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
   };
 
   // This aggregates all values per `timestamp`
-  calculateTotalsPerTimestamp = (
+  calculateTotalsPerTimestamp(
     data: EventsStatsData,
     getName: (
       timestamp: number,
       countArray: {count: number}[],
       i: number
     ) => number = timestamp => timestamp * 1000
-  ): SeriesDataUnit[] =>
-    data.map(([timestamp, countArray], i) => ({
+  ): SeriesDataUnit[] {
+    return data.map(([timestamp, countArray], i) => ({
       name: getName(timestamp, countArray, i),
       value: countArray.reduce((acc, {count}) => acc + count, 0),
     }));
+  }
 
   /**
-   * Get previous period data, but transform timestampts so that data fits unto the current period's data axis
+   * Get previous period data, but transform timestamps so that data fits unto
+   * the current period's data axis
    */
-  transformPreviousPeriodData = (
+  transformPreviousPeriodData(
     current: EventsStatsData,
     previous: EventsStatsData | null
-  ): Series | null => {
+  ): Series | null {
     // Need the current period data array so we can take the timestamp
     // so we can be sure the data lines up
     if (!previous) {
@@ -271,23 +280,22 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
         (_timestamp, _countArray, i) => current[i][0] * 1000
       ),
     };
-  };
+  }
+
   /**
    * Aggregate all counts for each time stamp
    */
-  transformAggregatedTimeseries = (
-    data: EventsStatsData,
-    seriesName: string = ''
-  ): Series => {
+  transformAggregatedTimeseries(data: EventsStatsData, seriesName: string = ''): Series {
     return {
       seriesName,
       data: this.calculateTotalsPerTimestamp(data),
     };
-  };
+  }
+
   /**
    * Transforms query response into timeseries data to be used in a chart
    */
-  transformTimeseriesData = (data: EventsStatsData): [Series] => {
+  transformTimeseriesData(data: EventsStatsData): [Series] {
     return [
       {
         seriesName: 'Current Period',
@@ -297,7 +305,7 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
         })),
       },
     ];
-  };
+  }
 
   processData(response: EventsStats | null) {
     if (!response) {
@@ -330,6 +338,7 @@ class EventsRequest extends React.PureComponent<EventsRequestProps, EventsReques
       timeAggregatedData,
     };
   }
+
   render() {
     const {children, showLoading, ...props} = this.props;
     const {timeseriesData, reloading} = this.state;
diff --git a/yarn.lock b/yarn.lock
index d6483df332..69084b1cb5 100644
--- a/yarn.lock
+++ b/yarn.lock
@@ -2068,10 +2068,10 @@
   dependencies:
     "@types/react" "*"
 
-"@types/echarts@^4.1.10":
-  version "4.1.10"
-  resolved "https://registry.yarnpkg.com/@types/echarts/-/echarts-4.1.10.tgz#ee71911eb8b1717c7c12c0bd81fc83db872f4d3b"
-  integrity sha512-AadUmn1mHp0RGNFwcDnNdVbz5LNZZla7V9B+3ptyEp31qiyRK0Hfr2yQLD26/4ojcLDSmUzyGfVrHrEXxgUmuA==
+"@types/echarts@^4.1.11":
+  version "4.1.11"
+  resolved "https://registry.yarnpkg.com/@types/echarts/-/echarts-4.1.11.tgz#32e9ad4e390f28e44cb29121de07aa0e357e04c0"
+  integrity sha512-V5HBs2OeKSK/uWFdArDntYPvsvJjP4qQQ8nfCpCIfbzci2wzqW00v0FbLzBiLen0wnTWO5x/NDzFgUALEma0fA==
   dependencies:
     "@types/zrender" "*"
 
@@ -5459,20 +5459,20 @@ ecc-jsbn@~0.1.1:
   dependencies:
     jsbn "~0.1.0"
 
-echarts-for-react@^2.0.13:
-  version "2.0.13"
-  resolved "https://registry.yarnpkg.com/echarts-for-react/-/echarts-for-react-2.0.13.tgz#fd1bff5bcf6ebf2709b0fd28355f42b762dc89a4"
-  integrity sha512-AKUw8aellifMBb301JMqiBmI80oP1/8mOplXm7SNtOQqkqTW+3F5dt9nUTN3ir4Itskya8d7tw5djdbDSCRWkQ==
+echarts-for-react@2.0.14:
+  version "2.0.14"
+  resolved "https://registry.yarnpkg.com/echarts-for-react/-/echarts-for-react-2.0.14.tgz#6df7a31eea43ef35321e20a5854109cbc52c9df3"
+  integrity sha512-W56Cr3KP5KatVlGPKNZmmZT1IsozehT03sin7ABhzsV98jJ3rDfgKedIvrn/mlp22u/Wneddd0P7rqxLq2lO8g==
   dependencies:
     fast-deep-equal "^2.0.1"
-    size-sensor "^0.0.4"
+    size-sensor "^0.2.0"
 
-echarts@^4.1.0:
-  version "4.1.0"
-  resolved "https://registry.yarnpkg.com/echarts/-/echarts-4.1.0.tgz#d588c95f73c1a9928b9c73d5b769751c3185bcdc"
-  integrity sha512-gP1e1fNnAj9KJpTDLXV21brklbfJlqeINmpQDJCDta9TX3cPoqyQOiDVcEPzbOVHqgBRgTOwNxC5iGwJ89014A==
+echarts@4.2.1:
+  version "4.2.1"
+  resolved "https://registry.yarnpkg.com/echarts/-/echarts-4.2.1.tgz#9a8ea3b03354f86f824d97625c334cf16965ef03"
+  integrity sha512-pw4xScRPsLegD/cqEcoXRKeA2SD4+s+Kyo0Na166NamOWhzNl2yI5RZ2rE97tBlAopNmhyMeBVpAeD5qb+ee1A==
   dependencies:
-    zrender "4.0.4"
+    zrender "4.0.7"
 
 ee-first@1.1.1:
   version "1.1.1"
@@ -13196,10 +13196,10 @@ sisteransi@^1.0.0:
   resolved "https://registry.yarnpkg.com/sisteransi/-/sisteransi-1.0.0.tgz#77d9622ff909080f1c19e5f4a1df0c1b0a27b88c"
   integrity sha512-N+z4pHB4AmUv0SjveWRd6q1Nj5w62m5jodv+GD8lvmbY/83T/rpbJGZOnK5T149OldDj4Db07BSv9xY4K6NTPQ==
 
-size-sensor@^0.0.4:
-  version "0.0.4"
-  resolved "https://registry.yarnpkg.com/size-sensor/-/size-sensor-0.0.4.tgz#e72a2b5346fa6009ce8703a72859fafbd75a5b7b"
-  integrity sha512-aAHl9NV8DE/OWzZKqG59A9/ZGqjnXI6bVSDfhI8DrdpquLctnua4R9IlLVLp59C41DyfehRuT1F1eKuLCNU9eQ==
+size-sensor@^0.2.0:
+  version "0.2.5"
+  resolved "https://registry.yarnpkg.com/size-sensor/-/size-sensor-0.2.5.tgz#e8ffb7cc5258893472bfda4f5734d66583247757"
+  integrity sha512-Rip8d6LmCHIBUY5iIS3nKln1X4bF8260oFI4suo6MX+vOV/aNpNWYKTyjamSJMbxP17qMlR0DmGXFEio3BYJUg==
 
 slash@^1.0.0:
   version "1.0.0"
@@ -15301,10 +15301,10 @@ yargs@12.0.5, yargs@^12.0.2:
     y18n "^3.2.1 || ^4.0.0"
     yargs-parser "^11.1.1"
 
-zrender@4.0.4:
-  version "4.0.4"
-  resolved "https://registry.yarnpkg.com/zrender/-/zrender-4.0.4.tgz#910e60d888f00c9599073f23758dd23345fe48fd"
-  integrity sha512-03Vd/BDl/cPXp8E61f5+Xbgr/a4vDyFA+uUtUc1s+5KgcPbyY2m+78R/9LQwkR6QwFYHG8qk25Q8ESGs/qpkZw==
+zrender@4.0.7:
+  version "4.0.7"
+  resolved "https://registry.yarnpkg.com/zrender/-/zrender-4.0.7.tgz#15ae960822f5efed410995d37e5107fe3de10e6d"
+  integrity sha512-TNloHe0ums6zxbHfnaCryM61J4IWDajZwNq6dHk9vfWhhysO/OeFvvR0drBs/nbXha2YxSzfQj2FiCd6RVBe+Q==
 
 zxcvbn@^4.4.2:
   version "4.4.2"
