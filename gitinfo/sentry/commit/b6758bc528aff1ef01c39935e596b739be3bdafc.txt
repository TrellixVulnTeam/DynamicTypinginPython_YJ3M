commit b6758bc528aff1ef01c39935e596b739be3bdafc
Author: Alexandru Mihai <alexandru.mihai@avira.com>
Date:   Sat Oct 24 01:10:52 2015 +0300

    Fixed #2206 - Show error message if team slug already exists

diff --git a/src/sentry/web/frontend/team_settings.py b/src/sentry/web/frontend/team_settings.py
index 988c96bc5f..45a98d32d1 100644
--- a/src/sentry/web/frontend/team_settings.py
+++ b/src/sentry/web/frontend/team_settings.py
@@ -1,8 +1,11 @@
 from __future__ import absolute_import
 
+import logging
+
 from django import forms
 from django.contrib import messages
 from django.core.urlresolvers import reverse
+from django.db import IntegrityError
 from django.http import HttpResponseRedirect
 from django.utils.translation import ugettext_lazy as _
 
@@ -23,21 +26,27 @@ class TeamSettingsView(TeamView):
         return EditTeamForm(request.POST or None, instance=team)
 
     def handle(self, request, organization, team):
+        old_slug = team.slug
         form = self.get_form(request, team)
         if form.is_valid():
-            team = form.save()
-
-            AuditLogEntry.objects.create(
-                organization=organization,
-                actor=request.user,
-                ip_address=request.META['REMOTE_ADDR'],
-                target_object=team.id,
-                event=AuditLogEntryEvent.TEAM_EDIT,
-                data=team.get_audit_log_data(),
-            )
-
-            messages.add_message(request, messages.SUCCESS,
-                _('Changes to your team were saved.'))
+            try:
+                team = form.save()
+            except IntegrityError:
+                team.slug = old_slug
+                messages.add_message(request, messages.ERROR,
+                    _('Changes to your team failed. Slug already exists.'))
+            else:
+                AuditLogEntry.objects.create(
+                    organization=organization,
+                    actor=request.user,
+                    ip_address=request.META['REMOTE_ADDR'],
+                    target_object=team.id,
+                    event=AuditLogEntryEvent.TEAM_EDIT,
+                    data=team.get_audit_log_data(),
+                )
+
+                messages.add_message(request, messages.SUCCESS,
+                    _('Changes to your team were saved.'))
 
             return HttpResponseRedirect(reverse('sentry-manage-team', args=[organization.slug, team.slug]))
 
