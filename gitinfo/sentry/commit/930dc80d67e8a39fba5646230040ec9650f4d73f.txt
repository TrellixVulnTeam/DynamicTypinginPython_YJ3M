commit 930dc80d67e8a39fba5646230040ec9650f4d73f
Author: David Cramer <dcramer@gmail.com>
Date:   Thu May 14 10:32:57 2015 -0700

    Correct project list to filter duplicates and inactive teams

diff --git a/src/sentry/web/frontend/help_platform_base.py b/src/sentry/web/frontend/help_platform_base.py
index 23e0ee185f..db8b913408 100644
--- a/src/sentry/web/frontend/help_platform_base.py
+++ b/src/sentry/web/frontend/help_platform_base.py
@@ -14,7 +14,9 @@ class HelpPlatformBaseView(BaseView):
         return list(Project.objects.filter(
             Q(organization__member_set__has_global_access=True, organization__member_set__user=user)
             | Q(team__organizationmember__user=user)
-        ).select_related('team', 'organization').order_by('organization', 'team'))
+        ).exclude(
+            team__organizationmemberteam__is_active=False,
+        ).select_related('team', 'organization').order_by('organization', 'team').distinct())
 
     def group_project_list(self, project_list):
         results = []
diff --git a/tests/sentry/web/frontend/test_help_platform_index.py b/tests/sentry/web/frontend/test_help_platform_index.py
index d2ab7fff68..fbcb84004b 100644
--- a/tests/sentry/web/frontend/test_help_platform_index.py
+++ b/tests/sentry/web/frontend/test_help_platform_index.py
@@ -1,5 +1,8 @@
+from __future__ import absolute_import
+
 from django.core.urlresolvers import reverse
 
+from sentry.models import OrganizationMember, OrganizationMemberTeam
 from sentry.testutils import TestCase
 
 
@@ -9,3 +12,36 @@ class HelpPlatformIndexTest(TestCase):
 
         resp = self.client.get(path)
         assert resp.status_code == 200
+
+    def test_logged_in(self):
+        org = self.create_organization(owner=self.user)
+        team1 = self.create_team(name='foo', organization=org)
+        project1 = self.create_project(name='foo', team=team1)
+        project2 = self.create_project(name='bar', team=team1)
+        team2 = self.create_team(name='bar', organization=org)
+        project3 = self.create_project(name='baz', team=team2)
+
+        member = OrganizationMember.objects.get(
+            organization=org,
+            user=self.user,
+        )
+        OrganizationMemberTeam.objects.create(
+            organizationmember=member,
+            team=team2,
+            is_active=False,
+        )
+
+        path = reverse('sentry-help-platform-list')
+
+        self.login_as(self.user)
+        resp = self.client.get(path)
+        assert resp.status_code == 200
+        assert len(resp.context['org_results']) == 1
+        org_results = resp.context['org_results'][0]
+        assert org_results[0] == org
+        assert len(org_results[1]) == 1
+        team_results = org_results[1][0]
+        assert team_results[0] == team1
+        assert len(team_results[1]) == 2
+        assert project1 in team_results[1]
+        assert project2 in team_results[1]
