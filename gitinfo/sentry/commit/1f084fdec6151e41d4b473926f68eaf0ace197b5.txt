commit 1f084fdec6151e41d4b473926f68eaf0ace197b5
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Feb 25 21:12:18 2015 -0800

    Ensure member who configures SSO is linked

diff --git a/src/sentry/auth/helper.py b/src/sentry/auth/helper.py
index 165cc42f00..33cb1f7791 100644
--- a/src/sentry/auth/helper.py
+++ b/src/sentry/auth/helper.py
@@ -221,6 +221,14 @@ class AuthHelper(object):
         state = request.session['auth']['state']
         config = self.provider.build_config(state)
 
+        try:
+            om = OrganizationMember.objects.get(
+                user=request.user,
+                organization=self.organization,
+            )
+        except OrganizationMember.DoesNotExist:
+            return self.error(ERR_UID_MISMATCH)
+
         self.auth_provider = AuthProvider.objects.create(
             organization=self.organization,
             provider=self.provider.key,
@@ -237,6 +245,9 @@ class AuthHelper(object):
             },
         )
 
+        setattr(om.flags, 'sso:linked', True)
+        om.save()
+
         AuditLogEntry.objects.create(
             organization=self.organization,
             actor=request.user,
