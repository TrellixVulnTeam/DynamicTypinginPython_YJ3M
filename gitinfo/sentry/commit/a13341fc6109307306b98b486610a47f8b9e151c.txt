commit a13341fc6109307306b98b486610a47f8b9e151c
Author: David Cramer <dcramer@gmail.com>
Date:   Tue May 23 16:56:06 2017 -0700

    [security] improve xss prevention with marked

diff --git a/src/sentry/static/sentry/app/utils/marked.jsx b/src/sentry/static/sentry/app/utils/marked.jsx
index eabf242941..edc2016357 100644
--- a/src/sentry/static/sentry/app/utils/marked.jsx
+++ b/src/sentry/static/sentry/app/utils/marked.jsx
@@ -19,7 +19,7 @@ function Renderer() {
 Object.assign(Renderer.prototype, marked.Renderer.prototype);
 
 // Anythign except javascript, vbscript, data protocols
-const safeLinkPattern = /^(?!javascript|vbscript|data:)/i;
+const safeLinkPattern = /^(https?:|mailto:)/i;
 
 Renderer.prototype.link = function(href, title, text) {
   // For a bad link, just return the plain text href
diff --git a/tests/js/spec/utils/marked.spec.jsx b/tests/js/spec/utils/marked.spec.jsx
index 41438d2bd6..9c1ed0c3c4 100644
--- a/tests/js/spec/utils/marked.spec.jsx
+++ b/tests/js/spec/utils/marked.spec.jsx
@@ -20,6 +20,7 @@ describe('marked', function() {
   it('rejected links should be rendered as plain text', function() {
     for (let test of [
       ['[x](javascript:foo)', 'javascript:foo'],
+      ['[x](java\nscript:foo)', 'java\nscript:foo'],
       ['[x](data:foo)', 'data:foo'],
       ['[x](vbscript:foo)', 'vbscript:foo']
     ]) {
