commit 0e83ae7c0841e9abe5169328a48344545762b277
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Mar 1 16:58:55 2017 -0800

    runner: abstract out uwsgi filemon stuff to be more reusable

diff --git a/src/sentry/runner/settings.py b/src/sentry/runner/settings.py
index 0560424479..abb66b0646 100644
--- a/src/sentry/runner/settings.py
+++ b/src/sentry/runner/settings.py
@@ -132,15 +132,9 @@ def configure(ctx, py, yaml, skip_backend_validation=False):
         raise ValueError("Configuration file does not exist at '%s'" % click.format_filename(yaml))
 
     # Add autoreload for config.yml file if needed
-    if 'UWSGI_PY_AUTORELOAD' in os.environ:
-        if yaml is not None and os.path.exists(yaml):
-            try:
-                import uwsgi
-                from uwsgidecorators import filemon
-            except ImportError:
-                pass
-            else:
-                filemon(yaml)(uwsgi.reload)
+    if yaml is not None and os.path.exists(yaml):
+        from sentry.utils.uwsgi import reload_on_change
+        reload_on_change(yaml)
 
     os.environ['DJANGO_SETTINGS_MODULE'] = 'sentry_config'
 
diff --git a/src/sentry/utils/uwsgi.py b/src/sentry/utils/uwsgi.py
new file mode 100644
index 0000000000..d5d7f6896d
--- /dev/null
+++ b/src/sentry/utils/uwsgi.py
@@ -0,0 +1,20 @@
+from __future__ import absolute_import
+
+import os
+
+
+def reload_on_change(path):
+    """
+    Set up uwsgi file monitoring hooks for reloading on change
+    """
+    # no-op if we're not configured to do any autoreloading
+    if 'UWSGI_PY_AUTORELOAD' not in os.environ:
+        return
+    try:
+        import uwsgi
+        from uwsgidecorators import filemon as filemon_
+    except ImportError:
+        # We may not be running within a uwsgi context, so just ignore.
+        return
+    # Register hook with uwsgi's filemon to reload ourself on change
+    filemon_(path)(uwsgi.reload)
