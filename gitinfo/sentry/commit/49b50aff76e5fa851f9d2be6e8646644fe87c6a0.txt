commit 49b50aff76e5fa851f9d2be6e8646644fe87c6a0
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Dec 11 21:39:51 2014 -0800

    Add basic audit log

diff --git a/src/sentry/models/auditlogentry.py b/src/sentry/models/auditlogentry.py
index d995e3c2b2..b8f4d0a11b 100644
--- a/src/sentry/models/auditlogentry.py
+++ b/src/sentry/models/auditlogentry.py
@@ -9,7 +9,6 @@ from __future__ import absolute_import, print_function
 
 from django.db import models
 from django.utils import timezone
-from django.utils.translation import ugettext_lazy as _
 
 from sentry.db.models import (
     Model, BoundedPositiveIntegerField, GzippedDictField,
@@ -47,3 +46,15 @@ class AuditLogEntry(Model):
         db_table = 'sentry_auditlogentry'
 
     __repr__ = sane_repr('organization_id', 'type')
+
+    def get_note(self):
+        if self.event == AuditLogEntryEvent.MEMBER_INVITE:
+            return 'invited %s' % (self.data['email'],)
+        elif self.event == AuditLogEntryEvent.MEMBER_ADD:
+            return 'added %s' % (self.target_user.get_display_name(),)
+        elif self.event == AuditLogEntryEvent.MEMBER_ACCEPT:
+            return 'accepted the membership invite'
+        elif self.event == AuditLogEntryEvent.MEMBER_REMOVE:
+            return 'removed %s' % (self.data.get('email') or self.target_user.get_display_name(),)
+        elif self.event == AuditLogEntryEvent.MEMBER_EDIT:
+            return 'edited %s' % (self.data.get('email') or self.target_user.get_display_name(),)
diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 7b648feeb6..5a0b53dbf1 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -1839,6 +1839,10 @@ img.avatar {
   border-radius: 3px;
   max-width: none;
 }
+img.avatar32 {
+  width: 32px;
+  height: 32px;
+}
 
 
 .nav-pills > li.active > a {
diff --git a/src/sentry/static/sentry/styles/global.min.css b/src/sentry/static/sentry/styles/global.min.css
index 815e09e7db..97070d6ec1 100644
--- a/src/sentry/static/sentry/styles/global.min.css
+++ b/src/sentry/static/sentry/styles/global.min.css
@@ -8303,6 +8303,10 @@ img.avatar {
   border-radius: 3px;
   max-width: none;
 }
+img.avatar32 {
+  width: 32px;
+  height: 32px;
+}
 .nav-pills > li.active > a {
   background-color: #70ace6;
 }
diff --git a/src/sentry/static/sentry/styles/sentry.css b/src/sentry/static/sentry/styles/sentry.css
index 815e09e7db..97070d6ec1 100644
--- a/src/sentry/static/sentry/styles/sentry.css
+++ b/src/sentry/static/sentry/styles/sentry.css
@@ -8303,6 +8303,10 @@ img.avatar {
   border-radius: 3px;
   max-width: none;
 }
+img.avatar32 {
+  width: 32px;
+  height: 32px;
+}
 .nav-pills > li.active > a {
   background-color: #70ace6;
 }
diff --git a/src/sentry/templates/sentry/bases/organization.html b/src/sentry/templates/sentry/bases/organization.html
index ada9d8f7ed..8b0665db0f 100644
--- a/src/sentry/templates/sentry/bases/organization.html
+++ b/src/sentry/templates/sentry/bases/organization.html
@@ -42,6 +42,11 @@
         {% trans "Usage" %}
       </a>
     </li>
+    <li class="{% block org_auditlog_nav %}{% endblock %}">
+      <a href="{% url 'sentry-organization-audit-log' organization.slug %}">
+        {% trans "Audit Log" %}
+      </a>
+    </li>
     <li class="{% block org_settings_nav %}{% endblock %}">
       <a href="{% url 'sentry-organization-settings' organization.slug %}">
         {% trans "Settings" %}
diff --git a/src/sentry/templates/sentry/organization-audit-log.html b/src/sentry/templates/sentry/organization-audit-log.html
new file mode 100644
index 0000000000..f6593c19c8
--- /dev/null
+++ b/src/sentry/templates/sentry/organization-audit-log.html
@@ -0,0 +1,56 @@
+{% extends "sentry/bases/organization.html" %}
+
+{% load i18n %}
+{% load sentry_helpers %}
+
+{% block title %}{% trans "Audit Log" %} | {{ block.super }}{% endblock %}
+
+{% block org_auditlog_nav %}active{% endblock %}
+
+{% block inner %}
+  <div class="page-header">
+    <h2>Audit Log</h2>
+  </div>
+
+  {% paginate audit_log_queryset from request as entry_list per_page 50 %}
+
+  {% if entry_list.objects %}
+    <p>{% blocktrans %}Sentry keeps track of important events within your Organization.{% endblocktrans %}</p>
+
+    <br>
+
+    <table class="table table-striped">
+      <colgroup>
+        <col width="32px"/>
+        <col/>
+        <col width="150px"/>
+        <col width="100px"/>
+        <col width="200px"/>
+      </colgroup>
+      <tbody>
+        {% for entry in entry_list.objects %}
+          <tr>
+            <td>
+              <img class="avatar avatar32" src="{% gravatar_url entry.actor.email size 32 %}">
+            </td>
+            <td>
+              <strong>{{ entry.actor.get_display_name }}</strong><br>
+              {{ entry.get_note }}
+            </td>
+            <td>{{ entry.get_event_display }}</td>
+            <td>{{ entry.ip_address }}</td>
+            <td style="text-align:right">
+              <span class="pretty-date" title="{{ entry.datetime|date:"c" }}Z">{{ entry.datetime|timesince }}</span>
+            </td>
+          </tr>
+        {% endfor %}
+      </tbody>
+    </table>
+
+    {{ event_list.paging }}
+  {% else %}
+    <div class="alert alert-block alert-info">
+      <p>It looks like nothing has really happened within your organization. Check back later!</p>
+    </div>
+  {% endif %}
+{% endblock %}
diff --git a/src/sentry/web/frontend/organization_audit_log.py b/src/sentry/web/frontend/organization_audit_log.py
new file mode 100644
index 0000000000..9007f020b5
--- /dev/null
+++ b/src/sentry/web/frontend/organization_audit_log.py
@@ -0,0 +1,21 @@
+from __future__ import absolute_import
+
+from sentry.models import (
+    AuditLogEntry, OrganizationMemberType
+)
+from sentry.web.frontend.base import OrganizationView
+
+
+class OrganizationAuditLogView(OrganizationView):
+    required_access = OrganizationMemberType.ADMIN
+
+    def get(self, request, organization):
+        queryset = AuditLogEntry.objects.filter(
+            organization=organization,
+        ).select_related('actor', 'target_user').order_by('-datetime')
+
+        context = {
+            'audit_log_queryset': queryset,
+        }
+
+        return self.respond('sentry/organization-audit-log.html', context)
diff --git a/src/sentry/web/frontend/organization_members.py b/src/sentry/web/frontend/organization_members.py
index a2710b478b..14b9995f57 100644
--- a/src/sentry/web/frontend/organization_members.py
+++ b/src/sentry/web/frontend/organization_members.py
@@ -24,7 +24,7 @@ class OrganizationMembersView(OrganizationView):
             organization=organization,
         ).select_related('user')
 
-        queryset = sorted(queryset, key=lambda x: x.user.get_display_name())
+        queryset = sorted(queryset, key=lambda x: x.email or x.user.get_display_name())
 
         member_list = []
         for om in queryset:
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 15c16bc18e..4b8b8e150b 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -35,6 +35,7 @@ __all__ = ('urlpatterns',)
 from sentry.web.frontend.accept_organization_invite import AcceptOrganizationInviteView
 from sentry.web.frontend.access_group_migration import AccessGroupMigrationView
 from sentry.web.frontend.home import HomeView
+from sentry.web.frontend.organization_audit_log import OrganizationAuditLogView
 from sentry.web.frontend.organization_home import OrganizationHomeView
 from sentry.web.frontend.organization_members import OrganizationMembersView
 from sentry.web.frontend.organization_member_settings import OrganizationMemberSettingsView
@@ -123,6 +124,8 @@ urlpatterns += patterns('',
         name='sentry-create-organization'),
     url(r'^organizations/(?P<organization_slug>[\w_-]+)/access-groups/$', AccessGroupMigrationView.as_view(),
         name='sentry-organization-access-group-migration'),
+    url(r'^organizations/(?P<organization_slug>[\w_-]+)/audit-log/$', OrganizationAuditLogView.as_view(),
+        name='sentry-organization-audit-log'),
     url(r'^organizations/(?P<organization_slug>[\w_-]+)/members/$', OrganizationMembersView.as_view(),
         name='sentry-organization-members'),
     url(r'^organizations/(?P<organization_slug>[\w_-]+)/members/new/$', CreateOrganizationMemberView.as_view(),
diff --git a/tests/sentry/web/frontend/test_organization_audit_log.py b/tests/sentry/web/frontend/test_organization_audit_log.py
new file mode 100644
index 0000000000..e69de29bb2
