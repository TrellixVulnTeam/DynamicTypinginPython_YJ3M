commit adc18ed17ce635412d2ce73e2f895018ee5eb4f8
Author: Ted Kaemming <ted@kaemming.com>
Date:   Fri Oct 9 12:28:55 2015 -0700

    Record distinct count of users affected by issues to TSDB.

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 06d3d1592c..2aa71e2ebc 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -467,6 +467,14 @@ class EventManager(object):
                 self.logger.info('Duplicate Event found for event_id=%s', event_id)
                 return event
 
+        if event_user:
+            tsdb.record(
+                tsdb.models.users_affected_by_group,
+                group.id,
+                (event_user.tag_value,),
+                timestamp=event.datetime,
+            )
+
         if is_new and release:
             buffer.incr(Release, {'new_groups': 1}, {
                 'id': release.id,
diff --git a/tests/sentry/test_event_manager.py b/tests/sentry/test_event_manager.py
index 40692dc8fe..b378919f52 100644
--- a/tests/sentry/test_event_manager.py
+++ b/tests/sentry/test_event_manager.py
@@ -8,6 +8,7 @@ from mock import patch
 
 from django.conf import settings
 
+from sentry.app import tsdb
 from sentry.constants import MAX_CULPRIT_LENGTH, DEFAULT_LOGGER_NAME
 from sentry.event_manager import (
     EventManager, EventUser, get_hashes_for_event, get_hashes_from_fingerprint
@@ -319,6 +320,15 @@ class EventManagerTest(TransactionTestCase):
         manager.normalize()
         event = manager.save(self.project.id)
 
+        assert tsdb.get_distinct_counts_totals(
+            tsdb.models.users_affected_by_group,
+            (event.group.id,),
+            event.datetime,
+            event.datetime,
+        ) == {
+            event.group.id: 1,
+        }
+
         assert EventUser.objects.filter(
             project=self.project,
             ident='1',
