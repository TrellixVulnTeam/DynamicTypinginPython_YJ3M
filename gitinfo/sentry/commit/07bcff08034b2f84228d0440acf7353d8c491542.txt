commit 07bcff08034b2f84228d0440acf7353d8c491542
Author: William Mak <william@wmak.io>
Date:   Fri Jan 17 11:52:44 2020 -0500

    fix(releases) - Truncate emails longer than 75 chars
    
    - Fixes SENTRY-E78

diff --git a/src/sentry/models/release.py b/src/sentry/models/release.py
index 133a2fb1fd..2d297daea1 100644
--- a/src/sentry/models/release.py
+++ b/src/sentry/models/release.py
@@ -27,6 +27,7 @@ from sentry.utils import metrics
 from sentry.utils.cache import cache
 from sentry.utils.hashlib import md5_text
 from sentry.utils.retries import TimedRetryPolicy
+from sentry.utils.strings import truncatechars
 
 logger = logging.getLogger(__name__)
 
@@ -399,6 +400,8 @@ class Release(Model):
                             + "@localhost"
                         )
 
+                    author_email = truncatechars(author_email, 75)
+
                     if not author_email:
                         author = None
                     elif author_email not in authors:
diff --git a/tests/sentry/models/test_release.py b/tests/sentry/models/test_release.py
index 9d433d8111..7af45fc6ec 100644
--- a/tests/sentry/models/test_release.py
+++ b/tests/sentry/models/test_release.py
@@ -29,6 +29,7 @@ from sentry.models import (
     Repository,
 )
 from sentry.signals import release_commits_updated
+from sentry.utils.strings import truncatechars
 
 from sentry.testutils import TestCase, SetRefsTestCase
 
@@ -509,6 +510,29 @@ class SetCommitsTestCase(TestCase):
 
         release_commits_updated.disconnect(dummy_signal_handler)
 
+    def test_long_email(self):
+        org = self.create_organization()
+        project = self.create_project(organization=org, name="foo")
+
+        repo = Repository.objects.create(organization_id=org.id, name="test/repo")
+
+        release = Release.objects.create(version="abcdabc", organization=org)
+        release.add_project(project)
+        commit_email = "a" * 248 + "@a.com"  # 254 chars long, max valid email.
+        release.set_commits(
+            [
+                {
+                    "id": "a" * 40,
+                    "repository": repo.name,
+                    "author_name": "foo bar baz",
+                    "author_email": commit_email,
+                    "message": "i fixed a bug",
+                }
+            ]
+        )
+        commit = Commit.objects.get(repository_id=repo.id, organization_id=org.id, key="a" * 40)
+        assert commit.author.email == truncatechars(commit_email, 75)
+
 
 class SetRefsTest(SetRefsTestCase):
     def setUp(self):
