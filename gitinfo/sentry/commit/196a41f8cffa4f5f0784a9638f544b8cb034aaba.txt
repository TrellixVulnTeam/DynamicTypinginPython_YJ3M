commit 196a41f8cffa4f5f0784a9638f544b8cb034aaba
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Tue Oct 15 09:39:34 2019 +0200

    fix: Correctly access frames of thread (#15051)
    
    * fix: Correctly access frames of thread
    
    * fix: Add test

diff --git a/src/sentry/stacktraces/processing.py b/src/sentry/stacktraces/processing.py
index 71fb558c0b..05accbc45a 100644
--- a/src/sentry/stacktraces/processing.py
+++ b/src/sentry/stacktraces/processing.py
@@ -394,7 +394,7 @@ def get_crash_frame_from_event_data(data, frame_filter=None):
     if not frames:
         threads = get_path(data, "threads", "values")
         if threads and len(threads) == 1:
-            frames = get_path(threads, 0)
+            frames = get_path(threads, 0, "stacktrace", "frames")
 
     default = None
     for frame in reversed(frames or ()):
diff --git a/tests/sentry/test_stacktraces.py b/tests/sentry/test_stacktraces.py
index c59a833131..cb21d15fdc 100644
--- a/tests/sentry/test_stacktraces.py
+++ b/tests/sentry/test_stacktraces.py
@@ -1,9 +1,12 @@
 from __future__ import absolute_import
 
+import pytest
+
 from sentry.grouping.api import get_default_grouping_config_dict, load_grouping_config
 from sentry.stacktraces.processing import (
     find_stacktraces_in_data,
     normalize_stacktraces_for_grouping,
+    get_crash_frame_from_event_data,
 )
 from sentry.testutils import TestCase
 
@@ -334,3 +337,19 @@ class NormalizeInApptest(TestCase):
         assert frames[4]["in_app"] is False
         assert frames[5]["in_app"] is True
         assert frames[6]["in_app"] is True
+
+
+@pytest.mark.parametrize(
+    "event",
+    [
+        {"threads": {"values": [{"stacktrace": {"frames": [{"in_app": True, "marco": "polo"}]}}]}},
+        {
+            "exception": {
+                "values": [{"stacktrace": {"frames": [{"in_app": True, "marco": "polo"}]}}]
+            }
+        },
+        {"stacktrace": {"frames": [{"in_app": True, "marco": "polo"}]}},
+    ],
+)
+def test_get_crash_frame(event):
+    assert get_crash_frame_from_event_data(event)["marco"] == "polo"
