commit a66938b106f85f25d9590b6371338b8499b7a6cb
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Wed Mar 25 15:21:36 2020 -0700

    cli: Add sentry migrations run
    
    This allows us to manually run data only migrations. More in this
    subgroup will follow.

diff --git a/src/sentry/runner/__init__.py b/src/sentry/runner/__init__.py
index 8bc90b7d3d..44d5918331 100644
--- a/src/sentry/runner/__init__.py
+++ b/src/sentry/runner/__init__.py
@@ -60,6 +60,7 @@ list(
             "sentry.runner.commands.files.files",
             "sentry.runner.commands.help.help",
             "sentry.runner.commands.init.init",
+            "sentry.runner.commands.migrations.migrations",
             "sentry.runner.commands.plugins.plugins",
             "sentry.runner.commands.queues.queues",
             "sentry.runner.commands.repair.repair",
diff --git a/src/sentry/runner/commands/migrations.py b/src/sentry/runner/commands/migrations.py
new file mode 100644
index 0000000000..dd746185f6
--- /dev/null
+++ b/src/sentry/runner/commands/migrations.py
@@ -0,0 +1,36 @@
+from __future__ import absolute_import, print_function
+
+import click
+
+from sentry.runner.decorators import configuration
+
+
+@click.group()
+def migrations():
+    "Manage migrations."
+
+
+@migrations.command()
+@click.argument("app_name")
+@click.argument("migration_name")
+@configuration
+@click.pass_context
+def run(ctx, app_name, migration_name):
+    "Manually run a single data migration. Will error if migration is not data only."
+
+    from django.apps import apps
+    from django.db import connections
+    from django.db.migrations.executor import MigrationExecutor
+    from django.db.migrations import RunPython
+
+    migration = MigrationExecutor(connections["default"]).loader.get_migration_by_prefix(
+        app_name, migration_name
+    )
+    for op in migration.operations:
+        if not isinstance(op, RunPython):
+            raise click.ClickException(
+                "Migration must contain only RunPython ops, found: %s", type(op).__name__
+            )
+
+    for op in migration.operations:
+        op.code(apps, None)
