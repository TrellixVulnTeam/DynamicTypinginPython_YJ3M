commit de664079da39cac03a53d1beb618035d6cfad3b2
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Tue May 1 10:08:21 2018 -0700

    fix(ui): Settings Index org name overflow (#8232)
    
    * add acceptance test

diff --git a/src/sentry/static/sentry/app/views/settings/settingsIndex.jsx b/src/sentry/static/sentry/app/views/settings/settingsIndex.jsx
index 9d0d33b0dd..c2f92d7724 100644
--- a/src/sentry/static/sentry/app/views/settings/settingsIndex.jsx
+++ b/src/sentry/static/sentry/app/views/settings/settingsIndex.jsx
@@ -1,5 +1,6 @@
 import {Flex, Box} from 'grid-emotion';
 import DocumentTitle from 'react-document-title';
+import PropTypes from 'prop-types';
 import React from 'react';
 import styled, {css} from 'react-emotion';
 
@@ -11,9 +12,9 @@ import InlineSvg from 'app/components/inlineSvg';
 import Link from 'app/components/link';
 import LoadingIndicator from 'app/components/loadingIndicator';
 import {Panel, PanelBody, PanelHeader} from 'app/components/panels';
+import overflowEllipsis from 'app/styles/overflowEllipsis';
 import SentryTypes from 'app/proptypes';
 import SettingsLayout from 'app/views/settings/components/settingsLayout';
-import TextOverflow from 'app/components/textOverflow';
 import withLatestContext from 'app/utils/withLatestContext';
 
 const LINKS = {
@@ -32,78 +33,12 @@ const LINKS = {
 
 const HOME_ICON_SIZE = 76;
 
-const HomePanelHeader = styled(PanelHeader)`
-  background: #fff;
-  flex-direction: column;
-  text-align: center;
-  justify-content: center;
-  font-size: 18px;
-  text-transform: unset;
-  padding: 35px 30px;
-`;
-
-const HomePanelBody = styled(PanelBody)`
-  padding: 30px;
-
-  h3 {
-    font-size: 14px;
-  }
-
-  ul {
-    margin: 0;
-    li {
-      line-height: 1.6;
-      /* Bullet color */
-      color: ${p => p.theme.gray1};
-    }
-  }
-`;
-
-const getHomeIconMargin = css`
-  margin-bottom: 20px;
-`;
-
-const HomeIcon = styled.div`
-  background: ${p => p.theme[p.color || 'gray2']};
-  color: #fff;
-  width: ${HOME_ICON_SIZE}px;
-  height: ${HOME_ICON_SIZE}px;
-  border-radius: ${HOME_ICON_SIZE}px;
-  ${getHomeIconMargin} > svg {
-    margin-top: 14px;
-  }
-`;
-
-const HomeLink = styled(Link)`
-  color: ${p => p.theme.purple};
-
-  &:hover {
-    color: ${p => p.theme.purpleDark};
-  }
-`;
-
 const flexCenter = css`
   display: flex;
   flex-direction: column;
   align-items: center;
 `;
 
-const HomeLinkIcon = styled(HomeLink)`
-  ${flexCenter};
-`;
-
-const ExternalHomeLink = styled(ExternalLink)`
-  color: ${p => p.theme.purple};
-
-  &:hover {
-    color: ${p => p.theme.purpleDark};
-  }
-`;
-
-const AvatarContainer = styled.div`
-  margin-bottom: 20px;
-`;
-
 class SettingsIndex extends React.Component {
   static propTypes = {
     organization: SentryTypes.Organization,
@@ -118,11 +53,12 @@ class SettingsIndex extends React.Component {
     let organizationSettingsUrl =
       (organization && `/settings/${organization.slug}/`) || '';
 
-    let supportLinkProps = isOnPremise
-      ? {href: LINKS.FORUM}
-      : {to: `${organizationSettingsUrl}support`};
+    let supportLinkProps = {
+      isOnPremise,
+      href: LINKS.FORUM,
+      to: `${organizationSettingsUrl}support`,
+    };
     let supportText = isOnPremise ? t('Community Forums') : t('Contact Support');
-    let SupportLinkComponent = isOnPremise ? ExternalHomeLink : HomeLink;
 
     return (
       <DocumentTitle title={organization ? `${organization.slug} Settings` : 'Settings'}>
@@ -175,9 +111,9 @@ class SettingsIndex extends React.Component {
                         <InlineSvg src="icon-stack" size="44px" />
                       </HomeIcon>
                     )}
-                    <TextOverflow css={{lineHeight: '1.1em'}}>
+                    <OrganizationName css={{lineHeight: '1.1em'}}>
                       {organization ? organization.slug : t('Organization')}
-                    </TextOverflow>
+                    </OrganizationName>
                   </HomeLinkIcon>
                 </HomePanelHeader>
                 <HomePanelBody>
@@ -331,4 +267,92 @@ class SettingsIndex extends React.Component {
     );
   }
 }
+
+export {SettingsIndex};
 export default withLatestContext(SettingsIndex);
+
+const HomePanelHeader = styled(PanelHeader)`
+  background: #fff;
+  flex-direction: column;
+  text-align: center;
+  justify-content: center;
+  font-size: 18px;
+  text-transform: unset;
+  padding: 35px 30px;
+`;
+
+const HomePanelBody = styled(PanelBody)`
+  padding: 30px;
+
+  h3 {
+    font-size: 14px;
+  }
+
+  ul {
+    margin: 0;
+    li {
+      line-height: 1.6;
+      /* Bullet color */
+      color: ${p => p.theme.gray1};
+    }
+  }
+`;
+
+const getHomeIconMargin = css`
+  margin-bottom: 20px;
+`;
+
+const HomeIcon = styled.div`
+  background: ${p => p.theme[p.color || 'gray2']};
+  color: #fff;
+  width: ${HOME_ICON_SIZE}px;
+  height: ${HOME_ICON_SIZE}px;
+  border-radius: ${HOME_ICON_SIZE}px;
+  ${getHomeIconMargin} > svg {
+    margin-top: 14px;
+  }
+`;
+
+const HomeLink = styled(Link)`
+  color: ${p => p.theme.purple};
+
+  &:hover {
+    color: ${p => p.theme.purpleDark};
+  }
+`;
+
+const HomeLinkIcon = styled(HomeLink)`
+  overflow: hidden;
+  width: 100%;
+  ${flexCenter};
+`;
+
+const ExternalHomeLink = styled(ExternalLink)`
+  color: ${p => p.theme.purple};
+
+  &:hover {
+    color: ${p => p.theme.purpleDark};
+  }
+`;
+
+const SupportLinkComponent = ({isOnPremise, href, to, ...props}) => {
+  if (isOnPremise) {
+    return <ExternalHomeLink href={href} {...props} />;
+  }
+  return <HomeLink to={to} {...props} />;
+};
+SupportLinkComponent.propTypes = {
+  isOnPremise: PropTypes.bool,
+  href: PropTypes.string,
+  to: PropTypes.string,
+};
+
+const AvatarContainer = styled.div`
+  margin-bottom: 20px;
+`;
+
+const OrganizationName = styled('div')`
+  line-height: 1.1em;
+
+  ${overflowEllipsis};
+`;
diff --git a/tests/acceptance/test_new_settings.py b/tests/acceptance/test_new_settings.py
new file mode 100644
index 0000000000..31e1b8abd5
--- /dev/null
+++ b/tests/acceptance/test_new_settings.py
@@ -0,0 +1,17 @@
+from __future__ import absolute_import
+
+from sentry.testutils import AcceptanceTestCase
+
+
+class NewSettingsTest(AcceptanceTestCase):
+    def setUp(self):
+        super(NewSettingsTest, self).setUp()
+        self.user = self.create_user(name="A Very Very Very Very Long Username", email='foo@example.com')
+        self.org = self.create_organization(name="A Very Very Very Very Long Organization", owner=self.user)
+        self.login_as(self.user)
+        self.path = '/settings/'
+
+    def test_settings_index(self):
+        self.browser.get(self.path)
+        self.browser.wait_until_not('.loading-indicator')
+        self.browser.snapshot('new settings index')
diff --git a/tests/js/spec/views/settings/__snapshots__/settingsIndex.spec.jsx.snap b/tests/js/spec/views/settings/__snapshots__/settingsIndex.spec.jsx.snap
new file mode 100644
index 0000000000..4a869d75ec
--- /dev/null
+++ b/tests/js/spec/views/settings/__snapshots__/settingsIndex.spec.jsx.snap
@@ -0,0 +1,343 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`SettingsIndex renders 1`] = `
+<SideEffect(DocumentTitle)
+  title="org-slug Settings"
+>
+  <SettingsLayout
+    organization={
+      Object {
+        "access": Array [
+          "org:read",
+          "org:write",
+          "org:admin",
+          "project:read",
+          "project:write",
+          "project:admin",
+          "team:read",
+          "team:write",
+          "team:admin",
+        ],
+        "features": Array [],
+        "id": "3",
+        "name": "Organization Name",
+        "onboardingTasks": Array [],
+        "projects": Array [],
+        "slug": "org-slug",
+        "status": Object {
+          "id": "active",
+          "name": "active",
+        },
+        "teams": Array [],
+      }
+    }
+  >
+    <Flex
+      mx={-2}
+      wrap={true}
+    >
+      <Box
+        px={2}
+        w={0.3333333333333333}
+      >
+        <Panel>
+          <HomePanelHeader>
+            <HomeLinkIcon
+              to="/settings/account/"
+            >
+              <AvatarContainer>
+                <Avatar
+                  hasTooltip={false}
+                  size={76}
+                  user={
+                    Object {
+                      "email": "foo@example.com",
+                      "flags": Object {
+                        "newsletter_consent_prompt": false,
+                      },
+                      "hasPasswordAuth": true,
+                      "isAuthenticated": true,
+                      "options": Object {
+                        "timezone": "UTC",
+                      },
+                      "permissions": Set {},
+                    }
+                  }
+                />
+              </AvatarContainer>
+              My Account
+            </HomeLinkIcon>
+          </HomePanelHeader>
+          <HomePanelBody>
+            <h3>
+              Quick links
+              :
+            </h3>
+            <ul>
+              <li>
+                <HomeLink
+                  to="/settings/account/security/"
+                >
+                  Change my password
+                </HomeLink>
+              </li>
+              <li>
+                <HomeLink
+                  to="/settings/account/notifications/"
+                >
+                  Notification Preferences
+                </HomeLink>
+              </li>
+              <li>
+                <HomeLink
+                  to="/settings/account/"
+                >
+                  Change my avatar
+                </HomeLink>
+              </li>
+            </ul>
+          </HomePanelBody>
+        </Panel>
+      </Box>
+      <Box
+        px={2}
+        w={0.3333333333333333}
+      >
+        <Panel>
+          <HomePanelHeader>
+            <HomeLinkIcon
+              to="/settings/org-slug/"
+            >
+              <AvatarContainer>
+                <Avatar
+                  hasTooltip={false}
+                  organization={
+                    Object {
+                      "access": Array [
+                        "org:read",
+                        "org:write",
+                        "org:admin",
+                        "project:read",
+                        "project:write",
+                        "project:admin",
+                        "team:read",
+                        "team:write",
+                        "team:admin",
+                      ],
+                      "features": Array [],
+                      "id": "3",
+                      "name": "Organization Name",
+                      "onboardingTasks": Array [],
+                      "projects": Array [],
+                      "slug": "org-slug",
+                      "status": Object {
+                        "id": "active",
+                        "name": "active",
+                      },
+                      "teams": Array [],
+                    }
+                  }
+                  size={76}
+                />
+              </AvatarContainer>
+              <OrganizationName
+                className="css-sikqsf"
+              >
+                org-slug
+              </OrganizationName>
+            </HomeLinkIcon>
+          </HomePanelHeader>
+          <HomePanelBody>
+            <h3>
+              Quick links
+              :
+            </h3>
+            <ul>
+              <li>
+                <HomeLink
+                  to="/settings/org-slug/projects/"
+                >
+                  Projects
+                </HomeLink>
+              </li>
+              <li>
+                <HomeLink
+                  to="/settings/org-slug/teams/"
+                >
+                  Teams
+                </HomeLink>
+              </li>
+              <li>
+                <HomeLink
+                  to="/settings/org-slug/members/"
+                >
+                  Members
+                </HomeLink>
+              </li>
+            </ul>
+          </HomePanelBody>
+        </Panel>
+      </Box>
+      <Box
+        px={2}
+        w={0.3333333333333333}
+      >
+        <Panel>
+          <HomePanelHeader>
+            <ExternalHomeLink
+              className="css-1rszxb1-flexCenter"
+              href="https://docs.sentry.io/"
+            >
+              <HomeIcon
+                color="orange"
+              >
+                <InlineSvg
+                  size="48px"
+                  src="icon-docs"
+                />
+              </HomeIcon>
+            </ExternalHomeLink>
+            <ExternalHomeLink
+              href="https://docs.sentry.io/"
+            >
+              Documentation
+            </ExternalHomeLink>
+          </HomePanelHeader>
+          <HomePanelBody>
+            <h3>
+              Quick links
+              :
+            </h3>
+            <ul>
+              <li>
+                <ExternalHomeLink
+                  href="https://docs.sentry.io/quickstart/"
+                >
+                  Quickstart Guide
+                </ExternalHomeLink>
+              </li>
+              <li>
+                <ExternalHomeLink
+                  href="https://docs.sentry.io/clients/"
+                >
+                  Platforms & Frameworks
+                </ExternalHomeLink>
+              </li>
+              <li>
+                <ExternalHomeLink
+                  href="https://docs.sentry.io/learn/cli/"
+                >
+                  Sentry CLI
+                </ExternalHomeLink>
+              </li>
+            </ul>
+          </HomePanelBody>
+        </Panel>
+      </Box>
+      <Box
+        px={2}
+        w={0.3333333333333333}
+      >
+        <Panel>
+          <HomePanelHeader>
+            <SupportLinkComponent
+              className="css-1rszxb1-flexCenter"
+              href="https://forum.sentry.io/"
+              to="/settings/org-slug/support"
+            >
+              <HomeIcon
+                color="purple"
+              >
+                <InlineSvg
+                  size="48px"
+                  src="icon-support"
+                />
+              </HomeIcon>
+              Support
+            </SupportLinkComponent>
+          </HomePanelHeader>
+          <HomePanelBody>
+            <h3>
+              Quick links
+              :
+            </h3>
+            <ul>
+              <li>
+                <SupportLinkComponent
+                  href="https://forum.sentry.io/"
+                  to="/settings/org-slug/support"
+                >
+                  Contact Support
+                </SupportLinkComponent>
+              </li>
+              <li>
+                <ExternalHomeLink
+                  href="https://github.com/getsentry/sentry/issues"
+                >
+                  Sentry on GitHub
+                </ExternalHomeLink>
+              </li>
+              <li>
+                <ExternalHomeLink
+                  href="https://status.sentry.io/"
+                >
+                  Service Status
+                </ExternalHomeLink>
+              </li>
+            </ul>
+          </HomePanelBody>
+        </Panel>
+      </Box>
+      <Box
+        px={2}
+        w={0.3333333333333333}
+      >
+        <Panel>
+          <HomePanelHeader>
+            <HomeLinkIcon
+              to="/settings/account/api/"
+            >
+              <HomeIcon>
+                <InlineSvg
+                  size="48px"
+                  src="icon-lock"
+                />
+              </HomeIcon>
+              API Keys
+            </HomeLinkIcon>
+          </HomePanelHeader>
+          <HomePanelBody>
+            <h3>
+              Quick links
+              :
+            </h3>
+            <ul>
+              <li>
+                <HomeLink
+                  to="/settings/account/api/"
+                >
+                  Auth Tokens
+                </HomeLink>
+              </li>
+              <li>
+                <HomeLink
+                  to="/settings/account/api/applications/"
+                >
+                  Applications
+                </HomeLink>
+              </li>
+              <li>
+                <ExternalHomeLink
+                  href="https://docs.sentry.io/hosted/api/"
+                >
+                  Documentation
+                </ExternalHomeLink>
+              </li>
+            </ul>
+          </HomePanelBody>
+        </Panel>
+      </Box>
+    </Flex>
+  </SettingsLayout>
+</SideEffect(DocumentTitle)>
+`;
diff --git a/tests/js/spec/views/settings/settingsIndex.spec.jsx b/tests/js/spec/views/settings/settingsIndex.spec.jsx
new file mode 100644
index 0000000000..a3f6cafa25
--- /dev/null
+++ b/tests/js/spec/views/settings/settingsIndex.spec.jsx
@@ -0,0 +1,36 @@
+import {shallow} from 'enzyme';
+import React from 'react';
+
+import {SettingsIndex} from 'app/views/settings/settingsIndex';
+import ConfigStore from 'app/stores/configStore';
+
+describe('SettingsIndex', function() {
+  it('renders', function() {
+    let wrapper = shallow(<SettingsIndex organization={TestStubs.Organization()} />);
+    expect(wrapper).toMatchSnapshot();
+  });
+
+  it('has loading when there is no organization', function() {
+    let wrapper = shallow(<SettingsIndex organization={null} />);
+
+    expect(wrapper.find('LoadingIndicator')).toHaveLength(1);
+  });
+
+  it('has different links for on premise users', function() {
+    ConfigStore.set('isOnPremise', true);
+
+    let wrapper = shallow(<SettingsIndex organization={TestStubs.Organization()} />);
+
+    expect(
+      wrapper.find(
+        'HomePanelHeader SupportLinkComponent[href="https://forum.sentry.io/"]'
+      )
+    ).toHaveLength(1);
+
+    expect(
+      wrapper
+        .find('HomePanelBody SupportLinkComponent[href="https://forum.sentry.io/"]')
+        .prop('children')
+    ).toBe('Community Forums');
+  });
+});
