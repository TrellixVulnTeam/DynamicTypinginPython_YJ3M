commit cba6db7cf5ac2d53ef664088842df269bbcb6677
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon May 18 17:05:32 2020 +0200

    ref: Clean up apm sample rate configuration (#18881)
    
    All of this stuff has to be opt-in to not create noise in onprem and single-tenant. There will be a PR for our production config to restore the values for the processing/symbolication tasks

diff --git a/src/sentry/api/endpoints/relay_projectconfigs.py b/src/sentry/api/endpoints/relay_projectconfigs.py
index 7ee340a3e6..a90e70216e 100644
--- a/src/sentry/api/endpoints/relay_projectconfigs.py
+++ b/src/sentry/api/endpoints/relay_projectconfigs.py
@@ -1,9 +1,12 @@
 from __future__ import absolute_import
 
+import random
 import logging
 import six
 from rest_framework.response import Response
 
+from django.conf import settings
+
 from sentry_sdk import Hub
 from sentry_sdk.tracing import Span
 
@@ -20,13 +23,17 @@ logger = logging.getLogger(__name__)
 PROJECT_CONFIG_SIZE_THRESHOLD = 10000
 
 
+def _sample_apm():
+    return random.random() < getattr(settings, "SENTRY_RELAY_ENDPOINT_APM_SAMPLING", 0)
+
+
 class RelayProjectConfigsEndpoint(Endpoint):
     authentication_classes = (RelayAuthentication,)
     permission_classes = (RelayPermission,)
 
     def post(self, request):
         with Hub.current.start_span(
-            Span(op="http.server", transaction="RelayProjectConfigsEndpoint", sampled=True)
+            Span(op="http.server", transaction="RelayProjectConfigsEndpoint", sampled=_sample_apm())
         ):
             return self._post(request)
 
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index c49d20a248..f83e7fd5e4 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -945,14 +945,25 @@ SENTRY_FRONTEND_REQUESTS_DSN = None
 # Configuration for JavaScript's whitelistUrls - defaults to ALLOWED_HOSTS
 SENTRY_FRONTEND_WHITELIST_URLS = None
 
-# Sample rate for Sentry transactions
+# ----
+# APM config
+# ----
+
+# sample rate for transactions initiated from the frontend
 SENTRY_APM_SAMPLING = 0
 
 # Sample rate for symbolicate_event task transactions
-SENTRY_SYMBOLICATE_EVENT_APM_SAMPLING = 0.1
+SENTRY_SYMBOLICATE_EVENT_APM_SAMPLING = 0
 
 # Sample rate for the process_event task transactions
-SENTRY_PROCESS_EVENT_APM_SAMPLING = 0.01
+SENTRY_PROCESS_EVENT_APM_SAMPLING = 0
+
+# sample rate for the relay projectconfig endpoint
+SENTRY_RELAY_ENDPOINT_APM_SAMPLING = 0
+
+# ----
+# end APM config
+# ----
 
 # DSN to use for Sentry monitors
 SENTRY_MONITOR_DSN = None
