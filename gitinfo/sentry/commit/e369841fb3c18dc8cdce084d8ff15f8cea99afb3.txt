commit e369841fb3c18dc8cdce084d8ff15f8cea99afb3
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Tue Jan 7 17:25:25 2020 -0800

    ref: Use new Event for debug mail views (#16290)

diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index 978fb18ea6..9085347925 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -16,7 +16,7 @@ from django.views.generic import View
 from loremipsum import Generator
 from random import Random
 
-from sentry import options
+from sentry import eventstore, options
 from sentry.app import tsdb
 from sentry.constants import LOG_LEVELS
 from sentry.digests import Record
@@ -33,7 +33,6 @@ from sentry.models import (
     Project,
     Release,
     Rule,
-    SnubaEvent,
     Team,
 )
 from sentry.event_manager import EventManager
@@ -198,15 +197,8 @@ class ActivityMailDebugView(View):
         group.message = event_manager.get_search_message()
         group.data = {"type": event_type.key, "metadata": event_type.get_metadata(data)}
 
-        event = SnubaEvent(
-            {
-                "event_id": "a" * 32,
-                "project_id": project.id,
-                "group_id": group.id,
-                "message": event_manager.get_search_message(),
-                "data": data.data,
-                "timestamp": data["timestamp"],
-            }
+        event = eventstore.create_event(
+            event_id="a" * 32, group_id=group.id, project_id=project.id, data=data.data
         )
 
         activity = Activity(group=group, project=event.project, **self.get_activity(request, event))
@@ -357,21 +349,13 @@ def digest(request):
             event_manager.normalize()
             data = event_manager.get_data()
 
-            timestamp = to_datetime(
-                random.randint(to_timestamp(group.first_seen), to_timestamp(group.last_seen))
+            data["timestamp"] = random.randint(
+                to_timestamp(group.first_seen), to_timestamp(group.last_seen)
             )
 
-            event = SnubaEvent(
-                {
-                    "event_id": uuid.uuid4().hex,
-                    "project_id": project.id,
-                    "group_id": group.id,
-                    "message": group.message,
-                    "data": data.data,
-                    "timestamp": timestamp.strftime("%Y-%m-%dT%H:%M:%S"),
-                }
+            event = eventstore.create_event(
+                event_id=uuid.uuid4().hex, group_id=group.id, project_id=project.id, data=data.data
             )
-            event.group = group
 
             records.append(
                 Record(
