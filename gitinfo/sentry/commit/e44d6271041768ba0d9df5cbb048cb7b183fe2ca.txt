commit e44d6271041768ba0d9df5cbb048cb7b183fe2ca
Author: Ted Kaemming <ted@kaemming.com>
Date:   Thu Nov 12 11:35:18 2015 -0800

    Prioritize sending single notifications over digest storage.

diff --git a/src/sentry/plugins/bases/notify.py b/src/sentry/plugins/bases/notify.py
index bbb80fb168..49f397e48c 100644
--- a/src/sentry/plugins/bases/notify.py
+++ b/src/sentry/plugins/bases/notify.py
@@ -65,10 +65,6 @@ class NotificationPlugin(Plugin):
 
         if hasattr(self, 'notify_digest'):
             project = event.group.project
-            if features.has('projects:digests:store', project):
-                key = unsplit_key(self, event.group.project)
-                if digests.add(key, event_to_record(event, rules)):
-                    deliver_digest.delay(key)
 
             # If digest delivery is disabled, we still need to send a
             # notification -- we also need to check rate limits, since
@@ -82,6 +78,11 @@ class NotificationPlugin(Plugin):
                 notification = Notification(event=event, rules=rules)
                 self.notify(notification)
 
+            if features.has('projects:digests:store', project):
+                key = unsplit_key(self, event.group.project)
+                if digests.add(key, event_to_record(event, rules)):
+                    deliver_digest.delay(key)
+
         else:
             notification = Notification(event=event, rules=rules)
             self.notify(notification)
