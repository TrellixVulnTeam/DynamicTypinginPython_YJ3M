commit a0f392f1f72442ec011e64ef846e7fb905973530
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Dec 22 23:39:19 2012 -0800

    Change Group details page to render with Backbone

diff --git a/src/sentry/static/sentry/scripts/app.js b/src/sentry/static/sentry/scripts/app.js
index 3a81026fe7..243ff0c390 100644
--- a/src/sentry/static/sentry/scripts/app.js
+++ b/src/sentry/static/sentry/scripts/app.js
@@ -1,6 +1,6 @@
 /*global Sentry:true*/
 
-(function(app, Backbone, jQuery, _){
+(function(window, app, Backbone, jQuery, _){
     "use strict";
 
     var $ = jQuery;
@@ -141,8 +141,35 @@
         initialize: function(data){
             BasePage.prototype.initialize.call(this, data);
 
+            this.group_list = new app.GroupListView({
+                className: 'group-list',
+                id: 'event_list',
+                members: [data.group],
+                model: app.Group
+            });
+
             $('#chart').height('200px');
             Sentry.charts.render('#chart');
+
+            $('#public-status .action').click(function(){
+                var $this = $(this);
+                $.ajax({
+                    url: $this.attr('data-api-url'),
+                    type: 'post',
+                    dataType: 'json',
+                    success: function(groups){
+                        var group = groups[0];
+                        var selector = (group.is_public ? 'true' : 'false');
+                        var nselector = (group.is_public ? 'false' : 'true');
+                        $('#public-status span[data-public="' + selector + '"]').show();
+                        $('#public-status span[data-public="' + nselector + '"]').hide();
+                    },
+                    error: function(){
+                        window.alert('There was an error changing the public status');
+                    }
+                });
+            });
+
         }
 
     });
@@ -246,4 +273,4 @@
     Backbone.sync = function(method, model, success, error){
         success();
     };
-}(app, Backbone, jQuery, _));
\ No newline at end of file
+}(window, app, Backbone, jQuery, _));
\ No newline at end of file
diff --git a/src/sentry/static/sentry/scripts/templates.js b/src/sentry/static/sentry/scripts/templates.js
index 25154c66fb..c7e4c634f2 100644
--- a/src/sentry/static/sentry/scripts/templates.js
+++ b/src/sentry/static/sentry/scripts/templates.js
@@ -26,7 +26,7 @@
                 '<span class="sparkline"></span>' + 
                 '<ul class="actions">' + 
                     '<% if (canResolve) { %>' + 
-                        '<li>' + 
+                        '<li>' +
                             '<% if (!isResolved) { %>' + 
                                 '<a href="#" data-action="resolve" title="Mark as Resolved">&#10003;</a>' + 
                             '<% } else { %>' + 
diff --git a/src/sentry/static/sentry/scripts/views.js b/src/sentry/static/sentry/scripts/views.js
index e8833f3375..bf0310e4d6 100644
--- a/src/sentry/static/sentry/scripts/views.js
+++ b/src/sentry/static/sentry/scripts/views.js
@@ -22,10 +22,12 @@
             this.$el.html(this.template(data));
             this.$el.attr('data-id', this.model.id);
             this.$el.addClass(this.getLevelClassName());
-            if (this.model.get('isResolved'))
+            if (this.model.get('isResolved')) {
                 this.$el.addClass('resolved');
-            if (this.model.get('historicalData'))
+            }
+            if (this.model.get('historicalData').length > 0) {
                 this.$el.addClass('with-sparkline');
+            }
             this.$el.find('a[data-action=resolve]').click(_.bind(function(e){
                 e.preventDefault();
                 this.resolve();
diff --git a/src/sentry/templates/sentry/groups/details.html b/src/sentry/templates/sentry/groups/details.html
index 3e82612071..b29459f5a8 100644
--- a/src/sentry/templates/sentry/groups/details.html
+++ b/src/sentry/templates/sentry/groups/details.html
@@ -87,48 +87,7 @@
 
 {% block main %}
     {% handle_before_events request group %}
-    <ul class="events" id="event_list">
-        <li class="event level-{{ group.get_level_display }}{% if group.status == 1 %} resolved{% endif %}" data-count="{{ group.times_seen|safe }}" data-score="{{ group.sort_value|safe }}" data-group="{{ group.id|safe }}">
-            <div class="count"><span title="{{ group.times_seen }}">{{ group.times_seen|small_count }}</span></div>
-            <div class="details">
-                <h3>
-                    {% if group.view %}
-                        {{ group.view }}
-                    {% else %}
-                        {{ group.message_top|truncatechars:100 }}
-                    {% endif %}
-                </h3>
-                <p class="message" title="{{ group.message }}">
-                    <span class="tag tag-logger">{{ group.logger }}</span>
-                    {% with group.get_version as version %}
-                        {% if version %}
-                            <span class="tag tag-version">{{ version.0 }} {{ version.1 }}</span>
-                        {% endif %}
-                    {% endwith %}
-                    {% for tag in group|get_tags:request %}<span class="tag">{{ tag }}</span> {% endfor %}
-                    {{ group.error }}
-                </p>
-                <div class="meta">
-                    <span class="last-seen pretty-date" title="{{ group.last_seen|date:"c" }}Z">{{ group.last_seen|timesince }}</span>
-                    {% if group.avg_time_spent %}
-                        <span class="time-spent">{{ group.avg_time_spent|duration }}</span>
-                    {% endif %}
-                </div>
-                {% if can_admin_event %}
-                    <ul class="actions">
-                        <li>
-                            {% if group.status == 0 %}
-                                <a href="javascript:void(0)" class="tip" onclick="Sentry.stream.resolve('{{ group.project.slug }}', {{ group.id|safe }}, false);" rel="tooltip" title="{% trans "Mark as Resolved" %}">&#10003;</a>
-                            {% else %}
-                                <a href="javascript:void(0)" class="tip checked" rel="tooltip" title="{% trans "Already Resolved" %}">&#10003;</a>
-                            {% endif %}
-                        </li>
-                        <li><a href="javascript:void(0)" onclick="Sentry.stream.bookmark('{{ group.project.slug }}', {{ group.id|safe }}, this);" class="tip bookmark{% if group|is_bookmarked:request.user %} checked{% endif %}" rel="tooltip" title="{% trans "Bookmark" %}">&#9733;</a></li>
-                    </ul>
-                {% endif %}
-            </div>
-        </li>
-    </ul>
+    <div id="event_list"></div>
 
     <section class="body">
         <ul class="nav nav-tabs">
@@ -172,24 +131,8 @@
 {% block content_after %}
     <script type="text/javascript">
     $(document).ready(function() {
-        new app.GroupDetailsPage();
-        $('#public-status .action').click(function(){
-            var $this = $(this);
-            $.ajax({
-                url: $this.attr('data-api-url'),
-                type: 'post',
-                dataType: 'json',
-                success: function(groups){
-                    var group = groups[0];
-                    var selector = (group.is_public ? 'true' : 'false');
-                    var nselector = (group.is_public ? 'false' : 'true')
-                    $('#public-status span[data-public="' + selector + '"]').show();
-                    $('#public-status span[data-public="' + nselector + '"]').hide();
-                },
-                error: function(){
-                    alert('There was an error changing the public status');
-                }
-            });
+        new app.GroupDetailsPage({
+            group: {{ group|to_json:request|safe }},
         });
     });
     </script>
