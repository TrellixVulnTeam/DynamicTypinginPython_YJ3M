commit 7556fc49f416ca3ac5e16abde65f76faae5d0550
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu May 21 11:28:49 2020 -0700

    event_manager: Move short id generation out of transaction
    
    This has a tradeoff of not guaranteeing gapless ids, but should reduce
    row lock contension for high volumes of groups within a project.

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 9eac35c298..1f28fc29c0 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -1074,8 +1074,9 @@ def _save_aggregate(event, hashes, release, **kwargs):
         # make sure it still exists
         first_release = kwargs.pop("first_release", None)
 
+        short_id = project.next_short_id()
+
         with transaction.atomic():
-            short_id = project.next_short_id()
             group, group_is_new = (
                 Group.objects.create(
                     project=project,
