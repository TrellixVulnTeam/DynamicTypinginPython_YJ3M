commit 18686fa98e81c5d189b7f56a6234f5aeb7b54466
Author: David Cramer <dcramer@gmail.com>
Date:   Mon May 6 20:53:22 2013 -0700

    Move user explore to be project bound

diff --git a/src/sentry/templates/sentry/header.html b/src/sentry/templates/sentry/header.html
index 8670fce884..93d983eba8 100644
--- a/src/sentry/templates/sentry/header.html
+++ b/src/sentry/templates/sentry/header.html
@@ -11,7 +11,6 @@
                     <nav id="team-nav">
                         <ul>
                             <li{% if SECTION == 'events' %} class="active"{% endif %}><a href="{% url 'sentry' team.slug %}">{% trans "Events" %}</a></li>
-                            <!-- <li{% if SECTION == 'users' %} class="active"{% endif %}><a href="{% url 'sentry-users' team.slug %}">Users</a></li> -->
                             {% if can_admin_team %}
                                 <li{% if SECTION == 'team' %} class="active"{% endif %}><a href="{% url 'sentry-manage-team' team.slug %}">{% trans "Team" %}</a></li>
                             {% endif %}
diff --git a/src/sentry/templates/sentry/users/details.html b/src/sentry/templates/sentry/users/details.html
index 2d02a8614a..d3c1f97309 100644
--- a/src/sentry/templates/sentry/users/details.html
+++ b/src/sentry/templates/sentry/users/details.html
@@ -10,7 +10,7 @@
 {% block breadcrumb %}
     {{ block.super }}
     <li class="divider"></li>
-    <li><a href="{% url 'sentry-user-details' team.slug tag.id %}">{{ tag.data.email }}</a></li>
+    <li><a href="{% url 'sentry-user-details' team.slug project.slug tag.id %}">{{ tag.data.email }}</a></li>
 {% endblock %}
 
 {% block bodyclass %} with-sidebar{% endblock %}
diff --git a/src/sentry/templates/sentry/users/list.html b/src/sentry/templates/sentry/users/list.html
index 54a2b147dc..217a668963 100644
--- a/src/sentry/templates/sentry/users/list.html
+++ b/src/sentry/templates/sentry/users/list.html
@@ -11,7 +11,7 @@
 
 {% block breadcrumb %}
     <li class="divider"></li>
-    <li><a href="{% url 'sentry-users' team.slug %}">{% trans "Users" %}</a></li>
+    <li><a href="{% url 'sentry-users' team.slug project.slug %}">{% trans "Users" %}</a></li>
 {% endblock %}
 
 {% block main %}
@@ -48,7 +48,7 @@
                 <tbody>
                     {% for tag in tag_list.paginator.objects %}
                         <tr>
-                            <td><a href="{% url 'sentry-user-details' team.slug tag.id %}">{% if tag.data.email %}{{ tag.data.email }}{% else %}{{ tag.value }}{% endif %}</a></td>
+                            <td><a href="{% url 'sentry-user-details' team.slug project.slug tag.id %}">{% if tag.data.email %}{{ tag.data.email }}{% else %}{{ tag.value }}{% endif %}</a></td>
                             <td style="text-align:center">{{ tag.last_seen|timesince }}</td>
                             <td style="text-align:center">{{ tag.times_seen|small_count }}</td>
                         </tr>
diff --git a/src/sentry/web/frontend/users.py b/src/sentry/web/frontend/users.py
index 1f94e7095b..8a01fe66ed 100644
--- a/src/sentry/web/frontend/users.py
+++ b/src/sentry/web/frontend/users.py
@@ -5,7 +5,7 @@ sentry.web.frontend.users
 :copyright: (c) 2012 by the Sentry Team, see AUTHORS for more details.
 :license: BSD, see LICENSE for more details.
 """
-from sentry.models import TagValue, GroupTag
+from sentry.models import TagValue, Group
 from sentry.web.decorators import login_required, has_access
 from sentry.web.helpers import render_to_response
 
@@ -19,12 +19,12 @@ SORT_OPTIONS = {
 
 @has_access
 @login_required
-def user_list(request, team):
+def user_list(request, team, project):
     sort = request.GET.get('sort')
     if sort not in SORT_OPTIONS:
         sort = DEFAULT_SORT_OPTION
 
-    tag_list = TagValue.objects.filter(project__team=team, key='sentry:user')
+    tag_list = TagValue.objects.filter(project=project, key='sentry:user')
 
     if sort == 'recent':
         tag_list = tag_list.order_by('-last_seen')
@@ -34,8 +34,9 @@ def user_list(request, team):
         tag_list = tag_list.order_by('-num_events')
 
     return render_to_response('sentry/users/list.html', {
-        'tag_list': tag_list,
         'team': team,
+        'project': project,
+        'tag_list': tag_list,
         'sort_label': SORT_OPTIONS[sort],
         'SECTION': 'users',
         'SORT_OPTIONS': SORT_OPTIONS,
@@ -44,21 +45,22 @@ def user_list(request, team):
 
 @has_access
 @login_required
-def user_details(request, team, user_id):
+def user_details(request, team, project, user_id):
     tag = TagValue.objects.get(
-        project__team=team,
+        project=project,
         key='sentry:user',
         id=user_id,
     )
 
-    event_list = GroupTag.objects.filter(
-        project__team=team,
-        key='sentry:user',
-        value=tag.value,
+    event_list = Group.objects.filter(
+        grouptag__project=project,
+        grouptag__key='sentry:user',
+        grouptag__value=tag.value,
     )
 
     return render_to_response('sentry/users/details.html', {
         'team': team,
+        'project': project,
         'tag': tag,
         'event_list': event_list,
         'SECTION': 'users',
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index d14f1566b3..94bed8b208 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -237,13 +237,12 @@ urlpatterns = patterns('',
     url(r'^(?P<team_slug>[\w_-]+)/show/alerts/$', alerts.alert_list,
         name='sentry-alerts'),
 
-    # Users
-    url(r'^(?P<team_slug>[\w_-]+)/explore/users/$', users.user_list,
+    # Explore - Users
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/users/$', users.user_list,
         name='sentry-users'),
-    url(r'^(?P<team_slug>[\w_-]+)/explore/users/(?P<user_id>\d+)/$', users.user_details,
+    url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/explore/users/(?P<user_id>\d+)/$', users.user_details,
         name='sentry-user-details'),
 
-    # Project specific
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/get-started/$', projects.get_started,
         name='sentry-get-started'),
     url(r'^(?P<team_slug>[\w_-]+)/(?P<project_id>[\w_-]+)/group/(?P<group_id>\d+)/$', groups.group,
diff --git a/tests/sentry/web/frontend/users/tests.py b/tests/sentry/web/frontend/users/tests.py
index b5e3ee3673..897b5add1b 100644
--- a/tests/sentry/web/frontend/users/tests.py
+++ b/tests/sentry/web/frontend/users/tests.py
@@ -15,7 +15,8 @@ logger = logging.getLogger(__name__)
 class UserListTest(TestCase):
     @fixture
     def path(self):
-        return reverse('sentry-users', args=[self.team.slug])
+        return reverse('sentry-users', args=[
+            self.team.slug, self.project.slug])
 
     def test_missing_permission(self):
         resp = self.client.get(self.path)
@@ -45,7 +46,8 @@ class UserListTest(TestCase):
 class UserDetailsTest(TestCase):
     @fixture
     def path(self):
-        return reverse('sentry-user-details', args=[self.team.slug, self.tag.id])
+        return reverse('sentry-user-details', args=[
+            self.team.slug, self.project.slugself.tag.id])
 
     @fixture
     def tag(self):
