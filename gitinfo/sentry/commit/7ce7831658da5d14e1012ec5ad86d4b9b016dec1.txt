commit 7ce7831658da5d14e1012ec5ad86d4b9b016dec1
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jun 26 16:51:47 2013 -0700

    Add total number of values to group tags

diff --git a/src/sentry/templates/sentry/groups/tag_list.html b/src/sentry/templates/sentry/groups/tag_list.html
index 13721a06f7..6e200b4358 100644
--- a/src/sentry/templates/sentry/groups/tag_list.html
+++ b/src/sentry/templates/sentry/groups/tag_list.html
@@ -6,7 +6,7 @@
 {% block inner %}
     {% if tag_list %}
 
-        {% for tag_name, tag_values in tag_list %}
+        {% for tag_key, tag_values in tag_list %}
             {% if not forloop.counter|divisibleby:2 %}
                 {% if not forloop.first %}
                     </div>
@@ -15,9 +15,9 @@
             {% endif %}
             <div class="span6">
                 <div class="page-header">
-                    <span class="pull-right"><a href="{% url 'sentry-group-tag-details' group.team.slug group.project.slug group.id tag_name %}">More Details</a></span>
+                    <span class="pull-right"><a href="{% url 'sentry-group-tag-details' group.team.slug group.project.slug group.id tag_key.key|urlquote %}">More Details</a></span>
 
-                    <h4>{{ tag_name|titlize }}</h4>
+                    <h4>{{ tag_key.get_label }} <small>({{ tag_key.values_seen|small_count }})</small></h4>
                 </div>
 
                 <ul class="tag-list">
@@ -25,7 +25,7 @@
                         <li>
                             <div class="progressbar">
                                 <div style="width:{{ percent }}%;">{{ times_seen }}</div>
-                                <a href="{% url 'sentry-stream' group.team.slug group.project.slug %}?{{ tag_name }}={{ tag_value }}">
+                                <a href="{% url 'sentry-stream' group.team.slug group.project.slug %}?{{ tag_key.key|urlquote }}={{ tag_value|urlquote }}">
                                     {{ tag_value }}
                                     <span>{{ times_seen|small_count }} ({{ percent }}%)</span>
                                 </a>
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 677f6d73ac..db7dbcf16e 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -30,7 +30,7 @@ from sentry.constants import (
     MSSQL_SORT_CLAUSES, MSSQL_SCORE_CLAUSES)
 from sentry.filters import get_filters
 from sentry.models import (
-    Project, Group, Event, SearchDocument, Activity, EventMapping)
+    Project, Group, Event, SearchDocument, Activity, EventMapping, TagKey)
 from sentry.permissions import can_admin_group, can_create_projects
 from sentry.plugins import plugins
 from sentry.utils import json
@@ -416,11 +416,11 @@ def group_tag_list(request, team, project, group):
 
     # O(N) db access
     tag_list = []
-    for tag_name in group.get_tags():
-        tag_list.append((tag_name, [
+    for tag_key in TagKey.objects.filter(project=project, key__in=group.get_tags()):
+        tag_list.append((tag_key, [
             (value, times_seen, percent(group.times_seen, times_seen))
             for (value, times_seen, first_seen, last_seen)
-            in group.get_unique_tags(tag_name)[:5]
+            in group.get_unique_tags(tag_key.key)[:5]
         ]))
 
     return render_with_group_context(group, 'sentry/groups/tag_list.html', {
