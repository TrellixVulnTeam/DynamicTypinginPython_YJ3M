commit 42325ca86b5692b6ca2816eb52e58daea132d68b
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Mon Dec 17 14:02:59 2018 -0800

    test(discover): Add tests for discover access (#11065)
    
    Added tests for:
    - no access to feature
    - attempting to query project without access

diff --git a/tests/snuba/test_organization_discover_query.py b/tests/snuba/test_organization_discover_query.py
index 716618012e..e293b729bb 100644
--- a/tests/snuba/test_organization_discover_query.py
+++ b/tests/snuba/test_organization_discover_query.py
@@ -22,6 +22,8 @@ class OrganizationDiscoverQueryTest(APITestCase, SnubaTestCase):
             organization=self.org,
         )
 
+        self.other_project = self.create_project(name='other')
+
         self.group = self.create_group(project=self.project, short_id=20)
 
         self.event = self.create_event(
@@ -244,3 +246,27 @@ class OrganizationDiscoverQueryTest(APITestCase, SnubaTestCase):
             {'name': 'project.name', 'type': 'string'},
             {'name': 'count', 'type': 'integer'}
         ]
+
+    def test_no_feature_access(self):
+        url = reverse('sentry-api-0-organization-discover-query', args=[self.org.slug])
+        response = self.client.post(url, {
+            'projects': [self.project.id],
+            'fields': ['message', 'platform'],
+            'range': '14d',
+            'orderby': '-timestamp',
+        })
+
+        assert response.status_code == 404, response.content
+
+    def test_invalid_project(self):
+        with self.feature('organizations:discover'):
+
+            url = reverse('sentry-api-0-organization-discover-query', args=[self.org.slug])
+            response = self.client.post(url, {
+                'projects': [self.other_project.id],
+                'fields': ['message', 'platform'],
+                'range': '14d',
+                'orderby': '-timestamp',
+            })
+
+        assert response.status_code == 403, response.content
