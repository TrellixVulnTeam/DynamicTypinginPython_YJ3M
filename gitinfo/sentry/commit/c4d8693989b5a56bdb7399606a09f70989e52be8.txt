commit c4d8693989b5a56bdb7399606a09f70989e52be8
Author: Lauryn Brown <lauryndbrown@gmail.com>
Date:   Fri Sep 28 09:42:57 2018 -0700

    fix(integrations): Gitlab add base url to gitlab identity external_id. (#9925)
    
    * Added base url to gitlab identity external_id'
    
    * got tests working

diff --git a/src/sentry/integrations/gitlab/integration.py b/src/sentry/integrations/gitlab/integration.py
index 5cd81c1203..4e9106d3b4 100644
--- a/src/sentry/integrations/gitlab/integration.py
+++ b/src/sentry/integrations/gitlab/integration.py
@@ -225,7 +225,7 @@ class GitlabIntegrationProvider(IntegrationProvider):
             },
             'user_identity': {
                 'type': 'gitlab',
-                'external_id': user['id'],
+                'external_id': u'{}:{}'.format(urlparse(base_url).netloc, user['id']),
                 'scopes': scopes,
                 'data': oauth_data,
             },
diff --git a/tests/sentry/integrations/gitlab/test_integration.py b/tests/sentry/integrations/gitlab/test_integration.py
index 22f7886d01..5233f3f4ff 100644
--- a/tests/sentry/integrations/gitlab/test_integration.py
+++ b/tests/sentry/integrations/gitlab/test_integration.py
@@ -111,7 +111,7 @@ class GitlabIntegrationTest(IntegrationTestCase):
         identity = Identity.objects.get(
             idp=idp,
             user=self.user,
-            external_id='user_id_1',
+            external_id='gitlab.example.com:user_id_1',
         )
         assert identity.status == IdentityStatus.VALID
         assert identity.data == {
