commit 738c5d65a6d5bfe18f785a88f5a8832b0bceea13
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jan 4 00:20:07 2012 -0800

    Dont support Trending with sqlite

diff --git a/sentry/templates/sentry/groups/group_list.html b/sentry/templates/sentry/groups/group_list.html
index bd3996dd80..35590d6987 100644
--- a/sentry/templates/sentry/groups/group_list.html
+++ b/sentry/templates/sentry/groups/group_list.html
@@ -76,9 +76,11 @@
                 <li class="divider"></li>
                 <li{% ifequal sort 'tottime' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=tottime">{% trans "Total Time Spent" %}</a></li>
                 <li{% ifequal sort 'avgtime' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=avgtime">{% trans "Average Time Spent" %}</a></li>
-                <li class="divider"></li>
-                <li{% ifequal sort 'accel_15' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_15">{% trans "Trending: 15 minutes" %}</a></li>
-                <li{% ifequal sort 'accel_60' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_60">{% trans "Trending: 60 minutes" %}</a></li>
+                {% if HAS_TRENDING %}
+                    <li class="divider"></li>
+                    <li{% ifequal sort 'accel_15' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_15">{% trans "Trending: 15 minutes" %}</a></li>
+                    <li{% ifequal sort 'accel_60' %} class="active"{% endifequal %}><a href="?{{ sort_querystring }}&amp;sort=accel_60">{% trans "Trending: 60 minutes" %}</a></li>
+                {% endif %}
             </ul>
         </li>
         <li class="pull-right"><a href="{% url sentry-ajax project.pk %}?op=clear" onclick="Sentry.stream.clear();return false;">Clear Feed</a>
diff --git a/sentry/web/frontend/groups.py b/sentry/web/frontend/groups.py
index 5f8df63db8..3af1a6c61a 100644
--- a/sentry/web/frontend/groups.py
+++ b/sentry/web/frontend/groups.py
@@ -23,7 +23,7 @@ from sentry.conf import settings
 from sentry.filters import Filter
 from sentry.models import Group, Event, Project, View
 from sentry.plugins import GroupActionProvider
-from sentry.utils import json
+from sentry.utils import json, get_db_engine
 from sentry.web.decorators import has_access, login_required
 from sentry.web.helpers import render_to_response, \
     get_project_list
@@ -32,6 +32,9 @@ uuid_re = re.compile(r'^[a-z0-9]{32}$', re.I)
 event_re = re.compile(r'^(?P<event_id>[a-z0-9]{32})\$(?P<checksum>[a-z0-9]{32})$', re.I)
 
 
+HAS_TRENDING = not get_db_engine('default').startswith('sqlite')
+
+
 @login_required
 @csrf_exempt
 @has_access
@@ -80,7 +83,7 @@ def ajax_handler(request, project):
             event_list = event_list.filter(time_spent_count__gt=0)\
                                    .extra(select={'avg_time_spent': 'time_spent_total / time_spent_count'})\
                                    .order_by('-avg_time_spent')
-        elif sort and sort.startswith('accel_'):
+        elif HAS_TRENDING and sort and sort.startswith('accel_'):
             event_list = Group.objects.get_accelerated(event_list, minutes=int(sort.split('_', 1)[1]))
         else:
             sort = 'priority'
@@ -279,7 +282,7 @@ def group_list(request, project, view_id=None):
         event_list = event_list.filter(time_spent_count__gt=0)\
                                .extra(select={'_avg_time_spent': 'time_spent_total / time_spent_count'})\
                                .order_by('-_avg_time_spent')
-    elif sort and sort.startswith('accel_'):
+    elif HAS_TRENDING and sort and sort.startswith('accel_'):
         minutes = int(sort.split('_', 1)[1])
         sort_label = 'Trending: {0} minutes'.format(minutes)
         event_list = Group.objects.get_accelerated(event_list, minutes=minutes)
@@ -302,6 +305,7 @@ def group_list(request, project, view_id=None):
         'any_filter': any_filter,
         'filters': filters,
         'view': view,
+        'HAS_TRENDING': HAS_TRENDING,
     }, request)
 
 
