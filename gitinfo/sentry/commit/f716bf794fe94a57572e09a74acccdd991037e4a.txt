commit f716bf794fe94a57572e09a74acccdd991037e4a
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Jan 22 12:55:14 2013 -0800

    More fixes for syntax highlighting

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index 13448ee2ec..54e9f4d452 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -70,10 +70,12 @@ def get_context(lineno, context_line, pre_context=None, post_context=None, filen
 
         def format(line):
             if not line:
-                return ''
+                return '<pre></pre>'
             return mark_safe(highlight(line, lexer, formatter))
 
         context = tuple((n, format(l)) for n, l in context)
+    else:
+        context = tuple((n, '<pre>%s</pre>' % (mark_safe(l),)) for n, l in context)
 
     return context
 
@@ -363,6 +365,7 @@ class Stacktrace(Interface):
                     pre_context=frame.get('pre_context'),
                     post_context=frame.get('post_context'),
                     filename=frame.get('abs_path', frame.get('filename')),
+                    format=True,
                 )
                 start_lineno = context[0][0]
             else:
