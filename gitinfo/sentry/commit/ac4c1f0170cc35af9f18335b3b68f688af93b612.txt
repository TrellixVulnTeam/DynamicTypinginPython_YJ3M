commit ac4c1f0170cc35af9f18335b3b68f688af93b612
Author: ted kaemming <t.kaemming+github@gmail.com>
Date:   Thu Jul 14 10:12:40 2016 -0700

    Support plaintext rendering for all email previews. (#3718)
    
    * Support `format` parameter for all mail previews.
    * Add digest to mail preview dropdown.

diff --git a/src/sentry/templates/sentry/debug/mail/preview.html b/src/sentry/templates/sentry/debug/mail/preview.html
index 94154ad8fd..c584cb7131 100644
--- a/src/sentry/templates/sentry/debug/mail/preview.html
+++ b/src/sentry/templates/sentry/debug/mail/preview.html
@@ -16,6 +16,7 @@
       </optgroup>
       <optgroup label="Alerts">
         <option value="mail/new-event/">New Event</option>
+        <option value="mail/digest/">Digest</option>
       </optgroup>
       <optgroup label="Account">
         <option value="mail/confirm-email/">Confirm Email</option>
diff --git a/src/sentry/web/frontend/debug/debug_new_release_email.py b/src/sentry/web/frontend/debug/debug_new_release_email.py
index 89f8a15eb7..38a2c971d0 100644
--- a/src/sentry/web/frontend/debug/debug_new_release_email.py
+++ b/src/sentry/web/frontend/debug/debug_new_release_email.py
@@ -7,7 +7,6 @@ from uuid import uuid4
 
 from sentry.models import Organization, Team, Project, Release
 from sentry.utils.http import absolute_uri
-from sentry.web.helpers import render_to_response
 
 from .mail import MailPreview
 
@@ -48,7 +47,7 @@ class DebugNewReleaseEmailView(View):
             'project_id': project.slug,
         }))
 
-        preview = MailPreview(
+        return MailPreview(
             html_template='sentry/emails/activity/release.html',
             text_template='sentry/emails/activity/release.txt',
             context={
@@ -57,8 +56,4 @@ class DebugNewReleaseEmailView(View):
                 'release_link': release_link,
                 'project_link': project_link,
             },
-        )
-
-        return render_to_response('sentry/debug/mail/preview.html', {
-            'preview': preview,
-        })
+        ).render(request)
diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index 7453f0bab1..864142f60f 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -121,9 +121,10 @@ class MailPreview(object):
             traceback.print_exc()
             raise
 
-    def render(self):
+    def render(self, request):
         return render_to_response('sentry/debug/mail/preview.html', {
             'preview': self,
+            'format': request.GET.get('format'),
         })
 
 
@@ -261,7 +262,7 @@ def new_event(request):
                 ('device', 'Other')
             ]
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -355,7 +356,7 @@ def digest(request):
             'start': start,
             'end': end,
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -384,7 +385,7 @@ def request_access(request):
                 'organization_slug': org.slug,
             }) + '?ref=access-requests'),
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -411,7 +412,7 @@ def invitation(request):
                 'token': om.token,
             })),
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -437,7 +438,7 @@ def access_approved(request):
             'organization': org,
             'team': team,
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -457,7 +458,7 @@ def confirm_email(request):
             )),
             'is_new_user': True,
         },
-    ).render()
+    ).render(request)
 
 
 @login_required
@@ -473,4 +474,4 @@ def recover_account(request):
             )),
             'domain': get_server_hostname(),
         },
-    ).render()
+    ).render(request)
