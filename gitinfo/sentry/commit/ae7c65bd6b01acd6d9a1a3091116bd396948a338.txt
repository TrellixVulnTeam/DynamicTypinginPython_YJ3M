commit ae7c65bd6b01acd6d9a1a3091116bd396948a338
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Dec 7 19:23:48 2015 -0800

    Pass SENTRY_CONF correctly to subprocess in devserver

diff --git a/src/sentry/runner/initializer.py b/src/sentry/runner/initializer.py
index 266654bd32..497d4151ac 100644
--- a/src/sentry/runner/initializer.py
+++ b/src/sentry/runner/initializer.py
@@ -147,7 +147,8 @@ def initialize_app(config, skip_backend_validation=False):
 
     from django.utils import timezone
     from sentry.app import env
-    env.data['config'] = config['config_path']
+    from sentry.runner.settings import get_sentry_conf
+    env.data['config'] = get_sentry_conf()
     env.data['start_date'] = timezone.now()
 
 
diff --git a/src/sentry/runner/settings.py b/src/sentry/runner/settings.py
index b397ea5bea..3147f5b830 100644
--- a/src/sentry/runner/settings.py
+++ b/src/sentry/runner/settings.py
@@ -248,6 +248,21 @@ def generate_settings():
     return py, yaml
 
 
+def get_sentry_conf():
+    """
+    Fetch the SENTRY_CONF value, either from the click context
+    if available, or SENTRY_CONF environment variable.
+    """
+    try:
+        ctx = click.get_current_context()
+        return ctx.obj['config']
+    except (RuntimeError, KeyError):
+        try:
+            return os.environ['SENTRY_CONF']
+        except KeyError:
+            return '~/.sentry'
+
+
 def discover_configs(ctx=None):
     """
     Discover the locations of three configuration components:
