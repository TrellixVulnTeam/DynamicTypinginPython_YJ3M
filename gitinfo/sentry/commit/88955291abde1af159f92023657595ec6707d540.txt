commit 88955291abde1af159f92023657595ec6707d540
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jan 30 23:07:38 2012 -0800

    More cleanup including moving tags to the right side and JSifying datetimes

diff --git a/bootstrap/sentry.less b/bootstrap/sentry.less
index c805172166..14a151b500 100644
--- a/bootstrap/sentry.less
+++ b/bootstrap/sentry.less
@@ -269,6 +269,9 @@ footer {
 /* =============================  Modules  ============================== */
 
 .btn {
+  span {
+    text-indent: -1000em;
+  }
   &.prev, &.next {
     padding: 6px 8px;
   }
@@ -341,6 +344,14 @@ footer {
       margin-bottom: 0;
       font-size: 14px;
       /*font-family: "proxima nova", "proxima-nova", "heletica-neue", sans-serif;*/
+      .tag {
+        font-size: 12px;
+        .pull-right;
+        .border-radius(6px);
+        background: #fff;
+        padding: 1px 6px;
+        color: #aec9d7;
+      }
     }
     .actions {
       display: none;
diff --git a/sentry/static/scripts/global.js b/sentry/static/scripts/global.js
index d47aab746f..5c003ee985 100644
--- a/sentry/static/scripts/global.js
+++ b/sentry/static/scripts/global.js
@@ -20,6 +20,48 @@ function getQueryParams()
     return vars;
 }
 
+/**
+ * Date.parse with progressive enhancement for ISO 8601 <https://github.com/csnover/js-iso8601>
+ * © 2011 Colin Snover <http://zetafleet.com>
+ * Released under MIT license.
+ */
+(function (Date, undefined) {
+    var origParse = Date.parse, numericKeys = [ 1, 4, 5, 6, 7, 10, 11 ];
+    Date.parse = function (date) {
+        var timestamp, struct, minutesOffset = 0;
+
+        // ES5 §15.9.4.2 states that the string should attempt to be parsed as a Date Time String Format string
+        // before falling back to any implementation-specific date parsing, so that's what we do, even if native
+        // implementations could be faster
+        //              1 YYYY                2 MM       3 DD           4 HH    5 mm       6 ss        7 msec        8 Z 9 ±    10 tzHH    11 tzmm
+        if ((struct = /^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(date))) {
+            // avoid NaN timestamps caused by "undefined" values being passed to Date.UTC
+            for (var i = 0, k; (k = numericKeys[i]); ++i) {
+                struct[k] = +struct[k] || 0;
+            }
+
+            // allow undefined days and months
+            struct[2] = (+struct[2] || 1) - 1;
+            struct[3] = +struct[3] || 1;
+
+            if (struct[8] !== 'Z' && struct[9] !== undefined) {
+                minutesOffset = struct[10] * 60 + struct[11];
+
+                if (struct[9] === '+') {
+                    minutesOffset = 0 - minutesOffset;
+                }
+            }
+
+            timestamp = Date.UTC(struct[1], struct[2], struct[3], struct[4], struct[5] + minutesOffset, struct[6], struct[7]);
+        }
+        else {
+            timestamp = origParse ? origParse(date) : NaN;
+        }
+
+        return timestamp;
+    };
+}(Date));
+
 if (Sentry === undefined) {
     var Sentry = {};
 }
@@ -322,6 +364,70 @@ if (Sentry === undefined) {
             }
         });
     });
+
+    Sentry.prettyDate = function(date_str) {
+        // we need to zero out at CST
+        var time = Date.parse(date_str);
+        var seconds = (new Date() - time) / 1000;
+        // var offset = (new Date().getTimezoneOffset() - 300) * 60;
+        // seconds = seconds + offset;
+        var token = 'ago';
+        var time_formats = [
+          [60, 'just now', 'just now'], // 60
+          [120, '1 minute ago', '1 minute from now'], // 60*2
+          [3600, 'minutes', 60], // 60*60, 60
+          [7200, '1 hour ago', '1 hour from now'], // 60*60*2
+          [86400, 'hours', 3600], // 60*60*24, 60*60
+          [172800, 'yesterday', 'tomorrow'], // 60*60*24*2
+          [604800, 'days', 86400], // 60*60*24*7, 60*60*24
+          [1209600, 'last week', 'next week'], // 60*60*24*7*4*2
+          [2419200, 'weeks', 604800], // 60*60*24*7*4, 60*60*24*7
+          [4838400, 'last month', 'next month'], // 60*60*24*7*4*2
+          [29030400, 'months', 2419200], // 60*60*24*7*4*12, 60*60*24*7*4
+          [58060800, 'last year', 'next year'], // 60*60*24*7*4*12*2
+          [2903040000, 'years', 29030400], // 60*60*24*7*4*12*100, 60*60*24*7*4*12
+          [5806080000, 'last century', 'next century'], // 60*60*24*7*4*12*100*2
+          [58060800000, 'centuries', 2903040000] // 60*60*24*7*4*12*100*20, 60*60*24*7*4*12*100
+        ];
+        var list_choice = 1;
+
+        if (seconds < 0)
+        {
+            seconds = Math.abs(seconds);
+            token = 'from now';
+            list_choice = 2;
+        }
+
+        for (var i=0, format; (format = time_formats[i]); i++) {
+            if (seconds < format[0])
+            {
+                if (typeof format[2] == 'string')
+                    return format[list_choice];
+                else
+                    return Math.floor(seconds / format[2]) + ' ' + format[1] + ' ' + token;
+            }
+        }
+        return time;
+    };
+
+    Sentry.prettyDates = function() {
+        $('.pretty-date').each(function(_, el){
+            var $el = $(el);
+            var title = $el.attr('title');
+            if (title) {
+                var date = Sentry.prettyDate(title);
+                console.log(date);
+                if (date) {
+                    $el.text(date);
+                }
+            }
+        });
+    };
+
+    $(function(){
+        setInterval(Sentry.prettyDates, 5000);
+        Sentry.prettyDates();
+    });
 }());
 
 $(document).ajaxSend(function(event, xhr, settings) {
diff --git a/sentry/static/styles/global.css b/sentry/static/styles/global.css
index 844c28806e..effd131a22 100644
--- a/sentry/static/styles/global.css
+++ b/sentry/static/styles/global.css
@@ -2320,6 +2320,9 @@ footer a {
   font-weight: bold;
 }
 /* =============================  Modules  ============================== */
+.btn span {
+  text-indent: -1000em;
+}
 .btn.prev, .btn.next {
   padding: 6px 8px;
 }
@@ -2409,6 +2412,16 @@ footer a {
   /*font-family: "proxima nova", "proxima-nova", "heletica-neue", sans-serif;*/
 
 }
+.events .event .message .tag {
+  font-size: 12px;
+  float: right;
+  -webkit-border-radius: 6px;
+  -moz-border-radius: 6px;
+  border-radius: 6px;
+  background: #fff;
+  padding: 1px 6px;
+  color: #aec9d7;
+}
 .events .event .actions {
   display: none;
 }
diff --git a/sentry/static/styles/global.min.css b/sentry/static/styles/global.min.css
index 66eee76a0a..e29586773b 100644
--- a/sentry/static/styles/global.min.css
+++ b/sentry/static/styles/global.min.css
@@ -372,6 +372,7 @@ p{font-family:"proxima-nova","helvetica neue",helvetica,sans-serif;font-size:14p
 footer{*zoom:1;background:#6d757e;text-align:center;padding:30px;color:#fff;}footer:before,footer:after{display:table;content:"";}
 footer:after{clear:both;}
 footer a{color:#fff;font-weight:bold;}
+.btn span{text-indent:-1000em;}
 .btn.prev,.btn.next{padding:6px 8px;}
 .btn.prev span{display:block;width:13px;height:13px;background:url(../images/dashboard/pagination.png);}
 .btn.next span{display:block;width:13px;height:13px;background:url(../images/dashboard/pagination.png) -13px 0;}
@@ -380,7 +381,7 @@ footer a{color:#fff;font-weight:bold;}
 .events .event h3{font-family:"proxima nova","proxima-nova","heletica-neue",sans-serif;margin:4px 0 0;font-size:20px;}.events .event h3 span{margin-left:10px;font-weight:300;padding:0 5px;font-size:13px;}
 .events .event .count{color:#fff;position:absolute;width:60px;height:60px;background:#cfd3da;-webkit-border-radius:60px;-moz-border-radius:60px;border-radius:60px;line-height:62px;text-align:center;font-size:26px;font-weight:400;letter-spacing:-1px;font-family:"proxima nova","proxima-nova","heletica-neue",sans-serif;}
 .events .event .details{margin:0 0 0 80px;}
-.events .event .message{margin-bottom:0;font-size:14px;}
+.events .event .message{margin-bottom:0;font-size:14px;}.events .event .message .tag{font-size:12px;float:right;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;background:#fff;padding:1px 6px;color:#aec9d7;}
 .events .event .actions{display:none;}
 .events .event .row_link{top:0;left:0;width:100%;height:100%;position:absolute;}
 .events .event.level-20 .count{background:#ffa101;}
diff --git a/sentry/templates/sentry/groups/group_list.html b/sentry/templates/sentry/groups/group_list.html
index 229f134f6e..2fecbfbb68 100644
--- a/sentry/templates/sentry/groups/group_list.html
+++ b/sentry/templates/sentry/groups/group_list.html
@@ -74,8 +74,8 @@
             </ul>
         </div>
         <div class="btn-group pull-right">
-            <a class="btn prev{% if not event_list.paginator.has_previous %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.previous_page }}">&larr;</a>
-            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.next_page }}">&rarr;</a>
+            <a class="btn prev{% if not event_list.paginator.has_previous %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
         </div>
     </div>
 
@@ -94,8 +94,8 @@
 
     <div class="actionbar">
         <div class="btn-group pull-right">
-            <a class="btn prev{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.previous_page }}">&larr;</a>
-            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.next_page }}">&rarr;</a>
+            <a class="btn prev{% if not event_list.paginator.has_previous %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.previous_page }}"><span>{% trans "Previous" %}</span></a>
+            <a class="btn next{% if not event_list.paginator.has_next %} disabled{% endif %}" href="?{{ event_list.query_string|escape }}&amp;p={{ event_list.paginator.next_page }}"><span>{% trans "Next" %}</span></a>
         </div>
     </div>
 {% endblock %}
\ No newline at end of file
diff --git a/sentry/templates/sentry/layout.html b/sentry/templates/sentry/layout.html
index 9665407b78..aeb054fb51 100644
--- a/sentry/templates/sentry/layout.html
+++ b/sentry/templates/sentry/layout.html
@@ -70,6 +70,12 @@
 
                         <div class="sidebar">
                             {% block sidebar %}
+                                <h6>{% trans "Your Projects" %}</h6>
+                                <ul class="nav tabs stacked">
+                                    {% for p in project_list %}
+                                        <li{% if p == project %} class="active"{% endif %}><a href="{% url sentry-manage-project p.pk %}">{{ p.name }}</a></li>
+                                    {% endfor %}
+                                </ul>
                             {% endblock %}
                         </div>
                     {% endblock %}
diff --git a/sentry/templates/sentry/partial/_group.html b/sentry/templates/sentry/partial/_group.html
index 2650783609..e2bd733613 100644
--- a/sentry/templates/sentry/partial/_group.html
+++ b/sentry/templates/sentry/partial/_group.html
@@ -11,7 +11,7 @@
                     {{ group.message_top|truncatechars:100 }}
                 {% endif %}
             </a>
-            <span class="last_seen" title="{{ group.last_seen }}">{{ group.last_seen|timesince }}</span>
+            <span class="last_seen pretty-date" title="{{ group.last_seen|date:"Y-m-dTH:i:s" }}Z">{{ group.last_seen|timesince }}</span>
             {% if group.avg_time_spent %}
                 <span class="time_spent">{{ group.avg_time_spent|duration }}</span>
             {% endif %}
diff --git a/sentry/templates/sentry/projects/manage.html b/sentry/templates/sentry/projects/manage.html
index 986559b48f..fa10c34007 100644
--- a/sentry/templates/sentry/projects/manage.html
+++ b/sentry/templates/sentry/projects/manage.html
@@ -10,15 +10,6 @@
     <li><a href="{% url sentry-manage-project project.pk %}">Manage</a></li>
 {% endblock %}
 
-{% block sidebar %}
-    <h6>{% trans "Your Projects" %}</h6>
-    <ul class="nav tabs stacked">
-        {% for p in project_list %}
-            <li{% if p == project %} class="active"{% endif %}><a href="{% url sentry-manage-project p.pk %}">{{ p.name }}</a></li>
-        {% endfor %}
-    </ul>
-{% endblock %}
-
 {% block main %}
     <section class="body">
         <ul class="nav tabs">
diff --git a/sentry/templatetags/sentry_helpers.py b/sentry/templatetags/sentry_helpers.py
index 4b025b970a..6b3ba93216 100644
--- a/sentry/templatetags/sentry_helpers.py
+++ b/sentry/templatetags/sentry_helpers.py
@@ -199,14 +199,14 @@ def timesince(value):
     from django.template.defaultfilters import timesince
     now = utc_to_local(datetime.datetime.utcnow())
     if not value:
-        return _('Never')
+        return _('never')
     if value < (now - datetime.timedelta(days=5)):
         return value.date()
     value = (' '.join(timesince(value, now).split(' ')[0:2])).strip(',')
     if value == _('0 minutes'):
-        return _('Just now')
+        return _('just now')
     if value == _('1 day'):
-        return _('Yesterday')
+        return _('yesterday')
     return value + _(' ago')
 
 
