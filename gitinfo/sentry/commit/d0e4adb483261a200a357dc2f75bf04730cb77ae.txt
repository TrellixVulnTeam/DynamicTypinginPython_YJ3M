commit d0e4adb483261a200a357dc2f75bf04730cb77ae
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Mon Sep 19 13:38:41 2016 -0700

    Guard against data keys being non-strings during sanitization (#4171)
    
    Fixes SENTRY-1YM

diff --git a/src/sentry/utils/data_scrubber.py b/src/sentry/utils/data_scrubber.py
index 5b5aed5428..8fcd31cfbc 100644
--- a/src/sentry/utils/data_scrubber.py
+++ b/src/sentry/utils/data_scrubber.py
@@ -97,7 +97,12 @@ class SensitiveDataFilter(object):
         if value is None:
             return
 
-        if key in self.exclude_fields:
+        if isinstance(key, six.string_types):
+            key = key.lower()
+        else:
+            key = ''
+
+        if key and key in self.exclude_fields:
             return value
 
         if isinstance(value, six.string_types):
@@ -110,11 +115,6 @@ class SensitiveDataFilter(object):
             if '//' in value and '@' in value:
                 value = self.URL_PASSWORD_RE.sub(r'\1' + FILTER_MASK + '@', value)
 
-        if isinstance(key, six.string_types):
-            key = key.lower()
-        else:
-            key = ''
-
         original_value = value
         if isinstance(value, six.string_types):
             value = value.lower()
