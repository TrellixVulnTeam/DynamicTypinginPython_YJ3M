commit a29d5dfca62fb7ab33cbd103480d9d643a8adca7
Author: James Cunningham <cunninghamjt09@gmail.com>
Date:   Mon Jan 8 16:14:00 2018 -0800

    fix(cleanup): Don't hard-cap EventMapping retention at 7d. (#6887)
    
    * Don't hard-cap EventMapping retention at 7d.
    
    * Move EventMapping to vanilla BulkDeleteQuery.
    
    * Add order_by clause to bulk delete EventMapping.

diff --git a/src/sentry/runner/commands/cleanup.py b/src/sentry/runner/commands/cleanup.py
index 98fa5fc1ae..220f3e2b10 100644
--- a/src/sentry/runner/commands/cleanup.py
+++ b/src/sentry/runner/commands/cleanup.py
@@ -197,6 +197,7 @@ def cleanup(days, project, concurrency, max_procs, silent, model, router, timed)
     # Deletions that use `BulkDeleteQuery` (and don't need to worry about child relations)
     # (model, datetime_field, order_by)
     BULK_QUERY_DELETES = [
+        (models.EventMapping, 'date_added', '-date_added'),
         (models.GroupEmailThread, 'date', None),
         (models.GroupRuleStatus, 'date_added', None),
     ] + EXTRA_BULK_QUERY_DELETES
@@ -321,22 +322,6 @@ def cleanup(days, project, concurrency, max_procs, silent, model, router, timed)
                     days, project_id, model, dtfield, order_by)
                 _chunk_until_complete(task)
 
-    # EventMapping is fairly expensive and is special cased as it's likely you
-    # won't need a reference to an event for nearly as long
-    if not silent:
-        click.echo("Removing expired values for EventMapping")
-    if is_filtered(models.EventMapping):
-        if not silent:
-            click.echo('>> Skipping EventMapping')
-    else:
-        BulkDeleteQuery(
-            model=models.EventMapping,
-            dtfield='date_added',
-            days=min(days, 7),
-            project_id=project_id,
-            order_by='-date_added'
-        ).execute()
-
     # Clean up FileBlob instances which are no longer used and aren't super
     # recent (as there could be a race between blob creation and reference)
     if not silent:
