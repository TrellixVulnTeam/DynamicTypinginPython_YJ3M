commit c9ae89a2086f3a13294c8feb2a94a4cf1a5ccab2
Author: Evan Purkhiser <evanpurkhiser@gmail.com>
Date:   Tue Aug 21 15:59:45 2018 -0500

    feat(repositories): Add bitbucket commitLink (#9439)
    
    * feat(repositories): Add bitbucket commitLink
    
    * Make inline actually right tho
    
    * feedback

diff --git a/src/sentry/static/sentry/app/components/commitLink.jsx b/src/sentry/static/sentry/app/components/commitLink.jsx
index e951dd312e..3cbcc17ae9 100644
--- a/src/sentry/static/sentry/app/components/commitLink.jsx
+++ b/src/sentry/static/sentry/app/components/commitLink.jsx
@@ -1,68 +1,75 @@
 import PropTypes from 'prop-types';
 import React from 'react';
+import styled from 'react-emotion';
 
 import {t} from 'app/locale';
+import {getShortVersion} from 'app/utils';
+import Button from 'app/components/buttons/button';
+import ExternalLink from 'app/components/externalLink';
 import InlineSvg from 'app/components/inlineSvg';
 
-const isBitbucket = providerId =>
-  ['bitbucket', 'integrations:bitbucket'].includes(providerId);
-const isGithub = providerId =>
-  ['github', 'integrations:github', 'integrations:github_enterprise'].includes(
-    providerId
-  );
+// TODO(epurkhiser, jess): This should be moved into plugins.
+const SUPPORTED_PROVIDERS = [
+  {
+    icon: 'icon-github',
+    providerIds: ['github', 'integrations:github', 'integrations:github_enterprise'],
+    commitUrl: ({baseUrl, commitId}) => `${baseUrl}/commit/${commitId}`,
+  },
+  {
+    icon: 'icon-bitbucket',
+    providerIds: ['bitbucket', 'integrations:bitbucket'],
+    commitUrl: ({baseUrl, commitId}) => `${baseUrl}/commits/${commitId}`,
+  },
+  {
+    icon: 'icon-vsts',
+    providerIds: ['visualstudio', 'integrations:vsts'],
+    commitUrl: ({baseUrl, commitId}) => `${baseUrl}/commit/${commitId}`,
+  },
+];
 
-class CommitLink extends React.Component {
-  static propTypes = {
-    commitId: PropTypes.string,
-    repository: PropTypes.object,
-    inline: PropTypes.bool,
-  };
+function CommitLink({inline, commitId, repository}) {
+  if (!commitId || !repository) {
+    return <span>{t('Unknown Commit')}</span>;
+  }
 
-  getCommitUrl = () => {
-    // TODO(jess): move this to plugins
-    if (isGithub(this.props.repository.provider.id)) {
-      return this.props.repository.url + '/commit/' + this.props.commitId;
-    }
-    if (isBitbucket(this.props.repository.provider.id)) {
-      return this.props.repository.url + '/commits/' + this.props.commitId;
-    }
-    return undefined;
-  };
+  const shortId = getShortVersion(commitId);
 
-  render() {
-    let {inline, commitId, repository} = this.props;
+  const providerData = SUPPORTED_PROVIDERS.find(provider =>
+    provider.providerIds.includes(repository.provider.id)
+  );
 
-    if (!commitId || !repository) {
-      return <span>{t('Unknown Commit')}</span>;
-    }
+  if (providerData === undefined) {
+    return <span>{shortId}</span>;
+  }
 
-    let commitUrl = this.getCommitUrl();
-    let shortId = commitId.slice(0, 7);
+  const commitUrl = providerData.commitUrl({
+    commitId,
+    baseUrl: repository.url,
+  });
 
-    return commitUrl ? (
-      <a
-        className={inline ? 'inline-commit' : 'btn btn-default btn-sm'}
-        href={commitUrl}
-        target="_blank"
-      >
-        {isGithub(repository.provider.id) && (
-          <InlineSvg src="icon-github" style={{verticalAlign: 'text-top'}} size="14px" />
-        )}
-        {isBitbucket(repository.provider.id) && (
-          <InlineSvg
-            src="icon-bitbucket"
-            style={{verticalAlign: 'text-top'}}
-            size="14px"
-          />
-        )}
-        &nbsp;
-        {inline ? '' : ' '}
-        {shortId}
-      </a>
-    ) : (
-      <span>{shortId}</span>
-    );
-  }
+  return !inline ? (
+    <Button external href={commitUrl} size="small" icon={providerData.icon}>
+      {shortId}
+    </Button>
+  ) : (
+    <ExternalLink className="inline-commit" href={commitUrl}>
+      <CommitIcon src={providerData.icon} />
+      {' ' + shortId}
+    </ExternalLink>
+  );
 }
 
+CommitLink.propTypes = {
+  commitId: PropTypes.string,
+  repository: PropTypes.object,
+  inline: PropTypes.bool,
+};
+
+const CommitIcon = styled(p => (
+  <InlineSvg size="14px" src={p.src} className={p.className} />
+))`
+  vertical-align: text-top;
+  margin-top: 2px;
+`;
+
 export default CommitLink;
