commit 78fbb1ddbcb89426d13a5a8b19b180b34190565c
Author: Max Bittker <maxbittker@gmail.com>
Date:   Wed Nov 2 10:13:46 2016 -0700

    catch invalid query in related event view (#4465)

diff --git a/src/sentry/api/endpoints/group_events.py b/src/sentry/api/endpoints/group_events.py
index 01f8327272..cc10af12a2 100644
--- a/src/sentry/api/endpoints/group_events.py
+++ b/src/sentry/api/endpoints/group_events.py
@@ -13,6 +13,8 @@ from sentry.api.paginator import DateTimePaginator
 from sentry.models import Event, EventTag, Group, TagKey, TagValue
 from sentry.search.utils import parse_query
 from sentry.utils.apidocs import scenario, attach_scenarios
+from rest_framework.response import Response
+from sentry.search.utils import InvalidQuery
 
 
 @scenario('ListAvailableSamples')
@@ -94,7 +96,10 @@ class GroupEventsEndpoint(GroupEndpoint):
 
         query = request.GET.get('query')
         if query:
-            query_kwargs = parse_query(group.project, query, request.user)
+            try:
+                query_kwargs = parse_query(group.project, query, request.user)
+            except InvalidQuery as exc:
+                return Response({'detail': six.text_type(exc)}, status=400)
 
             if query_kwargs['query']:
                 events = events.filter(
diff --git a/src/sentry/static/sentry/app/views/groupEvents.jsx b/src/sentry/static/sentry/app/views/groupEvents.jsx
index 3c4b5e9abb..afca0fee13 100644
--- a/src/sentry/static/sentry/app/views/groupEvents.jsx
+++ b/src/sentry/static/sentry/app/views/groupEvents.jsx
@@ -82,9 +82,11 @@ const GroupEvents = React.createClass({
           pageLinks: jqXHR.getResponseHeader('Link')
         });
       },
-      error: (error) => {
+      error: (err) => {
+        let error = err.responseJSON || true;
+        error = error.detail || true;
         this.setState({
-          error: true,
+          error,
           loading: false
         });
       }
@@ -215,7 +217,7 @@ const GroupEvents = React.createClass({
     if (this.state.loading)
       body = <LoadingIndicator />;
     else if (this.state.error)
-      body = <LoadingError onRetry={this.fetchData} />;
+      body = <LoadingError message={this.state.error} onRetry={this.fetchData} />;
     else if (this.state.eventList.length > 0)
       body = this.renderResults();
     else if (this.state.query && this.state.query !== '')
