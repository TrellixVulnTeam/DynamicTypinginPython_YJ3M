commit 8488b44469b48d40bf9be55bc277b67f03167cbd
Author: Billy Vong <billyvg@gmail.com>
Date:   Thu Aug 3 13:35:53 2017 -0700

    Change grouping threshold
    
    No longer an average, but only display issues where any of the scores
    are higher than min. score (0.6)

diff --git a/src/sentry/static/sentry/app/stores/groupingStore.jsx b/src/sentry/static/sentry/app/stores/groupingStore.jsx
index af84f1c499..b87368fff1 100644
--- a/src/sentry/static/sentry/app/stores/groupingStore.jsx
+++ b/src/sentry/static/sentry/app/stores/groupingStore.jsx
@@ -8,15 +8,12 @@ import GroupingActions from '../actions/groupingActions';
 const api = new Client();
 
 // Between 0-100
-const SIMILARITY_THRESHOLD = 50;
+const MIN_SCORE = 0.60;
 
 // @param score: {[key: string]: number}
-const getAvgScore = score => {
-  let scoreKeys = (score && Object.keys(score)) || [];
-  return Math.round(
-    scoreKeys.map(key => score[key]).reduce((acc, s) => acc + s * 100, 0) /
-      scoreKeys.length
-  );
+const checkBelowThreshold = scores => {
+  let scoreKeys = (scores && Object.keys(scores)) || [];
+  return !scoreKeys.map(key => scores[key]).find(score => score >= MIN_SCORE);
 };
 
 const GroupingStore = Reflux.createStore({
@@ -132,14 +129,12 @@ const GroupingStore = Reflux.createStore({
         return item;
       },
       similar: ([issue, score]) => {
-        // Hide items with a low average score
-        let avgScore = getAvgScore(score);
-        let isBelowThreshold = avgScore < SIMILARITY_THRESHOLD;
+        // Hide items with a low scores
+        let isBelowThreshold = checkBelowThreshold(score);
 
         return {
           issue,
           score,
-          avgScore,
           isBelowThreshold
         };
       }
diff --git a/tests/js/spec/stores/groupingStore.spec.jsx b/tests/js/spec/stores/groupingStore.spec.jsx
index 6dbb80f9e8..e8f1b9b06d 100644
--- a/tests/js/spec/stores/groupingStore.spec.jsx
+++ b/tests/js/spec/stores/groupingStore.spec.jsx
@@ -67,7 +67,7 @@ describe('Grouping Store', function() {
           {
             'exception:stacktrace:pairs': 0.375,
             'exception:stacktrace:application-chunks': 0.175,
-            'message:message:character-shingles': 0.675
+            'message:message:character-shingles': 0.775
           }
         ],
         [
@@ -123,8 +123,8 @@ describe('Grouping Store', function() {
       let calls = trigger.mock.calls;
       let arg = calls[calls.length - 1][0];
 
-      expect(arg.filteredSimilarItems.length).toBe(2);
-      expect(arg.similarItems.length).toBe(1);
+      expect(arg.filteredSimilarItems.length).toBe(1);
+      expect(arg.similarItems.length).toBe(2);
       expect(arg).toMatchObject({
         loading: false,
         error: false,
@@ -132,7 +132,12 @@ describe('Grouping Store', function() {
         mergedItems: [],
         similarItems: [
           {
-            avgScore: 100,
+            isBelowThreshold: false,
+            issue: {
+              id: '274'
+            }
+          },
+          {
             isBelowThreshold: false,
             issue: {
               id: '275'
@@ -141,14 +146,6 @@ describe('Grouping Store', function() {
         ],
         filteredSimilarItems: [
           {
-            avgScore: 41,
-            isBelowThreshold: true,
-            issue: {
-              id: '274'
-            }
-          },
-          {
-            avgScore: 0,
             isBelowThreshold: true,
             issue: {
               id: '216'
