commit 043264ea5e142ce057f9f4e9a74edbbf6a5c9d82
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Fri Dec 7 11:33:01 2018 -0800

    fix(api): Handle no projects in tag key values endpoint

diff --git a/src/sentry/api/endpoints/organization_tagkey_values.py b/src/sentry/api/endpoints/organization_tagkey_values.py
index 5e7b2d5cf6..1c258a9e58 100644
--- a/src/sentry/api/endpoints/organization_tagkey_values.py
+++ b/src/sentry/api/endpoints/organization_tagkey_values.py
@@ -2,7 +2,8 @@ from __future__ import absolute_import
 
 from rest_framework.response import Response
 
-from sentry.api.bases import OrganizationEventsEndpointBase, OrganizationEventsError
+from sentry.api.bases import OrganizationEventsEndpointBase, OrganizationEventsError, NoProjects
+from sentry.api.paginator import SequencePaginator
 from sentry.api.serializers import serialize
 from sentry.tagstore.base import TAG_KEY_RE
 from sentry.tagstore.snuba.backend import SnubaTagStorage
@@ -18,18 +19,20 @@ class OrganizationTagKeyValuesEndpoint(OrganizationEventsEndpointBase):
             filter_params = self.get_filter_params(request, organization)
         except OrganizationEventsError as exc:
             return Response({'detail': exc.message}, status=400)
-
-        # TODO(jess): update this when snuba tagstore is the primary backend for us
-        tagstore = SnubaTagStorage()
-
-        paginator = tagstore.get_tag_value_paginator_for_projects(
-            filter_params['project_id'],
-            filter_params.get('environment'),
-            key,
-            filter_params['start'],
-            filter_params['end'],
-            query=request.GET.get('query'),
-        )
+        except NoProjects:
+            paginator = SequencePaginator([])
+        else:
+            # TODO(jess): update this when snuba tagstore is the primary backend for us
+            tagstore = SnubaTagStorage()
+
+            paginator = tagstore.get_tag_value_paginator_for_projects(
+                filter_params['project_id'],
+                filter_params.get('environment'),
+                key,
+                filter_params['start'],
+                filter_params['end'],
+                query=request.GET.get('query'),
+            )
 
         return self.paginate(
             request=request,
diff --git a/tests/snuba/api/endpoints/test_organization_tagkey_values.py b/tests/snuba/api/endpoints/test_organization_tagkey_values.py
index 23f5aeb5cf..6b5074b152 100644
--- a/tests/snuba/api/endpoints/test_organization_tagkey_values.py
+++ b/tests/snuba/api/endpoints/test_organization_tagkey_values.py
@@ -201,3 +201,19 @@ class OrganizationTagKeyValuesTest(APITestCase, SnubaTestCase):
 
         response = self.client.get(url, format='json')
         assert response.status_code == 200, response.content
+
+    def test_no_projects(self):
+        user = self.create_user()
+        org = self.create_organization(owner=user)
+        self.login_as(user=user)
+        url = reverse(
+            'sentry-api-0-organization-tagkey-values',
+            kwargs={
+                'organization_slug': org.slug,
+                'key': 'fruit',
+            }
+        )
+
+        response = self.client.get(url, format='json')
+        assert response.status_code == 200, response.content
+        assert len(response.data) == 0
