commit dbf9e76eb3bba531e2729d623cd91d41d111ded9
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Mon Jun 3 12:30:13 2019 -0700

    feat(ui): Disable pin when there is no query (#13489)
    
    Disable pinning a search and creating a new org search when there is no query
    
    Fixes JAVASCRIPT-VH0

diff --git a/src/sentry/static/sentry/app/components/smartSearchBar/index.jsx b/src/sentry/static/sentry/app/components/smartSearchBar/index.jsx
index e04843543a..fc3bce9047 100644
--- a/src/sentry/static/sentry/app/components/smartSearchBar/index.jsx
+++ b/src/sentry/static/sentry/app/components/smartSearchBar/index.jsx
@@ -732,6 +732,7 @@ class SmartSearchBar extends React.Component {
 
     const pinTooltip = !!pinnedSearch ? t('Unpin this search') : t('Pin this search');
     const pinIconSrc = !!pinnedSearch ? 'icon-pin-filled' : 'icon-pin';
+    const hasQuery = !!this.state.query;
 
     if (hasPinnedSearch) {
       return (
@@ -768,11 +769,13 @@ class SmartSearchBar extends React.Component {
             <CreateSavedSearchButton
               query={this.state.query}
               organization={organization}
+              disabled={!hasQuery}
             />
             <Button
               type="button"
               title={pinTooltip}
               borderless
+              disabled={!hasQuery}
               aria-label={pinTooltip}
               size="zero"
               onClick={this.onTogglePinnedSearch}
diff --git a/tests/js/spec/components/smartSearchBar.spec.jsx b/tests/js/spec/components/smartSearchBar.spec.jsx
index 5baa75e451..a01e58261b 100644
--- a/tests/js/spec/components/smartSearchBar.spec.jsx
+++ b/tests/js/spec/components/smartSearchBar.spec.jsx
@@ -450,6 +450,26 @@ describe('SmartSearchBar', function() {
       });
     });
 
+    it('does not pin when query is empty', async function() {
+      const wrapper = mount(
+        <SmartSearchBar
+          api={new Client()}
+          organization={organization}
+          orgId={organization.slug}
+          projectId="456"
+          query=""
+          supportedTags={supportedTags}
+          savedSearchType={0}
+          hasPinnedSearch
+        />,
+        options
+      );
+      wrapper.find('button[aria-label="Pin this search"]').simulate('click');
+      await wrapper.update();
+
+      expect(pinRequest).not.toHaveBeenCalled();
+    });
+
     it('adds pins', async function() {
       const wrapper = mount(
         <SmartSearchBar
