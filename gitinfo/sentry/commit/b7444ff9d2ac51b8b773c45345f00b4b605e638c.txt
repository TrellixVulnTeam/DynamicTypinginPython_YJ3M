commit b7444ff9d2ac51b8b773c45345f00b4b605e638c
Author: David Cramer <dcramer@David-Cramers-MacBook.local>
Date:   Mon Nov 9 16:37:13 2009 -0600

    only return instance when it's available

diff --git a/djangodblog/manager.py b/djangodblog/manager.py
index d513b198a8..88c18882f4 100644
--- a/djangodblog/manager.py
+++ b/djangodblog/manager.py
@@ -118,4 +118,5 @@ class DBLogManager(models.Manager):
                 batch.save()
         except Exception, exc:
             warnings.warn(smart_unicode(exc))
-        return instance
\ No newline at end of file
+        else:
+            return instance
\ No newline at end of file
diff --git a/djangodblog/tests.py b/djangodblog/tests.py
index 4a1c833a7f..c31d406408 100644
--- a/djangodblog/tests.py
+++ b/djangodblog/tests.py
@@ -26,6 +26,9 @@ class RequestFactory(Client):
 RF = RequestFactory()
 
 class DBLogTestCase(TestCase):
+    def setUp(self):
+        settings.DBLOG_DATABASE = None
+    
     def testMiddleware(self):
         request = RF.get("/", REMOTE_ADDR="127.0.0.1:8000")
 
@@ -76,4 +79,4 @@ class DBLogTestCase(TestCase):
         cur = (Error.objects.count()-1, ErrorBatch.objects.count()-1)
         self.assertEquals(cur, ttl, 'Counts do not match. Assumed logs failed to save. %s != %s' % (cur, ttl))
 
-        settings.DBLOG_DATABASE = None        
\ No newline at end of file
+        settings.DBLOG_DATABASE = None
\ No newline at end of file
