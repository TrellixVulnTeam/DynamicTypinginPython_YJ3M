commit db68787c66bc193a0655d7422e8701964d9cc628
Author: Alex Hofsteede <alex@hofsteede.com>
Date:   Wed Jan 10 10:10:16 2018 +1300

    fix: Allow extra keys in CSP reports (#6926)
    
    Because the schema did not allow additional keys in CSP reports,
    and at least Chrome has started adding a 'disposition' field to these
    reports, causing them to be rejected.
    
    Also just allow all extra fields so we don't start failing any time
    a browser adds a new value to CSP reports.

diff --git a/src/sentry/interfaces/schemas.py b/src/sentry/interfaces/schemas.py
index 79bffda7dc..b5b70c803c 100644
--- a/src/sentry/interfaces/schemas.py
+++ b/src/sentry/interfaces/schemas.py
@@ -439,9 +439,12 @@ CSP_SCHEMA = {
                 'line-number': {'type': 'number'},
                 'column-number': {'type': 'number'},
                 'script-sample': {'type': 'number'},  # Firefox specific key.
+                'disposition': {'type': 'string'},
             },
             'required': ['effective-directive'],
-            'additionalProperties': False,  # Don't allow any other keys.
+            # Allow additional keys as browser vendors are still changing CSP
+            # implementations fairly frequently
+            'additionalProperties': True,
         }
     },
     'required': ['csp-report'],
diff --git a/tests/sentry/web/api/tests.py b/tests/sentry/web/api/tests.py
index e99bb741d4..3a9a916114 100644
--- a/tests/sentry/web/api/tests.py
+++ b/tests/sentry/web/api/tests.py
@@ -68,6 +68,7 @@ class SecurityReportCspTest(TestCase):
                 'source-file': 'http://example.com',
                 'effective-directive': 'style-src',
                 'violated-directive': 'style-src',
+                'disposition': 'enforce',
             }
         )
         assert resp.status_code == 201, resp.content
