commit 0ae90d323ecb06385595d9e1e84108f6191037aa
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Sep 15 15:25:32 2015 -0700

    Fixed two small in login redirect handling with more complex redirect urls.

diff --git a/src/sentry/utils/auth.py b/src/sentry/utils/auth.py
index 52e07e988d..87a30ad0c6 100644
--- a/src/sentry/utils/auth.py
+++ b/src/sentry/utils/auth.py
@@ -26,10 +26,11 @@ def get_auth_providers():
     ]
 
 
-def get_login_redirect(request):
-    default = reverse('sentry')
+def get_login_redirect(request, default=None):
+    if default is None:
+        default = reverse('sentry')
     login_url = request.session.pop('_next', None) or default
-    if '//' in login_url:
+    if login_url.startswith(('http://', 'https://')):
         login_url = default
     elif login_url.startswith(reverse('sentry-login')):
         login_url = default
diff --git a/src/sentry/web/frontend/auth_login.py b/src/sentry/web/frontend/auth_login.py
index 90f1a87dd6..07bf419a97 100644
--- a/src/sentry/web/frontend/auth_login.py
+++ b/src/sentry/web/frontend/auth_login.py
@@ -1,4 +1,4 @@
-from __future__ import absolute_import, print_function
+from __future__ import absolute_import
 
 from django.conf import settings
 from django.contrib import messages
diff --git a/src/sentry/web/frontend/auth_logout.py b/src/sentry/web/frontend/auth_logout.py
index 60d138d22b..c8e3fd5594 100644
--- a/src/sentry/web/frontend/auth_logout.py
+++ b/src/sentry/web/frontend/auth_logout.py
@@ -1,17 +1,17 @@
-from __future__ import absolute_import, print_function
+from __future__ import absolute_import
 
-from django.core.urlresolvers import reverse
 from django.contrib.auth import logout
 
 from sentry.models import AnonymousUser
 from sentry.web.frontend.base import BaseView
+from sentry.utils.auth import get_login_redirect
 
 
 class AuthLogoutView(BaseView):
     auth_required = False
 
     def handle(self, request):
+        rv = get_login_redirect(request)
         logout(request)
         request.user = AnonymousUser()
-
-        return self.redirect(reverse('sentry'))
+        return self.redirect(rv)
