commit 9b0088a1b942da63089daf61c99e16796b4b54c9
Author: Mark Story <mark@mark-story.com>
Date:   Thu Feb 14 10:08:07 2019 -0500

    fix(deploys) Fix 500 when deploying releases with long names (#12052)
    
    When deploying a release with a long version number we would respond
    with a 500 as the `sentry_activity.ident` column would overflow. In
    other places where we create activity for releases we truncate the
    ident value with this same function.
    
    Fixes APP-1119

diff --git a/src/sentry/models/deploy.py b/src/sentry/models/deploy.py
index 7632b371d2..df61072f79 100644
--- a/src/sentry/models/deploy.py
+++ b/src/sentry/models/deploy.py
@@ -77,7 +77,7 @@ class Deploy(Model):
                 activity = Activity.objects.create(
                     type=Activity.DEPLOY,
                     project=project,
-                    ident=release.version,
+                    ident=Activity.get_version_ident(release.version),
                     data={
                         'version': release.version,
                         'deploy_id': deploy.id,
diff --git a/tests/sentry/models/test_deploy.py b/tests/sentry/models/test_deploy.py
index 485f4edeef..a5fb1ba58b 100644
--- a/tests/sentry/models/test_deploy.py
+++ b/tests/sentry/models/test_deploy.py
@@ -6,6 +6,32 @@ from sentry.testutils import TestCase
 
 
 class DeployNotifyTest(TestCase):
+    def test_notify_if_ready_long_release(self):
+        org = self.create_organization()
+        project = self.create_project(organization=org)
+        release = Release.objects.create(
+            version='a' * 200,
+            organization=org,
+        )
+        release.add_project(project)
+        env = Environment.objects.create(
+            name='production',
+            organization_id=org.id,
+        )
+        deploy = Deploy.objects.create(
+            release=release,
+            organization_id=org.id,
+            environment_id=env.id,
+        )
+        Deploy.notify_if_ready(deploy.id)
+
+        # make sure activity has been created
+        record = Activity.objects.get(
+            type=Activity.DEPLOY,
+            project=project,
+        )
+        assert release.version.startswith(record.ident)
+
     def test_already_notified(self):
         org = self.create_organization()
         project = self.create_project(organization=org)
