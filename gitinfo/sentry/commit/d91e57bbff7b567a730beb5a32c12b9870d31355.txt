commit d91e57bbff7b567a730beb5a32c12b9870d31355
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Mon Apr 16 10:26:52 2018 -0700

    ref(js): üèãÔ∏è‚Äç‚ôÄÔ∏èjest errors/warnings (#8045)
    
    * Silence "plugin loaded" console spam
    * use enzyme for Frame test
    * fix invalid props in TeamProjects
    * add key for tooltip
    * formfield.label can be "node"
    * add getEndpoints to avoid deprecation call
    * org repos expects id
    * satisfy required prop
    * fix adminSettings deprecation warnings
    * fix apiNewToken deprecation warnings
    * add mock responses

diff --git a/src/sentry/static/sentry/app/components/events/interfaces/frame.jsx b/src/sentry/static/sentry/app/components/events/interfaces/frame.jsx
index 3ef5478c51..0603484601 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/frame.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/frame.jsx
@@ -206,7 +206,11 @@ const Frame = createReactClass({
 
     if (defined(data.origAbsPath)) {
       title.push(
-        <Tooltip title={this.renderOriginalSourceInfo()} tooltipOptions={{html: true}}>
+        <Tooltip
+          key="info-tooltip"
+          title={this.renderOriginalSourceInfo()}
+          tooltipOptions={{html: true}}
+        >
           <a className="in-at original-src">
             <span className="icon-question" />
           </a>
diff --git a/src/sentry/static/sentry/app/components/forms/formField.jsx b/src/sentry/static/sentry/app/components/forms/formField.jsx
index 90c4dfda62..105c0238b2 100644
--- a/src/sentry/static/sentry/app/components/forms/formField.jsx
+++ b/src/sentry/static/sentry/app/components/forms/formField.jsx
@@ -18,7 +18,7 @@ export default class FormField extends React.PureComponent {
     /** Inline style */
     style: PropTypes.object,
 
-    label: PropTypes.string,
+    label: PropTypes.node,
 
     // This is actually used but eslint doesn't parse it correctly
     // eslint-disable-next-line react/no-unused-prop-types
diff --git a/src/sentry/static/sentry/app/views/adminSettings.jsx b/src/sentry/static/sentry/app/views/adminSettings.jsx
index 0d9ed9219e..74623be802 100644
--- a/src/sentry/static/sentry/app/views/adminSettings.jsx
+++ b/src/sentry/static/sentry/app/views/adminSettings.jsx
@@ -20,6 +20,10 @@ const optionsAvailable = [
 ];
 
 export default class AdminSettings extends AsyncView {
+  getEndpoints() {
+    return [['data', this.getEndpoint()]];
+  }
+
   getEndpoint() {
     return '/internal/options/';
   }
diff --git a/src/sentry/static/sentry/app/views/apiNewToken.jsx b/src/sentry/static/sentry/app/views/apiNewToken.jsx
index 66ecfcc7b8..b7b09c629c 100644
--- a/src/sentry/static/sentry/app/views/apiNewToken.jsx
+++ b/src/sentry/static/sentry/app/views/apiNewToken.jsx
@@ -11,6 +11,10 @@ const SORTED_DEFAULT_API_SCOPES = DEFAULT_API_SCOPES.sort();
 const API_CHOICES = API_SCOPES.map(s => [s, s]);
 
 export default class ApiNewToken extends AsyncView {
+  getEndpoints() {
+    return [];
+  }
+
   getTitle() {
     return 'Create API Token';
   }
diff --git a/src/sentry/static/sentry/app/views/organizationCreate.jsx b/src/sentry/static/sentry/app/views/organizationCreate.jsx
index 779203b9c5..528cc5109e 100644
--- a/src/sentry/static/sentry/app/views/organizationCreate.jsx
+++ b/src/sentry/static/sentry/app/views/organizationCreate.jsx
@@ -13,6 +13,10 @@ export default class OrganizationCreate extends AsyncView {
     window.location.href = `/organizations/${data.slug}/projects/new/`;
   };
 
+  getEndpoints() {
+    return [];
+  }
+
   getTitle() {
     return 'Create Organization';
   }
diff --git a/src/sentry/static/sentry/app/views/projectChooser.jsx b/src/sentry/static/sentry/app/views/projectChooser.jsx
index 591bdad6d9..78559ffad4 100644
--- a/src/sentry/static/sentry/app/views/projectChooser.jsx
+++ b/src/sentry/static/sentry/app/views/projectChooser.jsx
@@ -66,7 +66,7 @@ const ProjectChooser = createReactClass({
           <PanelHeader hasButtons>{t('Projects')}</PanelHeader>
           <PanelBody css={{width: '100%'}}>
             {sortProjects(org.projects).map((project, i) => (
-              <PanelItem p={0} key={project.id} align="center">
+              <PanelItem p={0} key={project.slug} align="center">
                 <Box p={2} flex="1">
                   <Link
                     to={`/${org.slug}/${project.slug}/${task.location}`}
diff --git a/src/sentry/static/sentry/app/views/settings/organization/repositories/organizationRepositories.jsx b/src/sentry/static/sentry/app/views/settings/organization/repositories/organizationRepositories.jsx
index 4647fc37bb..ecb89eef90 100644
--- a/src/sentry/static/sentry/app/views/settings/organization/repositories/organizationRepositories.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organization/repositories/organizationRepositories.jsx
@@ -56,11 +56,6 @@ class OrganizationRepositories extends React.Component {
     let {orgId} = params;
     let hasItemList = itemList && itemList.length > 0;
 
-    // let action = (
-    //   <Button priority="link" onClick={onAddRepo}>
-    //   </Button>
-    // );
-
     return (
       <div>
         <SettingsPageHeader
diff --git a/src/sentry/static/sentry/app/views/settings/team/teamProjects.jsx b/src/sentry/static/sentry/app/views/settings/team/teamProjects.jsx
index c895b09e2a..0945c17eed 100644
--- a/src/sentry/static/sentry/app/views/settings/team/teamProjects.jsx
+++ b/src/sentry/static/sentry/app/views/settings/team/teamProjects.jsx
@@ -127,7 +127,7 @@ const TeamProjects = createReactClass({
 
     return (
       <Panel>
-        <PanelHeader hasButtons={true} alignItems="center" justifyContent="space-between">
+        <PanelHeader hasButtons={true}>
           <div>{t('Projects')}</div>
           <div style={{textTransform: 'none'}}>
             <DropdownAutoComplete
diff --git a/tests/js/spec/components/__snapshots__/streamGroup.spec.jsx.snap b/tests/js/spec/components/__snapshots__/streamGroup.spec.jsx.snap
index bd3750419e..bda680f88a 100644
--- a/tests/js/spec/components/__snapshots__/streamGroup.spec.jsx.snap
+++ b/tests/js/spec/components/__snapshots__/streamGroup.spec.jsx.snap
@@ -62,6 +62,7 @@ exports[`StreamGroup renders with anchors 1`] = `
             ],
           },
           "tags": Array [],
+          "type": "error",
         }
       }
       includeLink={true}
@@ -106,6 +107,7 @@ exports[`StreamGroup renders with anchors 1`] = `
         }
       }
       tags={Array []}
+      type="error"
     />
   </GroupSummary>
   <Box
@@ -145,6 +147,7 @@ exports[`StreamGroup renders with anchors 1`] = `
             ],
           },
           "tags": Array [],
+          "type": "error",
         }
       }
       id="1337"
diff --git a/tests/js/spec/components/assistant/helper.spec.jsx b/tests/js/spec/components/assistant/helper.spec.jsx
index e0817dc859..f9df9aa65a 100644
--- a/tests/js/spec/components/assistant/helper.spec.jsx
+++ b/tests/js/spec/components/assistant/helper.spec.jsx
@@ -6,6 +6,12 @@ import {shallow, mount} from 'enzyme';
 import AssistantHelper from 'app/components/assistant/helper';
 
 describe('Helper', function() {
+  beforeEach(function() {
+    MockApiClient.addMockResponse({
+      url: '/assistant/',
+    });
+  });
+
   it('renders cue', function() {
     let wrapper = shallow(<AssistantHelper />);
     expect(wrapper).toMatchSnapshot();
diff --git a/tests/js/spec/components/events/interfaces/__snapshots__/frame.spec.jsx.snap b/tests/js/spec/components/events/interfaces/__snapshots__/frame.spec.jsx.snap
new file mode 100644
index 0000000000..a8a62c9562
--- /dev/null
+++ b/tests/js/spec/components/events/interfaces/__snapshots__/frame.spec.jsx.snap
@@ -0,0 +1,7 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`Frame renderOriginalSourceInfo() should render the source map information as a HTML string 1`] = `
+"
+    <div>
+      <strong>Source Map</strong><br/>https://beta.getsentry.com/_static/sentry/dist/vendor.js.map<br/></div>"
+`;
diff --git a/tests/js/spec/components/events/interfaces/frame.spec.jsx b/tests/js/spec/components/events/interfaces/frame.spec.jsx
index d8d1c65e6e..4c28723283 100644
--- a/tests/js/spec/components/events/interfaces/frame.spec.jsx
+++ b/tests/js/spec/components/events/interfaces/frame.spec.jsx
@@ -1,24 +1,11 @@
 import React from 'react';
-import TestUtils from 'react-dom/test-utils';
+import {shallow} from 'enzyme';
 
 import Frame from 'app/components/events/interfaces/frame';
-import FrameVariables from 'app/components/events/interfaces/frameVariables';
-
-import stubReactComponents from '../../../../helpers/stubReactComponent';
 
 describe('Frame', function() {
-  let sandbox;
   let data;
 
-  beforeEach(function() {
-    sandbox = sinon.sandbox.create();
-    stubReactComponents(sandbox, [FrameVariables]);
-  });
-
-  afterEach(function() {
-    sandbox.restore();
-  });
-
   describe('renderOriginalSourceInfo()', function() {
     beforeEach(function() {
       data = {
@@ -33,12 +20,9 @@ describe('Frame', function() {
     });
 
     it('should render the source map information as a HTML string', function() {
-      let frame = TestUtils.renderIntoDocument(<Frame data={data} />);
+      let frame = shallow(<Frame data={data} />);
 
-      // NOTE: indentation/whitespace intentional to match output string
-      expect(frame.renderOriginalSourceInfo()).toEqual(
-        '\n    <div>\n      <strong>Source Map</strong><br/>https://beta.getsentry.com/_static/sentry/dist/vendor.js.map<br/></div>'
-      );
+      expect(frame.find('Tooltip').prop('title')).toMatchSnapshot();
     });
   });
 });
diff --git a/tests/js/spec/components/streamGroup.spec.jsx b/tests/js/spec/components/streamGroup.spec.jsx
index 124be91c0f..4843c9e327 100644
--- a/tests/js/spec/components/streamGroup.spec.jsx
+++ b/tests/js/spec/components/streamGroup.spec.jsx
@@ -18,6 +18,7 @@ describe('StreamGroup', function() {
         id: '13',
         slug: 'test',
       },
+      type: 'error',
     });
     sandbox.stub(GroupStore, 'get').returns(GROUP_1);
   });
diff --git a/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
index cdc641e94c..f0d2f72209 100644
--- a/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationRepositories.spec.jsx.snap
@@ -30,6 +30,7 @@ exports[`OrganizationRepositories renders with a repository 1`] = `
                     "type": "text",
                   },
                 ],
+                "id": "github",
                 "key": "github",
                 "name": "GitHub",
               }
@@ -147,6 +148,7 @@ exports[`OrganizationRepositories renders with github provider 1`] = `
                     "type": "text",
                   },
                 ],
+                "id": "github",
                 "key": "github",
                 "name": "GitHub",
               }
diff --git a/tests/js/spec/views/__snapshots__/organizationTeamProjects.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationTeamProjects.spec.jsx.snap
index 76d866575a..be49bb4f92 100644
--- a/tests/js/spec/views/__snapshots__/organizationTeamProjects.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationTeamProjects.spec.jsx.snap
@@ -15,40 +15,28 @@ exports[`OrganizationTeamProjects Should render 1`] = `
         className="css-wfa8ap-StyledPanel css-5bw71w0"
       >
         <PanelHeader
-          alignItems="center"
           hasButtons={true}
-          justifyContent="space-between"
         >
           <StyledPanelHeader
-            alignItems="center"
             hasButtons={true}
-            justifyContent="space-between"
           >
             <Component
-              alignItems="center"
               className="css-vzwv85-StyledPanelHeader css-1t1cqk30"
               hasButtons={true}
-              justifyContent="space-between"
             >
               <Flex
                 align="center"
-                alignItems="center"
                 className="css-vzwv85-StyledPanelHeader css-1t1cqk30"
                 justify="space-between"
-                justifyContent="space-between"
               >
                 <Base
                   align="center"
-                  alignItems="center"
                   className="css-1t1cqk30 css-1h9uuh9"
                   justify="space-between"
-                  justifyContent="space-between"
                 >
                   <div
-                    alignItems="center"
                     className="css-1t1cqk30 css-1h9uuh9"
                     is={null}
-                    justifyContent="space-between"
                   >
                     <div>
                       Projects
@@ -214,19 +202,19 @@ exports[`OrganizationTeamProjects Should render 1`] = `
               key="2"
             >
               <PanelItem
-                className="css-qjeif8-StyledPanelItem css-vc3zr81"
+                className="css-qjeif8-StyledPanelItem css-1cam9p51"
                 p={2}
               >
                 <StyledPanelItem
-                  className="css-qjeif8-StyledPanelItem css-vc3zr81"
+                  className="css-qjeif8-StyledPanelItem css-1cam9p51"
                   p={2}
                 >
                   <Base
-                    className="css-vc3zr81 css-1mlpbpg-StyledPanelItem css-q9h14u0"
+                    className="css-1cam9p51 css-1mlpbpg-StyledPanelItem css-q9h14u0"
                     p={2}
                   >
                     <div
-                      className="css-vc3zr81 css-1mlpbpg-StyledPanelItem css-q9h14u0"
+                      className="css-1cam9p51 css-1mlpbpg-StyledPanelItem css-q9h14u0"
                       is={null}
                     >
                       <ProjectItem
@@ -487,20 +475,20 @@ exports[`OrganizationTeamProjects Should render 1`] = `
                               >
                                 <RemoveIcon>
                                   <Component
-                                    className="css-1e2j5j0-RemoveIcon css-vc3zr80"
+                                    className="css-1e2j5j0-RemoveIcon css-1cam9p50"
                                   >
                                     <InlineSvg
-                                      className="css-1e2j5j0-RemoveIcon css-vc3zr80"
+                                      className="css-1e2j5j0-RemoveIcon css-1cam9p50"
                                       src="icon-circle-subtract"
                                     >
                                       <StyledSvg
-                                        className="css-1e2j5j0-RemoveIcon css-vc3zr80"
+                                        className="css-1e2j5j0-RemoveIcon css-1cam9p50"
                                         height="1em"
                                         viewBox={Object {}}
                                         width="1em"
                                       >
                                         <svg
-                                          className="css-vc3zr80 css-1jgfaio-StyledSvg css-adkcw30"
+                                          className="css-1cam9p50 css-1jgfaio-StyledSvg css-adkcw30"
                                           height="1em"
                                           viewBox={Object {}}
                                           width="1em"
diff --git a/tests/js/spec/views/__snapshots__/projectChooser.spec.jsx.snap b/tests/js/spec/views/__snapshots__/projectChooser.spec.jsx.snap
index 620d198fe1..9bf8d7d12d 100644
--- a/tests/js/spec/views/__snapshots__/projectChooser.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/projectChooser.spec.jsx.snap
@@ -21,6 +21,7 @@ exports[`ProjectChooser renders 1`] = `
     >
       <PanelItem
         align="center"
+        key="test-project"
         p={0}
       >
         <Box
@@ -60,6 +61,7 @@ exports[`ProjectChooser renders 1`] = `
       </PanelItem>
       <PanelItem
         align="center"
+        key="another-project"
         p={0}
       >
         <Box
diff --git a/tests/js/spec/views/organizationRepositories.spec.jsx b/tests/js/spec/views/organizationRepositories.spec.jsx
index 320dca6791..9c5d98ac26 100644
--- a/tests/js/spec/views/organizationRepositories.spec.jsx
+++ b/tests/js/spec/views/organizationRepositories.spec.jsx
@@ -20,7 +20,7 @@ describe('OrganizationRepositories', function() {
     let wrapper = shallow(
       <OrganizationRepositories
         params={{orgId: 'org-slug'}}
-        repoConfig={{providers: [TestStubs.GitHubRepositoryProvider()]}}
+        repoConfig={{providers: [TestStubs.GitHubRepositoryProvider({id: 'github'})]}}
         itemList={[]}
       />
     );
@@ -35,7 +35,7 @@ describe('OrganizationRepositories', function() {
     let wrapper = shallow(
       <OrganizationRepositories
         params={{orgId: 'org-slug'}}
-        repoConfig={{providers: [TestStubs.GitHubRepositoryProvider()]}}
+        repoConfig={{providers: [TestStubs.GitHubRepositoryProvider({id: 'github'})]}}
         itemList={[TestStubs.Repository()]}
       />
     );
diff --git a/tests/js/spec/views/organizationTeamsProjects.spec.jsx b/tests/js/spec/views/organizationTeamsProjects.spec.jsx
index bb2724f75c..7f20fce621 100644
--- a/tests/js/spec/views/organizationTeamsProjects.spec.jsx
+++ b/tests/js/spec/views/organizationTeamsProjects.spec.jsx
@@ -20,6 +20,9 @@ describe('OrganizationTeamProjects', function() {
     });
 
     ProjectsStore.loadInitialData([project, project2]);
+    MockApiClient.addMockResponse({
+      url: '/organizations/org-slug/stats/',
+    });
   });
 
   it('Should render', function() {
diff --git a/tests/js/spec/views/projectPluginDetails.spec.jsx b/tests/js/spec/views/projectPluginDetails.spec.jsx
index 288e117efe..646080d815 100644
--- a/tests/js/spec/views/projectPluginDetails.spec.jsx
+++ b/tests/js/spec/views/projectPluginDetails.spec.jsx
@@ -16,6 +16,10 @@ describe('ProjectPluginDetails', function() {
   let plugin = TestStubs.Plugin();
   let pluginId = plugin.id;
 
+  beforeAll(function() {
+    sinon.stub(console, 'info');
+  });
+
   beforeEach(function() {
     MockApiClient.addMockResponse({
       url: `/projects/${org.slug}/${project.slug}/plugins/`,
@@ -62,6 +66,11 @@ describe('ProjectPluginDetails', function() {
     );
   });
 
+  afterAll(function() {
+    // eslint-disable-next-line no-console
+    console.info.restore();
+  });
+
   it('renders', function() {
     expect(component).toMatchSnapshot();
   });
diff --git a/tests/js/spec/views/teamMembers.spec.jsx b/tests/js/spec/views/teamMembers.spec.jsx
index bc21aa0090..f98581a025 100644
--- a/tests/js/spec/views/teamMembers.spec.jsx
+++ b/tests/js/spec/views/teamMembers.spec.jsx
@@ -14,6 +14,12 @@ describe('TeamMembers', function() {
     team = TestStubs.Team();
     members = TestStubs.Members();
 
+    Client.clearMockResponses();
+    Client.addMockResponse({
+      url: `/organizations/${org.slug}/members/`,
+      method: 'GET',
+      body: members,
+    });
     Client.addMockResponse({
       url: `/teams/${org.slug}/${team.slug}/members/`,
       method: 'GET',
