commit 79c3dae94117d04681ef51b9317a6a5348d6a5dc
Author: Stephen Cefali <scefali@sentry.io>
Date:   Tue Apr 7 13:09:54 2020 -0700

    use lower case email for commit author (#18132)

diff --git a/src/sentry/models/commitauthor.py b/src/sentry/models/commitauthor.py
index 0af86424e2..624c2f7535 100644
--- a/src/sentry/models/commitauthor.py
+++ b/src/sentry/models/commitauthor.py
@@ -1,10 +1,19 @@
 from __future__ import absolute_import, print_function
 
 from django.db import models
+from sentry.db.models.manager import BaseManager
 
 from sentry.db.models import BoundedPositiveIntegerField, Model, sane_repr
 
 
+class CommitAuthorManager(BaseManager):
+    def get_or_create(self, organization_id, email, defaults, **kwargs):
+        # always use the lower case email
+        return super(CommitAuthorManager, self).get_or_create(
+            organization_id=organization_id, email=email.lower(), defaults=defaults, **kwargs
+        )
+
+
 class CommitAuthor(Model):
     __core__ = False
 
@@ -13,6 +22,8 @@ class CommitAuthor(Model):
     email = models.EmailField(max_length=75)
     external_id = models.CharField(max_length=164, null=True)
 
+    objects = CommitAuthorManager()
+
     class Meta:
         app_label = "sentry"
         db_table = "sentry_commitauthor"
diff --git a/tests/sentry/models/test_release.py b/tests/sentry/models/test_release.py
index 1d01ac383f..c80630922a 100644
--- a/tests/sentry/models/test_release.py
+++ b/tests/sentry/models/test_release.py
@@ -230,7 +230,7 @@ class SetCommitsTestCase(TestCase):
                 {
                     "id": "a" * 40,
                     "repository": repo.name,
-                    "author_email": "foo@example.com",
+                    "author_email": "Foo@example.com",  # throw in an upper case letter
                     "author_name": "foo bar baz",
                     "message": "i fixed a bug",
                 },
