commit 59be181e7ff05ce355f94abe79fd1c78a9c83b55
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Fri Nov 22 15:04:30 2019 +0100

    ref(relay): Set organization cache explicitly (#15777)

diff --git a/src/sentry/api/endpoints/relay_projectconfigs.py b/src/sentry/api/endpoints/relay_projectconfigs.py
index 5afa952f66..92dfcd3cea 100644
--- a/src/sentry/api/endpoints/relay_projectconfigs.py
+++ b/src/sentry/api/endpoints/relay_projectconfigs.py
@@ -60,7 +60,7 @@ class RelayProjectConfigsEndpoint(Endpoint):
 
         with Hub.current.start_span(op="relay_fetch_keys"):
             project_keys = {}
-            for key in ProjectKey.objects.get_many_from_cache(project_ids, key="project_id"):
+            for key in ProjectKey.objects.filter(project_id__in=project_ids):
                 project_keys.setdefault(key.project_id, []).append(key)
 
         metrics.timing("relay_project_configs.projects_requested", len(project_ids))
@@ -79,7 +79,10 @@ class RelayProjectConfigsEndpoint(Endpoint):
             if organization is None:
                 continue
 
+            # Try to prevent organization from being fetched again in quotas.
             project.organization = organization
+            project._organization_cache = organization
+
             org_opts = org_options.get(organization.id) or {}
 
             with Hub.current.start_span(op="get_config"):
