commit 08aa4df14290c814ec5d73b51579f4c26c682d7c
Author: Mark Story <mark@mark-story.com>
Date:   Mon Oct 29 20:47:50 2018 +0000

    fix(integrations) Use get() as Content-Type may not be set (#10309)
    
    During a demo we had an OAuth token exchange response not include
    a content-type header which resulted in a 500. We can work around that
    by using get()
    
    Fixes SENTRY-827
    Fixes APP-686

diff --git a/src/sentry/identity/oauth2.py b/src/sentry/identity/oauth2.py
index d72378c1a5..4650dd8b68 100644
--- a/src/sentry/identity/oauth2.py
+++ b/src/sentry/identity/oauth2.py
@@ -250,7 +250,7 @@ class OAuth2CallbackView(PipelineView):
         verify_ssl = pipeline.config.get('verify_ssl', True)
         req = safe_urlopen(self.access_token_url, data=data, verify_ssl=verify_ssl)
         body = safe_urlread(req)
-        if req.headers['Content-Type'].startswith('application/x-www-form-urlencoded'):
+        if req.headers.get('Content-Type', '').startswith('application/x-www-form-urlencoded'):
             return dict(parse_qsl(body))
         return json.loads(body)
 
