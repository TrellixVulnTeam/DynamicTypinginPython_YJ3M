commit 1842531bf4632220b0f57e8625dd8eeabeac2a3e
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 2 16:42:16 2015 -0800

    Initial work on stream pagination

diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index c75cf83118..edcb6654c5 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -117,11 +117,19 @@ class ProjectGroupIndexEndpoint(Endpoint):
         if query is not None:
             query_kwargs.update(parse_query(query, request.user))
 
-        results = list(search.query(**query_kwargs))
+        cursor_result = search.query(**query_kwargs)
 
-        GroupMeta.objects.populate_cache(results)
+        context = list(cursor_result)
 
-        return Response(serialize(results, request.user))
+        GroupMeta.objects.populate_cache(context)
+
+        response = Response(serialize(context, request.user))
+        response['Link'] = ', '.join([
+            self.build_cursor_link(request, 'previous', cursor_result.prev),
+            self.build_cursor_link(request, 'next', cursor_result.next),
+        ])
+
+        return response
 
     def put(self, request, project_id):
         """
diff --git a/src/sentry/static/sentry/app-react/components/stream.jsx b/src/sentry/static/sentry/app-react/components/stream.jsx
index 33ba34bc33..28a2eded55 100644
--- a/src/sentry/static/sentry/app-react/components/stream.jsx
+++ b/src/sentry/static/sentry/app-react/components/stream.jsx
@@ -6,6 +6,7 @@ var BarChart = require("./barChart");
 var Count = require("./count");
 var StreamActions = require('./streamActions');
 var StreamFilters = require('./streamFilters');
+var StreamPagination = require('./streamPagination');
 var TimeSince = require("./timeSince");
 
 var Aggregate = React.createClass({
@@ -83,7 +84,8 @@ var Stream = React.createClass({
     project: React.PropTypes.shape({
       id: React.PropTypes.string.isRequired
     }).isRequired,
-    initialQuery: React.PropTypes.string
+    initialQuery: React.PropTypes.string,
+    pageLinks: React.PropTypes.string
   },
   getInitialState: function() {
     return {
@@ -92,7 +94,8 @@ var Stream = React.createClass({
       multiSelected: false,
       anySelected: false,
       statsPeriod: '24h',
-      query: this.props.initialQuery
+      query: this.props.initialQuery,
+      pageLinks: this.props.pageLinks
     };
   },
   componentWillMount: function() {
@@ -269,6 +272,9 @@ var Stream = React.createClass({
         <ul className="group-list">
           {aggNodes}
         </ul>
+        <StreamPagination
+          aggList={this.state.aggList}
+          pageLinks={this.state.pageLinks} />
       </div>
     );
   }
diff --git a/src/sentry/static/sentry/app-react/components/streamPagination.jsx b/src/sentry/static/sentry/app-react/components/streamPagination.jsx
new file mode 100644
index 0000000000..33f97787d3
--- /dev/null
+++ b/src/sentry/static/sentry/app-react/components/streamPagination.jsx
@@ -0,0 +1,49 @@
+/*** @jsx React.DOM */
+var React = require("react");
+var $ = require("jquery");
+
+var utils = require("../utils");
+
+var StreamPagination = React.createClass({
+  propTypes: {
+    aggList: React.PropTypes.array.isRequired,
+    pageLinks: React.PropTypes.string.isRequired
+  },
+
+  render: function(){
+    if (this.props.aggList.length === 0) {
+      return <div />;
+    }
+
+    var links = utils.parseLinkHeader(this.props.pageLinks);
+
+    var previousPageClassName = 'btn btn-default btn-lg prev';
+    if (links.previous === '') {
+      previousPageClassName += ' disabled';
+    }
+
+    var nextPageClassName = 'btn btn-default btn-lg next';
+    if (links.next === '') {
+      nextPageClassName += ' disabled';
+    }
+
+    return (
+      <div className="stream-pagination">
+        <div className="btn-group pull-right">
+          <a className={previousPageClassName}
+             disabled={links.previous === ''}
+             href={links.previous}>
+            <span title="Previous" className="icon-arrow-left"></span>
+          </a>
+          <a className={nextPageClassName}
+             disabled={links.next === ''}
+             href={links.next}>
+            <span title="Next" className="icon-arrow-right"></span>
+          </a>
+        </div>
+      </div>
+    );
+  }
+});
+
+module.exports = StreamPagination;
diff --git a/src/sentry/static/sentry/app-react/utils.jsx b/src/sentry/static/sentry/app-react/utils.jsx
index 60689195fc..77e69c173f 100644
--- a/src/sentry/static/sentry/app-react/utils.jsx
+++ b/src/sentry/static/sentry/app-react/utils.jsx
@@ -22,6 +22,24 @@ var getQueryParams = function() {
   return vars;
 };
 
+var parseLinkHeader = function(header) {
+  if (header === null) {
+    return {};
+  }
+
+  var header_vals = header.split(','),
+      links = {};
+
+  header_vals.forEach(function(val){
+    var match = /<([^>]+)>; rel="([^"]+)"/g.exec(val);
+
+    links[match[2]] = match[1];
+  });
+
+  return links;
+};
+
 module.exports = {
-  getQueryParams: getQueryParams
+  getQueryParams: getQueryParams,
+  parseLinkHeader: parseLinkHeader
 };
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index cc722a4d49..f7a3e27644 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -10,7 +10,8 @@
       React.render(React.createFactory(Stream)({
         aggList: {% serialize event_list %},
         project: {% serialize project %},
-        initialQuery: {% serialize query %}
+        initialQuery: {% convert_to_json query %},
+        pageLinks: {% convert_to_json page_links %}
       }), document.getElementById('blk_stream'));
     });
     </script>
diff --git a/src/sentry/templatetags/sentry_api.py b/src/sentry/templatetags/sentry_api.py
index 9e43750ab7..3fb16aba7a 100644
--- a/src/sentry/templatetags/sentry_api.py
+++ b/src/sentry/templatetags/sentry_api.py
@@ -21,5 +21,8 @@ def serialize(context, obj):
 
 
 @register.simple_tag
-def convert_to_json(obj):
-    return mark_safe(json.dumps(obj).replace('<', '&lt;').replace('>', '&gt;'))
+def convert_to_json(obj, escape=False):
+    data = json.dumps(obj)
+    if escape:
+        data = data.replace('<', '&lt;').replace('>', '&gt;')
+    return mark_safe(data)
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 4f7d1efa22..7c2c157f1f 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -150,6 +150,7 @@ def group_list(request, organization, project):
         'organization': organization,
         'project': project,
         'event_list': response.data,
+        'page_links': response['Link'],
         'query': m_request.GET['query'],
         'SORT_OPTIONS': SORT_OPTIONS,
     }, request)
