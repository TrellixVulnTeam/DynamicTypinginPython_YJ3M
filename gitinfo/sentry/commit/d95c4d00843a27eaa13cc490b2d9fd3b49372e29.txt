commit d95c4d00843a27eaa13cc490b2d9fd3b49372e29
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Jul 20 11:31:27 2015 +0200

    Correctly handle non-JSON OAuth errors

diff --git a/src/sentry/auth/providers/oauth2.py b/src/sentry/auth/providers/oauth2.py
index afc6c881c1..1ba3bd5089 100644
--- a/src/sentry/auth/providers/oauth2.py
+++ b/src/sentry/auth/providers/oauth2.py
@@ -4,6 +4,7 @@ import logging
 
 from time import time
 from urllib import urlencode
+from urlparse import parse_qsl
 from uuid import uuid4
 
 from sentry.auth import Provider, AuthView
@@ -96,7 +97,8 @@ class OAuth2Callback(AuthView):
         )
         req = safe_urlopen(self.access_token_url, data=data)
         body = safe_urlread(req)
-
+        if req.headers['Content-Type'].startswith('application/x-www-form-urlencoded'):
+            return dict(parse_qsl(body))
         return json.loads(body)
 
     def dispatch(self, request, helper):
