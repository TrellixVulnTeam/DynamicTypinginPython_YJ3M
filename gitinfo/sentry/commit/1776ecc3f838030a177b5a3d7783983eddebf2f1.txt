commit 1776ecc3f838030a177b5a3d7783983eddebf2f1
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Sun May 17 13:33:35 2020 +0200

    fix(sessions): Ignore query outside retention (#18876)

diff --git a/src/sentry/snuba/sessions.py b/src/sentry/snuba/sessions.py
index c404c24663..ef2a2bfff4 100644
--- a/src/sentry/snuba/sessions.py
+++ b/src/sentry/snuba/sessions.py
@@ -3,7 +3,7 @@ from __future__ import absolute_import
 import pytz
 from datetime import datetime, timedelta
 
-from sentry.utils.snuba import raw_query, parse_snuba_datetime
+from sentry.utils.snuba import raw_query, parse_snuba_datetime, QueryOutsideRetentionError
 from sentry.utils.dates import to_timestamp, to_datetime
 from sentry.snuba.dataset import Dataset
 
@@ -355,13 +355,17 @@ def get_crash_free_breakdown(project_id, release, start, environments=None):
         timedelta(days=14),
         timedelta(days=30),
     ):
-        item_start = start + offset
-        if item_start > now:
-            if last is None or (item_start - last).days > 1:
-                rv.append(_query_stats(now))
-            break
-        rv.append(_query_stats(item_start))
-        last = item_start
+        try:
+            item_start = start + offset
+            if item_start > now:
+                if last is None or (item_start - last).days > 1:
+                    rv.append(_query_stats(now))
+                break
+            rv.append(_query_stats(item_start))
+            last = item_start
+        except QueryOutsideRetentionError:
+            # cannot query for these
+            pass
 
     return rv
 
