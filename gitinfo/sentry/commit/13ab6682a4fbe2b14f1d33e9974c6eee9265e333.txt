commit 13ab6682a4fbe2b14f1d33e9974c6eee9265e333
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Nov 3 12:41:16 2017 -0700

    always check for duplicate event from the Event table

diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 4f7359f2d3..f6a1e02ac1 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -629,21 +629,24 @@ class EventManager(object):
                     }
                 )
                 return event
-        else:
-            if Event.objects.filter(
-                project_id=project.id,
-                event_id=event_id,
-            ).exists():
-                self.logger.info(
-                    'duplicate.found',
-                    exc_info=True,
-                    extra={
-                        'event_uuid': event_id,
-                        'project_id': project.id,
-                        'model': Event.__name__,
-                    }
-                )
-                return event
+
+        # We now always need to check the Event table for dupes
+        # since EventMapping isn't exactly the canonical source of truth.
+        if Event.objects.filter(
+            project_id=project.id,
+            event_id=event_id,
+        ).exists():
+            self.logger.info(
+                'duplicate.found',
+                exc_info=True,
+                extra={
+                    'event_uuid': event_id,
+                    'project_id': project.id,
+                    'group_id': group.id,
+                    'model': Event.__name__,
+                }
+            )
+            return event
 
         environment = Environment.get_or_create(
             project=project,
