commit c41e469307e79b69d7be511b5580fa1129422c93
Author: Dena Mwangi <dena@getsentry.com>
Date:   Wed Apr 3 17:30:40 2019 -0700

    feat(tests): Add misc asserts and flows to acceptance tests (#12627)

diff --git a/src/sentry/static/sentry/app/views/organizationCreate.jsx b/src/sentry/static/sentry/app/views/organizationCreate.jsx
index f6d6278db5..951deb2812 100644
--- a/src/sentry/static/sentry/app/views/organizationCreate.jsx
+++ b/src/sentry/static/sentry/app/views/organizationCreate.jsx
@@ -60,7 +60,6 @@ export default class OrganizationCreate extends AsyncView {
                   privacyLink: <a href={privacyUrl} />,
                 }
               )}
-              placeholder={t('e.g. My Company')}
               required={true}
             />
           )}
diff --git a/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx b/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
index 61b6e4b942..4e878dba94 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
@@ -246,6 +246,7 @@ class OrganizationMembersView extends AsyncView {
         }
         to={recreateRoute('new/', {routes, params})}
         icon="icon-circle-add"
+        data-test-id="invite-member"
       >
         {t('Invite Member')}
       </Button>
@@ -270,7 +271,7 @@ class OrganizationMembersView extends AsyncView {
           requestList={requestList}
         />
 
-        <Panel>
+        <Panel data-test-id="org-member-list">
           <PanelHeader hasButtons>
             {t('Member')}
 
diff --git a/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx b/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
index 0a4c06bbfc..87309575c2 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationMembers/organizationMemberRow.jsx
@@ -151,6 +151,7 @@ export default class OrganizationMemberRow extends React.PureComponent {
                     priority="primary"
                     size="xsmall"
                     onClick={this.handleSendInvite}
+                    data-test-id="resend-invite"
                   >
                     {t('Resend invite')}
                   </ResendInviteButton>
diff --git a/src/sentry/templates/sentry/accept-organization-invite.html b/src/sentry/templates/sentry/accept-organization-invite.html
index fd3cdb4e38..6a764e3c08 100644
--- a/src/sentry/templates/sentry/accept-organization-invite.html
+++ b/src/sentry/templates/sentry/accept-organization-invite.html
@@ -40,14 +40,14 @@
             <div class="pull-right" style="margin-top: 5px;">
               <a href="{{ login_url }}">{% trans "Login as an existing user" %}</a>
             </div>
-            <a href="{{ register_url }}" class="btn btn-primary">{% trans "Create a new account" %}</a>
+            <a href="{{ register_url }}" class="btn btn-primary" data-test-id="create-account">{% trans "Create a new account" %}</a>
           </fieldset>
 
         {% elif needs_2fa %}
           <p>{% blocktrans %}To continue, <strong>{{ org_name }}</strong> requires all members to setup two-factor authentication.{% endblocktrans %}</p>
 
           <p class="form-actions">
-            <a href="{% url 'sentry-account-settings-security' %}" class="btn btn-primary">
+            <a href="{% url 'sentry-account-settings-security' %}" class="btn btn-primary" data-test-id="setup-2fa">
               {% trans "Setup Two-Factor Authentication" %}
             </a>
           </p>
@@ -56,7 +56,7 @@
           <form method="POST">
             {% csrf_token %}
             <p>
-              <button type="submit" class="btn btn-primary">
+              <button type="submit" class="btn btn-primary" data-test-id="join-organization">
                 {% blocktrans %}Join the {{ org_name }} organization{% endblocktrans %}
               </button>
             </p>
diff --git a/src/sentry/utils/pytest/selenium.py b/src/sentry/utils/pytest/selenium.py
index b5cc5fd47c..f5c0873797 100644
--- a/src/sentry/utils/pytest/selenium.py
+++ b/src/sentry/utils/pytest/selenium.py
@@ -73,6 +73,9 @@ class Browser(object):
             return False
         return True
 
+    def element_exists_by_test_id(self, selector):
+        return self.element_exists('[data-test-id="%s"]' % (selector))
+
     def click(self, selector):
         self.element(selector).click()
 
@@ -140,6 +143,9 @@ class Browser(object):
 
         return self
 
+    def wait_until_test_id(self, selector):
+        return self.wait_until('[data-test-id="%s"]' % (selector))
+
     def wait_until_not(self, selector=None, title=None, timeout=3):
         """
         Waits until ``selector`` is NOT found in the browser, or until
diff --git a/tests/acceptance/test_accept_organization_invite.py b/tests/acceptance/test_accept_organization_invite.py
index a9808f58b3..99ea24ef71 100644
--- a/tests/acceptance/test_accept_organization_invite.py
+++ b/tests/acceptance/test_accept_organization_invite.py
@@ -1,6 +1,9 @@
 from __future__ import absolute_import
 
+from django.db.models import F
+
 from sentry.testutils import AcceptanceTestCase
+from sentry.models import Organization
 
 
 class AcceptOrganizationInviteTest(AcceptanceTestCase):
@@ -19,8 +22,19 @@ class AcceptOrganizationInviteTest(AcceptanceTestCase):
             role='owner',
             teams=[self.team],
         )
-        self.login_as(self.user)
 
-    def test_invite(self):
+    def test_invite_simple(self):
+        self.login_as(self.user)
         self.browser.get(self.member.get_invite_link().split('/', 3)[-1])
         self.browser.snapshot(name='accept organization invite')
+        assert self.browser.element_exists_by_test_id('join-organization')
+
+    def test_invite_not_authenticated(self):
+        self.browser.get(self.member.get_invite_link().split('/', 3)[-1])
+        assert self.browser.element_exists_by_test_id('create-account')
+
+    def test_invite_2fa_enforced_org(self):
+        self.login_as(self.user)
+        self.org.update(flags=F('flags').bitor(Organization.flags.require_2fa))
+        self.browser.get(self.member.get_invite_link().split('/', 3)[-1])
+        assert self.browser.element_exists_by_test_id('setup-2fa')
diff --git a/tests/acceptance/test_create_organization.py b/tests/acceptance/test_create_organization.py
index 4b872dbaee..bed8e5a3f3 100644
--- a/tests/acceptance/test_create_organization.py
+++ b/tests/acceptance/test_create_organization.py
@@ -1,5 +1,7 @@
 from __future__ import absolute_import
 
+from django.conf import settings
+
 from sentry.testutils import AcceptanceTestCase
 
 
@@ -10,5 +12,15 @@ class CreateOrganizationTest(AcceptanceTestCase):
         self.login_as(self.user)
 
     def test_simple(self):
+        settings.PRIVACY_URL = 'https://sentry.io/privacy/'
+        settings.TERMS_URL = 'https://sentry.io/terms/'
         self.browser.get('/organizations/new/')
+        assert self.browser.element_exists('input[id="id-name"]')
+        assert self.browser.element_exists('input[id="id-agreeTerms"]')
         self.browser.snapshot(name='create organization')
+        self.browser.element('input[name="name"]').send_keys('new org')
+        self.browser.element('input[id="id-agreeTerms"]').click()
+        self.browser.click('button[type="submit"]')
+        # After creating an org should end up on create project
+        self.browser.wait_until_test_id('platform-javascript-react')
+        assert self.browser.element_exists_by_test_id('create-project')
diff --git a/tests/acceptance/test_dashboard.py b/tests/acceptance/test_dashboard.py
index 57f733f26f..93f480a481 100644
--- a/tests/acceptance/test_dashboard.py
+++ b/tests/acceptance/test_dashboard.py
@@ -61,7 +61,7 @@ class DashboardTest(AcceptanceTestCase):
         self.project.update(first_event=None)
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading-indicator')
-        self.browser.wait_until('[data-test-id="awaiting-events"]')
+        self.browser.wait_until_test_id('awaiting-events')
         self.browser.snapshot('org dash no issues')
 
     def test_one_issue(self):
diff --git a/tests/acceptance/test_issue_details.py b/tests/acceptance/test_issue_details.py
index b20f0a7653..44d8dfc993 100644
--- a/tests/acceptance/test_issue_details.py
+++ b/tests/acceptance/test_issue_details.py
@@ -193,8 +193,8 @@ class IssueDetailsTest(AcceptanceTestCase):
     def wait_until_loaded(self):
         self.browser.wait_until_not('.loading-indicator')
         self.browser.wait_until('.entries')
-        self.browser.wait_until('[data-test-id="linked-issues"]')
-        self.browser.wait_until('[data-test-id="loaded-device-name"]')
+        self.browser.wait_until_test_id('linked-issues')
+        self.browser.wait_until_test_id('loaded-device-name')
 
     def dismiss_assistant(self):
         # Forward session cookie to django client.
diff --git a/tests/acceptance/test_member_list.py b/tests/acceptance/test_member_list.py
index 2228cde555..4368b55bbb 100644
--- a/tests/acceptance/test_member_list.py
+++ b/tests/acceptance/test_member_list.py
@@ -34,3 +34,5 @@ class ListOrganizationMembersTest(AcceptanceTestCase):
         self.browser.get(u'/organizations/{}/members/'.format(self.org.slug))
         self.browser.wait_until_not('.loading-indicator')
         self.browser.snapshot(name='list organization members')
+        assert self.browser.element_exists_by_test_id('invite-member')
+        assert self.browser.element_exists_by_test_id('resend-invite')
diff --git a/tests/acceptance/test_onboarding.py b/tests/acceptance/test_onboarding.py
index cde9157f24..fcf941b460 100644
--- a/tests/acceptance/test_onboarding.py
+++ b/tests/acceptance/test_onboarding.py
@@ -47,4 +47,4 @@ class OrganizationOnboardingTest(AcceptanceTestCase):
         self.browser.wait_until_not('.loading')
 
         assert self.browser.element_exists('.robot')
-        assert self.browser.element_exists('[data-test-id="install-instructions"]')
+        assert self.browser.element_exists_by_test_id('install-instructions')
diff --git a/tests/acceptance/test_organization_discover.py b/tests/acceptance/test_organization_discover.py
index e5f6c2a8b9..06ef64a3b0 100644
--- a/tests/acceptance/test_organization_discover.py
+++ b/tests/acceptance/test_organization_discover.py
@@ -56,7 +56,7 @@ class OrganizationDiscoverTest(AcceptanceTestCase):
             self.browser.wait_until_not('.loading')
             self.browser.find_element_by_xpath("//button//span[contains(text(), 'Save')]").click()
             self.browser.get(self.path + 'saved/1/?editing=true')
-            self.browser.wait_until('[data-test-id="result"]')
+            self.browser.wait_until_test_id('result')
             self.browser.wait_until_not('.loading')
             self.browser.snapshot('discover - saved query')
 
@@ -66,6 +66,6 @@ class OrganizationDiscoverTest(AcceptanceTestCase):
             self.browser.wait_until_not('.loading')
             self.browser.find_element_by_xpath("//button//span[contains(text(), 'Save')]").click()
             self.browser.get(self.path + '?view=saved')
-            self.browser.wait_until('[data-test-id="result"]')
+            self.browser.wait_until_test_id('result')
             self.browser.wait_until_not('.loading')
             self.browser.snapshot('discover - saved query list')
diff --git a/tests/acceptance/test_organization_group_index.py b/tests/acceptance/test_organization_group_index.py
index cdbca15f09..9c52624af3 100644
--- a/tests/acceptance/test_organization_group_index.py
+++ b/tests/acceptance/test_organization_group_index.py
@@ -32,7 +32,7 @@ class OrganizationGroupIndexTest(AcceptanceTestCase):
         with self.feature(['organizations:sentry10', 'organizations:discover']):
             self.browser.get(self.path)
             self.wait_until_loaded()
-            self.browser.wait_until('[data-test-id="awaiting-events"]')
+            self.browser.wait_until_test_id('awaiting-events')
             self.browser.snapshot('organization issues onboarding')
 
     def test_with_no_results(self):
@@ -40,7 +40,7 @@ class OrganizationGroupIndexTest(AcceptanceTestCase):
         with self.feature(['organizations:sentry10', 'organizations:discover']):
             self.browser.get(self.path)
             self.wait_until_loaded()
-            self.browser.wait_until('[data-test-id="empty-state"]')
+            self.browser.wait_until_test_id('empty-state')
             self.browser.snapshot('organization issues no results')
 
     def wait_until_loaded(self):
diff --git a/tests/acceptance/test_organization_rate_limits.py b/tests/acceptance/test_organization_rate_limits.py
index 4800e416ca..eb32499493 100644
--- a/tests/acceptance/test_organization_rate_limits.py
+++ b/tests/acceptance/test_organization_rate_limits.py
@@ -34,15 +34,15 @@ class OrganizationRateLimitsTest(AcceptanceTestCase):
         self.project.update(first_event=timezone.now())
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading-indicator')
-        self.browser.wait_until('[data-test-id="rate-limit-editor"]')
+        self.browser.wait_until_test_id('rate-limit-editor')
         self.browser.snapshot('organization rate limits with quota')
-        assert self.browser.element_exists('[data-test-id="rate-limit-editor"]')
+        assert self.browser.element_exists_by_test_id('rate-limit-editor')
 
     @patch('sentry.app.quotas.get_maximum_quota', Mock(return_value=(0, 60)))
     def test_without_rate_limits(self):
         self.project.update(first_event=timezone.now())
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading-indicator')
-        self.browser.wait_until('[data-test-id="rate-limit-editor"]')
+        self.browser.wait_until_test_id('rate-limit-editor')
         self.browser.snapshot('organization rate limits without quota')
-        assert self.browser.element_exists('[data-test-id="rate-limit-editor"]')
+        assert self.browser.element_exists_by_test_id('rate-limit-editor')
diff --git a/tests/acceptance/test_project_data_forwarding_settings.py b/tests/acceptance/test_project_data_forwarding_settings.py
index eb19b73be3..7f03a4abdf 100644
--- a/tests/acceptance/test_project_data_forwarding_settings.py
+++ b/tests/acceptance/test_project_data_forwarding_settings.py
@@ -31,4 +31,4 @@ class ProjectDataForwardingSettingsTest(AcceptanceTestCase):
         self.browser.get(self.path)
         self.browser.wait_until_not('.loading-indicator')
         self.browser.snapshot('project data forwarding settings')
-        self.browser.wait_until('[data-test-id="data-forwarding-settings"]')
+        self.browser.wait_until_test_id('data-forwarding-settings')
diff --git a/tests/acceptance/test_project_issues.py b/tests/acceptance/test_project_issues.py
index 9200558541..d93d3749e2 100644
--- a/tests/acceptance/test_project_issues.py
+++ b/tests/acceptance/test_project_issues.py
@@ -26,7 +26,7 @@ class ProjectIssuesTest(AcceptanceTestCase):
         # TODO(dcramer): we should add basic assertions around "i wanted this
         # URL but was sent somewhere else"
         self.browser.get(self.path)
-        self.browser.wait_until('[data-test-id="awaiting-events"]')
+        self.browser.wait_until_test_id('awaiting-events')
         self.browser.snapshot('project issues not configured')
 
     def test_with_issues(self):
@@ -43,5 +43,5 @@ class ProjectIssuesTest(AcceptanceTestCase):
     def test_with_no_issues(self):
         self.project.update(first_event=timezone.now())
         self.browser.get(self.path)
-        self.browser.wait_until('[data-test-id=empty-state]')
+        self.browser.wait_until_test_id('empty-state')
         self.browser.snapshot('project issues without issues')
diff --git a/tests/acceptance/test_sidebar.py b/tests/acceptance/test_sidebar.py
index e8843dadd8..c59ff0f695 100644
--- a/tests/acceptance/test_sidebar.py
+++ b/tests/acceptance/test_sidebar.py
@@ -17,12 +17,12 @@ class SidebarTest(AcceptanceTestCase):
         self.browser.wait_until_not('.loading')
         self.browser.click('[data-test-id="sidebar-dropdown"]')
         self.browser.move_to('[data-test-id="sidebar-switch-org"]')
-        self.browser.wait_until('[data-test-id="sidebar-switch-org-menu"]')
+        self.browser.wait_until_test_id('sidebar-switch-org-menu')
         self.browser.snapshot('sidebar - switch org expanded')
         self.browser.click('[data-test-id="sidebar-collapse"]')
         self.browser.snapshot('sidebar - collapsed')
         self.browser.click('[data-test-id="sidebar-broadcasts"]')
-        self.browser.wait_until('[data-test-id="sidebar-broadcasts-panel"]')
+        self.browser.wait_until_test_id('sidebar-broadcasts-panel')
         self.browser.snapshot('sidebar - broadcasts panel')
         self.browser.click('footer')
         self.browser.wait_until_not('[data-test-id="sidebar-broadcasts-panel"]')
diff --git a/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
index 65eddefc11..357efa3537 100644
--- a/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
+++ b/tests/js/spec/views/__snapshots__/organizationCreate.spec.jsx.snap
@@ -70,7 +70,6 @@ exports[`OrganizationCreate render() renders with terms 1`] = `
           </span>
         }
         name="agreeTerms"
-        placeholder="e.g. My Company"
         required={true}
       />
     </ApiForm>
