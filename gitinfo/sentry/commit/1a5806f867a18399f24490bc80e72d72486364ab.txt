commit 1a5806f867a18399f24490bc80e72d72486364ab
Author: David Cramer <dcramer@gmail.com>
Date:   Wed Jun 28 17:00:10 2017 -0700

    ui: improve invite/register flows
    
    - dont show project_count if empty
    - add name to registration

diff --git a/src/sentry/templates/sentry/accept-organization-invite.html b/src/sentry/templates/sentry/accept-organization-invite.html
index ec7eba3f0a..7f5f9b32b4 100644
--- a/src/sentry/templates/sentry/accept-organization-invite.html
+++ b/src/sentry/templates/sentry/accept-organization-invite.html
@@ -27,14 +27,18 @@
           </div>
         {% endif %}
 
-        <p>{% blocktrans %}You have been invited to join this organization, which manages <strong>{{ project_count }}</strong> project(s), including:{% endblocktrans %}</p>
-        <ul>
-          {% for project in project_list|slice:"5" %}
-            <li>
-              {{ project.team.name }} &#47; {{ project.name }}
-            </li>
-          {% endfor %}
-        </ul>
+        {% if project_count %}
+          <p>{% blocktrans %}You have been invited to join this organization, which manages <strong>{{ project_count }}</strong> project(s), including:{% endblocktrans %}</p>
+          <ul>
+            {% for project in project_list|slice:"5" %}
+              <li>
+                {{ project.team.name }} &#47; {{ project.name }}
+              </li>
+            {% endfor %}
+          </ul>
+        {% else %}
+          <p>{% blocktrans %}You have been invited to join this organization.{% endblocktrans %}</p>
+        {% endif %}
 
         {% if needs_authentication %}
           <p>{% trans "To continue, you must either login to your existing account, or create a new one." %}</p>
diff --git a/src/sentry/web/forms/accounts.py b/src/sentry/web/forms/accounts.py
index 904ed9902b..7198b4a331 100644
--- a/src/sentry/web/forms/accounts.py
+++ b/src/sentry/web/forms/accounts.py
@@ -159,10 +159,16 @@ class AuthenticationForm(forms.Form):
 
 
 class RegistrationForm(forms.ModelForm):
+    name = forms.CharField(
+        label=_('Name'), max_length=30,
+        widget=forms.TextInput(attrs={'placeholder': 'Jane Doe'}),
+        required=True)
     username = forms.EmailField(
         label=_('Email'), max_length=128,
-        widget=forms.TextInput(attrs={'placeholder': 'you@example.com'}))
+        widget=forms.TextInput(attrs={'placeholder': 'you@example.com'}),
+        required=True)
     password = forms.CharField(
+        required=True,
         widget=forms.PasswordInput(attrs={'placeholder': 'something super secret'}))
     subscribe = forms.BooleanField(
         label=_('Subscribe to product updates newsletter'),
@@ -176,7 +182,7 @@ class RegistrationForm(forms.ModelForm):
             del self.fields['subscribe']
 
     class Meta:
-        fields = ('username',)
+        fields = ('username', 'name')
         model = User
 
     def clean_username(self):
diff --git a/tests/sentry/web/frontend/test_auth_login.py b/tests/sentry/web/frontend/test_auth_login.py
index 450cb17819..46d24e8263 100644
--- a/tests/sentry/web/frontend/test_auth_login.py
+++ b/tests/sentry/web/frontend/test_auth_login.py
@@ -67,12 +67,14 @@ class AuthLoginTest(TestCase):
             resp = self.client.post(self.path, {
                 'username': 'test-a-really-long-email-address@example.com',
                 'password': 'foobar',
+                'name': 'Foo Bar',
                 'op': 'register',
             })
         assert resp.status_code == 302
         user = User.objects.get(username='test-a-really-long-email-address@example.com')
         assert user.email == 'test-a-really-long-email-address@example.com'
         assert user.check_password('foobar')
+        assert user.name == 'Foo Bar'
 
     def test_register_renders_correct_template(self):
         options.set('auth.allow-registration', True)
