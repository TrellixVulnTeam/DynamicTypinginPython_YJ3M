commit 5b505d633b23f059b637f75323895c843b9e99e1
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Sep 16 01:37:30 2014 -0700

    Remove sidebar in favor of simple search queries

diff --git a/bower.json b/bower.json
index 4d4751bbfc..0cf5b88d25 100644
--- a/bower.json
+++ b/bower.json
@@ -17,7 +17,7 @@
     "bootstrap": "~3.1.1",
     "bootstrap-datepicker": "~1.3.0",
     "moment": "~2.1.0",
-    "jquery": "~2.0.3",
+    "jquery": "~2.1.0",
     "jquery-flot": "~0.8.3",
     "selectize": "~0.10.1",
     "simple-slider": "https://github.com/loopj/jquery-simple-slider.git",
@@ -26,6 +26,6 @@
   },
   "resolutions": {
     "angular": "1.2.9",
-    "jquery": "~2.0.3"
+    "jquery": "~2.1.0"
   }
 }
diff --git a/src/sentry/api/endpoints/project_group_index.py b/src/sentry/api/endpoints/project_group_index.py
index 2b54049c36..f0f59c7ddc 100644
--- a/src/sentry/api/endpoints/project_group_index.py
+++ b/src/sentry/api/endpoints/project_group_index.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import, division, print_function
+
 from datetime import timedelta
 from django.db.models import Q
 from django.utils import timezone
@@ -13,6 +15,7 @@ from sentry.constants import (
 )
 from sentry.db.models.query import create_or_update
 from sentry.models import Activity, Group, GroupBookmark, Project, TagKey
+from sentry.search.utils import parse_query
 from sentry.utils.dates import parse_date
 
 
@@ -95,6 +98,10 @@ class ProjectGroupIndexEndpoint(Endpoint):
         if cursor:
             query_kwargs['cursor'] = cursor
 
+        query = request.GET.get('query')
+        if query is not None:
+            query_kwargs.update(parse_query(query))
+
         results = search.query(**query_kwargs)
 
         return Response(serialize(list(results), request.user))
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 9fc9e54c61..1480272b24 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -543,9 +543,7 @@ SENTRY_PUBLIC = False
 SENTRY_PROJECT = 1
 SENTRY_CACHE_BACKEND = 'default'
 
-SENTRY_FILTERS = (
-    'sentry.filters.StatusFilter',
-)
+SENTRY_FILTERS = ()
 
 SENTRY_IGNORE_EXCEPTIONS = (
     'OperationalError',
diff --git a/src/sentry/search/utils.py b/src/sentry/search/utils.py
new file mode 100644
index 0000000000..cb251e1211
--- /dev/null
+++ b/src/sentry/search/utils.py
@@ -0,0 +1,18 @@
+from __future__ import absolute_import, division, print_function
+
+
+def parse_query(query):
+    # TODO(dcramer): make this better
+    tokens = query.split(' ')
+
+    results = {'tags': {}, 'query': []}
+    for token in tokens:
+        if ':' in token:
+            key, value = token.split(':', 1)
+            results['tags'][key] = value
+        else:
+            results['query'].append(value)
+
+    results['query'] = ' '.join(results['query'])
+
+    return dict(results)
diff --git a/src/sentry/static/sentry/app/controllers/projectStream.js b/src/sentry/static/sentry/app/controllers/projectStream.js
index 2377f54579..d9a6a72239 100644
--- a/src/sentry/static/sentry/app/controllers/projectStream.js
+++ b/src/sentry/static/sentry/app/controllers/projectStream.js
@@ -15,7 +15,11 @@
     function($scope, $timeout){
       var params = app.utils.getQueryParams();
 
-      $scope.searchDropdown = {visible: false};
+      $('.filter-nav .search-input').focus(function(){
+        $('.search-dropdown').show();
+      }).blur(function(){
+        $('.search-dropdown').hide();
+      });
 
       if (params.bookmarks) {
         $scope.activeButton = 'bookmarks';
@@ -35,13 +39,6 @@
         default:
           $('.btn-all-events').addClass('active');
       }
-
-      $('.search-input').typeahead({}, {
-        source: function(query, cb){
-          console.log(query);
-          cb([{value: query}]);
-        }
-      });
     }
   ]);
 
@@ -56,10 +53,11 @@
           .success(function(data){
             var duration = $scope.chartDuration;
             data = $.map(data, GroupModel);
+            angular.forEach(data, function(group){
+              group.activeChartData = group.stats[duration];
+            });
+
             $timeout(function(){
-              angular.forEach(data, function(group){
-                group.activeChartData = group.stats[duration];
-              });
               $scope.groupList.extend(data);
             });
           }).finally(function(){
diff --git a/src/sentry/static/sentry/less/sentry.less b/src/sentry/static/sentry/less/sentry.less
index 8280933c8c..73d0cedbde 100644
--- a/src/sentry/static/sentry/less/sentry.less
+++ b/src/sentry/static/sentry/less/sentry.less
@@ -819,23 +819,20 @@ a.icon-share {
 
 .group-header-container {
   margin-bottom: -45px;
-
   > .container {
-    width: 100%;
-    padding: 0;
+    left: -15px;
   }
 
   &.affix {
     top: 0;
     z-index: 1000;
-    // left: 0;
-    // right: 0;
-    // box-shadow: 0 1px 0 rgba(0,0,0, .1), 0 1px 2px rgba(0,0,0, .06);
-    // background: #f9f9f9;
+    left: 0;
+    right: 0;
+    box-shadow: 0 1px 0 rgba(0,0,0, .1), 0 1px 2px rgba(0,0,0, .06);
+    background: #f9f9f9;
 
     .group-header {
       margin-bottom: 0;
-      box-shadow: 0 1px 0 rgba(0,0,0, .03), 0 1px 2px rgba(0,0,0, .06);
     }
 
     .container {
@@ -847,6 +844,8 @@ a.icon-share {
     }
 
     .stream-actions-cell {
+      box-shadow: none;
+      border-color: transparent;
     }
   }
 }
@@ -857,7 +856,7 @@ a.icon-share {
 
 .group-header {
   display: table;
-  min-width: 847px;
+  width: 100%;
 }
 
 .stream-pagination {
@@ -2804,18 +2803,6 @@ table.integrations {
 
 /* Small screens */
 
-@media(max-width:1200px) {
-  .group-header {
-    min-width: 702px;
-  }
-}
-
-@media(max-width:992px) {
-  .group-header {
-    min-width: 720px;
-  }
-}
-
 @media(max-width:767px) {
   body {
     overflow-x: hidden;
@@ -2913,14 +2900,15 @@ table.integrations {
   .group-header-container {
     margin-left: -15px;
     margin-right: -15px;
-
+    .container {
+      left: 0;
+      margin: 0;
+      padding: 0
+    }
     &.affix {
       padding-left: 15px;
       padding-right: 0;
     }
-    .group-header {
-      min-width: 100%;
-    }
   }
 
   .group-list, .events {
diff --git a/src/sentry/templates/sentry/bases/stream.html b/src/sentry/templates/sentry/bases/stream.html
index 5ce840281b..9d16b985a7 100644
--- a/src/sentry/templates/sentry/bases/stream.html
+++ b/src/sentry/templates/sentry/bases/stream.html
@@ -35,13 +35,15 @@
             </div>
             <div class="col-sm-8">
               <div class="search">
-                  <form class="form-horizontal">
+                  <form class="form-horizontal" action="." method="GET">
                       <div>
                           <input type="text" class="search-input form-control"
-                                 placeholder="Search for events, users, tags, and everything else.">
+                                 placeholder="Search for events, users, tags, and everything else."
+                                 name="query"
+                                 value="{% if query %}{{query}}{% endif %}">
                           <span class="icon-search"></span>
                       </div>
-                      <div class="search-dropdown" ng-show="searchDropdown.visible === true">
+                      <div class="search-dropdown" style="display:none">
                         <ul class="search-helper search-autocomplete-list">
                           <li class="search-autocomplete-item">
                             <span class="icon icon-tag"></span>
@@ -59,34 +61,6 @@
                             <p class="search-example">assigned:[me|user@example.com]</p>
                           </li>
                         </ul>
-                        <ul class="tag-results search-autocomplete-list" ng-show="searchTagResults.visible === true">
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-tag"></span>
-                            <h4>server</h4>
-                          </li>
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-tag"></span>
-                            <h4>severity</h4>
-                          </li>
-                        </ul>
-                        <ul class="value-results search-autocomplete-list" ng-show="searchTagResults.visible === true">
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-ellipsis"></span>
-                            <h4>web-1</h4>
-                          </li>
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-ellipsis"></span>
-                            <h4>web-2</h4>
-                          </li>
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-ellipsis"></span>
-                            <h4>web-3</h4>
-                          </li>
-                          <li class="search-autocomplete-item">
-                            <span class="icon icon-ellipsis"></span>
-                            <h4>web-4</h4>
-                          </li>
-                        </ul>
                       </div>
                   </form>
               </div>
diff --git a/src/sentry/templates/sentry/groups/group_list.html b/src/sentry/templates/sentry/groups/group_list.html
index 55afe51ac3..35d2385672 100644
--- a/src/sentry/templates/sentry/groups/group_list.html
+++ b/src/sentry/templates/sentry/groups/group_list.html
@@ -4,17 +4,14 @@
 {% load sentry_api %}
 {% load sentry_helpers %}
 {% load sentry_plugins %}
-{% load sentry_stream_filters %}
 
 {% block controller %}ProjectStreamCtrl{% endblock %}
 
 {% block content %}
     {% querystring from request without sort as sort_querystring %}
     {% querystring from request without since as since_querystring %}
-    <div class="row">
-      <div class="col-md-9">
-        <div class="group-header-container" data-spy="affix" data-offset-top="195">
-        <div class="container">
+    <div class="group-header-container" data-spy="affix" data-offset-top="195">
+      <div class="container">
         <div class="group-header">
           <div class="stream-actions">
             <div class="stream-actions-left stream-actions-cell">
@@ -106,91 +103,78 @@
       </div>
     </div>
 
-        {% recent_alerts from project as recent_alerts %}
-        {% if recent_alerts %}
-            <ul class="active-alerts">
-                {% for alert in recent_alerts %}
-                    <li class="alert alert-error">
-                        <a class="close" data-dismiss="alert">×</a>
-                        <a href="{% url 'sentry-alert-details' project.team.slug project.slug alert.id %}">{{ alert.message }}</a>
-                        <small>&mdash; {{ alert.datetime|timesince }}</small>
-                    </li>
-                {% endfor %}
-            </ul>
-        {% endif %}
-
-        <ul class="group-list" ng-show="groupList">
-            <li class="group" ng-repeat="group in groupList"
-                ng-class="{'seen': group.hasSeen}">
-                <div class="event-details event-cell">
-                  <div class="checkbox">
-                      <input type="checkbox" class="chk-select">
-                  </div>
-                  <h3><a href="<% group.permalink %>"><% group.title %></a></h3>
-                  <div class="event-meta">
-                      <span class="message"><% group.culprit %></span>
-                      &middot; <time time-since="group.firstSeen"></time>
-                  </div>
-                </div>
-                <div class="event-assignee event-cell hidden-xs">
-                    <assignee-selector></assignee-selector>
-                </div>
-                <div class="hidden-sm hidden-xs event-graph align-right event-cell">
-                  <barchart data="group.activeChartData" options="chartOptions" class="sparkline"></barchart>
-                </div>
-                <div class="hidden-xs event-occurrences align-center event-cell">
-                  <span count="group.count"></span>
-                </div>
-                <div class="hidden-xs event-users align-center event-cell">
-                  <span count="group.tags['sentry:user'].count || 0"></span>
-                </div>
-            </li>
+    {% recent_alerts from project as recent_alerts %}
+    {% if recent_alerts %}
+        <ul class="active-alerts">
+            {% for alert in recent_alerts %}
+                <li class="alert alert-error">
+                    <a class="close" data-dismiss="alert">×</a>
+                    <a href="{% url 'sentry-alert-details' project.team.slug project.slug alert.id %}">{{ alert.message }}</a>
+                    <small>&mdash; {{ alert.datetime|timesince }}</small>
+                </li>
+            {% endfor %}
         </ul>
+    {% endif %}
 
-        <div class="stream-pagination" ng-show="groupList">
-            <div class="btn-group pull-right">
-                {% spaceless %}
-                    {% if previous_page %}
-                        <a class="btn btn-default btn-lg prev" href="?{{ pageless_query_string|escape }}&amp;p={{ previous_page }}">
-                            <span title="{% trans "Previous" %}" class="icon-arrow-left"></span>
-                        </a>
-                    {% else %}
-                        <a class="btn btn-default btn-lg prev disabled">
-                            <span title="{% trans "Previous" %}" class="icon-arrow-left"></span>
-                        </a>
-                    {% endif %}
-                    {% if next_page %}
-                        <a class="btn btn-default btn-lg next" href="?{{ pageless_query_string|escape }}&amp;p={{ next_page }}">
-                            <span title="{% trans "Next" %}" class="icon-arrow-right"></span></a>
-                    {% else %}
-                        <a class="btn btn-default btn-lg next disabled">
-                            <span calss="{% trans "Next" %}" class="icon-arrow-right"></span>
-                        </a>
-                    {% endif %}
-                {% endspaceless %}
+    <ul class="group-list" ng-if="groupList.length">
+        <li class="group" ng-repeat="group in groupList"
+            ng-class="{'seen': group.hasSeen}">
+            <div class="event-details event-cell">
+              <div class="checkbox">
+                  <input type="checkbox" class="chk-select">
+              </div>
+              <h3><a href="<% group.permalink %>"><% group.title %></a></h3>
+              <div class="event-meta">
+                  <span class="message"><% group.culprit %></span>
+                  &middot; <time time-since="group.firstSeen"></time>
+              </div>
             </div>
-        </div>
+            <div class="event-assignee event-cell hidden-xs">
+                <assignee-selector></assignee-selector>
+            </div>
+            <div class="hidden-sm hidden-xs event-graph align-right event-cell">
+              <barchart data="group.activeChartData" options="chartOptions" class="sparkline"></barchart>
+            </div>
+            <div class="hidden-xs event-occurrences align-center event-cell">
+              <span count="group.count"></span>
+            </div>
+            <div class="hidden-xs event-users align-center event-cell">
+              <span count="group.tags['sentry:user'].count || 0"></span>
+            </div>
+        </li>
+    </ul>
 
-        <div class="stream-empty" ng-hide="groupList">
-          <div class="container">
-            <h3>No events to show.</h3>
-          </div>
+    <div class="stream-pagination" ng-if="groupList.length">
+        <div class="btn-group pull-right">
+            {% spaceless %}
+                {% if previous_page %}
+                    <a class="btn btn-default btn-lg prev" href="?{{ pageless_query_string|escape }}&amp;p={{ previous_page }}">
+                        <span title="{% trans "Previous" %}" class="icon-arrow-left"></span>
+                    </a>
+                {% else %}
+                    <a class="btn btn-default btn-lg prev disabled">
+                        <span title="{% trans "Previous" %}" class="icon-arrow-left"></span>
+                    </a>
+                {% endif %}
+                {% if next_page %}
+                    <a class="btn btn-default btn-lg next" href="?{{ pageless_query_string|escape }}&amp;p={{ next_page }}">
+                        <span title="{% trans "Next" %}" class="icon-arrow-right"></span></a>
+                {% else %}
+                    <a class="btn btn-default btn-lg next disabled">
+                        <span calss="{% trans "Next" %}" class="icon-arrow-right"></span>
+                    </a>
+                {% endif %}
+            {% endspaceless %}
         </div>
-
-        <script>
-        window.groupList = {% serialize event_list %}
-        </script>
-
     </div>
-    <div class="sidebar col-md-3 hidden-sm hidden-xs">
-      {% for filter in project|get_filters:request %}
-        {% if filter.show_label %}
-            <h6>{% trans filter.label %}</h6>
-        {% endif %}
-        <div class="filter">
-            {{ filter.render }}
-        </div>
-      {% endfor %}
+
+    <div class="stream-empty" ng-if="!groupList.length">
+      <div class="container">
+        <h3>No events to show.</h3>
+      </div>
     </div>
-  </div>
+
+    <script>
+    window.groupList = {% serialize event_list %}
+    </script>
 {% endblock %}
diff --git a/src/sentry/templatetags/sentry_stream_filters.py b/src/sentry/templatetags/sentry_stream_filters.py
deleted file mode 100644
index ebe237d0d2..0000000000
--- a/src/sentry/templatetags/sentry_stream_filters.py
+++ /dev/null
@@ -1,42 +0,0 @@
-"""
-sentry.templatetags.sentry_stream_filters
-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-
-:copyright: (c) 2010-2014 by the Sentry Team, see AUTHORS for more details.
-:license: BSD, see LICENSE for more details.
-"""
-from __future__ import absolute_import, print_function
-
-import logging
-
-from django import template
-from django.conf import settings
-from sentry.constants import TAG_LABELS
-from sentry.filters.base import Filter
-from sentry.utils.imports import import_string
-
-register = template.Library()
-
-
-@register.filter
-def get_filters(project, request):
-    filter_list = []
-
-    for class_path in settings.SENTRY_FILTERS:
-        try:
-            filter_cls = import_string(class_path)
-        except Exception:
-            logger = logging.getLogger('sentry.errors')
-            logger.exception('Unable to import %s', class_path)
-            continue
-        filter_list.append(filter_cls(request, project))
-
-    for tag in project.get_tags():
-        filter_list.append(Filter(
-            column=tag,
-            label=TAG_LABELS.get(tag) or tag.replace('_', ' ').title(),
-            request=request,
-            project=project,
-        ))
-
-    return filter_list
diff --git a/src/sentry/web/frontend/groups.py b/src/sentry/web/frontend/groups.py
index 5c6897ea20..9c4c0e2f30 100644
--- a/src/sentry/web/frontend/groups.py
+++ b/src/sentry/web/frontend/groups.py
@@ -32,6 +32,7 @@ from sentry.permissions import (
     can_admin_group, can_remove_group, can_create_projects
 )
 from sentry.plugins import plugins
+from sentry.search.utils import parse_query
 from sentry.utils import json
 from sentry.utils.dates import parse_date
 from sentry.web.decorators import has_access, has_group_access, login_required
@@ -47,10 +48,6 @@ def _get_group_list(request, project):
         'project': project,
     }
 
-    query = request.GET.get('query')
-    if query:
-        query_kwargs['query'] = query
-
     status = request.GET.get('status', '0')
     if status:
         query_kwargs['status'] = int(status)
@@ -107,6 +104,10 @@ def _get_group_list(request, project):
     query_kwargs['offset'] = (page - 1) * EVENTS_PER_PAGE
     query_kwargs['limit'] = EVENTS_PER_PAGE + 1
 
+    query = request.GET.get('query')
+    if query is not None:
+        query_kwargs.update(parse_query(query))
+
     results = app.search.query(**query_kwargs)
 
     if len(results) == query_kwargs['limit']:
@@ -273,6 +274,7 @@ def group_list(request, team, project):
         'next_page': response['next_page'],
         'today': response['today'],
         'sort': response['sort'],
+        'query': query,
         'pageless_query_string': pageless_query_string,
         'sort_label': sort_label,
         'SORT_OPTIONS': SORT_OPTIONS,
