commit 38376652ddc6f49852c96d45521ab9a613e963e4
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Mon Oct 28 17:57:11 2019 +0100

    fix(quotas): Do not stringify a None-prefix (#15291)

diff --git a/src/sentry/quotas/redis.py b/src/sentry/quotas/redis.py
index 034ad00a16..8f5afddba8 100644
--- a/src/sentry/quotas/redis.py
+++ b/src/sentry/quotas/redis.py
@@ -113,7 +113,7 @@ class BasicRedisQuota(object):
     def to_json(self):
         return prune_empty_keys(
             {
-                "prefix": six.text_type(self.prefix),
+                "prefix": six.text_type(self.prefix) if self.prefix is not None else None,
                 "subscope": six.text_type(self.subscope) if self.subscope is not None else None,
                 "limit": self.limit,
                 "window": self.window,
diff --git a/tests/sentry/quotas/redis/tests.py b/tests/sentry/quotas/redis/tests.py
index 74691e88f9..1729338401 100644
--- a/tests/sentry/quotas/redis/tests.py
+++ b/tests/sentry/quotas/redis/tests.py
@@ -2,6 +2,7 @@
 
 from __future__ import absolute_import
 
+import pytest
 import mock
 import six
 import time
@@ -207,3 +208,17 @@ class RedisQuotaTest(TestCase):
             timestamp=timestamp,
             # the - 1 is because we refunded once
         ) == [n - 1 for _ in quotas] + [0, 0]
+
+
+@pytest.mark.parametrize(
+    "obj,json",
+    [
+        (
+            BasicRedisQuota(prefix="p", subscope=1, limit=None, window=1, reason_code="go_away"),
+            {"prefix": "p", "subscope": "1", "window": 1, "reasonCode": "go_away"},
+        ),
+        (BasicRedisQuota(limit=0, reason_code="go_away"), {"limit": 0, "reasonCode": "go_away"}),
+    ],
+)
+def test_quotas_to_json(obj, json):
+    assert obj.to_json() == json
