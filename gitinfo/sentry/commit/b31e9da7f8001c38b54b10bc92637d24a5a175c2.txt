commit b31e9da7f8001c38b54b10bc92637d24a5a175c2
Author: Mark Story <mark@mark-story.com>
Date:   Mon Apr 8 14:57:53 2019 -0400

    fix(search) Don't use organization tag endpoints in sentry9 view (#12683)
    
    We were using the snuba backed organization tag value endpoint in the
    sentry9 view which doesn't work in on-premise 9.1 as there is no snuba
    there.
    
    Fixes GH-12661
    Fixes SEN-455

diff --git a/src/sentry/static/sentry/app/actionCreators/tags.jsx b/src/sentry/static/sentry/app/actionCreators/tags.jsx
index b82514212a..2a94310402 100644
--- a/src/sentry/static/sentry/app/actionCreators/tags.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/tags.jsx
@@ -75,6 +75,23 @@ export function fetchProjectTags(orgId, projectId) {
   return promise;
 }
 
+/**
+ * Fetch tag values for a single project. Used for sentry9 views.
+ */
+export function fetchProjectTagValues(api, orgId, projectId, tagKey, search = null) {
+  const url = `/projects/${orgId}/${projectId}/tags/${tagKey}/values/`;
+
+  const query = {};
+  if (search) {
+    query.query = search;
+  }
+
+  return api.requestPromise(url, {
+    method: 'GET',
+    query,
+  });
+}
+
 /**
  * Fetch tags for an organization or a subset or projects.
  */
diff --git a/src/sentry/static/sentry/app/views/stream/stream.jsx b/src/sentry/static/sentry/app/views/stream/stream.jsx
index 4e3d5c9f86..6ad48bde6d 100644
--- a/src/sentry/static/sentry/app/views/stream/stream.jsx
+++ b/src/sentry/static/sentry/app/views/stream/stream.jsx
@@ -21,7 +21,7 @@ import ConfigStore from 'app/stores/configStore';
 import EnvironmentStore from 'app/stores/environmentStore';
 import ErrorRobot from 'app/components/errorRobot';
 import {fetchProjectSavedSearches} from 'app/actionCreators/savedSearches';
-import {fetchTagValues} from 'app/actionCreators/tags';
+import {fetchProjectTagValues} from 'app/actionCreators/tags';
 import GroupStore from 'app/stores/groupStore';
 import LoadingError from 'app/components/loadingError';
 import LoadingIndicator from 'app/components/loadingIndicator';
@@ -662,7 +662,7 @@ const Stream = createReactClass({
   tagValueLoader(key, search) {
     const {orgId} = this.props.params;
     const project = this.getProject();
-    return fetchTagValues(this.api, orgId, key, search, project.id);
+    return fetchProjectTagValues(this.api, orgId, project.slug, key, search);
   },
 
   render() {
