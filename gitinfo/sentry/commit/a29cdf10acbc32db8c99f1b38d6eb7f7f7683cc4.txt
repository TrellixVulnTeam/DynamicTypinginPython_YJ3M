commit a29cdf10acbc32db8c99f1b38d6eb7f7f7683cc4
Author: Billy Vong <billyvg@users.noreply.github.com>
Date:   Fri May 11 09:08:37 2018 -0700

    fix(sidebar): Apply max height to org selector  (APP-184) (#8405)

diff --git a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/switchOrganization.jsx b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/switchOrganization.jsx
index 8b602fb93b..4940769c20 100644
--- a/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/switchOrganization.jsx
+++ b/src/sentry/static/sentry/app/components/sidebar/sidebarDropdown/switchOrganization.jsx
@@ -47,17 +47,21 @@ class SwitchOrganization extends React.Component {
                   data-test-id="sidebar-switch-org-menu"
                   {...getMenuProps({isStyled: true})}
                 >
-                  {organizations.map(organization => (
-                    <SidebarMenuItem
-                      key={organization.slug}
-                      to={`/${organization.slug}/`}
-                    >
-                      <SidebarOrgSummary organization={organization} />
-                    </SidebarMenuItem>
-                  ))}
-                  {hasOrganizations && canCreateOrganization && <Divider />}
+                  <OrganizationList>
+                    {organizations.map(organization => (
+                      <SidebarMenuItem
+                        key={organization.slug}
+                        to={`/${organization.slug}/`}
+                      >
+                        <SidebarOrgSummary organization={organization} />
+                      </SidebarMenuItem>
+                    ))}
+                  </OrganizationList>
+                  {hasOrganizations &&
+                    canCreateOrganization && <Divider css={{marginTop: 0}} />}
                   {canCreateOrganization && (
                     <SidebarMenuItem
+                      data-test-id="sidebar-create-org"
                       to={'/organizations/new/'}
                       style={{alignItems: 'center'}}
                     >
@@ -78,6 +82,7 @@ class SwitchOrganization extends React.Component {
 }
 const SwitchOrganizationContainer = withOrganizations(SwitchOrganization);
 
+export {SwitchOrganization};
 export default SwitchOrganizationContainer;
 
 const AddIcon = styled(InlineSvg)`
@@ -118,3 +123,8 @@ const SwitchOrganizationMenu = styled('div')`
   top: 0;
   left: 256px;
 `;
+
+const OrganizationList = styled('div')`
+  max-height: 350px;
+  overflow-y: auto;
+`;
diff --git a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
index 39518edb56..f11198b1dd 100644
--- a/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
+++ b/tests/js/spec/components/sidebar/__snapshots__/index.spec.jsx.snap
@@ -15,7 +15,13 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
     onMouseEnter={[Function]}
     onMouseLeave={[Function]}
   >
+    <OrganizationList>
+      <div
+        className="css-1qovpib-OrganizationList ejspo4a5"
+      />
+    </OrganizationList>
     <SidebarMenuItem
+      data-test-id="sidebar-create-org"
       style={
         Object {
           "alignItems": "center",
@@ -24,6 +30,7 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
       to="/organizations/new/"
     >
       <MenuItemLink
+        data-test-id="sidebar-create-org"
         style={
           Object {
             "alignItems": "center",
@@ -33,6 +40,7 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
       >
         <Component
           className="css-1vsrn4x-MenuItemLink ebifsjx1"
+          data-test-id="sidebar-create-org"
           style={
             Object {
               "alignItems": "center",
@@ -42,6 +50,7 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
         >
           <Link
             className="css-1vsrn4x-MenuItemLink ebifsjx1"
+            data-test-id="sidebar-create-org"
             style={
               Object {
                 "alignItems": "center",
@@ -51,6 +60,7 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
           >
             <Link
               className="css-1vsrn4x-MenuItemLink ebifsjx1"
+              data-test-id="sidebar-create-org"
               onlyActiveOnIndex={false}
               style={
                 Object {
@@ -61,6 +71,7 @@ exports[`Sidebar SidebarDropdown can open "Switch Organization" sub-menu 1`] = `
             >
               <a
                 className="css-1vsrn4x-MenuItemLink ebifsjx1"
+                data-test-id="sidebar-create-org"
                 onClick={[Function]}
                 style={
                   Object {
diff --git a/tests/js/spec/components/sidebar/switchOrganization.spec.jsx b/tests/js/spec/components/sidebar/switchOrganization.spec.jsx
new file mode 100644
index 0000000000..1eb0f92c53
--- /dev/null
+++ b/tests/js/spec/components/sidebar/switchOrganization.spec.jsx
@@ -0,0 +1,64 @@
+import React from 'react';
+
+import {mount} from 'enzyme';
+import {SwitchOrganization} from 'app/components/sidebar/sidebarDropdown/switchOrganization';
+
+describe('SwitchOrganization', function() {
+  let routerContext = TestStubs.routerContext();
+  let {organization} = routerContext.context;
+
+  it('can list organizations', function() {
+    jest.useFakeTimers();
+    let wrapper = mount(
+      <SwitchOrganization
+        organizations={[organization, TestStubs.Organization({slug: 'org2'})]}
+      />,
+      routerContext
+    );
+
+    wrapper.find('SwitchOrganizationMenuActor').simulate('mouseEnter');
+    jest.advanceTimersByTime(500);
+    wrapper.update();
+    expect(wrapper.find('OrganizationList')).toHaveLength(1);
+    expect(wrapper.find('OrganizationList SidebarMenuItem')).toHaveLength(2);
+    jest.useRealTimers();
+  });
+
+  it('shows "Create an Org" if they have permission', function() {
+    jest.useFakeTimers();
+    let wrapper = mount(
+      <SwitchOrganization
+        organizations={[organization, TestStubs.Organization({slug: 'org2'})]}
+        canCreateOrganization
+      />,
+      routerContext
+    );
+
+    wrapper.find('SwitchOrganizationMenuActor').simulate('mouseEnter');
+    jest.advanceTimersByTime(500);
+    wrapper.update();
+    expect(
+      wrapper.find('SidebarMenuItem[data-test-id="sidebar-create-org"]')
+    ).toHaveLength(1);
+    jest.useRealTimers();
+  });
+
+  it('does not have "Create an Org" if they do not have permission', function() {
+    jest.useFakeTimers();
+    let wrapper = mount(
+      <SwitchOrganization
+        organizations={[organization, TestStubs.Organization({slug: 'org2'})]}
+        canCreateOrganization={false}
+      />,
+      routerContext
+    );
+
+    wrapper.find('SwitchOrganizationMenuActor').simulate('mouseEnter');
+    jest.advanceTimersByTime(500);
+    wrapper.update();
+    expect(
+      wrapper.find('SidebarMenuItem[data-test-id="sidebar-create-org"]')
+    ).toHaveLength(0);
+    jest.useRealTimers();
+  });
+});
