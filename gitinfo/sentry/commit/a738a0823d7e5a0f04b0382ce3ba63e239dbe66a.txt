commit a738a0823d7e5a0f04b0382ce3ba63e239dbe66a
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Feb 7 09:15:38 2019 -0800

    feat(releases): Redirect Sentry 10 users off project releases pages (#11952)
    
    If Sentry 10 users land on the project releases list or detail page
    they will automatically get redirected to the associated Sentry 10 routes.

diff --git a/src/sentry/static/sentry/app/views/releases/detail/project/index.jsx b/src/sentry/static/sentry/app/views/releases/detail/project/index.jsx
index 49d2fe6fa4..1fbae9775c 100644
--- a/src/sentry/static/sentry/app/views/releases/detail/project/index.jsx
+++ b/src/sentry/static/sentry/app/views/releases/detail/project/index.jsx
@@ -2,6 +2,7 @@ import DocumentTitle from 'react-document-title';
 import PropTypes from 'prop-types';
 import React from 'react';
 import createReactClass from 'create-react-class';
+import {browserHistory} from 'react-router';
 
 import ApiMixin from 'app/mixins/apiMixin';
 
@@ -22,6 +23,10 @@ const ProjectReleaseDetails = createReactClass({
     environment: SentryTypes.Environment,
   },
 
+  contextTypes: {
+    organization: SentryTypes.Organization,
+  },
+
   childContextTypes: {
     release: PropTypes.object,
   },
@@ -43,6 +48,15 @@ const ProjectReleaseDetails = createReactClass({
   },
 
   componentWillMount() {
+    // Redirect any Sentry 10 user that has followed an old link and ended up here
+    const {location, params: {orgId, version}} = this.props;
+    const hasSentry10 = new Set(this.context.organization.features).has('sentry10');
+    if (hasSentry10) {
+      browserHistory.replace(
+        `/organizations/${orgId}/releases/${version}/${location.search}`
+      );
+    }
+
     this.props.setProjectNavSection('releases');
     this.fetchData();
   },
diff --git a/src/sentry/static/sentry/app/views/releases/list/projectReleases/index.jsx b/src/sentry/static/sentry/app/views/releases/list/projectReleases/index.jsx
index bbb7404e02..8551191cf3 100644
--- a/src/sentry/static/sentry/app/views/releases/list/projectReleases/index.jsx
+++ b/src/sentry/static/sentry/app/views/releases/list/projectReleases/index.jsx
@@ -55,6 +55,13 @@ const ProjectReleases = createReactClass({
   },
 
   componentWillMount() {
+    // Redirect any Sentry 10 user that has followed an old link and ended up here
+    const {location, params: {orgId}} = this.props;
+    const hasSentry10 = new Set(this.context.organization.features).has('sentry10');
+    if (hasSentry10) {
+      browserHistory.replace(`/organizations/${orgId}/releases/${location.search}`);
+    }
+
     this.props.setProjectNavSection('releases');
     this.fetchData();
   },
diff --git a/tests/js/spec/views/releases/list/projectReleases.spec.jsx b/tests/js/spec/views/releases/list/projectReleases.spec.jsx
index 302c5c3e69..4c1be162ff 100644
--- a/tests/js/spec/views/releases/list/projectReleases.spec.jsx
+++ b/tests/js/spec/views/releases/list/projectReleases.spec.jsx
@@ -20,7 +20,7 @@ describe('ProjectReleases', function() {
       params: {orgId: '123', projectId: '456'},
       location: {query: {per_page: 0, query: 'derp'}},
     };
-    projectReleases = shallow(<ProjectReleases {...props} />);
+    projectReleases = shallow(<ProjectReleases {...props} />, TestStubs.routerContext());
   });
 
   afterEach(function() {
