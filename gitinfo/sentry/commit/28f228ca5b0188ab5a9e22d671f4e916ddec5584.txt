commit 28f228ca5b0188ab5a9e22d671f4e916ddec5584
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Mon Mar 21 22:31:02 2016 +0100

    Cleanup breadcrumb components and add ui event.

diff --git a/src/sentry/interfaces/breadcrumbs.py b/src/sentry/interfaces/breadcrumbs.py
index 0a065423f4..8059eb9cbd 100644
--- a/src/sentry/interfaces/breadcrumbs.py
+++ b/src/sentry/interfaces/breadcrumbs.py
@@ -58,7 +58,7 @@ def validate_payload_for_type(payload, type):
 @typevalidator('message')
 def validate_message(payload):
     rv = {}
-    for key in 'message', 'logger', 'level':
+    for key in 'message', 'logger', 'level', 'classifier':
         value = payload.get(key)
         if value is None:
             continue
@@ -109,6 +109,16 @@ def validate_query(payload):
     return rv
 
 
+@typevalidator('ui_event')
+def validate_event(payload):
+    rv = {}
+    for key in 'type', 'target', 'classifier':
+        value = payload.get(key)
+        if value is not None:
+            rv[key] = trim(value, 1024)
+    return rv
+
+
 class Breadcrumbs(Interface):
     """
     This interface stores informationt that leads up to an error in the
diff --git a/src/sentry/static/sentry/app/components/events/eventEntries.jsx b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
index 67b8d45db9..f0e484f0af 100644
--- a/src/sentry/static/sentry/app/components/events/eventEntries.jsx
+++ b/src/sentry/static/sentry/app/components/events/eventEntries.jsx
@@ -44,7 +44,7 @@ const EventEntries = React.createClass({
     breadcrumbs: require('./interfaces/breadcrumbs'),
   },
 
-  render(){
+  render() {
     let group = this.props.group;
     let evt = this.props.event;
     let isShare = this.props.isShare;
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/classifier.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/classifier.jsx
similarity index 64%
rename from src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/classifier.jsx
rename to src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/classifier.jsx
index b754c0eff7..06b021fe3a 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/classifier.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/classifier.jsx
@@ -3,19 +3,16 @@ import React from 'react';
 const Classifier = React.createClass({
   propTypes: {
     value: React.PropTypes.string.isRequired,
-    prefix: React.PropTypes.string,
     title: React.PropTypes.string,
+    hideIfEmpty: React.PropTypes.bool
   },
 
   render() {
     let value = this.props.value;
     if (!value) {
       value = 'generic';
-    } else if (this.props.prefix) {
-      if (value.substr(0, this.props.prefix.length + 1) == this.props.prefix + '.') {
-        value = value.substr(this.props.prefix.length + 1);
-      } else if (value == this.props.prefix) {
-        value = 'generic';
+      if (this.props.hideIfEmpty) {
+        return null;
       }
     }
     let title = this.props.title;
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/httpRequest.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/httpRequest.jsx
similarity index 87%
rename from src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/httpRequest.jsx
rename to src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/httpRequest.jsx
index 6486d1770d..a888d95dc3 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/httpRequest.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/httpRequest.jsx
@@ -23,7 +23,7 @@ const HttpRequestCrumbComponent = React.createClass({
         {data.response ?
           <span>({'response: '}<code>{data.response.statusCode}</code>)</span> :
           null}
-        <Classifier value={data.classifier} title="%s request" prefix="http_request" />
+        <Classifier value={data.classifier} title="%s request" />
       </p>
     );
   }
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/message.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/message.jsx
similarity index 80%
rename from src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/message.jsx
rename to src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/message.jsx
index 7f96adb20e..fc3c47fafd 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/message.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/message.jsx
@@ -1,5 +1,7 @@
 import React from 'react';
 
+import Classifier from './classifier';
+
 const MessageCrumbComponent = React.createClass({
   propTypes: {
     data: React.PropTypes.object.isRequired,
@@ -12,6 +14,7 @@ const MessageCrumbComponent = React.createClass({
         {data.level ? <span className="level">{data.level}</span> : null}
         {' ' + data.message + ' '}
         {data.logger ? <span className="logger">[{data.logger}]</span> : null}
+        <Classifier value={data.classifier} title="%s" hideIfEmpty={true}/>
       </p>
     );
   }
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/query.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/query.jsx
similarity index 50%
rename from src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/query.jsx
rename to src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/query.jsx
index b04eabc3dc..665eb8cb75 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/query.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/query.jsx
@@ -10,21 +10,19 @@ const QueryCrumbComponent = React.createClass({
   render() {
     let data = this.props.data;
     let placeholderIdx = 0;
-    let queryElements = [];
 
-    data.query.split(/(%s)/).forEach((item, idx) => {
-      queryElements.push(
-        item === '%s'
-          ? <span key={idx} className="param">{
-              data.params ? data.params[placeholderIdx++] : item}</span>
-          : <span key={idx} className="literal">{item}</span>
-      );
+    let queryElements = data.query.split(/(%s)/).map((item, idx) => {
+      return item === '%s'
+        ? <span key={idx} className="param">{
+            data.params ? data.params[placeholderIdx++] : item}</span>
+        : <span key={idx} className="literal">{item}</span>
+      ;
     });
 
     return (
       <p>
         <strong>Query:</strong> <code>{queryElements}</code>
-        <Classifier value={data.classifier} title="%s query" prefix="query" />
+        <Classifier value={data.classifier} title="%s query" />
       </p>
     );
   }
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/rpc.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/rpc.jsx
similarity index 83%
rename from src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/rpc.jsx
rename to src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/rpc.jsx
index b5a4fb5475..4d0f1e2653 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumb-components/rpc.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/rpc.jsx
@@ -12,7 +12,7 @@ const RpcCrumbComponent = React.createClass({
     return (
       <p>
         <strong>Remote call to</strong> <code>{data.endpoint}</code>
-        <Classifier value={data.classifier} prefix="rpc" title="%s call"/>
+        <Classifier value={data.classifier} title="%s call"/>
       </p>
     );
   }
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/uiEvent.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/uiEvent.jsx
new file mode 100644
index 0000000000..c6914bf6c4
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbComponents/uiEvent.jsx
@@ -0,0 +1,21 @@
+import React from 'react';
+
+import Classifier from './classifier';
+
+const UiEventComponent = React.createClass({
+  propTypes: {
+    data: React.PropTypes.object.isRequired,
+  },
+
+  render() {
+    let data = this.props.data;
+    return (
+      <p>
+        <strong>{data.event || 'UI Event'}</strong> on <code>{data.target || 'undefined target'}</code>
+        <Classifier value={data.classifier} title="%s call"/>
+      </p>
+    );
+  }
+});
+
+export default UiEventComponent;
diff --git a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbs.jsx b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbs.jsx
index 6d7a9012db..28dd396cbe 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbs.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/breadcrumbs.jsx
@@ -2,10 +2,11 @@ import React from 'react';
 import GroupEventDataSection from '../eventDataSection';
 import PropTypes from '../../../proptypes';
 
-import MessageCrumbComponent from './breadcrumb-components/message';
-import RpcCrumbComponent from './breadcrumb-components/rpc';
-import QueryCrumbComponent from './breadcrumb-components/query';
-import HttpRequestCrumbComponent from './breadcrumb-components/httpRequest';
+import MessageCrumbComponent from './breadcrumbComponents/message';
+import RpcCrumbComponent from './breadcrumbComponents/rpc';
+import QueryCrumbComponent from './breadcrumbComponents/query';
+import HttpRequestCrumbComponent from './breadcrumbComponents/httpRequest';
+import UiEventComponent from './breadcrumbComponents/uiEvent';
 
 
 const crumbComponents = {
@@ -13,6 +14,7 @@ const crumbComponents = {
   rpc: RpcCrumbComponent,
   query: QueryCrumbComponent,
   http_request: HttpRequestCrumbComponent,
+  ui_event: UiEventComponent,
 };
 
 
