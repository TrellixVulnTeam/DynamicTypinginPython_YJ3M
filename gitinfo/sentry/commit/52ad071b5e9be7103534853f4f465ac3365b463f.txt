commit 52ad071b5e9be7103534853f4f465ac3365b463f
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri May 20 15:32:48 2016 -0700

    devserver: run local https proxy when url-prefix is https

diff --git a/src/sentry/runner/commands/devserver.py b/src/sentry/runner/commands/devserver.py
index 62a092dbe4..7f4e4e032e 100644
--- a/src/sentry/runner/commands/devserver.py
+++ b/src/sentry/runner/commands/devserver.py
@@ -28,8 +28,26 @@ def devserver(reload, watchers, workers, bind):
 
     import os
     from django.conf import settings
+    from sentry import options
     from sentry.services.http import SentryHTTPServer
 
+    url_prefix = options.get('system.url-prefix', '')
+    needs_https = url_prefix.startswith('https://')
+    has_https = False
+
+    if needs_https:
+        from subprocess import check_output
+        try:
+            check_output(['which', 'https'])
+            has_https = True
+        except Exception:
+            has_https = False
+            from sentry.runner.initializer import show_big_error
+            show_big_error([
+                'missing `https` on your `$PATH`, but https is needed',
+                '`$ brew install mattrobenolt/stuff/https`',
+            ])
+
     uwsgi_overrides = {
         # Make sure we don't try and use uwsgi protocol
         'protocol': 'http',
@@ -55,6 +73,15 @@ def devserver(reload, watchers, workers, bind):
             ('cron', ['sentry', 'run', 'cron', '-l', 'INFO', '--autoreload']),
         ]
 
+    if needs_https and has_https:
+        from urlparse import urlparse
+        parsed_url = urlparse(url_prefix)
+        https_port = str(parsed_url.port or 443)
+        https_host = parsed_url.hostname
+        daemons += [
+            ('https', ['https', '-host', https_host, '-listen', host + ':' + https_port, bind]),
+        ]
+
     # A better log-format for local dev when running through honcho,
     # but if there aren't any other daemons, we don't want to override.
     if daemons:
