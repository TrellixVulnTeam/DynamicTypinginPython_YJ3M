commit 2fc7fa63ecc320707c69b6818387c2acc71da253
Author: James Cunningham <cunninghamjt09@gmail.com>
Date:   Tue Jan 29 17:26:30 2019 -0800

    Create a setting to skip publishing internal metrics based on prefix. (#11782)
    
    * Create a setting to skip publishing internal metrics based on prefix.
    
    * Change formatting, instantiate setting as a tuple.
    
    * Use a list but cast to tuple in the module level.
    
    * Spelling.
    
    * Spelling. Again.

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 2009288a29..33486205da 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -1077,6 +1077,7 @@ SENTRY_METRICS_BACKEND = 'sentry.metrics.dummy.DummyMetricsBackend'
 SENTRY_METRICS_OPTIONS = {}
 SENTRY_METRICS_SAMPLE_RATE = 1.0
 SENTRY_METRICS_PREFIX = 'sentry.'
+SENTRY_METRICS_SKIP_INTERNAL_PREFIXES = []  # Order this by most frequent prefixes.
 
 # URI Prefixes for generating DSN URLs
 # (Defaults to URL_PREFIX by default)
diff --git a/src/sentry/utils/metrics.py b/src/sentry/utils/metrics.py
index 585ffe3ac2..5e33ecc8b3 100644
--- a/src/sentry/utils/metrics.py
+++ b/src/sentry/utils/metrics.py
@@ -12,6 +12,9 @@ from threading import Thread
 from six.moves.queue import Queue
 
 
+metrics_skip_internal_prefixes = tuple(settings.SENTRY_METRICS_SKIP_INTERNAL_PREFIXES)
+
+
 def get_default_backend():
     from sentry.utils.imports import import_string
 
@@ -85,7 +88,11 @@ internal = InternalMetrics()
 
 def incr(key, amount=1, instance=None, tags=None, skip_internal=True):
     sample_rate = settings.SENTRY_METRICS_SAMPLE_RATE
-    if not skip_internal and _should_sample():
+    if (
+        not skip_internal and
+        _should_sample() and
+        not key.startswith(metrics_skip_internal_prefixes)
+    ):
         internal.incr(key, instance, tags, amount)
     try:
         backend.incr(key, instance, tags, amount, sample_rate)
