commit 6f17e20621839847e92eee22a8db4d2214cb43a6
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Apr 2 16:46:07 2012 -0700

    Correct issue with project_list not always representing the authenticated users list of projects

diff --git a/sentry/templates/sentry/dashboard.html b/sentry/templates/sentry/dashboard.html
index df154076ef..dcd9be4d2e 100644
--- a/sentry/templates/sentry/dashboard.html
+++ b/sentry/templates/sentry/dashboard.html
@@ -9,10 +9,10 @@
 
 {% block content %}
     <section class="body">
-        {% if project_list %}
+        {% if PROJECT_LIST %}
             <div class="alert alert-info">Select a project to view the stream of events...</div>
             <ul class="thumbnails sparkline-grid">
-                {% for project in project_list %}
+                {% for project in PROJECT_LIST %}
                     <li class="thumbnail">
                         <a href="{% url sentry project.pk %}">
                             <h3>{{ project.name }}</h3>
diff --git a/sentry/templates/sentry/header.html b/sentry/templates/sentry/header.html
index a722f08e87..5273eebc7c 100644
--- a/sentry/templates/sentry/header.html
+++ b/sentry/templates/sentry/header.html
@@ -26,38 +26,40 @@
                     {% endif %}
                 </ul>
                 <ul class="nav pull-right">
-                    {% if request.user.is_authenticated %}
-                        <li class="dropdown">
-                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans "Projects" %} <span class="caret"></span></a>
-                            <ul class="dropdown-menu">
-                                <li><a href="{% url sentry-project-list %}">{% trans "Manage" %}</a></li>
-                                {% if project_list %}
+                    {% block account_nav %}
+                        {% if request.user.is_authenticated %}
+                            <li class="dropdown">
+                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans "Projects" %} <span class="caret"></span></a>
+                                <ul class="dropdown-menu">
+                                    <li><a href="{% url sentry-project-list %}">{% trans "Manage" %}</a></li>
+                                    {% if PROJECT_LIST %}
+                                        <li class="divider"></li>
+                                        {% for p in PROJECT_LIST %}
+                                            <li{% if project == p %} class="active"{% endif %}><a href="{% url sentry p.pk %}">{{ p.name }}</a></li>
+                                        {% endfor %}
+                                    {% endif %}
+                                    {% if can_create_projects %}
+                                        <li class="divider"></li>
+                                        <li><a href="{% url sentry-new-project %}">{% trans "Create a new project" %}</a></li>
+                                    {% endif %}
+                                </ul>
+                            </li>
+                            <li class="dropdown">
+                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans "Account" %} <span class="caret"></span></a>
+                                <ul class="dropdown-menu">
+                                    <li><a href="{% url sentry-account-settings %}">{% trans "Settings" %}</a></li>
+                                    {% if request.user.is_staff %}
+                                        <li class="divider"></li>
+                                        <li><a href="{% url sentry-admin-status %}">{% trans "Admin" %}</a></li>
+                                    {% endif %}
                                     <li class="divider"></li>
-                                    {% for p in project_list %}
-                                        <li{% if project == p %} class="active"{% endif %}><a href="{% url sentry p.pk %}">{{ p.name }}</a></li>
-                                    {% endfor %}
-                                {% endif %}
-                                {% if can_create_projects %}
-                                    <li class="divider"></li>
-                                    <li><a href="{% url sentry-new-project %}">{% trans "Create a new project" %}</a></li>
-                                {% endif %}
-                            </ul>
-                        </li>
-                        <li class="dropdown">
-                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans "Account" %} <span class="caret"></span></a>
-                            <ul class="dropdown-menu">
-                                <li><a href="{% url sentry-account-settings %}">{% trans "Settings" %}</a></li>
-                                {% if request.user.is_staff %}
-                                    <li class="divider"></li>
-                                    <li><a href="{% url sentry-admin-status %}">{% trans "Admin" %}</a></li>
-                                {% endif %}
-                                <li class="divider"></li>
-                                <li><a href="{% url sentry-logout %}">{% trans "Logout" %}</a></li>
-                            </ul>
-                        </li>
-                    {% else %}
-                        <li><a href="{% url sentry-login %}">{% trans "Login" %}</a></li>
-                    {% endif %}
+                                    <li><a href="{% url sentry-logout %}">{% trans "Logout" %}</a></li>
+                                </ul>
+                            </li>
+                        {% else %}
+                            <li><a href="{% url sentry-login %}">{% trans "Login" %}</a></li>
+                        {% endif %}
+                    {% endblock %}
                 </ul>
              </div>
         </div>
diff --git a/sentry/templates/sentry/layout.html b/sentry/templates/sentry/layout.html
index a07f452ca2..df620508dc 100644
--- a/sentry/templates/sentry/layout.html
+++ b/sentry/templates/sentry/layout.html
@@ -78,7 +78,7 @@
                             {% block sidebar %}
                                 <h6>{% trans "Your Projects" %}</h6>
                                 <ul class="nav nav-tabs nav-stacked">
-                                    {% for p in project_list %}
+                                    {% for p in PROJECT_LIST %}
                                         <li{% if p == project %} class="active"{% endif %}><a href="{% url sentry-manage-project p.pk %}">{{ p.name }}</a></li>
                                     {% endfor %}
                                 </ul>
diff --git a/sentry/templates/sentry/projects/list.html b/sentry/templates/sentry/projects/list.html
index ce3ccf8268..490aebdb3c 100644
--- a/sentry/templates/sentry/projects/list.html
+++ b/sentry/templates/sentry/projects/list.html
@@ -19,7 +19,7 @@
 
 {% block content %}
     <section class="body">
-        {% if project_list %}
+        {% if PROJECT_LIST %}
             <p>{% trans "The following is a list of projects that you are a member of." %}</p>
             <table class="table table-bordered table-striped">
                 <colgroup>
@@ -37,7 +37,7 @@
                     </tr>
                 </thead>
                 <tbody>
-                    {% for project in project_list %}
+                    {% for project in PROJECT_LIST %}
                         <tr>
                             <td>
                                 <a href="{% url sentry-manage-project project.pk %}">{{ project.name }}</a><br/>
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index d0aaba942b..59ad257b6b 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -48,7 +48,7 @@ def project_list(request):
         project_list[project_id].member_type = member.get_type_display()
 
     return render_to_response('sentry/projects/list.html', {
-        'project_list': project_list.values(),
+        'PROJECT_LIST': project_list.values(),
     }, request)
 
 
diff --git a/sentry/web/helpers.py b/sentry/web/helpers.py
index 50911f26c9..347b320a3f 100644
--- a/sentry/web/helpers.py
+++ b/sentry/web/helpers.py
@@ -97,8 +97,8 @@ def get_default_context(request, existing_context=None):
             'request': request,
             'can_create_projects': can_create_projects(request.user),
         })
-        if not existing_context or 'project_list' not in existing_context:
-            context['project_list'] = get_project_list(request.user).values()
+        if not existing_context or 'PROJECT_LIST' not in existing_context:
+            context['PROJECT_LIST'] = get_project_list(request.user).values()
 
     return context
 
