commit 0ad0bf838665178b2377c150f431a974c2df6769
Author: Ayesha Omarali <ayesha.omarali@gmail.com>
Date:   Wed Jun 20 13:33:25 2018 -0700

    feat(ui): Project Chooser Dropdown Platformicons (#8618)
    
    Platformicons display max 3 platforms used per project in dropdown/project chooser.
    Fixes APP-280 (https://getsentry.atlassian.net/browse/APP-280)

diff --git a/docs-ui/components/platformList.stories.js b/docs-ui/components/platformList.stories.js
new file mode 100644
index 0000000000..fdc78de851
--- /dev/null
+++ b/docs-ui/components/platformList.stories.js
@@ -0,0 +1,14 @@
+import React from 'react';
+import {storiesOf} from '@storybook/react';
+import {withInfo} from '@storybook/addon-info';
+
+import PlatformList from 'app/components/platformList';
+
+storiesOf('Platform List', module).add(
+  'default',
+  withInfo('Stacked list of platform and framework icons')(() => (
+    <div style={{padding: 20, backgroundColor: '#ffffff'}}>
+      <PlatformList platforms={['java', 'php', 'javascript', 'cocoa', 'ruby']} />
+    </div>
+  ))
+);
diff --git a/src/sentry/static/sentry/app/components/platformList.jsx b/src/sentry/static/sentry/app/components/platformList.jsx
new file mode 100644
index 0000000000..b60ff188bc
--- /dev/null
+++ b/src/sentry/static/sentry/app/components/platformList.jsx
@@ -0,0 +1,64 @@
+import React from 'react';
+import PropTypes from 'prop-types';
+import styled from 'react-emotion';
+
+import Platformicon from 'app/components/platformicon';
+import space from '../styles/space';
+
+const MAX_PLATFORMS = 3;
+const ICON_SIZE = 16;
+
+class PlatformList extends React.Component {
+  static propTypes = {
+    platforms: PropTypes.array,
+  };
+
+  static defaultProps = {
+    platforms: [],
+  };
+
+  getIcon(platform) {
+    return (
+      <StyledPlatformIcon key={platform} platform={platform} size={ICON_SIZE + 'px'} />
+    );
+  }
+
+  getIcons(platforms) {
+    return platforms
+      .slice()
+      .reverse()
+      .map(this.getIcon);
+  }
+
+  render() {
+    const {platforms} = this.props;
+    const platformsPreview = platforms.slice(0, MAX_PLATFORMS);
+    return (
+      <PlatformIcons>
+        {platforms.length > 0 ? (
+          this.getIcons(platformsPreview)
+        ) : (
+          <StyledPlatformIcon size={ICON_SIZE + 'px'} platform="default" />
+        )}
+      </PlatformIcons>
+    );
+  }
+}
+
+const PlatformIcons = styled('div')`
+  margin-right: ${space(0.5)};
+  display: flex;
+  flex-direction: row;
+  justify-content: flex-end;
+  width: 24px;
+`;
+
+const StyledPlatformIcon = styled(Platformicon)`
+  border-radius: 3px;
+  box-shadow: 0 0 0 1px #fff;
+  &:not(:first-child) {
+    margin-left: ${ICON_SIZE * -1 + 4}px;
+  }
+`;
+
+export default PlatformList;
diff --git a/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx b/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
index 87b8168fc2..4a16ceb554 100644
--- a/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
+++ b/src/sentry/static/sentry/app/components/projectHeader/projectSelector.jsx
@@ -3,6 +3,7 @@ import React from 'react';
 import createReactClass from 'create-react-class';
 import {browserHistory} from 'react-router';
 import classNames from 'classnames';
+import {Flex} from 'grid-emotion';
 
 import ApiMixin from 'app/mixins/apiMixin';
 
@@ -10,9 +11,11 @@ import ProjectLabel from 'app/components/projectLabel';
 import DropdownLink from 'app/components/dropdownLink';
 import MenuItem from 'app/components/menuItem';
 import Link from 'app/components/link';
+import PlatformList from 'app/components/platformList';
 
 import {sortArray} from 'app/utils';
 import {t} from 'app/locale';
+import styled from 'react-emotion';
 
 const ProjectSelector = createReactClass({
   displayName: 'ProjectSelector',
@@ -199,6 +202,12 @@ const ProjectSelector = createReactClass({
   getProjectNode(team, project, highlightText, hasSingleTeam, isSelected) {
     let projectId = project.slug;
     let label = this.getProjectLabel(team, project, hasSingleTeam, highlightText);
+    let platforms;
+    if (typeof project.platforms !== 'undefined') {
+      platforms = project && project.platforms;
+    } else {
+      platforms = [];
+    }
 
     let menuItemProps = {
       key: projectId, // TODO: what if two projects w/ same name under diff orgs?
@@ -214,8 +223,14 @@ const ProjectSelector = createReactClass({
 
     return (
       <MenuItem {...menuItemProps}>
-        {project.isBookmarked && <span className="icon-star-solid bookmark " />}
-        {label}
+        {/*ideally an icon here...*/}
+        <ProjectBadge>
+          <Flex>
+            <PlatformList platforms={platforms} />
+            {label}
+          </Flex>
+          {project.isBookmarked && <BookmarkIcon />}
+        </ProjectBadge>
       </MenuItem>
     );
   },
@@ -393,4 +408,18 @@ const ProjectSelector = createReactClass({
   },
 });
 
+const ProjectBadge = styled.div`
+  display: flex;
+  align-items: center;
+  justify-content: space-between;
+`;
+
+const BookmarkIcon = styled(props => (
+  <div {...props}>
+    <span className="icon-star-solid bookmark" />
+  </div>
+))`
+  font-size: 12px;
+`;
+
 export default ProjectSelector;
diff --git a/src/sentry/static/sentry/app/views/organizationDashboard/platformList.jsx b/src/sentry/static/sentry/app/views/organizationDashboard/platformList.jsx
deleted file mode 100644
index 9460f74251..0000000000
--- a/src/sentry/static/sentry/app/views/organizationDashboard/platformList.jsx
+++ /dev/null
@@ -1,95 +0,0 @@
-import React from 'react';
-import PropTypes from 'prop-types';
-import {withRouter} from 'react-router';
-import styled from 'react-emotion';
-import {Flex} from 'grid-emotion';
-
-import SentryTypes from 'app/proptypes';
-import {t} from 'app/locale';
-import Button from 'app/components/buttons/button';
-import Platformicon from 'app/components/platformicon';
-
-const MAX_PLATFORMS = 5;
-
-class PlatformList extends React.Component {
-  static propTypes = {
-    project: SentryTypes.Project,
-    orgId: PropTypes.string,
-  };
-
-  getIcon(platform) {
-    return (
-      <StyledPlatformiconWrapper key={platform}>
-        <StyledPlatformicon platform={platform} size="24" />
-      </StyledPlatformiconWrapper>
-    );
-  }
-
-  getIcons(platforms) {
-    return (
-      <Flex direction="row-reverse" p={2}>
-        {platforms
-          .slice()
-          .reverse()
-          .map(this.getIcon)}
-      </Flex>
-    );
-  }
-  render() {
-    const {project, orgId} = this.props;
-    const platforms =
-      project && project.platforms && project.platforms.slice(0, MAX_PLATFORMS);
-
-    const link = `/${orgId}/${project.slug}/getting-started/${project.platform
-      ? project.platform + '/'
-      : ''}`;
-
-    if (!platforms || !platforms.length) {
-      return (
-        <NoPlatforms align="center" p={2}>
-          {project.firstEvent ? (
-            t('No platforms yet')
-          ) : (
-            <Button size="small" to={link}>
-              {t('Install an SDK')}
-            </Button>
-          )}
-        </NoPlatforms>
-      );
-    }
-
-    return (
-      <Flex align="center">
-        <div className="org-dashboard-platform-list">{this.getIcons(platforms)}</div>
-        <PlatformText>{platforms.join(', ')}</PlatformText>
-      </Flex>
-    );
-  }
-}
-
-const StyledPlatformiconWrapper = styled.span`
-  display: block;
-  margin-right: -8px;
-`;
-
-const StyledPlatformicon = styled(Platformicon)`
-  display: block;
-  color: white;
-  font-size: 22px;
-  border-radius: 4px;
-  box-shadow: 0 0 0 2px #fff;
-  max-width: 24px;
-`;
-
-const PlatformText = styled.div`
-  color: ${p => p.theme.gray2};
-  font-size: 13px;
-  line-height: 13px;
-`;
-
-const NoPlatforms = styled(Flex)`
-  color: ${p => p.theme.gray2};
-  height: 56px;
-`;
-
-export default withRouter(PlatformList);
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index bd9181b381..95e89e9667 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -2970,8 +2970,7 @@ ul.tag-list {
 }
 
 .client-platform-list,
-.client-platform,
-.org-dashboard-platform-list {
+.client-platform {
   li,
   span {
     &.python .platformicon {
diff --git a/src/sentry/templates/sentry/emails/reports/body.html b/src/sentry/templates/sentry/emails/reports/body.html
index bd8a821119..cb1f493d7d 100644
--- a/src/sentry/templates/sentry/emails/reports/body.html
+++ b/src/sentry/templates/sentry/emails/reports/body.html
@@ -33,7 +33,7 @@
       height: 16px;
       vertical-align: bottom;
       display: inline-block;
-      margin: 0 5px 0 15px;
+      margin: 0 15px 0 15px;
       border-radius: 3px;
       color: #fff;
     }
diff --git a/tests/js/spec/components/platformList.spec.jsx b/tests/js/spec/components/platformList.spec.jsx
new file mode 100644
index 0000000000..3f2ade8a07
--- /dev/null
+++ b/tests/js/spec/components/platformList.spec.jsx
@@ -0,0 +1,20 @@
+import React from 'react';
+import {mount} from 'enzyme';
+import PlatformList from 'app/components/platformList';
+
+describe('PlatformList', function() {
+  it('renders max of three icons from platforms', function() {
+    const platforms = ['java', 'php', 'javascript', 'cocoa', 'ruby'];
+    const wrapper = mount(<PlatformList platforms={platforms} />);
+    const icons = wrapper.find('StyledPlatformIcon');
+    expect(icons).toHaveLength(3);
+  });
+
+  it('renders default if no platforms', function() {
+    const platforms = [];
+    const wrapper = mount(<PlatformList platforms={platforms} />);
+    const icons = wrapper.find('StyledPlatformIcon');
+    expect(icons.first().prop('platform')).toBe('default');
+    expect(icons).toHaveLength(1);
+  });
+});
diff --git a/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap b/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
index 1d4c86892e..f4d4be3f08 100644
--- a/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
+++ b/tests/js/spec/components/projectHeader/__snapshots__/projectSelector.spec.jsx.snap
@@ -160,14 +160,65 @@ exports[`ProjectSelector render() can filter projects by project name 1`] = `
                     onClick={[Function]}
                     tabIndex="-1"
                   >
-                    <span>
-                      <strong
-                        className="highlight"
+                    <ProjectBadge>
+                      <div
+                        className="css-1dx2nj3-ProjectBadge et07ovj0"
                       >
-                        Another
-                      </strong>
-                       Project
-                    </span>
+                        <Flex>
+                          <Base
+                            className="css-sncxrr"
+                          >
+                            <div
+                              className="css-sncxrr"
+                              is={null}
+                            >
+                              <PlatformList
+                                platforms={Array []}
+                              >
+                                <PlatformIcons>
+                                  <div
+                                    className="css-10b0mx0-PlatformIcons ezvce7z0"
+                                  >
+                                    <StyledPlatformIcon
+                                      platform="default"
+                                      size="16px"
+                                    >
+                                      <Platformicon
+                                        className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                        platform="default"
+                                        size="16px"
+                                      >
+                                        <img
+                                          className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                          height="16px"
+                                          src={
+                                            Object {
+                                              "default": Object {
+                                                "id": "test",
+                                                "viewBox": Object {},
+                                              },
+                                            }
+                                          }
+                                          width="16px"
+                                        />
+                                      </Platformicon>
+                                    </StyledPlatformIcon>
+                                  </div>
+                                </PlatformIcons>
+                              </PlatformList>
+                              <span>
+                                <strong
+                                  className="highlight"
+                                >
+                                  Another
+                                </strong>
+                                 Project
+                              </span>
+                            </div>
+                          </Base>
+                        </Flex>
+                      </div>
+                    </ProjectBadge>
                   </a>
                 </li>
               </MenuItem>
@@ -340,7 +391,58 @@ exports[`ProjectSelector render() can filter projects by team name/project name
                     onClick={[Function]}
                     tabIndex="-1"
                   >
-                    Another Project
+                    <ProjectBadge>
+                      <div
+                        className="css-1dx2nj3-ProjectBadge et07ovj0"
+                      >
+                        <Flex>
+                          <Base
+                            className="css-sncxrr"
+                          >
+                            <div
+                              className="css-sncxrr"
+                              is={null}
+                            >
+                              <PlatformList
+                                platforms={Array []}
+                              >
+                                <PlatformIcons>
+                                  <div
+                                    className="css-10b0mx0-PlatformIcons ezvce7z0"
+                                  >
+                                    <StyledPlatformIcon
+                                      platform="default"
+                                      size="16px"
+                                    >
+                                      <Platformicon
+                                        className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                        platform="default"
+                                        size="16px"
+                                      >
+                                        <img
+                                          className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                          height="16px"
+                                          src={
+                                            Object {
+                                              "default": Object {
+                                                "id": "test",
+                                                "viewBox": Object {},
+                                              },
+                                            }
+                                          }
+                                          width="16px"
+                                        />
+                                      </Platformicon>
+                                    </StyledPlatformIcon>
+                                  </div>
+                                </PlatformIcons>
+                              </PlatformList>
+                              Another Project
+                            </div>
+                          </Base>
+                        </Flex>
+                      </div>
+                    </ProjectBadge>
                   </a>
                 </li>
               </MenuItem>
@@ -362,14 +464,65 @@ exports[`ProjectSelector render() can filter projects by team name/project name
                     onClick={[Function]}
                     tabIndex="-1"
                   >
-                    <span>
-                      <strong
-                        className="highlight"
+                    <ProjectBadge>
+                      <div
+                        className="css-1dx2nj3-ProjectBadge et07ovj0"
                       >
-                        Test
-                      </strong>
-                       Project
-                    </span>
+                        <Flex>
+                          <Base
+                            className="css-sncxrr"
+                          >
+                            <div
+                              className="css-sncxrr"
+                              is={null}
+                            >
+                              <PlatformList
+                                platforms={Array []}
+                              >
+                                <PlatformIcons>
+                                  <div
+                                    className="css-10b0mx0-PlatformIcons ezvce7z0"
+                                  >
+                                    <StyledPlatformIcon
+                                      platform="default"
+                                      size="16px"
+                                    >
+                                      <Platformicon
+                                        className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                        platform="default"
+                                        size="16px"
+                                      >
+                                        <img
+                                          className="css-b9p6z1-StyledPlatformIcon ezvce7z1"
+                                          height="16px"
+                                          src={
+                                            Object {
+                                              "default": Object {
+                                                "id": "test",
+                                                "viewBox": Object {},
+                                              },
+                                            }
+                                          }
+                                          width="16px"
+                                        />
+                                      </Platformicon>
+                                    </StyledPlatformIcon>
+                                  </div>
+                                </PlatformIcons>
+                              </PlatformList>
+                              <span>
+                                <strong
+                                  className="highlight"
+                                >
+                                  Test
+                                </strong>
+                                 Project
+                              </span>
+                            </div>
+                          </Base>
+                        </Flex>
+                      </div>
+                    </ProjectBadge>
                   </a>
                 </li>
               </MenuItem>
@@ -430,9 +583,16 @@ exports[`ProjectSelector render() lists projects and has filter 1`] = `
         key="another-project"
         linkClassName=""
       >
-        <span>
-          Another Project
-        </span>
+        <ProjectBadge>
+          <Flex>
+            <PlatformList
+              platforms={Array []}
+            />
+            <span>
+              Another Project
+            </span>
+          </Flex>
+        </ProjectBadge>
       </MenuItem>
       <MenuItem
         className=""
@@ -440,9 +600,16 @@ exports[`ProjectSelector render() lists projects and has filter 1`] = `
         key="test-project"
         linkClassName=""
       >
-        <span>
-          Test Project
-        </span>
+        <ProjectBadge>
+          <Flex>
+            <PlatformList
+              platforms={Array []}
+            />
+            <span>
+              Test Project
+            </span>
+          </Flex>
+        </ProjectBadge>
       </MenuItem>
     </DropdownLink>
   </h3>
