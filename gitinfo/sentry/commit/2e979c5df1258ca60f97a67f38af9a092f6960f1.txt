commit 2e979c5df1258ca60f97a67f38af9a092f6960f1
Author: Megan Heskett <meg.heskett@gmail.com>
Date:   Thu Jan 31 13:19:09 2019 -0800

    Remove org after redirect (#11806)

diff --git a/src/sentry/static/sentry/app/actionCreators/organizations.jsx b/src/sentry/static/sentry/app/actionCreators/organizations.jsx
index 906e5d1864..09c477ceb4 100644
--- a/src/sentry/static/sentry/app/actionCreators/organizations.jsx
+++ b/src/sentry/static/sentry/app/actionCreators/organizations.jsx
@@ -7,7 +7,7 @@ import OrganizationsStore from 'app/stores/organizationsStore';
 import ProjectsStore from 'app/stores/projectsStore';
 import TeamStore from 'app/stores/teamStore';
 
-export function redirectToRemainingOrganization({orgId}) {
+export function redirectToRemainingOrganization({orgId, removeOrg}) {
   // Remove queued, should redirect
   let allOrgs = OrganizationsStore.getAll().filter(
     org => org.status.id === 'active' && org.slug !== orgId
@@ -20,6 +20,11 @@ export function redirectToRemainingOrganization({orgId}) {
   // Let's be smart and select the best org to redirect to
   let firstRemainingOrg = allOrgs[0];
   browserHistory.push(`/${firstRemainingOrg.slug}/`);
+
+  // Remove org from SidebarDropdown
+  if (removeOrg) {
+    OrganizationsStore.remove(orgId);
+  }
 }
 
 export function remove(api, {successMessage, errorMessage, orgId} = {}) {
diff --git a/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx b/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
index 9aa3473440..55d42fbb78 100644
--- a/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
+++ b/src/sentry/static/sentry/app/views/settings/organizationMembers/index.jsx
@@ -14,7 +14,6 @@ import Pagination from 'app/components/pagination';
 import SentryTypes from 'app/sentryTypes';
 import SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';
 import recreateRoute from 'app/utils/recreateRoute';
-import OrganizationsStore from 'app/stores/organizationsStore';
 import {redirectToRemainingOrganization} from 'app/actionCreators/organizations';
 
 import OrganizationAccessRequests from './organizationAccessRequests';
@@ -163,9 +162,7 @@ class OrganizationMembersView extends AsyncView {
 
     this.removeMember(id).then(
       () => {
-        // Remove org from dropdown and redirect to remaining org
-        OrganizationsStore.remove(orgName);
-        redirectToRemainingOrganization({orgId: orgName});
+        redirectToRemainingOrganization({orgId: orgName, removeOrg: true});
 
         addSuccessMessage(
           tct('You left [orgName]', {
diff --git a/tests/js/spec/views/settings/organizationMembers/index.spec.jsx b/tests/js/spec/views/settings/organizationMembers/index.spec.jsx
index 511fce47cb..bff97cbaba 100644
--- a/tests/js/spec/views/settings/organizationMembers/index.spec.jsx
+++ b/tests/js/spec/views/settings/organizationMembers/index.spec.jsx
@@ -188,7 +188,6 @@ describe('OrganizationMembers', function() {
 
     expect(browserHistory.push).toHaveBeenCalledTimes(1);
     expect(browserHistory.push).toHaveBeenCalledWith('/organizations/new/');
-    expect(OrganizationsStore.getAll()).toEqual([]);
   });
 
   it('can redirect to remaining org after leaving', async function() {
