commit 5285ab037773afb14a56ec8991653700a6bc077c
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Thu Jun 6 17:55:02 2019 -0700

    fix(event-search): Ensure that project and issue are collections (#13574)
    
    `filter_keys` should always be a collection
    https://github.com/getsentry/sentry/blob/master/src/sentry/utils/snuba.py#L535

diff --git a/src/sentry/api/event_search.py b/src/sentry/api/event_search.py
index d4f6a72ac8..0f6af12cc7 100644
--- a/src/sentry/api/event_search.py
+++ b/src/sentry/api/event_search.py
@@ -1,7 +1,7 @@
 from __future__ import absolute_import
 
 import re
-from collections import namedtuple
+from collections import namedtuple, defaultdict
 from datetime import datetime
 
 import six
@@ -616,7 +616,7 @@ def get_snuba_query_args(query=None, params=None):
 
     kwargs = {
         'conditions': [],
-        'filter_keys': {},
+        'filter_keys': defaultdict(list),
     }
 
     for term in parsed_terms:
@@ -626,7 +626,10 @@ def get_snuba_query_args(query=None, params=None):
             if snuba_name in ('start', 'end'):
                 kwargs[snuba_name] = term.value.value
             elif snuba_name in ('project_id', 'issue'):
-                kwargs['filter_keys'][snuba_name] = term.value.value
+                value = term.value.value
+                if isinstance(value, int):
+                    value = [value]
+                kwargs['filter_keys'][snuba_name].extend(value)
             else:
                 converted_filter = convert_search_filter_to_snuba_query(term)
                 kwargs['conditions'].append(converted_filter)
diff --git a/tests/sentry/api/test_event_search.py b/tests/sentry/api/test_event_search.py
index b41209c8da..784105d95d 100644
--- a/tests/sentry/api/test_event_search.py
+++ b/tests/sentry/api/test_event_search.py
@@ -1124,6 +1124,30 @@ class GetSnubaQueryArgsTest(TestCase):
             'has_boolean_terms': True,
         }
 
+    def test_issue_filter(self):
+        assert get_snuba_query_args('issue.id:1') == {
+            'conditions': [],
+            'filter_keys': {
+                'issue': [1],
+            },
+        }
+
+        assert get_snuba_query_args('issue.id:1 issue.id:2 issue.id:3') == {
+            'conditions': [],
+            'filter_keys': {
+                'issue': [1, 2, 3],
+            },
+        }
+
+        assert get_snuba_query_args('issue.id:1 user.email:foo@example.com') == {
+            'conditions': [
+                ['email', '=', 'foo@example.com']
+            ],
+            'filter_keys': {
+                'issue': [1],
+            },
+        }
+
 
 class ConvertEndpointParamsTests(TestCase):
     def test_simple(self):
