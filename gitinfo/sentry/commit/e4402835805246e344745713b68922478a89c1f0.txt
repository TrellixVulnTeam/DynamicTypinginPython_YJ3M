commit e4402835805246e344745713b68922478a89c1f0
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jan 15 15:15:04 2012 -0800

    Added project to cleanup command/task

diff --git a/sentry/commands/cleanup.py b/sentry/commands/cleanup.py
index 814b0dcb53..253d70570b 100644
--- a/sentry/commands/cleanup.py
+++ b/sentry/commands/cleanup.py
@@ -14,12 +14,21 @@ from sentry.commands.utils import options, opt
     opt('--site', help='Limit truncation to only entries from site.'),
     opt('--server', help='Limit truncation to only entries from server.'),
     opt('--level', help='Limit truncation to only entries greater than or equal to level (e.g. DEBUG).'),
+    opt('--project', type=int, help='Limit truncation to only entries from project.'),
 )
-def cleanup(days=30, logger=None, site=None, server=None, level=None):
+def cleanup(days=30, logger=None, site=None, server=None, level=None,
+            project=None):
     import logging
     from sentry.queue.tasks.cleanup import cleanup
 
     if level is not None and not str(level).isdigit():
         level = getattr(logging, level.upper())
 
-    cleanup(days=days, logger=logger, site=site, server=server, level=level)
+    cleanup(
+        days=days,
+        logger=logger,
+        site=site,
+        server=server,
+        level=level,
+        project=project
+    )
diff --git a/sentry/queue/tasks/cleanup.py b/sentry/queue/tasks/cleanup.py
index c15ac18c3d..b3820823cd 100644
--- a/sentry/queue/tasks/cleanup.py
+++ b/sentry/queue/tasks/cleanup.py
@@ -7,7 +7,8 @@ sentry.queue.tasks.cleanup
 """
 
 
-def cleanup(days=30, logger=None, site=None, server=None, level=None):
+def cleanup(days=30, logger=None, site=None, server=None, level=None,
+            project=None):
     """
     Deletes a portion of the trailing data in Sentry based on
     their creation dates. For example, if ``days`` is 30, this
@@ -43,6 +44,8 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None):
         qs = qs.filter(server_name=server)
     if level:
         qs = qs.filter(level__gte=level)
+    if project:
+        qs = qs.filter(project=project)
 
     groups_to_check = set()
     for obj in RangeQuerySetWrapper(qs):
@@ -57,6 +60,8 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None):
             qs = qs.filter(group__logger=logger)
         if level:
             qs = qs.filter(group__level__gte=level)
+        if project:
+            qs = qs.filter(project=project)
 
         for obj in RangeQuerySetWrapper(qs):
             print ">>> Removing <%s: id=%s>" % (obj.__class__.__name__, obj.pk)
@@ -68,6 +73,8 @@ def cleanup(days=30, logger=None, site=None, server=None, level=None):
             qs = qs.filter(logger=logger)
         if level:
             qs = qs.filter(level__gte=level)
+        if project:
+            qs = qs.filter(project=project)
 
         for obj in RangeQuerySetWrapper(qs):
             for key, value in SkinnyQuerySet(MessageFilterValue).filter(group=obj).values_list('key', 'value'):
