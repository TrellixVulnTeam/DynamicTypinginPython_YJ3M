commit 4ac83d44c6acced1dc11d3b17df8171a99673835
Author: Lauryn Brown <lauryndbrown@gmail.com>
Date:   Tue Nov 27 14:43:16 2018 -0800

    fix(integrations): Added Docstring to compare_commit method and timestamps to Bitbucket and Azure (#10793)
    
    * added docstring and timestamp to bb and vsts
    
    * Added format date to bb and azure.
    
    * fixed bb and vsts compare commit tests
    
    * fixed typo in docstring

diff --git a/src/sentry/integrations/bitbucket/repository.py b/src/sentry/integrations/bitbucket/repository.py
index 00abeb9883..0a7543af78 100644
--- a/src/sentry/integrations/bitbucket/repository.py
+++ b/src/sentry/integrations/bitbucket/repository.py
@@ -103,6 +103,7 @@ class BitbucketRepositoryProvider(providers.IntegrationRepositoryProvider):
                 'author_email': parse_raw_user_email(c['author']['raw']),
                 'author_name': parse_raw_user_name(c['author']['raw']),
                 'message': c['message'],
+                'timestamp': self.format_date(c['date']),
                 'patch_set': c.get('patch_set'),
             } for c in commit_list
         ]
diff --git a/src/sentry/integrations/github/repository.py b/src/sentry/integrations/github/repository.py
index eaca97bd75..24319920ab 100644
--- a/src/sentry/integrations/github/repository.py
+++ b/src/sentry/integrations/github/repository.py
@@ -1,11 +1,8 @@
 from __future__ import absolute_import
 
-import dateutil.parser
 import logging
 import six
 
-from django.utils import timezone
-
 from sentry.integrations.exceptions import ApiError, IntegrationError
 from sentry.models import Integration
 from sentry.plugins import providers
@@ -95,9 +92,7 @@ class GitHubRepositoryProvider(providers.IntegrationRepositoryProvider):
                 'author_email': c['commit']['author'].get('email'),
                 'author_name': c['commit']['author'].get('name'),
                 'message': c['commit']['message'],
-                'timestamp': dateutil.parser.parse(
-                    c['commit']['author'].get('date'),
-                ).astimezone(timezone.utc) if c['commit']['author'].get('date') else None,
+                'timestamp': self.format_date(c['commit']['author'].get('date')),
                 'patch_set': self._get_patchset(client, repo_name, c['sha'])
             } for c in commit_list
         ]
diff --git a/src/sentry/integrations/gitlab/repository.py b/src/sentry/integrations/gitlab/repository.py
index 9af6b4bd19..43a50bc891 100644
--- a/src/sentry/integrations/gitlab/repository.py
+++ b/src/sentry/integrations/gitlab/repository.py
@@ -1,8 +1,5 @@
 from __future__ import absolute_import
 
-import dateutil.parser
-
-from django.utils import timezone
 
 from sentry.integrations.exceptions import ApiError, IntegrationError
 from sentry.plugins import providers
@@ -107,9 +104,7 @@ class GitlabRepositoryProvider(providers.IntegrationRepositoryProvider):
                 'author_email': c['author_email'],
                 'author_name': c['author_name'],
                 'message': c['title'],
-                'timestamp': dateutil.parser.parse(
-                    c['created_at'],
-                ).astimezone(timezone.utc) if c['created_at'] else None,
+                'timestamp': self.format_date(c['created_at']),
                 'patch_set': self._get_patchset(client, repo, c['id'])
             } for c in commit_list
         ]
diff --git a/src/sentry/integrations/vsts/repository.py b/src/sentry/integrations/vsts/repository.py
index 156e134b55..91038c4335 100644
--- a/src/sentry/integrations/vsts/repository.py
+++ b/src/sentry/integrations/vsts/repository.py
@@ -130,6 +130,7 @@ class VstsRepositoryProvider(providers.IntegrationRepositoryProvider):
                 'author_name': c['author']['name'],
                 'message': c['comment'],
                 'patch_set': c.get('patch_set'),
+                'timestamp': self.format_date(c['author']['date']),
             } for c in commit_list
         ]
 
diff --git a/src/sentry/plugins/providers/integration_repository.py b/src/sentry/plugins/providers/integration_repository.py
index d8edda145b..41ca0f5eaf 100644
--- a/src/sentry/plugins/providers/integration_repository.py
+++ b/src/sentry/plugins/providers/integration_repository.py
@@ -1,7 +1,9 @@
 from __future__ import absolute_import
 
+import dateutil.parser
 import six
 from django.db import IntegrityError, transaction
+from django.utils import timezone
 from rest_framework.response import Response
 
 from sentry import analytics
@@ -139,9 +141,24 @@ class IntegrationRepositoryProvider(object):
     def on_delete_repository(self, repo):
         pass
 
+    def format_date(self, date):
+        if not date:
+            return None
+        return dateutil.parser.parse(date).astimezone(timezone.utc)
+
     def compare_commits(self, repo, start_sha, end_sha):
         """
         Generate a list of commits between the start & end sha
+        Commits should be of the following format:
+            >>> {
+            >>>     'id': commit['id'],
+            >>>     'repository': repo.name,
+            >>>     'author_email': commit['author']['email'],
+            >>>     'author_name': commit['author']['name'],
+            >>>     'message': commit['message'],
+            >>>     'timestamp': self.format_date(commit['timestamp']),
+            >>>     'patch_set': commit['patch_set'],
+            >>> }
         """
         raise NotImplementedError
 
diff --git a/tests/sentry/integrations/bitbucket/test_repository.py b/tests/sentry/integrations/bitbucket/test_repository.py
index ee6b904e96..b5aa1a645b 100644
--- a/tests/sentry/integrations/bitbucket/test_repository.py
+++ b/tests/sentry/integrations/bitbucket/test_repository.py
@@ -1,9 +1,11 @@
 from __future__ import absolute_import
 
+import datetime
 import responses
 import pytest
 import six
 
+from django.utils import timezone
 from exam import fixture
 from sentry.models import Integration, Repository
 from sentry.testutils import TestCase, IntegrationRepositoryTestCase
@@ -74,7 +76,8 @@ class BitbucketRepositoryProviderTest(TestCase):
                 'message': 'README.md edited online with Bitbucket',
                 'id': 'e18e4e72de0d824edfbe0d73efe34cbd0d01d301',
                 'repository': 'sentryuser/newsdiffs',
-                'patch_set': [{'path': u'README.md', 'type': 'M'}]
+                'patch_set': [{'path': u'README.md', 'type': 'M'}],
+                'timestamp': datetime.datetime(2017, 5, 16, 23, 21, 40, tzinfo=timezone.utc),
             }
         ]
 
diff --git a/tests/sentry/integrations/vsts/test_repository.py b/tests/sentry/integrations/vsts/test_repository.py
index ab3d49b0ba..76ad8d7262 100644
--- a/tests/sentry/integrations/vsts/test_repository.py
+++ b/tests/sentry/integrations/vsts/test_repository.py
@@ -1,7 +1,9 @@
 from __future__ import absolute_import
 
 import responses
+import datetime
 
+from django.utils import timezone
 from exam import fixture
 from time import time
 
@@ -87,7 +89,8 @@ class VisualStudioRepositoryProviderTest(TestCase):
             'author_name': 'max bittker',
             'message': 'Updated README.md\n\nSecond line\n\nFixes SENTRY-1',
             'id': '6c36052c58bde5e57040ebe6bdb9f6a52c906fff',
-            'repository': 'example'
+            'repository': 'example',
+            'timestamp': datetime.datetime(2018, 4, 24, 0, 3, 18, tzinfo=timezone.utc),
         }]
 
     @responses.activate
