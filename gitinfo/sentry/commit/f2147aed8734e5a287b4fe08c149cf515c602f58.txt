commit f2147aed8734e5a287b4fe08c149cf515c602f58
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Tue Feb 27 16:26:43 2018 -0800

    feat(projects): Use slug instead of name in various places

diff --git a/src/sentry/api/endpoints/project_transfer.py b/src/sentry/api/endpoints/project_transfer.py
index e097633949..18625dcc1e 100644
--- a/src/sentry/api/endpoints/project_transfer.py
+++ b/src/sentry/api/endpoints/project_transfer.py
@@ -8,7 +8,7 @@ from django.utils import timezone
 from rest_framework import status
 from rest_framework.response import Response
 
-from sentry import roles, options
+from sentry import features, roles, options
 from sentry.api.bases.project import ProjectEndpoint, ProjectPermission
 from sentry.api.decorators import sudo_required
 from sentry.models import (
@@ -75,10 +75,16 @@ class ProjectTransferEndpoint(ProjectEndpoint):
             project_id=project.id,
             user_id=owner.user_id,
             transaction_id=transaction_id)
+
+        is_internal = features.has(
+            'organizations:internal-catchall',
+            project.organization,
+            actor=request.user,
+        )
         context = {
             'email': email,
             'from_org': project.organization.name,
-            'project_name': project.name,
+            'project_name': project.slug if is_internal else project.name,
             'request_time': timezone.now(),
             'url':
             absolute_uri('/accept-transfer/') + '?' + urlencode({'data': url_data}),
diff --git a/src/sentry/plugins/sentry_mail/activity/new_processing_issues.py b/src/sentry/plugins/sentry_mail/activity/new_processing_issues.py
index e70ccff6b1..14f487c915 100644
--- a/src/sentry/plugins/sentry_mail/activity/new_processing_issues.py
+++ b/src/sentry/plugins/sentry_mail/activity/new_processing_issues.py
@@ -1,5 +1,6 @@
 from __future__ import absolute_import
 
+from sentry import features
 from sentry.models import GroupSubscriptionReason, EventError
 from sentry.utils.http import absolute_uri
 
@@ -54,8 +55,12 @@ class NewProcessingIssuesActivityEmail(ActivityEmail):
         }
 
     def get_subject(self):
+        is_internal = features.has(
+            'organizations:internal-catchall',
+            self.organization,
+        )
         return u'Processing Issues on {}'.format(
-            self.project.name,
+            self.project.slug if is_internal else self.project.name,
         )
 
     def get_template(self):
diff --git a/src/sentry/plugins/sentry_webhooks/plugin.py b/src/sentry/plugins/sentry_webhooks/plugin.py
index 22472c4c0c..51541f6201 100644
--- a/src/sentry/plugins/sentry_webhooks/plugin.py
+++ b/src/sentry/plugins/sentry_webhooks/plugin.py
@@ -79,6 +79,7 @@ class WebHooksPlugin(notify.NotificationPlugin):
             'id': six.text_type(group.id),
             'project': group.project.slug,
             'project_name': group.project.name,
+            'project_slug': group.project.slug,
             'logger': event.get_tag('logger'),
             'level': event.get_tag('level'),
             'culprit': group.culprit,
diff --git a/src/sentry/testutils/fixtures.py b/src/sentry/testutils/fixtures.py
index 2cd49a3702..824836005d 100644
--- a/src/sentry/testutils/fixtures.py
+++ b/src/sentry/testutils/fixtures.py
@@ -341,7 +341,7 @@ class Fixtures(object):
     def create_repo(self, project):
         repo = Repository.objects.create(
             organization_id=project.organization_id,
-            name='organization-{}'.format(project.name),
+            name='organization-{}'.format(project.slug),
         )
         return repo
 
diff --git a/src/sentry/web/frontend/debug/mail.py b/src/sentry/web/frontend/debug/mail.py
index 482106c0b1..6203f553de 100644
--- a/src/sentry/web/frontend/debug/mail.py
+++ b/src/sentry/web/frontend/debug/mail.py
@@ -261,7 +261,7 @@ def alert(request):
             'link': 'http://example.com/link',
             'interfaces': interface_list,
             'tags': event.get_tags(),
-            'project_label': project.name,
+            'project_label': project.slug,
             'tags': [
                 ('logger', 'javascript'), ('environment', 'prod'), ('level', 'error'),
                 ('device', 'Other')
diff --git a/src/sentry/web/frontend/remove_project.py b/src/sentry/web/frontend/remove_project.py
index 13aba501b5..eef234edd2 100644
--- a/src/sentry/web/frontend/remove_project.py
+++ b/src/sentry/web/frontend/remove_project.py
@@ -6,6 +6,7 @@ from django.core.urlresolvers import reverse
 from django.http import HttpResponseRedirect
 from django.utils.translation import ugettext_lazy as _
 
+from sentry import features
 from sentry.api import client
 from sentry.web.frontend.base import ProjectView
 
@@ -33,9 +34,15 @@ class RemoveProjectView(ProjectView):
                 is_sudo=True
             )
 
+            is_internal = features.has(
+                'organizations:internal-catchall',
+                organization,
+                actor=request.user,
+            )
+            project_name = (project.slug if is_internal else project.name).encode('utf-8')
             messages.add_message(
                 request, messages.SUCCESS,
-                _(u'The project %r was scheduled for deletion.') % (project.name.encode('utf-8'), )
+                _(u'The project %r was scheduled for deletion.') % (project_name, )
             )
 
             return HttpResponseRedirect(
diff --git a/src/sentry/web/frontend/transfer_project.py b/src/sentry/web/frontend/transfer_project.py
index bd477d7485..fdd7a0c822 100644
--- a/src/sentry/web/frontend/transfer_project.py
+++ b/src/sentry/web/frontend/transfer_project.py
@@ -11,7 +11,7 @@ from django.http import HttpResponseRedirect
 from django.utils import timezone
 from django.utils.translation import ugettext_lazy as _
 
-from sentry import roles, options
+from sentry import features, roles, options
 from sentry.web.frontend.base import ProjectView
 from sentry.utils.email import MessageBuilder
 from sentry.utils.http import absolute_uri
@@ -60,10 +60,16 @@ class TransferProjectView(ProjectView):
                 project_id=project.id,
                 user_id=owner.user_id,
                 transaction_id=transaction_id)
+
+            is_internal = features.has(
+                'organizations:internal-catchall',
+                organization,
+                actor=request.user,
+            )
             context = {
                 'email': email,
                 'from_org': organization.name,
-                'project_name': project.name,
+                'project_name': project.slug if is_internal else project.name,
                 'request_time': timezone.now(),
                 'url':
                 absolute_uri('/accept-transfer/') + '?' + urlencode({'data': url_data}),
@@ -90,7 +96,7 @@ class TransferProjectView(ProjectView):
             messages.add_message(
                 request, messages.SUCCESS,
                 _(u'A request was sent to move project %r to a different organization') %
-                (project.name.encode('utf-8'), )
+                ((project.slug if is_internal else project.name).encode('utf-8'), )
             )
 
             return HttpResponseRedirect(
diff --git a/tests/sentry/api/serializers/test_activity.py b/tests/sentry/api/serializers/test_activity.py
index c4df672013..c2a326b961 100644
--- a/tests/sentry/api/serializers/test_activity.py
+++ b/tests/sentry/api/serializers/test_activity.py
@@ -40,7 +40,7 @@ class GroupActivityTestCase(TestCase):
 
         result = serialize([activity], user)[0]['data']
         pull_request = result['pullRequest']
-        assert pull_request['repository']['name'] == 'organization-Bar'
+        assert pull_request['repository']['name'] == 'organization-bar'
         assert pull_request['message'] == 'kartoffel'
 
     def test_commit_activity(self):
@@ -72,5 +72,5 @@ class GroupActivityTestCase(TestCase):
 
         result = serialize([activity], user)[0]['data']
         commit = result['commit']
-        assert commit['repository']['name'] == 'organization-Bar'
+        assert commit['repository']['name'] == 'organization-bar'
         assert commit['message'] == 'gemuse'
