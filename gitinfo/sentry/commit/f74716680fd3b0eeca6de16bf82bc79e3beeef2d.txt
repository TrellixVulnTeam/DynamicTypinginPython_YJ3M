commit f74716680fd3b0eeca6de16bf82bc79e3beeef2d
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 26 21:37:13 2013 -0700

    Reset sequences after initial project create as ID might be invalid

diff --git a/src/sentry/models.py b/src/sentry/models.py
index dc30620e8a..d5753d95b3 100644
--- a/src/sentry/models.py
+++ b/src/sentry/models.py
@@ -44,7 +44,7 @@ from sentry.manager import (
     UserOptionManager, TagKeyManager, TeamManager, UserManager)
 from sentry.signals import buffer_incr_complete, regression_signal
 from sentry.utils.cache import memoize
-from sentry.utils.db import has_trending
+from sentry.utils.db import has_trending, reset_sequences
 from sentry.utils.http import absolute_uri
 from sentry.utils.models import (
     Model, GzippedDictField, BoundedIntegerField, BoundedPositiveIntegerField,
@@ -1217,6 +1217,8 @@ def create_default_project(created_models, verbosity=2, **kwargs):
         owner=user,
     )
 
+    reset_sequences('sentry')
+
     if verbosity > 0:
         print 'Created internal Sentry project (slug=%s, id=%s)' % (project.slug, project.id)
 
diff --git a/src/sentry/utils/db.py b/src/sentry/utils/db.py
index bf253fe9a9..7a2289b5bf 100644
--- a/src/sentry/utils/db.py
+++ b/src/sentry/utils/db.py
@@ -138,3 +138,20 @@ def attach_foreignkey(objects, field, related=[], database=None):
 
 def table_exists(name, using=DEFAULT_DB_ALIAS):
     return name in connections[using].introspection.table_names()
+
+
+def reset_sequences(app='sentry'):
+    import os
+
+    os.environ['DJANGO_COLORS'] = 'nocolor'
+
+    from django.core.management import call_command
+    from django.db import connection
+    from StringIO import StringIO
+
+    commands = StringIO()
+    cursor = connection.cursor()
+
+    call_command('sqlsequencereset', app, stdout=commands)
+
+    cursor.execute(commands.getvalue())
