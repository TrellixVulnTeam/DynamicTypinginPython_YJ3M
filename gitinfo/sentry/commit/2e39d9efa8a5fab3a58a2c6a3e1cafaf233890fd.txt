commit 2e39d9efa8a5fab3a58a2c6a3e1cafaf233890fd
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Tue Oct 8 12:58:06 2019 -0700

    ref(tagstore): Remove references to legacy tag storage (#14983)

diff --git a/src/sentry/tasks/unmerge.py b/src/sentry/tasks/unmerge.py
index 2fc6070c62..e206f8b7a7 100644
--- a/src/sentry/tasks/unmerge.py
+++ b/src/sentry/tasks/unmerge.py
@@ -4,7 +4,6 @@ import logging
 from collections import defaultdict, OrderedDict
 
 from django.db import transaction
-from django.conf import settings
 
 from sentry import eventstore, eventstream, tagstore
 from sentry.app import tsdb
@@ -220,20 +219,9 @@ def migrate_events(
     for event in events:
         event.group = destination
 
-    if settings.SENTRY_TAGSTORE == "sentry.tagstore.legacy.LegacyTagStorage":
-        postgres_id_set = set(
-            Event.objects.filter(project_id=project.id, event_id__in=event_id_set).values_list(
-                "id", flat=True
-            )
-        )
-
-        tagstore.update_group_for_events(
-            project_id=project.id, event_ids=postgres_id_set, destination_id=destination_id
-        )
-
-    event_event_id_set = set(event.event_id for event in events)
+    event_id_set = set(event.event_id for event in events)
 
-    UserReport.objects.filter(project_id=project.id, event_id__in=event_event_id_set).update(
+    UserReport.objects.filter(project_id=project.id, event_id__in=event_id_set).update(
         group=destination_id
     )
 
diff --git a/tests/snuba/search/test_backend.py b/tests/snuba/search/test_backend.py
index 75060bb7ee..51a3cc5fad 100644
--- a/tests/snuba/search/test_backend.py
+++ b/tests/snuba/search/test_backend.py
@@ -2,9 +2,7 @@ from __future__ import absolute_import
 
 import mock
 import pytz
-import pytest
 from datetime import datetime, timedelta
-from django.conf import settings
 from django.utils import timezone
 from hashlib import md5
 
@@ -744,10 +742,6 @@ class SnubaSearchTest(TestCase, SnubaTestCase):
         )
         assert set(results) == set([self.group1, self.group2])
 
-    @pytest.mark.xfail(
-        settings.SENTRY_TAGSTORE.startswith("sentry.tagstore.legacy.LegacyTagStorage"),
-        reason="unsupported on legacy backend due to insufficient index",
-    )
     def test_date_filter_with_environment(self):
         results = self.backend.query(
             [self.project],
