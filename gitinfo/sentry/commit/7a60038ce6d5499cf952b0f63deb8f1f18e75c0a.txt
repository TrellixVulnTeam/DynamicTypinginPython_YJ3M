commit 7a60038ce6d5499cf952b0f63deb8f1f18e75c0a
Author: David Cramer <dcramer@gmail.com>
Date:   Sun Jan 29 17:51:25 2012 -0800

    Create project owners automatically

diff --git a/sentry/management/__init__.py b/sentry/management/__init__.py
index 8843eb8fc2..8a4392be3e 100644
--- a/sentry/management/__init__.py
+++ b/sentry/management/__init__.py
@@ -9,9 +9,9 @@ sentry.management
 import logging
 from django.contrib.auth.models import User
 from django.db.models.signals import post_syncdb, post_save
-from sentry.models import Project, ProjectMember, MessageIndex, \
+from sentry.models import Project, MessageIndex, SearchDocument, \
   Group, Event, FilterValue, MessageFilterValue, MessageCountByMinute, \
-  SearchDocument, MEMBER_OWNER
+  MEMBER_OWNER
 
 
 def register_indexes():
@@ -44,13 +44,6 @@ def create_default_project(created_models, verbosity=2, **kwargs):
         if not created:
             return
 
-        if owner:
-            ProjectMember.objects.create(
-                project=project,
-                user=owner,
-                type=MEMBER_OWNER,
-            )
-
         if verbosity > 0:
             print 'Created default Sentry project owned by %s' % owner
 
@@ -66,6 +59,19 @@ def create_default_project(created_models, verbosity=2, **kwargs):
                 print 'done!'
 
 
+def create_project_member_for_owner(instance, created, **kwargs):
+    if not created:
+        return
+
+    if not instance.owner:
+        return
+
+    instance.member_set.create(
+        user=instance.owner,
+        type=MEMBER_OWNER
+    )
+
+
 def update_document(instance, created, **kwargs):
     if created:
         return
@@ -80,8 +86,13 @@ post_syncdb.connect(
     create_default_project,
     dispatch_uid="create_default_project"
 )
-
+post_save.connect(
+    create_project_member_for_owner,
+    sender=Project,
+    dispatch_uid="create_project_member_for_owner"
+)
 post_save.connect(
     update_document,
     sender=Group,
+    dispatch_uid="update_document"
 )
\ No newline at end of file
diff --git a/sentry/web/frontend/projects.py b/sentry/web/frontend/projects.py
index 7bbb0a0101..37bbf1b4cc 100644
--- a/sentry/web/frontend/projects.py
+++ b/sentry/web/frontend/projects.py
@@ -31,11 +31,6 @@ def new_project(request):
         project = form.save(commit=False)
         project.owner = request.user
         project.save()
-
-        project.member_set.create(
-            user=project.owner,
-            type=MEMBER_OWNER,
-        )
         return HttpResponseRedirect(reverse('sentry-manage-project', args=[project.pk]))
 
     context = csrf(request)
diff --git a/tests/web/tests.py b/tests/web/tests.py
index e5a87c76f9..aaef86f30b 100644
--- a/tests/web/tests.py
+++ b/tests/web/tests.py
@@ -44,8 +44,7 @@ class SentryViewsTest(TestCase):
         self.assertTemplateNotUsed(resp, 'sentry/dashboard.html')
 
         # requires two projects to show dashboard
-        p = Project.objects.create(name='foo')
-        ProjectMember.objects.create(project=p, user=self.user)
+        Project.objects.create(name='foo', owner=self.user)
         resp = self.client.get(reverse('sentry'), follow=True)
         self.assertEquals(resp.status_code, 200)
         self.assertTemplateUsed(resp, 'sentry/dashboard.html')
