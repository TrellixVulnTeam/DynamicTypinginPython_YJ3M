commit fa6cc630135c9bbc602631c7cd1b312552926949
Author: Jess MacQueen <jessmacqueen@gmail.com>
Date:   Tue Mar 20 14:17:42 2018 -0700

    fix(deletion): Create audit log entry for team before deleting it
    
    fixes SENTRY-64E

diff --git a/src/sentry/api/endpoints/team_details.py b/src/sentry/api/endpoints/team_details.py
index d2e2e0f3cd..4e2a34ea07 100644
--- a/src/sentry/api/endpoints/team_details.py
+++ b/src/sentry/api/endpoints/team_details.py
@@ -123,12 +123,6 @@ class TeamDetailsEndpoint(TeamEndpoint):
         ).update(status=TeamStatus.PENDING_DELETION)
         if updated:
             transaction_id = uuid4().hex
-            delete_team.apply_async(
-                kwargs={
-                    'object_id': team.id,
-                    'transaction_id': transaction_id,
-                },
-            )
 
             self.create_audit_entry(
                 request=request,
@@ -139,6 +133,13 @@ class TeamDetailsEndpoint(TeamEndpoint):
                 transaction_id=transaction_id,
             )
 
+            delete_team.apply_async(
+                kwargs={
+                    'object_id': team.id,
+                    'transaction_id': transaction_id,
+                },
+            )
+
             delete_logger.info(
                 'object.delete.queued',
                 extra={
