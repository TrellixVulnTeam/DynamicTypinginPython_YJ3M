commit fe5f01eb3f663ef0e2dc3594f399f9e748005454
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Oct 28 15:55:31 2016 -0700

    account: prevent abuse of sending emails through email verification form (#4445)

diff --git a/src/sentry/web/frontend/accounts.py b/src/sentry/web/frontend/accounts.py
index f527a89833..c0035e5801 100644
--- a/src/sentry/web/frontend/accounts.py
+++ b/src/sentry/web/frontend/accounts.py
@@ -15,7 +15,7 @@ from django.contrib.auth import login as login_user, authenticate
 from django.core.context_processors import csrf
 from django.core.urlresolvers import reverse
 from django.db import IntegrityError, transaction
-from django.http import HttpResponseRedirect, Http404
+from django.http import HttpResponseRedirect, Http404, HttpResponse
 from django.views.decorators.cache import never_cache
 from django.views.decorators.csrf import csrf_protect
 from django.utils import timezone
@@ -122,6 +122,18 @@ def recover_confirm(request, user_id, hash):
 
 @login_required
 def start_confirm_email(request):
+    from sentry.app import ratelimiter
+
+    if ratelimiter.is_limited(
+        'auth:confirm-email:{}'.format(request.user.id),
+        limit=10, window=60,  # 10 per minute should be enough for anyone
+    ):
+        return HttpResponse(
+            'You have made too many email confirmation requests. Please try again later.',
+            content_type='text/plain',
+            status=429,
+        )
+
     has_unverified_emails = request.user.has_unverified_emails()
     if has_unverified_emails:
         request.user.send_confirm_emails()
