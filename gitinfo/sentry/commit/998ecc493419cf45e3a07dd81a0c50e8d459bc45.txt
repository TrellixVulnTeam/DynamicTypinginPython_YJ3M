commit 998ecc493419cf45e3a07dd81a0c50e8d459bc45
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Feb 22 13:58:51 2013 -0800

    Revert "Remove useless serialization bits"
    
    This reverts commit ab6627ebc17bbc992327cfb916a64660df14b560.

diff --git a/src/sentry/interfaces.py b/src/sentry/interfaces.py
index 82312b96cd..ef46301ef6 100644
--- a/src/sentry/interfaces.py
+++ b/src/sentry/interfaces.py
@@ -98,6 +98,7 @@ class Interface(object):
     display_score = None
 
     def __init__(self, **kwargs):
+        self.attrs = kwargs.keys()
         self.__dict__.update(kwargs)
 
     def __eq__(self, other):
@@ -107,6 +108,7 @@ class Interface(object):
 
     def __setstate__(self, data):
         kwargs = self.unserialize(data)
+        self.attrs = kwargs.keys()
         self.__dict__.update(kwargs)
 
     def __getstate__(self):
@@ -119,7 +121,7 @@ class Interface(object):
         return data
 
     def serialize(self):
-        return vars(self)
+        return dict((k, self.__dict__[k]) for k in self.attrs)
 
     def get_composite_hash(self, interfaces):
         return self.get_hash()
@@ -234,7 +236,7 @@ class Query(Interface):
         }
 
 
-class Frame(Interface):
+class Frame(object):
     def __init__(self, abs_path=None, filename=None, lineno=None, colno=None, in_app=False,
                  context_line=None, pre_context=(), post_context=(), vars=None,
                  module=None, function=None, data=None):
@@ -435,8 +437,16 @@ class Stacktrace(Interface):
             assert frame.is_valid()
 
     def serialize(self):
+        frames = []
+        for f in self.frames:
+            # compatibility with old serialization
+            if isinstance(f, Frame):
+                frames.append(vars(f))
+            else:
+                frames.append(f)
+
         return {
-            'frames': [f.serialize() for f in self.frames],
+            'frames': frames,
         }
 
     def unserialize(self, data):
diff --git a/tests/sentry/interfaces/tests.py b/tests/sentry/interfaces/tests.py
index defc7705f8..88746ba6e0 100644
--- a/tests/sentry/interfaces/tests.py
+++ b/tests/sentry/interfaces/tests.py
@@ -3,6 +3,7 @@
 from __future__ import absolute_import
 
 import mock
+import pickle
 
 from sentry.interfaces import Interface, get_context
 from sentry.models import Event
@@ -22,6 +23,14 @@ class InterfaceTest(InterfaceBase):
     def interface(self):
         return Interface(foo=1)
 
+    def test_init_sets_attrs(self):
+        assert self.interface.attrs == ['foo']
+
+    def test_setstate_sets_attrs(self):
+        data = pickle.dumps(self.interface)
+        obj = pickle.loads(data)
+        assert obj.attrs == ['foo']
+
     def test_to_html_default(self):
         assert self.interface.to_html(self.event) == ''
 
