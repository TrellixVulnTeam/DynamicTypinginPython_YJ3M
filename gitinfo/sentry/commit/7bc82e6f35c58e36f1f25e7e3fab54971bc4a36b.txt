commit 7bc82e6f35c58e36f1f25e7e3fab54971bc4a36b
Author: Jess MacQueen <macqueen@users.noreply.github.com>
Date:   Mon Mar 19 14:36:19 2018 -0700

    feat(ui): Add a project list page for early adopters (#7683)

diff --git a/src/sentry/static/sentry/app/components/organizations/homeSidebar.jsx b/src/sentry/static/sentry/app/components/organizations/homeSidebar.jsx
index c2ac85d723..4cb2fb5ff2 100644
--- a/src/sentry/static/sentry/app/components/organizations/homeSidebar.jsx
+++ b/src/sentry/static/sentry/app/components/organizations/homeSidebar.jsx
@@ -143,10 +143,9 @@ const HomeSidebar = createReactClass({
           )}
 
           {features.has('new-teams') && (
-            <React.Fragment>
-              <ListLink to={`${pathPrefix}/projects/`}>{t('Projects')}</ListLink>
-              <ListLink to={`${pathPrefix}/teams/`}>{t('Teams')}</ListLink>
-            </React.Fragment>
+            <ListLink to={`/organizations/${orgId}/projects/`}>
+              {t('Projects & Teams')}
+            </ListLink>
           )}
 
           {access.has('org:read') && (
diff --git a/src/sentry/static/sentry/app/components/projectLabel.jsx b/src/sentry/static/sentry/app/components/projectLabel.jsx
index 5f7be4dd21..d8e3446141 100644
--- a/src/sentry/static/sentry/app/components/projectLabel.jsx
+++ b/src/sentry/static/sentry/app/components/projectLabel.jsx
@@ -9,12 +9,12 @@ export default class ProjectLabel extends React.PureComponent {
 
   render() {
     let {project, organization} = this.props;
-    let features = new Set(organization.features);
+    let features = organization && new Set(organization.features);
 
     return (
       <span className="project-label" {...this.props}>
         <span className="project-name">
-          {features.has('new-teams') ? project.slug : project.name}
+          {!features || features.has('new-teams') ? project.slug : project.name}
         </span>
       </span>
     );
diff --git a/src/sentry/static/sentry/app/routes.jsx b/src/sentry/static/sentry/app/routes.jsx
index e79522b7db..8c5839ee3f 100644
--- a/src/sentry/static/sentry/app/routes.jsx
+++ b/src/sentry/static/sentry/app/routes.jsx
@@ -57,6 +57,7 @@ import OrganizationRepositoriesView from './views/organizationRepositoriesView';
 import OrganizationGeneralSettingsView from './views/settings/organization/general/organizationGeneralSettingsView';
 import OrganizationStats from './views/organizationStats';
 import OrganizationTeams from './views/organizationTeams';
+import OrganizationTeamsProjectsView from './views/organizationTeamsProjects';
 import ProjectAlertRules from './views/projectAlertRules';
 import ProjectAlertRuleDetails from './views/projectAlertRuleDetails';
 import ProjectAlertSettings from './views/projectAlertSettings';
@@ -633,6 +634,10 @@ function routes() {
         />
 
         <Route path="/organizations/:orgId/" component={OrganizationHomeContainer}>
+          <Route
+            path="projects/"
+            component={errorHandler(OrganizationTeamsProjectsView)}
+          />
           {hooksOrgRoutes}
           {orgSettingsRoutes}
         </Route>
diff --git a/src/sentry/static/sentry/app/views/organizationTeamsProjects.jsx b/src/sentry/static/sentry/app/views/organizationTeamsProjects.jsx
new file mode 100644
index 0000000000..ecf5e6e226
--- /dev/null
+++ b/src/sentry/static/sentry/app/views/organizationTeamsProjects.jsx
@@ -0,0 +1,166 @@
+import PropTypes from 'prop-types';
+import React from 'react';
+import {Box, Flex} from 'grid-emotion';
+import {Link} from 'react-router';
+import LazyLoad from 'react-lazy-load';
+
+import BarChart from '../components/barChart';
+import Button from '../components/buttons/button';
+import {Client} from '../api';
+import {loadStats} from '../actionCreators/projects';
+import Panel from './settings/components/panel';
+import PanelBody from './settings/components/panelBody';
+import PanelHeader from './settings/components/panelHeader';
+import PanelItem from './settings/components/panelItem';
+import ProjectLabel from '../components/projectLabel';
+import SentryTypes from '../proptypes';
+import SettingsPageHeader from './settings/components/settingsPageHeader';
+import {t, tct} from '../locale';
+import withProjects from '../utils/withProjects';
+
+class OrganizationTeamsProjectsView extends React.Component {
+  static propTypes = {
+    params: PropTypes.object,
+    projects: PropTypes.array,
+  };
+
+  static contextTypes = {
+    organization: SentryTypes.Organization,
+  };
+
+  componentWillMount() {
+    this.api = new Client();
+  }
+
+  componentDidMount() {
+    this.fetchStats();
+  }
+
+  componentWillUnmount() {
+    this.api.clear();
+  }
+
+  fetchStats() {
+    loadStats(this.api, {
+      orgId: this.props.params.orgId,
+      query: {
+        since: new Date().getTime() / 1000 - 3600 * 24,
+        stat: 'generated',
+        group: 'project',
+      },
+    });
+  }
+
+  renderNoProjects(teamSlug) {
+    let {orgId} = this.props.params;
+    return (
+      <tbody>
+        <tr>
+          <td>
+            <p className="project-list-empty">
+              {tct(
+                'There are no projects in this team. Get started by [link:creating your first project].',
+                {
+                  link: (
+                    <a href={`/organizations/${orgId}/projects/new/?team=' + teamSlug`} />
+                  ),
+                }
+              )}
+            </p>
+          </td>
+        </tr>
+      </tbody>
+    );
+  }
+
+  renderProject = project => {
+    let {orgId} = this.props.params;
+    let chartData =
+      project.stats &&
+      project.stats.map(point => {
+        return {x: point[0], y: point[1]};
+      });
+
+    let access = new Set(this.context.organization.access);
+
+    return (
+      <PanelItem key={project.id} align="center">
+        <Flex flex="1" justify="space-between">
+          <Link to={`/${orgId}/${project.slug}/`}>
+            <ProjectLabel project={project} />
+          </Link>
+          <div className="project-chart">
+            {chartData && (
+              <LazyLoad>
+                <BarChart points={chartData} label="events" />
+              </LazyLoad>
+            )}
+          </div>
+        </Flex>
+        {access.has('project:write') && (
+          <Box ml={2}>
+            <Button
+              size="small"
+              to={`/settings/organization/${orgId}/project/${project.slug}/settings/`}
+            >
+              {t('Manage Project')}
+            </Button>
+          </Box>
+        )}
+      </PanelItem>
+    );
+  };
+
+  renderProjectList(projects) {
+    return projects.map(this.renderProject);
+  }
+
+  renderTeamNode = (teamSlug, projects) => {
+    let display = teamSlug === null ? t('Projects Without Teams') : `#${teamSlug}`;
+    return (
+      <Panel key={teamSlug}>
+        <PanelHeader css={{textTransform: 'none'}}>{display}</PanelHeader>
+        <PanelBody>
+          {projects.length
+            ? this.renderProjectList(projects)
+            : this.renderNoProjects(teamSlug)}
+        </PanelBody>
+      </Panel>
+    );
+  };
+
+  render() {
+    let {projects} = this.props;
+    let projectsByTeam = {};
+    let teamlessProjects = [];
+
+    projects.forEach(project => {
+      if (!project.teams.length) {
+        teamlessProjects.push(project);
+      } else {
+        project.teams.forEach(team => {
+          if (!projectsByTeam[team.slug]) {
+            projectsByTeam[team.slug] = [];
+          }
+          projectsByTeam[team.slug].push(project);
+        });
+      }
+    });
+
+    return (
+      <div className="row">
+        <SettingsPageHeader title={t('Projects by Team')} />
+        <div className="col-md-9">
+          <div className="team-list">
+            {Object.keys(projectsByTeam).map(teamSlug => {
+              return this.renderTeamNode(teamSlug, projectsByTeam[teamSlug]);
+            })}
+            {!!teamlessProjects.length && this.renderTeamNode(null, teamlessProjects)}
+          </div>
+        </div>
+      </div>
+    );
+  }
+}
+
+export default withProjects(OrganizationTeamsProjectsView);
diff --git a/tests/js/spec/views/__snapshots__/organizationTeamsProjects.spec.jsx.snap b/tests/js/spec/views/__snapshots__/organizationTeamsProjects.spec.jsx.snap
new file mode 100644
index 0000000000..1d80a9cc50
--- /dev/null
+++ b/tests/js/spec/views/__snapshots__/organizationTeamsProjects.spec.jsx.snap
@@ -0,0 +1,587 @@
+// Jest Snapshot v1, https://goo.gl/fbAQLP
+
+exports[`OrganizationTeamProjects Should render 1`] = `
+.glamor-17 {
+  text-transform: none;
+}
+
+.glamor-4 {
+  font-size: 14px;
+  box-shadow: inset 0 -1px 0;
+  margin: -20px 0 30px;
+}
+
+.glamor-2 {
+  box-sizing: border-box;
+  display: -webkit-box;
+  display: -webkit-flex;
+  display: -ms-flexbox;
+  display: flex;
+  -webkit-align-items: center;
+  -webkit-box-align: center;
+  -ms-flex-align: center;
+  align-items: center;
+}
+
+.glamor-0 {
+  font-size: 20px;
+  font-weight: bold;
+  margin: 20px 0;
+  -webkit-flex: 1;
+  -ms-flex: 1;
+  flex: 1;
+}
+
+.glamor-29 {
+  background: #fff;
+  border: 1px solid;
+  margin-bottom: NaNpx;
+  position: relative;
+}
+
+.glamor-13 {
+  border-bottom: 1px solid;
+  border-radius: 0 0;
+  text-transform: uppercase;
+  font-size: 13px;
+  line-height: 1;
+  padding: 15px 20px;
+  text-transform: none;
+}
+
+.glamor-9 {
+  font-size: inherit;
+  text-transform: inherit;
+  margin: 0;
+}
+
+.glamor-7 {
+  font-size: 12px;
+  font-weight: 600;
+  text-transform: uppercase;
+  margin-bottom: 20px;
+  font-size: inherit;
+  text-transform: inherit;
+  margin: 0;
+}
+
+.glamor-25 {
+  box-sizing: border-box;
+  padding: 16px;
+  display: -webkit-box;
+  display: -webkit-flex;
+  display: -ms-flexbox;
+  display: flex;
+  -webkit-align-items: center;
+  -webkit-box-align: center;
+  -ms-flex-align: center;
+  align-items: center;
+  border-bottom: 1px solid;
+}
+
+.glamor-25:last-child {
+  border: 0;
+}
+
+.glamor-19 {
+  box-sizing: border-box;
+  -webkit-flex: 1;
+  -ms-flex: 1;
+  flex: 1;
+  display: -webkit-box;
+  display: -webkit-flex;
+  display: -ms-flexbox;
+  display: flex;
+  -webkit-box-pack: justify;
+  -webkit-justify-content: space-between;
+  -ms-flex-pack: justify;
+  justify-content: space-between;
+}
+
+.glamor-23 {
+  box-sizing: border-box;
+  margin-left: 16px;
+}
+
+<withProjects
+  params={
+    Object {
+      "orgId": "org-slug",
+    }
+  }
+>
+  <OrganizationTeamsProjectsView
+    params={
+      Object {
+        "orgId": "org-slug",
+      }
+    }
+    projects={
+      Array [
+        Object {
+          "hasAccess": true,
+          "id": "2",
+          "isBookmarked": false,
+          "isMember": true,
+          "name": "Project Name",
+          "slug": "project-slug",
+          "teams": Array [
+            Object {
+              "id": "1",
+              "name": "Team Name",
+              "slug": "team-slug",
+            },
+          ],
+        },
+        Object {
+          "hasAccess": true,
+          "id": "3",
+          "isBookmarked": false,
+          "isMember": true,
+          "name": "Project Name 2",
+          "slug": "project-slug-2",
+          "teams": Array [],
+        },
+      ]
+    }
+  >
+    <div
+      className="row"
+    >
+      <SettingsPageHeading
+        title="Projects by Team"
+      >
+        <Wrapper>
+          <div
+            className="glamor-4 glamor-5"
+          >
+            <Flex
+              align="center"
+            >
+              <Base
+                align="center"
+                className="glamor-2"
+              >
+                <div
+                  className="glamor-2"
+                  is={null}
+                >
+                  <Title>
+                    <div
+                      className="glamor-0 glamor-1"
+                    >
+                      Projects by Team
+                    </div>
+                  </Title>
+                </div>
+              </Base>
+            </Flex>
+          </div>
+        </Wrapper>
+      </SettingsPageHeading>
+      <div
+        className="col-md-9"
+      >
+        <div
+          className="team-list"
+        >
+          <Panel
+            key="team-slug"
+          >
+            <StyledPanel>
+              <div
+                className="glamor-29 glamor-30"
+              >
+                <PanelHeader
+                  className="glamor-17"
+                >
+                  <StyledPanelHeader
+                    className="glamor-17"
+                  >
+                    <Component
+                      className="glamor-13 glamor-14"
+                    >
+                      <div
+                        className="glamor-13 glamor-14"
+                      >
+                        <StyledPanelHeading>
+                          <Component
+                            className="glamor-9 glamor-6"
+                          >
+                            <PanelHeading
+                              className="glamor-9 glamor-6"
+                            >
+                              <div
+                                className="glamor-6 glamor-7 glamor-8"
+                              >
+                                #team-slug
+                              </div>
+                            </PanelHeading>
+                          </Component>
+                        </StyledPanelHeading>
+                      </div>
+                    </Component>
+                  </StyledPanelHeader>
+                </PanelHeader>
+                <PanelBody
+                  direction="column"
+                  disablePadding={true}
+                  flex={false}
+                >
+                  <div
+                    className=""
+                  >
+                    <PanelItem
+                      align="center"
+                      key="2"
+                      p={2}
+                    >
+                      <StyledPanelItem
+                        align="center"
+                        p={2}
+                      >
+                        <Base
+                          align="center"
+                          className="glamor-25 glamor-26"
+                          p={2}
+                        >
+                          <div
+                            className="glamor-25 glamor-26"
+                            is={null}
+                          >
+                            <Flex
+                              flex="1"
+                              justify="space-between"
+                            >
+                              <Base
+                                className="glamor-19"
+                                flex="1"
+                                justify="space-between"
+                              >
+                                <div
+                                  className="glamor-19"
+                                  is={null}
+                                >
+                                  <Link
+                                    onlyActiveOnIndex={false}
+                                    style={Object {}}
+                                    to="/org-slug/project-slug/"
+                                  >
+                                    <a
+                                      onClick={[Function]}
+                                      style={Object {}}
+                                    >
+                                      <ProjectLabel
+                                        project={
+                                          Object {
+                                            "hasAccess": true,
+                                            "id": "2",
+                                            "isBookmarked": false,
+                                            "isMember": true,
+                                            "name": "Project Name",
+                                            "slug": "project-slug",
+                                            "teams": Array [
+                                              Object {
+                                                "id": "1",
+                                                "name": "Team Name",
+                                                "slug": "team-slug",
+                                              },
+                                            ],
+                                          }
+                                        }
+                                      >
+                                        <span
+                                          className="project-label"
+                                          project={
+                                            Object {
+                                              "hasAccess": true,
+                                              "id": "2",
+                                              "isBookmarked": false,
+                                              "isMember": true,
+                                              "name": "Project Name",
+                                              "slug": "project-slug",
+                                              "teams": Array [
+                                                Object {
+                                                  "id": "1",
+                                                  "name": "Team Name",
+                                                  "slug": "team-slug",
+                                                },
+                                              ],
+                                            }
+                                          }
+                                        >
+                                          <span
+                                            className="project-name"
+                                          >
+                                            project-slug
+                                          </span>
+                                        </span>
+                                      </ProjectLabel>
+                                    </a>
+                                  </Link>
+                                  <div
+                                    className="project-chart"
+                                  />
+                                </div>
+                              </Base>
+                            </Flex>
+                            <Box
+                              ml={2}
+                            >
+                              <Base
+                                className="glamor-23"
+                                ml={2}
+                              >
+                                <div
+                                  className="glamor-23"
+                                  is={null}
+                                >
+                                  <Button
+                                    disabled={false}
+                                    size="small"
+                                    to="/settings/organization/org-slug/project/project-slug/settings/"
+                                  >
+                                    <Link
+                                      className="button button-default button-sm"
+                                      disabled={false}
+                                      onClick={[Function]}
+                                      onlyActiveOnIndex={false}
+                                      role="button"
+                                      style={Object {}}
+                                      to="/settings/organization/org-slug/project/project-slug/settings/"
+                                    >
+                                      <a
+                                        className="button button-default button-sm"
+                                        disabled={false}
+                                        onClick={[Function]}
+                                        role="button"
+                                        style={Object {}}
+                                      >
+                                        <Flex
+                                          align="center"
+                                          className="button-label"
+                                        >
+                                          <Base
+                                            align="center"
+                                            className="button-label glamor-2"
+                                          >
+                                            <div
+                                              className="button-label glamor-2"
+                                              is={null}
+                                            >
+                                              Manage Project
+                                            </div>
+                                          </Base>
+                                        </Flex>
+                                      </a>
+                                    </Link>
+                                  </Button>
+                                </div>
+                              </Base>
+                            </Box>
+                          </div>
+                        </Base>
+                      </StyledPanelItem>
+                    </PanelItem>
+                  </div>
+                </PanelBody>
+              </div>
+            </StyledPanel>
+          </Panel>
+          <Panel
+            key="null"
+          >
+            <StyledPanel>
+              <div
+                className="glamor-29 glamor-30"
+              >
+                <PanelHeader
+                  className="glamor-17"
+                >
+                  <StyledPanelHeader
+                    className="glamor-17"
+                  >
+                    <Component
+                      className="glamor-13 glamor-14"
+                    >
+                      <div
+                        className="glamor-13 glamor-14"
+                      >
+                        <StyledPanelHeading>
+                          <Component
+                            className="glamor-9 glamor-6"
+                          >
+                            <PanelHeading
+                              className="glamor-9 glamor-6"
+                            >
+                              <div
+                                className="glamor-6 glamor-7 glamor-8"
+                              >
+                                Projects Without Teams
+                              </div>
+                            </PanelHeading>
+                          </Component>
+                        </StyledPanelHeading>
+                      </div>
+                    </Component>
+                  </StyledPanelHeader>
+                </PanelHeader>
+                <PanelBody
+                  direction="column"
+                  disablePadding={true}
+                  flex={false}
+                >
+                  <div
+                    className=""
+                  >
+                    <PanelItem
+                      align="center"
+                      key="3"
+                      p={2}
+                    >
+                      <StyledPanelItem
+                        align="center"
+                        p={2}
+                      >
+                        <Base
+                          align="center"
+                          className="glamor-25 glamor-26"
+                          p={2}
+                        >
+                          <div
+                            className="glamor-25 glamor-26"
+                            is={null}
+                          >
+                            <Flex
+                              flex="1"
+                              justify="space-between"
+                            >
+                              <Base
+                                className="glamor-19"
+                                flex="1"
+                                justify="space-between"
+                              >
+                                <div
+                                  className="glamor-19"
+                                  is={null}
+                                >
+                                  <Link
+                                    onlyActiveOnIndex={false}
+                                    style={Object {}}
+                                    to="/org-slug/project-slug-2/"
+                                  >
+                                    <a
+                                      onClick={[Function]}
+                                      style={Object {}}
+                                    >
+                                      <ProjectLabel
+                                        project={
+                                          Object {
+                                            "hasAccess": true,
+                                            "id": "3",
+                                            "isBookmarked": false,
+                                            "isMember": true,
+                                            "name": "Project Name 2",
+                                            "slug": "project-slug-2",
+                                            "teams": Array [],
+                                          }
+                                        }
+                                      >
+                                        <span
+                                          className="project-label"
+                                          project={
+                                            Object {
+                                              "hasAccess": true,
+                                              "id": "3",
+                                              "isBookmarked": false,
+                                              "isMember": true,
+                                              "name": "Project Name 2",
+                                              "slug": "project-slug-2",
+                                              "teams": Array [],
+                                            }
+                                          }
+                                        >
+                                          <span
+                                            className="project-name"
+                                          >
+                                            project-slug-2
+                                          </span>
+                                        </span>
+                                      </ProjectLabel>
+                                    </a>
+                                  </Link>
+                                  <div
+                                    className="project-chart"
+                                  />
+                                </div>
+                              </Base>
+                            </Flex>
+                            <Box
+                              ml={2}
+                            >
+                              <Base
+                                className="glamor-23"
+                                ml={2}
+                              >
+                                <div
+                                  className="glamor-23"
+                                  is={null}
+                                >
+                                  <Button
+                                    disabled={false}
+                                    size="small"
+                                    to="/settings/organization/org-slug/project/project-slug-2/settings/"
+                                  >
+                                    <Link
+                                      className="button button-default button-sm"
+                                      disabled={false}
+                                      onClick={[Function]}
+                                      onlyActiveOnIndex={false}
+                                      role="button"
+                                      style={Object {}}
+                                      to="/settings/organization/org-slug/project/project-slug-2/settings/"
+                                    >
+                                      <a
+                                        className="button button-default button-sm"
+                                        disabled={false}
+                                        onClick={[Function]}
+                                        role="button"
+                                        style={Object {}}
+                                      >
+                                        <Flex
+                                          align="center"
+                                          className="button-label"
+                                        >
+                                          <Base
+                                            align="center"
+                                            className="button-label glamor-2"
+                                          >
+                                            <div
+                                              className="button-label glamor-2"
+                                              is={null}
+                                            >
+                                              Manage Project
+                                            </div>
+                                          </Base>
+                                        </Flex>
+                                      </a>
+                                    </Link>
+                                  </Button>
+                                </div>
+                              </Base>
+                            </Box>
+                          </div>
+                        </Base>
+                      </StyledPanelItem>
+                    </PanelItem>
+                  </div>
+                </PanelBody>
+              </div>
+            </StyledPanel>
+          </Panel>
+        </div>
+      </div>
+    </div>
+  </OrganizationTeamsProjectsView>
+</withProjects>
+`;
diff --git a/tests/js/spec/views/organizationTeamsProjects.spec.jsx b/tests/js/spec/views/organizationTeamsProjects.spec.jsx
new file mode 100644
index 0000000000..bb2724f75c
--- /dev/null
+++ b/tests/js/spec/views/organizationTeamsProjects.spec.jsx
@@ -0,0 +1,33 @@
+import React from 'react';
+import {mount} from 'enzyme';
+
+import ProjectsStore from 'app/stores/projectsStore';
+
+import OrganizationTeamsProjectsView from 'app/views/organizationTeamsProjects';
+
+describe('OrganizationTeamProjects', function() {
+  let project;
+  let project2;
+  let team;
+
+  beforeEach(function() {
+    team = TestStubs.Team({slug: 'team-slug'});
+    project = TestStubs.Project({teams: [team]});
+    project2 = TestStubs.Project({
+      id: '3',
+      slug: 'project-slug-2',
+      name: 'Project Name 2',
+    });
+
+    ProjectsStore.loadInitialData([project, project2]);
+  });
+
+  it('Should render', function() {
+    let wrapper = mount(
+      <OrganizationTeamsProjectsView params={{orgId: 'org-slug'}} />,
+      TestStubs.routerOrganizationContext()
+    );
+
+    expect(wrapper).toMatchSnapshot();
+  });
+});
