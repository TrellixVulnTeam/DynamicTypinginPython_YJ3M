commit 74e5b31ab4d97e5ad7b3f7bd7508db64e4cbabff
Author: Daniel Griesser <daniel.griesser.86@gmail.com>
Date:   Fri Sep 21 16:38:40 2018 +0200

    fix: Inject loader if lazy no (#9844)
    
    * fix: Inject loader if lazy no
    
    * ref: Update minified loader

diff --git a/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx b/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
index cfe2a9cfcd..ff9a3604ff 100644
--- a/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
+++ b/src/sentry/static/sentry/app/views/settings/project/projectKeys/projectKeyDetails.jsx
@@ -410,7 +410,7 @@ const KeySettings = createReactClass({
                   inline={false}
                   flexibleControlStateSize
                 >
-                  <TextCopyInput>{`<script src='${loaderLink}'></script>`}</TextCopyInput>
+                  <TextCopyInput>{`<script src='${loaderLink}' crossorigin="anonymous"></script>`}</TextCopyInput>
                 </Field>
                 <SelectField
                   name="browserSdkVersion"
diff --git a/src/sentry/templates/sentry/js-sdk-loader.js.tmpl b/src/sentry/templates/sentry/js-sdk-loader.js.tmpl
index ece31f605d..9bfbcbdaf2 100644
--- a/src/sentry/templates/sentry/js-sdk-loader.js.tmpl
+++ b/src/sentry/templates/sentry/js-sdk-loader.js.tmpl
@@ -182,4 +182,10 @@
     });
     if (_oldOnunhandledrejection) _oldOnunhandledrejection.apply(_window, arguments);
   };
+
+  if (!lazy) {
+    setTimeout(function() {
+      injectSdk(onLoadCallback);
+    });
+  }
 })(window, document, "script", "onerror", "onunhandledrejection", "Sentry", "{{ publicKey|safe }}", "{{ jsSdkUrl|safe }}", {{ config|to_json|safe }});
diff --git a/src/sentry/templates/sentry/js-sdk-loader.min.js.tmpl b/src/sentry/templates/sentry/js-sdk-loader.min.js.tmpl
index f72a9cd23f..93ccdcc6ab 100644
--- a/src/sentry/templates/sentry/js-sdk-loader.min.js.tmpl
+++ b/src/sentry/templates/sentry/js-sdk-loader.min.js.tmpl
@@ -1,3 +1,3 @@
-{% load sentry_helpers %}(function(c,t,u,m,f,l,y,z,v){function n(a){if(!w){w=!0;var e=t.getElementsByTagName(u)[0],b=t.createElement(u);b.src=z;b.crossorigin="anonymous";b.addEventListener("load",function(){try{c[m]=p;c[f]=q;var b=c[l],e=b.init;b.init=function(a){for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(v[b]=a[b]);e(v)};A(a,b)}catch(d){console.error(d)}});e.parentNode.insertBefore(b,e)}}function A(a,e){try{a&&a();for(var b=k.data,g=!1,h=!1,d=0;d<b.length;d++)if(b[d].f){h=!0;var f=b[d];!1===g&&"init"!==f.f&&
-e.init();g=!0;e[f.f].apply(e,f.a)}!1===h&&e.init();var l=c[m];for(d=0;d<b.length;d++)b[d].e?l.apply(c,b[d].e):b[d].p&&e.captureException(b[d].p)}catch(B){console.error(B)}}for(var g=!0,x=!1,h=0;h<document.scripts.length;h++)if(-1<document.scripts[h].src.indexOf(y)){g="no"!==document.scripts[h].dataset.lazy;break}var w=!1,r,k=function(a){(a.e||a.p||a.f&&-1<a.f.indexOf("capture")||a.f&&-1<a.f.indexOf("showReportDialog"))&&g&&n(r);k.data.push(a)};k.data=[];c[l]={onLoad:function(a){g&&!x?r=a:n(a)},forceLoad:function(){x=
-!0;g&&setTimeout(function(){n(r)})}};"init addBreadcrumb captureMessage captureException captureEvent configureScope withScope showReportDialog".split(" ").forEach(function(a){c[l][a]=function(){k({f:a,a:arguments})}});var p=c[m];c[m]=function(a,e,b,f,g){k({e:[].slice.call(arguments)});p&&p.apply(c,arguments)};var q=c[f];c[f]=function(a){k({p:a.reason});q&&q.apply(c,arguments)}})(window,document,"script","onerror","onunhandledrejection","Sentry","{{ publicKey|safe }}","{{ jsSdkUrl|safe }}",{{ config|to_json|safe }});
+{% load sentry_helpers %}(function(c,t,u,m,n,p,y,z,v){function h(a){if(!w){w=!0;var e=t.getElementsByTagName(u)[0],b=t.createElement(u);b.src=z;b.crossorigin="anonymous";b.addEventListener("load",function(){try{c[m]=q;c[n]=r;var b=c[p],e=b.init;b.init=function(a){for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(v[b]=a[b]);e(v)};A(a,b)}catch(d){console.error(d)}});e.parentNode.insertBefore(b,e)}}function A(a,e){try{a&&a();for(var b=k.data,f=!1,h=!1,d=0;d<b.length;d++)if(b[d].f){h=!0;var g=b[d];!1===f&&"init"!==g.f&&
+e.init();f=!0;e[g.f].apply(e,g.a)}!1===h&&e.init();var l=c[m];for(d=0;d<b.length;d++)b[d].e?l.apply(c,b[d].e):b[d].p&&e.captureException(b[d].p)}catch(B){console.error(B)}}for(var f=!0,x=!1,g=0;g<document.scripts.length;g++)if(-1<document.scripts[g].src.indexOf(y)){f="no"!==document.scripts[g].dataset.lazy;break}var w=!1,l,k=function(a){(a.e||a.p||a.f&&-1<a.f.indexOf("capture")||a.f&&-1<a.f.indexOf("showReportDialog"))&&f&&h(l);k.data.push(a)};k.data=[];c[p]={onLoad:function(a){f&&!x?l=a:h(a)},forceLoad:function(){x=
+!0;f&&setTimeout(function(){h(l)})}};"init addBreadcrumb captureMessage captureException captureEvent configureScope withScope showReportDialog".split(" ").forEach(function(a){c[p][a]=function(){k({f:a,a:arguments})}});var q=c[m];c[m]=function(a,e,b,f,g){k({e:[].slice.call(arguments)});q&&q.apply(c,arguments)};var r=c[n];c[n]=function(a){k({p:a.reason});r&&r.apply(c,arguments)};f||setTimeout(function(){h(l)})})(window,document,"script","onerror","onunhandledrejection","Sentry","{{ publicKey|safe }}","{{ jsSdkUrl|safe }}",{{ config|to_json|safe }});
