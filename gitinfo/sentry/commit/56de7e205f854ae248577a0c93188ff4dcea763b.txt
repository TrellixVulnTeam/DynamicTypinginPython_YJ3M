commit 56de7e205f854ae248577a0c93188ff4dcea763b
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Nov 13 02:07:58 2012 -0800

    Ugly hack to fix sparklines in ajax tabs

diff --git a/src/sentry/static/sentry/coffee/app.coffee b/src/sentry/static/sentry/coffee/app.coffee
index 82c746f036..33d87ce829 100644
--- a/src/sentry/static/sentry/coffee/app.coffee
+++ b/src/sentry/static/sentry/coffee/app.coffee
@@ -96,7 +96,7 @@ jQuery ->
                     view.load()
                     return
 
-                $cont = $(name)
+                $cont = $('#' + view_id)
                 $parent = $cont.parent()
 
                 $parent.css('opacity', .6)
@@ -110,8 +110,16 @@ jQuery ->
                         view.load(data)
                         $parent.css('opacity', 1)
                         $tab.tab('show')
-                    # error: ->
-                    #     $cont.html('<p>{% trans "There was an error fetching data from the server." %}</p>')
+
+                        if $cont.find('.sparkline canvas').length == 0
+                            $cont.find('.sparkline').each (_, el) =>
+                                # TODO: find a way to not run this check each time
+                                $(el).sparkline 'html'
+                                    enableTagOptions: true
+                                    height: $(el).height()
+
+                    error: ->
+                        $cont.html('<p>There was an error fetching data from the server.</p>')
     
             # initialize active tabs
             $('li.active a[data-toggle=ajtab]').click()
diff --git a/src/sentry/static/sentry/scripts/site.js b/src/sentry/static/sentry/scripts/site.js
index c4ef29fbb6..83991daad7 100644
--- a/src/sentry/static/sentry/scripts/site.js
+++ b/src/sentry/static/sentry/scripts/site.js
@@ -115,7 +115,7 @@
             view.load();
             return;
           }
-          $cont = $(name);
+          $cont = $('#' + view_id);
           $parent = $cont.parent();
           $parent.css('opacity', .6);
           e.preventDefault();
@@ -125,7 +125,18 @@
             success: function(data) {
               view.load(data);
               $parent.css('opacity', 1);
-              return $tab.tab('show');
+              $tab.tab('show');
+              if ($cont.find('.sparkline canvas').length === 0) {
+                return $cont.find('.sparkline').each(function(_, el) {
+                  return $(el).sparkline('html', {
+                    enableTagOptions: true,
+                    height: $(el).height()
+                  });
+                });
+              }
+            },
+            error: function() {
+              return $cont.html('<p>There was an error fetching data from the server.</p>');
             }
           });
         });
