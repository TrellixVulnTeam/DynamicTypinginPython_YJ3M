commit 33d5aa268e4a6dee5c27daa4d6ebe32d384c4d7a
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Thu Aug 11 19:42:54 2016 -0700

    Prevent XSS through Request interface (#3923)
    
    An attacker could craft a Sentry packet with a `javascript:*` url, which
    we conveniently link in the UI to be clicked.
    
    This just adds some validation that what we're given is in fact a valid
    url. This is a bit restrictive, since it'll only allow `http:` and
    `https:`, but I think this is fine.

diff --git a/src/sentry/static/sentry/app/components/events/interfaces/request.jsx b/src/sentry/static/sentry/app/components/events/interfaces/request.jsx
index 5bf184ddba..eb7382f6ca 100644
--- a/src/sentry/static/sentry/app/components/events/interfaces/request.jsx
+++ b/src/sentry/static/sentry/app/components/events/interfaces/request.jsx
@@ -3,6 +3,7 @@ import GroupEventDataSection from '../eventDataSection';
 import PropTypes from '../../../proptypes';
 import RichHttpContent from './richHttpContent';
 import {getCurlCommand} from './utils';
+import {isUrl} from '../../../utils';
 import {t} from '../../../locale';
 
 import Truncate from '../../../components/truncate';
@@ -60,7 +61,10 @@ const RequestInterface = React.createClass({
 
     let children = [];
 
-    if (!this.isPartial()) {
+    // Check if the url passed in is a safe url to avoid XSS
+    let isValidUrl = isUrl(fullUrl);
+
+    if (!this.isPartial() && isValidUrl) {
       children.push(
         <div key="view-buttons" className="btn-group">
           <a className={(view === 'rich' ? 'active' : '') + ' btn btn-default btn-sm'}
@@ -75,13 +79,15 @@ const RequestInterface = React.createClass({
 
     children.push(
       <h3 key="title">
-        <a href={fullUrl} title={fullUrl}>
+        <a href={isValidUrl ? fullUrl : null} title={fullUrl}>
           <span className="path"><strong>{data.method || 'GET'}</strong>
             <Truncate value={parsedUrl.pathname} maxLength={36} leftTrim={true} />
           </span>
-          <span className="external-icon">
-            <em className="icon-open" />
-          </span>
+          {isValidUrl &&
+            <span className="external-icon">
+              <em className="icon-open" />
+            </span>
+          }
         </a>
         <small style={{marginLeft: 10}} className="host">{parsedUrl.hostname}</small>
       </h3>
