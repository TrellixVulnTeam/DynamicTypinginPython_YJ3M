commit 35fff41f0d6ad1afdbc5b67c0435e034221b95da
Author: Markus Unterwaditzer <markus@unterwaditzer.net>
Date:   Fri Jul 10 19:00:54 2020 +0200

    ref(inbound-filters): Move filters into one module (#19790)

diff --git a/src/sentry/api/endpoints/project_details.py b/src/sentry/api/endpoints/project_details.py
index 307c8fa017..7304db6f27 100644
--- a/src/sentry/api/endpoints/project_details.py
+++ b/src/sentry/api/endpoints/project_details.py
@@ -12,7 +12,7 @@ from rest_framework import serializers, status
 from rest_framework.response import Response
 
 from sentry import features
-from sentry.utils.data_filters import FilterTypes
+from sentry.ingest.inbound_filters import FilterTypes
 from sentry.api.base import DocSection
 from sentry.api.bases.project import ProjectEndpoint, ProjectPermission
 from sentry.api.decorators import sudo_required
diff --git a/src/sentry/api/endpoints/project_filter_details.py b/src/sentry/api/endpoints/project_filter_details.py
index 69001cbb42..1e45aa9037 100644
--- a/src/sentry/api/endpoints/project_filter_details.py
+++ b/src/sentry/api/endpoints/project_filter_details.py
@@ -2,7 +2,7 @@ from __future__ import absolute_import
 
 from rest_framework.response import Response
 
-from sentry import message_filters
+from sentry.ingest import inbound_filters
 from sentry.api.bases.project import ProjectEndpoint
 from sentry.api.exceptions import ResourceDoesNotExist
 from sentry.models.auditlogentry import AuditLogEntryEvent
@@ -19,7 +19,7 @@ class ProjectFilterDetailsEndpoint(ProjectEndpoint):
 
         """
         current_filter = None
-        for flt in message_filters.get_all_filter_specs():
+        for flt in inbound_filters.get_all_filter_specs():
             if flt.id == filter_id:
                 current_filter = flt
                 break
@@ -31,9 +31,9 @@ class ProjectFilterDetailsEndpoint(ProjectEndpoint):
         if not serializer.is_valid():
             return Response(serializer.errors, status=400)
 
-        current_state = message_filters.get_filter_state(filter_id, project)
+        current_state = inbound_filters.get_filter_state(filter_id, project)
 
-        new_state = message_filters.set_filter_state(filter_id, project, serializer.validated_data)
+        new_state = inbound_filters.set_filter_state(filter_id, project, serializer.validated_data)
         audit_log_state = AuditLogEntryEvent.PROJECT_ENABLE
 
         if filter_id == "legacy-browsers":
diff --git a/src/sentry/api/endpoints/project_filters.py b/src/sentry/api/endpoints/project_filters.py
index d56051f348..92593ccfb5 100644
--- a/src/sentry/api/endpoints/project_filters.py
+++ b/src/sentry/api/endpoints/project_filters.py
@@ -2,7 +2,7 @@ from __future__ import absolute_import
 
 from rest_framework.response import Response
 
-from sentry import message_filters
+from sentry.ingest import inbound_filters
 from sentry.api.bases.project import ProjectEndpoint
 
 
@@ -17,13 +17,13 @@ class ProjectFiltersEndpoint(ProjectEndpoint):
 
         """
         results = []
-        for flt in message_filters.get_all_filter_specs():
+        for flt in inbound_filters.get_all_filter_specs():
             results.append(
                 {
                     "id": flt.id,
                     # 'active' will be either a boolean or list for the legacy browser filters
                     # all other filters will be boolean
-                    "active": message_filters.get_filter_state(flt.id, project),
+                    "active": inbound_filters.get_filter_state(flt.id, project),
                     "description": flt.description,
                     "name": flt.name,
                     "hello": flt.id + " - " + flt.name,
diff --git a/src/sentry/api/endpoints/project_stats.py b/src/sentry/api/endpoints/project_stats.py
index 097a1246c5..9575343c4f 100644
--- a/src/sentry/api/endpoints/project_stats.py
+++ b/src/sentry/api/endpoints/project_stats.py
@@ -7,7 +7,7 @@ from sentry.api.base import DocSection, EnvironmentMixin, StatsMixin
 from sentry.api.bases.project import ProjectEndpoint
 from sentry.api.exceptions import ResourceDoesNotExist
 from sentry.models import Environment
-from sentry.utils.data_filters import FILTER_STAT_KEYS_TO_VALUES
+from sentry.ingest.inbound_filters import FILTER_STAT_KEYS_TO_VALUES
 from sentry.utils.apidocs import scenario, attach_scenarios
 
 
diff --git a/src/sentry/api/serializers/models/project.py b/src/sentry/api/serializers/models/project.py
index c64436ab35..0c502d4b56 100644
--- a/src/sentry/api/serializers/models/project.py
+++ b/src/sentry/api/serializers/models/project.py
@@ -35,7 +35,7 @@ from sentry.models import (
     UserOption,
     UserReport,
 )
-from sentry.utils.data_filters import FilterTypes
+from sentry.ingest.inbound_filters import FilterTypes
 from sentry.utils.compat import zip
 
 STATUS_LABELS = {
diff --git a/src/sentry/event_manager.py b/src/sentry/event_manager.py
index 3768afb9cd..4cf9ce1975 100644
--- a/src/sentry/event_manager.py
+++ b/src/sentry/event_manager.py
@@ -65,7 +65,7 @@ from sentry.signals import first_event_received
 from sentry.tasks.integrations import kick_off_status_syncs
 from sentry.utils import json, metrics
 from sentry.utils.canonical import CanonicalKeyDict
-from sentry.utils.data_filters import FilterStatKeys
+from sentry.ingest.inbound_filters import FilterStatKeys
 from sentry.utils.dates import to_timestamp, to_datetime
 from sentry.utils.outcomes import Outcome, track_outcome
 from sentry.utils.safe import safe_execute, trim, get_path, setdefault_path
diff --git a/src/sentry/message_filters.py b/src/sentry/ingest/inbound_filters.py
similarity index 77%
rename from src/sentry/message_filters.py
rename to src/sentry/ingest/inbound_filters.py
index 985c677222..634671e1b1 100644
--- a/src/sentry/message_filters.py
+++ b/src/sentry/ingest/inbound_filters.py
@@ -2,10 +2,53 @@ from __future__ import absolute_import
 
 from rest_framework import serializers
 
+from sentry import tsdb
+from sentry.relay.utils import to_camel_case_name
 from sentry.api.fields.multiplechoice import MultipleChoiceField
 from sentry.models.projectoption import ProjectOption
 from sentry.signals import inbound_filter_toggled
-from sentry.utils.data_filters import FilterStatKeys, get_filter_key
+
+
+class FilterStatKeys(object):
+    """
+    NOTE: This enum also exists in Relay, check if alignment is needed when
+    editing this.
+    """
+
+    IP_ADDRESS = "ip-address"
+    RELEASE_VERSION = "release-version"
+    ERROR_MESSAGE = "error-message"
+    BROWSER_EXTENSION = "browser-extensions"
+    LEGACY_BROWSER = "legacy-browsers"
+    LOCALHOST = "localhost"
+    WEB_CRAWLER = "web-crawlers"
+    INVALID_CSP = "invalid-csp"
+    CORS = "cors"
+    DISCARDED_HASH = "discarded-hash"  # Not replicated in Relay
+    CRASH_REPORT_LIMIT = "crash-report-limit"  # Not replicated in Relay
+
+
+FILTER_STAT_KEYS_TO_VALUES = {
+    FilterStatKeys.IP_ADDRESS: tsdb.models.project_total_received_ip_address,
+    FilterStatKeys.RELEASE_VERSION: tsdb.models.project_total_received_release_version,
+    FilterStatKeys.ERROR_MESSAGE: tsdb.models.project_total_received_error_message,
+    FilterStatKeys.BROWSER_EXTENSION: tsdb.models.project_total_received_browser_extensions,
+    FilterStatKeys.LEGACY_BROWSER: tsdb.models.project_total_received_legacy_browsers,
+    FilterStatKeys.LOCALHOST: tsdb.models.project_total_received_localhost,
+    FilterStatKeys.WEB_CRAWLER: tsdb.models.project_total_received_web_crawlers,
+    FilterStatKeys.INVALID_CSP: tsdb.models.project_total_received_invalid_csp,
+    FilterStatKeys.CORS: tsdb.models.project_total_received_cors,
+    FilterStatKeys.DISCARDED_HASH: tsdb.models.project_total_received_discarded,
+}
+
+
+class FilterTypes(object):
+    ERROR_MESSAGES = "error_messages"
+    RELEASES = "releases"
+
+
+def get_filter_key(flt):
+    return to_camel_case_name(flt.id.replace("-", "_"))
 
 
 def get_all_filter_specs():
diff --git a/src/sentry/relay/config.py b/src/sentry/relay/config.py
index f742f964df..e112bb5d01 100644
--- a/src/sentry/relay/config.py
+++ b/src/sentry/relay/config.py
@@ -12,8 +12,12 @@ from sentry import quotas, utils
 from sentry.constants import ObjectStatus
 from sentry.grouping.api import get_grouping_config_dict_for_project
 from sentry.interfaces.security import DEFAULT_DISALLOWED_SOURCES
-from sentry.message_filters import get_all_filter_specs
-from sentry.utils.data_filters import FilterTypes, FilterStatKeys, get_filter_key
+from sentry.ingest.inbound_filters import (
+    get_all_filter_specs,
+    FilterTypes,
+    FilterStatKeys,
+    get_filter_key,
+)
 from sentry.utils.http import get_origins
 from sentry.utils.sdk import configure_scope
 from sentry.relay.utils import to_camel_case_name
diff --git a/src/sentry/tsdb/snuba.py b/src/sentry/tsdb/snuba.py
index e45178bdf5..87388edf2d 100644
--- a/src/sentry/tsdb/snuba.py
+++ b/src/sentry/tsdb/snuba.py
@@ -8,7 +8,7 @@ import six
 
 from sentry.tsdb.base import BaseTSDB, TSDBModel
 from sentry.utils import snuba, outcomes
-from sentry.utils.data_filters import FILTER_STAT_KEYS_TO_VALUES
+from sentry.ingest.inbound_filters import FILTER_STAT_KEYS_TO_VALUES
 from sentry.utils.dates import to_datetime
 from sentry.utils.compat import map
 from sentry.utils.compat import zip
diff --git a/src/sentry/utils/data_filters.py b/src/sentry/utils/data_filters.py
deleted file mode 100644
index 8d4db3f053..0000000000
--- a/src/sentry/utils/data_filters.py
+++ /dev/null
@@ -1,46 +0,0 @@
-from __future__ import absolute_import
-
-from sentry import tsdb
-from sentry.relay.utils import to_camel_case_name
-
-
-class FilterStatKeys(object):
-    """
-    NOTE: This enum also exists in Relay, check if alignment is needed when
-    editing this.
-    """
-
-    IP_ADDRESS = "ip-address"
-    RELEASE_VERSION = "release-version"
-    ERROR_MESSAGE = "error-message"
-    BROWSER_EXTENSION = "browser-extensions"
-    LEGACY_BROWSER = "legacy-browsers"
-    LOCALHOST = "localhost"
-    WEB_CRAWLER = "web-crawlers"
-    INVALID_CSP = "invalid-csp"
-    CORS = "cors"
-    DISCARDED_HASH = "discarded-hash"  # Not replicated in Relay
-    CRASH_REPORT_LIMIT = "crash-report-limit"  # Not replicated in Relay
-
-
-FILTER_STAT_KEYS_TO_VALUES = {
-    FilterStatKeys.IP_ADDRESS: tsdb.models.project_total_received_ip_address,
-    FilterStatKeys.RELEASE_VERSION: tsdb.models.project_total_received_release_version,
-    FilterStatKeys.ERROR_MESSAGE: tsdb.models.project_total_received_error_message,
-    FilterStatKeys.BROWSER_EXTENSION: tsdb.models.project_total_received_browser_extensions,
-    FilterStatKeys.LEGACY_BROWSER: tsdb.models.project_total_received_legacy_browsers,
-    FilterStatKeys.LOCALHOST: tsdb.models.project_total_received_localhost,
-    FilterStatKeys.WEB_CRAWLER: tsdb.models.project_total_received_web_crawlers,
-    FilterStatKeys.INVALID_CSP: tsdb.models.project_total_received_invalid_csp,
-    FilterStatKeys.CORS: tsdb.models.project_total_received_cors,
-    FilterStatKeys.DISCARDED_HASH: tsdb.models.project_total_received_discarded,
-}
-
-
-class FilterTypes(object):
-    ERROR_MESSAGES = "error_messages"
-    RELEASES = "releases"
-
-
-def get_filter_key(flt):
-    return to_camel_case_name(flt.id.replace("-", "_"))
diff --git a/src/sentry/utils/outcomes.py b/src/sentry/utils/outcomes.py
index f44675f59d..c1d9adee1b 100644
--- a/src/sentry/utils/outcomes.py
+++ b/src/sentry/utils/outcomes.py
@@ -12,7 +12,7 @@ import time
 from sentry import tsdb, options
 from sentry.constants import DataCategory
 from sentry.utils import json, metrics
-from sentry.utils.data_filters import FILTER_STAT_KEYS_TO_VALUES
+from sentry.ingest.inbound_filters import FILTER_STAT_KEYS_TO_VALUES
 from sentry.utils.dates import to_datetime
 from sentry.utils.pubsub import KafkaPublisher
 
diff --git a/tests/relay_integration/test_message_filters.py b/tests/relay_integration/test_message_filters.py
index 2c091f97b2..68bdecc64d 100644
--- a/tests/relay_integration/test_message_filters.py
+++ b/tests/relay_integration/test_message_filters.py
@@ -4,7 +4,7 @@ from __future__ import absolute_import, print_function
 from sentry.testutils import TransactionTestCase, RelayStoreHelper
 from sentry.models.projectoption import ProjectOption
 from sentry.utils.safe import set_path
-from sentry.message_filters import (
+from sentry.ingest.inbound_filters import (
     _localhost_filter,
     _browser_extensions_filter,
     _web_crawlers_filter,
diff --git a/tests/sentry/event_manager/test_event_manager.py b/tests/sentry/event_manager/test_event_manager.py
index 3fe1b5fd9b..d3fe022550 100644
--- a/tests/sentry/event_manager/test_event_manager.py
+++ b/tests/sentry/event_manager/test_event_manager.py
@@ -39,7 +39,7 @@ from sentry.models import (
 from sentry.utils.cache import cache_key_for_event
 from sentry.utils.outcomes import Outcome
 from sentry.testutils import assert_mock_called_once_with_partial, TestCase
-from sentry.utils.data_filters import FilterStatKeys
+from sentry.ingest.inbound_filters import FilterStatKeys
 
 
 def make_event(**kwargs):
