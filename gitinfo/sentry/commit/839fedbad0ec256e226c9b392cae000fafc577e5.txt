commit 839fedbad0ec256e226c9b392cae000fafc577e5
Author: Jan Michael Auer <jan.auer@sentry.io>
Date:   Wed Apr 29 09:26:54 2020 +0200

    fix(quotas): Validate that id-less quotas have no window (#18485)
    
    Fixes a loophole in quota validation when an `id` is set but no
    `window`.

diff --git a/src/sentry/quotas/base.py b/src/sentry/quotas/base.py
index 3894706eb9..75ab384672 100644
--- a/src/sentry/quotas/base.py
+++ b/src/sentry/quotas/base.py
@@ -75,7 +75,8 @@ class QuotaConfig(object):
             assert reason_code, "reason code required for fallible quotas"
 
         if limit == 0:
-            assert window is None, "zero-sized quotas cannot have a window"
+            assert id is None, "reject-all quotas cannot be tracked"
+            assert window is None, "tracked quotas must specify a window"
         else:
             assert id, "measured quotas require an identifier"
             assert window and window > 0, "window cannot be zero"
@@ -100,7 +101,7 @@ class QuotaConfig(object):
         Whether the quotas service should track this quota.
         """
 
-        return self.id is not None
+        return self.id is not None and self.window is not None
 
     def to_json_legacy(self):
         data = {
