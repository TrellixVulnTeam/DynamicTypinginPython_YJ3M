commit a96ec4f2709785c9a3ffafd1a0c00249aa870e8a
Author: Stephen Cefali <scefali@sentry.io>
Date:   Wed Nov 6 07:58:47 2019 -0800

    migration(plugins): use sessionstack from sentry core

diff --git a/conftest.py b/conftest.py
index 2180016227..16a30ed74b 100644
--- a/conftest.py
+++ b/conftest.py
@@ -32,6 +32,7 @@ def install_sentry_plugins():
     from sentry.runner.importer import install_plugin_apps
     from django.conf import settings
 
+    install_plugin_apps("sentry.new_apps", settings)
     install_plugin_apps("sentry.test_only_apps", settings)
 
     from sentry.runner.initializer import register_plugins
diff --git a/setup.py b/setup.py
index 1a17000654..97d8673ab9 100755
--- a/setup.py
+++ b/setup.py
@@ -140,13 +140,16 @@ setup(
     include_package_data=True,
     entry_points={
         "console_scripts": ["sentry = sentry.runner:main"],
+        "sentry.new_apps": [
+            "sessionstack = new_sentry_plugins.sessionstack",
+        ],
         "sentry.test_only_apps": [
             "jira_ac = test_only_plugins.jira_ac",
             "jira = test_only_plugins.jira",
-            "sessionstack = test_only_plugins.sessionstack",
         ],
         "sentry.new_plugins": [
             "amazon_sqs = new_sentry_plugins.amazon_sqs.plugin:AmazonSQSPlugin",
+            "sessionstack = new_sentry_plugins.sessionstack.plugin:SessionStackPlugin",
         ],
         "sentry.test_only_plugins": [
             "asana = test_only_plugins.asana.plugin:AsanaPlugin",
@@ -162,7 +165,6 @@ setup(
             "pivotal = test_only_plugins.pivotal.plugin:PivotalPlugin",
             "pushover = test_only_plugins.pushover.plugin:PushoverPlugin",
             "segment = test_only_plugins.segment.plugin:SegmentPlugin",
-            "sessionstack = test_only_plugins.sessionstack.plugin:SessionStackPlugin",
             "slack = test_only_plugins.slack.plugin:SlackPlugin",
             "splunk = test_only_plugins.splunk.plugin:SplunkPlugin",
             "victorops = test_only_plugins.victorops.plugin:VictorOpsPlugin",
diff --git a/src/new_sentry_plugins/base.py b/src/new_sentry_plugins/base.py
index 2ce4f248e4..bb0f8e9d64 100644
--- a/src/new_sentry_plugins/base.py
+++ b/src/new_sentry_plugins/base.py
@@ -1,18 +1,18 @@
 from __future__ import absolute_import
 
 import pkg_resources
-import test_only_plugins
+import new_sentry_plugins
 import six
 import sys
 
 from sentry.exceptions import InvalidIdentity, PluginError
 
-from test_only_plugins.constants import (
+from new_sentry_plugins.constants import (
     ERR_INTERNAL,
     ERR_UNAUTHORIZED,
     ERR_UNSUPPORTED_RESPONSE_TYPE,
 )
-from test_only_plugins.exceptions import (
+from new_sentry_plugins.exceptions import (
     ApiError,
     ApiHostError,
     ApiUnauthorized,
@@ -23,7 +23,7 @@ from test_only_plugins.exceptions import (
 class CorePluginMixin(object):
     author = "Sentry Team"
     author_url = "https://github.com/getsentry/sentry-plugins"
-    version = test_only_plugins.VERSION
+    version = new_sentry_plugins.VERSION
     resource_links = [
         ("Bug Tracker", "https://github.com/getsentry/sentry-plugins/issues"),
         ("Source", "https://github.com/getsentry/sentry-plugins"),
diff --git a/src/test_only_plugins/sessionstack/__init__.py b/src/new_sentry_plugins/sessionstack/__init__.py
similarity index 100%
rename from src/test_only_plugins/sessionstack/__init__.py
rename to src/new_sentry_plugins/sessionstack/__init__.py
diff --git a/src/test_only_plugins/sessionstack/client.py b/src/new_sentry_plugins/sessionstack/client.py
similarity index 100%
rename from src/test_only_plugins/sessionstack/client.py
rename to src/new_sentry_plugins/sessionstack/client.py
diff --git a/src/test_only_plugins/sessionstack/plugin.py b/src/new_sentry_plugins/sessionstack/plugin.py
similarity index 99%
rename from src/test_only_plugins/sessionstack/plugin.py
rename to src/new_sentry_plugins/sessionstack/plugin.py
index d2f35ee3f4..c1a2913f94 100644
--- a/src/test_only_plugins/sessionstack/plugin.py
+++ b/src/new_sentry_plugins/sessionstack/plugin.py
@@ -8,7 +8,7 @@ from sentry.plugins.base import Plugin2
 from sentry.plugins.base.configuration import react_plugin_config
 from sentry.exceptions import PluginError
 
-from test_only_plugins.base import CorePluginMixin
+from new_sentry_plugins.base import CorePluginMixin
 
 from .client import SessionStackClient, UnauthorizedError, InvalidWebsiteIdError, InvalidApiUrlError
 
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/components/settings.jsx b/src/new_sentry_plugins/sessionstack/static/sessionstack/components/settings.jsx
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/components/settings.jsx
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/components/settings.jsx
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/contexts/sessionstack.jsx b/src/new_sentry_plugins/sessionstack/static/sessionstack/contexts/sessionstack.jsx
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/contexts/sessionstack.jsx
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/contexts/sessionstack.jsx
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js b/src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.gz b/src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.gz
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.gz
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.gz
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map b/src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map.gz b/src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map.gz
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map.gz
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/dist/sessionstack.js.map.gz
diff --git a/src/test_only_plugins/sessionstack/static/sessionstack/sessionstack.jsx b/src/new_sentry_plugins/sessionstack/static/sessionstack/sessionstack.jsx
similarity index 100%
rename from src/test_only_plugins/sessionstack/static/sessionstack/sessionstack.jsx
rename to src/new_sentry_plugins/sessionstack/static/sessionstack/sessionstack.jsx
diff --git a/src/test_only_plugins/sessionstack/utils.py b/src/new_sentry_plugins/sessionstack/utils.py
similarity index 100%
rename from src/test_only_plugins/sessionstack/utils.py
rename to src/new_sentry_plugins/sessionstack/utils.py
diff --git a/src/sentry/runner/importer.py b/src/sentry/runner/importer.py
index a3ce8319ff..c808992068 100644
--- a/src/sentry/runner/importer.py
+++ b/src/sentry/runner/importer.py
@@ -79,6 +79,7 @@ class Importer(object):
         load_settings(self.config_path, settings=settings_mod, silent=True)
 
         install_plugin_apps("sentry.apps", settings_mod)
+        install_plugin_apps("sentry.new_apps", settings_mod)
 
         return settings_mod
 
diff --git a/src/sentry/testutils/cases.py b/src/sentry/testutils/cases.py
index 47255f8169..a9cb1203c5 100644
--- a/src/sentry/testutils/cases.py
+++ b/src/sentry/testutils/cases.py
@@ -687,6 +687,19 @@ class PluginTestCase(TestCase):
                 )
         self.fail("Missing app from entry_points: %r" % (name,))
 
+    # TODO (Steve): remove function
+    def assertNewAppInstalled(self, name, path):
+        for ep in iter_entry_points("sentry.new_apps"):
+            if ep.name == name:
+                ep_path = ep.module_name
+                if ep_path == path:
+                    return
+                self.fail(
+                    "Found app in entry_points, but wrong class. Got %r, expected %r"
+                    % (ep_path, path)
+                )
+        self.fail("Missing app from entry_points: %r" % (name,))
+
     def assertPluginInstalled(self, name, plugin):
         path = type(plugin).__module__ + ":" + type(plugin).__name__
         for ep in iter_entry_points("sentry.plugins"):
diff --git a/tests/sentry_plugins/sessionstack/test_plugin.py b/tests/sentry_plugins/sessionstack/test_plugin.py
index d7ee23d8a4..16999ad859 100644
--- a/tests/sentry_plugins/sessionstack/test_plugin.py
+++ b/tests/sentry_plugins/sessionstack/test_plugin.py
@@ -5,7 +5,7 @@ import responses
 from exam import fixture
 from sentry.testutils import PluginTestCase
 
-from test_only_plugins.sessionstack.plugin import SessionStackPlugin
+from new_sentry_plugins.sessionstack.plugin import SessionStackPlugin
 
 EXPECTED_SESSION_URL = (
     "https://app.sessionstack.com/player/#/sessions/588778a6c5762c1d566653ff"
@@ -26,7 +26,8 @@ class SessionStackPluginTest(PluginTestCase):
         assert self.plugin.conf_key == "sessionstack"
 
     def test_entry_point(self):
-        self.assertTestOnlyPluginInstalled("sessionstack", self.plugin)
+        self.assertNewPluginInstalled("sessionstack", self.plugin)
+        self.assertNewAppInstalled("sessionstack", "new_sentry_plugins.sessionstack")
 
     @responses.activate
     def test_config_validation(self):
