commit db96be9650f1d368f2f5eadb2552b45599ca1b87
Author: Brett Hoerner <brett@bretthoerner.com>
Date:   Tue Dec 12 14:27:14 2017 -0600

    fix: More randomness in create_environment names, always create (#6744)

diff --git a/src/sentry/testutils/fixtures.py b/src/sentry/testutils/fixtures.py
index a707e36603..598961848e 100644
--- a/src/sentry/testutils/fixtures.py
+++ b/src/sentry/testutils/fixtures.py
@@ -274,11 +274,14 @@ class Fixtures(object):
 
     def create_environment(self, **kwargs):
         project = kwargs.get('project', self.project)
-        name = kwargs.get('name', petname.Generate(1, ' ', letters=10))
-        return Environment.get_or_create(
-            project=project,
-            name=name
+        name = kwargs.get('name', petname.Generate(3, ' ', letters=10)[:64])
+        env = Environment.objects.create(
+            organization_id=project.organization_id,
+            project_id=project.id,
+            name=name,
         )
+        env.add_project(project)
+        return env
 
     def create_project(self, **kwargs):
         if not kwargs.get('name'):
