commit 1c834dd5ff0b30ca07a387164b96636566c84a61
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Tue Jan 17 01:24:16 2017 +0100

    Fixed a regression in last commit for culprit generation

diff --git a/src/sentry/lang/javascript/plugin.py b/src/sentry/lang/javascript/plugin.py
index df6111d7c6..ddbf2c7704 100644
--- a/src/sentry/lang/javascript/plugin.py
+++ b/src/sentry/lang/javascript/plugin.py
@@ -23,7 +23,7 @@ def generate_modules(data):
     for info in find_stacktraces_in_data(data):
         for frame in info.stacktrace['frames']:
             platform = frame.get('platform') or data['platform']
-            if platform != 'javascript' or platform.get('module'):
+            if platform != 'javascript' or frame.get('module'):
                 continue
             abs_path = frame.get('abs_path')
             if abs_path and abs_path.startswith(('http:', 'https:', 'webpack:')):
diff --git a/tests/sentry/lang/javascript/test_processor.py b/tests/sentry/lang/javascript/test_processor.py
index 1e6c5033c6..400b3741bf 100644
--- a/tests/sentry/lang/javascript/test_processor.py
+++ b/tests/sentry/lang/javascript/test_processor.py
@@ -304,7 +304,7 @@ class TrimLineTest(TestCase):
 
 
 def test_get_culprit_is_patched():
-    from sentry.lang.javascript.plugin import fix_culprit
+    from sentry.lang.javascript.plugin import fix_culprit, generate_modules
 
     data = {
         'message': 'hello',
@@ -333,6 +333,7 @@ def test_get_culprit_is_patched():
             }],
         }
     }
+    generate_modules(data)
     fix_culprit(data)
     assert data['culprit'] == 'bar in oops'
 
