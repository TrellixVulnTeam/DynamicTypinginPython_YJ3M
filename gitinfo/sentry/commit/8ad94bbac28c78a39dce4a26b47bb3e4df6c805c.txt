commit 8ad94bbac28c78a39dce4a26b47bb3e4df6c805c
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Nov 29 12:56:06 2014 -0800

    Some initial work on access group migration wizard

diff --git a/src/sentry/templates/sentry/access-group-migration.html b/src/sentry/templates/sentry/access-group-migration.html
new file mode 100644
index 0000000000..99a26cac6a
--- /dev/null
+++ b/src/sentry/templates/sentry/access-group-migration.html
@@ -0,0 +1,25 @@
+{% extends "sentry/bases/organization.html" %}
+
+{% load i18n %}
+
+{% block title %}{% trans "Access Group Migration" %} | {{ block.super }}{% endblock %}
+
+{% block inner %}
+    <div class="page-header">
+        <h2>{% trans "Access Group Migration" %}</h2>
+    </div>
+
+    {% if member_list %}
+        <p>Below is a list of all members who are part of an access group within this organization. You'll need to select which team(s) they should gain access to. Alternatively you can choose to remove the user if they no longer need access.</p>
+
+        <p>Note: Unlike access groups, organization membership cannot be restricted per-project. If you need to refine access to that level you should create additional teams and move to the projects where applicable.</p>
+
+        <ul>
+            {% for member, project_list in member_list %}
+                <li>{{ member.get_display_name }}</li>
+            {% endfor %}
+        </ul>
+    {% else %}
+        <p>Your work is done here! There are no access groups which need migrated.</p>
+    {% endif %}
+{% endblock %}
diff --git a/src/sentry/web/frontend/access_group_migration.py b/src/sentry/web/frontend/access_group_migration.py
new file mode 100644
index 0000000000..a8f5ed8d6b
--- /dev/null
+++ b/src/sentry/web/frontend/access_group_migration.py
@@ -0,0 +1,44 @@
+from __future__ import absolute_import
+
+from collections import defaultdict
+
+from sentry.models import AccessGroup, OrganizationMemberType
+from sentry.web.frontend.base import OrganizationView
+
+
+class AccessGroupMigrationView(OrganizationView):
+    required_access = OrganizationMemberType.ADMIN
+
+    def get(self, request, organization):
+        member_list = list(AccessGroup.members.through.objects.filter(
+            accessgroup__team__organization=organization,
+        ).select_related('user', 'accessgroup', 'accessgroup__team'))
+
+        group_list = set(m.accessgroup for m in member_list)
+
+        project_list = list(AccessGroup.projects.through.objects.filter(
+            accessgroup__in=group_list,
+        ).select_related('project'))
+
+        # sort projects by group
+        projects_by_group = defaultdict(list)
+        for obj in project_list:
+            projects_by_group[obj.accessgroup_id].append(obj.project)
+
+        projects_by_user = defaultdict(list)
+        for member in member_list:
+            projects_by_user[member.user_id].extend(projects_by_group[member.accessgroup_id])
+
+        results = []
+        for member in member_list:
+            results.append((
+                member.user,
+                projects_by_user[member.user_id],
+            ))
+
+        context = {
+            'member_list': results,
+            'group_list': group_list,
+        }
+
+        return self.respond('sentry/access-group-migration.html', context)
diff --git a/src/sentry/web/urls.py b/src/sentry/web/urls.py
index 1c2f35cbf2..d71775b737 100644
--- a/src/sentry/web/urls.py
+++ b/src/sentry/web/urls.py
@@ -33,6 +33,7 @@ import sentry.web.frontend.projects.tags
 __all__ = ('urlpatterns',)
 
 from sentry.web.frontend.accept_organization_invite import AcceptOrganizationInviteView
+from sentry.web.frontend.access_group_migration import AccessGroupMigrationView
 from sentry.web.frontend.home import HomeView
 from sentry.web.frontend.organization_home import OrganizationHomeView
 from sentry.web.frontend.organization_members import OrganizationMembersView
@@ -120,6 +121,8 @@ urlpatterns += patterns('',
     # Organizations
     url(r'^organizations/new/$', CreateOrganizationView.as_view(),
         name='sentry-create-organization'),
+    url(r'^organizations/(?P<organization_id>\d+)/access-groups/$', AccessGroupMigrationView.as_view(),
+        name='sentry-organization-access-group-migration'),
     url(r'^organizations/(?P<organization_id>\d+)/$', OrganizationHomeView.as_view(),
         name='sentry-organization-home'),
     url(r'^organizations/(?P<organization_id>\d+)/members/$', OrganizationMembersView.as_view(),
