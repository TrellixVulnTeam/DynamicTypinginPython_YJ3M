commit e3ffe3d028082825ffb7597e207886b42f7d4c45
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Aug 13 18:26:59 2015 -0700

    Correct default filename and no abs_path handling

diff --git a/src/sentry/interfaces/stacktrace.py b/src/sentry/interfaces/stacktrace.py
index ae15b055f9..2148627982 100644
--- a/src/sentry/interfaces/stacktrace.py
+++ b/src/sentry/interfaces/stacktrace.py
@@ -139,16 +139,21 @@ class Frame(Interface):
         abs_path = data.get('abs_path')
         filename = data.get('filename')
 
+        # absolute path takes priority over filename
+        # (in the end both will get set)
         if not abs_path:
             abs_path = filename
+            filename = None
 
-        if not filename:
-            if abs_path and is_url(abs_path):
+        if not filename and abs_path:
+            if is_url(abs_path):
                 urlparts = urlparse(abs_path)
                 if urlparts.path:
                     filename = urlparts.path
-        else:
-            filename = abs_path
+                else:
+                    filename = abs_path
+            else:
+                filename = abs_path
 
         assert filename or data.get('function') or data.get('module')
 
diff --git a/tests/sentry/interfaces/test_stacktrace.py b/tests/sentry/interfaces/test_stacktrace.py
index 0f84456096..91d821d842 100644
--- a/tests/sentry/interfaces/test_stacktrace.py
+++ b/tests/sentry/interfaces/test_stacktrace.py
@@ -71,14 +71,14 @@ class StacktraceTest(TestCase):
         assert frame.filename == '/foo.js'
         assert frame.abs_path == 'http://foo.com/foo.js'
 
-    def test_coerces_url_abs_paths(self):
+    def test_does_not_overwrite_filename(self):
         interface = Stacktrace.to_python(dict(frames=[{
             'lineno': 1,
             'filename': 'foo.js',
             'abs_path': 'http://foo.com/foo.js',
         }]))
         frame = interface.frames[0]
-        assert frame.filename == '/foo.js'
+        assert frame.filename == 'foo.js'
         assert frame.abs_path == 'http://foo.com/foo.js'
 
     def test_ignores_results_with_empty_path(self):
