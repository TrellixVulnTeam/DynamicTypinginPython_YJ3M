commit 071a06cedf607c337e616dbba6c0623649edbb10
Author: Matt Robenolt <matt@ydekproductions.com>
Date:   Fri Aug 19 15:29:09 2016 -0700

    Let DRF actually handle an auth failure without erroring (#3985)
    
    Fixes SENTRY-HP
    Fixes GH-3722

diff --git a/src/sentry/api/base.py b/src/sentry/api/base.py
index 2afe07630a..cb476f3485 100644
--- a/src/sentry/api/base.py
+++ b/src/sentry/api/base.py
@@ -137,14 +137,15 @@ class Endpoint(APIView):
             time.sleep(settings.SENTRY_API_RESPONSE_DELAY / 1000.0)
 
         origin = request.META.get('HTTP_ORIGIN')
-        if origin and request.auth:
-            allowed_origins = request.auth.get_allowed_origins()
-            if not is_valid_origin(origin, allowed=allowed_origins):
-                response = Response('Invalid origin: %s' % (origin,), status=400)
-                self.response = self.finalize_response(request, response, *args, **kwargs)
-                return self.response
 
         try:
+            if origin and request.auth:
+                allowed_origins = request.auth.get_allowed_origins()
+                if not is_valid_origin(origin, allowed=allowed_origins):
+                    response = Response('Invalid origin: %s' % (origin,), status=400)
+                    self.response = self.finalize_response(request, response, *args, **kwargs)
+                    return self.response
+
             self.initial(request, *args, **kwargs)
 
             # Get the appropriate handler method
