commit 745307e65042cbb6a47b4d0192748f9ddc3616b2
Author: David Cramer <dcramer@gmail.com>
Date:   Sat Jan 18 23:24:49 2014 -0800

    Remove use of periodic_task in favor of CELERYBEAT_SCHEDULE

diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index ad683c3623..b868e5dd0d 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -17,6 +17,8 @@ import socket
 import sys
 import urlparse
 
+from datetime import timedelta
+
 DEBUG = False
 TEMPLATE_DEBUG = True
 
@@ -279,6 +281,16 @@ CELERY_QUEUES = (
     Queue('update', routing_key='update'),
     Queue('email', routing_key='email'),
 )
+CELERYBEAT_SCHEDULE = {
+    'check-alerts': {
+        'task': 'sentry.tasks.check_alerts',
+        'schedule': timedelta(minutes=1),
+    },
+    'check-version': {
+        'task': 'sentry.tasks.check_update',
+        'schedule': timedelta(hours=1),
+    }
+}
 
 # Disable South in tests as it is sending incorrect create signals
 SOUTH_TESTS_MIGRATE = True
diff --git a/src/sentry/tasks/check_alerts.py b/src/sentry/tasks/check_alerts.py
index 2af021484b..19511c8cbd 100644
--- a/src/sentry/tasks/check_alerts.py
+++ b/src/sentry/tasks/check_alerts.py
@@ -8,8 +8,7 @@ sentry.tasks.check_alerts
 from __future__ import division
 
 from datetime import timedelta
-from celery.task import periodic_task, task
-from celery.task.schedules import crontab
+from celery.task import task
 from django.utils import timezone
 from sentry.constants import MINUTE_NORMALIZATION
 from sentry.utils import math
@@ -22,9 +21,7 @@ def fsteps(start, stop, steps):
         start += step
 
 
-@periodic_task(
-    name='sentry.tasks.check_alerts',
-    run_every=crontab(minute='*'), queue='alerts')
+@task(name='sentry.tasks.check_alerts', queue='alerts')
 def check_alerts(**kwargs):
     """
     Iterates all current keys and fires additional tasks to check each individual
diff --git a/src/sentry/tasks/check_update.py b/src/sentry/tasks/check_update.py
index 074dbebe10..e4dddbb95f 100644
--- a/src/sentry/tasks/check_update.py
+++ b/src/sentry/tasks/check_update.py
@@ -8,24 +8,17 @@ sentry.tasks.check_version
 import json
 import logging
 
-from celery.task import periodic_task
-from celery.task.schedules import crontab
+from celery.task import task
 from simplejson import JSONDecodeError
 
 from sentry.tasks.fetch_source import fetch_url_content, BAD_SOURCE
 
 PYPI_URL = 'https://pypi.python.org/pypi/sentry/json'
-SENTRY_CHECKUPDATE_TIME = {
-    'hour': 0,
-    'minute': 0
-}
 
 logger = logging.getLogger(__name__)
 
 
-@periodic_task(
-    name='sentry.tasks.check_update',
-    run_every=crontab(**SENTRY_CHECKUPDATE_TIME), queue='update')
+@task(name='sentry.tasks.check_update', queue='update')
 def check_update():
     """
     Daily retrieving latest available Sentry version from PyPI
