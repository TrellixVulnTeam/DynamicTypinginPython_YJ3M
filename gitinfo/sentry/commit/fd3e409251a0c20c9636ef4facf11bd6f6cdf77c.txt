commit fd3e409251a0c20c9636ef4facf11bd6f6cdf77c
Author: Lyn Nagara <lyn.nagara@gmail.com>
Date:   Tue Dec 11 10:37:07 2018 -0800

    feat(onboarding): Remove release commits broadcast modal (#10938)
    
    This is no longer a new feature, nor does it make sense to display as the first thing a new user sees in Sentry

diff --git a/src/sentry/api/endpoints/user_details.py b/src/sentry/api/endpoints/user_details.py
index a08f769a65..8c2b079fef 100644
--- a/src/sentry/api/endpoints/user_details.py
+++ b/src/sentry/api/endpoints/user_details.py
@@ -50,7 +50,6 @@ class UserOptionsSerializer(serializers.Serializer):
     ), required=False)
     timezone = serializers.ChoiceField(choices=TIMEZONE_CHOICES, required=False)
     clock24Hours = serializers.BooleanField(required=False)
-    seenReleaseBroadcast = serializers.BooleanField(required=False)
 
 
 class BaseUserSerializer(serializers.ModelSerializer):
@@ -150,7 +149,6 @@ class UserDetailsEndpoint(UserEndpoint):
             'timezone': 'timezone',
             'stacktraceOrder': 'stacktrace_order',
             'clock24Hours': 'clock_24_hours',
-            'seenReleaseBroadcast': 'seen_release_broadcast',
         }
 
         options_result = serializer_options.object
diff --git a/src/sentry/api/serializers/models/user.py b/src/sentry/api/serializers/models/user.py
index c937189c9b..1b270bddb9 100644
--- a/src/sentry/api/serializers/models/user.py
+++ b/src/sentry/api/serializers/models/user.py
@@ -92,7 +92,6 @@ class UserSerializer(Serializer):
                 'stacktraceOrder': stacktrace_order,
                 'timezone': options.get('timezone') or settings.SENTRY_DEFAULT_TIME_ZONE,
                 'clock24Hours': options.get('clock_24_hours') or False,
-                'seenReleaseBroadcast': options.get('seen_release_broadcast'),
             }
 
             d['flags'] = {
diff --git a/src/sentry/static/sentry/app/components/broadcastModal.jsx b/src/sentry/static/sentry/app/components/broadcastModal.jsx
deleted file mode 100644
index 78fb2d5c86..0000000000
--- a/src/sentry/static/sentry/app/components/broadcastModal.jsx
+++ /dev/null
@@ -1,162 +0,0 @@
-import PropTypes from 'prop-types';
-import React from 'react';
-import createReactClass from 'create-react-class';
-
-import InlineSvg from 'app/components/inlineSvg';
-import ConfigStore from 'app/stores/configStore';
-import ApiMixin from 'app/mixins/apiMixin';
-import {logAjaxError} from 'app/utils/logging';
-
-const ReleaseAnnouncement = ({close}) => {
-  const mediaUrl = ConfigStore.get('mediaUrl');
-  return (
-    <div>
-      <h3>
-        Releases are better with commits{' '}
-        <span className="badge badge-square highlight">NEW</span>
-      </h3>
-      <p>
-        <img src={mediaUrl + 'images/onboarding/release-commits-modal.gif'} />
-      </p>
-      <h5 style={{lineHeight: '1.2'}}>
-        By integrating commit data with Sentry, youâ€™ll unlock a number of helpful
-        features:
-      </h5>
-      <ul>
-        <li>
-          Enhanced releases overview page that allows you to see new and resolved issues,
-          files changed and authors all in the same place
-        </li>
-        <li>Resolving Sentry issues via commit messages</li>
-        <li>Suggested assignees for issues</li>
-        <li>Detailed summary emails when a deploy goes out</li>
-      </ul>
-      <p className="release-buttons">
-        <a className="btn btn-default btn-lg" href="#" onClick={close}>
-          Dismiss
-        </a>
-        <a
-          className="btn btn-primary btn-lg"
-          href="https://blog.sentry.io/2017/05/01/release-commits.html"
-          onClick={close}
-        >
-          Read the full post
-        </a>
-      </p>
-    </div>
-  );
-};
-
-ReleaseAnnouncement.propTypes = {
-  close: PropTypes.func.isRequired,
-};
-
-const BroadcastModal = createReactClass({
-  displayName: 'BroadcastModal',
-
-  propTypes: {
-    closeBroadcast: PropTypes.func.isRequired,
-  },
-
-  mixins: [ApiMixin],
-
-  getInitialState() {
-    return {
-      alerts: [ReleaseAnnouncement],
-      index: 0,
-    };
-  },
-
-  componentWillMount() {
-    document.addEventListener('keydown', this.handleKeyDown);
-  },
-
-  componentWillUnmount() {
-    document.removeEventListener('keydown', this.handleKeyDown);
-  },
-
-  close() {
-    //tell server to close
-    let user = ConfigStore.get('user');
-    let markedData = {
-      options: {
-        seenReleaseBroadcast: true,
-      },
-    };
-    this.api.request(`/users/${user.id}/`, {
-      method: 'PUT',
-      data: markedData,
-      success: (data, _, jqXHR) => {
-        ConfigStore.set('user', data);
-        this.props.closeBroadcast();
-      },
-      error: err => {
-        logAjaxError(err);
-        this.props.closeBroadcast();
-      },
-    });
-  },
-
-  handleKeyDown(evt) {
-    if (evt.key === 'Escape' || evt.keyCode === 27) {
-      this.close();
-    }
-  },
-
-  handleClick(evt) {
-    if (!evt.target.classList.contains('modal')) {
-      return;
-    }
-
-    this.close();
-  },
-
-  renderOneModal(message, i, a) {
-    let nth = 'abcd'[a.length - 1 - i] + '-nth';
-    return (
-      <div
-        className={'modal ' + nth}
-        style={{display: 'block'}}
-        key={i}
-        onClick={this.handleClick}
-      >
-        <div className="modal-dialog">
-          <div className="modal-content" role="document">
-            <div className="modal-body">
-              <div className="pull-right">
-                <span
-                  className="close-icon"
-                  onClick={() => {
-                    if (this.state.index + 1 >= this.state.alerts.length) {
-                      this.close();
-                    }
-                    this.setState({index: this.state.index + 1});
-                  }}
-                >
-                  <InlineSvg src="icon-close-lg" />
-                </span>
-              </div>
-              {message({close: this.close})}
-            </div>
-          </div>
-        </div>
-      </div>
-    );
-  },
-
-  render() {
-    let {alerts, index} = this.state;
-    let modals = alerts
-      .slice(index, index + 4)
-      .reverse()
-      .map(this.renderOneModal);
-    return (
-      <div className="modal-broadcast">
-        <div className="modal-backdrop in" />
-        <div className="modals">{modals}</div>
-      </div>
-    );
-  },
-});
-
-export default BroadcastModal;
diff --git a/src/sentry/static/sentry/app/views/organizationContext.jsx b/src/sentry/static/sentry/app/views/organizationContext.jsx
index 729da13500..8fc85d0198 100644
--- a/src/sentry/static/sentry/app/views/organizationContext.jsx
+++ b/src/sentry/static/sentry/app/views/organizationContext.jsx
@@ -3,7 +3,6 @@ import PropTypes from 'prop-types';
 import React from 'react';
 import Reflux from 'reflux';
 import createReactClass from 'create-react-class';
-import moment from 'moment';
 import styled from 'react-emotion';
 
 import {openSudo} from 'app/actionCreators/modal';
@@ -11,7 +10,6 @@ import {setActiveOrganization} from 'app/actionCreators/organizations';
 import {t} from 'app/locale';
 import Alert from 'app/components/alert';
 import ApiMixin from 'app/mixins/apiMixin';
-import BroadcastModal from 'app/components/broadcastModal';
 import ConfigStore from 'app/stores/configStore';
 import HookStore from 'app/stores/hookStore';
 import LoadingError from 'app/components/loadingError';
@@ -46,7 +44,6 @@ const OrganizationContext = createReactClass({
       error: false,
       errorType: null,
       organization: null,
-      showBroadcast: false,
     };
   },
 
@@ -104,7 +101,6 @@ const OrganizationContext = createReactClass({
           error: false,
           errorType: null,
           hooks,
-          showBroadcast: this.shouldShowBroadcast(data),
         });
       },
 
@@ -144,33 +140,6 @@ const OrganizationContext = createReactClass({
     return 'Sentry';
   },
 
-  shouldShowBroadcast(data) {
-    let user = ConfigStore.get('user');
-    let options = user ? user.options : {};
-    let seen = options.seenReleaseBroadcast;
-    let tasks = data.onboardingTasks;
-    // don't show broadcast they've seen it
-    if (seen) {
-      return false;
-    }
-
-    // also if they havn't sent their first event
-    let sentFirstEvent = tasks.find(
-      ({task, status}) => task == 2 && status == 'complete'
-    );
-
-    if (!sentFirstEvent) {
-      return false;
-    }
-
-    // show it if they sent their first event more than 2 days ago
-    return moment().diff(sentFirstEvent.dateCompleted, 'days') > 2;
-  },
-
-  closeBroadcast() {
-    this.setState({showBroadcast: false});
-  },
-
   renderSidebar() {
     if (!this.props.includeSidebar) return null;
 
@@ -215,11 +184,7 @@ const OrganizationContext = createReactClass({
       <DocumentTitle title={this.getTitle()}>
         <div className="app">
           {this.state.hooks}
-          {this.state.showBroadcast && (
-            <BroadcastModal closeBroadcast={this.closeBroadcast} />
-          )}
           {this.renderSidebar()}
-
           {this.props.children}
         </div>
       </DocumentTitle>
diff --git a/src/sentry/static/sentry/images/onboarding/release-commits-modal.gif b/src/sentry/static/sentry/images/onboarding/release-commits-modal.gif
deleted file mode 100644
index e16743dd9c..0000000000
Binary files a/src/sentry/static/sentry/images/onboarding/release-commits-modal.gif and /dev/null differ
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index d66076c012..4e87fc5da0 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -2146,16 +2146,6 @@ header + .alert {
   margin-left: 4px;
   .transition(0.1s background linear);
 
-  &.badge-square {
-    height: auto;
-    line-height: 1;
-    border-radius: 3px;
-    padding: 7px;
-    font-size: 12px;
-    vertical-align: bottom;
-    top: 0;
-  }
-
   &.new {
     background: @red;
   }
@@ -2406,59 +2396,6 @@ ul.radio-inputs {
   }
 }
 
-// Broadcast Modal
-
-.modal-broadcast {
-  .modal-dialog {
-    position: absolute;
-    right: 10px;
-    bottom: 10px;
-    .release-buttons {
-      display: flex;
-      justify-content: flex-end;
-      .btn {
-        margin-left: 10px;
-      }
-    }
-    .close-icon {
-      color: @50;
-      cursor: pointer;
-
-      &:hover {
-        color: @80;
-      }
-    }
-    .modal {
-      z-index: 2000;
-      .transition(transform 0.2s ease);
-
-      &.a-nth {
-        transform: scale(1, 1) translate(0, 0px);
-        z-index: 2000;
-        opacity: 1;
-      }
-
-      &.b-nth {
-        transform: scale(0.95, 0.95) translate(0, -50px);
-        z-index: 1999;
-        // opacity: .8;
-      }
-
-      &.c-nth {
-        transform: scale(0.9, 0.9) translate(0, -100px);
-        z-index: 1998;
-        // opacity: .6;
-      }
-
-      &.d-nth {
-        transform: scale(0.85, 0.85) translate(0, -150px);
-        z-index: 1997;
-        // opacity: .4;
-      }
-    }
-  }
-}
-
 /**
 * Well
 * ============================================================================
diff --git a/tests/sentry/api/endpoints/test_user_details.py b/tests/sentry/api/endpoints/test_user_details.py
index bed8dcd2ca..a556fb798b 100644
--- a/tests/sentry/api/endpoints/test_user_details.py
+++ b/tests/sentry/api/endpoints/test_user_details.py
@@ -84,7 +84,6 @@ class UserUpdateTest(APITestCase):
                     'language': 'fr',
                     'clock24Hours': True,
                     'extra': True,
-                    'seenReleaseBroadcast': True,
                 }
             }
         )
@@ -96,10 +95,6 @@ class UserUpdateTest(APITestCase):
         # note: email should not change, removed support for email changing from this endpoint
         assert user.email == 'a@example.com'
         assert user.username == 'a@example.com'
-        assert UserOption.objects.get_value(
-            user=user,
-            key='seen_release_broadcast',
-        ) is True
         assert UserOption.objects.get_value(user=self.user, key='timezone') == 'UTC'
         assert UserOption.objects.get_value(user=self.user, key='stacktrace_order') == '2'
         assert UserOption.objects.get_value(user=self.user, key='language') == 'fr'
