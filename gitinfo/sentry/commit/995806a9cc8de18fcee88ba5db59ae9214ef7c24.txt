commit 995806a9cc8de18fcee88ba5db59ae9214ef7c24
Author: Mark Story <mark@sentry.io>
Date:   Wed Jun 19 11:32:53 2019 -0400

    fix(jira) Fix jira users not having emails (#13729)
    
    Recent atlassian privacy changes mean we don't always get `emailAddress`
    field for user objects in jira. Sync tasks should silently fail when
    this happens instead of alerting us.
    
    Fixes SENTRY-AVP

diff --git a/src/sentry/integrations/jira/integration.py b/src/sentry/integrations/jira/integration.py
index a9ed29b348..32df26af7a 100644
--- a/src/sentry/integrations/jira/integration.py
+++ b/src/sentry/integrations/jira/integration.py
@@ -692,7 +692,8 @@ class JiraIntegration(IntegrationInstallation, IssueSyncMixin):
                     continue
                 try:
                     jira_user = [
-                        r for r in res if r['emailAddress'] and r['emailAddress'].lower() == ue.email.lower()
+                        r for r in res
+                        if r.get('emailAddress') and r['emailAddress'].lower() == ue.email.lower()
                     ][0]
                 except IndexError:
                     pass
diff --git a/tests/sentry/integrations/jira/test_integration.py b/tests/sentry/integrations/jira/test_integration.py
index 85d121b193..d200b054fa 100644
--- a/tests/sentry/integrations/jira/test_integration.py
+++ b/tests/sentry/integrations/jira/test_integration.py
@@ -827,6 +827,30 @@ class JiraIntegrationTest(APITestCase):
         assert assign_issue_response.status_code == 200
         assert assign_issue_response.request.body == '{"accountId": "deadbeef123"}'
 
+    @responses.activate
+    def test_sync_assignee_outbound_no_email(self):
+        self.user = self.create_user(email='bob@example.com')
+        issue_id = 'APP-123'
+        installation = self.integration.get_installation(self.organization.id)
+        external_issue = ExternalIssue.objects.create(
+            organization_id=self.organization.id,
+            integration_id=installation.model.id,
+            key=issue_id,
+        )
+        responses.add(
+            responses.GET,
+            'https://example.atlassian.net/rest/api/2/user/assignable/search',
+            json=[{
+                'accountId': 'deadbeef123',
+                'displayName': 'Dead Beef',
+            }],
+            match_querystring=False,
+        )
+        installation.sync_assignee_outbound(external_issue, self.user)
+
+        # No sync made as jira users don't have email addresses
+        assert len(responses.calls) == 1
+
     def test_update_organization_config(self):
         org = self.organization
         self.login_as(self.user)
