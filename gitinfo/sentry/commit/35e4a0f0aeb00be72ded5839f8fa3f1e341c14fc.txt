commit 35e4a0f0aeb00be72ded5839f8fa3f1e341c14fc
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 6 03:01:18 2012 -0800

    Configure plugins lazily

diff --git a/sentry/middleware.py b/sentry/middleware.py
index 6d85cf3671..652ea8a0b4 100644
--- a/sentry/middleware.py
+++ b/sentry/middleware.py
@@ -1,12 +1,11 @@
 from sentry.models import Project
-from sentry.plugins import Plugin
+from sentry.plugins import Plugin, PluginProxy
 
 
 def get_plugins(request, project):
     plugins = []
     for cls in Plugin.plugins.itervalues():
-        plugin = cls(request)
-        plugin.configure(project)
+        plugin = PluginProxy(cls(request), project)
         plugins.append(plugin)
     return plugins
 
diff --git a/sentry/plugins/__init__.py b/sentry/plugins/__init__.py
index 1f2fc798f9..71194d7d27 100644
--- a/sentry/plugins/__init__.py
+++ b/sentry/plugins/__init__.py
@@ -37,6 +37,28 @@ class PluginMount(type):
             cls.plugins[cls.slug] = cls
 
 
+class PluginProxy(object):
+    def __init__(self, plugin, project):
+        self.project = project
+        self.__configured = False
+        self.__plugin = plugin
+
+    def __getattr__(self, attr):
+        """
+        We hook getattr to enable lazy configuration.
+
+        This ensures that we don't bother configuring
+        a plugin unless it gets executed.
+        """
+        f = getattr(self.__plugin, attr)
+        if self.__configured:
+            return f
+        if callable(f):
+            self.__plugin.configure(self.project)
+            self.__configured = True
+        return f
+
+
 class Plugin(object):
     """
     All children should allow **kwargs on all inherited methods.
@@ -77,12 +99,14 @@ class Plugin(object):
     def render(self, template, context=None):
         return Response(template, context)
 
-    def configure(self, project):
-        pass
-
     def get_url(self, group):
         return reverse('sentry-group-plugin-action', args=(group.project_id, group.pk, self.slug))
 
+    def configure(self, project):
+        """
+        Called when plugin is initialized to perform any pre-configuration.
+        """
+
     def view(self, group, **kwargs):
         """
         Handles the view logic. If no response is given, we continue to the next action provider.
