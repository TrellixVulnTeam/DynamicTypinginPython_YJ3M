commit bad52d19a8020c9709bc7d899bca300077e4e8a6
Author: Armin Ronacher <armin.ronacher@active-4.com>
Date:   Fri Sep 29 11:12:10 2017 +0200

    feat(u2f): Catch u2f errors in flow (#6219)
    
    * feat(u2f): Catch u2f errors in flow
    
    * ref(u2f): Fixed a linter error

diff --git a/src/sentry/static/sentry/app/components/u2finterface.jsx b/src/sentry/static/sentry/app/components/u2finterface.jsx
index 8e588f06ba..20ec89cdba 100644
--- a/src/sentry/static/sentry/app/components/u2finterface.jsx
+++ b/src/sentry/static/sentry/app/components/u2finterface.jsx
@@ -1,6 +1,7 @@
 import PropTypes from 'prop-types';
 import React from 'react';
 import u2f from 'u2f-api';
+import Raven from 'raven-js';
 import ConfigStore from '../stores/configStore';
 
 import {t, tct} from '../locale';
@@ -80,15 +81,23 @@ const U2fInterface = React.createClass({
       })
       .catch(err => {
         let failure = 'DEVICE_ERROR';
-        if (err.metaData.type === 'DEVICE_INELIGIBLE') {
-          if (this.props.flowMode === 'enroll') {
-            failure = 'DUPLICATE_DEVICE';
-          } else {
-            failure = 'UNKNOWN_DEVICE';
+        // in some rare cases there is no metadata on the error which
+        // causes this to blow up badly.
+        if (err.metaData) {
+          if (err.metaData.type === 'DEVICE_INELIGIBLE') {
+            if (this.props.flowMode === 'enroll') {
+              failure = 'DUPLICATE_DEVICE';
+            } else {
+              failure = 'UNKNOWN_DEVICE';
+            }
+          } else if (err.metaData.type === 'BAD_REQUEST') {
+            failure = 'BAD_APPID';
           }
-        } else if (err.metaData.type === 'BAD_REQUEST') {
-          failure = 'BAD_APPID';
         }
+        // we want to know what is happening here.  There are some indicators
+        // that users are getting errors that should not happen through the
+        // regular u2f flow.
+        Raven.captureException(err);
         this.setState({
           deviceFailure: failure,
           hasBeenTapped: false
