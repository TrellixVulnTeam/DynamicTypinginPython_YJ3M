commit 7fb2fe540fd9cacf38d5c6d9aebc14448ea09513
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Feb 22 19:27:30 2013 -0800

    Move can_add_member into template filter

diff --git a/src/sentry/templates/sentry/teams/members/index.html b/src/sentry/templates/sentry/teams/members/index.html
index ed32224ac0..b8dd6ba878 100644
--- a/src/sentry/templates/sentry/teams/members/index.html
+++ b/src/sentry/templates/sentry/teams/members/index.html
@@ -2,6 +2,7 @@
 
 {% load i18n %}
 {% load sentry_helpers %}
+{% load sentry_permissions %}
 
 {% block breadcrumb %}
     {{ block.super }}
@@ -19,7 +20,7 @@
 
 {% block inner %}
     <div class="page-header">
-        {% if can_add_member %}
+        {% if user|can_add_team_member:team %}
             <a href="{% url sentry-new-team-member team.slug %}" class="btn pull-right btn-primary">{% trans "New Member" %}</a>
         {% endif %}
         <h2>{% trans "Members" %}</h2>
diff --git a/src/sentry/templatetags/sentry_permissions.py b/src/sentry/templatetags/sentry_permissions.py
new file mode 100644
index 0000000000..0400360625
--- /dev/null
+++ b/src/sentry/templatetags/sentry_permissions.py
@@ -0,0 +1,21 @@
+"""
+sentry.templatetags.sentry_permissions
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+:copyright: (c) 2010-2012 by the Sentry Team, see AUTHORS for more details.
+:license: BSD, see LICENSE for more details.
+"""
+
+from django import template
+
+register = template.Library()
+
+# TODO: Django doesn't seem to introspect function args correctly for filters
+# so we can't just register.filter(can_add_team_member)
+
+
+@register.filter
+def can_add_team_member(user, team):
+    from sentry.permissions import can_add_team_member
+
+    return can_add_team_member(user, team)
diff --git a/src/sentry/web/frontend/teams.py b/src/sentry/web/frontend/teams.py
index e26fb21341..8295fddaf2 100644
--- a/src/sentry/web/frontend/teams.py
+++ b/src/sentry/web/frontend/teams.py
@@ -173,7 +173,6 @@ def manage_team_members(request, team):
 
     context = csrf(request)
     context.update({
-        'can_add_member': can_add_team_member(request.user, team),
         'page': 'members',
         'member_list': member_list,
         'pending_member_list': pending_member_list,
@@ -186,8 +185,7 @@ def manage_team_members(request, team):
 @csrf_protect
 @has_access(MEMBER_OWNER)
 def new_team_member(request, team):
-    can_add_member = can_add_team_member(request.user, team)
-    if not can_add_member:
+    if not can_add_team_member(request.user, team):
         return HttpResponseRedirect(reverse('sentry'))
 
     initial = {
