commit 0d0b7745a44b8ae2dea379af6df58f0ac30202dd
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Mar 5 20:58:02 2015 -0800

    Handle duplicate file

diff --git a/src/sentry/api/endpoints/release_files.py b/src/sentry/api/endpoints/release_files.py
index dfee6695d3..4361f146e7 100644
--- a/src/sentry/api/endpoints/release_files.py
+++ b/src/sentry/api/endpoints/release_files.py
@@ -1,5 +1,6 @@
 from __future__ import absolute_import
 
+from django.db import IntegrityError, transaction
 from rest_framework.negotiation import DefaultContentNegotiation
 from rest_framework.parsers import FormParser, MultiPartParser
 from rest_framework.response import Response
@@ -90,11 +91,16 @@ class ReleaseFilesEndpoint(ProjectEndpoint):
         )
         file.putfile(fileobj)
 
-        releasefile = ReleaseFile.objects.create(
-            project=release.project,
-            release=release,
-            file=file,
-            name=full_name,
-        )
+        try:
+            with transaction.atomic():
+                releasefile = ReleaseFile.objects.create(
+                    project=release.project,
+                    release=release,
+                    file=file,
+                    name=full_name,
+                )
+        except IntegrityError:
+            file.delete()
+            return Response(status=409)
 
         return Response(serialize(releasefile, request.user), status=201)
