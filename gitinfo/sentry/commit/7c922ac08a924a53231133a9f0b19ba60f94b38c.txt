commit 7c922ac08a924a53231133a9f0b19ba60f94b38c
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Aug 7 08:09:42 2018 -0700

    Add tests for Django migrations

diff --git a/.travis.yml b/.travis.yml
index 74b226fb9a..215dba6769 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -31,11 +31,11 @@ env:
     - SENTRY_LIGHT_BUILD=1
     - SENTRY_SKIP_BACKEND_VALIDATION=1
     - SOUTH_TESTS_MIGRATE=1
+    - USE_SOUTH_MIGRATIONS=1
     - DJANGO_VERSION=">=1.6.11,<1.7"
     # node's version is pinned by .nvmrc and is autodetected by `nvm install`.
     - NODE_DIR="${HOME}/.nvm/versions/node/v$(< .nvmrc)"
     - YARN_VERSION="1.3.2"
-
 script:
   - make travis-lint-$TEST_SUITE
   - make travis-test-$TEST_SUITE
@@ -152,7 +152,7 @@ matrix:
       before_script:
         - psql -c 'create database sentry;' -U postgres
 
-    # django 1.8 in testing - allowed to fail
+    # django 1.8 compatibility
     - python: 2.7
       env: TEST_SUITE=postgres DJANGO_VERSION=">=1.8,<1.9"
       services:
@@ -164,6 +164,18 @@ matrix:
       before_script:
         - psql -c 'create database sentry;' -U postgres
 
+    # django 1.8 compatibility with migrations
+    - python: 2.7
+      env: TEST_SUITE=postgres DJANGO_VERSION=">=1.8,<1.9" USE_SOUTH_MIGRATIONS=0
+      services:
+        - memcached
+        - redis-server
+        - postgresql
+      install:
+        - pip install -e ".[dev,tests,optional]"
+      before_script:
+        - psql -c 'create database sentry;' -U postgres
+
     # snuba in testing - allowed to fail
     - python: 2.7
       env: TEST_SUITE=snuba SENTRY_TAGSTORE=sentry.tagstore.snuba.SnubaTagStorage
diff --git a/src/sentry/conf/server.py b/src/sentry/conf/server.py
index 1ea1a01a59..df97727913 100644
--- a/src/sentry/conf/server.py
+++ b/src/sentry/conf/server.py
@@ -269,7 +269,7 @@ INSTALLED_APPS = (
 )
 
 import django
-if django.VERSION < (1, 9):
+if django.VERSION < (1, 9) and os.environ.get('USE_SOUTH_MIGRATIONS', '1') == '1':
     INSTALLED_APPS += ('south', )
 
 STATIC_ROOT = os.path.realpath(os.path.join(PROJECT_ROOT, 'static'))
