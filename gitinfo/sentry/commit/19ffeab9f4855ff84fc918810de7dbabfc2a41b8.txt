commit 19ffeab9f4855ff84fc918810de7dbabfc2a41b8
Author: Alex Hofsteede <alex@hofsteede.com>
Date:   Sat Dec 2 11:13:19 2017 +1300

    fix: Don't try and truncate Nones (#6669)
    
    fixes SENTRY-3Q0

diff --git a/src/sentry/utils/strings.py b/src/sentry/utils/strings.py
index b76c065f99..494cc59ead 100644
--- a/src/sentry/utils/strings.py
+++ b/src/sentry/utils/strings.py
@@ -38,6 +38,8 @@ def truncatechars(value, arg, ellipsis='...'):
 
     Argument: Number of chars to truncate after.
     """
+    if value is None:
+        return value
     try:
         length = int(arg)
     except ValueError:  # Invalid literal for int().
diff --git a/tests/sentry/utils/test_strings.py b/tests/sentry/utils/test_strings.py
index 4cfde06c80..9953f43d33 100644
--- a/tests/sentry/utils/test_strings.py
+++ b/tests/sentry/utils/test_strings.py
@@ -115,3 +115,5 @@ def test_truncatechars():
     assert truncatechars("12345", 2, ellipsis=u"\u2026") == u"1\u2026"
     assert truncatechars("12345", 1, ellipsis=u"\u2026") == u"\u2026"
     assert truncatechars("12345", 0, ellipsis=u"\u2026") == u"\u2026"
+
+    assert truncatechars(None, 1) is None
