commit 48149d0ee30957f63ea722369dd0c1967bdaf6a2
Author: David Cramer <dcramer@gmail.com>
Date:   Thu Apr 30 00:32:32 2015 -0700

    Various enhancements to charts

diff --git a/src/sentry/static/sentry/app/components/barChart.jsx b/src/sentry/static/sentry/app/components/barChart.jsx
index 7ea2536462..5e177a09f7 100644
--- a/src/sentry/static/sentry/app/components/barChart.jsx
+++ b/src/sentry/static/sentry/app/components/barChart.jsx
@@ -1,7 +1,8 @@
 /*** @jsx React.DOM */
+var moment = require("moment");
 var React = require("react");
 
-var TooltipTrigger = require("./tooltipTrigger");
+var TooltipTrigger = require("./TooltipTrigger");
 
 var BarChart = React.createClass({
   propTypes: {
@@ -11,12 +12,15 @@ var BarChart = React.createClass({
       label: React.PropTypes.string
     })),
     interval: React.PropTypes.string,
-    placement: React.PropTypes.string
+    placement: React.PropTypes.string,
+    label: React.PropTypes.string
   },
 
   getDefaultProps(){
     return {
-      placement: "bottom"
+      placement: "bottom",
+      points: [],
+      label: "events"
     };
   },
 
@@ -37,6 +41,17 @@ var BarChart = React.createClass({
     );
   },
 
+  timeLabelAsDay(point) {
+    var timeMoment = moment(point.x * 1000);
+    var nextMoment = timeMoment.clone().add(59, "minute");
+
+    return (
+      <span>
+        {timeMoment.format("LL")}
+      </span>
+    );
+  },
+
   timeLabelAsRange(interval, point) {
     var timeMoment = moment(point.x * 1000);
     var nextMoment = timeMoment.clone().add(interval - 1, "second");
@@ -55,9 +70,7 @@ var BarChart = React.createClass({
   },
 
   render(){
-    // TODO: maxval could default to # of hours since first_seen / times_seen
     var points = this.props.points;
-
     var maxval = 10;
     points.forEach(function(point){
       if (point.y > maxval) {
@@ -73,6 +86,9 @@ var BarChart = React.createClass({
       case 3600:
         timeLabelFunc = this.timeLabelAsHour;
         break;
+      case 86400:
+        timeLabelFunc = this.timeLabelAsDay;
+        break;
       case null:
         timeLabelFunc = this.timeLabelAsFull;
         break;
@@ -85,8 +101,8 @@ var BarChart = React.createClass({
       var timeLabel = timeLabelFunc(point);
 
       var title = (
-        <div style={{minWidth: 200}}>
-          {point.y} events<br/>
+        <div style={{minWidth: 100}}>
+          {point.y} {this.props.label}<br/>
           {timeLabel}
         </div>
       );
@@ -107,7 +123,11 @@ var BarChart = React.createClass({
     });
 
     return (
-      <figure className={this.props.className}>
+      <figure className={this.props.className || '' + ' barchart'}
+              height={this.props.height}
+              width={this.props.width}>
+        <span className="max-y" key="max-y">{maxval}</span>
+        <span className="min-y" key="min-y">{0}</span>
         {children}
       </figure>
     );
diff --git a/src/sentry/static/sentry/app/views/groupDetails.jsx b/src/sentry/static/sentry/app/views/groupDetails.jsx
index 4221bd4ba8..6bdb863507 100644
--- a/src/sentry/static/sentry/app/views/groupDetails.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails.jsx
@@ -40,8 +40,7 @@ var GroupDetails = React.createClass({
 
   getInitialState() {
     return {
-      group: null,
-      statsPeriod: '30d'
+      group: null
     };
   },
 
@@ -87,12 +86,10 @@ var GroupDetails = React.createClass({
             orgId={params.orgId}
             projectId={params.projectId}
             group={group}
-            statsPeriod={this.state.statsPeriod}
             memberList={this.props.memberList} />
         <Router.RouteHandler
             memberList={this.props.memberList}
-            group={group}
-            statsPeriod={this.state.statsPeriod} />
+            group={group} />
       </div>
     );
   }
diff --git a/src/sentry/static/sentry/app/views/groupDetails/chart.jsx b/src/sentry/static/sentry/app/views/groupDetails/chart.jsx
index 9879b0d8ad..3e14df044e 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/chart.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/chart.jsx
@@ -10,18 +10,20 @@ var GroupChart = React.createClass({
 
   propTypes: {
     group: PropTypes.Group.isRequired,
+    statsPeriod: React.PropTypes.string.isRequired
   },
 
   render: function() {
     var group = this.props.group;
-    var stats = group.stats['24h'];
+    var stats = group.stats[this.props.statsPeriod];
     var points = stats.map((point) => {
       return {x: point[0], y: point[1]};
     });
+    var className = "bar-chart group-chart " + (this.props.className || '');
 
     return (
-      <div className="bar-chart group-chart">
-        <h6>Last 24 Hours</h6>
+      <div className={className}>
+        <h6>{this.props.title}</h6>
         <BarChart points={points} className="sparkline" />
       </div>
     );
diff --git a/src/sentry/static/sentry/app/views/groupDetails/header.jsx b/src/sentry/static/sentry/app/views/groupDetails/header.jsx
index 3cb8407d90..0c6c22961f 100644
--- a/src/sentry/static/sentry/app/views/groupDetails/header.jsx
+++ b/src/sentry/static/sentry/app/views/groupDetails/header.jsx
@@ -19,8 +19,7 @@ var GroupHeader = React.createClass({
 
   propTypes: {
     group: PropTypes.Group.isRequired,
-    memberList: React.PropTypes.instanceOf(Array).isRequired,
-    statsPeriod: React.PropTypes.string.isRequired
+    memberList: React.PropTypes.instanceOf(Array).isRequired
   },
 
   componentWillMount() {
@@ -39,10 +38,6 @@ var GroupHeader = React.createClass({
     var group = this.props.group,
         userCount = 0;
 
-    var chartData = group.stats[this.props.statsPeriod].map(function(point){
-      return {x: point[0], y: point[1]};
-    });
-
     if (group.tags["sentry:user"] !== undefined) {
       userCount = group.tags["sentry:user"].count;
     }
diff --git a/src/sentry/static/sentry/app/views/groupOverview.jsx b/src/sentry/static/sentry/app/views/groupOverview.jsx
index 451bd649cf..5ccd03d85d 100644
--- a/src/sentry/static/sentry/app/views/groupOverview.jsx
+++ b/src/sentry/static/sentry/app/views/groupOverview.jsx
@@ -130,8 +130,12 @@ var GroupOverview = React.createClass({
             )}
           </div>
           <div className="col-md-3">
-            <GroupChart statsPeriod={this.props.statsPeriod} group={group} />
             <div className="group-stats">
+              <GroupChart statsPeriod="24h" group={group}
+                          title="Last 24 Hours" />
+              <GroupChart statsPeriod="30d" group={group}
+                          title="Last 30 Days"
+                          className="bar-chart-small" />
               <h6>First seen</h6>
               <h3><TimeSince date={group.firstSeen} /></h3>
 
diff --git a/src/sentry/static/sentry/app/views/stream/actions.jsx b/src/sentry/static/sentry/app/views/stream/actions.jsx
index 17a4ea2e63..2228b2a146 100644
--- a/src/sentry/static/sentry/app/views/stream/actions.jsx
+++ b/src/sentry/static/sentry/app/views/stream/actions.jsx
@@ -457,8 +457,8 @@ var StreamActions = React.createClass({
             <li className={this.props.statsPeriod === '24h' ? 'active' : ''}>
               <a onClick={this.selectStatsPeriod.bind(this, '24h')}>24h</a>
             </li>
-            <li className={this.props.statsPeriod === '30d' ? 'active' : ''}>
-              <a onClick={this.selectStatsPeriod.bind(this, '30d')}>30d</a>
+            <li className={this.props.statsPeriod === '14d' ? 'active' : ''}>
+              <a onClick={this.selectStatsPeriod.bind(this, '14d')}>14d</a>
             </li>
           </ul>
         </div>
diff --git a/src/sentry/static/sentry/less/group-detail.less b/src/sentry/static/sentry/less/group-detail.less
index fa0aa6e0f6..e1be6c0846 100644
--- a/src/sentry/static/sentry/less/group-detail.less
+++ b/src/sentry/static/sentry/less/group-detail.less
@@ -163,10 +163,15 @@
 
 .group-overview {
   .bar-chart {
-    figure > a {
+    figure a {
       height: 70px;
     }
   }
+  .bar-chart-small {
+    figure a {
+      height: 40px;
+    }
+  }
 }
 
 /**
diff --git a/src/sentry/static/sentry/less/shared-components.less b/src/sentry/static/sentry/less/shared-components.less
index c221d2b620..bc335de956 100644
--- a/src/sentry/static/sentry/less/shared-components.less
+++ b/src/sentry/static/sentry/less/shared-components.less
@@ -842,46 +842,39 @@ table.integrations {
 
   figure {
     margin-bottom: 20px;
+    position: relative;
     .clearfix();
+    border-top: 1px solid #F0F1F4;
+
+    > .max-y,
+    > .min-y {
+      position: absolute;
+      width: 40px;
+      right: 2px;
+      text-align: right;
+      color: darken(@blue, 4);
+      font-size: 10px;
+    }
+
+    > .max-y {
+      top: 0;
+    }
+    > .min-y {
+      bottom: 0;
+    }
 
     a {
       height: 90px;
       position: relative;
 
-      &:before {
-        content: "";
-        background: #F0F1F4;
-        display: block;
-        border-radius: 1px;
-        position: absolute;
-        top: 0;
-        left: 0;
-        bottom: 0;
-        min-width: 5px;
-      }
-
       span {
+        display: block;
         border-radius: 1px;
-        min-height: 4px;
-        min-width: 5px;
+        min-height: 2px;
         background: darken(@blue, 4);
       }
     }
   }
-
-  &.team-chart {
-    figure a {
-      &:before {
-        min-width: 1px;
-        width: 3px;
-      }
-
-      span {
-        min-width: 3px;
-        max-width: 3px;
-      }
-    }
-  }
 }
 
 .tag-bar {
@@ -925,8 +918,8 @@ table.integrations {
 
     &:hover {
       > span {
-        background: @blue;
-        border-color: @blue;
+        background: lighten(@blue, 10%);
+        border-color: lighten(@blue, 10%);
       }
     }
 
@@ -943,7 +936,6 @@ table.integrations {
       text-indent: -9999px;
       text-align: left;
       min-height: 2px;
-      max-width: 3px;
       border-radius: 1px;
     }
   }
