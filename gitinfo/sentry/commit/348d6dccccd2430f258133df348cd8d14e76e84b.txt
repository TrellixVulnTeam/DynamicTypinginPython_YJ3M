commit 348d6dccccd2430f258133df348cd8d14e76e84b
Author: Dan Fuller <dfuller@sentry.io>
Date:   Tue Apr 21 16:21:23 2020 -0700

    fix(mail): Fix metrics associated with mail plugin activity sending (#18391)
    
    These metrics should only fire if we end up actually calling the `MailAdapter`. Just update them so
    that we can confirm activity is entirely going through `MailAdapter` and `MailPlugin` is unused.

diff --git a/src/sentry/plugins/sentry_mail/models.py b/src/sentry/plugins/sentry_mail/models.py
index d2de8d871a..2e4835de96 100644
--- a/src/sentry/plugins/sentry_mail/models.py
+++ b/src/sentry/plugins/sentry_mail/models.py
@@ -55,17 +55,17 @@ class MailPlugin(NotificationPlugin):
         )
 
     def notify_about_activity(self, activity):
-        metrics.incr("mail_plugin.notify_about_activity")
         if activity.project.flags.has_issue_alerts_targeting:
             return
+        metrics.incr("mail_plugin.notify_about_activity")
 
         return self.mail_adapter.notify_about_activity(activity)
 
     def handle_signal(self, name, payload, **kwargs):
-        metrics.incr("mail_plugin.handle_signal")
         if name == "user-reports.created":
             project = kwargs.get("project")
             if project and not project.flags.has_issue_alerts_targeting:
+                metrics.incr("mail_plugin.handle_signal")
                 self.mail_adapter.handle_signal(name, payload, **kwargs)
 
     def can_configure_for_project(self, project):
