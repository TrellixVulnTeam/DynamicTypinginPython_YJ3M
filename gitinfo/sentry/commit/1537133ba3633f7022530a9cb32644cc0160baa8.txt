commit 1537133ba3633f7022530a9cb32644cc0160baa8
Author: Ayesha Omarali <ayesha.omarali@gmail.com>
Date:   Wed Sep 19 18:03:10 2018 -0700

    Feat(Discover): Discover Update Chart Styles & Add Legends (#9731)

diff --git a/src/sentry/static/sentry/app/components/charts/baseChart.jsx b/src/sentry/static/sentry/app/components/charts/baseChart.jsx
index f86ca90398..e95c878065 100644
--- a/src/sentry/static/sentry/app/components/charts/baseChart.jsx
+++ b/src/sentry/static/sentry/app/components/charts/baseChart.jsx
@@ -13,6 +13,7 @@ import LineSeries from './series/lineSeries';
 import Tooltip from './components/tooltip';
 import YAxis from './components/yAxis';
 import XAxis from './components/xAxis';
+import Legend from './components/legend';
 
 // If dimension is a number conver it to pixels, otherwise use dimension without transform
 const getDimensionValue = dimension => {
@@ -50,6 +51,9 @@ class BaseChart extends React.Component {
     // ECharts Grid options
     grid: SentryTypes.EChartsGrid,
 
+    // Chart legend
+    legend: SentryTypes.EChartsLegend,
+
     // Chart height
     height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),
 
@@ -132,6 +136,7 @@ class BaseChart extends React.Component {
       colors,
       grid,
       tooltip,
+      legend,
       series,
       yAxis,
       xAxis,
@@ -177,6 +182,7 @@ class BaseChart extends React.Component {
           color: colors || this.getColorPalette(),
           grid: Grid(grid),
           tooltip: tooltip !== null ? Tooltip({isGroupedByDate, ...tooltip}) : null,
+          legend: legend ? Legend(legend) : null,
           yAxis: yAxis !== null ? YAxis(yAxis) : null,
           xAxis:
             xAxis !== null
diff --git a/src/sentry/static/sentry/app/components/charts/components/grid.jsx b/src/sentry/static/sentry/app/components/charts/components/grid.jsx
index 5765b2a877..cd4906c303 100644
--- a/src/sentry/static/sentry/app/components/charts/components/grid.jsx
+++ b/src/sentry/static/sentry/app/components/charts/components/grid.jsx
@@ -5,16 +5,14 @@
  */
 export default function Grid(props = {}) {
   return {
-    top: 24,
-
-    // Is this a decent default for X-axis labels?
-    bottom: 40,
-
+    top: 40,
+    bottom: 20,
     // This should allow for sufficient space for Y-axis labels
-    left: '10%',
-
-    right: '10%',
-
+    left: '0%',
+    right: '0%',
+    padding: 0,
+    itemGap: 25,
+    containLabel: true,
     ...props,
   };
 }
diff --git a/src/sentry/static/sentry/app/components/charts/components/legend.jsx b/src/sentry/static/sentry/app/components/charts/components/legend.jsx
index f350950830..6360c2c47f 100644
--- a/src/sentry/static/sentry/app/components/charts/components/legend.jsx
+++ b/src/sentry/static/sentry/app/components/charts/components/legend.jsx
@@ -1,8 +1,18 @@
 import 'echarts/lib/component/legend';
+import 'echarts/lib/component/legendScroll';
 
 export default function Legend(props = {}) {
   return {
     show: true,
+    type: 'scroll',
+    padding: 0,
+    formatter: function(name) {
+      if (name.length > 80) {
+        return name.substring(0, 80) + '...';
+      } else {
+        return name;
+      }
+    },
     ...props,
   };
 }
diff --git a/src/sentry/static/sentry/app/sentryTypes.jsx b/src/sentry/static/sentry/app/sentryTypes.jsx
index ac2ada7e43..5d085fcb32 100644
--- a/src/sentry/static/sentry/app/sentryTypes.jsx
+++ b/src/sentry/static/sentry/app/sentryTypes.jsx
@@ -682,6 +682,11 @@ export const EChartsGrid = PropTypes.shape({
   tooltip: EChartsTooltip,
 });
 
+export const EChartsLegend = PropTypes.shape({
+  // Show legend on chart
+  show: PropTypes.bool,
+});
+
 export const SeriesUnit = PropTypes.shape({
   seriesName: PropTypes.string,
   data: PropTypes.arrayOf(
@@ -733,6 +738,7 @@ let SentryTypes = {
   EChartsYAxis: EChartsAxis,
   EChartsTooltip,
   EChartsGrid,
+  EChartsLegend,
 };
 
 export default SentryTypes;
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
index c373e5b64b..cf4c3014a3 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/discover.jsx
@@ -3,6 +3,7 @@ import PropTypes from 'prop-types';
 import React from 'react';
 import {browserHistory} from 'react-router';
 import {uniq} from 'lodash';
+import styled from 'react-emotion';
 
 import {addErrorMessage, clearIndicators} from 'app/actionCreators/indicator';
 import {t} from 'app/locale';
@@ -12,6 +13,7 @@ import MultipleProjectSelector from 'app/components/organizations/multipleProjec
 import NumberField from 'app/components/forms/numberField';
 import SelectControl from 'app/components/forms/selectControl';
 import SentryTypes from 'app/sentryTypes';
+import space from 'app/styles/space';
 import TimeRangeSelector from 'app/components/organizations/timeRangeSelector';
 
 import Aggregations from './aggregations';
@@ -373,9 +375,9 @@ export default class OrganizationDiscover extends React.Component {
               onUpdate={this.runQuery}
             />
           </TopBar>
-          <Flex flex="1" direction="column" p={3}>
+          <BodyContent direction="column">
             {data && (
-              <Result
+              <Result flex="1"
                 data={data}
                 query={query}
                 chartData={chartData}
@@ -384,9 +386,14 @@ export default class OrganizationDiscover extends React.Component {
             )}
             {!data && <Intro updateQuery={this.updateFields} />}
             <EarlyAdopterMessage />
-          </Flex>
+          </BodyContent>
         </Body>
       </Discover>
     );
   }
 }
+
+const BodyContent = styled(Flex)`
+  flex: 1;
+  padding: ${space(1.5)} 32px 32px 32px;
+`;
\ No newline at end of file
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
index 94ece3fe96..b81aa111af 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/result/index.jsx
@@ -117,13 +117,17 @@ export default class Result extends React.Component {
 
     const byDayChartData = chartData && getChartDataByDay(chartData.data, chartQuery);
 
+    const legendData = byDayChartData
+      ? {data: byDayChartData.map(entry => entry.seriesName)}
+      : null;
+
     const tooltipOptions = {
       filter: value => value !== null,
       truncate: 80,
     };
 
     return (
-      <div>
+      <Results>
         <Flex align="center" mb={space(2)}>
           <Box flex="1">
             <Heading>{t('Result')}</Heading>
@@ -134,17 +138,35 @@ export default class Result extends React.Component {
         {view === 'table' && <Table data={data} query={query} />}
         {view === 'line' && (
           <ChartWrapper>
-            <LineChart series={basicChartData} height={300} tooltip={tooltipOptions} />
+            <LineChart
+              series={basicChartData}
+              height={300}
+              tooltip={tooltipOptions}
+              legend={{data: [query.aggregations[0][2]]}}
+              renderer="canvas"
+            />
           </ChartWrapper>
         )}
         {view === 'bar' && (
           <ChartWrapper>
-            <BarChart series={basicChartData} height={300} tooltip={tooltipOptions} />
+            <BarChart
+              series={basicChartData}
+              height={300}
+              tooltip={tooltipOptions}
+              legend={{data: [query.aggregations[0][2]]}}
+              renderer="canvas"
+            />
           </ChartWrapper>
         )}
         {view === 'line-by-day' && (
           <ChartWrapper>
-            <LineChart series={byDayChartData} height={300} tooltip={tooltipOptions} />
+            <LineChart
+              series={byDayChartData}
+              height={300}
+              tooltip={tooltipOptions}
+              legend={legendData}
+              renderer="canvas"
+            />
             {this.renderNote()}
           </ChartWrapper>
         )}
@@ -155,19 +177,24 @@ export default class Result extends React.Component {
               stacked={true}
               height={300}
               tooltip={tooltipOptions}
+              legend={legendData}
+              renderer="canvas"
             />
             {this.renderNote()}
           </ChartWrapper>
         )}
         {this.renderSummary()}
-      </div>
+      </Results>
     );
   }
 }
 
+const Results = styled('div')`
+  flex: 1;
+`;
+
 const ChartWrapper = styled(Panel)`
-  padding-left: ${space(3)};
-  padding-right: ${space(3)};
+  padding: ${space(3)} ${space(2)};
 `;
 
 const Summary = styled(Box)`
@@ -180,5 +207,4 @@ const Note = styled(Box)`
   text-align: center;
   font-size: ${p => p.theme.fontSizeMedium};
   color: ${p => p.theme.gray3};
-  margin-bottom: ${space(3)};
 `;
diff --git a/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx b/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
index a040ece84a..9d24326a2f 100644
--- a/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
+++ b/src/sentry/static/sentry/app/views/organizationDiscover/styles.jsx
@@ -33,7 +33,7 @@ export const Sidebar = styled(Box)`
   min-width: 320px;
 `;
 
-export const Body = styled(Box)``;
+export const Body = styled(Flex)``;
 
 export const TopBar = styled(Flex)`
   padding: 0 ${space(4)};
