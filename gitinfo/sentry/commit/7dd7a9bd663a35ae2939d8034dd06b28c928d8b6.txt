commit 7dd7a9bd663a35ae2939d8034dd06b28c928d8b6
Author: David Cramer <dcramer@gmail.com>
Date:   Tue Feb 23 14:48:08 2016 -0800

    Add basic buffer admin panel

diff --git a/src/sentry/static/sentry/app/routes.jsx b/src/sentry/static/sentry/app/routes.jsx
index e1a1e2ade1..c4ef2d6099 100644
--- a/src/sentry/static/sentry/app/routes.jsx
+++ b/src/sentry/static/sentry/app/routes.jsx
@@ -2,6 +2,7 @@ import React from 'react';
 import {Redirect, Route, IndexRoute} from 'react-router';
 
 import Admin from './views/admin';
+import AdminBuffer from './views/adminBuffer';
 import AdminOrganizations from './views/adminOrganizations';
 import AdminOverview from './views/adminOverview';
 import AdminSettings from './views/adminSettings';
@@ -58,6 +59,7 @@ let routes = (
   <Route path="/" component={errorHandler(App)}>
     <Route path="/manage/" component={errorHandler(Admin)}>
       <IndexRoute component={errorHandler(AdminOverview)} />
+      <Route path="buffer/" component={errorHandler(AdminBuffer)} />
       <Route path="organizations/" component={errorHandler(AdminOrganizations)} />
       <Route path="settings/" component={errorHandler(AdminSettings)} />
     </Route>
diff --git a/src/sentry/static/sentry/app/views/admin/index.jsx b/src/sentry/static/sentry/app/views/admin/index.jsx
index 1dd4b3afa8..e053bc722b 100644
--- a/src/sentry/static/sentry/app/views/admin/index.jsx
+++ b/src/sentry/static/sentry/app/views/admin/index.jsx
@@ -26,6 +26,7 @@ const Admin = React.createClass({
                   <h6 className="nav-header">System</h6>
                   <ul className="nav nav-stacked">
                     <ListLink index={true} to="/manage/">Overview</ListLink>
+                    <ListLink index={true} to="/manage/buffer/">Buffer</ListLink>
                     <li><a href={`${urlPrefix}/manage/queue/`}>Queue</a></li>
                     <li><a href={`${urlPrefix}/manage/status/environment/`}>Environment</a></li>
                     <li><a href={`${urlPrefix}/manage/status/packages/`}>Packages</a></li>
diff --git a/src/sentry/static/sentry/app/views/adminBuffer.jsx b/src/sentry/static/sentry/app/views/adminBuffer.jsx
new file mode 100644
index 0000000000..66d31164c7
--- /dev/null
+++ b/src/sentry/static/sentry/app/views/adminBuffer.jsx
@@ -0,0 +1,133 @@
+/*eslint getsentry/jsx-needs-il8n:0*/
+import React from 'react';
+
+import ApiMixin from '../mixins/apiMixin';
+import FlotChart from '../components/flotChart';
+import LoadingError from '../components/loadingError';
+import LoadingIndicator from '../components/loadingIndicator';
+
+const InternalChart = React.createClass({
+  mixins: [ApiMixin],
+
+  getInitialState() {
+    return {
+      error: false,
+      loading: true,
+      data: null,
+    };
+  },
+
+  componentWillMount() {
+    this.fetchData();
+  },
+
+  fetchData() {
+    this.api.request('/internal/stats/', {
+      method: 'GET',
+      data: {
+        since: this.props.since,
+        resolution: this.props.resolution,
+        key: this.props.stat,
+      },
+      success: (data) => {
+        this.setState({
+          data: data,
+          loading: false,
+          error: false,
+        });
+      },
+      error: (data) => {
+        this.setState({
+          error: true
+        });
+      }
+    });
+  },
+
+  getChartPoints() {
+    let points = this.state.data.map((point) => {
+      return [point[0] * 1000, point[1]];
+    });
+
+
+
+    return [
+      {
+        data: points,
+        label: this.props.label,
+        color: 'rgba(86, 175, 232, 1)',
+        shadowSize: 0,
+        stack: true,
+        lines: {
+          lineWidth: 2,
+          show: true,
+          fill: true
+        }
+      }
+    ];
+  },
+
+  render() {
+    if (this.state.loading)
+      return <LoadingIndicator />;
+    else if (this.state.error)
+      return <LoadingError onRetry={this.fetchData} />;
+
+    return <FlotChart style={{height: 250}} plotData={this.getChartPoints()} />;
+  }
+});
+
+
+const AdminBuffer = React.createClass({
+  getInitialState() {
+    return {
+      since: new Date().getTime() / 1000 - 3600 * 24 * 7,
+      resolution: '1h'
+    };
+  },
+
+  render() {
+    // TODO(dcramer): show buffer configuration when its moved into option store
+    return (
+      <div>
+        <h3>Buffers</h3>
+
+        <div className="box">
+          <div className="box-header">
+            <h4>About</h4>
+          </div>
+
+          <div className="box-content with-padding">
+            <p>Sentry buffers are responsible for making changes to cardinality counters &mdash; such as an issues event count &mdash; as well as updating attributes like <em>last seen</em>. These are flushed on a regularly interval, and are directly affected by the queue backlog.</p>
+          </div>
+        </div>
+
+        <div className="box">
+          <div className="box-header">
+            <h4>Updates Processed</h4>
+          </div>
+          <div className="box-content with-padding">
+            <InternalChart since={this.state.since}
+                           resolution={this.state.resolution}
+                           stat="jobs.finished.sentry.tasks.process_buffer.process_incr"
+                           label="Jobs" />
+          </div>
+        </div>
+
+        <div className="box">
+          <div className="box-header">
+            <h4>Revoked Updates</h4>
+          </div>
+          <div className="box-content with-padding">
+            <InternalChart since={this.state.since}
+                           resolution={this.state.resolution}
+                           stat="buffer.revoked"
+                           label="Jobs" />
+          </div>
+        </div>
+      </div>
+    );
+  }
+});
+
+export default AdminBuffer;
diff --git a/src/sentry/templates/sentry/bases/admin.html b/src/sentry/templates/sentry/bases/admin.html
index de3307b360..214a8e4195 100644
--- a/src/sentry/templates/sentry/bases/admin.html
+++ b/src/sentry/templates/sentry/bases/admin.html
@@ -9,12 +9,13 @@
 {% block sidebar %}
     <h6 class="nav-header">{% trans "System" %}</h6>
     <ul class="nav nav-stacked">
-        <li{% block admin-nav-overview %}{% endblock %}><a href="{% url 'sentry-admin-overview' %}">{% trans "Overview" %}</a></li>
+        <li><a href="{% absolute_uri '/manage/' %}">{% trans "Overview" %}</a></li>
+        <li><a href="{% absolute_uri '/manage/buffer/' %}">{% trans "Buffer" %}</a></li>
         <li{% block admin-nav-queue %}{% endblock %}><a href="{% url 'sentry-admin-queue' %}">{% trans "Queue" %}</a></li>
         <li{% block admin-nav-status %}{% endblock %}><a href="{% url 'sentry-admin-status' %}">{% trans "Environment" %}</a></li>
         <li{% block admin-nav-packages %}{% endblock %}><a href="{% url 'sentry-admin-packages-status' %}">{% trans "Packages" %}</a></li>
         <li{% block admin-nav-mail %}{% endblock %}><a href="{% url 'sentry-admin-mail-status' %}">{% trans "Mail" %}</a></li>
-        <li{% block admin-nav-settings %}{% endblock %}><a href="{% absolute_uri '/manage/settings/' %}">{% trans "Settings" %}</a></li>
+        <li><a href="{% absolute_uri '/manage/settings/' %}">{% trans "Settings" %}</a></li>
     </ul>
 
     <h6 class="nav-header">{% trans "Manage" %}</h6>
