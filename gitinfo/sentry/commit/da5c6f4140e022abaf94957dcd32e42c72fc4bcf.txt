commit da5c6f4140e022abaf94957dcd32e42c72fc4bcf
Author: David Cramer <dcramer@gmail.com>
Date:   Fri Jan 6 03:32:02 2012 -0800

    Clean up HTTP template (for post body)

diff --git a/sentry/interfaces.py b/sentry/interfaces.py
index 02e045cee2..995a19d65b 100644
--- a/sentry/interfaces.py
+++ b/sentry/interfaces.py
@@ -11,6 +11,8 @@ validated and rendered.
 
 import urlparse
 
+from django.http import QueryDict
+
 from sentry.web.helpers import render_to_string
 
 
@@ -230,12 +232,22 @@ class Http(Interface):
         }
 
     def to_html(self, event):
+        data = self.data
+        data_is_dict = False
+        if self.headers.get('Content-Type') == 'application/x-www-form-urlencoded':
+            try:
+                data = QueryDict(data)
+            except:
+                pass
+            else:
+                data_is_dict = True
         return render_to_string('sentry/partial/interfaces/http.html', {
             'event': event,
             'full_url': '?'.join(filter(None, [self.url, self.query_string])),
             'url': self.url,
             'method': self.method,
-            'data': self.data,
+            'data': data,
+            'data_is_dict': data_is_dict,
             'query_string': self.query_string,
             'cookies': self.cookies,
             'headers': self.headers,
diff --git a/sentry/templates/sentry/partial/interfaces/http.html b/sentry/templates/sentry/partial/interfaces/http.html
index 2ac12ff0cc..76680b5c59 100644
--- a/sentry/templates/sentry/partial/interfaces/http.html
+++ b/sentry/templates/sentry/partial/interfaces/http.html
@@ -34,13 +34,30 @@
                     <th>{% trans "Body:" %}</th>
                     <td>
                         {% if data %}
-                            {% if data|length > 5 %}
-                                <a href="#" onclick="return varToggle(this, 'HttpBody')"><span>&#x25b6;</span> {% trans "Body" %}</a>
-                                <div id="vHttpBody" style="display:none;">
-                                    <pre>{{ data|pprint|escape }}</pre>
-                                </div>
+                            {% if data_is_dict %}
+                                {% if data|length > 5 %}
+                                    <a href="#" onclick="return varToggle(this, 'HttpBody')"><span>&#x25b6;</span> {% trans "Body" %}</a>
+                                {% endif %}
+                                <table class="vars" id="vHttpHeaders"{% if data|length > 5 %} style="display:none;"{% endif %}>
+                                    <colgroup>
+                                        <col style="width:100px;">
+                                    </colgroup>
+                                    <tbody>
+                                        {% for key, value in data.iteritems|as_sorted %}
+                                            <tr>
+                                                <td>{{ key|escape }}</td>
+                                                <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                                            </tr>
+                                        {% endfor %}
+                                    </tbody>
+                                </table>
                             {% else %}
-                                <pre>{{ data|pprint|escape }}</pre>
+                                {% if data|length > 5 %}
+                                    <a href="#" onclick="return varToggle(this, 'HttpBody')"><span>&#x25b6;</span> {% trans "Body" %}</a>
+                                {% endif %}
+                                <div id="vHttpBody"{% if data|length > 5 %} style="display:none;"{% endif %}>
+                                    <pre>{{ data|pprint }}</pre>
+                                </div>
                             {% endif %}
                         {% else %}
                             <em>{% trans "No post body." %}</em>
@@ -53,34 +70,20 @@
                         {% if headers %}
                             {% if headers|length > 5 %}
                                 <a href="#" onclick="return varToggle(this, 'HttpHeaders')"><span>&#x25b6;</span> {% trans "Headers" %}</a>
-                                <table class="vars" id="vHttpHeaders" style="display:none;">
-                                    <colgroup>
-                                        <col style="width:100px;">
-                                    </colgroup>
-                                    <tbody>
-                                        {% for key, value in headers.iteritems|as_sorted %}
-                                            <tr>
-                                                <td>{{ key|escape }}</td>
-                                                <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
-                                            </tr>
-                                        {% endfor %}
-                                    </tbody>
-                                </table>
-                            {% else %}
-                                <table class="vars">
-                                    <colgroup>
-                                        <col style="width:100px;">
-                                    </colgroup>
-                                    <tbody>
-                                        {% for key, value in headers.iteritems|as_sorted %}
-                                            <tr>
-                                                <td>{{ key|escape }}</td>
-                                                <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
-                                            </tr>
-                                        {% endfor %}
-                                    </tbody>
-                                </table>
                             {% endif %}
+                            <table class="vars" id="vHttpHeaders"{% if headers|length > 5 %} style="display:none;"{% endif %}>
+                                <colgroup>
+                                    <col style="width:100px;">
+                                </colgroup>
+                                <tbody>
+                                    {% for key, value in headers.iteritems|as_sorted %}
+                                        <tr>
+                                            <td>{{ key|escape }}</td>
+                                            <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                                        </tr>
+                                    {% endfor %}
+                                </tbody>
+                            </table>
                         {% else %}
                             <em>{% trans "No headers recorded." %}</em>
                         {% endif %}
@@ -92,34 +95,20 @@
                         {% if env %}
                             {% if env|length > 5 %}
                                 <a href="#" onclick="return varToggle(this, 'HttpEnv')"><span>&#x25b6;</span> {% trans "Environment" %}</a>
-                                <table class="vars" id="vHttpEnv" style="display:none;">
-                                    <colgroup>
-                                        <col style="width:120px;">
-                                    </colgroup>
-                                    <tbody>
-                                        {% for key, value in env.iteritems|as_sorted %}
-                                            <tr>
-                                                <td>{{ key|escape }}</td>
-                                                <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
-                                            </tr>
-                                        {% endfor %}
-                                    </tbody>
-                                </table>
-                            {% else %}
-                                <table class="vars">
-                                    <colgroup>
-                                        <col style="width:120px;">
-                                    </colgroup>
-                                    <tbody>
-                                        {% for key, value in env.iteritems|as_sorted %}
-                                            <tr>
-                                                <td>{{ key|escape }}</td>
-                                                <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
-                                            </tr>
-                                        {% endfor %}
-                                    </tbody>
-                                </table>
                             {% endif %}
+                            <table class="vars" id="vHttpEnv"{% if env|length > 5 %} style="display:none;"{% endif %}>
+                                <colgroup>
+                                    <col style="width:120px;">
+                                </colgroup>
+                                <tbody>
+                                    {% for key, value in env.iteritems|as_sorted %}
+                                        <tr>
+                                            <td>{{ key|escape }}</td>
+                                            <td class="code"><pre>{{ value|pprint|escape }}</pre></td>
+                                        </tr>
+                                    {% endfor %}
+                                </tbody>
+                            </table>
                         {% else %}
                             <em>{% trans "No environment recorded." %}</em>
                         {% endif %}
