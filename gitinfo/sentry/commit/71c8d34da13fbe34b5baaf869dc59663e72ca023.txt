commit 71c8d34da13fbe34b5baaf869dc59663e72ca023
Author: David Cramer <dcramer@gmail.com>
Date:   Mon Aug 30 20:15:37 2010 -0700

    Add counts to links. Add server list.

diff --git a/.gitignore b/.gitignore
index 41d352f203..1c25409289 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,7 +1,6 @@
 /build
 /dist
-/django_db_log.egg-info
+/*.egg-info
 *.pyc
-/django-db-log-*
 *.log
 pip-log.txt
\ No newline at end of file
diff --git a/dblog/templates/dblog/group.html b/dblog/templates/dblog/group.html
index ebc7648f31..853d17eb4d 100644
--- a/dblog/templates/dblog/group.html
+++ b/dblog/templates/dblog/group.html
@@ -16,13 +16,22 @@
 			</li>
 		</ul>
 		
-		<h2>Logged URLs</h2>
+		<h2>URLs</h2>
 		
-		<ul>
+		<ul class="url-list">
 			{% for link in unique_urls %}
-				<li><a href="{{ link }}">{{ link }}</a></li>
+				<li><span class="count">{{ link.times_seen }}</span> <a href="{{ link.url }}">{{ link.url }}</a></li>
 			{% endfor %}
 		</ul>
+
+		<h2>Servers</h2>
+		
+		<ul class="server-list">
+			{% for server in unique_servers %}
+				<li><span class="count">{{ server.times_seen }}</span> {{ server.server_name }}</li>
+			{% endfor %}
+		</ul>
+
 		
 		{% if traceback %}
 
diff --git a/dblog/templates/dblog/index.html b/dblog/templates/dblog/index.html
index 140d2f3ad5..e10c59b13b 100644
--- a/dblog/templates/dblog/index.html
+++ b/dblog/templates/dblog/index.html
@@ -122,6 +122,10 @@
 			h2 span.commands { font-size:.7em;}
 			span.commands a:link {color:#5E5694;}
 			pre.exception_value { font-family: sans-serif; color: #666; font-size: 1.5em; margin: 10px 0 10px 0; }
+			.server-list, .url-list { list-style: none; margin-left: 5px; }
+			
+			/* messages generic */
+			.count { background: #000; -moz-border-radius: 4px; border-radius: 4px; padding: 0 5px; line-height: 19px; color: #fff; display: inline-block; }
 			
 			/* message list */
 			.messages { list-style: none; margin-left: 0; }
@@ -136,11 +140,22 @@
 			.messages .traceback { display: none; }
 			.messages li { padding: 8px; }
 			.messages .row1 { background: #f9f9f9; }
-			.messages .priority-high .count, .messages .priority-veryhigh .count {
+			.messages .priority-veryhigh .count {
 				background: red;
 			}
+			.messages .priority-high .count {
+				background: #ff5400;
+			}
+			.messages .priority-medium .count {
+				background: #ff7800;
+			}
+			.messages .priority-low .count,
+			.messages .priority-verylow .count {
+				background: #ffb400;
+			}
 			.messages .last_seen { color: #bbb; font-size: 0.9em; margin-left: 5px; }
 			.messages li:hover, .messages .active { background: #e0ebff; cursor: pointer; }
+			.messages li:hover .last_seen, .messages .active .last_seen { color: #777; }
 			pre {
 				white-space: pre-wrap;       /* CSS-3                  */
 				white-space: -moz-pre-wrap;  /* Mozilla, since 1999    */
@@ -149,11 +164,6 @@
 				word-wrap: break-word;       /* Internet Explorer 5.5+ */
 				color:;
 			}
-			.nextprev .count { background: #000; -moz-border-radius: 4px; border-radius: 4px; padding: 0 5px; line-height: 19px; color: #fff; display: inline-block; }
-			.nextprev { list-style: none; margin-left: 0; margin-bottom: 2em; }
-			.nextprev a { text-decoration: none; font-size: 1.2em; }
-			.nextprev .next { float: right; }
-			.nextprev .prev { display: inline-block; }
 		</style> 
 	</head> 
  
diff --git a/dblog/views.py b/dblog/views.py
index 30333c105d..7b855aec99 100644
--- a/dblog/views.py
+++ b/dblog/views.py
@@ -1,4 +1,5 @@
 # TODO: login
+from django.db.models import Count
 from django.shortcuts import render_to_response
 from django.utils.safestring import mark_safe
 
@@ -87,6 +88,8 @@ def group(request, group_id):
     else:
         traceback = message.traceback
     
-    unique_urls = [m[0] for m in message_list.filter(url__isnull=False).values_list('url', 'logger', 'view', 'checksum').distinct()[0:10]]
+    unique_urls = message_list.filter(url__isnull=False).values_list('url', 'logger', 'view', 'checksum').annotate(times_seen=Count('url')).values('url', 'times_seen')
+    
+    unique_servers = message_list.filter(server_name__isnull=False).values_list('server_name', 'logger', 'view', 'checksum').annotate(times_seen=Count('server_name')).values('server_name', 'times_seen')
     
     return render_to_response('dblog/group.html', locals())
\ No newline at end of file
