commit 485f3a863793626117ecdd78b442f216a9ffe798
Author: Dan Ryan <dan@danryan.co>
Date:   Sat Oct 13 13:11:45 2018 -0400

    Add changelog cleaning task
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/tasks/__init__.py b/tasks/__init__.py
index a20a64b2..6896edb6 100644
--- a/tasks/__init__.py
+++ b/tasks/__init__.py
@@ -2,8 +2,21 @@
 # Copyied from pip's vendoring process
 # see https://github.com/pypa/pip/blob/95bcf8c5f6394298035a7332c441868f3b0169f4/tasks/__init__.py
 import invoke
+import re
 
 from . import vendoring, release
 from .vendoring import vendor_passa
+from pathlib import Path
 
-ns = invoke.Collection(vendoring, release, vendor_passa.vendor_passa)
+ROOT = Path(".").parent.parent.absolute()
+
+
+@invoke.task
+def clean_mdchangelog(ctx):
+    changelog = ROOT / "CHANGELOG.md"
+    content = changelog.read_text()
+    content = re.sub(r"([^\n]+)\n?\s+\[[\\]+(#\d+)\]\(https://github\.com/pypa/[\w\-]+/issues/\d+\)", r"\1 \2", content, flags=re.MULTILINE)
+    changelog.write_text(content)
+
+
+ns = invoke.Collection(vendoring, release, clean_mdchangelog, vendor_passa.vendor_passa)
