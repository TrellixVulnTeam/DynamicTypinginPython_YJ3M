commit 8c0936faf6766aa1fbc477af8d57969e2584f828
Author: Grey Baker <greysteil@gmail.com>
Date:   Tue May 1 13:30:56 2018 +0100

    Always use sources from Pipfile when doing resolution

diff --git a/pipenv/resolver.py b/pipenv/resolver.py
index c04a6b3c..7e4b95d3 100644
--- a/pipenv/resolver.py
+++ b/pipenv/resolver.py
@@ -68,7 +68,7 @@ def main():
     results = resolve(
         packages,
         pre=do_pre,
-        sources=project.sources,
+        sources=project.pipfile_sources,
         verbose=is_verbose,
         clear=do_clear,
         system=system,
diff --git a/tests/integration/test_lock.py b/tests/integration/test_lock.py
index 29d472e5..e21c7dab 100644
--- a/tests/integration/test_lock.py
+++ b/tests/integration/test_lock.py
@@ -1,4 +1,5 @@
 import pytest
+import os
 
 from flaky import flaky
 
@@ -210,3 +211,41 @@ requests = "*"
         assert c.return_code == 0
         assert '-i https://pypi.python.org/simple' in c.out.strip()
         assert '--extra-index-url https://test.pypi.org/simple' in c.out.strip()
+
+
+@pytest.mark.install
+@pytest.mark.index
+def test_lock_updated_source(PipenvInstance, pypi):
+
+    with PipenvInstance(pypi=pypi) as p:
+        with open(p.pipfile_path, 'w') as f:
+            contents = """
+[[source]]
+url = "https://pypi.python.org/${MY_ENV_VAR}"
+
+[packages]
+requests = "==2.14.0"
+            """.strip()
+            f.write(contents)
+
+        os.environ['MY_ENV_VAR'] = 'simple'
+        c = p.pipenv('lock')
+        assert c.return_code == 0
+        assert 'requests' in p.lockfile['default']
+
+        del os.environ['MY_ENV_VAR']
+
+        with open(p.pipfile_path, 'w') as f:
+            contents = """
+[[source]]
+url = "https://pypi.python.org/simple"
+
+[packages]
+requests = "==2.14.0"
+            """.strip()
+            f.write(contents)
+
+        c = p.pipenv('lock')
+        assert c.return_code == 0
+        assert 'requests' in p.lockfile['default']
+
