commit af649b2b865db90e3c6eed91a6523a343ca3bf03
Author: frostming <frostming@tencent.com>
Date:   Fri May 29 13:35:56 2020 +0800

    Fix incorrect environment when inside venv

diff --git a/news/4276.bgufix.rst b/news/4276.bgufix.rst
new file mode 100644
index 00000000..960ab08b
--- /dev/null
+++ b/news/4276.bgufix.rst
@@ -0,0 +1 @@
+Fix a bug that system-wide packages will be considered when inside a venv.
diff --git a/pipenv/project.py b/pipenv/project.py
index 40b6b263..16bc715d 100644
--- a/pipenv/project.py
+++ b/pipenv/project.py
@@ -330,11 +330,11 @@ class Project(object):
 
     def get_environment(self, allow_global=False):
         # type: (bool) -> Environment
-        if allow_global:
+        is_venv = is_in_virtualenv()
+        if allow_global and not is_venv:
             prefix = sys.prefix
         else:
             prefix = self.virtualenv_location
-        is_venv = is_in_virtualenv()
         sources = self.sources if self.sources else [DEFAULT_SOURCE]
         environment = Environment(
             prefix=prefix, is_venv=is_venv, sources=sources, pipfile=self.parsed_pipfile,
