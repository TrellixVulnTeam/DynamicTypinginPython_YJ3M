commit 1d54a32dc5d71856470607f5b4feb6c4001af900
Author: Dan Ryan <dan@danryan.co>
Date:   Sun May 27 02:19:32 2018 -0400

    Add sources and caches to pip calls
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/pipenv/core.py b/pipenv/core.py
index 0f5c7e4f..07a88d66 100644
--- a/pipenv/core.py
+++ b/pipenv/core.py
@@ -1482,7 +1482,7 @@ def pip_install(
     pre = '--pre' if pre else ''
     quoted_pip = which_pip(allow_global=allow_global)
     quoted_pip = escape_grouped_arguments(quoted_pip)
-    upgrade_strategy = '--upgrade --upgrade-strategy=only-if-needed' if selective_upgrade else ''
+    upgrade_strategy = '--upgrade --upgrade-strategy=to-satisfy-only' if selective_upgrade else ''
     pip_command = '{0} install {4} {5} {6} {7} {3} {1} {2} --exists-action w'.format(
         quoted_pip,
         install_reqs,
@@ -1495,7 +1495,12 @@ def pip_install(
     )
     if verbose:
         click.echo('$ {0}'.format(pip_command), err=True)
-    c = delegator.run(pip_command, block=block, env={'PIP_CACHE_DIR': PIPENV_CACHE_DIR})
+    pip_config = {
+        'PIP_CACHE_DIR': PIPENV_CACHE_DIR,
+        'PIP_WHEEL_DIR': os.path.join(PIPENV_CACHE_DIR, 'wheels'),
+        'PIP_DESTINATION_DIR': os.path.join(PIPENV_CACHE_DIR, 'pkgs'),
+    }
+    c = delegator.run(pip_command, block=block, env=pip_config)
     return c
 
 
diff --git a/pipenv/utils.py b/pipenv/utils.py
index 599d8a0c..9cb27c78 100644
--- a/pipenv/utils.py
+++ b/pipenv/utils.py
@@ -260,6 +260,9 @@ def actually_resolve_reps(
     if sources:
         pip_args = prepare_pip_source_args(sources, pip_args)
     with NamedTemporaryFile(mode='w', prefix='pipenv-', suffix='-constraints.txt', dir=req_dir.name, delete=False) as f:
+        if sources:
+            requirementstxt_sources = ' '.join(pip_args).replace(' --', '\n--')
+            f.write('{0}\n'.format(requirementstxt_sources))
         f.write(u'\n'.join([_constraint for _constraint in constraints]))
         constraints_file = f.name
     if verbose:
