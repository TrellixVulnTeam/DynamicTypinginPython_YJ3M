commit eae91c2c623e4d2e52292de3d0a7c5abf9cb157d
Author: Kenneth Reitz <me@kennethreitz.org>
Date:   Thu Sep 21 19:14:31 2017 -0400

    fix the broken
    
    Signed-off-by: Kenneth Reitz <me@kennethreitz.org>

diff --git a/pipenv/utils.py b/pipenv/utils.py
index bc7c4705..d9bf1d41 100644
--- a/pipenv/utils.py
+++ b/pipenv/utils.py
@@ -403,6 +403,7 @@ def resolve_deps(deps, which, which_pip, project, sources=None, verbose=False, p
         extra_constraints = []
 
         for dep in deps:
+
             t = tempfile.mkstemp(prefix='pipenv-', suffix='-requirement.txt')[1]
             with open(t, 'w') as f:
                 f.write(dep)
@@ -416,12 +417,12 @@ def resolve_deps(deps, which, which_pip, project, sources=None, verbose=False, p
                 constraint = [c for c in pip.req.parse_requirements(t, session=pip._vendor.requests)][0]
                 extra_constraints = []
 
-            constraints.append(constraint)
-            constraints.extend(extra_constraints)
-
             if ' -i ' in dep:
                 index_lookup[constraint.name] = project.get_source(url=dep.split(' -i ')[1]).get('name')
 
+            constraints.append(constraint)
+            constraints.extend(extra_constraints)
+
         pip_command = get_pip_command()
 
         pip_args = []
@@ -654,7 +655,7 @@ def convert_deps_to_pip(deps, project=None, r=True, include_index=False):
             else:
                 dep = ''
 
-        dependencies.append('{0}{1}{2}{3} {4}'.format(dep, extra, version, hash, index))
+        dependencies.append('{0}{1}{2}{3} {4}'.format(dep, extra, version, hash, index).strip())
 
     if not r:
         return dependencies
