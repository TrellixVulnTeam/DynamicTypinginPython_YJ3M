commit ae512d2feee010e100d639d3e48473f96f96a38c
Author: Tzu-ping Chung <uranusjr@gmail.com>
Date:   Wed Mar 14 23:10:41 2018 +0800

    chdir when testing .env loading
    
    Fix #1666. This also fixes the .env overwriting so we can get rid of the
    recovering fixture!

diff --git a/tests/test_pipenv.py b/tests/test_pipenv.py
index 055eb7d0..3dd77eee 100644
--- a/tests/test_pipenv.py
+++ b/tests/test_pipenv.py
@@ -20,7 +20,7 @@ if PY2:
 
 try:
     from pathlib import Path
-except:
+except ImportError:
     from pipenv.vendor.pathlib2 import Path
 
 os.environ['PIPENV_DONT_USE_PYENV'] = '1'
@@ -34,25 +34,10 @@ def pip_src_dir(request):
     old_src_dir = os.environ.get('PIP_SRC', '')
     new_src_dir = TemporaryDirectory(prefix='pipenv-', suffix='-testsrc')
     os.environ['PIP_SRC'] = new_src_dir.name
+
     def finalize():
         new_src_dir.cleanup()
         os.environ['PIP_SRC'] = old_src_dir
-    request.addfinalizer(finalize)
-    return request
-
-
-@pytest.fixture()
-def backup_dotenv(request):
-    if os.path.exists('.env'):
-        with open('.env') as f:
-            prev_dotenv = f.read()
-    else:
-        prev_dotenv = None
-
-    def finalize():
-        if prev_dotenv is not None:
-            with open('.env', 'w') as f:
-                f.write(prev_dotenv)
 
     request.addfinalizer(finalize)
     return request
@@ -712,10 +697,9 @@ requests = {version = "*"}
 
     @pytest.mark.run
     @pytest.mark.dotenv
-    @pytest.mark.usefixtures('backup_dotenv')
     def test_env(self):
 
-        with PipenvInstance(pipfile=False) as p:
+        with PipenvInstance(pipfile=False, chdir=True) as p:
             with open('.env', 'w') as f:
                 f.write('HELLO=WORLD')
 
