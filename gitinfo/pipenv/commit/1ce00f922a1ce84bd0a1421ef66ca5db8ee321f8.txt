commit 1ce00f922a1ce84bd0a1421ef66ca5db8ee321f8
Author: Tzu-ping Chung <uranusjr@gmail.com>
Date:   Wed Jun 20 00:27:15 2018 +0800

    Ensure environs are strings on Python2 + Windows
    
    Patch based on theskumar/python-dotenv#101 by @greyli.

diff --git a/pipenv/vendor/dotenv/main.py b/pipenv/vendor/dotenv/main.py
index 3d1bd72f..75f49c4a 100644
--- a/pipenv/vendor/dotenv/main.py
+++ b/pipenv/vendor/dotenv/main.py
@@ -94,6 +94,13 @@ class DotEnv():
         for k, v in self.dict().items():
             if k in os.environ and not override:
                 continue
+            # With Python 2 on Windows, ensuree environment variables are
+            # system strings to avoid "TypeError: environment can only contain
+            # strings" in Python's subprocess module.
+            if sys.version_info.major < 3 and sys.platform == 'win32':
+                from pipenv.utils import fs_str
+                k = fs_str(k)
+                v = fs_str(v)
             os.environ[k] = v
 
         return True
diff --git a/tasks/vendoring/patches/vendor/dotenv-windows-unicode.patch b/tasks/vendoring/patches/vendor/dotenv-windows-unicode.patch
new file mode 100644
index 00000000..c090e885
--- /dev/null
+++ b/tasks/vendoring/patches/vendor/dotenv-windows-unicode.patch
@@ -0,0 +1,18 @@
+diff --git a/pipenv/vendor/dotenv/main.py b/pipenv/vendor/dotenv/main.py
+index 3d1bd72f..75f49c4a 100644
+--- a/pipenv/vendor/dotenv/main.py
++++ b/pipenv/vendor/dotenv/main.py
+@@ -94,6 +94,13 @@ class DotEnv():
+         for k, v in self.dict().items():
+             if k in os.environ and not override:
+                 continue
++            # With Python 2 on Windows, ensuree environment variables are
++            # system strings to avoid "TypeError: environment can only contain
++            # strings" in Python's subprocess module.
++            if sys.version_info.major < 3 and sys.platform == 'win32':
++                from pipenv.utils import fs_str
++                k = fs_str(k)
++                v = fs_str(v)
+             os.environ[k] = v
+
+         return True
