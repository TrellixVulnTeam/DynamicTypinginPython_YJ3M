commit d5680fb61792cc3a7400e985936e3f82214bba89
Author: Dan Ryan <dan@danryan.co>
Date:   Fri Nov 2 17:57:50 2018 -0400

    Fix hash function
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/pipenv/patched/piptools/repositories/pypi.py b/pipenv/patched/piptools/repositories/pypi.py
index 2a0743a3..61250f2b 100644
--- a/pipenv/patched/piptools/repositories/pypi.py
+++ b/pipenv/patched/piptools/repositories/pypi.py
@@ -65,7 +65,7 @@ class HashCache(SafeFileCache):
         if can_hash:
             # hash url WITH fragment
             hash_value = self.get(new_location.url)
-        if not hash_value:
+        if not hash_value and ((new_location.scheme == "file" and not os.path.isdir(new_location.path)) or new_location.scheme != "file"):
             hash_value = self._get_file_hash(new_location) if not new_location.url.startswith("ssh") else None
             hash_value = hash_value.encode('utf8') if hash_value else None
         if can_hash:
diff --git a/tasks/vendoring/patches/patched/piptools.patch b/tasks/vendoring/patches/patched/piptools.patch
index 3799ccf4..a96bf568 100644
--- a/tasks/vendoring/patches/patched/piptools.patch
+++ b/tasks/vendoring/patches/patched/piptools.patch
@@ -194,7 +194,7 @@ index bf69803..31b85b9 100644
 +        if can_hash:
 +            # hash url WITH fragment
 +            hash_value = self.get(new_location.url)
-+        if not hash_value:
++        if not hash_value and ((new_location.scheme == "file" and not os.path.isdir(new_location.path)) or new_location.scheme != "file"):
 +            hash_value = self._get_file_hash(new_location) if not new_location.url.startswith("ssh") else None
 +            hash_value = hash_value.encode('utf8') if hash_value else None
 +        if can_hash:
