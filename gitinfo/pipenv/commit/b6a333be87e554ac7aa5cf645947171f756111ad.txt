commit b6a333be87e554ac7aa5cf645947171f756111ad
Author: Tzu-ping Chung <uranusjr@gmail.com>
Date:   Tue Mar 27 11:05:44 2018 +0800

    Set -o pipefail so errors propagate through piping
    
    This prevents the pipe syntax in the $TAP_OUTPUT branch from masking
    the underlying pytest failure.

diff --git a/run-tests.sh b/run-tests.sh
index 2b528a1a..f66a7fd2 100755
--- a/run-tests.sh
+++ b/run-tests.sh
@@ -2,7 +2,7 @@
 
 # NOTE: set TEST_SUITE to be markers you want to run.
 
-set -e
+set -eo pipefail
 
 # Set the PYPI vendor URL for pytest-pypi.
 PYPI_VENDOR_DIR="$(pwd)/tests/pypi/"
@@ -63,6 +63,7 @@ fi
 if [[ "$TAP_OUTPUT" ]]; then
 	echo "$ pipenv run time pytest -v -n auto tests -m \"$TEST_SUITE\" --tap-stream | tee report-$PYTHON.tap"
 	pipenv run time pytest -v -n auto tests -m "$TEST_SUITE"  --tap-stream | tee report.tap
+
 else
 	echo "$ pipenv run time pytest -v -n auto tests -m \"$TEST_SUITE\""
 	# PIPENV_PYTHON=2.7 pipenv run time pytest -v -n auto tests -m "$TEST_SUITE" | prefix 2.7 &
@@ -72,4 +73,4 @@ else
 	PIPENV_PYTHON=3.6 pipenv run time pytest -v -n auto tests -m "$TEST_SUITE"
 	# Cleanup junk.
 	rm -fr .venv
-fi
\ No newline at end of file
+fi
