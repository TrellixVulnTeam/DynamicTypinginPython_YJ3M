commit 16db36e60fd759d35cb99c779354124d13eea20e
Author: jxltom <jxltom@gmail.com>
Date:   Sun Dec 16 19:46:54 2018 +0800

    Test for pipenv behavior in activated virtualenv

diff --git a/tests/integration/test_project.py b/tests/integration/test_project.py
index 6a4a858a..42754521 100644
--- a/tests/integration/test_project.py
+++ b/tests/integration/test_project.py
@@ -170,7 +170,15 @@ def test_include_editable_packages(PipenvInstance, pypi, testsroot, pathlib_tmpd
 @pytest.mark.virtualenv
 def test_run_in_virtualenv(PipenvInstance, pypi, virtualenv):
     with PipenvInstance(chdir=True, pypi=pypi) as p:
+        os.environ['PIPENV_IGNORE_VIRTUALENVS'] = '1'
+        c = p.pipenv('run which pip')
+        assert c.return_code == 0
+        assert 'virtualenv' not in c.out
+
         os.environ.pop("PIPENV_IGNORE_VIRTUALENVS", None)
+        c = p.pipenv('run which pip')
+        assert c.return_code == 0
+        assert 'virtualenv' in c.out
         project = Project()
         assert project.virtualenv_location == str(virtualenv)
         c = p.pipenv("run pip install click")
