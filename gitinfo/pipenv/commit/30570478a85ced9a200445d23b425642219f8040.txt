commit 30570478a85ced9a200445d23b425642219f8040
Author: Tzu-ping Chung <uranusjr@gmail.com>
Date:   Wed Jul 25 16:04:44 2018 +0800

    Clean up resolve_deps and actually_resolve_deps

diff --git a/pipenv/resolver.py b/pipenv/resolver.py
index 72db9429..e4c9b09b 100644
--- a/pipenv/resolver.py
+++ b/pipenv/resolver.py
@@ -20,7 +20,6 @@ def which(*args, **kwargs):
 
 
 def main():
-    is_verbose = "--verbose" in " ".join(sys.argv)
     do_pre = "--pre" in " ".join(sys.argv)
     do_clear = "--clear" in " ".join(sys.argv)
     is_debug = "--debug" in " ".join(sys.argv)
@@ -36,7 +35,7 @@ def main():
 
     os.environ["PIP_PYTHON_VERSION"] = ".".join([str(s) for s in sys.version_info[:3]])
     os.environ["PIP_PYTHON_PATH"] = sys.executable
-    if is_verbose:
+    if int(os.environ.get("PIPENV_VERBOSITY", 0)) > 0:
         logging.getLogger("notpip").setLevel(logging.INFO)
     if is_debug:
         # Shit's getting real at this point.
@@ -56,7 +55,7 @@ def main():
         else None
     )
 
-    def resolve(packages, pre, project, sources, verbose, clear, system):
+    def resolve(packages, pre, project, sources, clear, system):
         return resolve_deps(
             packages,
             which,
@@ -64,7 +63,6 @@ def main():
             pre=pre,
             sources=sources,
             clear=clear,
-            verbose=verbose,
             allow_global=system,
         )
 
@@ -81,7 +79,6 @@ def main():
         pre=do_pre,
         project=project,
         sources=sources,
-        verbose=is_verbose,
         clear=do_clear,
         system=system,
     )
diff --git a/pipenv/utils.py b/pipenv/utils.py
index 987645e6..f82f38e4 100644
--- a/pipenv/utils.py
+++ b/pipenv/utils.py
@@ -220,14 +220,11 @@ def actually_resolve_deps(
     markers_lookup,
     project,
     sources,
-    verbose,
     clear,
     pre,
     req_dir=None,
 ):
-    from .vendor.packaging.markers import default_environment
     from .patched.notpip._internal import basecommand
-    from .patched.notpip._internal.cmdoptions import no_binary, only_binary
     from .patched.notpip._internal.req import parse_requirements
     from .patched.notpip._internal.exceptions import DistributionNotFound
     from .patched.notpip._vendor.requests.exceptions import HTTPError
@@ -273,7 +270,7 @@ def actually_resolve_deps(
     pip_args = []
     if sources:
         pip_args = prepare_pip_source_args(sources, pip_args)
-    if verbose:
+    if environments.PIPENV_VERBOSITY > 0:
         print("Using pip: {0}".format(" ".join(pip_args)))
     with NamedTemporaryFile(
         mode="w",
@@ -296,7 +293,7 @@ def actually_resolve_deps(
         constraints_file, finder=pypi.finder, session=pypi.session, options=pip_options
     )
     constraints = [c for c in constraints]
-    if verbose:
+    if environments.PIPENV_VERBOSITY > 0:
         logging.log.verbose = True
         piptools_logging.log.verbose = True
     resolved_tree = set()
@@ -391,7 +388,6 @@ def resolve_deps(
     which,
     project,
     sources=None,
-    verbose=False,
     python=False,
     clear=False,
     pre=False,
@@ -420,7 +416,6 @@ def resolve_deps(
                 markers_lookup,
                 project,
                 sources,
-                verbose,
                 clear,
                 pre,
                 req_dir=req_dir,
@@ -443,7 +438,6 @@ def resolve_deps(
                     markers_lookup,
                     project,
                     sources,
-                    verbose,
                     clear,
                     pre,
                     req_dir=req_dir,
@@ -485,7 +479,7 @@ def resolve_deps(
                         collected_hashes.append(release["digests"]["sha256"])
                     collected_hashes = ["sha256:" + s for s in collected_hashes]
                 except (ValueError, KeyError, ConnectionError):
-                    if verbose:
+                    if environments.PIPENV_VERBOSITY > 0:
                         click_echo(
                             "{0}: Error generating hash for {1}".format(
                                 crayons.red("Warning", bold=True), name
