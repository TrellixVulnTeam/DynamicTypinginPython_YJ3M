commit ed780c4061bcf9680332a29ed966733c6aed2eaa
Author: Dan Ryan <dan.ryan@canonical.com>
Date:   Wed May 20 01:47:42 2020 -0400

    Tweak crayons patch with vendored imports
    
    - Remove now-unused `allow_global` argument to pip install
      argument builder
    - Update vistir version number and code to fix vendoring issue
    
    Signed-off-by: Dan Ryan <dan.ryan@canonical.com>

diff --git a/pipenv/core.py b/pipenv/core.py
index 08372629..680e069a 100644
--- a/pipenv/core.py
+++ b/pipenv/core.py
@@ -1335,7 +1335,6 @@ def get_pip_args(
     no_deps=False,  # type: bool,
     selective_upgrade=False,  # type: bool
     src_dir=None,  # type: Optional[str]
-    allow_global=False,  # type: bool
 ):
     # type: (...) -> List[str]
     from .vendor.packaging.version import parse as parse_version
@@ -1496,7 +1495,7 @@ def pip_install(
     pip_args = get_pip_args(
         pre=pre, verbose=environments.is_verbose(), upgrade=True,
         selective_upgrade=selective_upgrade, no_use_pep517=not use_pep517,
-        no_deps=no_deps, require_hashes=not ignore_hashes, allow_global=allow_global
+        no_deps=no_deps, require_hashes=not ignore_hashes,
     )
     pip_command.extend(pip_args)
     if r:
diff --git a/pipenv/patched/crayons.py b/pipenv/patched/crayons.py
index de735daf..d7644a21 100644
--- a/pipenv/patched/crayons.py
+++ b/pipenv/patched/crayons.py
@@ -12,8 +12,8 @@ import os
 import re
 import sys
 
-import shellingham
-import colorama
+from pipenv.vendor import shellingham
+from pipenv.vendor import colorama
 
 PY3 = sys.version_info[0] >= 3
 
diff --git a/pipenv/vendor/vendor.txt b/pipenv/vendor/vendor.txt
index 98d1e86b..3e081520 100644
--- a/pipenv/vendor/vendor.txt
+++ b/pipenv/vendor/vendor.txt
@@ -38,7 +38,7 @@ six==1.14.0
 semver==2.9.0
 toml==0.10.1
 cached-property==1.5.1
-vistir==0.5.1
+vistir==0.5.2
 pip-shims==0.5.2
     contextlib2==0.6.0.post1
     funcsigs==1.0.2
diff --git a/pipenv/vendor/vistir/misc.py b/pipenv/vendor/vistir/misc.py
index 83f30b35..460e142b 100644
--- a/pipenv/vendor/vistir/misc.py
+++ b/pipenv/vendor/vistir/misc.py
@@ -207,11 +207,14 @@ class SubprocessStreamWrapper(object):
         stdout_allowed=False,  # type: bool
     ):
         # type: (...) -> None
+        stdout_encoding = None
+        stderr_encoding = None
+        preferred_encoding = getpreferredencoding()
         if subprocess is not None:
             stdout_encoding = self.get_subprocess_encoding(subprocess, "stdout")
             stderr_encoding = self.get_subprocess_encoding(subprocess, "stderr")
-        self.stdout_encoding = stdout_encoding or PREFERRED_ENCODING
-        self.stderr_encoding = stderr_encoding or PREFERRED_ENCODING
+        self.stdout_encoding = stdout_encoding or preferred_encoding
+        self.stderr_encoding = stderr_encoding or preferred_encoding
         self.stdout_lines = []
         self.text_stdout_lines = []
         self.stderr_lines = []
diff --git a/tasks/vendoring/patches/patched/crayons.patch b/tasks/vendoring/patches/patched/crayons.patch
index d7fa3d40..2760ca81 100644
--- a/tasks/vendoring/patches/patched/crayons.patch
+++ b/tasks/vendoring/patches/patched/crayons.patch
@@ -8,8 +8,9 @@ index 455d3e90..de735daf 100644
  
 -PY3 = sys.version_info[0] >= 3
 -
-+import shellingham
- import colorama
+-import colorama
++from pipenv.vendor import shellingham
++from pipenv.vendor import colorama
  
 +PY3 = sys.version_info[0] >= 3
 +
