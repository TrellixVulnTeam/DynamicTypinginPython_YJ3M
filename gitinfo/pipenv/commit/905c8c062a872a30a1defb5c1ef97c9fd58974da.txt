commit 905c8c062a872a30a1defb5c1ef97c9fd58974da
Author: frostming <mianghong@gmail.com>
Date:   Fri Nov 16 10:51:18 2018 +0800

    Derive missing values of source from existing fields
    
    Signed-off-by: frostming <mianghong@gmail.com>

diff --git a/pipenv/project.py b/pipenv/project.py
index 590fafe5..0067348c 100644
--- a/pipenv/project.py
+++ b/pipenv/project.py
@@ -727,6 +727,18 @@ class Project(object):
             data[u"requires"] = {"python_version": version[: len("2.7")]}
         self.write_toml(data)
 
+    @classmethod
+    def populate_source(cls, source):
+        """Derive missing values of source from the existing fields."""
+        # Only URL pararemter is mandatory, let the KeyError be thrown.
+        if "name" not in source:
+            source["name"] = get_url_name(source["url"])
+        if "verify_ssl" not in source:
+            source["verify_ssl"] = "https://" in source["url"]
+        if not isinstance(source["verify_ssl"], bool):
+            source["verify_ssl"] = source["verify_ssl"].lower() == "true"
+        return source
+
     def get_or_create_lockfile(self):
         from pipenv.vendor.requirementslib.models.lockfile import Lockfile as Req_Lockfile
         lockfile = None
@@ -747,15 +759,7 @@ class Project(object):
             elif not isinstance(sources, list):
                 sources = [sources,]
             lockfile_dict["_meta"]["sources"] = [
-                {
-                    "name": s.get("name", get_url_name(s.get("url"))),
-                    "url": s["url"],
-                    "verify_ssl": (
-                        s["verify_ssl"] if isinstance(s["verify_ssl"], bool) else (
-                            True if s["verify_ssl"].lower() == "true" else False
-                        )
-                    )
-                } for s in sources
+                self.populate_source(s) for s in sources
             ]
             _created_lockfile = Req_Lockfile.from_data(
                 path=self.lockfile_location, data=lockfile_dict, meta_from_project=False
diff --git a/tests/integration/test_lock.py b/tests/integration/test_lock.py
index 2b520808..f2f0ac76 100644
--- a/tests/integration/test_lock.py
+++ b/tests/integration/test_lock.py
@@ -486,3 +486,20 @@ def test_lockfile_with_empty_dict(PipenvInstance):
         assert c.return_code == 0
         assert 'Pipfile.lock is corrupted' in c.err
         assert p.lockfile['_meta']
+
+
+@pytest.mark.lock
+@pytest.mark.install
+def test_lock_with_incomplete_source(PipenvInstance, pypi):
+    with PipenvInstance(pypi=pypi, chdir=True) as p:
+        with open(p.pipfile_path, 'w') as f:
+            f.write("""
+[[source]]
+url = "https://test.pypi.org/simple"
+
+[packages]
+requests = "*"
+            """)
+        c = p.pipenv('install')
+        assert c.return_code == 0
+        assert p.lockfile['_meta']['sources']
