commit e51340458e87d29b70a4b41967039e1d6f6d7c52
Author: Dan Ryan <dan.ryan@canonical.com>
Date:   Sun Apr 5 00:45:14 2020 -0400

    Fix package build test
    
    Signed-off-by: Dan Ryan <dan.ryan@canonical.com>

diff --git a/.azure-pipelines/steps/build-package.yml b/.azure-pipelines/steps/build-package.yml
index 81a6160b..01f9fe0b 100644
--- a/.azure-pipelines/steps/build-package.yml
+++ b/.azure-pipelines/steps/build-package.yml
@@ -6,16 +6,17 @@ steps:
     addToPath: true
   displayName: Use Python $(python.version)
 
-- template: install-dependencies.yml
+- bash: |
+    PYTHON_PATH=$(python -c 'import sys; print(sys.executable)')
+    echo "##vso[task.setvariable variable=PY_EXE]$PYTHON_PATH"
+  displayName: Set Python Path
 
 - script: |
     echo '##vso[task.setvariable variable=PIPENV_DEFAULT_PYTHON_VERSION]'$(python.version)
   env:
     PYTHON_VERSION: $(python.version)
 
-- template: create-virtualenv.yml
-  parameters:
-    python_version: $(python.version)
+- template: install-dependencies.yml
 
 - script: |
     python -m pip install --upgrade wheel pip setuptools twine readme_renderer[md]
diff --git a/.azure-pipelines/steps/install-dependencies.yml b/.azure-pipelines/steps/install-dependencies.yml
index c537447d..fd5b31c7 100644
--- a/.azure-pipelines/steps/install-dependencies.yml
+++ b/.azure-pipelines/steps/install-dependencies.yml
@@ -17,14 +17,15 @@ steps:
     git submodule update --init --recursive
     $(PY_EXE) -m pip install --upgrade --upgrade-strategy=eager pip setuptools wheel
     $(PY_EXE) -m pip install "virtualenv<20"
-    $(PY_EXE) -m pipenv install --deploy --dev --python="$(PY_EXE)"
   env:
     PIPENV_DEFAULT_PYTHON_VERSION: ${{ parameters.python_version }}
     PYTHONWARNINGS: 'ignore:DEPRECATION'
     PIPENV_NOSPIN: '1'
   displayName: Make Virtualenv
 
-- script: 'python -m pip install -e . --upgrade'
+- script: |
+    $(PY_EXE) -m pip install -e . --upgrade
+    $(PY_EXE) -m pipenv install --deploy --dev --python="$(PY_EXE)"
   displayName: Upgrade Pip & Install Pipenv
   env:
     PYTHONWARNINGS: 'ignore:DEPRECATION'
diff --git a/.azure-pipelines/steps/run-tests-windows.yml b/.azure-pipelines/steps/run-tests-windows.yml
index 14b645a1..554cae7c 100644
--- a/.azure-pipelines/steps/run-tests-windows.yml
+++ b/.azure-pipelines/steps/run-tests-windows.yml
@@ -55,12 +55,3 @@ steps:
       PYTHONWARNINGS: 'ignore:DEPRECATION'
       PIPENV_NOSPIN: 1
       GIT_SSH_COMMAND: ssh -o StrictHostKeyChecking=accept-new -o CheckHostIP=no
-
-
-
-- task: PublishTestResults@2
-  displayName: Publish Test Results
-  inputs:
-    testResultsFiles: junit/*.xml
-    testRunTitle: 'Python $(python.version)'
-  condition: succeededOrFailed()
diff --git a/.azure-pipelines/steps/run-vendor-scripts.yml b/.azure-pipelines/steps/run-vendor-scripts.yml
index 2923f266..070cc455 100644
--- a/.azure-pipelines/steps/run-vendor-scripts.yml
+++ b/.azure-pipelines/steps/run-vendor-scripts.yml
@@ -10,8 +10,16 @@ steps:
   displayName: Use Python $(python.version)
 
 
+- bash: |
+    PYTHON_PATH=$(python -c 'import sys; print(sys.executable)')
+    echo "##vso[task.setvariable variable=PY_EXE]$PYTHON_PATH"
+  displayName: Set Python Path
+
 - script: |
     echo '##vso[task.setvariable variable=PIPENV_DEFAULT_PYTHON_VERSION]'$(python.version)
+  env:
+    PYTHONWARNINGS: 'ignore:DEPRECATION'
+
   env:
     PYTHON_VERSION: $(python.version)
 
