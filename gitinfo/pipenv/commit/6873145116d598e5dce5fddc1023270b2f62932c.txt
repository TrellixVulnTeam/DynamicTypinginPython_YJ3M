commit 6873145116d598e5dce5fddc1023270b2f62932c
Author: Frost Ming <mianghong@gmail.com>
Date:   Wed Nov 28 16:42:14 2018 +0800

    Abort pipenv when pip install fails

diff --git a/news/3318.bugfix.rst b/news/3318.bugfix.rst
new file mode 100644
index 00000000..b56f75dd
--- /dev/null
+++ b/news/3318.bugfix.rst
@@ -0,0 +1 @@
+Abort pipenv before adding the non-exist package to Pipfile.
diff --git a/pipenv/core.py b/pipenv/core.py
index b9abe272..366a1114 100644
--- a/pipenv/core.py
+++ b/pipenv/core.py
@@ -1926,6 +1926,8 @@ def do_install(
                         extra_indexes=extra_index_url,
                         pypi_mirror=pypi_mirror,
                     )
+                    if not c.ok:
+                        raise RuntimeError(c.err)
                 except (ValueError, RuntimeError) as e:
                     sp.write_err(vistir.compat.fs_str(
                         "{0}: {1}".format(crayons.red("WARNING"), e),
@@ -1933,6 +1935,7 @@ def do_install(
                     sp.fail(environments.PIPENV_SPINNER_FAIL_TEXT.format(
                         "Installation Failed",
                     ))
+                    sys.exit(1)
                 # Warn if --editable wasn't passed.
                 if pkg_requirement.is_vcs and not pkg_requirement.editable:
                     sp.write_err(
diff --git a/tests/integration/test_install_basic.py b/tests/integration/test_install_basic.py
index 25cb55ea..51be966c 100644
--- a/tests/integration/test_install_basic.py
+++ b/tests/integration/test_install_basic.py
@@ -431,3 +431,11 @@ def test_install_creates_pipfile(PipenvInstance):
         c = p.pipenv("install")
         assert c.return_code == 0
         assert os.path.isfile(p.pipfile_path)
+
+
+@pytest.mark.install
+def test_install_non_exist_dep(PipenvInstance, pypi):
+    with PipenvInstance(pypi=pypi, chdir=True) as p:
+        c = p.pipenv("install dateutil")
+        assert not c.ok
+        assert "dateutil" not in p.pipfile["packages"]
