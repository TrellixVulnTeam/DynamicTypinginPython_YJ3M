commit 8960250362186b74d0a85b7419f002329bbfb7e6
Author: Dan Ryan <dan@danryan.co>
Date:   Tue Apr 30 18:13:08 2019 -0400

    Fix pep517 usage on failure
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/pipenv/core.py b/pipenv/core.py
index 76ce7e8b..d3e2ed68 100644
--- a/pipenv/core.py
+++ b/pipenv/core.py
@@ -746,7 +746,7 @@ def batch_install(deps_list, procs, failed_deps_queue,
                 pypi_mirror=pypi_mirror,
                 trusted_hosts=trusted_hosts,
                 extra_indexes=extra_indexes,
-                use_pep517=not retry,
+                use_pep517=not failed,
             )
             if procs.qsize() < nprocs:
                 c.dep = dep
