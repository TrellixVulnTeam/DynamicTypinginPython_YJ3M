commit c1652dffa9e8c47dc0994202715ce8a53c96b82f
Author: Dan Ryan <dan@danryan.co>
Date:   Mon May 27 15:15:20 2019 -0400

    Add separate templates for building package and vendor scripts
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/.azure-pipelines/steps/build-package.yml b/.azure-pipelines/steps/build-package.yml
new file mode 100644
index 00000000..6088f28b
--- /dev/null
+++ b/.azure-pipelines/steps/build-package.yml
@@ -0,0 +1,29 @@
+steps:
+- task: UsePythonVersion@0
+  inputs:
+    versionSpec: $(python.version)
+    architecture: '$(python.architecture)'
+    addToPath: true
+  displayName: Use Python $(python.version)
+
+- template: install-dependencies.yml
+
+- script: |
+    echo '##vso[task.setvariable variable=PIPENV_DEFAULT_PYTHON_VERSION]$(PYTHON_VERSION)'
+  env:
+    PYTHON_VERSION: $(python.version)
+
+- template: create-virtualenv.yml
+
+- script: |
+    python -m pip install --upgrade wheel pip setuptools twine readme_renderer[md]
+    python setup.py sdist bdist_wheel
+    twine check dist/*
+  displayName: Build and check package
+  env:
+    PY_EXE: $(PY_EXE)
+    GIT_SSL_CAINFO: $(GIT_SSL_CAINFO)
+    LANG: $(LANG)
+    PIPENV_DEFAULT_PYTHON_VERSION: $(PIPENV_DEFAULT_PYTHON_VERSION)
+    PYTHONWARNINGS: ignore:DEPRECATION
+    PIPENV_NOSPIN: '1'
diff --git a/.azure-pipelines/steps/run-vendor-scripts.yml b/.azure-pipelines/steps/run-vendor-scripts.yml
new file mode 100644
index 00000000..b776690f
--- /dev/null
+++ b/.azure-pipelines/steps/run-vendor-scripts.yml
@@ -0,0 +1,28 @@
+steps:
+- task: UsePythonVersion@0
+  inputs:
+    versionSpec: $(python.version)
+    architecture: '$(python.architecture)'
+    addToPath: true
+  displayName: Use Python $(python.version)
+
+- template: install-dependencies.yml
+
+- script: |
+    echo '##vso[task.setvariable variable=PIPENV_DEFAULT_PYTHON_VERSION]$(PYTHON_VERSION)'
+  env:
+    PYTHON_VERSION: $(python.version)
+
+- template: create-virtualenv.yml
+
+- script: |
+    python -m pip install --upgrade invoke requests parver bs4 vistir towncrier pip setuptools wheel --upgrade-strategy=eager
+    python -m invoke vendoring.update
+  displayName: Run Vendor Scripts
+  env:
+    PY_EXE: $(PY_EXE)
+    GIT_SSL_CAINFO: $(GIT_SSL_CAINFO)
+    LANG: $(LANG)
+    PIPENV_DEFAULT_PYTHON_VERSION: $(PIPENV_DEFAULT_PYTHON_VERSION)
+    PYTHONWARNINGS: ignore:DEPRECATION
+    PIPENV_NOSPIN: '1'
diff --git a/azure-pipelines.yml b/azure-pipelines.yml
index 28c23a9f..5260208b 100644
--- a/azure-pipelines.yml
+++ b/azure-pipelines.yml
@@ -35,7 +35,10 @@ jobs:
   - template: .azure-pipelines/steps/run-tests.yml
     parameters:
       vmImage: 'Ubuntu-16.04'
-  - template: .azure-pipelines/jobs/run-vendor-scripts.yml
+  - template: .azure-pipelines/steps/run-vendor-scripts.yml
+    parameters:
+      vmImage: 'Ubuntu-16.04'
+- template: .azure-pipelines/steps/build-package.yml
     parameters:
       vmImage: 'Ubuntu-16.04'
 
