commit 70fc92b08d213209a7f4363c616fe490cef9dc66
Author: Dan Ryan <dan@danryan.co>
Date:   Mon Nov 12 10:05:21 2018 -0500

    Fix import errors on setup parsing
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/pipenv/vendor/requirementslib/models/setup_info.py b/pipenv/vendor/requirementslib/models/setup_info.py
index 561ba156..6107a240 100644
--- a/pipenv/vendor/requirementslib/models/setup_info.py
+++ b/pipenv/vendor/requirementslib/models/setup_info.py
@@ -18,6 +18,7 @@ from six.moves import configparser
 from six.moves.urllib.parse import unquote
 from vistir.compat import Path
 from vistir.contextmanagers import cd
+from vistir.misc import run
 from vistir.path import create_tracked_tempdir, ensure_mkdir_p, mkdir_p
 
 from .utils import init_requirement, get_pyproject
@@ -220,9 +221,15 @@ class SetupInfo(object):
 
     def run_setup(self):
         if self.setup_py is not None and self.setup_py.exists():
-            with cd(self.setup_py.parent), _suppress_distutils_logs():
+            target_cwd = self.setup_py.parent.as_posix()
+            with cd(target_cwd), _suppress_distutils_logs():
+                from setuptools.dist import distutils
+                script_name = self.setup_py.as_posix()
+                args = ["egg_info", "--egg-base", self.base_dir]
+                g = {"__file__": script_name, "__name__": "__main__"}
+                local_dict = {}
                 if sys.version_info < (3, 5):
-                    save_argv = sys.argv[:]
+                    save_argv = sys.argv
                 else:
                     save_argv = sys.argv.copy()
                 # This is for you, Hynek
@@ -230,13 +237,18 @@ class SetupInfo(object):
                 try:
                     global _setup_distribution, _setup_stop_after
                     _setup_stop_after = "run"
-                    script_name = self.setup_py.as_posix()
-                    g = {"__file__": script_name, "__name__": "__main__"}
-                    l = {}
                     sys.argv[0] = script_name
-                    sys.argv[1:] = ["egg_info", "--egg-base", self.base_dir]
+                    sys.argv[1:] = args
                     with open(script_name, 'rb') as f:
-                        exec(f.read(), g, l)
+                        if sys.version_info < (3, 5):
+                            exec(f.read(), g, local_dict)
+                        else:
+                            exec(f.read(), g)
+                # We couldn't import everything needed to run setup
+                except NameError:
+                    python = os.environ.get('PIP_PYTHON_PATH', sys.executable)
+                    out, _ = run([python, "setup.py"] + args, cwd=target_cwd, block=True,
+                                 combine_stderr=False, return_object=False, nospin=True)
                 finally:
                     _setup_stop_after = None
                     sys.argv = save_argv
