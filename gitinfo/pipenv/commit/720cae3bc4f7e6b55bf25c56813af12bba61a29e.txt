commit 720cae3bc4f7e6b55bf25c56813af12bba61a29e
Author: davidgang <dgang@freightos.com>
Date:   Tue Mar 6 14:06:22 2018 +0200

    dont add dependency if the constraint does not evaluate

diff --git a/pipenv/patched/piptools/resolver.py b/pipenv/patched/piptools/resolver.py
index e3ab6f22..86476a1a 100755
--- a/pipenv/patched/piptools/resolver.py
+++ b/pipenv/patched/piptools/resolver.py
@@ -6,7 +6,6 @@ import copy
 from functools import partial
 from itertools import chain, count
 import os
-
 from first import first
 from pip.req import InstallRequirement
 
@@ -194,10 +193,11 @@ class Resolver(object):
         # Find the new set of secondary dependencies
         log.debug('')
         log.debug('Finding secondary dependencies:')
-
         safe_constraints = []
         for best_match in best_matches:
             for dep in self._iter_dependencies(best_match):
+                if dep.markers and not dep.markers.evaluate():
+                    continue
                 if self.allow_unsafe or dep.name not in UNSAFE_PACKAGES:
                     safe_constraints.append(dep)
         # Grouping constraints to make clean diff between rounds
