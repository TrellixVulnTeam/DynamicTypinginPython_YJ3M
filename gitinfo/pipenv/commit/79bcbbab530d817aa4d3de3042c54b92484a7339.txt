commit 79bcbbab530d817aa4d3de3042c54b92484a7339
Author: Dan Ryan <dan.ryan@canonical.com>
Date:   Wed Apr 22 13:59:20 2020 -0400

    Fix safety zipfile generation
    
    Signed-off-by: Dan Ryan <dan.ryan@canonical.com>

diff --git a/tasks/vendoring/__init__.py b/tasks/vendoring/__init__.py
index 9354c720..3c0cb22b 100644
--- a/tasks/vendoring/__init__.py
+++ b/tasks/vendoring/__init__.py
@@ -222,10 +222,12 @@ def update_safety(ctx):
     root = _get_git_root(ctx)
     with TemporaryDirectory(prefix="pipenv-", suffix="-safety") as download_dir:
         log("generating lockfile...")
-        resolve_cmd = "python {0} safety".format(root.joinpath("pipenv/resolver.py").as_posix())
-        py27_resolve_cmd = "python2.7 {0} safety".format(root.joinpath("pipenv/resolver.py").as_posix())
-        _, _, resolved = ctx.run(resolve_cmd, hide=True).stdout.partition("RESULTS:")
-        _, _, resolved_py2 = ctx.run(py27_resolve_cmd, hide=True).stdout.partition("RESULTS:")
+        packages = "\n".join(["safety", "requests[security]"])
+        env = {"PIPENV_PACKAGES": packages}
+        resolve_cmd = "python {0}".format(root.joinpath("pipenv/resolver.py").as_posix())
+        py27_resolve_cmd = "python2.7 {0}".format(root.joinpath("pipenv/resolver.py").as_posix())
+        _, _, resolved = ctx.run(resolve_cmd, hide=True, env=env).stdout.partition("RESULTS:")
+        _, _, resolved_py2 = ctx.run(py27_resolve_cmd, hide=True, env=env).stdout.partition("RESULTS:")
         resolved = json.loads(resolved.strip())
         resolved_py2 = json.loads(resolved_py2.strip())
         pkg_dict, pkg_dict_py2 = {}, {}
