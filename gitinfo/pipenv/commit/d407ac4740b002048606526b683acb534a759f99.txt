commit d407ac4740b002048606526b683acb534a759f99
Author: Dan Ryan <dan@danryan.co>
Date:   Sun Nov 18 23:55:50 2018 -0500

    Add submodule sync and update to scripts
    
    Signed-off-by: Dan Ryan <dan@danryan.co>

diff --git a/.azure-pipelines/jobs/run-tests.yml b/.azure-pipelines/jobs/run-tests.yml
index fe98e8ec..3544af41 100644
--- a/.azure-pipelines/jobs/run-tests.yml
+++ b/.azure-pipelines/jobs/run-tests.yml
@@ -26,6 +26,7 @@ steps:
     export GIT_SSL_CAINFO="$(python -m certifi)"
     export LANG="C.UTF-8"
     export PIP_PROCESS_DEPENDENCY_LINKS="1"
+    git submodule sync && git submodule update --init --recursive
     pipenv run pytest --junitxml=test-results.xml
   displayName: Run integration tests
 
diff --git a/.azure-pipelines/steps/run-tests.yml b/.azure-pipelines/steps/run-tests.yml
index 7496c76f..f33523f1 100644
--- a/.azure-pipelines/steps/run-tests.yml
+++ b/.azure-pipelines/steps/run-tests.yml
@@ -12,6 +12,8 @@ steps:
     $env:TEMP='T:\'
     Write-Host "##vso[task.setvariable variable=TMP]T:\"
     $env:TMP='T:\'
+    git submodule sync
+    git submodule update --init --recursive
     D:\.venv\Scripts\pipenv run pytest -ra --ignore=pipenv\patched --ignore=pipenv\vendor --junitxml=test-results.xml tests
   displayName: Run integration tests
 
diff --git a/run-tests.bat b/run-tests.bat
index f31a562a..d20af35f 100644
--- a/run-tests.bat
+++ b/run-tests.bat
@@ -1,7 +1,7 @@
-rem imdisk  -a -s 964515b -m R: -p "/FS:NTFS /Y"
-
-virtualenv R:\.venv
-R:\.venv\Scripts\pip install -e . --upgrade --upgrade-strategy=only-if-needed
-R:\.venv\Scripts\pipenv install --dev
-
-SET RAM_DISK=R: && R:\.venv\Scripts\pipenv run pytest -n auto -v tests --tap-stream > report.tap
+rem imdisk  -a -s 964515b -m R: -p "/FS:NTFS /Y"
+
+virtualenv R:\.venv
+R:\.venv\Scripts\pip install -e . --upgrade --upgrade-strategy=only-if-needed
+R:\.venv\Scripts\pipenv install --dev
+git submodule sync && git submodule update --init --recursive
+SET RAM_DISK=R: && R:\.venv\Scripts\pipenv run pytest -n auto -v tests --tap-stream > report.tap
diff --git a/run-tests.sh b/run-tests.sh
index 16755623..991c0df7 100755
--- a/run-tests.sh
+++ b/run-tests.sh
@@ -55,6 +55,9 @@ PIPENV_PYTHON=2.7 python3 -m pipenv --venv && pipenv --rm && pipenv install --de
 PIPENV_PYTHON=3.7 python3 -m pipenv --venv && pipenv --rm && pipenv install --dev
 PIPENV_PYTHON=2.7 python3 -m pipenv run pip install --upgrade -e .
 PIPENV_PYTHON=3.7 python3 -m pipenv run pip install --upgrade -e .
+echo "$ git submodule sync && git submodule update --init --recursive"
+
+git submodule sync && git submodule update --init --recursive
 
 echo "$ pipenv run time pytest -v -n auto tests -m \"$TEST_SUITE\""
 # PIPENV_PYTHON=2.7 pipenv run time pytest -v -n auto tests -m "$TEST_SUITE" | prefix 2.7 &
diff --git a/run_local_tests.sh b/run_local_tests.sh
new file mode 100755
index 00000000..d3ecb3d6
--- /dev/null
+++ b/run_local_tests.sh
@@ -0,0 +1,57 @@
+#!/bin/bash
+owner=$USER
+IFS=' ' read -a groups <<< $(groups)
+group=${groups[0]}
+python=$(python -c "import sys; print(sys.executable)")
+python2=$(python2.7 -c "import sys; print(sys.executable)")
+#python3=$(pyenv which python3.7)
+ramdisk="/mnt/ramdisk"
+venv_path="$ramdisk/.venv"
+venv_bin="$venv_path/bin"
+# pip="$venv_bin/pip"
+# pipenv="$venv_bin/pipenv"
+py="$venv_bin/python"
+pip="$py -m pip"
+pipenv="$py -m pipenv"
+venv2_path="$ramdisk/.venv2"
+# pipenv2="$venv2_bin/pipenv"
+# pip2="$venv2_bin/pip"
+venv2_bin="$venv2_path/bin"
+py2="$venv2_bin/python"
+pip2="$py2 -m pip"
+pipenv2="$py2 -m pipenv"
+#venv3_path="$ramdisk/.venv3"
+#venv3_bin="$venv3_path/bin"
+#pip3="$venv3_bin/pip"
+#pipenv3="$venv3_bin/pipenv"
+
+
+export RAM_DISK="/mnt/ramdisk/"
+
+[ ! -e $venv_path ] && sudo mount -t ramfs -o size=2g ramfs $ramdisk \
+    && sudo chown -R $owner:$group $ramdisk
+
+[ ! -e $venv_path ] && python -m virtualenv --python=$python $venv_path \
+    && VIRTUAL_ENV="$venv_path" $pip install -e . \
+    && VIRTUAL_ENV="$venv_path" $pipenv run pip install -e . \
+    && VIRTUAL_ENV="$venv_path" $pipenv install --dev
+
+[ ! -e $venv2_path ] && python -m virtualenv --python=$python2 $venv2_path \
+    && VIRTUAL_ENV="$venv2_path" $pip2 install pathlib2 -e . \
+    && VIRTUAL_ENV="$venv2_path" $pipenv2 run pip install -e . \
+    && VIRTUAL_ENV="$venv2_path" $pipenv2 install --dev
+
+#[ ! -e $venv3_path ] && python -m virtualenv --python=$python3 $venv3_path \
+    #&& $pip3 install -e . \
+    #&& $pipenv3 run pip install -e . \
+    #&& $pipenv3 install --dev
+
+
+#export PYPI_VENDOR_DIR="$(pwd)/tests/pypi/"
+PIP_PROCESS_DEPENDENCY_LINKS=1 && VIRTUAL_ENV="$venv2_path" $pipenv run pytest tests/ $@ 2>&1
+PIP_PROCESS_DEPENDENCY_LINKS=1 && VIRTUAL_ENV="$venv2_path" $pipenv2 run pytest tests/ $@ 2>&1
+#$pipenv run pytest -v -n 4 --ignore=pipenv/vendor --ignore=pipenv/patched --ignore=build --ignore=tests/pypi --ignore=tests/pytest-pypi/pypi -p tests.pytest-pypi.pytest_pypi tests/ $@ 2>&1
+#$pipenv2 run pytest -v -n 4 --ignore=pipenv/vendor --ignore=pipenv/patched --ignore=build --ignore=tests/pypi --ignore=tests/pytest-pypi/pypi -p tests.pytest-pypi.pytest_pypi tests/ $@ 2>&1
+#$pipenv3 run pytest -v -n 4 --ignore=pipenv/vendor --ignore=pipenv/patched tests/ $@ 2>&1
+#    && /mnt/ramdisk/.venv/bin/pip install dist/pipenv-11.10.1.dev1-py2.py3-none-any.whl \
+#    && /mnt/ramdisk/.venv/bin/pipenv run pip install dist/pipenv-11.10.1.dev1-py2.py3-none-any.whl \
