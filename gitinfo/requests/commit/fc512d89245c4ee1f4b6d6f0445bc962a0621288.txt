commit fc512d89245c4ee1f4b6d6f0445bc962a0621288
Author: Kenneth Reitz <me@kennethreitz.org>
Date:   Fri Feb 5 17:51:09 2016 -0500

    Don't use redirect_cache if allow_redirects=False
    
    Fix for #2997

diff --git a/requests/sessions.py b/requests/sessions.py
index c177c602..639668f2 100644
--- a/requests/sessions.py
+++ b/requests/sessions.py
@@ -553,19 +553,21 @@ class Session(SessionRedirectMixin):
         if not isinstance(request, PreparedRequest):
             raise ValueError('You can only send PreparedRequests.')
 
-        checked_urls = set()
-        while request.url in self.redirect_cache:
-            checked_urls.add(request.url)
-            new_url = self.redirect_cache.get(request.url)
-            if new_url in checked_urls:
-                break
-            request.url = new_url
-
         # Set up variables needed for resolve_redirects and dispatching of hooks
         allow_redirects = kwargs.pop('allow_redirects', True)
         stream = kwargs.get('stream')
         hooks = request.hooks
 
+        # Resolve URL in redirect cache, if available.
+        if allow_redirects:
+            checked_urls = set()
+            while request.url in self.redirect_cache:
+                checked_urls.add(request.url)
+                new_url = self.redirect_cache.get(request.url)
+                if new_url in checked_urls:
+                    break
+                request.url = new_url
+
         # Get the appropriate adapter to use
         adapter = self.get_adapter(url=request.url)
 
