commit f7917c305a4f05a86a3ae058036e2205dc0f47e7
Author: Braulio Valdivielso Mart√≠nez <brlvldvlsmrtnz@gmail.com>
Date:   Thu Nov 26 01:04:27 2015 +0100

    Make server set stop_event right after closing its socket

diff --git a/testserver/server.py b/testserver/server.py
index f19cc3c7..e329a9fc 100644
--- a/testserver/server.py
+++ b/testserver/server.py
@@ -36,8 +36,8 @@ class Server(threading.Thread):
             
         finally:
             self.ready_event.set() # just in case of exception
-            self.stop_event.set()
             sock.close()
+            self.stop_event.set()
 
     def _create_socket_and_bind(self):
         sock = socket.socket()
