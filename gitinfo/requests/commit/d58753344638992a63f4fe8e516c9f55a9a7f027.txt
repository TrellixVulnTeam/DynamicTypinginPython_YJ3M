commit d58753344638992a63f4fe8e516c9f55a9a7f027
Author: lovedboy <lovedboy.tk@qq.com>
Date:   Fri Oct 21 16:37:46 2016 +0800

    little modification  in consume_socket_content

diff --git a/tests/testserver/server.py b/tests/testserver/server.py
index 93b6522a..6a1dcaa5 100644
--- a/tests/testserver/server.py
+++ b/tests/testserver/server.py
@@ -8,17 +8,17 @@ import select
 def consume_socket_content(sock, timeout=0.5):
     chunks = 65536
     content = b''
-    more_to_read = select.select([sock], [], [], timeout)[0]
 
-    while more_to_read:
-        new_content = sock.recv(chunks)
+    while True:
+        more_to_read = select.select([sock], [], [], timeout)[0]
+        if not more_to_read:
+            break
 
+        new_content = sock.recv(chunks)
         if not new_content:
             break
 
         content += new_content
-        # stop reading if no new data is received for a while
-        more_to_read = select.select([sock], [], [], timeout)[0]
 
     return content
 
