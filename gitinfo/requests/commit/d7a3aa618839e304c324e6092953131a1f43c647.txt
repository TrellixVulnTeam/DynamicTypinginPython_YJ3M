commit d7a3aa618839e304c324e6092953131a1f43c647
Author: Jason Grout <jgrout6@bloomberg.net>
Date:   Thu Aug 27 17:26:14 2015 +0000

    Fix another place the proxy-selecting logic is used.

diff --git a/requests/adapters.py b/requests/adapters.py
index cc6c8971..b9b3326e 100644
--- a/requests/adapters.py
+++ b/requests/adapters.py
@@ -278,10 +278,12 @@ class HTTPAdapter(BaseAdapter):
         :param proxies: A dictionary of schemes to proxy URLs.
         """
         proxies = proxies or {}
-        scheme = urlparse(request.url).scheme
-        proxy = proxies.get(scheme)
+        urlparts = urlparse(request.url.lower())
+        proxy = proxies.get(urlparts.scheme+'://'+urlparts.hostname)
+        if proxy is None:
+            proxy = proxies.get(urlparts.scheme)
 
-        if proxy and scheme != 'https':
+        if proxy and urlparts.scheme != 'https':
             url = urldefragauth(request.url)
         else:
             url = request.path_url
