commit 1ced0040bdc7da87b9fb05c57fc2443be012caf9
Author: Artur Siekielski <artur.siekielski@vhex.net>
Date:   Fri Nov 6 21:54:43 2015 +0100

    Assure session is closed on exception.

diff --git a/requests/api.py b/requests/api.py
index 72a777b2..09ec731b 100644
--- a/requests/api.py
+++ b/requests/api.py
@@ -46,13 +46,11 @@ def request(method, url, **kwargs):
       <Response [200]>
     """
 
-    session = sessions.Session()
-    response = session.request(method=method, url=url, **kwargs)
-    # By explicitly closing the session, we avoid leaving sockets open which
-    # can trigger a ResourceWarning in some cases, and look like a memory leak
-    # in others.
-    session.close()
-    return response
+    # By using the 'with' statement we are sure the session is closed, thus we
+    # avoid leaving sockets open which can trigger a ResourceWarning in some
+    # cases, and look like a memory leak in others.
+    with sessions.Session() as session:
+        return session.request(method=method, url=url, **kwargs)
 
 
 def get(url, params=None, **kwargs):
