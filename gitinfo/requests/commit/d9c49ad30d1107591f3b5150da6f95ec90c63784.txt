commit d9c49ad30d1107591f3b5150da6f95ec90c63784
Author: Vikram Oberoi <voberoi@gmail.com>
Date:   Thu Jun 27 17:16:42 2013 -0400

    Add test to verify .netrc authentication behavior.
    
    Here's what should happen:
    
    - If no credentials are given, use netrc if there's a netrc entry.
    - If credentials are given, they should override netrc.

diff --git a/test_requests.py b/test_requests.py
index 7ad10ee9..07582105 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -234,6 +234,34 @@ class RequestsTestCase(unittest.TestCase):
         r = s.get(url)
         self.assertEqual(r.status_code, 200)
 
+    def test_basicauth_with_netrc(self):
+        auth = ('user', 'pass')
+        wrong_auth = ('wronguser', 'wrongpass')
+        url = httpbin('basic-auth', 'user', 'pass')
+
+        def get_netrc_auth_mock(url):
+            return auth
+        requests.sessions.get_netrc_auth = get_netrc_auth_mock
+
+        # Should use netrc and work.
+        r = requests.get(url)
+        self.assertEqual(r.status_code, 200)
+
+        # Given auth should override and fail.
+        r = requests.get(url, auth=wrong_auth)
+        self.assertEqual(r.status_code, 401)
+
+        s = requests.session()
+        
+        # Should use netrc and work.
+        r = s.get(url)
+        self.assertEqual(r.status_code, 200)
+
+        # Given auth should override and fail.
+        s.auth = wrong_auth
+        r = s.get(url)
+        self.assertEqual(r.status_code, 401)
+
     def test_DIGEST_HTTP_200_OK_GET(self):
 
         auth = HTTPDigestAuth('user', 'pass')
