commit 7ba5a534ae9fc24e40b3ae6c480c9075d684727e
Author: Cory Benfield <lukasaoz@gmail.com>
Date:   Wed Jan 29 19:13:46 2014 +0000

    Repopulate ~/.netrc auth.

diff --git a/requests/sessions.py b/requests/sessions.py
index e262aa32..22fe22f8 100644
--- a/requests/sessions.py
+++ b/requests/sessions.py
@@ -158,6 +158,23 @@ class SessionRedirectMixin(object):
             prepared_request._cookies.update(self.cookies)
             prepared_request.prepare_cookies(prepared_request._cookies)
 
+            # If we get redirected to a new host, we should strip out any
+            #Â authentication headers.
+            original_parsed = urlparse(resp.request.url)
+            redirect_parsed = urlparse(url)
+
+            if original_parsed.hostname != redirect_parsed.hostname:
+                try:
+                    del headers['Authorization']
+                except KeyError:
+                    pass
+
+            # However, .netrc might have more auth for us. Let's get it if it
+            # does.
+            new_auth = get_netrc_auth(url)
+            if new_auth is not None:
+                prepared_request.prepare_auth(new_auth)
+
             resp = self.send(
                 prepared_request,
                 stream=stream,
