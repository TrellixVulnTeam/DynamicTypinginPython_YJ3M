commit f44b86e03962b08ebf3b77d980ebeb8f11f6f704
Author: Cory Benfield <lukasaoz@gmail.com>
Date:   Sat Aug 17 07:27:58 2013 +0100

    Allow non-string objects to be data with files

diff --git a/requests/models.py b/requests/models.py
index 6b4a2994..2428a5e4 100644
--- a/requests/models.py
+++ b/requests/models.py
@@ -106,6 +106,10 @@ class RequestEncodingMixin(object):
                 val = [val]
             for v in val:
                 if v is not None:
+                    # Don't call str() on bytestrings: in Py3 it all goes wrong.
+                    if not isinstance(v, bytes):
+                        v = str(v)
+
                     new_fields.append(
                         (field.decode('utf-8') if isinstance(field, bytes) else field,
                          v.encode('utf-8') if isinstance(v, str) else v))
diff --git a/test_requests.py b/test_requests.py
index c9572a67..e20d45a1 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -663,6 +663,14 @@ class RequestsTestCase(unittest.TestCase):
         self.assertTrue('unicode' in p.headers.keys())
         self.assertTrue('byte' in p.headers.keys())
 
+    def test_can_send_nonstring_objects_with_files(self):
+        data = {'a': 0.0}
+        files = {'b': 'foo'}
+        r = requests.Request('POST', httpbin('post'), data=data, files=files)
+        p = r.prepare()
+
+        self.assertTrue('multipart/form-data' in p.headers['Content-Type'])
+
 
 class TestCaseInsensitiveDict(unittest.TestCase):
 
