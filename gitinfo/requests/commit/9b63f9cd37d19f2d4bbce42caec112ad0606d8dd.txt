commit 9b63f9cd37d19f2d4bbce42caec112ad0606d8dd
Author: Cory Benfield <lukasaoz@gmail.com>
Date:   Thu Oct 22 12:22:28 2015 +0100

    Make sure we unapply this patch.

diff --git a/test_requests.py b/test_requests.py
index d1c6aa4d..cb25555a 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -353,28 +353,33 @@ class TestRequests(object):
         wrong_auth = ('wronguser', 'wrongpass')
         url = httpbin('basic-auth', 'user', 'pass')
 
-        def get_netrc_auth_mock(url):
-            return auth
-        requests.sessions.get_netrc_auth = get_netrc_auth_mock
+        old_auth = requests.sessions.get_netrc_auth
 
-        # Should use netrc and work.
-        r = requests.get(url)
-        assert r.status_code == 200
-
-        # Given auth should override and fail.
-        r = requests.get(url, auth=wrong_auth)
-        assert r.status_code == 401
-
-        s = requests.session()
-
-        # Should use netrc and work.
-        r = s.get(url)
-        assert r.status_code == 200
-
-        # Given auth should override and fail.
-        s.auth = wrong_auth
-        r = s.get(url)
-        assert r.status_code == 401
+        try:
+            def get_netrc_auth_mock(url):
+                return auth
+            requests.sessions.get_netrc_auth = get_netrc_auth_mock
+
+            # Should use netrc and work.
+            r = requests.get(url)
+            assert r.status_code == 200
+
+            # Given auth should override and fail.
+            r = requests.get(url, auth=wrong_auth)
+            assert r.status_code == 401
+
+            s = requests.session()
+
+            # Should use netrc and work.
+            r = s.get(url)
+            assert r.status_code == 200
+
+            # Given auth should override and fail.
+            s.auth = wrong_auth
+            r = s.get(url)
+            assert r.status_code == 401
+        finally:
+            requests.sessions.get_netrc_auth = old_auth
 
     def test_DIGEST_HTTP_200_OK_GET(self):
 
