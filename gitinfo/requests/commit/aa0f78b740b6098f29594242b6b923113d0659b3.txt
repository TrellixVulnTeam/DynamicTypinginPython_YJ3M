commit aa0f78b740b6098f29594242b6b923113d0659b3
Author: Jérémy Bethmont <jeremy.bethmont@gmail.com>
Date:   Tue Aug 9 15:14:08 2011 +0200

    Better support of utf-8 paths.

diff --git a/requests/models.py b/requests/models.py
index 619d099f..51100290 100644
--- a/requests/models.py
+++ b/requests/models.py
@@ -247,10 +247,12 @@ class Request(object):
         """Build the actual URL to use"""
 
         # Support for unicode domain names and paths.
-        parsed_url = list(urlparse(self.url))
-        parsed_url[1] = parsed_url[1].encode('idna')
-        parsed_url[2] = urllib.quote(urllib.unquote(parsed_url[2]))
-        self.url = urlunparse(parsed_url)
+        scheme, netloc, path, params, query, fragment = urlparse(self.url)
+        netloc = netloc.encode('idna')
+        if isinstance(path, unicode):
+            path = path.encode('utf-8')
+        path = urllib.quote(urllib.unquote(path))
+        self.url = str(urlunparse([ scheme, netloc, path, params, query, fragment ]))
 
         if self._enc_params:
             if urlparse(self.url).query:
