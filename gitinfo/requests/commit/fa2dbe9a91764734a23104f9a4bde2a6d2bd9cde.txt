commit fa2dbe9a91764734a23104f9a4bde2a6d2bd9cde
Author: David Black <dblack@atlassian.com>
Date:   Mon Jun 15 20:14:29 2020 +1000

    Remove what appears to be an un-needed call to self.resolve_redirects when not following redirects as part of creating a request's history.

diff --git a/requests/sessions.py b/requests/sessions.py
index 2845880b..e8e2d609 100644
--- a/requests/sessions.py
+++ b/requests/sessions.py
@@ -658,11 +658,13 @@ class Session(SessionRedirectMixin):
 
         extract_cookies_to_jar(self.cookies, request, r.raw)
 
-        # Redirect resolving generator.
-        gen = self.resolve_redirects(r, request, **kwargs)
-
         # Resolve redirects if allowed.
-        history = [resp for resp in gen] if allow_redirects else []
+        if allow_redirects:
+            # Redirect resolving generator.
+            gen = self.resolve_redirects(r, request, **kwargs)
+            history = [resp for resp in gen]
+        else:
+            history = []
 
         # Shuffle things around if there's history.
         if history:
