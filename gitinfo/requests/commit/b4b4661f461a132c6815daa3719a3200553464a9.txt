commit b4b4661f461a132c6815daa3719a3200553464a9
Author: Braulio Valdivielso Mart√≠nez <brlvldvlsmrtnz@gmail.com>
Date:   Thu Nov 26 01:05:16 2015 +0100

    Implemented test to verify that the context manager exits after the server is closed

diff --git a/test_requests.py b/test_requests.py
index 75253eb3..2d433f95 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -1756,6 +1756,16 @@ class TestTestServer(unittest.TestCase):
             assert text == answer
             sock.close()
 
+    def test_server_closes(self):
+        with Server.basic_response_server() as (host, port):
+            sock = socket.socket()
+            sock.connect((host, port))
+
+        with pytest.raises(socket.error):
+            new_sock = socket.socket()
+            new_sock.connect((host, port))
+        sock.close()
+            
     def test_basic_response(self):
         with Server.basic_response_server() as (host, port):
             r = requests.get('http://{}:{}'.format(host, port))
