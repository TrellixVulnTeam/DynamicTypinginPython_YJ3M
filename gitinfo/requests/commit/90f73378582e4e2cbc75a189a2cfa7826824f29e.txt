commit 90f73378582e4e2cbc75a189a2cfa7826824f29e
Author: Cory Benfield <lukasaoz@gmail.com>
Date:   Sat Mar 22 21:11:33 2014 +0000

    Style changes thanks to @sigmavirus24.

diff --git a/requests/sessions.py b/requests/sessions.py
index 65902d87..79ea7773 100644
--- a/requests/sessions.py
+++ b/requests/sessions.py
@@ -221,22 +221,21 @@ class SessionRedirectMixin(object):
             environ_proxies = get_environ_proxies(url)
             scheme = urlparse(url).scheme
 
-            try:
+            proxy = environ_proxies.get(scheme)
+
+            if proxy:
                 new_proxies.setdefault(scheme, environ_proxies[scheme])
-            except KeyError:
-                pass
 
         if 'Proxy-Authorization' in headers:
             del headers['Proxy-Authorization']
 
         try:
             username, password = get_auth_from_url(new_proxies[scheme])
-            if username and password:
-                headers['Proxy-Authorization'] = _basic_auth_str(
-                    username, password
-                )
         except KeyError:
-            pass
+            username, password = None, None
+
+        if username and password:
+            headers['Proxy-Authorization'] = _basic_auth_str(username, password)
 
         return new_proxies
 
