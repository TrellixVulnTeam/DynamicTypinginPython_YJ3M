commit e4d15c464929e87a6648c57f32c422dc5bfecef3
Author: Cory Benfield <lukasaoz@gmail.com>
Date:   Wed Dec 30 16:45:51 2015 +0000

    Help @sigmavirus24 with code golf.

diff --git a/requests/adapters.py b/requests/adapters.py
index 6098ccdd..18900f15 100644
--- a/requests/adapters.py
+++ b/requests/adapters.py
@@ -303,17 +303,16 @@ class HTTPAdapter(BaseAdapter):
         """
         proxy = select_proxy(request.url, proxies)
         scheme = urlparse(request.url).scheme
-        proxy_scheme = ''
+
+        is_proxied_http_request = (proxy and scheme != 'https')
+        using_socks_proxy = False
         if proxy:
-            proxy_scheme = urlparse(proxy).scheme
+            proxy_scheme = urlparse(proxy).scheme.lower()
+            using_socks_proxy = proxy_scheme.startswith('socks')
 
-        if proxy and proxy_scheme.lower().startswith('socks'):
-            # Socks proxies behave like the proxy isn't there at all.
-            url = request.path_url
-        elif proxy and scheme != 'https':
+        url = request.path_url
+        if is_proxied_http_request and not using_socks_proxy:
             url = urldefragauth(request.url)
-        else:
-            url = request.path_url
 
         return url
 
