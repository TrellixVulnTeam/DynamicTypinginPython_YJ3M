commit fb496e4e86cafd78fd510e6d1ecf539c0545bcae
Author: Jason Grout <jgrout6@bloomberg.net>
Date:   Thu Aug 27 18:20:11 2015 +0000

    Add test for per-host proxy selection

diff --git a/test_requests.py b/test_requests.py
index 7e5e4d8f..c67e569e 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -1325,6 +1325,15 @@ class UtilsTestCase(unittest.TestCase):
             'http://localhost.localdomain:5000/v1.0/') == {}
         assert get_environ_proxies('http://www.requests.com/') != {}
 
+    def test_select_proxies(self):
+        """Make sure we can select per-host proxies correctly."""
+        from requests.utils import select_proxy
+        proxies = {'http': 'http://http.proxy',
+                   'http://some.host': 'http://some.host.proxy'}
+        assert select_proxy('hTTp://u:p@Some.Host/path', proxies) == 'http://some.host.proxy'
+        assert select_proxy('hTTp://u:p@Other.Host/path', proxies) == 'http://http.proxy'
+        assert select_proxy('hTTps://Other.Host', proxies) is None
+
     def test_guess_filename_when_int(self):
         from requests.utils import guess_filename
         assert None is guess_filename(1)
