commit 142e24de7b456d09b88bbbe0b9c978755254ca95
Author: Pierre Tardy <pierre.tardy@intel.com>
Date:   Fri Apr 3 15:38:59 2015 +0200

    digestauth: threadsafe test
    
    Signed-off-by: Pierre Tardy <pierre.tardy@intel.com>

diff --git a/test_requests.py b/test_requests.py
index 15406a22..22af2995 100755
--- a/test_requests.py
+++ b/test_requests.py
@@ -32,6 +32,11 @@ try:
 except ImportError:
     import io as StringIO
 
+try:
+    from multiprocessing.pool import ThreadPool
+except ImportError:
+    ThreadPool = None
+
 if is_py3:
     def u(s):
         return s
@@ -411,6 +416,21 @@ class RequestsTestCase(unittest.TestCase):
         r = requests.get(url, auth=auth)
         assert '"auth"' in r.request.headers['Authorization']
 
+    def test_DIGESTAUTH_THREADED(self):
+
+        auth = HTTPDigestAuth('user', 'pass')
+        url = httpbin('digest-auth', 'auth', 'user', 'pass')
+        session = requests.Session()
+        session.auth=auth
+
+        def do_request(i):
+            r = session.get(url)
+            assert '"auth"' in r.request.headers['Authorization']
+            return 1
+        if ThreadPool is not None:
+            pool = ThreadPool(processes=50)
+            pool.map(do_request, range(100))
+
     def test_POSTBIN_GET_POST_FILES(self):
 
         url = httpbin('post')
