commit 41d1a427b06acd33ae69728f4dc63e56078719b0
Author: Shivaram Lingamneni <slingamn@cs.stanford.edu>
Date:   Thu May 3 01:21:37 2012 -0700

    add a test for max_redirects in safe/normal modes

diff --git a/tests/test_requests.py b/tests/test_requests.py
index fb0d75c0..db176f51 100755
--- a/tests/test_requests.py
+++ b/tests/test_requests.py
@@ -847,5 +847,15 @@ class RequestsTestSuite(TestSetup, TestBaseMixin, unittest.TestCase):
         r = requests.get(httpbin('status', '404'))
         r.text
 
+    def test_max_redirects(self):
+        def unsafe_callable():
+            requests.get("http://httpbin.org/redirect/3", config=dict(max_redirects=2))
+        self.assertRaises(requests.exceptions.TooManyRedirects, unsafe_callable)
+
+        # add safe mode
+        response = requests.get("http://httpbin.org/redirect/3", config=dict(safe_mode=True, max_redirects=2))
+        self.assertTrue(response.content is None)
+        self.assertTrue(isinstance(response.error, requests.exceptions.TooManyRedirects))
+
 if __name__ == '__main__':
     unittest.main()
