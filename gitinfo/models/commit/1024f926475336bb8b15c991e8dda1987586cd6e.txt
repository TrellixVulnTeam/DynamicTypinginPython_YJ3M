commit 1024f926475336bb8b15c991e8dda1987586cd6e
Author: Andrew M. Dai <adai@google.com>
Date:   Mon Oct 9 00:09:08 2017 -0700

    Fix eval writing multiple summary files.
    
    PiperOrigin-RevId: 171498799

diff --git a/research/adversarial_text/BUILD b/research/adversarial_text/BUILD
index 476865f9..fe737d19 100644
--- a/research/adversarial_text/BUILD
+++ b/research/adversarial_text/BUILD
@@ -1,5 +1,7 @@
 licenses(["notice"])  # Apache 2.0
 
+exports_files(["LICENSE"])
+
 # Binaries
 # ==============================================================================
 py_binary(
diff --git a/research/adversarial_text/adversarial_losses.py b/research/adversarial_text/adversarial_losses.py
index 07dbf0c5..7ca99466 100644
--- a/research/adversarial_text/adversarial_losses.py
+++ b/research/adversarial_text/adversarial_losses.py
@@ -16,7 +16,6 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
-from six.moves import xrange  # pylint: disable=redefined-builtin
 
 # Dependency imports
 
diff --git a/research/adversarial_text/evaluate.py b/research/adversarial_text/evaluate.py
index a6480ca7..64fbac06 100644
--- a/research/adversarial_text/evaluate.py
+++ b/research/adversarial_text/evaluate.py
@@ -25,7 +25,7 @@ import time
 
 import tensorflow as tf
 
-import graphs
+from adversarial_text import graphs
 
 flags = tf.app.flags
 FLAGS = flags.FLAGS
@@ -75,7 +75,8 @@ def run_eval(eval_ops, summary_writer, saver):
   Returns:
     dict<metric name, value>, with value being the average over all examples.
   """
-  sv = tf.train.Supervisor(logdir=FLAGS.eval_dir, saver=None, summary_op=None)
+  sv = tf.train.Supervisor(
+      logdir=FLAGS.eval_dir, saver=None, summary_op=None, summary_writer=None)
   with sv.managed_session(
       master=FLAGS.master, start_standard_services=False) as sess:
     if not restore_from_checkpoint(sess, saver):
@@ -113,6 +114,7 @@ def _log_values(sess, value_ops, summary_writer=None):
 
   if summary_writer is not None:
     global_step_val = sess.run(tf.train.get_global_step())
+    tf.logging.info('Finished eval for step ' + str(global_step_val))
     summary_writer.add_summary(summary, global_step_val)
 
 
diff --git a/research/adversarial_text/graphs.py b/research/adversarial_text/graphs.py
index d14324b8..9f417435 100644
--- a/research/adversarial_text/graphs.py
+++ b/research/adversarial_text/graphs.py
@@ -24,9 +24,9 @@ import os
 
 import tensorflow as tf
 
-import adversarial_losses as adv_lib
-import inputs as inputs_lib
-import layers as layers_lib
+from adversarial_text import adversarial_losses as adv_lib
+from adversarial_text import inputs as inputs_lib
+from adversarial_text import layers as layers_lib
 
 flags = tf.app.flags
 FLAGS = flags.FLAGS
@@ -116,7 +116,7 @@ class VatxtModel(object):
   """
 
   def __init__(self, cl_logits_input_dim=None):
-    self.global_step = tf.train.get_or_create_global_step()
+    self.global_step = tf.contrib.framework.get_or_create_global_step()
     self.vocab_freqs = _get_vocab_freqs()
 
     # Cache VatxtInput objects
diff --git a/research/adversarial_text/graphs_test.py b/research/adversarial_text/graphs_test.py
index 433afbe7..c19e34cc 100644
--- a/research/adversarial_text/graphs_test.py
+++ b/research/adversarial_text/graphs_test.py
@@ -29,7 +29,7 @@ import tempfile
 
 import tensorflow as tf
 
-import graphs
+from adversarial_text import graphs
 from adversarial_text.data import data_utils
 
 flags = tf.app.flags
diff --git a/research/adversarial_text/layers.py b/research/adversarial_text/layers.py
index 985377cf..f99f8e27 100644
--- a/research/adversarial_text/layers.py
+++ b/research/adversarial_text/layers.py
@@ -16,7 +16,6 @@
 from __future__ import absolute_import
 from __future__ import division
 from __future__ import print_function
-from six.moves import xrange  # pylint: disable=redefined-builtin
 
 # Dependency imports
 
diff --git a/research/adversarial_text/pretrain.py b/research/adversarial_text/pretrain.py
index 4e1fa6a4..d5231b61 100644
--- a/research/adversarial_text/pretrain.py
+++ b/research/adversarial_text/pretrain.py
@@ -27,8 +27,8 @@ from __future__ import print_function
 
 import tensorflow as tf
 
-import graphs
-import train_utils
+from adversarial_text import graphs
+from adversarial_text import train_utils
 
 FLAGS = tf.app.flags.FLAGS
 
diff --git a/research/adversarial_text/train_classifier.py b/research/adversarial_text/train_classifier.py
index f498d2c2..c47131ca 100644
--- a/research/adversarial_text/train_classifier.py
+++ b/research/adversarial_text/train_classifier.py
@@ -35,8 +35,8 @@ from __future__ import print_function
 
 import tensorflow as tf
 
-import graphs
-import train_utils
+from adversarial_text import graphs
+from adversarial_text import train_utils
 
 flags = tf.app.flags
 FLAGS = flags.FLAGS
