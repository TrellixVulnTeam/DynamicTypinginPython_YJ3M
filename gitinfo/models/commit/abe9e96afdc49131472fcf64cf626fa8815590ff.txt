commit abe9e96afdc49131472fcf64cf626fa8815590ff
Author: guptapriya <14104855+guptapriya@users.noreply.github.com>
Date:   Thu May 23 01:50:27 2019 -0700

    NCF Keras: Add validation every epoch
    
    Adding validation every epoch allows us to view the progress during training instead of having to wait until the last eval. Mostly useful for manual runs.

diff --git a/official/recommendation/ncf_keras_main.py b/official/recommendation/ncf_keras_main.py
index 1873c5de..e8f095c7 100644
--- a/official/recommendation/ncf_keras_main.py
+++ b/official/recommendation/ncf_keras_main.py
@@ -110,6 +110,8 @@ def _get_train_and_eval_data(producer, params):
   train_input_fn = producer.make_input_fn(is_training=True)
   train_input_dataset = train_input_fn(params).map(
       preprocess_train_input)
+  train_input_dataset = train_input_dataset.repeat(FLAGS.train_epochs)
+
 
   def preprocess_eval_input(features):
     """Pre-process the eval data.
@@ -242,10 +244,13 @@ def run_ncf(_):
         cloning=params["clone_model_in_keras_dist_strat"])
 
     history = keras_model.fit(train_input_dataset,
+                              steps_per_epoch=num_train_steps,
                               epochs=FLAGS.train_epochs,
                               callbacks=[
                                   IncrementEpochCallback(producer),
                                   time_callback],
+                              validation_data=eval_input_dataset,
+                              validation_steps=num_eval_steps,
                               verbose=2)
 
     logging.info("Training done. Start evaluating")
