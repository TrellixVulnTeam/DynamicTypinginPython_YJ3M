commit f7843c44182996c057ea123f9694400bb45db53e
Author: A. Unique TensorFlower <gardener@tensorflow.org>
Date:   Tue Mar 10 18:21:54 2020 -0700

    Internal change
    
    PiperOrigin-RevId: 300222585

diff --git a/official/vision/detection/modeling/losses.py b/official/vision/detection/modeling/losses.py
index 85714d44..9e36dd5f 100644
--- a/official/vision/detection/modeling/losses.py
+++ b/official/vision/detection/modeling/losses.py
@@ -465,7 +465,9 @@ class RetinanetBoxLoss(object):
     # for instances, the regression targets of 512x512 input with 6 anchors on
     # P3-P7 pyramid is about [0.1, 0.1, 0.2, 0.2].
     normalizer = num_positives * 4.0
-    mask = tf.not_equal(box_targets, 0.0)
+    mask = tf.cast(tf.not_equal(box_targets, 0.0), dtype=tf.float32)
+    box_targets = tf.expand_dims(box_targets, axis=-1)
+    box_outputs = tf.expand_dims(box_outputs, axis=-1)
     box_loss = self._huber_loss(box_targets, box_outputs, sample_weight=mask)
     box_loss /= normalizer
     return box_loss
