commit bf65145d3a771bc0a585946a448fad8886d2c156
Author: Derek Chow <derekjchow@gmail.com>
Date:   Thu Dec 14 14:58:28 2017 -0800

    Fix a bug in create_pet_tf_record.py related to mask creation.

diff --git a/research/object_detection/dataset_tools/create_pet_tf_record.py b/research/object_detection/dataset_tools/create_pet_tf_record.py
index 71af9844..a8663297 100644
--- a/research/object_detection/dataset_tools/create_pet_tf_record.py
+++ b/research/object_detection/dataset_tools/create_pet_tf_record.py
@@ -160,8 +160,6 @@ def dict_to_tf_example(data,
     if not faces_only:
       mask_remapped = mask_np != 2
       masks.append(mask_remapped)
-    mask_stack = np.stack(masks).astype(np.float32)
-    masks_flattened = np.reshape(mask_stack, [-1])
 
   feature_dict = {
       'image/height': dataset_util.int64_feature(height),
@@ -184,8 +182,11 @@ def dict_to_tf_example(data,
       'image/object/view': dataset_util.bytes_list_feature(poses),
   }
   if not faces_only:
+    mask_stack = np.stack(masks).astype(np.float32)
+    masks_flattened = np.reshape(mask_stack, [-1])
     feature_dict['image/object/mask'] = (
         dataset_util.float_list_feature(masks_flattened.tolist()))
+
   example = tf.train.Example(features=tf.train.Features(feature=feature_dict))
   return example
 
