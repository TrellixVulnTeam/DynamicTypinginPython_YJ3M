commit 5b81bb594c9a20b33b6e793edfd08a207d843ba0
Author: guptapriya <priyag@google.com>
Date:   Wed Jun 5 01:45:45 2019 +0000

    scale loss by num replicas

diff --git a/official/recommendation/ncf_keras_main.py b/official/recommendation/ncf_keras_main.py
index db4057a9..a0cd9807 100644
--- a/official/recommendation/ncf_keras_main.py
+++ b/official/recommendation/ncf_keras_main.py
@@ -235,10 +235,11 @@ def _get_keras_model(params):
       from_logits=True,
       reduction="sum")
 
+  loss_scale_factor = batch_size * tf.distribute.get_strategy().num_replicas_in_sync
   keras_model.add_loss(loss_obj(
       y_true=label_input,
       y_pred=softmax_logits,
-      sample_weight=valid_pt_mask_input) * 1.0 / batch_size)
+      sample_weight=valid_pt_mask_input) * 1.0 / loss_scale_factor)
 
   keras_model.summary()
   return keras_model
