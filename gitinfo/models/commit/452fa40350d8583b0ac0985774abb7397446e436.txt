commit 452fa40350d8583b0ac0985774abb7397446e436
Author: Mathias Deschamps <mathias@short-edition.com>
Date:   Tue Nov 7 10:12:40 2017 +0100

    Fix Dockerfile build
    
    - add patch package to make bazel work with @opt
    - CI configured is trying to get git version, which lead to fail since the parents folders are not copied
    - bazel version was too old for the new tensorflow version
    - bazel not finding PYTHON_BIN_PATH, add ENV command as a workaround

diff --git a/research/syntaxnet/Dockerfile b/research/syntaxnet/Dockerfile
index 332cdfc3..efa008bb 100644
--- a/research/syntaxnet/Dockerfile
+++ b/research/syntaxnet/Dockerfile
@@ -19,8 +19,9 @@ RUN mkdir -p $SYNTAXNETDIR \
           libgraphviz-dev \
           liblapack-dev \
           libopenblas-dev \
-          libpng12-dev \
+          libpng-dev \
           libxft-dev \
+          patch \
           python-dev \
           python-mock \
           python-pip \
@@ -55,20 +56,22 @@ RUN python -m pip install \
     && rm -rf /root/.cache/pip /tmp/pip*
 
 # Installs the latest version of Bazel.
-RUN wget --quiet https://github.com/bazelbuild/bazel/releases/download/0.4.3/bazel-0.4.3-installer-linux-x86_64.sh \
-    && chmod +x bazel-0.4.3-installer-linux-x86_64.sh \
-    && ./bazel-0.4.3-installer-linux-x86_64.sh \
-    && rm ./bazel-0.4.3-installer-linux-x86_64.sh
+RUN wget --quiet https://github.com/bazelbuild/bazel/releases/download/0.5.4/bazel-0.5.4-installer-linux-x86_64.sh \
+    && chmod +x bazel-0.5.4-installer-linux-x86_64.sh \
+    && ./bazel-0.5.4-installer-linux-x86_64.sh \
+    && rm ./bazel-0.5.4-installer-linux-x86_64.sh
 
 COPY WORKSPACE $SYNTAXNETDIR/syntaxnet/WORKSPACE
 COPY tools/bazel.rc $SYNTAXNETDIR/syntaxnet/tools/bazel.rc
 COPY tensorflow $SYNTAXNETDIR/syntaxnet/tensorflow
 
+# Workaround solving the PYTHON_BIN_PATH not found problem
+ENV PYTHON_BIN_PATH=/usr/bin/python
 # Compile common TensorFlow targets, which don't depend on DRAGNN / SyntaxNet
 # source. This makes it more convenient to re-compile DRAGNN / SyntaxNet for
 # development (though not as convenient as the docker-devel scripts).
 RUN cd $SYNTAXNETDIR/syntaxnet/tensorflow \
-    && tensorflow/tools/ci_build/builds/configured CPU \
+    && ./configured CPU \
     && cd $SYNTAXNETDIR/syntaxnet \
     && bazel build -c opt @org_tensorflow//tensorflow:tensorflow_py
 
