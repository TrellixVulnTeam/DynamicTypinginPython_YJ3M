commit e1364ca051f703aa7dad208efb297a6712470d1f
Author: Christopher Shallue <chris.shallue@gmail.com>
Date:   Fri Sep 30 14:18:44 2016 -0700

    Close the TFRecordWriter after use.

diff --git a/im2txt/im2txt/data/build_mscoco_data.py b/im2txt/im2txt/data/build_mscoco_data.py
index c55ec911..ecd87b7a 100644
--- a/im2txt/im2txt/data/build_mscoco_data.py
+++ b/im2txt/im2txt/data/build_mscoco_data.py
@@ -286,6 +286,7 @@ def _process_image_files(thread_index, ranges, name, images, decoder, vocab,
               (datetime.now(), thread_index, counter, num_images_in_thread))
         sys.stdout.flush()
 
+    writer.close()
     print("%s [thread %d]: Wrote %d image-caption pairs to %s" %
           (datetime.now(), thread_index, shard_counter, output_file))
     sys.stdout.flush()
diff --git a/inception/inception/data/build_image_data.py b/inception/inception/data/build_image_data.py
index 6d943cfb..b7826cd9 100644
--- a/inception/inception/data/build_image_data.py
+++ b/inception/inception/data/build_image_data.py
@@ -273,6 +273,7 @@ def _process_image_files_batch(coder, thread_index, ranges, name, filenames,
               (datetime.now(), thread_index, counter, num_files_in_thread))
         sys.stdout.flush()
 
+    writer.close()
     print('%s [thread %d]: Wrote %d images to %s' %
           (datetime.now(), thread_index, shard_counter, output_file))
     sys.stdout.flush()
diff --git a/inception/inception/data/build_imagenet_data.py b/inception/inception/data/build_imagenet_data.py
index 77c5a816..a6066152 100644
--- a/inception/inception/data/build_imagenet_data.py
+++ b/inception/inception/data/build_imagenet_data.py
@@ -399,6 +399,7 @@ def _process_image_files_batch(coder, thread_index, ranges, name, filenames,
               (datetime.now(), thread_index, counter, num_files_in_thread))
         sys.stdout.flush()
 
+    writer.close()
     print('%s [thread %d]: Wrote %d images to %s' %
           (datetime.now(), thread_index, shard_counter, output_file))
     sys.stdout.flush()
