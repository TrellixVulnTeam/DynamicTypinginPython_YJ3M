commit a7d1b2b3eda8ccf9794694a7ea149a9ad716367f
Author: Bruce Fontaine <bfontain@google.com>
Date:   Mon Jan 27 15:59:44 2020 -0800

    Internal change
    
    PiperOrigin-RevId: 291819853

diff --git a/official/recommendation/data_pipeline.py b/official/recommendation/data_pipeline.py
index 5bcbb36a..6abc8747 100644
--- a/official/recommendation/data_pipeline.py
+++ b/official/recommendation/data_pipeline.py
@@ -425,7 +425,8 @@ class BaseDataConstructor(threading.Thread):
     self._shuffle_with_forkpool = not stream_files
     if stream_files:
       self._shard_root = epoch_dir or tempfile.mkdtemp(prefix="ncf_")
-      atexit.register(tf.io.gfile.rmtree, self._shard_root)
+      if not create_data_offline:
+        atexit.register(tf.io.gfile.rmtree, self._shard_root)
     else:
       self._shard_root = None
 
