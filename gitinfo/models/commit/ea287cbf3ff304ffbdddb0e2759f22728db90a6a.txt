commit ea287cbf3ff304ffbdddb0e2759f22728db90a6a
Author: Taylor Robie <taylorrobie@google.com>
Date:   Tue Jul 31 16:34:07 2018 -0700

    make ncf dataset test less brittle (#4960)

diff --git a/official/recommendation/data_test.py b/official/recommendation/data_test.py
index 1f640b42..eeb8a204 100644
--- a/official/recommendation/data_test.py
+++ b/official/recommendation/data_test.py
@@ -105,7 +105,10 @@ class BaseTest(tf.test.TestCase):
         batch_size=BATCH_SIZE, eval_batch_size=BATCH_SIZE, num_data_readers=2,
         num_neg=NUM_NEG)
 
-    time.sleep(5)  # allow `alive` file to be written
+    for _ in range(30):
+      if tf.gfile.Exists(ncf_dataset.cache_paths.subproc_alive):
+        break
+      time.sleep(1)  # allow `alive` file to be written
 
     g = tf.Graph()
     with g.as_default():
