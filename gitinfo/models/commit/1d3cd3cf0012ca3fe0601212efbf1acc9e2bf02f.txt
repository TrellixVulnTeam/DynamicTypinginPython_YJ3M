commit 1d3cd3cf0012ca3fe0601212efbf1acc9e2bf02f
Author: Hongkun Yu <hongkuny@google.com>
Date:   Tue Dec 3 14:25:36 2019 -0800

    Internal change
    
    PiperOrigin-RevId: 283622345

diff --git a/official/transformer/model/beam_search.py b/official/transformer/model/beam_search.py
index f386bf37..1b3d5b91 100644
--- a/official/transformer/model/beam_search.py
+++ b/official/transformer/model/beam_search.py
@@ -402,7 +402,9 @@ class SequenceBeamSearch(object):
     topk_ids = topk_indices % self.vocab_size
     if self.padded_decode:
       topk_seq = tf.transpose(topk_seq, perm=[2, 0, 1])
-      topk_seq = tf.tensor_scatter_nd_update(topk_seq, [i + 1], topk_ids)
+      # TODO(b/145533236, hongkuny): Reverts once TF fix the validation.
+      topk_seq = tf.tensor_scatter_nd_update(topk_seq, [[i + 1]],
+                                             tf.expand_dims(topk_ids, axis=0))
       topk_seq = tf.transpose(topk_seq, perm=[1, 2, 0])
     else:
       topk_ids = tf.expand_dims(topk_ids, axis=2)
