commit bb6f092ae5702d50a4f55a8448a6e40144e91029
Author: Yuhao Zhang <zyhzyhzyh@pku.edu.cn>
Date:   Fri Apr 24 01:32:29 2020 -0500

    Guard the unsafe tf.log to prevent NAN (#8223)

diff --git a/research/video_prediction/prediction_train.py b/research/video_prediction/prediction_train.py
index 89b54290..dfc7ab6c 100644
--- a/research/video_prediction/prediction_train.py
+++ b/research/video_prediction/prediction_train.py
@@ -33,6 +33,9 @@ VAL_INTERVAL = 200
 # How often to save a model checkpoint
 SAVE_INTERVAL = 2000
 
+# EPSILON to avoid NAN
+EPSILON = 1e-9
+
 # tf record data location:
 DATA_DIR = 'push/push_train'
 
@@ -81,7 +84,7 @@ def peak_signal_to_noise_ratio(true, pred):
   Returns:
     peak signal to noise ratio (PSNR)
   """
-  return 10.0 * tf.log(1.0 / mean_squared_error(true, pred)) / tf.log(10.0)
+  return 10.0 * (- tf.log(tf.maximum(mean_squared_error(true, pred), EPSILON))) / tf.log(10.0)
 
 
 def mean_squared_error(true, pred):
