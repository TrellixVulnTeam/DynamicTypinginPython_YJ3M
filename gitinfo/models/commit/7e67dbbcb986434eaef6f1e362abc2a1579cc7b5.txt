commit 7e67dbbcb986434eaef6f1e362abc2a1579cc7b5
Author: Yeqing Li <yeqing@google.com>
Date:   Tue Dec 17 14:34:38 2019 -0800

    Internal change
    
    PiperOrigin-RevId: 286061591

diff --git a/official/vision/detection/configs/retinanet_config.py b/official/vision/detection/configs/retinanet_config.py
index 8c5901b3..96a5736e 100644
--- a/official/vision/detection/configs/retinanet_config.py
+++ b/official/vision/detection/configs/retinanet_config.py
@@ -32,6 +32,7 @@ RETINANET_CFG = {
     'type': 'retinanet',
     'model_dir': '',
     'use_tpu': True,
+    'strategy_type': 'tpu',
     'train': {
         'batch_size': 64,
         'iterations_per_loop': 500,
diff --git a/official/vision/detection/dataloader/input_reader.py b/official/vision/detection/dataloader/input_reader.py
index 3615074f..c042102a 100644
--- a/official/vision/detection/dataloader/input_reader.py
+++ b/official/vision/detection/dataloader/input_reader.py
@@ -94,7 +94,9 @@ class InputFn(object):
     dataset = dataset.cache()
 
     if self._is_training:
-      dataset = dataset.shuffle(64)
+      # Large shuffle size is critical for 2vm input pipeline. Can use small
+      # value (e.g. 64) for 1vm.
+      dataset = dataset.shuffle(1000)
     if self._num_examples > 0:
       dataset = dataset.take(self._num_examples)
 
