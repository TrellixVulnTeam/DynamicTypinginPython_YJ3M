commit 7acce35d7224fd831122f37ce2266816c3fc9855
Author: Jing Li <jingli@google.com>
Date:   Sat Oct 5 09:36:14 2019 -0700

    Fix bug in test dataset generation
    
    PiperOrigin-RevId: 273066504

diff --git a/official/resnet/ctl/ctl_imagenet_main.py b/official/resnet/ctl/ctl_imagenet_main.py
index 40ec6bec..a599d0b5 100644
--- a/official/resnet/ctl/ctl_imagenet_main.py
+++ b/official/resnet/ctl/ctl_imagenet_main.py
@@ -128,13 +128,14 @@ def get_input_dataset(flags_obj, strategy):
           input_context=ctx)
       return test_ds
 
-  if strategy:
-    if isinstance(strategy, tf.distribute.experimental.TPUStrategy):
-      test_ds = strategy.experimental_distribute_datasets_from_function(_test_data_fn)
+    if strategy:
+      if isinstance(strategy, tf.distribute.experimental.TPUStrategy):
+        test_ds = strategy.experimental_distribute_datasets_from_function(
+            _test_data_fn)
+      else:
+        test_ds = strategy.experimental_distribute_dataset(_test_data_fn())
     else:
-      test_ds = strategy.experimental_distribute_dataset(_test_data_fn())
-  else:
-    test_ds = _test_data_fn()
+      test_ds = _test_data_fn()
 
   return train_ds, test_ds
 
