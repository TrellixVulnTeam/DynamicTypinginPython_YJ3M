commit 39aea35f4ec64b8caff170e52d2dfdb2d5479ca0
Author: Ayush Dubey <ayushd@google.com>
Date:   Thu Aug 22 15:40:01 2019 -0700

    Add flags to run BERT with MultiWorkerMirroredStrategy.
    
    PiperOrigin-RevId: 264935345

diff --git a/official/bert/common_flags.py b/official/bert/common_flags.py
index 30810956..efcce8ca 100644
--- a/official/bert/common_flags.py
+++ b/official/bert/common_flags.py
@@ -32,10 +32,10 @@ def define_common_bert_flags():
       'init_checkpoint', None,
       'Initial checkpoint (usually from a pre-trained BERT model).')
   flags.DEFINE_enum(
-      'strategy_type', 'mirror', ['tpu', 'mirror'],
+      'strategy_type', 'mirror', ['tpu', 'mirror', 'multi_worker_mirror'],
       'Distribution Strategy type to use for training. `tpu` uses '
-      'TPUStrategy for running on TPUs, `mirror` uses GPUs with '
-      'single host.')
+      'TPUStrategy for running on TPUs, `mirror` uses GPUs with single host, '
+      '`multi_worker_mirror` uses CPUs or GPUs with multiple hosts.')
   flags.DEFINE_integer('num_train_epochs', 3,
                        'Total number of training epochs to perform.')
   flags.DEFINE_integer(
diff --git a/official/bert/run_squad.py b/official/bert/run_squad.py
index dde7cf54..0a063814 100644
--- a/official/bert/run_squad.py
+++ b/official/bert/run_squad.py
@@ -321,6 +321,8 @@ def main(_):
   strategy = None
   if FLAGS.strategy_type == 'mirror':
     strategy = tf.distribute.MirroredStrategy()
+  elif FLAGS.strategy_type == 'multi_worker_mirror':
+    strategy = tf.distribute.experimental.MultiWorkerMirroredStrategy()
   elif FLAGS.strategy_type == 'tpu':
     # Initialize TPU System.
     cluster_resolver = tpu_lib.tpu_initialize(FLAGS.tpu)
