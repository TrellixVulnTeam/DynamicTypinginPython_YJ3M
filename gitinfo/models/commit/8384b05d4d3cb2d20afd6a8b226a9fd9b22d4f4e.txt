commit 8384b05d4d3cb2d20afd6a8b226a9fd9b22d4f4e
Author: Hongkun Yu <saberkun@users.noreply.github.com>
Date:   Mon Aug 5 21:23:32 2019 -0700

    Merged commit includes the following changes: (#7385)
    
    261786323  by yanhuasun<yanhuasun@google.com>:
    
        Replace set, dict with ObjectIdentityDict/Set to prepare for eq implementation
    
    --
    
    PiperOrigin-RevId: 261786323

diff --git a/official/bert/model_training_utils.py b/official/bert/model_training_utils.py
index 8557cb03..38fb8366 100644
--- a/official/bert/model_training_utils.py
+++ b/official/bert/model_training_utils.py
@@ -23,6 +23,7 @@ import os
 
 from absl import logging
 import tensorflow as tf
+from tensorflow.python.util import object_identity
 from official.utils.misc import distribution_utils
 
 _SUMMARY_TXT = 'training_summary.txt'
@@ -248,7 +249,8 @@ def run_customized_training_loop(
             scaled_loss = optimizer.get_scaled_loss(loss)
 
         # De-dupes variables due to keras tracking issues.
-        tvars = list(set(model.trainable_variables))
+        tvars = list(
+            object_identity.ObjectIdentitySet(model.trainable_variables))
         if use_float16:
           scaled_grads = tape.gradient(scaled_loss, tvars)
           grads = optimizer.get_unscaled_gradients(scaled_grads)
