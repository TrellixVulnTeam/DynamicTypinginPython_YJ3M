commit 2e21c80e47c52cbafda9bf0efeb7fd95c220376c
Author: George Sterpu <george.sterpu@gmail.com>
Date:   Mon Jan 27 17:27:16 2020 +0000

    Update beam_search_v1.py

diff --git a/official/nlp/transformer/beam_search_v1.py b/official/nlp/transformer/beam_search_v1.py
index 8b143b1b..016908e2 100644
--- a/official/nlp/transformer/beam_search_v1.py
+++ b/official/nlp/transformer/beam_search_v1.py
@@ -128,9 +128,13 @@ class SequenceBeamSearch(object):
     """Beam search for sequences with highest scores."""
     state, state_shapes = self._create_initial_state(initial_ids, initial_cache)
 
-    finished_state = tf.while_loop(
-        self._continue_search, self._search_step, loop_vars=[state],
-        shape_invariants=[state_shapes], parallel_iterations=1, back_prop=False)
+    finished_state = tf.nest.map_structure(
+      tf.stop_gradient,
+      tf.while_loop(self._continue_search,
+                    self._search_step,
+                    loop_vars=[state],
+                    shape_invariants=[state_shapes],
+                    parallel_iterations=1))
     finished_state = finished_state[0]
 
     alive_seq = finished_state[_StateKeys.ALIVE_SEQ]
