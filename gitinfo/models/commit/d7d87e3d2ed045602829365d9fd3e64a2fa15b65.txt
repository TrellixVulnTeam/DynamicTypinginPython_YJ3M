commit d7d87e3d2ed045602829365d9fd3e64a2fa15b65
Author: Ryan Sepassi <rsepassi@gmail.com>
Date:   Thu Jun 29 13:40:51 2017 -0700

    Fix KL when num_classes != 2 (#1820)
    
    Fix to [issue 1724](https://github.com/tensorflow/models/issues/1724)

diff --git a/adversarial_text/adversarial_losses.py b/adversarial_text/adversarial_losses.py
index 46a0b371..7ca99466 100644
--- a/adversarial_text/adversarial_losses.py
+++ b/adversarial_text/adversarial_losses.py
@@ -212,6 +212,7 @@ def _kl_divergence_with_logits(q_logits, p_logits, weights):
 
   # For softmax regression
   else:
+    q = tf.nn.softmax(q_logits)
     kl = tf.reduce_sum(
         q * (tf.nn.log_softmax(q_logits) - tf.nn.log_softmax(p_logits)), 1)
 
