commit ca6f90261d1b2264fb0d5b149b621d1a39c2b617
Author: Pavithra Vijay <psv@google.com>
Date:   Fri Jan 24 13:32:30 2020 -0800

    Internal change
    
    PiperOrigin-RevId: 291432304

diff --git a/official/vision/image_classification/cifar_preprocessing.py b/official/vision/image_classification/cifar_preprocessing.py
index dcf174b9..6cf78a1e 100644
--- a/official/vision/image_classification/cifar_preprocessing.py
+++ b/official/vision/image_classification/cifar_preprocessing.py
@@ -76,8 +76,6 @@ def parse_record(raw_record, is_training, dtype):
   image = preprocess_image(image, is_training)
   image = tf.cast(image, dtype)
 
-  # TODO(haoyuzhang,hongkuny,tobyboyd): Remove or replace the use of V1 API
-  label = tf.compat.v1.sparse_to_dense(label, (NUM_CLASSES,), 1)
   return image, label
 
 
diff --git a/official/vision/image_classification/resnet_cifar_main.py b/official/vision/image_classification/resnet_cifar_main.py
index 41ace8e7..9718728c 100644
--- a/official/vision/image_classification/resnet_cifar_main.py
+++ b/official/vision/image_classification/resnet_cifar_main.py
@@ -161,17 +161,17 @@ def run(flags_obj):
     # a valid arg for this model. Also remove as a valid flag.
     if flags_obj.force_v2_in_keras_compile is not None:
       model.compile(
-          loss='categorical_crossentropy',
+          loss='sparse_categorical_crossentropy',
           optimizer=optimizer,
-          metrics=(['categorical_accuracy']
+          metrics=(['sparse_categorical_accuracy']
                    if flags_obj.report_accuracy_metrics else None),
           run_eagerly=flags_obj.run_eagerly,
           experimental_run_tf_function=flags_obj.force_v2_in_keras_compile)
     else:
       model.compile(
-          loss='categorical_crossentropy',
+          loss='sparse_categorical_crossentropy',
           optimizer=optimizer,
-          metrics=(['categorical_accuracy']
+          metrics=(['sparse_categorical_accuracy']
                    if flags_obj.report_accuracy_metrics else None),
           run_eagerly=flags_obj.run_eagerly)
 
