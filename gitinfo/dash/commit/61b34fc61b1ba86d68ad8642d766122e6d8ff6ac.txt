commit 61b34fc61b1ba86d68ad8642d766122e6d8ff6ac
Author: byron <byron@plot.ly>
Date:   Fri Oct 25 11:26:33 2019 -0400

    make it more flexible

diff --git a/dash/testing/browser.py b/dash/testing/browser.py
index 9d9cc3e3..73772ab1 100644
--- a/dash/testing/browser.py
+++ b/dash/testing/browser.py
@@ -100,7 +100,7 @@ class Browser(DashPageMixin):
         except percy.errors.Error:
             logger.exception("percy runner failed to finalize properly")
 
-    def percy_snapshot(self, name=""):
+    def percy_snapshot(self, name="", wait_for_callbacks=False):
         """percy_snapshot - visual test api shortcut to `percy_runner.snapshot`.
         It also combines the snapshot `name` with the python version.
         """
@@ -108,6 +108,8 @@ class Browser(DashPageMixin):
             name, sys.version_info.major, sys.version_info.minor
         )
         logger.info("taking snapshot name => %s", snapshot_name)
+        if wait_for_callbacks:
+            until(self._wait_for_callbacks, timeout=10)
         self.percy_runner.snapshot(name=snapshot_name)
 
     def take_snapshot(self, name):
@@ -498,7 +500,9 @@ class Browser(DashPageMixin):
             if entries:
                 self._last_ts = entries[-1]["timestamp"]
 
-    def visit_and_snapshot(self, resource_path, hook_id, assert_check=True):
+    def visit_and_snapshot(
+        self, resource_path, hook_id, wait_for_callbacks=True, assert_check=True
+    ):
         try:
             path = resource_path.lstrip("/")
             if path != resource_path:
@@ -507,13 +511,7 @@ class Browser(DashPageMixin):
 
             # wait for the hook_id to present and all callbacks get fired
             self.wait_for_element_by_id(hook_id)
-            until(
-                lambda: self.redux_state_rqs
-                and all((_["responseTime"] for _ in self.redux_state_rqs)),
-                timeout=10,
-            )
-
-            self.percy_snapshot(path)
+            self.percy_snapshot(path, wait_for_callbacks=wait_for_callbacks)
             if assert_check:
                 assert not self.driver.find_elements_by_css_selector(
                     "div.dash-debug-alert"
diff --git a/dash/testing/dash_page.py b/dash/testing/dash_page.py
index 62b3b95e..c63aea8e 100644
--- a/dash/testing/dash_page.py
+++ b/dash/testing/dash_page.py
@@ -1,4 +1,5 @@
 from bs4 import BeautifulSoup
+import dash.testing.wait as wait
 
 
 class DashPageMixin(object):
@@ -36,6 +37,17 @@ class DashPageMixin(object):
             "return window.store.getState().requestQueue"
         )
 
+    def _wait_for_callbacks(self):
+        if self.driver.execute_script(
+            "return window.store"
+        ) and self.driver.execute_script(
+            "return window.store.getState().requestQueue"
+        ):
+            return self.redux_state_rqs and all(
+                (_["responseTime"] for _ in self.redux_state_rqs)
+            )
+        return True
+
     def get_local_storage(self, store_id="local"):
         return self.driver.execute_script(
             "return JSON.parse(window.localStorage.getItem('{}'));".format(
