commit c3b40464d08536e6e128cb41a2a715254395bcb6
Author: Marc-Andr√© Rivet <Marc-Andre-Rivet@users.noreply.github.com>
Date:   Tue Jun 2 17:18:45 2020 -0400

    CI on forked repo and other tweaks (#1280)

diff --git a/.circleci/config.yml b/.circleci/config.yml
index 2802b519..1c314c36 100644
--- a/.circleci/config.yml
+++ b/.circleci/config.yml
@@ -230,8 +230,8 @@ jobs:
           command: |
             python -m venv venv
             . venv/bin/activate
-            git clone --depth 1 https://github.com/plotly/dash.git -b ${CIRCLE_BRANCH} dash-main
-            cd dash-main && pip install -e .[dev,testing] --progress-bar off && cd ..
+            npm ci
+            pip install --no-cache-dir --upgrade -e .[dev,testing] --progress-bar off
             git clone --depth 1 https://github.com/plotly/dashR.git -b dev dashR
             git clone --depth 1 https://github.com/plotly/dash-html-components.git
             git clone --depth 1 https://github.com/plotly/dash-core-components.git
@@ -303,8 +303,7 @@ jobs:
           command: |
             python -m venv venv
             . venv/bin/activate
-            cd dash-main/\@plotly/dash-generator-test-component-nested && npm ci && npm run build && sudo R CMD INSTALL . && cd ../../..
-            cd dash-main/\@plotly/dash-generator-test-component-standard && npm ci && npm run build && sudo R CMD INSTALL . && cd ../../..
+            npm run setup-tests.R
             export PATH=$PATH:/home/circleci/.local/bin/
             pytest --nopercyfinalize --junitxml=test-reports/dashr.xml dashR/tests/integration/dopsa/
       - store_artifacts:
diff --git a/package.json b/package.json
index b3a65097..97df5ce6 100644
--- a/package.json
+++ b/package.json
@@ -10,16 +10,21 @@
     "private::lint.pylint-dash": "PYLINTRC=${PYLINTRC:=.pylintrc37} && pylint dash setup.py --rcfile=$PYLINTRC",
     "private::lint.pylint-tests": "PYLINTRC=${PYLINTRC:=.pylintrc37} && pylint tests/unit tests/integration -d all --rcfile=$PYLINTRC",
     "private::lint.renderer": "cd dash-renderer && npm run lint",
-    "private::test.setup-nested": "cd \\@plotly/dash-generator-test-component-nested && npm ci && npm run build && pip install -e .",
-    "private::test.setup-standard": "cd \\@plotly/dash-generator-test-component-standard && npm ci && npm run build && pip install -e .",
+    "private::test.setup-nested": "cd \\@plotly/dash-generator-test-component-nested && npm ci && npm run build",
+    "private::test.setup-standard": "cd \\@plotly/dash-generator-test-component-standard && npm ci && npm run build",
+    "private::test.py.deploy-nested": "npm run private::test.setup-nested && cd \\@plotly/dash-generator-test-component-nested && pip install -e .",
+    "private::test.py.deploy-standard": "npm run private::test.setup-standard && cd \\@plotly/dash-generator-test-component-standard && pip install -e .",
+    "private::test.R.deploy-nested": "npm run private::test.setup-nested && cd \\@plotly/dash-generator-test-component-nested && sudo R CMD INSTALL .",
+    "private::test.R.deploy-standard": "npm run private::test.setup-standard && cd \\@plotly/dash-generator-test-component-standard && sudo R CMD INSTALL .",
     "private::test.unit-dash": "PYTHONPATH=~/dash/tests/assets pytest tests/unit",
     "private::test.unit-renderer": "cd dash-renderer && npm run test",
     "private::test.integration-dash": "TESTFILES=$(circleci tests glob \"tests/integration/**/test_*.py\" | circleci tests split --split-by=timings) && pytest --headless --nopercyfinalize --junitxml=test-reports/junit_intg.xml ${TESTFILES}",
     "format": "run-s private::format.*",
     "initialize": "run-s private::initialize.*",
     "lint": "run-s private::lint.*",
-    "setup-tests": "run-s private::test.setup-*",
-    "test.integration": "run-s setup-tests private::test.integration-*",
+    "setup-tests.py": "run-s private::test.py.deploy-*",
+    "setup-tests.R": "run-s private::test.R.deploy-*",
+    "test.integration": "run-s setup-tests.py private::test.integration-*",
     "test.unit": "run-s private::test.unit-**"
   },
   "devDependencies": {
