commit e029904faa1b6fef95d7fd77846ee5c88112e2b9
Author: alexcjohnson <alex@plot.ly>
Date:   Fri Jun 28 22:33:39 2019 -0400

    lint & simplify component_generator

diff --git a/dash/development/component_generator.py b/dash/development/component_generator.py
index 04286a1a..9c8abef3 100644
--- a/dash/development/component_generator.py
+++ b/dash/development/component_generator.py
@@ -2,7 +2,6 @@ from __future__ import print_function
 from collections import OrderedDict
 
 import json
-import yaml
 import sys
 import subprocess
 import shlex
@@ -12,6 +11,7 @@ import shutil
 import functools
 
 import pkg_resources
+import yaml
 
 from ._r_components_generation import write_class_file
 from ._r_components_generation import generate_exports
@@ -51,9 +51,6 @@ def generate_components(
 
     project_shortname = project_shortname.replace("-", "_").rstrip("/\\")
 
-    if rprefix is not None:
-        prefix = rprefix
-
     is_windows = sys.platform == "win32"
 
     yamldata = None
@@ -92,12 +89,7 @@ def generate_components(
         )
         sys.exit(1)
 
-    jsondata_unicode = json.loads(out.decode(), object_pairs_hook=OrderedDict)
-
-    if sys.version_info[0] >= 3:
-        metadata = jsondata_unicode
-    else:
-        metadata = byteify(jsondata_unicode)
+    metadata = safe_json_loads(out.decode())
 
     generator_methods = [generate_class_file]
 
@@ -106,15 +98,8 @@ def generate_components(
             os.makedirs('man')
         if not os.path.exists('R'):
             os.makedirs('R')
-        if os.path.isfile("dash-info.yaml"):
-            yamldata = open("dash-info.yaml")
-        else:
-            print(
-                "Warning: dash-info.yaml missing; package metadata not loaded",
-                file=sys.stderr
-            )
         generator_methods.append(
-            functools.partial(write_class_file, prefix=prefix))
+            functools.partial(write_class_file, prefix=rprefix))
 
     components = generate_classes_files(
         project_shortname,
@@ -128,29 +113,39 @@ def generate_components(
     generate_imports(project_shortname, components)
 
     if rprefix is not None:
-        with open('package.json', 'r') as f:
-            jsondata_unicode = json.load(f, object_pairs_hook=OrderedDict)
-            if yamldata is not None:
+        if os.path.isfile("dash-info.yaml"):
+            with open("dash-info.yaml") as yamldata:
                 rpkg_data = yaml.safe_load(yamldata)
-            else:
-                rpkg_data = None
-            if sys.version_info[0] >= 3:
-                pkg_data = jsondata_unicode
-            else:
-                pkg_data = byteify(jsondata_unicode)
+        else:
+            rpkg_data = None
+            print(
+                "Warning: dash-info.yaml missing; package metadata not loaded",
+                file=sys.stderr
+            )
+
+        with open('package.json', 'r') as f:
+            pkg_data = safe_json_loads(f.read())
+
         generate_exports(
             project_shortname,
             components,
             metadata,
             pkg_data,
             rpkg_data,
-            prefix,
+            rprefix,
             rdepends,
             rimports,
             rsuggests,
         )
 
 
+def safe_json_loads(s):
+    jsondata_unicode = json.loads(s, object_pairs_hook=OrderedDict)
+    if sys.version_info[0] >= 3:
+        return jsondata_unicode
+    return byteify(jsondata_unicode)
+
+
 def cli():
     parser = argparse.ArgumentParser(
         prog="dash-generate-components",
diff --git a/requires-ci.txt b/requires-ci.txt
index 7533eca4..fec63ac1 100644
--- a/requires-ci.txt
+++ b/requires-ci.txt
@@ -3,7 +3,8 @@ dash-dangerously-set-inner-html
 six
 mock
 flake8
+PyYAML>=5.1.1
 pylint==1.9.4;python_version<"3.7"
 pylint==2.3.1;python_version=="3.7"
 astroid==2.2.5;python_version=="3.7"
-virtualenv;python_version=="2.7"
\ No newline at end of file
+virtualenv;python_version=="2.7"
