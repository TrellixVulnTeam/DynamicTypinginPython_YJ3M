commit 74ee80ce523d9b64b466bac502fd01c6fcf8a868
Author: Chris P <christopher.parmer@gmail.com>
Date:   Thu Apr 9 23:51:54 2015 -0400

    updates

diff --git a/gapminder/DataBackend.py b/gapminder/DataBackend.py
index 8c926728..c6c23e8d 100644
--- a/gapminder/DataBackend.py
+++ b/gapminder/DataBackend.py
@@ -8,35 +8,33 @@ class Graph():
                               'examples/gapminder/data/'
                               'gapminderDataFiveYear.txt', sep='\t')
         self.country = 'United States'
-        self.xaxis = 'gdpPercap'
-        self.yaxis = 'lifeExp'
-        self.size = 'pop'
+        self.yaxis = 'pop'
 
     def on_page_load(self):
         pass
 
-    def on_pong(self):
+    def on_pong(self, message):
         print('on_pong')
         messages = []
-
-        messages.extend(self.replot({'slider': 1952}))
-        messages.extend(self.replot({'select': True, 'yaxis': self.yaxis}))
+        messages.extend(self.replot(message))
         return messages
 
     def replot(self, app_state):
-        self.yaxis = app_state['yaxis']
         self.xaxis = app_state['xaxis']
+        self.yaxis = app_state['yaxis']
         self.size = app_state['size']
 
-        if 'click' in app_state:
-            curveNumber = app_state['click']['points'][0]['curveNumber']
-            pointNumber = app_state['click']['points'][0]['pointNumber']
-            text = self.on_slide(app_state)[0]['data'][curveNumber]['text']
-            self.country = text.get_value(text.index[pointNumber])
+        labels = {
+            'pop': 'Population',
+            'lifeExp': 'Life Expectancy',
+            'gdpPercap': 'GDP per Capita'
+        }
 
         dfi = self.df[(self.df['year'] == app_state['slider']) &
                       (self.df['country'] != 'Kuwait')]
+
         traces = []
+
         for c in dfi['continent'].unique():
             dfc = dfi[dfi['continent'] == c]
             traces.append({
@@ -56,7 +54,7 @@ class Graph():
             'data': traces,
             'layout': {
                 'xaxis': {
-                    'title': 'GDP per Capita',
+                    'title': labels[self.xaxis],
                     'type': 'log',
                     'autorange': False,
                     'range': np.log10([(
@@ -64,7 +62,7 @@ class Graph():
                         max(self.df[self.xaxis])*1.1])
                 },
                 'yaxis': {
-                    'title': 'Life Expectancy',
+                    'title': labels[self.yaxis],
                     'autorange': False,
                     'range': [
                         min(self.df[self.yaxis])*0.8,
@@ -97,12 +95,16 @@ class Graph():
             }
         ]
 
+
+        if 'click' in app_state:
+            curveNumber = app_state['click']['points'][0]['curveNumber']
+            pointNumber = app_state['click']['points'][0]['pointNumber']
+            text = self.on_slide(app_state)[0]['data'][curveNumber]['text']
+            self.country = text.get_value(text.index[pointNumber])
+
+
         dfi = self.df[self.df['country'] == self.country]
-        labels = {
-            'pop': 'Population',
-            'lifeExp': 'Life Expectancy',
-            'gdpPercap': 'GDP per Capita'
-        }
+
         fig = {
             'data': [
                 {
@@ -131,6 +133,7 @@ class Graph():
                 ]
             }
         }
+
         messages.extend([
             {
                 'id': 'line',
diff --git a/gapminder/app.py b/gapminder/app.py
index 49d34d59..091e5cd7 100644
--- a/gapminder/app.py
+++ b/gapminder/app.py
@@ -50,7 +50,7 @@ def replot(message):
 @socketio.on('pong')
 def on_pong(message):
     app.logger.info('on_pong: {}'.format(message))
-    messages = graph.on_pong()
+    messages = graph.on_pong(message)
     jmessages = replace_nan(json.dumps(messages,
                                        cls=plotly.utils.PlotlyJSONEncoder))
     emit('postMessage', jmessages)
diff --git a/gapminder/templates/index.html b/gapminder/templates/index.html
index a9b6d072..29b3c2c2 100644
--- a/gapminder/templates/index.html
+++ b/gapminder/templates/index.html
@@ -60,7 +60,7 @@
                             margin-left: 20px;
                             margin-top: 28px;
                             display: inline-block;">
-                    Drilling Down with Sliders, Click Events, and Dropdown
+                    Drilling Down with Sliders, Click Events, and Dropdowns
                 </div>
                 <div style="height: 100%;
                             display: inline-block;
@@ -93,24 +93,26 @@
                     </iframe>
                     <form class="pure-form" style="float: right;">
                         <fieldset>
+                            <label>X Data</label>
                             <select id="xaxis">
                                 <option value="pop">Population</option>
                                 <option value="lifeExp">Life Expectancy</option>
-                                <option value="gdpPercap">GDP per Capita</option>
+                                <option selected="selected" value="gdpPercap">GDP per Capita</option>
                             </select>
 
+                            <label>Y Data</label>
                             <select id="yaxis">
                                 <option value="pop">Population</option>
-                                <option value="lifeExp">Life Expectancy</option>
+                                <option selected="selected" value="lifeExp">Life Expectancy</option>
                                 <option value="gdpPercap">GDP per Capita</option>
                             </select>
 
+                            <label>Size</label>
                             <select id="size">
-                                <option value="pop">Population</option>
+                                <option selected="selected" value="pop">Population</option>
                                 <option value="lifeExp">Life Expectancy</option>
                                 <option value="gdpPercap">GDP per Capita</option>
                             </select>
-
                         </fieldset>
                     </form>
                 </div>
@@ -188,7 +190,9 @@
                         'task': 'listen',
                         'events': ['click']
                     }, 'https://plot.ly');
-                    socket.emit('pong', {id: id});
+                    var payload = getState();
+                    payload[id] = id;
+                    socket.emit('pong', payload);
                 } else if (message.type==='hover' ||
                             message.type==='zoom'  ||
                             message.type==='click') {
@@ -205,21 +209,25 @@
             //
             // JQuery UI
             //
-            function sendState(that, payload){
+            function getState() {
                 var payload = payload || {};
 
                 payload.slider = $('#slider').slider("value");
-                payload.yaxis = $('#yaxis option:selected').val();
                 payload.xaxis = $('#xaxis option:selected').val();
+                payload.yaxis = $('#yaxis option:selected').val();
                 payload.size = $('#size option:selected').val();
+                return payload;
+            }
 
+            function sendState(that, payload){
+                payload = getState();
                 socket.emit('replot', payload)
             }
             $('#slider').on('slide', function(){console.log('change'); sendState({},{'slide': true});});
-            $('#yaxis').change(function(){
+            $('#xaxis').change(function(){
                 sendState({}, {'select': true})
             });
-            $('#xaxis').change(function(){
+            $('#yaxis').change(function(){
                 sendState({}, {'select': true})
             });
             $('#size').change(function(){
