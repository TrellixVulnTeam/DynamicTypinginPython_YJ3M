commit 736469dc11f455831115c66bc225a6ca428a154c
Author: chriddyp <chris@plot.ly>
Date:   Tue Apr 18 12:30:52 2017 -0400

    move the `_setup_server` routes to the `before_first_request` hook

diff --git a/dash/dash.py b/dash/dash.py
index 0931422d..447b6d6c 100644
--- a/dash/dash.py
+++ b/dash/dash.py
@@ -120,6 +120,8 @@ class Dash(object):
             endpoint='{}_{}'.format(url_namespace, 'index'),
             view_func=self.index)
 
+        self.server.before_first_request(self._setup_server)
+
         self._layout = None
         self.routes = []
 
@@ -563,8 +565,4 @@ class Dash(object):
                    debug=True,
                    threaded=True,
                    **flask_run_options):
-        # TODO - If users run the server directly
-        # through app.server, then this _setup_server won't get
-        # called unless they call it explicitly
-        self._setup_server()
         self.server.run(port=port, debug=debug, **flask_run_options)
