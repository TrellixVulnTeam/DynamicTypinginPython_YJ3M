commit f13f7ebfa6d79b5006305a7dd8e1a65b2b8d152a
Author: chriddyp <chris@plot.ly>
Date:   Tue Apr 25 23:53:05 2017 -0400

    try a different `appveyor.yml`

diff --git a/appveyor.yml b/appveyor.yml
index 5fa81078..f702df24 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -1,42 +1,47 @@
-# From https://github.com/cloudify-cosmo/appveyor-utils, recommended by
-# http://help.appveyor.com/discussions/questions/1548-a-configuration-file-for-tox
-environment:
-  # SDK v7.0 MSVC Express 2008's SetEnv.cmd script will fail if the
-  # /E:ON and /V:ON options are not enabled in the batch script intepreter
-  # See: http://stackoverflow.com/a/13751649/163740
-  CMD_IN_ENV: "cmd /E:ON /V:ON /C .\\appveyor\\run_with_env.cmd"
-  TOX_ENV: "pywin"
+# Adapted from
+# https://github.com/PyCQA/pyflakes/blob/master/.appveyor.yml
 
+environment:
   nodejs_version: "6.9.2"
 
-  matrix:
-    - PYTHON: "C:\\Python27"
-      PYTHON_VERSION: "2.7.8"
-      PYTHON_ARCH: "32"
-
-    - PYTHON: "C:\\Python27-x64"
-      PYTHON_VERSION: "2.7.8"
-      PYTHON_ARCH: "64"
-
-  NODE_ENV: production
 
+# To activate, change the Appveyor settings to use `.appveyor.yml`.
 install:
-  # Download setup scripts and unzip
-  - ps: "wget https://github.com/cloudify-cosmo/appveyor-utils/archive/master.zip -OutFile ./master.zip"
-  - "7z e master.zip */appveyor/* -oappveyor"
-
-  # Install Python (from the official .msi of http://python.org) and pip when
-  # not already installed.
-  - "powershell ./appveyor/install.ps1"
-
-  # Prepend newly installed Python to the PATH of this build (this cannot be
-  # done from inside the powershell script as it would require to restart
-  # the parent CMD process).
-  - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
-
-  # Check that we have the expected version and architecture for Python
-  - "python --version"
-  - "python -c \"import struct; print(struct.calcsize('P') * 8)\""
+  - python -m pip install -r dev-requirements.txt
+
+  # Fetch the three main PyPy releases
+  - ps: (New-Object Net.WebClient).DownloadFile('https://bitbucket.org/pypy/pypy/downloads/pypy-2.6.1-win32.zip', "$env:appveyor_build_folder\pypy-2.6.1-win32.zip")
+  - ps: 7z x pypy-2.6.1-win32.zip | Out-Null
+  - move pypy-2.6.1-win32 C:\
+
+  - ps: (New-Object Net.WebClient).DownloadFile('https://bitbucket.org/pypy/pypy/downloads/pypy2-v5.3.1-win32.zip', "$env:appveyor_build_folder\pypy2-v5.3.1-win32.zip")
+  - ps: 7z x pypy2-v5.3.1-win32.zip | Out-Null
+  - move pypy2-v5.3.1-win32 C:\
+
+  - ps: (New-Object Net.WebClient).DownloadFile('https://bitbucket.org/pypy/pypy/downloads/pypy3-2.4.0-win32.zip', "$env:appveyor_build_folder\pypy3-2.4.0-win32.zip")
+  - ps: 7z x pypy3-2.4.0-win32.zip | Out-Null
+  - move pypy3-2.4.0-win32 C:\
+
+  # pypy3 installer provides 'pypy.exe', not pypy3.exe.
+  - copy C:\pypy3-2.4.0-win32\pypy.exe C:\pypy3-2.4.0-win32\pypy3.exe
+
+  # workaround https://github.com/pypa/virtualenv/issues/93
+  - mkdir C:\python33\tcl\tcl8.6
+  - mkdir C:\python33\tcl\tk8.6
+  - mkdir C:\pypy3-2.4.0-win32\tcl\tcl8.6
+  - mkdir C:\pypy3-2.4.0-win32\tcl\tk8.6
+
+  # Only pypy2-5.3.1 is integrated into tox, as pypy3-2.4.0 fails and
+  # a Windows distribution of pypy3-5.2 isnt available yet.
+  - ps: $env:path = "$env:path;C:\pypy2-v5.3.1-win32"
+
+  # pypy3-2.4.0 and pypy-2.6.1 are manually bootstrapped and tested
+  - ps: (New-Object Net.WebClient).DownloadFile('https://bootstrap.pypa.io/get-pip.py', "$env:appveyor_build_folder\get-pip.py")
+  # errors are ignored due to https://github.com/pypa/pip/issues/2669#issuecomment-136405390
+  # NOTE: If and when a new version of PyPy3 is released for Windows that
+  #       supports anything newer than Python 3.2, remove the setuptools pin.
+  - ps: C:\pypy3-2.4.0-win32\pypy3 "$env:appveyor_build_folder\get-pip.py"; C:\pypy3-2.4.0-win32\pypy3 -m pip install -U --force-reinstall pip==8.1.2 "setuptools<30"; echo "ignore error"
+  - ps: C:\pypy-2.6.1-win32\pypy "$env:appveyor_build_folder\get-pip.py"
 
   # Get the latest stable version of Node.js or io.js
   - ps: Install-Product node $env:nodejs_version
@@ -47,13 +52,10 @@ install:
 
 build: off
 
-before_test:
-  - "%CMD_IN_ENV% pip install tox"
-
 test_script:
-  - "%CMD_IN_ENV% tox -e %TOX_ENV%"
+  - python -m tox
 
-  # Node
-  - node --version
-  - npm --version
-  - npm run test
+    # Node
+    - node --version
+    - npm --version
+    - npm run test
