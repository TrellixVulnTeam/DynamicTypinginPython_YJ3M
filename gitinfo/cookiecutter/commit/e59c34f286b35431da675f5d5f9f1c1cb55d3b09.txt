commit e59c34f286b35431da675f5d5f9f1c1cb55d3b09
Author: Sorin Sbarnea <ssbarnea@users.noreply.github.com>
Date:   Sun Jul 28 16:57:05 2019 +0100

    Generalize linter calling via pre-commit (#1195)
    
    * enable chaining multiple linters via pre-commit tool.
    * fixes several trailing newlines
    * removes few incorrect +x modes on files
    * adds few extra checks
    * renames flake8 tox environment to 'lint' to avoid confusions
    * fixes docs/conf.py style so we do not need more flake8 excludes

diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml
new file mode 100644
index 0000000..a34c065
--- /dev/null
+++ b/.pre-commit-config.yaml
@@ -0,0 +1,16 @@
+---
+repos:
+  - repo: https://github.com/pre-commit/pre-commit-hooks
+    rev: v2.2.3
+    hooks:
+      - id: trailing-whitespace
+      - id: mixed-line-ending
+      - id: check-byte-order-marker
+      - id: check-executables-have-shebangs
+      - id: check-merge-conflict
+  - repo: https://gitlab.com/pycqa/flake8
+    rev: 3.7.8
+    hooks:
+      - id: flake8
+        additional_dependencies:
+          - flake8-black
diff --git a/.travis.yml b/.travis.yml
index 6278f4b..3e6d7b2 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -5,6 +5,8 @@ language: python
 
 matrix:
     include:
+      - python: 3.7
+        env: TOXENV=lint
       - python: 2.7
         env: TOXENV=py27
       - python: 3.5
@@ -15,8 +17,6 @@ matrix:
         env: TOXENV=py37
       - python: pypy
         env: TOXENV=pypy
-      - python: 3.5
-        env: TOXENV=flake8
 
 script: tox
 
diff --git a/CONTRIBUTING.rst b/CONTRIBUTING.rst
index 71923fc..00fee95 100644
--- a/CONTRIBUTING.rst
+++ b/CONTRIBUTING.rst
@@ -3,7 +3,7 @@ Contributing
 ============
 
 Contributions are welcome, and they are greatly appreciated! Every
-little bit helps, and credit will always be given. 
+little bit helps, and credit will always be given.
 
 .. toctree::
    :numbered:
@@ -155,7 +155,7 @@ Before you submit a pull request, check that it meets these guidelines:
    feature to the list in README.rst.
 3. The pull request should work for Python 2.7, 3.5, 3.6, 3.7, and PyPy on
    AppVeyor and Travis CI.
-4. Check https://travis-ci.org/audreyr/cookiecutter/pull_requests and 
+4. Check https://travis-ci.org/audreyr/cookiecutter/pull_requests and
    https://ci.appveyor.com/project/audreyr/cookiecutter/history to ensure the tests pass for all supported Python versions and platforms.
 
 Coding Standards
@@ -381,8 +381,8 @@ When you're processing the first change after a release, create boilerplate foll
 
     Other changes:
 
-    * Description of the change, thanks to @contributor (#PR). 
-                      
+    * Description of the change, thanks to @contributor (#PR).
+
     .. _`@contributor`: https://github.com/contributor
 
 Process: Accepting Template Pull Requests
diff --git a/README.rst b/README.rst
index a6e3fc6..e2e46ef 100644
--- a/README.rst
+++ b/README.rst
@@ -279,7 +279,7 @@ Support This Project
 --------------------
 
 This project is run by volunteers. Shortly we will be providing means for organizations
-and individuals to support the project. 
+and individuals to support the project.
 
 Code of Conduct
 ---------------
diff --git a/case_studies.rst b/case_studies.rst
index 0c699b7..ec8edc4 100644
--- a/case_studies.rst
+++ b/case_studies.rst
@@ -35,7 +35,7 @@ OpenStack uses several Cookiecutter templates to generate:
 * `New tempest plugins`_
 
 OpenStack_ is open source software for creating private and public clouds.
-  
+
 .. _OpenStack: http://www.openstack.org/
 .. _`OpenStack compliant puppet-modules`: https://github.com/openstack/puppet-openstack-cookiecutter
 .. _`Install guides`: https://github.com/openstack/installguide-cookiecutter
diff --git a/docs/conf.py b/docs/conf.py
index 2f0d527..17eeaa9 100644
--- a/docs/conf.py
+++ b/docs/conf.py
@@ -3,7 +3,8 @@
 # cookiecutter documentation build configuration file, created by
 # sphinx-quickstart on Thu Jul 11 11:31:49 2013.
 #
-# This file is execfile()d with the current directory set to its containing dir.
+# This file is execfile()d with the current directory set to its containing
+# dir.
 #
 # Note that not all possible configuration values are present in this
 # autogenerated file.
@@ -11,18 +12,18 @@
 # All configuration values have a default; values that are commented out
 # serve to show the default.
 
-import sys, os
+import os
+import sys
 
 # If extensions (or modules to document with autodoc) are in another directory,
 # add these directories to sys.path here. If the directory is relative to the
 # documentation root, use os.path.abspath to make it absolute, like shown here.
-#sys.path.insert(0, os.path.abspath('.'))
+# sys.path.insert(0, os.path.abspath('.'))
 
 # For building docs in foreign environments where we don't have all our
 # dependencies (like readthedocs), mock out imports that cause sphinx to fail.
-# see: https://docs.readthedocs.io/en/latest/faq.html#i-get-import-errors-on-libraries-that-depend-on-c-modules
+# see: https://docs.readthedocs.io/en/latest/faq.html#i-get-import-errors-on-libraries-that-depend-on-c-modules  # noqa
 
-import sys
 
 class Mock(object):
     def __init__(self, *args, **kwargs):
@@ -42,6 +43,7 @@ class Mock(object):
         else:
             return Mock()
 
+
 MOCK_MODULES = ['yaml']
 for mod_name in MOCK_MODULES:
     sys.modules[mod_name] = Mock()
@@ -52,18 +54,19 @@ cwd = os.getcwd()
 parent = os.path.dirname(cwd)
 sys.path.append(parent)
 
-import cookiecutter
+import cookiecutter  # noqa 402
 
-# -- General configuration -----------------------------------------------------
+# -- General configuration ----------------------------------------------------
 
 # If your documentation needs a minimal Sphinx version, state it here.
-#needs_sphinx = '1.0'
+# needs_sphinx = '1.0'
 
-# Add any Sphinx extension module names here, as strings. They can be extensions
-# coming with Sphinx (named 'sphinx.ext.*') or your custom ones.
-extensions = ['sphinx.ext.autodoc', 'sphinx.ext.doctest', 'sphinx.ext.intersphinx',
-              'sphinx.ext.todo', 'sphinx.ext.coverage', 'sphinx.ext.imgmath',
-              'sphinx.ext.ifconfig', 'sphinx.ext.viewcode', 'docs.ccext']
+# Add any Sphinx extension module names here, as strings. They can be
+# extensions coming with Sphinx (named 'sphinx.ext.*') or your custom ones.
+extensions = [
+    'sphinx.ext.autodoc', 'sphinx.ext.doctest', 'sphinx.ext.intersphinx',
+    'sphinx.ext.todo', 'sphinx.ext.coverage', 'sphinx.ext.imgmath',
+    'sphinx.ext.ifconfig', 'sphinx.ext.viewcode', 'docs.ccext']
 
 # Add any paths that contain templates here, relative to this directory.
 templates_path = ['_templates']
@@ -72,7 +75,7 @@ templates_path = ['_templates']
 source_suffix = '.rst'
 
 # The encoding of source files.
-#source_encoding = 'utf-8-sig'
+# source_encoding = 'utf-8-sig'
 
 # The master toctree document.
 master_doc = 'index'
@@ -92,45 +95,45 @@ release = cookiecutter.__version__
 
 # The language for content autogenerated by Sphinx. Refer to documentation
 # for a list of supported languages.
-#language = None
+# language = None
 
 # There are two options for replacing |today|: either, you set today to some
 # non-false value, then it is used:
-#today = ''
+# today = ''
 # Else, today_fmt is used as the format for a strftime call.
-#today_fmt = '%B %d, %Y'
+# today_fmt = '%B %d, %Y'
 
 # List of patterns, relative to source directory, that match files and
 # directories to ignore when looking for source files.
 exclude_patterns = ['_build']
 
-# The reST default role (used for this markup: `text`) to use for all documents.
-#default_role = None
+# The reST default role (used for this markup: `text`) to use for all documents
+# default_role = None
 
 # If true, '()' will be appended to :func: etc. cross-reference text.
-#add_function_parentheses = True
+# add_function_parentheses = True
 
 # If true, the current module name will be prepended to all description
 # unit titles (such as .. function::).
-#add_module_names = True
+# add_module_names = True
 
 # If true, sectionauthor and moduleauthor directives will be shown in the
 # output. They are ignored by default.
-#show_authors = False
+# show_authors = False
 
 # The name of the Pygments (syntax highlighting) style to use.
 pygments_style = 'sphinx'
 
 # A list of ignored prefixes for module index sorting.
-#modindex_common_prefix = []
+# modindex_common_prefix = []
 
 # If true, keep warnings as "system message" paragraphs in the built documents.
-#keep_warnings = False
+# keep_warnings = False
 
 # Suppress nonlocal image warnings
 suppress_warnings = ['image.nonlocal_uri']
 
-# -- Options for HTML output ---------------------------------------------------
+# -- Options for HTML output --------------------------------------------------
 
 # The theme to use for HTML and HTML Help pages.  See the documentation for
 # a list of builtin themes.
@@ -139,26 +142,26 @@ html_theme = 'sphinx_rtd_theme'
 # Theme options are theme-specific and customize the look and feel of a theme
 # further.  For a list of options available for each theme, see the
 # documentation.
-#html_theme_options = {}
+# html_theme_options = {}
 
 # Add any paths that contain custom themes here, relative to this directory.
-#html_theme_path = []
+# html_theme_path = []
 
 # The name for this set of Sphinx documents.  If None, it defaults to
 # "<project> v<release> documentation".
-#html_title = None
+# html_title = None
 
 # A shorter title for the navigation bar.  Default is the same as html_title.
-#html_short_title = None
+# html_short_title = None
 
 # The name of an image file (relative to this directory) to place at the top
 # of the sidebar.
-#html_logo = None
+# html_logo = None
 
 # The name of an image file (within the static path) to use as favicon of the
 # docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32
 # pixels large.
-#html_favicon = None
+# html_favicon = None
 
 # Add any paths that contain custom static files (such as style sheets) here,
 # relative to this directory. They are copied after the builtin static files,
@@ -167,91 +170,91 @@ html_static_path = []
 
 # If not '', a 'Last updated on:' timestamp is inserted at every page bottom,
 # using the given strftime format.
-#html_last_updated_fmt = '%b %d, %Y'
+# html_last_updated_fmt = '%b %d, %Y'
 
 # If true, SmartyPants will be used to convert quotes and dashes to
 # typographically correct entities.
-#html_use_smartypants = True
+# html_use_smartypants = True
 
 # Custom sidebar templates, maps document names to template names.
-#html_sidebars = {}
+# html_sidebars = {}
 
 # Additional templates that should be rendered to pages, maps page names to
 # template names.
-#html_additional_pages = {}
+# html_additional_pages = {}
 
 # If false, no module index is generated.
-#html_domain_indices = True
+# html_domain_indices = True
 
 # If false, no index is generated.
-#html_use_index = True
+# html_use_index = True
 
 # If true, the index is split into individual pages for each letter.
-#html_split_index = False
+# html_split_index = False
 
 # If true, links to the reST sources are added to the pages.
-#html_show_sourcelink = True
+# html_show_sourcelink = True
 
 # If true, "Created using Sphinx" is shown in the HTML footer. Default is True.
-#html_show_sphinx = True
+# html_show_sphinx = True
 
 # If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.
-#html_show_copyright = True
+# html_show_copyright = True
 
 # If true, an OpenSearch description file will be output, and all pages will
 # contain a <link> tag referring to it.  The value of this option must be the
 # base URL from which the finished HTML is served.
-#html_use_opensearch = ''
+# html_use_opensearch = ''
 
 # This is the file name suffix for HTML files (e.g. ".xhtml").
-#html_file_suffix = None
+# html_file_suffix = None
 
 # Output file base name for HTML help builder.
 htmlhelp_basename = 'cookiecutterdoc'
 
 
-# -- Options for LaTeX output --------------------------------------------------
+# -- Options for LaTeX output -------------------------------------------------
 
 latex_elements = {
-# The paper size ('letterpaper' or 'a4paper').
-#'papersize': 'letterpaper',
+    # The paper size ('letterpaper' or 'a4paper').
+    # 'papersize': 'letterpaper',
 
-# The font size ('10pt', '11pt' or '12pt').
-#'pointsize': '10pt',
+    # The font size ('10pt', '11pt' or '12pt').
+    # 'pointsize': '10pt',
 
-# Additional stuff for the LaTeX preamble.
-#'preamble': '',
+    # Additional stuff for the LaTeX preamble.
+    # 'preamble': '',
 }
 
 # Grouping the document tree into LaTeX files. List of tuples
-# (source start file, target name, title, author, documentclass [howto/manual]).
+# (source start file, target name, title, author, documentclass [howto/manual])
 latex_documents = [
-  ('index', 'cookiecutter.tex', u'cookiecutter Documentation',
-   u'Audrey Roy', 'manual'),
+    ('index', 'cookiecutter.tex', u'cookiecutter Documentation',
+     u'Audrey Roy', 'manual'),
 ]
 
 # The name of an image file (relative to this directory) to place at the top of
 # the title page.
-#latex_logo = None
+# latex_logo = None
 
 # For "manual" documents, if this is true, then toplevel headings are parts,
 # not chapters.
-#latex_use_parts = False
+# latex_use_parts = False
 
 # If true, show page references after internal links.
-#latex_show_pagerefs = False
+# latex_show_pagerefs = False
 
 # If true, show URL addresses after external links.
-#latex_show_urls = False
+# latex_show_urls = False
 
 # Documents to append as an appendix to all manuals.
-#latex_appendices = []
+# latex_appendices = []
 
 # If false, no module index is generated.
-#latex_domain_indices = True
+# latex_domain_indices = True
 
 
-# -- Options for manual page output --------------------------------------------
+# -- Options for manual page output -------------------------------------------
 
 # One entry per manual page. List of tuples
 # (source start file, name, description, authors, manual section).
@@ -261,34 +264,34 @@ man_pages = [
 ]
 
 # If true, show URL addresses after external links.
-#man_show_urls = False
+# man_show_urls = False
 
 
-# -- Options for Texinfo output ------------------------------------------------
+# -- Options for Texinfo output -----------------------------------------------
 
 # Grouping the document tree into Texinfo files. List of tuples
 # (source start file, target name, title, author,
 #  dir menu entry, description, category)
 texinfo_documents = [
-  ('index', 'cookiecutter', u'cookiecutter Documentation',
-   u'Audrey Roy', 'cookiecutter', 'One line description of project.',
-   'Miscellaneous'),
+    ('index', 'cookiecutter', u'cookiecutter Documentation',
+     u'Audrey Roy', 'cookiecutter', 'One line description of project.',
+     'Miscellaneous'),
 ]
 
 # Documents to append as an appendix to all manuals.
-#texinfo_appendices = []
+# texinfo_appendices = []
 
 # If false, no module index is generated.
-#texinfo_domain_indices = True
+# texinfo_domain_indices = True
 
 # How to display URL addresses: 'footnote', 'no', or 'inline'.
-#texinfo_show_urls = 'footnote'
+# texinfo_show_urls = 'footnote'
 
 # If true, do not generate a @detailmenu in the "Top" node's menu.
-#texinfo_no_detailmenu = False
+# texinfo_no_detailmenu = False
 
 
-# -- Options for Epub output ---------------------------------------------------
+# -- Options for Epub output --------------------------------------------------
 
 # Bibliographic Dublin Core info.
 epub_title = u'cookiecutter'
@@ -298,52 +301,52 @@ epub_copyright = u'2013-2016, Audrey Roy'
 
 # The language of the text. It defaults to the language option
 # or en if the language is not set.
-#epub_language = ''
+# epub_language = ''
 
 # The scheme of the identifier. Typical schemes are ISBN or URL.
-#epub_scheme = ''
+# epub_scheme = ''
 
 # The unique identifier of the text. This can be a ISBN number
 # or the project homepage.
-#epub_identifier = ''
+# epub_identifier = ''
 
 # A unique identification for the text.
-#epub_uid = ''
+# epub_uid = ''
 
 # A tuple containing the cover image and cover page html template filenames.
-#epub_cover = ()
+# epub_cover = ()
 
 # A sequence of (type, uri, title) tuples for the guide element of content.opf.
-#epub_guide = ()
+# epub_guide = ()
 
 # HTML files that should be inserted before the pages created by sphinx.
 # The format is a list of tuples containing the path and title.
-#epub_pre_files = []
+# epub_pre_files = []
 
 # HTML files shat should be inserted after the pages created by sphinx.
 # The format is a list of tuples containing the path and title.
-#epub_post_files = []
+# epub_post_files = []
 
 # A list of files that should not be packed into the epub file.
-#epub_exclude_files = []
+# epub_exclude_files = []
 
 # The depth of the table of contents in toc.ncx.
-#epub_tocdepth = 3
+# epub_tocdepth = 3
 
 # Allow duplicate toc entries.
-#epub_tocdup = True
+# epub_tocdup = True
 
 # Fix unsupported image types using the PIL.
-#epub_fix_images = False
+# epub_fix_images = False
 
 # Scale large images.
-#epub_max_image_width = 0
+# epub_max_image_width = 0
 
 # If 'no', URL addresses will not be shown.
-#epub_show_urls = 'inline'
+# epub_show_urls = 'inline'
 
 # If false, no index is generated.
-#epub_use_index = True
+# epub_use_index = True
 
 
 # Example configuration for intersphinx: refer to the Python standard library.
diff --git a/docs/contributing.rst b/docs/contributing.rst
index 2e7b6d1..20a1918 100644
--- a/docs/contributing.rst
+++ b/docs/contributing.rst
@@ -3,7 +3,7 @@ Contributing
 ============
 
 Contributions are welcome, and they are greatly appreciated! Every
-little bit helps, and credit will always be given. 
+little bit helps, and credit will always be given.
 
 .. toctree::
    :numbered:
diff --git a/docs/contributor_guidelines.rst b/docs/contributor_guidelines.rst
index 527ff8e..f08c234 100644
--- a/docs/contributor_guidelines.rst
+++ b/docs/contributor_guidelines.rst
@@ -12,7 +12,7 @@ Before you submit a pull request, check that it meets these guidelines:
    feature to the list in README.rst.
 3. The pull request should work for Python 2.7, 3.5, 3.6, 3.7, and PyPy on
    Appveyor and Travis CI.
-4. Check https://travis-ci.org/audreyr/cookiecutter/pull_requests and 
+4. Check https://travis-ci.org/audreyr/cookiecutter/pull_requests and
    https://ci.appveyor.com/project/audreyr/cookiecutter/history to ensure the tests pass for all supported Python versions and platforms.
 
 Coding Standards
diff --git a/docs/core_committer_guide.rst b/docs/core_committer_guide.rst
index 389a091..e091858 100644
--- a/docs/core_committer_guide.rst
+++ b/docs/core_committer_guide.rst
@@ -151,8 +151,8 @@ When you're processing the first change after a release, create boilerplate foll
 
     Other changes:
 
-    * Description of the change, thanks to @contributor (#PR). 
-                      
+    * Description of the change, thanks to @contributor (#PR).
+
     .. _`@contributor`: https://github.com/contributor
 
 Process: Accepting Template Pull Requests
diff --git a/docs/sprint-contributors.rst b/docs/sprint-contributors.rst
index 654889b..1a8419f 100644
--- a/docs/sprint-contributors.rst
+++ b/docs/sprint-contributors.rst
@@ -6,8 +6,8 @@ PyCon 2016 Sprint
 -----------------
 
 The following people made contributions to the cookiecutter project
-at the PyCon sprints in Portland, OR from June 2-5 2016. 
-Contributions include user testing, debugging, improving documentation, 
+at the PyCon sprints in Portland, OR from June 2-5 2016.
+Contributions include user testing, debugging, improving documentation,
 reviewing issues, writing tutorials, creating and updating project
 templates, and teaching each other.
 
diff --git a/docs/tutorial1.rst b/docs/tutorial1.rst
index 7d79631..2659db8 100644
--- a/docs/tutorial1.rst
+++ b/docs/tutorial1.rst
@@ -108,7 +108,7 @@ Find the directory called `{{ cookiecutter.project_slug }}`. Click on it. Observ
 the files inside of it. You should see that this directory and its contents
 corresponds to the project that you just generated.
 
-This happens in `find.py`, where the `find_template()` method looks for the first jinja-like directory name that starts with `cookiecutter`. 
+This happens in `find.py`, where the `find_template()` method looks for the first jinja-like directory name that starts with `cookiecutter`.
 
 AUTHORS.rst
 ~~~~~~~~~~~
diff --git a/setup.cfg b/setup.cfg
index 83901b4..2dbd45b 100644
--- a/setup.cfg
+++ b/setup.cfg
@@ -9,7 +9,8 @@ tag_name = {new_version}
 [bumpversion:file:cookiecutter/__init__.py]
 
 [flake8]
-ignore = E731
+# BLK100 excluded temporary until we enable python black
+ignore = E731,BLK100
 
 [bdist_wheel]
 universal = 1
diff --git a/tests/fake-repo-tmpl/cookiecutter.json b/tests/fake-repo-tmpl/cookiecutter.json
old mode 100755
new mode 100644
diff --git a/tests/fake-repo-tmpl/{{cookiecutter.repo_name}}/README.rst b/tests/fake-repo-tmpl/{{cookiecutter.repo_name}}/README.rst
old mode 100755
new mode 100644
diff --git a/tests/test_generate_context.py b/tests/test_generate_context.py
index 35a601c..79dbbda 100644
--- a/tests/test_generate_context.py
+++ b/tests/test_generate_context.py
@@ -87,7 +87,7 @@ def test_generate_context_with_json_decoding_error():
     # original message from json module should be included
     pattern = (
         'Expecting \'{0,1}:\'{0,1} delimiter: '
-        'line 1 column (19|20) \(char 19\)'
+        'line 1 column (19|20) \\(char 19\\)'
     )
     assert re.search(pattern, str(excinfo.value))
     # File name should be included too...for testing purposes, just test the
diff --git a/tox.ini b/tox.ini
index d5d4924..56f4d5e 100644
--- a/tox.ini
+++ b/tox.ini
@@ -1,5 +1,11 @@
 [tox]
-envlist = py27, py35, py36, py37, pypy, flake8
+envlist =
+    lint
+    py27
+    py35
+    py36
+    py37
+    pypy
 minversion = 3.2.0
 requires =
     # https://github.com/tox-dev/tox/issues/765
@@ -13,11 +19,13 @@ passenv =
 commands = pytest --cov=cookiecutter {posargs:tests}
 deps = -rtest_requirements.txt
 
-[testenv:flake8]
-deps =
-    flake8==3.5.0
+[testenv:lint]
 commands =
-    flake8 cookiecutter tests setup.py
+    python -m pre_commit run {posargs:--all}
+deps = pre-commit>=1.17.0
+extras =
+skip_install = true
+usedevelop = false
 
 [testenv:cov-report]
 commands = pytest --cov=cookiecutter --cov-report=term --cov-report=html
