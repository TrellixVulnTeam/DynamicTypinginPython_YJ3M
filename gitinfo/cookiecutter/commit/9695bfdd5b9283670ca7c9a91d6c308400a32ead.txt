commit 9695bfdd5b9283670ca7c9a91d6c308400a32ead
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Sat Nov 15 15:56:46 2014 +0100

    Convert test_branch for git to pytest

diff --git a/tests/test_examples.py b/tests/test_examples.py
index f786a34..2dc1e66 100755
--- a/tests/test_examples.py
+++ b/tests/test_examples.py
@@ -55,31 +55,5 @@ class TestExamplesRepoArg(CookiecutterCleanSystemTestCase):
         self.assertTrue(os.path.isfile('boilerplate/README.rst'))
 
 
-@unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
-@unittest.skipIf(condition=no_network, reason='Needs a network connection to GitHub.')
-class TestGitBranch(CookiecutterCleanSystemTestCase):
-
-    def tearDown(self):
-        with utils.work_in(config.DEFAULT_CONFIG['cookiecutters_dir']):
-            if os.path.isdir('cookiecutter-pypackage'):
-                utils.rmtree('cookiecutter-pypackage')
-        if os.path.isdir('boilerplate'):
-            utils.rmtree('boilerplate')
-        super(TestGitBranch, self).tearDown()
-
-    def test_branch(self):
-        proc = subprocess.Popen(
-            'cookiecutter -c console-script https://github.com/audreyr/cookiecutter-pypackage.git',
-            stdin=subprocess.PIPE,
-            shell=True
-        )
-
-        # Just skip all the prompts
-        proc.communicate(input=b'\n\n\n\n\n\n\n\n\n\n\n\n')
-
-        self.assertTrue(os.path.isfile('boilerplate/README.rst'))
-        self.assertTrue(os.path.isfile('boilerplate/boilerplate/main.py'))
-
-
 if __name__ == '__main__':
     unittest.main()
diff --git a/tests/test_git_branch.py b/tests/test_git_branch.py
new file mode 100644
index 0000000..efe6783
--- /dev/null
+++ b/tests/test_git_branch.py
@@ -0,0 +1,50 @@
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+
+"""
+test_cookiecutters
+------------------
+
+Test formerly known from a unittest residing in test_generate.py named
+TestGitBranch.test_branch
+"""
+
+from __future__ import unicode_literals
+import os
+import subprocess
+import pytest
+
+from cookiecutter import config, utils
+from tests.skipif_markers import skipif_travis, skipif_no_network
+
+
+@pytest.fixture(scope='function')
+def remove_additional_dirs(request):
+    """
+    Remove special directories which are creating during the tests.
+    """
+    def fin_remove_additional_dirs():
+        with utils.work_in(config.DEFAULT_CONFIG['cookiecutters_dir']):
+            if os.path.isdir('cookiecutter-pypackage'):
+                utils.rmtree('cookiecutter-pypackage')
+        if os.path.isdir('boilerplate'):
+            utils.rmtree('boilerplate')
+    request.addfinalizer(fin_remove_additional_dirs)
+
+
+@skipif_travis
+@skipif_no_network
+@pytest.mark.usefixtures('clean_system', 'remove_additional_dirs')
+def test_branch():
+    pypackage_git = 'https://github.com/audreyr/cookiecutter-pypackage.git'
+    proc = subprocess.Popen(
+        'cookiecutter -c console-script {0}'.format(pypackage_git),
+        stdin=subprocess.PIPE,
+        shell=True
+    )
+
+    # Just skip all the prompts
+    proc.communicate(input=b'\n\n\n\n\n\n\n\n\n\n\n\n')
+
+    assert os.path.isfile('boilerplate/README.rst')
+    assert os.path.isfile('boilerplate/boilerplate/main.py')
