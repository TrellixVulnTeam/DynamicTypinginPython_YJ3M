commit 064a815e701c5e44444381f19eed4924b50d2b1d
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Wed May 20 00:22:03 2015 +0200

    Implement a test to ensure correct system encoding

diff --git a/tests/test_preferred_encoding.py b/tests/test_preferred_encoding.py
new file mode 100644
index 0000000..c68ca02
--- /dev/null
+++ b/tests/test_preferred_encoding.py
@@ -0,0 +1,22 @@
+# -*- coding: utf-8 -*-
+
+import locale
+import codecs
+
+
+def test_not_ascii():
+    """Make sure that the systems preferred encoding is not `ascii`.
+
+    Otherwise `click` is raising a RuntimeError for Python3. For a detailed
+    description of this very problem please consult the following gist:
+    https://gist.github.com/hackebrot/937245251887197ef542
+
+    This test also checks that `tox.ini` explicitly copies the according
+    system environment variables to the test environments.
+    """
+    try:
+        preferred_encoding = locale.getpreferredencoding()
+        fs_enc = codecs.lookup(preferred_encoding).name
+    except Exception:
+        fs_enc = 'ascii'
+    assert fs_enc != 'ascii'
