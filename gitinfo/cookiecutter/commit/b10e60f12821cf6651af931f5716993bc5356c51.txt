commit b10e60f12821cf6651af931f5716993bc5356c51
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Wed Nov 25 15:28:48 2015 +0100

    Implement a test for the extended cli error message for undefined vars

diff --git a/tests/test_cli.py b/tests/test_cli.py
index 383d7ea..0db9db8 100644
--- a/tests/test_cli.py
+++ b/tests/test_cli.py
@@ -1,4 +1,5 @@
 import os
+import json
 import pytest
 
 from click.testing import CliRunner
@@ -295,3 +296,33 @@ def test_default_user_config(mocker):
         output_dir='.',
         config_file=None
     )
+
+
+def test_echo_undefined_variable_error(tmpdir):
+    output_dir = str(tmpdir.mkdir('output'))
+    template_path = 'tests/undefined-variable/file-name/'
+
+    result = runner.invoke(main, [
+        '--no-input',
+        '--default-config',
+        '--output-dir',
+        output_dir,
+        template_path,
+    ])
+
+    assert result.exit_code == 1
+
+    error = "Unable to create file '{{cookiecutter.foobar}}'"
+    assert error in result.output
+
+    message = "Error message: 'dict object' has no attribute 'foobar'"
+    assert message in result.output
+
+    context = {
+        'cookiecutter': {
+            'github_username': 'hackebrot',
+            'project_slug': 'testproject'
+        }
+    }
+    context_str = json.dumps(context, indent=4, sort_keys=True)
+    assert context_str in result.output
diff --git a/tests/undefined-variable/file-name/cookiecutter.json b/tests/undefined-variable/file-name/cookiecutter.json
new file mode 100644
index 0000000..c9bd2f7
--- /dev/null
+++ b/tests/undefined-variable/file-name/cookiecutter.json
@@ -0,0 +1,4 @@
+{
+    "project_slug": "testproject",
+    "github_username": "hackebrot"
+}
