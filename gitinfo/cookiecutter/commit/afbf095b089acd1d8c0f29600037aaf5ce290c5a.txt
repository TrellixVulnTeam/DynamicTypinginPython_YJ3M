commit afbf095b089acd1d8c0f29600037aaf5ce290c5a
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Thu Jun 9 18:38:57 2016 +0100

    Implement tests to check template_name in main for replay functions

diff --git a/tests/test_main.py b/tests/test_main.py
index 56fc6bf..f25ceff 100644
--- a/tests/test_main.py
+++ b/tests/test_main.py
@@ -140,3 +140,59 @@ def test_cookiecutter_repository_url_should_clone(
     )
 
     assert os.path.isdir(project_dir)
+
+
+def test_replay_dump_template_name(
+        monkeypatch, mocker, user_config_data, user_config_file):
+    """Check that replay_dump is called with a valid template_name that is
+    not a relative path.
+
+    Otherwise files such as ``..json`` are created, which are not just cryptic
+    but also later mistaken for replay files of other templates if invoked with
+    '.' and '--replay'.
+
+    Change the current working directory temporarily to 'tests/fake-repo-tmpl'
+    for this test and call cookiecutter with '.' for the target template.
+    """
+    monkeypatch.chdir('tests/fake-repo-tmpl')
+
+    mock_replay_dump = mocker.patch('cookiecutter.main.dump')
+    mocker.patch('cookiecutter.main.generate_files')
+
+    cookiecutter(
+        '.',
+        no_input=True,
+        replay=False,
+        config_file=user_config_file,
+    )
+
+    mock_replay_dump.assert_called_once_with(
+        user_config_data['replay_dir'],
+        'fake-repo-tmpl',
+        mocker.ANY,
+    )
+
+
+def test_replay_load_template_name(
+        monkeypatch, mocker, user_config_data, user_config_file):
+    """Check that replay_load is called with a valid template_name that is
+    not a relative path.
+
+    Change the current working directory temporarily to 'tests/fake-repo-tmpl'
+    for this test and call cookiecutter with '.' for the target template.
+    """
+    monkeypatch.chdir('tests/fake-repo-tmpl')
+
+    mock_replay_load = mocker.patch('cookiecutter.main.load')
+    mocker.patch('cookiecutter.main.generate_files')
+
+    cookiecutter(
+        '.',
+        replay=True,
+        config_file=user_config_file,
+    )
+
+    mock_replay_load.assert_called_once_with(
+        user_config_data['replay_dir'],
+        'fake-repo-tmpl',
+    )
