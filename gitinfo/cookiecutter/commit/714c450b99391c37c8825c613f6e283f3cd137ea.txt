commit 714c450b99391c37c8825c613f6e283f3cd137ea
Author: Audrey Roy <audreyr@gmail.com>
Date:   Sat Aug 24 22:16:47 2013 +0200

    Get the integration tests working locally with subprocess. Only run locally; not on Travis.

diff --git a/cookiecutter/find.py b/cookiecutter/find.py
index 9ad0dd2..0c3d915 100755
--- a/cookiecutter/find.py
+++ b/cookiecutter/find.py
@@ -24,6 +24,7 @@ def find_template(repo_dir):
     
     repo_dir_contents = os.listdir(repo_dir)
 
+    project_template = None
     for item in repo_dir_contents:
         if 'cookiecutter' in item and \
             '{{' in item and \
diff --git a/tests/test_examples.py b/tests/test_examples.py
index 1655b76..b993022 100755
--- a/tests/test_examples.py
+++ b/tests/test_examples.py
@@ -36,7 +36,7 @@ except KeyError:
     travis = False
 
 
-@unittest.skip(reason='Works locally with tox but fails on Travis.')
+@unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
 class TestPyPackage(unittest.TestCase):
 
     def test_cookiecutter_pypackage(self):
@@ -44,15 +44,27 @@ class TestPyPackage(unittest.TestCase):
         Tests that https://github.com/audreyr/cookiecutter-pypackage.git works.
         """
 
-        os.system('git clone https://github.com/audreyr/cookiecutter-pypackage.git')
-        os.system('cookiecutter cookiecutter-pypackage/')
-        self.assertTrue(os.path.isfile('cookiecutter-pypackage/alotofeffort/README.rst'))
+        with subprocess.Popen(
+            'git clone https://github.com/audreyr/cookiecutter-pypackage.git',
+            stdin=subprocess.PIPE,
+            shell=True
+        ) as proc:
+            proc.wait()
+
+        with subprocess.Popen(
+            'cookiecutter cookiecutter-pypackage/',
+            stdin=subprocess.PIPE,
+            shell=True
+        ) as proc:
+            proc.wait()
+
+        self.assertTrue(os.path.isfile('cookiecutter-pypackage/boilerplate/README.rst'))
 
     def tearDown(self):
         if os.path.isdir('cookiecutter-pypackage'):
             shutil.rmtree('cookiecutter-pypackage')
 
-@unittest.skip(reason='Works locally with tox but fails on Travis.')
+@unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
 class TestJQuery(unittest.TestCase):
 
     def test_cookiecutter_jquery(self):
@@ -60,24 +72,44 @@ class TestJQuery(unittest.TestCase):
         Tests that https://github.com/audreyr/cookiecutter-jquery.git works.
         """
 
-        os.system('git clone https://github.com/audreyr/cookiecutter-jquery.git')
-        os.system('cookiecutter cookiecutter-jquery/')
+        with subprocess.Popen(
+            'git clone https://github.com/audreyr/cookiecutter-jquery.git',
+            stdin=subprocess.PIPE,
+            shell=True
+        ) as proc:
+            proc.wait()
+
+        with subprocess.Popen(
+            'cookiecutter cookiecutter-jquery/',
+            stdin=subprocess.PIPE,
+            shell=True
+        ) as proc:
+            proc.wait()
+
         self.assertTrue(os.path.isfile('cookiecutter-jquery/boilerplate/README.md'))
 
     def tearDown(self):
         if os.path.isdir('cookiecutter-jquery'):
             shutil.rmtree('cookiecutter-jquery')
 
-@unittest.skip(reason='Works locally with tox but fails on Travis.')
+@unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
 class TestExamplesRepoArg(unittest.TestCase):
 
     def test_cookiecutter_pypackage_git(self):
-        os.system('cookiecutter https://github.com/audreyr/cookiecutter-pypackage.git')
-        self.assertTrue(os.path.isfile('alotofeffort/README.rst'))
+        with subprocess.Popen(
+            'cookiecutter https://github.com/audreyr/cookiecutter-pypackage.git',
+            stdin=subprocess.PIPE,
+            shell=True
+        ) as proc:
+
+            # Just skip all the prompts
+            proc.communicate(input=b'\n\n\n\n\n\n\n\n\n\n\n\n')
+
+        self.assertTrue(os.path.isfile('boilerplate/README.rst'))
 
     def tearDown(self):
-        if os.path.isdir('alotofeffort'):
-            shutil.rmtree('alotofeffort')
+        if os.path.isdir('boilerplate'):
+            shutil.rmtree('boilerplate')
 
 @unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
 class TestGitBranch(unittest.TestCase):
@@ -87,14 +119,14 @@ class TestGitBranch(unittest.TestCase):
             shutil.rmtree('cookiecutter-pypackage')
 
     def test_branch(self):
-        p = subprocess.Popen(
+        with subprocess.Popen(
             'cookiecutter -c console-script https://github.com/audreyr/cookiecutter-pypackage.git',
             stdin=subprocess.PIPE,
             shell=True
-        )
+        ) as proc:
 
-        # Just skip all the prompts
-        p.communicate(input=b'\n\n\n\n\n\n\n\n\n\n\n\n')
+            # Just skip all the prompts
+            proc.communicate(input=b'\n\n\n\n\n\n\n\n\n\n\n\n')
 
         self.assertTrue(os.path.isfile('boilerplate/README.rst'))
         self.assertTrue(os.path.isfile('boilerplate/boilerplate/main.py'))
