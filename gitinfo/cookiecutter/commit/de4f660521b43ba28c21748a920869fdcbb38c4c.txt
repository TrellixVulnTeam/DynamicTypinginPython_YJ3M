commit de4f660521b43ba28c21748a920869fdcbb38c4c
Author: Audrey Roy <audreyr@gmail.com>
Date:   Sat Sep 7 17:45:03 2013 +0200

    Move code that removes stale backups into subcondition.

diff --git a/tests/__init__.py b/tests/__init__.py
index a4d1f64..f01f42d 100755
--- a/tests/__init__.py
+++ b/tests/__init__.py
@@ -56,11 +56,14 @@ class CookiecutterCleanSystemTestCase(unittest.TestCase):
         self.cookiecutters_dir_backup = os.path.expanduser('~/.cookiecutters.backup')
         if os.path.isdir(self.cookiecutters_dir):
             self.cookiecutters_dir_found = True
+
+            # Remove existing backups before backing up. If they exist, they're stale.
+            if os.path.isdir(self.cookiecutters_dir_backup):
+                shutil.rmtree(self.cookiecutters_dir_backup)
+
             shutil.copytree(self.cookiecutters_dir, self.cookiecutters_dir_backup)
         else:
             self.cookiecutters_dir_found = False
-        if os.path.isdir(self.cookiecutters_dir_backup):
-            shutil.rmtree(self.cookiecutters_dir)
 
     def tearDown(self):
         # If it existed, restore ~/.cookiecutterrc
diff --git a/tests/test_main.py b/tests/test_main.py
index bbd6920..8af5d83 100755
--- a/tests/test_main.py
+++ b/tests/test_main.py
@@ -36,7 +36,7 @@ else:
 logging.basicConfig(format='%(levelname)s: %(message)s', level=logging.DEBUG)
 
 
-class TestCookiecutterLocalNoInput(unittest.TestCase):
+class TestCookiecutterLocalNoInput(CookiecutterCleanSystemTestCase):
 
     def test_cookiecutter(self):
         main.cookiecutter('tests/fake-repo-pre/', no_input=True)
@@ -59,7 +59,7 @@ class TestCookiecutterLocalNoInput(unittest.TestCase):
             shutil.rmtree('fake-project')
 
 
-class TestCookiecutterLocalWithInput(unittest.TestCase):
+class TestCookiecutterLocalWithInput(CookiecutterCleanSystemTestCase):
 
     @patch(input_str, lambda x: '\n')
     def test_cookiecutter_local_with_input(self):
