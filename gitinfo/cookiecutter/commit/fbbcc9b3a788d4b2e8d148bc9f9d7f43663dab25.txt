commit fbbcc9b3a788d4b2e8d148bc9f9d7f43663dab25
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Thu Nov 20 22:46:05 2014 +0100

    Convert test_cookiecutter_git with fixtures and patch

diff --git a/tests/test_cookiecutter_repo_arg.py b/tests/test_cookiecutter_repo_arg.py
new file mode 100644
index 0000000..a51f84f
--- /dev/null
+++ b/tests/test_cookiecutter_repo_arg.py
@@ -0,0 +1,50 @@
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+
+"""
+test_cookiecutter_repo_arg
+--------------------------
+
+Tests formerly known from a unittest residing in test_main.py named
+TestCookiecutterRepoArg.test_cookiecutter_git
+"""
+
+from __future__ import unicode_literals
+import os
+import pytest
+
+from cookiecutter import main, utils
+from tests.skipif_markers import skipif_no_network
+
+
+@pytest.fixture(scope='function')
+def remove_additional_folders(request):
+    """
+    Remove some special folders which are created by the tests.
+    """
+    def fin_remove_additional_folders():
+        if os.path.isdir('cookiecutter-pypackage'):
+            utils.rmtree('cookiecutter-pypackage')
+        if os.path.isdir('boilerplate'):
+            utils.rmtree('boilerplate')
+        if os.path.isdir('cookiecutter-trytonmodule'):
+            utils.rmtree('cookiecutter-trytonmodule')
+        if os.path.isdir('module_name'):
+            utils.rmtree('module_name')
+    request.addfinalizer(fin_remove_additional_folders)
+
+
+@skipif_no_network
+@pytest.mark.usefixtures('clean_system', 'remove_additional_folders')
+def test_cookiecutter_git(monkeypatch):
+    monkeypatch.setattr('cookiecutter.prompt.read_response', lambda x=u'': u'')
+
+    main.cookiecutter('https://github.com/audreyr/cookiecutter-pypackage.git')
+    clone_dir = os.path.join(
+        os.path.expanduser('~/.cookiecutters'),
+        'cookiecutter-pypackage'
+    )
+    assert os.path.exists(clone_dir)
+    assert os.path.isdir('boilerplate')
+    assert os.path.isfile('boilerplate/README.rst')
+    assert os.path.exists('boilerplate/setup.py')
diff --git a/tests/test_main.py b/tests/test_main.py
index cc683ea..aefda8d 100755
--- a/tests/test_main.py
+++ b/tests/test_main.py
@@ -161,16 +161,6 @@ class TestCookiecutterRepoArg(CookiecutterCleanSystemTestCase):
             utils.rmtree('module_name')
         super(TestCookiecutterRepoArg, self).tearDown()
 
-    @patch('cookiecutter.prompt.read_response', lambda x=u'': u'')
-    def test_cookiecutter_git(self):
-        main.cookiecutter('https://github.com/audreyr/cookiecutter-pypackage.git')
-        logging.debug('Current dir is {0}'.format(os.getcwd()))
-        clone_dir = os.path.join(os.path.expanduser('~/.cookiecutters'), 'cookiecutter-pypackage')
-        self.assertTrue(os.path.exists(clone_dir))
-        self.assertTrue(os.path.isdir('boilerplate'))
-        self.assertTrue(os.path.isfile('boilerplate/README.rst'))
-        self.assertTrue(os.path.exists('boilerplate/setup.py'))
-
     @patch('cookiecutter.prompt.read_response', lambda x=u'': u'')
     def test_cookiecutter_mercurial(self):
         main.cookiecutter('https://bitbucket.org/pokoli/cookiecutter-trytonmodule')
