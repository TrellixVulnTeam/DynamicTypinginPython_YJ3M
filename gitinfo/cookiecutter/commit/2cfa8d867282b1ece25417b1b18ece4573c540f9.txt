commit 2cfa8d867282b1ece25417b1b18ece4573c540f9
Author: Raphael Pierzina <raphael@hackebrot.de>
Date:   Sat Nov 15 13:30:04 2014 +0100

    Convert test_cookiecutter_pypackage along with teardown

diff --git a/tests/test_examples.py b/tests/test_examples.py
index b2d9e05..76e93a2 100755
--- a/tests/test_examples.py
+++ b/tests/test_examples.py
@@ -30,40 +30,6 @@ except KeyError:
 logging.basicConfig(format='%(levelname)s: %(message)s', level=logging.DEBUG)
 
 
-@unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
-@unittest.skipIf(condition=no_network, reason='Needs a network connection to GitHub.')
-class TestPyPackage(CookiecutterCleanSystemTestCase):
-
-    def tearDown(self):
-        if os.path.isdir('cookiecutter-pypackage'):
-            utils.rmtree('cookiecutter-pypackage')
-        if os.path.isdir('boilerplate'):
-            utils.rmtree('boilerplate')
-        super(TestPyPackage, self).tearDown()
-
-    def test_cookiecutter_pypackage(self):
-        """
-        Tests that https://github.com/audreyr/cookiecutter-pypackage.git works.
-        """
-
-        proc = subprocess.Popen(
-            'git clone https://github.com/audreyr/cookiecutter-pypackage.git',
-            stdin=subprocess.PIPE,
-            shell=True
-        )
-        proc.wait()
-
-        proc = subprocess.Popen(
-            'cookiecutter --no-input cookiecutter-pypackage/',
-            stdin=subprocess.PIPE,
-            shell=True
-        )
-        proc.wait()
-
-        self.assertTrue(os.path.isdir('cookiecutter-pypackage'))
-        self.assertTrue(os.path.isfile('boilerplate/README.rst'))
-
-
 @unittest.skipIf(condition=travis, reason='Works locally with tox but fails on Travis.')
 @unittest.skipIf(condition=no_network, reason='Needs a network connection to GitHub.')
 class TestJQuery(CookiecutterCleanSystemTestCase):
diff --git a/tests/test_pypackage.py b/tests/test_pypackage.py
new file mode 100644
index 0000000..50729cb
--- /dev/null
+++ b/tests/test_pypackage.py
@@ -0,0 +1,74 @@
+#!/usr/bin/env python
+# -*- coding: utf-8 -*-
+
+"""
+test_pypackage
+--------------
+
+Tests formerly known from a unittest residing in test_generate.py named
+TestPyPackage.test_cookiecutter_pypackage
+"""
+
+from __future__ import unicode_literals
+import os
+import subprocess
+import pytest
+
+from cookiecutter import utils
+
+
+try:
+    travis = os.environ[u'TRAVIS']
+except KeyError:
+    travis = False
+
+try:
+    no_network = os.environ[u'DISABLE_NETWORK_TESTS']
+except KeyError:
+    no_network = False
+
+
+@pytest.fixture(scope='function')
+def remove_additional_dirs(request):
+    """
+    Remove special directories which are creating during the tests.
+    """
+    def fin_remove_additional_dirs():
+        if os.path.isdir('cookiecutter-pypackage'):
+            utils.rmtree('cookiecutter-pypackage')
+        if os.path.isdir('boilerplate'):
+            utils.rmtree('boilerplate')
+    request.addfinalizer(fin_remove_additional_dirs)
+
+
+# For some reason pytest incorrectly uses the first reason text regardless of
+# which condition matches. Using a unified message for now
+# travis_reason = 'Works locally with tox but fails on Travis.'
+# no_network_reason = 'Needs a network connection to GitHub.'
+reason = 'Fails on Travis or else there is no network connection to GitHub'
+
+
+@pytest.mark.skipif(travis, reason=reason)
+@pytest.mark.skipif(no_network, reason=reason)
+@pytest.mark.usefixtures('remove_additional_dirs')
+def test_cookiecutter_pypackage():
+    """
+    Tests that https://github.com/audreyr/cookiecutter-pypackage.git works.
+    """
+
+    proc = subprocess.Popen(
+        'git clone https://github.com/audreyr/cookiecutter-pypackage.git',
+        stdin=subprocess.PIPE,
+        shell=True
+    )
+    proc.wait()
+
+    proc = subprocess.Popen(
+        'cookiecutter --no-input cookiecutter-pypackage/',
+        stdin=subprocess.PIPE,
+        shell=True
+    )
+    proc.wait()
+
+    assert os.path.isdir('cookiecutter-pypackage')
+    assert os.path.isfile('boilerplate/README.rst')
