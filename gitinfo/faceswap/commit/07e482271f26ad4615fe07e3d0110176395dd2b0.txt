commit 07e482271f26ad4615fe07e3d0110176395dd2b0
Author: Clorr <colin@clorr.fr>
Date:   Tue Dec 19 22:15:48 2017 +0100

    Different aligner setup
    
    Using cnn_face_detection_model_v1 as per
    https://www.reddit.com/r/deepfakes/comments/7kfva4/face_alignment_with_d
    lib/
    
    Note this gives good result on trump/cage, but not on the group photos
    I tried

diff --git a/lib/aligner.py b/lib/aligner.py
index e66efe0..19a7d1f 100644
--- a/lib/aligner.py
+++ b/lib/aligner.py
@@ -7,19 +7,19 @@ import dlib
 import numpy as np
 
 class Aligner:
-    def __init__(self, pred):
-        self.detector = dlib.get_frontal_face_detector()
+    def __init__(self, pred, detect):
+        self.detector = dlib.cnn_face_detection_model_v1(detect)
         self.predictor = dlib.shape_predictor(pred)
 
     def get_rects(self, img):
-        rects = self.detector(img)
+        rects = self.detector(img, 1)
         #print("[+] Number of faces found:", len(rects))
         return rects
 
     def get_first_rect(self, img):
         rects = self.get_rects(img)
         if len(rects) > 0:
-            return rects[0]
+            return rects[0].rect
         else:
             return None
 
@@ -62,6 +62,7 @@ class Aligner:
         return output_im
 
     def align(self, ref_img, img):
+        # TODO optimize with a one step detection for both images
         ref_rect = self.get_first_rect(ref_img)
         if ref_rect is None:
             return None
diff --git a/lib/faces_process.py b/lib/faces_process.py
index b4b70f4..7c3c45d 100644
--- a/lib/faces_process.py
+++ b/lib/faces_process.py
@@ -14,7 +14,7 @@ autoencoder = autoencoder_B
 
 # landmark file can be found in http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2
 # unzip it in the same folder as the main scripts
-aligner = Aligner("shape_predictor_68_face_landmarks.dat")
+aligner = Aligner("shape_predictor_68_face_landmarks.dat","mmod_human_face_detector.dat")
 
 def convert_one_image( image ):
     assert image.shape == (256,256,3)
diff --git a/mmod_human_face_detector.dat b/mmod_human_face_detector.dat
new file mode 100644
index 0000000..f1f73a5
Binary files /dev/null and b/mmod_human_face_detector.dat differ
