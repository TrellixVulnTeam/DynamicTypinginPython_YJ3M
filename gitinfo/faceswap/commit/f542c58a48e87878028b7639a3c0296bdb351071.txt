commit f542c58a48e87878028b7639a3c0296bdb351071
Author: Clorr <colin@clorr.fr>
Date:   Thu Dec 21 23:13:47 2017 +0100

    Adding face_recognition
    
    Added face_recongition from
    https://github.com/ageitgey/face_recognition/
    
    It is based on dlib, but does not have the glitches I had previously!
    
    Also reworked Dockerfile (sticking to Python2 for now)

diff --git a/.dockerignore b/.dockerignore
new file mode 100644
index 0000000..3099ac2
--- /dev/null
+++ b/.dockerignore
@@ -0,0 +1,2 @@
+*
+!requirements.txt
\ No newline at end of file
diff --git a/Dockerfile b/Dockerfile
index 24376aa..59b8a19 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -1,23 +1,42 @@
-FROM gw000/keras:2.0.6-py3-tf-cpu
+FROM debian:stretch
+
+# install debian packages
+ENV DEBIAN_FRONTEND noninteractive
 
 RUN apt-get update -qq \
  && apt-get install --no-install-recommends -y \
-    python-pip \
-    python-dev
-
-COPY requirements.txt .
+    # install essentials
+	build-essential \ 
+	g++ \ 
+	git \ 
+	openssh-client \ 
+	# install python 2
+	python \ 
+	python-dev \ 
+	python-pip \ 
+	python-setuptools \ 
+	python-virtualenv \ 
+	python-wheel \ 
+	pkg-config \
+	# requirements for keras
+	python-h5py \
+	python-yaml \
+	python-pydot \
+ && apt-get clean \
+ && rm -rf /var/lib/apt/lists/*
 
-# install dependencies from python packages
+# mandatory ?
 RUN pip install --upgrade setuptools
 
-RUN pip3 --no-cache-dir install -r ./requirements.txt
-
-RUN apt-get install -y \
+# requirements for dlib
+RUN apt-get update \
+ && apt-get install --no-install-recommends -y \
     cmake \
-    libboost-all-dev
+    libboost-all-dev \
+ && apt-get clean \
+ && rm -rf /var/lib/apt/lists/*
+
+COPY ./requirements.txt .
+RUN pip --no-cache-dir install -r ./requirements.txt
 
-# Add these to requirements.txt
-RUN pip3 --no-cache-dir install \
-    scikit-image \
-    # boost \
-    dlib
+WORKDIR /srv/
diff --git a/lib/faces_detect.py b/lib/faces_detect.py
index 8618ba7..b98a599 100644
--- a/lib/faces_detect.py
+++ b/lib/faces_detect.py
@@ -1,14 +1,13 @@
-import cv2
+import face_recognition
 from DetectedFace import DetectedFace
 
-# Give right path to the xml file or put it directly in current folder
-face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')
+def crop_faces(frame):
+    face_locations = face_recognition.face_locations(frame)
+    #face_encodings = face_recognition.face_encodings(frame, face_locations)
 
-def crop_faces(image):
-    # Add : cv.EqualizeHist(image, image) ?
-    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
-
-    faces = face_cascade.detectMultiScale(gray, 1.3, 5)
-
-    for (x, y, w, h) in faces:
-        yield DetectedFace(image[y: y + h, x: x + w], x, w, y, h, None)
+    for (top, right, bottom, left) in face_locations:
+        x = left
+        y = top
+        w = right - left
+        h = bottom - top
+        yield DetectedFace(frame[y: y + h, x: x + w], x, w, y, h, None)
diff --git a/requirements-gpu.txt b/requirements-gpu.txt
index 8a43431..7339c67 100644
--- a/requirements-gpu.txt
+++ b/requirements-gpu.txt
@@ -4,3 +4,6 @@ h5py==2.7.1
 Keras==2.1.2
 opencv-python==3.3.0.10
 tensorflow-gpu==1.4.1
+scikit-image
+dlib
+face_recognition
diff --git a/requirements.txt b/requirements.txt
index f4fc87a..03530cf 100644
--- a/requirements.txt
+++ b/requirements.txt
@@ -4,3 +4,6 @@ h5py==2.7.1
 Keras==2.1.2
 opencv-python==3.3.0.10
 tensorflow==1.4.1
+scikit-image
+dlib
+face_recognition
