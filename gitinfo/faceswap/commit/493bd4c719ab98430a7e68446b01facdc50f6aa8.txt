commit 493bd4c719ab98430a7e68446b01facdc50f6aa8
Author: Artem Ivanov <37909402+andenixa@users.noreply.github.com>
Date:   Wed Jul 31 18:35:20 2019 +0300

    Manual Balance Plugin - brightness contrast adjustments (#818)
    
    * Update manual_balance.py
    * Update manual_balance_defaults.py
    
    - Renamed the parameters to `contrast` and `brightness`
    - Values range is altered to run from -100.0 to +100.0

diff --git a/plugins/convert/color/manual_balance.py b/plugins/convert/color/manual_balance.py
index 2e59f35..7acb30c 100644
--- a/plugins/convert/color/manual_balance.py
+++ b/plugins/convert/color/manual_balance.py
@@ -21,6 +21,22 @@ class Color(Adjustment):
                 image[:, :, idx] = image[:, :, idx] * (1 + adjustment[idx])
 
         image = self.convert_colorspace(image * 255.0, to_bgr=True)
+        image = self.adjust_contrast(image)
+        return image
+
+    def adjust_contrast(self, image):
+        """
+        Adjust image contrast and brightness.
+        """
+        contrast = max(-126, int(round(self.config["contrast"] * 1.27)))
+        brightness = max(-126, int(round(self.config["brightness"] * 1.27)))
+
+        if not contrast and not brightness:
+            return image
+
+        image = np.rint(image * 255.0).astype("uint8")
+        image = np.clip(image * (contrast/127+1) - contrast + brightness, 0, 255)
+        image = np.clip(np.divide(image, 255, dtype=np.float32), .0, 1.0)
         return image
 
     def convert_colorspace(self, new_face, to_bgr=False):
diff --git a/plugins/convert/color/manual_balance_defaults.py b/plugins/convert/color/manual_balance_defaults.py
index 6663131..f55ea07 100755
--- a/plugins/convert/color/manual_balance_defaults.py
+++ b/plugins/convert/color/manual_balance_defaults.py
@@ -114,4 +114,24 @@ _DEFAULTS = {
         "gui_radio": False,
         "fixed": True,
     },
+    "contrast": {
+        "default": 0.0,
+        "info": "Amount of contrast applied.",
+        "datatype": float,
+        "rounding": 1,
+        "min_max": (-100.0, 100.0),
+        "choices": [],
+        "gui_radio": False,
+        "fixed": True,
+    },
+    "brightness": {
+        "default": 0.0,
+        "info": "Amount of brighness applied.",
+        "datatype": float,
+        "rounding": 1,
+        "min_max": (-100.0, 100.0),
+        "choices": [],
+        "gui_radio": False,
+        "fixed": True,
+    },
 }
