commit 3896de3dba20b34bc3f27b56dbd469a1205dcd98
Author: torzdf <36920800+torzdf@users.noreply.github.com>
Date:   Wed Jul 10 09:44:50 2019 +0000

    Bugfixes
    
    Merge Alignments fix
    Face Filter. Set default aligner/detector on convert

diff --git a/scripts/fsmedia.py b/scripts/fsmedia.py
index 537e5b9..3b04adb 100644
--- a/scripts/fsmedia.py
+++ b/scripts/fsmedia.py
@@ -272,8 +272,18 @@ class PostProcess():
         if ((hasattr(self.args, "filter") and self.args.filter is not None) or
                 (hasattr(self.args, "nfilter") and
                  self.args.nfilter is not None)):
-            face_filter = dict(detector=self.args.detector.replace("-", "_").lower(),
-                               aligner=self.args.aligner.replace("-", "_").lower(),
+
+            if hasattr(self.args, "detector"):
+                detector = self.args.detector.replace("-", "_").lower()
+            else:
+                detector = "cv2_dnn"
+            if hasattr(self.args, "aligner"):
+                aligner = self.args.aligner.replace("-", "_").lower()
+            else:
+                aligner = "cv2_dnn"
+
+            face_filter = dict(detector=detector,
+                               aligner=aligner,
                                loglevel=self.args.loglevel,
                                multiprocess=not self.args.singleprocess)
             filter_lists = dict()
diff --git a/tools/lib_alignments/jobs.py b/tools/lib_alignments/jobs.py
index 3a03fcc..1e5b39a 100644
--- a/tools/lib_alignments/jobs.py
+++ b/tools/lib_alignments/jobs.py
@@ -151,7 +151,7 @@ class Check():
         """ yield each frame in alignments that does
             not have a matching file """
         self.output_message = "Missing frames that are in alignments file"
-        frames = set([item["frame_fullname"] for item in self.items])
+        frames = set(item["frame_fullname"] for item in self.items)
         for frame in tqdm(self.alignments.data.keys(), desc=self.output_message):
             if frame not in frames:
                 logger.debug("Returning: '%s'", frame)
@@ -573,7 +573,7 @@ class Merge():
         """ Merge the source alignment into the destination """
         logger.debug("Merging alignment: (frame: %s, src_idx: %s, hash: %s)",
                      frame, idx, alignment["hash"])
-        self.hashes_to_frame.setdefault(alignment["hash"], dict())[frame] = idx
+        self._hashes_to_frame.setdefault(alignment["hash"], dict())[frame] = idx
         self.final_alignments.data.setdefault(frame, list()).append(alignment)
 
     def set_destination_filename(self):
@@ -758,8 +758,8 @@ class Rename():
         logger.info("[RENAME FACES]")  # Tidy up cli output
         rename_count = 0
         for frame, details, _, frame_fullname in tqdm(self.alignments.yield_faces(),
-                                                desc="Renaming Faces",
-                                                total=self.alignments.frames_count):
+                                                      desc="Renaming Faces",
+                                                      total=self.alignments.frames_count):
             rename_count += self.rename_faces(frame, frame_fullname, details)
         logger.info("%s faces renamed", rename_count)
 
