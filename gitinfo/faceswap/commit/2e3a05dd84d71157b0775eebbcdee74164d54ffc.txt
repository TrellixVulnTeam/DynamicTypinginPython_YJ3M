commit 2e3a05dd84d71157b0775eebbcdee74164d54ffc
Author: torzdf <36920800+torzdf@users.noreply.github.com>
Date:   Sun Mar 31 11:35:00 2019 +0100

    Windows Installer - Conda: Better detection. Location bugfix

diff --git a/.install/windows/install.nsi b/.install/windows/install.nsi
index 148fd8a..372579b 100644
--- a/.install/windows/install.nsi
+++ b/.install/windows/install.nsi
@@ -19,7 +19,7 @@ InstallDir $PROFILE\faceswap
 !define flagsSetup "--installer"
 
 # Install cli flags
-!define flagsConda "/S /RegisterPython=0 /AddToPath=0 /D=$\"$PROFILE\MiniConda3$\""
+!define flagsConda "/S /RegisterPython=0 /AddToPath=0 /D=$PROFILE\MiniConda3"
 !define flagsGit "/SILENT /NORESTART /NOCANCEL /SP /CLOSEAPPLICATIONS /RESTARTAPPLICATIONS"
 !define flagsRepo "--depth 1 --no-single-branch ${wwwRepo}"
 !define flagsEnv "-y python=3.6"
@@ -34,9 +34,12 @@ InstallDir $PROFILE\faceswap
 
 
 # Folders
+Var ProgramData
 Var dirTemp
 Var dirMiniconda
+Var dirMinicondaAll
 Var dirAnaconda
+Var dirAnacondaAll
 Var dirConda
 
 # Items to Install
@@ -80,11 +83,16 @@ Page custom pgPrereqCreate pgPrereqLeave
 
 # Init
 Function .onInit
+    SetShellVarContext all
+    StrCpy $ProgramData $APPDATA
+    SetShellVarContext current
     # It's better to put stuff in $pluginsdir, $temp is shared
     InitPluginsDir
     StrCpy $dirTemp "$pluginsdir\faceswap\temp"
     StrCpy $dirMiniconda "$PROFILE\Miniconda3"
     StrCpy $dirAnaconda "$PROFILE\Anaconda3"
+    StrCpy $dirMinicondaAll "$ProgramData\Miniconda3"
+    StrCpy $dirAnacondaAll "$ProgramData\Anaconda3"
     StrCpy $gitInf "$dirTemp\git_install.inf"
     StrCpy $envName "faceswap"
     SetOutPath "$dirTemp"
@@ -217,21 +225,33 @@ Function CheckPrerequisites
         pop $0
         pop $1
 
-        # anaconda
-        nsExec::ExecToStack "$\"$dirAnaconda\Scripts\conda.exe$\" -V"
+        nsExec::ExecToStack "$\"$dirMinicondaAll\Scripts\conda.exe$\" -V"
         pop $2
         pop $3
 
+        # anaconda
+        nsExec::ExecToStack "$\"$dirAnaconda\Scripts\conda.exe$\" -V"
+        pop $4
+        pop $5
+
+        nsExec::ExecToStack "$\"$dirAnacondaAll\Scripts\conda.exe$\" -V"
+        pop $6
+        pop $7
+
         ${If} $0 == 0
             StrCpy $dirConda "$dirMiniconda"
             StrCpy $Log "$log(check) MiniConda installed: $1"
+        ${ElseIf} $2 == 0
+            StrCpy $dirConda "$dirMinicondaAll"
+            StrCpy $Log "$log(check) MiniConda installed: $3"
+        ${ElseIf} $4 == 0
+            StrCpy $dirConda "$dirAnaconda"
+            StrCpy $Log "$log(check) AnaConda installed: $5"
+        ${ElseIf} $6 == 0
+            StrCpy $dirConda "$dirAnacondaAll"
+            StrCpy $Log "$log(check) AnaConda installed: $7"
         ${Else}
-            ${If} $2 == 0
-                StrCpy $dirConda "$dirAnaconda"
-                StrCpy $Log "$log(check) AnaConda installed: $0"
-            ${Else}
-                StrCpy $InstallConda 1
-            ${EndIf}
+            StrCpy $InstallConda 1
         ${EndIf}
 
     # CPU Capabilities
