commit d15172248748e5a538d167a9d69df334066b5958
Author: torzdf <36920800+torzdf@users.noreply.github.com>
Date:   Sun Jun 30 16:04:16 2019 +0000

    Handle corrupted model error

diff --git a/lib/cli.py b/lib/cli.py
index 5ac5b50..bc06e0d 100644
--- a/lib/cli.py
+++ b/lib/cli.py
@@ -125,7 +125,7 @@ class ScriptExecutor():
                 logger.error(line)
             crash_file = crash_log()
             logger.info("To get more information on this error see the crash report written to "
-                        "%s", crash_file)
+                        "'%s'", crash_file)
         except KeyboardInterrupt:  # pylint: disable=try-except-raise
             raise
         except SystemExit:
@@ -133,7 +133,7 @@ class ScriptExecutor():
         except Exception:  # pylint: disable=broad-except
             crash_file = crash_log()
             logger.exception("Got Exception on main handler:")
-            logger.critical("An unexpected crash has occurred. Crash report written to %s. "
+            logger.critical("An unexpected crash has occurred. Crash report written to '%s'. "
                             "Please verify you are running the latest version of faceswap "
                             "before reporting", crash_file)
 
diff --git a/plugins/train/model/_base.py b/plugins/train/model/_base.py
index 66d0db9..1320a8e 100644
--- a/plugins/train/model/_base.py
+++ b/plugins/train/model/_base.py
@@ -23,7 +23,7 @@ from lib import Serializer
 from lib.model.losses import DSSIMObjective, PenalizedLoss
 from lib.model.nn_blocks import NNBlocks
 from lib.multithreading import MultiThread
-from lib.utils import get_folder
+from lib.utils import FaceswapError, get_folder
 from plugins.train._config import Config
 
 logger = logging.getLogger(__name__)  # pylint: disable=invalid-name
@@ -171,7 +171,15 @@ class ModelBase():
         """ Build the model. Override for custom build methods """
         self.add_networks()
         self.load_models(swapped=False)
-        self.build_autoencoders()
+        try:
+            self.build_autoencoders()
+        except ValueError as err:
+            if "must be from the same graph" in str(err).lower():
+                msg = ("The were was an error loading saved weights. This is most likely due to "
+                       "model corruption during a previous save."
+                       "\nYou should restore weights from a snapshot or from the .bk files "
+                       "located in your model folder: '{}'".format(self.model_dir))
+                raise FaceswapError(msg) from err
         self.log_summary()
         self.compile_predictors(initialize=True)
 
