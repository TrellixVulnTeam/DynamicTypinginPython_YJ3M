commit 91dbcbdf0e48d12f95caaf60409e9901d9afefb9
Author: torzdf <36920800+torzdf@users.noreply.github.com>
Date:   Thu Jul 25 14:15:47 2019 +0000

    Bugfixes
    
    Preview for extract/convert: Output debug info on error and pass
    Analysis: Training graph. Correctly order the sessions

diff --git a/lib/gui/stats.py b/lib/gui/stats.py
index 5e8fa35..a3c9cce 100644
--- a/lib/gui/stats.py
+++ b/lib/gui/stats.py
@@ -192,8 +192,9 @@ class Session():
     def total_loss(self):
         """ Return collated loss for all session """
         loss_dict = dict()
-        for sess in self.tb_logs.get_loss().values():
-            for loss_key, side_loss in sess.items():
+        all_loss = self.tb_logs.get_loss()
+        for key in sorted(int(idx) for idx in all_loss.keys()):
+            for loss_key, side_loss in all_loss[key].items():
                 for side, loss in side_loss.items():
                     loss_dict.setdefault(loss_key, dict()).setdefault(side, list()).extend(loss)
         return loss_dict
diff --git a/lib/gui/utils.py b/lib/gui/utils.py
index e7f4e03..b7f951b 100644
--- a/lib/gui/utils.py
+++ b/lib/gui/utils.py
@@ -431,8 +431,31 @@ class Images():
             placeholder = np.concatenate([np.expand_dims(self.previewcache["placeholder"],
                                                          0)] * remainder)
             samples = np.concatenate((samples, placeholder))
-        display = np.vstack([np.hstack(samples[row * cols: (row + 1) * cols])
-                             for row in range(rows)])
+
+        try:
+            display = np.vstack([np.hstack(samples[row * cols: (row + 1) * cols])
+                                 for row in range(rows)])
+        except ValueError as err:
+            # TODO Actually handle this properly. The following error is inconsistently output:
+            #   Exception in Tkinter callback
+            #   Traceback (most recent call last):
+            #     File "/home/matt/fake/faceswap/lib/gui/utils.py", line 435, in place_previews
+            #       for row in range(rows)])
+            #     File "/home/matt/fake/faceswap/lib/gui/utils.py", line 435, in <listcomp>
+            #       for row in range(rows)])
+            #     File "/home/matt/fake/envs/faceswap/lib/python3.6/site-packages/numpy/core/
+            #           shape_base.py", line 340, in hstack
+            #       return _nx.concatenate(arrs, 1)
+            #   ValueError: need at least one array to concatenate
+            # This theoretically shouldn't be possible as if cols == 0 or rows == 0 then this code
+            # shouldnever be reached
+            logger.warning("A known, but unexplained bug has occured! It has been skipped, but "
+                           "please report the following output to the faceswap Devs:")
+            logger.warning("Extract/Convert preview bug. Debug output: (cols: %s, rows: %s, "
+                           "remainder: %s, num_images: %s, thumbnail_size: %s, samples shape: %s, "
+                           "err: %s)", cols, rows, remainder, num_images, thumbnail_size,
+                           samples.shape, err)
+            return None
         logger.debug("display shape: %s", display.shape)
         return Image.fromarray(display)
 
