commit f8975cfb5f307b6c77ceb30e0881e456fc81056b
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Tue Oct 23 15:11:38 2012 -0400

    BUG: fix improved to_html when DataFrame index is multiindex

diff --git a/pandas/core/format.py b/pandas/core/format.py
index 3bc379220..c38e34141 100644
--- a/pandas/core/format.py
+++ b/pandas/core/format.py
@@ -538,12 +538,15 @@ class HTMLFormatter(object):
             col_values = self.columns.values
             level_lengths = _get_level_lengths(levels)
 
+            row_levels = self.frame.index.nlevels
+
             for lnum, (records, values) in enumerate(zip(level_lengths, levels)):
                 name = self.columns.names[lnum]
-                row = ['' if name is None else str(name)]
+                row = [''] * (row_levels - 1) + ['' if name is None
+                                                 else str(name)]
 
                 tags = {}
-                j = 1
+                j = len(row)
                 for i, v in enumerate(values):
                     if i in records:
                         if records[i] > 1:
diff --git a/pandas/tests/test_format.py b/pandas/tests/test_format.py
index c08eb1437..5f5dd666e 100644
--- a/pandas/tests/test_format.py
+++ b/pandas/tests/test_format.py
@@ -238,6 +238,60 @@ class TestDataFrameFormatting(unittest.TestCase):
 </table>"""
         self.assertEquals(result, expected)
 
+        df = DataFrame([[0, 1], [2, 3], [4, 5], [6, 7]],
+                       columns=index[::2], index=index)
+
+        result = df.to_html()
+        expected = """\
+<table border="1" class="dataframe">
+  <thead>
+    <tr>
+      <th></th>
+      <th>foo</th>
+      <th>0</th>
+      <th>1</th>
+    </tr>
+    <tr>
+      <th></th>
+      <th></th>
+      <th>0</th>
+      <th>0</th>
+    </tr>
+    <tr>
+      <th>foo</th>
+      <th></th>
+      <th></th>
+      <th></th>
+    </tr>
+  </thead>
+  <tbody>
+    <tr>
+      <td rowspan="2" valign="top"><strong>0</strong></td>
+      <td><strong>0</strong></td>
+      <td> 0</td>
+      <td> 1</td>
+    </tr>
+    <tr>
+      <td><strong>1</strong></td>
+      <td> 2</td>
+      <td> 3</td>
+    </tr>
+    <tr>
+      <td rowspan="2" valign="top"><strong>1</strong></td>
+      <td><strong>0</strong></td>
+      <td> 4</td>
+      <td> 5</td>
+    </tr>
+    <tr>
+      <td><strong>1</strong></td>
+      <td> 6</td>
+      <td> 7</td>
+    </tr>
+  </tbody>
+</table>"""
+        self.assertEquals(result, expected)
+
+
     def test_nonunicode_nonascii_alignment(self):
         df = DataFrame([["aa\xc3\xa4\xc3\xa4", 1], ["bbbb", 2]])
         rep_str = df.to_string()
