commit 9754f4d800d676ca5c1f29dcb678fbf4d7825f7d
Author: y-p <yoval@gmx.com>
Date:   Tue Mar 12 16:43:04 2013 +0200

    TST:  Don't segfault when categorical groupby differs in length from series, GH3011

diff --git a/pandas/tests/test_groupby.py b/pandas/tests/test_groupby.py
index 4b1770dd4..d276e2e90 100644
--- a/pandas/tests/test_groupby.py
+++ b/pandas/tests/test_groupby.py
@@ -2237,6 +2237,15 @@ class TestGroupBy(unittest.TestCase):
         got_dt = result.dtype
         self.assert_(issubclass(got_dt.type, np.datetime64))
 
+    def test_groupby_categorical_unequal_len(self):
+        import pandas as pd
+        #GH3011
+        series = Series([np.nan, np.nan, 1, 1, 2, 2, 3, 3, 4, 4])
+        bins =  pd.cut(series.dropna(), 4)
+
+        # len(bins) != len(series) here
+        self.assertRaises(AssertionError,lambda : series.groupby(bins).mean())
+
 def assert_fp_equal(a, b):
     assert((np.abs(a - b) < 1e-12).all())
 
