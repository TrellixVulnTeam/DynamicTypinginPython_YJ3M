commit 89a61e58ee9f3ec816b6cbb146c341a36c15ae49
Author: Chang She <changshe@gmail.com>
Date:   Mon Sep 17 22:47:30 2012 -0400

    Have PeriodIndex override asof_locs to cleanup series.asof

diff --git a/pandas/core/series.py b/pandas/core/series.py
index 5bcf0c407..8f4435cb3 100644
--- a/pandas/core/series.py
+++ b/pandas/core/series.py
@@ -2537,18 +2537,16 @@ copy : boolean, default False
             where = datetools.to_datetime(where)
 
         values = self.values
-        time_index = self.index
-        is_periodindex = isinstance(self.index, PeriodIndex)
-        if is_periodindex:
-            time_index = Index(self.index.values)
 
         if not hasattr(where, '__iter__'):
-            if is_periodindex:
+            start = self.index[0]
+            if isinstance(self.index, PeriodIndex):
                 where = Period(where, freq=self.index.freq).ordinal
+                start = start.ordinal
 
-            if where < time_index[0]:
+            if where < start:
                 return np.nan
-            loc = time_index.searchsorted(where, side='right')
+            loc = self.index.searchsorted(where, side='right')
             if loc > 0:
                 loc -= 1
             while isnull(values[loc]) and loc > 0:
@@ -2558,16 +2556,7 @@ copy : boolean, default False
         if not isinstance(where, Index):
             where = Index(where)
 
-        where_index = where
-        if is_periodindex:
-            if isinstance(where_index, DatetimeIndex):
-                where_index = PeriodIndex(where_index.values,
-                                          freq=self.index.freq)
-
-            if isinstance(where_index, PeriodIndex):
-                where_index = Index(where_index.values)
-
-        locs = time_index.asof_locs(where_index, notnull(values))
+        locs = self.index.asof_locs(where, notnull(values))
         new_values = com.take_1d(values, locs)
         return Series(new_values, index=where, name=self.name)
 
diff --git a/pandas/tseries/period.py b/pandas/tseries/period.py
index c81cd595b..af3894fa2 100644
--- a/pandas/tseries/period.py
+++ b/pandas/tseries/period.py
@@ -632,6 +632,26 @@ class PeriodIndex(Int64Index):
         f = lambda x: Period(ordinal=x, freq=self.freq)
         return lib.map_infer(values, f)
 
+    def asof_locs(self, where, mask):
+        """
+        where : array of timestamps
+        mask : array of booleans where data is not NA
+
+        """
+        where_idx = where
+        if isinstance(where_idx, DatetimeIndex):
+            where_idx = PeriodIndex(where_idx.values, freq=self.freq)
+
+        locs = self.values[mask].searchsorted(where_idx.values, side='right')
+
+        locs = np.where(locs > 0, locs - 1, 0)
+        result = np.arange(len(self))[mask].take(locs)
+
+        first = mask.argmax()
+        result[(locs == 0) & (where_idx.values < self.values[first])] = -1
+
+        return result
+
     @property
     def asobject(self):
         from pandas.core.index import Index
