commit 6e460991a8bea3f5caaa0e9bd37c61fa480f1e80
Author: Chang She <chang@lambdafoundry.com>
Date:   Mon Jun 4 21:55:22 2012 -0400

    BUG: buffer access out of bounds with roll_generic on empty

diff --git a/pandas/src/moments.pyx b/pandas/src/moments.pyx
index 00855f7f7..886332797 100644
--- a/pandas/src/moments.pyx
+++ b/pandas/src/moments.pyx
@@ -696,6 +696,9 @@ def roll_generic(ndarray[float64_t, cast=True] input, int win,
     buf = <float64_t*> input.data
 
     n = len(input)
+    if n == 0:
+        return input
+
     minp = _check_minp(minp, n)
     output = np.empty(n, dtype=float)
     counts = roll_sum(np.isfinite(input).astype(float), win, minp)
diff --git a/pandas/stats/tests/test_moments.py b/pandas/stats/tests/test_moments.py
index 9c44047e7..ff13385e5 100644
--- a/pandas/stats/tests/test_moments.py
+++ b/pandas/stats/tests/test_moments.py
@@ -8,7 +8,7 @@ from numpy.random import randn
 import numpy as np
 
 from pandas import Series, DataFrame, bdate_range
-from pandas.util.testing import assert_almost_equal
+from pandas.util.testing import assert_almost_equal, assert_series_equal
 import pandas.core.datetools as datetools
 import pandas.stats.moments as mom
 import pandas.util.testing as tm
@@ -73,6 +73,9 @@ class TestMoments(unittest.TestCase):
             self._check_moment_func(f, alt)
 
     def test_rolling_apply(self):
+        ser = Series([])
+        assert_series_equal(ser, mom.rolling_apply(ser, 10, lambda x:x.mean()))
+
         def roll_mean(x, window, min_periods=None, freq=None):
             return mom.rolling_apply(x, window,
                                          lambda x: x[np.isfinite(x)].mean(),
