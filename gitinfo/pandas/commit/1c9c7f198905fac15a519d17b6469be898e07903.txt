commit 1c9c7f198905fac15a519d17b6469be898e07903
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Wed Jan 18 20:03:39 2012 -0500

    BLD: use AsEncodedString more properly

diff --git a/pandas/src/numpy_helper.h b/pandas/src/numpy_helper.h
index 53490c65e..10cc9bc21 100644
--- a/pandas/src/numpy_helper.h
+++ b/pandas/src/numpy_helper.h
@@ -76,11 +76,14 @@ get_value_1d(PyArrayObject* ap, Py_ssize_t i) {
 PANDAS_INLINE char*
 get_c_string(PyObject* obj) {
 #if PY_VERSION_HEX >= 0x03000000
-  PyObject* enc_str = PyUnicode_AsEncodedString(obj);
+  PyObject* enc_str = PyUnicode_AsEncodedString(obj, "utf-8", "error");
+
   char *ret;
   ret = PyBytes_AS_STRING(enc_str);
 
-  Py_XDECREF(enc_str);
+  // TODO: memory leak here
+
+  // Py_XDECREF(enc_str);
   return ret;
 #else
   return PyString_AsString(obj);
