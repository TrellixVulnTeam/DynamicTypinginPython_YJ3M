commit cc463925b7b5991ec3e900c1c68f09e66dcc31a8
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Mon Dec 12 00:19:25 2011 -0500

    ENH: rolling_corr_pairwise function re: #189

diff --git a/RELEASE.rst b/RELEASE.rst
index 113b81e65..b11e2dcff 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -54,6 +54,8 @@ pandas 0.6.1
   - Implement DataFrame.from_items alternate constructor (GH #444)
   - DataFrame.convert_objects method for inferring better dtypes for object
     columns (GH #302)
+  - Add rolling_corr_pairwise function for computing Panel of correlation
+    matrices (GH #189)
 
 **Improvements to existing features**
 
diff --git a/pandas/stats/moments.py b/pandas/stats/moments.py
index 97c067feb..5b57f3b0e 100644
--- a/pandas/stats/moments.py
+++ b/pandas/stats/moments.py
@@ -16,6 +16,7 @@ __all__ = ['rolling_count', 'rolling_max', 'rolling_min',
            'rolling_sum', 'rolling_mean', 'rolling_std', 'rolling_cov',
            'rolling_corr', 'rolling_var', 'rolling_skew', 'rolling_kurt',
            'rolling_quantile', 'rolling_median', 'rolling_apply',
+           'rolling_corr_pairwise',
            'ewma', 'ewmvar', 'ewmstd', 'ewmvol', 'ewmcorr', 'ewmcov']
 
 def rolling_count(arg, window, time_rule=None):
@@ -87,6 +88,34 @@ def _flex_binary_moment(arg1, arg2, f):
     else:
         return _flex_binary_moment(arg2, arg1, f)
 
+def rolling_corr_pairwise(df, window, min_periods=None):
+    """
+    Computes pairwise rolling correlation matrices as Panel whose items are
+    dates
+
+    Parameters
+    ----------
+    df : DataFrame
+    window : int
+    min_periods : int, default None
+
+    Returns
+    -------
+    correls : Panel
+    """
+    from pandas import Panel
+    from collections import defaultdict
+
+    all_results = defaultdict(dict)
+
+    for i, k1 in enumerate(df.columns):
+        for k2 in df.columns[i:]:
+            corr = rolling_corr(df[k1], df[k2], window,
+                                min_periods=min_periods)
+            all_results[k1][k2] = corr
+            all_results[k2][k1] = corr
+
+    return Panel.from_dict(all_results).swapaxes('items', 'major')
 
 def _rolling_moment(arg, window, func, minp, axis=0, time_rule=None):
     """
diff --git a/pandas/stats/tests/test_moments.py b/pandas/stats/tests/test_moments.py
index ace7f3fc1..738abacb6 100644
--- a/pandas/stats/tests/test_moments.py
+++ b/pandas/stats/tests/test_moments.py
@@ -252,6 +252,14 @@ class TestMoments(unittest.TestCase):
         result = mom.rolling_corr(a, b, len(a), min_periods=1)
         assert_almost_equal(result[-1], a.corr(b))
 
+    def test_rolling_corr_pairwise(self):
+        panel = mom.rolling_corr_pairwise(self.frame, 10, min_periods=5)
+
+        correl = panel.ix[:, 1, 5]
+        exp = mom.rolling_corr(self.frame[1], self.frame[5],
+                               10, min_periods=5)
+        tm.assert_series_equal(correl, exp)
+
     def test_flex_binary_frame(self):
         def _check(method):
             series = self.frame[1]
