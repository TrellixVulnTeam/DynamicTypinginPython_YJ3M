commit 2e4da9b07d500add644257b9fa317a668cf5e332
Author: Sangmin Park <sangmin.park@twosigma.com>
Date:   Fri Feb 26 23:04:52 2016 -0500

    ERR: Better error reporting with .transform and an invalid output
    
    closes #10165
    closes #12474

diff --git a/doc/source/whatsnew/v0.18.0.txt b/doc/source/whatsnew/v0.18.0.txt
index 4873a2029..03227b197 100644
--- a/doc/source/whatsnew/v0.18.0.txt
+++ b/doc/source/whatsnew/v0.18.0.txt
@@ -865,6 +865,7 @@ Other API Changes
 - ``.to_latex`` and ``.to_html`` gain a ``decimal`` parameter like ``.to_csv``; the default is ``'.'`` (:issue:`12031`)
 - More helpful error message when constructing a ``DataFrame`` with empty data but with indices (:issue:`8020`)
 - ``.describe()`` will now properly handle bool dtype as a categorical (:issue:`6625`)
+- More helpful error message invalid ``.transform`` with user defined input (:issue:`10165`)
 
 .. _whatsnew_0180.deprecations:
 
diff --git a/doc/source/whatsnew/v0.18.1.txt b/doc/source/whatsnew/v0.18.1.txt
index 8c66cd0c1..70a1ad4a3 100644
--- a/doc/source/whatsnew/v0.18.1.txt
+++ b/doc/source/whatsnew/v0.18.1.txt
@@ -43,4 +43,3 @@ Performance Improvements
 
 Bug Fixes
 ~~~~~~~~~
-
diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index 06f3e0409..442f21328 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -3346,9 +3346,9 @@ class NDFrameGroupBy(GroupBy):
                     path, res = self._choose_path(fast_path, slow_path, group)
                 except TypeError:
                     return self._transform_item_by_item(obj, fast_path)
-                except Exception:  # pragma: no cover
-                    res = fast_path(group)
-                    path = fast_path
+                except ValueError:
+                    msg = 'transform must return a scalar value for each group'
+                    raise ValueError(msg)
             else:
                 res = path(group)
 
diff --git a/pandas/tests/test_groupby.py b/pandas/tests/test_groupby.py
index 7ee40a775..89ef4decf 100644
--- a/pandas/tests/test_groupby.py
+++ b/pandas/tests/test_groupby.py
@@ -6104,6 +6104,21 @@ class TestGroupBy(tm.TestCase):
         expected = pd.Series([1] * 5, name='name', index=index)
         tm.assert_series_equal(result, expected)
 
+    def test_transform_with_non_scalar_group(self):
+        # GH 10165
+        cols = pd.MultiIndex.from_tuples([
+            ('syn', 'A'), ('mis', 'A'), ('non', 'A'),
+            ('syn', 'C'), ('mis', 'C'), ('non', 'C'),
+            ('syn', 'T'), ('mis', 'T'), ('non', 'T'),
+            ('syn', 'G'), ('mis', 'G'), ('non', 'G')])
+        df = pd.DataFrame(np.random.randint(1, 10, (4, 12)),
+                          columns=cols,
+                          index=['A', 'C', 'G', 'T'])
+        self.assertRaisesRegexp(ValueError, 'transform must return a scalar '
+                                'value for each group.*', df.groupby
+                                (axis=1, level=1).transform,
+                                lambda z: z.div(z.sum(axis=1), axis=0))
+
 
 def assert_fp_equal(a, b):
     assert (np.abs(a - b) < 1e-12).all()
