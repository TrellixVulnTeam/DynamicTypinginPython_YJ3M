commit 7eaf5ca6daec0159c8d7df344579012e12758ee3
Author: MinRK <benjaminrk@gmail.com>
Date:   Thu Aug 23 11:22:31 2012 -0700

    undo dumb setuptools bug clobbering .pyx sources back to .c
    
    setuptools (not distribute) will replace '.pyx' extensions with '.c'
    if *pyrex* is not importable.  This checks if that happened,
    and reverses it if so.
    
    closes #1805

diff --git a/setup.py b/setup.py
index 7edb5d268..50ff7279b 100755
--- a/setup.py
+++ b/setup.py
@@ -403,6 +403,14 @@ extensions = [algos_ext, lib_ext, period_ext, sparse_ext]
 if not ISRELEASED:
     extensions.extend([sandbox_ext])
 
+if suffix == '.pyx' and 'setuptools' in sys.modules:
+    # undo dumb setuptools bug clobbering .pyx sources back to .c
+    for ext in extensions:
+        if ext.sources[0].endswith('.c'):
+            root, _ = os.path.splitext(ext.sources[0])
+            ext.sources[0] = root + suffix
+
+
 # if _have_setuptools:
 #     setuptools_kwargs["test_suite"] = "nose.collector"
 
