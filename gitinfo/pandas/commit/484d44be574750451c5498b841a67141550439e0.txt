commit 484d44be574750451c5498b841a67141550439e0
Author: Chang She <chang@lambdafoundry.com>
Date:   Tue Apr 2 14:01:50 2013 -0700

    BUG: week of year fix around leap years #2768

diff --git a/pandas/tseries/tests/test_timeseries.py b/pandas/tseries/tests/test_timeseries.py
index 3d50bbc4d..6073811b9 100644
--- a/pandas/tseries/tests/test_timeseries.py
+++ b/pandas/tseries/tests/test_timeseries.py
@@ -1270,6 +1270,10 @@ class TestTimeSeries(unittest.TestCase):
         expected = 53 # ISO standard
         self.assertEqual(result, expected)
 
+        result = np.array([Timestamp(datetime(*args)).week for args in
+                           [(2000,1,1),(2000,1,2),(2005,1,1),(2005,1,2)]])
+        self.assertTrue((result == [52, 52, 53, 53]).all())
+
     def test_timestamp_date_out_of_range(self):
         self.assertRaises(ValueError, Timestamp, '1676-01-01')
         self.assertRaises(ValueError, Timestamp, '2263-01-01')
diff --git a/pandas/tslib.pyx b/pandas/tslib.pyx
index 9730f5696..329c565fc 100644
--- a/pandas/tslib.pyx
+++ b/pandas/tslib.pyx
@@ -1666,7 +1666,7 @@ def get_date_field(ndarray[int64_t] dtindex, object field):
         Py_ssize_t i, count = 0
         ndarray[int32_t] out
         ndarray[int32_t, ndim=2] _month_offset
-        int isleap
+        int isleap, isleap_prev
         pandas_datetimestruct dts
         int mo_off, doy, dow, woy
 
@@ -1764,6 +1764,7 @@ def get_date_field(ndarray[int64_t] dtindex, object field):
             pandas_datetime_to_datetimestruct(dtindex[i], PANDAS_FR_ns, &dts)
             ts = convert_to_tsobject(dtindex[i], None)
             isleap = is_leapyear(dts.year)
+            isleap_prev = is_leapyear(dts.year - 1)
             mo_off = _month_offset[isleap, dts.month - 1]
             doy = mo_off + dts.day
             dow = ts_dayofweek(ts)
@@ -1775,7 +1776,7 @@ def get_date_field(ndarray[int64_t] dtindex, object field):
 
             # verify
             if woy < 0:
-                if (woy > -2) or (woy == -2 and isleap):
+                if (woy > -2) or (woy == -2 and isleap_prev):
                     woy = 53
                 else:
                     woy = 52
