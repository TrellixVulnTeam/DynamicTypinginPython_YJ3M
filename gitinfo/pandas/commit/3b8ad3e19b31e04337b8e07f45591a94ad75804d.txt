commit 3b8ad3e19b31e04337b8e07f45591a94ad75804d
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Mon Dec 12 19:59:43 2011 -0500

    BUG: handling of grand margin when no columns passed, GH #114

diff --git a/RELEASE.rst b/RELEASE.rst
index 2229a2fe7..2218193a1 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -56,6 +56,8 @@ pandas 0.6.1
     columns (GH #302)
   - Add rolling_corr_pairwise function for computing Panel of correlation
     matrices (GH #189)
+  - Add `margins` option to `pivot_table` for computing subgroup aggregates (GH
+    #114)
 
 **Improvements to existing features**
 
diff --git a/pandas/tools/pivot.py b/pandas/tools/pivot.py
index 582ec5489..7bc364243 100644
--- a/pandas/tools/pivot.py
+++ b/pandas/tools/pivot.py
@@ -139,7 +139,10 @@ def _add_margins(table, data, values, rows=None, cols=None, aggfunc=np.mean):
     row_margin = row_margin.reindex(result.columns)
     # populate grand margin
     for k in margin_keys:
-        row_margin[k] = grand_margin[k[0]]
+        if len(cols) > 0:
+            row_margin[k] = grand_margin[k[0]]
+        else:
+            row_margin[k] = grand_margin[k]
 
     margin_dummy = DataFrame(row_margin, columns=[key]).T
     result = result.append(margin_dummy)
diff --git a/pandas/tools/tests/test_pivot.py b/pandas/tools/tests/test_pivot.py
index 27caa7abe..9397b1564 100644
--- a/pandas/tools/tests/test_pivot.py
+++ b/pandas/tools/tests/test_pivot.py
@@ -86,7 +86,10 @@ class TestPivotTable(unittest.TestCase):
             _check_output(table[valcol], valcol)
 
         # no col
-        table = self.data.pivot_table(rows=['A', 'B'], margins=True,
+
+        # to help with a buglet
+        self.data.columns = [k * 2 for k in self.data.columns]
+        table = self.data.pivot_table(rows=['AA', 'BB'], margins=True,
                                       aggfunc=np.mean)
         for valcol in table.columns:
             gmarg = table[valcol]['All', '']
