commit 329fdaae294ae3dc45d4d7301f0f1eec2d26cb4b
Author: DSM <dsm054@gmail.com>
Date:   Sun Jul 2 13:38:58 2017 -0400

    TST: Verify that positional shifting works with duplicate columns (#9092) (#16810)

diff --git a/pandas/tests/frame/test_timeseries.py b/pandas/tests/frame/test_timeseries.py
index 143a7ea8f..aaca8a60f 100644
--- a/pandas/tests/frame/test_timeseries.py
+++ b/pandas/tests/frame/test_timeseries.py
@@ -266,6 +266,28 @@ class TestDataFrameTimeSeriesMethods(TestData):
 
         assert_frame_equal(df, rs)
 
+    def test_shift_duplicate_columns(self):
+        # GH 9092; verify that position-based shifting works
+        # in the presence of duplicate columns
+        column_lists = [list(range(5)), [1] * 5, [1, 1, 2, 2, 1]]
+        data = np.random.randn(20, 5)
+
+        shifted = []
+        for columns in column_lists:
+            df = pd.DataFrame(data.copy(), columns=columns)
+            for s in range(5):
+                df.iloc[:, s] = df.iloc[:, s].shift(s + 1)
+            df.columns = range(5)
+            shifted.append(df)
+
+        # sanity check the base case
+        nulls = shifted[0].isnull().sum()
+        assert_series_equal(nulls, Series(range(1, 6), dtype='int64'))
+
+        # check all answers are the same
+        assert_frame_equal(shifted[0], shifted[1])
+        assert_frame_equal(shifted[0], shifted[2])
+
     def test_tshift(self):
         # PeriodIndex
         ps = tm.makePeriodFrame()
