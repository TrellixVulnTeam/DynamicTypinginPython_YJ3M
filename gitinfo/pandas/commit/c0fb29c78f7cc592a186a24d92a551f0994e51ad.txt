commit c0fb29c78f7cc592a186a24d92a551f0994e51ad
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Wed Feb 8 17:38:34 2012 -0500

    BUG: fix subtle bug in maybe_convert_objects causing indexes to be mutated, test coverage, fix #766

diff --git a/pandas/core/frame.py b/pandas/core/frame.py
index 948e717f7..0dbb9abda 100644
--- a/pandas/core/frame.py
+++ b/pandas/core/frame.py
@@ -2943,13 +2943,9 @@ class DataFrame(NDFrame):
                 for k, v in series_gen:
                     results[k] = func(v)
             except Exception, e:
-                try:
-                    if hasattr(e, 'args'):
-                        e.args = e.args + ('occurred at index %s' % str(k),)
-                except UnboundLocalError:
-                    raise e
-                else:
-                    raise
+                if hasattr(e, 'args'):
+                    e.args = e.args + ('occurred at index %s' % str(k),)
+                raise
 
         if len(results) > 0 and _is_sequence(results.values()[0]):
             if not isinstance(results.values()[0], Series):
diff --git a/pandas/src/inference.pyx b/pandas/src/inference.pyx
index 7a20d196b..0c75a65a2 100644
--- a/pandas/src/inference.pyx
+++ b/pandas/src/inference.pyx
@@ -258,7 +258,6 @@ def maybe_convert_objects(ndarray[object] objects, bint try_float=0):
 
         if val is None:
             seen_null = 1
-            objects[i] = onan
             floats[i] = fnan
         elif util.is_bool_object(val):
             seen_bool = 1
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index a5cd0df43..cac76fe09 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -351,6 +351,12 @@ class CheckIndexing(object):
         self.assert_(df['z'] is not foo)
         assert_series_equal(df['z'], expected)
 
+    def test_setitem_None(self):
+        # GH #766
+        self.frame[None] = self.frame['A']
+        assert_series_equal(self.frame[None], self.frame['A'])
+        repr(self.frame)
+
     def test_delitem_corner(self):
         f = self.frame.copy()
         del f['D']
diff --git a/pandas/tests/test_index.py b/pandas/tests/test_index.py
index 0f54dbcb2..998c7ff03 100644
--- a/pandas/tests/test_index.py
+++ b/pandas/tests/test_index.py
@@ -301,6 +301,13 @@ class TestIndex(unittest.TestCase):
         self.assert_(len(result) == 2)
         self.assertEquals(result, expected)
 
+    def test_format_none(self):
+        values = ['a', 'b', 'c', None]
+
+        idx = Index(values)
+        idx.format()
+        self.assert_(idx[3] is None)
+
     def test_take(self):
         indexer = [4, 3, 0, 2]
         result = self.dateIndex.take(indexer)
