commit 31ea45f8a354535f56524cc719e53690c89df738
Author: patrick <61934744+phofl@users.noreply.github.com>
Date:   Fri Apr 10 22:47:57 2020 +0200

    BUG: Add test to ensure, that bug will not occur again. #33058 (#33072)

diff --git a/pandas/tests/groupby/test_apply.py b/pandas/tests/groupby/test_apply.py
index 9fbcced75..9fcbabb07 100644
--- a/pandas/tests/groupby/test_apply.py
+++ b/pandas/tests/groupby/test_apply.py
@@ -880,3 +880,24 @@ def test_apply_function_index_return(function):
         index=pd.Index([1, 2, 3], name="id"),
     )
     tm.assert_series_equal(result, expected)
+
+
+def test_apply_function_with_indexing():
+    # GH: 33058
+    df = pd.DataFrame(
+        {"col1": ["A", "A", "A", "B", "B", "B"], "col2": [1, 2, 3, 4, 5, 6]}
+    )
+
+    def fn(x):
+        x.col2[x.index[-1]] = 0
+        return x.col2
+
+    result = df.groupby(["col1"], as_index=False).apply(fn)
+    expected = pd.Series(
+        [1, 2, 0, 4, 5, 0],
+        index=pd.MultiIndex.from_tuples(
+            [(0, 0), (0, 1), (0, 2), (1, 3), (1, 4), (1, 5)]
+        ),
+        name="col2",
+    )
+    tm.assert_series_equal(result, expected)
