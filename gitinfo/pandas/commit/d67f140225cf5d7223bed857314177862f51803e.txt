commit d67f140225cf5d7223bed857314177862f51803e
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Thu Jan 26 11:39:45 2012 -0500

    BUG: unbox 0-dimensional arrays in map_infer, GH #690

diff --git a/pandas/src/inference.pyx b/pandas/src/inference.pyx
index 65b07e979..88bb3314c 100644
--- a/pandas/src/inference.pyx
+++ b/pandas/src/inference.pyx
@@ -83,10 +83,6 @@ def infer_dtype_list(list values):
 cdef inline bint is_datetime(object o):
     return PyDateTime_Check(o)
 
-cpdef is_array(object o):
-    return np.PyArray_Check(o)
-
-
 def is_bool_array(ndarray values):
     cdef:
         Py_ssize_t i, n = len(values)
@@ -401,8 +397,16 @@ def map_infer(ndarray arr, object f):
     n = len(arr)
     result = np.empty(n, dtype=object)
     for i in range(n):
-        val = PyArray_GETITEM(arr, PyArray_ITER_DATA(it))
-        result[i] = f(val)
+        val = f(PyArray_GETITEM(arr, PyArray_ITER_DATA(it)))
+
+        # unbox 0-dim arrays, GH #690
+        if is_array(val) and PyArray_NDIM(val) == 0:
+            # is there a faster way to unbox?
+            val = val.item()
+
+        result[i] = val
+
+
         PyArray_ITER_NEXT(it)
 
     return maybe_convert_objects(result, try_float=0)
diff --git a/pandas/src/tseries.pyx b/pandas/src/tseries.pyx
index e189498da..cc43640a3 100644
--- a/pandas/src/tseries.pyx
+++ b/pandas/src/tseries.pyx
@@ -24,6 +24,7 @@ cdef inline int int_min(int a, int b): return a if a <= b else b
 ctypedef unsigned char UChar
 
 cimport util
+from util cimport is_array
 
 cdef extern from "math.h":
     double sqrt(double x)
diff --git a/pandas/src/util.pxd b/pandas/src/util.pxd
index 12fe0d6dc..3730c72ce 100644
--- a/pandas/src/util.pxd
+++ b/pandas/src/util.pxd
@@ -49,3 +49,5 @@ cdef inline set_value_at(ndarray arr, object loc, object value):
 cdef inline int is_contiguous(ndarray arr):
     return cnp.PyArray_CHKFLAGS(arr, cnp.NPY_C_CONTIGUOUS)
 
+cdef inline is_array(object o):
+    return cnp.PyArray_Check(o)
diff --git a/pandas/tests/test_series.py b/pandas/tests/test_series.py
index 329dacd9f..92d1c078c 100644
--- a/pandas/tests/test_series.py
+++ b/pandas/tests/test_series.py
@@ -1667,6 +1667,11 @@ class TestSeries(unittest.TestCase, CheckNameIntegration):
         self.assert_(isnull(merged['d']))
         self.assert_(not isnull(merged['c']))
 
+    def test_map_type_inference(self):
+        s = Series(range(3))
+        s2 = s.map(lambda x: np.where(x == 0, 0, 1))
+        self.assert_(issubclass(s2.dtype.type, np.integer))
+
     def test_map_decimal(self):
         from decimal import Decimal
 
