commit f9f97eb4126f538e845aeaf8920ea8b1706832a7
Author: Joris Van den Bossche <jorisvandenbossche@gmail.com>
Date:   Sun Aug 2 23:55:26 2015 +0200

    DOC: limit error traceback to one line for expected exceptions (GH10715)

diff --git a/doc/sphinxext/ipython_sphinxext/ipython_directive.py b/doc/sphinxext/ipython_sphinxext/ipython_directive.py
index 3f9be9560..08fc53e43 100644
--- a/doc/sphinxext/ipython_sphinxext/ipython_directive.py
+++ b/doc/sphinxext/ipython_sphinxext/ipython_directive.py
@@ -461,10 +461,6 @@ class EmbeddedSphinxShell(object):
 
         self.cout.seek(0)
         output = self.cout.read()
-        if not is_suppress and not is_semicolon:
-            ret.append(output)
-        elif is_semicolon: # get spacing right
-            ret.append('')
 
         # context information
         filename = self.state.document.current_source
@@ -494,6 +490,16 @@ class EmbeddedSphinxShell(object):
                 sys.stdout.write(s)
                 sys.stdout.write('<<<' + ('-' * 73) + '\n')
 
+        # if :okexcept: has been specified, display shorter traceback
+        if is_okexcept and "Traceback" in output:
+            traceback = output.split('\n\n')
+            output = traceback[-1]
+
+        if not is_suppress and not is_semicolon:
+            ret.append(output)
+        elif is_semicolon: # get spacing right
+            ret.append('')
+
         self.cout.truncate(0)
         return (ret, input_lines, output, is_doctest, decorator, image_file,
                     image_directive)
