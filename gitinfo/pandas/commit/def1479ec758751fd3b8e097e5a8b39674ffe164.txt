commit def1479ec758751fd3b8e097e5a8b39674ffe164
Author: Phillip Cloud <cpcloud@gmail.com>
Date:   Wed Apr 29 15:46:37 2015 -0400

    Ensure object on stata

diff --git a/pandas/io/stata.py b/pandas/io/stata.py
index 3972bad7b..eecc225d0 100644
--- a/pandas/io/stata.py
+++ b/pandas/io/stata.py
@@ -1626,7 +1626,7 @@ def _dtype_to_stata_type(dtype, column):
     elif dtype.type == np.object_:  # try to coerce it to the biggest string
                                     # not memory efficient, what else could we
                                     # do?
-        itemsize = max_len_string_array(column.values)
+        itemsize = max_len_string_array(com._ensure_object(column.values))
         return chr(max(itemsize, 1))
     elif dtype == np.float64:
         return chr(255)
@@ -1664,7 +1664,7 @@ def _dtype_to_default_stata_fmt(dtype, column):
         if not (inferred_dtype in ('string', 'unicode')
                 or len(column) == 0):
             raise ValueError('Writing general object arrays is not supported')
-        itemsize = max_len_string_array(column.values)
+        itemsize = max_len_string_array(com._ensure_object(column.values))
         if itemsize > 244:
             raise ValueError(excessive_string_length_error % column.name)
         return "%" + str(max(itemsize, 1)) + "s"
diff --git a/pandas/lib.pyx b/pandas/lib.pyx
index ab37514c5..2519ef7e3 100644
--- a/pandas/lib.pyx
+++ b/pandas/lib.pyx
@@ -903,21 +903,11 @@ def clean_index_list(list obj):
 ctypedef fused pandas_t:
     str
     unicode
-    float32_t
-    float64_t
-    uint8_t
-    uint16_t
-    uint32_t
-    uint64_t
-    int8_t
-    int16_t
-    int32_t
-    int64_t
 
 
 @cython.boundscheck(False)
 @cython.wraparound(False)
-def max_len_string_array(pandas_t[:] arr):
+cpdef Py_ssize_t max_len_string_array(pandas_t[:] arr):
     """ return the maximum size of elements in a 1-dim string array """
     cdef:
         Py_ssize_t i, m = 0, l = 0, length = arr.shape[0]
diff --git a/pandas/tests/test_lib.py b/pandas/tests/test_lib.py
index bb860269c..a963b8785 100644
--- a/pandas/tests/test_lib.py
+++ b/pandas/tests/test_lib.py
@@ -16,7 +16,7 @@ class TestMisc(tm.TestCase):
         self.assertTrue(max_len_string_array(arr),3)
 
         # unicode
-        arr = arr.astype('U')
+        arr = arr.astype('U').astype(object)
         self.assertTrue(max_len_string_array(arr),3)
 
 class TestIsscalar(tm.TestCase):
