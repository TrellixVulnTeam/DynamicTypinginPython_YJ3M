commit 4fe91e294b5c51d35d142601970f67ca5ec457ef
Author: Christopher C. Aycock <christopher.aycock@twosigma.com>
Date:   Tue Jan 17 08:42:42 2017 -0500

    BUG: Allow tolerance when left_index/right_index enabled for merge_asof() (#15135)
    
    closes #15135
    
    Author: Christopher C. Aycock <christopher.aycock@twosigma.com>
    
    Closes #15139 from chrisaycock/GH15135 and squashes the following commits:
    
    17c902a [Christopher C. Aycock] BUG: Allow tolerance when left_index/right_index enabled for merge_asof() (#15135)

diff --git a/doc/source/whatsnew/v0.20.0.txt b/doc/source/whatsnew/v0.20.0.txt
index 2a825edd0..1ae20803c 100644
--- a/doc/source/whatsnew/v0.20.0.txt
+++ b/doc/source/whatsnew/v0.20.0.txt
@@ -360,7 +360,7 @@ Bug Fixes
 - Bug in catching an overflow in ``Timestamp`` + ``Timedelta/Offset`` operations (:issue:`15126`)
 
 
-
+- Bug in ``pd.merge_asof()`` where ``left_index``/``right_index`` together caused a failure when ``tolerance`` was specified (:issue:`15135`)
 
 
 
diff --git a/pandas/tools/merge.py b/pandas/tools/merge.py
index 4012629aa..c756a61fa 100644
--- a/pandas/tools/merge.py
+++ b/pandas/tools/merge.py
@@ -1129,7 +1129,11 @@ class _AsOfMerge(_OrderedMerge):
         # validate tolerance; must be a Timedelta if we have a DTI
         if self.tolerance is not None:
 
-            lt = left_join_keys[-1]
+            if self.left_index:
+                lt = self.left.index
+            else:
+                lt = left_join_keys[-1]
+
             msg = "incompatible tolerance, must be compat " \
                   "with type {0}".format(type(lt))
 
diff --git a/pandas/tools/tests/test_merge_asof.py b/pandas/tools/tests/test_merge_asof.py
index bbbf1a3bd..e05cbd085 100644
--- a/pandas/tools/tests/test_merge_asof.py
+++ b/pandas/tools/tests/test_merge_asof.py
@@ -518,6 +518,19 @@ class TestAsOfMerge(tm.TestCase):
              'value2': list("BCDEE")})
         assert_frame_equal(result, expected)
 
+    def test_index_tolerance(self):
+        # GH 15135
+        expected = self.tolerance.set_index('time')
+        trades = self.trades.set_index('time')
+        quotes = self.quotes.set_index('time')
+
+        result = pd.merge_asof(trades, quotes,
+                               left_index=True,
+                               right_index=True,
+                               by='ticker',
+                               tolerance=pd.Timedelta('1day'))
+        assert_frame_equal(result, expected)
+
     def test_allow_exact_matches(self):
 
         result = merge_asof(self.trades, self.quotes,
