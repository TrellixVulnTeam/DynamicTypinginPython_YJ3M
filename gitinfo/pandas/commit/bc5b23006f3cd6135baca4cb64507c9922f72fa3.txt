commit bc5b23006f3cd6135baca4cb64507c9922f72fa3
Author: Wouter Overmeire <lodagro@gmail.com>
Date:   Wed Mar 14 10:52:34 2012 +0100

    BUG: close #911, fix df.set_value() failure when index dtype needs to change.

diff --git a/pandas/core/generic.py b/pandas/core/generic.py
index 7ab43b662..d8d2291da 100644
--- a/pandas/core/generic.py
+++ b/pandas/core/generic.py
@@ -358,7 +358,7 @@ class NDFrame(PandasObject):
         new_axes = []
         for k, ax in zip(key, self.axes):
             if k not in ax:
-                new_axes.append(np.concatenate([ax, [k]]))
+                new_axes.append(ax.insert(len(ax), k))
             else:
                 new_axes.append(ax)
 
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index 80014ff06..0136e33c1 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -912,6 +912,12 @@ class CheckIndexing(object):
         self.assert_(isnull(res3['baz'].drop(['foobar'])).values.all())
         self.assertRaises(ValueError, res3.set_value, 'foobar', 'baz', 'sam')
 
+    def test_set_value_with_index_dtype_change(self):
+        df = DataFrame(randn(3,3), index=range(3), columns=list('ABC'))
+        res = df.set_value('C', 2, 1.0)
+        self.assert_(list(res.index) == list(df.index) + ['C'])
+        self.assert_(list(res.columns) == list(df.columns) + [2])
+
     def test_get_set_value_no_partial_indexing(self):
         # partial w/ MultiIndex raise exception
         index = MultiIndex.from_tuples([(0, 1), (0, 2), (1, 1), (1, 2)])
