commit 2c7a45a6c6360f24bc1f0a9a9f0bfaf062035a57
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sun Mar 4 14:51:29 2012 -0500

    ENH: don't use self.groups in groupby.size(), GH #860

diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index b6f8450e2..08b834d5f 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -484,16 +484,12 @@ class Grouper(object):
         """
         Compute group sizes
         """
-        result = sorted((k, len(v)) for k, v in self.groups.iteritems())
-        keys, values = zip(*result)
-
-        if len(self.groupings) > 1:
-            names = [ping.name for ping in self.groupings]
-            index = MultiIndex.from_tuples(keys, names=names)
-        else:
-            index = Index(keys, name=self.groupings[0].name)
-
-        return Series(values, index=index)
+        # TODO: better impl
+        labels, _, ngroups = self.group_info
+        bin_counts = Series(labels).value_counts()
+        bin_counts = bin_counts.reindex(np.arange(ngroups))
+        bin_counts.index = self.result_index
+        return bin_counts
 
     @cache_readonly
     def groups(self):
diff --git a/vb_suite/groupby.py b/vb_suite/groupby.py
index 3138a2518..eec08ee86 100644
--- a/vb_suite/groupby.py
+++ b/vb_suite/groupby.py
@@ -97,3 +97,17 @@ groupby_multi_different_numpy_functions = \
                                                    'value2' : np.var,
                                                    'value3' : np.sum})""",
               setup, start_date=datetime(2011, 9, 1))
+
+#----------------------------------------------------------------------
+# size() speed
+
+setup = common_setup + """
+df = DataFrame({'key1': np.random.randint(0, 100, size=100000),
+                'key2': np.random.randint(0, 100, size=100000),
+                'value1' : np.random.randn(100000),
+                'value2' : np.random.randn(100000),
+                'value3' : np.random.randn(100000)})
+"""
+
+groupby_multi_size = Benchmark("df.groupby(['key1', 'key2']).size()",
+                               setup, start_date=datetime(2011, 10, 1))
