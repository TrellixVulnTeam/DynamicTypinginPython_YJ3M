commit fbe6e035e77d5c6ca826a1f8c015e06e91c4915d
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Tue Feb 2 21:17:01 2010 +0000

    adjustments to platform independent make.py
    
    git-svn-id: http://pandas.googlecode.com/svn/trunk@122 d5231056-7de3-11de-ac95-d976489f1ece

diff --git a/doc/make.py b/doc/make.py
index 5492a8b2a..57ba09d24 100755
--- a/doc/make.py
+++ b/doc/make.py
@@ -13,56 +13,71 @@ python make.py clean
 python make.py html
 """
 
+import glob
 import os
 import shutil
 import sys
+import sphinx
+
+SPHINX_BUILD = 'sphinxbuild'
+NEED_AUTOSUMMARY = sphinx.__version__ < 0.7
 
 def sf():
     'push a copy to the sf site'
-    os.system('cd build/html; rsync -avz . wesmckinn,pandas@web.sf.net:/home/groups/p/pa/pandas/htdocs/ -essh --cvs-exclude')
+    os.system('cd build/html; rsync -avz . wesmckinn,pandas@web.sf.net'
+              ':/home/groups/p/pa/pandas/htdocs/ -essh --cvs-exclude')
 
 def clean():
-    os.system('make clean')
+    if os.path.exists('build'):
+        shutil.rmtree('build')
 
-def html():
-    os.system('make html')
+    if os.path.exists('source/generated'):
+        shutil.rmtree('source/generated')
 
-def latex():
+def html():
     check_build()
-    # Produce pdf.
-    os.chdir('../build/latex')
-
-    # first call to pdflatex used to generate .idx files
-    os.system('pdflatex pandas.tex')
-
-    # convert .idx files to indices
-    os.system('makeindex -s python.ist pandas.idx')
-    os.system('makeindex -s python.ist modpandas.idx')
-
-    # regenerate pdf with proper indices
-    os.system('pdflatex pandas.tex')
-
-    os.chdir('../..')
+    if os.system('sphinx-build -P -b html -d build/doctrees '
+                 'source build/html'):
+        raise SystemExit("Building HTML failed.")
+
+def check_build():
+    build_dirs = [
+        'build', 'build/doctrees', 'build/html',
+        'build/latex', 'build/plots', 'build/_static',
+        'build/_templates']
+    for d in build_dirs:
+        try:
+            os.mkdir(d)
+        except OSError:
+            pass
+
+    if NEED_AUTOSUMMARY:
+        generate_autosummary()
+
+def generate_autosummary():
+    as_gen = "python ./sphinxext/autosummary_generate.py "
+    as_cmd = as_gen + "%s -p dump.xml -o source/generated"
+
+    for path in glob.glob('source/*.rst'):
+        if os.system(as_cmd % path):
+            raise SystemExit("Failed to auto generate "
+                             "summary for %s" % path)
 
 def all():
     clean()
     html()
-#    latex()
 
 funcd = {
     'html'     : html,
-    'latex'    : latex,
     'clean'    : clean,
     'sf'       : sf,
     'all'      : all,
     }
 
-
 small_docs = False
 
-# Change directory to the one containing this file
-current_dir = os.getcwd()
-os.chdir(os.path.dirname(os.path.join(current_dir, __file__)))
+# current_dir = os.getcwd()
+# os.chdir(os.path.dirname(os.path.join(current_dir, __file__)))
 
 if len(sys.argv)>1:
     for arg in sys.argv[1:]:
@@ -74,4 +89,4 @@ if len(sys.argv)>1:
 else:
     small_docs = False
     all()
-os.chdir(current_dir)
+#os.chdir(current_dir)
