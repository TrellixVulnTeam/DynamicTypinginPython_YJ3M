commit 3783ccc694ef93c0cf159ca1ad8e69a67d828bf0
Author: Yimeng Zhang <zym1010@gmail.com>
Date:   Tue Mar 13 19:21:01 2018 -0400

    add test cases for GroupBy.apply trivial cases  (#20081)

diff --git a/pandas/tests/groupby/test_groupby.py b/pandas/tests/groupby/test_groupby.py
index be0c32cef..cdb4e3072 100644
--- a/pandas/tests/groupby/test_groupby.py
+++ b/pandas/tests/groupby/test_groupby.py
@@ -233,6 +233,36 @@ class TestGroupBy(MixIn):
             lambda x: x['time'][x['value'].idxmax()])
         assert_series_equal(result, expected)
 
+    def test_apply_trivial(self):
+        # GH 20066
+        # trivial apply: ignore input and return a constant dataframe.
+        df = pd.DataFrame({'key': ['a', 'a', 'b', 'b', 'a'],
+                           'data': [1.0, 2.0, 3.0, 4.0, 5.0]},
+                          columns=['key', 'data'])
+        expected = pd.concat([df.iloc[1:], df.iloc[1:]],
+                             axis=1, keys=['float64', 'object'])
+        result = df.groupby([str(x) for x in df.dtypes],
+                            axis=1).apply(lambda x: df.iloc[1:])
+
+        assert_frame_equal(result, expected)
+
+    @pytest.mark.xfail(reason=("GH 20066; function passed into apply "
+                               "returns a DataFrame with the same index "
+                               "as the one to create GroupBy object."))
+    def test_apply_trivial_fail(self):
+        # GH 20066
+        # trivial apply fails if the constant dataframe has the same index
+        # with the one used to create GroupBy object.
+        df = pd.DataFrame({'key': ['a', 'a', 'b', 'b', 'a'],
+                           'data': [1.0, 2.0, 3.0, 4.0, 5.0]},
+                          columns=['key', 'data'])
+        expected = pd.concat([df, df],
+                             axis=1, keys=['float64', 'object'])
+        result = df.groupby([str(x) for x in df.dtypes],
+                            axis=1).apply(lambda x: df)
+
+        assert_frame_equal(result, expected)
+
     def test_time_field_bug(self):
         # Test a fix for the following error related to GH issue 11324 When
         # non-key fields in a group-by dataframe contained time-based fields
