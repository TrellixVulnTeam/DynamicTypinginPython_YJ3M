commit 542b8ffcd4a15cdaab1732ae24186979a94b1fd8
Author: Adam Klein <adamklein@gmail.com>
Date:   Tue Jan 31 12:28:01 2012 -0500

    BUG: closes #719, check for sortedness of multiindex in to_panel

diff --git a/pandas/core/frame.py b/pandas/core/frame.py
index c08f80ecb..6e4799507 100644
--- a/pandas/core/frame.py
+++ b/pandas/core/frame.py
@@ -815,19 +815,24 @@ class DataFrame(NDFrame):
 
         self._consolidate_inplace()
 
-        major_axis, minor_axis = self.index.levels
-        major_labels, minor_labels = self.index.labels
+        if not self.index.is_monotonic:
+            selfsorted = self.sort()
+        else:
+            selfsorted = self
+
+        major_axis, minor_axis = selfsorted.index.levels
+        major_labels, minor_labels = selfsorted.index.labels
 
         shape = len(major_axis), len(minor_axis)
 
         new_blocks = []
-        for block in self._data.blocks:
+        for block in selfsorted._data.blocks:
             newb = block2d_to_block3d(block.values.T, block.items, shape,
                                       major_labels, minor_labels,
-                                      ref_items=self.columns)
+                                      ref_items=selfsorted.columns)
             new_blocks.append(newb)
 
-        new_axes = [self.columns, major_axis, minor_axis]
+        new_axes = [selfsorted.columns, major_axis, minor_axis]
         new_mgr = BlockManager(new_blocks, new_axes)
 
         return Panel(new_mgr)
diff --git a/pandas/tests/test_panel.py b/pandas/tests/test_panel.py
index b6720e5d2..c02ee49c5 100644
--- a/pandas/tests/test_panel.py
+++ b/pandas/tests/test_panel.py
@@ -965,6 +965,14 @@ class TestPanel(unittest.TestCase, PanelTests, CheckIndexing,
         f2 = lambda x: np.zeros((2,2))
         self.assertRaises(Exception, group_agg, values, bounds, f2)
 
+    def test_from_frame_unsorted(self):
+        tuples = [('MSFT', 3), ('AAPL', 3), ('MSFT', 1), 
+                  ('AAPL', 1), ('MSFT', 2)]
+        midx = MultiIndex.from_tuples(tuples)
+        df = DataFrame(np.random.rand(5,4), index=midx)
+        p = df.to_panel()
+        assert_frame_equal(p.major_xs('MSFT'), df.sort().ix['MSFT',:])
+
 class TestLongPanel(unittest.TestCase):
     """
     LongPanel no longer exists, but...
