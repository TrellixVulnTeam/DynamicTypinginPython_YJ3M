commit ebbe7bc2f2cbbdb3fd3a1387911c8c3759ba52aa
Author: Phillip Cloud <cpcloud@gmail.com>
Date:   Fri Sep 27 09:01:21 2013 -0400

    PERF: add vbench for DatetimeIndex unions/intersetions

diff --git a/pandas/tslib.pyx b/pandas/tslib.pyx
index 18d2c59ae..5d09d9bad 100644
--- a/pandas/tslib.pyx
+++ b/pandas/tslib.pyx
@@ -475,11 +475,10 @@ cdef class _Timestamp(datetime):
         int64_t value, nanosecond
         object offset       # frequency reference
 
-    def __hash__(self):
+    def __hash__(_Timestamp self):
         if self.nanosecond:
             return hash(self.value)
-        else:
-            return datetime.__hash__(self)
+        return datetime.__hash__(self)
 
     def __richcmp__(_Timestamp self, object other, int op):
         cdef:
@@ -520,13 +519,14 @@ cdef class _Timestamp(datetime):
         self._assert_tzawareness_compat(other)
         return _cmp_scalar(self.value, ots.value, op)
 
-    cdef _compare_outside_nanorange(self, object other, int op):
+    cdef bint _compare_outside_nanorange(_Timestamp self, datetime other,
+                                         int op) except -1:
         cdef datetime dtval = self.to_datetime()
 
         self._assert_tzawareness_compat(other)
 
         if self.nanosecond == 0:
-            return PyObject_RichCompare(dtval, other, op)
+            return PyObject_RichCompareBool(dtval, other, op)
         else:
             if op == Py_EQ:
                 return False
@@ -541,15 +541,15 @@ cdef class _Timestamp(datetime):
             elif op == Py_GE:
                 return dtval >= other
 
-    cdef _assert_tzawareness_compat(self, object other):
+    cdef void _assert_tzawareness_compat(_Timestamp self, object other):
         if self.tzinfo is None:
             if other.tzinfo is not None:
-                raise Exception('Cannot compare tz-naive and '
-                                'tz-aware timestamps')
+                raise ValueError('Cannot compare tz-naive and tz-aware '
+                                 'timestamps')
         elif other.tzinfo is None:
-            raise Exception('Cannot compare tz-naive and tz-aware timestamps')
+            raise ValueError('Cannot compare tz-naive and tz-aware timestamps')
 
-    cpdef to_datetime(self):
+    cpdef datetime to_datetime(_Timestamp self):
         cdef:
             pandas_datetimestruct dts
             _TSObject ts
diff --git a/vb_suite/index_object.py b/vb_suite/index_object.py
index cf87a9af5..8b348ddc6 100644
--- a/vb_suite/index_object.py
+++ b/vb_suite/index_object.py
@@ -22,6 +22,16 @@ rng2 = rng[:-1]
 index_datetime_intersection = Benchmark("rng.intersection(rng2)", setup)
 index_datetime_union = Benchmark("rng.union(rng2)", setup)
 
+setup = common_setup + """
+rng = date_range('1/1/2000', periods=10000, freq='T')
+rng2 = rng[:-1]
+"""
+
+datetime_index_intersection = Benchmark("rng.intersection(rng2)", setup,
+                                        start_date=datetime(2013, 9, 27))
+datetime_index_union = Benchmark("rng.union(rng2)", setup,
+                                 start_date=datetime(2013, 9, 27))
+
 # integers
 setup = common_setup + """
 N = 1000000
