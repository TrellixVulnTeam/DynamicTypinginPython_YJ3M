commit 2acd81c512d5a1ce0718665a5ef045fc03a73146
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Nov 21 21:45:01 2009 +0000

    misc fixed to Cython
    
    git-svn-id: http://pandas.googlecode.com/svn/trunk@40 d5231056-7de3-11de-ac95-d976489f1ece

diff --git a/pandas/lib/src/common.pyx b/pandas/lib/src/common.pyx
index 6ec25c918..853b64d13 100644
--- a/pandas/lib/src/common.pyx
+++ b/pandas/lib/src/common.pyx
@@ -65,12 +65,11 @@ cpdef map_indices(ndarray index):
 
     result = {}
 
-    iter = PyArray_IterNew(index)
-
+    iter = <flatiter> PyArray_IterNew(index)
     length = PyArray_SIZE(index)
 
     for i from 0 <= i < length:
-        idx = PyArray_GETITEM(index, <void *> iter.dataptr)
+        idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
         result[idx] = i
         PyArray_ITER_NEXT(iter)
 
diff --git a/pandas/lib/src/tseries.c b/pandas/lib/src/tseries.c
index e0fdccead..6ded9fb59 100644
--- a/pandas/lib/src/tseries.c
+++ b/pandas/lib/src/tseries.c
@@ -1,4 +1,4 @@
-/* Generated by Cython 0.12.rc1 on Sat Nov 21 16:14:23 2009 */
+/* Generated by Cython 0.12.rc1 on Sat Nov 21 16:40:17 2009 */
 
 #define PY_SSIZE_T_CLEAN
 #include "Python.h"
@@ -1432,7 +1432,6 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
   __Pyx_RefNannySetupContext("map_indices");
   __Pyx_INCREF((PyObject *)__pyx_v_index);
   __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
@@ -1444,7 +1443,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
  * 
  *     result = {}             # <<<<<<<<<<<<<<
  * 
- *     iter = PyArray_IterNew(index)
+ *     iter = <flatiter> PyArray_IterNew(index)
  */
   __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
@@ -1455,66 +1454,63 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":68
  *     result = {}
  * 
- *     iter = PyArray_IterNew(index)             # <<<<<<<<<<<<<<
- * 
+ *     iter = <flatiter> PyArray_IterNew(index)             # <<<<<<<<<<<<<<
  *     length = PyArray_SIZE(index)
+ * 
  */
   __pyx_t_1 = PyArray_IterNew(((PyObject *)__pyx_v_index)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_flatiter))))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_1)));
   __Pyx_DECREF(((PyObject *)__pyx_v_iter));
   __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":70
- *     iter = PyArray_IterNew(index)
+  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":69
  * 
+ *     iter = <flatiter> PyArray_IterNew(index)
  *     length = PyArray_SIZE(index)             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < length:
  */
   __pyx_v_length = PyArray_SIZE(__pyx_v_index);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":72
+  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":71
  *     length = PyArray_SIZE(index)
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         idx = PyArray_GETITEM(index, <void *> iter.dataptr)
+ *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i
  */
   __pyx_t_2 = __pyx_v_length;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":73
+    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":72
  * 
  *     for i from 0 <= i < length:
- *         idx = PyArray_GETITEM(index, <void *> iter.dataptr)             # <<<<<<<<<<<<<<
+ *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
  *         result[idx] = i
  *         PyArray_ITER_NEXT(iter)
  */
-    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_iter), __pyx_n_s__dataptr); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = PyArray_GETITEM(__pyx_v_index, PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = PyArray_GETITEM(__pyx_v_index, ((void *)__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_v_idx);
-    __pyx_v_idx = __pyx_t_3;
-    __pyx_t_3 = 0;
+    __pyx_v_idx = __pyx_t_1;
+    __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":74
+    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":73
  *     for i from 0 <= i < length:
- *         idx = PyArray_GETITEM(index, <void *> iter.dataptr)
+ *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i             # <<<<<<<<<<<<<<
  *         PyArray_ITER_NEXT(iter)
  * 
  */
-    __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_idx, __pyx_t_3) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_1 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_idx, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":75
- *         idx = PyArray_GETITEM(index, <void *> iter.dataptr)
+    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":74
+ *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i
  *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
  * 
@@ -1523,7 +1519,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
     PyArray_ITER_NEXT(__pyx_v_iter);
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":77
+  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":76
  *         PyArray_ITER_NEXT(iter)
  * 
  *     return result             # <<<<<<<<<<<<<<
@@ -1539,7 +1535,6 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_AddTraceback("tseries.map_indices");
   __pyx_r = 0;
   __pyx_L0:;
@@ -19651,7 +19646,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":84
+  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":83
  * 
  * # initialize numpy
  * import_array()             # <<<<<<<<<<<<<<
