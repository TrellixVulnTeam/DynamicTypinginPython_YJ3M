commit d5b790778dba1449fa72af2907876d1e7637508d
Author: Chang She <chang@lambdafoundry.com>
Date:   Fri Dec 28 11:10:33 2012 -0500

    BUG: common.in_interactive_session() returns False after IPython %run magic #2585

diff --git a/pandas/core/common.py b/pandas/core/common.py
index 15f6cb641..e380ed4d0 100644
--- a/pandas/core/common.py
+++ b/pandas/core/common.py
@@ -1197,8 +1197,16 @@ def in_interactive_session():
 
     returns True if running under python/ipython interactive shell
     """
-    import __main__ as main
-    return not hasattr(main, '__file__') or get_option('mode.sim_interactive')
+    try:
+        ipy = __IPYTHON__
+        if ipy:
+            return True
+    except:
+        pass
+    finally:
+        import __main__ as main
+        return (not hasattr(main, '__file__') or
+                get_option('mode.sim_interactive'))
 
 def in_qtconsole():
     """
