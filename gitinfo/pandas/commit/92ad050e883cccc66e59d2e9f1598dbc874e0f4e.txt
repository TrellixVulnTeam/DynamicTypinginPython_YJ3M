commit 92ad050e883cccc66e59d2e9f1598dbc874e0f4e
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sun Jul 22 14:10:25 2012 -0400

    BUG: handle Yahoo! finance returning duplicate dates for prev bus day, doc fixes

diff --git a/RELEASE.rst b/RELEASE.rst
index c88391fe5..6aafca52a 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -103,6 +103,8 @@ pandas 0.8.1
   - Fix Series.interpolate with method='values' and DatetimeIndex (#1646)
   - Fix IndexError in left merges on a DataFrame with 0-length (#1628)
   - Fix DataFrame column width display with UTF-8 encoded characters (#1620)
+  - Handle case in pandas.io.data.get_data_yahoo where Yahoo! returns duplicate
+    dates for most recent business day
 
 pandas 0.8.0
 ============
diff --git a/doc/source/basics.rst b/doc/source/basics.rst
index f6359aea3..b8b9040e1 100644
--- a/doc/source/basics.rst
+++ b/doc/source/basics.rst
@@ -369,14 +369,14 @@ index labels with the minimum and maximum corresponding values:
    df1.idxmin(axis=0)
    df1.idxmax(axis=1)
 
-When there are multiple rows (or columns) matching the minimum or maximum 
+When there are multiple rows (or columns) matching the minimum or maximum
 value, ``idxmin`` and ``idxmax`` return the first matching index:
 
 .. ipython:: python
 
-   df = DataFrame([2, 1, 1, 3, np.nan], columns=['A'], index=list('edcba'))
-   df
-   df['A'].idxmin()
+   df3 = DataFrame([2, 1, 1, 3, np.nan], columns=['A'], index=list('edcba'))
+   df3
+   df3['A'].idxmin()
 
 Value counts (histogramming)
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
diff --git a/doc/source/visualization.rst b/doc/source/visualization.rst
index 99651d87f..5078b960b 100644
--- a/doc/source/visualization.rst
+++ b/doc/source/visualization.rst
@@ -98,11 +98,11 @@ You can plot one column versus another using the `x` and `y` keywords in
 
    plt.figure()
 
-   df = DataFrame(np.random.randn(1000, 2), columns=['B', 'C']).cumsum()
-   df['A'] = Series(range(len(df)))
+   df3 = DataFrame(np.random.randn(1000, 2), columns=['B', 'C']).cumsum()
+   df3['A'] = Series(range(len(df)))
 
    @savefig df_plot_xy.png width=4.5in
-   df.plot(x='A', y='B')
+   df3.plot(x='A', y='B')
 
 
 Plotting on a Secondary Y-axis
diff --git a/pandas/io/data.py b/pandas/io/data.py
index a81b0c7cb..65c4daec3 100644
--- a/pandas/io/data.py
+++ b/pandas/io/data.py
@@ -134,16 +134,25 @@ def get_data_yahoo(name=None, start=None, end=None, retry_count=3, pause=0):
       '&f=%s' % end.year + \
       '&g=d' + \
       '&ignore=.csv'
-    for i in range(0, retry_count):
+
+    for _ in range(retry_count):
         resp =  urllib2.urlopen(url)
         if resp.code == 200:
             lines = resp.read()
             rs = read_csv(StringIO(bytes_to_str(lines)), index_col=0,
-                          parse_dates=True)
-            return rs[::-1]
+                          parse_dates=True)[::-1]
+
+            # Yahoo! Finance sometimes does this awesome thing where they
+            # return 2 rows for the most recent business day
+            if len(rs) > 2 and rs.index[-1] == rs.index[-2]:  # pragma: no cover
+                rs = rs[:-1]
+
+            return rs
+
         time.sleep(pause)
-    raise Exception(
-              "after %d tries, Yahoo did not return a 200 for url %s" % (pause, url))
+
+    raise Exception("after %d tries, Yahoo did not "
+                    "return a 200 for url %s" % (pause, url))
 
 
 
