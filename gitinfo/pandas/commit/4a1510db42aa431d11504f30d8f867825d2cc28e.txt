commit 4a1510db42aa431d11504f30d8f867825d2cc28e
Author: jreback <jeff@reback.net>
Date:   Sat Dec 29 09:47:38 2012 -0500

    ENH: added overwrite parameter to copy (defaults to True)

diff --git a/pandas/io/pytables.py b/pandas/io/pytables.py
index 60c5246b7..74bb2dcfb 100644
--- a/pandas/io/pytables.py
+++ b/pandas/io/pytables.py
@@ -637,13 +637,14 @@ class HDFStore(object):
             raise KeyError('No object named %s in the file' % key)
         return _is_table_type(group)
 
-    def copy(self, file, mode = 'w', propindexes = True, keys = None, complib = None, complevel = None, fletcher32 = False):
+    def copy(self, file, mode = 'w', propindexes = True, keys = None, complib = None, complevel = None, fletcher32 = False, overwrite = True):
         """ copy the existing store to a new file, upgrading in place
 
             Parameters
             ----------
             propindexes: restore indexes in copied file (defaults to True)
             keys       : list of keys to include in the copy (defaults to all)
+            overwrite  : overwrite (remove and replace) existing nodes in the new store (default is True)
             mode, complib, complevel, fletcher32 same as in HDFStore.__init__
 
             Returns
@@ -659,6 +660,11 @@ class HDFStore(object):
         for k in keys:
             n    = self.get_node(k)
             if n is not None:
+
+                if k in new_store:
+                    if overwrite:
+                        new_store.remove(k)
+
                 data = self.select(k)
                 if _is_table_type(n):
 
@@ -666,9 +672,10 @@ class HDFStore(object):
                     index = False
                     if propindexes:
                         index = [ a.name for a in t.axes if a.is_indexed ]
-                    new_store.append(k,data, index=index, data_columns=getattr(t,'data_columns',None))
+                        new_store.append(k,data, index=index, data_columns=getattr(t,'data_columns',None))
                 else:
                     new_store.put(k,data)
+
         return new_store
 
     ###### private methods ######
diff --git a/pandas/io/tests/test_pytables.py b/pandas/io/tests/test_pytables.py
index febb571cf..4ce89057a 100644
--- a/pandas/io/tests/test_pytables.py
+++ b/pandas/io/tests/test_pytables.py
@@ -1737,7 +1737,7 @@ class TestHDFStore(unittest.TestCase):
 
     def test_copy(self):
         pth = curpath()
-        def do_copy(f = None, keys = None, propindexes = True, **kwargs):
+        def do_copy(f = None, new_f = None, keys = None, propindexes = True, **kwargs):
             try:
                 import os
 
@@ -1745,9 +1745,12 @@ class TestHDFStore(unittest.TestCase):
                     f = os.path.join(pth, 'legacy_0.10.h5')
 
                 store = HDFStore(f, 'r')
-                import tempfile
-                tmp = tempfile.mkstemp()[1]
-                tstore = store.copy(tmp, keys = keys, propindexes = propindexes, **kwargs)
+
+                if new_f is None:
+                    import tempfile
+                    new_f = tempfile.mkstemp()[1]
+
+                tstore = store.copy(new_f, keys = keys, propindexes = propindexes, **kwargs)
                 
                 # check keys
                 if keys is None:
@@ -1771,7 +1774,7 @@ class TestHDFStore(unittest.TestCase):
                 store.close()
                 tstore.close()
                 import os
-                os.remove(tmp)
+                os.remove(new_f)
 
         do_copy()
         do_copy(keys = ['df'])
