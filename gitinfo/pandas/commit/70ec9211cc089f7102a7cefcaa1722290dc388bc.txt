commit 70ec9211cc089f7102a7cefcaa1722290dc388bc
Author: behzad nouri <behzadnouri@gmail.com>
Date:   Wed Sep 3 19:41:26 2014 -0400

    BUG: GroupBy.count() with float32 data type does not exclude nan

diff --git a/doc/source/v0.15.0.txt b/doc/source/v0.15.0.txt
index 71f39d962..bfd484b36 100644
--- a/doc/source/v0.15.0.txt
+++ b/doc/source/v0.15.0.txt
@@ -669,3 +669,4 @@ Bug Fixes
   was a tuple (:issue:`8121`).
 
 - Bug with kde plot and NaNs (:issue:`8182`)
+- Bug in ``GroupBy.count`` with float32 data type were nan values were not excluded (:issue:`8169`).
diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index 320680726..41ff6a696 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -147,10 +147,7 @@ def _last_compat(x, axis=0):
 
 
 def _count_compat(x, axis=0):
-    try:
-        return x.size
-    except:
-        return x.count()
+    return x.count()  # .size != .count(); count excludes nan
 
 class Grouper(object):
     """
@@ -1527,14 +1524,15 @@ class BaseGrouper(object):
 
         result = self._aggregate(result, counts, values, how, is_numeric)
 
-        if self._filter_empty_groups:
+        if self._filter_empty_groups and not counts.all():
             if result.ndim == 2:
                 try:
                     result = lib.row_bool_subset(
                         result, (counts > 0).view(np.uint8))
                 except ValueError:
                     result = lib.row_bool_subset_object(
-                        result, (counts > 0).view(np.uint8))
+                                    com._ensure_object(result),
+                                    (counts > 0).view(np.uint8))
             else:
                 result = result[counts > 0]
 
@@ -2477,7 +2475,7 @@ class NDFrameGroupBy(GroupBy):
             values = block._try_operate(block.values)
 
             if block.is_numeric:
-                values = com.ensure_float(values)
+                values = _algos.ensure_float64(values)
 
             result, _ = self.grouper.aggregate(values, how, axis=agg_axis)
 
diff --git a/pandas/tests/test_groupby.py b/pandas/tests/test_groupby.py
index 3cfdd8ec9..84aaed819 100644
--- a/pandas/tests/test_groupby.py
+++ b/pandas/tests/test_groupby.py
@@ -2214,6 +2214,20 @@ class TestGroupBy(tm.TestCase):
         expected = pd.Series([1, 3], index=[2, 3], name='a')
         tm.assert_series_equal(result, expected)
 
+    def test_count_cross_type(self):  # GH8169
+        vals = np.hstack((np.random.randint(0,5,(100,2)),
+                          np.random.randint(0,2,(100,2))))
+
+        df = pd.DataFrame(vals, columns=['a', 'b', 'c', 'd'])
+        df[df==2] = np.nan
+        expected = df.groupby(['c', 'd']).count()
+
+        for t in ['float32', 'object']:
+            df['a'] = df['a'].astype(t)
+            df['b'] = df['b'].astype(t)
+            result = df.groupby(['c', 'd']).count()
+            tm.assert_frame_equal(result, expected)
+
     def test_non_cython_api(self):
 
         # GH5610
