commit 7bc6649baef4909da11680872260bacac3ffa4c4
Author: y-p <yoval@gmx.com>
Date:   Fri Feb 15 19:32:13 2013 +0200

    BUG: util.testing.makeCustomIndex results were not sorted properly
    
    mkdf(100,2) was returning
    [(#_l0_g0, #_l1_g0), (#_l0_g1, #_l1_g1), (#_l0_g10, #_l1_g10), (#_l0_g100, #_l1_g100)
    
    rather then:
    
    [(#_l0_g0, #_l1_g0), (#_l0_g1, #_l1_g1), (#_l0_g2, #_l1_g2), (#_l0_g3, #_l1_g3)

diff --git a/pandas/util/testing.py b/pandas/util/testing.py
index 702ae7d5c..9e7710a61 100644
--- a/pandas/util/testing.py
+++ b/pandas/util/testing.py
@@ -425,6 +425,11 @@ def makeCustomIndex(nentries, nlevels, prefix='#', names=False, ndupe_l=None,
 
     tuples = []
     for i in range(nlevels):
+        def keyfunc(x):
+            import re
+            numeric_tuple = re.sub("[^\d_]_?","",x).split("_")
+            return map(int,numeric_tuple)
+
         # build a list of lists to create the index from
         div_factor = nentries // ndupe_l[i] + 1
         cnt = Counter()
@@ -432,7 +437,7 @@ def makeCustomIndex(nentries, nlevels, prefix='#', names=False, ndupe_l=None,
             label = prefix + '_l%d_g' % i + str(j)
             cnt[label] = ndupe_l[i]
         # cute Counter trick
-        result = list(sorted(cnt.elements()))[:nentries]
+        result = list(sorted(cnt.elements(), key=keyfunc))[:nentries]
         tuples.append(result)
 
     tuples = zip(*tuples)
