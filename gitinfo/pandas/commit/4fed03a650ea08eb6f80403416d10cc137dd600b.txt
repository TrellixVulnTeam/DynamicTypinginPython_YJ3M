commit 4fed03a650ea08eb6f80403416d10cc137dd600b
Author: y-p <yoval@gmx.com>
Date:   Wed Jan 15 21:55:41 2014 +0200

    BLD: ipython_directive, add back okexcept

diff --git a/doc/sphinxext/ipython_directive.py b/doc/sphinxext/ipython_directive.py
index d9e48f9d9..8af65595a 100644
--- a/doc/sphinxext/ipython_directive.py
+++ b/doc/sphinxext/ipython_directive.py
@@ -110,6 +110,7 @@ import re
 import sys
 import tempfile
 import ast
+from pandas.compat import zip, range, map, lmap, u, cStringIO as StringIO
 
 # To keep compatibility with various python versions
 try:
@@ -358,6 +359,7 @@ class EmbeddedSphinxShell(object):
         is_doctest = (decorator is not None and \
                      decorator.startswith('@doctest')) or self.is_doctest
         is_suppress = decorator=='@suppress' or self.is_suppress
+        is_okexcept = decorator=='@okexcept' or self.is_okexcept
         is_savefig = decorator is not None and \
                      decorator.startswith('@savefig')
 
@@ -417,6 +419,9 @@ class EmbeddedSphinxShell(object):
         elif is_semicolon: # get spacing right
             ret.append('')
 
+        if not is_okexcept and "Traceback" in output:
+            sys.stdout.write(output)
+
         self.cout.truncate(0)
         return (ret, input_lines, output, is_doctest, decorator, image_file,
                     image_directive)
@@ -658,6 +663,7 @@ class IPythonDirective(Directive):
                     'suppress' : directives.flag,
                     'verbatim' : directives.flag,
                     'doctest' : directives.flag,
+                    'okexcept': directives.flag
                   }
 
     shell = None
@@ -755,6 +761,7 @@ class IPythonDirective(Directive):
         self.shell.is_suppress = 'suppress' in options
         self.shell.is_doctest = 'doctest' in options
         self.shell.is_verbatim = 'verbatim' in options
+        self.shell.is_okexcept = 'okexcept' in options
 
         # handle pure python code
         if 'python' in self.arguments:
