commit 0a04723027919a143ff52c42b0d8aec5a919cecf
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Wed Oct 31 20:20:35 2012 -0400

    BUG: fix unstacking edge case failure when filtering unrepresented combinations. close #2100

diff --git a/RELEASE.rst b/RELEASE.rst
index 8cda23b8f..7aefafca7 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -41,6 +41,7 @@ pandas 0.9.1
   - Make WLS r-squared match statsmodels 0.5.0 fixed value
   - Fix zero-trimming DataFrame formatting bug
   - Correctly compute/box datetime64 min/max values from Series.min/max (#2083)
+  - Fix unstacking edge case with unrepresented groups (#2100)
 
 pandas 0.9.0
 ============
diff --git a/pandas/core/reshape.py b/pandas/core/reshape.py
index 044870fc4..5d611bdea 100644
--- a/pandas/core/reshape.py
+++ b/pandas/core/reshape.py
@@ -169,6 +169,7 @@ class _Unstacker(object):
             mask_chunk.flat[self.mask] = True
 
         new_values = new_values.take(self.unique_groups, axis=0)
+        new_mask = new_mask.take(self.unique_groups, axis=0)
 
         return new_values, new_mask
 
diff --git a/pandas/tests/test_multilevel.py b/pandas/tests/test_multilevel.py
index 580f43e10..34872ea57 100644
--- a/pandas/tests/test_multilevel.py
+++ b/pandas/tests/test_multilevel.py
@@ -15,6 +15,7 @@ from pandas.util.testing import (assert_almost_equal,
 import pandas.core.common as com
 import pandas.util.testing as tm
 from pandas.util.compat import product as cart_product
+import pandas as pd
 
 class TestMultiLevel(unittest.TestCase):
 
@@ -711,6 +712,28 @@ x   q   30      3    -0.6662 -0.5243 -0.3580  0.89145  2.5838"""
         result = self.ymd.unstack(0).stack(-2)
         expected = self.ymd.unstack(0).stack(0)
 
+    def test_unstack_odd_failure(self):
+        data = """day,time,smoker,sum,len
+Fri,Dinner,No,8.25,3.
+Fri,Dinner,Yes,27.03,9
+Fri,Lunch,No,3.0,1
+Fri,Lunch,Yes,13.68,6
+Sat,Dinner,No,139.63,45
+Sat,Dinner,Yes,120.77,42
+Sun,Dinner,No,180.57,57
+Sun,Dinner,Yes,66.82,19
+Thur,Dinner,No,3.0,1
+Thur,Lunch,No,117.32,44
+Thur,Lunch,Yes,51.51,17"""
+
+        df = pd.read_csv(StringIO(data)).set_index(['day', 'time', 'smoker'])
+
+        # it works, #2100
+        result = df.unstack(2)
+
+        recons = result.stack()
+        assert_frame_equal(recons, df)
+
     def test_stack_mixed_dtype(self):
         df = self.frame.T
         df['foo', 'four'] = 'foo'
