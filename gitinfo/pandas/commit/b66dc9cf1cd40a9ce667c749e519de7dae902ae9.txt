commit b66dc9cf1cd40a9ce667c749e519de7dae902ae9
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Sep 8 23:07:54 2012 -0400

    BUG: fix error after Panel truncate copy close #1823

diff --git a/RELEASE.rst b/RELEASE.rst
index 3f371d89c..3e751952e 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -120,6 +120,8 @@ pandas 0.9.0
   - Fix unicode console encoding issue in IPython notebook (#1782, #1768)
   - Fix unicode formatting issue with Series.name (#1782)
   - Fix bug in DataFrame.duplicated with datetime64 columns (#1833)
+  - Fix bug in Panel internals resulting in error when doing fillna after
+    truncate not changing size of panel (#1823)
 
 pandas 0.8.1
 ============
diff --git a/pandas/core/internals.py b/pandas/core/internals.py
index 39e51628d..e33d98cda 100644
--- a/pandas/core/internals.py
+++ b/pandas/core/internals.py
@@ -949,6 +949,12 @@ class BlockManager(object):
             if copy:
                 result = self.copy(deep=True)
                 result.axes[axis] = new_axis
+
+                if axis == 0:
+                    # patch ref_items
+                    for blk in result.blocks:
+                        blk.ref_items = new_axis
+
                 return result
             else:
                 return self
diff --git a/pandas/tests/test_panel.py b/pandas/tests/test_panel.py
index 27125771e..ead6ba842 100644
--- a/pandas/tests/test_panel.py
+++ b/pandas/tests/test_panel.py
@@ -897,6 +897,13 @@ class TestPanel(unittest.TestCase, PanelTests, CheckIndexing,
         filled = empty.fillna(0)
         assert_panel_equal(filled, empty)
 
+    def test_truncate_fillna_bug(self):
+        # #1823
+        result = self.panel.truncate(before=None, after=None, axis='items')
+
+        # it works!
+        result.fillna(value=0.0)
+
     def test_swapaxes(self):
         result = self.panel.swapaxes('items', 'minor')
         self.assert_(result.items is self.panel.minor_axis)
