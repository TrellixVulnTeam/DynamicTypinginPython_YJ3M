commit a4138bdc15b7d5059589282893033a61fdcf100f
Author: Jeff Reback <jeff@reback.net>
Date:   Wed Sep 16 10:28:33 2015 -0700

    BLD: install build deps when building
    
    install run deps after building from source

diff --git a/ci/install_conda.sh b/ci/install_conda.sh
index 1db1e7fa6..c54f5494c 100755
--- a/ci/install_conda.sh
+++ b/ci/install_conda.sh
@@ -78,21 +78,13 @@ conda config --set ssl_verify false || exit 1
 # Useful for debugging any issues with conda
 conda info -a || exit 1
 
-REQ="ci/requirements-${TRAVIS_PYTHON_VERSION}${JOB_TAG}.txt"
-conda create -n pandas python=$TRAVIS_PYTHON_VERSION || exit 1
-conda install -n pandas --file=${REQ} || exit 1
-
-conda install -n pandas pip setuptools nose || exit 1
-conda remove -n pandas pandas
+# build deps
+REQ="ci/requirements-${TRAVIS_PYTHON_VERSION}${JOB_TAG}.build"
+time conda create -n pandas python=$TRAVIS_PYTHON_VERSION nose || exit 1
+time conda install -n pandas --file=${REQ} || exit 1
 
 source activate pandas
 
-# we may have additional pip installs
-REQ="ci/requirements-${TRAVIS_PYTHON_VERSION}${JOB_TAG}.pip"
-if [ -e ${REQ} ]; then
-    pip install -r $REQ
-fi
-
 # set the compiler cache to work
 if [ "$IRON_TOKEN" ]; then
     export PATH=/usr/lib/ccache:/usr/lib64/ccache:$PATH
@@ -104,15 +96,33 @@ if [ "$IRON_TOKEN" ]; then
 fi
 
 if [ "$BUILD_TEST" ]; then
+
+    # build testing
     pip uninstall --yes cython
     pip install cython==0.15.1
     ( python setup.py build_ext --inplace && python setup.py develop ) || true
+
 else
-    python setup.py build_ext --inplace && python setup.py develop
-fi
 
-for package in beautifulsoup4; do
-    pip uninstall --yes $package
-done
+    # build but don't install
+    time python setup.py build_ext --inplace || exit 1
+
+    # we may have run installations
+    REQ="ci/requirements-${TRAVIS_PYTHON_VERSION}${JOB_TAG}.run"
+    time conda install -n pandas --file=${REQ} || exit 1
+
+    # we may have additional pip installs
+    REQ="ci/requirements-${TRAVIS_PYTHON_VERSION}${JOB_TAG}.pip"
+    if [ -e ${REQ} ]; then
+        pip install -r $REQ
+    fi
+
+    # remove any installed pandas package
+    conda remove pandas
+
+    # install our pandas
+    python setup.py develop  || exit 1
+
+fi
 
 true
diff --git a/ci/install_pydata.sh b/ci/install_pydata.sh
index f2ab5af34..667b57897 100755
--- a/ci/install_pydata.sh
+++ b/ci/install_pydata.sh
@@ -90,7 +90,8 @@ fi
 # Force virtualenv to accept system_site_packages
 rm -f $VIRTUAL_ENV/lib/python$TRAVIS_PYTHON_VERSION/no-global-site-packages.txt
 
-time pip install $PIP_ARGS -r ci/requirements-${wheel_box}.txt
+# build deps
+time pip install $PIP_ARGS -r ci/requirements-${wheel_box}.build
 
 # Need to enable for locale testing. The location of the locale file(s) is
 # distro specific. For example, on Arch Linux all of the locales are in a
@@ -147,6 +148,9 @@ else
     python setup.py develop
 fi
 
+# install the run libs
+time pip install $PIP_ARGS -r ci/requirements-${wheel_box}.run
+
 # restore cython (if not numpy building)
 if [ -z "$NUMPY_BUILD" ]; then
     time pip install $PIP_ARGS  $(cat ci/requirements-${wheel_box}.txt | grep -i cython)
diff --git a/ci/requirements-2.6.build b/ci/requirements-2.6.build
new file mode 100644
index 000000000..f8cbd8cef
--- /dev/null
+++ b/ci/requirements-2.6.build
@@ -0,0 +1,4 @@
+numpy=1.7.0
+cython=0.19.1
+dateutil=1.5
+pytz=2013b
diff --git a/ci/requirements-2.6.txt b/ci/requirements-2.6.run
similarity index 93%
rename from ci/requirements-2.6.txt
rename to ci/requirements-2.6.run
index 9b338cee2..d8ed2a426 100644
--- a/ci/requirements-2.6.txt
+++ b/ci/requirements-2.6.run
@@ -1,5 +1,4 @@
 numpy=1.7.0
-cython=0.19.1
 dateutil=1.5
 pytz=2013b
 scipy=0.11.0
diff --git a/ci/requirements-2.7.build b/ci/requirements-2.7.build
new file mode 100644
index 000000000..df543aaf4
--- /dev/null
+++ b/ci/requirements-2.7.build
@@ -0,0 +1,4 @@
+dateutil=2.1
+pytz=2013b
+numpy=1.7.1
+cython=0.19.1
diff --git a/ci/requirements-2.7.txt b/ci/requirements-2.7.run
similarity index 91%
rename from ci/requirements-2.7.txt
rename to ci/requirements-2.7.run
index 2764e7408..a74096668 100644
--- a/ci/requirements-2.7.txt
+++ b/ci/requirements-2.7.run
@@ -1,8 +1,7 @@
 dateutil=2.1
 pytz=2013b
+numpy=1.7.1
 xlwt=0.7.5
-numpy=1.7.0
-cython=0.19.1
 numexpr=2.2.2
 pytables=3.0.0
 matplotlib=1.3.1
@@ -12,7 +11,6 @@ sqlalchemy=0.9.6
 lxml=3.2.1
 scipy
 xlsxwriter=0.4.6
-statsmodels
 boto=2.36.0
 bottleneck=0.8.0
 psycopg2=2.5.2
@@ -20,3 +18,4 @@ patsy
 pymysql=0.6.3
 html5lib=1.0b2
 beautiful-soup=4.2.1
+statsmodels
diff --git a/ci/requirements-2.7_32.txt b/ci/requirements-2.7_32.txt
deleted file mode 100644
index 2e241b1ce..000000000
--- a/ci/requirements-2.7_32.txt
+++ /dev/null
@@ -1,11 +0,0 @@
-python-dateutil
-pytz
-xlwt
-numpy
-cython
-numexpr
-pytables
-matplotlib
-openpyxl
-xlrd
-scipy
diff --git a/ci/requirements-2.7_64.txt b/ci/requirements-2.7_64.txt
deleted file mode 100644
index 2e241b1ce..000000000
--- a/ci/requirements-2.7_64.txt
+++ /dev/null
@@ -1,11 +0,0 @@
-python-dateutil
-pytz
-xlwt
-numpy
-cython
-numexpr
-pytables
-matplotlib
-openpyxl
-xlrd
-scipy
diff --git a/ci/requirements-2.7_BUILD_TEST.txt b/ci/requirements-2.7_BUILD_TEST.build
similarity index 84%
rename from ci/requirements-2.7_BUILD_TEST.txt
rename to ci/requirements-2.7_BUILD_TEST.build
index b273ca043..faf1e3559 100644
--- a/ci/requirements-2.7_BUILD_TEST.txt
+++ b/ci/requirements-2.7_BUILD_TEST.build
@@ -2,4 +2,3 @@ dateutil
 pytz
 numpy
 cython
-nose
diff --git a/ci/requirements-2.7_LOCALE.build b/ci/requirements-2.7_LOCALE.build
new file mode 100644
index 000000000..ada6686f5
--- /dev/null
+++ b/ci/requirements-2.7_LOCALE.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz=2013b
+numpy=1.7.1
+cython=0.19.1
diff --git a/ci/requirements-2.7_LOCALE.txt b/ci/requirements-2.7_LOCALE.run
similarity index 94%
rename from ci/requirements-2.7_LOCALE.txt
rename to ci/requirements-2.7_LOCALE.run
index fc7aceb0d..9bb37ee10 100644
--- a/ci/requirements-2.7_LOCALE.txt
+++ b/ci/requirements-2.7_LOCALE.run
@@ -1,11 +1,10 @@
 python-dateutil
 pytz=2013b
+numpy=1.7.1
 xlwt=0.7.5
 openpyxl=1.6.2
 xlsxwriter=0.4.6
 xlrd=0.9.2
-numpy=1.7.1
-cython=0.19.1
 bottleneck=0.8.0
 matplotlib=1.2.1
 patsy=0.1.0
diff --git a/ci/requirements-2.7_NUMPY_DEV_1_8_x.txt b/ci/requirements-2.7_NUMPY_DEV_1_8_x.txt
deleted file mode 100644
index 90fa8f11c..000000000
--- a/ci/requirements-2.7_NUMPY_DEV_1_8_x.txt
+++ /dev/null
@@ -1,3 +0,0 @@
-python-dateutil
-pytz==2013b
-cython==0.19.1
diff --git a/ci/requirements-2.7_NUMPY_DEV_master.txt b/ci/requirements-2.7_NUMPY_DEV_master.build
similarity index 100%
rename from ci/requirements-2.7_NUMPY_DEV_master.txt
rename to ci/requirements-2.7_NUMPY_DEV_master.build
diff --git a/ci/requirements-2.7_NUMPY_DEV_master.run b/ci/requirements-2.7_NUMPY_DEV_master.run
new file mode 100644
index 000000000..e69de29bb
diff --git a/ci/requirements-2.7_SLOW.build b/ci/requirements-2.7_SLOW.build
new file mode 100644
index 000000000..9558cf00d
--- /dev/null
+++ b/ci/requirements-2.7_SLOW.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz
+numpy
+cython
diff --git a/ci/requirements-2.7_SLOW.txt b/ci/requirements-2.7_SLOW.run
similarity index 96%
rename from ci/requirements-2.7_SLOW.txt
rename to ci/requirements-2.7_SLOW.run
index 563ce3e11..b6c9250dd 100644
--- a/ci/requirements-2.7_SLOW.txt
+++ b/ci/requirements-2.7_SLOW.run
@@ -1,7 +1,6 @@
 python-dateutil
 pytz
 numpy
-cython
 matplotlib
 scipy
 patsy
diff --git a/ci/requirements-3.3.build b/ci/requirements-3.3.build
new file mode 100644
index 000000000..8dc9b2102
--- /dev/null
+++ b/ci/requirements-3.3.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz=2013b
+numpy=1.8.0
+cython=0.19.1
diff --git a/ci/requirements-3.3.txt b/ci/requirements-3.3.run
similarity index 93%
rename from ci/requirements-3.3.txt
rename to ci/requirements-3.3.run
index cb8c3f7c1..09d07c1c5 100644
--- a/ci/requirements-3.3.txt
+++ b/ci/requirements-3.3.run
@@ -1,11 +1,10 @@
 python-dateutil
 pytz=2013b
+numpy=1.8.0
 openpyxl=1.6.2
 xlsxwriter=0.4.6
 xlrd=0.9.2
 html5lib=1.0b2
-numpy=1.8.0
-cython=0.19.1
 numexpr
 pytables
 bottleneck=0.8.0
diff --git a/ci/requirements-3.4.build b/ci/requirements-3.4.build
new file mode 100644
index 000000000..9558cf00d
--- /dev/null
+++ b/ci/requirements-3.4.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz
+numpy
+cython
diff --git a/ci/requirements-3.4_SLOW.txt b/ci/requirements-3.4.run
similarity index 91%
rename from ci/requirements-3.4_SLOW.txt
rename to ci/requirements-3.4.run
index ecc31dad7..73209a462 100644
--- a/ci/requirements-3.4_SLOW.txt
+++ b/ci/requirements-3.4.run
@@ -1,5 +1,6 @@
 python-dateutil
 pytz
+numpy
 openpyxl
 xlsxwriter
 xlrd
@@ -7,8 +8,6 @@ xlwt
 html5lib
 patsy
 beautiful-soup
-numpy
-cython
 scipy
 numexpr
 pytables
@@ -16,5 +15,5 @@ matplotlib=1.3.1
 lxml
 sqlalchemy
 bottleneck
-pymysql
+pymysql=0.6.3
 psycopg2
diff --git a/ci/requirements-3.4_32.txt b/ci/requirements-3.4_32.txt
deleted file mode 100644
index f2a364ed6..000000000
--- a/ci/requirements-3.4_32.txt
+++ /dev/null
@@ -1,10 +0,0 @@
-python-dateutil
-pytz
-openpyxl
-xlrd
-numpy
-cython
-scipy
-numexpr
-pytables
-matplotlib
diff --git a/ci/requirements-3.4_64.txt b/ci/requirements-3.4_64.txt
deleted file mode 100644
index f2a364ed6..000000000
--- a/ci/requirements-3.4_64.txt
+++ /dev/null
@@ -1,10 +0,0 @@
-python-dateutil
-pytz
-openpyxl
-xlrd
-numpy
-cython
-scipy
-numexpr
-pytables
-matplotlib
diff --git a/ci/requirements-3.4_SLOW.build b/ci/requirements-3.4_SLOW.build
new file mode 100644
index 000000000..9558cf00d
--- /dev/null
+++ b/ci/requirements-3.4_SLOW.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz
+numpy
+cython
diff --git a/ci/requirements-3.4.txt b/ci/requirements-3.4_SLOW.run
similarity index 87%
rename from ci/requirements-3.4.txt
rename to ci/requirements-3.4_SLOW.run
index fd0a5bc53..4c60fb883 100644
--- a/ci/requirements-3.4.txt
+++ b/ci/requirements-3.4_SLOW.run
@@ -1,5 +1,6 @@
 python-dateutil
 pytz
+numpy
 openpyxl
 xlsxwriter
 xlrd
@@ -7,8 +8,6 @@ xlwt
 html5lib
 patsy
 beautiful-soup
-numpy
-cython
 scipy
 numexpr
 pytables
@@ -16,5 +15,6 @@ matplotlib
 lxml
 sqlalchemy
 bottleneck
-pymysql==0.6.3
+pymysql
 psycopg2
+statsmodels
diff --git a/ci/requirements-3.5.build b/ci/requirements-3.5.build
new file mode 100644
index 000000000..9558cf00d
--- /dev/null
+++ b/ci/requirements-3.5.build
@@ -0,0 +1,4 @@
+python-dateutil
+pytz
+numpy
+cython
diff --git a/ci/requirements-3.5.txt b/ci/requirements-3.5.run
similarity index 97%
rename from ci/requirements-3.5.txt
rename to ci/requirements-3.5.run
index 7af2c473b..f06cac7b8 100644
--- a/ci/requirements-3.5.txt
+++ b/ci/requirements-3.5.run
@@ -1,12 +1,11 @@
 python-dateutil
 pytz
+numpy
 openpyxl
 xlsxwriter
 xlrd
 xlwt
 patsy
-numpy
-cython
 scipy
 numexpr
 pytables
