commit c293c3b1d9e8175d48c767e62427a4313d7dc923
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sun Oct 9 12:49:56 2011 -0400

    BUG: change python access to buffer access

diff --git a/pandas/core/sparse.py b/pandas/core/sparse.py
index 40ca5f762..c02b0cee2 100644
--- a/pandas/core/sparse.py
+++ b/pandas/core/sparse.py
@@ -317,7 +317,7 @@ to sparse
     __itruediv__ = __truediv__
     __ifloordiv__ = __floordiv__
     __ipow__ = __pow__
-    
+
     # Python 2 division operators
     if not py3compat.PY3:
         __div__ = _sparse_op_wrap(operator.div, 'div')
diff --git a/pandas/src/sparse.pyx b/pandas/src/sparse.pyx
index 1fe4cada6..3b5bab7d8 100644
--- a/pandas/src/sparse.pyx
+++ b/pandas/src/sparse.pyx
@@ -364,7 +364,7 @@ cdef class BlockIndex(SparseIndex):
                     raise ValueError('Block %d extends beyond end' % i)
 
             # no zero-length blocks
-            if self.blengths[i] == 0:
+            if blengths[i] == 0:
                 raise ValueError('Zero-length block %d' % i)
 
     def equals(self, other):
@@ -747,7 +747,7 @@ cpdef sparse_nanpow(ndarray x, SparseIndex xindex,
 cdef inline tuple sparse_nancombine(ndarray x, SparseIndex xindex,
                                     ndarray y, SparseIndex yindex,
                                     double_func op):
-    # block_nanop is up to 40x slower and I don't know why yet
+    # faster to convert to IntIndex
     return int_nanop(x, xindex.to_int_index(),
                      y, yindex.to_int_index(), op)
 
