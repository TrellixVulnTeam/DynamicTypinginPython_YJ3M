commit 832b67cd0c43778a91e0fbfabc8aa163b76f1f10
Author: y-p <yoval@gmx.com>
Date:   Sat Feb 1 13:36:08 2014 +0200

    BLD: travis, reuse cython files if unchanged in last 5 master commits

diff --git a/ci/prep_ccache.sh b/ci/prep_ccache.sh
index c64da5d83..ffff9d7ac 100755
--- a/ci/prep_ccache.sh
+++ b/ci/prep_ccache.sh
@@ -8,7 +8,7 @@ if [ "$IRON_TOKEN" ]; then
 
     python ci/ironcache/get.py
     ccache -C
-    ccache -M 60M
+    ccache -M 120M
 
     if [ -f ~/ccache.7z ]; then
         echo "Cache retrieved"
@@ -21,6 +21,17 @@ if [ "$IRON_TOKEN" ]; then
         rm -rf $HOME/ccache
 
     fi
+
+    # did the last commit change cython files?
+    git show --pretty="format:" --name-only HEAD~5.. --first-parent | grep -P "pyx|pxd"
+
+    if [ "$?" != "0" ]; then
+        # nope, reuse cython files
+        echo "Will reuse cached cython file"
+        touch "$TRAVIS_BUILD_DIR"/pandas/*.c
+        touch "$TRAVIS_BUILD_DIR"/pandas/src/*.c
+        touch "$TRAVIS_BUILD_DIR"/pandas/*.cpp
+    fi
 fi
 
 exit 0
diff --git a/ci/submit_ccache.sh b/ci/submit_ccache.sh
index ba21b3780..0440be74e 100755
--- a/ci/submit_ccache.sh
+++ b/ci/submit_ccache.sh
@@ -14,20 +14,10 @@ if [ "$IRON_TOKEN" ]; then
     rm -rf ~/ccache.7z
 
     tar cf - $HOME/.ccache \
-        |  7za a -si ~/ccache.7z
-
-    # Caching the cython files could be be made to work.
-    # There's a timestamp issue to be handled (http://stackoverflow.com/questions/1964470)
-    # but you could get the build to reuse them.
-    # However, there's a race condition between travis cythonizing
-    # and a new commit being made on a GH server somewhere.
-    # and there's convenient causal link between the two we can
-    # take advantage of.
-    # Let's just wait another 60 seconds.
-    # "$TRAVIS_BUILD_DIR"/pandas/{index,algos,lib,tslib,parser,hashtable}.c \
-    # "$TRAVIS_BUILD_DIR"/pandas/src/{sparse,testing}.c \
-    # "$TRAVIS_BUILD_DIR"/pandas/msgpack.cpp  \
-    # |  7za a -si ~/ccache.7z
+    "$TRAVIS_BUILD_DIR"/pandas/{index,algos,lib,tslib,parser,hashtable}.c \
+    "$TRAVIS_BUILD_DIR"/pandas/src/{sparse,testing}.c \
+    "$TRAVIS_BUILD_DIR"/pandas/msgpack.cpp  \
+    |  7za a -si ~/ccache.7z
 
     split -b 500000 -d ~/ccache.7z ~/ccache.
 
