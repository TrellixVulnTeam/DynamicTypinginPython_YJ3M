commit d8f94e9c756e3c8f9b470945a18403fe9dd53217
Author: Andy Hayden <andyhayden1@gmail.com>
Date:   Mon Jan 27 16:25:28 2014 -0800

    PERF speed up str.get_dummies

diff --git a/pandas/core/strings.py b/pandas/core/strings.py
index fc0cc7fda..a41c06a6a 100644
--- a/pandas/core/strings.py
+++ b/pandas/core/strings.py
@@ -472,31 +472,31 @@ def str_get_dummies(arr, sep='|'):
     2  1  0  1
 
     >>> pd.Series(['a|b', np.nan, 'a|c']).str.get_dummies()
-        a   b   c
-    0   1   1   0
-    1 NaN NaN NaN
-    2   1   0   1
+       a  b  c
+    0  1  1  0
+    1  0  0  0
+    2  1  0  1
 
     See also ``pd.get_dummies``.
 
     """
-    def na_setunion(x, y):
-        try:
-            return x.union(y)
-        except TypeError:
-            return x
-
     # TODO remove this hack?
-    arr = sep + arr.fillna('').astype(str) + sep
+    arr = arr.fillna('')
+    try:
+        arr = sep + arr + sep
+    except TypeError:
+        arr = sep + arr.astype(str) + sep
+
+    tags = set()
+    for ts in arr.str.split(sep):
+        tags.update(ts)
+    tags = sorted(tags - set([""]))
 
-    from functools import reduce
-    tags = sorted(reduce(na_setunion, arr.str.split(sep), set())
-                  - set(['']))
     dummies = np.empty((len(arr), len(tags)), dtype=int)
 
     for i, t in enumerate(tags):
         pat = sep + t + sep
-        dummies[:, i] = _na_map(lambda x: pat in x, arr)
+        dummies[:, i] = lib.map_infer(arr.values, lambda x: pat in x)
     return DataFrame(dummies, arr.index, tags)
 
 
