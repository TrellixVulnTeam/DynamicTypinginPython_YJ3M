commit 761f0508f266d9a978355494c38cfb586ad5b437
Author: Chang She <chang@lambdafoundry.com>
Date:   Tue Jun 5 22:11:58 2012 -0400

    BUG: to_csv duplicate index values #1373

diff --git a/pandas/core/frame.py b/pandas/core/frame.py
index 48b144018..06f14479a 100644
--- a/pandas/core/frame.py
+++ b/pandas/core/frame.py
@@ -1092,7 +1092,9 @@ class DataFrame(NDFrame):
         if cols is None:
             cols = self.columns
 
-        series = self._series
+        series = {}
+        for k, v in self._series.iteritems():
+            series[k] = v.values
         if header:
             if index:
                 # should write something for index label
@@ -1122,7 +1124,7 @@ class DataFrame(NDFrame):
                 writer.writerow(encoded_cols)
 
         nlevels = getattr(self.index, 'nlevels', 1)
-        for idx in self.index:
+        for j, idx in enumerate(self.index):
             row_fields = []
             if index:
                 if nlevels == 1:
@@ -1130,7 +1132,7 @@ class DataFrame(NDFrame):
                 else:  # handle MultiIndex
                     row_fields = list(idx)
             for i, col in enumerate(cols):
-                val = series[col].get(idx)
+                val = series[col][j]
                 if isnull(val):
                     val = na_rep
 
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index cfb7138ab..109805ed4 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -3015,6 +3015,22 @@ class TestDataFrame(unittest.TestCase, CheckIndexing,
         recons = DataFrame.from_csv(path)
         assert_frame_equal(dm, recons)
 
+
+
+        #duplicate index
+        df = DataFrame(np.random.randn(3, 3), index=['a', 'a', 'b'],
+                       columns=['x', 'y', 'z'])
+        df.to_csv(path)
+        result = DataFrame.from_csv(path)
+        assert_frame_equal(result, df)
+
+        midx = MultiIndex.from_tuples([('A', 1, 2), ('A', 1, 2), ('B', 1, 2)])
+        df = DataFrame(np.random.randn(3, 3), index=midx,
+                       columns=['x', 'y', 'z'])
+        df.to_csv(path)
+        result = DataFrame.from_csv(path, index_col=[0, 1, 2],
+                                    parse_dates=False)
+        assert_frame_equal(result, df)
         os.remove(path)
 
     def test_to_csv_multiindex(self):
diff --git a/vb_suite/io_bench.py b/vb_suite/io_bench.py
index ea2af9608..d421466dd 100644
--- a/vb_suite/io_bench.py
+++ b/vb_suite/io_bench.py
@@ -38,3 +38,9 @@ df = DataFrame({'float1' : randn(10000),
 write_csv_standard = Benchmark("df.to_csv('__test__.csv')", setup2,
                                start_date=datetime(2011, 9, 15))
 
+#----------------------------------
+setup = common_setup + """
+df = DataFrame(np.random.randn(3000, 30))
+"""
+frame_to_csv = Benchmark("df.to_csv('__test__.csv')", setup,
+                         start_date=datetime(2011, 1, 1))
