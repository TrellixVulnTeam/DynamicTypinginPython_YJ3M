commit df63dfc905b406b269a19e17e65c7770efc33887
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Wed Apr 20 10:38:48 2011 -0400

    further sparse work, testing, etc.

diff --git a/pandas/core/frame.py b/pandas/core/frame.py
index 86432c670..cc2928ec0 100644
--- a/pandas/core/frame.py
+++ b/pandas/core/frame.py
@@ -659,7 +659,7 @@ class DataFrame(Picklable, Groupable):
                                      columns=self.columns)
 
         # teeny hack because one does DataFrame + TimeSeries all the time
-        if self.index._allDates and other.index._allDates:
+        if self.index.is_all_dates() and other.index.is_all_dates():
             return self._combine_match_index(other, func)
         else:
             return self._combine_match_columns(other, func)
diff --git a/pandas/core/index.py b/pandas/core/index.py
index 8a1968d29..bb1787e74 100644
--- a/pandas/core/index.py
+++ b/pandas/core/index.py
@@ -76,6 +76,9 @@ class Index(np.ndarray):
 
         return self._cache_allDates
 
+    def is_all_dates(self):
+        return self._allDates
+
     def _checkForDuplicates(self):
         if len(self.indexMap) < len(self):
             raise Exception('Index cannot contain duplicate values!')
diff --git a/pandas/core/series.py b/pandas/core/series.py
index e20e6e693..1c2393f5b 100644
--- a/pandas/core/series.py
+++ b/pandas/core/series.py
@@ -171,7 +171,7 @@ class Series(np.ndarray, Picklable, Groupable):
         subarr = subarr.view(cls)
         subarr.index = index
 
-        if subarr.index._allDates:
+        if subarr.index.is_all_dates():
             subarr = subarr.view(TimeSeries)
 
         return subarr
diff --git a/pandas/core/sparse.py b/pandas/core/sparse.py
index 41ff43af8..471bf93f9 100644
--- a/pandas/core/sparse.py
+++ b/pandas/core/sparse.py
@@ -3,7 +3,7 @@ Data structures for sparse float data. Life is made simpler by dealing only with
 float64 data
 """
 
-from numpy import NaN
+from numpy import nan
 import numpy as np
 
 import operator
@@ -17,7 +17,7 @@ from pandas.lib.sparse import BlockIndex, IntIndex
 import pandas.lib.sparse as splib
 import pandas.lib.tseries as tseries
 
-def make_sparse(arr, kind='block', fill_value=np.NaN):
+def make_sparse(arr, kind='block', fill_value=nan):
     """
     Convert ndarray to sparse format
 
@@ -31,9 +31,7 @@ def make_sparse(arr, kind='block', fill_value=np.NaN):
     -------
     vector : SparseVector
     """
-    if isinstance(arr, Series):
-        arr = arr.values
-
+    arr = np.asarray(arr)
     length = len(arr)
 
     if np.isnan(fill_value):
@@ -48,13 +46,13 @@ def make_sparse(arr, kind='block', fill_value=np.NaN):
         index = BlockIndex(length, locs, lens)
     elif kind == 'integer':
         index = IntIndex(length, indices)
-    else:
+    else: # pragma: no cover
         raise ValueError('must be block or integer type')
 
     sparsified_values = arr[mask]
     return sparsified_values, index
 
-def to_sparse_series(series, kind='block', fill_value=np.NaN):
+def to_sparse_series(series, kind='block', fill_value=nan):
     sp_values, sp_index = make_sparse(series, kind=kind, fill_value=fill_value)
     return SparseSeries(sp_values, index=series.index, sparse_index=sp_index,
                         fill_value=fill_value)
@@ -81,8 +79,6 @@ def _sparse_op_wrap(name):
             if np.isnan(self.fill_value):
                 sparse_op = lambda a, b: _sparse_nanop(a, b, name)
             else:
-                if self.fill_value != other.fill_value:
-                    raise Exception('Fill values must be the same')
                 sparse_op = lambda a, b: _sparse_fillop(a, b, name)
 
             new_index = self.index + other.index
@@ -92,15 +88,20 @@ def _sparse_op_wrap(name):
                 this = self.reindex(new_index)
                 other = other.reindex(new_index)
 
-            if self.sparse_index.equals(other.sparse_index):
-                result = py_op(this.sparse_values, other.sparse_values)
-                result_index = self.sparse_index
+            if self.sp_index.equals(other.sp_index):
+                result = py_op(this.sp_values, other.sp_values)
+                result_index = self.sp_index
             else:
                 result, result_index = sparse_op(this, other)
 
-            return SparseSeries(result, index=self.index,
+            try:
+                fill_value = py_op(this.fill_value, other.fill_value)
+            except ZeroDivisionError:
+                fill_value = nan
+
+            return SparseSeries(result, index=new_index,
                                 sparse_index=result_index,
-                                fill_value=self.fill_value)
+                                fill_value=fill_value)
 
         elif isinstance(other, SparseDataFrame):
             reverse_op = _MIRROR_OPS.get(name)
@@ -108,44 +109,57 @@ def _sparse_op_wrap(name):
                 raise Exception('Cannot do %s op, sorry!')
             return getattr(other, reverse_op)(self)
         elif np.isscalar(other):
-            return SparseSeries(py_op(self.sparse_values, other),
+            return SparseSeries(py_op(self.sp_values, other),
                                 index=self.index,
-                                sparse_index=self.sparse_index,
+                                sparse_index=self.sp_index,
                                 fill_value=py_op(self.fill_value, other))
 
     wrapper.__name__ = name
     return wrapper
 
 def _sparse_nanop(this, other, name):
-    sparse_op = getattr(splib, 'sparse_nan%d' % name)
-    result, result_index = sparse_op(this.sparse_values,
-                                     this.sparse_index,
-                                     other.sparse_values,
-                                     other.sparse_index)
+    sparse_op = getattr(splib, 'sparse_nan%s' % name)
+    result, result_index = sparse_op(this.sp_values,
+                                     this.sp_index,
+                                     other.sp_values,
+                                     other.sp_index)
 
     return result, result_index
 
 def _sparse_fillop(this, other, name):
     # TODO!
-    sparse_op = getattr(splib, 'sparse_%d' % name)
-    result, result_index = sparse_op(this.sparse_values,
-                                     this.sparse_index,
-                                     other.sparse_values,
-                                     other.sparse_index)
+    sparse_op = getattr(splib, 'sparse_%s' % name)
+    result, result_index = sparse_op(this.sp_values,
+                                     this.sp_index,
+                                     this.fill_value,
+                                     other.sp_values,
+                                     other.sp_index,
+                                     other.fill_value)
 
     return result, result_index
 
+"""
+Notes.
+
+- Not sure if subclassing is the way to go, could just lead to trouble on down
+  the road (e.g. if putting a SparseSeries in a regular DataFrame...). But on
+  the other hand you do get many things for free...
+
+- Will need to "disable" a number of methods?
+"""
+
 class SparseSeries(Series):
     """
     Data structure for labeled, sparse floating point data
 
     Parameters
     ----------
+    data : {array-like, Series, SparseSeries, dict}
     kind : {'block', 'integer'}
     fill_value : float
         Defaults to NaN (code for missing)
     """
-    sparse_index = None
+    sp_index = None
     fill_value = None
 
     def __new__(cls, data, index=None, sparse_index=None,
@@ -163,31 +177,40 @@ class SparseSeries(Series):
 
             values = np.asarray(data)
         elif isinstance(data, (Series, dict)):
-            data = Series(data)
+            if fill_value is None:
+                fill_value = nan
 
+            data = Series(data)
             if index is None:
                 index = data.index
+            values, sparse_index = make_sparse(data, kind=kind,
+                                               fill_value=fill_value)
+        else:
+            if fill_value is None:
+                fill_value = nan
 
-            values, sparse_index = make_sparse(data.values, kind=kind)
-        elif isinstance(data, np.ndarray):
+            # array-like
             if sparse_index is None:
-                values, sparse_index = make_sparse(data, kind=kind)
+                values, sparse_index = make_sparse(data, kind=kind,
+                                                   fill_value=fill_value)
             else:
                 values = data
                 assert(len(values) == sparse_index.npoints)
 
         if index is None:
             index = Index(np.arange(sparse_index.length))
+        elif not isinstance(index, Index):
+            index = Index(index)
 
         # Create array, do *not* copy data by default
         subarr = np.array(values, dtype=np.float64, copy=False)
 
-        if index._allDates:
+        if index.is_all_dates():
             cls = SparseTimeSeries
 
         # Change the class of the array to be the subclass type.
         subarr = subarr.view(cls)
-        subarr.sparse_index = sparse_index
+        subarr.sp_index = sparse_index
         subarr.fill_value = fill_value
         subarr.index = index
         return subarr
@@ -198,11 +221,11 @@ class SparseSeries(Series):
         to pass on the index.
         """
         self._index = getattr(obj, '_index', None)
-        self.sparse_index = getattr(obj, 'sparse_index', None)
+        self.sp_index = getattr(obj, 'sp_index', None)
         self.fill_value = getattr(obj, 'fill_value', None)
 
     def __len__(self):
-        return self.sparse_index.length
+        return self.sp_index.length
 
     # Arithmetic operators
 
@@ -222,14 +245,14 @@ class SparseSeries(Series):
 
     @property
     def values(self):
-        output = np.empty(self.sparse_index.length, dtype=np.float64)
-        int_index = self.sparse_index.to_int_index()
+        output = np.empty(self.sp_index.length, dtype=np.float64)
+        int_index = self.sp_index.to_int_index()
         output.fill(self.fill_value)
         output.put(int_index.indices, self)
         return output
 
     @property
-    def sparse_values(self):
+    def sp_values(self):
         return np.asarray(self)
 
     def to_dense(self):
@@ -243,9 +266,9 @@ class SparseSeries(Series):
         return self.copy()
 
     def copy(self):
-        values = self.sparse_values.copy()
+        values = self.sp_values.copy()
         return SparseSeries(values, index=self.index,
-                            sparse_index=self.sparse_index)
+                            sparse_index=self.sp_index)
 
     def reindex(self, new_index):
         return SparseSeries(self.to_dense().reindex(new_index))
@@ -257,7 +280,7 @@ class SparseSeries(Series):
             new_index = Index(new_index)
 
         if len(self.index) == 0:
-            return Series(NaN, index=new_index)
+            return Series(nan, index=new_index)
 
         indexer, mask = tseries.getFillVec(self.index, new_index,
                                            self.index.indexMap,
@@ -312,7 +335,7 @@ class SparseDataFrame(DataFrame):
                                          fill_value=self.fill_value)
             else:
                 if isinstance(v, dict):
-                    v = [v.get(i, NaN) for i in index]
+                    v = [v.get(i, nan) for i in index]
 
                 v = SparseSeries(v, index=index, kind=self.kind).copy()
 
@@ -347,7 +370,7 @@ class SparseDataFrame(DataFrame):
             new = values.take(indexer)
 
             if need_mask:
-                new[notmask] = np.NaN
+                new[notmask] = nan
 
             new_series[col] = new
 
diff --git a/pandas/core/tests/test_sparse.py b/pandas/core/tests/test_sparse.py
new file mode 100644
index 000000000..8416fd15b
--- /dev/null
+++ b/pandas/core/tests/test_sparse.py
@@ -0,0 +1,213 @@
+from unittest import TestCase
+import operator
+
+from numpy import nan
+import numpy as np
+
+from pandas.util.testing import assert_almost_equal, assert_series_equal
+from numpy.testing import assert_equal
+
+from pandas.core.sparse import (IntIndex, BlockIndex, SparseSeries)
+import pandas.core.sparse as sparsem
+
+"""
+Testing TODO
+
+
+"""
+def _test_data1():
+    # nan-based
+    arr = np.arange(20, dtype=float)
+    index = np.arange(20)
+    arr[:2] = nan
+    arr[5:10] = nan
+    arr[-3:] = nan
+
+    return arr, index
+
+def _test_data2():
+    # nan-based
+    arr = np.arange(15, dtype=float)
+    index = np.arange(15)
+    arr[7:12] = nan
+    arr[-1:] = nan
+    return arr, index
+
+def _test_data1_zero():
+    # zero-based
+    arr, index = _test_data1()
+    arr[np.isnan(arr)] = 0
+    return arr, index
+
+def _test_data2_zero():
+    # zero-based
+    arr, index = _test_data2()
+    arr[np.isnan(arr)] = 0
+    return arr, index
+
+def assert_sp_series_equal(a, b):
+    assert_equal(a.sp_values, b.sp_values)
+    assert(a.sp_index.equals(b.sp_index))
+    if np.isnan(a.fill_value):
+        assert(np.isnan(b.fill_value))
+    else:
+        assert(a.fill_value == b.fill_value)
+
+def assert_sp_frame_equal(left, right):
+    for col, series in left.iteritems():
+        assert(col in right)
+        assert_sp_series_equal(series, right[col])
+
+    for col in right:
+        assert(col in left)
+
+class TestSparseSeries(TestCase):
+
+    def setUp(self):
+        arr, index = _test_data1()
+        self.bseries = SparseSeries(arr, index=index, kind='block')
+        self.iseries = SparseSeries(arr, index=index, kind='integer')
+
+        arr, index = _test_data2()
+        self.bseries2 = SparseSeries(arr, index=index, kind='block')
+        self.iseries2 = SparseSeries(arr, index=index, kind='integer')
+
+        arr, index = _test_data1_zero()
+        self.zbseries = SparseSeries(arr, index=index, kind='block',
+                                     fill_value=0)
+        self.ziseries = SparseSeries(arr, index=index, kind='integer',
+                                     fill_value=0)
+
+        arr, index = _test_data2_zero()
+        self.zbseries2 = SparseSeries(arr, index=index, kind='block',
+                                      fill_value=0)
+        self.ziseries2 = SparseSeries(arr, index=index, kind='integer',
+                                      fill_value=0)
+
+    def test_to_dense(self):
+        arr, index = _test_data1()
+        series = self.bseries.to_dense()
+        assert_equal(series, arr)
+
+        series = self.iseries.to_dense()
+        assert_equal(series, arr)
+
+    def test_to_sparse_series(self):
+        series = self.bseries.to_dense()
+        bseries = sparsem.to_sparse_series(series, kind='block')
+        iseries = sparsem.to_sparse_series(series, kind='integer')
+        assert_sp_series_equal(bseries, self.bseries)
+        assert_sp_series_equal(iseries, self.iseries)
+
+        # non-NaN fill value
+        series = self.zbseries.to_dense()
+        zbseries = sparsem.to_sparse_series(series, kind='block',
+                                            fill_value=0)
+        ziseries = sparsem.to_sparse_series(series, kind='integer',
+                                            fill_value=0)
+        assert_sp_series_equal(zbseries, self.zbseries)
+        assert_sp_series_equal(ziseries, self.ziseries)
+
+    def test_constructor(self):
+        # test setup guys
+        self.assert_(np.isnan(self.bseries.fill_value))
+        self.assert_(isinstance(self.bseries.sp_index, BlockIndex))
+        self.assert_(np.isnan(self.iseries.fill_value))
+        self.assert_(isinstance(self.iseries.sp_index, IntIndex))
+
+        self.assertEquals(self.zbseries.fill_value, 0)
+        assert_equal(self.zbseries.values, self.bseries.to_dense().fillna(0))
+
+        # pass SparseSeries
+
+        # pass Series
+        series = self.bseries.to_dense()
+        bseries2 = SparseSeries(series)
+        assert_equal(self.bseries.sp_values, bseries2.sp_values)
+
+        # pass dict
+
+    def test_constructor_nonnan(self):
+        arr = [0, 0, 0, nan, nan]
+        sp_series = SparseSeries(arr, fill_value=0)
+        assert_equal(sp_series.values, arr)
+
+    def test_getitem(self):
+        pass
+
+    def test_setitem(self):
+        pass
+
+    def test_slice(self):
+        pass
+
+    def test_setslice(self):
+        pass
+
+    def test_serialize(self):
+        pass
+
+    def test_operators(self):
+        def _check_op(a, b, op):
+            sp_result = op(a, b)
+            adense = a.to_dense() if isinstance(a, SparseSeries) else a
+            bdense = b.to_dense() if isinstance(b, SparseSeries) else b
+            dense_result = op(adense, bdense)
+            assert_almost_equal(sp_result.to_dense(), dense_result)
+
+        def check(a, b):
+            _check_op(a, b, operator.add)
+            _check_op(a, b, operator.sub)
+            _check_op(a, b, operator.div)
+            _check_op(a, b, operator.mul)
+            _check_op(a, b, operator.pow)
+
+            _check_op(a, b, lambda x, y: operator.add(y, x))
+            _check_op(a, b, lambda x, y: operator.sub(y, x))
+            _check_op(a, b, lambda x, y: operator.div(y, x))
+            _check_op(a, b, lambda x, y: operator.mul(y, x))
+            _check_op(a, b, lambda x, y: operator.pow(y, x))
+
+        check(self.bseries, self.bseries)
+        check(self.iseries, self.iseries)
+        check(self.bseries, self.iseries)
+
+        check(self.bseries, self.bseries2)
+        check(self.bseries, self.iseries2)
+        check(self.iseries, self.iseries2)
+
+        # scalar value
+        check(self.bseries, 5)
+
+        # zero-based
+        check(self.zbseries, self.zbseries * 2)
+        check(self.zbseries, self.zbseries + 2)
+        check(self.ziseries, self.ziseries * 2)
+
+    def test_reindex(self):
+        pass
+
+    def test_repr(self):
+        pass
+
+    def test_iter(self):
+        pass
+
+    def test_truncate(self):
+        pass
+
+    def test_fillna(self):
+        pass
+
+    def test_groupby(self):
+        pass
+
+class TestSparseTimeSeries(TestCase):
+    pass
+
+
+if __name__ == '__main__':
+    import nose
+    nose.runmodule(argv=[__file__,'-vvs','-x','--pdb', '--pdb-failure'],
+                   exit=False)
+
diff --git a/pandas/lib/src/common.pyx b/pandas/lib/src/common.pyx
index f9b37c2c5..a34d97ba2 100644
--- a/pandas/lib/src/common.pyx
+++ b/pandas/lib/src/common.pyx
@@ -155,8 +155,13 @@ cdef double __add(double a, double b):
     return a + b
 cdef double __sub(double a, double b):
     return a - b
+
 cdef double __div(double a, double b):
-    return a / b
+    if b == 0:
+        return NaN
+    else:
+        return a / b
+
 cdef double __mul(double a, double b):
     return a * b
 cdef double __eq(double a, double b):
@@ -167,7 +172,11 @@ cdef double __lt(double a, double b):
     return a < b
 cdef double __gt(double a, double b):
     return a > b
+
 cdef double __pow(double a, double b):
+    # NaN
+    if a != a or b != b:
+        return NaN
     return a ** b
 
 ctypedef double (* double_func)(double a, double b)
diff --git a/pandas/lib/src/sparse.pyx b/pandas/lib/src/sparse.pyx
index e2576b6cf..e2a71e703 100644
--- a/pandas/lib/src/sparse.pyx
+++ b/pandas/lib/src/sparse.pyx
@@ -17,23 +17,31 @@ cdef float64_t NaN = <float64_t> np.NaN
 cdef inline int int_max(int a, int b): return a if a >= b else b
 cdef inline int int_min(int a, int b): return a if a <= b else b
 
-cdef float64_t __add(float64_t a, float64_t b):
+cdef inline float64_t __add(float64_t a, float64_t b):
     return a + b
-cdef float64_t __sub(float64_t a, float64_t b):
+cdef inline float64_t __sub(float64_t a, float64_t b):
     return a - b
-cdef float64_t __div(float64_t a, float64_t b):
-    return a / b
-cdef float64_t __mul(float64_t a, float64_t b):
+cdef inline float64_t __div(float64_t a, float64_t b):
+    if b == 0:
+        return NaN
+    else:
+        return a / b
+
+cdef inline float64_t __mul(float64_t a, float64_t b):
     return a * b
-cdef float64_t __eq(float64_t a, float64_t b):
+cdef inline float64_t __eq(float64_t a, float64_t b):
     return a == b
-cdef float64_t __ne(float64_t a, float64_t b):
+cdef inline float64_t __ne(float64_t a, float64_t b):
     return a != b
-cdef float64_t __lt(float64_t a, float64_t b):
+cdef inline float64_t __lt(float64_t a, float64_t b):
     return a < b
-cdef float64_t __gt(float64_t a, float64_t b):
+cdef inline float64_t __gt(float64_t a, float64_t b):
     return a > b
-cdef float64_t __pow(float64_t a, float64_t b):
+
+cdef inline float64_t __pow(float64_t a, float64_t b):
+    # NaN
+    if a != a or b != b:
+        return NaN
     return a ** b
 
 ctypedef float64_t (* double_func)(float64_t a, float64_t b)
@@ -84,7 +92,7 @@ cdef class IntIndex(SparseIndex):
 
     def equals(self, other):
         if not isinstance(other, IntIndex):
-            raise Exception('Can only compare with like object')
+            return False
 
         same_length = self.length == other.length
         same_indices = np.array_equal(self.indices, other.indices)
@@ -232,7 +240,7 @@ cdef class BlockIndex(SparseIndex):
 
     def equals(self, other):
         if not isinstance(other, BlockIndex):
-            raise Exception('Can only compare with like object')
+            return False
 
         same_length = self.length == other.length
         same_blocks = (np.array_equal(self.blocs, other.blocs) and
@@ -356,7 +364,74 @@ cdef class BlockIndex(SparseIndex):
         -------
         union : BlockIndex
         '''
-        pass
+        cdef:
+            BlockIndex y
+            pyst out_length
+            ndarray[int32_t, ndim=1] xloc, xlen, yloc, ylen
+
+            list out_blocs = []
+            list out_blengths = []
+
+            pyst xi = 0, yi = 0 # block indices
+            int32_t cur_loc, cur_length, xend, yend, diff
+
+
+        y = other.to_block_index()
+
+        # unwise? should enforce same length?
+        out_length = int_max(self.length, y.length)
+
+        xloc = self.blocs
+        xlen = self.blengths
+        yloc = y.blocs
+        ylen = y.blengths
+
+        while True:
+            # we are done (or possibly never began)
+            if xi >= self.nblocks or yi >= y.nblocks:
+                break
+
+            # completely symmetric...would like to avoid code dup but oh well
+            if xloc[xi] >= yloc[yi]:
+                cur_loc = xloc[xi]
+                diff = xloc[xi] - yloc[yi]
+
+                if ylen[yi] - diff <= 0:
+                    # have to skip this block
+                    yi += 1
+                    continue
+
+                if ylen[yi] - diff < xlen[xi]:
+                    # take end of y block, move onward
+                    cur_length = ylen[yi] - diff
+                    yi += 1
+                else:
+                    # take end of x block
+                    cur_length = xlen[xi]
+                    xi += 1
+
+            else: # xloc[xi] < yloc[yi]
+                cur_loc = yloc[yi]
+                diff = yloc[yi] - xloc[xi]
+
+                if xlen[xi] - diff <= 0:
+                    # have to skip this block
+                    xi += 1
+                    continue
+
+                if xlen[xi] - diff < ylen[yi]:
+                    # take end of x block, move onward
+                    cur_length = xlen[xi] - diff
+                    xi += 1
+                else:
+                    # take end of y block
+                    cur_length = ylen[yi]
+                    yi += 1
+
+            out_blocs.append(cur_loc)
+            out_blengths.append(cur_length)
+
+        return BlockIndex(self.length, out_blocs, out_blengths)
 
 #-------------------------------------------------------------------------------
 # Sparse arithmetic
@@ -390,6 +465,41 @@ cdef tuple sparse_nancombine(ndarray x, SparseIndex xindex,
         return int_nanop(x, xindex.to_int_index(),
                          y, yindex.to_int_index(), op)
 
+cpdef sparse_add(ndarray x, SparseIndex xindex, float64_t xfill,
+                 ndarray y, SparseIndex yindex, float64_t yfill):
+    return sparse_nancombine(x, xindex, xfill,
+                             y, yindex, yfill, __add)
+
+cpdef sparse_sub(ndarray x, SparseIndex xindex, float64_t xfill,
+                 ndarray y, SparseIndex yindex, float64_t yfill):
+    return sparse_nancombine(x, xindex, xfill,
+                             y, yindex, yfill, __sub)
+
+cpdef sparse_mul(ndarray x, SparseIndex xindex, float64_t xfill,
+                 ndarray y, SparseIndex yindex, float64_t yfill):
+    return sparse_nancombine(x, xindex, xfill,
+                             y, yindex, yfill, __mul)
+
+cpdef sparse_div(ndarray x, SparseIndex xindex, float64_t xfill,
+                 ndarray y, SparseIndex yindex, float64_t yfill):
+    return sparse_nancombine(x, xindex, xfill,
+                             y, yindex, yfill, __div)
+
+cpdef sparse_pow(ndarray x, SparseIndex xindex, float64_t xfill,
+                 ndarray y, SparseIndex yindex, float64_t yfill):
+    return sparse_nancombine(x, xindex, xfill,
+                             y, yindex, yfill, __pow)
+
+cdef tuple sparse_combine(ndarray x, SparseIndex xindex, float64_t xfill,
+                          ndarray y, SparseIndex yindex, float64_t yfill,
+                          double_func op):
+    if isinstance(xindex, BlockIndex):
+        return block_op(x, xindex.to_block_index(), xfill,
+                        y, yindex.to_block_index(), yfill, op)
+    elif isinstance(xindex, IntIndex):
+        return int_op(x, xindex.to_int_index(), xfill,
+                      y, yindex.to_int_index(), yfill, op)
+
 # NaN-based arithmetic operation-- no handling of fill values
 # TODO: faster to convert everything to dense?
 
@@ -486,13 +596,68 @@ cdef tuple int_nanop(ndarray[float64_t, ndim=1] x, IntIndex xindex,
 
 
 cdef tuple block_op(ndarray[float64_t, ndim=1] x, BlockIndex xindex,
+                    float64_t xfill,
                     ndarray[float64_t, ndim=1] y, BlockIndex yindex,
-                    float64_t fill_value, double_func op):
-    pass
+                    float64_t yfill, double_func op):
+    cdef:
+        BlockIndex out_index
+        int xi = 0, yi = 0, out_i = 0 # fp buf indices
+        int xbp = 0, ybp = 0, obp = 0 # block positions
+        pyst xblock = 0, yblock = 0, outblock = 0 # block numbers
+
+        ndarray[float64_t, ndim=1] out
+
+    out_index = xindex.make_union(yindex)
+    out = np.empty(out_index.npoints, dtype=np.float64)
+
+    # walk the two SparseVectors, adding matched locations...
+    for out_i from 0 <= out_i < out_index.npoints:
+
+        # I have a feeling this is inefficient
+
+        # walk x
+        while xindex.locbuf[xblock] + xbp < out_index.locbuf[outblock] + obp:
+            xbp += 1
+            xi += 1
+            if xbp == xindex.lenbuf[xblock]:
+                xblock += 1
+                xbp = 0
+
+        # walk y
+        while yindex.locbuf[yblock] + ybp < out_index.locbuf[outblock] + obp:
+            ybp += 1
+            yi += 1
+            if ybp == yindex.lenbuf[yblock]:
+                yblock += 1
+                ybp = 0
+
+        out[out_i] = op(x[xi], y[yi])
+
+        # advance. strikes me as too complicated
+        xi += 1
+        yi += 1
+
+        xbp += 1
+        if xbp == xindex.lenbuf[xblock]:
+            xblock += 1
+            xbp = 0
+
+        ybp += 1
+        if ybp == yindex.lenbuf[yblock]:
+            yblock += 1
+            ybp = 0
+
+        obp += 1
+        if obp == out_index.lenbuf[outblock]:
+            outblock += 1
+            obp = 0
+
+    return out, out_index
 
 cdef tuple int_op(ndarray[float64_t, ndim=1] x, BlockIndex xindex,
+                  float64_t xfill,
                   ndarray[float64_t, ndim=1] y, BlockIndex yindex,
-                  float64_t fill_value, double_func op):
+                  float64_t yfill, double_func op):
     pass
 
 #-------------------------------------------------------------------------------
diff --git a/pandas/lib/src/tseries.c b/pandas/lib/src/tseries.c
index 1927a8618..2d09ffadb 100644
--- a/pandas/lib/src/tseries.c
+++ b/pandas/lib/src/tseries.c
@@ -1,4 +1,4 @@
-/* Generated by Cython 0.13 on Fri Dec 24 16:25:31 2010 */
+/* Generated by Cython 0.14.1 on Tue Apr 19 15:02:07 2011 */
 
 #define PY_SSIZE_T_CLEAN
 #include "Python.h"
@@ -126,15 +126,20 @@
   #define PyBytes_Repr                 PyString_Repr
   #define PyBytes_Concat               PyString_Concat
   #define PyBytes_ConcatAndDel         PyString_ConcatAndDel
+#endif
+
+#if PY_VERSION_HEX < 0x02060000
   #define PySet_Check(obj)             PyObject_TypeCheck(obj, &PySet_Type)
   #define PyFrozenSet_Check(obj)       PyObject_TypeCheck(obj, &PyFrozenSet_Type)
 #endif
-
 #ifndef PySet_CheckExact
-#  define PySet_CheckExact(obj)          (Py_TYPE(obj) == &PySet_Type)
+  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
 #endif
 
+#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
+
 #if PY_MAJOR_VERSION >= 3
+  #define PyIntObject                  PyLongObject
   #define PyInt_Type                   PyLong_Type
   #define PyInt_Check(op)              PyLong_Check(op)
   #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
@@ -151,7 +156,7 @@
 #endif
 
 #if PY_MAJOR_VERSION >= 3
-  #define PyBoolObject PyLongObject
+  #define PyBoolObject                 PyLongObject
 #endif
 
 
@@ -163,6 +168,25 @@
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
 #endif
 
+#if (PY_MAJOR_VERSION < 3) || (PY_VERSION_HEX >= 0x03010300)
+  #define __Pyx_PySequence_GetSlice(obj, a, b) PySequence_GetSlice(obj, a, b)
+  #define __Pyx_PySequence_SetSlice(obj, a, b, value) PySequence_SetSlice(obj, a, b, value)
+  #define __Pyx_PySequence_DelSlice(obj, a, b) PySequence_DelSlice(obj, a, b)
+#else
+  #define __Pyx_PySequence_GetSlice(obj, a, b) (unlikely(!(obj)) ? \
+        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), (PyObject*)0) : \
+        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_GetSlice(obj, a, b)) : \
+            (PyErr_Format(PyExc_TypeError, "'%.200s' object is unsliceable", (obj)->ob_type->tp_name), (PyObject*)0)))
+  #define __Pyx_PySequence_SetSlice(obj, a, b, value) (unlikely(!(obj)) ? \
+        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
+        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_SetSlice(obj, a, b, value)) : \
+            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice assignment", (obj)->ob_type->tp_name), -1)))
+  #define __Pyx_PySequence_DelSlice(obj, a, b) (unlikely(!(obj)) ? \
+        (PyErr_SetString(PyExc_SystemError, "null argument to internal routine"), -1) : \
+        (likely((obj)->ob_type->tp_as_mapping) ? (PySequence_DelSlice(obj, a, b)) : \
+            (PyErr_Format(PyExc_TypeError, "'%.200s' object doesn't support slice deletion", (obj)->ob_type->tp_name), -1)))
+#endif
+
 #if PY_MAJOR_VERSION >= 3
   #define PyMethod_New(func, self, klass) ((self) ? PyMethod_New(func, self) : PyInstanceMethod_New(func))
 #endif
@@ -205,6 +229,11 @@
 #include "cobject.h"
 #include "datetime.h"
 
+#ifdef PYREX_WITHOUT_ASSERTIONS
+#define CYTHON_WITHOUT_ASSERTIONS
+#endif
+
+
 /* inline attribute */
 #ifndef CYTHON_INLINE
   #if defined(__GNUC__)
@@ -214,7 +243,7 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_INLINE inline
   #else
-    #define CYTHON_INLINE 
+    #define CYTHON_INLINE
   #endif
 #endif
 
@@ -222,14 +251,14 @@
 #ifndef CYTHON_UNUSED
 # if defined(__GNUC__)
 #   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
-#     define CYTHON_UNUSED __attribute__ ((__unused__)) 
+#     define CYTHON_UNUSED __attribute__ ((__unused__))
 #   else
 #     define CYTHON_UNUSED
 #   endif
 # elif defined(__ICC) || defined(__INTEL_COMPILER)
-#   define CYTHON_UNUSED __attribute__ ((__unused__)) 
+#   define CYTHON_UNUSED __attribute__ ((__unused__))
 # else
-#   define CYTHON_UNUSED 
+#   define CYTHON_UNUSED
 # endif
 #endif
 
@@ -254,7 +283,7 @@ static CYTHON_INLINE size_t __Pyx_PyInt_AsSize_t(PyObject*);
 
 #ifdef __GNUC__
 /* Test for GCC > 2.95 */
-#if __GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
+#if __GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95))
 #define likely(x)   __builtin_expect(!!(x), 1)
 #define unlikely(x) __builtin_expect(!!(x), 0)
 #else /* __GNUC__ > 2 ... */
@@ -311,6 +340,7 @@ static const char *__pyx_f[] = {
   "numpy.pxd",
   "tseries.pyx",
   "bool.pxd",
+  "complex.pxd",
 };
 
 typedef npy_int8 __pyx_t_5numpy_int8_t;
@@ -383,11 +413,11 @@ typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
 
 typedef npy_cdouble __pyx_t_5numpy_complex_t;
 
-typedef __pyx_t_5numpy_double_t (*__pyx_t_7tseries_skiplist_f)(PyObject *, int, int);
-
 typedef double (*__pyx_t_7tseries_double_func)(double, double);
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":46
+typedef __pyx_t_5numpy_double_t (*__pyx_t_7tseries_skiplist_f)(PyObject *, int, int);
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":46
  * NIL = Node(np.inf, [], [])
  * 
  * cdef class IndexableSkiplist:             # <<<<<<<<<<<<<<
@@ -403,7 +433,7 @@ struct __pyx_obj_7tseries_IndexableSkiplist {
   struct __pyx_obj_7tseries_Node *head;
 };
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":32
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":32
  * # TODO: optimize this, make less messy
  * 
  * cdef class Node:             # <<<<<<<<<<<<<<
@@ -419,7 +449,7 @@ struct __pyx_obj_7tseries_Node {
 };
 
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":46
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":46
  * NIL = Node(np.inf, [], [])
  * 
  * cdef class IndexableSkiplist:             # <<<<<<<<<<<<<<
@@ -484,6 +514,11 @@ static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/
 
 static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
 
+static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
+static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
+
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
+
 static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
     const char *name, int exact); /*proto*/
 
@@ -514,15 +549,12 @@ static CYTHON_INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
 static void __Pyx_RaiseBufferIndexError(int axis); /*proto*/
 #define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
 
-static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
-static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/
 
 static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name, PyObject* kw_name); /*proto*/
 
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found); /*proto*/
-
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/
 
 
@@ -635,11 +667,8 @@ static CYTHON_INLINE PyObject* __Pyx_PyBoolOrNull_FromLong(long b) {
     return unlikely(b < 0) ? NULL : __Pyx_PyBool_FromLong(b);
 }
 
-static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);
-
 static CYTHON_INLINE void __Pyx_RaiseNoneIndexingError(void);
 
-
 #if PY_MAJOR_VERSION >= 3
 static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
     PyObject *value;
@@ -671,6 +700,8 @@ static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
 static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
 static int __Pyx_EndUnpack(PyObject *, Py_ssize_t expected); /*proto*/
 
+static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);
+
 static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index); /*proto*/
 
 static CYTHON_INLINE void __Pyx_ExceptionSave(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
@@ -688,8 +719,6 @@ Py_ssize_t __Pyx_minusones[] = {-1};
 
 static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/
 
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
-
 static CYTHON_INLINE npy_int32 __Pyx_PyInt_from_py_npy_int32(PyObject *);
 
 static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_npy_int64(npy_int64);
@@ -727,11 +756,17 @@ static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(floa
   #ifdef __cplusplus
     #define __Pyx_c_is_zerof(z) ((z)==(float)0)
     #define __Pyx_c_conjf(z)    (::std::conj(z))
-    /*#define __Pyx_c_absf(z)     (::std::abs(z))*/
+    #if 1
+        #define __Pyx_c_absf(z)     (::std::abs(z))
+        #define __Pyx_c_powf(a, b)  (::std::pow(a, b))
+    #endif
   #else
     #define __Pyx_c_is_zerof(z) ((z)==0)
     #define __Pyx_c_conjf(z)    (conjf(z))
-    /*#define __Pyx_c_absf(z)     (cabsf(z))*/
+    #if 1
+        #define __Pyx_c_absf(z)     (cabsf(z))
+        #define __Pyx_c_powf(a, b)  (cpowf(a, b))
+    #endif
  #endif
 #else
     static CYTHON_INLINE int __Pyx_c_eqf(__pyx_t_float_complex, __pyx_t_float_complex);
@@ -742,7 +777,10 @@ static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(floa
     static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_negf(__pyx_t_float_complex);
     static CYTHON_INLINE int __Pyx_c_is_zerof(__pyx_t_float_complex);
     static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conjf(__pyx_t_float_complex);
-    /*static CYTHON_INLINE float __Pyx_c_absf(__pyx_t_float_complex);*/
+    #if 1
+        static CYTHON_INLINE float __Pyx_c_absf(__pyx_t_float_complex);
+        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_powf(__pyx_t_float_complex, __pyx_t_float_complex);
+    #endif
 #endif
 
 static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double, double);
@@ -757,11 +795,17 @@ static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(do
   #ifdef __cplusplus
     #define __Pyx_c_is_zero(z) ((z)==(double)0)
     #define __Pyx_c_conj(z)    (::std::conj(z))
-    /*#define __Pyx_c_abs(z)     (::std::abs(z))*/
+    #if 1
+        #define __Pyx_c_abs(z)     (::std::abs(z))
+        #define __Pyx_c_pow(a, b)  (::std::pow(a, b))
+    #endif
   #else
     #define __Pyx_c_is_zero(z) ((z)==0)
     #define __Pyx_c_conj(z)    (conj(z))
-    /*#define __Pyx_c_abs(z)     (cabs(z))*/
+    #if 1
+        #define __Pyx_c_abs(z)     (cabs(z))
+        #define __Pyx_c_pow(a, b)  (cpow(a, b))
+    #endif
  #endif
 #else
     static CYTHON_INLINE int __Pyx_c_eq(__pyx_t_double_complex, __pyx_t_double_complex);
@@ -772,7 +816,10 @@ static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(do
     static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg(__pyx_t_double_complex);
     static CYTHON_INLINE int __Pyx_c_is_zero(__pyx_t_double_complex);
     static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj(__pyx_t_double_complex);
-    /*static CYTHON_INLINE double __Pyx_c_abs(__pyx_t_double_complex);*/
+    #if 1
+        static CYTHON_INLINE double __Pyx_c_abs(__pyx_t_double_complex);
+        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow(__pyx_t_double_complex, __pyx_t_double_complex);
+    #endif
 #endif
 
 static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject *);
@@ -882,8 +929,11 @@ static PyTypeObject *__pyx_ptype_7cpython_4bool_bool = 0;
 
 /* Module declarations from cpython.float */
 
+/* Module declarations from __builtin__ */
+
 /* Module declarations from cpython.complex */
 
+static PyTypeObject *__pyx_ptype_7cpython_7complex_complex = 0;
 /* Module declarations from cpython.string */
 
 /* Module declarations from cpython.unicode */
@@ -935,14 +985,6 @@ static __pyx_t_5numpy_int32_t *__pyx_f_7tseries_get_int32_ptr(PyArrayObject *);
 static __pyx_t_5numpy_int64_t *__pyx_f_7tseries_get_int64_ptr(PyArrayObject *); /*proto*/
 static __pyx_t_5numpy_double_t *__pyx_f_7tseries_get_double_ptr(PyArrayObject *); /*proto*/
 static PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *, int __pyx_skip_dispatch); /*proto*/
-static double __pyx_f_7tseries_Log2(double); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *); /*proto*/
-static PyObject *__pyx_f_7tseries_checknull(PyObject *, int __pyx_skip_dispatch); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_7tseries__isnan(PyObject *); /*proto*/
-static PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *, int, int, __pyx_t_7tseries_skiplist_f); /*proto*/
-static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *, int, int); /*proto*/
-static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *, int, int); /*proto*/
-static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *, int, int); /*proto*/
 static double __pyx_f_7tseries___add(double, double); /*proto*/
 static double __pyx_f_7tseries___sub(double, double); /*proto*/
 static double __pyx_f_7tseries___div(double, double); /*proto*/
@@ -952,6 +994,14 @@ static double __pyx_f_7tseries___ne(double, double); /*proto*/
 static double __pyx_f_7tseries___lt(double, double); /*proto*/
 static double __pyx_f_7tseries___gt(double, double); /*proto*/
 static double __pyx_f_7tseries___pow(double, double); /*proto*/
+static double __pyx_f_7tseries_Log2(double); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *); /*proto*/
+static PyObject *__pyx_f_7tseries_checknull(PyObject *, int __pyx_skip_dispatch); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_7tseries__isnan(PyObject *); /*proto*/
+static PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *, int, int, __pyx_t_7tseries_skiplist_f); /*proto*/
+static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *, int, int); /*proto*/
+static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *, int, int); /*proto*/
+static __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *, int, int); /*proto*/
 static PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func, PyArrayObject *, PyArrayObject *, PyArrayObject *, PyObject *, PyObject *); /*proto*/
 static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *); /*proto*/
 static PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t, int __pyx_skip_dispatch); /*proto*/
@@ -963,7 +1013,7 @@ static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_5numpy_double_t = { "double_t",
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_5numpy_int32_t = { "int32_t", NULL, sizeof(__pyx_t_5numpy_int32_t), 'I' };
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_5numpy_int64_t = { "int64_t", NULL, sizeof(__pyx_t_5numpy_int64_t), 'I' };
 #define __Pyx_MODULE_NAME "tseries"
-int __pyx_module_is_main_tseries = 0;
+static int __pyx_module_is_main_tseries = 0;
 
 /* Implementation of tseries */
 static PyObject *__pyx_builtin_Exception;
@@ -974,25 +1024,15 @@ static PyObject *__pyx_builtin_object;
 static PyObject *__pyx_builtin_RuntimeError;
 static char __pyx_k_1[] = "Error calling func on index %s";
 static char __pyx_k_2[] = "Tried to use data field on non-contiguous array!";
-static char __pyx_k_3[] = "Not Found";
-static char __pyx_k_4[] = "Don't recognize method: %s";
-static char __pyx_k_5[] = "bad funcname requested of Cython code";
-static char __pyx_k_6[] = "ndarray is not C contiguous";
-static char __pyx_k_7[] = "ndarray is not Fortran contiguous";
-static char __pyx_k_8[] = "Non-native byte order not supported";
-static char __pyx_k_9[] = "unknown dtype code in numpy.pxd (%d)";
-static char __pyx_k_10[] = "Format string allocated too short, see comment in numpy.pxd";
-static char __pyx_k_11[] = "Format string allocated too short.";
-static char __pyx_k_12[] = "map_indices (line 88)";
-static char __pyx_k_13[] = "isAllDates2 (line 135)";
-static char __pyx_k_14[] = "median (line 58)";
-static char __pyx_k_15[] = "ewma (line 166)";
-static char __pyx_k_16[] = "roll_median (line 442)";
-static char __pyx_k_17[] = "roll_max (line 448)";
-static char __pyx_k_18[] = "roll_min (line 454)";
-static char __pyx_k_19[] = "_backfill (line 16)";
-static char __pyx_k_20[] = "_pad (line 107)";
-static char __pyx_k_21[] = "combineFunc (line 61)";
+static char __pyx_k_4[] = "Not Found";
+static char __pyx_k_7[] = "Don't recognize method: %s";
+static char __pyx_k_10[] = "bad funcname requested of Cython code";
+static char __pyx_k_12[] = "ndarray is not C contiguous";
+static char __pyx_k_14[] = "ndarray is not Fortran contiguous";
+static char __pyx_k_16[] = "Non-native byte order not supported";
+static char __pyx_k_18[] = "unknown dtype code in numpy.pxd (%d)";
+static char __pyx_k_19[] = "Format string allocated too short, see comment in numpy.pxd";
+static char __pyx_k_22[] = "Format string allocated too short.";
 static char __pyx_k__B[] = "B";
 static char __pyx_k__H[] = "H";
 static char __pyx_k__I[] = "I";
@@ -1063,6 +1103,7 @@ static char __pyx_k____eq__[] = "__eq__";
 static char __pyx_k____gt__[] = "__gt__";
 static char __pyx_k____lt__[] = "__lt__";
 static char __pyx_k____ne__[] = "__ne__";
+static char __pyx_k__append[] = "append";
 static char __pyx_k__arrmap[] = "arrmap";
 static char __pyx_k__astype[] = "astype";
 static char __pyx_k__fields[] = "fields";
@@ -1084,8 +1125,10 @@ static char __pyx_k____mul__[] = "__mul__";
 static char __pyx_k____pow__[] = "__pow__";
 static char __pyx_k____sub__[] = "__sub__";
 static char __pyx_k__asarray[] = "asarray";
+static char __pyx_k__groupby[] = "groupby";
 static char __pyx_k__object_[] = "object_";
 static char __pyx_k__strides[] = "strides";
+static char __pyx_k__tseries[] = "tseries";
 static char __pyx_k__BACKFILL[] = "BACKFILL";
 static char __pyx_k__KeyError[] = "KeyError";
 static char __pyx_k____main__[] = "__main__";
@@ -1097,46 +1140,45 @@ static char __pyx_k__oldIndex[] = "oldIndex";
 static char __pyx_k__readonly[] = "readonly";
 static char __pyx_k__roll_max[] = "roll_max";
 static char __pyx_k__roll_min[] = "roll_min";
+static char __pyx_k__roll_sum[] = "roll_sum";
+static char __pyx_k__roll_var[] = "roll_var";
 static char __pyx_k__type_num[] = "type_num";
 static char __pyx_k__Exception[] = "Exception";
 static char __pyx_k___backfill[] = "_backfill";
 static char __pyx_k__byteorder[] = "byteorder";
 static char __pyx_k__isnullobj[] = "isnullobj";
 static char __pyx_k__maxlevels[] = "maxlevels";
+static char __pyx_k__roll_kurt[] = "roll_kurt";
+static char __pyx_k__roll_mean[] = "roll_mean";
+static char __pyx_k__roll_skew[] = "roll_skew";
 static char __pyx_k__toordinal[] = "toordinal";
 static char __pyx_k__ValueError[] = "ValueError";
+static char __pyx_k__getFillVec[] = "getFillVec";
+static char __pyx_k__isAllDates[] = "isAllDates";
 static char __pyx_k__pydatetime[] = "pydatetime";
 static char __pyx_k__suboffsets[] = "suboffsets";
 static char __pyx_k__combineFunc[] = "combineFunc";
 static char __pyx_k__getMergeVec[] = "getMergeVec";
 static char __pyx_k__isAllDates2[] = "isAllDates2";
-static char __pyx_k__map_indices[] = "map_indices";
 static char __pyx_k__roll_median[] = "roll_median";
 static char __pyx_k__RuntimeError[] = "RuntimeError";
 static char __pyx_k__kth_smallest[] = "kth_smallest";
 static char __pyx_k__expected_size[] = "expected_size";
+static char __pyx_k__groupby_indices[] = "groupby_indices";
 static char __pyx_k__utcfromtimestamp[] = "utcfromtimestamp";
+static char __pyx_k__array_to_datetime[] = "array_to_datetime";
+static char __pyx_k__array_to_timestamp[] = "array_to_timestamp";
 static PyObject *__pyx_kp_s_1;
-static PyObject *__pyx_kp_u_10;
-static PyObject *__pyx_kp_u_11;
+static PyObject *__pyx_kp_s_10;
 static PyObject *__pyx_kp_u_12;
-static PyObject *__pyx_kp_u_13;
 static PyObject *__pyx_kp_u_14;
-static PyObject *__pyx_kp_u_15;
 static PyObject *__pyx_kp_u_16;
-static PyObject *__pyx_kp_u_17;
 static PyObject *__pyx_kp_u_18;
 static PyObject *__pyx_kp_u_19;
 static PyObject *__pyx_kp_s_2;
-static PyObject *__pyx_kp_u_20;
-static PyObject *__pyx_kp_u_21;
-static PyObject *__pyx_kp_s_3;
+static PyObject *__pyx_kp_u_22;
 static PyObject *__pyx_kp_s_4;
-static PyObject *__pyx_kp_s_5;
-static PyObject *__pyx_kp_u_6;
-static PyObject *__pyx_kp_u_7;
-static PyObject *__pyx_kp_u_8;
-static PyObject *__pyx_kp_u_9;
+static PyObject *__pyx_kp_s_7;
 static PyObject *__pyx_n_s__BACKFILL;
 static PyObject *__pyx_n_s__Exception;
 static PyObject *__pyx_n_s__KeyError;
@@ -1162,6 +1204,9 @@ static PyObject *__pyx_n_s__a;
 static PyObject *__pyx_n_s__aMap;
 static PyObject *__pyx_n_s__any;
 static PyObject *__pyx_n_s__ao;
+static PyObject *__pyx_n_s__append;
+static PyObject *__pyx_n_s__array_to_datetime;
+static PyObject *__pyx_n_s__array_to_timestamp;
 static PyObject *__pyx_n_s__arrmap;
 static PyObject *__pyx_n_s__asarray;
 static PyObject *__pyx_n_s__astype;
@@ -1187,7 +1232,10 @@ static PyObject *__pyx_n_s__fill;
 static PyObject *__pyx_n_s__format;
 static PyObject *__pyx_n_s__func;
 static PyObject *__pyx_n_s__get;
+static PyObject *__pyx_n_s__getFillVec;
 static PyObject *__pyx_n_s__getMergeVec;
+static PyObject *__pyx_n_s__groupby;
+static PyObject *__pyx_n_s__groupby_indices;
 static PyObject *__pyx_n_s__head;
 static PyObject *__pyx_n_s__index;
 static PyObject *__pyx_n_s__inf;
@@ -1196,6 +1244,7 @@ static PyObject *__pyx_n_s__insert;
 static PyObject *__pyx_n_s__int32;
 static PyObject *__pyx_n_s__int64;
 static PyObject *__pyx_n_s__int8;
+static PyObject *__pyx_n_s__isAllDates;
 static PyObject *__pyx_n_s__isAllDates2;
 static PyObject *__pyx_n_s__isnan;
 static PyObject *__pyx_n_s__isnullobj;
@@ -1203,7 +1252,6 @@ static PyObject *__pyx_n_s__itemsize;
 static PyObject *__pyx_n_s__k;
 static PyObject *__pyx_n_s__kind;
 static PyObject *__pyx_n_s__kth_smallest;
-static PyObject *__pyx_n_s__map_indices;
 static PyObject *__pyx_n_s__mapper;
 static PyObject *__pyx_n_s__maxlevels;
 static PyObject *__pyx_n_s__median;
@@ -1228,14 +1276,20 @@ static PyObject *__pyx_n_s__random;
 static PyObject *__pyx_n_s__range;
 static PyObject *__pyx_n_s__readonly;
 static PyObject *__pyx_n_s__remove;
+static PyObject *__pyx_n_s__roll_kurt;
 static PyObject *__pyx_n_s__roll_max;
+static PyObject *__pyx_n_s__roll_mean;
 static PyObject *__pyx_n_s__roll_median;
 static PyObject *__pyx_n_s__roll_min;
+static PyObject *__pyx_n_s__roll_skew;
+static PyObject *__pyx_n_s__roll_sum;
+static PyObject *__pyx_n_s__roll_var;
 static PyObject *__pyx_n_s__shape;
 static PyObject *__pyx_n_s__size;
 static PyObject *__pyx_n_s__strides;
 static PyObject *__pyx_n_s__suboffsets;
 static PyObject *__pyx_n_s__toordinal;
+static PyObject *__pyx_n_s__tseries;
 static PyObject *__pyx_n_s__type_num;
 static PyObject *__pyx_n_s__utcfromtimestamp;
 static PyObject *__pyx_n_s__value;
@@ -1249,8 +1303,20 @@ static PyObject *__pyx_int_2;
 static PyObject *__pyx_int_neg_1;
 static PyObject *__pyx_int_15;
 static PyObject *__pyx_int_100;
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":16
+static PyObject *__pyx_k_tuple_3;
+static PyObject *__pyx_k_tuple_5;
+static PyObject *__pyx_k_tuple_6;
+static PyObject *__pyx_k_tuple_8;
+static PyObject *__pyx_k_tuple_9;
+static PyObject *__pyx_k_tuple_11;
+static PyObject *__pyx_k_tuple_13;
+static PyObject *__pyx_k_tuple_15;
+static PyObject *__pyx_k_tuple_17;
+static PyObject *__pyx_k_tuple_20;
+static PyObject *__pyx_k_tuple_21;
+static PyObject *__pyx_k_tuple_23;
+
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":16
  * from datetime import datetime as pydatetime
  * 
  * cdef inline object trycall(object func, object arg):             # <<<<<<<<<<<<<<
@@ -1267,7 +1333,7 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
   PyObject *__pyx_t_5 = NULL;
   __Pyx_RefNannySetupContext("trycall");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":17
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":17
  * 
  * cdef inline object trycall(object func, object arg):
  *     try:             # <<<<<<<<<<<<<<
@@ -1282,7 +1348,7 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
     __Pyx_XGOTREF(__pyx_save_exc_tb);
     /*try:*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":18
+      /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":18
  * cdef inline object trycall(object func, object arg):
  *     try:
  *         return func(arg)             # <<<<<<<<<<<<<<
@@ -1291,13 +1357,13 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
  */
       __Pyx_XDECREF(__pyx_r);
       __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
       __Pyx_INCREF(__pyx_v_arg);
       PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_arg);
       __Pyx_GIVEREF(__pyx_v_arg);
-      __pyx_t_2 = PyObject_Call(__pyx_v_func, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      __pyx_t_2 = PyObject_Call(__pyx_v_func, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
       __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
       goto __pyx_L7_try_return;
@@ -1316,7 +1382,7 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":19
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":19
  *     try:
  *         return func(arg)
  *     except:             # <<<<<<<<<<<<<<
@@ -1330,7 +1396,7 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_3);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":20
+      /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":20
  *         return func(arg)
  *     except:
  *         raise Exception('Error calling func on index %s' % arg)             # <<<<<<<<<<<<<<
@@ -1340,13 +1406,13 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
       __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_1), __pyx_v_arg); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
       __Pyx_GOTREF(((PyObject *)__pyx_t_4));
       __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
-      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_GOTREF(((PyObject *)__pyx_t_5));
       PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_4));
       __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
       __pyx_t_4 = 0;
-      __pyx_t_4 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
+      __pyx_t_4 = PyObject_Call(__pyx_builtin_Exception, ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
       __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
       __Pyx_Raise(__pyx_t_4, 0, 0);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L5_except_error;}
@@ -1385,7 +1451,7 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries_trycall(PyObject *__pyx_v_func,
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":22
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":22
  *         raise Exception('Error calling func on index %s' % arg)
  * 
  * cdef inline int int_max(int a, int b): return a if a >= b else b             # <<<<<<<<<<<<<<
@@ -1411,7 +1477,7 @@ static CYTHON_INLINE int __pyx_f_7tseries_int_max(int __pyx_v_a, int __pyx_v_b)
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":23
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":23
  * 
  * cdef inline int int_max(int a, int b): return a if a >= b else b
  * cdef inline int int_min(int a, int b): return a if a >= b else b             # <<<<<<<<<<<<<<
@@ -1437,7 +1503,7 @@ static CYTHON_INLINE int __pyx_f_7tseries_int_min(int __pyx_v_a, int __pyx_v_b)
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":27
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":27
  * ctypedef unsigned char UChar
  * 
  * cdef int is_contiguous(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1447,16 +1513,20 @@ static CYTHON_INLINE int __pyx_f_7tseries_int_min(int __pyx_v_a, int __pyx_v_b)
 
 static  int __pyx_f_7tseries_is_contiguous(PyArrayObject *__pyx_v_arr) {
   int __pyx_r;
+  PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("is_contiguous");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":28
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":28
  * 
  * cdef int is_contiguous(ndarray arr):
  *     return np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS)             # <<<<<<<<<<<<<<
  * 
  * cdef int _contiguous_check(ndarray arr):
  */
-  __pyx_r = PyArray_CHKFLAGS(__pyx_v_arr, NPY_C_CONTIGUOUS);
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_r = PyArray_CHKFLAGS(((PyArrayObject *)__pyx_t_1), NPY_C_CONTIGUOUS);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   goto __pyx_L0;
 
   __pyx_r = 0;
@@ -1465,7 +1535,7 @@ static  int __pyx_f_7tseries_is_contiguous(PyArrayObject *__pyx_v_arr) {
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":30
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":30
  *     return np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS)
  * 
  * cdef int _contiguous_check(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1475,38 +1545,34 @@ static  int __pyx_f_7tseries_is_contiguous(PyArrayObject *__pyx_v_arr) {
 
 static  int __pyx_f_7tseries__contiguous_check(PyArrayObject *__pyx_v_arr) {
   int __pyx_r;
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
   __Pyx_RefNannySetupContext("_contiguous_check");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":31
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":31
  * 
  * cdef int _contiguous_check(ndarray arr):
  *     if not is_contiguous(arr):             # <<<<<<<<<<<<<<
  *         raise ValueError('Tried to use data field on non-contiguous array!')
  * 
  */
-  __pyx_t_1 = (!__pyx_f_7tseries_is_contiguous(__pyx_v_arr));
-  if (__pyx_t_1) {
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = (!__pyx_f_7tseries_is_contiguous(((PyArrayObject *)__pyx_t_1)));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":32
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":32
  * cdef int _contiguous_check(ndarray arr):
  *     if not is_contiguous(arr):
  *         raise ValueError('Tried to use data field on non-contiguous array!')             # <<<<<<<<<<<<<<
  * 
  * cdef int16_t *get_int16_ptr(ndarray arr):
  */
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_2));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_2));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_2));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_Raise(__pyx_t_1, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     goto __pyx_L3;
   }
@@ -1515,8 +1581,7 @@ static  int __pyx_f_7tseries__contiguous_check(PyArrayObject *__pyx_v_arr) {
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_WriteUnraisable("tseries._contiguous_check");
   __pyx_r = 0;
   __pyx_L0:;
@@ -1524,7 +1589,7 @@ static  int __pyx_f_7tseries__contiguous_check(PyArrayObject *__pyx_v_arr) {
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":34
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":34
  *         raise ValueError('Tried to use data field on non-contiguous array!')
  * 
  * cdef int16_t *get_int16_ptr(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1534,18 +1599,22 @@ static  int __pyx_f_7tseries__contiguous_check(PyArrayObject *__pyx_v_arr) {
 
 static  __pyx_t_5numpy_int16_t *__pyx_f_7tseries_get_int16_ptr(PyArrayObject *__pyx_v_arr) {
   __pyx_t_5numpy_int16_t *__pyx_r;
+  PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("get_int16_ptr");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":35
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":35
  * 
  * cdef int16_t *get_int16_ptr(ndarray arr):
  *     _contiguous_check(arr)             # <<<<<<<<<<<<<<
  * 
  *     return <int16_t *> arr.data
  */
-  __pyx_f_7tseries__contiguous_check(__pyx_v_arr);
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_f_7tseries__contiguous_check(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":37
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":37
  *     _contiguous_check(arr)
  * 
  *     return <int16_t *> arr.data             # <<<<<<<<<<<<<<
@@ -1561,7 +1630,7 @@ static  __pyx_t_5numpy_int16_t *__pyx_f_7tseries_get_int16_ptr(PyArrayObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":39
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":39
  *     return <int16_t *> arr.data
  * 
  * cdef int32_t *get_int32_ptr(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1571,18 +1640,22 @@ static  __pyx_t_5numpy_int16_t *__pyx_f_7tseries_get_int16_ptr(PyArrayObject *__
 
 static  __pyx_t_5numpy_int32_t *__pyx_f_7tseries_get_int32_ptr(PyArrayObject *__pyx_v_arr) {
   __pyx_t_5numpy_int32_t *__pyx_r;
+  PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("get_int32_ptr");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":40
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":40
  * 
  * cdef int32_t *get_int32_ptr(ndarray arr):
  *     _contiguous_check(arr)             # <<<<<<<<<<<<<<
  * 
  *     return <int32_t *> arr.data
  */
-  __pyx_f_7tseries__contiguous_check(__pyx_v_arr);
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_f_7tseries__contiguous_check(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":42
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":42
  *     _contiguous_check(arr)
  * 
  *     return <int32_t *> arr.data             # <<<<<<<<<<<<<<
@@ -1598,7 +1671,7 @@ static  __pyx_t_5numpy_int32_t *__pyx_f_7tseries_get_int32_ptr(PyArrayObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":44
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":44
  *     return <int32_t *> arr.data
  * 
  * cdef int64_t *get_int64_ptr(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1608,18 +1681,22 @@ static  __pyx_t_5numpy_int32_t *__pyx_f_7tseries_get_int32_ptr(PyArrayObject *__
 
 static  __pyx_t_5numpy_int64_t *__pyx_f_7tseries_get_int64_ptr(PyArrayObject *__pyx_v_arr) {
   __pyx_t_5numpy_int64_t *__pyx_r;
+  PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("get_int64_ptr");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":45
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":45
  * 
  * cdef int64_t *get_int64_ptr(ndarray arr):
  *     _contiguous_check(arr)             # <<<<<<<<<<<<<<
  * 
  *     return <int64_t *> arr.data
  */
-  __pyx_f_7tseries__contiguous_check(__pyx_v_arr);
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_f_7tseries__contiguous_check(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":47
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":47
  *     _contiguous_check(arr)
  * 
  *     return <int64_t *> arr.data             # <<<<<<<<<<<<<<
@@ -1635,7 +1712,7 @@ static  __pyx_t_5numpy_int64_t *__pyx_f_7tseries_get_int64_ptr(PyArrayObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":49
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":49
  *     return <int64_t *> arr.data
  * 
  * cdef double_t *get_double_ptr(ndarray arr):             # <<<<<<<<<<<<<<
@@ -1645,18 +1722,22 @@ static  __pyx_t_5numpy_int64_t *__pyx_f_7tseries_get_int64_ptr(PyArrayObject *__
 
 static  __pyx_t_5numpy_double_t *__pyx_f_7tseries_get_double_ptr(PyArrayObject *__pyx_v_arr) {
   __pyx_t_5numpy_double_t *__pyx_r;
+  PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("get_double_ptr");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":50
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":50
  * 
  * cdef double_t *get_double_ptr(ndarray arr):
  *     _contiguous_check(arr)             # <<<<<<<<<<<<<<
  * 
  *     return <double_t *> arr.data
  */
-  __pyx_f_7tseries__contiguous_check(__pyx_v_arr);
+  __pyx_t_1 = ((PyObject *)__pyx_v_arr);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_f_7tseries__contiguous_check(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":52
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":52
  *     _contiguous_check(arr)
  * 
  *     return <double_t *> arr.data             # <<<<<<<<<<<<<<
@@ -1672,7 +1753,7 @@ static  __pyx_t_5numpy_double_t *__pyx_f_7tseries_get_double_ptr(PyArrayObject *
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":88
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":88
  * import_array()
  * 
  * cpdef map_indices(ndarray index):             # <<<<<<<<<<<<<<
@@ -1689,13 +1770,14 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   PyObject *__pyx_v_idx;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_3;
   __Pyx_RefNannySetupContext("map_indices");
   __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_result = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_result = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":103
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":103
  *     cdef object idx
  * 
  *     result = {}             # <<<<<<<<<<<<<<
@@ -1708,53 +1790,62 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   __pyx_v_result = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":105
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":105
  *     result = {}
  * 
  *     iter = <flatiter> PyArray_IterNew(index)             # <<<<<<<<<<<<<<
  *     length = PyArray_SIZE(index)
  * 
  */
-  __pyx_t_1 = PyArray_IterNew(((PyObject *)__pyx_v_index)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_1)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
-  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_1);
+  __pyx_t_1 = ((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyArray_IterNew(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_2)));
+  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
+  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":106
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":106
  * 
  *     iter = <flatiter> PyArray_IterNew(index)
  *     length = PyArray_SIZE(index)             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < length:
  */
-  __pyx_v_length = PyArray_SIZE(__pyx_v_index);
+  __pyx_t_2 = ((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_t_2));
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":108
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":108
  *     length = PyArray_SIZE(index)
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
  *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i
  */
-  __pyx_t_2 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_3 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":109
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":109
  * 
  *     for i from 0 <= i < length:
  *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
  *         result[idx] = i
  *         PyArray_ITER_NEXT(iter)
  */
-    __pyx_t_1 = PyArray_GETITEM(__pyx_v_index, PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_2);
+    __pyx_t_1 = PyArray_GETITEM(((PyArrayObject *)__pyx_t_2), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_v_idx);
     __pyx_v_idx = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":110
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":110
  *     for i from 0 <= i < length:
  *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i             # <<<<<<<<<<<<<<
@@ -1766,7 +1857,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
     if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_idx, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":111
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":111
  *         idx = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  *         result[idx] = i
  *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
@@ -1776,7 +1867,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
     PyArray_ITER_NEXT(__pyx_v_iter);
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":113
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":113
  *         PyArray_ITER_NEXT(iter)
  * 
  *     return result             # <<<<<<<<<<<<<<
@@ -1792,6 +1883,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.map_indices");
   __pyx_r = 0;
   __pyx_L0:;
@@ -1803,7 +1895,7 @@ static  PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *__pyx_v_index, int
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":88
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":88
  * import_array()
  * 
  * cpdef map_indices(ndarray index):             # <<<<<<<<<<<<<<
@@ -1816,20 +1908,25 @@ static char __pyx_doc_7tseries_map_indices[] = "\n    Produce a dict mapping the
 static PyObject *__pyx_pf_7tseries_map_indices(PyObject *__pyx_self, PyObject *__pyx_v_index) {
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   __Pyx_RefNannySetupContext("map_indices");
   __pyx_self = __pyx_self;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries_map_indices(((PyArrayObject *)__pyx_v_index), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = __pyx_v_index;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries_map_indices(((PyArrayObject *)__pyx_t_1), 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.map_indices");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -1838,7 +1935,7 @@ static PyObject *__pyx_pf_7tseries_map_indices(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":115
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":115
  *     return result
  * 
  * def isAllDates(ndarray index):             # <<<<<<<<<<<<<<
@@ -1846,56 +1943,64 @@ static PyObject *__pyx_pf_7tseries_map_indices(PyObject *__pyx_self, PyObject *_
  *     cdef flatiter iter
  */
 
-static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__pyx_v_index); /*proto*/
-static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__pyx_v_index) {
+static PyObject *__pyx_pf_7tseries_1isAllDates(PyObject *__pyx_self, PyObject *__pyx_v_index); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_1isAllDates = {__Pyx_NAMESTR("isAllDates"), (PyCFunction)__pyx_pf_7tseries_1isAllDates, METH_O, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_1isAllDates(PyObject *__pyx_self, PyObject *__pyx_v_index) {
   int __pyx_v_i;
   int __pyx_v_length;
   PyArrayIterObject *__pyx_v_iter;
   PyObject *__pyx_v_date;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_t_3;
+  int __pyx_t_4;
   __Pyx_RefNannySetupContext("isAllDates");
   __pyx_self = __pyx_self;
   __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_date = Py_None; __Pyx_INCREF(Py_None);
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":120
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":120
  *     cdef object date
  * 
  *     iter = <flatiter> PyArray_IterNew(index)             # <<<<<<<<<<<<<<
  *     length = PyArray_SIZE(index)
  * 
  */
-  __pyx_t_1 = PyArray_IterNew(__pyx_v_index); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_1)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
-  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_1);
+  __pyx_t_1 = __pyx_v_index;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyArray_IterNew(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_2)));
+  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
+  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":121
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":121
  * 
  *     iter = <flatiter> PyArray_IterNew(index)
  *     length = PyArray_SIZE(index)             # <<<<<<<<<<<<<<
  * 
  *     if length == 0:
  */
-  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_v_index));
+  __pyx_t_2 = __pyx_v_index;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_t_2));
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":123
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":123
  *     length = PyArray_SIZE(index)
  * 
  *     if length == 0:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
-  __pyx_t_2 = (__pyx_v_length == 0);
-  if (__pyx_t_2) {
+  __pyx_t_3 = (__pyx_v_length == 0);
+  if (__pyx_t_3) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":124
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":124
  * 
  *     if length == 0:
  *         return False             # <<<<<<<<<<<<<<
@@ -1903,49 +2008,52 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
  *     for i from 0 <= i < length:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_2 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_r = __pyx_t_2;
+    __pyx_t_2 = 0;
     goto __pyx_L0;
     goto __pyx_L5;
   }
   __pyx_L5:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":126
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":126
  *         return False
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
  *         date = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  * 
  */
-  __pyx_t_3 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_t_4 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_4; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":127
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":127
  * 
  *     for i from 0 <= i < length:
  *         date = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
  * 
  *         if not PyDateTime_Check(date):
  */
-    __pyx_t_1 = PyArray_GETITEM(((PyArrayObject *)__pyx_v_index), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = __pyx_v_index;
+    __Pyx_INCREF(__pyx_t_2);
+    __pyx_t_1 = PyArray_GETITEM(((PyArrayObject *)__pyx_t_2), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_v_date);
     __pyx_v_date = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":129
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":129
  *         date = PyArray_GETITEM(index, PyArray_ITER_DATA(iter))
  * 
  *         if not PyDateTime_Check(date):             # <<<<<<<<<<<<<<
  *             return False
  *         PyArray_ITER_NEXT(iter)
  */
-    __pyx_t_2 = (!PyDateTime_Check(__pyx_v_date));
-    if (__pyx_t_2) {
+    __pyx_t_3 = (!PyDateTime_Check(__pyx_v_date));
+    if (__pyx_t_3) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":130
+      /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":130
  * 
  *         if not PyDateTime_Check(date):
  *             return False             # <<<<<<<<<<<<<<
@@ -1962,7 +2070,7 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
     }
     __pyx_L8:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":131
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":131
  *         if not PyDateTime_Check(date):
  *             return False
  *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
@@ -1972,7 +2080,7 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
     PyArray_ITER_NEXT(__pyx_v_iter);
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":133
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":133
  *         PyArray_ITER_NEXT(iter)
  * 
  *     return True             # <<<<<<<<<<<<<<
@@ -1990,6 +2098,7 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.isAllDates");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -2000,7 +2109,7 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":135
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":135
  *     return True
  * 
  * def isAllDates2(ndarray[object, ndim=1] arr):             # <<<<<<<<<<<<<<
@@ -2008,9 +2117,10 @@ static PyObject *__pyx_pf_7tseries_isAllDates(PyObject *__pyx_self, PyObject *__
  *     cannot use
  */
 
-static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
-static char __pyx_doc_7tseries_isAllDates2[] = "\n    cannot use\n    ";
-static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
+static PyObject *__pyx_pf_7tseries_2isAllDates2(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
+static char __pyx_doc_7tseries_2isAllDates2[] = "\n    cannot use\n    ";
+static PyMethodDef __pyx_mdef_7tseries_2isAllDates2 = {__Pyx_NAMESTR("isAllDates2"), (PyCFunction)__pyx_pf_7tseries_2isAllDates2, METH_O, __Pyx_DOCSTR(__pyx_doc_7tseries_2isAllDates2)};
+static PyObject *__pyx_pf_7tseries_2isAllDates2(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
   int __pyx_v_i;
   int __pyx_v_size;
   PyObject *__pyx_v_date;
@@ -2018,9 +2128,9 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
   Py_ssize_t __pyx_bstride_0_arr = 0;
   Py_ssize_t __pyx_bshape_0_arr = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  int __pyx_t_3;
   int __pyx_t_4;
   int __pyx_t_5;
   int __pyx_t_6;
@@ -2036,27 +2146,30 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
   __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
   __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":140
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":140
  *     '''
  * 
  *     cdef int i, size = len(arr)             # <<<<<<<<<<<<<<
  *     cdef object date
  * 
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_size = __pyx_t_1;
+  __pyx_t_1 = __pyx_v_arr;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_size = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":143
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":143
  *     cdef object date
  * 
  *     if size == 0:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
-  __pyx_t_2 = (__pyx_v_size == 0);
-  if (__pyx_t_2) {
+  __pyx_t_3 = (__pyx_v_size == 0);
+  if (__pyx_t_3) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":144
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":144
  * 
  *     if size == 0:
  *         return False             # <<<<<<<<<<<<<<
@@ -2064,16 +2177,16 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
  *     for i from 0 <= i < size:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_r = __pyx_t_3;
-    __pyx_t_3 = 0;
+    __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_r = __pyx_t_1;
+    __pyx_t_1 = 0;
     goto __pyx_L0;
     goto __pyx_L5;
   }
   __pyx_L5:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":146
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":146
  *         return False
  * 
  *     for i from 0 <= i < size:             # <<<<<<<<<<<<<<
@@ -2083,7 +2196,7 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
   __pyx_t_4 = __pyx_v_size;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_4; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":147
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":147
  * 
  *     for i from 0 <= i < size:
  *         date = arr[i]             # <<<<<<<<<<<<<<
@@ -2100,23 +2213,23 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
       __Pyx_RaiseBufferIndexError(__pyx_t_6);
       {__pyx_filename = __pyx_f[0]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_arr.buf, __pyx_t_5, __pyx_bstride_0_arr);
-    __Pyx_INCREF((PyObject*)__pyx_t_3);
+    __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_arr.buf, __pyx_t_5, __pyx_bstride_0_arr);
+    __Pyx_INCREF((PyObject*)__pyx_t_1);
     __Pyx_DECREF(__pyx_v_date);
-    __pyx_v_date = __pyx_t_3;
-    __pyx_t_3 = 0;
+    __pyx_v_date = __pyx_t_1;
+    __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":149
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":149
  *         date = arr[i]
  * 
  *         if not PyDateTime_Check(date):             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
-    __pyx_t_2 = (!PyDateTime_Check(__pyx_v_date));
-    if (__pyx_t_2) {
+    __pyx_t_3 = (!PyDateTime_Check(__pyx_v_date));
+    if (__pyx_t_3) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":150
+      /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":150
  * 
  *         if not PyDateTime_Check(date):
  *             return False             # <<<<<<<<<<<<<<
@@ -2124,32 +2237,34 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
  *     return True
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_3 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_r = __pyx_t_3;
-      __pyx_t_3 = 0;
+      __pyx_t_1 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_r = __pyx_t_1;
+      __pyx_t_1 = 0;
       goto __pyx_L0;
       goto __pyx_L8;
     }
     __pyx_L8:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":152
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":152
  *             return False
  * 
  *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef double __add(double a, double b):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
+  __pyx_t_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_1);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
@@ -2166,540 +2281,502 @@ static PyObject *__pyx_pf_7tseries_isAllDates2(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":18
- * # MSVC does not have log2!
- * 
- * cdef double Log2(double x):             # <<<<<<<<<<<<<<
- *     return log(x) / log(2.)
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":154
+ *     return True
  * 
+ * cdef double __add(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a + b
+ * cdef double __sub(double a, double b):
  */
 
-static  double __pyx_f_7tseries_Log2(double __pyx_v_x) {
+static  double __pyx_f_7tseries___add(double __pyx_v_a, double __pyx_v_b) {
   double __pyx_r;
-  double __pyx_t_1;
-  double __pyx_t_2;
-  __Pyx_RefNannySetupContext("Log2");
+  __Pyx_RefNannySetupContext("__add");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":19
- * 
- * cdef double Log2(double x):
- *     return log(x) / log(2.)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":155
  * 
- * cimport numpy as np
+ * cdef double __add(double a, double b):
+ *     return a + b             # <<<<<<<<<<<<<<
+ * cdef double __sub(double a, double b):
+ *     return a - b
  */
-  __pyx_t_1 = log(__pyx_v_x);
-  __pyx_t_2 = log(2.);
-  if (unlikely(__pyx_t_2 == 0)) {
-    PyErr_Format(PyExc_ZeroDivisionError, "float division");
-    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_r = (__pyx_t_1 / __pyx_t_2);
+  __pyx_r = (__pyx_v_a + __pyx_v_b);
   goto __pyx_L0;
 
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries.Log2");
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":34
- * cdef class Node:
- *     cdef public:
- *         double_t value             # <<<<<<<<<<<<<<
- *         list next
- *         list width
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":156
+ * cdef double __add(double a, double b):
+ *     return a + b
+ * cdef double __sub(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a - b
+ * 
  */
 
-static PyObject *__pyx_pf_7tseries_4Node_5value___get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pf_7tseries_4Node_5value___get__(PyObject *__pyx_v_self) {
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("__get__");
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyFloat_FromDouble(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+static  double __pyx_f_7tseries___sub(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__sub");
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":157
+ *     return a + b
+ * cdef double __sub(double a, double b):
+ *     return a - b             # <<<<<<<<<<<<<<
+ * 
+ * cdef double __div(double a, double b):
+ */
+  __pyx_r = (__pyx_v_a - __pyx_v_b);
   goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.Node.value.__get__");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static int __pyx_pf_7tseries_4Node_5value___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pf_7tseries_4Node_5value___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
-  int __pyx_r;
-  __pyx_t_5numpy_double_t __pyx_t_1;
-  __Pyx_RefNannySetupContext("__set__");
-  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_t_1;
 
   __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.value.__set__");
-  __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":35
- *     cdef public:
- *         double_t value
- *         list next             # <<<<<<<<<<<<<<
- *         list width
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":159
+ *     return a - b
  * 
+ * cdef double __div(double a, double b):             # <<<<<<<<<<<<<<
+ *     if b == 0:
+ *         return NaN
  */
 
-static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannySetupContext("__get__");
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  goto __pyx_L0;
+static  double __pyx_f_7tseries___div(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  int __pyx_t_1;
+  __Pyx_RefNannySetupContext("__div");
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":160
+ * 
+ * cdef double __div(double a, double b):
+ *     if b == 0:             # <<<<<<<<<<<<<<
+ *         return NaN
+ *     else:
+ */
+  __pyx_t_1 = (__pyx_v_b == 0.0);
+  if (__pyx_t_1) {
 
-static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__set__");
-  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_INCREF(__pyx_v_value);
-  __Pyx_GIVEREF(__pyx_v_value);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject *)__pyx_v_value);
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":161
+ * cdef double __div(double a, double b):
+ *     if b == 0:
+ *         return NaN             # <<<<<<<<<<<<<<
+ *     else:
+ *         return a / b
+ */
+    __pyx_r = __pyx_v_7tseries_NaN;
+    goto __pyx_L0;
+    goto __pyx_L3;
+  }
+  /*else*/ {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":163
+ *         return NaN
+ *     else:
+ *         return a / b             # <<<<<<<<<<<<<<
+ * 
+ * cdef double __mul(double a, double b):
+ */
+    if (unlikely(__pyx_v_b == 0)) {
+      PyErr_Format(PyExc_ZeroDivisionError, "float division");
+      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 163; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_r = (__pyx_v_a / __pyx_v_b);
+    goto __pyx_L0;
+  }
+  __pyx_L3:;
 
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.next.__set__");
-  __pyx_r = -1;
+  __Pyx_WriteUnraisable("tseries.__div");
+  __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_7tseries_4Node_4next___del__(PyObject *__pyx_v_self); /*proto*/
-static int __pyx_pf_7tseries_4Node_4next___del__(PyObject *__pyx_v_self) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__del__");
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject *)Py_None);
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":165
+ *         return a / b
+ * 
+ * cdef double __mul(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a * b
+ * cdef double __eq(double a, double b):
+ */
+
+static  double __pyx_f_7tseries___mul(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__mul");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":166
+ * 
+ * cdef double __mul(double a, double b):
+ *     return a * b             # <<<<<<<<<<<<<<
+ * cdef double __eq(double a, double b):
+ *     return a == b
+ */
+  __pyx_r = (__pyx_v_a * __pyx_v_b);
+  goto __pyx_L0;
 
   __pyx_r = 0;
+  __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":36
- *         double_t value
- *         list next
- *         list width             # <<<<<<<<<<<<<<
- * 
- *     def __init__(self, double_t value, list next, list width):
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":167
+ * cdef double __mul(double a, double b):
+ *     return a * b
+ * cdef double __eq(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a == b
+ * cdef double __ne(double a, double b):
  */
 
-static PyObject *__pyx_pf_7tseries_4Node_5width___get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pf_7tseries_4Node_5width___get__(PyObject *__pyx_v_self) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannySetupContext("__get__");
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
-  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
+static  double __pyx_f_7tseries___eq(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__eq");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":168
+ *     return a * b
+ * cdef double __eq(double a, double b):
+ *     return a == b             # <<<<<<<<<<<<<<
+ * cdef double __ne(double a, double b):
+ *     return a != b
+ */
+  __pyx_r = (__pyx_v_a == __pyx_v_b);
   goto __pyx_L0;
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_r = 0;
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_7tseries_4Node_5width___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pf_7tseries_4Node_5width___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__set__");
-  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_INCREF(__pyx_v_value);
-  __Pyx_GIVEREF(__pyx_v_value);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((PyObject *)__pyx_v_value);
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":169
+ * cdef double __eq(double a, double b):
+ *     return a == b
+ * cdef double __ne(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a != b
+ * cdef double __lt(double a, double b):
+ */
 
-  __pyx_r = 0;
+static  double __pyx_f_7tseries___ne(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__ne");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":170
+ *     return a == b
+ * cdef double __ne(double a, double b):
+ *     return a != b             # <<<<<<<<<<<<<<
+ * cdef double __lt(double a, double b):
+ *     return a < b
+ */
+  __pyx_r = (__pyx_v_a != __pyx_v_b);
   goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.width.__set__");
-  __pyx_r = -1;
+
+  __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static int __pyx_pf_7tseries_4Node_5width___del__(PyObject *__pyx_v_self); /*proto*/
-static int __pyx_pf_7tseries_4Node_5width___del__(PyObject *__pyx_v_self) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__del__");
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((PyObject *)Py_None);
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":171
+ * cdef double __ne(double a, double b):
+ *     return a != b
+ * cdef double __lt(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a < b
+ * cdef double __gt(double a, double b):
+ */
+
+static  double __pyx_f_7tseries___lt(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__lt");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":172
+ *     return a != b
+ * cdef double __lt(double a, double b):
+ *     return a < b             # <<<<<<<<<<<<<<
+ * cdef double __gt(double a, double b):
+ *     return a > b
+ */
+  __pyx_r = (__pyx_v_a < __pyx_v_b);
+  goto __pyx_L0;
 
   __pyx_r = 0;
+  __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":38
- *         list width
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":173
+ * cdef double __lt(double a, double b):
+ *     return a < b
+ * cdef double __gt(double a, double b):             # <<<<<<<<<<<<<<
+ *     return a > b
  * 
- *     def __init__(self, double_t value, list next, list width):             # <<<<<<<<<<<<<<
- *         self.value = value
- *         self.next = next
  */
 
-static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  __pyx_t_5numpy_double_t __pyx_v_value;
-  PyObject *__pyx_v_next = 0;
-  PyObject *__pyx_v_width = 0;
-  int __pyx_r;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__value,&__pyx_n_s__next,&__pyx_n_s__width,0};
-  __Pyx_RefNannySetupContext("__init__");
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__next);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__width);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_value = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_value == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_next = ((PyObject *)values[1]);
-    __pyx_v_width = ((PyObject *)values[2]);
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_value == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_next = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_width = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.Node.__init__");
-  __Pyx_RefNannyFinishContext();
-  return -1;
-  __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_next), &PyList_Type, 1, "next", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_width), &PyList_Type, 1, "width", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+static  double __pyx_f_7tseries___gt(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  __Pyx_RefNannySetupContext("__gt");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":39
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":174
+ *     return a < b
+ * cdef double __gt(double a, double b):
+ *     return a > b             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, double_t value, list next, list width):
- *         self.value = value             # <<<<<<<<<<<<<<
- *         self.next = next
- *         self.width = width
+ * cdef double __pow(double a, double b):
  */
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_v_value;
+  __pyx_r = (__pyx_v_a > __pyx_v_b);
+  goto __pyx_L0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":40
- *     def __init__(self, double_t value, list next, list width):
- *         self.value = value
- *         self.next = next             # <<<<<<<<<<<<<<
- *         self.width = width
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":176
+ *     return a > b
  * 
+ * cdef double __pow(double a, double b):             # <<<<<<<<<<<<<<
+ *     # NaN
+ *     if a != a or b != b:
  */
-  __Pyx_INCREF(((PyObject *)__pyx_v_next));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_next));
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = __pyx_v_next;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":41
- *         self.value = value
- *         self.next = next
- *         self.width = width             # <<<<<<<<<<<<<<
+static  double __pyx_f_7tseries___pow(double __pyx_v_a, double __pyx_v_b) {
+  double __pyx_r;
+  int __pyx_t_1;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  __Pyx_RefNannySetupContext("__pow");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":178
+ * cdef double __pow(double a, double b):
+ *     # NaN
+ *     if a != a or b != b:             # <<<<<<<<<<<<<<
+ *         return NaN
+ *     return a ** b
+ */
+  __pyx_t_1 = (__pyx_v_a != __pyx_v_a);
+  if (!__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_b != __pyx_v_b);
+    __pyx_t_3 = __pyx_t_2;
+  } else {
+    __pyx_t_3 = __pyx_t_1;
+  }
+  if (__pyx_t_3) {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":179
+ *     # NaN
+ *     if a != a or b != b:
+ *         return NaN             # <<<<<<<<<<<<<<
+ *     return a ** b
  * 
- * # Singleton terminator node
  */
-  __Pyx_INCREF(((PyObject *)__pyx_v_width));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_width));
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = __pyx_v_width;
+    __pyx_r = __pyx_v_7tseries_NaN;
+    goto __pyx_L0;
+    goto __pyx_L3;
+  }
+  __pyx_L3:;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":180
+ *     if a != a or b != b:
+ *         return NaN
+ *     return a ** b             # <<<<<<<<<<<<<<
+ * 
+ * ctypedef double (* double_func)(double a, double b)
+ */
+  __pyx_r = pow(__pyx_v_a, __pyx_v_b);
+  goto __pyx_L0;
+
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":18
+ * # MSVC does not have log2!
+ * 
+ * cdef double Log2(double x):             # <<<<<<<<<<<<<<
+ *     return log(x) / log(2.)
+ * 
+ */
+
+static  double __pyx_f_7tseries_Log2(double __pyx_v_x) {
+  double __pyx_r;
+  double __pyx_t_1;
+  double __pyx_t_2;
+  __Pyx_RefNannySetupContext("Log2");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":19
+ * 
+ * cdef double Log2(double x):
+ *     return log(x) / log(2.)             # <<<<<<<<<<<<<<
+ * 
+ * cimport numpy as np
+ */
+  __pyx_t_1 = log(__pyx_v_x);
+  __pyx_t_2 = log(2.);
+  if (unlikely(__pyx_t_2 == 0)) {
+    PyErr_Format(PyExc_ZeroDivisionError, "float division");
+    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_r = (__pyx_t_1 / __pyx_t_2);
+  goto __pyx_L0;
 
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.__init__");
-  __pyx_r = -1;
+  __Pyx_WriteUnraisable("tseries.Log2");
+  __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":55
- *         Node head
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":38
+ *         list width
  * 
- *     def __init__(self, expected_size=100):             # <<<<<<<<<<<<<<
- *         self.size = 0
- *         self.maxlevels = int(1 + Log2(expected_size))
+ *     def __init__(self, double_t value, list next, list width):             # <<<<<<<<<<<<<<
+ *         self.value = value
+ *         self.next = next
  */
 
-static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_expected_size = 0;
+static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  __pyx_t_5numpy_double_t __pyx_v_value;
+  PyObject *__pyx_v_next = 0;
+  PyObject *__pyx_v_width = 0;
   int __pyx_r;
-  double __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__expected_size,0};
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__value,&__pyx_n_s__next,&__pyx_n_s__width,0};
   __Pyx_RefNannySetupContext("__init__");
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[1] = {0};
-    values[0] = ((PyObject *)__pyx_int_100);
+    PyObject* values[3] = {0,0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
       default: goto __pyx_L5_argtuple_error;
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      if (kw_args > 0) {
-        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__expected_size);
-        if (value) { values[0] = value; kw_args--; }
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__next);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__width);
+      if (likely(values[2])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_expected_size = values[0];
+    __pyx_v_value = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_value == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_next = ((PyObject*)values[1]);
+    __pyx_v_width = ((PyObject*)values[2]);
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
+    goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_expected_size = ((PyObject *)__pyx_int_100);
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  1: __pyx_v_expected_size = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
+    __pyx_v_value = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely((__pyx_v_value == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_next = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 1));
+    __pyx_v_width = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 2));
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  __Pyx_AddTraceback("tseries.Node.__init__");
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_next), (&PyList_Type), 1, "next", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_width), (&PyList_Type), 1, "width", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":56
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":39
  * 
- *     def __init__(self, expected_size=100):
- *         self.size = 0             # <<<<<<<<<<<<<<
- *         self.maxlevels = int(1 + Log2(expected_size))
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
+ *     def __init__(self, double_t value, list next, list width):
+ *         self.value = value             # <<<<<<<<<<<<<<
+ *         self.next = next
+ *         self.width = width
  */
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size = 0;
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_v_value;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":57
- *     def __init__(self, expected_size=100):
- *         self.size = 0
- *         self.maxlevels = int(1 + Log2(expected_size))             # <<<<<<<<<<<<<<
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":40
+ *     def __init__(self, double_t value, list next, list width):
+ *         self.value = value
+ *         self.next = next             # <<<<<<<<<<<<<<
+ *         self.width = width
  * 
  */
-  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_expected_size); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels = ((int)(1.0 + __pyx_f_7tseries_Log2(__pyx_t_1)));
+  __Pyx_INCREF(((PyObject *)__pyx_v_next));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_next));
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = __pyx_v_next;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":58
- *         self.size = 0
- *         self.maxlevels = int(1 + Log2(expected_size))
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":41
+ *         self.value = value
+ *         self.next = next
+ *         self.width = width             # <<<<<<<<<<<<<<
  * 
- *     def __len__(self):
+ * # Singleton terminator node
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__NIL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(((PyObject *)__pyx_t_4), __pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  __Pyx_INCREF(__pyx_int_1);
-  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_1);
-  __Pyx_GIVEREF(__pyx_int_1);
-  __pyx_t_4 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyNumber_Multiply(((PyObject *)__pyx_t_2), __pyx_t_4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
-  __Pyx_GIVEREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
-  __Pyx_GIVEREF(__pyx_t_5);
-  PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_6);
-  __Pyx_GIVEREF(__pyx_t_6);
-  __pyx_t_3 = 0;
-  __pyx_t_5 = 0;
-  __pyx_t_6 = 0;
-  __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_GIVEREF(__pyx_t_6);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head = ((struct __pyx_obj_7tseries_Node *)__pyx_t_6);
-  __pyx_t_6 = 0;
+  __Pyx_INCREF(((PyObject *)__pyx_v_width));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_width));
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = __pyx_v_width;
 
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  __Pyx_AddTraceback("tseries.Node.__init__");
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":60
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
- * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
- *         return self.size
- * 
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":34
+ * cdef class Node:
+ *     cdef public:
+ *         double_t value             # <<<<<<<<<<<<<<
+ *         list next
+ *         list width
  */
 
-static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self); /*proto*/
-static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self) {
-  Py_ssize_t __pyx_r;
-  __Pyx_RefNannySetupContext("__len__");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":61
- * 
- *     def __len__(self):
- *         return self.size             # <<<<<<<<<<<<<<
- * 
- *     def __getitem__(self, i):
- */
-  __pyx_r = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size;
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":63
- *         return self.size
- * 
- *     def __getitem__(self, i):             # <<<<<<<<<<<<<<
- *         return self.get(i)
- * 
- */
-
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
+static PyObject *__pyx_pf_7tseries_4Node_5value___get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pf_7tseries_4Node_5value___get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  __Pyx_RefNannySetupContext("__getitem__");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":64
- * 
- *     def __getitem__(self, i):
- *         return self.get(i)             # <<<<<<<<<<<<<<
- * 
- *     cpdef get(self, int i):
- */
+  PyObject *__pyx_t_1 = NULL;
+  __Pyx_RefNannySetupContext("__get__");
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_AsInt(__pyx_v_i); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  __pyx_t_1 = PyFloat_FromDouble(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__getitem__");
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("tseries.Node.value.__get__");
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
@@ -2707,663 +2784,507 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__p
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":66
- *         return self.get(i)
- * 
- *     cpdef get(self, int i):             # <<<<<<<<<<<<<<
- *         cdef int level
- *         cdef Node node
- */
-
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
-static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_get(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, int __pyx_v_i, int __pyx_skip_dispatch) {
-  int __pyx_v_level;
-  struct __pyx_obj_7tseries_Node *__pyx_v_node;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
-  __Pyx_RefNannySetupContext("get");
-  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  /* Check if called by wrapper */
-  if (unlikely(__pyx_skip_dispatch)) ;
-  /* Check if overriden in Python */
-  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
-    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__get); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_get)) {
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-      __Pyx_GIVEREF(__pyx_t_2);
-      __pyx_t_2 = 0;
-      __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_r = __pyx_t_2;
-      __pyx_t_2 = 0;
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      goto __pyx_L0;
-    }
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":70
- *         cdef Node node
- * 
- *         node = self.head             # <<<<<<<<<<<<<<
- *         i += 1
- * 
- */
-  __Pyx_INCREF(((PyObject *)__pyx_v_self->head));
-  __Pyx_DECREF(((PyObject *)__pyx_v_node));
-  __pyx_v_node = __pyx_v_self->head;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":71
- * 
- *         node = self.head
- *         i += 1             # <<<<<<<<<<<<<<
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- */
-  __pyx_v_i += 1;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":73
- *         i += 1
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
- *             while node.width[level] <= i:
- *                 i -= node.width[level]
- */
-  for (__pyx_t_4 = (__pyx_v_self->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
-    __pyx_v_level = __pyx_t_4;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":74
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             while node.width[level] <= i:             # <<<<<<<<<<<<<<
- *                 i -= node.width[level]
- *                 node = node.next[level]
- */
-    while (1) {
-      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_LE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      if (!__pyx_t_5) break;
+static int __pyx_pf_7tseries_4Node_5value_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pf_7tseries_4Node_5value_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+  int __pyx_r;
+  __pyx_t_5numpy_double_t __pyx_t_1;
+  __Pyx_RefNannySetupContext("__set__");
+  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_value); if (unlikely((__pyx_t_1 == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_t_1;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":75
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             while node.width[level] <= i:
- *                 i -= node.width[level]             # <<<<<<<<<<<<<<
- *                 node = node.next[level]
- * 
- */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = __Pyx_PyInt_AsInt(__pyx_t_3); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_v_i -= __pyx_t_6;
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("tseries.Node.value.__set__");
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":76
- *             while node.width[level] <= i:
- *                 i -= node.width[level]
- *                 node = node.next[level]             # <<<<<<<<<<<<<<
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":35
+ *     cdef public:
+ *         double_t value
+ *         list next             # <<<<<<<<<<<<<<
+ *         list width
  * 
- *         return node.value
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_node));
-      __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-      __pyx_t_3 = 0;
-    }
-  }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":78
- *                 node = node.next[level]
- * 
- *         return node.value             # <<<<<<<<<<<<<<
- * 
- *     cpdef insert(self, double value):
- */
+static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannySetupContext("__get__");
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_node->value); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_7tseries_4Node_4next_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pf_7tseries_4Node_4next_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__set__");
+  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(__pyx_v_value);
+  __Pyx_GIVEREF(__pyx_v_value);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject*)__pyx_v_value);
+
+  __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
-  __pyx_r = 0;
+  __Pyx_AddTraceback("tseries.Node.next.__set__");
+  __pyx_r = -1;
   __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_node);
-  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":66
- *         return self.get(i)
+static int __pyx_pf_7tseries_4Node_4next_2__del__(PyObject *__pyx_v_self); /*proto*/
+static int __pyx_pf_7tseries_4Node_4next_2__del__(PyObject *__pyx_v_self) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__del__");
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject*)Py_None);
+
+  __pyx_r = 0;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":36
+ *         double_t value
+ *         list next
+ *         list width             # <<<<<<<<<<<<<<
  * 
- *     cpdef get(self, int i):             # <<<<<<<<<<<<<<
- *         cdef int level
- *         cdef Node node
+ *     def __init__(self, double_t value, list next, list width):
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i) {
-  int __pyx_v_i;
+static PyObject *__pyx_pf_7tseries_4Node_5width___get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pf_7tseries_4Node_5width___get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("get");
-  assert(__pyx_arg_i); {
-    __pyx_v_i = __Pyx_PyInt_AsInt(__pyx_arg_i); if (unlikely((__pyx_v_i == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
+  __Pyx_RefNannySetupContext("__get__");
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_i, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
+  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
-  __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":80
- *         return node.value
- * 
- *     cpdef insert(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, steps, d
- *         cdef Node node, prevnode, newnode, next_at_level, tmp
+static int __pyx_pf_7tseries_4Node_5width_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pf_7tseries_4Node_5width_1__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__set__");
+  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(__pyx_v_value);
+  __Pyx_GIVEREF(__pyx_v_value);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((PyObject*)__pyx_v_value);
+
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("tseries.Node.width.__set__");
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_7tseries_4Node_5width_2__del__(PyObject *__pyx_v_self); /*proto*/
+static int __pyx_pf_7tseries_4Node_5width_2__del__(PyObject *__pyx_v_self) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__del__");
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((PyObject*)Py_None);
+
+  __pyx_r = 0;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":55
+ *         Node head
+ * 
+ *     def __init__(self, expected_size=100):             # <<<<<<<<<<<<<<
+ *         self.size = 0
+ *         self.maxlevels = int(1 + Log2(expected_size))
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_insert(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, double __pyx_v_value, int __pyx_skip_dispatch) {
-  int __pyx_v_level;
-  int __pyx_v_steps;
-  int __pyx_v_d;
-  struct __pyx_obj_7tseries_Node *__pyx_v_node;
-  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_newnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
-  PyObject *__pyx_v_chain;
-  PyObject *__pyx_v_steps_at_level;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
+static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_expected_size = 0;
+  int __pyx_r;
+  double __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  double __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_t_9;
-  int __pyx_t_10;
-  __Pyx_RefNannySetupContext("insert");
-  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_steps_at_level = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  /* Check if called by wrapper */
-  if (unlikely(__pyx_skip_dispatch)) ;
-  /* Check if overriden in Python */
-  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
-    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__insert); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_insert)) {
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-      __Pyx_GIVEREF(__pyx_t_2);
-      __pyx_t_2 = 0;
-      __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_r = __pyx_t_2;
-      __pyx_t_2 = 0;
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      goto __pyx_L0;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__expected_size,0};
+  __Pyx_RefNannySetupContext("__init__");
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[1] = {0};
+    values[0] = ((PyObject *)__pyx_int_100);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      if (kw_args > 0) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__expected_size);
+        if (value) { values[0] = value; kw_args--; }
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_expected_size = values[0];
+  } else {
+    __pyx_v_expected_size = ((PyObject *)__pyx_int_100);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  1: __pyx_v_expected_size = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
     }
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  __Pyx_RefNannyFinishContext();
+  return -1;
+  __pyx_L4_argument_unpacking_done:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":86
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":56
  * 
- *         # find first node on each level where node.next[levels].value > value
- *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
- *         steps_at_level = [0] * self.maxlevels
- *         node = self.head
+ *     def __init__(self, expected_size=100):
+ *         self.size = 0             # <<<<<<<<<<<<<<
+ *         self.maxlevels = int(1 + Log2(expected_size))
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
-  __pyx_v_chain = ((PyObject *)__pyx_t_3);
-  __pyx_t_3 = 0;
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":87
- *         # find first node on each level where node.next[levels].value > value
- *         chain = [None] * self.maxlevels
- *         steps_at_level = [0] * self.maxlevels             # <<<<<<<<<<<<<<
- *         node = self.head
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":57
+ *     def __init__(self, expected_size=100):
+ *         self.size = 0
+ *         self.maxlevels = int(1 + Log2(expected_size))             # <<<<<<<<<<<<<<
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
  * 
  */
-  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  __Pyx_INCREF(__pyx_int_0);
-  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
-  __Pyx_GIVEREF(__pyx_int_0);
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_steps_at_level));
-  __pyx_v_steps_at_level = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
+  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_expected_size); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels = ((int)(1.0 + __pyx_f_7tseries_Log2(__pyx_t_1)));
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":88
- *         chain = [None] * self.maxlevels
- *         steps_at_level = [0] * self.maxlevels
- *         node = self.head             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":58
+ *         self.size = 0
+ *         self.maxlevels = int(1 + Log2(expected_size))
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)             # <<<<<<<<<<<<<<
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):
+ *     def __len__(self):
  */
-  __Pyx_INCREF(((PyObject *)__pyx_v_self->head));
-  __Pyx_DECREF(((PyObject *)__pyx_v_node));
-  __pyx_v_node = __pyx_v_self->head;
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__NIL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_5 = PyNumber_Multiply(((PyObject *)__pyx_t_4), __pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __Pyx_INCREF(__pyx_int_1);
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_1);
+  __Pyx_GIVEREF(__pyx_int_1);
+  __pyx_t_4 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_6 = PyNumber_Multiply(((PyObject *)__pyx_t_2), __pyx_t_4); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_6);
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
+  __Pyx_GIVEREF(__pyx_t_5);
+  PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_6);
+  __Pyx_GIVEREF(__pyx_t_6);
+  __pyx_t_3 = 0;
+  __pyx_t_5 = 0;
+  __pyx_t_6 = 0;
+  __pyx_t_6 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_6);
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_GIVEREF(__pyx_t_6);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head = ((struct __pyx_obj_7tseries_Node *)__pyx_t_6);
+  __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":90
- *         node = self.head
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":60
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels, [1] * self.maxlevels)
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
- *             next_at_level = node.next[level]
+ *     def __len__(self):             # <<<<<<<<<<<<<<
+ *         return self.size
  * 
  */
-  for (__pyx_t_4 = (__pyx_v_self->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
-    __pyx_v_level = __pyx_t_4;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":91
+static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist_1__len__(PyObject *__pyx_v_self); /*proto*/
+static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist_1__len__(PyObject *__pyx_v_self) {
+  Py_ssize_t __pyx_r;
+  __Pyx_RefNannySetupContext("__len__");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":61
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+ *     def __len__(self):
+ *         return self.size             # <<<<<<<<<<<<<<
  * 
- *             while next_at_level.value <= value:
+ *     def __getitem__(self, i):
  */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
-    __pyx_t_1 = 0;
+  __pyx_r = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size;
+  goto __pyx_L0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":93
- *             next_at_level = node.next[level]
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":63
+ *         return self.size
+ * 
+ *     def __getitem__(self, i):             # <<<<<<<<<<<<<<
+ *         return self.get(i)
  * 
- *             while next_at_level.value <= value:             # <<<<<<<<<<<<<<
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])
  */
-    while (1) {
-      __pyx_t_5 = (__pyx_v_next_at_level->value <= __pyx_v_value);
-      if (!__pyx_t_5) break;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":94
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_2__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_2__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
+  PyObject *__pyx_r = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  __Pyx_RefNannySetupContext("__getitem__");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":64
  * 
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
- *                                          node.width[level])
- *                 node = next_at_level
+ *     def __getitem__(self, i):
+ *         return self.get(i)             # <<<<<<<<<<<<<<
+ * 
+ *     cpdef get(self, int i):
  */
-      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyInt_AsInt(__pyx_v_i); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":95
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])             # <<<<<<<<<<<<<<
- *                 node = next_at_level
- *                 next_at_level = node.next[level]
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__getitem__");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":66
+ *         return self.get(i)
+ * 
+ *     cpdef get(self, int i):             # <<<<<<<<<<<<<<
+ *         cdef int level
+ *         cdef Node node
  */
-      __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_3get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
+static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_get(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, int __pyx_v_i, int __pyx_skip_dispatch) {
+  int __pyx_v_level;
+  struct __pyx_obj_7tseries_Node *__pyx_v_node;
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  int __pyx_t_6;
+  __Pyx_RefNannySetupContext("get");
+  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  /* Check if called by wrapper */
+  if (unlikely(__pyx_skip_dispatch)) ;
+  /* Check if overriden in Python */
+  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
+    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__get); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_3get)) {
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+      __Pyx_GIVEREF(__pyx_t_2);
+      __pyx_t_2 = 0;
+      __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+      __pyx_r = __pyx_t_2;
+      __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      goto __pyx_L0;
+    }
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  }
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":94
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":70
+ *         cdef Node node
+ * 
+ *         node = self.head             # <<<<<<<<<<<<<<
+ *         i += 1
  * 
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
- *                                          node.width[level])
- *                 node = next_at_level
  */
-      if (__Pyx_SetItemInt(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_INCREF(((PyObject *)__pyx_v_self->head));
+  __Pyx_DECREF(((PyObject *)__pyx_v_node));
+  __pyx_v_node = __pyx_v_self->head;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":96
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])
- *                 node = next_at_level             # <<<<<<<<<<<<<<
- *                 next_at_level = node.next[level]
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":71
  * 
+ *         node = self.head
+ *         i += 1             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(self.maxlevels - 1, -1, -1):
  */
-      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
-      __Pyx_DECREF(((PyObject *)__pyx_v_node));
-      __pyx_v_node = __pyx_v_next_at_level;
+  __pyx_v_i = (__pyx_v_i + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":97
- *                                          node.width[level])
- *                 node = next_at_level
- *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":73
+ *         i += 1
  * 
- *             chain[level] = node
+ *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-      __pyx_t_3 = 0;
-    }
+  for (__pyx_t_4 = (__pyx_v_self->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
+    __pyx_v_level = __pyx_t_4;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":99
- *                 next_at_level = node.next[level]
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":74
  * 
- *             chain[level] = node             # <<<<<<<<<<<<<<
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             while node.width[level] <= i:             # <<<<<<<<<<<<<<
+ *                 i -= node.width[level]
+ *                 node = node.next[level]
+ */
+    while (1) {
+      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_t_2, Py_LE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      if (!__pyx_t_5) break;
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":75
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]             # <<<<<<<<<<<<<<
+ *                 node = node.next[level]
  * 
- *         # insert a link to the newnode at each level
  */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
+      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_1 = PyNumber_InPlaceSubtract(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_6 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_v_i = __pyx_t_6;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":102
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":76
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]
+ *                 node = node.next[level]             # <<<<<<<<<<<<<<
  * 
- *         # insert a link to the newnode at each level
- *         d = min(self.maxlevels, 1 - int(Log2(random())))             # <<<<<<<<<<<<<<
- *         newnode = Node(value, [None] * d, [None] * d)
- *         steps = 0
+ *         return node.value
  */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__random); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_f_7tseries_Log2(__pyx_t_6)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Subtract(__pyx_int_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __pyx_v_self->maxlevels;
-  __pyx_t_1 = PyInt_FromLong(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = PyObject_RichCompare(__pyx_t_3, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (__pyx_t_5) {
-    __Pyx_INCREF(__pyx_t_3);
-    __pyx_t_2 = __pyx_t_3;
-  } else {
-    __pyx_t_7 = PyInt_FromLong(__pyx_t_4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = __pyx_t_7;
-    __pyx_t_7 = 0;
+      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_node));
+      __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
+      __pyx_t_1 = 0;
+    }
   }
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_d = __pyx_t_4;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":103
- *         # insert a link to the newnode at each level
- *         d = min(self.maxlevels, 1 - int(Log2(random())))
- *         newnode = Node(value, [None] * d, [None] * d)             # <<<<<<<<<<<<<<
- *         steps = 0
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":78
+ *                 node = node.next[level]
+ * 
+ *         return node.value             # <<<<<<<<<<<<<<
  * 
+ *     cpdef insert(self, double value):
  */
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_3, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_7 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_node->value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyList_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_7));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_7, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = PyNumber_Multiply(((PyObject *)__pyx_t_7), __pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_8);
-  __Pyx_GIVEREF(__pyx_t_8);
-  __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
-  __pyx_t_8 = 0;
-  __pyx_t_8 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_newnode));
-  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_8);
-  __pyx_t_8 = 0;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":104
- *         d = min(self.maxlevels, 1 - int(Log2(random())))
- *         newnode = Node(value, [None] * d, [None] * d)
- *         steps = 0             # <<<<<<<<<<<<<<
- * 
- *         for level in range(d):
- */
-  __pyx_v_steps = 0;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":106
- *         steps = 0
- * 
- *         for level in range(d):             # <<<<<<<<<<<<<<
- *             prevnode = chain[level]
- *             newnode.next[level] = prevnode.next[level]
- */
-  __pyx_t_4 = __pyx_v_d;
-  for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_4; __pyx_t_9+=1) {
-    __pyx_v_level = __pyx_t_9;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":107
- * 
- *         for level in range(d):
- *             prevnode = chain[level]             # <<<<<<<<<<<<<<
- *             newnode.next[level] = prevnode.next[level]
- *             prevnode.next[level] = newnode
- */
-    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_8);
-    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
-    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_8);
-    __pyx_t_8 = 0;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":108
- *         for level in range(d):
- *             prevnode = chain[level]
- *             newnode.next[level] = prevnode.next[level]             # <<<<<<<<<<<<<<
- *             prevnode.next[level] = newnode
- *             newnode.width[level] = (prevnode.width[level] - steps)
- */
-    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_8);
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->next), __pyx_v_level, __pyx_t_8, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":109
- *             prevnode = chain[level]
- *             newnode.next[level] = prevnode.next[level]
- *             prevnode.next[level] = newnode             # <<<<<<<<<<<<<<
- *             newnode.width[level] = (prevnode.width[level] - steps)
- *             prevnode.width[level] = steps + 1
- */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, ((PyObject *)__pyx_v_newnode), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":110
- *             newnode.next[level] = prevnode.next[level]
- *             prevnode.next[level] = newnode
- *             newnode.width[level] = (prevnode.width[level] - steps)             # <<<<<<<<<<<<<<
- *             prevnode.width[level] = steps + 1
- *             steps += steps_at_level[level]
- */
-    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_3 = PyInt_FromLong(__pyx_v_steps); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = PyNumber_Subtract(__pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->width), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":111
- *             prevnode.next[level] = newnode
- *             newnode.width[level] = (prevnode.width[level] - steps)
- *             prevnode.width[level] = steps + 1             # <<<<<<<<<<<<<<
- *             steps += steps_at_level[level]
- * 
- */
-    __pyx_t_1 = PyInt_FromLong((__pyx_v_steps + 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":112
- *             newnode.width[level] = (prevnode.width[level] - steps)
- *             prevnode.width[level] = steps + 1
- *             steps += steps_at_level[level]             # <<<<<<<<<<<<<<
- * 
- *         for level in range(d, self.maxlevels):
- */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_v_steps += __pyx_t_10;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":114
- *             steps += steps_at_level[level]
- * 
- *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
- *             (<Node> chain[level]).width[level] += 1
- * 
- */
-  __pyx_t_4 = __pyx_v_self->maxlevels;
-  for (__pyx_t_9 = __pyx_v_d; __pyx_t_9 < __pyx_t_4; __pyx_t_9+=1) {
-    __pyx_v_level = __pyx_t_9;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":115
- * 
- *         for level in range(d, self.maxlevels):
- *             (<Node> chain[level]).width[level] += 1             # <<<<<<<<<<<<<<
- * 
- *         self.size += 1
- */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_1)->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_t_3, __pyx_int_1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (__Pyx_SetItemInt(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_1)->width), __pyx_v_level, __pyx_t_8, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":117
- *             (<Node> chain[level]).width[level] += 1
- * 
- *         self.size += 1             # <<<<<<<<<<<<<<
- * 
- *     cpdef remove(self, double value):
- */
-  __pyx_v_self->size += 1;
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -3371,47 +3292,40 @@ static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_insert(struct __pyx_obj_7
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_DECREF((PyObject *)__pyx_v_node);
-  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_newnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
-  __Pyx_DECREF(__pyx_v_chain);
-  __Pyx_DECREF(__pyx_v_steps_at_level);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":80
- *         return node.value
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":66
+ *         return self.get(i)
  * 
- *     cpdef insert(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, steps, d
- *         cdef Node node, prevnode, newnode, next_at_level, tmp
+ *     cpdef get(self, int i):             # <<<<<<<<<<<<<<
+ *         cdef int level
+ *         cdef Node node
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  double __pyx_v_value;
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_3get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_3get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i) {
+  int __pyx_v_i;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("insert");
-  assert(__pyx_arg_value); {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely((__pyx_v_value == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RefNannySetupContext("get");
+  assert(__pyx_arg_i); {
+    __pyx_v_i = __Pyx_PyInt_AsInt(__pyx_arg_i); if (unlikely((__pyx_v_i == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->insert(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_value, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->get(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_i, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
@@ -3421,7 +3335,7 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
@@ -3429,55 +3343,62 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":119
- *         self.size += 1
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":80
+ *         return node.value
  * 
- *     cpdef remove(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, d
- *         cdef Node node, prevnode, tmpnode, next_at_level
+ *     cpdef insert(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, steps, d
+ *         cdef Node node, prevnode, newnode, next_at_level, tmp
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, double __pyx_v_value, int __pyx_skip_dispatch) {
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_4insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_insert(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, double __pyx_v_value, int __pyx_skip_dispatch) {
   int __pyx_v_level;
+  int __pyx_v_steps;
   int __pyx_v_d;
   struct __pyx_obj_7tseries_Node *__pyx_v_node;
   struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_tmpnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_newnode;
   struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
   PyObject *__pyx_v_chain;
+  PyObject *__pyx_v_steps_at_level;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
   int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
-  int __pyx_t_7;
-  __Pyx_RefNannySetupContext("remove");
+  double __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  PyObject *__pyx_t_11 = NULL;
+  __Pyx_RefNannySetupContext("insert");
   __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_chain = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_steps_at_level = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overriden in Python */
   else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
-    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__remove); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__insert); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
-    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_remove)) {
+    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_4insert)) {
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
       PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
       __Pyx_GIVEREF(__pyx_t_2);
       __pyx_t_2 = 0;
-      __pyx_t_2 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
       __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
@@ -3486,32 +3407,55 @@ static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":125
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":86
  * 
- *         # find first node on each level where node.next[levels].value >= value
+ *         # find first node on each level where node.next[levels].value > value
  *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
+ *         steps_at_level = [0] * self.maxlevels
  *         node = self.head
- * 
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(Py_None);
   PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
   __Pyx_GIVEREF(Py_None);
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(((PyObject *)__pyx_v_chain));
-  __pyx_v_chain = ((PyObject *)__pyx_t_3);
+  __pyx_v_chain = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":126
- *         # find first node on each level where node.next[levels].value >= value
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":87
+ *         # find first node on each level where node.next[levels].value > value
+ *         chain = [None] * self.maxlevels
+ *         steps_at_level = [0] * self.maxlevels             # <<<<<<<<<<<<<<
+ *         node = self.head
+ * 
+ */
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  __Pyx_INCREF(__pyx_int_0);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
+  __Pyx_GIVEREF(__pyx_int_0);
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_steps_at_level));
+  __pyx_v_steps_at_level = ((PyObject*)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":88
  *         chain = [None] * self.maxlevels
+ *         steps_at_level = [0] * self.maxlevels
  *         node = self.head             # <<<<<<<<<<<<<<
  * 
  *         for level in range(self.maxlevels - 1, -1, -1):
@@ -3520,44 +3464,78 @@ static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7
   __Pyx_DECREF(((PyObject *)__pyx_v_node));
   __pyx_v_node = __pyx_v_self->head;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":128
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":90
  *         node = self.head
  * 
  *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
  *             next_at_level = node.next[level]
- *             while next_at_level.value < value:
+ * 
  */
   for (__pyx_t_4 = (__pyx_v_self->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
     __pyx_v_level = __pyx_t_4;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":129
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":91
  * 
  *         for level in range(self.maxlevels - 1, -1, -1):
  *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
- *             while next_at_level.value < value:
- *                 node = next_at_level
+ * 
+ *             while next_at_level.value <= value:
  */
-    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-    __pyx_t_3 = 0;
+    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
+    __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":130
- *         for level in range(self.maxlevels - 1, -1, -1):
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":93
  *             next_at_level = node.next[level]
- *             while next_at_level.value < value:             # <<<<<<<<<<<<<<
- *                 node = next_at_level
- *                 next_at_level = node.next[level]
+ * 
+ *             while next_at_level.value <= value:             # <<<<<<<<<<<<<<
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])
  */
     while (1) {
-      __pyx_t_5 = (__pyx_v_next_at_level->value < __pyx_v_value);
+      __pyx_t_5 = (__pyx_v_next_at_level->value <= __pyx_v_value);
       if (!__pyx_t_5) break;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":131
- *             next_at_level = node.next[level]
- *             while next_at_level.value < value:
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":94
+ * 
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
+ *                                          node.width[level])
+ *                 node = next_at_level
+ */
+      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":95
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])             # <<<<<<<<<<<<<<
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]
+ */
+      __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":94
+ * 
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
+ *                                          node.width[level])
+ *                 node = next_at_level
+ */
+      if (__Pyx_SetItemInt(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":96
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])
  *                 node = next_at_level             # <<<<<<<<<<<<<<
  *                 next_at_level = node.next[level]
  * 
@@ -3566,208 +3544,276 @@ static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7
       __Pyx_DECREF(((PyObject *)__pyx_v_node));
       __pyx_v_node = __pyx_v_next_at_level;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":132
- *             while next_at_level.value < value:
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":97
+ *                                          node.width[level])
  *                 node = next_at_level
  *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
  * 
  *             chain[level] = node
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
       __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
       __pyx_t_3 = 0;
     }
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":134
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":99
  *                 next_at_level = node.next[level]
  * 
  *             chain[level] = node             # <<<<<<<<<<<<<<
  * 
- *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:
+ *         # insert a link to the newnode at each level
  */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":136
- *             chain[level] = node
- * 
- *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:             # <<<<<<<<<<<<<<
- *             raise KeyError('Not Found')
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":102
  * 
+ *         # insert a link to the newnode at each level
+ *         d = min(self.maxlevels, 1 - int(Log2(random())))             # <<<<<<<<<<<<<<
+ *         newnode = Node(value, [None] * d, [None] * d)
+ *         steps = 0
  */
-  __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__random); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_3)->next), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = (__pyx_v_value != ((struct __pyx_obj_7tseries_Node *)__pyx_t_2)->value);
+  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_6 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_f_7tseries_Log2(__pyx_t_6)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __pyx_t_3 = PyNumber_Subtract(__pyx_int_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = __pyx_v_self->maxlevels;
+  __pyx_t_1 = PyInt_FromLong(__pyx_t_4); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_7 = PyObject_RichCompare(__pyx_t_3, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_5) {
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_2 = __pyx_t_3;
+  } else {
+    __pyx_t_7 = PyInt_FromLong(__pyx_t_4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __pyx_t_2 = __pyx_t_7;
+    __pyx_t_7 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_d = __pyx_t_4;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":137
- * 
- *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:
- *             raise KeyError('Not Found')             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":103
+ *         # insert a link to the newnode at each level
+ *         d = min(self.maxlevels, 1 - int(Log2(random())))
+ *         newnode = Node(value, [None] * d, [None] * d)             # <<<<<<<<<<<<<<
+ *         steps = 0
  * 
- *         # remove one link at each level
  */
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_3));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L7;
-  }
-  __pyx_L7:;
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_3, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_7 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_7); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+  __pyx_t_7 = PyList_New(1); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_7));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_7, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_8 = PyNumber_Multiply(((PyObject *)__pyx_t_7), __pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_8);
+  __Pyx_GIVEREF(__pyx_t_8);
+  __pyx_t_2 = 0;
+  __pyx_t_1 = 0;
+  __pyx_t_8 = 0;
+  __pyx_t_8 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_8);
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_newnode));
+  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_8);
+  __pyx_t_8 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":140
- * 
- *         # remove one link at each level
- *         d = len((<Node> (<Node> (<Node> chain[0]).next)[0]).next)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":104
+ *         d = min(self.maxlevels, 1 - int(Log2(random())))
+ *         newnode = Node(value, [None] * d, [None] * d)
+ *         steps = 0             # <<<<<<<<<<<<<<
  * 
  *         for level in range(d):
  */
-  __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_3)->next), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(((struct __pyx_obj_7tseries_Node *)__pyx_t_2)->next == Py_None)) {
-    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()"); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-  }
-  __pyx_t_6 = PyList_GET_SIZE(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_2)->next)); 
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_d = __pyx_t_6;
+  __pyx_v_steps = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":142
- *         d = len((<Node> (<Node> (<Node> chain[0]).next)[0]).next)
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":106
+ *         steps = 0
  * 
  *         for level in range(d):             # <<<<<<<<<<<<<<
  *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]
+ *             newnode.next[level] = prevnode.next[level]
  */
   __pyx_t_4 = __pyx_v_d;
-  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
-    __pyx_v_level = __pyx_t_7;
+  for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_4; __pyx_t_9+=1) {
+    __pyx_v_level = __pyx_t_9;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":143
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":107
  * 
  *         for level in range(d):
  *             prevnode = chain[level]             # <<<<<<<<<<<<<<
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1
+ *             newnode.next[level] = prevnode.next[level]
+ *             prevnode.next[level] = newnode
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    if (!(likely(((__pyx_t_8) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_8, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
-    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
-    __pyx_t_2 = 0;
+    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_8);
+    __pyx_t_8 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":144
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":108
  *         for level in range(d):
  *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]             # <<<<<<<<<<<<<<
- *             prevnode.width[level] += tmpnode.width[level] - 1
- *             prevnode.next[level] = tmpnode.next[level]
+ *             newnode.next[level] = prevnode.next[level]             # <<<<<<<<<<<<<<
+ *             prevnode.next[level] = newnode
+ *             newnode.width[level] = (prevnode.width[level] - steps)
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
-    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
-    __pyx_t_2 = 0;
+    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->next), __pyx_v_level, __pyx_t_8, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":145
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":109
  *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1             # <<<<<<<<<<<<<<
- *             prevnode.next[level] = tmpnode.next[level]
- * 
+ *             newnode.next[level] = prevnode.next[level]
+ *             prevnode.next[level] = newnode             # <<<<<<<<<<<<<<
+ *             newnode.width[level] = (prevnode.width[level] - steps)
+ *             prevnode.width[level] = steps + 1
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Subtract(__pyx_t_2, __pyx_int_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, ((PyObject *)__pyx_v_newnode), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":110
+ *             newnode.next[level] = prevnode.next[level]
+ *             prevnode.next[level] = newnode
+ *             newnode.width[level] = (prevnode.width[level] - steps)             # <<<<<<<<<<<<<<
+ *             prevnode.width[level] = steps + 1
+ *             steps += steps_at_level[level]
+ */
+    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_3 = PyInt_FromLong(__pyx_v_steps); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = PyNumber_Subtract(__pyx_t_8, __pyx_t_3); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->width), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":146
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1
- *             prevnode.next[level] = tmpnode.next[level]             # <<<<<<<<<<<<<<
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":111
+ *             prevnode.next[level] = newnode
+ *             newnode.width[level] = (prevnode.width[level] - steps)
+ *             prevnode.width[level] = steps + 1             # <<<<<<<<<<<<<<
+ *             steps += steps_at_level[level]
  * 
- *         for level in range(d, self.maxlevels):
  */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = PyInt_FromLong((__pyx_v_steps + 1)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->width), __pyx_v_level, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":148
- *             prevnode.next[level] = tmpnode.next[level]
- * 
- *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
- *             tmpnode = chain[level]
- *             tmpnode.width[level] -= 1
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":112
+ *             newnode.width[level] = (prevnode.width[level] - steps)
+ *             prevnode.width[level] = steps + 1
+ *             steps += steps_at_level[level]             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(d, self.maxlevels):
  */
-  __pyx_t_4 = __pyx_v_self->maxlevels;
-  for (__pyx_t_7 = __pyx_v_d; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
-    __pyx_v_level = __pyx_t_7;
+    __pyx_t_1 = PyInt_FromLong(__pyx_v_steps); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_t_8); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __pyx_v_steps = __pyx_t_10;
+  }
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":149
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":114
+ *             steps += steps_at_level[level]
  * 
- *         for level in range(d, self.maxlevels):
- *             tmpnode = chain[level]             # <<<<<<<<<<<<<<
- *             tmpnode.width[level] -= 1
+ *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
+ *             (<Node> chain[level]).width[level] += 1
  * 
  */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
-    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
-    __pyx_t_1 = 0;
+  __pyx_t_4 = __pyx_v_self->maxlevels;
+  for (__pyx_t_9 = __pyx_v_d; __pyx_t_9 < __pyx_t_4; __pyx_t_9+=1) {
+    __pyx_v_level = __pyx_t_9;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":150
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":115
+ * 
  *         for level in range(d, self.maxlevels):
- *             tmpnode = chain[level]
- *             tmpnode.width[level] -= 1             # <<<<<<<<<<<<<<
+ *             (<Node> chain[level]).width[level] += 1             # <<<<<<<<<<<<<<
  * 
- *         self.size -= 1
+ *         self.size += 1
  */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = PyNumber_InPlaceSubtract(__pyx_t_1, __pyx_int_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_tmpnode->width), __pyx_v_level, __pyx_t_2, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_8)->width));
+    __pyx_t_11 = ((struct __pyx_obj_7tseries_Node *)__pyx_t_8)->width;
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    __pyx_t_10 = __pyx_v_level;
+    __pyx_t_8 = __Pyx_GetItemInt_List(((PyObject *)__pyx_t_11), __pyx_t_10, sizeof(int), PyInt_FromLong); if (!__pyx_t_8) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_t_8, __pyx_int_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_t_11), __pyx_t_10, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_11)); __pyx_t_11 = 0;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":152
- *             tmpnode.width[level] -= 1
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":117
+ *             (<Node> chain[level]).width[level] += 1
  * 
- *         self.size -= 1             # <<<<<<<<<<<<<<
+ *         self.size += 1             # <<<<<<<<<<<<<<
+ * 
+ *     cpdef remove(self, double value):
  */
-  __pyx_v_self->size -= 1;
+  __pyx_v_self->size = (__pyx_v_self->size + 1);
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -3775,44 +3821,48 @@ static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(((PyObject *)__pyx_t_11));
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_DECREF((PyObject *)__pyx_v_node);
   __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_tmpnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_newnode);
   __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
   __Pyx_DECREF(__pyx_v_chain);
+  __Pyx_DECREF(__pyx_v_steps_at_level);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":119
- *         self.size += 1
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":80
+ *         return node.value
  * 
- *     cpdef remove(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, d
- *         cdef Node node, prevnode, tmpnode, next_at_level
+ *     cpdef insert(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, steps, d
+ *         cdef Node node, prevnode, newnode, next_at_level, tmp
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_4insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_4insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
   double __pyx_v_value;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("remove");
+  __Pyx_RefNannySetupContext("insert");
   assert(__pyx_arg_value); {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely((__pyx_v_value == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely((__pyx_v_value == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->remove(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_value, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->insert(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_value, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
@@ -3822,7 +3872,7 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
@@ -3830,380 +3880,352 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":5
- * cdef double NEGINF = -INF
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":119
+ *         self.size += 1
  * 
- * cdef inline _checknull(object val):             # <<<<<<<<<<<<<<
- *     if isinstance(val, float):
- *         return val != val or val == INF or val == NEGINF
+ *     cpdef remove(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, d
+ *         cdef Node node, prevnode, tmpnode, next_at_level
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *__pyx_v_val) {
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_5remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static  PyObject *__pyx_f_7tseries_17IndexableSkiplist_remove(struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_self, double __pyx_v_value, int __pyx_skip_dispatch) {
+  int __pyx_v_level;
+  int __pyx_v_d;
+  struct __pyx_obj_7tseries_Node *__pyx_v_node;
+  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_tmpnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
+  PyObject *__pyx_v_chain;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
+  PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  __Pyx_RefNannySetupContext("_checknull");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":6
- * 
- * cdef inline _checknull(object val):
- *     if isinstance(val, float):             # <<<<<<<<<<<<<<
- *         return val != val or val == INF or val == NEGINF
- *     else:
- */
-  __pyx_t_1 = PyFloat_Check(__pyx_v_val); 
-  if (__pyx_t_1) {
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":7
- * cdef inline _checknull(object val):
- *     if isinstance(val, float):
- *         return val != val or val == INF or val == NEGINF             # <<<<<<<<<<<<<<
- *     else:
- *         return val is None
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_val, __pyx_v_val, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    if (!__pyx_t_1) {
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_INF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      if (!__pyx_t_1) {
-        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_NEGINF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_5 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_5);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_3 = __pyx_t_5;
-        __pyx_t_5 = 0;
-      } else {
-        __pyx_t_3 = __pyx_t_4;
-        __pyx_t_4 = 0;
-      }
-      __pyx_t_4 = __pyx_t_3;
-      __pyx_t_3 = 0;
-    } else {
-      __pyx_t_4 = __pyx_t_2;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  Py_ssize_t __pyx_t_6;
+  int __pyx_t_7;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_t_9;
+  __Pyx_RefNannySetupContext("remove");
+  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_chain = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
+  /* Check if called by wrapper */
+  if (unlikely(__pyx_skip_dispatch)) ;
+  /* Check if overriden in Python */
+  else if (unlikely(Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0)) {
+    __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s__remove); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (void *)&__pyx_pf_7tseries_17IndexableSkiplist_5remove)) {
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+      __Pyx_GIVEREF(__pyx_t_2);
+      __pyx_t_2 = 0;
+      __pyx_t_2 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+      __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      goto __pyx_L0;
     }
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-    goto __pyx_L3;
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
-  /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":9
- *         return val != val or val == INF or val == NEGINF
- *     else:
- *         return val is None             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":125
+ * 
+ *         # find first node on each level where node.next[levels].value >= value
+ *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
+ *         node = self.head
  * 
- * cpdef checknull(object val):
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = (__pyx_v_val == Py_None);
-    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-  }
-  __pyx_L3:;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("tseries._checknull");
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_self->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
+  __pyx_v_chain = ((PyObject*)__pyx_t_3);
+  __pyx_t_3 = 0;
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":11
- *         return val is None
- * 
- * cpdef checknull(object val):             # <<<<<<<<<<<<<<
- *     return _checknull(val)
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":126
+ *         # find first node on each level where node.next[levels].value >= value
+ *         chain = [None] * self.maxlevels
+ *         node = self.head             # <<<<<<<<<<<<<<
  * 
+ *         for level in range(self.maxlevels - 1, -1, -1):
  */
+  __Pyx_INCREF(((PyObject *)__pyx_v_self->head));
+  __Pyx_DECREF(((PyObject *)__pyx_v_node));
+  __pyx_v_node = __pyx_v_self->head;
 
-static PyObject *__pyx_pf_7tseries_checknull(PyObject *__pyx_self, PyObject *__pyx_v_val); /*proto*/
-static  PyObject *__pyx_f_7tseries_checknull(PyObject *__pyx_v_val, int __pyx_skip_dispatch) {
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("checknull");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":12
- * 
- * cpdef checknull(object val):
- *     return _checknull(val)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":128
+ *         node = self.head
  * 
- * def isnullobj(ndarray input):
+ *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries__checknull(__pyx_v_val); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.checknull");
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  for (__pyx_t_4 = (__pyx_v_self->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
+    __pyx_v_level = __pyx_t_4;
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":11
- *         return val is None
- * 
- * cpdef checknull(object val):             # <<<<<<<<<<<<<<
- *     return _checknull(val)
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":129
  * 
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+ *             while next_at_level.value < value:
+ *                 node = next_at_level
  */
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+    __pyx_t_3 = 0;
 
-static PyObject *__pyx_pf_7tseries_checknull(PyObject *__pyx_self, PyObject *__pyx_v_val); /*proto*/
-static PyObject *__pyx_pf_7tseries_checknull(PyObject *__pyx_self, PyObject *__pyx_v_val) {
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("checknull");
-  __pyx_self = __pyx_self;
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries_checknull(__pyx_v_val, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries.checknull");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":14
- *     return _checknull(val)
- * 
- * def isnullobj(ndarray input):             # <<<<<<<<<<<<<<
- *     cdef int i, length
- *     cdef object val
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":130
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:             # <<<<<<<<<<<<<<
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]
  */
+    while (1) {
+      __pyx_t_5 = (__pyx_v_next_at_level->value < __pyx_v_value);
+      if (!__pyx_t_5) break;
 
-static PyObject *__pyx_pf_7tseries_isnullobj(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
-static PyObject *__pyx_pf_7tseries_isnullobj(PyObject *__pyx_self, PyObject *__pyx_v_input) {
-  int __pyx_v_i;
-  int __pyx_v_length;
-  PyObject *__pyx_v_val;
-  PyArrayObject *__pyx_v_result;
-  PyArrayIterObject *__pyx_v_iter;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  int __pyx_t_13;
-  __Pyx_RefNannySetupContext("isnullobj");
-  __pyx_self = __pyx_self;
-  __pyx_v_val = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_result.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":20
- *     cdef flatiter iter
- * 
- *     length = PyArray_SIZE(input)             # <<<<<<<<<<<<<<
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":131
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:
+ *                 node = next_at_level             # <<<<<<<<<<<<<<
+ *                 next_at_level = node.next[level]
  * 
- *     result = <ndarray> np.zeros(length, dtype=np.int8)
  */
-  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_v_input));
+      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
+      __Pyx_DECREF(((PyObject *)__pyx_v_node));
+      __pyx_v_node = __pyx_v_next_at_level;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":22
- *     length = PyArray_SIZE(input)
- * 
- *     result = <ndarray> np.zeros(length, dtype=np.int8)             # <<<<<<<<<<<<<<
+      /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":132
+ *             while next_at_level.value < value:
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
  * 
- *     iter= PyArray_IterNew(input)
+ *             chain[level] = node
  */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
-      }
+      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 132; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+      __pyx_t_3 = 0;
     }
-    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_6 = 0;
-  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_5)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_result));
-  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":24
- *     result = <ndarray> np.zeros(length, dtype=np.int8)
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":134
+ *                 next_at_level = node.next[level]
  * 
- *     iter= PyArray_IterNew(input)             # <<<<<<<<<<<<<<
+ *             chain[level] = node             # <<<<<<<<<<<<<<
  * 
- *     for i from 0 <= i < length:
+ *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:
  */
-  __pyx_t_5 = PyArray_IterNew(__pyx_v_input); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_flatiter))))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
-  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_5);
-  __pyx_t_5 = 0;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":26
- *     iter= PyArray_IterNew(input)
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":136
+ *             chain[level] = node
  * 
- *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
+ *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:             # <<<<<<<<<<<<<<
+ *             raise KeyError('Not Found')
  * 
  */
-  __pyx_t_7 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
+  __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = __Pyx_GetItemInt(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_3)->next), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_5 = (__pyx_v_value != ((struct __pyx_obj_7tseries_Node *)__pyx_t_2)->value);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (__pyx_t_5) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":27
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":137
  * 
- *     for i from 0 <= i < length:
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
+ *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:
+ *             raise KeyError('Not Found')             # <<<<<<<<<<<<<<
  * 
- *         if _checknull(val):
+ *         # remove one link at each level
  */
-    __pyx_t_5 = PyArray_GETITEM(((PyArrayObject *)__pyx_v_input), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_v_val);
-    __pyx_v_val = __pyx_t_5;
-    __pyx_t_5 = 0;
+    __pyx_t_2 = PyObject_Call(__pyx_builtin_KeyError, ((PyObject *)__pyx_k_tuple_5), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    goto __pyx_L7;
+  }
+  __pyx_L7:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":29
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":140
  * 
- *         if _checknull(val):             # <<<<<<<<<<<<<<
- *             result[i] = 1
+ *         # remove one link at each level
+ *         d = len((<Node> (<Node> (<Node> chain[0]).next)[0]).next)             # <<<<<<<<<<<<<<
  * 
+ *         for level in range(d):
  */
-    __pyx_t_5 = __pyx_f_7tseries__checknull(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (__pyx_t_11) {
+  __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_GetItemInt(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_2)->next), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_t_3)->next);
+  __Pyx_INCREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (unlikely(__pyx_t_2 == Py_None)) {
+    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()"); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+  }
+  __pyx_t_6 = PyList_GET_SIZE(__pyx_t_2); 
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_d = __pyx_t_6;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":30
- * 
- *         if _checknull(val):
- *             result[i] = 1             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":142
+ *         d = len((<Node> (<Node> (<Node> chain[0]).next)[0]).next)
  * 
- *         PyArray_ITER_NEXT(iter)
+ *         for level in range(d):             # <<<<<<<<<<<<<<
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]
  */
-      __pyx_t_12 = __pyx_v_i;
-      __pyx_t_13 = -1;
-      if (__pyx_t_12 < 0) {
-        __pyx_t_12 += __pyx_bshape_0_result;
-        if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
-      } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_result)) __pyx_t_13 = 0;
-      if (unlikely(__pyx_t_13 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_13);
-        {__pyx_filename = __pyx_f[3]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_result.buf, __pyx_t_12, __pyx_bstride_0_result) = 1;
-      goto __pyx_L7;
-    }
-    __pyx_L7:;
+  __pyx_t_4 = __pyx_v_d;
+  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
+    __pyx_v_level = __pyx_t_7;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":32
- *             result[i] = 1
- * 
- *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":143
  * 
- *     return result
+ *         for level in range(d):
+ *             prevnode = chain[level]             # <<<<<<<<<<<<<<
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1
  */
-    PyArray_ITER_NEXT(__pyx_v_iter);
-  }
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
+    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
+    __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":34
- *         PyArray_ITER_NEXT(iter)
- * 
- *     return result             # <<<<<<<<<<<<<<
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyObject *)__pyx_v_result);
-  goto __pyx_L0;
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":144
+ *         for level in range(d):
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]             # <<<<<<<<<<<<<<
+ *             prevnode.width[level] += tmpnode.width[level] - 1
+ *             prevnode.next[level] = tmpnode.next[level]
+ */
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
+    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
+    __pyx_t_2 = 0;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":145
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1             # <<<<<<<<<<<<<<
+ *             prevnode.next[level] = tmpnode.next[level]
+ * 
+ */
+    __Pyx_INCREF(((PyObject *)__pyx_v_prevnode->width));
+    __pyx_t_8 = __pyx_v_prevnode->width;
+    __pyx_t_9 = __pyx_v_level;
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_t_8), __pyx_t_9, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->width), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = PyNumber_Subtract(__pyx_t_3, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_t_8), __pyx_t_9, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":146
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1
+ *             prevnode.next[level] = tmpnode.next[level]             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(d, self.maxlevels):
+ */
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":148
+ *             prevnode.next[level] = tmpnode.next[level]
+ * 
+ *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
+ *             tmpnode = chain[level]
+ *             tmpnode.width[level] -= 1
+ */
+  __pyx_t_4 = __pyx_v_self->maxlevels;
+  for (__pyx_t_7 = __pyx_v_d; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
+    __pyx_v_level = __pyx_t_7;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":149
+ * 
+ *         for level in range(d, self.maxlevels):
+ *             tmpnode = chain[level]             # <<<<<<<<<<<<<<
+ *             tmpnode.width[level] -= 1
+ * 
+ */
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
+    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+    __pyx_t_3 = 0;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":150
+ *         for level in range(d, self.maxlevels):
+ *             tmpnode = chain[level]
+ *             tmpnode.width[level] -= 1             # <<<<<<<<<<<<<<
+ * 
+ *         self.size -= 1
+ */
+    __Pyx_INCREF(((PyObject *)__pyx_v_tmpnode->width));
+    __pyx_t_8 = __pyx_v_tmpnode->width;
+    __pyx_t_9 = __pyx_v_level;
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_t_8), __pyx_t_9, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = PyNumber_InPlaceSubtract(__pyx_t_3, __pyx_int_1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_t_8), __pyx_t_9, __pyx_t_1, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
+  }
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":152
+ *             tmpnode.width[level] -= 1
+ * 
+ *         self.size -= 1             # <<<<<<<<<<<<<<
+ */
+  __pyx_v_self->size = (__pyx_v_self->size - 1);
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -4211,48 +4233,45 @@ static PyObject *__pyx_pf_7tseries_isnullobj(PyObject *__pyx_self, PyObject *__p
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.isnullobj");
-  __pyx_r = NULL;
-  goto __pyx_L2;
+  __Pyx_XDECREF(((PyObject *)__pyx_t_8));
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __pyx_r = 0;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_val);
-  __Pyx_DECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_iter);
+  __Pyx_DECREF((PyObject *)__pyx_v_node);
+  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_tmpnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
+  __Pyx_DECREF(__pyx_v_chain);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":5
- * # Groupby-related functions
- * 
- * cdef inline _isnan(object o):             # <<<<<<<<<<<<<<
- *     return o != o
+/* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":119
+ *         self.size += 1
  * 
+ *     cpdef remove(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, d
+ *         cdef Node node, prevnode, tmpnode, next_at_level
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_7tseries__isnan(PyObject *__pyx_v_o) {
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_5remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_5remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
+  double __pyx_v_value;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  __Pyx_RefNannySetupContext("_isnan");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":6
- * 
- * cdef inline _isnan(object o):
- *     return o != o             # <<<<<<<<<<<<<<
- * 
- * @cython.boundscheck(False)
- */
+  __Pyx_RefNannySetupContext("remove");
+  assert(__pyx_arg_value); {
+    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely((__pyx_v_value == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_o, __pyx_v_o, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->__pyx_vtab)->remove(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self), __pyx_v_value, 1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
@@ -4262,296 +4281,520 @@ static CYTHON_INLINE PyObject *__pyx_f_7tseries__isnan(PyObject *__pyx_v_o) {
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("tseries._isnan");
-  __pyx_r = 0;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":9
+/* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":5
+ * cdef double NEGINF = -INF
  * 
- * @cython.boundscheck(False)
- * def arrmap(ndarray[object, ndim=1] index, object func):             # <<<<<<<<<<<<<<
- *     cdef int length = index.shape[0]
- *     cdef int i = 0
+ * cdef inline _checknull(object val):             # <<<<<<<<<<<<<<
+ *     if isinstance(val, float):
+ *         return val != val or val == INF or val == NEGINF
  */
 
-static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_func = 0;
-  int __pyx_v_length;
-  int __pyx_v_i;
-  PyArrayObject *__pyx_v_result = 0;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
+static CYTHON_INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *__pyx_v_val) {
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  PyObject **__pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__func,0};
-  __Pyx_RefNannySetupContext("arrmap");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__func);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RefNannySetupContext("_checknull");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":6
+ * 
+ * cdef inline _checknull(object val):
+ *     if isinstance(val, float):             # <<<<<<<<<<<<<<
+ *         return val != val or val == INF or val == NEGINF
+ *     else:
+ */
+  __pyx_t_1 = __pyx_v_val;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = ((PyObject *)((PyObject*)(&PyFloat_Type)));
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_TypeCheck(__pyx_t_1, __pyx_t_2); 
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (__pyx_t_3) {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":7
+ * cdef inline _checknull(object val):
+ *     if isinstance(val, float):
+ *         return val != val or val == INF or val == NEGINF             # <<<<<<<<<<<<<<
+ *     else:
+ *         return val is None
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_val, __pyx_v_val, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (!__pyx_t_3) {
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_1 = PyFloat_FromDouble(__pyx_v_7tseries_INF); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_val, __pyx_t_1, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      if (!__pyx_t_3) {
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_7tseries_NEGINF); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_5 = PyObject_RichCompare(__pyx_v_val, __pyx_t_1, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __pyx_t_1 = __pyx_t_5;
+        __pyx_t_5 = 0;
+      } else {
+        __pyx_t_1 = __pyx_t_4;
+        __pyx_t_4 = 0;
       }
+      __pyx_t_4 = __pyx_t_1;
+      __pyx_t_1 = 0;
+    } else {
+      __pyx_t_4 = __pyx_t_2;
+      __pyx_t_2 = 0;
     }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "arrmap") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_func = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_func = PyTuple_GET_ITEM(__pyx_args, 1);
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.arrmap");
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_bstruct_result.buf = NULL;
-  __pyx_bstruct_index.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+    goto __pyx_L3;
   }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
+  /*else*/ {
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":10
- * @cython.boundscheck(False)
- * def arrmap(ndarray[object, ndim=1] index, object func):
- *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
- *     cdef int i = 0
+    /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":9
+ *         return val != val or val == INF or val == NEGINF
+ *     else:
+ *         return val is None             # <<<<<<<<<<<<<<
  * 
+ * cpdef checknull(object val):
  */
-  __pyx_v_length = (__pyx_v_index->dimensions[0]);
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_3 = (__pyx_v_val == Py_None);
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+  }
+  __pyx_L3:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":11
- * def arrmap(ndarray[object, ndim=1] index, object func):
- *     cdef int length = index.shape[0]
- *     cdef int i = 0             # <<<<<<<<<<<<<<
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("tseries._checknull");
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":11
+ *         return val is None
+ * 
+ * cpdef checknull(object val):             # <<<<<<<<<<<<<<
+ *     return _checknull(val)
  * 
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
  */
-  __pyx_v_i = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":13
- *     cdef int i = 0
+static PyObject *__pyx_pf_7tseries_3checknull(PyObject *__pyx_self, PyObject *__pyx_v_val); /*proto*/
+static  PyObject *__pyx_f_7tseries_checknull(PyObject *__pyx_v_val, int __pyx_skip_dispatch) {
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  __Pyx_RefNannySetupContext("checknull");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":12
  * 
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)             # <<<<<<<<<<<<<<
+ * cpdef checknull(object val):
+ *     return _checknull(val)             # <<<<<<<<<<<<<<
  * 
- *     for i from 0 <= i < length:
+ * def isnullobj(ndarray input):
  */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __pyx_v_val;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries__checknull(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("tseries.checknull");
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":11
+ *         return val is None
+ * 
+ * cpdef checknull(object val):             # <<<<<<<<<<<<<<
+ *     return _checknull(val)
+ * 
+ */
+
+static PyObject *__pyx_pf_7tseries_3checknull(PyObject *__pyx_self, PyObject *__pyx_v_val); /*proto*/
+static PyObject *__pyx_pf_7tseries_3checknull(PyObject *__pyx_self, PyObject *__pyx_v_val) {
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  __Pyx_RefNannySetupContext("checknull");
+  __pyx_self = __pyx_self;
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __pyx_v_val;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries_checknull(__pyx_t_1, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("tseries.checknull");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":14
+ *     return _checknull(val)
+ * 
+ * def isnullobj(ndarray input):             # <<<<<<<<<<<<<<
+ *     cdef int i, length
+ *     cdef object val
+ */
+
+static PyObject *__pyx_pf_7tseries_4isnullobj(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_4isnullobj = {__Pyx_NAMESTR("isnullobj"), (PyCFunction)__pyx_pf_7tseries_4isnullobj, METH_O, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_4isnullobj(PyObject *__pyx_self, PyObject *__pyx_v_input) {
+  int __pyx_v_i;
+  int __pyx_v_length;
+  PyObject *__pyx_v_val;
+  PyArrayObject *__pyx_v_result;
+  PyArrayIterObject *__pyx_v_iter;
+  Py_buffer __pyx_bstruct_result;
+  Py_ssize_t __pyx_bstride_0_result = 0;
+  Py_ssize_t __pyx_bshape_0_result = 0;
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  __Pyx_RefNannySetupContext("isnullobj");
+  __pyx_self = __pyx_self;
+  __pyx_v_val = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_bstruct_result.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":20
+ *     cdef flatiter iter
+ * 
+ *     length = PyArray_SIZE(input)             # <<<<<<<<<<<<<<
+ * 
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)
+ */
+  __pyx_t_1 = __pyx_v_input;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":22
+ *     length = PyArray_SIZE(input)
+ * 
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)             # <<<<<<<<<<<<<<
+ * 
+ *     iter= PyArray_IterNew(input)
+ */
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__object_); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_result.buf = NULL;
-      {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-      __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_7 < 0)) {
+      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
+        __Pyx_RaiseBufferFallbackError();
+      } else {
+        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+      }
     }
+    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
+    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
+    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_t_6 = 0;
+  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_5)));
+  __Pyx_DECREF(((PyObject *)__pyx_v_result));
   __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
-  __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":15
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":24
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)
+ * 
+ *     iter= PyArray_IterNew(input)             # <<<<<<<<<<<<<<
+ * 
+ *     for i from 0 <= i < length:
+ */
+  __pyx_t_5 = __pyx_v_input;
+  __Pyx_INCREF(__pyx_t_5);
+  __pyx_t_1 = PyArray_IterNew(__pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_flatiter))))) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
+  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":26
+ *     iter= PyArray_IterNew(input)
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         result[i] = trycall(func, index[i])
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
  * 
  */
   __pyx_t_7 = __pyx_v_length;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":16
+    /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":27
  * 
  *     for i from 0 <= i < length:
- *         result[i] = trycall(func, index[i])             # <<<<<<<<<<<<<<
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
  * 
- *     return result
+ *         if _checknull(val):
  */
-    __pyx_t_8 = __pyx_v_i;
-    if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_index;
-    __pyx_t_5 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_8, __pyx_bstride_0_index);
-    __Pyx_INCREF((PyObject*)__pyx_t_5);
-    __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_func, __pyx_t_5); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_9 = __pyx_v_i;
-    if (__pyx_t_9 < 0) __pyx_t_9 += __pyx_bshape_0_result;
-    __pyx_t_10 = __Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_result.buf, __pyx_t_9, __pyx_bstride_0_result);
-    __Pyx_GOTREF(*__pyx_t_10);
-    __Pyx_DECREF(*__pyx_t_10); __Pyx_INCREF(__pyx_t_1);
-    *__pyx_t_10 = __pyx_t_1;
-    __Pyx_GIVEREF(*__pyx_t_10);
+    __pyx_t_1 = __pyx_v_input;
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_5 = PyArray_GETITEM(((PyArrayObject *)__pyx_t_1), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  }
+    __Pyx_DECREF(__pyx_v_val);
+    __pyx_v_val = __pyx_t_5;
+    __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":18
- *         result[i] = trycall(func, index[i])
+    /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":29
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
  * 
- *     return result             # <<<<<<<<<<<<<<
+ *         if _checknull(val):             # <<<<<<<<<<<<<<
+ *             result[i] = 1
  * 
- * @cython.boundscheck(False)
  */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyObject *)__pyx_v_result);
-  goto __pyx_L0;
+    __pyx_t_5 = __pyx_f_7tseries__checknull(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (__pyx_t_11) {
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.arrmap");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+      /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":30
+ * 
+ *         if _checknull(val):
+ *             result[i] = 1             # <<<<<<<<<<<<<<
+ * 
+ *         PyArray_ITER_NEXT(iter)
+ */
+      __pyx_t_12 = __pyx_v_i;
+      __pyx_t_13 = -1;
+      if (__pyx_t_12 < 0) {
+        __pyx_t_12 += __pyx_bshape_0_result;
+        if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+      } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_result)) __pyx_t_13 = 0;
+      if (unlikely(__pyx_t_13 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_13);
+        {__pyx_filename = __pyx_f[3]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_result.buf, __pyx_t_12, __pyx_bstride_0_result) = 1;
+      goto __pyx_L7;
+    }
+    __pyx_L7:;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":32
+ *             result[i] = 1
+ * 
+ *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
+ * 
+ *     return result
+ */
+    PyArray_ITER_NEXT(__pyx_v_iter);
+  }
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":34
+ *         PyArray_ITER_NEXT(iter)
+ * 
+ *     return result             # <<<<<<<<<<<<<<
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.isnullobj");
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
   __pyx_L2:;
-  __Pyx_XDECREF((PyObject *)__pyx_v_result);
+  __Pyx_DECREF(__pyx_v_val);
+  __Pyx_DECREF((PyObject *)__pyx_v_result);
+  __Pyx_DECREF((PyObject *)__pyx_v_iter);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":5
+ * # Groupby-related functions
+ * 
+ * cdef inline _isnan(object o):             # <<<<<<<<<<<<<<
+ *     return o != o
+ * 
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_7tseries__isnan(PyObject *__pyx_v_o) {
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  __Pyx_RefNannySetupContext("_isnan");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":6
+ * 
+ * cdef inline _isnan(object o):
+ *     return o != o             # <<<<<<<<<<<<<<
+ * 
+ * @cython.boundscheck(False)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_o, __pyx_v_o, Py_NE); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("tseries._isnan");
+  __pyx_r = 0;
+  __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":21
+/* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":9
  * 
  * @cython.boundscheck(False)
- * def groupby(object index, object mapper, output=None):             # <<<<<<<<<<<<<<
- *     cdef dict result
- *     cdef ndarray[object, ndim=1] mapped_index
+ * def arrmap(ndarray[object, ndim=1] index, object func):             # <<<<<<<<<<<<<<
+ *     cdef int length = index.shape[0]
+ *     cdef int i = 0
  */
 
-static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_mapper = 0;
-  PyObject *__pyx_v_output = 0;
-  PyObject *__pyx_v_result;
-  PyArrayObject *__pyx_v_mapped_index;
-  PyArrayObject *__pyx_v_index_buf;
-  PyArrayObject *__pyx_v_mask;
-  int __pyx_v_i;
+static PyObject *__pyx_pf_7tseries_5arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_5arrmap = {__Pyx_NAMESTR("arrmap"), (PyCFunction)__pyx_pf_7tseries_5arrmap, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_5arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_func = 0;
   int __pyx_v_length;
-  PyObject *__pyx_v_members;
-  PyObject *__pyx_v_idx;
-  PyObject *__pyx_v_key;
-  PyObject *__pyx_v_nullkeys;
-  Py_buffer __pyx_bstruct_index_buf;
-  Py_ssize_t __pyx_bstride_0_index_buf = 0;
-  Py_ssize_t __pyx_bshape_0_index_buf = 0;
-  Py_buffer __pyx_bstruct_mask;
-  Py_ssize_t __pyx_bstride_0_mask = 0;
-  Py_ssize_t __pyx_bshape_0_mask = 0;
-  Py_buffer __pyx_bstruct_mapped_index;
-  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
-  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
+  int __pyx_v_i;
+  PyArrayObject *__pyx_v_result = 0;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
+  Py_buffer __pyx_bstruct_result;
+  Py_ssize_t __pyx_bstride_0_result = 0;
+  Py_ssize_t __pyx_bshape_0_result = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyArrayObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  PyArrayObject *__pyx_t_11 = NULL;
-  PyArrayObject *__pyx_t_12 = NULL;
-  int __pyx_t_13;
-  __pyx_t_5numpy_int8_t __pyx_t_14;
-  int __pyx_t_15;
-  int __pyx_t_16;
-  int __pyx_t_17;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__mapper,&__pyx_n_s__output,0};
-  __Pyx_RefNannySetupContext("groupby");
+  int __pyx_t_8;
+  int __pyx_t_9;
+  PyObject **__pyx_t_10;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__func,0};
+  __Pyx_RefNannySetupContext("arrmap");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    values[2] = ((PyObject *)Py_None);
+    PyObject* values[2] = {0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -4563,480 +4806,209 @@ static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mapper);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__func);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("groupby", 0, 2, 3, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      if (kw_args > 0) {
-        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
-        if (value) { values[2] = value; kw_args--; }
+        __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "arrmap") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_index = values[0];
-    __pyx_v_mapper = values[1];
-    __pyx_v_output = values[2];
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_func = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_output = ((PyObject *)Py_None);
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3:
-      __pyx_v_output = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2:
-      __pyx_v_mapper = PyTuple_GET_ITEM(__pyx_args, 1);
-      __pyx_v_index = PyTuple_GET_ITEM(__pyx_args, 0);
-      break;
-      default: goto __pyx_L5_argtuple_error;
-    }
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_func = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupby", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupby");
+  __Pyx_AddTraceback("tseries.arrmap");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_v_result = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_index_buf = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_nullkeys = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_bstruct_mapped_index.buf = NULL;
-  __pyx_bstruct_index_buf.buf = NULL;
-  __pyx_bstruct_mask.buf = NULL;
+  __pyx_bstruct_result.buf = NULL;
+  __pyx_bstruct_index.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":30
- *     cdef object idx, key
- * 
- *     length = len(index)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":10
+ * @cython.boundscheck(False)
+ * def arrmap(ndarray[object, ndim=1] index, object func):
+ *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef int i = 0
  * 
- *     if output is None:
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_index); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_length = __pyx_t_1;
+  __pyx_v_length = (__pyx_v_index->dimensions[0]);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":32
- *     length = len(index)
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":11
+ * def arrmap(ndarray[object, ndim=1] index, object func):
+ *     cdef int length = index.shape[0]
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
  * 
- *     if output is None:             # <<<<<<<<<<<<<<
- *         result = {}
- *     else:
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
  */
-  __pyx_t_2 = (__pyx_v_output == Py_None);
-  if (__pyx_t_2) {
+  __pyx_v_i = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":33
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":13
+ *     cdef int i = 0
  * 
- *     if output is None:
- *         result = {}             # <<<<<<<<<<<<<<
- *     else:
- *         result = <dict> output
- */
-    __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-    __Pyx_DECREF(((PyObject *)__pyx_v_result));
-    __pyx_v_result = __pyx_t_3;
-    __pyx_t_3 = 0;
-    goto __pyx_L6;
-  }
-  /*else*/ {
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":35
- *         result = {}
- *     else:
- *         result = <dict> output             # <<<<<<<<<<<<<<
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)             # <<<<<<<<<<<<<<
  * 
- *     index_buf = np.asarray(index)
+ *     for i from 0 <= i < length:
  */
-    __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_v_output)));
-    __Pyx_DECREF(((PyObject *)__pyx_v_result));
-    __pyx_v_result = ((PyObject *)__pyx_v_output);
-  }
-  __pyx_L6:;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":37
- *         result = <dict> output
- * 
- *     index_buf = np.asarray(index)             # <<<<<<<<<<<<<<
- *     mapped_index = arrmap(index_buf, mapper)
- *     mask = isnullobj(mapped_index)
- */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__asarray); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(__pyx_v_index);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_index);
-  __Pyx_GIVEREF(__pyx_v_index);
-  __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__object_); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_index_buf, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index_buf, (PyObject*)__pyx_v_index_buf, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
-      }
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_result.buf = NULL;
+      {__pyx_filename = __pyx_f[4]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
+      __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
     }
-    __pyx_bstride_0_index_buf = __pyx_bstruct_index_buf.strides[0];
-    __pyx_bshape_0_index_buf = __pyx_bstruct_index_buf.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_index_buf));
-  __pyx_v_index_buf = ((PyArrayObject *)__pyx_t_5);
+  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":38
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":15
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
  * 
- *     index_buf = np.asarray(index)
- *     mapped_index = arrmap(index_buf, mapper)             # <<<<<<<<<<<<<<
- *     mask = isnullobj(mapped_index)
- *     nullkeys = index_buf[mask.astype(bool)]
- */
-  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_v_index_buf));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_index_buf));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_index_buf));
-  __Pyx_INCREF(__pyx_v_mapper);
-  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_mapper);
-  __Pyx_GIVEREF(__pyx_v_mapper);
-  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_11 = ((PyArrayObject *)__pyx_t_4);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_11, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_10, &__pyx_t_9, &__pyx_t_8);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_v_mapped_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_8);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_10, __pyx_t_9, __pyx_t_8);
-      }
-    }
-    __pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
-    __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_11 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_mapped_index));
-  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":39
- *     index_buf = np.asarray(index)
- *     mapped_index = arrmap(index_buf, mapper)
- *     mask = isnullobj(mapped_index)             # <<<<<<<<<<<<<<
- *     nullkeys = index_buf[mask.astype(bool)]
- *     if len(nullkeys) > 0:
- */
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnullobj); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_v_mapped_index));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_mapped_index));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_mapped_index));
-  __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_v_mask, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
-      }
-    }
-    __pyx_bstride_0_mask = __pyx_bstruct_mask.strides[0];
-    __pyx_bshape_0_mask = __pyx_bstruct_mask.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_12 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_mask));
-  __pyx_v_mask = ((PyArrayObject *)__pyx_t_5);
-  __pyx_t_5 = 0;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":40
- *     mapped_index = arrmap(index_buf, mapper)
- *     mask = isnullobj(mapped_index)
- *     nullkeys = index_buf[mask.astype(bool)]             # <<<<<<<<<<<<<<
- *     if len(nullkeys) > 0:
- *         result[np.NaN] = nullkeys
- */
-  __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject*)&PyBool_Type));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject*)&PyBool_Type));
-  __Pyx_GIVEREF(((PyObject*)&PyBool_Type));
-  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v_index_buf), __pyx_t_4); if (!__pyx_t_3) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_v_nullkeys);
-  __pyx_v_nullkeys = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":41
- *     mask = isnullobj(mapped_index)
- *     nullkeys = index_buf[mask.astype(bool)]
- *     if len(nullkeys) > 0:             # <<<<<<<<<<<<<<
- *         result[np.NaN] = nullkeys
+ *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
+ *         result[i] = trycall(func, index[i])
  * 
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_nullkeys); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = (__pyx_t_1 > 0);
-  if (__pyx_t_2) {
+  __pyx_t_7 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":42
- *     nullkeys = index_buf[mask.astype(bool)]
- *     if len(nullkeys) > 0:
- *         result[np.NaN] = nullkeys             # <<<<<<<<<<<<<<
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":16
  * 
  *     for i from 0 <= i < length:
+ *         result[i] = trycall(func, index[i])             # <<<<<<<<<<<<<<
+ * 
+ *     return result
  */
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_5 = __pyx_v_func;
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_8 = __pyx_v_i;
+    if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_index;
+    __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_8, __pyx_bstride_0_index);
+    __Pyx_INCREF((PyObject*)__pyx_t_1);
+    __pyx_t_3 = __pyx_f_7tseries_trycall(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__NaN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_9 = __pyx_v_i;
+    if (__pyx_t_9 < 0) __pyx_t_9 += __pyx_bshape_0_result;
+    __pyx_t_10 = __Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_result.buf, __pyx_t_9, __pyx_bstride_0_result);
+    __Pyx_GOTREF(*__pyx_t_10);
+    __Pyx_DECREF(*__pyx_t_10); __Pyx_INCREF(__pyx_t_3);
+    *__pyx_t_10 = __pyx_t_3;
+    __Pyx_GIVEREF(*__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_t_4, __pyx_v_nullkeys) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    goto __pyx_L7;
   }
-  __pyx_L7:;
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":44
- *         result[np.NaN] = nullkeys
- * 
- *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         if mask[i]:
- *             continue
- */
-  __pyx_t_7 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":45
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":18
+ *         result[i] = trycall(func, index[i])
  * 
- *     for i from 0 <= i < length:
- *         if mask[i]:             # <<<<<<<<<<<<<<
- *             continue
+ *     return result             # <<<<<<<<<<<<<<
  * 
+ * @cython.boundscheck(False)
  */
-    __pyx_t_13 = __pyx_v_i;
-    if (__pyx_t_13 < 0) __pyx_t_13 += __pyx_bshape_0_mask;
-    __pyx_t_14 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_13, __pyx_bstride_0_mask));
-    if (__pyx_t_14) {
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
+  goto __pyx_L0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":46
- *     for i from 0 <= i < length:
- *         if mask[i]:
- *             continue             # <<<<<<<<<<<<<<
- * 
- *         key = mapped_index[i]
- */
-      goto __pyx_L8_continue;
-      goto __pyx_L10;
-    }
-    __pyx_L10:;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.arrmap");
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_result);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":48
- *             continue
+/* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":21
  * 
- *         key = mapped_index[i]             # <<<<<<<<<<<<<<
- *         idx = index_buf[i]
- *         if key in result:
+ * @cython.boundscheck(False)
+ * def groupby(object index, object mapper, output=None):             # <<<<<<<<<<<<<<
+ *     cdef dict result
+ *     cdef ndarray[object, ndim=1] mapped_index
  */
-    __pyx_t_15 = __pyx_v_i;
-    if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_mapped_index;
-    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_15, __pyx_bstride_0_mapped_index);
-    __Pyx_INCREF((PyObject*)__pyx_t_4);
-    __Pyx_DECREF(__pyx_v_key);
-    __pyx_v_key = __pyx_t_4;
-    __pyx_t_4 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":49
- * 
- *         key = mapped_index[i]
- *         idx = index_buf[i]             # <<<<<<<<<<<<<<
- *         if key in result:
- *             members = result[key]
- */
-    __pyx_t_16 = __pyx_v_i;
-    if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_index_buf;
-    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index_buf.buf, __pyx_t_16, __pyx_bstride_0_index_buf);
-    __Pyx_INCREF((PyObject*)__pyx_t_4);
-    __Pyx_DECREF(__pyx_v_idx);
-    __pyx_v_idx = __pyx_t_4;
-    __pyx_t_4 = 0;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":50
- *         key = mapped_index[i]
- *         idx = index_buf[i]
- *         if key in result:             # <<<<<<<<<<<<<<
- *             members = result[key]
- *             members.append(idx)
- */
-    if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
-      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {
-      __pyx_t_2 = ((PyDict_Contains(((PyObject *)__pyx_v_result), __pyx_v_key))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    if (__pyx_t_2) {
-
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":51
- *         idx = index_buf[i]
- *         if key in result:
- *             members = result[key]             # <<<<<<<<<<<<<<
- *             members.append(idx)
- *         else:
- */
-      __pyx_t_4 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_result), __pyx_v_key); if (!__pyx_t_4) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      if (!(likely(PyList_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_4)->tp_name), 0))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = ((PyObject *)__pyx_t_4);
-      __pyx_t_4 = 0;
-
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":52
- *         if key in result:
- *             members = result[key]
- *             members.append(idx)             # <<<<<<<<<<<<<<
- *         else:
- *             result[key] = [idx]
- */
-      if (unlikely(__pyx_v_members == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_17 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      goto __pyx_L11;
-    }
-    /*else*/ {
-
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":54
- *             members.append(idx)
- *         else:
- *             result[key] = [idx]             # <<<<<<<<<<<<<<
- * 
- *     return result
- */
-      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-      __Pyx_INCREF(__pyx_v_idx);
-      PyList_SET_ITEM(__pyx_t_4, 0, __pyx_v_idx);
-      __Pyx_GIVEREF(__pyx_v_idx);
-      if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_key, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
-    }
-    __pyx_L11:;
-    __pyx_L8_continue:;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":56
- *             result[key] = [idx]
- * 
- *     return result             # <<<<<<<<<<<<<<
- * 
- * @cython.boundscheck(False)
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyObject *)__pyx_v_result);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupby");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_mapped_index);
-  __Pyx_DECREF((PyObject *)__pyx_v_index_buf);
-  __Pyx_DECREF((PyObject *)__pyx_v_mask);
-  __Pyx_DECREF(__pyx_v_members);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_nullkeys);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":59
- * 
- * @cython.boundscheck(False)
- * def groupby_indices(object index, object mapper):             # <<<<<<<<<<<<<<
- *     cdef dict result
- *     cdef ndarray[object, ndim=1] mapped_index
- */
-
-static PyObject *__pyx_pf_7tseries_groupby_indices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_groupby_indices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_6groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_6groupby = {__Pyx_NAMESTR("groupby"), (PyCFunction)__pyx_pf_7tseries_6groupby, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_6groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_index = 0;
   PyObject *__pyx_v_mapper = 0;
+  PyObject *__pyx_v_output = 0;
   PyObject *__pyx_v_result;
   PyArrayObject *__pyx_v_mapped_index;
+  PyArrayObject *__pyx_v_index_buf;
   PyArrayObject *__pyx_v_mask;
   int __pyx_v_i;
   int __pyx_v_length;
-  PyObject *__pyx_v_null_list;
+  PyObject *__pyx_v_members;
+  PyObject *__pyx_v_idx;
   PyObject *__pyx_v_key;
+  PyObject *__pyx_v_nullkeys;
+  Py_buffer __pyx_bstruct_index_buf;
+  Py_ssize_t __pyx_bstride_0_index_buf = 0;
+  Py_ssize_t __pyx_bshape_0_index_buf = 0;
   Py_buffer __pyx_bstruct_mask;
   Py_ssize_t __pyx_bstride_0_mask = 0;
   Py_ssize_t __pyx_bshape_0_mask = 0;
@@ -5044,28 +5016,32 @@ static PyObject *__pyx_pf_7tseries_groupby_indices(PyObject *__pyx_self, PyObjec
   Py_ssize_t __pyx_bstride_0_mapped_index = 0;
   Py_ssize_t __pyx_bshape_0_mapped_index = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
-  PyArrayObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
-  PyArrayObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  __pyx_t_5numpy_int8_t __pyx_t_13;
-  int __pyx_t_14;
+  PyObject *__pyx_t_10 = NULL;
+  PyArrayObject *__pyx_t_11 = NULL;
+  PyArrayObject *__pyx_t_12 = NULL;
+  int __pyx_t_13;
+  __pyx_t_5numpy_int8_t __pyx_t_14;
   int __pyx_t_15;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__mapper,0};
-  __Pyx_RefNannySetupContext("groupby_indices");
+  int __pyx_t_16;
+  int __pyx_t_17;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__mapper,&__pyx_n_s__output,0};
+  __Pyx_RefNannySetupContext("groupby");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)Py_None);
     switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -5080,345 +5056,421 @@ static PyObject *__pyx_pf_7tseries_groupby_indices(PyObject *__pyx_self, PyObjec
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mapper);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("groupby_indices", 1, 2, 2, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupby", 0, 2, 3, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      if (kw_args > 0) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+        if (value) { values[2] = value; kw_args--; }
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_indices") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_index = values[0];
     __pyx_v_mapper = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
+    __pyx_v_output = values[2];
   } else {
-    __pyx_v_index = PyTuple_GET_ITEM(__pyx_args, 0);
-    __pyx_v_mapper = PyTuple_GET_ITEM(__pyx_args, 1);
+    __pyx_v_output = ((PyObject *)Py_None);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3:
+      __pyx_v_output = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2:
+      __pyx_v_mapper = PyTuple_GET_ITEM(__pyx_args, 1);
+      __pyx_v_index = PyTuple_GET_ITEM(__pyx_args, 0);
+      break;
+      default: goto __pyx_L5_argtuple_error;
+    }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupby_indices", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("groupby", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupby_indices");
+  __Pyx_AddTraceback("tseries.groupby");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF(__pyx_v_index);
-  __pyx_v_result = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_result = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_index_buf = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_null_list = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_members = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
   __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_nullkeys = Py_None; __Pyx_INCREF(Py_None);
   __pyx_bstruct_mapped_index.buf = NULL;
+  __pyx_bstruct_index_buf.buf = NULL;
   __pyx_bstruct_mask.buf = NULL;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":67
- *     cdef object key
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":30
+ *     cdef object idx, key
  * 
  *     length = len(index)             # <<<<<<<<<<<<<<
  * 
- *     result = {}
+ *     if output is None:
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_index); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_length = __pyx_t_1;
+  __pyx_t_1 = __pyx_v_index;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_length = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":69
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":32
  *     length = len(index)
  * 
- *     result = {}             # <<<<<<<<<<<<<<
- *     index = np.asarray(index)
- *     mapped_index = arrmap(index, mapper)
+ *     if output is None:             # <<<<<<<<<<<<<<
+ *         result = {}
+ *     else:
  */
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  __Pyx_DECREF(((PyObject *)__pyx_v_result));
-  __pyx_v_result = __pyx_t_2;
-  __pyx_t_2 = 0;
+  __pyx_t_3 = (__pyx_v_output == Py_None);
+  if (__pyx_t_3) {
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":70
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":33
  * 
- *     result = {}
- *     index = np.asarray(index)             # <<<<<<<<<<<<<<
- *     mapped_index = arrmap(index, mapper)
+ *     if output is None:
+ *         result = {}             # <<<<<<<<<<<<<<
+ *     else:
+ *         result = <dict> output
+ */
+    __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+    __Pyx_DECREF(((PyObject *)__pyx_v_result));
+    __pyx_v_result = __pyx_t_1;
+    __pyx_t_1 = 0;
+    goto __pyx_L6;
+  }
+  /*else*/ {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":35
+ *         result = {}
+ *     else:
+ *         result = <dict> output             # <<<<<<<<<<<<<<
  * 
+ *     index_buf = np.asarray(index)
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__asarray); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_v_index);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_index);
-  __Pyx_GIVEREF(__pyx_v_index);
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_v_index);
-  __pyx_v_index = __pyx_t_4;
-  __pyx_t_4 = 0;
+    __Pyx_INCREF(((PyObject *)((PyObject*)__pyx_v_output)));
+    __Pyx_DECREF(((PyObject *)__pyx_v_result));
+    __pyx_v_result = ((PyObject*)__pyx_v_output);
+  }
+  __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":71
- *     result = {}
- *     index = np.asarray(index)
- *     mapped_index = arrmap(index, mapper)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":37
+ *         result = <dict> output
  * 
+ *     index_buf = np.asarray(index)             # <<<<<<<<<<<<<<
+ *     mapped_index = arrmap(index_buf, mapper)
  *     mask = isnullobj(mapped_index)
  */
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__asarray); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(__pyx_v_index);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_index);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_index);
   __Pyx_GIVEREF(__pyx_v_index);
-  __Pyx_INCREF(__pyx_v_mapper);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_mapper);
-  __Pyx_GIVEREF(__pyx_v_mapper);
-  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
+    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_index_buf, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_7 < 0)) {
+      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index_buf, (PyObject*)__pyx_v_index_buf, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
+        __Pyx_RaiseBufferFallbackError();
+      } else {
+        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+      }
+    }
+    __pyx_bstride_0_index_buf = __pyx_bstruct_index_buf.strides[0];
+    __pyx_bshape_0_index_buf = __pyx_bstruct_index_buf.shape[0];
+    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_t_6 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_index_buf));
+  __pyx_v_index_buf = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":38
+ * 
+ *     index_buf = np.asarray(index)
+ *     mapped_index = arrmap(index_buf, mapper)             # <<<<<<<<<<<<<<
+ *     mask = isnullobj(mapped_index)
+ *     nullkeys = index_buf[mask.astype(bool)]
+ */
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(((PyObject *)__pyx_v_index_buf));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_index_buf));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_index_buf));
+  __Pyx_INCREF(__pyx_v_mapper);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_mapper);
+  __Pyx_GIVEREF(__pyx_v_mapper);
+  __pyx_t_4 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_11 = ((PyArrayObject *)__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_6 < 0)) {
-      PyErr_Fetch(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
+    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_11, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_7 < 0)) {
+      PyErr_Fetch(&__pyx_t_10, &__pyx_t_9, &__pyx_t_8);
       if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_v_mapped_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
+        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_8);
         __Pyx_RaiseBufferFallbackError();
       } else {
-        PyErr_Restore(__pyx_t_7, __pyx_t_8, __pyx_t_9);
+        PyErr_Restore(__pyx_t_10, __pyx_t_9, __pyx_t_8);
       }
     }
     __pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
     __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
-    if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_t_5 = 0;
+  __pyx_t_11 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_v_mapped_index));
-  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_3);
-  __pyx_t_3 = 0;
+  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":73
- *     mapped_index = arrmap(index, mapper)
- * 
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":39
+ *     index_buf = np.asarray(index)
+ *     mapped_index = arrmap(index_buf, mapper)
  *     mask = isnullobj(mapped_index)             # <<<<<<<<<<<<<<
- * 
- *     if mask.astype(bool).any():
+ *     nullkeys = index_buf[mask.astype(bool)]
+ *     if len(nullkeys) > 0:
  */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnullobj); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnullobj); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(((PyObject *)__pyx_v_mapped_index));
-  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_mapped_index));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_mapped_index));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_mapped_index));
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_10 = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_5 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_t_10, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_6 < 0)) {
-      PyErr_Fetch(&__pyx_t_9, &__pyx_t_8, &__pyx_t_7);
+    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_7 < 0)) {
+      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
       if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_v_mask, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_7);
+        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
         __Pyx_RaiseBufferFallbackError();
       } else {
-        PyErr_Restore(__pyx_t_9, __pyx_t_8, __pyx_t_7);
+        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
       }
     }
     __pyx_bstride_0_mask = __pyx_bstruct_mask.strides[0];
     __pyx_bshape_0_mask = __pyx_bstruct_mask.shape[0];
-    if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_t_10 = 0;
+  __pyx_t_12 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_v_mask));
-  __pyx_v_mask = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
+  __pyx_v_mask = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":75
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":40
+ *     mapped_index = arrmap(index_buf, mapper)
  *     mask = isnullobj(mapped_index)
- * 
- *     if mask.astype(bool).any():             # <<<<<<<<<<<<<<
- *         null_list = []
- *         result[np.NaN] = null_list
+ *     nullkeys = index_buf[mask.astype(bool)]             # <<<<<<<<<<<<<<
+ *     if len(nullkeys) > 0:
+ *         result[np.NaN] = nullkeys
  */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(((PyObject*)&PyBool_Type));
-  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject*)&PyBool_Type));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)&PyBool_Type));
   __Pyx_GIVEREF(((PyObject*)&PyBool_Type));
-  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_GetItem(((PyObject *)__pyx_v_index_buf), __pyx_t_4); if (!__pyx_t_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__any); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__pyx_t_11) {
+  __Pyx_DECREF(__pyx_v_nullkeys);
+  __pyx_v_nullkeys = __pyx_t_1;
+  __pyx_t_1 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":76
- * 
- *     if mask.astype(bool).any():
- *         null_list = []             # <<<<<<<<<<<<<<
- *         result[np.NaN] = null_list
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":41
+ *     mask = isnullobj(mapped_index)
+ *     nullkeys = index_buf[mask.astype(bool)]
+ *     if len(nullkeys) > 0:             # <<<<<<<<<<<<<<
+ *         result[np.NaN] = nullkeys
  * 
  */
-    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-    __Pyx_DECREF(((PyObject *)__pyx_v_null_list));
-    __pyx_v_null_list = __pyx_t_3;
-    __pyx_t_3 = 0;
+  __pyx_t_2 = PyObject_Length(__pyx_v_nullkeys); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = (__pyx_t_2 > 0);
+  if (__pyx_t_3) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":77
- *     if mask.astype(bool).any():
- *         null_list = []
- *         result[np.NaN] = null_list             # <<<<<<<<<<<<<<
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":42
+ *     nullkeys = index_buf[mask.astype(bool)]
+ *     if len(nullkeys) > 0:
+ *         result[np.NaN] = nullkeys             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < length:
  */
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__NaN); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_t_2, ((PyObject *)__pyx_v_null_list)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    goto __pyx_L6;
+    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_4 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__NaN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_t_4, __pyx_v_nullkeys) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    goto __pyx_L7;
   }
-  __pyx_L6:;
+  __pyx_L7:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":79
- *         result[np.NaN] = null_list
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":44
+ *         result[np.NaN] = nullkeys
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
  *         if mask[i]:
- *             null_list.append(i)
+ *             continue
  */
-  __pyx_t_6 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_6; __pyx_v_i++) {
+  __pyx_t_7 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":80
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":45
  * 
  *     for i from 0 <= i < length:
  *         if mask[i]:             # <<<<<<<<<<<<<<
- *             null_list.append(i)
- *         key = mapped_index[i]
+ *             continue
+ * 
  */
-    __pyx_t_12 = __pyx_v_i;
-    if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_mask;
-    __pyx_t_13 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_12, __pyx_bstride_0_mask));
-    if (__pyx_t_13) {
+    __pyx_t_13 = __pyx_v_i;
+    if (__pyx_t_13 < 0) __pyx_t_13 += __pyx_bshape_0_mask;
+    __pyx_t_14 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_13, __pyx_bstride_0_mask));
+    if (__pyx_t_14) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":81
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":46
  *     for i from 0 <= i < length:
  *         if mask[i]:
- *             null_list.append(i)             # <<<<<<<<<<<<<<
+ *             continue             # <<<<<<<<<<<<<<
+ * 
  *         key = mapped_index[i]
- *         if key in result:
  */
-      if (unlikely(__pyx_v_null_list == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_2 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_14 = PyList_Append(((PyObject *)__pyx_v_null_list), __pyx_t_2); if (unlikely(__pyx_t_14 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      goto __pyx_L9;
+      goto __pyx_L8_continue;
+      goto __pyx_L10;
     }
-    __pyx_L9:;
+    __pyx_L10:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":82
- *         if mask[i]:
- *             null_list.append(i)
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":48
+ *             continue
+ * 
  *         key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *         idx = index_buf[i]
  *         if key in result:
- *             (<list> result[key]).append(i)
  */
-    __pyx_t_14 = __pyx_v_i;
-    if (__pyx_t_14 < 0) __pyx_t_14 += __pyx_bshape_0_mapped_index;
-    __pyx_t_2 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_14, __pyx_bstride_0_mapped_index);
-    __Pyx_INCREF((PyObject*)__pyx_t_2);
+    __pyx_t_15 = __pyx_v_i;
+    if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_mapped_index;
+    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_15, __pyx_bstride_0_mapped_index);
+    __Pyx_INCREF((PyObject*)__pyx_t_4);
     __Pyx_DECREF(__pyx_v_key);
-    __pyx_v_key = __pyx_t_2;
-    __pyx_t_2 = 0;
+    __pyx_v_key = __pyx_t_4;
+    __pyx_t_4 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":83
- *             null_list.append(i)
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":49
+ * 
+ *         key = mapped_index[i]
+ *         idx = index_buf[i]             # <<<<<<<<<<<<<<
+ *         if key in result:
+ *             members = result[key]
+ */
+    __pyx_t_16 = __pyx_v_i;
+    if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_index_buf;
+    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index_buf.buf, __pyx_t_16, __pyx_bstride_0_index_buf);
+    __Pyx_INCREF((PyObject*)__pyx_t_4);
+    __Pyx_DECREF(__pyx_v_idx);
+    __pyx_v_idx = __pyx_t_4;
+    __pyx_t_4 = 0;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":50
  *         key = mapped_index[i]
+ *         idx = index_buf[i]
  *         if key in result:             # <<<<<<<<<<<<<<
- *             (<list> result[key]).append(i)
- *         else:
+ *             members = result[key]
+ *             members.append(idx)
  */
-    if (unlikely(((PyObject *)__pyx_v_result) == Py_None)) {
-      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {
-      __pyx_t_11 = ((PyDict_Contains(((PyObject *)__pyx_v_result), __pyx_v_key))); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_v_result == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
     }
-    if (__pyx_t_11) {
+    __pyx_t_3 = ((PyDict_Contains(((PyObject *)__pyx_v_result), __pyx_v_key))); if (unlikely(__pyx_t_3 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__pyx_t_3) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":84
- *         key = mapped_index[i]
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":51
+ *         idx = index_buf[i]
  *         if key in result:
- *             (<list> result[key]).append(i)             # <<<<<<<<<<<<<<
+ *             members = result[key]             # <<<<<<<<<<<<<<
+ *             members.append(idx)
  *         else:
- *             result[key] = [i]
  */
-      __pyx_t_2 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_result), __pyx_v_key); if (!__pyx_t_2) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      if (unlikely(((PyObject *)__pyx_t_2) == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_15 = PyList_Append(((PyObject *)((PyObject *)__pyx_t_2)), __pyx_t_3); if (unlikely(__pyx_t_15 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      goto __pyx_L10;
-    }
-    /*else*/ {
-
-      /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":86
- *             (<list> result[key]).append(i)
+      __pyx_t_4 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_result), __pyx_v_key); if (!__pyx_t_4) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      if (!(likely(PyList_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_4)->tp_name), 0))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = ((PyObject*)__pyx_t_4);
+      __pyx_t_4 = 0;
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":52
+ *         if key in result:
+ *             members = result[key]
+ *             members.append(idx)             # <<<<<<<<<<<<<<
  *         else:
- *             result[key] = [i]             # <<<<<<<<<<<<<<
+ *             result[key] = [idx]
+ */
+      if (unlikely(__pyx_v_members == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_17 = PyList_Append(__pyx_v_members, __pyx_v_idx); if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      goto __pyx_L11;
+    }
+    /*else*/ {
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":54
+ *             members.append(idx)
+ *         else:
+ *             result[key] = [idx]             # <<<<<<<<<<<<<<
  * 
  *     return result
  */
-      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-      PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
-      __Pyx_GIVEREF(__pyx_t_3);
-      __pyx_t_3 = 0;
-      if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_key, ((PyObject *)__pyx_t_2)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+      __Pyx_INCREF(__pyx_v_idx);
+      PyList_SET_ITEM(__pyx_t_4, 0, __pyx_v_idx);
+      __Pyx_GIVEREF(__pyx_v_idx);
+      if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_key, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
     }
-    __pyx_L10:;
+    __pyx_L11:;
+    __pyx_L8_continue:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/groupby.pyx":88
- *             result[key] = [i]
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":56
+ *             result[key] = [idx]
  * 
  *     return result             # <<<<<<<<<<<<<<
+ * 
+ * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_result));
@@ -5428,69 +5480,80 @@ static PyObject *__pyx_pf_7tseries_groupby_indices(PyObject *__pyx_self, PyObjec
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupby_indices");
+  __Pyx_AddTraceback("tseries.groupby");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index_buf);
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
   __pyx_L2:;
   __Pyx_DECREF(__pyx_v_result);
   __Pyx_DECREF((PyObject *)__pyx_v_mapped_index);
+  __Pyx_DECREF((PyObject *)__pyx_v_index_buf);
   __Pyx_DECREF((PyObject *)__pyx_v_mask);
-  __Pyx_DECREF(__pyx_v_null_list);
+  __Pyx_DECREF(__pyx_v_members);
+  __Pyx_DECREF(__pyx_v_idx);
   __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_index);
+  __Pyx_DECREF(__pyx_v_nullkeys);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":28
- * 
+/* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":59
  * 
- * def kth_smallest(ndarray[double_t, ndim=1] a, int k):             # <<<<<<<<<<<<<<
- *     cdef:
- *         int i,j,l,m,n
+ * @cython.boundscheck(False)
+ * def groupby_indices(object index, object mapper):             # <<<<<<<<<<<<<<
+ *     cdef dict result
+ *     cdef ndarray[object, ndim=1] mapped_index
  */
 
-static PyObject *__pyx_pf_7tseries_kth_smallest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_kth_smallest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_a = 0;
-  int __pyx_v_k;
+static PyObject *__pyx_pf_7tseries_7groupby_indices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_7groupby_indices = {__Pyx_NAMESTR("groupby_indices"), (PyCFunction)__pyx_pf_7tseries_7groupby_indices, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_7groupby_indices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_mapper = 0;
+  PyObject *__pyx_v_result;
+  PyArrayObject *__pyx_v_mapped_index;
+  PyArrayObject *__pyx_v_mask;
   int __pyx_v_i;
-  int __pyx_v_j;
-  int __pyx_v_l;
-  int __pyx_v_m;
-  int __pyx_v_n;
-  __pyx_t_5numpy_double_t __pyx_v_x;
-  __pyx_t_5numpy_double_t __pyx_v_t;
-  Py_buffer __pyx_bstruct_a;
-  Py_ssize_t __pyx_bstride_0_a = 0;
-  Py_ssize_t __pyx_bshape_0_a = 0;
+  int __pyx_v_length;
+  PyObject *__pyx_v_null_list;
+  PyObject *__pyx_v_key;
+  Py_buffer __pyx_bstruct_mask;
+  Py_ssize_t __pyx_bstride_0_mask = 0;
+  Py_ssize_t __pyx_bshape_0_mask = 0;
+  Py_buffer __pyx_bstruct_mapped_index;
+  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
+  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  int __pyx_t_5;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyArrayObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
-  int __pyx_t_7;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyArrayObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
-  PyObject *__pyx_t_12 = NULL;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__a,&__pyx_n_s__k,0};
-  __Pyx_RefNannySetupContext("kth_smallest");
+  int __pyx_t_12;
+  __pyx_t_5numpy_int8_t __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__mapper,0};
+  __Pyx_RefNannySetupContext("groupby_indices");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
@@ -5503,629 +5566,1073 @@ static PyObject *__pyx_pf_7tseries_kth_smallest(PyObject *__pyx_self, PyObject *
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__a);
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__mapper);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("kth_smallest", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupby_indices", 1, 2, 2, 1); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "kth_smallest") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_indices") < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_a = ((PyArrayObject *)values[0]);
-    __pyx_v_k = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_k == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = values[0];
+    __pyx_v_mapper = values[1];
   } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_a = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_k = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_k == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = PyTuple_GET_ITEM(__pyx_args, 0);
+    __pyx_v_mapper = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("kth_smallest", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("groupby_indices", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.kth_smallest");
+  __Pyx_AddTraceback("tseries.groupby_indices");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_bstruct_a.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_a), __pyx_ptype_5numpy_ndarray, 1, "a", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_a, (PyObject*)__pyx_v_a, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_a = __pyx_bstruct_a.strides[0];
-  __pyx_bshape_0_a = __pyx_bstruct_a.shape[0];
+  __Pyx_INCREF(__pyx_v_index);
+  __pyx_v_result = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_null_list = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_bstruct_mapped_index.buf = NULL;
+  __pyx_bstruct_mask.buf = NULL;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":33
- *         double_t x, t
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":67
+ *     cdef object key
  * 
- *     n = len(a)             # <<<<<<<<<<<<<<
+ *     length = len(index)             # <<<<<<<<<<<<<<
  * 
- *     l = 0
+ *     result = {}
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_a)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
+  __pyx_t_1 = __pyx_v_index;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_length = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":35
- *     n = len(a)
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":69
+ *     length = len(index)
  * 
- *     l = 0             # <<<<<<<<<<<<<<
- *     m = n-1
- *     while (l<m):
+ *     result = {}             # <<<<<<<<<<<<<<
+ *     index = np.asarray(index)
+ *     mapped_index = arrmap(index, mapper)
  */
-  __pyx_v_l = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_DECREF(((PyObject *)__pyx_v_result));
+  __pyx_v_result = __pyx_t_1;
+  __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":36
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":70
+ * 
+ *     result = {}
+ *     index = np.asarray(index)             # <<<<<<<<<<<<<<
+ *     mapped_index = arrmap(index, mapper)
  * 
- *     l = 0
- *     m = n-1             # <<<<<<<<<<<<<<
- *     while (l<m):
- *         x = a[k]
- */
-  __pyx_v_m = (__pyx_v_n - 1);
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":37
- *     l = 0
- *     m = n-1
- *     while (l<m):             # <<<<<<<<<<<<<<
- *         x = a[k]
- *         i = l
  */
-  while (1) {
-    __pyx_t_2 = (__pyx_v_l < __pyx_v_m);
-    if (!__pyx_t_2) break;
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__asarray); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(__pyx_v_index);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_index);
+  __Pyx_GIVEREF(__pyx_v_index);
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_v_index);
+  __pyx_v_index = __pyx_t_4;
+  __pyx_t_4 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":38
- *     m = n-1
- *     while (l<m):
- *         x = a[k]             # <<<<<<<<<<<<<<
- *         i = l
- *         j = m
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":71
+ *     result = {}
+ *     index = np.asarray(index)
+ *     mapped_index = arrmap(index, mapper)             # <<<<<<<<<<<<<<
+ * 
+ *     mask = isnullobj(mapped_index)
  */
-    __pyx_t_3 = __pyx_v_k;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_a;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_a)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(__pyx_v_index);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_index);
+  __Pyx_GIVEREF(__pyx_v_index);
+  __Pyx_INCREF(__pyx_v_mapper);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_mapper);
+  __Pyx_GIVEREF(__pyx_v_mapper);
+  __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
+    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_6 < 0)) {
+      PyErr_Fetch(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
+      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_v_mapped_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
+        __Pyx_RaiseBufferFallbackError();
+      } else {
+        PyErr_Restore(__pyx_t_7, __pyx_t_8, __pyx_t_9);
+      }
     }
-    __pyx_v_x = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_3, __pyx_bstride_0_a));
+    __pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
+    __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
+    if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_t_5 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_mapped_index));
+  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_3);
+  __pyx_t_3 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":39
- *     while (l<m):
- *         x = a[k]
- *         i = l             # <<<<<<<<<<<<<<
- *         j = m
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":73
+ *     mapped_index = arrmap(index, mapper)
  * 
- */
-    __pyx_v_i = __pyx_v_l;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":40
- *         x = a[k]
- *         i = l
- *         j = m             # <<<<<<<<<<<<<<
+ *     mask = isnullobj(mapped_index)             # <<<<<<<<<<<<<<
  * 
- *         while 1:
+ *     if mask.astype(bool).any():
  */
-    __pyx_v_j = __pyx_v_m;
-
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":42
- *         j = m
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnullobj); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(((PyObject *)__pyx_v_mapped_index));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_mapped_index));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_mapped_index));
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_10 = ((PyArrayObject *)__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
+    __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_t_10, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_6 < 0)) {
+      PyErr_Fetch(&__pyx_t_9, &__pyx_t_8, &__pyx_t_7);
+      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mask, (PyObject*)__pyx_v_mask, &__Pyx_TypeInfo_nn___pyx_t_5numpy_int8_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_7);
+        __Pyx_RaiseBufferFallbackError();
+      } else {
+        PyErr_Restore(__pyx_t_9, __pyx_t_8, __pyx_t_7);
+      }
+    }
+    __pyx_bstride_0_mask = __pyx_bstruct_mask.strides[0];
+    __pyx_bshape_0_mask = __pyx_bstruct_mask.shape[0];
+    if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_t_10 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_mask));
+  __pyx_v_mask = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":75
+ *     mask = isnullobj(mapped_index)
  * 
- *         while 1:             # <<<<<<<<<<<<<<
- *             while a[i] < x: i += 1
- *             while x < a[j]: j -= 1
+ *     if mask.astype(bool).any():             # <<<<<<<<<<<<<<
+ *         null_list = []
+ *         result[np.NaN] = null_list
  */
-    while (1) {
-      if (!1) break;
+  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(((PyObject*)&PyBool_Type));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject*)&PyBool_Type));
+  __Pyx_GIVEREF(((PyObject*)&PyBool_Type));
+  __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__any); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (__pyx_t_11) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":43
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":76
+ * 
+ *     if mask.astype(bool).any():
+ *         null_list = []             # <<<<<<<<<<<<<<
+ *         result[np.NaN] = null_list
  * 
- *         while 1:
- *             while a[i] < x: i += 1             # <<<<<<<<<<<<<<
- *             while x < a[j]: j -= 1
- *             if i <= j:
  */
-      while (1) {
-        __pyx_t_4 = __pyx_v_i;
-        __pyx_t_5 = -1;
-        if (__pyx_t_4 < 0) {
-          __pyx_t_4 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-        } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_a)) __pyx_t_5 = 0;
-        if (unlikely(__pyx_t_5 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_5);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        __pyx_t_2 = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_4, __pyx_bstride_0_a)) < __pyx_v_x);
-        if (!__pyx_t_2) break;
-        __pyx_v_i += 1;
-      }
+    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+    __Pyx_DECREF(((PyObject *)__pyx_v_null_list));
+    __pyx_v_null_list = __pyx_t_3;
+    __pyx_t_3 = 0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":44
- *         while 1:
- *             while a[i] < x: i += 1
- *             while x < a[j]: j -= 1             # <<<<<<<<<<<<<<
- *             if i <= j:
- *                 t = a[i]
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":77
+ *     if mask.astype(bool).any():
+ *         null_list = []
+ *         result[np.NaN] = null_list             # <<<<<<<<<<<<<<
+ * 
+ *     for i from 0 <= i < length:
  */
-      while (1) {
-        __pyx_t_5 = __pyx_v_j;
-        __pyx_t_6 = -1;
-        if (__pyx_t_5 < 0) {
-          __pyx_t_5 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_5 < 0)) __pyx_t_6 = 0;
-        } else if (unlikely(__pyx_t_5 >= __pyx_bshape_0_a)) __pyx_t_6 = 0;
-        if (unlikely(__pyx_t_6 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_6);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        __pyx_t_2 = (__pyx_v_x < (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_5, __pyx_bstride_0_a)));
-        if (!__pyx_t_2) break;
-        __pyx_v_j -= 1;
-      }
+    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__NaN); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_t_1, ((PyObject *)__pyx_v_null_list)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    goto __pyx_L6;
+  }
+  __pyx_L6:;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":45
- *             while a[i] < x: i += 1
- *             while x < a[j]: j -= 1
- *             if i <= j:             # <<<<<<<<<<<<<<
- *                 t = a[i]
- *                 a[i] = a[j]
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":79
+ *         result[np.NaN] = null_list
+ * 
+ *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
+ *         if mask[i]:
+ *             null_list.append(i)
  */
-      __pyx_t_2 = (__pyx_v_i <= __pyx_v_j);
-      if (__pyx_t_2) {
+  __pyx_t_6 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_6; __pyx_v_i++) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":46
- *             while x < a[j]: j -= 1
- *             if i <= j:
- *                 t = a[i]             # <<<<<<<<<<<<<<
- *                 a[i] = a[j]
- *                 a[j] = t
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":80
+ * 
+ *     for i from 0 <= i < length:
+ *         if mask[i]:             # <<<<<<<<<<<<<<
+ *             null_list.append(i)
+ *         key = mapped_index[i]
  */
-        __pyx_t_6 = __pyx_v_i;
-        __pyx_t_7 = -1;
-        if (__pyx_t_6 < 0) {
-          __pyx_t_6 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-        } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_a)) __pyx_t_7 = 0;
-        if (unlikely(__pyx_t_7 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_7);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        __pyx_v_t = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_6, __pyx_bstride_0_a));
+    __pyx_t_12 = __pyx_v_i;
+    if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_mask;
+    __pyx_t_13 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_12, __pyx_bstride_0_mask));
+    if (__pyx_t_13) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":47
- *             if i <= j:
- *                 t = a[i]
- *                 a[i] = a[j]             # <<<<<<<<<<<<<<
- *                 a[j] = t
- *                 i += 1; j -= 1
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":81
+ *     for i from 0 <= i < length:
+ *         if mask[i]:
+ *             null_list.append(i)             # <<<<<<<<<<<<<<
+ *         key = mapped_index[i]
+ *         if key in result:
  */
-        __pyx_t_7 = __pyx_v_j;
-        __pyx_t_8 = -1;
-        if (__pyx_t_7 < 0) {
-          __pyx_t_7 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-        } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_a)) __pyx_t_8 = 0;
-        if (unlikely(__pyx_t_8 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_8);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        __pyx_t_8 = __pyx_v_i;
-        __pyx_t_9 = -1;
-        if (__pyx_t_8 < 0) {
-          __pyx_t_8 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
-        } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_a)) __pyx_t_9 = 0;
-        if (unlikely(__pyx_t_9 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_9);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_8, __pyx_bstride_0_a) = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_7, __pyx_bstride_0_a));
+      if (unlikely(__pyx_v_null_list == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_1 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_14 = PyList_Append(__pyx_v_null_list, __pyx_t_1); if (unlikely(__pyx_t_14 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      goto __pyx_L9;
+    }
+    __pyx_L9:;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":48
- *                 t = a[i]
- *                 a[i] = a[j]
- *                 a[j] = t             # <<<<<<<<<<<<<<
- *                 i += 1; j -= 1
- * 
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":82
+ *         if mask[i]:
+ *             null_list.append(i)
+ *         key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *         if key in result:
+ *             (<list> result[key]).append(i)
  */
-        __pyx_t_9 = __pyx_v_j;
-        __pyx_t_10 = -1;
-        if (__pyx_t_9 < 0) {
-          __pyx_t_9 += __pyx_bshape_0_a;
-          if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
-        } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_a)) __pyx_t_10 = 0;
-        if (unlikely(__pyx_t_10 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_10);
-          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_9, __pyx_bstride_0_a) = __pyx_v_t;
+    __pyx_t_14 = __pyx_v_i;
+    if (__pyx_t_14 < 0) __pyx_t_14 += __pyx_bshape_0_mapped_index;
+    __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_14, __pyx_bstride_0_mapped_index);
+    __Pyx_INCREF((PyObject*)__pyx_t_1);
+    __Pyx_DECREF(__pyx_v_key);
+    __pyx_v_key = __pyx_t_1;
+    __pyx_t_1 = 0;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":49
- *                 a[i] = a[j]
- *                 a[j] = t
- *                 i += 1; j -= 1             # <<<<<<<<<<<<<<
- * 
- *             if i > j: break
+    /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":83
+ *             null_list.append(i)
+ *         key = mapped_index[i]
+ *         if key in result:             # <<<<<<<<<<<<<<
+ *             (<list> result[key]).append(i)
+ *         else:
  */
-        __pyx_v_i += 1;
-        __pyx_v_j -= 1;
-        goto __pyx_L14;
-      }
-      __pyx_L14:;
+    if (unlikely(__pyx_v_result == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+    }
+    __pyx_t_11 = ((PyDict_Contains(((PyObject *)__pyx_v_result), __pyx_v_key))); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (__pyx_t_11) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":51
- *                 i += 1; j -= 1
- * 
- *             if i > j: break             # <<<<<<<<<<<<<<
- * 
- *         if j < k: l = i
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":84
+ *         key = mapped_index[i]
+ *         if key in result:
+ *             (<list> result[key]).append(i)             # <<<<<<<<<<<<<<
+ *         else:
+ *             result[key] = [i]
  */
-      __pyx_t_2 = (__pyx_v_i > __pyx_v_j);
-      if (__pyx_t_2) {
-        goto __pyx_L9_break;
-        goto __pyx_L15;
+      __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_result), __pyx_v_key); if (!__pyx_t_1) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      if (unlikely(((PyObject*)__pyx_t_1) == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
       }
-      __pyx_L15:;
+      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_15 = PyList_Append(((PyObject*)__pyx_t_1), __pyx_t_3); if (unlikely(__pyx_t_15 == -1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      goto __pyx_L10;
     }
-    __pyx_L9_break:;
+    /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":53
- *             if i > j: break
+      /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":86
+ *             (<list> result[key]).append(i)
+ *         else:
+ *             result[key] = [i]             # <<<<<<<<<<<<<<
  * 
- *         if j < k: l = i             # <<<<<<<<<<<<<<
- *         if k < i: m = j
- *     return a[k]
+ *     return result
  */
-    __pyx_t_2 = (__pyx_v_j < __pyx_v_k);
-    if (__pyx_t_2) {
-      __pyx_v_l = __pyx_v_i;
-      goto __pyx_L16;
+      __pyx_t_3 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
+      __Pyx_GIVEREF(__pyx_t_3);
+      __pyx_t_3 = 0;
+      if (PyDict_SetItem(((PyObject *)__pyx_v_result), __pyx_v_key, ((PyObject *)__pyx_t_1)) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
     }
-    __pyx_L16:;
+    __pyx_L10:;
+  }
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":54
- * 
- *         if j < k: l = i
- *         if k < i: m = j             # <<<<<<<<<<<<<<
- *     return a[k]
- * 
- */
-    __pyx_t_2 = (__pyx_v_k < __pyx_v_i);
-    if (__pyx_t_2) {
-      __pyx_v_m = __pyx_v_j;
-      goto __pyx_L17;
-    }
-    __pyx_L17:;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":55
- *         if j < k: l = i
- *         if k < i: m = j
- *     return a[k]             # <<<<<<<<<<<<<<
- * 
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":88
+ *             result[key] = [i]
  * 
+ *     return result             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_10 = __pyx_v_k;
-  __pyx_t_11 = -1;
-  if (__pyx_t_10 < 0) {
-    __pyx_t_10 += __pyx_bshape_0_a;
-    if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
-  } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_a)) __pyx_t_11 = 0;
-  if (unlikely(__pyx_t_11 != -1)) {
-    __Pyx_RaiseBufferIndexError(__pyx_t_11);
-    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_12 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_10, __pyx_bstride_0_a))); if (unlikely(!__pyx_t_12)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_12);
-  __pyx_r = __pyx_t_12;
-  __pyx_t_12 = 0;
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_a);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.kth_smallest");
+  __Pyx_AddTraceback("tseries.groupby_indices");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_a);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
   __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_result);
+  __Pyx_DECREF((PyObject *)__pyx_v_mapped_index);
+  __Pyx_DECREF((PyObject *)__pyx_v_mask);
+  __Pyx_DECREF(__pyx_v_null_list);
+  __Pyx_DECREF(__pyx_v_key);
+  __Pyx_DECREF(__pyx_v_index);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":58
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":28
  * 
  * 
- * def median(ndarray arr):             # <<<<<<<<<<<<<<
- *     '''
- *     A faster median
+ * def kth_smallest(ndarray[double_t, ndim=1] a, int k):             # <<<<<<<<<<<<<<
+ *     cdef:
+ *         int i,j,l,m,n
  */
 
-static PyObject *__pyx_pf_7tseries_median(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
-static char __pyx_doc_7tseries_median[] = "\n    A faster median\n    ";
-static PyObject *__pyx_pf_7tseries_median(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
+static PyObject *__pyx_pf_7tseries_8kth_smallest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_8kth_smallest = {__Pyx_NAMESTR("kth_smallest"), (PyCFunction)__pyx_pf_7tseries_8kth_smallest, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_8kth_smallest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_a = 0;
+  int __pyx_v_k;
+  int __pyx_v_i;
+  int __pyx_v_j;
+  int __pyx_v_l;
+  int __pyx_v_m;
   int __pyx_v_n;
+  __pyx_t_5numpy_double_t __pyx_v_x;
+  __pyx_t_5numpy_double_t __pyx_v_t;
+  Py_buffer __pyx_bstruct_a;
+  Py_ssize_t __pyx_bstride_0_a = 0;
+  Py_ssize_t __pyx_bshape_0_a = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  long __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  __Pyx_RefNannySetupContext("median");
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  int __pyx_t_3;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  int __pyx_t_6;
+  int __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__a,&__pyx_n_s__k,0};
+  __Pyx_RefNannySetupContext("kth_smallest");
   __pyx_self = __pyx_self;
-  __Pyx_INCREF((PyObject *)__pyx_v_arr);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[2] = {0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__a);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__k);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("kth_smallest", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "kth_smallest") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_a = ((PyArrayObject *)values[0]);
+    __pyx_v_k = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_k == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_a = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_k = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_k == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("kth_smallest", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.kth_smallest");
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_bstruct_a.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_a), __pyx_ptype_5numpy_ndarray, 1, "a", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_a, (PyObject*)__pyx_v_a, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_a = __pyx_bstruct_a.strides[0];
+  __pyx_bshape_0_a = __pyx_bstruct_a.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":62
- *     A faster median
- *     '''
- *     cdef int n = len(arr)             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":33
+ *         double_t x, t
  * 
- *     if len(arr) == 0:
+ *     n = len(a)             # <<<<<<<<<<<<<<
+ * 
+ *     l = 0
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_a);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_n = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":64
- *     cdef int n = len(arr)
- * 
- *     if len(arr) == 0:             # <<<<<<<<<<<<<<
- *         return np.NaN
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":35
+ *     n = len(a)
  * 
+ *     l = 0             # <<<<<<<<<<<<<<
+ *     m = n-1
+ *     while (l<m):
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = (__pyx_t_1 == 0);
-  if (__pyx_t_2) {
+  __pyx_v_l = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":65
- * 
- *     if len(arr) == 0:
- *         return np.NaN             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":36
  * 
- *     arr = arr.copy()
+ *     l = 0
+ *     m = n-1             # <<<<<<<<<<<<<<
+ *     while (l<m):
+ *         x = a[k]
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__NaN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-    goto __pyx_L5;
-  }
-  __pyx_L5:;
+  __pyx_v_m = (__pyx_v_n - 1);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":67
- *         return np.NaN
- * 
- *     arr = arr.copy()             # <<<<<<<<<<<<<<
- * 
- *     if n % 2:
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":37
+ *     l = 0
+ *     m = n-1
+ *     while (l<m):             # <<<<<<<<<<<<<<
+ *         x = a[k]
+ *         i = l
  */
-  __pyx_t_4 = PyObject_GetAttr(__pyx_v_arr, __pyx_n_s__copy); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_v_arr);
-  __pyx_v_arr = __pyx_t_3;
-  __pyx_t_3 = 0;
+  while (1) {
+    __pyx_t_3 = (__pyx_v_l < __pyx_v_m);
+    if (!__pyx_t_3) break;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":69
- *     arr = arr.copy()
- * 
- *     if n % 2:             # <<<<<<<<<<<<<<
- *         return kth_smallest(arr, n / 2)
- *     else:
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":38
+ *     m = n-1
+ *     while (l<m):
+ *         x = a[k]             # <<<<<<<<<<<<<<
+ *         i = l
+ *         j = m
  */
-  __pyx_t_5 = __Pyx_mod_long(__pyx_v_n, 2);
-  if (__pyx_t_5) {
+    __pyx_t_4 = __pyx_v_k;
+    __pyx_t_5 = -1;
+    if (__pyx_t_4 < 0) {
+      __pyx_t_4 += __pyx_bshape_0_a;
+      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
+    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_a)) __pyx_t_5 = 0;
+    if (unlikely(__pyx_t_5 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_5);
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_x = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_4, __pyx_bstride_0_a));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":70
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":39
+ *     while (l<m):
+ *         x = a[k]
+ *         i = l             # <<<<<<<<<<<<<<
+ *         j = m
  * 
- *     if n % 2:
- *         return kth_smallest(arr, n / 2)             # <<<<<<<<<<<<<<
- *     else:
- *         return (kth_smallest(arr, n / 2) +
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyInt_FromLong(__Pyx_div_long(__pyx_v_n, 2)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_INCREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_arr);
-    __Pyx_GIVEREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
-    __Pyx_GIVEREF(__pyx_t_4);
-    __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-    goto __pyx_L6;
-  }
-  /*else*/ {
+    __pyx_v_i = __pyx_v_l;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":72
- *         return kth_smallest(arr, n / 2)
- *     else:
- *         return (kth_smallest(arr, n / 2) +             # <<<<<<<<<<<<<<
- *                 kth_smallest(arr, n / 2 - 1)) / 2
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":40
+ *         x = a[k]
+ *         i = l
+ *         j = m             # <<<<<<<<<<<<<<
  * 
+ *         while 1:
  */
-    __Pyx_XDECREF(__pyx_r);
+    __pyx_v_j = __pyx_v_m;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":73
- *     else:
- *         return (kth_smallest(arr, n / 2) +
- *                 kth_smallest(arr, n / 2 - 1)) / 2             # <<<<<<<<<<<<<<
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":42
+ *         j = m
  * 
- * #-------------------------------------------------------------------------------
+ *         while 1:             # <<<<<<<<<<<<<<
+ *             while a[i] < x: i += 1
+ *             while x < a[j]: j -= 1
  */
-    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    while (1) {
+      if (!1) break;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":72
- *         return kth_smallest(arr, n / 2)
- *     else:
- *         return (kth_smallest(arr, n / 2) +             # <<<<<<<<<<<<<<
- *                 kth_smallest(arr, n / 2 - 1)) / 2
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":43
  * 
+ *         while 1:
+ *             while a[i] < x: i += 1             # <<<<<<<<<<<<<<
+ *             while x < a[j]: j -= 1
+ *             if i <= j:
  */
-    __pyx_t_6 = PyInt_FromLong(__Pyx_div_long(__pyx_v_n, 2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_INCREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_arr);
-    __Pyx_GIVEREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_6);
-    __Pyx_GIVEREF(__pyx_t_6);
-    __pyx_t_6 = 0;
-    __pyx_t_6 = PyObject_Call(__pyx_t_4, __pyx_t_3, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      while (1) {
+        __pyx_t_5 = __pyx_v_i;
+        __pyx_t_6 = -1;
+        if (__pyx_t_5 < 0) {
+          __pyx_t_5 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_5 < 0)) __pyx_t_6 = 0;
+        } else if (unlikely(__pyx_t_5 >= __pyx_bshape_0_a)) __pyx_t_6 = 0;
+        if (unlikely(__pyx_t_6 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_6);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        __pyx_t_3 = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_5, __pyx_bstride_0_a)) < __pyx_v_x);
+        if (!__pyx_t_3) break;
+        __pyx_v_i = (__pyx_v_i + 1);
+      }
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":73
- *     else:
- *         return (kth_smallest(arr, n / 2) +
- *                 kth_smallest(arr, n / 2 - 1)) / 2             # <<<<<<<<<<<<<<
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":44
+ *         while 1:
+ *             while a[i] < x: i += 1
+ *             while x < a[j]: j -= 1             # <<<<<<<<<<<<<<
+ *             if i <= j:
+ *                 t = a[i]
+ */
+      while (1) {
+        __pyx_t_6 = __pyx_v_j;
+        __pyx_t_7 = -1;
+        if (__pyx_t_6 < 0) {
+          __pyx_t_6 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
+        } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_a)) __pyx_t_7 = 0;
+        if (unlikely(__pyx_t_7 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_7);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        __pyx_t_3 = (__pyx_v_x < (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_6, __pyx_bstride_0_a)));
+        if (!__pyx_t_3) break;
+        __pyx_v_j = (__pyx_v_j - 1);
+      }
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":45
+ *             while a[i] < x: i += 1
+ *             while x < a[j]: j -= 1
+ *             if i <= j:             # <<<<<<<<<<<<<<
+ *                 t = a[i]
+ *                 a[i] = a[j]
+ */
+      __pyx_t_3 = (__pyx_v_i <= __pyx_v_j);
+      if (__pyx_t_3) {
+
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":46
+ *             while x < a[j]: j -= 1
+ *             if i <= j:
+ *                 t = a[i]             # <<<<<<<<<<<<<<
+ *                 a[i] = a[j]
+ *                 a[j] = t
+ */
+        __pyx_t_7 = __pyx_v_i;
+        __pyx_t_8 = -1;
+        if (__pyx_t_7 < 0) {
+          __pyx_t_7 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
+        } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_a)) __pyx_t_8 = 0;
+        if (unlikely(__pyx_t_8 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_8);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        __pyx_v_t = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_7, __pyx_bstride_0_a));
+
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":47
+ *             if i <= j:
+ *                 t = a[i]
+ *                 a[i] = a[j]             # <<<<<<<<<<<<<<
+ *                 a[j] = t
+ *                 i += 1; j -= 1
+ */
+        __pyx_t_8 = __pyx_v_j;
+        __pyx_t_9 = -1;
+        if (__pyx_t_8 < 0) {
+          __pyx_t_8 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
+        } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_a)) __pyx_t_9 = 0;
+        if (unlikely(__pyx_t_9 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_9);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        __pyx_t_9 = __pyx_v_i;
+        __pyx_t_10 = -1;
+        if (__pyx_t_9 < 0) {
+          __pyx_t_9 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+        } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_a)) __pyx_t_10 = 0;
+        if (unlikely(__pyx_t_10 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_10);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_9, __pyx_bstride_0_a) = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_8, __pyx_bstride_0_a));
+
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":48
+ *                 t = a[i]
+ *                 a[i] = a[j]
+ *                 a[j] = t             # <<<<<<<<<<<<<<
+ *                 i += 1; j -= 1
  * 
- * #-------------------------------------------------------------------------------
  */
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyInt_FromLong((__Pyx_div_long(__pyx_v_n, 2) - 1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_INCREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_arr);
-    __Pyx_GIVEREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
-    __Pyx_GIVEREF(__pyx_t_4);
-    __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_7, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
+        __pyx_t_10 = __pyx_v_j;
+        __pyx_t_11 = -1;
+        if (__pyx_t_10 < 0) {
+          __pyx_t_10 += __pyx_bshape_0_a;
+          if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+        } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_a)) __pyx_t_11 = 0;
+        if (unlikely(__pyx_t_11 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_11);
+          {__pyx_filename = __pyx_f[5]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_10, __pyx_bstride_0_a) = __pyx_v_t;
+
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":49
+ *                 a[i] = a[j]
+ *                 a[j] = t
+ *                 i += 1; j -= 1             # <<<<<<<<<<<<<<
+ * 
+ *             if i > j: break
+ */
+        __pyx_v_i = (__pyx_v_i + 1);
+        __pyx_v_j = (__pyx_v_j - 1);
+        goto __pyx_L14;
+      }
+      __pyx_L14:;
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":51
+ *                 i += 1; j -= 1
+ * 
+ *             if i > j: break             # <<<<<<<<<<<<<<
+ * 
+ *         if j < k: l = i
+ */
+      __pyx_t_3 = (__pyx_v_i > __pyx_v_j);
+      if (__pyx_t_3) {
+        goto __pyx_L9_break;
+        goto __pyx_L15;
+      }
+      __pyx_L15:;
+    }
+    __pyx_L9_break:;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":53
+ *             if i > j: break
+ * 
+ *         if j < k: l = i             # <<<<<<<<<<<<<<
+ *         if k < i: m = j
+ *     return a[k]
+ */
+    __pyx_t_3 = (__pyx_v_j < __pyx_v_k);
+    if (__pyx_t_3) {
+      __pyx_v_l = __pyx_v_i;
+      goto __pyx_L16;
+    }
+    __pyx_L16:;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":54
+ * 
+ *         if j < k: l = i
+ *         if k < i: m = j             # <<<<<<<<<<<<<<
+ *     return a[k]
+ * 
+ */
+    __pyx_t_3 = (__pyx_v_k < __pyx_v_i);
+    if (__pyx_t_3) {
+      __pyx_v_m = __pyx_v_j;
+      goto __pyx_L17;
+    }
+    __pyx_L17:;
   }
-  __pyx_L6:;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":55
+ *         if j < k: l = i
+ *         if k < i: m = j
+ *     return a[k]             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_11 = __pyx_v_k;
+  __pyx_t_12 = -1;
+  if (__pyx_t_11 < 0) {
+    __pyx_t_11 += __pyx_bshape_0_a;
+    if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
+  } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_a)) __pyx_t_12 = 0;
+  if (unlikely(__pyx_t_12 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_12);
+    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_a.buf, __pyx_t_11, __pyx_bstride_0_a))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("tseries.median");
+  __Pyx_XDECREF(__pyx_t_1);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_a);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.kth_smallest");
   __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_arr);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_a);
+  __pyx_L2:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":78
- * # Rolling sum
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":58
  * 
- * def roll_sum(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *               int win, int minp):
- *     cdef double val, prev, sum_x = 0
+ * 
+ * def median(ndarray arr):             # <<<<<<<<<<<<<<
+ *     '''
+ *     A faster median
  */
 
-static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_input = 0;
-  int __pyx_v_win;
-  int __pyx_v_minp;
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  int __pyx_v_nobs;
-  int __pyx_v_i;
-  int __pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
-  Py_buffer __pyx_bstruct_output;
-  Py_ssize_t __pyx_bstride_0_output = 0;
-  Py_ssize_t __pyx_bshape_0_output = 0;
-  Py_buffer __pyx_bstruct_input;
-  Py_ssize_t __pyx_bstride_0_input = 0;
-  Py_ssize_t __pyx_bshape_0_input = 0;
+static PyObject *__pyx_pf_7tseries_9median(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
+static char __pyx_doc_7tseries_9median[] = "\n    A faster median\n    ";
+static PyMethodDef __pyx_mdef_7tseries_9median = {__Pyx_NAMESTR("median"), (PyCFunction)__pyx_pf_7tseries_9median, METH_O, __Pyx_DOCSTR(__pyx_doc_7tseries_9median)};
+static PyObject *__pyx_pf_7tseries_9median(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
+  int __pyx_v_n;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  long __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  int __pyx_t_13;
-  int __pyx_t_14;
-  int __pyx_t_15;
-  int __pyx_t_16;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
-  __Pyx_RefNannySetupContext("roll_sum");
+  long __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  __Pyx_RefNannySetupContext("median");
   __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
+  __Pyx_INCREF((PyObject *)__pyx_v_arr);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":62
+ *     A faster median
+ *     '''
+ *     cdef int n = len(arr)             # <<<<<<<<<<<<<<
+ * 
+ *     if len(arr) == 0:
+ */
+  __pyx_t_1 = __pyx_v_arr;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_n = __pyx_t_2;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":64
+ *     cdef int n = len(arr)
+ * 
+ *     if len(arr) == 0:             # <<<<<<<<<<<<<<
+ *         return np.NaN
+ * 
+ */
+  __pyx_t_1 = __pyx_v_arr;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_3 = (__pyx_t_2 == 0);
+  if (__pyx_t_3) {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":65
+ * 
+ *     if len(arr) == 0:
+ *         return np.NaN             # <<<<<<<<<<<<<<
+ * 
+ *     arr = arr.copy()
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_4 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__NaN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+    goto __pyx_L5;
+  }
+  __pyx_L5:;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":67
+ *         return np.NaN
+ * 
+ *     arr = arr.copy()             # <<<<<<<<<<<<<<
+ * 
+ *     if n % 2:
+ */
+  __pyx_t_4 = PyObject_GetAttr(__pyx_v_arr, __pyx_n_s__copy); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_v_arr);
+  __pyx_v_arr = __pyx_t_1;
+  __pyx_t_1 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":69
+ *     arr = arr.copy()
+ * 
+ *     if n % 2:             # <<<<<<<<<<<<<<
+ *         return kth_smallest(arr, n / 2)
+ *     else:
+ */
+  __pyx_t_5 = __Pyx_mod_long(__pyx_v_n, 2);
+  if (__pyx_t_5) {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":70
+ * 
+ *     if n % 2:
+ *         return kth_smallest(arr, n / 2)             # <<<<<<<<<<<<<<
+ *     else:
+ *         return (kth_smallest(arr, n / 2) +
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_4 = PyInt_FromLong(__Pyx_div_long(__pyx_v_n, 2)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_6));
+    __Pyx_INCREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_arr);
+    __Pyx_GIVEREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_4);
+    __pyx_t_4 = 0;
+    __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+    goto __pyx_L6;
+  }
+  /*else*/ {
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":72
+ *         return kth_smallest(arr, n / 2)
+ *     else:
+ *         return (kth_smallest(arr, n / 2) +             # <<<<<<<<<<<<<<
+ *                 kth_smallest(arr, n / 2 - 1)) / 2
+ * 
+ */
+    __Pyx_XDECREF(__pyx_r);
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":73
+ *     else:
+ *         return (kth_smallest(arr, n / 2) +
+ *                 kth_smallest(arr, n / 2 - 1)) / 2             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":72
+ *         return kth_smallest(arr, n / 2)
+ *     else:
+ *         return (kth_smallest(arr, n / 2) +             # <<<<<<<<<<<<<<
+ *                 kth_smallest(arr, n / 2 - 1)) / 2
+ * 
+ */
+    __pyx_t_6 = PyInt_FromLong(__Pyx_div_long(__pyx_v_n, 2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+    __Pyx_INCREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_arr);
+    __Pyx_GIVEREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
+    __Pyx_GIVEREF(__pyx_t_6);
+    __pyx_t_6 = 0;
+    __pyx_t_6 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":73
+ *     else:
+ *         return (kth_smallest(arr, n / 2) +
+ *                 kth_smallest(arr, n / 2 - 1)) / 2             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__kth_smallest); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_4 = PyInt_FromLong((__Pyx_div_long(__pyx_v_n, 2) - 1)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_7));
+    __Pyx_INCREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_arr);
+    __Pyx_GIVEREF(__pyx_v_arr);
+    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_4);
+    __pyx_t_4 = 0;
+    __pyx_t_4 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_7), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
+    __pyx_t_7 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+  }
+  __pyx_L6:;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("tseries.median");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_DECREF((PyObject *)__pyx_v_arr);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":78
+ * # Rolling sum
+ * 
+ * def roll_sum(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0
+ */
+
+static PyObject *__pyx_pf_7tseries_10roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_10roll_sum = {__Pyx_NAMESTR("roll_sum"), (PyCFunction)__pyx_pf_7tseries_10roll_sum, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_10roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  int __pyx_v_win;
+  int __pyx_v_minp;
+  double __pyx_v_val;
+  double __pyx_v_prev;
+  double __pyx_v_sum_x;
+  int __pyx_v_nobs;
+  int __pyx_v_i;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
+  Py_buffer __pyx_bstruct_output;
+  Py_ssize_t __pyx_bstride_0_output = 0;
+  Py_ssize_t __pyx_bshape_0_output = 0;
+  Py_buffer __pyx_bstruct_input;
+  Py_ssize_t __pyx_bstride_0_input = 0;
+  Py_ssize_t __pyx_bshape_0_input = 0;
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("roll_sum");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[3] = {0,0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
       values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
@@ -6173,7 +6680,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":80
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":80
  * def roll_sum(ndarray[double_t, ndim=1] input,
  *               int win, int minp):
  *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
@@ -6182,7 +6689,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
  */
   __pyx_v_sum_x = 0.0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":81
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":81
  *               int win, int minp):
  *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
@@ -6191,43 +6698,46 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
  */
   __pyx_v_nobs = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":82
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":82
  *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":84
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":84
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     if minp > N:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -6243,7 +6753,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":86
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":86
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -6253,7 +6763,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":87
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":87
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -6265,7 +6775,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":89
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":89
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -6275,7 +6785,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":90
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":90
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -6294,7 +6804,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":93
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":93
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -6304,28 +6814,28 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":94
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":94
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":95
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":95
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":97
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":97
  *             sum_x += val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -6345,7 +6855,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":99
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":99
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -6355,7 +6865,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":100
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":100
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -6374,7 +6884,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":102
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":102
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -6384,7 +6894,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":103
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":103
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -6403,7 +6913,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":104
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":104
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -6413,23 +6923,23 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":105
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":105
  *             prev = input[i - win]
  *             if prev == prev:
  *                 sum_x -= prev             # <<<<<<<<<<<<<<
  *                 nobs -= 1
  * 
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+        __pyx_v_sum_x = (__pyx_v_sum_x - __pyx_v_prev);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":106
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":106
  *             if prev == prev:
  *                 sum_x -= prev
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1;
+        __pyx_v_nobs = (__pyx_v_nobs - 1);
         goto __pyx_L13;
       }
       __pyx_L13:;
@@ -6437,7 +6947,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":108
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":108
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -6447,28 +6957,28 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":109
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":109
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":110
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":110
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":112
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":112
  *             sum_x += val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -6478,7 +6988,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":113
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":113
  * 
  *         if nobs >= minp:
  *             output[i] = sum_x             # <<<<<<<<<<<<<<
@@ -6500,7 +7010,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":115
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":115
  *             output[i] = sum_x
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
@@ -6522,7 +7032,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
     __pyx_L15:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":117
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":117
  *             output[i] = NaN
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -6537,7 +7047,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -6559,7 +7069,7 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":122
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":122
  * # Rolling mean
  * 
  * def roll_mean(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
@@ -6567,8 +7077,9 @@ static PyObject *__pyx_pf_7tseries_roll_sum(PyObject *__pyx_self, PyObject *__py
  *     cdef double val, prev, sum_x = 0
  */
 
-static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_11roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_11roll_mean = {__Pyx_NAMESTR("roll_mean"), (PyCFunction)__pyx_pf_7tseries_11roll_mean, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_11roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
@@ -6586,8 +7097,8 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -6664,7 +7175,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":124
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":124
  * def roll_mean(ndarray[double_t, ndim=1] input,
  *                int win, int minp):
  *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
@@ -6673,7 +7184,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_sum_x = 0.0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":125
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":125
  *                int win, int minp):
  *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
@@ -6682,43 +7193,46 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_nobs = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":126
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":126
  *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":128
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":128
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     if minp > N:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -6734,7 +7248,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":130
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":130
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -6744,7 +7258,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":131
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":131
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -6756,7 +7270,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":133
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":133
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -6766,7 +7280,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":134
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":134
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -6785,7 +7299,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":137
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":137
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -6795,28 +7309,28 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":138
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":138
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":139
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":139
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":141
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":141
  *             sum_x += val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -6836,7 +7350,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":143
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":143
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -6846,7 +7360,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":144
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":144
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -6865,7 +7379,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":146
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":146
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -6875,7 +7389,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":147
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":147
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -6894,7 +7408,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":148
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":148
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -6904,23 +7418,23 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":149
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":149
  *             prev = input[i - win]
  *             if prev == prev:
  *                 sum_x -= prev             # <<<<<<<<<<<<<<
  *                 nobs -= 1
  * 
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+        __pyx_v_sum_x = (__pyx_v_sum_x - __pyx_v_prev);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":150
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":150
  *             if prev == prev:
  *                 sum_x -= prev
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1;
+        __pyx_v_nobs = (__pyx_v_nobs - 1);
         goto __pyx_L13;
       }
       __pyx_L13:;
@@ -6928,7 +7442,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":152
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":152
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -6938,28 +7452,28 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":153
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":153
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":154
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":154
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":156
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":156
  *             sum_x += val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -6969,7 +7483,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":157
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":157
  * 
  *         if nobs >= minp:
  *             output[i] = sum_x / nobs             # <<<<<<<<<<<<<<
@@ -6995,7 +7509,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":159
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":159
  *             output[i] = sum_x / nobs
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
@@ -7017,7 +7531,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
     __pyx_L15:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":161
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":161
  *             output[i] = NaN
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -7032,7 +7546,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -7054,7 +7568,7 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":166
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":166
  * # Exponentially weighted moving average
  * 
  * def ewma(ndarray[double_t, ndim=1] input, double_t com):             # <<<<<<<<<<<<<<
@@ -7062,9 +7576,10 @@ static PyObject *__pyx_pf_7tseries_roll_mean(PyObject *__pyx_self, PyObject *__p
  *     Compute exponentially-weighted moving average using center-of-mass.
  */
 
-static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_ewma[] = "\n    Compute exponentially-weighted moving average using center-of-mass.\n\n    Parameters\n    ----------\n    input : ndarray (float64 type)\n    com : float64\n\n    Returns\n    -------\n    y : ndarray\n    ";
-static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_12ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_12ewma[] = "\n    Compute exponentially-weighted moving average using center-of-mass.\n\n    Parameters\n    ----------\n    input : ndarray (float64 type)\n    com : float64\n\n    Returns\n    -------\n    y : ndarray\n    ";
+static PyMethodDef __pyx_mdef_7tseries_12ewma = {__Pyx_NAMESTR("ewma"), (PyCFunction)__pyx_pf_7tseries_12ewma, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_12ewma)};
+static PyObject *__pyx_pf_7tseries_12ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   __pyx_t_5numpy_double_t __pyx_v_com;
   double __pyx_v_cur;
@@ -7082,8 +7597,8 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -7156,43 +7671,46 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":182
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":182
  *     cdef double cur, prev, neww, oldw, adj
  *     cdef int i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":184
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":184
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -7208,7 +7726,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":187
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":187
  * 
  * 
  *     neww = 1. / (1. + com)             # <<<<<<<<<<<<<<
@@ -7222,7 +7740,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   }
   __pyx_v_neww = (1. / __pyx_t_7);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":188
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":188
  * 
  *     neww = 1. / (1. + com)
  *     oldw = 1. - neww             # <<<<<<<<<<<<<<
@@ -7231,7 +7749,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
  */
   __pyx_v_oldw = (1. - __pyx_v_neww);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":189
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":189
  *     neww = 1. / (1. + com)
  *     oldw = 1. - neww
  *     adj = oldw             # <<<<<<<<<<<<<<
@@ -7240,7 +7758,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
  */
   __pyx_v_adj = __pyx_v_oldw;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":191
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":191
  *     adj = oldw
  * 
  *     output[0] = neww * input[0]             # <<<<<<<<<<<<<<
@@ -7269,7 +7787,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   }
   *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = (__pyx_v_neww * (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_8, __pyx_bstride_0_input)));
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":193
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":193
  *     output[0] = neww * input[0]
  * 
  *     for i from 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -7279,7 +7797,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_t_9 = __pyx_v_N;
   for (__pyx_v_i = 1; __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":194
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":194
  * 
  *     for i from 1 <= i < N:
  *         cur = input[i]             # <<<<<<<<<<<<<<
@@ -7298,7 +7816,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_11, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":195
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":195
  *     for i from 1 <= i < N:
  *         cur = input[i]
  *         prev = output[i - 1]             # <<<<<<<<<<<<<<
@@ -7317,7 +7835,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_13, __pyx_bstride_0_output));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":197
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":197
  *         prev = output[i - 1]
  * 
  *         if cur == cur:             # <<<<<<<<<<<<<<
@@ -7327,7 +7845,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     __pyx_t_14 = (__pyx_v_cur == __pyx_v_cur);
     if (__pyx_t_14) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":198
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":198
  * 
  *         if cur == cur:
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -7337,7 +7855,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
       __pyx_t_14 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_14) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":199
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":199
  *         if cur == cur:
  *             if prev == prev:
  *                 output[i] = oldw * prev + neww * cur             # <<<<<<<<<<<<<<
@@ -7359,7 +7877,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
       }
       /*else*/ {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":201
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":201
  *                 output[i] = oldw * prev + neww * cur
  *             else:
  *                 output[i] = neww * cur             # <<<<<<<<<<<<<<
@@ -7383,7 +7901,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":203
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":203
  *                 output[i] = neww * cur
  *         else:
  *             output[i] = prev             # <<<<<<<<<<<<<<
@@ -7405,7 +7923,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     __pyx_L8:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":205
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":205
  *             output[i] = prev
  * 
  *     for i from 0 <= i < N:             # <<<<<<<<<<<<<<
@@ -7415,7 +7933,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_t_9 = __pyx_v_N;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":206
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":206
  * 
  *     for i from 0 <= i < N:
  *         cur = input[i]             # <<<<<<<<<<<<<<
@@ -7434,7 +7952,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_17, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":207
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":207
  *     for i from 0 <= i < N:
  *         cur = input[i]
  *         output[i] = output[i] / (1. - adj)             # <<<<<<<<<<<<<<
@@ -7469,7 +7987,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_19, __pyx_bstride_0_output) = (__pyx_t_7 / __pyx_t_20);
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":209
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":209
  *         output[i] = output[i] / (1. - adj)
  * 
  *         if cur == cur:             # <<<<<<<<<<<<<<
@@ -7479,20 +7997,20 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
     __pyx_t_14 = (__pyx_v_cur == __pyx_v_cur);
     if (__pyx_t_14) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":210
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":210
  * 
  *         if cur == cur:
  *             adj *= oldw             # <<<<<<<<<<<<<<
  * 
  *     return output
  */
-      __pyx_v_adj *= __pyx_v_oldw;
+      __pyx_v_adj = (__pyx_v_adj * __pyx_v_oldw);
       goto __pyx_L12;
     }
     __pyx_L12:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":212
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":212
  *             adj *= oldw
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -7507,7 +8025,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -7529,7 +8047,7 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":217
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":217
  * # Rolling variance
  * 
  * def roll_var(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
@@ -7537,8 +8055,9 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
  *     cdef double val, prev, sum_x = 0, sum_xx = 0, nobs = 0
  */
 
-static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_13roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_13roll_var = {__Pyx_NAMESTR("roll_var"), (PyCFunction)__pyx_pf_7tseries_13roll_var, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_13roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
@@ -7557,8 +8076,8 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -7637,7 +8156,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":219
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":219
  * def roll_var(ndarray[double_t, ndim=1] input,
  *               int win, int minp):
  *     cdef double val, prev, sum_x = 0, sum_xx = 0, nobs = 0             # <<<<<<<<<<<<<<
@@ -7648,43 +8167,46 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_v_sum_xx = 0.0;
   __pyx_v_nobs = 0.0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":221
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":221
  *     cdef double val, prev, sum_x = 0, sum_xx = 0, nobs = 0
  *     cdef int i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":223
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":223
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     if minp > N:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -7700,7 +8222,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":225
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":225
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -7710,7 +8232,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":226
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":226
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -7722,7 +8244,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":228
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":228
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -7732,7 +8254,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":229
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":229
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -7751,7 +8273,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":232
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":232
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -7761,37 +8283,37 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":233
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":233
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  *             sum_xx += val * val
  */
-      __pyx_v_nobs += 1.0;
+      __pyx_v_nobs = (__pyx_v_nobs + 1.0);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":234
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":234
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  *             sum_xx += val * val
  * 
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":235
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":235
  *             nobs += 1
  *             sum_x += val
  *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_sum_xx = (__pyx_v_sum_xx + (__pyx_v_val * __pyx_v_val));
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":237
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":237
  *             sum_xx += val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -7811,7 +8333,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":239
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":239
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -7821,7 +8343,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":240
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":240
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -7840,7 +8362,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":242
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":242
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -7850,7 +8372,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":243
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":243
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -7869,7 +8391,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":244
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":244
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -7879,32 +8401,32 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":245
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":245
  *             prev = input[i - win]
  *             if prev == prev:
  *                 sum_x -= prev             # <<<<<<<<<<<<<<
  *                 sum_xx -= prev * prev
  *                 nobs -= 1
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+        __pyx_v_sum_x = (__pyx_v_sum_x - __pyx_v_prev);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":246
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":246
  *             if prev == prev:
  *                 sum_x -= prev
  *                 sum_xx -= prev * prev             # <<<<<<<<<<<<<<
  *                 nobs -= 1
  * 
  */
-        __pyx_v_sum_xx -= (__pyx_v_prev * __pyx_v_prev);
+        __pyx_v_sum_xx = (__pyx_v_sum_xx - (__pyx_v_prev * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":247
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":247
  *                 sum_x -= prev
  *                 sum_xx -= prev * prev
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1.0;
+        __pyx_v_nobs = (__pyx_v_nobs - 1.0);
         goto __pyx_L13;
       }
       __pyx_L13:;
@@ -7912,7 +8434,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":249
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":249
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -7922,37 +8444,37 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":250
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":250
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
  *             sum_xx += val * val
  */
-      __pyx_v_nobs += 1.0;
+      __pyx_v_nobs = (__pyx_v_nobs + 1.0);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":251
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":251
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
  *             sum_xx += val * val
  * 
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_v_sum_x = (__pyx_v_sum_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":252
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":252
  *             nobs += 1
  *             sum_x += val
  *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_sum_xx = (__pyx_v_sum_xx + (__pyx_v_val * __pyx_v_val));
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":254
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":254
  *             sum_xx += val * val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -7962,7 +8484,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":255
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":255
  * 
  *         if nobs >= minp:
  *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)             # <<<<<<<<<<<<<<
@@ -7990,7 +8512,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":257
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":257
  *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
@@ -8012,7 +8534,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
     __pyx_L15:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":259
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":259
  *             output[i] = NaN
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -8027,7 +8549,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -8049,7 +8571,7 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":264
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":264
  * # Rolling skewness
  * 
  * def roll_skew(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
@@ -8057,8 +8579,9 @@ static PyObject *__pyx_pf_7tseries_roll_var(PyObject *__pyx_self, PyObject *__py
  *     cdef double val, prev
  */
 
-static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_14roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_14roll_skew = {__Pyx_NAMESTR("roll_skew"), (PyCFunction)__pyx_pf_7tseries_14roll_skew, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_14roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
@@ -8082,8 +8605,8 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -8162,7 +8685,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":267
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":267
  *                int win, int minp):
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0             # <<<<<<<<<<<<<<
@@ -8173,7 +8696,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_v_xx = 0.0;
   __pyx_v_xxx = 0.0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":268
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":268
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
@@ -8182,43 +8705,46 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_nobs = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":269
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":269
  *     cdef double x = 0, xx = 0, xxx = 0
  *     cdef int nobs = 0, i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":271
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":271
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     # 3 components of the skewness equation
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -8234,7 +8760,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":276
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":276
  *     cdef double A, B, C, R
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -8244,7 +8770,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":277
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":277
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -8256,7 +8782,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":279
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":279
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -8266,7 +8792,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":280
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":280
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -8285,7 +8811,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":283
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":283
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -8295,46 +8821,46 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":284
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":284
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             x += val
  *             xx += val * val
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":285
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":285
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
  *             xx += val * val
  *             xxx += val * val * val
  */
-      __pyx_v_x += __pyx_v_val;
+      __pyx_v_x = (__pyx_v_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":286
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":286
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
  * 
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_xx = (__pyx_v_xx + (__pyx_v_val * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":287
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":287
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxx = (__pyx_v_xxx + ((__pyx_v_val * __pyx_v_val) * __pyx_v_val));
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":289
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":289
  *             xxx += val * val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -8354,7 +8880,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":291
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":291
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -8364,7 +8890,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":292
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":292
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -8383,7 +8909,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":294
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":294
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -8393,7 +8919,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":295
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":295
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -8412,7 +8938,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":296
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":296
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -8422,41 +8948,41 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":297
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":297
  *             prev = input[i - win]
  *             if prev == prev:
  *                 x -= prev             # <<<<<<<<<<<<<<
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev
  */
-        __pyx_v_x -= __pyx_v_prev;
+        __pyx_v_x = (__pyx_v_x - __pyx_v_prev);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":298
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":298
  *             if prev == prev:
  *                 x -= prev
  *                 xx -= prev * prev             # <<<<<<<<<<<<<<
  *                 xxx -= prev * prev * prev
  * 
  */
-        __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
+        __pyx_v_xx = (__pyx_v_xx - (__pyx_v_prev * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":299
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":299
  *                 x -= prev
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
  * 
  *                 nobs -= 1
  */
-        __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
+        __pyx_v_xxx = (__pyx_v_xxx - ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":301
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":301
  *                 xxx -= prev * prev * prev
  * 
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1;
+        __pyx_v_nobs = (__pyx_v_nobs - 1);
         goto __pyx_L13;
       }
       __pyx_L13:;
@@ -8464,7 +8990,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":303
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":303
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -8474,46 +9000,46 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":304
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":304
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             x += val
  *             xx += val * val
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":305
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":305
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
  *             xx += val * val
  *             xxx += val * val * val
  */
-      __pyx_v_x += __pyx_v_val;
+      __pyx_v_x = (__pyx_v_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":306
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":306
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
  * 
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_xx = (__pyx_v_xx + (__pyx_v_val * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":307
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":307
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxx = (__pyx_v_xxx + ((__pyx_v_val * __pyx_v_val) * __pyx_v_val));
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":309
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":309
  *             xxx += val * val * val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -8523,7 +9049,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":310
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":310
  * 
  *         if nobs >= minp:
  *             A = x / nobs             # <<<<<<<<<<<<<<
@@ -8536,7 +9062,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":311
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":311
  *         if nobs >= minp:
  *             A = x / nobs
  *             B = xx / nobs - A * A             # <<<<<<<<<<<<<<
@@ -8549,7 +9075,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - (__pyx_v_A * __pyx_v_A));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":312
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":312
  *             A = x / nobs
  *             B = xx / nobs - A * A
  *             C = xxx / nobs - A * A * A - 3 * A * B             # <<<<<<<<<<<<<<
@@ -8562,7 +9088,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - ((__pyx_v_A * __pyx_v_A) * __pyx_v_A)) - ((3.0 * __pyx_v_A) * __pyx_v_B));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":314
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":314
  *             C = xxx / nobs - A * A * A - 3 * A * B
  * 
  *             R = sqrt(B)             # <<<<<<<<<<<<<<
@@ -8571,7 +9097,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
  */
       __pyx_v_R = sqrt(__pyx_v_B);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":316
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":316
  *             R = sqrt(B)
  * 
  *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
@@ -8580,7 +9106,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
  */
       __pyx_t_15 = (sqrt((__pyx_v_nobs * (__pyx_v_nobs - 1.))) * __pyx_v_C);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":317
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":317
  * 
  *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
  *                          ((nobs-2) * R * R * R))             # <<<<<<<<<<<<<<
@@ -8593,7 +9119,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
         {__pyx_filename = __pyx_f[5]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":316
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":316
  *             R = sqrt(B)
  * 
  *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
@@ -8615,7 +9141,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":319
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":319
  *                          ((nobs-2) * R * R * R))
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
@@ -8637,7 +9163,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
     __pyx_L15:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":321
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":321
  *             output[i] = NaN
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -8652,7 +9178,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -8674,7 +9200,7 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":327
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":327
  * 
  * 
  * def roll_kurt(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
@@ -8682,8 +9208,9 @@ static PyObject *__pyx_pf_7tseries_roll_skew(PyObject *__pyx_self, PyObject *__p
  *     cdef double val, prev
  */
 
-static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_15roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_15roll_kurt = {__Pyx_NAMESTR("roll_kurt"), (PyCFunction)__pyx_pf_7tseries_15roll_kurt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_15roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
@@ -8710,8 +9237,8 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -8790,7 +9317,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":330
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":330
  *                int win, int minp):
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0             # <<<<<<<<<<<<<<
@@ -8802,7 +9329,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_v_xxx = 0.0;
   __pyx_v_xxxx = 0.0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":331
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":331
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
@@ -8811,43 +9338,46 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_nobs = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":332
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":332
  *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
  *     cdef int nobs = 0, i
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_N = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_N = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":334
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":334
  *     cdef int N = len(input)
  * 
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     # 5 components of the kurtosis equation
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -8863,7 +9393,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":339
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":339
  *     cdef double A, B, C, D, R, K
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -8873,7 +9403,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":340
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":340
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -8885,7 +9415,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":342
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":342
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -8895,7 +9425,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":343
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":343
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -8914,7 +9444,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":346
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":346
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -8924,55 +9454,55 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":347
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":347
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  * 
  *             # seriously don't ask me why this is faster
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":350
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":350
  * 
  *             # seriously don't ask me why this is faster
  *             x += val             # <<<<<<<<<<<<<<
  *             xx += val * val
  *             xxx += val * val * val
  */
-      __pyx_v_x += __pyx_v_val;
+      __pyx_v_x = (__pyx_v_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":351
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":351
  *             # seriously don't ask me why this is faster
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
  *             xxxx += val * val * val * val
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_xx = (__pyx_v_xx + (__pyx_v_val * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":352
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":352
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
  *             xxxx += val * val * val * val
  * 
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxx = (__pyx_v_xxx + ((__pyx_v_val * __pyx_v_val) * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":353
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":353
  *             xx += val * val
  *             xxx += val * val * val
  *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_xxxx += (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxxx = (__pyx_v_xxxx + (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val));
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":355
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":355
  *             xxxx += val * val * val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -8992,7 +9522,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":357
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":357
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -9002,7 +9532,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":358
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":358
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -9021,7 +9551,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":360
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":360
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -9031,7 +9561,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":361
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":361
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -9050,7 +9580,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":362
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":362
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -9060,50 +9590,50 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":363
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":363
  *             prev = input[i - win]
  *             if prev == prev:
  *                 x -= prev             # <<<<<<<<<<<<<<
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev
  */
-        __pyx_v_x -= __pyx_v_prev;
+        __pyx_v_x = (__pyx_v_x - __pyx_v_prev);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":364
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":364
  *             if prev == prev:
  *                 x -= prev
  *                 xx -= prev * prev             # <<<<<<<<<<<<<<
  *                 xxx -= prev * prev * prev
  *                 xxxx -= prev * prev * prev * prev
  */
-        __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
+        __pyx_v_xx = (__pyx_v_xx - (__pyx_v_prev * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":365
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":365
  *                 x -= prev
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
  *                 xxxx -= prev * prev * prev * prev
  * 
  */
-        __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
+        __pyx_v_xxx = (__pyx_v_xxx - ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":366
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":366
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev
  *                 xxxx -= prev * prev * prev * prev             # <<<<<<<<<<<<<<
  * 
  *                 nobs -= 1
  */
-        __pyx_v_xxxx -= (((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev) * __pyx_v_prev);
+        __pyx_v_xxxx = (__pyx_v_xxxx - (((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev) * __pyx_v_prev));
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":368
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":368
  *                 xxxx -= prev * prev * prev * prev
  * 
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1;
+        __pyx_v_nobs = (__pyx_v_nobs - 1);
         goto __pyx_L13;
       }
       __pyx_L13:;
@@ -9111,7 +9641,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":370
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":370
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -9121,55 +9651,55 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":371
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":371
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             x += val
  *             xx += val * val
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":372
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":372
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
  *             xx += val * val
  *             xxx += val * val * val
  */
-      __pyx_v_x += __pyx_v_val;
+      __pyx_v_x = (__pyx_v_x + __pyx_v_val);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":373
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":373
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
  *             xxxx += val * val * val * val
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_xx = (__pyx_v_xx + (__pyx_v_val * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":374
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":374
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
  *             xxxx += val * val * val * val
  * 
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxx = (__pyx_v_xxx + ((__pyx_v_val * __pyx_v_val) * __pyx_v_val));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":375
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":375
  *             xx += val * val
  *             xxx += val * val * val
  *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_xxxx += (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_xxxx = (__pyx_v_xxxx + (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val));
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":377
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":377
  *             xxxx += val * val * val * val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -9179,7 +9709,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":378
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":378
  * 
  *         if nobs >= minp:
  *             A = x / nobs             # <<<<<<<<<<<<<<
@@ -9192,7 +9722,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":379
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":379
  *         if nobs >= minp:
  *             A = x / nobs
  *             R = A * A             # <<<<<<<<<<<<<<
@@ -9201,7 +9731,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
  */
       __pyx_v_R = (__pyx_v_A * __pyx_v_A);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":380
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":380
  *             A = x / nobs
  *             R = A * A
  *             B = xx / nobs - R             # <<<<<<<<<<<<<<
@@ -9214,7 +9744,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - __pyx_v_R);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":381
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":381
  *             R = A * A
  *             B = xx / nobs - R
  *             R = R * A             # <<<<<<<<<<<<<<
@@ -9223,7 +9753,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
  */
       __pyx_v_R = (__pyx_v_R * __pyx_v_A);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":382
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":382
  *             B = xx / nobs - R
  *             R = R * A
  *             C = xxx / nobs - R - 3 * A * B             # <<<<<<<<<<<<<<
@@ -9236,7 +9766,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - __pyx_v_R) - ((3.0 * __pyx_v_A) * __pyx_v_B));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":383
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":383
  *             R = R * A
  *             C = xxx / nobs - R - 3 * A * B
  *             R = R * A             # <<<<<<<<<<<<<<
@@ -9245,7 +9775,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
  */
       __pyx_v_R = (__pyx_v_R * __pyx_v_A);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":384
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":384
  *             C = xxx / nobs - R - 3 * A * B
  *             R = R * A
  *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A             # <<<<<<<<<<<<<<
@@ -9258,7 +9788,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_D = ((((__pyx_v_xxxx / __pyx_v_nobs) - __pyx_v_R) - (((6.0 * __pyx_v_B) * __pyx_v_A) * __pyx_v_A)) - ((4.0 * __pyx_v_C) * __pyx_v_A));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":386
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":386
  *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
  * 
  *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)             # <<<<<<<<<<<<<<
@@ -9273,7 +9803,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_K = ((__pyx_t_15 / __pyx_t_16) - (3.0 * pow((__pyx_v_nobs - 1.), 2.0)));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":387
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":387
  * 
  *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
  *             K = K / ((nobs - 2.)*(nobs-3.))             # <<<<<<<<<<<<<<
@@ -9287,7 +9817,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
       }
       __pyx_v_K = (__pyx_v_K / __pyx_t_16);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":389
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":389
  *             K = K / ((nobs - 2.)*(nobs-3.))
  * 
  *             output[i] = K             # <<<<<<<<<<<<<<
@@ -9309,7 +9839,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":391
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":391
  *             output[i] = K
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
@@ -9331,7 +9861,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
     __pyx_L15:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":393
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":393
  *             output[i] = NaN
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -9346,7 +9876,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -9368,7 +9898,7 @@ static PyObject *__pyx_pf_7tseries_roll_kurt(PyObject *__pyx_self, PyObject *__p
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":400
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":400
  * ctypedef double_t (* skiplist_f)(object sl, int n, int p)
  * 
  * cdef _roll_skiplist_op(ndarray arg, int win, int minp, skiplist_f op):             # <<<<<<<<<<<<<<
@@ -9412,7 +9942,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_bstruct_input.buf = NULL;
   __pyx_bstruct_output.buf = NULL;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":401
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":401
  * 
  * cdef _roll_skiplist_op(ndarray arg, int win, int minp, skiplist_f op):
  *     cdef ndarray[double_t, ndim=1] input = arg             # <<<<<<<<<<<<<<
@@ -9431,7 +9961,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __Pyx_INCREF(((PyObject *)__pyx_v_arg));
   __pyx_v_input = ((PyArrayObject *)__pyx_v_arg);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":404
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":404
  *     cdef double val, prev, midpoint
  *     cdef IndexableSkiplist skiplist
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
@@ -9440,7 +9970,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
  */
   __pyx_v_nobs = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":406
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":406
  *     cdef int nobs = 0, i
  * 
  *     cdef int N = len(input)             # <<<<<<<<<<<<<<
@@ -9450,7 +9980,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_v_N = __pyx_t_1;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":407
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":407
  * 
  *     cdef int N = len(input)
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
@@ -9465,17 +9995,17 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
   __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
@@ -9492,7 +10022,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":409
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":409
  *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     skiplist = IndexableSkiplist(win)             # <<<<<<<<<<<<<<
@@ -9502,18 +10032,18 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_5 = PyInt_FromLong(__pyx_v_win); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_IndexableSkiplist)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_IndexableSkiplist)), ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_v_skiplist));
   __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":411
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":411
  *     skiplist = IndexableSkiplist(win)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
@@ -9523,7 +10053,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
   if (__pyx_t_7) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":412
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":412
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -9535,7 +10065,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   }
   __pyx_L3:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":414
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":414
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
@@ -9545,7 +10075,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_8 = (__pyx_v_minp - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":415
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":415
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -9564,7 +10094,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":418
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":418
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -9574,16 +10104,16 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":419
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":419
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             skiplist.insert(val)
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":420
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":420
  *         if val == val:
  *             nobs += 1
  *             skiplist.insert(val)             # <<<<<<<<<<<<<<
@@ -9597,7 +10127,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     }
     __pyx_L6:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":422
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":422
  *             skiplist.insert(val)
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
@@ -9617,7 +10147,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":424
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":424
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
@@ -9627,7 +10157,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   __pyx_t_11 = __pyx_v_N;
   for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":425
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":425
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
@@ -9646,7 +10176,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     }
     __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":427
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":427
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
@@ -9656,7 +10186,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":428
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":428
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
@@ -9675,7 +10205,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
       }
       __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":430
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":430
  *             prev = input[i - win]
  * 
  *             if prev == prev:             # <<<<<<<<<<<<<<
@@ -9685,7 +10215,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
       __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
       if (__pyx_t_7) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":431
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":431
  * 
  *             if prev == prev:
  *                 skiplist.remove(prev)             # <<<<<<<<<<<<<<
@@ -9696,14 +10226,14 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":432
+        /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":432
  *             if prev == prev:
  *                 skiplist.remove(prev)
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
-        __pyx_v_nobs -= 1;
+        __pyx_v_nobs = (__pyx_v_nobs - 1);
         goto __pyx_L10;
       }
       __pyx_L10:;
@@ -9711,7 +10241,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     }
     __pyx_L9:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":434
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":434
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
@@ -9721,16 +10251,16 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
     if (__pyx_t_7) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":435
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":435
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             skiplist.insert(val)
  * 
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_nobs = (__pyx_v_nobs + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":436
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":436
  *         if val == val:
  *             nobs += 1
  *             skiplist.insert(val)             # <<<<<<<<<<<<<<
@@ -9744,7 +10274,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     }
     __pyx_L11:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":438
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":438
  *             skiplist.insert(val)
  * 
  *         output[i] = op(skiplist, nobs, minp)             # <<<<<<<<<<<<<<
@@ -9764,7 +10294,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
     *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = __pyx_v_op(((PyObject *)__pyx_v_skiplist), __pyx_v_nobs, __pyx_v_minp);
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":440
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":440
  *         output[i] = op(skiplist, nobs, minp)
  * 
  *     return output             # <<<<<<<<<<<<<<
@@ -9803,7 +10333,7 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":442
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":442
  *     return output
  * 
  * def roll_median(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
@@ -9811,14 +10341,16 @@ static  PyObject *__pyx_f_7tseries__roll_skiplist_op(PyArrayObject *__pyx_v_arg,
  *     O(N log(window)) implementation using skip list
  */
 
-static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_roll_median[] = "\n    O(N log(window)) implementation using skip list\n    ";
-static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_16roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_16roll_median[] = "\n    O(N log(window)) implementation using skip list\n    ";
+static PyMethodDef __pyx_mdef_7tseries_16roll_median = {__Pyx_NAMESTR("roll_median"), (PyCFunction)__pyx_pf_7tseries_16roll_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_16roll_median)};
+static PyObject *__pyx_pf_7tseries_16roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("roll_median");
   __pyx_self = __pyx_self;
@@ -9873,7 +10405,7 @@ static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *_
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":446
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":446
  *     O(N log(window)) implementation using skip list
  *     '''
  *     return _roll_skiplist_op(input, win, minp, _get_median)             # <<<<<<<<<<<<<<
@@ -9881,16 +10413,20 @@ static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *_
  * def roll_max(ndarray input, int win, int minp):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries__roll_skiplist_op(__pyx_v_input, __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_median); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries__roll_skiplist_op(((PyArrayObject *)__pyx_t_1), __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_median); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 446; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.roll_median");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -9899,7 +10435,7 @@ static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":448
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":448
  *     return _roll_skiplist_op(input, win, minp, _get_median)
  * 
  * def roll_max(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
@@ -9907,14 +10443,16 @@ static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *_
  *     O(N log(window)) implementation using skip list
  */
 
-static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_roll_max[] = "\n    O(N log(window)) implementation using skip list\n    ";
-static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_17roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_17roll_max[] = "\n    O(N log(window)) implementation using skip list\n    ";
+static PyMethodDef __pyx_mdef_7tseries_17roll_max = {__Pyx_NAMESTR("roll_max"), (PyCFunction)__pyx_pf_7tseries_17roll_max, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_17roll_max)};
+static PyObject *__pyx_pf_7tseries_17roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("roll_max");
   __pyx_self = __pyx_self;
@@ -9969,7 +10507,7 @@ static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__py
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":452
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":452
  *     O(N log(window)) implementation using skip list
  *     '''
  *     return _roll_skiplist_op(input, win, minp, _get_max)             # <<<<<<<<<<<<<<
@@ -9977,16 +10515,20 @@ static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__py
  * def roll_min(ndarray input, int win, int minp):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries__roll_skiplist_op(__pyx_v_input, __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_max); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries__roll_skiplist_op(((PyArrayObject *)__pyx_t_1), __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_max); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.roll_max");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -9995,7 +10537,7 @@ static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__py
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":454
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":454
  *     return _roll_skiplist_op(input, win, minp, _get_max)
  * 
  * def roll_min(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
@@ -10003,14 +10545,16 @@ static PyObject *__pyx_pf_7tseries_roll_max(PyObject *__pyx_self, PyObject *__py
  *     O(N log(window)) implementation using skip list
  */
 
-static PyObject *__pyx_pf_7tseries_roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_roll_min[] = "\n    O(N log(window)) implementation using skip list\n    ";
-static PyObject *__pyx_pf_7tseries_roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_18roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_18roll_min[] = "\n    O(N log(window)) implementation using skip list\n    ";
+static PyMethodDef __pyx_mdef_7tseries_18roll_min = {__Pyx_NAMESTR("roll_min"), (PyCFunction)__pyx_pf_7tseries_18roll_min, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_18roll_min)};
+static PyObject *__pyx_pf_7tseries_18roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("roll_min");
   __pyx_self = __pyx_self;
@@ -10065,7 +10609,7 @@ static PyObject *__pyx_pf_7tseries_roll_min(PyObject *__pyx_self, PyObject *__py
   __pyx_L4_argument_unpacking_done:;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":458
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":458
  *     O(N log(window)) implementation using skip list
  *     '''
  *     return _roll_skiplist_op(input, win, minp, _get_min)             # <<<<<<<<<<<<<<
@@ -10073,16 +10617,20 @@ static PyObject *__pyx_pf_7tseries_roll_min(PyObject *__pyx_self, PyObject *__py
  * # Unfortunately had to resort to some hackery here, would like for
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries__roll_skiplist_op(__pyx_v_input, __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_min); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries__roll_skiplist_op(((PyArrayObject *)__pyx_t_1), __pyx_v_win, __pyx_v_minp, __pyx_f_7tseries__get_min); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.roll_min");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -10091,7 +10639,7 @@ static PyObject *__pyx_pf_7tseries_roll_min(PyObject *__pyx_self, PyObject *__py
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":463
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":463
  * # Cython to be able to get this right.
  * 
  * cdef double_t _get_median(object sl, int nobs, int minp):             # <<<<<<<<<<<<<<
@@ -10111,7 +10659,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
   PyObject *__pyx_t_6 = NULL;
   __Pyx_RefNannySetupContext("_get_median");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":465
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":465
  * cdef double_t _get_median(object sl, int nobs, int minp):
  *     cdef int midpoint
  *     cdef IndexableSkiplist skiplist = <IndexableSkiplist> sl             # <<<<<<<<<<<<<<
@@ -10121,7 +10669,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
   __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_sl)));
   __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_sl);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":466
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":466
  *     cdef int midpoint
  *     cdef IndexableSkiplist skiplist = <IndexableSkiplist> sl
  *     if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -10131,7 +10679,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
   __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":467
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":467
  *     cdef IndexableSkiplist skiplist = <IndexableSkiplist> sl
  *     if nobs >= minp:
  *         midpoint = nobs / 2             # <<<<<<<<<<<<<<
@@ -10140,7 +10688,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
  */
     __pyx_v_midpoint = __Pyx_div_long(__pyx_v_nobs, 2);
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":468
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":468
  *     if nobs >= minp:
  *         midpoint = nobs / 2
  *         if nobs % 2:             # <<<<<<<<<<<<<<
@@ -10150,7 +10698,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
     __pyx_t_2 = __Pyx_mod_long(__pyx_v_nobs, 2);
     if (__pyx_t_2) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":469
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":469
  *         midpoint = nobs / 2
  *         if nobs % 2:
  *             return skiplist.get(midpoint)             # <<<<<<<<<<<<<<
@@ -10167,7 +10715,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":471
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":471
  *             return skiplist.get(midpoint)
  *         else:
  *             return (skiplist.get(midpoint) +             # <<<<<<<<<<<<<<
@@ -10177,7 +10725,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
       __pyx_t_3 = ((struct __pyx_vtabstruct_7tseries_IndexableSkiplist *)__pyx_v_skiplist->__pyx_vtab)->get(__pyx_v_skiplist, __pyx_v_midpoint, 0); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":472
+      /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":472
  *         else:
  *             return (skiplist.get(midpoint) +
  *                     skiplist.get(midpoint - 1)) / 2             # <<<<<<<<<<<<<<
@@ -10203,7 +10751,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
   }
   /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":474
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":474
  *                     skiplist.get(midpoint - 1)) / 2
  *     else:
  *         return NaN             # <<<<<<<<<<<<<<
@@ -10229,7 +10777,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_median(PyObject *__pyx_v_s
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":476
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":476
  *         return NaN
  * 
  * cdef double_t _get_max(object skiplist, int nobs, int minp):             # <<<<<<<<<<<<<<
@@ -10246,7 +10794,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *__pyx_v_skip
   __pyx_t_5numpy_double_t __pyx_t_5;
   __Pyx_RefNannySetupContext("_get_max");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":477
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":477
  * 
  * cdef double_t _get_max(object skiplist, int nobs, int minp):
  *     if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -10256,7 +10804,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *__pyx_v_skip
   __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":478
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":478
  * cdef double_t _get_max(object skiplist, int nobs, int minp):
  *     if nobs >= minp:
  *         return <IndexableSkiplist> skiplist.get(nobs - 1)             # <<<<<<<<<<<<<<
@@ -10268,14 +10816,14 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *__pyx_v_skip
     __pyx_t_3 = PyInt_FromLong((__pyx_v_nobs - 1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_3);
     __pyx_t_3 = 0;
-    __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
     __pyx_t_5 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_5 == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_5;
@@ -10284,7 +10832,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *__pyx_v_skip
   }
   /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":480
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":480
  *         return <IndexableSkiplist> skiplist.get(nobs - 1)
  *     else:
  *         return NaN             # <<<<<<<<<<<<<<
@@ -10309,7 +10857,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_max(PyObject *__pyx_v_skip
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":482
+/* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":482
  *         return NaN
  * 
  * cdef double_t _get_min(object skiplist, int nobs, int minp):             # <<<<<<<<<<<<<<
@@ -10322,11 +10870,10 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *__pyx_v_skip
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  __pyx_t_5numpy_double_t __pyx_t_5;
+  __pyx_t_5numpy_double_t __pyx_t_4;
   __Pyx_RefNannySetupContext("_get_min");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":483
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":483
  * 
  * cdef double_t _get_min(object skiplist, int nobs, int minp):
  *     if nobs >= minp:             # <<<<<<<<<<<<<<
@@ -10336,7 +10883,7 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *__pyx_v_skip
   __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":484
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":484
  * cdef double_t _get_min(object skiplist, int nobs, int minp):
  *     if nobs >= minp:
  *         return <IndexableSkiplist> skiplist.get(0)             # <<<<<<<<<<<<<<
@@ -10345,24 +10892,18 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *__pyx_v_skip
  */
     __pyx_t_2 = PyObject_GetAttr(__pyx_v_skiplist, __pyx_n_s__get); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_k_tuple_6), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_INCREF(__pyx_int_0);
-    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
-    __Pyx_GIVEREF(__pyx_int_0);
-    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_4 == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_5 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_5 == (npy_double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_r = __pyx_t_5;
+    __pyx_r = __pyx_t_4;
     goto __pyx_L0;
     goto __pyx_L3;
   }
   /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/moments.pyx":486
+    /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":486
  *         return <IndexableSkiplist> skiplist.get(0)
  *     else:
  *         return NaN             # <<<<<<<<<<<<<<
@@ -10377,7 +10918,6 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *__pyx_v_skip
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_WriteUnraisable("tseries._get_min");
   __pyx_r = 0;
   __pyx_L0:;
@@ -10385,14 +10925,15 @@ static  __pyx_t_5numpy_double_t __pyx_f_7tseries__get_min(PyObject *__pyx_v_skip
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":1
+/* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":1
  * def getFillVec(ndarray oldIndex, ndarray newIndex, dict oldMap, dict newMap,             # <<<<<<<<<<<<<<
- *                object kind):
+ *                kind=None):
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_19getFillVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_19getFillVec = {__Pyx_NAMESTR("getFillVec"), (PyCFunction)__pyx_pf_7tseries_19getFillVec, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_19getFillVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_oldIndex = 0;
   PyArrayObject *__pyx_v_newIndex = 0;
   PyObject *__pyx_v_oldMap = 0;
@@ -10412,6 +10953,14 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
     PyObject* values[5] = {0,0,0,0,0};
+
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":2
+ * def getFillVec(ndarray oldIndex, ndarray newIndex, dict oldMap, dict newMap,
+ *                kind=None):             # <<<<<<<<<<<<<<
+ * 
+ *     if kind is None:
+ */
+    values[4] = ((PyObject *)Py_None);
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
       case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
@@ -10430,25 +10979,24 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__newIndex);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("getFillVec", 1, 5, 5, 1); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("getFillVec", 0, 4, 5, 1); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__oldMap);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("getFillVec", 1, 5, 5, 2); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("getFillVec", 0, 4, 5, 2); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  3:
       values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__newMap);
       if (likely(values[3])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("getFillVec", 1, 5, 5, 3); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("getFillVec", 0, 4, 5, 3); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__kind);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("getFillVec", 1, 5, 5, 4); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (kw_args > 0) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__kind);
+        if (value) { values[4] = value; kw_args--; }
       }
     }
     if (unlikely(kw_args > 0)) {
@@ -10456,21 +11004,26 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     }
     __pyx_v_oldIndex = ((PyArrayObject *)values[0]);
     __pyx_v_newIndex = ((PyArrayObject *)values[1]);
-    __pyx_v_oldMap = ((PyObject *)values[2]);
-    __pyx_v_newMap = ((PyObject *)values[3]);
+    __pyx_v_oldMap = ((PyObject*)values[2]);
+    __pyx_v_newMap = ((PyObject*)values[3]);
     __pyx_v_kind = values[4];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
-    goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_oldIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_newIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_oldMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
-    __pyx_v_newMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 3));
-    __pyx_v_kind = PyTuple_GET_ITEM(__pyx_args, 4);
+    __pyx_v_kind = ((PyObject *)Py_None);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  5:
+      __pyx_v_kind = PyTuple_GET_ITEM(__pyx_args, 4);
+      case  4:
+      __pyx_v_newMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 3));
+      __pyx_v_oldMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 2));
+      __pyx_v_newIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
+      __pyx_v_oldIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+      break;
+      default: goto __pyx_L5_argtuple_error;
+    }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("getFillVec", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("getFillVec", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.getFillVec");
   __Pyx_RefNannyFinishContext();
@@ -10480,11 +11033,11 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   __pyx_v_maskVec = Py_None; __Pyx_INCREF(Py_None);
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldIndex), __pyx_ptype_5numpy_ndarray, 1, "oldIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newIndex), __pyx_ptype_5numpy_ndarray, 1, "newIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), &PyDict_Type, 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), &PyDict_Type, 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), (&PyDict_Type), 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), (&PyDict_Type), 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":4
- *                object kind):
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":4
+ *                kind=None):
  * 
  *     if kind is None:             # <<<<<<<<<<<<<<
  *         fillVec, maskVec = getMergeVec(newIndex, oldMap)
@@ -10493,7 +11046,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   __pyx_t_1 = (__pyx_v_kind == Py_None);
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":5
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":5
  * 
  *     if kind is None:
  *         fillVec, maskVec = getMergeVec(newIndex, oldMap)             # <<<<<<<<<<<<<<
@@ -10503,17 +11056,17 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__getMergeVec); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
     __Pyx_INCREF(((PyObject *)__pyx_v_newIndex));
     PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_newIndex));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_newIndex));
     __Pyx_INCREF(((PyObject *)__pyx_v_oldMap));
     PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_oldMap));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_oldMap));
-    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
     if (PyTuple_CheckExact(__pyx_t_4) && likely(PyTuple_GET_SIZE(__pyx_t_4) == 2)) {
       PyObject* tuple = __pyx_t_4;
       __pyx_t_3 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_3);
@@ -10545,7 +11098,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":6
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":6
  *     if kind is None:
  *         fillVec, maskVec = getMergeVec(newIndex, oldMap)
  *     elif kind == 'PAD':             # <<<<<<<<<<<<<<
@@ -10558,7 +11111,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":7
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":7
  *         fillVec, maskVec = getMergeVec(newIndex, oldMap)
  *     elif kind == 'PAD':
  *         fillVec, maskVec = _pad(oldIndex, newIndex, oldMap, newMap)             # <<<<<<<<<<<<<<
@@ -10568,7 +11121,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s___pad); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_GOTREF(((PyObject *)__pyx_t_2));
     __Pyx_INCREF(((PyObject *)__pyx_v_oldIndex));
     PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_oldIndex));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_oldIndex));
@@ -10581,10 +11134,10 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     __Pyx_INCREF(((PyObject *)__pyx_v_newMap));
     PyTuple_SET_ITEM(__pyx_t_2, 3, ((PyObject *)__pyx_v_newMap));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_newMap));
-    __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_Call(__pyx_t_4, ((PyObject *)__pyx_t_2), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
     if (PyTuple_CheckExact(__pyx_t_3) && likely(PyTuple_GET_SIZE(__pyx_t_3) == 2)) {
       PyObject* tuple = __pyx_t_3;
       __pyx_t_2 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_2);
@@ -10616,7 +11169,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":8
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":8
  *     elif kind == 'PAD':
  *         fillVec, maskVec = _pad(oldIndex, newIndex, oldMap, newMap)
  *     elif kind == 'BACKFILL':             # <<<<<<<<<<<<<<
@@ -10629,7 +11182,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_1) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":9
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":9
  *         fillVec, maskVec = _pad(oldIndex, newIndex, oldMap, newMap)
  *     elif kind == 'BACKFILL':
  *         fillVec, maskVec = _backfill(oldIndex, newIndex, oldMap, newMap)             # <<<<<<<<<<<<<<
@@ -10639,7 +11192,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s___backfill); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
     __Pyx_INCREF(((PyObject *)__pyx_v_oldIndex));
     PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_oldIndex));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_oldIndex));
@@ -10652,10 +11205,10 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
     __Pyx_INCREF(((PyObject *)__pyx_v_newMap));
     PyTuple_SET_ITEM(__pyx_t_4, 3, ((PyObject *)__pyx_v_newMap));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_newMap));
-    __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
     if (PyTuple_CheckExact(__pyx_t_2) && likely(PyTuple_GET_SIZE(__pyx_t_2) == 2)) {
       PyObject* tuple = __pyx_t_2;
       __pyx_t_4 = PyTuple_GET_ITEM(tuple, 0); __Pyx_INCREF(__pyx_t_4);
@@ -10688,30 +11241,30 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   }
   /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":11
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":11
  *         fillVec, maskVec = _backfill(oldIndex, newIndex, oldMap, newMap)
  *     else:
  *         raise Exception("Don't recognize method: %s" % kind)             # <<<<<<<<<<<<<<
  * 
  *     return fillVec, maskVec.astype(np.bool)
  */
-    __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_4), __pyx_v_kind); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyNumber_Remainder(((PyObject *)__pyx_kp_s_7), __pyx_v_kind); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(((PyObject *)__pyx_t_2));
     __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_GOTREF(((PyObject *)__pyx_t_3));
     PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
     __pyx_t_2 = 0;
-    __pyx_t_2 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyObject_Call(__pyx_builtin_Exception, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_2, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     {__pyx_filename = __pyx_f[6]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":13
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":13
  *         raise Exception("Don't recognize method: %s" % kind)
  * 
  *     return fillVec, maskVec.astype(np.bool)             # <<<<<<<<<<<<<<
@@ -10727,23 +11280,23 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
   __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
   __Pyx_INCREF(__pyx_v_fillVec);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_fillVec);
   __Pyx_GIVEREF(__pyx_v_fillVec);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_r = __pyx_t_3;
+  __pyx_r = ((PyObject *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
@@ -10764,7 +11317,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":16
+/* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":16
  * 
  * @cython.wraparound(False)
  * def _backfill(ndarray[object, ndim=1] oldIndex,             # <<<<<<<<<<<<<<
@@ -10772,9 +11325,10 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
  *               dict oldMap, dict newMap):
  */
 
-static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries__backfill[] = "\n    Backfilling logic for generating fill vector\n\n    Diagram of what's going on\n\n    Old      New    Fill vector    Mask\n             .        0               1\n             .        0               1\n             .        0               1\n    A        A        0               1\n             .        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n    B        B        1               1\n             .        2               1\n             .        2               1\n             .        2               1\n    C        C        2               1\n             .                        0\n             .                        0\n    D\n    ";
-static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_20_backfill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_20_backfill[] = "\n    Backfilling logic for generating fill vector\n\n    Diagram of what's going on\n\n    Old      New    Fill vector    Mask\n             .        0               1\n             .        0               1\n             .        0               1\n    A        A        0               1\n             .        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n    B        B        1               1\n             .        2               1\n             .        2               1\n             .        2               1\n    C        C        2               1\n             .                        0\n             .                        0\n    D\n    ";
+static PyMethodDef __pyx_mdef_7tseries_20_backfill = {__Pyx_NAMESTR("_backfill"), (PyCFunction)__pyx_pf_7tseries_20_backfill, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_20_backfill)};
+static PyObject *__pyx_pf_7tseries_20_backfill(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_oldIndex = 0;
   PyArrayObject *__pyx_v_newIndex = 0;
   PyObject *__pyx_v_oldMap = 0;
@@ -10801,8 +11355,8 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   Py_ssize_t __pyx_bstride_0_newIndex = 0;
   Py_ssize_t __pyx_bshape_0_newIndex = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -10866,15 +11420,15 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_v_oldIndex = ((PyArrayObject *)values[0]);
     __pyx_v_newIndex = ((PyArrayObject *)values[1]);
-    __pyx_v_oldMap = ((PyObject *)values[2]);
-    __pyx_v_newMap = ((PyObject *)values[3]);
+    __pyx_v_oldMap = ((PyObject*)values[2]);
+    __pyx_v_newMap = ((PyObject*)values[3]);
   } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_oldIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
     __pyx_v_newIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_oldMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
-    __pyx_v_newMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 3));
+    __pyx_v_oldMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 2));
+    __pyx_v_newMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 3));
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
@@ -10894,8 +11448,8 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   __pyx_bstruct_newIndex.buf = NULL;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldIndex), __pyx_ptype_5numpy_ndarray, 1, "oldIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newIndex), __pyx_ptype_5numpy_ndarray, 1, "newIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), &PyDict_Type, 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), &PyDict_Type, 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), (&PyDict_Type), 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), (&PyDict_Type), 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_oldIndex, (PyObject*)__pyx_v_oldIndex, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -10909,60 +11463,69 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   __pyx_bstride_0_newIndex = __pyx_bstruct_newIndex.strides[0];
   __pyx_bshape_0_newIndex = __pyx_bstruct_newIndex.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":51
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":51
  * 
  *     # Get the size
  *     oldLength = len(oldIndex)             # <<<<<<<<<<<<<<
  *     newLength = len(newIndex)
  * 
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_oldIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_oldLength = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_oldIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_oldLength = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":52
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":52
  *     # Get the size
  *     oldLength = len(oldIndex)
  *     newLength = len(newIndex)             # <<<<<<<<<<<<<<
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_newLength = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_newLength = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":54
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":54
  *     newLength = len(newIndex)
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)             # <<<<<<<<<<<<<<
  *     fillVec.fill(-1)
  * 
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__int32); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
   {
@@ -10987,7 +11550,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   __pyx_v_fillVec = ((PyArrayObject *)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":55
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":55
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)
  *     fillVec.fill(-1)             # <<<<<<<<<<<<<<
@@ -10996,51 +11559,48 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_t_6 = PyObject_GetAttr(((PyObject *)__pyx_v_fillVec), __pyx_n_s__fill); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_int_neg_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_neg_1);
-  __Pyx_GIVEREF(__pyx_int_neg_1);
-  __pyx_t_4 = PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_k_tuple_8), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":57
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":57
  *     fillVec.fill(-1)
  * 
  *     mask = np.zeros(len(newIndex), dtype = np.int8)             # <<<<<<<<<<<<<<
  * 
  *     # Current positions
  */
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_6 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
-  __Pyx_GIVEREF(__pyx_t_4);
-  __pyx_t_4 = 0;
-  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_6, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -11065,7 +11625,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   __pyx_v_mask = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":60
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":60
  * 
  *     # Current positions
  *     oldPos = oldLength - 1             # <<<<<<<<<<<<<<
@@ -11074,7 +11634,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_oldPos = (__pyx_v_oldLength - 1);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":61
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":61
  *     # Current positions
  *     oldPos = oldLength - 1
  *     newPos = newLength - 1             # <<<<<<<<<<<<<<
@@ -11083,7 +11643,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  */
   __pyx_v_newPos = (__pyx_v_newLength - 1);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":64
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":64
  * 
  *     # corner case, no filling possible
  *     if newIndex[0] > oldIndex[oldLength - 1]:             # <<<<<<<<<<<<<<
@@ -11110,17 +11670,17 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     __Pyx_RaiseBufferIndexError(__pyx_t_8);
     {__pyx_filename = __pyx_f[6]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_14, __pyx_bstride_0_oldIndex);
-  __Pyx_INCREF((PyObject*)__pyx_t_4);
-  __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_GT); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_14, __pyx_bstride_0_oldIndex);
+  __Pyx_INCREF((PyObject*)__pyx_t_1);
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_GT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   if (__pyx_t_15) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":65
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":65
  *     # corner case, no filling possible
  *     if newIndex[0] > oldIndex[oldLength - 1]:
  *         return fillVec, mask             # <<<<<<<<<<<<<<
@@ -11128,22 +11688,22 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  *     while newPos >= 0:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
     __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
-    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_fillVec));
+    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_fillVec));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
     __Pyx_INCREF(((PyObject *)__pyx_v_mask));
-    PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_v_mask));
+    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_mask));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_mask));
-    __pyx_r = __pyx_t_6;
-    __pyx_t_6 = 0;
+    __pyx_r = ((PyObject *)__pyx_t_4);
+    __pyx_t_4 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":67
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":67
  *         return fillVec, mask
  * 
  *     while newPos >= 0:             # <<<<<<<<<<<<<<
@@ -11154,7 +11714,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     __pyx_t_15 = (__pyx_v_newPos >= 0);
     if (!__pyx_t_15) break;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":68
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":68
  * 
  *     while newPos >= 0:
  *         curOld = oldIndex[oldPos]             # <<<<<<<<<<<<<<
@@ -11170,13 +11730,13 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
       {__pyx_filename = __pyx_f[6]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_8, __pyx_bstride_0_oldIndex);
-    __Pyx_INCREF((PyObject*)__pyx_t_6);
+    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_8, __pyx_bstride_0_oldIndex);
+    __Pyx_INCREF((PyObject*)__pyx_t_4);
     __Pyx_DECREF(__pyx_v_curOld);
-    __pyx_v_curOld = __pyx_t_6;
-    __pyx_t_6 = 0;
+    __pyx_v_curOld = __pyx_t_4;
+    __pyx_t_4 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":71
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":71
  * 
  *         # Until we reach a point where we are before the curOld point
  *         while newIndex[newPos] > curOld:             # <<<<<<<<<<<<<<
@@ -11193,25 +11753,25 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_16, __pyx_bstride_0_newIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_6);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_curOld, Py_GT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_16, __pyx_bstride_0_newIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_4);
+      __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_curOld, Py_GT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (!__pyx_t_15) break;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":72
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":72
  *         # Until we reach a point where we are before the curOld point
  *         while newIndex[newPos] > curOld:
  *             newPos -= 1             # <<<<<<<<<<<<<<
  *             if newPos < 0:
  *                 break
  */
-      __pyx_v_newPos -= 1;
+      __pyx_v_newPos = (__pyx_v_newPos - 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":73
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":73
  *         while newIndex[newPos] > curOld:
  *             newPos -= 1
  *             if newPos < 0:             # <<<<<<<<<<<<<<
@@ -11221,7 +11781,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
       __pyx_t_15 = (__pyx_v_newPos < 0);
       if (__pyx_t_15) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":74
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":74
  *             newPos -= 1
  *             if newPos < 0:
  *                 break             # <<<<<<<<<<<<<<
@@ -11235,20 +11795,20 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_L10_break:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":77
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":77
  * 
  *         # Get the location in the old index
  *         curLoc = oldMap[curOld]             # <<<<<<<<<<<<<<
  * 
  *         # At the beginning of the old index
  */
-    __pyx_t_4 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_oldMap), __pyx_v_curOld); if (!__pyx_t_4) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_17 = __Pyx_PyInt_AsInt(__pyx_t_4); if (unlikely((__pyx_t_17 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_oldMap), __pyx_v_curOld); if (!__pyx_t_1) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_17 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_17 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_curLoc = __pyx_t_17;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":80
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":80
  * 
  *         # At the beginning of the old index
  *         if oldPos == 0:             # <<<<<<<<<<<<<<
@@ -11258,7 +11818,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     __pyx_t_15 = (__pyx_v_oldPos == 0);
     if (__pyx_t_15) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":82
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":82
  *         if oldPos == 0:
  *             # Make sure we are before the curOld index
  *             if newIndex[newPos] <= curOld:             # <<<<<<<<<<<<<<
@@ -11274,40 +11834,40 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_17, __pyx_bstride_0_newIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_4);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_v_curOld, Py_LE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_17, __pyx_bstride_0_newIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_1);
+      __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_curOld, Py_LE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_15) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":83
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":83
  *             # Make sure we are before the curOld index
  *             if newIndex[newPos] <= curOld:
  *                 fillVec[:newPos + 1] = curLoc             # <<<<<<<<<<<<<<
  *                 mask[:newPos + 1] = 1
  *             # Exit the main loop
  */
-        __pyx_t_6 = PyInt_FromLong(__pyx_v_curLoc); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_6);
-        if (PySequence_SetSlice(((PyObject *)__pyx_v_fillVec), 0, (__pyx_v_newPos + 1), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+        __pyx_t_4 = PyInt_FromLong(__pyx_v_curLoc); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        if (__Pyx_PySequence_SetSlice(((PyObject *)__pyx_v_fillVec), 0, (__pyx_v_newPos + 1), __pyx_t_4) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":84
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":84
  *             if newIndex[newPos] <= curOld:
  *                 fillVec[:newPos + 1] = curLoc
  *                 mask[:newPos + 1] = 1             # <<<<<<<<<<<<<<
  *             # Exit the main loop
  *             break
  */
-        if (PySequence_SetSlice(((PyObject *)__pyx_v_mask), 0, (__pyx_v_newPos + 1), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        if (__Pyx_PySequence_SetSlice(((PyObject *)__pyx_v_mask), 0, (__pyx_v_newPos + 1), __pyx_int_1) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         goto __pyx_L13;
       }
       __pyx_L13:;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":86
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":86
  *                 mask[:newPos + 1] = 1
  *             # Exit the main loop
  *             break             # <<<<<<<<<<<<<<
@@ -11319,7 +11879,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":89
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":89
  *         else:
  *             # Get the index there
  *             prevOld = oldIndex[oldPos - 1]             # <<<<<<<<<<<<<<
@@ -11335,13 +11895,13 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_19, __pyx_bstride_0_oldIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_6);
+      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_19, __pyx_bstride_0_oldIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_4);
       __Pyx_DECREF(__pyx_v_prevOld);
-      __pyx_v_prevOld = __pyx_t_6;
-      __pyx_t_6 = 0;
+      __pyx_v_prevOld = __pyx_t_4;
+      __pyx_t_4 = 0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":92
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":92
  * 
  *             # Until we reach the previous index
  *             while newIndex[newPos] > prevOld:             # <<<<<<<<<<<<<<
@@ -11358,16 +11918,16 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
           __Pyx_RaiseBufferIndexError(__pyx_t_20);
           {__pyx_filename = __pyx_f[6]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         }
-        __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_18, __pyx_bstride_0_newIndex);
-        __Pyx_INCREF((PyObject*)__pyx_t_6);
-        __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_prevOld, Py_GT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_4);
-        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_18, __pyx_bstride_0_newIndex);
+        __Pyx_INCREF((PyObject*)__pyx_t_4);
+        __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_prevOld, Py_GT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         if (!__pyx_t_15) break;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":94
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":94
  *             while newIndex[newPos] > prevOld:
  *                 # Set the current fill location
  *                 fillVec[newPos] = curLoc             # <<<<<<<<<<<<<<
@@ -11385,7 +11945,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         }
         *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int32_t *, __pyx_bstruct_fillVec.buf, __pyx_t_20, __pyx_bstride_0_fillVec) = __pyx_v_curLoc;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":95
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":95
  *                 # Set the current fill location
  *                 fillVec[newPos] = curLoc
  *                 mask[newPos] = 1             # <<<<<<<<<<<<<<
@@ -11403,16 +11963,16 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         }
         *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_21, __pyx_bstride_0_mask) = 1;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":97
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":97
  *                 mask[newPos] = 1
  * 
  *                 newPos -= 1             # <<<<<<<<<<<<<<
  *                 if newPos < 0:
  *                     break
  */
-        __pyx_v_newPos -= 1;
+        __pyx_v_newPos = (__pyx_v_newPos - 1);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":98
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":98
  * 
  *                 newPos -= 1
  *                 if newPos < 0:             # <<<<<<<<<<<<<<
@@ -11422,7 +11982,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
         __pyx_t_15 = (__pyx_v_newPos < 0);
         if (__pyx_t_15) {
 
-          /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":99
+          /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":99
  *                 newPos -= 1
  *                 if newPos < 0:
  *                     break             # <<<<<<<<<<<<<<
@@ -11438,18 +11998,18 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":102
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":102
  * 
  *         # Move one period back
  *         oldPos -= 1             # <<<<<<<<<<<<<<
  * 
  *     return (fillVec, mask)
  */
-    __pyx_v_oldPos -= 1;
+    __pyx_v_oldPos = (__pyx_v_oldPos - 1);
   }
   __pyx_L8_break:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":104
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":104
  *         oldPos -= 1
  * 
  *     return (fillVec, mask)             # <<<<<<<<<<<<<<
@@ -11457,22 +12017,22 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  * @cython.wraparound(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
-  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_fillVec));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_fillVec));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
   __Pyx_INCREF(((PyObject *)__pyx_v_mask));
-  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_mask));
+  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_mask));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_mask));
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
+  __pyx_r = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -11502,7 +12062,7 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":107
+/* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":107
  * 
  * @cython.wraparound(False)
  * def _pad(ndarray[object, ndim=1] oldIndex,             # <<<<<<<<<<<<<<
@@ -11510,9 +12070,10 @@ static PyObject *__pyx_pf_7tseries__backfill(PyObject *__pyx_self, PyObject *__p
  *          dict oldMap, dict newMap):
  */
 
-static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries__pad[] = "\n    Padding logic for generating fill vector\n\n    Diagram of what's going on\n\n    Old      New    Fill vector    Mask\n             .                        0\n             .                        0\n             .                        0\n    A        A        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n    B        B        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n    C        C        2               1\n    ";
-static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_21_pad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_21_pad[] = "\n    Padding logic for generating fill vector\n\n    Diagram of what's going on\n\n    Old      New    Fill vector    Mask\n             .                        0\n             .                        0\n             .                        0\n    A        A        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n             .        0               1\n    B        B        1               1\n             .        1               1\n             .        1               1\n             .        1               1\n    C        C        2               1\n    ";
+static PyMethodDef __pyx_mdef_7tseries_21_pad = {__Pyx_NAMESTR("_pad"), (PyCFunction)__pyx_pf_7tseries_21_pad, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_21_pad)};
+static PyObject *__pyx_pf_7tseries_21_pad(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_oldIndex = 0;
   PyArrayObject *__pyx_v_newIndex = 0;
   PyObject *__pyx_v_oldMap = 0;
@@ -11540,8 +12101,8 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   Py_ssize_t __pyx_bstride_0_newIndex = 0;
   Py_ssize_t __pyx_bshape_0_newIndex = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -11605,15 +12166,15 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_v_oldIndex = ((PyArrayObject *)values[0]);
     __pyx_v_newIndex = ((PyArrayObject *)values[1]);
-    __pyx_v_oldMap = ((PyObject *)values[2]);
-    __pyx_v_newMap = ((PyObject *)values[3]);
+    __pyx_v_oldMap = ((PyObject*)values[2]);
+    __pyx_v_newMap = ((PyObject*)values[3]);
   } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_oldIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
     __pyx_v_newIndex = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_oldMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 2));
-    __pyx_v_newMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 3));
+    __pyx_v_oldMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 2));
+    __pyx_v_newMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 3));
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
@@ -11633,8 +12194,8 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_bstruct_newIndex.buf = NULL;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldIndex), __pyx_ptype_5numpy_ndarray, 1, "oldIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newIndex), __pyx_ptype_5numpy_ndarray, 1, "newIndex", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), &PyDict_Type, 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), &PyDict_Type, 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), (&PyDict_Type), 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_newMap), (&PyDict_Type), 1, "newMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
     if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_oldIndex, (PyObject*)__pyx_v_oldIndex, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -11648,60 +12209,69 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_bstride_0_newIndex = __pyx_bstruct_newIndex.strides[0];
   __pyx_bshape_0_newIndex = __pyx_bstruct_newIndex.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":139
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":139
  * 
  *     # Get the size
  *     oldLength = len(oldIndex)             # <<<<<<<<<<<<<<
  *     newLength = len(newIndex)
  * 
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_oldIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_oldLength = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_oldIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 139; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_oldLength = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":140
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":140
  *     # Get the size
  *     oldLength = len(oldIndex)
  *     newLength = len(newIndex)             # <<<<<<<<<<<<<<
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_newLength = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_newLength = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":142
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":142
  *     newLength = len(newIndex)
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)             # <<<<<<<<<<<<<<
  *     fillVec.fill(-1)
  * 
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__int32); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
   {
@@ -11726,7 +12296,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_v_fillVec = ((PyArrayObject *)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":143
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":143
  * 
  *     fillVec = np.empty(len(newIndex), dtype = np.int32)
  *     fillVec.fill(-1)             # <<<<<<<<<<<<<<
@@ -11735,51 +12305,48 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
   __pyx_t_6 = PyObject_GetAttr(((PyObject *)__pyx_v_fillVec), __pyx_n_s__fill); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_int_neg_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_neg_1);
-  __Pyx_GIVEREF(__pyx_int_neg_1);
-  __pyx_t_4 = PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyObject_Call(__pyx_t_6, ((PyObject *)__pyx_k_tuple_9), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":145
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":145
  *     fillVec.fill(-1)
  * 
  *     mask = np.zeros(len(newIndex), dtype = np.int8)             # <<<<<<<<<<<<<<
  * 
  *     oldPos = 0
  */
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_newIndex)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_6 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
-  __Pyx_GIVEREF(__pyx_t_4);
-  __pyx_t_4 = 0;
-  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = ((PyObject *)__pyx_v_newIndex);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_6, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -11804,7 +12371,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_v_mask = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":147
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":147
  *     mask = np.zeros(len(newIndex), dtype = np.int8)
  * 
  *     oldPos = 0             # <<<<<<<<<<<<<<
@@ -11813,7 +12380,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
   __pyx_v_oldPos = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":148
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":148
  * 
  *     oldPos = 0
  *     newPos = 0             # <<<<<<<<<<<<<<
@@ -11822,7 +12389,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
   __pyx_v_newPos = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":151
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":151
  * 
  *     # corner case, no filling possible
  *     if newIndex[newLength - 1] < oldIndex[0]:             # <<<<<<<<<<<<<<
@@ -11849,17 +12416,17 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     __Pyx_RaiseBufferIndexError(__pyx_t_8);
     {__pyx_filename = __pyx_f[6]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_14, __pyx_bstride_0_oldIndex);
-  __Pyx_INCREF((PyObject*)__pyx_t_4);
-  __pyx_t_6 = PyObject_RichCompare(__pyx_t_5, __pyx_t_4, Py_LT); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_14, __pyx_bstride_0_oldIndex);
+  __Pyx_INCREF((PyObject*)__pyx_t_1);
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_LT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   if (__pyx_t_15) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":152
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":152
  *     # corner case, no filling possible
  *     if newIndex[newLength - 1] < oldIndex[0]:
  *         return fillVec, mask             # <<<<<<<<<<<<<<
@@ -11867,22 +12434,22 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  *     while newPos < newLength:
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(((PyObject *)__pyx_t_4));
     __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
-    PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_fillVec));
+    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_fillVec));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
     __Pyx_INCREF(((PyObject *)__pyx_v_mask));
-    PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_v_mask));
+    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_mask));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_mask));
-    __pyx_r = __pyx_t_6;
-    __pyx_t_6 = 0;
+    __pyx_r = ((PyObject *)__pyx_t_4);
+    __pyx_t_4 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
   __pyx_L6:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":154
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":154
  *         return fillVec, mask
  * 
  *     while newPos < newLength:             # <<<<<<<<<<<<<<
@@ -11893,7 +12460,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     __pyx_t_15 = (__pyx_v_newPos < __pyx_v_newLength);
     if (!__pyx_t_15) break;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":155
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":155
  * 
  *     while newPos < newLength:
  *         curOld = oldIndex[oldPos]             # <<<<<<<<<<<<<<
@@ -11909,13 +12476,13 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
       {__pyx_filename = __pyx_f[6]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_8, __pyx_bstride_0_oldIndex);
-    __Pyx_INCREF((PyObject*)__pyx_t_6);
+    __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_8, __pyx_bstride_0_oldIndex);
+    __Pyx_INCREF((PyObject*)__pyx_t_4);
     __Pyx_DECREF(__pyx_v_curOld);
-    __pyx_v_curOld = __pyx_t_6;
-    __pyx_t_6 = 0;
+    __pyx_v_curOld = __pyx_t_4;
+    __pyx_t_4 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":159
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":159
  *         # At beginning, keep going until we go exceed the
  *         # first OLD index in the NEW index
  *         while newIndex[newPos] < curOld:             # <<<<<<<<<<<<<<
@@ -11932,25 +12499,25 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_16, __pyx_bstride_0_newIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_6);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_curOld, Py_LT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_16, __pyx_bstride_0_newIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_4);
+      __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_curOld, Py_LT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (!__pyx_t_15) break;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":160
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":160
  *         # first OLD index in the NEW index
  *         while newIndex[newPos] < curOld:
  *             newPos += 1             # <<<<<<<<<<<<<<
  *             if newPos > newLength - 1:
  *                 break
  */
-      __pyx_v_newPos += 1;
+      __pyx_v_newPos = (__pyx_v_newPos + 1);
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":161
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":161
  *         while newIndex[newPos] < curOld:
  *             newPos += 1
  *             if newPos > newLength - 1:             # <<<<<<<<<<<<<<
@@ -11960,7 +12527,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
       __pyx_t_15 = (__pyx_v_newPos > (__pyx_v_newLength - 1));
       if (__pyx_t_15) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":162
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":162
  *             newPos += 1
  *             if newPos > newLength - 1:
  *                 break             # <<<<<<<<<<<<<<
@@ -11974,20 +12541,20 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_L10_break:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":165
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":165
  * 
  *         # We got there, get the current location in the old index
  *         curLoc = oldMap[curOld]             # <<<<<<<<<<<<<<
  * 
  *         # We're at the end of the road, need to propagate this value to the end
  */
-    __pyx_t_4 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_oldMap), __pyx_v_curOld); if (!__pyx_t_4) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_17 = __Pyx_PyInt_AsInt(__pyx_t_4); if (unlikely((__pyx_t_17 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_1 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_oldMap), __pyx_v_curOld); if (!__pyx_t_1) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_17 = __Pyx_PyInt_AsInt(__pyx_t_1); if (unlikely((__pyx_t_17 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_curLoc = __pyx_t_17;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":168
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":168
  * 
  *         # We're at the end of the road, need to propagate this value to the end
  *         if oldPos == oldLength - 1:             # <<<<<<<<<<<<<<
@@ -11997,7 +12564,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     __pyx_t_15 = (__pyx_v_oldPos == (__pyx_v_oldLength - 1));
     if (__pyx_t_15) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":169
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":169
  *         # We're at the end of the road, need to propagate this value to the end
  *         if oldPos == oldLength - 1:
  *             if newIndex[newPos] >= curOld:             # <<<<<<<<<<<<<<
@@ -12013,40 +12580,40 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_17, __pyx_bstride_0_newIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_4);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_4, __pyx_v_curOld, Py_GE); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_17, __pyx_bstride_0_newIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_1);
+      __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_curOld, Py_GE); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_15) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":170
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":170
  *         if oldPos == oldLength - 1:
  *             if newIndex[newPos] >= curOld:
  *                 fillVec[newPos:] = curLoc             # <<<<<<<<<<<<<<
  *                 mask[newPos:] = 1
  *             break
  */
-        __pyx_t_6 = PyInt_FromLong(__pyx_v_curLoc); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_6);
-        if (PySequence_SetSlice(((PyObject *)__pyx_v_fillVec), __pyx_v_newPos, PY_SSIZE_T_MAX, __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+        __pyx_t_4 = PyInt_FromLong(__pyx_v_curLoc); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        if (__Pyx_PySequence_SetSlice(((PyObject *)__pyx_v_fillVec), __pyx_v_newPos, PY_SSIZE_T_MAX, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":171
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":171
  *             if newIndex[newPos] >= curOld:
  *                 fillVec[newPos:] = curLoc
  *                 mask[newPos:] = 1             # <<<<<<<<<<<<<<
  *             break
  *         else:
  */
-        if (PySequence_SetSlice(((PyObject *)__pyx_v_mask), __pyx_v_newPos, PY_SSIZE_T_MAX, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        if (__Pyx_PySequence_SetSlice(((PyObject *)__pyx_v_mask), __pyx_v_newPos, PY_SSIZE_T_MAX, __pyx_int_1) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         goto __pyx_L13;
       }
       __pyx_L13:;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":172
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":172
  *                 fillVec[newPos:] = curLoc
  *                 mask[newPos:] = 1
  *             break             # <<<<<<<<<<<<<<
@@ -12058,7 +12625,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     /*else*/ {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":177
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":177
  * 
  *             # Get the next index so we know when to stop propagating this value
  *             nextOld = oldIndex[oldPos + 1]             # <<<<<<<<<<<<<<
@@ -12074,13 +12641,13 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
         {__pyx_filename = __pyx_f[6]; __pyx_lineno = 177; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_19, __pyx_bstride_0_oldIndex);
-      __Pyx_INCREF((PyObject*)__pyx_t_6);
+      __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_oldIndex.buf, __pyx_t_19, __pyx_bstride_0_oldIndex);
+      __Pyx_INCREF((PyObject*)__pyx_t_4);
       __Pyx_DECREF(__pyx_v_nextOld);
-      __pyx_v_nextOld = __pyx_t_6;
-      __pyx_t_6 = 0;
+      __pyx_v_nextOld = __pyx_t_4;
+      __pyx_t_4 = 0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":179
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":179
  *             nextOld = oldIndex[oldPos + 1]
  * 
  *             done = 0             # <<<<<<<<<<<<<<
@@ -12089,7 +12656,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
       __pyx_v_done = 0;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":182
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":182
  * 
  *             # Until we reach the next OLD value in the NEW index
  *             while newIndex[newPos] < nextOld:             # <<<<<<<<<<<<<<
@@ -12106,16 +12673,16 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
           __Pyx_RaiseBufferIndexError(__pyx_t_20);
           {__pyx_filename = __pyx_f[6]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         }
-        __pyx_t_6 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_18, __pyx_bstride_0_newIndex);
-        __Pyx_INCREF((PyObject*)__pyx_t_6);
-        __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_nextOld, Py_LT); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_4);
-        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_4 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_newIndex.buf, __pyx_t_18, __pyx_bstride_0_newIndex);
+        __Pyx_INCREF((PyObject*)__pyx_t_4);
+        __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_nextOld, Py_LT); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         if (!__pyx_t_15) break;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":184
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":184
  *             while newIndex[newPos] < nextOld:
  *                 # Use this location to fill
  *                 fillVec[newPos] = curLoc             # <<<<<<<<<<<<<<
@@ -12133,7 +12700,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         }
         *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int32_t *, __pyx_bstruct_fillVec.buf, __pyx_t_20, __pyx_bstride_0_fillVec) = __pyx_v_curLoc;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":187
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":187
  * 
  *                 # Set mask to be 1 so will not be NaN'd
  *                 mask[newPos] = 1             # <<<<<<<<<<<<<<
@@ -12151,16 +12718,16 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         }
         *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_21, __pyx_bstride_0_mask) = 1;
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":188
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":188
  *                 # Set mask to be 1 so will not be NaN'd
  *                 mask[newPos] = 1
  *                 newPos += 1             # <<<<<<<<<<<<<<
  * 
  *                 # We got to the end of the new index
  */
-        __pyx_v_newPos += 1;
+        __pyx_v_newPos = (__pyx_v_newPos + 1);
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":191
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":191
  * 
  *                 # We got to the end of the new index
  *                 if newPos > newLength - 1:             # <<<<<<<<<<<<<<
@@ -12170,7 +12737,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
         __pyx_t_15 = (__pyx_v_newPos > (__pyx_v_newLength - 1));
         if (__pyx_t_15) {
 
-          /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":192
+          /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":192
  *                 # We got to the end of the new index
  *                 if newPos > newLength - 1:
  *                     done = 1             # <<<<<<<<<<<<<<
@@ -12179,7 +12746,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
           __pyx_v_done = 1;
 
-          /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":193
+          /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":193
  *                 if newPos > newLength - 1:
  *                     done = 1
  *                     break             # <<<<<<<<<<<<<<
@@ -12193,7 +12760,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
       }
       __pyx_L15_break:;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":196
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":196
  * 
  *             # We got to the end of the new index
  *             if done:             # <<<<<<<<<<<<<<
@@ -12202,7 +12769,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  */
       if (__pyx_v_done) {
 
-        /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":197
+        /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":197
  *             # We got to the end of the new index
  *             if done:
  *                 break             # <<<<<<<<<<<<<<
@@ -12216,18 +12783,18 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
     }
     __pyx_L12:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":201
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":201
  *         # We already advanced the iterold pointer to the next value,
  *         # inc the count
  *         oldPos += 1             # <<<<<<<<<<<<<<
  * 
  *     return fillVec, mask
  */
-    __pyx_v_oldPos += 1;
+    __pyx_v_oldPos = (__pyx_v_oldPos + 1);
   }
   __pyx_L8_break:;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":203
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":203
  *         oldPos += 1
  * 
  *     return fillVec, mask             # <<<<<<<<<<<<<<
@@ -12235,22 +12802,22 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  * @cython.boundscheck(False)
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
-  PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_fillVec));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_fillVec));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
   __Pyx_INCREF(((PyObject *)__pyx_v_mask));
-  PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_mask));
+  PyTuple_SET_ITEM(__pyx_t_1, 1, ((PyObject *)__pyx_v_mask));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_mask));
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
+  __pyx_r = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -12280,7 +12847,7 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":206
+/* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":206
  * 
  * @cython.boundscheck(False)
  * def getMergeVec(ndarray values, dict oldMap):             # <<<<<<<<<<<<<<
@@ -12288,8 +12855,9 @@ static PyObject *__pyx_pf_7tseries__pad(PyObject *__pyx_self, PyObject *__pyx_ar
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_22getMergeVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_22getMergeVec = {__Pyx_NAMESTR("getMergeVec"), (PyCFunction)__pyx_pf_7tseries_22getMergeVec, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_22getMergeVec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_values = 0;
   PyObject *__pyx_v_oldMap = 0;
   int __pyx_v_i;
@@ -12305,8 +12873,8 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   Py_ssize_t __pyx_bstride_0_fillVec = 0;
   Py_ssize_t __pyx_bshape_0_fillVec = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -12351,12 +12919,12 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
       if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "getMergeVec") < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_values = ((PyArrayObject *)values[0]);
-    __pyx_v_oldMap = ((PyObject *)values[1]);
+    __pyx_v_oldMap = ((PyObject*)values[1]);
   } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_values = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_oldMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
+    __pyx_v_oldMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 1));
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
@@ -12373,51 +12941,54 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __pyx_bstruct_fillVec.buf = NULL;
   __pyx_bstruct_mask.buf = NULL;
   if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), __pyx_ptype_5numpy_ndarray, 1, "values", 0))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), &PyDict_Type, 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_oldMap), (&PyDict_Type), 1, "oldMap", 1))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":214
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":214
  *     cdef ndarray[int8_t, ndim=1] mask
  * 
  *     newLength = len(values)             # <<<<<<<<<<<<<<
  *     fillVec = np.empty(newLength, dtype=np.int32)
  *     mask = np.zeros(newLength, dtype=np.int8)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_values)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_newLength = __pyx_t_1;
+  __pyx_t_1 = ((PyObject *)__pyx_v_values);
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_newLength = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":215
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":215
  * 
  *     newLength = len(values)
  *     fillVec = np.empty(newLength, dtype=np.int32)             # <<<<<<<<<<<<<<
  *     mask = np.zeros(newLength, dtype=np.int8)
  * 
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_newLength); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_newLength); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__int32); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
   {
@@ -12442,7 +13013,7 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __pyx_v_fillVec = ((PyArrayObject *)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":216
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":216
  *     newLength = len(values)
  *     fillVec = np.empty(newLength, dtype=np.int32)
  *     mask = np.zeros(newLength, dtype=np.int8)             # <<<<<<<<<<<<<<
@@ -12451,13 +13022,13 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
  */
   __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__zeros); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = PyInt_FromLong(__pyx_v_newLength); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   __pyx_t_6 = 0;
@@ -12470,10 +13041,10 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (PyDict_SetItem(__pyx_t_6, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_4, ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_1, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_12 = ((PyArrayObject *)__pyx_t_5);
@@ -12499,21 +13070,24 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __pyx_v_mask = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":218
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":218
  *     mask = np.zeros(newLength, dtype=np.int8)
  * 
  *     iternew = <flatiter> PyArray_IterNew(values)             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < newLength:
  */
-  __pyx_t_5 = PyArray_IterNew(((PyObject *)__pyx_v_values)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_5)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_iternew));
-  __pyx_v_iternew = ((PyArrayIterObject *)__pyx_t_5);
+  __pyx_t_5 = ((PyObject *)__pyx_v_values);
+  __Pyx_INCREF(__pyx_t_5);
+  __pyx_t_6 = PyArray_IterNew(__pyx_t_5); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_INCREF(((PyObject *)((PyArrayIterObject *)__pyx_t_6)));
+  __Pyx_DECREF(((PyObject *)__pyx_v_iternew));
+  __pyx_v_iternew = ((PyArrayIterObject *)__pyx_t_6);
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":220
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":220
  *     iternew = <flatiter> PyArray_IterNew(values)
  * 
  *     for i from 0 <= i < newLength:             # <<<<<<<<<<<<<<
@@ -12523,34 +13097,36 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __pyx_t_8 = __pyx_v_newLength;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":221
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":221
  * 
  *     for i from 0 <= i < newLength:
  *         idx = PyArray_GETITEM(values, PyArray_ITER_DATA(iternew))             # <<<<<<<<<<<<<<
  * 
  *         if idx in oldMap:
  */
-    __pyx_t_5 = PyArray_GETITEM(__pyx_v_values, PyArray_ITER_DATA(__pyx_v_iternew)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_6 = ((PyObject *)__pyx_v_values);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_5 = PyArray_GETITEM(((PyArrayObject *)__pyx_t_6), PyArray_ITER_DATA(__pyx_v_iternew)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 221; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_v_idx);
     __pyx_v_idx = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":223
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":223
  *         idx = PyArray_GETITEM(values, PyArray_ITER_DATA(iternew))
  * 
  *         if idx in oldMap:             # <<<<<<<<<<<<<<
  *             fillVec[i] = oldMap[idx]
  *             mask[i] = 1
  */
-    if (unlikely(((PyObject *)__pyx_v_oldMap) == Py_None)) {
-      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {
-      __pyx_t_13 = ((PyDict_Contains(((PyObject *)__pyx_v_oldMap), __pyx_v_idx))); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_v_oldMap == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[6]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
     }
+    __pyx_t_13 = ((PyDict_Contains(((PyObject *)__pyx_v_oldMap), __pyx_v_idx))); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     if (__pyx_t_13) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":224
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":224
  * 
  *         if idx in oldMap:
  *             fillVec[i] = oldMap[idx]             # <<<<<<<<<<<<<<
@@ -12565,7 +13141,7 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
       if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_fillVec;
       *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int32_t *, __pyx_bstruct_fillVec.buf, __pyx_t_15, __pyx_bstride_0_fillVec) = __pyx_t_14;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":225
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":225
  *         if idx in oldMap:
  *             fillVec[i] = oldMap[idx]
  *             mask[i] = 1             # <<<<<<<<<<<<<<
@@ -12579,7 +13155,7 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
     }
     __pyx_L8:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":227
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":227
  *             mask[i] = 1
  * 
  *         PyArray_ITER_NEXT(iternew)             # <<<<<<<<<<<<<<
@@ -12589,7 +13165,7 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
     PyArray_ITER_NEXT(__pyx_v_iternew);
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":229
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":229
  *         PyArray_ITER_NEXT(iternew)
  * 
  *     for i from 0 <= i < newLength:             # <<<<<<<<<<<<<<
@@ -12599,7 +13175,7 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
   __pyx_t_8 = __pyx_v_newLength;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":230
+    /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":230
  * 
  *     for i from 0 <= i < newLength:
  *         if mask[i] == 0:             # <<<<<<<<<<<<<<
@@ -12610,339 +13186,82 @@ static PyObject *__pyx_pf_7tseries_getMergeVec(PyObject *__pyx_self, PyObject *_
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_bshape_0_mask;
     __pyx_t_13 = ((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int8_t *, __pyx_bstruct_mask.buf, __pyx_t_17, __pyx_bstride_0_mask)) == 0);
     if (__pyx_t_13) {
-
-      /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":231
- *     for i from 0 <= i < newLength:
- *         if mask[i] == 0:
- *             fillVec[i] = -1             # <<<<<<<<<<<<<<
- * 
- *     return fillVec, mask.astype(bool)
- */
-      __pyx_t_18 = __pyx_v_i;
-      if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_bshape_0_fillVec;
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int32_t *, __pyx_bstruct_fillVec.buf, __pyx_t_18, __pyx_bstride_0_fillVec) = -1;
-      goto __pyx_L11;
-    }
-    __pyx_L11:;
-  }
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/reindex.pyx":233
- *             fillVec[i] = -1
- * 
- *     return fillVec, mask.astype(bool)             # <<<<<<<<<<<<<<
- * 
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(((PyObject*)&PyBool_Type));
-  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject*)&PyBool_Type));
-  __Pyx_GIVEREF(((PyObject*)&PyBool_Type));
-  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
-  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_fillVec));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
-  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
-  __Pyx_GIVEREF(__pyx_t_4);
-  __pyx_t_4 = 0;
-  __pyx_r = __pyx_t_6;
-  __pyx_t_6 = 0;
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_fillVec);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.getMergeVec");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_fillVec);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_iternew);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF((PyObject *)__pyx_v_fillVec);
-  __Pyx_DECREF((PyObject *)__pyx_v_mask);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":1
- * cdef double __add(double a, double b):             # <<<<<<<<<<<<<<
- *     return a + b
- * cdef double __sub(double a, double b):
- */
-
-static  double __pyx_f_7tseries___add(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__add");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":2
- * cdef double __add(double a, double b):
- *     return a + b             # <<<<<<<<<<<<<<
- * cdef double __sub(double a, double b):
- *     return a - b
- */
-  __pyx_r = (__pyx_v_a + __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":3
- * cdef double __add(double a, double b):
- *     return a + b
- * cdef double __sub(double a, double b):             # <<<<<<<<<<<<<<
- *     return a - b
- * cdef double __div(double a, double b):
- */
-
-static  double __pyx_f_7tseries___sub(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__sub");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":4
- *     return a + b
- * cdef double __sub(double a, double b):
- *     return a - b             # <<<<<<<<<<<<<<
- * cdef double __div(double a, double b):
- *     return a / b
- */
-  __pyx_r = (__pyx_v_a - __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":5
- * cdef double __sub(double a, double b):
- *     return a - b
- * cdef double __div(double a, double b):             # <<<<<<<<<<<<<<
- *     return a / b
- * cdef double __mul(double a, double b):
- */
-
-static  double __pyx_f_7tseries___div(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__div");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":6
- *     return a - b
- * cdef double __div(double a, double b):
- *     return a / b             # <<<<<<<<<<<<<<
- * cdef double __mul(double a, double b):
- *     return a * b
- */
-  if (unlikely(__pyx_v_b == 0)) {
-    PyErr_Format(PyExc_ZeroDivisionError, "float division");
-    {__pyx_filename = __pyx_f[7]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_r = (__pyx_v_a / __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries.__div");
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":7
- * cdef double __div(double a, double b):
- *     return a / b
- * cdef double __mul(double a, double b):             # <<<<<<<<<<<<<<
- *     return a * b
- * cdef double __eq(double a, double b):
- */
-
-static  double __pyx_f_7tseries___mul(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__mul");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":8
- *     return a / b
- * cdef double __mul(double a, double b):
- *     return a * b             # <<<<<<<<<<<<<<
- * cdef double __eq(double a, double b):
- *     return a == b
- */
-  __pyx_r = (__pyx_v_a * __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":9
- * cdef double __mul(double a, double b):
- *     return a * b
- * cdef double __eq(double a, double b):             # <<<<<<<<<<<<<<
- *     return a == b
- * cdef double __ne(double a, double b):
- */
-
-static  double __pyx_f_7tseries___eq(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__eq");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":10
- *     return a * b
- * cdef double __eq(double a, double b):
- *     return a == b             # <<<<<<<<<<<<<<
- * cdef double __ne(double a, double b):
- *     return a != b
- */
-  __pyx_r = (__pyx_v_a == __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":11
- * cdef double __eq(double a, double b):
- *     return a == b
- * cdef double __ne(double a, double b):             # <<<<<<<<<<<<<<
- *     return a != b
- * cdef double __lt(double a, double b):
- */
-
-static  double __pyx_f_7tseries___ne(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__ne");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":12
- *     return a == b
- * cdef double __ne(double a, double b):
- *     return a != b             # <<<<<<<<<<<<<<
- * cdef double __lt(double a, double b):
- *     return a < b
- */
-  __pyx_r = (__pyx_v_a != __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":13
- * cdef double __ne(double a, double b):
- *     return a != b
- * cdef double __lt(double a, double b):             # <<<<<<<<<<<<<<
- *     return a < b
- * cdef double __gt(double a, double b):
- */
-
-static  double __pyx_f_7tseries___lt(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__lt");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":14
- *     return a != b
- * cdef double __lt(double a, double b):
- *     return a < b             # <<<<<<<<<<<<<<
- * cdef double __gt(double a, double b):
- *     return a > b
- */
-  __pyx_r = (__pyx_v_a < __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":15
- * cdef double __lt(double a, double b):
- *     return a < b
- * cdef double __gt(double a, double b):             # <<<<<<<<<<<<<<
- *     return a > b
- * cdef double __pow(double a, double b):
- */
-
-static  double __pyx_f_7tseries___gt(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__gt");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":16
- *     return a < b
- * cdef double __gt(double a, double b):
- *     return a > b             # <<<<<<<<<<<<<<
- * cdef double __pow(double a, double b):
- *     return a ** b
- */
-  __pyx_r = (__pyx_v_a > __pyx_v_b);
-  goto __pyx_L0;
-
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":17
- * cdef double __gt(double a, double b):
- *     return a > b
- * cdef double __pow(double a, double b):             # <<<<<<<<<<<<<<
- *     return a ** b
+
+      /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":231
+ *     for i from 0 <= i < newLength:
+ *         if mask[i] == 0:
+ *             fillVec[i] = -1             # <<<<<<<<<<<<<<
  * 
+ *     return fillVec, mask.astype(bool)
  */
+      __pyx_t_18 = __pyx_v_i;
+      if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_bshape_0_fillVec;
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_int32_t *, __pyx_bstruct_fillVec.buf, __pyx_t_18, __pyx_bstride_0_fillVec) = -1;
+      goto __pyx_L11;
+    }
+    __pyx_L11:;
+  }
 
-static  double __pyx_f_7tseries___pow(double __pyx_v_a, double __pyx_v_b) {
-  double __pyx_r;
-  __Pyx_RefNannySetupContext("__pow");
-
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":18
- *     return a > b
- * cdef double __pow(double a, double b):
- *     return a ** b             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":233
+ *             fillVec[i] = -1
+ * 
+ *     return fillVec, mask.astype(bool)             # <<<<<<<<<<<<<<
  * 
- * ctypedef double (* double_func)(double a, double b)
  */
-  __pyx_r = pow(__pyx_v_a, __pyx_v_b);
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
+  __Pyx_INCREF(((PyObject*)&PyBool_Type));
+  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject*)&PyBool_Type));
+  __Pyx_GIVEREF(((PyObject*)&PyBool_Type));
+  __pyx_t_4 = PyObject_Call(__pyx_t_5, ((PyObject *)__pyx_t_6), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
+  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_6));
+  __Pyx_INCREF(((PyObject *)__pyx_v_fillVec));
+  PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_v_fillVec));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_fillVec));
+  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
+  __Pyx_GIVEREF(__pyx_t_4);
+  __pyx_t_4 = 0;
+  __pyx_r = ((PyObject *)__pyx_t_6);
+  __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  __pyx_r = 0;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_fillVec);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.getMergeVec");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mask);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_fillVec);
+  __pyx_L2:;
+  __Pyx_DECREF((PyObject *)__pyx_v_iternew);
+  __Pyx_DECREF(__pyx_v_idx);
+  __Pyx_DECREF((PyObject *)__pyx_v_fillVec);
+  __Pyx_DECREF((PyObject *)__pyx_v_mask);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":24
+/* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":3
  * @cython.boundscheck(False)
  * @cython.wraparound(False)
  * cdef ndarray _applyFunc(double_func func, ndarray index, ndarray ao,             # <<<<<<<<<<<<<<
@@ -12997,7 +13316,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
   __pyx_bstruct_A.buf = NULL;
   __pyx_bstruct_B.buf = NULL;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":38
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":17
  *     cdef ndarray[double_t, ndim=1] A, B
  * 
  *     A = ao             # <<<<<<<<<<<<<<
@@ -13019,13 +13338,13 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     }
     __pyx_bstride_0_A = __pyx_bstruct_A.strides[0];
     __pyx_bshape_0_A = __pyx_bstruct_A.shape[0];
-    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __Pyx_INCREF(((PyObject *)__pyx_v_ao));
   __Pyx_DECREF(((PyObject *)__pyx_v_A));
   __pyx_v_A = ((PyArrayObject *)__pyx_v_ao);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":39
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":18
  * 
  *     A = ao
  *     B = bo             # <<<<<<<<<<<<<<
@@ -13047,13 +13366,13 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     }
     __pyx_bstride_0_B = __pyx_bstruct_B.strides[0];
     __pyx_bshape_0_B = __pyx_bstruct_B.shape[0];
-    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __Pyx_INCREF(((PyObject *)__pyx_v_bo));
   __Pyx_DECREF(((PyObject *)__pyx_v_B));
   __pyx_v_B = ((PyArrayObject *)__pyx_v_bo);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":41
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":20
  *     B = bo
  * 
  *     ibuf = index             # <<<<<<<<<<<<<<
@@ -13075,71 +13394,74 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     }
     __pyx_bstride_0_ibuf = __pyx_bstruct_ibuf.strides[0];
     __pyx_bshape_0_ibuf = __pyx_bstruct_ibuf.shape[0];
-    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __Pyx_INCREF(((PyObject *)__pyx_v_index));
   __Pyx_DECREF(((PyObject *)__pyx_v_ibuf));
   __pyx_v_ibuf = ((PyArrayObject *)__pyx_v_index);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":43
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":22
  *     ibuf = index
  * 
  *     nan = <double> np.NaN             # <<<<<<<<<<<<<<
  *     length = len(index)
  *     result = <ndarray> np.empty(length, dtype=float)
  */
-  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__NaN); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__NaN); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_7 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_nan = __pyx_t_7;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":44
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":23
  * 
  *     nan = <double> np.NaN
  *     length = len(index)             # <<<<<<<<<<<<<<
  *     result = <ndarray> np.empty(length, dtype=float)
  *     result_data = <double *> result.data
  */
-  __pyx_t_8 = PyObject_Length(((PyObject *)__pyx_v_index)); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_t_6);
+  __pyx_t_8 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_length = __pyx_t_8;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":45
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":24
  *     nan = <double> np.NaN
  *     length = len(index)
  *     result = <ndarray> np.empty(length, dtype=float)             # <<<<<<<<<<<<<<
  *     result_data = <double *> result.data
  * 
  */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
+  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
   PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyDict_New(); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyDict_New(); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_6));
-  if (PyDict_SetItem(__pyx_t_6, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_10 = PyEval_CallObjectWithKeywords(__pyx_t_5, __pyx_t_9, ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_6, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) < 0) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_10 = PyEval_CallObjectWithKeywords(__pyx_t_5, ((PyObject *)__pyx_t_9), ((PyObject *)__pyx_t_6)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
   __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_10)));
   __Pyx_DECREF(((PyObject *)__pyx_v_result));
   __pyx_v_result = ((PyArrayObject *)__pyx_t_10);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":46
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":25
  *     length = len(index)
  *     result = <ndarray> np.empty(length, dtype=float)
  *     result_data = <double *> result.data             # <<<<<<<<<<<<<<
@@ -13148,7 +13470,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
  */
   __pyx_v_result_data = ((double *)__pyx_v_result->data);
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":48
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":27
  *     result_data = <double *> result.data
  * 
  *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
@@ -13158,7 +13480,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
   __pyx_t_1 = __pyx_v_length;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":49
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":28
  * 
  *     for i from 0 <= i < length:
  *         idx = ibuf[i]             # <<<<<<<<<<<<<<
@@ -13172,31 +13494,29 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     __pyx_v_idx = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":51
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":30
  *         idx = ibuf[i]
  * 
  *         if idx not in aMap or idx not in bMap:             # <<<<<<<<<<<<<<
  *             result_data[i] = nan
  *             continue
  */
-    if (unlikely(((PyObject *)__pyx_v_aMap) == Py_None)) {
-      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {
-      __pyx_t_11 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_aMap), __pyx_v_idx))); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__pyx_v_aMap == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
     }
+    __pyx_t_11 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_aMap), __pyx_v_idx))); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     if (!__pyx_t_11) {
-      if (unlikely(((PyObject *)__pyx_v_bMap) == Py_None)) {
-        __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      } else {
-        __pyx_t_12 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_bMap), __pyx_v_idx))); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      if (unlikely(__pyx_v_bMap == Py_None)) {
+        PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
       }
+      __pyx_t_12 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_bMap), __pyx_v_idx))); if (unlikely(__pyx_t_12 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __pyx_t_13 = __pyx_t_12;
     } else {
       __pyx_t_13 = __pyx_t_11;
     }
     if (__pyx_t_13) {
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":52
+      /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":31
  * 
  *         if idx not in aMap or idx not in bMap:
  *             result_data[i] = nan             # <<<<<<<<<<<<<<
@@ -13205,7 +13525,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
  */
       (__pyx_v_result_data[__pyx_v_i]) = __pyx_v_nan;
 
-      /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":53
+      /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":32
  *         if idx not in aMap or idx not in bMap:
  *             result_data[i] = nan
  *             continue             # <<<<<<<<<<<<<<
@@ -13217,33 +13537,33 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     }
     __pyx_L5:;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":55
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":34
  *             continue
  * 
  *         aidx = aMap[idx]             # <<<<<<<<<<<<<<
  *         bidx = bMap[idx]
  *         result_data[i] = func(A[aidx], B[bidx])
  */
-    __pyx_t_10 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_aMap), __pyx_v_idx); if (!__pyx_t_10) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_10 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_aMap), __pyx_v_idx); if (!__pyx_t_10) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_14 = __Pyx_PyIndex_AsSsize_t(__pyx_t_10); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_14 = __Pyx_PyIndex_AsSsize_t(__pyx_t_10); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_v_aidx = __pyx_t_14;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":56
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":35
  * 
  *         aidx = aMap[idx]
  *         bidx = bMap[idx]             # <<<<<<<<<<<<<<
  *         result_data[i] = func(A[aidx], B[bidx])
  * 
  */
-    __pyx_t_10 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_bMap), __pyx_v_idx); if (!__pyx_t_10) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_10 = __Pyx_PyDict_GetItem(((PyObject *)__pyx_v_bMap), __pyx_v_idx); if (!__pyx_t_10) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_14 = __Pyx_PyIndex_AsSsize_t(__pyx_t_10); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_14 = __Pyx_PyIndex_AsSsize_t(__pyx_t_10); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_v_bidx = __pyx_t_14;
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":57
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":36
  *         aidx = aMap[idx]
  *         bidx = bMap[idx]
  *         result_data[i] = func(A[aidx], B[bidx])             # <<<<<<<<<<<<<<
@@ -13256,7 +13576,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
     __pyx_L3_continue:;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":59
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":38
  *         result_data[i] = func(A[aidx], B[bidx])
  * 
  *     return result             # <<<<<<<<<<<<<<
@@ -13299,7 +13619,7 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":61
+/* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":40
  *     return result
  * 
  * def combineFunc(object name, ndarray index, ndarray ao,             # <<<<<<<<<<<<<<
@@ -13307,9 +13627,10 @@ static  PyArrayObject *__pyx_f_7tseries__applyFunc(__pyx_t_7tseries_double_func
  *     '''
  */
 
-static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_combineFunc[] = "\n    Combine two series (values and index maps for each passed in) using the\n    indicated function.\n    ";
-static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_23combineFunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_23combineFunc[] = "\n    Combine two series (values and index maps for each passed in) using the\n    indicated function.\n    ";
+static PyMethodDef __pyx_mdef_7tseries_23combineFunc = {__Pyx_NAMESTR("combineFunc"), (PyCFunction)__pyx_pf_7tseries_23combineFunc, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_23combineFunc)};
+static PyObject *__pyx_pf_7tseries_23combineFunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_name = 0;
   PyArrayObject *__pyx_v_index = 0;
   PyArrayObject *__pyx_v_ao = 0;
@@ -13320,6 +13641,10 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__name,&__pyx_n_s__index,&__pyx_n_s__ao,&__pyx_n_s__bo,&__pyx_n_s__aMap,&__pyx_n_s__bMap,0};
   __Pyx_RefNannySetupContext("combineFunc");
   __pyx_self = __pyx_self;
@@ -13345,42 +13670,42 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 1); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 1); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__ao);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 2); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 2); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  3:
       values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bo);
       if (likely(values[3])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 3); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 3); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  4:
       values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__aMap);
       if (likely(values[4])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 4); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 4); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  5:
       values[5] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__bMap);
       if (likely(values[5])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 5); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, 5); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "combineFunc") < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "combineFunc") < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_name = values[0];
     __pyx_v_index = ((PyArrayObject *)values[1]);
     __pyx_v_ao = ((PyArrayObject *)values[2]);
     __pyx_v_bo = ((PyArrayObject *)values[3]);
-    __pyx_v_aMap = ((PyObject *)values[4]);
-    __pyx_v_bMap = ((PyObject *)values[5]);
+    __pyx_v_aMap = ((PyObject*)values[4]);
+    __pyx_v_bMap = ((PyObject*)values[5]);
   } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
     goto __pyx_L5_argtuple_error;
   } else {
@@ -13388,37 +13713,37 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
     __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
     __pyx_v_ao = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 2));
     __pyx_v_bo = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 3));
-    __pyx_v_aMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 4));
-    __pyx_v_bMap = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 5));
+    __pyx_v_aMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 4));
+    __pyx_v_bMap = ((PyObject*)PyTuple_GET_ITEM(__pyx_args, 5));
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("combineFunc", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.combineFunc");
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ao), __pyx_ptype_5numpy_ndarray, 1, "ao", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_bo), __pyx_ptype_5numpy_ndarray, 1, "bo", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_aMap), &PyDict_Type, 1, "aMap", 1))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_bMap), &PyDict_Type, 1, "bMap", 1))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_ao), __pyx_ptype_5numpy_ndarray, 1, "ao", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_bo), __pyx_ptype_5numpy_ndarray, 1, "bo", 0))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_aMap), (&PyDict_Type), 1, "aMap", 1))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_bMap), (&PyDict_Type), 1, "bMap", 1))) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":67
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":46
  *     indicated function.
  *     '''
  *     if name == "__add__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__add, index, ao, bo, aMap, bMap)
  *     elif name == "__sub__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____add__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____add__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":68
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":47
  *     '''
  *     if name == "__add__":
  *         return _applyFunc(__add, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13426,28 +13751,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__sub, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___add, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_1 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_4 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_5 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_6 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_7 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___add, ((PyArrayObject *)__pyx_t_1), ((PyArrayObject *)__pyx_t_3), ((PyArrayObject *)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_6))); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 47; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":69
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":48
  *     if name == "__add__":
  *         return _applyFunc(__add, index, ao, bo, aMap, bMap)
  *     elif name == "__sub__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__sub, index, ao, bo, aMap, bMap)
  *     elif name == "__div__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____sub__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____sub__), Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":70
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":49
  *         return _applyFunc(__add, index, ao, bo, aMap, bMap)
  *     elif name == "__sub__":
  *         return _applyFunc(__sub, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13455,28 +13795,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__div, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___sub, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_7);
+    __pyx_t_6 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_5 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_4 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_3 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___sub, ((PyArrayObject *)__pyx_t_7), ((PyArrayObject *)__pyx_t_6), ((PyArrayObject *)__pyx_t_5), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_3))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":71
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":50
  *     elif name == "__sub__":
  *         return _applyFunc(__sub, index, ao, bo, aMap, bMap)
  *     elif name == "__div__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__div, index, ao, bo, aMap, bMap)
  *     elif name == "__mul__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____div__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____div__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":72
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":51
  *         return _applyFunc(__sub, index, ao, bo, aMap, bMap)
  *     elif name == "__div__":
  *         return _applyFunc(__div, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13484,28 +13839,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__mul, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___div, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_1 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_4 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_5 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_6 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_7 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___div, ((PyArrayObject *)__pyx_t_1), ((PyArrayObject *)__pyx_t_3), ((PyArrayObject *)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_6))); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":73
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":52
  *     elif name == "__div__":
  *         return _applyFunc(__div, index, ao, bo, aMap, bMap)
  *     elif name == "__mul__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__mul, index, ao, bo, aMap, bMap)
  *     elif name == "__eq__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____mul__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____mul__), Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":74
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":53
  *         return _applyFunc(__div, index, ao, bo, aMap, bMap)
  *     elif name == "__mul__":
  *         return _applyFunc(__mul, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13513,28 +13883,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__eq, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___mul, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_7);
+    __pyx_t_6 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_5 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_4 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_3 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___mul, ((PyArrayObject *)__pyx_t_7), ((PyArrayObject *)__pyx_t_6), ((PyArrayObject *)__pyx_t_5), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_3))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":75
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":54
  *     elif name == "__mul__":
  *         return _applyFunc(__mul, index, ao, bo, aMap, bMap)
  *     elif name == "__eq__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__eq, index, ao, bo, aMap, bMap)
  *     elif name == "__ne__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____eq__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____eq__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":76
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":55
  *         return _applyFunc(__mul, index, ao, bo, aMap, bMap)
  *     elif name == "__eq__":
  *         return _applyFunc(__eq, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13542,28 +13927,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__ne, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___eq, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_1 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_4 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_5 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_6 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_7 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___eq, ((PyArrayObject *)__pyx_t_1), ((PyArrayObject *)__pyx_t_3), ((PyArrayObject *)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_6))); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":77
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":56
  *     elif name == "__eq__":
  *         return _applyFunc(__eq, index, ao, bo, aMap, bMap)
  *     elif name == "__ne__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__ne, index, ao, bo, aMap, bMap)
  *     elif name == "__lt__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____ne__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____ne__), Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":78
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":57
  *         return _applyFunc(__eq, index, ao, bo, aMap, bMap)
  *     elif name == "__ne__":
  *         return _applyFunc(__ne, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13571,28 +13971,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__lt, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___ne, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_7);
+    __pyx_t_6 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_5 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_4 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_3 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___ne, ((PyArrayObject *)__pyx_t_7), ((PyArrayObject *)__pyx_t_6), ((PyArrayObject *)__pyx_t_5), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_3))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":79
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":58
  *     elif name == "__ne__":
  *         return _applyFunc(__ne, index, ao, bo, aMap, bMap)
  *     elif name == "__lt__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__lt, index, ao, bo, aMap, bMap)
  *     elif name == "__gt__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____lt__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____lt__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":80
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":59
  *         return _applyFunc(__ne, index, ao, bo, aMap, bMap)
  *     elif name == "__lt__":
  *         return _applyFunc(__lt, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13600,28 +14015,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__gt, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___lt, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_1 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_4 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_5 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_6 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_7 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___lt, ((PyArrayObject *)__pyx_t_1), ((PyArrayObject *)__pyx_t_3), ((PyArrayObject *)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_6))); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":81
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":60
  *     elif name == "__lt__":
  *         return _applyFunc(__lt, index, ao, bo, aMap, bMap)
  *     elif name == "__gt__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__gt, index, ao, bo, aMap, bMap)
  *     elif name == "__pow__":
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____gt__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_7 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____gt__), Py_EQ); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":82
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":61
  *         return _applyFunc(__lt, index, ao, bo, aMap, bMap)
  *     elif name == "__gt__":
  *         return _applyFunc(__gt, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13629,28 +14059,43 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         return _applyFunc(__pow, index, ao, bo, aMap, bMap)
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___gt, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_7);
+    __pyx_t_6 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_5 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_4 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_3 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___gt, ((PyArrayObject *)__pyx_t_7), ((PyArrayObject *)__pyx_t_6), ((PyArrayObject *)__pyx_t_5), ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_3))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":83
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":62
  *     elif name == "__gt__":
  *         return _applyFunc(__gt, index, ao, bo, aMap, bMap)
  *     elif name == "__pow__":             # <<<<<<<<<<<<<<
  *         return _applyFunc(__pow, index, ao, bo, aMap, bMap)
  *     else:
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____pow__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_name, ((PyObject *)__pyx_n_s____pow__), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":84
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":63
  *         return _applyFunc(__gt, index, ao, bo, aMap, bMap)
  *     elif name == "__pow__":
  *         return _applyFunc(__pow, index, ao, bo, aMap, bMap)             # <<<<<<<<<<<<<<
@@ -13658,31 +14103,40 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  *         raise Exception('bad funcname requested of Cython code')
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___pow, __pyx_v_index, __pyx_v_ao, __pyx_v_bo, __pyx_v_aMap, __pyx_v_bMap)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
+    __pyx_t_1 = ((PyObject *)__pyx_v_index);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = ((PyObject *)__pyx_v_ao);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_t_4 = ((PyObject *)__pyx_v_bo);
+    __Pyx_INCREF(__pyx_t_4);
+    __pyx_t_5 = ((PyObject *)__pyx_v_aMap);
+    __Pyx_INCREF(__pyx_t_5);
+    __pyx_t_6 = ((PyObject *)__pyx_v_bMap);
+    __Pyx_INCREF(__pyx_t_6);
+    __pyx_t_7 = ((PyObject *)__pyx_f_7tseries__applyFunc(__pyx_f_7tseries___pow, ((PyArrayObject *)__pyx_t_1), ((PyArrayObject *)__pyx_t_3), ((PyArrayObject *)__pyx_t_4), ((PyObject*)__pyx_t_5), ((PyObject*)__pyx_t_6))); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
     goto __pyx_L0;
     goto __pyx_L6;
   }
   /*else*/ {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/operators.pyx":86
+    /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":65
  *         return _applyFunc(__pow, index, ao, bo, aMap, bMap)
  *     else:
  *         raise Exception('bad funcname requested of Cython code')             # <<<<<<<<<<<<<<
  */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_5));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_5));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_5));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[7]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = PyObject_Call(__pyx_builtin_Exception, ((PyObject *)__pyx_k_tuple_11), NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_Raise(__pyx_t_7, 0, 0);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    {__pyx_filename = __pyx_f[7]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_L6:;
 
@@ -13691,6 +14145,10 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_AddTraceback("tseries.combineFunc");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13699,7 +14157,7 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":5
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":5
  * from datetime import date as pydate
  * 
  * cdef inline int64_t gmtime(object date):             # <<<<<<<<<<<<<<
@@ -13724,7 +14182,7 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
   int __pyx_t_5;
   __Pyx_RefNannySetupContext("gmtime");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":8
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":8
  *     cdef int y, m, d, h, mn, s, ms, days
  * 
  *     y = PyDateTime_GET_YEAR(date)             # <<<<<<<<<<<<<<
@@ -13732,9 +14190,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     d = PyDateTime_GET_DAY(date)
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_y = PyDateTime_GET_YEAR(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_y = PyDateTime_GET_YEAR(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":9
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":9
  * 
  *     y = PyDateTime_GET_YEAR(date)
  *     m = PyDateTime_GET_MONTH(date)             # <<<<<<<<<<<<<<
@@ -13742,9 +14203,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     h = PyDateTime_DATE_GET_HOUR(date)
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_m = PyDateTime_GET_MONTH(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_m = PyDateTime_GET_MONTH(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":10
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":10
  *     y = PyDateTime_GET_YEAR(date)
  *     m = PyDateTime_GET_MONTH(date)
  *     d = PyDateTime_GET_DAY(date)             # <<<<<<<<<<<<<<
@@ -13752,9 +14216,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     mn = PyDateTime_DATE_GET_MINUTE(date)
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_d = PyDateTime_GET_DAY(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_d = PyDateTime_GET_DAY(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":11
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":11
  *     m = PyDateTime_GET_MONTH(date)
  *     d = PyDateTime_GET_DAY(date)
  *     h = PyDateTime_DATE_GET_HOUR(date)             # <<<<<<<<<<<<<<
@@ -13762,9 +14229,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     s = PyDateTime_DATE_GET_SECOND(date)
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_h = PyDateTime_DATE_GET_HOUR(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_h = PyDateTime_DATE_GET_HOUR(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":12
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":12
  *     d = PyDateTime_GET_DAY(date)
  *     h = PyDateTime_DATE_GET_HOUR(date)
  *     mn = PyDateTime_DATE_GET_MINUTE(date)             # <<<<<<<<<<<<<<
@@ -13772,9 +14242,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     ms = PyDateTime_DATE_GET_MICROSECOND(date) / 1000
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_mn = PyDateTime_DATE_GET_MINUTE(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_mn = PyDateTime_DATE_GET_MINUTE(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":13
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":13
  *     h = PyDateTime_DATE_GET_HOUR(date)
  *     mn = PyDateTime_DATE_GET_MINUTE(date)
  *     s = PyDateTime_DATE_GET_SECOND(date)             # <<<<<<<<<<<<<<
@@ -13782,9 +14255,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  * 
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_s = PyDateTime_DATE_GET_SECOND(((PyDateTime_DateTime *)__pyx_v_date));
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_s = PyDateTime_DATE_GET_SECOND(((PyDateTime_DateTime *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":14
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":14
  *     mn = PyDateTime_DATE_GET_MINUTE(date)
  *     s = PyDateTime_DATE_GET_SECOND(date)
  *     ms = PyDateTime_DATE_GET_MICROSECOND(date) / 1000             # <<<<<<<<<<<<<<
@@ -13792,9 +14268,12 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  *     days = pydate(y, m, 1).toordinal() - _EPOCH_ORD + d - 1
  */
   if (!(likely(((__pyx_v_date) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_date, __pyx_ptype_7tseries_datetime))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_ms = __Pyx_div_long(PyDateTime_DATE_GET_MICROSECOND(((PyDateTime_DateTime *)__pyx_v_date)), 1000);
+  __pyx_t_1 = __pyx_v_date;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_ms = __Pyx_div_long(PyDateTime_DATE_GET_MICROSECOND(((PyDateTime_DateTime *)__pyx_t_1)), 1000);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":16
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":16
  *     ms = PyDateTime_DATE_GET_MICROSECOND(date) / 1000
  * 
  *     days = pydate(y, m, 1).toordinal() - _EPOCH_ORD + d - 1             # <<<<<<<<<<<<<<
@@ -13808,7 +14287,7 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
   __pyx_t_3 = PyInt_FromLong(__pyx_v_m); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
@@ -13818,10 +14297,10 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
   __Pyx_GIVEREF(__pyx_int_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_t_4), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
   __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__toordinal); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
@@ -13847,7 +14326,7 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_days = __pyx_t_5;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":17
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":17
  * 
  *     days = pydate(y, m, 1).toordinal() - _EPOCH_ORD + d - 1
  *     return ((<int64_t> (((days * 24 + h) * 60 + mn))) * 60 + s) * 1000             # <<<<<<<<<<<<<<
@@ -13871,7 +14350,7 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":19
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":19
  *     return ((<int64_t> (((days * 24 + h) * 60 + mn))) * 60 + s) * 1000
  * 
  * cpdef object to_datetime(int64_t timestamp):             # <<<<<<<<<<<<<<
@@ -13879,7 +14358,7 @@ static CYTHON_INLINE __pyx_t_5numpy_int64_t __pyx_f_7tseries_gmtime(PyObject *__
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp); /*proto*/
+static PyObject *__pyx_pf_7tseries_24to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp); /*proto*/
 static  PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t __pyx_v_timestamp, int __pyx_skip_dispatch) {
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
@@ -13887,7 +14366,7 @@ static  PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t __pyx_v_ti
   PyObject *__pyx_t_3 = NULL;
   __Pyx_RefNannySetupContext("to_datetime");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":20
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":20
  * 
  * cpdef object to_datetime(int64_t timestamp):
  *     return pydatetime.utcfromtimestamp(timestamp / 1000.0)             # <<<<<<<<<<<<<<
@@ -13903,14 +14382,14 @@ static  PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t __pyx_v_ti
   __pyx_t_1 = PyFloat_FromDouble((__pyx_v_timestamp / 1000.0)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
@@ -13929,7 +14408,7 @@ static  PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t __pyx_v_ti
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":19
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":19
  *     return ((<int64_t> (((days * 24 + h) * 60 + mn))) * 60 + s) * 1000
  * 
  * cpdef object to_datetime(int64_t timestamp):             # <<<<<<<<<<<<<<
@@ -13937,8 +14416,8 @@ static  PyObject *__pyx_f_7tseries_to_datetime(__pyx_t_5numpy_int64_t __pyx_v_ti
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp); /*proto*/
-static PyObject *__pyx_pf_7tseries_to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp) {
+static PyObject *__pyx_pf_7tseries_24to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp); /*proto*/
+static PyObject *__pyx_pf_7tseries_24to_datetime(PyObject *__pyx_self, PyObject *__pyx_arg_timestamp) {
   __pyx_t_5numpy_int64_t __pyx_v_timestamp;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
@@ -13972,7 +14451,7 @@ static PyObject *__pyx_pf_7tseries_to_datetime(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":22
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":22
  *     return pydatetime.utcfromtimestamp(timestamp / 1000.0)
  * 
  * cpdef object to_timestamp(object dt):             # <<<<<<<<<<<<<<
@@ -13980,13 +14459,14 @@ static PyObject *__pyx_pf_7tseries_to_datetime(PyObject *__pyx_self, PyObject *_
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt); /*proto*/
+static PyObject *__pyx_pf_7tseries_25to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt); /*proto*/
 static  PyObject *__pyx_f_7tseries_to_timestamp(PyObject *__pyx_v_dt, int __pyx_skip_dispatch) {
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   __Pyx_RefNannySetupContext("to_timestamp");
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":23
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":23
  * 
  * cpdef object to_timestamp(object dt):
  *     return gmtime(dt)             # <<<<<<<<<<<<<<
@@ -13994,16 +14474,20 @@ static  PyObject *__pyx_f_7tseries_to_timestamp(PyObject *__pyx_v_dt, int __pyx_
  * def array_to_timestamp(ndarray[object, ndim=1] arr):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_to_py_npy_int64(__pyx_f_7tseries_gmtime(__pyx_v_dt)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = __pyx_v_dt;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyInt_to_py_npy_int64(__pyx_f_7tseries_gmtime(__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.to_timestamp");
   __pyx_r = 0;
   __pyx_L0:;
@@ -14012,7 +14496,7 @@ static  PyObject *__pyx_f_7tseries_to_timestamp(PyObject *__pyx_v_dt, int __pyx_
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":22
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":22
  *     return pydatetime.utcfromtimestamp(timestamp / 1000.0)
  * 
  * cpdef object to_timestamp(object dt):             # <<<<<<<<<<<<<<
@@ -14020,23 +14504,28 @@ static  PyObject *__pyx_f_7tseries_to_timestamp(PyObject *__pyx_v_dt, int __pyx_
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt); /*proto*/
-static PyObject *__pyx_pf_7tseries_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt) {
+static PyObject *__pyx_pf_7tseries_25to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt); /*proto*/
+static PyObject *__pyx_pf_7tseries_25to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_dt) {
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   __Pyx_RefNannySetupContext("to_timestamp");
   __pyx_self = __pyx_self;
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_7tseries_to_timestamp(__pyx_v_dt, 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __pyx_t_1 = __pyx_v_dt;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = __pyx_f_7tseries_to_timestamp(__pyx_t_1, 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_AddTraceback("tseries.to_timestamp");
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14045,7 +14534,7 @@ static PyObject *__pyx_pf_7tseries_to_timestamp(PyObject *__pyx_self, PyObject *
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":25
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":25
  *     return gmtime(dt)
  * 
  * def array_to_timestamp(ndarray[object, ndim=1] arr):             # <<<<<<<<<<<<<<
@@ -14053,8 +14542,9 @@ static PyObject *__pyx_pf_7tseries_to_timestamp(PyObject *__pyx_self, PyObject *
  *     cdef ndarray[int64_t, ndim=1] result
  */
 
-static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
-static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
+static PyObject *__pyx_pf_7tseries_26array_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_26array_to_timestamp = {__Pyx_NAMESTR("array_to_timestamp"), (PyCFunction)__pyx_pf_7tseries_26array_to_timestamp, METH_O, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_26array_to_timestamp(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
   int __pyx_v_i;
   int __pyx_v_n;
   PyArrayObject *__pyx_v_result;
@@ -14065,8 +14555,8 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   Py_ssize_t __pyx_bstride_0_result = 0;
   Py_ssize_t __pyx_bshape_0_result = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -14092,49 +14582,52 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
   __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":29
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":29
  *     cdef ndarray[int64_t, ndim=1] result
  * 
  *     n = len(arr)             # <<<<<<<<<<<<<<
  *     result = np.empty(n, dtype=np.int64)
  * 
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
+  __pyx_t_1 = __pyx_v_arr;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_n = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":30
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":30
  * 
  *     n = len(arr)
  *     result = np.empty(n, dtype=np.int64)             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < n:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
   __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = PyObject_GetAttr(__pyx_t_5, __pyx_n_s__int64); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_6) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
   {
@@ -14159,7 +14652,7 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   __pyx_v_result = ((PyArrayObject *)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":32
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":32
  *     result = np.empty(n, dtype=np.int64)
  * 
  *     for i from 0 <= i < n:             # <<<<<<<<<<<<<<
@@ -14169,7 +14662,7 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   __pyx_t_8 = __pyx_v_n;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":33
+    /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":33
  * 
  *     for i from 0 <= i < n:
  *         result[i] = gmtime(arr[i])             # <<<<<<<<<<<<<<
@@ -14202,7 +14695,7 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":35
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":35
  *         result[i] = gmtime(arr[i])
  * 
  *     return result             # <<<<<<<<<<<<<<
@@ -14217,7 +14710,7 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -14240,7 +14733,7 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
   return __pyx_r;
 }
 
-/* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":37
+/* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":37
  *     return result
  * 
  * def array_to_datetime(ndarray[int64_t, ndim=1] arr):             # <<<<<<<<<<<<<<
@@ -14248,8 +14741,9 @@ static PyObject *__pyx_pf_7tseries_array_to_timestamp(PyObject *__pyx_self, PyOb
  *     cdef ndarray[object, ndim=1] result
  */
 
-static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
-static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
+static PyObject *__pyx_pf_7tseries_27array_to_datetime(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
+static PyMethodDef __pyx_mdef_7tseries_27array_to_datetime = {__Pyx_NAMESTR("array_to_datetime"), (PyCFunction)__pyx_pf_7tseries_27array_to_datetime, METH_O, __Pyx_DOCSTR(0)};
+static PyObject *__pyx_pf_7tseries_27array_to_datetime(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
   int __pyx_v_i;
   int __pyx_v_n;
   PyArrayObject *__pyx_v_result;
@@ -14260,8 +14754,8 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   Py_ssize_t __pyx_bstride_0_result = 0;
   Py_ssize_t __pyx_bshape_0_result = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
@@ -14287,43 +14781,46 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
   __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":41
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":41
  *     cdef ndarray[object, ndim=1] result
  * 
  *     n = len(arr)             # <<<<<<<<<<<<<<
  *     result = np.empty(n, dtype=object)
  * 
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
+  __pyx_t_1 = __pyx_v_arr;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_v_n = __pyx_t_2;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":42
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":42
  * 
  *     n = len(arr)
  *     result = np.empty(n, dtype=object)             # <<<<<<<<<<<<<<
  * 
  *     for i from 0 <= i < n:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), __pyx_builtin_object) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_builtin_object) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
@@ -14348,7 +14845,7 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":44
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":44
  *     result = np.empty(n, dtype=object)
  * 
  *     for i from 0 <= i < n:             # <<<<<<<<<<<<<<
@@ -14358,7 +14855,7 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   __pyx_t_7 = __pyx_v_n;
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":45
+    /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":45
  * 
  *     for i from 0 <= i < n:
  *         result[i] = to_datetime(arr[i])             # <<<<<<<<<<<<<<
@@ -14395,7 +14892,7 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":47
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":47
  *         result[i] = to_datetime(arr[i])
  * 
  *     return result             # <<<<<<<<<<<<<<
@@ -14408,7 +14905,7 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
@@ -14430,7 +14927,7 @@ static PyObject *__pyx_pf_7tseries_array_to_datetime(PyObject *__pyx_self, PyObj
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":188
+/* "numpy.pxd":188
  *         # experimental exception made for __getbuffer__ and __releasebuffer__
  *         # -- the details of this may change.
  *         def __getbuffer__(ndarray self, Py_buffer* info, int flags):             # <<<<<<<<<<<<<<
@@ -14451,21 +14948,21 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   int __pyx_v_offset;
   int __pyx_v_hasfields;
   int __pyx_r;
-  int __pyx_t_1;
+  PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_4;
+  int __pyx_t_5;
   int __pyx_t_6;
   int __pyx_t_7;
-  int __pyx_t_8;
+  PyObject *__pyx_t_8 = NULL;
   char *__pyx_t_9;
   __Pyx_RefNannySetupContext("__getbuffer__");
   if (__pyx_v_info == NULL) return 0;
   __pyx_v_info->obj = Py_None; __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(__pyx_v_info->obj);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":194
+  /* "numpy.pxd":194
  *             # of flags
  *             cdef int copy_shape, i, ndim
  *             cdef int endian_detector = 1             # <<<<<<<<<<<<<<
@@ -14474,7 +14971,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_endian_detector = 1;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":195
+  /* "numpy.pxd":195
  *             cdef int copy_shape, i, ndim
  *             cdef int endian_detector = 1
  *             cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)             # <<<<<<<<<<<<<<
@@ -14483,26 +14980,29 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_little_endian = ((((char *)(&__pyx_v_endian_detector))[0]) != 0);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":197
+  /* "numpy.pxd":197
  *             cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)
  * 
  *             ndim = PyArray_NDIM(self)             # <<<<<<<<<<<<<<
  * 
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
  */
-  __pyx_v_ndim = PyArray_NDIM(((PyArrayObject *)__pyx_v_self));
+  __pyx_t_1 = __pyx_v_self;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_ndim = PyArray_NDIM(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":199
+  /* "numpy.pxd":199
  *             ndim = PyArray_NDIM(self)
  * 
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):             # <<<<<<<<<<<<<<
  *                 copy_shape = 1
  *             else:
  */
-  __pyx_t_1 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
-  if (__pyx_t_1) {
+  __pyx_t_2 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":200
+    /* "numpy.pxd":200
  * 
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
  *                 copy_shape = 1             # <<<<<<<<<<<<<<
@@ -14514,7 +15014,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":202
+    /* "numpy.pxd":202
  *                 copy_shape = 1
  *             else:
  *                 copy_shape = 0             # <<<<<<<<<<<<<<
@@ -14525,108 +15025,105 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   }
   __pyx_L5:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":204
+  /* "numpy.pxd":204
  *                 copy_shape = 0
  * 
  *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)             # <<<<<<<<<<<<<<
  *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):
  *                 raise ValueError(u"ndarray is not C contiguous")
  */
-  __pyx_t_1 = ((__pyx_v_flags & PyBUF_C_CONTIGUOUS) == PyBUF_C_CONTIGUOUS);
-  if (__pyx_t_1) {
+  __pyx_t_2 = ((__pyx_v_flags & PyBUF_C_CONTIGUOUS) == PyBUF_C_CONTIGUOUS);
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":205
+    /* "numpy.pxd":205
  * 
  *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
  *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):             # <<<<<<<<<<<<<<
  *                 raise ValueError(u"ndarray is not C contiguous")
  * 
  */
-    __pyx_t_2 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_v_self), NPY_C_CONTIGUOUS));
-    __pyx_t_3 = __pyx_t_2;
+    __pyx_t_1 = __pyx_v_self;
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_3 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_t_1), NPY_C_CONTIGUOUS));
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_4 = __pyx_t_3;
   } else {
-    __pyx_t_3 = __pyx_t_1;
+    __pyx_t_4 = __pyx_t_2;
   }
-  if (__pyx_t_3) {
+  if (__pyx_t_4) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":206
+    /* "numpy.pxd":206
  *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
  *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):
  *                 raise ValueError(u"ndarray is not C contiguous")             # <<<<<<<<<<<<<<
  * 
  *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
  */
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_u_6));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_6));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_6));
-    __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_Raise(__pyx_t_5, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_13), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_Raise(__pyx_t_1, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     {__pyx_filename = __pyx_f[8]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     goto __pyx_L6;
   }
   __pyx_L6:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":208
+  /* "numpy.pxd":208
  *                 raise ValueError(u"ndarray is not C contiguous")
  * 
  *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)             # <<<<<<<<<<<<<<
  *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):
  *                 raise ValueError(u"ndarray is not Fortran contiguous")
  */
-  __pyx_t_3 = ((__pyx_v_flags & PyBUF_F_CONTIGUOUS) == PyBUF_F_CONTIGUOUS);
-  if (__pyx_t_3) {
+  __pyx_t_4 = ((__pyx_v_flags & PyBUF_F_CONTIGUOUS) == PyBUF_F_CONTIGUOUS);
+  if (__pyx_t_4) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":209
+    /* "numpy.pxd":209
  * 
  *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
  *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):             # <<<<<<<<<<<<<<
  *                 raise ValueError(u"ndarray is not Fortran contiguous")
  * 
  */
-    __pyx_t_1 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_v_self), NPY_F_CONTIGUOUS));
-    __pyx_t_2 = __pyx_t_1;
+    __pyx_t_1 = __pyx_v_self;
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_t_2 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_t_1), NPY_F_CONTIGUOUS));
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_3 = __pyx_t_2;
   } else {
-    __pyx_t_2 = __pyx_t_3;
+    __pyx_t_3 = __pyx_t_4;
   }
-  if (__pyx_t_2) {
+  if (__pyx_t_3) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":210
+    /* "numpy.pxd":210
  *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
  *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):
  *                 raise ValueError(u"ndarray is not Fortran contiguous")             # <<<<<<<<<<<<<<
  * 
  *             info.buf = PyArray_DATA(self)
  */
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_u_7));
-    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_7));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_7));
-    __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_Raise(__pyx_t_4, 0, 0);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_15), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_Raise(__pyx_t_1, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     {__pyx_filename = __pyx_f[8]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     goto __pyx_L7;
   }
   __pyx_L7:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":212
+  /* "numpy.pxd":212
  *                 raise ValueError(u"ndarray is not Fortran contiguous")
  * 
  *             info.buf = PyArray_DATA(self)             # <<<<<<<<<<<<<<
  *             info.ndim = ndim
  *             if copy_shape:
  */
-  __pyx_v_info->buf = PyArray_DATA(((PyArrayObject *)__pyx_v_self));
+  __pyx_t_1 = __pyx_v_self;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_info->buf = PyArray_DATA(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":213
+  /* "numpy.pxd":213
  * 
  *             info.buf = PyArray_DATA(self)
  *             info.ndim = ndim             # <<<<<<<<<<<<<<
@@ -14635,7 +15132,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_info->ndim = __pyx_v_ndim;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":214
+  /* "numpy.pxd":214
  *             info.buf = PyArray_DATA(self)
  *             info.ndim = ndim
  *             if copy_shape:             # <<<<<<<<<<<<<<
@@ -14644,7 +15141,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   if (__pyx_v_copy_shape) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":217
+    /* "numpy.pxd":217
  *                 # Allocate new buffer for strides and shape info. This is allocated
  *                 # as one block, strides first.
  *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)             # <<<<<<<<<<<<<<
@@ -14653,7 +15150,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_info->strides = ((Py_ssize_t *)malloc((((sizeof(Py_ssize_t)) * __pyx_v_ndim) * 2)));
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":218
+    /* "numpy.pxd":218
  *                 # as one block, strides first.
  *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)
  *                 info.shape = info.strides + ndim             # <<<<<<<<<<<<<<
@@ -14662,60 +15159,72 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_info->shape = (__pyx_v_info->strides + __pyx_v_ndim);
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":219
+    /* "numpy.pxd":219
  *                 info.strides = <Py_ssize_t*>stdlib.malloc(sizeof(Py_ssize_t) * ndim * 2)
  *                 info.shape = info.strides + ndim
  *                 for i in range(ndim):             # <<<<<<<<<<<<<<
  *                     info.strides[i] = PyArray_STRIDES(self)[i]
  *                     info.shape[i] = PyArray_DIMS(self)[i]
  */
-    __pyx_t_6 = __pyx_v_ndim;
-    for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
-      __pyx_v_i = __pyx_t_7;
+    __pyx_t_5 = __pyx_v_ndim;
+    for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
+      __pyx_v_i = __pyx_t_6;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":220
+      /* "numpy.pxd":220
  *                 info.shape = info.strides + ndim
  *                 for i in range(ndim):
  *                     info.strides[i] = PyArray_STRIDES(self)[i]             # <<<<<<<<<<<<<<
  *                     info.shape[i] = PyArray_DIMS(self)[i]
  *             else:
  */
-      (__pyx_v_info->strides[__pyx_v_i]) = (PyArray_STRIDES(((PyArrayObject *)__pyx_v_self))[__pyx_v_i]);
+      __pyx_t_1 = __pyx_v_self;
+      __Pyx_INCREF(__pyx_t_1);
+      (__pyx_v_info->strides[__pyx_v_i]) = (PyArray_STRIDES(((PyArrayObject *)__pyx_t_1))[__pyx_v_i]);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":221
+      /* "numpy.pxd":221
  *                 for i in range(ndim):
  *                     info.strides[i] = PyArray_STRIDES(self)[i]
  *                     info.shape[i] = PyArray_DIMS(self)[i]             # <<<<<<<<<<<<<<
  *             else:
  *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
  */
-      (__pyx_v_info->shape[__pyx_v_i]) = (PyArray_DIMS(((PyArrayObject *)__pyx_v_self))[__pyx_v_i]);
+      __pyx_t_1 = __pyx_v_self;
+      __Pyx_INCREF(__pyx_t_1);
+      (__pyx_v_info->shape[__pyx_v_i]) = (PyArray_DIMS(((PyArrayObject *)__pyx_t_1))[__pyx_v_i]);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     }
     goto __pyx_L8;
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":223
+    /* "numpy.pxd":223
  *                     info.shape[i] = PyArray_DIMS(self)[i]
  *             else:
  *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)             # <<<<<<<<<<<<<<
  *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
  *             info.suboffsets = NULL
  */
-    __pyx_v_info->strides = ((Py_ssize_t *)PyArray_STRIDES(((PyArrayObject *)__pyx_v_self)));
+    __pyx_t_1 = __pyx_v_self;
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_v_info->strides = ((Py_ssize_t *)PyArray_STRIDES(((PyArrayObject *)__pyx_t_1)));
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":224
+    /* "numpy.pxd":224
  *             else:
  *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
  *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)             # <<<<<<<<<<<<<<
  *             info.suboffsets = NULL
  *             info.itemsize = PyArray_ITEMSIZE(self)
  */
-    __pyx_v_info->shape = ((Py_ssize_t *)PyArray_DIMS(((PyArrayObject *)__pyx_v_self)));
+    __pyx_t_1 = __pyx_v_self;
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_v_info->shape = ((Py_ssize_t *)PyArray_DIMS(((PyArrayObject *)__pyx_t_1)));
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
   __pyx_L8:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":225
+  /* "numpy.pxd":225
  *                 info.strides = <Py_ssize_t*>PyArray_STRIDES(self)
  *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
  *             info.suboffsets = NULL             # <<<<<<<<<<<<<<
@@ -14724,25 +15233,31 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_info->suboffsets = NULL;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":226
+  /* "numpy.pxd":226
  *                 info.shape = <Py_ssize_t*>PyArray_DIMS(self)
  *             info.suboffsets = NULL
  *             info.itemsize = PyArray_ITEMSIZE(self)             # <<<<<<<<<<<<<<
  *             info.readonly = not PyArray_ISWRITEABLE(self)
  * 
  */
-  __pyx_v_info->itemsize = PyArray_ITEMSIZE(((PyArrayObject *)__pyx_v_self));
+  __pyx_t_1 = __pyx_v_self;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_info->itemsize = PyArray_ITEMSIZE(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":227
+  /* "numpy.pxd":227
  *             info.suboffsets = NULL
  *             info.itemsize = PyArray_ITEMSIZE(self)
  *             info.readonly = not PyArray_ISWRITEABLE(self)             # <<<<<<<<<<<<<<
  * 
  *             cdef int t
  */
-  __pyx_v_info->readonly = (!PyArray_ISWRITEABLE(((PyArrayObject *)__pyx_v_self)));
+  __pyx_t_1 = __pyx_v_self;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_v_info->readonly = (!PyArray_ISWRITEABLE(((PyArrayObject *)__pyx_t_1)));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":230
+  /* "numpy.pxd":230
  * 
  *             cdef int t
  *             cdef char* f = NULL             # <<<<<<<<<<<<<<
@@ -14751,7 +15266,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_f = NULL;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":231
+  /* "numpy.pxd":231
  *             cdef int t
  *             cdef char* f = NULL
  *             cdef dtype descr = self.descr             # <<<<<<<<<<<<<<
@@ -14761,7 +15276,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_v_self)->descr));
   __pyx_v_descr = ((PyArrayObject *)__pyx_v_self)->descr;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":235
+  /* "numpy.pxd":235
  *             cdef int offset
  * 
  *             cdef bint hasfields = PyDataType_HASFIELDS(descr)             # <<<<<<<<<<<<<<
@@ -14770,23 +15285,23 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
   __pyx_v_hasfields = PyDataType_HASFIELDS(__pyx_v_descr);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":237
+  /* "numpy.pxd":237
  *             cdef bint hasfields = PyDataType_HASFIELDS(descr)
  * 
  *             if not hasfields and not copy_shape:             # <<<<<<<<<<<<<<
  *                 # do not call releasebuffer
  *                 info.obj = None
  */
-  __pyx_t_2 = (!__pyx_v_hasfields);
-  if (__pyx_t_2) {
-    __pyx_t_3 = (!__pyx_v_copy_shape);
-    __pyx_t_1 = __pyx_t_3;
+  __pyx_t_3 = (!__pyx_v_hasfields);
+  if (__pyx_t_3) {
+    __pyx_t_4 = (!__pyx_v_copy_shape);
+    __pyx_t_2 = __pyx_t_4;
   } else {
-    __pyx_t_1 = __pyx_t_2;
+    __pyx_t_2 = __pyx_t_3;
   }
-  if (__pyx_t_1) {
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":239
+    /* "numpy.pxd":239
  *             if not hasfields and not copy_shape:
  *                 # do not call releasebuffer
  *                 info.obj = None             # <<<<<<<<<<<<<<
@@ -14802,7 +15317,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":242
+    /* "numpy.pxd":242
  *             else:
  *                 # need to call releasebuffer
  *                 info.obj = self             # <<<<<<<<<<<<<<
@@ -14817,17 +15332,17 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   }
   __pyx_L11:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":244
+  /* "numpy.pxd":244
  *                 info.obj = self
  * 
  *             if not hasfields:             # <<<<<<<<<<<<<<
  *                 t = descr.type_num
  *                 if ((descr.byteorder == '>' and little_endian) or
  */
-  __pyx_t_1 = (!__pyx_v_hasfields);
-  if (__pyx_t_1) {
+  __pyx_t_2 = (!__pyx_v_hasfields);
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":245
+    /* "numpy.pxd":245
  * 
  *             if not hasfields:
  *                 t = descr.type_num             # <<<<<<<<<<<<<<
@@ -14836,312 +15351,306 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_t = __pyx_v_descr->type_num;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":246
+    /* "numpy.pxd":246
  *             if not hasfields:
  *                 t = descr.type_num
  *                 if ((descr.byteorder == '>' and little_endian) or             # <<<<<<<<<<<<<<
  *                     (descr.byteorder == '<' and not little_endian)):
  *                     raise ValueError(u"Non-native byte order not supported")
  */
-    __pyx_t_1 = (__pyx_v_descr->byteorder == '>');
-    if (__pyx_t_1) {
-      __pyx_t_2 = __pyx_v_little_endian;
+    __pyx_t_2 = (__pyx_v_descr->byteorder == '>');
+    if (__pyx_t_2) {
+      __pyx_t_3 = __pyx_v_little_endian;
     } else {
-      __pyx_t_2 = __pyx_t_1;
+      __pyx_t_3 = __pyx_t_2;
     }
-    if (!__pyx_t_2) {
+    if (!__pyx_t_3) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":247
+      /* "numpy.pxd":247
  *                 t = descr.type_num
  *                 if ((descr.byteorder == '>' and little_endian) or
  *                     (descr.byteorder == '<' and not little_endian)):             # <<<<<<<<<<<<<<
  *                     raise ValueError(u"Non-native byte order not supported")
  *                 if   t == NPY_BYTE:        f = "b"
  */
-      __pyx_t_1 = (__pyx_v_descr->byteorder == '<');
-      if (__pyx_t_1) {
-        __pyx_t_3 = (!__pyx_v_little_endian);
-        __pyx_t_8 = __pyx_t_3;
+      __pyx_t_2 = (__pyx_v_descr->byteorder == '<');
+      if (__pyx_t_2) {
+        __pyx_t_4 = (!__pyx_v_little_endian);
+        __pyx_t_7 = __pyx_t_4;
       } else {
-        __pyx_t_8 = __pyx_t_1;
+        __pyx_t_7 = __pyx_t_2;
       }
-      __pyx_t_1 = __pyx_t_8;
+      __pyx_t_2 = __pyx_t_7;
     } else {
-      __pyx_t_1 = __pyx_t_2;
+      __pyx_t_2 = __pyx_t_3;
     }
-    if (__pyx_t_1) {
+    if (__pyx_t_2) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":248
+      /* "numpy.pxd":248
  *                 if ((descr.byteorder == '>' and little_endian) or
  *                     (descr.byteorder == '<' and not little_endian)):
  *                     raise ValueError(u"Non-native byte order not supported")             # <<<<<<<<<<<<<<
  *                 if   t == NPY_BYTE:        f = "b"
  *                 elif t == NPY_UBYTE:       f = "B"
  */
-      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_8));
-      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_8));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_8));
-      __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __Pyx_Raise(__pyx_t_5, 0, 0);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_1 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_17), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_Raise(__pyx_t_1, 0, 0);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       {__pyx_filename = __pyx_f[8]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       goto __pyx_L13;
     }
     __pyx_L13:;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":249
+    /* "numpy.pxd":249
  *                     (descr.byteorder == '<' and not little_endian)):
  *                     raise ValueError(u"Non-native byte order not supported")
  *                 if   t == NPY_BYTE:        f = "b"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_UBYTE:       f = "B"
  *                 elif t == NPY_SHORT:       f = "h"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_BYTE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_BYTE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__b;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":250
+    /* "numpy.pxd":250
  *                     raise ValueError(u"Non-native byte order not supported")
  *                 if   t == NPY_BYTE:        f = "b"
  *                 elif t == NPY_UBYTE:       f = "B"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_SHORT:       f = "h"
  *                 elif t == NPY_USHORT:      f = "H"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_UBYTE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_UBYTE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__B;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":251
+    /* "numpy.pxd":251
  *                 if   t == NPY_BYTE:        f = "b"
  *                 elif t == NPY_UBYTE:       f = "B"
  *                 elif t == NPY_SHORT:       f = "h"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_USHORT:      f = "H"
  *                 elif t == NPY_INT:         f = "i"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_SHORT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_SHORT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__h;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":252
+    /* "numpy.pxd":252
  *                 elif t == NPY_UBYTE:       f = "B"
  *                 elif t == NPY_SHORT:       f = "h"
  *                 elif t == NPY_USHORT:      f = "H"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_INT:         f = "i"
  *                 elif t == NPY_UINT:        f = "I"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_USHORT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_USHORT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__H;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":253
+    /* "numpy.pxd":253
  *                 elif t == NPY_SHORT:       f = "h"
  *                 elif t == NPY_USHORT:      f = "H"
  *                 elif t == NPY_INT:         f = "i"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_UINT:        f = "I"
  *                 elif t == NPY_LONG:        f = "l"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_INT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_INT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__i;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":254
+    /* "numpy.pxd":254
  *                 elif t == NPY_USHORT:      f = "H"
  *                 elif t == NPY_INT:         f = "i"
  *                 elif t == NPY_UINT:        f = "I"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_LONG:        f = "l"
  *                 elif t == NPY_ULONG:       f = "L"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_UINT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_UINT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__I;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":255
+    /* "numpy.pxd":255
  *                 elif t == NPY_INT:         f = "i"
  *                 elif t == NPY_UINT:        f = "I"
  *                 elif t == NPY_LONG:        f = "l"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_ULONG:       f = "L"
  *                 elif t == NPY_LONGLONG:    f = "q"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_LONG);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_LONG);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__l;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":256
+    /* "numpy.pxd":256
  *                 elif t == NPY_UINT:        f = "I"
  *                 elif t == NPY_LONG:        f = "l"
  *                 elif t == NPY_ULONG:       f = "L"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_LONGLONG:    f = "q"
  *                 elif t == NPY_ULONGLONG:   f = "Q"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_ULONG);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_ULONG);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__L;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":257
+    /* "numpy.pxd":257
  *                 elif t == NPY_LONG:        f = "l"
  *                 elif t == NPY_ULONG:       f = "L"
  *                 elif t == NPY_LONGLONG:    f = "q"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_ULONGLONG:   f = "Q"
  *                 elif t == NPY_FLOAT:       f = "f"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_LONGLONG);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_LONGLONG);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__q;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":258
+    /* "numpy.pxd":258
  *                 elif t == NPY_ULONG:       f = "L"
  *                 elif t == NPY_LONGLONG:    f = "q"
  *                 elif t == NPY_ULONGLONG:   f = "Q"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_FLOAT:       f = "f"
  *                 elif t == NPY_DOUBLE:      f = "d"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_ULONGLONG);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_ULONGLONG);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__Q;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":259
+    /* "numpy.pxd":259
  *                 elif t == NPY_LONGLONG:    f = "q"
  *                 elif t == NPY_ULONGLONG:   f = "Q"
  *                 elif t == NPY_FLOAT:       f = "f"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_DOUBLE:      f = "d"
  *                 elif t == NPY_LONGDOUBLE:  f = "g"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_FLOAT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_FLOAT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__f;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":260
+    /* "numpy.pxd":260
  *                 elif t == NPY_ULONGLONG:   f = "Q"
  *                 elif t == NPY_FLOAT:       f = "f"
  *                 elif t == NPY_DOUBLE:      f = "d"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_LONGDOUBLE:  f = "g"
  *                 elif t == NPY_CFLOAT:      f = "Zf"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_DOUBLE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_DOUBLE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__d;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":261
+    /* "numpy.pxd":261
  *                 elif t == NPY_FLOAT:       f = "f"
  *                 elif t == NPY_DOUBLE:      f = "d"
  *                 elif t == NPY_LONGDOUBLE:  f = "g"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_CFLOAT:      f = "Zf"
  *                 elif t == NPY_CDOUBLE:     f = "Zd"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_LONGDOUBLE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_LONGDOUBLE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__g;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":262
+    /* "numpy.pxd":262
  *                 elif t == NPY_DOUBLE:      f = "d"
  *                 elif t == NPY_LONGDOUBLE:  f = "g"
  *                 elif t == NPY_CFLOAT:      f = "Zf"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_CDOUBLE:     f = "Zd"
  *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_CFLOAT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_CFLOAT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__Zf;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":263
+    /* "numpy.pxd":263
  *                 elif t == NPY_LONGDOUBLE:  f = "g"
  *                 elif t == NPY_CFLOAT:      f = "Zf"
  *                 elif t == NPY_CDOUBLE:     f = "Zd"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
  *                 elif t == NPY_OBJECT:      f = "O"
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_CDOUBLE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_CDOUBLE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__Zd;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":264
+    /* "numpy.pxd":264
  *                 elif t == NPY_CFLOAT:      f = "Zf"
  *                 elif t == NPY_CDOUBLE:     f = "Zd"
  *                 elif t == NPY_CLONGDOUBLE: f = "Zg"             # <<<<<<<<<<<<<<
  *                 elif t == NPY_OBJECT:      f = "O"
  *                 else:
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_CLONGDOUBLE);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_CLONGDOUBLE);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__Zg;
       goto __pyx_L14;
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":265
+    /* "numpy.pxd":265
  *                 elif t == NPY_CDOUBLE:     f = "Zd"
  *                 elif t == NPY_CLONGDOUBLE: f = "Zg"
  *                 elif t == NPY_OBJECT:      f = "O"             # <<<<<<<<<<<<<<
  *                 else:
  *                     raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)
  */
-    __pyx_t_1 = (__pyx_v_t == NPY_OBJECT);
-    if (__pyx_t_1) {
+    __pyx_t_2 = (__pyx_v_t == NPY_OBJECT);
+    if (__pyx_t_2) {
       __pyx_v_f = __pyx_k__O;
       goto __pyx_L14;
     }
     /*else*/ {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":267
+      /* "numpy.pxd":267
  *                 elif t == NPY_OBJECT:      f = "O"
  *                 else:
  *                     raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)             # <<<<<<<<<<<<<<
  *                 info.format = f
  *                 return
  */
-      __pyx_t_5 = PyInt_FromLong(__pyx_v_t); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_9), __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_4));
-      __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
-      __pyx_t_4 = 0;
-      __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_Raise(__pyx_t_4, 0, 0);
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_1 = PyInt_FromLong(__pyx_v_t); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_8 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_18), __pyx_t_1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_8));
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+      PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_t_8));
+      __Pyx_GIVEREF(((PyObject *)__pyx_t_8));
+      __pyx_t_8 = 0;
+      __pyx_t_8 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_1), NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+      __Pyx_Raise(__pyx_t_8, 0, 0);
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       {__pyx_filename = __pyx_f[8]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
     __pyx_L14:;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":268
+    /* "numpy.pxd":268
  *                 else:
  *                     raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)
  *                 info.format = f             # <<<<<<<<<<<<<<
@@ -15150,7 +15659,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_info->format = __pyx_v_f;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":269
+    /* "numpy.pxd":269
  *                     raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)
  *                 info.format = f
  *                 return             # <<<<<<<<<<<<<<
@@ -15163,7 +15672,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":271
+    /* "numpy.pxd":271
  *                 return
  *             else:
  *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)             # <<<<<<<<<<<<<<
@@ -15172,7 +15681,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_info->format = ((char *)malloc(255));
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":272
+    /* "numpy.pxd":272
  *             else:
  *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)
  *                 info.format[0] = '^' # Native data types, manual alignment             # <<<<<<<<<<<<<<
@@ -15181,7 +15690,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     (__pyx_v_info->format[0]) = '^';
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":273
+    /* "numpy.pxd":273
  *                 info.format = <char*>stdlib.malloc(_buffer_format_string_len)
  *                 info.format[0] = '^' # Native data types, manual alignment
  *                 offset = 0             # <<<<<<<<<<<<<<
@@ -15190,7 +15699,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  */
     __pyx_v_offset = 0;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":276
+    /* "numpy.pxd":276
  *                 f = _util_dtypestring(descr, info.format + 1,
  *                                       info.format + _buffer_format_string_len,
  *                                       &offset)             # <<<<<<<<<<<<<<
@@ -15200,7 +15709,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
     __pyx_t_9 = __pyx_f_5numpy__util_dtypestring(__pyx_v_descr, (__pyx_v_info->format + 1), (__pyx_v_info->format + 255), (&__pyx_v_offset)); if (unlikely(__pyx_t_9 == NULL)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 274; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __pyx_v_f = __pyx_t_9;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":277
+    /* "numpy.pxd":277
  *                                       info.format + _buffer_format_string_len,
  *                                       &offset)
  *                 f[0] = 0 # Terminate format string             # <<<<<<<<<<<<<<
@@ -15214,8 +15723,8 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_8);
   __Pyx_AddTraceback("numpy.ndarray.__getbuffer__");
   __pyx_r = -1;
   __Pyx_GOTREF(__pyx_v_info->obj);
@@ -15232,7 +15741,7 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":279
+/* "numpy.pxd":279
  *                 f[0] = 0 # Terminate format string
  * 
  *         def __releasebuffer__(ndarray self, Py_buffer* info):             # <<<<<<<<<<<<<<
@@ -15240,22 +15749,26 @@ static CYTHON_UNUSED int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_
  *                 stdlib.free(info.format)
  */
 
-static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info); /*proto*/
-static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info) {
-  int __pyx_t_1;
+static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray_1__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info); /*proto*/
+static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray_1__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info) {
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
   __Pyx_RefNannySetupContext("__releasebuffer__");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":280
+  /* "numpy.pxd":280
  * 
  *         def __releasebuffer__(ndarray self, Py_buffer* info):
  *             if PyArray_HASFIELDS(self):             # <<<<<<<<<<<<<<
  *                 stdlib.free(info.format)
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
  */
-  __pyx_t_1 = PyArray_HASFIELDS(((PyArrayObject *)__pyx_v_self));
-  if (__pyx_t_1) {
+  __pyx_t_1 = __pyx_v_self;
+  __Pyx_INCREF(__pyx_t_1);
+  __pyx_t_2 = PyArray_HASFIELDS(((PyArrayObject *)__pyx_t_1));
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":281
+    /* "numpy.pxd":281
  *         def __releasebuffer__(ndarray self, Py_buffer* info):
  *             if PyArray_HASFIELDS(self):
  *                 stdlib.free(info.format)             # <<<<<<<<<<<<<<
@@ -15267,17 +15780,17 @@ static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *_
   }
   __pyx_L5:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":282
+  /* "numpy.pxd":282
  *             if PyArray_HASFIELDS(self):
  *                 stdlib.free(info.format)
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):             # <<<<<<<<<<<<<<
  *                 stdlib.free(info.strides)
  *                 # info.shape was stored after info.strides in the same block
  */
-  __pyx_t_1 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
-  if (__pyx_t_1) {
+  __pyx_t_2 = ((sizeof(npy_intp)) != (sizeof(Py_ssize_t)));
+  if (__pyx_t_2) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":283
+    /* "numpy.pxd":283
  *                 stdlib.free(info.format)
  *             if sizeof(npy_intp) != sizeof(Py_ssize_t):
  *                 stdlib.free(info.strides)             # <<<<<<<<<<<<<<
@@ -15292,7 +15805,7 @@ static CYTHON_UNUSED void __pyx_pf_5numpy_7ndarray___releasebuffer__(PyObject *_
   __Pyx_RefNannyFinishContext();
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":756
+/* "numpy.pxd":756
  * ctypedef npy_cdouble     complex_t
  * 
  * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
@@ -15305,7 +15818,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__
   PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew1");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":757
+  /* "numpy.pxd":757
  * 
  * cdef inline object PyArray_MultiIterNew1(a):
  *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
@@ -15331,7 +15844,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":759
+/* "numpy.pxd":759
  *     return PyArray_MultiIterNew(1, <void*>a)
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
@@ -15344,7 +15857,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__
   PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew2");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":760
+  /* "numpy.pxd":760
  * 
  * cdef inline object PyArray_MultiIterNew2(a, b):
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
@@ -15370,7 +15883,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":762
+/* "numpy.pxd":762
  *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
@@ -15383,7 +15896,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__
   PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew3");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":763
+  /* "numpy.pxd":763
  * 
  * cdef inline object PyArray_MultiIterNew3(a, b, c):
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
@@ -15409,7 +15922,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":765
+/* "numpy.pxd":765
  *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
@@ -15422,7 +15935,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__
   PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew4");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":766
+  /* "numpy.pxd":766
  * 
  * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
@@ -15448,7 +15961,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":768
+/* "numpy.pxd":768
  *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
@@ -15461,7 +15974,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__
   PyObject *__pyx_t_1 = NULL;
   __Pyx_RefNannySetupContext("PyArray_MultiIterNew5");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":769
+  /* "numpy.pxd":769
  * 
  * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
@@ -15487,7 +16000,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":771
+/* "numpy.pxd":771
  *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
  * 
  * cdef inline char* _util_dtypestring(dtype descr, char* f, char* end, int* offset) except NULL:             # <<<<<<<<<<<<<<
@@ -15513,15 +16026,16 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
   int __pyx_t_7;
   int __pyx_t_8;
   int __pyx_t_9;
-  char *__pyx_t_10;
+  long __pyx_t_10;
+  char *__pyx_t_11;
   __Pyx_RefNannySetupContext("_util_dtypestring");
   __pyx_v_child = ((PyArray_Descr *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_fields = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_fields = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
   __pyx_v_childname = Py_None; __Pyx_INCREF(Py_None);
   __pyx_v_new_offset = Py_None; __Pyx_INCREF(Py_None);
   __pyx_v_t = Py_None; __Pyx_INCREF(Py_None);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":778
+  /* "numpy.pxd":778
  *     cdef int delta_offset
  *     cdef tuple i
  *     cdef int endian_detector = 1             # <<<<<<<<<<<<<<
@@ -15530,7 +16044,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
  */
   __pyx_v_endian_detector = 1;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":779
+  /* "numpy.pxd":779
  *     cdef tuple i
  *     cdef int endian_detector = 1
  *     cdef bint little_endian = ((<char*>&endian_detector)[0] != 0)             # <<<<<<<<<<<<<<
@@ -15539,18 +16053,17 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
  */
   __pyx_v_little_endian = ((((char *)(&__pyx_v_endian_detector))[0]) != 0);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":782
+  /* "numpy.pxd":782
  *     cdef tuple fields
  * 
  *     for childname in descr.names:             # <<<<<<<<<<<<<<
  *         fields = descr.fields[childname]
  *         child, new_offset = fields
  */
-  if (likely(((PyObject *)__pyx_v_descr->names) != Py_None)) {
-    __pyx_t_1 = 0; __pyx_t_2 = ((PyObject *)__pyx_v_descr->names); __Pyx_INCREF(__pyx_t_2);
-  } else {
-    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[8]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(__pyx_v_descr->names == Py_None)) {
+    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable"); {__pyx_filename = __pyx_f[8]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
   }
+  __pyx_t_1 = 0; __pyx_t_2 = ((PyObject *)__pyx_v_descr->names); __Pyx_INCREF(__pyx_t_2);
   for (;;) {
     if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
     __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_1); __Pyx_INCREF(__pyx_t_3); __pyx_t_1++;
@@ -15558,7 +16071,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     __pyx_v_childname = __pyx_t_3;
     __pyx_t_3 = 0;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":783
+    /* "numpy.pxd":783
  * 
  *     for childname in descr.names:
  *         fields = descr.fields[childname]             # <<<<<<<<<<<<<<
@@ -15569,10 +16082,10 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     __Pyx_GOTREF(__pyx_t_3);
     if (!(likely(PyTuple_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected tuple, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_fields));
-    __pyx_v_fields = ((PyObject *)__pyx_t_3);
+    __pyx_v_fields = ((PyObject*)__pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":784
+    /* "numpy.pxd":784
  *     for childname in descr.names:
  *         fields = descr.fields[childname]
  *         child, new_offset = fields             # <<<<<<<<<<<<<<
@@ -15595,7 +16108,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
       {__pyx_filename = __pyx_f[8]; __pyx_lineno = 784; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":786
+    /* "numpy.pxd":786
  *         child, new_offset = fields
  * 
  *         if (end - f) - (new_offset - offset[0]) < 15:             # <<<<<<<<<<<<<<
@@ -15620,29 +16133,23 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (__pyx_t_6) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":787
+      /* "numpy.pxd":787
  * 
  *         if (end - f) - (new_offset - offset[0]) < 15:
  *             raise RuntimeError(u"Format string allocated too short, see comment in numpy.pxd")             # <<<<<<<<<<<<<<
  * 
  *         if ((child.byteorder == '>' and little_endian) or
  */
-      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_Call(__pyx_builtin_RuntimeError, ((PyObject *)__pyx_k_tuple_20), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_10));
-      PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_10));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_10));
-      __pyx_t_3 = PyObject_Call(__pyx_builtin_RuntimeError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_Raise(__pyx_t_5, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_Raise(__pyx_t_3, 0, 0);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       {__pyx_filename = __pyx_f[8]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       goto __pyx_L5;
     }
     __pyx_L5:;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":789
+    /* "numpy.pxd":789
  *             raise RuntimeError(u"Format string allocated too short, see comment in numpy.pxd")
  * 
  *         if ((child.byteorder == '>' and little_endian) or             # <<<<<<<<<<<<<<
@@ -15657,7 +16164,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     }
     if (!__pyx_t_7) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":790
+      /* "numpy.pxd":790
  * 
  *         if ((child.byteorder == '>' and little_endian) or
  *             (child.byteorder == '<' and not little_endian)):             # <<<<<<<<<<<<<<
@@ -15677,21 +16184,15 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     }
     if (__pyx_t_6) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":791
+      /* "numpy.pxd":791
  *         if ((child.byteorder == '>' and little_endian) or
  *             (child.byteorder == '<' and not little_endian)):
  *             raise ValueError(u"Non-native byte order not supported")             # <<<<<<<<<<<<<<
  *             # One could encode it in the format string and have Cython
  *             # complain instead, BUT: < and > in format strings also imply
  */
-      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_8));
-      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_8));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_8));
-      __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_21), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_Raise(__pyx_t_5, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       {__pyx_filename = __pyx_f[8]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -15699,7 +16200,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     }
     __pyx_L6:;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":801
+    /* "numpy.pxd":801
  * 
  *         # Output padding bytes
  *         while offset[0] < new_offset:             # <<<<<<<<<<<<<<
@@ -15716,7 +16217,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (!__pyx_t_6) break;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":802
+      /* "numpy.pxd":802
  *         # Output padding bytes
  *         while offset[0] < new_offset:
  *             f[0] = 120 # "x"; pad byte             # <<<<<<<<<<<<<<
@@ -15725,35 +16226,37 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
  */
       (__pyx_v_f[0]) = 120;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":803
+      /* "numpy.pxd":803
  *         while offset[0] < new_offset:
  *             f[0] = 120 # "x"; pad byte
  *             f += 1             # <<<<<<<<<<<<<<
  *             offset[0] += 1
  * 
  */
-      __pyx_v_f += 1;
+      __pyx_v_f = (__pyx_v_f + 1);
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":804
+      /* "numpy.pxd":804
  *             f[0] = 120 # "x"; pad byte
  *             f += 1
  *             offset[0] += 1             # <<<<<<<<<<<<<<
  * 
  *         offset[0] += child.itemsize
  */
-      (__pyx_v_offset[0]) += 1;
+      __pyx_t_10 = 0;
+      (__pyx_v_offset[__pyx_t_10]) = ((__pyx_v_offset[__pyx_t_10]) + 1);
     }
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":806
+    /* "numpy.pxd":806
  *             offset[0] += 1
  * 
  *         offset[0] += child.itemsize             # <<<<<<<<<<<<<<
  * 
  *         if not PyDataType_HASFIELDS(child):
  */
-    (__pyx_v_offset[0]) += __pyx_v_child->elsize;
+    __pyx_t_10 = 0;
+    (__pyx_v_offset[__pyx_t_10]) = ((__pyx_v_offset[__pyx_t_10]) + __pyx_v_child->elsize);
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":808
+    /* "numpy.pxd":808
  *         offset[0] += child.itemsize
  * 
  *         if not PyDataType_HASFIELDS(child):             # <<<<<<<<<<<<<<
@@ -15763,7 +16266,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
     __pyx_t_6 = (!PyDataType_HASFIELDS(__pyx_v_child));
     if (__pyx_t_6) {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":809
+      /* "numpy.pxd":809
  * 
  *         if not PyDataType_HASFIELDS(child):
  *             t = child.type_num             # <<<<<<<<<<<<<<
@@ -15776,7 +16279,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
       __pyx_v_t = __pyx_t_3;
       __pyx_t_3 = 0;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":810
+      /* "numpy.pxd":810
  *         if not PyDataType_HASFIELDS(child):
  *             t = child.type_num
  *             if end - f < 5:             # <<<<<<<<<<<<<<
@@ -15786,408 +16289,402 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
       __pyx_t_6 = ((__pyx_v_end - __pyx_v_f) < 5);
       if (__pyx_t_6) {
 
-        /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":811
+        /* "numpy.pxd":811
  *             t = child.type_num
  *             if end - f < 5:
  *                 raise RuntimeError(u"Format string allocated too short.")             # <<<<<<<<<<<<<<
  * 
  *             # Until ticket #99 is fixed, use integers to avoid warnings
  */
-        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_3 = PyObject_Call(__pyx_builtin_RuntimeError, ((PyObject *)__pyx_k_tuple_23), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_3);
-        __Pyx_INCREF(((PyObject *)__pyx_kp_u_11));
-        PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_11));
-        __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_11));
-        __pyx_t_5 = PyObject_Call(__pyx_builtin_RuntimeError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_Raise(__pyx_t_3, 0, 0);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __Pyx_Raise(__pyx_t_5, 0, 0);
-        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         {__pyx_filename = __pyx_f[8]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         goto __pyx_L10;
       }
       __pyx_L10:;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":814
+      /* "numpy.pxd":814
  * 
  *             # Until ticket #99 is fixed, use integers to avoid warnings
  *             if   t == NPY_BYTE:        f[0] =  98 #"b"             # <<<<<<<<<<<<<<
  *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
  *             elif t == NPY_SHORT:       f[0] = 104 #"h"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_BYTE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_BYTE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 98;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":815
+      /* "numpy.pxd":815
  *             # Until ticket #99 is fixed, use integers to avoid warnings
  *             if   t == NPY_BYTE:        f[0] =  98 #"b"
  *             elif t == NPY_UBYTE:       f[0] =  66 #"B"             # <<<<<<<<<<<<<<
  *             elif t == NPY_SHORT:       f[0] = 104 #"h"
  *             elif t == NPY_USHORT:      f[0] =  72 #"H"
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_UBYTE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_UBYTE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 815; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 66;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":816
+      /* "numpy.pxd":816
  *             if   t == NPY_BYTE:        f[0] =  98 #"b"
  *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
  *             elif t == NPY_SHORT:       f[0] = 104 #"h"             # <<<<<<<<<<<<<<
  *             elif t == NPY_USHORT:      f[0] =  72 #"H"
  *             elif t == NPY_INT:         f[0] = 105 #"i"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_SHORT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_SHORT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 104;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":817
+      /* "numpy.pxd":817
  *             elif t == NPY_UBYTE:       f[0] =  66 #"B"
  *             elif t == NPY_SHORT:       f[0] = 104 #"h"
  *             elif t == NPY_USHORT:      f[0] =  72 #"H"             # <<<<<<<<<<<<<<
  *             elif t == NPY_INT:         f[0] = 105 #"i"
  *             elif t == NPY_UINT:        f[0] =  73 #"I"
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_USHORT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_USHORT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 72;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":818
+      /* "numpy.pxd":818
  *             elif t == NPY_SHORT:       f[0] = 104 #"h"
  *             elif t == NPY_USHORT:      f[0] =  72 #"H"
  *             elif t == NPY_INT:         f[0] = 105 #"i"             # <<<<<<<<<<<<<<
  *             elif t == NPY_UINT:        f[0] =  73 #"I"
  *             elif t == NPY_LONG:        f[0] = 108 #"l"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_INT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_INT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 818; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 105;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":819
+      /* "numpy.pxd":819
  *             elif t == NPY_USHORT:      f[0] =  72 #"H"
  *             elif t == NPY_INT:         f[0] = 105 #"i"
  *             elif t == NPY_UINT:        f[0] =  73 #"I"             # <<<<<<<<<<<<<<
  *             elif t == NPY_LONG:        f[0] = 108 #"l"
  *             elif t == NPY_ULONG:       f[0] = 76  #"L"
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_UINT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_UINT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 73;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":820
+      /* "numpy.pxd":820
  *             elif t == NPY_INT:         f[0] = 105 #"i"
  *             elif t == NPY_UINT:        f[0] =  73 #"I"
  *             elif t == NPY_LONG:        f[0] = 108 #"l"             # <<<<<<<<<<<<<<
  *             elif t == NPY_ULONG:       f[0] = 76  #"L"
  *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_LONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_LONG); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 820; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 108;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":821
+      /* "numpy.pxd":821
  *             elif t == NPY_UINT:        f[0] =  73 #"I"
  *             elif t == NPY_LONG:        f[0] = 108 #"l"
  *             elif t == NPY_ULONG:       f[0] = 76  #"L"             # <<<<<<<<<<<<<<
  *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
  *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_ULONG); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_ULONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 821; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 76;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":822
+      /* "numpy.pxd":822
  *             elif t == NPY_LONG:        f[0] = 108 #"l"
  *             elif t == NPY_ULONG:       f[0] = 76  #"L"
  *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"             # <<<<<<<<<<<<<<
  *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
  *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_LONGLONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_LONGLONG); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 822; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 113;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":823
+      /* "numpy.pxd":823
  *             elif t == NPY_ULONG:       f[0] = 76  #"L"
  *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
  *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"             # <<<<<<<<<<<<<<
  *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
  *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_ULONGLONG); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_ULONGLONG); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 81;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":824
+      /* "numpy.pxd":824
  *             elif t == NPY_LONGLONG:    f[0] = 113 #"q"
  *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
  *             elif t == NPY_FLOAT:       f[0] = 102 #"f"             # <<<<<<<<<<<<<<
  *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
  *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_FLOAT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_FLOAT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 824; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 102;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":825
+      /* "numpy.pxd":825
  *             elif t == NPY_ULONGLONG:   f[0] = 81  #"Q"
  *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
  *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"             # <<<<<<<<<<<<<<
  *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
  *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_DOUBLE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_DOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 100;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":826
+      /* "numpy.pxd":826
  *             elif t == NPY_FLOAT:       f[0] = 102 #"f"
  *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
  *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"             # <<<<<<<<<<<<<<
  *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
  *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_LONGDOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_LONGDOUBLE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 826; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 103;
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":827
+      /* "numpy.pxd":827
  *             elif t == NPY_DOUBLE:      f[0] = 100 #"d"
  *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
  *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf             # <<<<<<<<<<<<<<
  *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
  *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_CFLOAT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_CFLOAT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 827; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 90;
         (__pyx_v_f[1]) = 102;
-        __pyx_v_f += 1;
+        __pyx_v_f = (__pyx_v_f + 1);
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":828
+      /* "numpy.pxd":828
  *             elif t == NPY_LONGDOUBLE:  f[0] = 103 #"g"
  *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
  *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd             # <<<<<<<<<<<<<<
  *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
  *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_CDOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_CDOUBLE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 828; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 90;
         (__pyx_v_f[1]) = 100;
-        __pyx_v_f += 1;
+        __pyx_v_f = (__pyx_v_f + 1);
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":829
+      /* "numpy.pxd":829
  *             elif t == NPY_CFLOAT:      f[0] = 90; f[1] = 102; f += 1 # Zf
  *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
  *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg             # <<<<<<<<<<<<<<
  *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
  *             else:
  */
-      __pyx_t_3 = PyInt_FromLong(NPY_CLONGDOUBLE); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyInt_FromLong(NPY_CLONGDOUBLE); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 829; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 90;
         (__pyx_v_f[1]) = 103;
-        __pyx_v_f += 1;
+        __pyx_v_f = (__pyx_v_f + 1);
         goto __pyx_L11;
       }
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":830
+      /* "numpy.pxd":830
  *             elif t == NPY_CDOUBLE:     f[0] = 90; f[1] = 100; f += 1 # Zd
  *             elif t == NPY_CLONGDOUBLE: f[0] = 90; f[1] = 103; f += 1 # Zg
  *             elif t == NPY_OBJECT:      f[0] = 79 #"O"             # <<<<<<<<<<<<<<
  *             else:
  *                 raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)
  */
-      __pyx_t_5 = PyInt_FromLong(NPY_OBJECT); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_t, __pyx_t_5, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_3 = PyInt_FromLong(NPY_OBJECT); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_t, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 830; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_6) {
         (__pyx_v_f[0]) = 79;
         goto __pyx_L11;
       }
       /*else*/ {
 
-        /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":832
+        /* "numpy.pxd":832
  *             elif t == NPY_OBJECT:      f[0] = 79 #"O"
  *             else:
  *                 raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)             # <<<<<<<<<<<<<<
  *             f += 1
  *         else:
  */
-        __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_9), __pyx_v_t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_5 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_18), __pyx_v_t); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(((PyObject *)__pyx_t_5));
+        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_t_5));
+        __Pyx_GIVEREF(((PyObject *)__pyx_t_5));
+        __pyx_t_5 = 0;
+        __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_3), NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_5);
-        PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_t_3));
-        __Pyx_GIVEREF(((PyObject *)__pyx_t_3));
-        __pyx_t_3 = 0;
-        __pyx_t_3 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
+        __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+        __Pyx_Raise(__pyx_t_5, 0, 0);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __Pyx_Raise(__pyx_t_3, 0, 0);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         {__pyx_filename = __pyx_f[8]; __pyx_lineno = 832; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
       __pyx_L11:;
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":833
+      /* "numpy.pxd":833
  *             else:
  *                 raise ValueError(u"unknown dtype code in numpy.pxd (%d)" % t)
  *             f += 1             # <<<<<<<<<<<<<<
  *         else:
  *             # Cython ignores struct boundary information ("T{...}"),
  */
-      __pyx_v_f += 1;
+      __pyx_v_f = (__pyx_v_f + 1);
       goto __pyx_L9;
     }
     /*else*/ {
 
-      /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":837
+      /* "numpy.pxd":837
  *             # Cython ignores struct boundary information ("T{...}"),
  *             # so don't output it
  *             f = _util_dtypestring(child, f, end, offset)             # <<<<<<<<<<<<<<
  *     return f
  * 
  */
-      __pyx_t_10 = __pyx_f_5numpy__util_dtypestring(__pyx_v_child, __pyx_v_f, __pyx_v_end, __pyx_v_offset); if (unlikely(__pyx_t_10 == NULL)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 837; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __pyx_v_f = __pyx_t_10;
+      __pyx_t_11 = __pyx_f_5numpy__util_dtypestring(__pyx_v_child, __pyx_v_f, __pyx_v_end, __pyx_v_offset); if (unlikely(__pyx_t_11 == NULL)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 837; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_v_f = __pyx_t_11;
     }
     __pyx_L9:;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":838
+  /* "numpy.pxd":838
  *             # so don't output it
  *             f = _util_dtypestring(child, f, end, offset)
  *     return f             # <<<<<<<<<<<<<<
@@ -16216,7 +16713,7 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
   return __pyx_r;
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":953
+/* "numpy.pxd":953
  * 
  * 
  * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
@@ -16227,9 +16724,10 @@ static CYTHON_INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx
 static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
   PyObject *__pyx_v_baseptr;
   int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
   __Pyx_RefNannySetupContext("set_array_base");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":955
+  /* "numpy.pxd":955
  * cdef inline void set_array_base(ndarray arr, object base):
  *      cdef PyObject* baseptr
  *      if base is None:             # <<<<<<<<<<<<<<
@@ -16239,7 +16737,7 @@ static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_a
   __pyx_t_1 = (__pyx_v_base == Py_None);
   if (__pyx_t_1) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":956
+    /* "numpy.pxd":956
  *      cdef PyObject* baseptr
  *      if base is None:
  *          baseptr = NULL             # <<<<<<<<<<<<<<
@@ -16251,16 +16749,19 @@ static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_a
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":958
+    /* "numpy.pxd":958
  *          baseptr = NULL
  *      else:
  *          Py_INCREF(base) # important to do this before decref below!             # <<<<<<<<<<<<<<
  *          baseptr = <PyObject*>base
  *      Py_XDECREF(arr.base)
  */
-    Py_INCREF(__pyx_v_base);
+    __pyx_t_2 = __pyx_v_base;
+    __Pyx_INCREF(__pyx_t_2);
+    Py_INCREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":959
+    /* "numpy.pxd":959
  *      else:
  *          Py_INCREF(base) # important to do this before decref below!
  *          baseptr = <PyObject*>base             # <<<<<<<<<<<<<<
@@ -16271,7 +16772,7 @@ static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_a
   }
   __pyx_L3:;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":960
+  /* "numpy.pxd":960
  *          Py_INCREF(base) # important to do this before decref below!
  *          baseptr = <PyObject*>base
  *      Py_XDECREF(arr.base)             # <<<<<<<<<<<<<<
@@ -16280,7 +16781,7 @@ static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_a
  */
   Py_XDECREF(__pyx_v_arr->base);
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":961
+  /* "numpy.pxd":961
  *          baseptr = <PyObject*>base
  *      Py_XDECREF(arr.base)
  *      arr.base = baseptr             # <<<<<<<<<<<<<<
@@ -16292,7 +16793,7 @@ static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_a
   __Pyx_RefNannyFinishContext();
 }
 
-/* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":963
+/* "numpy.pxd":963
  *      arr.base = baseptr
  * 
  * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
@@ -16305,7 +16806,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__py
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("get_array_base");
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":964
+  /* "numpy.pxd":964
  * 
  * cdef inline object get_array_base(ndarray arr):
  *     if arr.base is NULL:             # <<<<<<<<<<<<<<
@@ -16315,7 +16816,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__py
   __pyx_t_1 = (__pyx_v_arr->base == NULL);
   if (__pyx_t_1) {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":965
+    /* "numpy.pxd":965
  * cdef inline object get_array_base(ndarray arr):
  *     if arr.base is NULL:
  *         return None             # <<<<<<<<<<<<<<
@@ -16330,7 +16831,7 @@ static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__py
   }
   /*else*/ {
 
-    /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/numpy.pxd":967
+    /* "numpy.pxd":967
  *         return None
  *     else:
  *         return <object>arr.base             # <<<<<<<<<<<<<<
@@ -16354,8 +16855,8 @@ static PyObject *__pyx_tp_new_7tseries_Node(PyTypeObject *t, PyObject *a, PyObje
   PyObject *o = (*t->tp_alloc)(t, 0);
   if (!o) return 0;
   p = ((struct __pyx_obj_7tseries_Node *)o);
-  p->next = ((PyObject *)Py_None); Py_INCREF(Py_None);
-  p->width = ((PyObject *)Py_None); Py_INCREF(Py_None);
+  p->next = ((PyObject*)Py_None); Py_INCREF(Py_None);
+  p->width = ((PyObject*)Py_None); Py_INCREF(Py_None);
   return o;
 }
 
@@ -16382,10 +16883,10 @@ static int __pyx_tp_clear_7tseries_Node(PyObject *o) {
   struct __pyx_obj_7tseries_Node *p = (struct __pyx_obj_7tseries_Node *)o;
   PyObject* tmp;
   tmp = ((PyObject*)p->next);
-  p->next = ((PyObject *)Py_None); Py_INCREF(Py_None);
+  p->next = ((PyObject*)Py_None); Py_INCREF(Py_None);
   Py_XDECREF(tmp);
   tmp = ((PyObject*)p->width);
-  p->width = ((PyObject *)Py_None); Py_INCREF(Py_None);
+  p->width = ((PyObject*)Py_None); Py_INCREF(Py_None);
   Py_XDECREF(tmp);
   return 0;
 }
@@ -16396,7 +16897,7 @@ static PyObject *__pyx_getprop_7tseries_4Node_value(PyObject *o, void *x) {
 
 static int __pyx_setprop_7tseries_4Node_value(PyObject *o, PyObject *v, void *x) {
   if (v) {
-    return __pyx_pf_7tseries_4Node_5value___set__(o, v);
+    return __pyx_pf_7tseries_4Node_5value_1__set__(o, v);
   }
   else {
     PyErr_SetString(PyExc_NotImplementedError, "__del__");
@@ -16410,10 +16911,10 @@ static PyObject *__pyx_getprop_7tseries_4Node_next(PyObject *o, void *x) {
 
 static int __pyx_setprop_7tseries_4Node_next(PyObject *o, PyObject *v, void *x) {
   if (v) {
-    return __pyx_pf_7tseries_4Node_4next___set__(o, v);
+    return __pyx_pf_7tseries_4Node_4next_1__set__(o, v);
   }
   else {
-    return __pyx_pf_7tseries_4Node_4next___del__(o);
+    return __pyx_pf_7tseries_4Node_4next_2__del__(o);
   }
 }
 
@@ -16423,10 +16924,10 @@ static PyObject *__pyx_getprop_7tseries_4Node_width(PyObject *o, void *x) {
 
 static int __pyx_setprop_7tseries_4Node_width(PyObject *o, PyObject *v, void *x) {
   if (v) {
-    return __pyx_pf_7tseries_4Node_5width___set__(o, v);
+    return __pyx_pf_7tseries_4Node_5width_1__set__(o, v);
   }
   else {
-    return __pyx_pf_7tseries_4Node_5width___del__(o);
+    return __pyx_pf_7tseries_4Node_5width_2__del__(o);
   }
 }
 
@@ -16539,7 +17040,7 @@ static PyBufferProcs __pyx_tp_as_buffer_Node = {
   #endif
 };
 
-PyTypeObject __pyx_type_7tseries_Node = {
+static PyTypeObject __pyx_type_7tseries_Node = {
   PyVarObject_HEAD_INIT(0, 0)
   __Pyx_NAMESTR("tseries.Node"), /*tp_name*/
   sizeof(struct __pyx_obj_7tseries_Node), /*tp_basicsize*/
@@ -16563,7 +17064,7 @@ PyTypeObject __pyx_type_7tseries_Node = {
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   &__pyx_tp_as_buffer_Node, /*tp_as_buffer*/
-  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
   __pyx_tp_traverse_7tseries_Node, /*tp_traverse*/
   __pyx_tp_clear_7tseries_Node, /*tp_clear*/
@@ -16638,9 +17139,9 @@ static PyObject *__pyx_sq_item_7tseries_IndexableSkiplist(PyObject *o, Py_ssize_
 }
 
 static PyMethodDef __pyx_methods_7tseries_IndexableSkiplist[] = {
-  {__Pyx_NAMESTR("get"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_get, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("insert"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_insert, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("remove"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_remove, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("get"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_3get, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("insert"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_4insert, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("remove"), (PyCFunction)__pyx_pf_7tseries_17IndexableSkiplist_5remove, METH_O, __Pyx_DOCSTR(0)},
   {0, 0, 0, 0}
 };
 
@@ -16703,7 +17204,7 @@ static PyNumberMethods __pyx_tp_as_number_IndexableSkiplist = {
 };
 
 static PySequenceMethods __pyx_tp_as_sequence_IndexableSkiplist = {
-  __pyx_pf_7tseries_17IndexableSkiplist___len__, /*sq_length*/
+  __pyx_pf_7tseries_17IndexableSkiplist_1__len__, /*sq_length*/
   0, /*sq_concat*/
   0, /*sq_repeat*/
   __pyx_sq_item_7tseries_IndexableSkiplist, /*sq_item*/
@@ -16716,8 +17217,8 @@ static PySequenceMethods __pyx_tp_as_sequence_IndexableSkiplist = {
 };
 
 static PyMappingMethods __pyx_tp_as_mapping_IndexableSkiplist = {
-  __pyx_pf_7tseries_17IndexableSkiplist___len__, /*mp_length*/
-  __pyx_pf_7tseries_17IndexableSkiplist___getitem__, /*mp_subscript*/
+  __pyx_pf_7tseries_17IndexableSkiplist_1__len__, /*mp_length*/
+  __pyx_pf_7tseries_17IndexableSkiplist_2__getitem__, /*mp_subscript*/
   0, /*mp_ass_subscript*/
 };
 
@@ -16742,7 +17243,7 @@ static PyBufferProcs __pyx_tp_as_buffer_IndexableSkiplist = {
   #endif
 };
 
-PyTypeObject __pyx_type_7tseries_IndexableSkiplist = {
+static PyTypeObject __pyx_type_7tseries_IndexableSkiplist = {
   PyVarObject_HEAD_INIT(0, 0)
   __Pyx_NAMESTR("tseries.IndexableSkiplist"), /*tp_name*/
   sizeof(struct __pyx_obj_7tseries_IndexableSkiplist), /*tp_basicsize*/
@@ -16766,7 +17267,7 @@ PyTypeObject __pyx_type_7tseries_IndexableSkiplist = {
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   &__pyx_tp_as_buffer_IndexableSkiplist, /*tp_as_buffer*/
-  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   __Pyx_DOCSTR("\n    Sorted collection supporting O(lg n) insertion, removal, and\n    lookup by rank.\n    "), /*tp_doc*/
   __pyx_tp_traverse_7tseries_IndexableSkiplist, /*tp_traverse*/
   __pyx_tp_clear_7tseries_IndexableSkiplist, /*tp_clear*/
@@ -16800,33 +17301,9 @@ PyTypeObject __pyx_type_7tseries_IndexableSkiplist = {
 
 static PyMethodDef __pyx_methods[] = {
   {__Pyx_NAMESTR("map_indices"), (PyCFunction)__pyx_pf_7tseries_map_indices, METH_O, __Pyx_DOCSTR(__pyx_doc_7tseries_map_indices)},
-  {__Pyx_NAMESTR("isAllDates"), (PyCFunction)__pyx_pf_7tseries_isAllDates, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("isAllDates2"), (PyCFunction)__pyx_pf_7tseries_isAllDates2, METH_O, __Pyx_DOCSTR(__pyx_doc_7tseries_isAllDates2)},
-  {__Pyx_NAMESTR("checknull"), (PyCFunction)__pyx_pf_7tseries_checknull, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("isnullobj"), (PyCFunction)__pyx_pf_7tseries_isnullobj, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("arrmap"), (PyCFunction)__pyx_pf_7tseries_arrmap, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("groupby"), (PyCFunction)__pyx_pf_7tseries_groupby, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("groupby_indices"), (PyCFunction)__pyx_pf_7tseries_groupby_indices, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("kth_smallest"), (PyCFunction)__pyx_pf_7tseries_kth_smallest, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("median"), (PyCFunction)__pyx_pf_7tseries_median, METH_O, __Pyx_DOCSTR(__pyx_doc_7tseries_median)},
-  {__Pyx_NAMESTR("roll_sum"), (PyCFunction)__pyx_pf_7tseries_roll_sum, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("roll_mean"), (PyCFunction)__pyx_pf_7tseries_roll_mean, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("ewma"), (PyCFunction)__pyx_pf_7tseries_ewma, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_ewma)},
-  {__Pyx_NAMESTR("roll_var"), (PyCFunction)__pyx_pf_7tseries_roll_var, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("roll_skew"), (PyCFunction)__pyx_pf_7tseries_roll_skew, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("roll_kurt"), (PyCFunction)__pyx_pf_7tseries_roll_kurt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("roll_median"), (PyCFunction)__pyx_pf_7tseries_roll_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_roll_median)},
-  {__Pyx_NAMESTR("roll_max"), (PyCFunction)__pyx_pf_7tseries_roll_max, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_roll_max)},
-  {__Pyx_NAMESTR("roll_min"), (PyCFunction)__pyx_pf_7tseries_roll_min, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_roll_min)},
-  {__Pyx_NAMESTR("getFillVec"), (PyCFunction)__pyx_pf_7tseries_getFillVec, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_backfill"), (PyCFunction)__pyx_pf_7tseries__backfill, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries__backfill)},
-  {__Pyx_NAMESTR("_pad"), (PyCFunction)__pyx_pf_7tseries__pad, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries__pad)},
-  {__Pyx_NAMESTR("getMergeVec"), (PyCFunction)__pyx_pf_7tseries_getMergeVec, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("combineFunc"), (PyCFunction)__pyx_pf_7tseries_combineFunc, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_combineFunc)},
-  {__Pyx_NAMESTR("to_datetime"), (PyCFunction)__pyx_pf_7tseries_to_datetime, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("to_timestamp"), (PyCFunction)__pyx_pf_7tseries_to_timestamp, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("array_to_timestamp"), (PyCFunction)__pyx_pf_7tseries_array_to_timestamp, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("array_to_datetime"), (PyCFunction)__pyx_pf_7tseries_array_to_datetime, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("checknull"), (PyCFunction)__pyx_pf_7tseries_3checknull, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("to_datetime"), (PyCFunction)__pyx_pf_7tseries_24to_datetime, METH_O, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("to_timestamp"), (PyCFunction)__pyx_pf_7tseries_25to_timestamp, METH_O, __Pyx_DOCSTR(0)},
   {0, 0, 0, 0}
 };
 
@@ -16846,26 +17323,16 @@ static struct PyModuleDef __pyx_moduledef = {
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_kp_s_1, __pyx_k_1, sizeof(__pyx_k_1), 0, 0, 1, 0},
-  {&__pyx_kp_u_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 1, 0, 0},
-  {&__pyx_kp_u_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 1, 0, 0},
+  {&__pyx_kp_s_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 0, 1, 0},
   {&__pyx_kp_u_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 1, 0, 0},
-  {&__pyx_kp_u_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 1, 0, 0},
   {&__pyx_kp_u_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 1, 0, 0},
-  {&__pyx_kp_u_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 1, 0, 0},
   {&__pyx_kp_u_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 1, 0, 0},
-  {&__pyx_kp_u_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 1, 0, 0},
   {&__pyx_kp_u_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 1, 0, 0},
   {&__pyx_kp_u_19, __pyx_k_19, sizeof(__pyx_k_19), 0, 1, 0, 0},
   {&__pyx_kp_s_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 0, 1, 0},
-  {&__pyx_kp_u_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 1, 0, 0},
-  {&__pyx_kp_u_21, __pyx_k_21, sizeof(__pyx_k_21), 0, 1, 0, 0},
-  {&__pyx_kp_s_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 0, 1, 0},
+  {&__pyx_kp_u_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 1, 0, 0},
   {&__pyx_kp_s_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 1, 0},
-  {&__pyx_kp_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 0},
-  {&__pyx_kp_u_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 1, 0, 0},
-  {&__pyx_kp_u_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 1, 0, 0},
-  {&__pyx_kp_u_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 1, 0, 0},
-  {&__pyx_kp_u_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 1, 0, 0},
+  {&__pyx_kp_s_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 0, 1, 0},
   {&__pyx_n_s__BACKFILL, __pyx_k__BACKFILL, sizeof(__pyx_k__BACKFILL), 0, 0, 1, 1},
   {&__pyx_n_s__Exception, __pyx_k__Exception, sizeof(__pyx_k__Exception), 0, 0, 1, 1},
   {&__pyx_n_s__KeyError, __pyx_k__KeyError, sizeof(__pyx_k__KeyError), 0, 0, 1, 1},
@@ -16891,6 +17358,9 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__aMap, __pyx_k__aMap, sizeof(__pyx_k__aMap), 0, 0, 1, 1},
   {&__pyx_n_s__any, __pyx_k__any, sizeof(__pyx_k__any), 0, 0, 1, 1},
   {&__pyx_n_s__ao, __pyx_k__ao, sizeof(__pyx_k__ao), 0, 0, 1, 1},
+  {&__pyx_n_s__append, __pyx_k__append, sizeof(__pyx_k__append), 0, 0, 1, 1},
+  {&__pyx_n_s__array_to_datetime, __pyx_k__array_to_datetime, sizeof(__pyx_k__array_to_datetime), 0, 0, 1, 1},
+  {&__pyx_n_s__array_to_timestamp, __pyx_k__array_to_timestamp, sizeof(__pyx_k__array_to_timestamp), 0, 0, 1, 1},
   {&__pyx_n_s__arrmap, __pyx_k__arrmap, sizeof(__pyx_k__arrmap), 0, 0, 1, 1},
   {&__pyx_n_s__asarray, __pyx_k__asarray, sizeof(__pyx_k__asarray), 0, 0, 1, 1},
   {&__pyx_n_s__astype, __pyx_k__astype, sizeof(__pyx_k__astype), 0, 0, 1, 1},
@@ -16916,7 +17386,10 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__format, __pyx_k__format, sizeof(__pyx_k__format), 0, 0, 1, 1},
   {&__pyx_n_s__func, __pyx_k__func, sizeof(__pyx_k__func), 0, 0, 1, 1},
   {&__pyx_n_s__get, __pyx_k__get, sizeof(__pyx_k__get), 0, 0, 1, 1},
+  {&__pyx_n_s__getFillVec, __pyx_k__getFillVec, sizeof(__pyx_k__getFillVec), 0, 0, 1, 1},
   {&__pyx_n_s__getMergeVec, __pyx_k__getMergeVec, sizeof(__pyx_k__getMergeVec), 0, 0, 1, 1},
+  {&__pyx_n_s__groupby, __pyx_k__groupby, sizeof(__pyx_k__groupby), 0, 0, 1, 1},
+  {&__pyx_n_s__groupby_indices, __pyx_k__groupby_indices, sizeof(__pyx_k__groupby_indices), 0, 0, 1, 1},
   {&__pyx_n_s__head, __pyx_k__head, sizeof(__pyx_k__head), 0, 0, 1, 1},
   {&__pyx_n_s__index, __pyx_k__index, sizeof(__pyx_k__index), 0, 0, 1, 1},
   {&__pyx_n_s__inf, __pyx_k__inf, sizeof(__pyx_k__inf), 0, 0, 1, 1},
@@ -16925,6 +17398,7 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__int32, __pyx_k__int32, sizeof(__pyx_k__int32), 0, 0, 1, 1},
   {&__pyx_n_s__int64, __pyx_k__int64, sizeof(__pyx_k__int64), 0, 0, 1, 1},
   {&__pyx_n_s__int8, __pyx_k__int8, sizeof(__pyx_k__int8), 0, 0, 1, 1},
+  {&__pyx_n_s__isAllDates, __pyx_k__isAllDates, sizeof(__pyx_k__isAllDates), 0, 0, 1, 1},
   {&__pyx_n_s__isAllDates2, __pyx_k__isAllDates2, sizeof(__pyx_k__isAllDates2), 0, 0, 1, 1},
   {&__pyx_n_s__isnan, __pyx_k__isnan, sizeof(__pyx_k__isnan), 0, 0, 1, 1},
   {&__pyx_n_s__isnullobj, __pyx_k__isnullobj, sizeof(__pyx_k__isnullobj), 0, 0, 1, 1},
@@ -16932,7 +17406,6 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__k, __pyx_k__k, sizeof(__pyx_k__k), 0, 0, 1, 1},
   {&__pyx_n_s__kind, __pyx_k__kind, sizeof(__pyx_k__kind), 0, 0, 1, 1},
   {&__pyx_n_s__kth_smallest, __pyx_k__kth_smallest, sizeof(__pyx_k__kth_smallest), 0, 0, 1, 1},
-  {&__pyx_n_s__map_indices, __pyx_k__map_indices, sizeof(__pyx_k__map_indices), 0, 0, 1, 1},
   {&__pyx_n_s__mapper, __pyx_k__mapper, sizeof(__pyx_k__mapper), 0, 0, 1, 1},
   {&__pyx_n_s__maxlevels, __pyx_k__maxlevels, sizeof(__pyx_k__maxlevels), 0, 0, 1, 1},
   {&__pyx_n_s__median, __pyx_k__median, sizeof(__pyx_k__median), 0, 0, 1, 1},
@@ -16957,14 +17430,20 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__range, __pyx_k__range, sizeof(__pyx_k__range), 0, 0, 1, 1},
   {&__pyx_n_s__readonly, __pyx_k__readonly, sizeof(__pyx_k__readonly), 0, 0, 1, 1},
   {&__pyx_n_s__remove, __pyx_k__remove, sizeof(__pyx_k__remove), 0, 0, 1, 1},
+  {&__pyx_n_s__roll_kurt, __pyx_k__roll_kurt, sizeof(__pyx_k__roll_kurt), 0, 0, 1, 1},
   {&__pyx_n_s__roll_max, __pyx_k__roll_max, sizeof(__pyx_k__roll_max), 0, 0, 1, 1},
+  {&__pyx_n_s__roll_mean, __pyx_k__roll_mean, sizeof(__pyx_k__roll_mean), 0, 0, 1, 1},
   {&__pyx_n_s__roll_median, __pyx_k__roll_median, sizeof(__pyx_k__roll_median), 0, 0, 1, 1},
   {&__pyx_n_s__roll_min, __pyx_k__roll_min, sizeof(__pyx_k__roll_min), 0, 0, 1, 1},
+  {&__pyx_n_s__roll_skew, __pyx_k__roll_skew, sizeof(__pyx_k__roll_skew), 0, 0, 1, 1},
+  {&__pyx_n_s__roll_sum, __pyx_k__roll_sum, sizeof(__pyx_k__roll_sum), 0, 0, 1, 1},
+  {&__pyx_n_s__roll_var, __pyx_k__roll_var, sizeof(__pyx_k__roll_var), 0, 0, 1, 1},
   {&__pyx_n_s__shape, __pyx_k__shape, sizeof(__pyx_k__shape), 0, 0, 1, 1},
   {&__pyx_n_s__size, __pyx_k__size, sizeof(__pyx_k__size), 0, 0, 1, 1},
   {&__pyx_n_s__strides, __pyx_k__strides, sizeof(__pyx_k__strides), 0, 0, 1, 1},
   {&__pyx_n_s__suboffsets, __pyx_k__suboffsets, sizeof(__pyx_k__suboffsets), 0, 0, 1, 1},
   {&__pyx_n_s__toordinal, __pyx_k__toordinal, sizeof(__pyx_k__toordinal), 0, 0, 1, 1},
+  {&__pyx_n_s__tseries, __pyx_k__tseries, sizeof(__pyx_k__tseries), 0, 0, 1, 1},
   {&__pyx_n_s__type_num, __pyx_k__type_num, sizeof(__pyx_k__type_num), 0, 0, 1, 1},
   {&__pyx_n_s__utcfromtimestamp, __pyx_k__utcfromtimestamp, sizeof(__pyx_k__utcfromtimestamp), 0, 0, 1, 1},
   {&__pyx_n_s__value, __pyx_k__value, sizeof(__pyx_k__value), 0, 0, 1, 1},
@@ -16986,6 +17465,181 @@ static int __Pyx_InitCachedBuiltins(void) {
   return -1;
 }
 
+static int __Pyx_InitCachedConstants(void) {
+  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants");
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":32
+ * cdef int _contiguous_check(ndarray arr):
+ *     if not is_contiguous(arr):
+ *         raise ValueError('Tried to use data field on non-contiguous array!')             # <<<<<<<<<<<<<<
+ * 
+ * cdef int16_t *get_int16_ptr(ndarray arr):
+ */
+  __pyx_k_tuple_3 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_3));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_s_2));
+  PyTuple_SET_ITEM(__pyx_k_tuple_3, 0, ((PyObject *)__pyx_kp_s_2));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_2));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_3));
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":137
+ * 
+ *         if value != (<Node> (<Node> (<Node> chain[0]).next)[0]).value:
+ *             raise KeyError('Not Found')             # <<<<<<<<<<<<<<
+ * 
+ *         # remove one link at each level
+ */
+  __pyx_k_tuple_5 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_5));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
+  PyTuple_SET_ITEM(__pyx_k_tuple_5, 0, ((PyObject *)__pyx_kp_s_4));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_5));
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":484
+ * cdef double_t _get_min(object skiplist, int nobs, int minp):
+ *     if nobs >= minp:
+ *         return <IndexableSkiplist> skiplist.get(0)             # <<<<<<<<<<<<<<
+ *     else:
+ *         return NaN
+ */
+  __pyx_k_tuple_6 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_6)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_6));
+  __Pyx_INCREF(__pyx_int_0);
+  PyTuple_SET_ITEM(__pyx_k_tuple_6, 0, __pyx_int_0);
+  __Pyx_GIVEREF(__pyx_int_0);
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_6));
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":55
+ * 
+ *     fillVec = np.empty(len(newIndex), dtype = np.int32)
+ *     fillVec.fill(-1)             # <<<<<<<<<<<<<<
+ * 
+ *     mask = np.zeros(len(newIndex), dtype = np.int8)
+ */
+  __pyx_k_tuple_8 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_8)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_8));
+  __Pyx_INCREF(__pyx_int_neg_1);
+  PyTuple_SET_ITEM(__pyx_k_tuple_8, 0, __pyx_int_neg_1);
+  __Pyx_GIVEREF(__pyx_int_neg_1);
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_8));
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":143
+ * 
+ *     fillVec = np.empty(len(newIndex), dtype = np.int32)
+ *     fillVec.fill(-1)             # <<<<<<<<<<<<<<
+ * 
+ *     mask = np.zeros(len(newIndex), dtype = np.int8)
+ */
+  __pyx_k_tuple_9 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_9)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_9));
+  __Pyx_INCREF(__pyx_int_neg_1);
+  PyTuple_SET_ITEM(__pyx_k_tuple_9, 0, __pyx_int_neg_1);
+  __Pyx_GIVEREF(__pyx_int_neg_1);
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_9));
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":65
+ *         return _applyFunc(__pow, index, ao, bo, aMap, bMap)
+ *     else:
+ *         raise Exception('bad funcname requested of Cython code')             # <<<<<<<<<<<<<<
+ */
+  __pyx_k_tuple_11 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_11)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_11));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_s_10));
+  PyTuple_SET_ITEM(__pyx_k_tuple_11, 0, ((PyObject *)__pyx_kp_s_10));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_10));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_11));
+
+  /* "numpy.pxd":206
+ *             if ((flags & pybuf.PyBUF_C_CONTIGUOUS == pybuf.PyBUF_C_CONTIGUOUS)
+ *                 and not PyArray_CHKFLAGS(self, NPY_C_CONTIGUOUS)):
+ *                 raise ValueError(u"ndarray is not C contiguous")             # <<<<<<<<<<<<<<
+ * 
+ *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
+ */
+  __pyx_k_tuple_13 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_13)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_13));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_12));
+  PyTuple_SET_ITEM(__pyx_k_tuple_13, 0, ((PyObject *)__pyx_kp_u_12));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_12));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_13));
+
+  /* "numpy.pxd":210
+ *             if ((flags & pybuf.PyBUF_F_CONTIGUOUS == pybuf.PyBUF_F_CONTIGUOUS)
+ *                 and not PyArray_CHKFLAGS(self, NPY_F_CONTIGUOUS)):
+ *                 raise ValueError(u"ndarray is not Fortran contiguous")             # <<<<<<<<<<<<<<
+ * 
+ *             info.buf = PyArray_DATA(self)
+ */
+  __pyx_k_tuple_15 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_15)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_15));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_14));
+  PyTuple_SET_ITEM(__pyx_k_tuple_15, 0, ((PyObject *)__pyx_kp_u_14));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_14));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_15));
+
+  /* "numpy.pxd":248
+ *                 if ((descr.byteorder == '>' and little_endian) or
+ *                     (descr.byteorder == '<' and not little_endian)):
+ *                     raise ValueError(u"Non-native byte order not supported")             # <<<<<<<<<<<<<<
+ *                 if   t == NPY_BYTE:        f = "b"
+ *                 elif t == NPY_UBYTE:       f = "B"
+ */
+  __pyx_k_tuple_17 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_17)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_17));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_16));
+  PyTuple_SET_ITEM(__pyx_k_tuple_17, 0, ((PyObject *)__pyx_kp_u_16));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_16));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_17));
+
+  /* "numpy.pxd":787
+ * 
+ *         if (end - f) - (new_offset - offset[0]) < 15:
+ *             raise RuntimeError(u"Format string allocated too short, see comment in numpy.pxd")             # <<<<<<<<<<<<<<
+ * 
+ *         if ((child.byteorder == '>' and little_endian) or
+ */
+  __pyx_k_tuple_20 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_20)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_20));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_19));
+  PyTuple_SET_ITEM(__pyx_k_tuple_20, 0, ((PyObject *)__pyx_kp_u_19));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_19));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_20));
+
+  /* "numpy.pxd":791
+ *         if ((child.byteorder == '>' and little_endian) or
+ *             (child.byteorder == '<' and not little_endian)):
+ *             raise ValueError(u"Non-native byte order not supported")             # <<<<<<<<<<<<<<
+ *             # One could encode it in the format string and have Cython
+ *             # complain instead, BUT: < and > in format strings also imply
+ */
+  __pyx_k_tuple_21 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_21)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 791; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_21));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_16));
+  PyTuple_SET_ITEM(__pyx_k_tuple_21, 0, ((PyObject *)__pyx_kp_u_16));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_16));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_21));
+
+  /* "numpy.pxd":811
+ *             t = child.type_num
+ *             if end - f < 5:
+ *                 raise RuntimeError(u"Format string allocated too short.")             # <<<<<<<<<<<<<<
+ * 
+ *             # Until ticket #99 is fixed, use integers to avoid warnings
+ */
+  __pyx_k_tuple_23 = PyTuple_New(1); if (unlikely(!__pyx_k_tuple_23)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 811; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_k_tuple_23));
+  __Pyx_INCREF(((PyObject *)__pyx_kp_u_22));
+  PyTuple_SET_ITEM(__pyx_k_tuple_23, 0, ((PyObject *)__pyx_kp_u_22));
+  __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_22));
+  __Pyx_GIVEREF(((PyObject *)__pyx_k_tuple_23));
+  __Pyx_RefNannyFinishContext();
+  return 0;
+  __pyx_L1_error:;
+  __Pyx_RefNannyFinishContext();
+  return -1;
+}
+
 static int __Pyx_InitGlobals(void) {
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
@@ -17055,6 +17709,8 @@ PyMODINIT_FUNC PyInit_tseries(void)
   }
   /*--- Builtin init code ---*/
   if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  /*--- Constants init code ---*/
+  if (unlikely(__Pyx_InitCachedConstants() < 0)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   /*--- Global init code ---*/
   /*--- Function export code ---*/
   /*--- Type init code ---*/
@@ -17063,15 +17719,9 @@ PyMODINIT_FUNC PyInit_tseries(void)
   if (__Pyx_SetAttrString(__pyx_m, "Node", (PyObject *)&__pyx_type_7tseries_Node) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_ptype_7tseries_Node = &__pyx_type_7tseries_Node;
   __pyx_vtabptr_7tseries_IndexableSkiplist = &__pyx_vtable_7tseries_IndexableSkiplist;
-  #if PY_MAJOR_VERSION >= 3
   __pyx_vtable_7tseries_IndexableSkiplist.get = (PyObject *(*)(struct __pyx_obj_7tseries_IndexableSkiplist *, int, int __pyx_skip_dispatch))__pyx_f_7tseries_17IndexableSkiplist_get;
   __pyx_vtable_7tseries_IndexableSkiplist.insert = (PyObject *(*)(struct __pyx_obj_7tseries_IndexableSkiplist *, double, int __pyx_skip_dispatch))__pyx_f_7tseries_17IndexableSkiplist_insert;
   __pyx_vtable_7tseries_IndexableSkiplist.remove = (PyObject *(*)(struct __pyx_obj_7tseries_IndexableSkiplist *, double, int __pyx_skip_dispatch))__pyx_f_7tseries_17IndexableSkiplist_remove;
-  #else
-  *(void(**)(void))&__pyx_vtable_7tseries_IndexableSkiplist.get = (void(*)(void))__pyx_f_7tseries_17IndexableSkiplist_get;
-  *(void(**)(void))&__pyx_vtable_7tseries_IndexableSkiplist.insert = (void(*)(void))__pyx_f_7tseries_17IndexableSkiplist_insert;
-  *(void(**)(void))&__pyx_vtable_7tseries_IndexableSkiplist.remove = (void(*)(void))__pyx_f_7tseries_17IndexableSkiplist_remove;
-  #endif
   if (PyType_Ready(&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (__Pyx_SetVtable(__pyx_type_7tseries_IndexableSkiplist.tp_dict, __pyx_vtabptr_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (__Pyx_SetAttrString(__pyx_m, "IndexableSkiplist", (PyObject *)&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -17083,10 +17733,11 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __pyx_ptype_5numpy_ndarray = __Pyx_ImportType("numpy", "ndarray", sizeof(PyArrayObject), 0); if (unlikely(!__pyx_ptype_5numpy_ndarray)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_ptype_5numpy_ufunc = __Pyx_ImportType("numpy", "ufunc", sizeof(PyUFuncObject), 0); if (unlikely(!__pyx_ptype_5numpy_ufunc)) {__pyx_filename = __pyx_f[8]; __pyx_lineno = 849; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), 0); if (unlikely(!__pyx_ptype_7cpython_4bool_bool)) {__pyx_filename = __pyx_f[10]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType(__Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), 0); if (unlikely(!__pyx_ptype_7cpython_7complex_complex)) {__pyx_filename = __pyx_f[11]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   /*--- Function import code ---*/
   /*--- Execution code ---*/
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":10
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":10
  * from cpython cimport PyFloat_Check
  * 
  * import numpy as np             # <<<<<<<<<<<<<<
@@ -17098,7 +17749,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   if (PyObject_SetAttr(__pyx_m, __pyx_n_s__np, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":11
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":11
  * 
  * import numpy as np
  * isnan = np.isnan             # <<<<<<<<<<<<<<
@@ -17113,7 +17764,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   if (PyObject_SetAttr(__pyx_m, __pyx_n_s__isnan, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":12
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":12
  * import numpy as np
  * isnan = np.isnan
  * cdef double NaN = <double> np.NaN             # <<<<<<<<<<<<<<
@@ -17129,7 +17780,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_7tseries_NaN = __pyx_t_3;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":14
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":14
  * cdef double NaN = <double> np.NaN
  * 
  * from datetime import datetime as pydatetime             # <<<<<<<<<<<<<<
@@ -17150,7 +17801,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":83
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":83
  * 
  * # import datetime C API
  * PyDateTime_IMPORT             # <<<<<<<<<<<<<<
@@ -17159,7 +17810,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
  */
   PyDateTime_IMPORT;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/common.pyx":86
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":86
  * 
  * # initialize numpy
  * import_array()             # <<<<<<<<<<<<<<
@@ -17168,7 +17819,31 @@ PyMODINIT_FUNC PyInit_tseries(void)
  */
   import_array();
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":23
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":115
+ *     return result
+ * 
+ * def isAllDates(ndarray index):             # <<<<<<<<<<<<<<
+ *     cdef int i, length
+ *     cdef flatiter iter
+ */
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7tseries_1isAllDates, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__isAllDates, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/common.pyx":135
+ *     return True
+ * 
+ * def isAllDates2(ndarray[object, ndim=1] arr):             # <<<<<<<<<<<<<<
+ *     '''
+ *     cannot use
+ */
+  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7tseries_2isAllDates2, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__isAllDates2, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":23
  * cimport numpy as np
  * from numpy cimport *
  * import numpy as np             # <<<<<<<<<<<<<<
@@ -17180,7 +17855,7 @@ PyMODINIT_FUNC PyInit_tseries(void)
   if (PyObject_SetAttr(__pyx_m, __pyx_n_s__np, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 23; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":25
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":25
  * import numpy as np
  * 
  * from random import random             # <<<<<<<<<<<<<<
@@ -17201,80 +17876,318 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":28
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":28
  * 
  * # initialize numpy
  * import_array()             # <<<<<<<<<<<<<<
  * 
- * # TODO: optimize this, make less messy
+ * # TODO: optimize this, make less messy
+ */
+  import_array();
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/skiplist.pyx":44
+ * 
+ * # Singleton terminator node
+ * NIL = Node(np.inf, [], [])             # <<<<<<<<<<<<<<
+ * 
+ * cdef class IndexableSkiplist:
+ */
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__inf); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_5));
+  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_1));
+  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
+  PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)__pyx_t_4));
+  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
+  __pyx_t_2 = 0;
+  __pyx_t_1 = 0;
+  __pyx_t_4 = 0;
+  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), ((PyObject *)__pyx_t_5), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__NIL, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":2
+ * 
+ * cdef double INF = <double> np.inf             # <<<<<<<<<<<<<<
+ * cdef double NEGINF = -INF
+ * 
+ */
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__inf); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_7tseries_INF = __pyx_t_3;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":3
+ * 
+ * cdef double INF = <double> np.inf
+ * cdef double NEGINF = -INF             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline _checknull(object val):
+ */
+  __pyx_v_7tseries_NEGINF = (-__pyx_v_7tseries_INF);
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/isnull.pyx":14
+ *     return _checknull(val)
+ * 
+ * def isnullobj(ndarray input):             # <<<<<<<<<<<<<<
+ *     cdef int i, length
+ *     cdef object val
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_4isnullobj, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__isnullobj, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":9
+ * 
+ * @cython.boundscheck(False)
+ * def arrmap(ndarray[object, ndim=1] index, object func):             # <<<<<<<<<<<<<<
+ *     cdef int length = index.shape[0]
+ *     cdef int i = 0
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_5arrmap, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__arrmap, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":21
+ * 
+ * @cython.boundscheck(False)
+ * def groupby(object index, object mapper, output=None):             # <<<<<<<<<<<<<<
+ *     cdef dict result
+ *     cdef ndarray[object, ndim=1] mapped_index
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_6groupby, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__groupby, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/groupby.pyx":59
+ * 
+ * @cython.boundscheck(False)
+ * def groupby_indices(object index, object mapper):             # <<<<<<<<<<<<<<
+ *     cdef dict result
+ *     cdef ndarray[object, ndim=1] mapped_index
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_7groupby_indices, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__groupby_indices, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":28
+ * 
+ * 
+ * def kth_smallest(ndarray[double_t, ndim=1] a, int k):             # <<<<<<<<<<<<<<
+ *     cdef:
+ *         int i,j,l,m,n
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_8kth_smallest, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__kth_smallest, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":58
+ * 
+ * 
+ * def median(ndarray arr):             # <<<<<<<<<<<<<<
+ *     '''
+ *     A faster median
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_9median, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__median, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":78
+ * # Rolling sum
+ * 
+ * def roll_sum(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_10roll_sum, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_sum, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":122
+ * # Rolling mean
+ * 
+ * def roll_mean(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
+ *     cdef double val, prev, sum_x = 0
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_11roll_mean, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_mean, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":166
+ * # Exponentially weighted moving average
+ * 
+ * def ewma(ndarray[double_t, ndim=1] input, double_t com):             # <<<<<<<<<<<<<<
+ *     '''
+ *     Compute exponentially-weighted moving average using center-of-mass.
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_12ewma, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__ewma, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":217
+ * # Rolling variance
+ * 
+ * def roll_var(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0, sum_xx = 0, nobs = 0
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_13roll_var, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_var, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 217; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":264
+ * # Rolling skewness
+ * 
+ * def roll_skew(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
+ *     cdef double val, prev
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_14roll_skew, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_skew, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":327
+ * 
+ * 
+ * def roll_kurt(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
+ *     cdef double val, prev
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_15roll_kurt, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_kurt, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 327; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":442
+ *     return output
+ * 
+ * def roll_median(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
+ *     '''
+ *     O(N log(window)) implementation using skip list
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_16roll_median, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_median, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 442; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":448
+ *     return _roll_skiplist_op(input, win, minp, _get_median)
+ * 
+ * def roll_max(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
+ *     '''
+ *     O(N log(window)) implementation using skip list
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_17roll_max, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_max, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 448; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/moments.pyx":454
+ *     return _roll_skiplist_op(input, win, minp, _get_max)
+ * 
+ * def roll_min(ndarray input, int win, int minp):             # <<<<<<<<<<<<<<
+ *     '''
+ *     O(N log(window)) implementation using skip list
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_18roll_min, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__roll_min, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":1
+ * def getFillVec(ndarray oldIndex, ndarray newIndex, dict oldMap, dict newMap,             # <<<<<<<<<<<<<<
+ *                kind=None):
+ * 
+ */
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_19getFillVec, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__getFillVec, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":16
+ * 
+ * @cython.wraparound(False)
+ * def _backfill(ndarray[object, ndim=1] oldIndex,             # <<<<<<<<<<<<<<
+ *               ndarray[object, ndim=1] newIndex,
+ *               dict oldMap, dict newMap):
  */
-  import_array();
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_20_backfill, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s___backfill, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/skiplist.pyx":44
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":107
  * 
- * # Singleton terminator node
- * NIL = Node(np.inf, [], [])             # <<<<<<<<<<<<<<
- * 
- * cdef class IndexableSkiplist:
+ * @cython.wraparound(False)
+ * def _pad(ndarray[object, ndim=1] oldIndex,             # <<<<<<<<<<<<<<
+ *          ndarray[object, ndim=1] newIndex,
+ *          dict oldMap, dict newMap):
  */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__inf); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_21_pad, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_5, 1, ((PyObject *)__pyx_t_1));
-  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
-  PyTuple_SET_ITEM(__pyx_t_5, 2, ((PyObject *)__pyx_t_4));
-  __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
-  __pyx_t_2 = 0;
-  __pyx_t_1 = 0;
-  __pyx_t_4 = 0;
-  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s___pad, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__NIL, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":2
+  /* "/home/wesm/code/pandas/pandas/lib/src/reindex.pyx":206
  * 
- * cdef double INF = <double> np.inf             # <<<<<<<<<<<<<<
- * cdef double NEGINF = -INF
+ * @cython.boundscheck(False)
+ * def getMergeVec(ndarray values, dict oldMap):             # <<<<<<<<<<<<<<
+ *     cdef int i, j, length, newLength
  * 
  */
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__inf); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_22getMergeVec, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__getMergeVec, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_v_7tseries_INF = __pyx_t_3;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/isnull.pyx":3
- * 
- * cdef double INF = <double> np.inf
- * cdef double NEGINF = -INF             # <<<<<<<<<<<<<<
+  /* "/home/wesm/code/pandas/pandas/lib/src/operators.pyx":40
+ *     return result
  * 
- * cdef inline _checknull(object val):
+ * def combineFunc(object name, ndarray index, ndarray ao,             # <<<<<<<<<<<<<<
+ *                 ndarray bo, dict aMap, dict bMap):
+ *     '''
  */
-  __pyx_v_7tseries_NEGINF = (-__pyx_v_7tseries_INF);
+  __pyx_t_5 = PyCFunction_NewEx(&__pyx_mdef_7tseries_23combineFunc, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__combineFunc, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 40; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":1
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":1
  * cdef int _EPOCH_ORD = 719163             # <<<<<<<<<<<<<<
  * 
  * from datetime import date as pydate
  */
   __pyx_v_7tseries__EPOCH_ORD = 719163;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/io.pyx":3
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":3
  * cdef int _EPOCH_ORD = 719163
  * 
  * from datetime import date as pydate             # <<<<<<<<<<<<<<
@@ -17295,87 +18208,41 @@ PyMODINIT_FUNC PyInit_tseries(void)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "/Users/wesm/code/pandas/pandas/lib/src/tseries.pyx":1
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":25
+ *     return gmtime(dt)
+ * 
+ * def array_to_timestamp(ndarray[object, ndim=1] arr):             # <<<<<<<<<<<<<<
+ *     cdef int i, n
+ *     cdef ndarray[int64_t, ndim=1] result
+ */
+  __pyx_t_4 = PyCFunction_NewEx(&__pyx_mdef_7tseries_26array_to_timestamp, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__array_to_timestamp, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "/home/wesm/code/pandas/pandas/lib/src/io.pyx":37
+ *     return result
+ * 
+ * def array_to_datetime(ndarray[int64_t, ndim=1] arr):             # <<<<<<<<<<<<<<
+ *     cdef int i, n
+ *     cdef ndarray[object, ndim=1] result
+ */
+  __pyx_t_4 = PyCFunction_NewEx(&__pyx_mdef_7tseries_27array_to_datetime, NULL, __pyx_n_s__tseries); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__array_to_datetime, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 37; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "tseries.pyx":1
  * include "common.pyx"             # <<<<<<<<<<<<<<
  * include "skiplist.pyx"
  * include "isnull.pyx"
  */
   __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  __pyx_t_5 = PyObject_GetAttr(__pyx_m, __pyx_n_s__map_indices); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_GetAttrString(__pyx_t_5, "__doc__"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_12), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_m, __pyx_n_s__isAllDates2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_GetAttrString(__pyx_t_1, "__doc__"); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_13), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyObject_GetAttr(__pyx_m, __pyx_n_s__median); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_GetAttrString(__pyx_t_5, "__doc__"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_14), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_m, __pyx_n_s__ewma); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_GetAttrString(__pyx_t_1, "__doc__"); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_15), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyObject_GetAttr(__pyx_m, __pyx_n_s__roll_median); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_GetAttrString(__pyx_t_5, "__doc__"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_16), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_m, __pyx_n_s__roll_max); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_GetAttrString(__pyx_t_1, "__doc__"); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_17), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyObject_GetAttr(__pyx_m, __pyx_n_s__roll_min); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_GetAttrString(__pyx_t_5, "__doc__"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_18), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_m, __pyx_n_s___backfill); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_GetAttrString(__pyx_t_1, "__doc__"); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_19), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyObject_GetAttr(__pyx_m, __pyx_n_s___pad); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_GetAttrString(__pyx_t_5, "__doc__"); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_20), __pyx_t_1) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_m, __pyx_n_s__combineFunc); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_GetAttrString(__pyx_t_1, "__doc__"); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_kp_u_21), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   if (PyObject_SetAttr(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_4)) < 0) {__pyx_filename = __pyx_f[9]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
 
-  /* "/Library/Frameworks/Python.framework/Versions/6.3/lib/python2.6/site-packages/Cython-0.13-py2.6-macosx-10.5-i386.egg/Cython/Includes/cpython/type.pxd":2
+  /* "cpython/type.pxd":2
  * 
  * cdef extern from "Python.h":             # <<<<<<<<<<<<<<
  *     # The C structure of the objects used to describe built-in types.
@@ -17428,35 +18295,172 @@ static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
     #if PY_MAJOR_VERSION >= 3
     if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
         goto bad;
-    #endif
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-    Py_INCREF(local_type);
-    Py_INCREF(local_value);
-    Py_INCREF(local_tb);
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    /* Make sure tstate is in a consistent state when we XDECREF
-       these objects (XDECREF may run arbitrary code). */
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-    return 0;
+    #endif
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+    Py_INCREF(local_type);
+    Py_INCREF(local_value);
+    Py_INCREF(local_tb);
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    /* Make sure tstate is in a consistent state when we XDECREF
+       these objects (XDECREF may run arbitrary code). */
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
+
+static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    PyThreadState *tstate = PyThreadState_GET();
+
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+
+static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
+    PyThreadState *tstate = PyThreadState_GET();
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+}
+
+
+#if PY_MAJOR_VERSION < 3
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
+    Py_XINCREF(type);
+    Py_XINCREF(value);
+    Py_XINCREF(tb);
+    /* First, check the traceback argument, replacing None with NULL. */
+    if (tb == Py_None) {
+        Py_DECREF(tb);
+        tb = 0;
+    }
+    else if (tb != NULL && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto raise_error;
+    }
+    /* Next, replace a missing value with None */
+    if (value == NULL) {
+        value = Py_None;
+        Py_INCREF(value);
+    }
+    #if PY_VERSION_HEX < 0x02050000
+    if (!PyClass_Check(type))
+    #else
+    if (!PyType_Check(type))
+    #endif
+    {
+        /* Raising an instance.  The value should be a dummy. */
+        if (value != Py_None) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto raise_error;
+        }
+        /* Normalize to raise <class>, <instance> */
+        Py_DECREF(value);
+        value = type;
+        #if PY_VERSION_HEX < 0x02050000
+            if (PyInstance_Check(type)) {
+                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
+                Py_INCREF(type);
+            }
+            else {
+                type = 0;
+                PyErr_SetString(PyExc_TypeError,
+                    "raise: exception must be an old-style class or instance");
+                goto raise_error;
+            }
+        #else
+            type = (PyObject*) Py_TYPE(type);
+            Py_INCREF(type);
+            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
+                PyErr_SetString(PyExc_TypeError,
+                    "raise: exception class must be a subclass of BaseException");
+                goto raise_error;
+            }
+        #endif
+    }
+
+    __Pyx_ErrRestore(type, value, tb);
+    return;
+raise_error:
+    Py_XDECREF(value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+    return;
+}
+
+#else /* Python 3+ */
+
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
+    if (tb == Py_None) {
+        tb = 0;
+    } else if (tb && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto bad;
+    }
+    if (value == Py_None)
+        value = 0;
+
+    if (PyExceptionInstance_Check(type)) {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto bad;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(value);
+    } else if (!PyExceptionClass_Check(type)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: exception class must be a subclass of BaseException");
+        goto bad;
+    }
+
+    PyErr_SetObject(type, value);
+
+    if (tb) {
+        PyThreadState *tstate = PyThreadState_GET();
+        PyObject* tmp_tb = tstate->curexc_traceback;
+        if (tb != tmp_tb) {
+            Py_INCREF(tb);
+            tstate->curexc_traceback = tb;
+            Py_XDECREF(tmp_tb);
+        }
+    }
+
 bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
+    return;
 }
-
+#endif
 
 static int __Pyx_ArgTypeTest(PyObject *obj, PyTypeObject *type, int none_allowed,
     const char *name, int exact)
@@ -17597,7 +18601,7 @@ static size_t __Pyx_BufFmt_TypeCharToNativeSize(char ch, int is_complex) {
     default: {
       __Pyx_BufFmt_RaiseUnexpectedChar(ch);
       return 0;
-    }    
+    }
   }
 }
 
@@ -17641,7 +18645,7 @@ static size_t __Pyx_BufFmt_TypeCharToGroup(char ch, int is_complex) {
     default: {
       __Pyx_BufFmt_RaiseUnexpectedChar(ch);
       return 0;
-    }    
+    }
   }
 }
 
@@ -17678,7 +18682,7 @@ static int __Pyx_BufFmt_ProcessTypeChunk(__Pyx_BufFmt_Context* ctx) {
   do {
     __Pyx_StructField* field = ctx->head->field;
     __Pyx_TypeInfo* type = field->type;
-  
+
     if (ctx->packmode == '@' || ctx->packmode == '^') {
       size = __Pyx_BufFmt_TypeCharToNativeSize(ctx->enc_type, ctx->is_complex);
     } else {
@@ -17701,7 +18705,7 @@ static int __Pyx_BufFmt_ProcessTypeChunk(__Pyx_BufFmt_Context* ctx) {
         ctx->head->parent_offset = parent_offset;
         continue;
       }
-    
+
       __Pyx_BufFmt_RaiseExpected(ctx);
       return -1;
     }
@@ -17715,7 +18719,7 @@ static int __Pyx_BufFmt_ProcessTypeChunk(__Pyx_BufFmt_Context* ctx) {
     }
 
     ctx->fmt_offset += size;
-  
+
     --ctx->enc_count; /* Consume from buffer string */
 
     /* Done checking, move to next field, pushing or popping struct stack if needed */
@@ -17748,7 +18752,7 @@ static int __Pyx_BufFmt_ProcessTypeChunk(__Pyx_BufFmt_Context* ctx) {
   } while (ctx->enc_count);
   ctx->enc_type = 0;
   ctx->is_complex = 0;
-  return 0;    
+  return 0;
 }
 
 static int __Pyx_BufFmt_FirstPack(__Pyx_BufFmt_Context* ctx) {
@@ -17870,7 +18874,7 @@ static const char* __Pyx_BufFmt_CheckString(__Pyx_BufFmt_Context* ctx, const cha
             return NULL;
           }
         }
-      
+
     }
   }
 }
@@ -17927,46 +18931,6 @@ static void __Pyx_RaiseBufferIndexError(int axis) {
 }
 
 
-static CYTHON_INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    PyThreadState *tstate = PyThreadState_GET();
-
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-
-static CYTHON_INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb) {
-    PyThreadState *tstate = PyThreadState_GET();
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-}
-
-
-static void __Pyx_RaiseDoubleKeywordsError(
-    const char* func_name,
-    PyObject* kw_name)
-{
-    PyErr_Format(PyExc_TypeError,
-        #if PY_MAJOR_VERSION >= 3
-        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
-        #else
-        "%s() got multiple values for keyword argument '%s'", func_name,
-        PyString_AS_STRING(kw_name));
-        #endif
-}
-
 static void __Pyx_RaiseArgtupleInvalid(
     const char* func_name,
     int exact,
@@ -17997,6 +18961,19 @@ static void __Pyx_RaiseArgtupleInvalid(
         func_name, more_or_less, num_expected, number, num_found);
 }
 
+static void __Pyx_RaiseDoubleKeywordsError(
+    const char* func_name,
+    PyObject* kw_name)
+{
+    PyErr_Format(PyExc_TypeError,
+        #if PY_MAJOR_VERSION >= 3
+        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
+        #else
+        "%s() got multiple values for keyword argument '%s'", func_name,
+        PyString_AS_STRING(kw_name));
+        #endif
+}
+
 static int __Pyx_ParseOptionalKeywords(
     PyObject *kwds,
     PyObject **argnames[],
@@ -18096,10 +19073,6 @@ static void __Pyx_RaiseBufferFallbackError(void) {
 }
 
 
-static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
-    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-}
-
 static CYTHON_INLINE void __Pyx_RaiseNoneIndexingError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is unsubscriptable");
 }
@@ -18159,6 +19132,10 @@ static int __Pyx_EndUnpack(PyObject *iter, Py_ssize_t expected) {
         return -1;
 }
 
+static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
+    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
+}
+
 static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
     if (t == Py_None) {
       __Pyx_RaiseNoneNotIterableError();
@@ -18209,7 +19186,7 @@ static int __Pyx_GetBuffer(PyObject *obj, Py_buffer *view, int flags) {
 static void __Pyx_ReleaseBuffer(Py_buffer *view) {
   PyObject* obj = view->obj;
   if (obj) {
-if (PyObject_TypeCheck(obj, __pyx_ptype_5numpy_ndarray)) __pyx_pf_5numpy_7ndarray___releasebuffer__(obj, view);
+if (PyObject_TypeCheck(obj, __pyx_ptype_5numpy_ndarray)) __pyx_pf_5numpy_7ndarray_1__releasebuffer__(obj, view);
     Py_DECREF(obj);
     view->obj = NULL;
   }
@@ -18250,116 +19227,6 @@ bad:
     return module;
 }
 
-#if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
-    Py_XINCREF(type);
-    Py_XINCREF(value);
-    Py_XINCREF(tb);
-    /* First, check the traceback argument, replacing None with NULL. */
-    if (tb == Py_None) {
-        Py_DECREF(tb);
-        tb = 0;
-    }
-    else if (tb != NULL && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto raise_error;
-    }
-    /* Next, replace a missing value with None */
-    if (value == NULL) {
-        value = Py_None;
-        Py_INCREF(value);
-    }
-    #if PY_VERSION_HEX < 0x02050000
-    if (!PyClass_Check(type))
-    #else
-    if (!PyType_Check(type))
-    #endif
-    {
-        /* Raising an instance.  The value should be a dummy. */
-        if (value != Py_None) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto raise_error;
-        }
-        /* Normalize to raise <class>, <instance> */
-        Py_DECREF(value);
-        value = type;
-        #if PY_VERSION_HEX < 0x02050000
-            if (PyInstance_Check(type)) {
-                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
-                Py_INCREF(type);
-            }
-            else {
-                type = 0;
-                PyErr_SetString(PyExc_TypeError,
-                    "raise: exception must be an old-style class or instance");
-                goto raise_error;
-            }
-        #else
-            type = (PyObject*) Py_TYPE(type);
-            Py_INCREF(type);
-            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
-                PyErr_SetString(PyExc_TypeError,
-                    "raise: exception class must be a subclass of BaseException");
-                goto raise_error;
-            }
-        #endif
-    }
-
-    __Pyx_ErrRestore(type, value, tb);
-    return;
-raise_error:
-    Py_XDECREF(value);
-    Py_XDECREF(type);
-    Py_XDECREF(tb);
-    return;
-}
-
-#else /* Python 3+ */
-
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
-    if (tb == Py_None) {
-        tb = 0;
-    } else if (tb && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto bad;
-    }
-    if (value == Py_None)
-        value = 0;
-
-    if (PyExceptionInstance_Check(type)) {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto bad;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(value);
-    } else if (!PyExceptionClass_Check(type)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: exception class must be a subclass of BaseException");
-        goto bad;
-    }
-
-    PyErr_SetObject(type, value);
-
-    if (tb) {
-        PyThreadState *tstate = PyThreadState_GET();
-        PyObject* tmp_tb = tstate->curexc_traceback;
-        if (tb != tmp_tb) {
-            Py_INCREF(tb);
-            tstate->curexc_traceback = tb;
-            Py_XDECREF(tmp_tb);
-        }
-    }
-
-bad:
-    return;
-}
-#endif
-
 static CYTHON_INLINE npy_int32 __Pyx_PyInt_from_py_npy_int32(PyObject* x) {
     const npy_int32 neg_one = (npy_int32)-1, const_zero = (npy_int32)0;
     const int is_unsigned = const_zero < neg_one;
@@ -18501,15 +19368,60 @@ static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_npy_int64(npy_int64 val) {
         z.imag = -a.imag;
         return z;
     }
-/*
-    static CYTHON_INLINE float __Pyx_c_absf(__pyx_t_float_complex z) {
-#if HAVE_HYPOT
-        return hypotf(z.real, z.imag);
-#else
-        return sqrtf(z.real*z.real + z.imag*z.imag);
-#endif
-    }
-*/
+    #if 1
+        static CYTHON_INLINE float __Pyx_c_absf(__pyx_t_float_complex z) {
+          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
+            return sqrtf(z.real*z.real + z.imag*z.imag);
+          #else
+            return hypotf(z.real, z.imag);
+          #endif
+        }
+        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_powf(__pyx_t_float_complex a, __pyx_t_float_complex b) {
+            __pyx_t_float_complex z;
+            float r, lnr, theta, z_r, z_theta;
+            if (b.imag == 0 && b.real == (int)b.real) {
+                if (b.real < 0) {
+                    float denom = a.real * a.real + a.imag * a.imag;
+                    a.real = a.real / denom;
+                    a.imag = -a.imag / denom;
+                    b.real = -b.real;
+                }
+                switch ((int)b.real) {
+                    case 0:
+                        z.real = 1;
+                        z.imag = 0;
+                        return z;
+                    case 1:
+                        return a;
+                    case 2:
+                        z = __Pyx_c_prodf(a, a);
+                        return __Pyx_c_prodf(a, a);
+                    case 3:
+                        z = __Pyx_c_prodf(a, a);
+                        return __Pyx_c_prodf(z, a);
+                    case 4:
+                        z = __Pyx_c_prodf(a, a);
+                        return __Pyx_c_prodf(z, z);
+                }
+            }
+            if (a.imag == 0) {
+                if (a.real == 0) {
+                    return a;
+                }
+                r = a.real;
+                theta = 0;
+            } else {
+                r = __Pyx_c_absf(a);
+                theta = atan2f(a.imag, a.real);
+            }
+            lnr = logf(r);
+            z_r = expf(lnr * b.real - theta * b.imag);
+            z_theta = theta * b.real + lnr * b.imag;
+            z.real = z_r * cosf(z_theta);
+            z.imag = z_r * sinf(z_theta);
+            return z;
+        }
+    #endif
 #endif
 
 #if CYTHON_CCOMPLEX
@@ -18576,15 +19488,60 @@ static CYTHON_INLINE PyObject *__Pyx_PyInt_to_py_npy_int64(npy_int64 val) {
         z.imag = -a.imag;
         return z;
     }
-/*
-    static CYTHON_INLINE double __Pyx_c_abs(__pyx_t_double_complex z) {
-#if HAVE_HYPOT
-        return hypot(z.real, z.imag);
-#else
-        return sqrt(z.real*z.real + z.imag*z.imag);
-#endif
-    }
-*/
+    #if 1
+        static CYTHON_INLINE double __Pyx_c_abs(__pyx_t_double_complex z) {
+          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
+            return sqrt(z.real*z.real + z.imag*z.imag);
+          #else
+            return hypot(z.real, z.imag);
+          #endif
+        }
+        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow(__pyx_t_double_complex a, __pyx_t_double_complex b) {
+            __pyx_t_double_complex z;
+            double r, lnr, theta, z_r, z_theta;
+            if (b.imag == 0 && b.real == (int)b.real) {
+                if (b.real < 0) {
+                    double denom = a.real * a.real + a.imag * a.imag;
+                    a.real = a.real / denom;
+                    a.imag = -a.imag / denom;
+                    b.real = -b.real;
+                }
+                switch ((int)b.real) {
+                    case 0:
+                        z.real = 1;
+                        z.imag = 0;
+                        return z;
+                    case 1:
+                        return a;
+                    case 2:
+                        z = __Pyx_c_prod(a, a);
+                        return __Pyx_c_prod(a, a);
+                    case 3:
+                        z = __Pyx_c_prod(a, a);
+                        return __Pyx_c_prod(z, a);
+                    case 4:
+                        z = __Pyx_c_prod(a, a);
+                        return __Pyx_c_prod(z, z);
+                }
+            }
+            if (a.imag == 0) {
+                if (a.real == 0) {
+                    return a;
+                }
+                r = a.real;
+                theta = 0;
+            } else {
+                r = __Pyx_c_abs(a);
+                theta = atan2(a.imag, a.real);
+            }
+            lnr = log(r);
+            z_r = exp(lnr * b.real - theta * b.imag);
+            z_theta = theta * b.real + lnr * b.imag;
+            z.real = z_r * cos(z_theta);
+            z.imag = z_r * sin(z_theta);
+            return z;
+        }
+    #endif
 #endif
 
 static CYTHON_INLINE unsigned char __Pyx_PyInt_AsUnsignedChar(PyObject* x) {
@@ -19085,13 +20042,13 @@ static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
-        PyErr_Format(PyExc_TypeError, 
+        PyErr_Format(PyExc_TypeError,
             "%s.%s is not a type object",
             module_name, class_name);
         goto bad;
     }
     if (!strict && ((PyTypeObject *)result)->tp_basicsize > size) {
-        PyOS_snprintf(warning, sizeof(warning), 
+        PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility",
             module_name, class_name);
         #if PY_VERSION_HEX < 0x02050000
@@ -19101,7 +20058,7 @@ static PyTypeObject *__Pyx_ImportType(const char *module_name, const char *class
         #endif
     }
     else if (((PyTypeObject *)result)->tp_basicsize != size) {
-        PyErr_Format(PyExc_ValueError, 
+        PyErr_Format(PyExc_ValueError,
             "%s.%s has the wrong size, try recompiling",
             module_name, class_name);
         goto bad;
