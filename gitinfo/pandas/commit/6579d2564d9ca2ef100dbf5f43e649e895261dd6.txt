commit 6579d2564d9ca2ef100dbf5f43e649e895261dd6
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Mon May 28 14:59:35 2012 -0400

    BUG: DatetimeIndex partial slicing bug, tsplot kludge around #1332

diff --git a/pandas/tools/plotting.py b/pandas/tools/plotting.py
index b47688f9c..77394cbc6 100644
--- a/pandas/tools/plotting.py
+++ b/pandas/tools/plotting.py
@@ -6,7 +6,9 @@ import numpy as np
 
 from pandas.util.decorators import cache_readonly
 import pandas.core.common as com
+from pandas.core.index import MultiIndex
 from pandas.core.series import Series
+from pandas.tseries.frequencies import to_calendar_freq
 from pandas.tseries.index import DatetimeIndex
 from pandas.tseries.period import PeriodIndex
 from pandas.tseries.offsets import DateOffset
@@ -313,8 +315,14 @@ class MPLPlot(object):
     @property
     def legend_title(self):
         if hasattr(self.data, 'columns'):
-            stringified = map(str, self.data.columns.names)
-            return ','.join(stringified)
+            if not isinstance(self.data.columns, MultiIndex):
+                name = self.data.columns.name
+                if name is not None:
+                    name = str(name)
+                return name
+            else:
+                stringified = map(str, self.data.columns.names)
+                return ','.join(stringified)
         else:
             return None
 
@@ -438,7 +446,10 @@ class LinePlot(MPLPlot):
         from pandas.core.frame import DataFrame
         if (isinstance(data.index, DatetimeIndex) and
             isinstance(data, DataFrame)):
-            freq = getattr(data.index, 'freq', None)
+            freq = getattr(data.index, 'freqstr', None)
+
+            freq = to_calendar_freq(freq)
+
             if freq is None and hasattr(data.index, 'inferred_freq'):
                 freq = data.index.inferred_freq
 
diff --git a/pandas/tseries/frequencies.py b/pandas/tseries/frequencies.py
index 94dac0864..a58169e20 100644
--- a/pandas/tseries/frequencies.py
+++ b/pandas/tseries/frequencies.py
@@ -257,7 +257,7 @@ for prefix in need_suffix:
         _offset_to_period_map['%s-%s' % (prefix, m)] = \
             _offset_to_period_map[prefix]
 
-def offset_to_period_alias(offset_str):
+def to_calendar_freq(offset_str):
     """ alias to closest period strings BQ->Q etc"""
     return _offset_to_period_map.get(offset_str, offset_str)
 
diff --git a/pandas/tseries/index.py b/pandas/tseries/index.py
index eaa034b8c..a401c4f39 100644
--- a/pandas/tseries/index.py
+++ b/pandas/tseries/index.py
@@ -855,11 +855,7 @@ class DatetimeIndex(Int64Index):
         except KeyError:
 
             try:
-                freq = getattr(self, 'freq', getattr(self, 'inferred_freq',
-                                                     None))
-                asdt, parsed, reso = parse_time_string(key, freq)
-                key = asdt
-                loc = self._partial_date_slice(reso, parsed)
+                loc = self._get_string_slice(key)
                 return series[loc]
             except (TypeError, ValueError, KeyError):
                 pass
@@ -909,7 +905,8 @@ class DatetimeIndex(Int64Index):
         return com._ensure_platform_int(indexer)
 
     def _get_string_slice(self, key):
-        freq = getattr(self, 'freq', getattr(self, 'inferred_freq', None))
+        freq = getattr(self, 'freqstr',
+                       getattr(self, 'inferred_freq', None))
         asdt, parsed, reso = parse_time_string(key, freq)
         key = asdt
         loc = self._partial_date_slice(reso, parsed)
diff --git a/pandas/tseries/plotting.py b/pandas/tseries/plotting.py
index 593a4cdd5..b33bcc2f5 100644
--- a/pandas/tseries/plotting.py
+++ b/pandas/tseries/plotting.py
@@ -75,7 +75,7 @@ def tsplot(series, plotf, *args, **kwargs):
     if isinstance(freq, DateOffset):
         freq = freq.rule_code
 
-    freq = frequencies.offset_to_period_alias(freq)
+    freq = frequencies.to_calendar_freq(freq)
     # Convert DatetimeIndex to PeriodIndex
     if isinstance(series.index, DatetimeIndex):
         idx = series.index.to_period(freq=freq)
diff --git a/pandas/tseries/tests/test_resample.py b/pandas/tseries/tests/test_resample.py
index 2b1d96553..9c517e836 100644
--- a/pandas/tseries/tests/test_resample.py
+++ b/pandas/tseries/tests/test_resample.py
@@ -425,6 +425,7 @@ def _simple_pts(start, end, freq='D'):
 from pandas.tseries.frequencies import MONTHS, DAYS
 from pandas.util.compat import product
 
+
 class TestResamplePeriodIndex(unittest.TestCase):
 
     def test_basic_downsample(self):
diff --git a/pandas/tseries/tests/test_timeseries.py b/pandas/tseries/tests/test_timeseries.py
index 1c4ada8b7..9a0d6e649 100644
--- a/pandas/tseries/tests/test_timeseries.py
+++ b/pandas/tseries/tests/test_timeseries.py
@@ -971,6 +971,12 @@ class TestLegacySupport(unittest.TestCase):
         expected = df[df.index.year == 2005]
         assert_frame_equal(result, expected)
 
+        rng = date_range('1/1/2000', '1/1/2010')
+
+        result = rng.get_loc('2009')
+        expected = slice(3288, 3653)
+        self.assert_(result == expected)
+
     def test_slice_quarter(self):
         dti = DatetimeIndex(freq='D', start=datetime(2000,6,1), periods=500)
 
