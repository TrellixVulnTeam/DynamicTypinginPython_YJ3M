commit c8ed032fb5cd3e91b106482f7d8b67fc4eb8b725
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Sep 1 22:00:08 2012 -0400

    BUG: fix memory leak in building structured array

diff --git a/pandas/src/numpy_helper.h b/pandas/src/numpy_helper.h
index 9ae0a047c..940526e87 100644
--- a/pandas/src/numpy_helper.h
+++ b/pandas/src/numpy_helper.h
@@ -144,10 +144,16 @@ PANDAS_INLINE PyObject* floatify(PyObject* str) {
 }
 
 PyObject* sarr_from_data(PyArray_Descr *descr, int length, void* data) {
+	PyArrayObject *result;
 	npy_intp dims[1] = {length};
 	Py_INCREF(descr);
-	return (PyObject*) PyArray_NewFromDescr(&PyArray_Type, descr, 1, dims,
-											NULL, data, 0, NULL);
+	result = (PyArrayObject*) PyArray_NewFromDescr(&PyArray_Type, descr, 1, dims,
+												   NULL, data, 0, NULL);
+
+	// Returned array doesn't own data by default
+	result->flags |= NPY_OWNDATA;
+
+	return (PyObject*) result;
 }
 
 void transfer_object_column(char *dst, char *src, size_t stride,
diff --git a/pandas/src/parser.pyx b/pandas/src/parser.pyx
index 0f4407147..529d95a8f 100644
--- a/pandas/src/parser.pyx
+++ b/pandas/src/parser.pyx
@@ -713,6 +713,7 @@ def _to_structured_array(dict columns, object colnames):
     buf = <char*> malloc(length * stride)
 
     recs = util.sarr_from_data(dt, length, buf)
+    assert(recs.flags.owndata)
 
     # buf = <char*> recs.data
     # end = time.clock()
diff --git a/setup.py b/setup.py
index 506e4d4ca..583d58a6e 100755
--- a/setup.py
+++ b/setup.py
@@ -385,7 +385,8 @@ period_ext = Extension('pandas._period',
                        include_dirs=[np.get_include()])
 
 parser_ext = Extension('pandas._parser',
-                       depends=['pandas/src/parser/parser.h'],
+                       depends=['pandas/src/parser/parser.h',
+                                'pandas/src/numpy_helper.h'],
                        sources=[srcpath('parser', suffix=suffix),
                                 'pandas/src/parser/parser.c',
                                 'pandas/src/parser/conversions.c',
