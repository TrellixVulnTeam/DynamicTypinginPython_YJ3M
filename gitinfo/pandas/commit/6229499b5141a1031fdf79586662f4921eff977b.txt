commit 6229499b5141a1031fdf79586662f4921eff977b
Author: Ka Wo Chen <kawoc@tepper.cmu.edu>
Date:   Wed Nov 25 23:12:37 2015 -0500

    BUG: GH11697 where memory allocation erroneously failed in rolling_median

diff --git a/doc/source/whatsnew/v0.18.0.txt b/doc/source/whatsnew/v0.18.0.txt
index 7e0130347..82249a86c 100644
--- a/doc/source/whatsnew/v0.18.0.txt
+++ b/doc/source/whatsnew/v0.18.0.txt
@@ -190,3 +190,4 @@ Bug Fixes
 
 
 - Bug in ``.loc`` result with duplicated key may have ``Index`` with incorrect dtype (:issue:`11497`)
+- Bug in ``pd.rolling_median`` where memory allocation failed even with sufficient memory (:issue:`11696`)
diff --git a/pandas/src/skiplist.h b/pandas/src/skiplist.h
index c7117f16c..2d7009030 100644
--- a/pandas/src/skiplist.h
+++ b/pandas/src/skiplist.h
@@ -60,7 +60,7 @@ typedef struct {
 } skiplist_t;
 
 static PANDAS_INLINE double urand(void) {
-  return rand() / ((double) RAND_MAX + 1);
+  return ((double) rand() + 1) / ((double) RAND_MAX + 2);
 }
 
 static PANDAS_INLINE int int_min(int a, int b) {
diff --git a/pandas/stats/tests/test_moments.py b/pandas/stats/tests/test_moments.py
index e2ed27156..b9efa8757 100644
--- a/pandas/stats/tests/test_moments.py
+++ b/pandas/stats/tests/test_moments.py
@@ -1919,6 +1919,12 @@ class TestMomentsConsistency(Base):
         x = mom.rolling_median(series, window=1, freq='D')
         assert_series_equal(expected, x)
 
+    def test_rolling_median_memory_error(self):
+        # GH11722
+        n = 20000
+        mom.rolling_median(Series(np.random.randn(n)), window=2, center=False)
+        mom.rolling_median(Series(np.random.randn(n)), window=2, center=False)
+
 if __name__ == '__main__':
     import nose
     nose.runmodule(argv=[__file__, '-vvs', '-x', '--pdb', '--pdb-failure'],
