commit 6f810e49e80b212cdb93dab66e941618995ce8c6
Author: Adam Klein <adamklein@gmail.com>
Date:   Mon Jan 16 11:50:41 2012 -0500

    ENH: ipython_directive to warning on exceptions when building docs, small fix

diff --git a/doc/source/io.rst b/doc/source/io.rst
index 6c7a60d2f..c83ef06bf 100644
--- a/doc/source/io.rst
+++ b/doc/source/io.rst
@@ -343,7 +343,6 @@ performance HDF5 format using the excellent `PyTables
 
 .. ipython:: python
    :suppress:
-   :okexcept:
 
    os.remove('store.h5')
 
diff --git a/doc/sphinxext/ipython_directive.py b/doc/sphinxext/ipython_directive.py
index c04c3475d..ff7f77ab0 100644
--- a/doc/sphinxext/ipython_directive.py
+++ b/doc/sphinxext/ipython_directive.py
@@ -218,13 +218,10 @@ class EmbeddedSphinxShell(object):
         self.config = config
 
         def custom_handler(self, etype, value, tb, tb_offset=None):
-            tmpstderr = io.stderr
-            io.stderr = sys.stderr
             if not config.suppress_exception_warning:
                 errstr = ("WARNING: Unhandled Exception: (%s, %s)\n"
                         % (etype, value))
-                io.stderr.write(errstr)
-            io.stderr = tmpstderr
+                sys.stderr.write(errstr)
 
         IP.set_custom_exc((Exception,), custom_handler)
 
