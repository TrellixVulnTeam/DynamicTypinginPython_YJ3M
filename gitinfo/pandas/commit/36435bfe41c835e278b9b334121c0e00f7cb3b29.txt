commit 36435bfe41c835e278b9b334121c0e00f7cb3b29
Author: jreback <jeff@reback.net>
Date:   Fri May 2 14:56:26 2014 -0400

    BLD: fix caching 3

diff --git a/ci/install.sh b/ci/install.sh
index 2aa20e9c7..ef0a0f762 100755
--- a/ci/install.sh
+++ b/ci/install.sh
@@ -146,8 +146,14 @@ fi
 
 
 # set the compiler cache to work
-export PATH=/usr/lib/ccache:/usr/lib64/ccache:$PATH
-which gcc
+if [ "$IRON_TOKEN" ]; then
+    export PATH=/usr/lib/ccache:/usr/lib64/ccache:$PATH
+    gcc=$(which gcc)
+    echo "gcc: $gcc"
+    ccache=$(which ccache)
+    echo "ccache: $ccache"
+    export CC='ccache gcc'
+fi
 
 # build pandas
 time python setup.py sdist
diff --git a/ci/prep_ccache.sh b/ci/prep_ccache.sh
index a36f3d0b5..34e1f2520 100755
--- a/ci/prep_ccache.sh
+++ b/ci/prep_ccache.sh
@@ -2,13 +2,13 @@
 
 if [ "$IRON_TOKEN" ]; then
 
+    home_dir=$(pwd)
+
     # install the compiler cache
     sudo apt-get $APT_ARGS install ccache p7zip-full
     # iron_cache, pending py3 fixes upstream
     pip install -I --allow-external --allow-insecure git+https://github.com/iron-io/iron_cache_python.git@8a451c7d7e4d16e0c3bedffd0f280d5d9bd4fe59#egg=iron_cache
 
-
-    curdir=$(pwd)
     python ci/ironcache/get.py
     ccache -C
 
@@ -27,7 +27,7 @@ if [ "$IRON_TOKEN" ]; then
     fi
 
     # did the last commit change cython files?
-    cd $curdir
+    cd $home_dir
 
     retval=$(git diff HEAD~3 --numstat | grep -P "pyx|pxd"|wc -l)
     echo "number of cython files changed: $retval"
diff --git a/ci/submit_ccache.sh b/ci/submit_ccache.sh
index 0440be74e..d0f138c98 100755
--- a/ci/submit_ccache.sh
+++ b/ci/submit_ccache.sh
@@ -1,5 +1,6 @@
 #!/bin/bash
 
+home_dir=$(pwd)
 ccache -s
 
 MISSES=$(ccache -s | grep "cache miss" | grep -Po "\d+")
@@ -11,17 +12,20 @@ if [ x"$MISSES" == x"0" ]; then
 fi
 
 if [ "$IRON_TOKEN" ]; then
-    rm -rf ~/ccache.7z
 
-    tar cf - $HOME/.ccache \
+    cd $HOME
+    rm -rf ccache.7z
+
+    tar cf - .ccache \
     "$TRAVIS_BUILD_DIR"/pandas/{index,algos,lib,tslib,parser,hashtable}.c \
     "$TRAVIS_BUILD_DIR"/pandas/src/{sparse,testing}.c \
     "$TRAVIS_BUILD_DIR"/pandas/msgpack.cpp  \
-    |  7za a -si ~/ccache.7z
+    |  7za a -si ccache.7z
 
-    split -b 500000 -d ~/ccache.7z ~/ccache.
+    split -b 500000 -d ccache.7z ccache.
 
     python ci/ironcache/put.py
+    cd $home_dir
 fi;
 
 exit 0
