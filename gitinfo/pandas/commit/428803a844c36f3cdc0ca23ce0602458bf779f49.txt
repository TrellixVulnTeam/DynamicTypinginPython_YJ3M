commit 428803a844c36f3cdc0ca23ce0602458bf779f49
Author: Chang She <changshe@gmail.com>
Date:   Fri Nov 30 13:05:44 2012 -0500

    Excel tweaks to handle PeriodIndex and split test cases #2370 #2294 #2395

diff --git a/pandas/core/format.py b/pandas/core/format.py
index 3c4b0328a..ed8a99c42 100644
--- a/pandas/core/format.py
+++ b/pandas/core/format.py
@@ -19,6 +19,7 @@ import numpy as np
 
 import itertools
 
+from pandas.tseries.period import PeriodIndex
 
 docstring_to_string = """
      Parameters
@@ -688,7 +689,7 @@ def _get_level_lengths(levels):
 # ExcelCell = namedtuple("ExcelCell",
 #                        'row, col, val, style, mergestart, mergeend')
 
-class ExcelCell:
+class ExcelCell(object):
     __fields__ = ('row', 'col', 'val', 'style', 'mergestart', 'mergeend')
     __slots__ = __fields__
 
@@ -849,6 +850,9 @@ class ExcelFormatter(object):
 
             #write index_values
             index_values = self.df.index
+            if isinstance(self.df.index, PeriodIndex):
+                index_values = self.df.index.to_timestamp()
+
             coloffset = 1
             for idx, idxval in enumerate(index_values):
                 yield ExcelCell(self.rowcounter + idx, 0, idxval, header_style)
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index 854f94cd7..851857549 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -4188,7 +4188,7 @@ class TestDataFrame(unittest.TestCase, CheckIndexing,
         self.assertEquals(openpyxl.style.Alignment.HORIZONTAL_CENTER,
                           xlsx_style.alignment.horizontal)
 
-    def test_to_excel_header_styling(self):
+    def test_to_excel_header_styling_xls(self):
 
         import StringIO
         s = StringIO.StringIO(
@@ -4210,9 +4210,8 @@ class TestDataFrame(unittest.TestCase, CheckIndexing,
                                              cols=["Date", "type"])
 
         try:
+            import xlwt
             import xlrd
-            import openpyxl
-            from openpyxl.cell import get_column_letter
         except ImportError:
             raise nose.SkipTest
 
@@ -4239,6 +4238,38 @@ class TestDataFrame(unittest.TestCase, CheckIndexing,
                 self.assertEquals(2, cell_xf.alignment.hor_align)
 
         os.remove(filename)
+
+
+    def test_to_excel_header_styling_xlsx(self):
+
+        import StringIO
+        s = StringIO.StringIO(
+        """Date,ticker,type,value
+        2001-01-01,x,close,12.2
+        2001-01-01,x,open ,12.1
+        2001-01-01,y,close,12.2
+        2001-01-01,y,open ,12.1
+        2001-02-01,x,close,12.2
+        2001-02-01,x,open ,12.1
+        2001-02-01,y,close,12.2
+        2001-02-01,y,open ,12.1
+        2001-03-01,x,close,12.2
+        2001-03-01,x,open ,12.1
+        2001-03-01,y,close,12.2
+        2001-03-01,y,open ,12.1""")
+        df = read_csv(s, parse_dates=["Date"])
+        pdf = df.pivot_table(values="value", rows=["ticker"],
+                                             cols=["Date", "type"])
+
+        try:
+            import openpyxl
+            from openpyxl.cell import get_column_letter
+        except ImportError:
+            raise nose.SkipTest
+
+        if openpyxl.__version__ < '1.6.1':
+            raise nose.SkipTest
+
         # test xlsx_styling
         filename = '__tmp__.xlsx'
         pdf.to_excel(filename, 'test1')
