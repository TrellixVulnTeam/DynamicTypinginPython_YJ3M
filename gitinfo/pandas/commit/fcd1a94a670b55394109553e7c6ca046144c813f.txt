commit fcd1a94a670b55394109553e7c6ca046144c813f
Author: jreback <jeff@reback.net>
Date:   Mon Sep 22 18:06:51 2014 -0400

    BUG: Bug in alignment with TimeOps and non-unique indexes (GH8363)

diff --git a/doc/source/v0.15.0.txt b/doc/source/v0.15.0.txt
index db55786ba..f49c919e8 100644
--- a/doc/source/v0.15.0.txt
+++ b/doc/source/v0.15.0.txt
@@ -867,7 +867,7 @@ Bug Fixes
 
 - Bug in ``tslib.tz_convert`` and ``tslib.tz_convert_single`` may return different results (:issue:`7798`)
 - Bug in ``DatetimeIndex.intersection`` of non-overlapping timestamps with tz raises ``IndexError`` (:issue:`7880`)
-
+- Bug in alignment with TimeOps and non-unique indexes (:issue:`8363`)
 
 
 - Bug in ``GroupBy.filter()`` where fast path vs. slow path made the filter
diff --git a/pandas/core/generic.py b/pandas/core/generic.py
index f4192e576..c9f83bfe0 100644
--- a/pandas/core/generic.py
+++ b/pandas/core/generic.py
@@ -3112,9 +3112,13 @@ class NDFrame(PandasObject):
                 raise ValueError('cannot align series to a series other than '
                                  'axis 0')
 
-            join_index, lidx, ridx = self.index.join(other.index, how=join,
-                                                     level=level,
-                                                     return_indexers=True)
+            # equal
+            if  self.index.equals(other.index):
+                join_index, lidx, ridx = None, None, None
+            else:
+                join_index, lidx, ridx = self.index.join(other.index, how=join,
+                                                         level=level,
+                                                         return_indexers=True)
 
             left_result = self._reindex_indexer(join_index, lidx, copy)
             right_result = other._reindex_indexer(join_index, ridx, copy)
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index b4b8e4263..18de6ac35 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -3523,6 +3523,21 @@ class TestDataFrame(tm.TestCase, CheckIndexing,
         result = z.ix[['a', 'c', 'a']]
         check(result,expected)
 
+
+    def test_column_dups_indexing2(self):
+
+        # GH 8363
+        # datetime ops with a non-unique index
+        df = DataFrame({'A' : np.arange(5), 'B' : np.arange(1,6)},index=[2,2,3,3,4])
+        result = df.B-df.A
+        expected = Series(1,index=[2,2,3,3,4])
+        assert_series_equal(result,expected)
+
+        df = DataFrame({'A' : date_range('20130101',periods=5), 'B' : date_range('20130101 09:00:00', periods=5)},index=[2,2,3,3,4])
+        result = df.B-df.A
+        expected = Series(Timedelta('9 hours'),index=[2,2,3,3,4])
+        assert_series_equal(result,expected)
+
     def test_insert_benchmark(self):
         # from the vb_suite/frame_methods/frame_insert_columns
         N = 10
