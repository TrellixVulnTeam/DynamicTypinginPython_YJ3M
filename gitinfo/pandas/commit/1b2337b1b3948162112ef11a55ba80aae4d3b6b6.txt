commit 1b2337b1b3948162112ef11a55ba80aae4d3b6b6
Author: jreback <jeff@reback.net>
Date:   Thu Mar 21 11:43:56 2013 -0400

    BUG: GH2817, raise the correct KeyError that the multi-index is not sorted

diff --git a/pandas/core/index.py b/pandas/core/index.py
index 8b42f2146..467fe46e8 100644
--- a/pandas/core/index.py
+++ b/pandas/core/index.py
@@ -274,6 +274,9 @@ class Index(np.ndarray):
     def is_monotonic(self):
         return self._engine.is_monotonic
 
+    def is_lexsorted_for_tuple(self, tup):
+        return True
+
     @cache_readonly
     def is_unique(self):
         return self._engine.is_unique
@@ -1692,6 +1695,12 @@ class MultiIndex(Index):
         """
         return self.lexsort_depth == self.nlevels
 
+    def is_lexsorted_for_tuple(self, tup):
+        """
+        Return True if we are correctly lexsorted given the passed tuple
+        """
+        return len(tup) <= self.lexsort_depth
+
     @cache_readonly
     def lexsort_depth(self):
         if self.sortorder is not None:
diff --git a/pandas/core/indexing.py b/pandas/core/indexing.py
index 16259fd39..05ee4728e 100644
--- a/pandas/core/indexing.py
+++ b/pandas/core/indexing.py
@@ -311,6 +311,10 @@ class _NDFrameIndexer(object):
             except Exception, e1:
                 if isinstance(tup[0], (slice, Index)):
                     raise IndexingError
+
+                # raise the error if we are not sorted
+                if not ax0.is_lexsorted_for_tuple(tup):
+                    raise e1
                 try:
                     loc = ax0.get_loc(tup[0])
                 except KeyError:
diff --git a/pandas/tests/test_indexing.py b/pandas/tests/test_indexing.py
index f1ac1a288..207eb96a9 100644
--- a/pandas/tests/test_indexing.py
+++ b/pandas/tests/test_indexing.py
@@ -697,6 +697,23 @@ class TestIndexing(unittest.TestCase):
         xp = mi_int.ix[4]
         assert_frame_equal(rs,xp)
 
+    def test_ix_general(self):
+
+        # ix general issues
+
+        # GH 2817
+        data={'amount': {0: 700, 1: 600, 2: 222, 3: 333, 4: 444},
+              'col': {0: 3.5, 1: 3.5, 2: 4.0, 3: 4.0, 4: 4.0},
+              'year': {0: 2012, 1: 2011, 2: 2012, 3: 2012, 4: 2012}}
+        df = DataFrame(data).set_index(keys=['col','year'])
+
+        # this should raise correct error
+        self.assertRaises(KeyError, df.ix.__getitem__, tuple([4.0,2012]))
+
+        # this is ok
+        df.sortlevel(inplace=True)
+        df.ix[(4.0,2012)]
+
 if __name__ == '__main__':
     import nose
     nose.runmodule(argv=[__file__, '-vvs', '-x', '--pdb', '--pdb-failure'],
