commit bb9484b737319b43820360bf4d2469786774c7b1
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Fri Feb 26 00:26:45 2010 +0000

    simplified rolling moments
    
    git-svn-id: http://pandas.googlecode.com/svn/trunk@129 d5231056-7de3-11de-ac95-d976489f1ece

diff --git a/pandas/lib/src/moments.pyx b/pandas/lib/src/moments.pyx
index 7c172456e..f441aa901 100644
--- a/pandas/lib/src/moments.pyx
+++ b/pandas/lib/src/moments.pyx
@@ -1,55 +1,16 @@
 # Cython implementations of rolling sum, mean, variance, skewness,
 # other statistical moment functions
 
-include "skiplist.pyx"
-
-cdef extern from "wirth.h":
-    double kth_smallest(double *a, int n, int k)
-
 #-------------------------------------------------------------------------------
 # Rolling sum
 
-cdef void _roll_sum(double_t *input, double_t *output,
-                    int win, int minp, int N):
+def _roll_sum(ndarray[double_t, ndim=1] input,
+              int win, int minp):
     cdef double val, prev, sum_x = 0
     cdef int nobs = 0, i
+    cdef int N = len(input)
 
-    if minp > N:
-        minp = N + 1
-
-    for i from 0 <= i < minp - 1:
-        val = input[i]
-
-        # Not NaN
-        if val == val:
-            nobs += 1
-            sum_x += val
-
-        output[i] = NaN
-
-    for i from minp - 1 <= i < N:
-        val = input[i]
-
-        if i > win - 1:
-            prev = input[i - win]
-            if prev == prev:
-                sum_x -= prev
-                nobs -= 1
-
-        if val == val:
-            nobs += 1
-            sum_x += val
-
-        if nobs >= minp:
-            output[i] = sum_x
-        else:
-            output[i] = NaN
-
-def _roll_sum_noncontig(ndarray[double_t, ndim=1] input,
-                        ndarray[double_t, ndim=1] output,
-                        int win, int minp, int N):
-    cdef double val, prev, sum_x = 0
-    cdef int nobs = 0, i
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     if minp > N:
         minp = N + 1
@@ -82,50 +43,18 @@ def _roll_sum_noncontig(ndarray[double_t, ndim=1] input,
         else:
             output[i] = NaN
 
+    return output
+
 #-------------------------------------------------------------------------------
 # Rolling mean
 
-cdef void _roll_mean(double_t *input, double_t *output,
-                    int win, int minp, int N):
+def _roll_mean(ndarray[double_t, ndim=1] input,
+               int win, int minp):
     cdef double val, prev, sum_x = 0
     cdef int nobs = 0, i
+    cdef int N = len(input)
 
-    if minp > N:
-        minp = N + 1
-
-    for i from 0 <= i < minp - 1:
-        val = input[i]
-
-        # Not NaN
-        if val == val:
-            nobs += 1
-            sum_x += val
-
-        output[i] = NaN
-
-    for i from minp - 1 <= i < N:
-        val = input[i]
-
-        if i > win - 1:
-            prev = input[i - win]
-            if prev == prev:
-                sum_x -= prev
-                nobs -= 1
-
-        if val == val:
-            nobs += 1
-            sum_x += val
-
-        if nobs >= minp:
-            output[i] = sum_x / nobs
-        else:
-            output[i] = NaN
-
-def _roll_mean_noncontig(ndarray[double_t, ndim=1] input,
-                         ndarray[double_t, ndim=1] output,
-                         int win, int minp, int N):
-    cdef double val, prev, sum_x = 0
-    cdef int nobs = 0, i
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     if minp > N:
         minp = N + 1
@@ -158,44 +87,19 @@ def _roll_mean_noncontig(ndarray[double_t, ndim=1] input,
         else:
             output[i] = NaN
 
+    return output
+
 #-------------------------------------------------------------------------------
 # Exponentially weighted moving average
 
-cdef void _ewma(double_t *input, double_t *output,
-                      int com, int N):
+def _ewma(ndarray[double_t, ndim=1] input,
+          int com):
     cdef double cur, prev, neww, oldw, adj
     cdef int i
+    cdef int N = len(input)
 
-    neww = 1. / (1. + com)
-    oldw = 1. - neww
-    adj = oldw
-
-    output[0] = neww * input[0]
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
-    for i from 1 <= i < N:
-        cur = input[i]
-        prev = output[i - 1]
-
-        if cur == cur:
-            if prev == prev:
-                output[i] = oldw * prev + neww * cur
-            else:
-                output[i] = neww * cur
-        else:
-            output[i] = prev
-
-    for i from 0 <= i < N:
-        cur = input[i]
-        output[i] = output[i] / (1. - adj)
-
-        if cur == cur:
-            adj *= oldw
-
-def _ewma_noncontig(ndarray[double_t, ndim=1] input,
-                          ndarray[double_t, ndim=1] output,
-                          int com, int N):
-    cdef double cur, prev, neww, oldw, adj
-    cdef int i
 
     neww = 1. / (1. + com)
     oldw = 1. - neww
@@ -222,54 +126,18 @@ def _ewma_noncontig(ndarray[double_t, ndim=1] input,
         if cur == cur:
             adj *= oldw
 
+    return output
+
 #-------------------------------------------------------------------------------
 # Rolling variance
 
-cdef void _roll_var(double_t *input, double_t *output,
-                    int win, int minp, int N):
+def _roll_var(ndarray[double_t, ndim=1] input,
+              int win, int minp):
     cdef double val, prev, sum_x = 0, sum_xx = 0
     cdef int nobs = 0, i
+    cdef int N = len(input)
 
-    if minp > N:
-        minp = N + 1
-
-    for i from 0 <= i < minp - 1:
-        val = input[i]
-
-        # Not NaN
-        if val == val:
-            nobs += 1
-            sum_x += val
-            sum_xx += val * val
-
-        output[i] = NaN
-
-    for i from minp - 1 <= i < N:
-        val = input[i]
-
-        if i > win - 1:
-            prev = input[i - win]
-            if prev == prev:
-                sum_x -= prev
-                sum_xx -= prev * prev
-                nobs -= 1
-
-        if val == val:
-            nobs += 1
-            sum_x += val
-            sum_xx += val * val
-
-        if nobs >= minp:
-            output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
-        else:
-            output[i] = NaN
-
-
-def _roll_var_noncontig(ndarray[double_t, ndim=1] input,
-                        ndarray[double_t, ndim=1] output,
-                        int win, int minp, int N):
-    cdef double val, prev, sum_x = 0, sum_xx = 0
-    cdef int nobs = 0, i
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     if minp > N:
         minp = N + 1
@@ -305,70 +173,19 @@ def _roll_var_noncontig(ndarray[double_t, ndim=1] input,
         else:
             output[i] = NaN
 
+    return output
+
 #-------------------------------------------------------------------------------
 # Rolling skewness
 
-cdef void _roll_skew(double_t *input, double_t *output,
-                    int win, int minp, int N):
+def _roll_skew(ndarray[double_t, ndim=1] input,
+               int win, int minp):
     cdef double val, prev
     cdef double x = 0, xx = 0, xxx = 0
     cdef int nobs = 0, i
+    cdef int N = len(input)
 
-    # 3 components of the skewness equation
-    cdef double A, B, C, R
-
-    if minp > N:
-        minp = N + 1
-
-    for i from 0 <= i < minp - 1:
-        val = input[i]
-
-        # Not NaN
-        if val == val:
-            nobs += 1
-            x += val
-            xx += val * val
-            xxx += val * val * val
-
-        output[i] = NaN
-
-    for i from minp - 1 <= i < N:
-        val = input[i]
-
-        if i > win - 1:
-            prev = input[i - win]
-            if prev == prev:
-                x -= prev
-                xx -= prev * prev
-                xxx -= prev * prev * prev
-
-                nobs -= 1
-
-        if val == val:
-            nobs += 1
-            x += val
-            xx += val * val
-            xxx += val * val * val
-
-        if nobs >= minp:
-            A = x / nobs
-            B = xx / nobs - A * A
-            C = xxx / nobs - A * A * A - 3 * A * B
-
-            R = sqrt(B)
-
-            output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
-                         ((nobs-2) * R * R * R))
-        else:
-            output[i] = NaN
-
-
-def _roll_skew_noncontig(ndarray[double_t, ndim=1] input,
-                         ndarray[double_t, ndim=1] output,
-                         int win, int minp, int N):
-    cdef double val, prev
-    cdef double x = 0, xx = 0, xxx = 0
-    cdef int nobs = 0, i
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     # 3 components of the skewness equation
     cdef double A, B, C, R
@@ -418,15 +235,20 @@ def _roll_skew_noncontig(ndarray[double_t, ndim=1] input,
         else:
             output[i] = NaN
 
+    return output
+
 #-------------------------------------------------------------------------------
 # Rolling kurtosis
 
 
-cdef void _roll_kurt(double_t *input, double_t *output,
-                     int win, int minp, int N):
+def _roll_kurt(ndarray[double_t, ndim=1] input,
+               int win, int minp):
     cdef double val, prev
     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
     cdef int nobs = 0, i
+    cdef int N = len(input)
+
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     # 5 components of the kurtosis equation
     cdef double A, B, C, D, R, K
@@ -440,6 +262,8 @@ cdef void _roll_kurt(double_t *input, double_t *output,
         # Not NaN
         if val == val:
             nobs += 1
+
+            # seriously don't ask me why this is faster
             x += val
             xx += val * val
             xxx += val * val * val
@@ -483,15 +307,22 @@ cdef void _roll_kurt(double_t *input, double_t *output,
         else:
             output[i] = NaN
 
-def _roll_kurt_noncontig(ndarray[double_t, ndim=1] input,
-                         ndarray[double_t, ndim=1] output,
-                         int win, int minp, int N):
-    cdef double val, prev
-    cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
+    return output
+
+#-------------------------------------------------------------------------------
+# Rolling median
+
+def _roll_median(ndarray[double_t, ndim=1] input,
+                 int win, int minp):
+
+    cdef double val, prev, midpoint
+    cdef IndexableSkiplist skiplist
     cdef int nobs = 0, i
+    cdef int N = len(input)
 
-    # 5 components of the kurtosis equation
-    cdef double A, B, C, D, R, K
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+
+    skiplist = IndexableSkiplist(win)
 
     if minp > N:
         minp = N + 1
@@ -502,12 +333,7 @@ def _roll_kurt_noncontig(ndarray[double_t, ndim=1] input,
         # Not NaN
         if val == val:
             nobs += 1
-
-            # seriously don't ask me why this is faster
-            x += val
-            xx += val * val
-            xxx += val * val * val
-            xxxx += val * val * val * val
+            skiplist.insert(val)
 
         output[i] = NaN
 
@@ -516,84 +342,37 @@ def _roll_kurt_noncontig(ndarray[double_t, ndim=1] input,
 
         if i > win - 1:
             prev = input[i - win]
-            if prev == prev:
-                x -= prev
-                xx -= prev * prev
-                xxx -= prev * prev * prev
-                xxxx -= prev * prev * prev * prev
 
+            if prev == prev:
+                skiplist.remove(prev)
                 nobs -= 1
 
         if val == val:
             nobs += 1
-            x += val
-            xx += val * val
-            xxx += val * val * val
-            xxxx += val * val * val * val
+            skiplist.insert(val)
 
         if nobs >= minp:
-            A = x / nobs
-            R = A * A
-            B = xx / nobs - R
-            R = R * A
-            C = xxx / nobs - R - 3 * A * B
-            R = R * A
-            D = xxxx / nobs - R - 6*B*A*A - 4*C*A
-
-            K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
-            K = K / ((nobs - 2.)*(nobs-3.))
-
-            output[i] = K
+            midpoint = nobs / 2
+            if nobs % 2:
+                output[i] = skiplist.get(midpoint)
+            else:
+                output[i] = (skiplist.get(midpoint) +
+                             skiplist.get(midpoint - 1)) / 2
         else:
             output[i] = NaN
 
-#-------------------------------------------------------------------------------
-# Rolling median
-
-def median(ndarray arr):
-    cdef double *values
-    cdef int n = len(arr)
-
-    if len(arr) == 0:
-        return np.NaN
-
-    if not np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS):
-        arr = np.array(arr)
-
-    values = <double *> arr.data
-
-    if n % 2:
-        return kth_smallest(values, n, n / 2)
-    else:
-        return (kth_smallest(values, n, n / 2) +
-                kth_smallest(values, n, n / 2 - 1)) / 2
-
-
+    return output
 
 #-------------------------------------------------------------------------------
 # Rolling min / max
 
-cdef void _roll_max(double_t *input, double_t *output,
-                    int win, int N):
+def _roll_max(ndarray[double_t, ndim=1] input,
+              int win):
     cdef double val
     cdef int i, j
+    cdef int N = len(input)
 
-    for i from 0 <= i < win - 1:
-        output[i] = NaN
-
-    for i from win - 1 <= i < N:
-        val = input[i - win + 1]
-
-        for j from (i - win + 1) <= j <= i:
-            val = max(val, input[j])
-
-        output[j] = val
-
-def _roll_max_noncontig(ndarray[double_t, ndim=1] input,
-                        ndarray[double_t, ndim=1] output,
-                        int win, int N):
-    cdef double val
-    cdef int i, j
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     for i from 0 <= i < win - 1:
         output[i] = NaN
@@ -606,27 +385,15 @@ def _roll_max_noncontig(ndarray[double_t, ndim=1] input,
 
         output[j] = val
 
-cdef void _roll_min(double_t *input, double_t *output,
-                    int win, int N):
-    cdef double val
-    cdef int i, j
-
-    for i from 0 <= i < win - 1:
-        output[i] = NaN
-
-    for i from win - 1 <= i < N:
-        val = input[i - win + 1]
-
-        for j from (i - win + 1) <= j <= i:
-            val = min(val, input[j])
-
-        output[j] = val
+    return output
 
-def _roll_min_noncontig(ndarray[double_t, ndim=1] input,
-                        ndarray[double_t, ndim=1] output,
-                        int win, int N):
+def _roll_min(ndarray[double_t, ndim=1] input,
+              int win):
     cdef double val
     cdef int i, j
+    cdef int N = len(input)
+
+    cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
 
     for i from 0 <= i < win - 1:
         output[i] = NaN
@@ -639,57 +406,11 @@ def _roll_min_noncontig(ndarray[double_t, ndim=1] input,
 
         output[j] = val
 
-def roll_median(ndarray[npy_float64, ndim=1] arr, int window, int minp):
-    cdef char *mask_data
-    cdef ndarray mask
-    cdef ndarray[npy_float64, ndim=1] result
-    cdef int i, n
-
-    n = len(arr)
-    arr = arr.copy()
-
-    mask = <ndarray> np.isfinite(arr)
-    mask_data = <char *> mask.data
-
-    result = np.empty(len(arr), dtype=float)
-
-    for i from minp <= i <= n:
-        pass
-
-def rolling_median(ndarray[double, ndim=1] arr, int window):
-    cdef int i, n, midpoint
-    cdef IndexableSkiplist skiplist
-    cdef ndarray[double, ndim=1] result
-
-    n = len(arr)
-    skiplist = IndexableSkiplist(window)
-    result = np.empty(n, dtype=float)
-    result[:window] = NaN
-
-    for i from 0 <= i < window:
-        skiplist.insert(arr[i])
-
-    midpoint = window / 2
-
-    cdef int flag = window % 2
-
-    for i from window <= i < n:
-        skiplist.remove(arr[i - window])
-        skiplist.insert(arr[i])
-
-        if flag:
-            result[i] = skiplist.get(midpoint)
-        else:
-            result[i] = (skiplist.get(midpoint) +
-                         skiplist.get(midpoint - 1)) / 2
-
-    return result
+    return output
 
 #-------------------------------------------------------------------------------
 # Python interface
 
-# I could use function pointers here and trim down the code duplication
-
 def rolling_sum(ndarray input, window, minp=None):
     '''
     Compute rolling sum of input array
@@ -704,63 +425,33 @@ def rolling_sum(ndarray input, window, minp=None):
     -------
     ndarray with length of input
     '''
-    N = len(input)
-
     if minp is None:
         minp = window
 
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
-
-    if is_contiguous(input):
-        _roll_sum(get_double_ptr(input), get_double_ptr(output),
-                   window, minp, N)
-    else:
-        _roll_sum_noncontig(input, output, window, minp, N)
-
-    return output
+    return _roll_sum(input, window, minp)
 
 def rolling_mean(ndarray input, window, minp=None):
-    N = len(input)
-
     if minp is None:
         minp = window
 
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
-
-    if is_contiguous(input):
-        _roll_mean(get_double_ptr(input), get_double_ptr(output),
-                   window, minp, N)
-    else:
-        _roll_mean_noncontig(input, output, window, minp, N)
-
-    return output
+    return _roll_mean(input, window, minp)
 
-
-def ewma(ndarray input, com):
-    N = len(input)
+def rolling_median(ndarray input, window, minp=None):
+    if minp is None:
+        minp = window
 
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
-
-    if is_contiguous(input):
-        _ewma(get_double_ptr(input), get_double_ptr(output),
-              com, N)
-    else:
-        _ewma_noncontig(input, output, com, N)
-
-    return output
+    return _roll_median(input, window, minp)
 
 def rolling_var(ndarray input, window, minp=None):
-    N = len(input)
-
     if minp is None:
         minp = window
     else:
@@ -769,24 +460,13 @@ def rolling_var(ndarray input, window, minp=None):
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
-
-    if is_contiguous(input):
-        _roll_var(get_double_ptr(input), get_double_ptr(output),
-                   window, minp, N)
-    else:
-        _roll_var_noncontig(input, output, window, minp, N)
-
-    return output
+    return _roll_var(input, window, minp)
 
 def rolling_std(ndarray input, window, minp=None):
     output = rolling_var(input, window, minp=minp)
-
     return np.sqrt(output)
 
 def rolling_skew(ndarray input, window, minp=None):
-    N = len(input)
-
     if minp is None:
         minp = window
     else:
@@ -795,19 +475,9 @@ def rolling_skew(ndarray input, window, minp=None):
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
-
-    if is_contiguous(input):
-        _roll_skew(get_double_ptr(input), get_double_ptr(output),
-                   window, minp, N)
-    else:
-        _roll_skew_noncontig(input, output, window, minp, N)
-
-    return output
+    return _roll_skew(input, window, minp)
 
 def rolling_kurt(ndarray input, window, minp=None):
-    N = len(input)
-
     if minp is None:
         minp = window
     else:
@@ -816,13 +486,12 @@ def rolling_kurt(ndarray input, window, minp=None):
     if not issubclass(input.dtype.type, float):
         input = input.astype(float)
 
-    cdef ndarray output = np.empty(N, dtype=float)
+    return _roll_kurt(input, window, minp)
 
-    if is_contiguous(input):
-        _roll_kurt(get_double_ptr(input), get_double_ptr(output),
-                   window, minp, N)
-    else:
-        _roll_kurt_noncontig(input, output, window, minp, N)
+def ewma(ndarray input, com):
+    N = len(input)
 
-    return output
+    if not issubclass(input.dtype.type, float):
+        input = input.astype(float)
 
+    return _ewma(input, com, N)
diff --git a/pandas/lib/src/tseries.c b/pandas/lib/src/tseries.c
index 8cf272aba..d854b1a1e 100644
--- a/pandas/lib/src/tseries.c
+++ b/pandas/lib/src/tseries.c
@@ -1,4 +1,4 @@
-/* Generated by Cython 0.12.rc1 on Thu Feb 25 16:05:23 2010 */
+/* Generated by Cython 0.12.rc1 on Thu Feb 25 19:01:48 2010 */
 
 #define PY_SSIZE_T_CLEAN
 #include "Python.h"
@@ -146,7 +146,6 @@
 #include "stdio.h"
 #include "numpy/arrayobject.h"
 #include "numpy/ufuncobject.h"
-#include "wirth.h"
 
 #ifdef __GNUC__
 #define INLINE __inline__
@@ -362,7 +361,7 @@ typedef npy_cdouble __pyx_t_5numpy_complex_t;
 
 typedef double (*__pyx_t_7tseries_double_func)(double, double);
 
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":46
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":43
  * NIL = Node(np.inf, [], np.array([])) # Singleton terminator node
  * 
  * cdef class IndexableSkiplist:             # <<<<<<<<<<<<<<
@@ -443,38 +442,6 @@ static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
 
 static INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type); /*proto*/
 
-/* Run-time type information about structs used with buffers */
-struct __Pyx_StructField_;
-
-typedef struct {
-  const char* name; /* for error messages only */
-  struct __Pyx_StructField_* fields;
-  size_t size;     /* sizeof(type) */
-  char typegroup; /* _R_eal, _C_omplex, Signed _I_nt, _U_nsigned int, _S_truct, _P_ointer, _O_bject */
-} __Pyx_TypeInfo;
-
-typedef struct __Pyx_StructField_ {
-  __Pyx_TypeInfo* type;
-  const char* name;
-  size_t offset;
-} __Pyx_StructField;
-
-typedef struct {
-  __Pyx_StructField* field;
-  size_t parent_offset;
-} __Pyx_BufFmt_StackElem;
-
-
-static INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
-static int __Pyx_GetBufferAndValidate(Py_buffer* buf, PyObject* obj, __Pyx_TypeInfo* dtype, int flags, int nd, int cast, __Pyx_BufFmt_StackElem* stack);
-
-static void __Pyx_RaiseBufferFallbackError(void); /*proto*/
-static void __Pyx_RaiseBufferIndexError(int axis); /*proto*/
-#define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
-
-static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
-static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
-
 static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name, PyObject* kw_name); /*proto*/
 
@@ -483,13 +450,6 @@ static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
 
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,     const char* function_name); /*proto*/
 
-static INLINE long __Pyx_NegateNonNeg(long b) { return unlikely(b < 0) ? b : !b; }
-static INLINE PyObject* __Pyx_PyBoolOrNull_FromLong(long b) {
-    return unlikely(b < 0) ? NULL : __Pyx_PyBool_FromLong(b);
-}
-
-static INLINE void __Pyx_RaiseNoneNotIterableError(void);
-
 
 static INLINE PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
@@ -591,10 +551,49 @@ static INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
     }
 }
 
-static INLINE long __Pyx_mod_long(long, long); /* proto */
+/* Run-time type information about structs used with buffers */
+struct __Pyx_StructField_;
+
+typedef struct {
+  const char* name; /* for error messages only */
+  struct __Pyx_StructField_* fields;
+  size_t size;     /* sizeof(type) */
+  char typegroup; /* _R_eal, _C_omplex, Signed _I_nt, _U_nsigned int, _S_truct, _P_ointer, _O_bject */
+} __Pyx_TypeInfo;
+
+typedef struct __Pyx_StructField_ {
+  __Pyx_TypeInfo* type;
+  const char* name;
+  size_t offset;
+} __Pyx_StructField;
+
+typedef struct {
+  __Pyx_StructField* field;
+  size_t parent_offset;
+} __Pyx_BufFmt_StackElem;
+
+
+static INLINE void __Pyx_SafeReleaseBuffer(Py_buffer* info);
+static int __Pyx_GetBufferAndValidate(Py_buffer* buf, PyObject* obj, __Pyx_TypeInfo* dtype, int flags, int nd, int cast, __Pyx_BufFmt_StackElem* stack);
+
+static void __Pyx_RaiseBufferFallbackError(void); /*proto*/
+static void __Pyx_RaiseBufferIndexError(int axis); /*proto*/
+#define __Pyx_BufPtrStrided1d(type, buf, i0, s0) (type)((char*)buf + i0 * s0)
+
+static INLINE void __Pyx_ErrRestore(PyObject *type, PyObject *value, PyObject *tb); /*proto*/
+static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **tb); /*proto*/
+
+static INLINE long __Pyx_NegateNonNeg(long b) { return unlikely(b < 0) ? b : !b; }
+static INLINE PyObject* __Pyx_PyBoolOrNull_FromLong(long b) {
+    return unlikely(b < 0) ? NULL : __Pyx_PyBool_FromLong(b);
+}
+
+static INLINE void __Pyx_RaiseNoneNotIterableError(void);
 
 static INLINE long __Pyx_div_long(long, long); /* proto */
 
+static INLINE long __Pyx_mod_long(long, long); /* proto */
+
 static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
 
 static INLINE void __Pyx_RaiseTooManyValuesError(void);
@@ -817,14 +816,6 @@ static __pyx_t_5numpy_double_t *__pyx_f_7tseries_get_double_ptr(PyArrayObject *)
 static PyObject *__pyx_f_7tseries_map_indices(PyArrayObject *, int __pyx_skip_dispatch); /*proto*/
 static INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *); /*proto*/
 static PyArrayObject *__pyx_f_7tseries__isnullobj(PyObject *); /*proto*/
-static void __pyx_f_7tseries__roll_sum(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_mean(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int, int); /*proto*/
-static void __pyx_f_7tseries__ewma(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_var(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_skew(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_max(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int); /*proto*/
-static void __pyx_f_7tseries__roll_min(__pyx_t_5numpy_double_t *, __pyx_t_5numpy_double_t *, int, int); /*proto*/
 static PyObject *__pyx_f_7tseries__nofill(PyArrayObject *, PyArrayObject *, PyObject *, PyObject *); /*proto*/
 static PyObject *__pyx_f_7tseries__backfill(PyArrayObject *, PyArrayObject *, PyObject *, PyObject *); /*proto*/
 static PyObject *__pyx_f_7tseries__pad(PyArrayObject *, PyArrayObject *, PyObject *, PyObject *); /*proto*/
@@ -842,7 +833,6 @@ static __Pyx_TypeInfo __Pyx_TypeInfo_nn_npy_int8 = { "numpy.npy_int8", NULL, siz
 static __Pyx_TypeInfo __Pyx_TypeInfo_object = { "Python object", NULL, sizeof(PyObject *), 'O' };
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn_npy_float64 = { "numpy.npy_float64", NULL, sizeof(npy_float64), 'R' };
 static __Pyx_TypeInfo __Pyx_TypeInfo_nn___pyx_t_5numpy_double_t = { "numpy.double_t", NULL, sizeof(__pyx_t_5numpy_double_t), 'R' };
-static __Pyx_TypeInfo __Pyx_TypeInfo_double = { "double", NULL, sizeof(double), 'R' };
 #define __Pyx_MODULE_NAME "tseries"
 int __pyx_module_is_main_tseries = 0;
 
@@ -857,24 +847,20 @@ static PyObject *__pyx_builtin_object;
 static PyObject *__pyx_builtin_RuntimeError;
 static char __pyx_k_1[] = "Error calling func on index %s";
 static char __pyx_k_2[] = "Tried to use data field on non-contiguous array!";
-static char __pyx_k_3[] = "Dates and values were not the same length!";
-static char __pyx_k_4[] = "Not Found";
-static char __pyx_k_5[] = "_roll_mean_noncontig";
-static char __pyx_k_6[] = "_roll_skew_noncontig";
-static char __pyx_k_7[] = "_roll_kurt_noncontig";
-static char __pyx_k_8[] = "";
-static char __pyx_k_9[] = "bad funcname requested of Cython code";
-static char __pyx_k_10[] = "ndarray is not C contiguous";
-static char __pyx_k_11[] = "ndarray is not Fortran contiguous";
-static char __pyx_k_12[] = "Non-native byte order not supported";
-static char __pyx_k_13[] = "unknown dtype code in numpy.pxd (%d)";
-static char __pyx_k_14[] = "Format string allocated too short, see comment in numpy.pxd";
-static char __pyx_k_15[] = "Format string allocated too short.";
+static char __pyx_k_3[] = "Not Found";
+static char __pyx_k_4[] = "Dates and values were not the same length!";
+static char __pyx_k_5[] = "";
+static char __pyx_k_6[] = "bad funcname requested of Cython code";
+static char __pyx_k_7[] = "ndarray is not C contiguous";
+static char __pyx_k_8[] = "ndarray is not Fortran contiguous";
+static char __pyx_k_9[] = "Non-native byte order not supported";
+static char __pyx_k_10[] = "unknown dtype code in numpy.pxd (%d)";
+static char __pyx_k_11[] = "Format string allocated too short, see comment in numpy.pxd";
+static char __pyx_k_12[] = "Format string allocated too short.";
 static char __pyx_k__B[] = "B";
 static char __pyx_k__H[] = "H";
 static char __pyx_k__I[] = "I";
 static char __pyx_k__L[] = "L";
-static char __pyx_k__N[] = "N";
 static char __pyx_k__O[] = "O";
 static char __pyx_k__Q[] = "Q";
 static char __pyx_k__S[] = "S";
@@ -909,7 +895,6 @@ static char __pyx_k__aMap[] = "aMap";
 static char __pyx_k__bMap[] = "bMap";
 static char __pyx_k__base[] = "base";
 static char __pyx_k__bool[] = "bool";
-static char __pyx_k__copy[] = "copy";
 static char __pyx_k__data[] = "data";
 static char __pyx_k__func[] = "func";
 static char __pyx_k__head[] = "head";
@@ -923,6 +908,7 @@ static char __pyx_k__ones[] = "ones";
 static char __pyx_k__size[] = "size";
 static char __pyx_k__sqrt[] = "sqrt";
 static char __pyx_k__type[] = "type";
+static char __pyx_k___ewma[] = "_ewma";
 static char __pyx_k__array[] = "array";
 static char __pyx_k__descr[] = "descr";
 static char __pyx_k__dtype[] = "dtype";
@@ -952,7 +938,6 @@ static char __pyx_k__isnull[] = "isnull";
 static char __pyx_k__newMap[] = "newMap";
 static char __pyx_k__object[] = "object";
 static char __pyx_k__oldMap[] = "oldMap";
-static char __pyx_k__output[] = "output";
 static char __pyx_k__random[] = "random";
 static char __pyx_k__remove[] = "remove";
 static char __pyx_k__values[] = "values";
@@ -979,38 +964,37 @@ static char __pyx_k__oldIndex[] = "oldIndex";
 static char __pyx_k__readonly[] = "readonly";
 static char __pyx_k__type_num[] = "type_num";
 static char __pyx_k__Exception[] = "Exception";
+static char __pyx_k___roll_sum[] = "_roll_sum";
+static char __pyx_k___roll_var[] = "_roll_var";
 static char __pyx_k__applyfunc[] = "applyfunc";
 static char __pyx_k__byteorder[] = "byteorder";
 static char __pyx_k__maxlevels[] = "maxlevels";
 static char __pyx_k__width_arr[] = "width_arr";
 static char __pyx_k__ValueError[] = "ValueError";
+static char __pyx_k___roll_kurt[] = "_roll_kurt";
+static char __pyx_k___roll_mean[] = "_roll_mean";
+static char __pyx_k___roll_skew[] = "_roll_skew";
 static char __pyx_k__pydatetime[] = "pydatetime";
 static char __pyx_k__suboffsets[] = "suboffsets";
 static char __pyx_k__rolling_var[] = "rolling_var";
 static char __pyx_k__RuntimeError[] = "RuntimeError";
+static char __pyx_k___roll_median[] = "_roll_median";
 static char __pyx_k__expected_size[] = "expected_size";
-static char __pyx_k___ewma_noncontig[] = "_ewma_noncontig";
-static char __pyx_k___roll_sum_noncontig[] = "_roll_sum_noncontig";
-static char __pyx_k___roll_var_noncontig[] = "_roll_var_noncontig";
 static PyObject *__pyx_kp_s_1;
 static PyObject *__pyx_kp_u_10;
 static PyObject *__pyx_kp_u_11;
 static PyObject *__pyx_kp_u_12;
-static PyObject *__pyx_kp_u_13;
-static PyObject *__pyx_kp_u_14;
-static PyObject *__pyx_kp_u_15;
 static PyObject *__pyx_kp_s_2;
 static PyObject *__pyx_kp_s_3;
 static PyObject *__pyx_kp_s_4;
-static PyObject *__pyx_n_s_5;
-static PyObject *__pyx_n_s_6;
-static PyObject *__pyx_n_s_7;
-static PyObject *__pyx_kp_s_8;
-static PyObject *__pyx_kp_s_9;
+static PyObject *__pyx_kp_s_5;
+static PyObject *__pyx_kp_s_6;
+static PyObject *__pyx_kp_u_7;
+static PyObject *__pyx_kp_u_8;
+static PyObject *__pyx_kp_u_9;
 static PyObject *__pyx_n_s__BACKFILL;
 static PyObject *__pyx_n_s__Exception;
 static PyObject *__pyx_n_s__KeyError;
-static PyObject *__pyx_n_s__N;
 static PyObject *__pyx_n_s__NIL;
 static PyObject *__pyx_n_s__NaN;
 static PyObject *__pyx_n_s__O;
@@ -1028,9 +1012,13 @@ static PyObject *__pyx_n_s____mul__;
 static PyObject *__pyx_n_s____ne__;
 static PyObject *__pyx_n_s____pow__;
 static PyObject *__pyx_n_s____sub__;
-static PyObject *__pyx_n_s___ewma_noncontig;
-static PyObject *__pyx_n_s___roll_sum_noncontig;
-static PyObject *__pyx_n_s___roll_var_noncontig;
+static PyObject *__pyx_n_s___ewma;
+static PyObject *__pyx_n_s___roll_kurt;
+static PyObject *__pyx_n_s___roll_mean;
+static PyObject *__pyx_n_s___roll_median;
+static PyObject *__pyx_n_s___roll_skew;
+static PyObject *__pyx_n_s___roll_sum;
+static PyObject *__pyx_n_s___roll_var;
 static PyObject *__pyx_n_s__aMap;
 static PyObject *__pyx_n_s__any;
 static PyObject *__pyx_n_s__ao;
@@ -1047,7 +1035,6 @@ static PyObject *__pyx_n_s__bool;
 static PyObject *__pyx_n_s__buf;
 static PyObject *__pyx_n_s__byteorder;
 static PyObject *__pyx_n_s__com;
-static PyObject *__pyx_n_s__copy;
 static PyObject *__pyx_n_s__data;
 static PyObject *__pyx_n_s__datetime;
 static PyObject *__pyx_n_s__descr;
@@ -1092,7 +1079,6 @@ static PyObject *__pyx_n_s__object_;
 static PyObject *__pyx_n_s__oldIndex;
 static PyObject *__pyx_n_s__oldMap;
 static PyObject *__pyx_n_s__ones;
-static PyObject *__pyx_n_s__output;
 static PyObject *__pyx_n_s__pydatetime;
 static PyObject *__pyx_n_s__random;
 static PyObject *__pyx_n_s__range;
@@ -1715,4695 +1701,2242 @@ static PyObject *__pyx_pf_7tseries_map_indices(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":5
- * cdef double NEGINF = -INF
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":29
+ *     cdef public:
+ *         double value
+ *         list next             # <<<<<<<<<<<<<<
+ *         ndarray width_arr
  * 
- * cdef inline _checknull(object val):             # <<<<<<<<<<<<<<
- *     if isinstance(val, float):
- *         return val != val or val == INF or val == NEGINF
  */
 
-static INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *__pyx_v_val) {
+static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  __Pyx_RefNannySetupContext("_checknull");
-  __Pyx_INCREF(__pyx_v_val);
+  __Pyx_RefNannySetupContext("__get__");
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  goto __pyx_L0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":6
- * 
- * cdef inline _checknull(object val):
- *     if isinstance(val, float):             # <<<<<<<<<<<<<<
- *         return val != val or val == INF or val == NEGINF
- *     else:
- */
-  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_val, ((PyTypeObject *)((PyObject*)&PyFloat_Type))); 
-  if (__pyx_t_1) {
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":7
- * cdef inline _checknull(object val):
- *     if isinstance(val, float):
- *         return val != val or val == INF or val == NEGINF             # <<<<<<<<<<<<<<
- *     else:
- *         return val is None
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_val, __pyx_v_val, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    if (!__pyx_t_1) {
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_INF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      if (!__pyx_t_1) {
-        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_NEGINF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_5 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_5);
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_3 = __pyx_t_5;
-        __pyx_t_5 = 0;
-      } else {
-        __pyx_t_3 = __pyx_t_4;
-        __pyx_t_4 = 0;
-      }
-      __pyx_t_4 = __pyx_t_3;
-      __pyx_t_3 = 0;
-    } else {
-      __pyx_t_4 = __pyx_t_2;
-      __pyx_t_2 = 0;
-    }
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-    goto __pyx_L3;
-  }
-  /*else*/ {
+static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__set__");
+  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(__pyx_v_value);
+  __Pyx_GIVEREF(__pyx_v_value);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject *)__pyx_v_value);
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":9
- *         return val != val or val == INF or val == NEGINF
- *     else:
- *         return val is None             # <<<<<<<<<<<<<<
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("tseries.Node.next.__set__");
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":30
+ *         double value
+ *         list next
+ *         ndarray width_arr             # <<<<<<<<<<<<<<
  * 
- * cdef ndarray _isnullobj(input):
+ *     cdef:
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = (__pyx_v_val == Py_None);
-    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-  }
-  __pyx_L3:;
+
+static PyObject *__pyx_pf_7tseries_4Node_9width_arr___get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pf_7tseries_4Node_9width_arr___get__(PyObject *__pyx_v_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannySetupContext("__get__");
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
+  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_7tseries_4Node_9width_arr___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
+static int __pyx_pf_7tseries_4Node_9width_arr___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
+  int __pyx_r;
+  __Pyx_RefNannySetupContext("__set__");
+  if (!(likely(((__pyx_v_value) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_value, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(__pyx_v_value);
+  __Pyx_GIVEREF(__pyx_v_value);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr = ((PyArrayObject *)__pyx_v_value);
+
+  __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("tseries._checknull");
-  __pyx_r = 0;
+  __Pyx_AddTraceback("tseries.Node.width_arr.__set__");
+  __pyx_r = -1;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_val);
-  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":11
- *         return val is None
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":35
+ *         int *width
  * 
- * cdef ndarray _isnullobj(input):             # <<<<<<<<<<<<<<
- *     cdef int i, length
- *     cdef object val
+ *     def __init__(self, double value, list next, ndarray width):             # <<<<<<<<<<<<<<
+ *         self.value = value
+ *         self.next = next
  */
 
-static  PyArrayObject *__pyx_f_7tseries__isnullobj(PyObject *__pyx_v_input) {
-  int __pyx_v_i;
-  int __pyx_v_length;
-  PyObject *__pyx_v_val;
-  PyArrayObject *__pyx_v_result;
-  PyArrayIterObject *__pyx_v_iter;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
-  PyArrayObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  int __pyx_t_13;
-  __Pyx_RefNannySetupContext("_isnullobj");
-  __Pyx_INCREF(__pyx_v_input);
-  __pyx_v_val = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_result.buf = NULL;
-
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":17
- *     cdef flatiter iter
- * 
- *     length = PyArray_SIZE(input)             # <<<<<<<<<<<<<<
- * 
- *     result = <ndarray> np.zeros(length, dtype=np.int8)
- */
-  if (!(likely(((__pyx_v_input) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_input, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_v_input));
-
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":19
- *     length = PyArray_SIZE(input)
- * 
- *     result = <ndarray> np.zeros(length, dtype=np.int8)             # <<<<<<<<<<<<<<
- * 
- *     iter= PyArray_IterNew(input)
- */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  double __pyx_v_value;
+  PyObject *__pyx_v_next = 0;
+  PyArrayObject *__pyx_v_width = 0;
+  int __pyx_r;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__value,&__pyx_n_s__next,&__pyx_n_s__width,0};
+  __Pyx_RefNannySetupContext("__init__");
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[3] = {0,0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__next);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__width);
+      if (likely(values[2])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
-    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_value = __pyx_PyFloat_AsDouble(values[0]); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_next = ((PyObject *)values[1]);
+    __pyx_v_width = ((PyArrayObject *)values[2]);
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_value = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_next = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
+    __pyx_v_width = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 2));
   }
-  __pyx_t_6 = 0;
-  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_5)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_result));
-  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.Node.__init__");
+  return -1;
+  __pyx_L4_argument_unpacking_done:;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_next), &PyList_Type, 1, "next", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_width), __pyx_ptype_5numpy_ndarray, 1, "width", 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":21
- *     result = <ndarray> np.zeros(length, dtype=np.int8)
- * 
- *     iter= PyArray_IterNew(input)             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":36
  * 
- *     for i from 0 <= i < length:
+ *     def __init__(self, double value, list next, ndarray width):
+ *         self.value = value             # <<<<<<<<<<<<<<
+ *         self.next = next
+ *         self.width_arr = width
  */
-  __pyx_t_5 = PyArray_IterNew(__pyx_v_input); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_flatiter))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
-  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_5);
-  __pyx_t_5 = 0;
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_v_value;
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":23
- *     iter= PyArray_IterNew(input)
- * 
- *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
- * 
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":37
+ *     def __init__(self, double value, list next, ndarray width):
+ *         self.value = value
+ *         self.next = next             # <<<<<<<<<<<<<<
+ *         self.width_arr = width
+ *         self.width = <int *> width.data
  */
-  __pyx_t_7 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
+  __Pyx_INCREF(((PyObject *)__pyx_v_next));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_next));
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = __pyx_v_next;
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":24
- * 
- *     for i from 0 <= i < length:
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":38
+ *         self.value = value
+ *         self.next = next
+ *         self.width_arr = width             # <<<<<<<<<<<<<<
+ *         self.width = <int *> width.data
  * 
- *         if _checknull(val):
  */
-    if (!(likely(((__pyx_v_input) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_input, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_5 = PyArray_GETITEM(((PyArrayObject *)__pyx_v_input), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_v_val);
-    __pyx_v_val = __pyx_t_5;
-    __pyx_t_5 = 0;
+  __Pyx_INCREF(((PyObject *)__pyx_v_width));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_width));
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr = __pyx_v_width;
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":26
- *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
- * 
- *         if _checknull(val):             # <<<<<<<<<<<<<<
- *             result[i] = 1
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":39
+ *         self.next = next
+ *         self.width_arr = width
+ *         self.width = <int *> width.data             # <<<<<<<<<<<<<<
  * 
+ * NIL = Node(np.inf, [], np.array([])) # Singleton terminator node
  */
-    __pyx_t_5 = __pyx_f_7tseries__checknull(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (__pyx_t_11) {
+  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((int *)__pyx_v_width->data);
 
-      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":27
- * 
- *         if _checknull(val):
- *             result[i] = 1             # <<<<<<<<<<<<<<
- * 
- *         PyArray_ITER_NEXT(iter)
- */
-      __pyx_t_12 = __pyx_v_i;
-      __pyx_t_13 = -1;
-      if (__pyx_t_12 < 0) {
-        __pyx_t_12 += __pyx_bshape_0_result;
-        if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
-      } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_result)) __pyx_t_13 = 0;
-      if (unlikely(__pyx_t_13 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_13);
-        {__pyx_filename = __pyx_f[4]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_result.buf, __pyx_t_12, __pyx_bstride_0_result) = 1;
-      goto __pyx_L5;
-    }
-    __pyx_L5:;
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("tseries.Node.__init__");
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":29
- *             result[i] = 1
- * 
- *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":51
+ *         Node head
  * 
- *     return result
+ *     def __init__(self, expected_size=100):             # <<<<<<<<<<<<<<
+ *         self.size = 0
+ *         self.maxlevels = int(1 + log2(expected_size))
  */
-    PyArray_ITER_NEXT(__pyx_v_iter);
-  }
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":31
- *         PyArray_ITER_NEXT(iter)
+static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_expected_size = 0;
+  int __pyx_r;
+  double __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__expected_size,0};
+  __Pyx_RefNannySetupContext("__init__");
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[1] = {0};
+    values[0] = ((PyObject *)__pyx_int_100);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      if (kw_args > 1) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__expected_size);
+        if (unlikely(value)) { values[0] = value; kw_args--; }
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_expected_size = values[0];
+  } else {
+    __pyx_v_expected_size = ((PyObject *)__pyx_int_100);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  1: __pyx_v_expected_size = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  return -1;
+  __pyx_L4_argument_unpacking_done:;
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":52
  * 
- *     return result             # <<<<<<<<<<<<<<
+ *     def __init__(self, expected_size=100):
+ *         self.size = 0             # <<<<<<<<<<<<<<
+ *         self.maxlevels = int(1 + log2(expected_size))
  * 
- * def isnull(input):
  */
-  __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyArrayObject *)__pyx_v_result);
-  goto __pyx_L0;
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size = 0;
 
-  __pyx_r = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":53
+ *     def __init__(self, expected_size=100):
+ *         self.size = 0
+ *         self.maxlevels = int(1 + log2(expected_size))             # <<<<<<<<<<<<<<
+ * 
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels,
+ */
+  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_expected_size); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 53; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels = ((int)(1 + log2(__pyx_t_1)));
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":55
+ *         self.maxlevels = int(1 + log2(expected_size))
+ * 
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels,             # <<<<<<<<<<<<<<
+ *                          np.ones(self.maxlevels, dtype=int))
+ * 
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__NIL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
+  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_5 = PyNumber_Multiply(((PyObject *)__pyx_t_4), __pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":56
+ * 
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels,
+ *                          np.ones(self.maxlevels, dtype=int))             # <<<<<<<<<<<<<<
+ * 
+ *     def __len__(self):
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__ones); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_6);
+  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyInt_Type))) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
+  __Pyx_GIVEREF(__pyx_t_5);
+  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_7);
+  __Pyx_GIVEREF(__pyx_t_7);
+  __pyx_t_3 = 0;
+  __pyx_t_5 = 0;
+  __pyx_t_7 = 0;
+  __pyx_t_7 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":55
+ *         self.maxlevels = int(1 + log2(expected_size))
+ * 
+ *         self.head = Node(np.NaN, [NIL] * self.maxlevels,             # <<<<<<<<<<<<<<
+ *                          np.ones(self.maxlevels, dtype=int))
+ * 
+ */
+  __Pyx_GIVEREF(__pyx_t_7);
+  __Pyx_GOTREF(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head);
+  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head = ((struct __pyx_obj_7tseries_Node *)__pyx_t_7);
+  __pyx_t_7 = 0;
+
+  __pyx_r = 0;
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._isnullobj");
-  __pyx_r = 0;
-  goto __pyx_L2;
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
+  __pyx_r = -1;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_val);
-  __Pyx_DECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_iter);
-  __Pyx_DECREF(__pyx_v_input);
-  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":33
- *     return result
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":58
+ *                          np.ones(self.maxlevels, dtype=int))
+ * 
+ *     def __len__(self):             # <<<<<<<<<<<<<<
+ *         return self.size
  * 
- * def isnull(input):             # <<<<<<<<<<<<<<
- *     '''
- *     Replacement for numpy.isnan / -numpy.isfinite which is suitable
  */
 
-static PyObject *__pyx_pf_7tseries_isnull(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
-static char __pyx_doc_7tseries_isnull[] = "\n    Replacement for numpy.isnan / -numpy.isfinite which is suitable\n    for use on object arrays.\n\n    Parameters\n    ----------\n    arr: ndarray or object value\n\n    Returns\n    -------\n    boolean ndarray or boolean\n    ";
-static PyObject *__pyx_pf_7tseries_isnull(PyObject *__pyx_self, PyObject *__pyx_v_input) {
-  PyArrayObject *__pyx_v_result;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
-  PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  __Pyx_RefNannySetupContext("isnull");
-  __pyx_self = __pyx_self;
-  __Pyx_INCREF(__pyx_v_input);
-  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_result.buf = NULL;
+static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self); /*proto*/
+static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self) {
+  Py_ssize_t __pyx_r;
+  __Pyx_RefNannySetupContext("__len__");
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":48
- *     cdef ndarray[npy_int8, ndim=1] result
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":59
  * 
- *     if isinstance(input, np.ndarray):             # <<<<<<<<<<<<<<
- *         if input.dtype.kind in ('O', 'S'):
- *             result = _isnullobj(input)
+ *     def __len__(self):
+ *         return self.size             # <<<<<<<<<<<<<<
+ * 
+ *     def __getitem__(self, i):
  */
-  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_input, ((PyTypeObject *)((PyObject*)__pyx_ptype_5numpy_ndarray))); 
-  if (__pyx_t_1) {
+  __pyx_r = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size;
+  goto __pyx_L0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":49
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":61
+ *         return self.size
  * 
- *     if isinstance(input, np.ndarray):
- *         if input.dtype.kind in ('O', 'S'):             # <<<<<<<<<<<<<<
- *             result = _isnullobj(input)
+ *     def __getitem__(self, i):             # <<<<<<<<<<<<<<
+ *         return self.get(i)
  * 
  */
-    __pyx_t_2 = PyObject_GetAttr(__pyx_v_input, __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__kind); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_n_s__O), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_1 == (int)-1))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_4 = ((int)__pyx_t_1);
-    if (!__pyx_t_4) {
-      __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_n_s__S), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_1 == (int)-1))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = ((int)__pyx_t_1);
-      __pyx_t_1 = __pyx_t_5;
-    } else {
-      __pyx_t_1 = __pyx_t_4;
-    }
-    __pyx_t_4 = __pyx_t_1;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (__pyx_t_4) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":50
- *     if isinstance(input, np.ndarray):
- *         if input.dtype.kind in ('O', 'S'):
- *             result = _isnullobj(input)             # <<<<<<<<<<<<<<
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  __Pyx_RefNannySetupContext("__getitem__");
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":62
  * 
- *             return result.astype(np.bool)
- */
-      __pyx_t_3 = ((PyObject *)__pyx_f_7tseries__isnullobj(__pyx_v_input)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      {
-        __Pyx_BufFmt_StackElem __pyx_stack[1];
-        __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-        __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)((PyArrayObject *)__pyx_t_3), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-        if (unlikely(__pyx_t_6 < 0)) {
-          PyErr_Fetch(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
-          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-            Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
-            __Pyx_RaiseBufferFallbackError();
-          } else {
-            PyErr_Restore(__pyx_t_7, __pyx_t_8, __pyx_t_9);
-          }
-        }
-        __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-        __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-        if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __Pyx_DECREF(((PyObject *)__pyx_v_result));
-      __pyx_v_result = ((PyArrayObject *)__pyx_t_3);
-      __pyx_t_3 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":52
- *             result = _isnullobj(input)
- * 
- *             return result.astype(np.bool)             # <<<<<<<<<<<<<<
- *         else:
- *             return -np.isfinite(input)
- */
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_result), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_10 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__bool); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_10);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_10);
-      __Pyx_GIVEREF(__pyx_t_10);
-      __pyx_t_10 = 0;
-      __pyx_t_10 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_10);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_r = __pyx_t_10;
-      __pyx_t_10 = 0;
-      goto __pyx_L0;
-      goto __pyx_L6;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":54
- *             return result.astype(np.bool)
- *         else:
- *             return -np.isfinite(input)             # <<<<<<<<<<<<<<
- *     else:
- *         return _checknull(input)
- */
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_10 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_10);
-      __pyx_t_2 = PyObject_GetAttr(__pyx_t_10, __pyx_n_s__isfinite); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_10);
-      __Pyx_INCREF(__pyx_v_input);
-      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_input);
-      __Pyx_GIVEREF(__pyx_v_input);
-      __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = PyNumber_Negative(__pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_10);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_r = __pyx_t_10;
-      __pyx_t_10 = 0;
-      goto __pyx_L0;
-    }
-    __pyx_L6:;
-    goto __pyx_L5;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":56
- *             return -np.isfinite(input)
- *     else:
- *         return _checknull(input)             # <<<<<<<<<<<<<<
+ *     def __getitem__(self, i):
+ *         return self.get(i)             # <<<<<<<<<<<<<<
  * 
- * def notnull(input):
+ *     def get(self, int i):
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_10 = __pyx_f_7tseries__checknull(__pyx_v_input); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_10);
-    __pyx_r = __pyx_t_10;
-    __pyx_t_10 = 0;
-    goto __pyx_L0;
-  }
-  __pyx_L5:;
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__get); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(__pyx_v_i);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_i);
+  __Pyx_GIVEREF(__pyx_v_i);
+  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_10);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.isnull");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.__getitem__");
   __pyx_r = NULL;
-  goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF(__pyx_v_input);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":58
- *         return _checknull(input)
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":64
+ *         return self.get(i)
  * 
- * def notnull(input):             # <<<<<<<<<<<<<<
- *     '''
- *     Replacement for numpy.isfinite / -numpy.isnan which is suitable
+ *     def get(self, int i):             # <<<<<<<<<<<<<<
+ *         cdef int level
+ *         cdef Node node
  */
 
-static PyObject *__pyx_pf_7tseries_notnull(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
-static char __pyx_doc_7tseries_notnull[] = "\n    Replacement for numpy.isfinite / -numpy.isnan which is suitable\n    for use on object arrays.\n\n    Parameters\n    ----------\n    arr: ndarray or object value\n\n    Returns\n    -------\n    boolean ndarray or boolean\n    ";
-static PyObject *__pyx_pf_7tseries_notnull(PyObject *__pyx_self, PyObject *__pyx_v_input) {
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i) {
+  int __pyx_v_i;
+  int __pyx_v_level;
+  struct __pyx_obj_7tseries_Node *__pyx_v_node;
   PyObject *__pyx_r = NULL;
   int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  __Pyx_RefNannySetupContext("notnull");
-  __pyx_self = __pyx_self;
-  __Pyx_INCREF(__pyx_v_input);
-
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":71
- *     boolean ndarray or boolean
- *     '''
- *     if isinstance(input, np.ndarray):             # <<<<<<<<<<<<<<
- *         return -isnull(input)
- *     else:
- */
-  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_input, ((PyTypeObject *)((PyObject*)__pyx_ptype_5numpy_ndarray))); 
-  if (__pyx_t_1) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":72
- *     '''
- *     if isinstance(input, np.ndarray):
- *         return -isnull(input)             # <<<<<<<<<<<<<<
- *     else:
- *         return not bool(_checknull(input))
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnull); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_INCREF(__pyx_v_input);
-    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_input);
-    __Pyx_GIVEREF(__pyx_v_input);
-    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_r = __pyx_t_3;
-    __pyx_t_3 = 0;
-    goto __pyx_L0;
-    goto __pyx_L5;
+  __Pyx_RefNannySetupContext("get");
+  assert(__pyx_arg_i); {
+    __pyx_v_i = __Pyx_PyInt_AsInt(__pyx_arg_i); if (unlikely((__pyx_v_i == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 64; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
-  /*else*/ {
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_self);
+  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
 
-    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":74
- *         return -isnull(input)
- *     else:
- *         return not bool(_checknull(input))             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":68
+ *         cdef Node node
+ * 
+ *         node = self.head             # <<<<<<<<<<<<<<
+ *         i += 1
  * 
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __pyx_f_7tseries__checknull(__pyx_v_input); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
-    __Pyx_GIVEREF(__pyx_t_3);
-    __pyx_t_3 = 0;
-    __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyBool_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyBool_FromLong((!__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_r = __pyx_t_3;
-    __pyx_t_3 = 0;
-    goto __pyx_L0;
-  }
-  __pyx_L5:;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("tseries.notnull");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_input);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
+  __Pyx_DECREF(((PyObject *)__pyx_v_node));
+  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
 
-/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":6
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":69
  * 
- * @cython.boundscheck(False)
- * def arrmap(ndarray[object, ndim=1] index, object func):             # <<<<<<<<<<<<<<
- *     cdef int length = index.shape[0]
- *     cdef int i = 0
+ *         node = self.head
+ *         i += 1             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(self.maxlevels - 1, -1, -1):
  */
+  __pyx_v_i += 1;
 
-static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_func = 0;
-  int __pyx_v_length;
-  int __pyx_v_i;
-  PyArrayObject *__pyx_v_result = 0;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  PyObject **__pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__func,0};
-  __Pyx_RefNannySetupContext("arrmap");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__func);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "arrmap") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_func = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_func = PyTuple_GET_ITEM(__pyx_args, 1);
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.arrmap");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_index);
-  __Pyx_INCREF(__pyx_v_func);
-  __pyx_bstruct_result.buf = NULL;
-  __pyx_bstruct_index.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":7
- * @cython.boundscheck(False)
- * def arrmap(ndarray[object, ndim=1] index, object func):
- *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
- *     cdef int i = 0
- * 
- */
-  __pyx_v_length = (__pyx_v_index->dimensions[0]);
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":8
- * def arrmap(ndarray[object, ndim=1] index, object func):
- *     cdef int length = index.shape[0]
- *     cdef int i = 0             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":71
+ *         i += 1
  * 
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
+ *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]
  */
-  __pyx_v_i = 0;
+  for (__pyx_t_1 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_1 > -1; __pyx_t_1-=1) {
+    __pyx_v_level = __pyx_t_1;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":10
- *     cdef int i = 0
- * 
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":72
  * 
- *     for i from 0 <= i < length:
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             while node.width[level] <= i:             # <<<<<<<<<<<<<<
+ *                 i -= node.width[level]
+ *                 node = node.next[level]
  */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__object_); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_result.buf = NULL;
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-      __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-    }
-  }
-  __pyx_t_6 = 0;
-  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
-  __pyx_t_5 = 0;
+    while (1) {
+      __pyx_t_2 = ((__pyx_v_node->width[__pyx_v_level]) <= __pyx_v_i);
+      if (!__pyx_t_2) break;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":12
- *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
- * 
- *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         result[i] = func(index[i])
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":73
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]             # <<<<<<<<<<<<<<
+ *                 node = node.next[level]
  * 
  */
-  __pyx_t_7 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
+      __pyx_v_i -= (__pyx_v_node->width[__pyx_v_level]);
 
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":13
- * 
- *     for i from 0 <= i < length:
- *         result[i] = func(index[i])             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":74
+ *             while node.width[level] <= i:
+ *                 i -= node.width[level]
+ *                 node = node.next[level]             # <<<<<<<<<<<<<<
  * 
- *     return result
+ *         return node.value
  */
-    __pyx_t_8 = __pyx_v_i;
-    if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_index;
-    __pyx_t_5 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_8, __pyx_bstride_0_index);
-    __Pyx_INCREF((PyObject*)__pyx_t_5);
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
-    __Pyx_GIVEREF(__pyx_t_5);
-    __pyx_t_5 = 0;
-    __pyx_t_5 = PyObject_Call(__pyx_v_func, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_9 = __pyx_v_i;
-    if (__pyx_t_9 < 0) __pyx_t_9 += __pyx_bshape_0_result;
-    __pyx_t_10 = __Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_result.buf, __pyx_t_9, __pyx_bstride_0_result);
-    __Pyx_GOTREF(*__pyx_t_10);
-    __Pyx_DECREF(*__pyx_t_10); __Pyx_INCREF(__pyx_t_5);
-    *__pyx_t_10 = __pyx_t_5;
-    __Pyx_GIVEREF(*__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_node));
+      __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+      __pyx_t_3 = 0;
+    }
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":15
- *         result[i] = func(index[i])
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":76
+ *                 node = node.next[level]
  * 
- *     return result             # <<<<<<<<<<<<<<
+ *         return node.value             # <<<<<<<<<<<<<<
  * 
- * @cython.boundscheck(False)
+ *     def insert(self, double value):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyObject *)__pyx_v_result);
+  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_node->value); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.arrmap");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
   __pyx_r = NULL;
-  goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-  __pyx_L2:;
-  __Pyx_XDECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_index);
-  __Pyx_DECREF(__pyx_v_func);
+  __Pyx_DECREF((PyObject *)__pyx_v_node);
+  __Pyx_DECREF((PyObject *)__pyx_v_self);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":18
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":78
+ *         return node.value
  * 
- * @cython.boundscheck(False)
- * def groupby_withnull_old(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
- *     cdef dict groups
- *     cdef int length = index.shape[0]
+ *     def insert(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, steps, d
+ *         cdef Node node, prevnode, newnode, next_at_level
  */
 
-static PyObject *__pyx_pf_7tseries_groupby_withnull_old(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_groupby_withnull_old(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_keyfunc = 0;
-  PyObject *__pyx_v_groups;
-  int __pyx_v_length;
-  PyObject *__pyx_v_idx;
-  PyObject *__pyx_v_curKey;
-  PyObject *__pyx_v_key;
-  PyObject *__pyx_v_members;
-  PyArrayObject *__pyx_v_mapped_index = 0;
-  PyArrayObject *__pyx_v_null_mask = 0;
-  PyObject *__pyx_v_bool_mask;
-  PyObject *__pyx_v_null_values;
-  int __pyx_v_i;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  Py_buffer __pyx_bstruct_null_mask;
-  Py_ssize_t __pyx_bstride_0_null_mask = 0;
-  Py_ssize_t __pyx_bshape_0_null_mask = 0;
-  Py_buffer __pyx_bstruct_mapped_index;
-  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
-  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
+  double __pyx_v_value;
+  int __pyx_v_level;
+  int __pyx_v_steps;
+  int __pyx_v_d;
+  struct __pyx_obj_7tseries_Node *__pyx_v_node;
+  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_newnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
+  PyObject *__pyx_v_chain;
+  PyObject *__pyx_v_steps_at_level;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
+  PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyArrayObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  long __pyx_t_7;
-  long __pyx_t_8;
-  npy_int8 __pyx_t_9;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  double __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_t_11;
-  int __pyx_t_12;
-  PyObject *__pyx_t_13;
-  int __pyx_t_14;
-  int __pyx_t_15;
-  int __pyx_t_16;
-  int __pyx_t_17;
-  int __pyx_t_18;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
-  __Pyx_RefNannySetupContext("groupby_withnull_old");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupby_withnull_old", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_withnull_old") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_keyfunc = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
+  __Pyx_RefNannySetupContext("insert");
+  assert(__pyx_arg_value); {
+    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupby_withnull_old", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupby_withnull_old");
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_index);
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_bool_mask = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_null_values = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_bstruct_mapped_index.buf = NULL;
-  __pyx_bstruct_null_mask.buf = NULL;
-  __pyx_bstruct_index.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
+  __Pyx_INCREF((PyObject *)__pyx_v_self);
+  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_steps_at_level = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":20
- * def groupby_withnull_old(ndarray[object, ndim = 1] index, object keyfunc):
- *     cdef dict groups
- *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
- *     cdef object idx
- *     cdef object curKey, key
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":84
+ * 
+ *         # find first node on each level where node.next[levels].value > value
+ *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
+ *         steps_at_level = [0] * self.maxlevels
+ * 
  */
-  __pyx_v_length = (__pyx_v_index->dimensions[0]);
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
+  __pyx_v_chain = ((PyObject *)__pyx_t_3);
+  __pyx_t_3 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":25
- *     cdef list members
- * 
- *     groups = PyDict_New()             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":85
+ *         # find first node on each level where node.next[levels].value > value
+ *         chain = [None] * self.maxlevels
+ *         steps_at_level = [0] * self.maxlevels             # <<<<<<<<<<<<<<
  * 
- *     if length != index.shape[0]:
+ *         node = self.head
  */
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  __Pyx_INCREF(__pyx_int_0);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
+  __Pyx_GIVEREF(__pyx_int_0);
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
-  __pyx_v_groups = ((PyObject *)__pyx_t_1);
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_steps_at_level));
+  __pyx_v_steps_at_level = ((PyObject *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":27
- *     groups = PyDict_New()
- * 
- *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
- *         raise Exception('Dates and values were not the same length!')
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":87
+ *         steps_at_level = [0] * self.maxlevels
  * 
+ *         node = self.head             # <<<<<<<<<<<<<<
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]
  */
-  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
-  if (__pyx_t_2) {
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
+  __Pyx_DECREF(((PyObject *)__pyx_v_node));
+  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
 
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":28
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":88
  * 
- *     if length != index.shape[0]:
- *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
+ *         node = self.head
+ *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
+ *             next_at_level = node.next[level]
  * 
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
  */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_3));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
+  for (__pyx_t_4 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
+    __pyx_v_level = __pyx_t_4;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":30
- *         raise Exception('Dates and values were not the same length!')
- * 
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":89
+ *         node = self.head
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
+ *             while next_at_level.value <= value:
  */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)__pyx_v_index));
-  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_index));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_keyfunc);
-  __Pyx_GIVEREF(__pyx_v_keyfunc);
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_mapped_index.buf = NULL;
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
-      __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
-    }
-  }
-  __pyx_t_5 = 0;
-  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
+    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
+    __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":32
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
- * 
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":91
+ *             next_at_level = node.next[level]
  * 
- *     bool_mask = null_mask.astype(bool)
+ *             while next_at_level.value <= value:             # <<<<<<<<<<<<<<
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])
  */
-  __pyx_t_4 = ((PyObject *)__pyx_f_7tseries__isnullobj(((PyObject *)__pyx_v_mapped_index))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_null_mask, (PyObject*)((PyArrayObject *)__pyx_t_4), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_null_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_null_mask.buf = NULL;
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_null_mask = __pyx_bstruct_null_mask.strides[0];
-      __pyx_bshape_0_null_mask = __pyx_bstruct_null_mask.shape[0];
-    }
-  }
-  __pyx_v_null_mask = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
+    while (1) {
+      __pyx_t_5 = (__pyx_v_next_at_level->value <= __pyx_v_value);
+      if (!__pyx_t_5) break;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":34
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":92
  * 
- *     bool_mask = null_mask.astype(bool)             # <<<<<<<<<<<<<<
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
+ *                                          node.width[level])
+ *                 node = next_at_level
+ */
+      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":93
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])             # <<<<<<<<<<<<<<
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]
+ */
+      __pyx_t_2 = PyInt_FromLong((__pyx_v_node->width[__pyx_v_level])); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":92
  * 
- *     null_values = np.asarray(index)[bool_mask]
+ *             while next_at_level.value <= value:
+ *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
+ *                                          node.width[level])
+ *                 node = next_at_level
  */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_null_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)((PyObject*)&PyBool_Type)));
-  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)((PyObject*)&PyBool_Type)));
-  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyBool_Type)));
-  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      if (__Pyx_SetItemInt(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":94
+ *                 steps_at_level[level] = (steps_at_level[level] +
+ *                                          node.width[level])
+ *                 node = next_at_level             # <<<<<<<<<<<<<<
+ *                 next_at_level = node.next[level]
+ * 
+ */
+      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
+      __Pyx_DECREF(((PyObject *)__pyx_v_node));
+      __pyx_v_node = __pyx_v_next_at_level;
+
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":95
+ *                                          node.width[level])
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+ * 
+ *             chain[level] = node
+ */
+      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+      __pyx_t_3 = 0;
+    }
+
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":97
+ *                 next_at_level = node.next[level]
+ * 
+ *             chain[level] = node             # <<<<<<<<<<<<<<
+ * 
+ *         # insert a link to the newnode at each level
+ */
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":100
+ * 
+ *         # insert a link to the newnode at each level
+ *         d = min(self.maxlevels, 1 - int(log2(random())))             # <<<<<<<<<<<<<<
+ *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))
+ *         steps = 0
+ */
+  __pyx_t_3 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__random); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_v_bool_mask);
-  __pyx_v_bool_mask = __pyx_t_3;
+  __pyx_t_1 = PyFloat_FromDouble(log2(__pyx_t_6)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyNumber_Subtract(__pyx_int_1, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_3 = 0;
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyObject_Call(__pyx_builtin_min, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_d = __pyx_t_4;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":36
- *     bool_mask = null_mask.astype(bool)
- * 
- *     null_values = np.asarray(index)[bool_mask]             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":101
+ *         # insert a link to the newnode at each level
+ *         d = min(self.maxlevels, 1 - int(log2(random())))
+ *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))             # <<<<<<<<<<<<<<
+ *         steps = 0
  * 
- *     if null_values.any():
  */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__asarray); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_7 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_7);
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_v_index));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_index));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
-  __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__empty); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyObject_GetItem(__pyx_t_4, __pyx_v_bool_mask); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_v_null_values);
-  __pyx_v_null_values = __pyx_t_3;
+  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_8);
+  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_3);
   __pyx_t_3 = 0;
+  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyInt_Type))) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_9 = PyEval_CallObjectWithKeywords(__pyx_t_1, __pyx_t_8, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_9);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_7);
+  __Pyx_GIVEREF(__pyx_t_7);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_9);
+  __Pyx_GIVEREF(__pyx_t_9);
+  __pyx_t_2 = 0;
+  __pyx_t_7 = 0;
+  __pyx_t_9 = 0;
+  __pyx_t_9 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_9);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_newnode));
+  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_9);
+  __pyx_t_9 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":38
- *     null_values = np.asarray(index)[bool_mask]
- * 
- *     if null_values.any():             # <<<<<<<<<<<<<<
- *         PyDict_SetItem(groups, np.NaN, null_values)
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":102
+ *         d = min(self.maxlevels, 1 - int(log2(random())))
+ *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))
+ *         steps = 0             # <<<<<<<<<<<<<<
  * 
+ *         for level in range(d):
  */
-  __pyx_t_3 = PyObject_GetAttr(__pyx_v_null_values, __pyx_n_s__any); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__pyx_t_2) {
+  __pyx_v_steps = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":39
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":104
+ *         steps = 0
  * 
- *     if null_values.any():
- *         PyDict_SetItem(groups, np.NaN, null_values)             # <<<<<<<<<<<<<<
+ *         for level in range(d):             # <<<<<<<<<<<<<<
+ *             prevnode = chain[level]
  * 
- *     cdef int i = 0
  */
-    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_t_3, __pyx_v_null_values); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L7;
-  }
-  __pyx_L7:;
+  __pyx_t_4 = __pyx_v_d;
+  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_4; __pyx_t_10+=1) {
+    __pyx_v_level = __pyx_t_10;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":41
- *         PyDict_SetItem(groups, np.NaN, null_values)
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":105
  * 
- *     cdef int i = 0             # <<<<<<<<<<<<<<
- *     idx = index[0]
- *     key = mapped_index[0]
+ *         for level in range(d):
+ *             prevnode = chain[level]             # <<<<<<<<<<<<<<
+ * 
+ *             newnode.next[level] = prevnode.next[level]
  */
-  __pyx_v_i = 0;
+    __pyx_t_9 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_9);
+    if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
+    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_9);
+    __pyx_t_9 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":42
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":107
+ *             prevnode = chain[level]
  * 
- *     cdef int i = 0
- *     idx = index[0]             # <<<<<<<<<<<<<<
- *     key = mapped_index[0]
+ *             newnode.next[level] = prevnode.next[level]             # <<<<<<<<<<<<<<
+ *             prevnode.next[level] = newnode
  * 
  */
-  __pyx_t_7 = 0;
-  if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_7, __pyx_bstride_0_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_idx);
-  __pyx_v_idx = __pyx_t_3;
-  __pyx_t_3 = 0;
+    __pyx_t_9 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_9);
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->next), __pyx_v_level, __pyx_t_9, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":43
- *     cdef int i = 0
- *     idx = index[0]
- *     key = mapped_index[0]             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":108
  * 
- *     # Algorithm notes
+ *             newnode.next[level] = prevnode.next[level]
+ *             prevnode.next[level] = newnode             # <<<<<<<<<<<<<<
+ * 
+ *             newnode.width[level] = prevnode.width[level] - steps
  */
-  __pyx_t_8 = 0;
-  if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_mapped_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_8, __pyx_bstride_0_mapped_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_key);
-  __pyx_v_key = __pyx_t_3;
-  __pyx_t_3 = 0;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, ((PyObject *)__pyx_v_newnode), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":49
- *     #   'lazily' evaluates
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":110
+ *             prevnode.next[level] = newnode
+ * 
+ *             newnode.width[level] = prevnode.width[level] - steps             # <<<<<<<<<<<<<<
+ *             prevnode.width[level] = steps + 1
  * 
- *     while i < length:             # <<<<<<<<<<<<<<
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]
  */
-  while (1) {
-    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-    if (!__pyx_t_2) break;
+    (__pyx_v_newnode->width[__pyx_v_level]) = ((__pyx_v_prevnode->width[__pyx_v_level]) - __pyx_v_steps);
 
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":50
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":111
  * 
- *     while i < length:
- *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)
+ *             newnode.width[level] = prevnode.width[level] - steps
+ *             prevnode.width[level] = steps + 1             # <<<<<<<<<<<<<<
+ * 
+ *             steps = steps + steps_at_level[level]
  */
-    __pyx_t_6 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_2 = (!__pyx_t_6);
-    if (__pyx_t_2) {
+    (__pyx_v_prevnode->width[__pyx_v_level]) = (__pyx_v_steps + 1);
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":51
- *     while i < length:
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]             # <<<<<<<<<<<<<<
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":113
+ *             prevnode.width[level] = steps + 1
+ * 
+ *             steps = steps + steps_at_level[level]             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(d, self.maxlevels):
  */
-      __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-      __Pyx_INCREF(__pyx_v_idx);
-      PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
-      __Pyx_GIVEREF(__pyx_v_idx);
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = __pyx_t_3;
-      __pyx_t_3 = 0;
+    __pyx_t_9 = PyInt_FromLong(__pyx_v_steps); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_9);
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_7 = PyNumber_Add(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_11 = __Pyx_PyInt_AsInt(__pyx_t_7); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __pyx_v_steps = __pyx_t_11;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":52
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":115
+ *             steps = steps + steps_at_level[level]
+ * 
+ *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
+ *             (<Node> chain[level]).width[level] += 1
+ * 
  */
-      __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels;
+  for (__pyx_t_10 = __pyx_v_d; __pyx_t_10 < __pyx_t_4; __pyx_t_10+=1) {
+    __pyx_v_level = __pyx_t_10;
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":53
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":116
+ * 
+ *         for level in range(d, self.maxlevels):
+ *             (<Node> chain[level]).width[level] += 1             # <<<<<<<<<<<<<<
+ * 
+ *         self.size += 1
  */
-      __pyx_v_i += 1;
+    __pyx_t_7 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_7);
+    (((struct __pyx_obj_7tseries_Node *)__pyx_t_7)->width[__pyx_v_level]) += 1;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":54
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 if null_mask[i]:
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":118
+ *             (<Node> chain[level]).width[level] += 1
+ * 
+ *         self.size += 1             # <<<<<<<<<<<<<<
+ * 
+ *     def remove(self, double value):
  */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":55
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 if null_mask[i]:
- *                     i += 1
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_DECREF((PyObject *)__pyx_v_node);
+  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_newnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
+  __Pyx_DECREF(__pyx_v_chain);
+  __Pyx_DECREF(__pyx_v_steps_at_level);
+  __Pyx_DECREF((PyObject *)__pyx_v_self);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":56
- *             curKey = key
- *             while i < length:
- *                 if null_mask[i]:             # <<<<<<<<<<<<<<
- *                     i += 1
- *                     continue
+/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":120
+ *         self.size += 1
+ * 
+ *     def remove(self, double value):             # <<<<<<<<<<<<<<
+ *         cdef int level, d
+ *         cdef Node node, prevnode, tmpnode, next_at_level
  */
-        __pyx_t_6 = __pyx_v_i;
-        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_6, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":57
- *             while i < length:
- *                 if null_mask[i]:
- *                     i += 1             # <<<<<<<<<<<<<<
- *                     continue
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
+static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
+  double __pyx_v_value;
+  int __pyx_v_level;
+  int __pyx_v_d;
+  struct __pyx_obj_7tseries_Node *__pyx_v_node;
+  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_tmpnode;
+  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
+  PyObject *__pyx_v_chain;
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  int __pyx_t_5;
+  Py_ssize_t __pyx_t_6;
+  int __pyx_t_7;
+  __Pyx_RefNannySetupContext("remove");
+  assert(__pyx_arg_value); {
+    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_self);
+  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":126
+ * 
+ *         # find first node on each level where node.next[levels].value >= value
+ *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
+ *         node = self.head
  * 
  */
-          __pyx_v_i += 1;
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __Pyx_INCREF(Py_None);
+  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
+  __Pyx_GIVEREF(Py_None);
+  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
+  __pyx_v_chain = ((PyObject *)__pyx_t_3);
+  __pyx_t_3 = 0;
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":58
- *                 if null_mask[i]:
- *                     i += 1
- *                     continue             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":127
+ *         # find first node on each level where node.next[levels].value >= value
+ *         chain = [None] * self.maxlevels
+ *         node = self.head             # <<<<<<<<<<<<<<
  * 
- *                 idx = index[i]
+ *         for level in range(self.maxlevels - 1, -1, -1):
  */
-          goto __pyx_L11_continue;
-          goto __pyx_L13;
-        }
-        __pyx_L13:;
+  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
+  __Pyx_DECREF(((PyObject *)__pyx_v_node));
+  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":60
- *                     continue
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":129
+ *         node = self.head
  * 
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = mapped_index[i]
- *                 if key == curKey:
+ *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:
  */
-        __pyx_t_10 = __pyx_v_i;
-        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_3;
-        __pyx_t_3 = 0;
+  for (__pyx_t_4 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
+    __pyx_v_level = __pyx_t_4;
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":61
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":130
  * 
- *                 idx = index[i]
- *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+ *             while next_at_level.value < value:
+ *                 node = next_at_level
  */
-        __pyx_t_11 = __pyx_v_i;
-        if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_mapped_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_11, __pyx_bstride_0_mapped_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_3;
-        __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 130; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+    __pyx_t_3 = 0;
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":62
- *                 idx = index[i]
- *                 key = mapped_index[i]
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":131
+ *         for level in range(self.maxlevels - 1, -1, -1):
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:             # <<<<<<<<<<<<<<
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]
  */
-        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":63
- *                 key = mapped_index[i]
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    while (1) {
+      __pyx_t_5 = (__pyx_v_next_at_level->value < __pyx_v_value);
+      if (!__pyx_t_5) break;
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":64
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":132
+ *             next_at_level = node.next[level]
+ *             while next_at_level.value < value:
+ *                 node = next_at_level             # <<<<<<<<<<<<<<
+ *                 next_at_level = node.next[level]
+ * 
  */
-          __pyx_v_i += 1;
-          goto __pyx_L14;
-        }
-        /*else*/ {
+      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
+      __Pyx_DECREF(((PyObject *)__pyx_v_node));
+      __pyx_v_node = __pyx_v_next_at_level;
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":66
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
+      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":133
+ *             while next_at_level.value < value:
+ *                 node = next_at_level
+ *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+ * 
+ *             chain[level] = node
  */
-          goto __pyx_L12_break;
-        }
-        __pyx_L14:;
-        __pyx_L11_continue:;
-      }
-      __pyx_L12_break:;
-      goto __pyx_L10;
+      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
+      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
+      __pyx_t_3 = 0;
     }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":68
- *                     break
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
- *             members.append(idx)
- *             i += 1
- */
-      __pyx_t_13 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
-      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = ((PyObject *)__pyx_t_13);
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":69
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(idx)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      if (unlikely(__pyx_v_members == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":70
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(idx)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while null_mask[i] and i < length:
- */
-      __pyx_v_i += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":71
- *             members.append(idx)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while null_mask[i] and i < length:
- *                 i += 1
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":135
+ *                 next_at_level = node.next[level]
+ * 
+ *             chain[level] = node             # <<<<<<<<<<<<<<
+ * 
+ *         if value != chain[0].next[0].value:
  */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":72
- *             i += 1
- *             curKey = key
- *             while null_mask[i] and i < length:             # <<<<<<<<<<<<<<
- *                 i += 1
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":137
+ *             chain[level] = node
+ * 
+ *         if value != chain[0].next[0].value:             # <<<<<<<<<<<<<<
+ *             raise KeyError('Not Found')
  * 
  */
-      while (1) {
-        __pyx_t_12 = __pyx_v_i;
-        if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_12, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
-          __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-          __pyx_t_14 = __pyx_t_2;
-        } else {
-          __pyx_t_14 = __pyx_t_9;
-        }
-        if (!__pyx_t_14) break;
+  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__next); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_t_1, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 137; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (__pyx_t_5) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":73
- *             curKey = key
- *             while null_mask[i] and i < length:
- *                 i += 1             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":138
  * 
- *             while i < length:
+ *         if value != chain[0].next[0].value:
+ *             raise KeyError('Not Found')             # <<<<<<<<<<<<<<
+ * 
+ *         # remove one link at each level
  */
-        __pyx_v_i += 1;
-      }
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
+    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_3));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
+    __pyx_t_1 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_Raise(__pyx_t_1, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    goto __pyx_L9;
+  }
+  __pyx_L9:;
 
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":75
- *                 i += 1
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":141
  * 
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 if null_mask[i]:
- *                     i += 1
+ *         # remove one link at each level
+ *         d = len(chain[0].next[0].next)             # <<<<<<<<<<<<<<
+ * 
+ *         for level in range(d):
  */
-      while (1) {
-        __pyx_t_14 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_14) break;
+  __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__next); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__next); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_6 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_d = __pyx_t_6;
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":76
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":143
+ *         d = len(chain[0].next[0].next)
  * 
- *             while i < length:
- *                 if null_mask[i]:             # <<<<<<<<<<<<<<
- *                     i += 1
- *                     continue
+ *         for level in range(d):             # <<<<<<<<<<<<<<
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]
  */
-        __pyx_t_15 = __pyx_v_i;
-        if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_15, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
+  __pyx_t_4 = __pyx_v_d;
+  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
+    __pyx_v_level = __pyx_t_7;
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":77
- *             while i < length:
- *                 if null_mask[i]:
- *                     i += 1             # <<<<<<<<<<<<<<
- *                     continue
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":144
  * 
+ *         for level in range(d):
+ *             prevnode = chain[level]             # <<<<<<<<<<<<<<
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1
  */
-          __pyx_v_i += 1;
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
+    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
+    __pyx_t_2 = 0;
 
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":78
- *                 if null_mask[i]:
- *                     i += 1
- *                     continue             # <<<<<<<<<<<<<<
- * 
- *                 idx = index[i]
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":145
+ *         for level in range(d):
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]             # <<<<<<<<<<<<<<
+ *             prevnode.width[level] += tmpnode.width[level] - 1
+ *             prevnode.next[level] = tmpnode.next[level]
  */
-          goto __pyx_L17_continue;
-          goto __pyx_L19;
-        }
-        __pyx_L19:;
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
+    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
+    __pyx_t_2 = 0;
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":80
- *                     continue
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":146
+ *             prevnode = chain[level]
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1             # <<<<<<<<<<<<<<
+ *             prevnode.next[level] = tmpnode.next[level]
  * 
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = mapped_index[i]
- *                 if key == curKey:
  */
-        __pyx_t_16 = __pyx_v_i;
-        if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_16, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_3;
-        __pyx_t_3 = 0;
+    (__pyx_v_prevnode->width[__pyx_v_level]) += ((__pyx_v_tmpnode->width[__pyx_v_level]) - 1);
 
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":81
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":147
+ *             tmpnode = prevnode.next[level]
+ *             prevnode.width[level] += tmpnode.width[level] - 1
+ *             prevnode.next[level] = tmpnode.next[level]             # <<<<<<<<<<<<<<
  * 
- *                 idx = index[i]
- *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
- */
-        __pyx_t_17 = __pyx_v_i;
-        if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_bshape_0_mapped_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_17, __pyx_bstride_0_mapped_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_3;
-        __pyx_t_3 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":82
- *                 idx = index[i]
- *                 key = mapped_index[i]
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
- */
-        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_14 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (__pyx_t_14) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":83
- *                 key = mapped_index[i]
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_18 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_18 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":84
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L20;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":86
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- * 
- *     return groups
- */
-          goto __pyx_L18_break;
-        }
-        __pyx_L20:;
-        __pyx_L17_continue:;
-      }
-      __pyx_L18_break:;
-    }
-    __pyx_L10:;
-  }
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":88
- *                     break
- * 
- *     return groups             # <<<<<<<<<<<<<<
- * 
- * @cython.boundscheck(False)
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
-  __pyx_r = ((PyObject *)__pyx_v_groups);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupby_withnull_old");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_groups);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF(__pyx_v_curKey);
-  __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_members);
-  __Pyx_XDECREF((PyObject *)__pyx_v_mapped_index);
-  __Pyx_XDECREF((PyObject *)__pyx_v_null_mask);
-  __Pyx_DECREF(__pyx_v_bool_mask);
-  __Pyx_DECREF(__pyx_v_null_values);
-  __Pyx_DECREF((PyObject *)__pyx_v_index);
-  __Pyx_DECREF(__pyx_v_keyfunc);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":91
- * 
- * @cython.boundscheck(False)
- * def groupby_withnull(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
- *     cdef dict groups
- *     cdef int length = index.shape[0]
- */
-
-static PyObject *__pyx_pf_7tseries_groupby_withnull(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_groupby_withnull(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_keyfunc = 0;
-  PyObject *__pyx_v_groups;
-  int __pyx_v_length;
-  PyObject *__pyx_v_idx;
-  PyObject *__pyx_v_curKey;
-  PyObject *__pyx_v_key;
-  PyObject *__pyx_v_members;
-  PyArrayObject *__pyx_v_mapped_index = 0;
-  PyArrayObject *__pyx_v_null_mask = 0;
-  PyObject *__pyx_v_bool_mask;
-  PyObject *__pyx_v_null_values;
-  int __pyx_v_i;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  Py_buffer __pyx_bstruct_null_mask;
-  Py_ssize_t __pyx_bstride_0_null_mask = 0;
-  Py_ssize_t __pyx_bshape_0_null_mask = 0;
-  Py_buffer __pyx_bstruct_mapped_index;
-  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
-  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyArrayObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  long __pyx_t_7;
-  long __pyx_t_8;
-  npy_int8 __pyx_t_9;
-  int __pyx_t_10;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  int __pyx_t_13;
-  int __pyx_t_14;
-  int __pyx_t_15;
-  int __pyx_t_16;
-  int __pyx_t_17;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
-  __Pyx_RefNannySetupContext("groupby_withnull");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupby_withnull", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_withnull") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_keyfunc = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupby_withnull", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupby_withnull");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_index);
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_bool_mask = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_null_values = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_bstruct_mapped_index.buf = NULL;
-  __pyx_bstruct_null_mask.buf = NULL;
-  __pyx_bstruct_index.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":93
- * def groupby_withnull(ndarray[object, ndim = 1] index, object keyfunc):
- *     cdef dict groups
- *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
- *     cdef object idx
- *     cdef object curKey, key
- */
-  __pyx_v_length = (__pyx_v_index->dimensions[0]);
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":98
- *     cdef list members
- * 
- *     groups = PyDict_New()             # <<<<<<<<<<<<<<
- * 
- *     if length != index.shape[0]:
- */
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
-  __pyx_v_groups = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":100
- *     groups = PyDict_New()
- * 
- *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
- *         raise Exception('Dates and values were not the same length!')
- * 
- */
-  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":101
- * 
- *     if length != index.shape[0]:
- *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
- * 
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
- */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_3));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":103
- *         raise Exception('Dates and values were not the same length!')
- * 
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)             # <<<<<<<<<<<<<<
- * 
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
- */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)__pyx_v_index));
-  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_index));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_keyfunc);
-  __Pyx_GIVEREF(__pyx_v_keyfunc);
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_mapped_index.buf = NULL;
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
-      __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
-    }
-  }
-  __pyx_t_5 = 0;
-  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":105
- *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
- * 
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)             # <<<<<<<<<<<<<<
- * 
- *     bool_mask = null_mask.astype(bool)
- */
-  __pyx_t_4 = ((PyObject *)__pyx_f_7tseries__isnullobj(((PyObject *)__pyx_v_mapped_index))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_null_mask, (PyObject*)((PyArrayObject *)__pyx_t_4), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-      __pyx_v_null_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_null_mask.buf = NULL;
-      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {__pyx_bstride_0_null_mask = __pyx_bstruct_null_mask.strides[0];
-      __pyx_bshape_0_null_mask = __pyx_bstruct_null_mask.shape[0];
-    }
-  }
-  __pyx_v_null_mask = ((PyArrayObject *)__pyx_t_4);
-  __pyx_t_4 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":107
- *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
- * 
- *     bool_mask = null_mask.astype(bool)             # <<<<<<<<<<<<<<
- * 
- *     null_values = np.asarray(index)[bool_mask]
- */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_null_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_INCREF(((PyObject *)((PyObject*)&PyBool_Type)));
-  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)((PyObject*)&PyBool_Type)));
-  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyBool_Type)));
-  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_v_bool_mask);
-  __pyx_v_bool_mask = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":109
- *     bool_mask = null_mask.astype(bool)
- * 
- *     null_values = np.asarray(index)[bool_mask]             # <<<<<<<<<<<<<<
- * 
- *     if null_values.any():
- */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__asarray); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_v_index));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_index));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
-  __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyObject_GetItem(__pyx_t_4, __pyx_v_bool_mask); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_v_null_values);
-  __pyx_v_null_values = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":111
- *     null_values = np.asarray(index)[bool_mask]
- * 
- *     if null_values.any():             # <<<<<<<<<<<<<<
- *         PyDict_SetItem(groups, np.NaN, null_values)
- * 
- */
-  __pyx_t_3 = PyObject_GetAttr(__pyx_v_null_values, __pyx_n_s__any); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":112
- * 
- *     if null_values.any():
- *         PyDict_SetItem(groups, np.NaN, null_values)             # <<<<<<<<<<<<<<
- * 
- *     cdef int i = 0
- */
-    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_t_3, __pyx_v_null_values); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L7;
-  }
-  __pyx_L7:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":114
- *         PyDict_SetItem(groups, np.NaN, null_values)
- * 
- *     cdef int i = 0             # <<<<<<<<<<<<<<
- *     idx = index[0]
- *     key = mapped_index[0]
- */
-  __pyx_v_i = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":115
- * 
- *     cdef int i = 0
- *     idx = index[0]             # <<<<<<<<<<<<<<
- *     key = mapped_index[0]
- * 
- */
-  __pyx_t_7 = 0;
-  if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_7, __pyx_bstride_0_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_idx);
-  __pyx_v_idx = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":116
- *     cdef int i = 0
- *     idx = index[0]
- *     key = mapped_index[0]             # <<<<<<<<<<<<<<
- * 
- *     # Algorithm notes
- */
-  __pyx_t_8 = 0;
-  if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_mapped_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_8, __pyx_bstride_0_mapped_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_key);
-  __pyx_v_key = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":122
- *     #   'lazily' evaluates
- * 
- *     while i < length:             # <<<<<<<<<<<<<<
- *         if key not in groups:
- *             members = [idx]
- */
-  while (1) {
-    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-    if (!__pyx_t_2) break;
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":123
- * 
- *     while i < length:
- *         if key not in groups:             # <<<<<<<<<<<<<<
- *             members = [idx]
- *             groups[key] = members
- */
-    if (unlikely(((PyObject *)__pyx_v_groups) == Py_None)) {
-      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    } else {
-      __pyx_t_2 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    if (__pyx_t_2) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":124
- *     while i < length:
- *         if key not in groups:
- *             members = [idx]             # <<<<<<<<<<<<<<
- *             groups[key] = members
- *             i += 1
- */
-      __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-      __Pyx_INCREF(__pyx_v_idx);
-      PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
-      __Pyx_GIVEREF(__pyx_v_idx);
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = __pyx_t_3;
-      __pyx_t_3 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":125
- *         if key not in groups:
- *             members = [idx]
- *             groups[key] = members             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      if (PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":126
- *             members = [idx]
- *             groups[key] = members
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":127
- *             groups[key] = members
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 if null_mask[i]:
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":128
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 if null_mask[i]:
- *                     i += 1
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":129
- *             curKey = key
- *             while i < length:
- *                 if null_mask[i]:             # <<<<<<<<<<<<<<
- *                     i += 1
- *                     continue
- */
-        __pyx_t_6 = __pyx_v_i;
-        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_6, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":130
- *             while i < length:
- *                 if null_mask[i]:
- *                     i += 1             # <<<<<<<<<<<<<<
- *                     continue
- * 
- */
-          __pyx_v_i += 1;
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":131
- *                 if null_mask[i]:
- *                     i += 1
- *                     continue             # <<<<<<<<<<<<<<
- * 
- *                 idx = index[i]
- */
-          goto __pyx_L11_continue;
-          goto __pyx_L13;
-        }
-        __pyx_L13:;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":133
- *                     continue
- * 
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = mapped_index[i]
- *                 if key == curKey:
- */
-        __pyx_t_10 = __pyx_v_i;
-        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_3;
-        __pyx_t_3 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":134
- * 
- *                 idx = index[i]
- *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
- */
-        __pyx_t_11 = __pyx_v_i;
-        if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_mapped_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_11, __pyx_bstride_0_mapped_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_3;
-        __pyx_t_3 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":135
- *                 idx = index[i]
- *                 key = mapped_index[i]
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
- */
-        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":136
- *                 key = mapped_index[i]
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":137
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L14;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":139
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- *         else:
- *             members = <list> groups[key]
- */
-          goto __pyx_L12_break;
-        }
-        __pyx_L14:;
-        __pyx_L11_continue:;
-      }
-      __pyx_L12_break:;
-      goto __pyx_L10;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":141
- *                     break
- *         else:
- *             members = <list> groups[key]             # <<<<<<<<<<<<<<
- *             members.append(idx)
- *             i += 1
- */
-      __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_3)));
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = ((PyObject *)__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":142
- *         else:
- *             members = <list> groups[key]
- *             members.append(idx)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      if (unlikely(__pyx_v_members == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":143
- *             members = <list> groups[key]
- *             members.append(idx)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while null_mask[i] and i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":144
- *             members.append(idx)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while null_mask[i] and i < length:
- *                 i += 1
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":145
- *             i += 1
- *             curKey = key
- *             while null_mask[i] and i < length:             # <<<<<<<<<<<<<<
- *                 i += 1
- * 
- */
-      while (1) {
-        __pyx_t_12 = __pyx_v_i;
-        if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_12, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
-          __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-          __pyx_t_13 = __pyx_t_2;
-        } else {
-          __pyx_t_13 = __pyx_t_9;
-        }
-        if (!__pyx_t_13) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":146
- *             curKey = key
- *             while null_mask[i] and i < length:
- *                 i += 1             # <<<<<<<<<<<<<<
- * 
- *             while i < length:
- */
-        __pyx_v_i += 1;
-      }
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":148
- *                 i += 1
- * 
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 if null_mask[i]:
- *                     i += 1
- */
-      while (1) {
-        __pyx_t_13 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_13) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":149
- * 
- *             while i < length:
- *                 if null_mask[i]:             # <<<<<<<<<<<<<<
- *                     i += 1
- *                     continue
- */
-        __pyx_t_14 = __pyx_v_i;
-        if (__pyx_t_14 < 0) __pyx_t_14 += __pyx_bshape_0_null_mask;
-        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_14, __pyx_bstride_0_null_mask));
-        if (__pyx_t_9) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":150
- *             while i < length:
- *                 if null_mask[i]:
- *                     i += 1             # <<<<<<<<<<<<<<
- *                     continue
- * 
- */
-          __pyx_v_i += 1;
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":151
- *                 if null_mask[i]:
- *                     i += 1
- *                     continue             # <<<<<<<<<<<<<<
- * 
- *                 idx = index[i]
- */
-          goto __pyx_L17_continue;
-          goto __pyx_L19;
-        }
-        __pyx_L19:;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":153
- *                     continue
- * 
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = mapped_index[i]
- *                 if key == curKey:
- */
-        __pyx_t_15 = __pyx_v_i;
-        if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_15, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_3;
-        __pyx_t_3 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":154
- * 
- *                 idx = index[i]
- *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
- */
-        __pyx_t_16 = __pyx_v_i;
-        if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_mapped_index;
-        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_16, __pyx_bstride_0_mapped_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_3);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_3;
-        __pyx_t_3 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":155
- *                 idx = index[i]
- *                 key = mapped_index[i]
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
- */
-        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (__pyx_t_13) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":156
- *                 key = mapped_index[i]
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_17 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":157
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L20;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":159
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- * 
- *     return groups
- */
-          goto __pyx_L18_break;
-        }
-        __pyx_L20:;
-        __pyx_L17_continue:;
-      }
-      __pyx_L18_break:;
-    }
-    __pyx_L10:;
-  }
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":161
- *                     break
- * 
- *     return groups             # <<<<<<<<<<<<<<
- * 
- * @cython.boundscheck(False)
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
-  __pyx_r = ((PyObject *)__pyx_v_groups);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupby_withnull");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_groups);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF(__pyx_v_curKey);
-  __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_members);
-  __Pyx_XDECREF((PyObject *)__pyx_v_mapped_index);
-  __Pyx_XDECREF((PyObject *)__pyx_v_null_mask);
-  __Pyx_DECREF(__pyx_v_bool_mask);
-  __Pyx_DECREF(__pyx_v_null_values);
-  __Pyx_DECREF((PyObject *)__pyx_v_index);
-  __Pyx_DECREF(__pyx_v_keyfunc);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":164
- * 
- * @cython.boundscheck(False)
- * def groupby(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
- *     cdef dict groups
- *     cdef int length = index.shape[0]
- */
-
-static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyObject *__pyx_v_keyfunc = 0;
-  PyObject *__pyx_v_groups;
-  int __pyx_v_length;
-  PyObject *__pyx_v_idx;
-  PyObject *__pyx_v_curKey;
-  PyObject *__pyx_v_key;
-  PyObject *__pyx_v_members;
-  int __pyx_v_i;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
-  PyObject *__pyx_t_7;
-  int __pyx_t_8;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
-  __Pyx_RefNannySetupContext("groupby");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupby", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_keyfunc = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupby", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupby");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_index);
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_index.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":166
- * def groupby(ndarray[object, ndim = 1] index, object keyfunc):
- *     cdef dict groups
- *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
- *     cdef object idx
- *     cdef object curKey, key
- */
-  __pyx_v_length = (__pyx_v_index->dimensions[0]);
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":171
- *     cdef list members
- * 
- *     groups = PyDict_New()             # <<<<<<<<<<<<<<
- * 
- *     if length != index.shape[0]:
- */
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
-  __pyx_v_groups = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":173
- *     groups = PyDict_New()
- * 
- *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
- *         raise Exception('Dates and values were not the same length!')
- * 
- */
-  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":174
- * 
- *     if length != index.shape[0]:
- *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
- * 
- *     cdef int i = 0
- */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_3));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":176
- *         raise Exception('Dates and values were not the same length!')
- * 
- *     cdef int i = 0             # <<<<<<<<<<<<<<
- *     idx = index[i]
- *     key = keyfunc(idx)
- */
-  __pyx_v_i = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":177
- * 
- *     cdef int i = 0
- *     idx = index[i]             # <<<<<<<<<<<<<<
- *     key = keyfunc(idx)
- * 
- */
-  __pyx_t_4 = __pyx_v_i;
-  if (__pyx_t_4 < 0) __pyx_t_4 += __pyx_bshape_0_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_4, __pyx_bstride_0_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_idx);
-  __pyx_v_idx = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":178
- *     cdef int i = 0
- *     idx = index[i]
- *     key = keyfunc(idx)             # <<<<<<<<<<<<<<
- * 
- *     # Algorithm notes
- */
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(__pyx_v_idx);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
-  __Pyx_GIVEREF(__pyx_v_idx);
-  __pyx_t_1 = PyObject_Call(__pyx_v_keyfunc, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_v_key);
-  __pyx_v_key = __pyx_t_1;
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":183
- *     #   - Tries to reduce the number of calls to PyDict_GetItem, 'lazily' evaluates
- * 
- *     while i < length:             # <<<<<<<<<<<<<<
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]
- */
-  while (1) {
-    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-    if (!__pyx_t_2) break;
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":184
- * 
- *     while i < length:
- *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)
- */
-    __pyx_t_5 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_2 = (!__pyx_t_5);
-    if (__pyx_t_2) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":185
- *     while i < length:
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]             # <<<<<<<<<<<<<<
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
- */
-      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-      __Pyx_INCREF(__pyx_v_idx);
-      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_idx);
-      __Pyx_GIVEREF(__pyx_v_idx);
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = __pyx_t_1;
-      __pyx_t_1 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":186
- *         if not PyDict_Contains(groups, key):
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      __pyx_t_5 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":187
- *             members = [idx]
- *             PyDict_SetItem(groups, key, members)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":188
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 idx = index[i]
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":189
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":190
- *             curKey = key
- *             while i < length:
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- */
-        __pyx_t_5 = __pyx_v_i;
-        if (__pyx_t_5 < 0) __pyx_t_5 += __pyx_bshape_0_index;
-        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_5, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":191
- *             while i < length:
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
- */
-        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":192
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
- */
-        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":193
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_6 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":194
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L12;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":196
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
- */
-          goto __pyx_L11_break;
-        }
-        __pyx_L12:;
-      }
-      __pyx_L11_break:;
-      goto __pyx_L9;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":198
- *                     break
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
- *             members.append(idx)
- *             i += 1
- */
-      __pyx_t_7 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
-      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_7)));
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = ((PyObject *)__pyx_t_7);
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":199
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(idx)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      if (unlikely(__pyx_v_members == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_6 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":200
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(idx)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":201
- *             members.append(idx)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 idx = index[i]
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":202
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":203
- *             curKey = key
- *             while i < length:
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- */
-        __pyx_t_6 = __pyx_v_i;
-        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_index;
-        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_6, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":204
- *             while i < length:
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(idx)
- */
-        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":205
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(idx)
- *                     i += 1
- */
-        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":206
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- *                     members.append(idx)             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_8 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":207
- *                 if key == curKey:
- *                     members.append(idx)
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L15;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":209
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- * 
- *     return groups
- */
-          goto __pyx_L14_break;
-        }
-        __pyx_L15:;
-      }
-      __pyx_L14_break:;
-    }
-    __pyx_L9:;
-  }
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":211
- *                     break
- * 
- *     return groups             # <<<<<<<<<<<<<<
- * 
- * @cython.boundscheck(False)
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
-  __pyx_r = ((PyObject *)__pyx_v_groups);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupby");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_groups);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF(__pyx_v_curKey);
-  __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_members);
-  __Pyx_DECREF((PyObject *)__pyx_v_index);
-  __Pyx_DECREF(__pyx_v_keyfunc);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":214
- * 
- * @cython.boundscheck(False)
- * def groupbyfunc(ndarray[object, ndim = 1] index,             # <<<<<<<<<<<<<<
- *                 ndarray[npy_float64, ndim = 1] values,
- *                 object keyfunc, object applyfunc):
- */
-
-static PyObject *__pyx_pf_7tseries_groupbyfunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_7tseries_groupbyfunc[] = "\n    Doing this proper in Cython\n    Not sure how much it will really speed things up\n    ";
-static PyObject *__pyx_pf_7tseries_groupbyfunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_index = 0;
-  PyArrayObject *__pyx_v_values = 0;
-  PyObject *__pyx_v_keyfunc = 0;
-  PyObject *__pyx_v_applyfunc = 0;
-  PyObject *__pyx_v_groups;
-  int __pyx_v_length;
-  PyObject *__pyx_v_idx;
-  PyObject *__pyx_v_curKey;
-  PyObject *__pyx_v_key;
-  PyObject *__pyx_v_members;
-  PyObject *__pyx_v_grouplist;
-  int __pyx_v_i;
-  Py_buffer __pyx_bstruct_index;
-  Py_ssize_t __pyx_bstride_0_index = 0;
-  Py_ssize_t __pyx_bshape_0_index = 0;
-  Py_buffer __pyx_bstruct_values;
-  Py_ssize_t __pyx_bstride_0_values = 0;
-  Py_ssize_t __pyx_bshape_0_values = 0;
-  PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
-  int __pyx_t_7;
-  int __pyx_t_8;
-  PyObject *__pyx_t_9;
-  int __pyx_t_10;
-  int __pyx_t_11;
-  int __pyx_t_12;
-  Py_ssize_t __pyx_t_13;
-  PyObject *__pyx_t_14 = NULL;
-  int __pyx_t_15;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__values,&__pyx_n_s__keyfunc,&__pyx_n_s__applyfunc,0};
-  __Pyx_RefNannySetupContext("groupbyfunc");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[4] = {0,0,0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__values);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 2); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__applyfunc);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 3); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupbyfunc") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_index = ((PyArrayObject *)values[0]);
-    __pyx_v_values = ((PyArrayObject *)values[1]);
-    __pyx_v_keyfunc = values[2];
-    __pyx_v_applyfunc = values[3];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_values = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 2);
-    __pyx_v_applyfunc = PyTuple_GET_ITEM(__pyx_args, 3);
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.groupbyfunc");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_index);
-  __Pyx_INCREF((PyObject *)__pyx_v_values);
-  __Pyx_INCREF(__pyx_v_keyfunc);
-  __Pyx_INCREF(__pyx_v_applyfunc);
-  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_grouplist = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_index.buf = NULL;
-  __pyx_bstruct_values.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), __pyx_ptype_5numpy_ndarray, 1, "values", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
-  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_values, (PyObject*)__pyx_v_values, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_values = __pyx_bstruct_values.strides[0];
-  __pyx_bshape_0_values = __pyx_bstruct_values.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":222
- *     '''
- *     cdef dict groups
- *     cdef int length = values.shape[0]             # <<<<<<<<<<<<<<
- *     cdef object idx
- *     cdef object curKey, key
- */
-  __pyx_v_length = (__pyx_v_values->dimensions[0]);
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":227
- *     cdef list members, grouplist
- * 
- *     groups = PyDict_New()             # <<<<<<<<<<<<<<
- * 
- *     if length != index.shape[0]:
- */
-  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
-  __pyx_v_groups = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":229
- *     groups = PyDict_New()
- * 
- *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
- *         raise Exception('Dates and values were not the same length!')
- * 
- */
-  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":230
- * 
- *     if length != index.shape[0]:
- *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
- * 
- *     cdef int i = 0
- */
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_3));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_3));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_3));
-    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_Raise(__pyx_t_3, 0, 0);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":232
- *         raise Exception('Dates and values were not the same length!')
- * 
- *     cdef int i = 0             # <<<<<<<<<<<<<<
- *     idx = index[i]
- *     key = trycall(keyfunc, idx)
- */
-  __pyx_v_i = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":233
- * 
- *     cdef int i = 0
- *     idx = index[i]             # <<<<<<<<<<<<<<
- *     key = trycall(keyfunc, idx)
- * 
- */
-  __pyx_t_4 = __pyx_v_i;
-  if (__pyx_t_4 < 0) __pyx_t_4 += __pyx_bshape_0_index;
-  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_4, __pyx_bstride_0_index);
-  __Pyx_INCREF((PyObject*)__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_idx);
-  __pyx_v_idx = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":234
- *     cdef int i = 0
- *     idx = index[i]
- *     key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
- * 
- *     # Algorithm notes
- */
-  __pyx_t_3 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_v_key);
-  __pyx_v_key = __pyx_t_3;
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":240
- *     #   'lazily' evaluates
- * 
- *     while i < length:             # <<<<<<<<<<<<<<
- *         if not PyDict_Contains(groups, key):
- *             members = [values[i]]
- */
-  while (1) {
-    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-    if (!__pyx_t_2) break;
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":241
- * 
- *     while i < length:
- *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
- *             members = [values[i]]
- *             PyDict_SetItem(groups, key, members)
- */
-    __pyx_t_5 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_2 = (!__pyx_t_5);
-    if (__pyx_t_2) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":242
- *     while i < length:
- *         if not PyDict_Contains(groups, key):
- *             members = [values[i]]             # <<<<<<<<<<<<<<
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
- */
-      __pyx_t_5 = __pyx_v_i;
-      if (__pyx_t_5 < 0) __pyx_t_5 += __pyx_bshape_0_values;
-      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_5, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
-      __Pyx_GIVEREF(__pyx_t_3);
-      __pyx_t_3 = 0;
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = __pyx_t_1;
-      __pyx_t_1 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":243
- *         if not PyDict_Contains(groups, key):
- *             members = [values[i]]
- *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":244
- *             members = [values[i]]
- *             PyDict_SetItem(groups, key, members)
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":245
- *             PyDict_SetItem(groups, key, members)
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 idx = index[i]
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":246
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":247
- *             curKey = key
- *             while i < length:
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- */
-        __pyx_t_6 = __pyx_v_i;
-        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_index;
-        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_6, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":248
- *             while i < length:
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(values[i])
- */
-        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":249
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(values[i])
- *                     i += 1
- */
-        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":250
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- *                     members.append(values[i])             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_7 = __pyx_v_i;
-          if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_values;
-          __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_7, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-          __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_8 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":251
- *                 if key == curKey:
- *                     members.append(values[i])
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L12;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":253
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
- */
-          goto __pyx_L11_break;
-        }
-        __pyx_L12:;
-      }
-      __pyx_L11_break:;
-      goto __pyx_L9;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":255
- *                     break
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
- *             members.append(values[i])
- *             i += 1
- */
-      __pyx_t_9 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
-      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_9)));
-      __Pyx_DECREF(((PyObject *)__pyx_v_members));
-      __pyx_v_members = ((PyObject *)__pyx_t_9);
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":256
- *         else:
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(values[i])             # <<<<<<<<<<<<<<
- *             i += 1
- *             curKey = key
- */
-      if (unlikely(__pyx_v_members == Py_None)) {
-        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-      }
-      __pyx_t_8 = __pyx_v_i;
-      if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_values;
-      __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_8, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_10 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":257
- *             members = <list> PyDict_GetItem(groups, key)
- *             members.append(values[i])
- *             i += 1             # <<<<<<<<<<<<<<
- *             curKey = key
- *             while i < length:
- */
-      __pyx_v_i += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":258
- *             members.append(values[i])
- *             i += 1
- *             curKey = key             # <<<<<<<<<<<<<<
- *             while i < length:
- *                 idx = index[i]
- */
-      __Pyx_INCREF(__pyx_v_key);
-      __Pyx_DECREF(__pyx_v_curKey);
-      __pyx_v_curKey = __pyx_v_key;
-
-      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":259
- *             i += 1
- *             curKey = key
- *             while i < length:             # <<<<<<<<<<<<<<
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- */
-      while (1) {
-        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
-        if (!__pyx_t_2) break;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":260
- *             curKey = key
- *             while i < length:
- *                 idx = index[i]             # <<<<<<<<<<<<<<
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- */
-        __pyx_t_10 = __pyx_v_i;
-        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
-        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
-        __Pyx_INCREF((PyObject*)__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_idx);
-        __pyx_v_idx = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":261
- *             while i < length:
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
- *                 if key == curKey:
- *                     members.append(values[i])
- */
-        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __Pyx_DECREF(__pyx_v_key);
-        __pyx_v_key = __pyx_t_1;
-        __pyx_t_1 = 0;
-
-        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":262
- *                 idx = index[i]
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:             # <<<<<<<<<<<<<<
- *                     members.append(values[i])
- *                     i += 1
- */
-        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        if (__pyx_t_2) {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":263
- *                 key = trycall(keyfunc, idx)
- *                 if key == curKey:
- *                     members.append(values[i])             # <<<<<<<<<<<<<<
- *                     i += 1
- *                 else:
- */
-          if (unlikely(__pyx_v_members == Py_None)) {
-            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
-          }
-          __pyx_t_11 = __pyx_v_i;
-          if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_values;
-          __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_11, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-          __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":264
- *                 if key == curKey:
- *                     members.append(values[i])
- *                     i += 1             # <<<<<<<<<<<<<<
- *                 else:
- *                     break
- */
-          __pyx_v_i += 1;
-          goto __pyx_L15;
-        }
-        /*else*/ {
-
-          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":266
- *                     i += 1
- *                 else:
- *                     break             # <<<<<<<<<<<<<<
- * 
- *     grouplist = PyDict_Keys(groups)
- */
-          goto __pyx_L14_break;
-        }
-        __pyx_L15:;
-      }
-      __pyx_L14_break:;
-    }
-    __pyx_L9:;
-  }
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":268
- *                     break
- * 
- *     grouplist = PyDict_Keys(groups)             # <<<<<<<<<<<<<<
- * 
- *     i = 0
- */
-  __pyx_t_1 = PyDict_Keys(((PyObject *)__pyx_v_groups)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_grouplist));
-  __pyx_v_grouplist = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":270
- *     grouplist = PyDict_Keys(groups)
- * 
- *     i = 0             # <<<<<<<<<<<<<<
- *     length = len(grouplist)
- *     for i from 0 <= i < length:
- */
-  __pyx_v_i = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":271
- * 
- *     i = 0
- *     length = len(grouplist)             # <<<<<<<<<<<<<<
- *     for i from 0 <= i < length:
- *         key = grouplist[i]
- */
-  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_grouplist)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_length = __pyx_t_13;
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":272
- *     i = 0
- *     length = len(grouplist)
- *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
- *         key = grouplist[i]
- *         members = <list> PyDict_GetItem(groups, key)
- */
-  __pyx_t_12 = __pyx_v_length;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_12; __pyx_v_i++) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":273
- *     length = len(grouplist)
- *     for i from 0 <= i < length:
- *         key = grouplist[i]             # <<<<<<<<<<<<<<
- *         members = <list> PyDict_GetItem(groups, key)
- *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
- */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_grouplist), __pyx_v_i, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_v_key);
-    __pyx_v_key = __pyx_t_1;
-    __pyx_t_1 = 0;
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":274
- *     for i from 0 <= i < length:
- *         key = grouplist[i]
- *         members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
- *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
- * 
- */
-    __pyx_t_9 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
-    __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_9)));
-    __Pyx_DECREF(((PyObject *)__pyx_v_members));
-    __pyx_v_members = ((PyObject *)__pyx_t_9);
-
-    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":275
- *         key = grouplist[i]
- *         members = <list> PyDict_GetItem(groups, key)
- *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))             # <<<<<<<<<<<<<<
- * 
- *     return groups
- */
-    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__asarray); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_v_members));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_members));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_members));
-    __pyx_t_14 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_14);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_14);
-    __Pyx_GIVEREF(__pyx_t_14);
-    __pyx_t_14 = 0;
-    __pyx_t_14 = PyObject_Call(__pyx_v_applyfunc, __pyx_t_1, NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_14);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_15 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, __pyx_t_14); if (unlikely(__pyx_t_15 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  }
-
-  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":277
- *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
- * 
- *     return groups             # <<<<<<<<<<<<<<
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
-  __pyx_r = ((PyObject *)__pyx_v_groups);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_14);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_values);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.groupbyfunc");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_values);
-  __pyx_L2:;
-  __Pyx_DECREF(__pyx_v_groups);
-  __Pyx_DECREF(__pyx_v_idx);
-  __Pyx_DECREF(__pyx_v_curKey);
-  __Pyx_DECREF(__pyx_v_key);
-  __Pyx_DECREF(__pyx_v_members);
-  __Pyx_DECREF(__pyx_v_grouplist);
-  __Pyx_DECREF((PyObject *)__pyx_v_index);
-  __Pyx_DECREF((PyObject *)__pyx_v_values);
-  __Pyx_DECREF(__pyx_v_keyfunc);
-  __Pyx_DECREF(__pyx_v_applyfunc);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":29
- *     cdef public:
- *         double value
- *         list next             # <<<<<<<<<<<<<<
- *         ndarray width_arr
- * 
- */
-
-static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pf_7tseries_4Node_4next___get__(PyObject *__pyx_v_self) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannySetupContext("__get__");
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pf_7tseries_4Node_4next___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__set__");
-  if (!(likely(PyList_CheckExact(__pyx_v_value))||((__pyx_v_value) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_v_value)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_INCREF(__pyx_v_value);
-  __Pyx_GIVEREF(__pyx_v_value);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = ((PyObject *)__pyx_v_value);
-
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.next.__set__");
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":30
- *         double value
- *         list next
- *         ndarray width_arr             # <<<<<<<<<<<<<<
- * 
- *     cdef:
- */
-
-static PyObject *__pyx_pf_7tseries_4Node_9width_arr___get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pf_7tseries_4Node_9width_arr___get__(PyObject *__pyx_v_self) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannySetupContext("__get__");
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
-  __pyx_r = ((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static int __pyx_pf_7tseries_4Node_9width_arr___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value); /*proto*/
-static int __pyx_pf_7tseries_4Node_9width_arr___set__(PyObject *__pyx_v_self, PyObject *__pyx_v_value) {
-  int __pyx_r;
-  __Pyx_RefNannySetupContext("__set__");
-  if (!(likely(((__pyx_v_value) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_value, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_INCREF(__pyx_v_value);
-  __Pyx_GIVEREF(__pyx_v_value);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr = ((PyArrayObject *)__pyx_v_value);
-
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.width_arr.__set__");
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":35
- *         int *width
- * 
- *     def __init__(self, double value, list next, ndarray width):             # <<<<<<<<<<<<<<
- *         self.value = value
- *         self.next = next
+ *         for level in range(d, self.maxlevels):
  */
-
-static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pf_7tseries_4Node___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  double __pyx_v_value;
-  PyObject *__pyx_v_next = 0;
-  PyArrayObject *__pyx_v_width = 0;
-  int __pyx_r;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__value,&__pyx_n_s__next,&__pyx_n_s__width,0};
-  __Pyx_RefNannySetupContext("__init__");
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__value);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__next);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__width);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_value = __pyx_PyFloat_AsDouble(values[0]); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_next = ((PyObject *)values[1]);
-    __pyx_v_width = ((PyArrayObject *)values[2]);
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_next = ((PyObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_width = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 2));
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, __pyx_t_2, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.Node.__init__");
-  return -1;
-  __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_next), &PyList_Type, 1, "next", 1))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_width), __pyx_ptype_5numpy_ndarray, 1, "width", 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 35; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":36
- * 
- *     def __init__(self, double value, list next, ndarray width):
- *         self.value = value             # <<<<<<<<<<<<<<
- *         self.next = next
- *         self.width_arr = width
+
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":149
+ *             prevnode.next[level] = tmpnode.next[level]
+ * 
+ *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
+ *             tmpnode = chain[level]
+ *             tmpnode.width[level] -= 1
  */
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->value = __pyx_v_value;
+  __pyx_t_4 = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels;
+  for (__pyx_t_7 = __pyx_v_d; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
+    __pyx_v_level = __pyx_t_7;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":37
- *     def __init__(self, double value, list next, ndarray width):
- *         self.value = value
- *         self.next = next             # <<<<<<<<<<<<<<
- *         self.width_arr = width
- *         self.width = <int *> width.data
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":150
+ * 
+ *         for level in range(d, self.maxlevels):
+ *             tmpnode = chain[level]             # <<<<<<<<<<<<<<
+ *             tmpnode.width[level] -= 1
+ * 
  */
-  __Pyx_INCREF(((PyObject *)__pyx_v_next));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_next));
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->next = __pyx_v_next;
+    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
+    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
+    __pyx_t_2 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":38
- *         self.value = value
- *         self.next = next
- *         self.width_arr = width             # <<<<<<<<<<<<<<
- *         self.width = <int *> width.data
+    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":151
+ *         for level in range(d, self.maxlevels):
+ *             tmpnode = chain[level]
+ *             tmpnode.width[level] -= 1             # <<<<<<<<<<<<<<
  * 
+ *         self.size -= 1
  */
-  __Pyx_INCREF(((PyObject *)__pyx_v_width));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_width));
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr));
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width_arr = __pyx_v_width;
+    (__pyx_v_tmpnode->width[__pyx_v_level]) -= 1;
+  }
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":39
- *         self.next = next
- *         self.width_arr = width
- *         self.width = <int *> width.data             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":153
+ *             tmpnode.width[level] -= 1
  * 
- * #     cdef get_width(self, int i):
+ *         self.size -= 1             # <<<<<<<<<<<<<<
  */
-  ((struct __pyx_obj_7tseries_Node *)__pyx_v_self)->width = ((int *)__pyx_v_width->data);
+  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size -= 1;
 
-  __pyx_r = 0;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_AddTraceback("tseries.Node.__init__");
-  __pyx_r = -1;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_DECREF((PyObject *)__pyx_v_node);
+  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_tmpnode);
+  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
+  __Pyx_DECREF(__pyx_v_chain);
+  __Pyx_DECREF((PyObject *)__pyx_v_self);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":54
- *         Node head
+/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":5
+ * cdef double NEGINF = -INF
  * 
- *     def __init__(self, expected_size=100):             # <<<<<<<<<<<<<<
- *         self.size = 0
- *         self.maxlevels = int(1 + log2(expected_size))
+ * cdef inline _checknull(object val):             # <<<<<<<<<<<<<<
+ *     if isinstance(val, float):
+ *         return val != val or val == INF or val == NEGINF
  */
 
-static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static int __pyx_pf_7tseries_17IndexableSkiplist___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_expected_size = 0;
-  int __pyx_r;
-  double __pyx_t_1;
+static INLINE PyObject *__pyx_f_7tseries__checknull(PyObject *__pyx_v_val) {
+  PyObject *__pyx_r = NULL;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__expected_size,0};
-  __Pyx_RefNannySetupContext("__init__");
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[1] = {0};
-    values[0] = ((PyObject *)__pyx_int_100);
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      if (kw_args > 1) {
-        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__expected_size);
-        if (unlikely(value)) { values[0] = value; kw_args--; }
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "__init__") < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_expected_size = values[0];
-  } else {
-    __pyx_v_expected_size = ((PyObject *)__pyx_int_100);
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  1: __pyx_v_expected_size = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 0, 1, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[1]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
-  return -1;
-  __pyx_L4_argument_unpacking_done:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":55
- * 
- *     def __init__(self, expected_size=100):
- *         self.size = 0             # <<<<<<<<<<<<<<
- *         self.maxlevels = int(1 + log2(expected_size))
- * 
- */
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":56
- *     def __init__(self, expected_size=100):
- *         self.size = 0
- *         self.maxlevels = int(1 + log2(expected_size))             # <<<<<<<<<<<<<<
- * 
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels,
- */
-  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_expected_size); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels = ((int)(1 + log2(__pyx_t_1)));
+  __Pyx_RefNannySetupContext("_checknull");
+  __Pyx_INCREF(__pyx_v_val);
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":58
- *         self.maxlevels = int(1 + log2(expected_size))
- * 
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels,             # <<<<<<<<<<<<<<
- *                          np.ones(self.maxlevels, dtype=int))
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":6
  * 
+ * cdef inline _checknull(object val):
+ *     if isinstance(val, float):             # <<<<<<<<<<<<<<
+ *         return val != val or val == INF or val == NEGINF
+ *     else:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__NIL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(((PyObject *)__pyx_t_4), __pyx_t_2); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_val, ((PyTypeObject *)((PyObject*)&PyFloat_Type))); 
+  if (__pyx_t_1) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":59
- * 
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels,
- *                          np.ones(self.maxlevels, dtype=int))             # <<<<<<<<<<<<<<
- * 
- *     def __len__(self):
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":7
+ * cdef inline _checknull(object val):
+ *     if isinstance(val, float):
+ *         return val != val or val == INF or val == NEGINF             # <<<<<<<<<<<<<<
+ *     else:
+ *         return val is None
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__ones); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyInt_Type))) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
-  __Pyx_GIVEREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
-  __Pyx_GIVEREF(__pyx_t_5);
-  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_t_7);
-  __Pyx_GIVEREF(__pyx_t_7);
-  __pyx_t_3 = 0;
-  __pyx_t_5 = 0;
-  __pyx_t_7 = 0;
-  __pyx_t_7 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_val, __pyx_v_val, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (!__pyx_t_1) {
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_INF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      if (!__pyx_t_1) {
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __pyx_t_3 = PyFloat_FromDouble(__pyx_v_7tseries_NEGINF); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_5 = PyObject_RichCompare(__pyx_v_val, __pyx_t_3, Py_EQ); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        __pyx_t_3 = __pyx_t_5;
+        __pyx_t_5 = 0;
+      } else {
+        __pyx_t_3 = __pyx_t_4;
+        __pyx_t_4 = 0;
+      }
+      __pyx_t_4 = __pyx_t_3;
+      __pyx_t_3 = 0;
+    } else {
+      __pyx_t_4 = __pyx_t_2;
+      __pyx_t_2 = 0;
+    }
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+    goto __pyx_L3;
+  }
+  /*else*/ {
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":58
- *         self.maxlevels = int(1 + log2(expected_size))
- * 
- *         self.head = Node(np.NaN, [NIL] * self.maxlevels,             # <<<<<<<<<<<<<<
- *                          np.ones(self.maxlevels, dtype=int))
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":9
+ *         return val != val or val == INF or val == NEGINF
+ *     else:
+ *         return val is None             # <<<<<<<<<<<<<<
  * 
+ * cdef ndarray _isnullobj(input):
  */
-  __Pyx_GIVEREF(__pyx_t_7);
-  __Pyx_GOTREF(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head);
-  __Pyx_DECREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head = ((struct __pyx_obj_7tseries_Node *)__pyx_t_7);
-  __pyx_t_7 = 0;
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_1 = (__pyx_v_val == Py_None);
+    __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 9; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+  }
+  __pyx_L3:;
 
-  __pyx_r = 0;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__init__");
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":61
- *                          np.ones(self.maxlevels, dtype=int))
- * 
- *     def __len__(self):             # <<<<<<<<<<<<<<
- *         return self.size
- * 
- */
-
-static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self); /*proto*/
-static Py_ssize_t __pyx_pf_7tseries_17IndexableSkiplist___len__(PyObject *__pyx_v_self) {
-  Py_ssize_t __pyx_r;
-  __Pyx_RefNannySetupContext("__len__");
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":62
- * 
- *     def __len__(self):
- *         return self.size             # <<<<<<<<<<<<<<
- * 
- *     def __getitem__(self, i):
- */
-  __pyx_r = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size;
-  goto __pyx_L0;
-
+  __Pyx_AddTraceback("tseries._checknull");
   __pyx_r = 0;
   __pyx_L0:;
+  __Pyx_DECREF(__pyx_v_val);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":64
- *         return self.size
- * 
- *     def __getitem__(self, i):             # <<<<<<<<<<<<<<
- *         return self.get(i)
+/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":11
+ *         return val is None
  * 
+ * cdef ndarray _isnullobj(input):             # <<<<<<<<<<<<<<
+ *     cdef int i, length
+ *     cdef object val
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist___getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_i) {
-  PyObject *__pyx_r = NULL;
+static  PyArrayObject *__pyx_f_7tseries__isnullobj(PyObject *__pyx_v_input) {
+  int __pyx_v_i;
+  int __pyx_v_length;
+  PyObject *__pyx_v_val;
+  PyArrayObject *__pyx_v_result;
+  PyArrayIterObject *__pyx_v_iter;
+  Py_buffer __pyx_bstruct_result;
+  Py_ssize_t __pyx_bstride_0_result = 0;
+  Py_ssize_t __pyx_bshape_0_result = 0;
+  PyArrayObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  __Pyx_RefNannySetupContext("__getitem__");
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  __Pyx_RefNannySetupContext("_isnullobj");
+  __Pyx_INCREF(__pyx_v_input);
+  __pyx_v_val = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_iter = ((PyArrayIterObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_bstruct_result.buf = NULL;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":65
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":17
+ *     cdef flatiter iter
  * 
- *     def __getitem__(self, i):
- *         return self.get(i)             # <<<<<<<<<<<<<<
+ *     length = PyArray_SIZE(input)             # <<<<<<<<<<<<<<
  * 
- *     def get(self, int i):
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_v_self, __pyx_n_s__get); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (!(likely(((__pyx_v_input) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_input, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_length = PyArray_SIZE(((PyArrayObject *)__pyx_v_input));
+
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":19
+ *     length = PyArray_SIZE(input)
+ * 
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)             # <<<<<<<<<<<<<<
+ * 
+ *     iter= PyArray_IterNew(input)
+ */
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__zeros); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_v_i);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_i);
-  __Pyx_GIVEREF(__pyx_v_i);
-  __pyx_t_3 = PyObject_Call(__pyx_t_1, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__int8); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
-  goto __pyx_L0;
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.__getitem__");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":67
- *         return self.get(i)
- * 
- *     def get(self, int i):             # <<<<<<<<<<<<<<
- *         cdef int level
- *         cdef Node node
- */
-
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_get(PyObject *__pyx_v_self, PyObject *__pyx_arg_i) {
-  int __pyx_v_i;
-  int __pyx_v_level;
-  struct __pyx_obj_7tseries_Node *__pyx_v_node;
-  PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  __Pyx_RefNannySetupContext("get");
-  assert(__pyx_arg_i); {
-    __pyx_v_i = __Pyx_PyInt_AsInt(__pyx_arg_i); if (unlikely((__pyx_v_i == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
+    if (unlikely(__pyx_t_7 < 0)) {
+      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
+        __Pyx_RaiseBufferFallbackError();
+      } else {
+        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+      }
+    }
+    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
+    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
+    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_self);
-  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_t_6 = 0;
+  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_5)));
+  __Pyx_DECREF(((PyObject *)__pyx_v_result));
+  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":71
- *         cdef Node node
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":21
+ *     result = <ndarray> np.zeros(length, dtype=np.int8)
  * 
- *         node = self.head             # <<<<<<<<<<<<<<
- *         i += 1
+ *     iter= PyArray_IterNew(input)             # <<<<<<<<<<<<<<
  * 
+ *     for i from 0 <= i < length:
  */
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
-  __Pyx_DECREF(((PyObject *)__pyx_v_node));
-  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
+  __pyx_t_5 = PyArray_IterNew(__pyx_v_input); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_flatiter))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 21; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_iter));
+  __pyx_v_iter = ((PyArrayIterObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":72
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":23
+ *     iter= PyArray_IterNew(input)
  * 
- *         node = self.head
- *         i += 1             # <<<<<<<<<<<<<<
+ *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):
  */
-  __pyx_v_i += 1;
+  __pyx_t_7 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":74
- *         i += 1
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":24
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
- *             while node.width[level] <= i:
- *                 i -= node.width[level]
- */
-  for (__pyx_t_1 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_1 > -1; __pyx_t_1-=1) {
-    __pyx_v_level = __pyx_t_1;
-
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":75
+ *     for i from 0 <= i < length:
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))             # <<<<<<<<<<<<<<
  * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             while node.width[level] <= i:             # <<<<<<<<<<<<<<
- *                 i -= node.width[level]
- *                 node = node.next[level]
+ *         if _checknull(val):
  */
-    while (1) {
-      __pyx_t_2 = ((__pyx_v_node->width[__pyx_v_level]) <= __pyx_v_i);
-      if (!__pyx_t_2) break;
+    if (!(likely(((__pyx_v_input) == Py_None) || likely(__Pyx_TypeTest(__pyx_v_input, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_5 = PyArray_GETITEM(((PyArrayObject *)__pyx_v_input), PyArray_ITER_DATA(__pyx_v_iter)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 24; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_v_val);
+    __pyx_v_val = __pyx_t_5;
+    __pyx_t_5 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":76
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             while node.width[level] <= i:
- *                 i -= node.width[level]             # <<<<<<<<<<<<<<
- *                 node = node.next[level]
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":26
+ *         val = PyArray_GETITEM(input, PyArray_ITER_DATA(iter))
+ * 
+ *         if _checknull(val):             # <<<<<<<<<<<<<<
+ *             result[i] = 1
  * 
  */
-      __pyx_v_i -= (__pyx_v_node->width[__pyx_v_level]);
+    __pyx_t_5 = __pyx_f_7tseries__checknull(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_11 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (__pyx_t_11) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":77
- *             while node.width[level] <= i:
- *                 i -= node.width[level]
- *                 node = node.next[level]             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":27
  * 
- *         return node.value
+ *         if _checknull(val):
+ *             result[i] = 1             # <<<<<<<<<<<<<<
+ * 
+ *         PyArray_ITER_NEXT(iter)
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_node));
-      __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-      __pyx_t_3 = 0;
+      __pyx_t_12 = __pyx_v_i;
+      __pyx_t_13 = -1;
+      if (__pyx_t_12 < 0) {
+        __pyx_t_12 += __pyx_bshape_0_result;
+        if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+      } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_result)) __pyx_t_13 = 0;
+      if (unlikely(__pyx_t_13 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_13);
+        {__pyx_filename = __pyx_f[4]; __pyx_lineno = 27; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_result.buf, __pyx_t_12, __pyx_bstride_0_result) = 1;
+      goto __pyx_L5;
     }
+    __pyx_L5:;
+
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":29
+ *             result[i] = 1
+ * 
+ *         PyArray_ITER_NEXT(iter)             # <<<<<<<<<<<<<<
+ * 
+ *     return result
+ */
+    PyArray_ITER_NEXT(__pyx_v_iter);
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":79
- *                 node = node.next[level]
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":31
+ *         PyArray_ITER_NEXT(iter)
  * 
- *         return node.value             # <<<<<<<<<<<<<<
+ *     return result             # <<<<<<<<<<<<<<
  * 
- *     def insert(self, double value):
+ * def isnull(input):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_node->value); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
+  __Pyx_XDECREF(((PyObject *)__pyx_r));
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyArrayObject *)__pyx_v_result);
   goto __pyx_L0;
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_r = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.get");
-  __pyx_r = NULL;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._isnullobj");
+  __pyx_r = 0;
+  goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_node);
-  __Pyx_DECREF((PyObject *)__pyx_v_self);
-  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_val);
+  __Pyx_DECREF((PyObject *)__pyx_v_result);
+  __Pyx_DECREF((PyObject *)__pyx_v_iter);
+  __Pyx_DECREF(__pyx_v_input);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":81
- *         return node.value
+/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":33
+ *     return result
  * 
- *     def insert(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, steps, d
- *         cdef Node node, prevnode, newnode, next_at_level
+ * def isnull(input):             # <<<<<<<<<<<<<<
+ *     '''
+ *     Replacement for numpy.isnan / -numpy.isfinite which is suitable
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  double __pyx_v_value;
-  int __pyx_v_level;
-  int __pyx_v_steps;
-  int __pyx_v_d;
-  struct __pyx_obj_7tseries_Node *__pyx_v_node;
-  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_newnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
-  PyObject *__pyx_v_chain;
-  PyObject *__pyx_v_steps_at_level;
+static PyObject *__pyx_pf_7tseries_isnull(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
+static char __pyx_doc_7tseries_isnull[] = "\n    Replacement for numpy.isnan / -numpy.isfinite which is suitable\n    for use on object arrays.\n\n    Parameters\n    ----------\n    arr: ndarray or object value\n\n    Returns\n    -------\n    boolean ndarray or boolean\n    ";
+static PyObject *__pyx_pf_7tseries_isnull(PyObject *__pyx_self, PyObject *__pyx_v_input) {
+  PyArrayObject *__pyx_v_result;
+  Py_buffer __pyx_bstruct_result;
+  Py_ssize_t __pyx_bstride_0_result = 0;
+  Py_ssize_t __pyx_bshape_0_result = 0;
   PyObject *__pyx_r = NULL;
-  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
   int __pyx_t_5;
-  double __pyx_t_6;
+  int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
-  int __pyx_t_10;
-  int __pyx_t_11;
-  __Pyx_RefNannySetupContext("insert");
-  assert(__pyx_arg_value); {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_self);
-  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_steps_at_level = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":87
- * 
- *         # find first node on each level where node.next[levels].value > value
- *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
- *         steps_at_level = [0] * self.maxlevels
- * 
- */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
-  __pyx_v_chain = ((PyObject *)__pyx_t_3);
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":88
- *         # find first node on each level where node.next[levels].value > value
- *         chain = [None] * self.maxlevels
- *         steps_at_level = [0] * self.maxlevels             # <<<<<<<<<<<<<<
- * 
- *         node = self.head
- */
-  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  __Pyx_INCREF(__pyx_int_0);
-  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_int_0);
-  __Pyx_GIVEREF(__pyx_int_0);
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyNumber_Multiply(((PyObject *)__pyx_t_3), __pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_steps_at_level));
-  __pyx_v_steps_at_level = ((PyObject *)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":90
- *         steps_at_level = [0] * self.maxlevels
- * 
- *         node = self.head             # <<<<<<<<<<<<<<
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             next_at_level = node.next[level]
- */
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
-  __Pyx_DECREF(((PyObject *)__pyx_v_node));
-  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":91
- * 
- *         node = self.head
- *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
- *             next_at_level = node.next[level]
- * 
- */
-  for (__pyx_t_4 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
-    __pyx_v_level = __pyx_t_4;
+  PyObject *__pyx_t_10 = NULL;
+  __Pyx_RefNannySetupContext("isnull");
+  __pyx_self = __pyx_self;
+  __Pyx_INCREF(__pyx_v_input);
+  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_bstruct_result.buf = NULL;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":92
- *         node = self.head
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":48
+ *     cdef ndarray[npy_int8, ndim=1] result
  * 
- *             while next_at_level.value <= value:
+ *     if isinstance(input, np.ndarray):             # <<<<<<<<<<<<<<
+ *         if input.dtype.kind in ('O', 'S'):
+ *             result = _isnullobj(input)
  */
-    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_1);
-    __pyx_t_1 = 0;
+  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_input, ((PyTypeObject *)((PyObject*)__pyx_ptype_5numpy_ndarray))); 
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":94
- *             next_at_level = node.next[level]
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":49
  * 
- *             while next_at_level.value <= value:             # <<<<<<<<<<<<<<
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])
- */
-    while (1) {
-      __pyx_t_5 = (__pyx_v_next_at_level->value <= __pyx_v_value);
-      if (!__pyx_t_5) break;
-
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":95
+ *     if isinstance(input, np.ndarray):
+ *         if input.dtype.kind in ('O', 'S'):             # <<<<<<<<<<<<<<
+ *             result = _isnullobj(input)
  * 
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
- *                                          node.width[level])
- *                 node = next_at_level
- */
-      __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_1);
-
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":96
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])             # <<<<<<<<<<<<<<
- *                 node = next_at_level
- *                 next_at_level = node.next[level]
  */
-      __pyx_t_2 = PyInt_FromLong((__pyx_v_node->width[__pyx_v_level])); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyObject_GetAttr(__pyx_v_input, __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__kind); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_n_s__O), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_1 == (int)-1))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_4 = ((int)__pyx_t_1);
+    if (!__pyx_t_4) {
+      __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, ((PyObject *)__pyx_n_s__S), Py_EQ); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_1 == (int)-1))) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_5 = ((int)__pyx_t_1);
+      __pyx_t_1 = __pyx_t_5;
+    } else {
+      __pyx_t_1 = __pyx_t_4;
+    }
+    __pyx_t_4 = __pyx_t_1;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (__pyx_t_4) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":95
+      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":50
+ *     if isinstance(input, np.ndarray):
+ *         if input.dtype.kind in ('O', 'S'):
+ *             result = _isnullobj(input)             # <<<<<<<<<<<<<<
  * 
- *             while next_at_level.value <= value:
- *                 steps_at_level[level] = (steps_at_level[level] +             # <<<<<<<<<<<<<<
- *                                          node.width[level])
- *                 node = next_at_level
+ *             return result.astype(np.bool)
  */
-      if (__Pyx_SetItemInt(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, __pyx_t_3, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_3 = ((PyObject *)__pyx_f_7tseries__isnullobj(__pyx_v_input)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      {
+        __Pyx_BufFmt_StackElem __pyx_stack[1];
+        __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+        __pyx_t_6 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)((PyArrayObject *)__pyx_t_3), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
+        if (unlikely(__pyx_t_6 < 0)) {
+          PyErr_Fetch(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
+          if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+            Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
+            __Pyx_RaiseBufferFallbackError();
+          } else {
+            PyErr_Restore(__pyx_t_7, __pyx_t_8, __pyx_t_9);
+          }
+        }
+        __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
+        __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
+        if (unlikely(__pyx_t_6 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __Pyx_DECREF(((PyObject *)__pyx_v_result));
+      __pyx_v_result = ((PyArrayObject *)__pyx_t_3);
+      __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":97
- *                 steps_at_level[level] = (steps_at_level[level] +
- *                                          node.width[level])
- *                 node = next_at_level             # <<<<<<<<<<<<<<
- *                 next_at_level = node.next[level]
+      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":52
+ *             result = _isnullobj(input)
  * 
+ *             return result.astype(np.bool)             # <<<<<<<<<<<<<<
+ *         else:
+ *             return -np.isfinite(input)
  */
-      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
-      __Pyx_DECREF(((PyObject *)__pyx_v_node));
-      __pyx_v_node = __pyx_v_next_at_level;
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_result), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_10 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__bool); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_10);
+      __Pyx_GIVEREF(__pyx_t_10);
+      __pyx_t_10 = 0;
+      __pyx_t_10 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_r = __pyx_t_10;
+      __pyx_t_10 = 0;
+      goto __pyx_L0;
+      goto __pyx_L6;
+    }
+    /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":98
- *                                          node.width[level])
- *                 node = next_at_level
- *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
- * 
- *             chain[level] = node
+      /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":54
+ *             return result.astype(np.bool)
+ *         else:
+ *             return -np.isfinite(input)             # <<<<<<<<<<<<<<
+ *     else:
+ *         return _checknull(input)
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_10 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_10);
+      __pyx_t_2 = PyObject_GetAttr(__pyx_t_10, __pyx_n_s__isfinite); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+      __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_INCREF(__pyx_v_input);
+      PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_input);
+      __Pyx_GIVEREF(__pyx_v_input);
+      __pyx_t_3 = PyObject_Call(__pyx_t_2, __pyx_t_10, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-      __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+      __pyx_t_10 = PyNumber_Negative(__pyx_t_3); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 54; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_10);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_r = __pyx_t_10;
+      __pyx_t_10 = 0;
+      goto __pyx_L0;
     }
+    __pyx_L6:;
+    goto __pyx_L5;
+  }
+  /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":100
- *                 next_at_level = node.next[level]
- * 
- *             chain[level] = node             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":56
+ *             return -np.isfinite(input)
+ *     else:
+ *         return _checknull(input)             # <<<<<<<<<<<<<<
  * 
- *         # insert a link to the newnode at each level
+ * def notnull(input):
  */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_10 = __pyx_f_7tseries__checknull(__pyx_v_input); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_10);
+    __pyx_r = __pyx_t_10;
+    __pyx_t_10 = 0;
+    goto __pyx_L0;
   }
+  __pyx_L5:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":103
- * 
- *         # insert a link to the newnode at each level
- *         d = min(self.maxlevels, 1 - int(log2(random())))             # <<<<<<<<<<<<<<
- *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))
- *         steps = 0
- */
-  __pyx_t_3 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__random); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_6 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyFloat_FromDouble(log2(__pyx_t_6)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_Call(((PyObject *)((PyObject*)&PyInt_Type)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Subtract(__pyx_int_1, __pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
-  __Pyx_GIVEREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_3 = 0;
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_Call(__pyx_builtin_min, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_4 = __Pyx_PyInt_AsInt(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_d = __pyx_t_4;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_10);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.isnull");
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __pyx_L2:;
+  __Pyx_DECREF((PyObject *)__pyx_v_result);
+  __Pyx_DECREF(__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":104
- *         # insert a link to the newnode at each level
- *         d = min(self.maxlevels, 1 - int(log2(random())))
- *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))             # <<<<<<<<<<<<<<
- *         steps = 0
+/* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":58
+ *         return _checknull(input)
  * 
+ * def notnull(input):             # <<<<<<<<<<<<<<
+ *     '''
+ *     Replacement for numpy.isfinite / -numpy.isnan which is suitable
  */
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_7 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__empty); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyInt_FromLong(__pyx_v_d); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_8);
-  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
-  __Pyx_GIVEREF(__pyx_t_3);
-  __pyx_t_3 = 0;
-  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyInt_Type))) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_9 = PyEval_CallObjectWithKeywords(__pyx_t_1, __pyx_t_8, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_7);
-  __Pyx_GIVEREF(__pyx_t_7);
-  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_9);
-  __Pyx_GIVEREF(__pyx_t_9);
-  __pyx_t_2 = 0;
-  __pyx_t_7 = 0;
-  __pyx_t_9 = 0;
-  __pyx_t_9 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_newnode));
-  __pyx_v_newnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_9);
-  __pyx_t_9 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":105
- *         d = min(self.maxlevels, 1 - int(log2(random())))
- *         newnode = Node(value, [None] * d, np.empty(d, dtype=int))
- *         steps = 0             # <<<<<<<<<<<<<<
- * 
- *         for level in range(d):
- */
-  __pyx_v_steps = 0;
+static PyObject *__pyx_pf_7tseries_notnull(PyObject *__pyx_self, PyObject *__pyx_v_input); /*proto*/
+static char __pyx_doc_7tseries_notnull[] = "\n    Replacement for numpy.isfinite / -numpy.isnan which is suitable\n    for use on object arrays.\n\n    Parameters\n    ----------\n    arr: ndarray or object value\n\n    Returns\n    -------\n    boolean ndarray or boolean\n    ";
+static PyObject *__pyx_pf_7tseries_notnull(PyObject *__pyx_self, PyObject *__pyx_v_input) {
+  PyObject *__pyx_r = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  __Pyx_RefNannySetupContext("notnull");
+  __pyx_self = __pyx_self;
+  __Pyx_INCREF(__pyx_v_input);
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":107
- *         steps = 0
- * 
- *         for level in range(d):             # <<<<<<<<<<<<<<
- *             prevnode = chain[level]
- * 
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":71
+ *     boolean ndarray or boolean
+ *     '''
+ *     if isinstance(input, np.ndarray):             # <<<<<<<<<<<<<<
+ *         return -isnull(input)
+ *     else:
  */
-  __pyx_t_4 = __pyx_v_d;
-  for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_4; __pyx_t_10+=1) {
-    __pyx_v_level = __pyx_t_10;
+  __pyx_t_1 = PyObject_TypeCheck(__pyx_v_input, ((PyTypeObject *)((PyObject*)__pyx_ptype_5numpy_ndarray))); 
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":108
- * 
- *         for level in range(d):
- *             prevnode = chain[level]             # <<<<<<<<<<<<<<
- * 
- *             newnode.next[level] = prevnode.next[level]
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":72
+ *     '''
+ *     if isinstance(input, np.ndarray):
+ *         return -isnull(input)             # <<<<<<<<<<<<<<
+ *     else:
+ *         return not bool(_checknull(input))
  */
-    __pyx_t_9 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_9);
-    if (!(likely(((__pyx_t_9) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_9, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
-    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_9);
-    __pyx_t_9 = 0;
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__isnull); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_v_input);
+    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_input);
+    __Pyx_GIVEREF(__pyx_v_input);
+    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_r = __pyx_t_3;
+    __pyx_t_3 = 0;
+    goto __pyx_L0;
+    goto __pyx_L5;
+  }
+  /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":110
- *             prevnode = chain[level]
- * 
- *             newnode.next[level] = prevnode.next[level]             # <<<<<<<<<<<<<<
- *             prevnode.next[level] = newnode
+    /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":74
+ *         return -isnull(input)
+ *     else:
+ *         return not bool(_checknull(input))             # <<<<<<<<<<<<<<
  * 
  */
-    __pyx_t_9 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_9) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_9);
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_newnode->next), __pyx_v_level, __pyx_t_9, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_3 = __pyx_f_7tseries__checknull(__pyx_v_input); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_3);
+    __pyx_t_3 = 0;
+    __pyx_t_3 = PyObject_Call(((PyObject *)((PyObject*)&PyBool_Type)), __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_PyBool_FromLong((!__pyx_t_1)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_r = __pyx_t_3;
+    __pyx_t_3 = 0;
+    goto __pyx_L0;
+  }
+  __pyx_L5:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":111
- * 
- *             newnode.next[level] = prevnode.next[level]
- *             prevnode.next[level] = newnode             # <<<<<<<<<<<<<<
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("tseries.notnull");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_DECREF(__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":6
  * 
- *             newnode.width[level] = prevnode.width[level] - steps
+ * @cython.boundscheck(False)
+ * def arrmap(ndarray[object, ndim=1] index, object func):             # <<<<<<<<<<<<<<
+ *     cdef int length = index.shape[0]
+ *     cdef int i = 0
  */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, ((PyObject *)__pyx_v_newnode), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":113
- *             prevnode.next[level] = newnode
- * 
- *             newnode.width[level] = prevnode.width[level] - steps             # <<<<<<<<<<<<<<
- *             prevnode.width[level] = steps + 1
+static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_arrmap(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_func = 0;
+  int __pyx_v_length;
+  int __pyx_v_i;
+  PyArrayObject *__pyx_v_result = 0;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
+  Py_buffer __pyx_bstruct_result;
+  Py_ssize_t __pyx_bstride_0_result = 0;
+  Py_ssize_t __pyx_bshape_0_result = 0;
+  PyObject *__pyx_r = NULL;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  PyObject **__pyx_t_10;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__func,0};
+  __Pyx_RefNannySetupContext("arrmap");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[2] = {0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__func);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "arrmap") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_func = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_func = PyTuple_GET_ITEM(__pyx_args, 1);
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("arrmap", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.arrmap");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_v_func);
+  __pyx_bstruct_result.buf = NULL;
+  __pyx_bstruct_index.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
+
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":7
+ * @cython.boundscheck(False)
+ * def arrmap(ndarray[object, ndim=1] index, object func):
+ *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef int i = 0
  * 
  */
-    (__pyx_v_newnode->width[__pyx_v_level]) = ((__pyx_v_prevnode->width[__pyx_v_level]) - __pyx_v_steps);
+  __pyx_v_length = (__pyx_v_index->dimensions[0]);
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":114
- * 
- *             newnode.width[level] = prevnode.width[level] - steps
- *             prevnode.width[level] = steps + 1             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":8
+ * def arrmap(ndarray[object, ndim=1] index, object func):
+ *     cdef int length = index.shape[0]
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
  * 
- *             steps = steps + steps_at_level[level]
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
  */
-    (__pyx_v_prevnode->width[__pyx_v_level]) = (__pyx_v_steps + 1);
+  __pyx_v_i = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":116
- *             prevnode.width[level] = steps + 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":10
+ *     cdef int i = 0
  * 
- *             steps = steps + steps_at_level[level]             # <<<<<<<<<<<<<<
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)             # <<<<<<<<<<<<<<
  * 
- *         for level in range(d, self.maxlevels):
+ *     for i from 0 <= i < length:
  */
-    __pyx_t_9 = PyInt_FromLong(__pyx_v_steps); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_steps_at_level), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_7 = PyNumber_Add(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_11 = __Pyx_PyInt_AsInt(__pyx_t_7); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_v_steps = __pyx_t_11;
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyInt_FromLong(__pyx_v_length); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
+  __Pyx_GIVEREF(__pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__object_); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (PyDict_SetItem(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_5) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_3, ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_result.buf = NULL;
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
+      __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
+    }
   }
+  __pyx_t_6 = 0;
+  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":118
- *             steps = steps + steps_at_level[level]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":12
+ *     cdef ndarray[object, ndim=1] result = np.empty(length, dtype=np.object_)
  * 
- *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
- *             (<Node> chain[level]).width[level] += 1
+ *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
+ *         result[i] = func(index[i])
  * 
  */
-  __pyx_t_4 = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels;
-  for (__pyx_t_10 = __pyx_v_d; __pyx_t_10 < __pyx_t_4; __pyx_t_10+=1) {
-    __pyx_v_level = __pyx_t_10;
+  __pyx_t_7 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":119
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":13
  * 
- *         for level in range(d, self.maxlevels):
- *             (<Node> chain[level]).width[level] += 1             # <<<<<<<<<<<<<<
+ *     for i from 0 <= i < length:
+ *         result[i] = func(index[i])             # <<<<<<<<<<<<<<
  * 
- *         self.size += 1
+ *     return result
  */
-    __pyx_t_7 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_7) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    (((struct __pyx_obj_7tseries_Node *)__pyx_t_7)->width[__pyx_v_level]) += 1;
+    __pyx_t_8 = __pyx_v_i;
+    if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_index;
+    __pyx_t_5 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_8, __pyx_bstride_0_index);
+    __Pyx_INCREF((PyObject*)__pyx_t_5);
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
+    __Pyx_GIVEREF(__pyx_t_5);
+    __pyx_t_5 = 0;
+    __pyx_t_5 = PyObject_Call(__pyx_v_func, __pyx_t_1, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_9 = __pyx_v_i;
+    if (__pyx_t_9 < 0) __pyx_t_9 += __pyx_bshape_0_result;
+    __pyx_t_10 = __Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_result.buf, __pyx_t_9, __pyx_bstride_0_result);
+    __Pyx_GOTREF(*__pyx_t_10);
+    __Pyx_DECREF(*__pyx_t_10); __Pyx_INCREF(__pyx_t_5);
+    *__pyx_t_10 = __pyx_t_5;
+    __Pyx_GIVEREF(*__pyx_t_10);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":121
- *             (<Node> chain[level]).width[level] += 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":15
+ *         result[i] = func(index[i])
  * 
- *         self.size += 1             # <<<<<<<<<<<<<<
+ *     return result             # <<<<<<<<<<<<<<
  * 
- *     def remove(self, double value):
+ * @cython.boundscheck(False)
  */
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size += 1;
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_result));
+  __pyx_r = ((PyObject *)__pyx_v_result);
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -6411,672 +3944,877 @@ static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_insert(PyObject *__pyx_v_
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.insert");
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.arrmap");
   __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_node);
-  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_newnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
-  __Pyx_DECREF(__pyx_v_chain);
-  __Pyx_DECREF(__pyx_v_steps_at_level);
-  __Pyx_DECREF((PyObject *)__pyx_v_self);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_result);
+  __Pyx_DECREF((PyObject *)__pyx_v_index);
+  __Pyx_DECREF(__pyx_v_func);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":123
- *         self.size += 1
+/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":18
  * 
- *     def remove(self, double value):             # <<<<<<<<<<<<<<
- *         cdef int level, d
- *         cdef Node node, prevnode, tmpnode, next_at_level
+ * @cython.boundscheck(False)
+ * def groupby_withnull_old(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]
  */
 
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value); /*proto*/
-static PyObject *__pyx_pf_7tseries_17IndexableSkiplist_remove(PyObject *__pyx_v_self, PyObject *__pyx_arg_value) {
-  double __pyx_v_value;
-  int __pyx_v_level;
-  int __pyx_v_d;
-  struct __pyx_obj_7tseries_Node *__pyx_v_node;
-  struct __pyx_obj_7tseries_Node *__pyx_v_prevnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_tmpnode;
-  struct __pyx_obj_7tseries_Node *__pyx_v_next_at_level;
-  PyObject *__pyx_v_chain;
+static PyObject *__pyx_pf_7tseries_groupby_withnull_old(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_groupby_withnull_old(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_keyfunc = 0;
+  PyObject *__pyx_v_groups;
+  int __pyx_v_length;
+  PyObject *__pyx_v_idx;
+  PyObject *__pyx_v_curKey;
+  PyObject *__pyx_v_key;
+  PyObject *__pyx_v_members;
+  PyArrayObject *__pyx_v_mapped_index = 0;
+  PyArrayObject *__pyx_v_null_mask = 0;
+  PyObject *__pyx_v_bool_mask;
+  PyObject *__pyx_v_null_values;
+  int __pyx_v_i;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
+  Py_buffer __pyx_bstruct_null_mask;
+  Py_ssize_t __pyx_bstride_0_null_mask = 0;
+  Py_ssize_t __pyx_bshape_0_null_mask = 0;
+  Py_buffer __pyx_bstruct_mapped_index;
+  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
+  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
   PyObject *__pyx_r = NULL;
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  Py_ssize_t __pyx_t_6;
-  int __pyx_t_7;
-  __Pyx_RefNannySetupContext("remove");
-  assert(__pyx_arg_value); {
-    __pyx_v_value = __pyx_PyFloat_AsDouble(__pyx_arg_value); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  PyObject *__pyx_t_4 = NULL;
+  PyArrayObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  long __pyx_t_7;
+  long __pyx_t_8;
+  npy_int8 __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  PyObject *__pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
+  __Pyx_RefNannySetupContext("groupby_withnull_old");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[2] = {0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("groupby_withnull_old", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_withnull_old") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_keyfunc = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("groupby_withnull_old", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
+  __Pyx_AddTraceback("tseries.groupby_withnull_old");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_self);
-  __pyx_v_node = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_chain = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":129
- * 
- *         # find first node on each level where node.next[levels].value >= value
- *         chain = [None] * self.maxlevels             # <<<<<<<<<<<<<<
- *         node = self.head
- * 
- */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
-  __Pyx_INCREF(Py_None);
-  PyList_SET_ITEM(__pyx_t_1, 0, Py_None);
-  __Pyx_GIVEREF(Py_None);
-  __pyx_t_2 = PyInt_FromLong(((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyNumber_Multiply(((PyObject *)__pyx_t_1), __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(PyList_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_3)->tp_name), 0))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(((PyObject *)__pyx_v_chain));
-  __pyx_v_chain = ((PyObject *)__pyx_t_3);
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":130
- *         # find first node on each level where node.next[levels].value >= value
- *         chain = [None] * self.maxlevels
- *         node = self.head             # <<<<<<<<<<<<<<
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- */
-  __Pyx_INCREF(((PyObject *)((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head));
-  __Pyx_DECREF(((PyObject *)__pyx_v_node));
-  __pyx_v_node = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->head;
-
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":132
- *         node = self.head
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):             # <<<<<<<<<<<<<<
- *             next_at_level = node.next[level]
- *             while next_at_level.value < value:
- */
-  for (__pyx_t_4 = (((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels - 1); __pyx_t_4 > -1; __pyx_t_4-=1) {
-    __pyx_v_level = __pyx_t_4;
-
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":133
- * 
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             next_at_level = node.next[level]             # <<<<<<<<<<<<<<
- *             while next_at_level.value < value:
- *                 node = next_at_level
- */
-    __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-    __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-    __pyx_t_3 = 0;
-
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":134
- *         for level in range(self.maxlevels - 1, -1, -1):
- *             next_at_level = node.next[level]
- *             while next_at_level.value < value:             # <<<<<<<<<<<<<<
- *                 node = next_at_level
- *                 next_at_level = node.next[level]
+  __Pyx_INCREF((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_bool_mask = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_null_values = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_bstruct_mapped_index.buf = NULL;
+  __pyx_bstruct_null_mask.buf = NULL;
+  __pyx_bstruct_index.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
+
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":20
+ * def groupby_withnull_old(ndarray[object, ndim = 1] index, object keyfunc):
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef object idx
+ *     cdef object curKey, key
  */
-    while (1) {
-      __pyx_t_5 = (__pyx_v_next_at_level->value < __pyx_v_value);
-      if (!__pyx_t_5) break;
+  __pyx_v_length = (__pyx_v_index->dimensions[0]);
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":135
- *             next_at_level = node.next[level]
- *             while next_at_level.value < value:
- *                 node = next_at_level             # <<<<<<<<<<<<<<
- *                 next_at_level = node.next[level]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":25
+ *     cdef list members
+ * 
+ *     groups = PyDict_New()             # <<<<<<<<<<<<<<
  * 
+ *     if length != index.shape[0]:
  */
-      __Pyx_INCREF(((PyObject *)__pyx_v_next_at_level));
-      __Pyx_DECREF(((PyObject *)__pyx_v_node));
-      __pyx_v_node = __pyx_v_next_at_level;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
+  __pyx_v_groups = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":136
- *             while next_at_level.value < value:
- *                 node = next_at_level
- *                 next_at_level = node.next[level]             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":27
+ *     groups = PyDict_New()
+ * 
+ *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *             chain[level] = node
  */
-      __pyx_t_3 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_node->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_3) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(((PyObject *)__pyx_v_next_at_level));
-      __pyx_v_next_at_level = ((struct __pyx_obj_7tseries_Node *)__pyx_t_3);
-      __pyx_t_3 = 0;
-    }
+  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
+  if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":138
- *                 next_at_level = node.next[level]
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":28
  * 
- *             chain[level] = node             # <<<<<<<<<<<<<<
+ *     if length != index.shape[0]:
+ *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
  * 
- *         if value != chain[0].next[0].value:
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
  */
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_chain), __pyx_v_level, ((PyObject *)__pyx_v_node), sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_4));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_Raise(__pyx_t_3, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    goto __pyx_L6;
   }
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":140
- *             chain[level] = node
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":30
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *         if value != chain[0].next[0].value:             # <<<<<<<<<<<<<<
- *             raise KeyError('Not Found')
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)             # <<<<<<<<<<<<<<
  * 
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
  */
-  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__next); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__value); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_t_1, Py_NE); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)__pyx_v_index));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_index));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_keyfunc);
+  __Pyx_GIVEREF(__pyx_v_keyfunc);
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__pyx_t_5) {
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_mapped_index.buf = NULL;
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
+      __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
+    }
+  }
+  __pyx_t_5 = 0;
+  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":141
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":32
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
  * 
- *         if value != chain[0].next[0].value:
- *             raise KeyError('Not Found')             # <<<<<<<<<<<<<<
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)             # <<<<<<<<<<<<<<
  * 
- *         # remove one link at each level
+ *     bool_mask = null_mask.astype(bool)
  */
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_kp_s_4));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
-    __pyx_t_1 = PyObject_Call(__pyx_builtin_KeyError, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_Raise(__pyx_t_1, 0, 0);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    goto __pyx_L9;
+  __pyx_t_4 = ((PyObject *)__pyx_f_7tseries__isnullobj(((PyObject *)__pyx_v_mapped_index))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_null_mask, (PyObject*)((PyArrayObject *)__pyx_t_4), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_null_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_null_mask.buf = NULL;
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_null_mask = __pyx_bstruct_null_mask.strides[0];
+      __pyx_bshape_0_null_mask = __pyx_bstruct_null_mask.shape[0];
+    }
   }
-  __pyx_L9:;
+  __pyx_v_null_mask = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":144
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":34
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
  * 
- *         # remove one link at each level
- *         d = len(chain[0].next[0].next)             # <<<<<<<<<<<<<<
+ *     bool_mask = null_mask.astype(bool)             # <<<<<<<<<<<<<<
  * 
- *         for level in range(d):
+ *     null_values = np.asarray(index)[bool_mask]
  */
-  __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_null_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__next); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)((PyObject*)&PyBool_Type)));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)((PyObject*)&PyBool_Type)));
+  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyBool_Type)));
+  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, sizeof(long), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_v_bool_mask);
+  __pyx_v_bool_mask = __pyx_t_3;
+  __pyx_t_3 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":36
+ *     bool_mask = null_mask.astype(bool)
+ * 
+ *     null_values = np.asarray(index)[bool_mask]             # <<<<<<<<<<<<<<
+ * 
+ *     if null_values.any():
+ */
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__asarray); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__next); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(((PyObject *)__pyx_v_index));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_index));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
+  __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_6 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_d = __pyx_t_6;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyObject_GetItem(__pyx_t_4, __pyx_v_bool_mask); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_v_null_values);
+  __pyx_v_null_values = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":146
- *         d = len(chain[0].next[0].next)
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":38
+ *     null_values = np.asarray(index)[bool_mask]
+ * 
+ *     if null_values.any():             # <<<<<<<<<<<<<<
+ *         PyDict_SetItem(groups, np.NaN, null_values)
  * 
- *         for level in range(d):             # <<<<<<<<<<<<<<
- *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]
  */
-  __pyx_t_4 = __pyx_v_d;
-  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
-    __pyx_v_level = __pyx_t_7;
+  __pyx_t_3 = PyObject_GetAttr(__pyx_v_null_values, __pyx_n_s__any); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":147
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":39
  * 
- *         for level in range(d):
- *             prevnode = chain[level]             # <<<<<<<<<<<<<<
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1
+ *     if null_values.any():
+ *         PyDict_SetItem(groups, np.NaN, null_values)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int i = 0
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_prevnode));
-    __pyx_v_prevnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
-    __pyx_t_2 = 0;
+    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_t_3, __pyx_v_null_values); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L7;
+  }
+  __pyx_L7:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":148
- *         for level in range(d):
- *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]             # <<<<<<<<<<<<<<
- *             prevnode.width[level] += tmpnode.width[level] - 1
- *             prevnode.next[level] = tmpnode.next[level]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":41
+ *         PyDict_SetItem(groups, np.NaN, null_values)
+ * 
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
+ *     idx = index[0]
+ *     key = mapped_index[0]
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
-    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
-    __pyx_t_2 = 0;
+  __pyx_v_i = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":42
+ * 
+ *     cdef int i = 0
+ *     idx = index[0]             # <<<<<<<<<<<<<<
+ *     key = mapped_index[0]
+ * 
+ */
+  __pyx_t_7 = 0;
+  if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_7, __pyx_bstride_0_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_idx);
+  __pyx_v_idx = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":149
- *             prevnode = chain[level]
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1             # <<<<<<<<<<<<<<
- *             prevnode.next[level] = tmpnode.next[level]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":43
+ *     cdef int i = 0
+ *     idx = index[0]
+ *     key = mapped_index[0]             # <<<<<<<<<<<<<<
  * 
+ *     # Algorithm notes
  */
-    (__pyx_v_prevnode->width[__pyx_v_level]) += ((__pyx_v_tmpnode->width[__pyx_v_level]) - 1);
+  __pyx_t_8 = 0;
+  if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_mapped_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_8, __pyx_bstride_0_mapped_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_key);
+  __pyx_v_key = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":150
- *             tmpnode = prevnode.next[level]
- *             prevnode.width[level] += tmpnode.width[level] - 1
- *             prevnode.next[level] = tmpnode.next[level]             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":49
+ *     #   'lazily' evaluates
  * 
- *         for level in range(d, self.maxlevels):
+ *     while i < length:             # <<<<<<<<<<<<<<
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_tmpnode->next), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (__Pyx_SetItemInt(((PyObject *)__pyx_v_prevnode->next), __pyx_v_level, __pyx_t_2, sizeof(int), PyInt_FromLong) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  }
+  while (1) {
+    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+    if (!__pyx_t_2) break;
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":152
- *             prevnode.next[level] = tmpnode.next[level]
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":50
  * 
- *         for level in range(d, self.maxlevels):             # <<<<<<<<<<<<<<
- *             tmpnode = chain[level]
- *             tmpnode.width[level] -= 1
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)
  */
-  __pyx_t_4 = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->maxlevels;
-  for (__pyx_t_7 = __pyx_v_d; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
-    __pyx_v_level = __pyx_t_7;
+    __pyx_t_6 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = (!__pyx_t_6);
+    if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":153
- * 
- *         for level in range(d, self.maxlevels):
- *             tmpnode = chain[level]             # <<<<<<<<<<<<<<
- *             tmpnode.width[level] -= 1
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":51
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]             # <<<<<<<<<<<<<<
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
  */
-    __pyx_t_2 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_chain), __pyx_v_level, sizeof(int), PyInt_FromLong); if (!__pyx_t_2) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_7tseries_Node))))) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_tmpnode));
-    __pyx_v_tmpnode = ((struct __pyx_obj_7tseries_Node *)__pyx_t_2);
-    __pyx_t_2 = 0;
+      __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+      __Pyx_INCREF(__pyx_v_idx);
+      PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
+      __Pyx_GIVEREF(__pyx_v_idx);
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = __pyx_t_3;
+      __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":154
- *         for level in range(d, self.maxlevels):
- *             tmpnode = chain[level]
- *             tmpnode.width[level] -= 1             # <<<<<<<<<<<<<<
- * 
- *         self.size -= 1
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":52
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
  */
-    (__pyx_v_tmpnode->width[__pyx_v_level]) -= 1;
-  }
+      __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":156
- *             tmpnode.width[level] -= 1
- * 
- *         self.size -= 1             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":53
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
-  ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_v_self)->size -= 1;
+      __pyx_v_i += 1;
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("tseries.IndexableSkiplist.remove");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_node);
-  __Pyx_DECREF((PyObject *)__pyx_v_prevnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_tmpnode);
-  __Pyx_DECREF((PyObject *)__pyx_v_next_at_level);
-  __Pyx_DECREF(__pyx_v_chain);
-  __Pyx_DECREF((PyObject *)__pyx_v_self);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":54
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 if null_mask[i]:
+ */
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":12
- * # Rolling sum
- * 
- * cdef void _roll_sum(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":55
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 if null_mask[i]:
+ *                     i += 1
  */
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-static  void __pyx_f_7tseries__roll_sum(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_minp, int __pyx_v_N) {
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  int __pyx_v_nobs;
-  int __pyx_v_i;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  __Pyx_RefNannySetupContext("_roll_sum");
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":56
+ *             curKey = key
+ *             while i < length:
+ *                 if null_mask[i]:             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                     continue
+ */
+        __pyx_t_6 = __pyx_v_i;
+        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_6, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":14
- * cdef void _roll_sum(double_t *input, double_t *output,
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
- *     cdef int nobs = 0, i
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":57
+ *             while i < length:
+ *                 if null_mask[i]:
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                     continue
  * 
  */
-  __pyx_v_sum_x = 0;
+          __pyx_v_i += 1;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":15
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
- *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":58
+ *                 if null_mask[i]:
+ *                     i += 1
+ *                     continue             # <<<<<<<<<<<<<<
  * 
- *     if minp > N:
+ *                 idx = index[i]
  */
-  __pyx_v_nobs = 0;
+          goto __pyx_L11_continue;
+          goto __pyx_L13;
+        }
+        __pyx_L13:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":17
- *     cdef int nobs = 0, i
- * 
- *     if minp > N:             # <<<<<<<<<<<<<<
- *         minp = N + 1
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":60
+ *                     continue
  * 
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+        __pyx_t_10 = __pyx_v_i;
+        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":18
- * 
- *     if minp > N:
- *         minp = N + 1             # <<<<<<<<<<<<<<
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":61
  * 
- *     for i from 0 <= i < minp - 1:
+ *                 idx = index[i]
+ *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-    __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L3;
-  }
-  __pyx_L3:;
+        __pyx_t_11 = __pyx_v_i;
+        if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_mapped_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_11, __pyx_bstride_0_mapped_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":20
- *         minp = N + 1
- * 
- *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":62
+ *                 idx = index[i]
+ *                 key = mapped_index[i]
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        if (__pyx_t_2) {
+
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":63
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
+ */
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":64
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
+ */
+          __pyx_v_i += 1;
+          goto __pyx_L14;
+        }
+        /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":21
- * 
- *     for i from 0 <= i < minp - 1:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         # Not NaN
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":66
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+          goto __pyx_L12_break;
+        }
+        __pyx_L14:;
+        __pyx_L11_continue:;
+      }
+      __pyx_L12_break:;
+      goto __pyx_L10;
+    }
+    /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":24
- * 
- *         # Not NaN
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":68
+ *                     break
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
+ *             members.append(idx)
+ *             i += 1
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+      __pyx_t_13 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
+      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_13)));
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = ((PyObject *)__pyx_t_13);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":25
- *         # Not NaN
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":69
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(idx)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
  */
-      __pyx_v_nobs += 1;
+      if (unlikely(__pyx_v_members == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":26
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":70
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(idx)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while null_mask[i] and i < length:
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L6;
-    }
-    __pyx_L6:;
+      __pyx_v_i += 1;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":28
- *             sum_x += val
- * 
- *         output[i] = NaN             # <<<<<<<<<<<<<<
- * 
- *     for i from minp - 1 <= i < N:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":71
+ *             members.append(idx)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while null_mask[i] and i < length:
+ *                 i += 1
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-  }
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":30
- *         output[i] = NaN
- * 
- *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i]
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":72
+ *             i += 1
+ *             curKey = key
+ *             while null_mask[i] and i < length:             # <<<<<<<<<<<<<<
+ *                 i += 1
  * 
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+      while (1) {
+        __pyx_t_12 = __pyx_v_i;
+        if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_12, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
+          __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+          __pyx_t_14 = __pyx_t_2;
+        } else {
+          __pyx_t_14 = __pyx_t_9;
+        }
+        if (!__pyx_t_14) break;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":31
- * 
- *     for i from minp - 1 <= i < N:
- *         val = input[i]             # <<<<<<<<<<<<<<
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":73
+ *             curKey = key
+ *             while null_mask[i] and i < length:
+ *                 i += 1             # <<<<<<<<<<<<<<
  * 
- *         if i > win - 1:
+ *             while i < length:
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+        __pyx_v_i += 1;
+      }
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":33
- *         val = input[i]
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":75
+ *                 i += 1
  * 
- *         if i > win - 1:             # <<<<<<<<<<<<<<
- *             prev = input[i - win]
- *             if prev == prev:
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 if null_mask[i]:
+ *                     i += 1
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+      while (1) {
+        __pyx_t_14 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_14) break;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":34
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":76
  * 
- *         if i > win - 1:
- *             prev = input[i - win]             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 sum_x -= prev
+ *             while i < length:
+ *                 if null_mask[i]:             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                     continue
  */
-      __pyx_v_prev = (__pyx_v_input[(__pyx_v_i - __pyx_v_win)]);
+        __pyx_t_15 = __pyx_v_i;
+        if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_15, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":35
- *         if i > win - 1:
- *             prev = input[i - win]
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 sum_x -= prev
- *                 nobs -= 1
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":77
+ *             while i < length:
+ *                 if null_mask[i]:
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                     continue
+ * 
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+          __pyx_v_i += 1;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":36
- *             prev = input[i - win]
- *             if prev == prev:
- *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":78
+ *                 if null_mask[i]:
+ *                     i += 1
+ *                     continue             # <<<<<<<<<<<<<<
  * 
+ *                 idx = index[i]
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+          goto __pyx_L17_continue;
+          goto __pyx_L19;
+        }
+        __pyx_L19:;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":37
- *             if prev == prev:
- *                 sum_x -= prev
- *                 nobs -= 1             # <<<<<<<<<<<<<<
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":80
+ *                     continue
  * 
- *         if val == val:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L10;
-      }
-      __pyx_L10:;
-      goto __pyx_L9;
-    }
-    __pyx_L9:;
+        __pyx_t_16 = __pyx_v_i;
+        if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_16, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":39
- *                 nobs -= 1
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":81
  * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+ *                 idx = index[i]
+ *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+        __pyx_t_17 = __pyx_v_i;
+        if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_bshape_0_mapped_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_17, __pyx_bstride_0_mapped_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":40
- * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":82
+ *                 idx = index[i]
+ *                 key = mapped_index[i]
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-      __pyx_v_nobs += 1;
+        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_14 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        if (__pyx_t_14) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":41
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         if nobs >= minp:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":83
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L11;
-    }
-    __pyx_L11:;
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_18 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_18 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":43
- *             sum_x += val
- * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = sum_x
- *         else:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":84
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+          __pyx_v_i += 1;
+          goto __pyx_L20;
+        }
+        /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":44
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":86
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
  * 
- *         if nobs >= minp:
- *             output[i] = sum_x             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
+ *     return groups
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_sum_x;
-      goto __pyx_L12;
+          goto __pyx_L18_break;
+        }
+        __pyx_L20:;
+        __pyx_L17_continue:;
+      }
+      __pyx_L18_break:;
     }
-    /*else*/ {
+    __pyx_L10:;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":46
- *             output[i] = sum_x
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":88
+ *                     break
  * 
- * def _roll_sum_noncontig(ndarray[double_t, ndim=1] input,
+ *     return groups             # <<<<<<<<<<<<<<
+ * 
+ * @cython.boundscheck(False)
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L12:;
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
+  __pyx_r = ((PyObject *)__pyx_v_groups);
+  goto __pyx_L0;
 
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.groupby_withnull_old");
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
+  __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_groups);
+  __Pyx_DECREF(__pyx_v_idx);
+  __Pyx_DECREF(__pyx_v_curKey);
+  __Pyx_DECREF(__pyx_v_key);
+  __Pyx_DECREF(__pyx_v_members);
+  __Pyx_XDECREF((PyObject *)__pyx_v_mapped_index);
+  __Pyx_XDECREF((PyObject *)__pyx_v_null_mask);
+  __Pyx_DECREF(__pyx_v_bool_mask);
+  __Pyx_DECREF(__pyx_v_null_values);
+  __Pyx_DECREF((PyObject *)__pyx_v_index);
+  __Pyx_DECREF(__pyx_v_keyfunc);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":48
- *             output[i] = NaN
+/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":91
  * 
- * def _roll_sum_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int minp, int N):
+ * @cython.boundscheck(False)
+ * def groupby_withnull(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]
  */
 
-static PyObject *__pyx_pf_7tseries__roll_sum_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_sum_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
-  int __pyx_v_win;
-  int __pyx_v_minp;
-  int __pyx_v_N;
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  int __pyx_v_nobs;
+static PyObject *__pyx_pf_7tseries_groupby_withnull(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_groupby_withnull(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_keyfunc = 0;
+  PyObject *__pyx_v_groups;
+  int __pyx_v_length;
+  PyObject *__pyx_v_idx;
+  PyObject *__pyx_v_curKey;
+  PyObject *__pyx_v_key;
+  PyObject *__pyx_v_members;
+  PyArrayObject *__pyx_v_mapped_index = 0;
+  PyArrayObject *__pyx_v_null_mask = 0;
+  PyObject *__pyx_v_bool_mask;
+  PyObject *__pyx_v_null_values;
   int __pyx_v_i;
-  Py_buffer __pyx_bstruct_output;
-  Py_ssize_t __pyx_bstride_0_output = 0;
-  Py_ssize_t __pyx_bshape_0_output = 0;
-  Py_buffer __pyx_bstruct_input;
-  Py_ssize_t __pyx_bstride_0_input = 0;
-  Py_ssize_t __pyx_bshape_0_input = 0;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
+  Py_buffer __pyx_bstruct_null_mask;
+  Py_ssize_t __pyx_bstride_0_null_mask = 0;
+  Py_ssize_t __pyx_bshape_0_null_mask = 0;
+  Py_buffer __pyx_bstruct_mapped_index;
+  Py_ssize_t __pyx_bstride_0_mapped_index = 0;
+  Py_ssize_t __pyx_bshape_0_mapped_index = 0;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  int __pyx_t_5;
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyArrayObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
-  int __pyx_t_7;
-  int __pyx_t_8;
-  int __pyx_t_9;
+  long __pyx_t_7;
+  long __pyx_t_8;
+  npy_int8 __pyx_t_9;
   int __pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__minp,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_sum_noncontig");
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  int __pyx_t_17;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
+  __Pyx_RefNannySetupContext("groupby_withnull");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[5] = {0,0,0,0,0};
+    PyObject* values[2] = {0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -7084,710 +4822,776 @@ static PyObject *__pyx_pf_7tseries__roll_sum_noncontig(PyObject *__pyx_self, PyO
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_sum_noncontig", 1, 5, 5, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_sum_noncontig", 1, 5, 5, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_sum_noncontig", 1, 5, 5, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_sum_noncontig", 1, 5, 5, 4); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupby_withnull", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_sum_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby_withnull") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[4]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_keyfunc = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 50; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_sum_noncontig", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("groupby_withnull", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_sum_noncontig");
+  __Pyx_AddTraceback("tseries.groupby_withnull");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
-  __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
-  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+  __Pyx_INCREF((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_bool_mask = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_null_values = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_bstruct_mapped_index.buf = NULL;
+  __pyx_bstruct_null_mask.buf = NULL;
+  __pyx_bstruct_index.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":51
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
- *     cdef int nobs = 0, i
- * 
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":93
+ * def groupby_withnull(ndarray[object, ndim = 1] index, object keyfunc):
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef object idx
+ *     cdef object curKey, key
  */
-  __pyx_v_sum_x = 0;
+  __pyx_v_length = (__pyx_v_index->dimensions[0]);
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":52
- *                         int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
- *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":98
+ *     cdef list members
  * 
- *     if minp > N:
+ *     groups = PyDict_New()             # <<<<<<<<<<<<<<
+ * 
+ *     if length != index.shape[0]:
  */
-  __pyx_v_nobs = 0;
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
+  __pyx_v_groups = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":54
- *     cdef int nobs = 0, i
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":100
+ *     groups = PyDict_New()
  * 
- *     if minp > N:             # <<<<<<<<<<<<<<
- *         minp = N + 1
+ *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
+ *         raise Exception('Dates and values were not the same length!')
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
+  if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":55
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":101
  * 
- *     if minp > N:
- *         minp = N + 1             # <<<<<<<<<<<<<<
+ *     if length != index.shape[0]:
+ *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
  * 
- *     for i from 0 <= i < minp - 1:
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
  */
-    __pyx_v_minp = (__pyx_v_N + 1);
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_4));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_Raise(__pyx_t_3, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     goto __pyx_L6;
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":57
- *         minp = N + 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":103
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
- *         val = input[i]
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)             # <<<<<<<<<<<<<<
  * 
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__arrmap); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_INCREF(((PyObject *)__pyx_v_index));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_index));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_keyfunc);
+  __Pyx_GIVEREF(__pyx_v_keyfunc);
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (!(likely(((__pyx_t_4) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_mapped_index, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_mapped_index = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_mapped_index.buf = NULL;
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_mapped_index = __pyx_bstruct_mapped_index.strides[0];
+      __pyx_bshape_0_mapped_index = __pyx_bstruct_mapped_index.shape[0];
+    }
+  }
+  __pyx_t_5 = 0;
+  __pyx_v_mapped_index = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":58
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":105
+ *     cdef ndarray[object, ndim=1] mapped_index = arrmap(index, keyfunc)
  * 
- *     for i from 0 <= i < minp - 1:
- *         val = input[i]             # <<<<<<<<<<<<<<
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)             # <<<<<<<<<<<<<<
  * 
- *         # Not NaN
+ *     bool_mask = null_mask.astype(bool)
  */
-    __pyx_t_3 = __pyx_v_i;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 58; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = ((PyObject *)__pyx_f_7tseries__isnullobj(((PyObject *)__pyx_v_mapped_index))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_null_mask, (PyObject*)((PyArrayObject *)__pyx_t_4), &__Pyx_TypeInfo_nn_npy_int8, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_null_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_null_mask.buf = NULL;
+      {__pyx_filename = __pyx_f[5]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_null_mask = __pyx_bstruct_null_mask.strides[0];
+      __pyx_bshape_0_null_mask = __pyx_bstruct_null_mask.shape[0];
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_3, __pyx_bstride_0_input));
+  }
+  __pyx_v_null_mask = ((PyArrayObject *)__pyx_t_4);
+  __pyx_t_4 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":61
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":107
+ *     cdef ndarray[npy_int8, ndim=1] null_mask = _isnullobj(mapped_index)
  * 
- *         # Not NaN
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+ *     bool_mask = null_mask.astype(bool)             # <<<<<<<<<<<<<<
+ * 
+ *     null_values = np.asarray(index)[bool_mask]
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_null_mask), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_INCREF(((PyObject *)((PyObject*)&PyBool_Type)));
+  PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)((PyObject*)&PyBool_Type)));
+  __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyBool_Type)));
+  __pyx_t_3 = PyObject_Call(__pyx_t_4, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_v_bool_mask);
+  __pyx_v_bool_mask = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":62
- *         # Not NaN
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":109
+ *     bool_mask = null_mask.astype(bool)
  * 
+ *     null_values = np.asarray(index)[bool_mask]             # <<<<<<<<<<<<<<
+ * 
+ *     if null_values.any():
  */
-      __pyx_v_nobs += 1;
+  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_1 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__asarray); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(((PyObject *)__pyx_v_index));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_index));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_index));
+  __pyx_t_4 = PyObject_Call(__pyx_t_1, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyObject_GetItem(__pyx_t_4, __pyx_v_bool_mask); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_v_null_values);
+  __pyx_v_null_values = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":63
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":111
+ *     null_values = np.asarray(index)[bool_mask]
+ * 
+ *     if null_values.any():             # <<<<<<<<<<<<<<
+ *         PyDict_SetItem(groups, np.NaN, null_values)
  * 
- *         output[i] = NaN
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L9;
-    }
-    __pyx_L9:;
+  __pyx_t_3 = PyObject_GetAttr(__pyx_v_null_values, __pyx_n_s__any); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = PyObject_Call(__pyx_t_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":65
- *             sum_x += val
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":112
  * 
- *         output[i] = NaN             # <<<<<<<<<<<<<<
+ *     if null_values.any():
+ *         PyDict_SetItem(groups, np.NaN, null_values)             # <<<<<<<<<<<<<<
  * 
- *     for i from minp - 1 <= i < N:
+ *     cdef int i = 0
  */
-    __pyx_t_4 = __pyx_v_i;
-    __pyx_t_5 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_5 = 0;
-    if (unlikely(__pyx_t_5 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_5);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 65; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__NaN); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_t_3, __pyx_v_null_values); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    goto __pyx_L7;
   }
+  __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":67
- *         output[i] = NaN
- * 
- *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":114
+ *         PyDict_SetItem(groups, np.NaN, null_values)
  * 
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
+ *     idx = index[0]
+ *     key = mapped_index[0]
  */
-  __pyx_t_5 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_5; __pyx_v_i++) {
+  __pyx_v_i = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":68
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":115
  * 
- *     for i from minp - 1 <= i < N:
- *         val = input[i]             # <<<<<<<<<<<<<<
+ *     cdef int i = 0
+ *     idx = index[0]             # <<<<<<<<<<<<<<
+ *     key = mapped_index[0]
  * 
- *         if i > win - 1:
  */
-    __pyx_t_6 = __pyx_v_i;
-    __pyx_t_7 = -1;
-    if (__pyx_t_6 < 0) {
-      __pyx_t_6 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input));
+  __pyx_t_7 = 0;
+  if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_7, __pyx_bstride_0_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_idx);
+  __pyx_v_idx = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":70
- *         val = input[i]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":116
+ *     cdef int i = 0
+ *     idx = index[0]
+ *     key = mapped_index[0]             # <<<<<<<<<<<<<<
  * 
- *         if i > win - 1:             # <<<<<<<<<<<<<<
- *             prev = input[i - win]
- *             if prev == prev:
+ *     # Algorithm notes
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+  __pyx_t_8 = 0;
+  if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_mapped_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_8, __pyx_bstride_0_mapped_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_key);
+  __pyx_v_key = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":71
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":122
+ *     #   'lazily' evaluates
  * 
- *         if i > win - 1:
- *             prev = input[i - win]             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 sum_x -= prev
- */
-      __pyx_t_7 = (__pyx_v_i - __pyx_v_win);
-      __pyx_t_8 = -1;
-      if (__pyx_t_7 < 0) {
-        __pyx_t_7 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-      } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_8 = 0;
-      if (unlikely(__pyx_t_8 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_8);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":72
- *         if i > win - 1:
- *             prev = input[i - win]
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 sum_x -= prev
- *                 nobs -= 1
+ *     while i < length:             # <<<<<<<<<<<<<<
+ *         if key not in groups:
+ *             members = [idx]
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+  while (1) {
+    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+    if (!__pyx_t_2) break;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":73
- *             prev = input[i - win]
- *             if prev == prev:
- *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":123
  * 
+ *     while i < length:
+ *         if key not in groups:             # <<<<<<<<<<<<<<
+ *             members = [idx]
+ *             groups[key] = members
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+    if (unlikely(((PyObject *)__pyx_v_groups) == Py_None)) {
+      __Pyx_RaiseNoneNotIterableError(); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {
+      __pyx_t_2 = (__Pyx_NegateNonNeg(PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key))); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    if (__pyx_t_2) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":74
- *             if prev == prev:
- *                 sum_x -= prev
- *                 nobs -= 1             # <<<<<<<<<<<<<<
- * 
- *         if val == val:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":124
+ *     while i < length:
+ *         if key not in groups:
+ *             members = [idx]             # <<<<<<<<<<<<<<
+ *             groups[key] = members
+ *             i += 1
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L13;
-      }
-      __pyx_L13:;
-      goto __pyx_L12;
-    }
-    __pyx_L12:;
+      __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_3));
+      __Pyx_INCREF(__pyx_v_idx);
+      PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
+      __Pyx_GIVEREF(__pyx_v_idx);
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = __pyx_t_3;
+      __pyx_t_3 = 0;
+
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":125
+ *         if key not in groups:
+ *             members = [idx]
+ *             groups[key] = members             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
+ */
+      if (PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)) < 0) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":76
- *                 nobs -= 1
- * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":126
+ *             members = [idx]
+ *             groups[key] = members
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+      __pyx_v_i += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":77
- * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":127
+ *             groups[key] = members
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 if null_mask[i]:
  */
-      __pyx_v_nobs += 1;
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":78
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         if nobs >= minp:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":128
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 if null_mask[i]:
+ *                     i += 1
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L14;
-    }
-    __pyx_L14:;
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":80
- *             sum_x += val
- * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = sum_x
- *         else:
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":129
+ *             curKey = key
+ *             while i < length:
+ *                 if null_mask[i]:             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                     continue
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+        __pyx_t_6 = __pyx_v_i;
+        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_6, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":81
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":130
+ *             while i < length:
+ *                 if null_mask[i]:
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                     continue
  * 
- *         if nobs >= minp:
- *             output[i] = sum_x             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
  */
-      __pyx_t_8 = __pyx_v_i;
-      __pyx_t_9 = -1;
-      if (__pyx_t_8 < 0) {
-        __pyx_t_8 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
-      } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
-      if (unlikely(__pyx_t_9 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = __pyx_v_sum_x;
-      goto __pyx_L15;
-    }
-    /*else*/ {
+          __pyx_v_i += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":83
- *             output[i] = sum_x
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":131
+ *                 if null_mask[i]:
+ *                     i += 1
+ *                     continue             # <<<<<<<<<<<<<<
  * 
- * #-------------------------------------------------------------------------------
+ *                 idx = index[i]
  */
-      __pyx_t_9 = __pyx_v_i;
-      __pyx_t_10 = -1;
-      if (__pyx_t_9 < 0) {
-        __pyx_t_9 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
-      } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_output)) __pyx_t_10 = 0;
-      if (unlikely(__pyx_t_10 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_10);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_9, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L15:;
-  }
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_sum_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+          goto __pyx_L11_continue;
+          goto __pyx_L13;
+        }
+        __pyx_L13:;
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":88
- * # Rolling mean
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":133
+ *                     continue
  * 
- * cdef void _roll_mean(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
  */
+        __pyx_t_10 = __pyx_v_i;
+        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-static  void __pyx_f_7tseries__roll_mean(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_minp, int __pyx_v_N) {
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  int __pyx_v_nobs;
-  int __pyx_v_i;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  __Pyx_RefNannySetupContext("_roll_mean");
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":90
- * cdef void _roll_mean(double_t *input, double_t *output,
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
- *     cdef int nobs = 0, i
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":134
  * 
+ *                 idx = index[i]
+ *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-  __pyx_v_sum_x = 0;
+        __pyx_t_11 = __pyx_v_i;
+        if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_mapped_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_11, __pyx_bstride_0_mapped_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":91
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
- *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
- * 
- *     if minp > N:
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":135
+ *                 idx = index[i]
+ *                 key = mapped_index[i]
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-  __pyx_v_nobs = 0;
+        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        if (__pyx_t_2) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":93
- *     cdef int nobs = 0, i
- * 
- *     if minp > N:             # <<<<<<<<<<<<<<
- *         minp = N + 1
- * 
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":136
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":94
- * 
- *     if minp > N:
- *         minp = N + 1             # <<<<<<<<<<<<<<
- * 
- *     for i from 0 <= i < minp - 1:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":137
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-    __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L3;
-  }
-  __pyx_L3:;
+          __pyx_v_i += 1;
+          goto __pyx_L14;
+        }
+        /*else*/ {
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":96
- *         minp = N + 1
- * 
- *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":139
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
+ *         else:
+ *             members = <list> groups[key]
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+          goto __pyx_L12_break;
+        }
+        __pyx_L14:;
+        __pyx_L11_continue:;
+      }
+      __pyx_L12_break:;
+      goto __pyx_L10;
+    }
+    /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":97
- * 
- *     for i from 0 <= i < minp - 1:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         # Not NaN
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":141
+ *                     break
+ *         else:
+ *             members = <list> groups[key]             # <<<<<<<<<<<<<<
+ *             members.append(idx)
+ *             i += 1
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+      __pyx_t_3 = PyObject_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key); if (!__pyx_t_3) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_3)));
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = ((PyObject *)__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":100
- * 
- *         # Not NaN
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":142
+ *         else:
+ *             members = <list> groups[key]
+ *             members.append(idx)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+      if (unlikely(__pyx_v_members == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":101
- *         # Not NaN
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":143
+ *             members = <list> groups[key]
+ *             members.append(idx)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while null_mask[i] and i < length:
  */
-      __pyx_v_nobs += 1;
+      __pyx_v_i += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":102
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":144
+ *             members.append(idx)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while null_mask[i] and i < length:
+ *                 i += 1
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L6;
-    }
-    __pyx_L6:;
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":104
- *             sum_x += val
- * 
- *         output[i] = NaN             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":145
+ *             i += 1
+ *             curKey = key
+ *             while null_mask[i] and i < length:             # <<<<<<<<<<<<<<
+ *                 i += 1
  * 
- *     for i from minp - 1 <= i < N:
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-  }
+      while (1) {
+        __pyx_t_12 = __pyx_v_i;
+        if (__pyx_t_12 < 0) __pyx_t_12 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_12, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
+          __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+          __pyx_t_13 = __pyx_t_2;
+        } else {
+          __pyx_t_13 = __pyx_t_9;
+        }
+        if (!__pyx_t_13) break;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":106
- *         output[i] = NaN
- * 
- *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i]
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":146
+ *             curKey = key
+ *             while null_mask[i] and i < length:
+ *                 i += 1             # <<<<<<<<<<<<<<
  * 
+ *             while i < length:
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+        __pyx_v_i += 1;
+      }
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":107
- * 
- *     for i from minp - 1 <= i < N:
- *         val = input[i]             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":148
+ *                 i += 1
  * 
- *         if i > win - 1:
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 if null_mask[i]:
+ *                     i += 1
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+      while (1) {
+        __pyx_t_13 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_13) break;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":109
- *         val = input[i]
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":149
  * 
- *         if i > win - 1:             # <<<<<<<<<<<<<<
- *             prev = input[i - win]
- *             if prev == prev:
+ *             while i < length:
+ *                 if null_mask[i]:             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                     continue
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+        __pyx_t_14 = __pyx_v_i;
+        if (__pyx_t_14 < 0) __pyx_t_14 += __pyx_bshape_0_null_mask;
+        __pyx_t_9 = (*__Pyx_BufPtrStrided1d(npy_int8 *, __pyx_bstruct_null_mask.buf, __pyx_t_14, __pyx_bstride_0_null_mask));
+        if (__pyx_t_9) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":110
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":150
+ *             while i < length:
+ *                 if null_mask[i]:
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                     continue
  * 
- *         if i > win - 1:
- *             prev = input[i - win]             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 sum_x -= prev
- */
-      __pyx_v_prev = (__pyx_v_input[(__pyx_v_i - __pyx_v_win)]);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":111
- *         if i > win - 1:
- *             prev = input[i - win]
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 sum_x -= prev
- *                 nobs -= 1
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+          __pyx_v_i += 1;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":112
- *             prev = input[i - win]
- *             if prev == prev:
- *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":151
+ *                 if null_mask[i]:
+ *                     i += 1
+ *                     continue             # <<<<<<<<<<<<<<
  * 
+ *                 idx = index[i]
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+          goto __pyx_L17_continue;
+          goto __pyx_L19;
+        }
+        __pyx_L19:;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":113
- *             if prev == prev:
- *                 sum_x -= prev
- *                 nobs -= 1             # <<<<<<<<<<<<<<
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":153
+ *                     continue
  * 
- *         if val == val:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L10;
-      }
-      __pyx_L10:;
-      goto __pyx_L9;
-    }
-    __pyx_L9:;
+        __pyx_t_15 = __pyx_v_i;
+        if (__pyx_t_15 < 0) __pyx_t_15 += __pyx_bshape_0_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_15, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":115
- *                 nobs -= 1
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":154
  * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+ *                 idx = index[i]
+ *                 key = mapped_index[i]             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+        __pyx_t_16 = __pyx_v_i;
+        if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_bshape_0_mapped_index;
+        __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_mapped_index.buf, __pyx_t_16, __pyx_bstride_0_mapped_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_3);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_3;
+        __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":116
- * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":155
+ *                 idx = index[i]
+ *                 key = mapped_index[i]
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-      __pyx_v_nobs += 1;
+        __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_13 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        if (__pyx_t_13) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":117
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         if nobs >= minp:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":156
+ *                 key = mapped_index[i]
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L11;
-    }
-    __pyx_L11:;
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_17 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_17 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":119
- *             sum_x += val
- * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = sum_x / nobs
- *         else:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":157
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+          __pyx_v_i += 1;
+          goto __pyx_L20;
+        }
+        /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":120
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":159
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
  * 
- *         if nobs >= minp:
- *             output[i] = sum_x / nobs             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
+ *     return groups
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+          goto __pyx_L18_break;
+        }
+        __pyx_L20:;
+        __pyx_L17_continue:;
       }
-      (__pyx_v_output[__pyx_v_i]) = (__pyx_v_sum_x / __pyx_v_nobs);
-      goto __pyx_L12;
+      __pyx_L18_break:;
     }
-    /*else*/ {
+    __pyx_L10:;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":122
- *             output[i] = sum_x / nobs
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":161
+ *                     break
+ * 
+ *     return groups             # <<<<<<<<<<<<<<
  * 
- * def _roll_mean_noncontig(ndarray[double_t, ndim=1] input,
+ * @cython.boundscheck(False)
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L12:;
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
+  __pyx_r = ((PyObject *)__pyx_v_groups);
+  goto __pyx_L0;
 
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries._roll_mean");
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.groupby_withnull");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_null_mask);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_mapped_index);
+  __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_groups);
+  __Pyx_DECREF(__pyx_v_idx);
+  __Pyx_DECREF(__pyx_v_curKey);
+  __Pyx_DECREF(__pyx_v_key);
+  __Pyx_DECREF(__pyx_v_members);
+  __Pyx_XDECREF((PyObject *)__pyx_v_mapped_index);
+  __Pyx_XDECREF((PyObject *)__pyx_v_null_mask);
+  __Pyx_DECREF(__pyx_v_bool_mask);
+  __Pyx_DECREF(__pyx_v_null_values);
+  __Pyx_DECREF((PyObject *)__pyx_v_index);
+  __Pyx_DECREF(__pyx_v_keyfunc);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":124
- *             output[i] = NaN
+/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":164
  * 
- * def _roll_mean_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                          ndarray[double_t, ndim=1] output,
- *                          int win, int minp, int N):
+ * @cython.boundscheck(False)
+ * def groupby(ndarray[object, ndim = 1] index, object keyfunc):             # <<<<<<<<<<<<<<
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]
  */
 
-static PyObject *__pyx_pf_7tseries__roll_mean_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_mean_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
-  int __pyx_v_win;
-  int __pyx_v_minp;
-  int __pyx_v_N;
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  int __pyx_v_nobs;
+static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_groupby(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyObject *__pyx_v_keyfunc = 0;
+  PyObject *__pyx_v_groups;
+  int __pyx_v_length;
+  PyObject *__pyx_v_idx;
+  PyObject *__pyx_v_curKey;
+  PyObject *__pyx_v_key;
+  PyObject *__pyx_v_members;
   int __pyx_v_i;
-  Py_buffer __pyx_bstruct_output;
-  Py_ssize_t __pyx_bstride_0_output = 0;
-  Py_ssize_t __pyx_bshape_0_output = 0;
-  Py_buffer __pyx_bstruct_input;
-  Py_ssize_t __pyx_bstride_0_input = 0;
-  Py_ssize_t __pyx_bshape_0_input = 0;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
   int __pyx_t_5;
   int __pyx_t_6;
-  int __pyx_t_7;
+  PyObject *__pyx_t_7;
   int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__minp,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_mean_noncontig");
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__keyfunc,0};
+  __Pyx_RefNannySetupContext("groupby");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[5] = {0,0,0,0,0};
+    PyObject* values[2] = {0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -7795,656 +5599,529 @@ static PyObject *__pyx_pf_7tseries__roll_mean_noncontig(PyObject *__pyx_self, Py
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_mean_noncontig", 1, 5, 5, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_mean_noncontig", 1, 5, 5, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_mean_noncontig", 1, 5, 5, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_mean_noncontig", 1, 5, 5, 4); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupby", 1, 2, 2, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_mean_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupby") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[4]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_keyfunc = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_mean_noncontig", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("groupby", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_mean_noncontig");
+  __Pyx_AddTraceback("tseries.groupby");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
-  __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 125; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
-  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+  __Pyx_INCREF((PyObject *)__pyx_v_index);
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_bstruct_index.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":127
- *                          ndarray[double_t, ndim=1] output,
- *                          int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
- *     cdef int nobs = 0, i
- * 
- */
-  __pyx_v_sum_x = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":128
- *                          int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0
- *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
- * 
- *     if minp > N:
- */
-  __pyx_v_nobs = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":130
- *     cdef int nobs = 0, i
- * 
- *     if minp > N:             # <<<<<<<<<<<<<<
- *         minp = N + 1
- * 
- */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":131
- * 
- *     if minp > N:
- *         minp = N + 1             # <<<<<<<<<<<<<<
- * 
- *     for i from 0 <= i < minp - 1:
- */
-    __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":133
- *         minp = N + 1
- * 
- *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
- */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":134
- * 
- *     for i from 0 <= i < minp - 1:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         # Not NaN
- */
-    __pyx_t_3 = __pyx_v_i;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_3, __pyx_bstride_0_input));
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":137
- * 
- *         # Not NaN
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
- */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":138
- *         # Not NaN
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- * 
- */
-      __pyx_v_nobs += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":139
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- * 
- *         output[i] = NaN
- */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L9;
-    }
-    __pyx_L9:;
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":141
- *             sum_x += val
- * 
- *         output[i] = NaN             # <<<<<<<<<<<<<<
- * 
- *     for i from minp - 1 <= i < N:
- */
-    __pyx_t_4 = __pyx_v_i;
-    __pyx_t_5 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_5 = 0;
-    if (unlikely(__pyx_t_5 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_5);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 164; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":143
- *         output[i] = NaN
- * 
- *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
- */
-  __pyx_t_5 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_5; __pyx_v_i++) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":144
- * 
- *     for i from minp - 1 <= i < N:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         if i > win - 1:
- */
-    __pyx_t_6 = __pyx_v_i;
-    __pyx_t_7 = -1;
-    if (__pyx_t_6 < 0) {
-      __pyx_t_6 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input));
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":146
- *         val = input[i]
- * 
- *         if i > win - 1:             # <<<<<<<<<<<<<<
- *             prev = input[i - win]
- *             if prev == prev:
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":166
+ * def groupby(ndarray[object, ndim = 1] index, object keyfunc):
+ *     cdef dict groups
+ *     cdef int length = index.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef object idx
+ *     cdef object curKey, key
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+  __pyx_v_length = (__pyx_v_index->dimensions[0]);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":147
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":171
+ *     cdef list members
  * 
- *         if i > win - 1:
- *             prev = input[i - win]             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 sum_x -= prev
- */
-      __pyx_t_7 = (__pyx_v_i - __pyx_v_win);
-      __pyx_t_8 = -1;
-      if (__pyx_t_7 < 0) {
-        __pyx_t_7 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-      } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_8 = 0;
-      if (unlikely(__pyx_t_8 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_8);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 147; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":148
- *         if i > win - 1:
- *             prev = input[i - win]
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 sum_x -= prev
- *                 nobs -= 1
+ *     groups = PyDict_New()             # <<<<<<<<<<<<<<
+ * 
+ *     if length != index.shape[0]:
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
+  __pyx_v_groups = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":149
- *             prev = input[i - win]
- *             if prev == prev:
- *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":173
+ *     groups = PyDict_New()
+ * 
+ *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
+ *         raise Exception('Dates and values were not the same length!')
  * 
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
+  if (__pyx_t_2) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":150
- *             if prev == prev:
- *                 sum_x -= prev
- *                 nobs -= 1             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":174
  * 
- *         if val == val:
+ *     if length != index.shape[0]:
+ *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int i = 0
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L13;
-      }
-      __pyx_L13:;
-      goto __pyx_L12;
-    }
-    __pyx_L12:;
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_4));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_Raise(__pyx_t_3, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    goto __pyx_L6;
+  }
+  __pyx_L6:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":152
- *                 nobs -= 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":176
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
+ *     idx = index[i]
+ *     key = keyfunc(idx)
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+  __pyx_v_i = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":153
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":177
  * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
+ *     cdef int i = 0
+ *     idx = index[i]             # <<<<<<<<<<<<<<
+ *     key = keyfunc(idx)
  * 
  */
-      __pyx_v_nobs += 1;
+  __pyx_t_4 = __pyx_v_i;
+  if (__pyx_t_4 < 0) __pyx_t_4 += __pyx_bshape_0_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_4, __pyx_bstride_0_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_idx);
+  __pyx_v_idx = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":154
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":178
+ *     cdef int i = 0
+ *     idx = index[i]
+ *     key = keyfunc(idx)             # <<<<<<<<<<<<<<
  * 
- *         if nobs >= minp:
+ *     # Algorithm notes
  */
-      __pyx_v_sum_x += __pyx_v_val;
-      goto __pyx_L14;
-    }
-    __pyx_L14:;
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(__pyx_v_idx);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_idx);
+  __Pyx_GIVEREF(__pyx_v_idx);
+  __pyx_t_1 = PyObject_Call(__pyx_v_keyfunc, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 178; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_v_key);
+  __pyx_v_key = __pyx_t_1;
+  __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":156
- *             sum_x += val
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":183
+ *     #   - Tries to reduce the number of calls to PyDict_GetItem, 'lazily' evaluates
  * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = sum_x / nobs
- *         else:
+ *     while i < length:             # <<<<<<<<<<<<<<
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+  while (1) {
+    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+    if (!__pyx_t_2) break;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":157
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":184
  * 
- *         if nobs >= minp:
- *             output[i] = sum_x / nobs             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_t_8 = __pyx_v_i;
-      __pyx_t_9 = -1;
-      if (__pyx_t_8 < 0) {
-        __pyx_t_8 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
-      } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
-      if (unlikely(__pyx_t_9 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = (__pyx_v_sum_x / __pyx_v_nobs);
-      goto __pyx_L15;
-    }
-    /*else*/ {
+    __pyx_t_5 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = (!__pyx_t_5);
+    if (__pyx_t_2) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":159
- *             output[i] = sum_x / nobs
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
- * 
- * #-------------------------------------------------------------------------------
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":185
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]             # <<<<<<<<<<<<<<
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
  */
-      __pyx_t_9 = __pyx_v_i;
-      __pyx_t_10 = -1;
-      if (__pyx_t_9 < 0) {
-        __pyx_t_9 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
-      } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_output)) __pyx_t_10 = 0;
-      if (unlikely(__pyx_t_10 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_10);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 159; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_9, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L15:;
-  }
+      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+      __Pyx_INCREF(__pyx_v_idx);
+      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_idx);
+      __Pyx_GIVEREF(__pyx_v_idx);
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = __pyx_t_1;
+      __pyx_t_1 = 0;
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_mean_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":186
+ *         if not PyDict_Contains(groups, key):
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
+ */
+      __pyx_t_5 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":164
- * # Exponentially weighted moving average
- * 
- * cdef void _ewma(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                       int com, int N):
- *     cdef double cur, prev, neww, oldw, adj
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":187
+ *             members = [idx]
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
+      __pyx_v_i += 1;
 
-static  void __pyx_f_7tseries__ewma(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_com, int __pyx_v_N) {
-  double __pyx_v_cur;
-  double __pyx_v_prev;
-  double __pyx_v_neww;
-  double __pyx_v_oldw;
-  double __pyx_v_adj;
-  int __pyx_v_i;
-  double __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  __pyx_t_5numpy_double_t __pyx_t_4;
-  __Pyx_RefNannySetupContext("_ewma");
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":188
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 idx = index[i]
+ */
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":169
- *     cdef int i
- * 
- *     neww = 1. / (1. + com)             # <<<<<<<<<<<<<<
- *     oldw = 1. - neww
- *     adj = oldw
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":189
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
  */
-  __pyx_t_1 = (1.0 + __pyx_v_com);
-  if (unlikely(__pyx_t_1 == 0)) {
-    PyErr_Format(PyExc_ZeroDivisionError, "float division");
-    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_v_neww = (1.0 / __pyx_t_1);
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":170
- * 
- *     neww = 1. / (1. + com)
- *     oldw = 1. - neww             # <<<<<<<<<<<<<<
- *     adj = oldw
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":190
+ *             curKey = key
+ *             while i < length:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
+ */
+        __pyx_t_5 = __pyx_v_i;
+        if (__pyx_t_5 < 0) __pyx_t_5 += __pyx_bshape_0_index;
+        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_5, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_1;
+        __pyx_t_1 = 0;
+
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":191
+ *             while i < length:
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-  __pyx_v_oldw = (1.0 - __pyx_v_neww);
+        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":171
- *     neww = 1. / (1. + com)
- *     oldw = 1. - neww
- *     adj = oldw             # <<<<<<<<<<<<<<
- * 
- *     output[0] = neww * input[0]
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":192
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-  __pyx_v_adj = __pyx_v_oldw;
+        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 192; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        if (__pyx_t_2) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":173
- *     adj = oldw
- * 
- *     output[0] = neww * input[0]             # <<<<<<<<<<<<<<
- * 
- *     for i from 1 <= i < N:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":193
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-  (__pyx_v_output[0]) = (__pyx_v_neww * (__pyx_v_input[0]));
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_6 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 193; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":175
- *     output[0] = neww * input[0]
- * 
- *     for i from 1 <= i < N:             # <<<<<<<<<<<<<<
- *         cur = input[i]
- *         prev = output[i - 1]
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":194
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-  __pyx_t_2 = __pyx_v_N;
-  for (__pyx_v_i = 1; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+          __pyx_v_i += 1;
+          goto __pyx_L12;
+        }
+        /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":176
- * 
- *     for i from 1 <= i < N:
- *         cur = input[i]             # <<<<<<<<<<<<<<
- *         prev = output[i - 1]
- * 
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":196
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
  */
-    __pyx_v_cur = (__pyx_v_input[__pyx_v_i]);
+          goto __pyx_L11_break;
+        }
+        __pyx_L12:;
+      }
+      __pyx_L11_break:;
+      goto __pyx_L9;
+    }
+    /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":177
- *     for i from 1 <= i < N:
- *         cur = input[i]
- *         prev = output[i - 1]             # <<<<<<<<<<<<<<
- * 
- *         if cur == cur:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":198
+ *                     break
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
+ *             members.append(idx)
+ *             i += 1
  */
-    __pyx_v_prev = (__pyx_v_output[(__pyx_v_i - 1)]);
+      __pyx_t_7 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
+      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_7)));
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = ((PyObject *)__pyx_t_7);
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":179
- *         prev = output[i - 1]
- * 
- *         if cur == cur:             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 output[i] = oldw * prev + neww * cur
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":199
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(idx)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
  */
-    __pyx_t_3 = (__pyx_v_cur == __pyx_v_cur);
-    if (__pyx_t_3) {
+      if (unlikely(__pyx_v_members == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_6 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 199; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":180
- * 
- *         if cur == cur:
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 output[i] = oldw * prev + neww * cur
- *             else:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":200
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(idx)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
-      __pyx_t_3 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_3) {
+      __pyx_v_i += 1;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":181
- *         if cur == cur:
- *             if prev == prev:
- *                 output[i] = oldw * prev + neww * cur             # <<<<<<<<<<<<<<
- *             else:
- *                 output[i] = neww * cur
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":201
+ *             members.append(idx)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 idx = index[i]
  */
-        (__pyx_v_output[__pyx_v_i]) = ((__pyx_v_oldw * __pyx_v_prev) + (__pyx_v_neww * __pyx_v_cur));
-        goto __pyx_L6;
-      }
-      /*else*/ {
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":183
- *                 output[i] = oldw * prev + neww * cur
- *             else:
- *                 output[i] = neww * cur             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = prev
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":202
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
  */
-        (__pyx_v_output[__pyx_v_i]) = (__pyx_v_neww * __pyx_v_cur);
-      }
-      __pyx_L6:;
-      goto __pyx_L5;
-    }
-    /*else*/ {
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":185
- *                 output[i] = neww * cur
- *         else:
- *             output[i] = prev             # <<<<<<<<<<<<<<
- * 
- *     for i from 0 <= i < N:
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":203
+ *             curKey = key
+ *             while i < length:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_prev;
-    }
-    __pyx_L5:;
-  }
+        __pyx_t_6 = __pyx_v_i;
+        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_index;
+        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_6, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":187
- *             output[i] = prev
- * 
- *     for i from 0 <= i < N:             # <<<<<<<<<<<<<<
- *         cur = input[i]
- *         output[i] = output[i] / (1. - adj)
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":204
+ *             while i < length:
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(idx)
  */
-  __pyx_t_2 = __pyx_v_N;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":188
- * 
- *     for i from 0 <= i < N:
- *         cur = input[i]             # <<<<<<<<<<<<<<
- *         output[i] = output[i] / (1. - adj)
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":205
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(idx)
+ *                     i += 1
  */
-    __pyx_v_cur = (__pyx_v_input[__pyx_v_i]);
+        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        if (__pyx_t_2) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":189
- *     for i from 0 <= i < N:
- *         cur = input[i]
- *         output[i] = output[i] / (1. - adj)             # <<<<<<<<<<<<<<
- * 
- *         if cur == cur:
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":206
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
+ *                     members.append(idx)             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-    __pyx_t_4 = (__pyx_v_output[__pyx_v_i]);
-    __pyx_t_1 = (1.0 - __pyx_v_adj);
-    if (unlikely(__pyx_t_1 == 0)) {
-      PyErr_Format(PyExc_ZeroDivisionError, "float division");
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 189; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    (__pyx_v_output[__pyx_v_i]) = (__pyx_t_4 / __pyx_t_1);
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_8 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_v_idx); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":191
- *         output[i] = output[i] / (1. - adj)
- * 
- *         if cur == cur:             # <<<<<<<<<<<<<<
- *             adj *= oldw
- * 
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":207
+ *                 if key == curKey:
+ *                     members.append(idx)
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-    __pyx_t_3 = (__pyx_v_cur == __pyx_v_cur);
-    if (__pyx_t_3) {
+          __pyx_v_i += 1;
+          goto __pyx_L15;
+        }
+        /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":192
- * 
- *         if cur == cur:
- *             adj *= oldw             # <<<<<<<<<<<<<<
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":209
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
  * 
- * def _ewma_noncontig(ndarray[double_t, ndim=1] input,
+ *     return groups
  */
-      __pyx_v_adj *= __pyx_v_oldw;
-      goto __pyx_L9;
+          goto __pyx_L14_break;
+        }
+        __pyx_L15:;
+      }
+      __pyx_L14_break:;
     }
     __pyx_L9:;
   }
 
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":211
+ *                     break
+ * 
+ *     return groups             # <<<<<<<<<<<<<<
+ * 
+ * @cython.boundscheck(False)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
+  __pyx_r = ((PyObject *)__pyx_v_groups);
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries._ewma");
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.groupby");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_groups);
+  __Pyx_DECREF(__pyx_v_idx);
+  __Pyx_DECREF(__pyx_v_curKey);
+  __Pyx_DECREF(__pyx_v_key);
+  __Pyx_DECREF(__pyx_v_members);
+  __Pyx_DECREF((PyObject *)__pyx_v_index);
+  __Pyx_DECREF(__pyx_v_keyfunc);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":194
- *             adj *= oldw
+/* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":214
  * 
- * def _ewma_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                           ndarray[double_t, ndim=1] output,
- *                           int com, int N):
+ * @cython.boundscheck(False)
+ * def groupbyfunc(ndarray[object, ndim = 1] index,             # <<<<<<<<<<<<<<
+ *                 ndarray[npy_float64, ndim = 1] values,
+ *                 object keyfunc, object applyfunc):
  */
 
-static PyObject *__pyx_pf_7tseries__ewma_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__ewma_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
-  int __pyx_v_com;
-  int __pyx_v_N;
-  double __pyx_v_cur;
-  double __pyx_v_prev;
-  double __pyx_v_neww;
-  double __pyx_v_oldw;
-  double __pyx_v_adj;
+static PyObject *__pyx_pf_7tseries_groupbyfunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static char __pyx_doc_7tseries_groupbyfunc[] = "\n    Doing this proper in Cython\n    Not sure how much it will really speed things up\n    ";
+static PyObject *__pyx_pf_7tseries_groupbyfunc(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_index = 0;
+  PyArrayObject *__pyx_v_values = 0;
+  PyObject *__pyx_v_keyfunc = 0;
+  PyObject *__pyx_v_applyfunc = 0;
+  PyObject *__pyx_v_groups;
+  int __pyx_v_length;
+  PyObject *__pyx_v_idx;
+  PyObject *__pyx_v_curKey;
+  PyObject *__pyx_v_key;
+  PyObject *__pyx_v_members;
+  PyObject *__pyx_v_grouplist;
   int __pyx_v_i;
-  Py_buffer __pyx_bstruct_output;
-  Py_ssize_t __pyx_bstride_0_output = 0;
-  Py_ssize_t __pyx_bshape_0_output = 0;
-  Py_buffer __pyx_bstruct_input;
-  Py_ssize_t __pyx_bstride_0_input = 0;
-  Py_ssize_t __pyx_bshape_0_input = 0;
+  Py_buffer __pyx_bstruct_index;
+  Py_ssize_t __pyx_bstride_0_index = 0;
+  Py_ssize_t __pyx_bshape_0_index = 0;
+  Py_buffer __pyx_bstruct_values;
+  Py_ssize_t __pyx_bstride_0_values = 0;
+  Py_ssize_t __pyx_bshape_0_values = 0;
   PyObject *__pyx_r = NULL;
-  double __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  long __pyx_t_4;
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
   int __pyx_t_5;
   int __pyx_t_6;
-  long __pyx_t_7;
+  int __pyx_t_7;
   int __pyx_t_8;
-  int __pyx_t_9;
+  PyObject *__pyx_t_9;
   int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_t_12;
-  int __pyx_t_13;
-  __pyx_t_5numpy_double_t __pyx_t_14;
+  Py_ssize_t __pyx_t_13;
+  PyObject *__pyx_t_14 = NULL;
   int __pyx_t_15;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__com,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_ewma_noncontig");
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__index,&__pyx_n_s__values,&__pyx_n_s__keyfunc,&__pyx_n_s__applyfunc,0};
+  __Pyx_RefNannySetupContext("groupbyfunc");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
@@ -8459,696 +6136,647 @@ static PyObject *__pyx_pf_7tseries__ewma_noncontig(PyObject *__pyx_self, PyObjec
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__index);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__values);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_ewma_noncontig", 1, 4, 4, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 1); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__com);
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__keyfunc);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_ewma_noncontig", 1, 4, 4, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 2); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
+      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__applyfunc);
       if (likely(values[3])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_ewma_noncontig", 1, 4, 4, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, 3); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_ewma_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "groupbyfunc") < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_com = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_com == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = ((PyArrayObject *)values[0]);
+    __pyx_v_values = ((PyArrayObject *)values[1]);
+    __pyx_v_keyfunc = values[2];
+    __pyx_v_applyfunc = values[3];
   } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
     goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_com = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_com == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 196; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_index = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_values = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
+    __pyx_v_keyfunc = PyTuple_GET_ITEM(__pyx_args, 2);
+    __pyx_v_applyfunc = PyTuple_GET_ITEM(__pyx_args, 3);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_ewma_noncontig", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("groupbyfunc", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._ewma_noncontig");
+  __Pyx_AddTraceback("tseries.groupbyfunc");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
-  __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF((PyObject *)__pyx_v_index);
+  __Pyx_INCREF((PyObject *)__pyx_v_values);
+  __Pyx_INCREF(__pyx_v_keyfunc);
+  __Pyx_INCREF(__pyx_v_applyfunc);
+  __pyx_v_groups = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_idx = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_curKey = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_key = Py_None; __Pyx_INCREF(Py_None);
+  __pyx_v_members = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_v_grouplist = ((PyObject *)Py_None); __Pyx_INCREF(Py_None);
+  __pyx_bstruct_index.buf = NULL;
+  __pyx_bstruct_values.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_index), __pyx_ptype_5numpy_ndarray, 1, "index", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_values), __pyx_ptype_5numpy_ndarray, 1, "values", 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 215; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_index, (PyObject*)__pyx_v_index, &__Pyx_TypeInfo_object, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
-  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+  __pyx_bstride_0_index = __pyx_bstruct_index.strides[0];
+  __pyx_bshape_0_index = __pyx_bstruct_index.shape[0];
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 194; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":200
- *     cdef int i
- * 
- *     neww = 1. / (1. + com)             # <<<<<<<<<<<<<<
- *     oldw = 1. - neww
- *     adj = oldw
- */
-  __pyx_t_1 = (1.0 + __pyx_v_com);
-  if (unlikely(__pyx_t_1 == 0)) {
-    PyErr_Format(PyExc_ZeroDivisionError, "float division");
-    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 200; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_v_neww = (1.0 / __pyx_t_1);
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":201
- * 
- *     neww = 1. / (1. + com)
- *     oldw = 1. - neww             # <<<<<<<<<<<<<<
- *     adj = oldw
- * 
- */
-  __pyx_v_oldw = (1.0 - __pyx_v_neww);
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":202
- *     neww = 1. / (1. + com)
- *     oldw = 1. - neww
- *     adj = oldw             # <<<<<<<<<<<<<<
- * 
- *     output[0] = neww * input[0]
- */
-  __pyx_v_adj = __pyx_v_oldw;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":204
- *     adj = oldw
- * 
- *     output[0] = neww * input[0]             # <<<<<<<<<<<<<<
- * 
- *     for i from 1 <= i < N:
- */
-  __pyx_t_2 = 0;
-  __pyx_t_3 = -1;
-  if (__pyx_t_2 < 0) {
-    __pyx_t_2 += __pyx_bshape_0_input;
-    if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
-  } else if (unlikely(__pyx_t_2 >= __pyx_bshape_0_input)) __pyx_t_3 = 0;
-  if (unlikely(__pyx_t_3 != -1)) {
-    __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_4 = 0;
-  __pyx_t_3 = -1;
-  if (__pyx_t_4 < 0) {
-    __pyx_t_4 += __pyx_bshape_0_output;
-    if (unlikely(__pyx_t_4 < 0)) __pyx_t_3 = 0;
-  } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_3 = 0;
-  if (unlikely(__pyx_t_3 != -1)) {
-    __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_values, (PyObject*)__pyx_v_values, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = (__pyx_v_neww * (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_2, __pyx_bstride_0_input)));
+  __pyx_bstride_0_values = __pyx_bstruct_values.strides[0];
+  __pyx_bshape_0_values = __pyx_bstruct_values.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":206
- *     output[0] = neww * input[0]
- * 
- *     for i from 1 <= i < N:             # <<<<<<<<<<<<<<
- *         cur = input[i]
- *         prev = output[i - 1]
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":222
+ *     '''
+ *     cdef dict groups
+ *     cdef int length = values.shape[0]             # <<<<<<<<<<<<<<
+ *     cdef object idx
+ *     cdef object curKey, key
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = 1; __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_v_length = (__pyx_v_values->dimensions[0]);
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":207
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":227
+ *     cdef list members, grouplist
  * 
- *     for i from 1 <= i < N:
- *         cur = input[i]             # <<<<<<<<<<<<<<
- *         prev = output[i - 1]
+ *     groups = PyDict_New()             # <<<<<<<<<<<<<<
  * 
+ *     if length != index.shape[0]:
  */
-    __pyx_t_5 = __pyx_v_i;
-    __pyx_t_6 = -1;
-    if (__pyx_t_5 < 0) {
-      __pyx_t_5 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_5 < 0)) __pyx_t_6 = 0;
-    } else if (unlikely(__pyx_t_5 >= __pyx_bshape_0_input)) __pyx_t_6 = 0;
-    if (unlikely(__pyx_t_6 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_6);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_5, __pyx_bstride_0_input));
+  __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(PyDict_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected dict, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_groups));
+  __pyx_v_groups = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":208
- *     for i from 1 <= i < N:
- *         cur = input[i]
- *         prev = output[i - 1]             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":229
+ *     groups = PyDict_New()
  * 
- *         if cur == cur:
- */
-    __pyx_t_7 = (__pyx_v_i - 1);
-    __pyx_t_6 = -1;
-    if (__pyx_t_7 < 0) {
-      __pyx_t_7 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_7 < 0)) __pyx_t_6 = 0;
-    } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_output)) __pyx_t_6 = 0;
-    if (unlikely(__pyx_t_6 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_6);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_7, __pyx_bstride_0_output));
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":210
- *         prev = output[i - 1]
+ *     if length != index.shape[0]:             # <<<<<<<<<<<<<<
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *         if cur == cur:             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 output[i] = oldw * prev + neww * cur
  */
-    __pyx_t_8 = (__pyx_v_cur == __pyx_v_cur);
-    if (__pyx_t_8) {
+  __pyx_t_2 = (__pyx_v_length != (__pyx_v_index->dimensions[0]));
+  if (__pyx_t_2) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":211
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":230
  * 
- *         if cur == cur:
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 output[i] = oldw * prev + neww * cur
- *             else:
- */
-      __pyx_t_8 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_8) {
-
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":212
- *         if cur == cur:
- *             if prev == prev:
- *                 output[i] = oldw * prev + neww * cur             # <<<<<<<<<<<<<<
- *             else:
- *                 output[i] = neww * cur
- */
-        __pyx_t_6 = __pyx_v_i;
-        __pyx_t_9 = -1;
-        if (__pyx_t_6 < 0) {
-          __pyx_t_6 += __pyx_bshape_0_output;
-          if (unlikely(__pyx_t_6 < 0)) __pyx_t_9 = 0;
-        } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
-        if (unlikely(__pyx_t_9 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_9);
-          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_6, __pyx_bstride_0_output) = ((__pyx_v_oldw * __pyx_v_prev) + (__pyx_v_neww * __pyx_v_cur));
-        goto __pyx_L9;
-      }
-      /*else*/ {
-
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":214
- *                 output[i] = oldw * prev + neww * cur
- *             else:
- *                 output[i] = neww * cur             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = prev
- */
-        __pyx_t_9 = __pyx_v_i;
-        __pyx_t_10 = -1;
-        if (__pyx_t_9 < 0) {
-          __pyx_t_9 += __pyx_bshape_0_output;
-          if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
-        } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_output)) __pyx_t_10 = 0;
-        if (unlikely(__pyx_t_10 != -1)) {
-          __Pyx_RaiseBufferIndexError(__pyx_t_10);
-          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-        }
-        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_9, __pyx_bstride_0_output) = (__pyx_v_neww * __pyx_v_cur);
-      }
-      __pyx_L9:;
-      goto __pyx_L8;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":216
- *                 output[i] = neww * cur
- *         else:
- *             output[i] = prev             # <<<<<<<<<<<<<<
+ *     if length != index.shape[0]:
+ *         raise Exception('Dates and values were not the same length!')             # <<<<<<<<<<<<<<
  * 
- *     for i from 0 <= i < N:
+ *     cdef int i = 0
  */
-      __pyx_t_10 = __pyx_v_i;
-      __pyx_t_11 = -1;
-      if (__pyx_t_10 < 0) {
-        __pyx_t_10 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
-      } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
-      if (unlikely(__pyx_t_11 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 216; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_prev;
-    }
-    __pyx_L8:;
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_4));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_4));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_4));
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_Raise(__pyx_t_3, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    {__pyx_filename = __pyx_f[5]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    goto __pyx_L6;
   }
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":218
- *             output[i] = prev
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":232
+ *         raise Exception('Dates and values were not the same length!')
  * 
- *     for i from 0 <= i < N:             # <<<<<<<<<<<<<<
- *         cur = input[i]
- *         output[i] = output[i] / (1. - adj)
+ *     cdef int i = 0             # <<<<<<<<<<<<<<
+ *     idx = index[i]
+ *     key = trycall(keyfunc, idx)
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_v_i = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":219
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":233
  * 
- *     for i from 0 <= i < N:
- *         cur = input[i]             # <<<<<<<<<<<<<<
- *         output[i] = output[i] / (1. - adj)
+ *     cdef int i = 0
+ *     idx = index[i]             # <<<<<<<<<<<<<<
+ *     key = trycall(keyfunc, idx)
  * 
  */
-    __pyx_t_11 = __pyx_v_i;
-    __pyx_t_12 = -1;
-    if (__pyx_t_11 < 0) {
-      __pyx_t_11 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
-    } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_input)) __pyx_t_12 = 0;
-    if (unlikely(__pyx_t_12 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_11, __pyx_bstride_0_input));
+  __pyx_t_4 = __pyx_v_i;
+  if (__pyx_t_4 < 0) __pyx_t_4 += __pyx_bshape_0_index;
+  __pyx_t_3 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_4, __pyx_bstride_0_index);
+  __Pyx_INCREF((PyObject*)__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_idx);
+  __pyx_v_idx = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":220
- *     for i from 0 <= i < N:
- *         cur = input[i]
- *         output[i] = output[i] / (1. - adj)             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":234
+ *     cdef int i = 0
+ *     idx = index[i]
+ *     key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
  * 
- *         if cur == cur:
+ *     # Algorithm notes
  */
-    __pyx_t_12 = __pyx_v_i;
-    __pyx_t_13 = -1;
-    if (__pyx_t_12 < 0) {
-      __pyx_t_12 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
-    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_output)) __pyx_t_13 = 0;
-    if (unlikely(__pyx_t_13 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_t_14 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_12, __pyx_bstride_0_output));
-    __pyx_t_1 = (1.0 - __pyx_v_adj);
-    if (unlikely(__pyx_t_1 == 0)) {
-      PyErr_Format(PyExc_ZeroDivisionError, "float division");
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_t_13 = __pyx_v_i;
-    __pyx_t_15 = -1;
-    if (__pyx_t_13 < 0) {
-      __pyx_t_13 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_13 < 0)) __pyx_t_15 = 0;
-    } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_output)) __pyx_t_15 = 0;
-    if (unlikely(__pyx_t_15 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_15);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_13, __pyx_bstride_0_output) = (__pyx_t_14 / __pyx_t_1);
+  __pyx_t_3 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_v_key);
+  __pyx_v_key = __pyx_t_3;
+  __pyx_t_3 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":222
- *         output[i] = output[i] / (1. - adj)
- * 
- *         if cur == cur:             # <<<<<<<<<<<<<<
- *             adj *= oldw
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":240
+ *     #   'lazily' evaluates
  * 
+ *     while i < length:             # <<<<<<<<<<<<<<
+ *         if not PyDict_Contains(groups, key):
+ *             members = [values[i]]
  */
-    __pyx_t_8 = (__pyx_v_cur == __pyx_v_cur);
-    if (__pyx_t_8) {
+  while (1) {
+    __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+    if (!__pyx_t_2) break;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":223
- * 
- *         if cur == cur:
- *             adj *= oldw             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":241
  * 
- * #-------------------------------------------------------------------------------
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):             # <<<<<<<<<<<<<<
+ *             members = [values[i]]
+ *             PyDict_SetItem(groups, key, members)
  */
-      __pyx_v_adj *= __pyx_v_oldw;
-      goto __pyx_L12;
-    }
-    __pyx_L12:;
-  }
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._ewma_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+    __pyx_t_5 = PyDict_Contains(((PyObject *)__pyx_v_groups), __pyx_v_key); if (unlikely(__pyx_t_5 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 241; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = (!__pyx_t_5);
+    if (__pyx_t_2) {
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":228
- * # Rolling variance
- * 
- * cdef void _roll_var(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0, sum_xx = 0
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":242
+ *     while i < length:
+ *         if not PyDict_Contains(groups, key):
+ *             members = [values[i]]             # <<<<<<<<<<<<<<
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
  */
+      __pyx_t_5 = __pyx_v_i;
+      if (__pyx_t_5 < 0) __pyx_t_5 += __pyx_bshape_0_values;
+      __pyx_t_3 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_5, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 242; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+      PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
+      __Pyx_GIVEREF(__pyx_t_3);
+      __pyx_t_3 = 0;
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = __pyx_t_1;
+      __pyx_t_1 = 0;
 
-static  void __pyx_f_7tseries__roll_var(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_minp, int __pyx_v_N) {
-  double __pyx_v_val;
-  double __pyx_v_prev;
-  double __pyx_v_sum_x;
-  double __pyx_v_sum_xx;
-  int __pyx_v_nobs;
-  int __pyx_v_i;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  double __pyx_t_4;
-  int __pyx_t_5;
-  __Pyx_RefNannySetupContext("_roll_var");
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":243
+ *         if not PyDict_Contains(groups, key):
+ *             members = [values[i]]
+ *             PyDict_SetItem(groups, key, members)             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
+ */
+      __pyx_t_6 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, ((PyObject *)__pyx_v_members)); if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 243; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":230
- * cdef void _roll_var(double_t *input, double_t *output,
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0, sum_xx = 0             # <<<<<<<<<<<<<<
- *     cdef int nobs = 0, i
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":244
+ *             members = [values[i]]
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
-  __pyx_v_sum_x = 0;
-  __pyx_v_sum_xx = 0;
+      __pyx_v_i += 1;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":231
- *                     int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0, sum_xx = 0
- *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
- * 
- *     if minp > N:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":245
+ *             PyDict_SetItem(groups, key, members)
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 idx = index[i]
  */
-  __pyx_v_nobs = 0;
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":233
- *     cdef int nobs = 0, i
- * 
- *     if minp > N:             # <<<<<<<<<<<<<<
- *         minp = N + 1
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":246
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":234
- * 
- *     if minp > N:
- *         minp = N + 1             # <<<<<<<<<<<<<<
- * 
- *     for i from 0 <= i < minp - 1:
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":247
+ *             curKey = key
+ *             while i < length:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
  */
-    __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L3;
-  }
-  __pyx_L3:;
+        __pyx_t_6 = __pyx_v_i;
+        if (__pyx_t_6 < 0) __pyx_t_6 += __pyx_bshape_0_index;
+        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_6, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":236
- *         minp = N + 1
- * 
- *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":248
+ *             while i < length:
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(values[i])
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":237
- * 
- *     for i from 0 <= i < minp - 1:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         # Not NaN
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":249
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(values[i])
+ *                     i += 1
+ */
+        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        if (__pyx_t_2) {
+
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":250
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
+ *                     members.append(values[i])             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_7 = __pyx_v_i;
+          if (__pyx_t_7 < 0) __pyx_t_7 += __pyx_bshape_0_values;
+          __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_7, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+          __Pyx_GOTREF(__pyx_t_1);
+          __pyx_t_8 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_8 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":240
- * 
- *         # Not NaN
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":251
+ *                 if key == curKey:
+ *                     members.append(values[i])
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+          __pyx_v_i += 1;
+          goto __pyx_L12;
+        }
+        /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":241
- *         # Not NaN
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- *             sum_xx += val * val
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":253
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
  */
-      __pyx_v_nobs += 1;
+          goto __pyx_L11_break;
+        }
+        __pyx_L12:;
+      }
+      __pyx_L11_break:;
+      goto __pyx_L9;
+    }
+    /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":242
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- *             sum_xx += val * val
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":255
+ *                     break
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
+ *             members.append(values[i])
+ *             i += 1
  */
-      __pyx_v_sum_x += __pyx_v_val;
+      __pyx_t_9 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
+      __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_9)));
+      __Pyx_DECREF(((PyObject *)__pyx_v_members));
+      __pyx_v_members = ((PyObject *)__pyx_t_9);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":243
- *             nobs += 1
- *             sum_x += val
- *             sum_xx += val * val             # <<<<<<<<<<<<<<
- * 
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":256
+ *         else:
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(values[i])             # <<<<<<<<<<<<<<
+ *             i += 1
+ *             curKey = key
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
-      goto __pyx_L6;
-    }
-    __pyx_L6:;
+      if (unlikely(__pyx_v_members == Py_None)) {
+        PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+      }
+      __pyx_t_8 = __pyx_v_i;
+      if (__pyx_t_8 < 0) __pyx_t_8 += __pyx_bshape_0_values;
+      __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_8, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_10 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":245
- *             sum_xx += val * val
- * 
- *         output[i] = NaN             # <<<<<<<<<<<<<<
- * 
- *     for i from minp - 1 <= i < N:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":257
+ *             members = <list> PyDict_GetItem(groups, key)
+ *             members.append(values[i])
+ *             i += 1             # <<<<<<<<<<<<<<
+ *             curKey = key
+ *             while i < length:
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-  }
+      __pyx_v_i += 1;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":247
- *         output[i] = NaN
- * 
- *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i]
- * 
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":258
+ *             members.append(values[i])
+ *             i += 1
+ *             curKey = key             # <<<<<<<<<<<<<<
+ *             while i < length:
+ *                 idx = index[i]
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+      __Pyx_INCREF(__pyx_v_key);
+      __Pyx_DECREF(__pyx_v_curKey);
+      __pyx_v_curKey = __pyx_v_key;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":248
- * 
- *     for i from minp - 1 <= i < N:
- *         val = input[i]             # <<<<<<<<<<<<<<
- * 
- *         if i > win - 1:
+      /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":259
+ *             i += 1
+ *             curKey = key
+ *             while i < length:             # <<<<<<<<<<<<<<
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+      while (1) {
+        __pyx_t_2 = (__pyx_v_i < __pyx_v_length);
+        if (!__pyx_t_2) break;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":250
- *         val = input[i]
- * 
- *         if i > win - 1:             # <<<<<<<<<<<<<<
- *             prev = input[i - win]
- *             if prev == prev:
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":260
+ *             curKey = key
+ *             while i < length:
+ *                 idx = index[i]             # <<<<<<<<<<<<<<
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+        __pyx_t_10 = __pyx_v_i;
+        if (__pyx_t_10 < 0) __pyx_t_10 += __pyx_bshape_0_index;
+        __pyx_t_1 = *__Pyx_BufPtrStrided1d(PyObject **, __pyx_bstruct_index.buf, __pyx_t_10, __pyx_bstride_0_index);
+        __Pyx_INCREF((PyObject*)__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_idx);
+        __pyx_v_idx = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":251
- * 
- *         if i > win - 1:
- *             prev = input[i - win]             # <<<<<<<<<<<<<<
- *             if prev == prev:
- *                 sum_x -= prev
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":261
+ *             while i < length:
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)             # <<<<<<<<<<<<<<
+ *                 if key == curKey:
+ *                     members.append(values[i])
  */
-      __pyx_v_prev = (__pyx_v_input[(__pyx_v_i - __pyx_v_win)]);
+        __pyx_t_1 = __pyx_f_7tseries_trycall(__pyx_v_keyfunc, __pyx_v_idx); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_DECREF(__pyx_v_key);
+        __pyx_v_key = __pyx_t_1;
+        __pyx_t_1 = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":252
- *         if i > win - 1:
- *             prev = input[i - win]
- *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 sum_x -= prev
- *                 sum_xx -= prev * prev
+        /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":262
+ *                 idx = index[i]
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:             # <<<<<<<<<<<<<<
+ *                     members.append(values[i])
+ *                     i += 1
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+        __pyx_t_1 = PyObject_RichCompare(__pyx_v_key, __pyx_v_curKey, Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        if (__pyx_t_2) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":253
- *             prev = input[i - win]
- *             if prev == prev:
- *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 sum_xx -= prev * prev
- *                 nobs -= 1
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":263
+ *                 key = trycall(keyfunc, idx)
+ *                 if key == curKey:
+ *                     members.append(values[i])             # <<<<<<<<<<<<<<
+ *                     i += 1
+ *                 else:
  */
-        __pyx_v_sum_x -= __pyx_v_prev;
+          if (unlikely(__pyx_v_members == Py_None)) {
+            PyErr_SetString(PyExc_AttributeError, "'NoneType' object has no attribute 'append'"); {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;} 
+          }
+          __pyx_t_11 = __pyx_v_i;
+          if (__pyx_t_11 < 0) __pyx_t_11 += __pyx_bshape_0_values;
+          __pyx_t_1 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(npy_float64 *, __pyx_bstruct_values.buf, __pyx_t_11, __pyx_bstride_0_values))); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+          __Pyx_GOTREF(__pyx_t_1);
+          __pyx_t_12 = PyList_Append(((PyObject *)__pyx_v_members), __pyx_t_1); if (unlikely(__pyx_t_12 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":254
- *             if prev == prev:
- *                 sum_x -= prev
- *                 sum_xx -= prev * prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
- * 
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":264
+ *                 if key == curKey:
+ *                     members.append(values[i])
+ *                     i += 1             # <<<<<<<<<<<<<<
+ *                 else:
+ *                     break
  */
-        __pyx_v_sum_xx -= (__pyx_v_prev * __pyx_v_prev);
+          __pyx_v_i += 1;
+          goto __pyx_L15;
+        }
+        /*else*/ {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":255
- *                 sum_x -= prev
- *                 sum_xx -= prev * prev
- *                 nobs -= 1             # <<<<<<<<<<<<<<
+          /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":266
+ *                     i += 1
+ *                 else:
+ *                     break             # <<<<<<<<<<<<<<
  * 
- *         if val == val:
+ *     grouplist = PyDict_Keys(groups)
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L10;
+          goto __pyx_L14_break;
+        }
+        __pyx_L15:;
       }
-      __pyx_L10:;
-      goto __pyx_L9;
+      __pyx_L14_break:;
     }
     __pyx_L9:;
+  }
+
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":268
+ *                     break
+ * 
+ *     grouplist = PyDict_Keys(groups)             # <<<<<<<<<<<<<<
+ * 
+ *     i = 0
+ */
+  __pyx_t_1 = PyDict_Keys(((PyObject *)__pyx_v_groups)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(PyList_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected list, got %.200s", Py_TYPE(__pyx_t_1)->tp_name), 0))) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(((PyObject *)__pyx_v_grouplist));
+  __pyx_v_grouplist = ((PyObject *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":257
- *                 nobs -= 1
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":270
+ *     grouplist = PyDict_Keys(groups)
  * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             sum_x += val
+ *     i = 0             # <<<<<<<<<<<<<<
+ *     length = len(grouplist)
+ *     for i from 0 <= i < length:
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+  __pyx_v_i = 0;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":258
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":271
  * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             sum_x += val
- *             sum_xx += val * val
+ *     i = 0
+ *     length = len(grouplist)             # <<<<<<<<<<<<<<
+ *     for i from 0 <= i < length:
+ *         key = grouplist[i]
  */
-      __pyx_v_nobs += 1;
+  __pyx_t_13 = PyObject_Length(((PyObject *)__pyx_v_grouplist)); if (unlikely(__pyx_t_13 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_length = __pyx_t_13;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":259
- *         if val == val:
- *             nobs += 1
- *             sum_x += val             # <<<<<<<<<<<<<<
- *             sum_xx += val * val
- * 
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":272
+ *     i = 0
+ *     length = len(grouplist)
+ *     for i from 0 <= i < length:             # <<<<<<<<<<<<<<
+ *         key = grouplist[i]
+ *         members = <list> PyDict_GetItem(groups, key)
  */
-      __pyx_v_sum_x += __pyx_v_val;
+  __pyx_t_12 = __pyx_v_length;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_12; __pyx_v_i++) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":260
- *             nobs += 1
- *             sum_x += val
- *             sum_xx += val * val             # <<<<<<<<<<<<<<
- * 
- *         if nobs >= minp:
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":273
+ *     length = len(grouplist)
+ *     for i from 0 <= i < length:
+ *         key = grouplist[i]             # <<<<<<<<<<<<<<
+ *         members = <list> PyDict_GetItem(groups, key)
+ *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
-      goto __pyx_L11;
-    }
-    __pyx_L11:;
+    __pyx_t_1 = __Pyx_GetItemInt_List(((PyObject *)__pyx_v_grouplist), __pyx_v_i, sizeof(int), PyInt_FromLong); if (!__pyx_t_1) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_v_key);
+    __pyx_v_key = __pyx_t_1;
+    __pyx_t_1 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":262
- *             sum_xx += val * val
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":274
+ *     for i from 0 <= i < length:
+ *         key = grouplist[i]
+ *         members = <list> PyDict_GetItem(groups, key)             # <<<<<<<<<<<<<<
+ *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
  * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
- *         else:
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+    __pyx_t_9 = PyDict_GetItem(((PyObject *)__pyx_v_groups), __pyx_v_key);
+    __Pyx_INCREF(((PyObject *)((PyObject *)__pyx_t_9)));
+    __Pyx_DECREF(((PyObject *)__pyx_v_members));
+    __pyx_v_members = ((PyObject *)__pyx_t_9);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":263
+    /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":275
+ *         key = grouplist[i]
+ *         members = <list> PyDict_GetItem(groups, key)
+ *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))             # <<<<<<<<<<<<<<
  * 
- *         if nobs >= minp:
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
+ *     return groups
  */
-      __pyx_t_4 = ((__pyx_v_nobs * __pyx_v_sum_xx) - (__pyx_v_sum_x * __pyx_v_sum_x));
-      __pyx_t_5 = ((__pyx_v_nobs * __pyx_v_nobs) - __pyx_v_nobs);
-      if (unlikely(__pyx_t_5 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      (__pyx_v_output[__pyx_v_i]) = (__pyx_t_4 / __pyx_t_5);
-      goto __pyx_L12;
-    }
-    /*else*/ {
+    __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__asarray); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)__pyx_v_members));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_members));
+    __Pyx_GIVEREF(((PyObject *)__pyx_v_members));
+    __pyx_t_14 = PyObject_Call(__pyx_t_3, __pyx_t_1, NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_1);
+    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_14);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = PyObject_Call(__pyx_v_applyfunc, __pyx_t_1, NULL); if (unlikely(!__pyx_t_14)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_15 = PyDict_SetItem(((PyObject *)__pyx_v_groups), __pyx_v_key, __pyx_t_14); if (unlikely(__pyx_t_15 == -1)) {__pyx_filename = __pyx_f[5]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":265
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
- * 
+  /* "H:\workspace\pandas\pandas\lib\src\groupby.pyx":277
+ *         PyDict_SetItem(groups, key, applyfunc(np.asarray(members)))
  * 
+ *     return groups             # <<<<<<<<<<<<<<
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L12:;
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_groups));
+  __pyx_r = ((PyObject *)__pyx_v_groups);
+  goto __pyx_L0;
 
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries._roll_var");
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_14);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_values);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries.groupbyfunc");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_index);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_values);
+  __pyx_L2:;
+  __Pyx_DECREF(__pyx_v_groups);
+  __Pyx_DECREF(__pyx_v_idx);
+  __Pyx_DECREF(__pyx_v_curKey);
+  __Pyx_DECREF(__pyx_v_key);
+  __Pyx_DECREF(__pyx_v_members);
+  __Pyx_DECREF(__pyx_v_grouplist);
+  __Pyx_DECREF((PyObject *)__pyx_v_index);
+  __Pyx_DECREF((PyObject *)__pyx_v_values);
+  __Pyx_DECREF(__pyx_v_keyfunc);
+  __Pyx_DECREF(__pyx_v_applyfunc);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":268
- * 
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":7
+ * # Rolling sum
  * 
- * def _roll_var_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int minp, int N):
+ * def _roll_sum(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0
  */
 
-static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries__roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_sum(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
-  int __pyx_v_N;
   double __pyx_v_val;
   double __pyx_v_prev;
   double __pyx_v_sum_x;
-  double __pyx_v_sum_xx;
   int __pyx_v_nobs;
   int __pyx_v_i;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   Py_buffer __pyx_bstruct_output;
   Py_ssize_t __pyx_bstride_0_output = 0;
   Py_ssize_t __pyx_bshape_0_output = 0;
@@ -9156,26 +6784,29 @@ static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyO
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
-  int __pyx_t_8;
-  double __pyx_t_9;
+  long __pyx_t_8;
+  int __pyx_t_9;
   int __pyx_t_10;
   int __pyx_t_11;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__minp,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_var_noncontig");
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_sum");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[5] = {0,0,0,0,0};
+    PyObject* values[3] = {0,0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -9188,103 +6819,130 @@ static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyO
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_var_noncontig", 1, 5, 5, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_sum", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_var_noncontig", 1, 5, 5, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_var_noncontig", 1, 5, 5, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_var_noncontig", 1, 5, 5, 4); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_sum", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_var_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_sum") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[4]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 8; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_var_noncontig", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_sum", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_var_noncontig");
+  __Pyx_AddTraceback("tseries._roll_sum");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
   __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":271
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0, sum_xx = 0             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":9
+ * def _roll_sum(ndarray[double_t, ndim=1] input,
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
  *     cdef int nobs = 0, i
- * 
+ *     cdef int N = len(input)
  */
   __pyx_v_sum_x = 0;
-  __pyx_v_sum_xx = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":272
- *                         int win, int minp, int N):
- *     cdef double val, prev, sum_x = 0, sum_xx = 0
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":10
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
  * 
- *     if minp > N:
  */
   __pyx_v_nobs = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":274
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":11
+ *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 11; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":13
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     if minp > N:
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":15
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
  *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":275
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":16
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -9296,184 +6954,166 @@ static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyO
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":277
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":18
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":278
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":19
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         # Not NaN
  */
-    __pyx_t_3 = __pyx_v_i;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_3, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":281
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":22
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  *             sum_x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":282
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":23
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
- *             sum_xx += val * val
+ * 
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":283
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":24
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
- *             sum_xx += val * val
- * 
- */
-      __pyx_v_sum_x += __pyx_v_val;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":284
- *             nobs += 1
- *             sum_x += val
- *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_sum_x += __pyx_v_val;
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":286
- *             sum_xx += val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":26
+ *             sum_x += val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from minp - 1 <= i < N:
  */
-    __pyx_t_4 = __pyx_v_i;
-    __pyx_t_5 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_5 = 0;
-    if (unlikely(__pyx_t_5 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_5);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 286; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 26; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":288
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":28
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_5 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_5; __pyx_v_i++) {
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":289
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":29
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         if i > win - 1:
  */
-    __pyx_t_6 = __pyx_v_i;
-    __pyx_t_7 = -1;
-    if (__pyx_t_6 < 0) {
-      __pyx_t_6 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":291
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":31
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
  *             prev = input[i - win]
  *             if prev == prev:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":292
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":32
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
  *             if prev == prev:
  *                 sum_x -= prev
  */
-      __pyx_t_7 = (__pyx_v_i - __pyx_v_win);
-      __pyx_t_8 = -1;
-      if (__pyx_t_7 < 0) {
-        __pyx_t_7 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-      } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_8 = 0;
-      if (unlikely(__pyx_t_8 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_8);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":293
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":33
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
  *                 sum_x -= prev
- *                 sum_xx -= prev * prev
+ *                 nobs -= 1
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":294
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":34
  *             prev = input[i - win]
  *             if prev == prev:
  *                 sum_x -= prev             # <<<<<<<<<<<<<<
- *                 sum_xx -= prev * prev
  *                 nobs -= 1
+ * 
  */
         __pyx_v_sum_x -= __pyx_v_prev;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":295
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":35
  *             if prev == prev:
  *                 sum_x -= prev
- *                 sum_xx -= prev * prev             # <<<<<<<<<<<<<<
- *                 nobs -= 1
- * 
- */
-        __pyx_v_sum_xx -= (__pyx_v_prev * __pyx_v_prev);
-
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":296
- *                 sum_x -= prev
- *                 sum_xx -= prev * prev
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
@@ -9486,186 +7126,315 @@ static PyObject *__pyx_pf_7tseries__roll_var_noncontig(PyObject *__pyx_self, PyO
     }
     __pyx_L12:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":298
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":37
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  *             sum_x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":299
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":38
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
  *             sum_x += val
- *             sum_xx += val * val
+ * 
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":300
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":39
  *         if val == val:
  *             nobs += 1
  *             sum_x += val             # <<<<<<<<<<<<<<
- *             sum_xx += val * val
- * 
- */
-      __pyx_v_sum_x += __pyx_v_val;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":301
- *             nobs += 1
- *             sum_x += val
- *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_sum_x += __pyx_v_val;
       goto __pyx_L14;
     }
     __pyx_L14:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":303
- *             sum_xx += val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":41
+ *             sum_x += val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
+ *             output[i] = sum_x
  *         else:
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":304
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":42
  * 
  *         if nobs >= minp:
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)             # <<<<<<<<<<<<<<
+ *             output[i] = sum_x             # <<<<<<<<<<<<<<
  *         else:
  *             output[i] = NaN
  */
-      __pyx_t_9 = ((__pyx_v_nobs * __pyx_v_sum_xx) - (__pyx_v_sum_x * __pyx_v_sum_x));
-      __pyx_t_8 = ((__pyx_v_nobs * __pyx_v_nobs) - __pyx_v_nobs);
-      if (unlikely(__pyx_t_8 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_t_10 = __pyx_v_i;
-      __pyx_t_11 = -1;
-      if (__pyx_t_10 < 0) {
-        __pyx_t_10 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
-      } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
-      if (unlikely(__pyx_t_11 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_14 = __pyx_v_i;
+      __pyx_t_15 = -1;
+      if (__pyx_t_14 < 0) {
+        __pyx_t_14 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
+      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_15 = 0;
+      if (unlikely(__pyx_t_15 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_15);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = (__pyx_t_9 / __pyx_t_8);
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = __pyx_v_sum_x;
       goto __pyx_L15;
     }
     /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":306
- *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":44
+ *             output[i] = sum_x
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- * #-------------------------------------------------------------------------------
+ *     return output
  */
-      __pyx_t_8 = __pyx_v_i;
-      __pyx_t_11 = -1;
-      if (__pyx_t_8 < 0) {
-        __pyx_t_8 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_8 < 0)) __pyx_t_11 = 0;
-      } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
-      if (unlikely(__pyx_t_11 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_15 = __pyx_v_i;
+      __pyx_t_16 = -1;
+      if (__pyx_t_15 < 0) {
+        __pyx_t_15 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_15 < 0)) __pyx_t_16 = 0;
+      } else if (unlikely(__pyx_t_15 >= __pyx_bshape_0_output)) __pyx_t_16 = 0;
+      if (unlikely(__pyx_t_16 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_16);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_15, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
     }
     __pyx_L15:;
   }
 
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":46
+ *             output[i] = NaN
+ * 
+ *     return output             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
+
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_var_noncontig");
+  __Pyx_AddTraceback("tseries._roll_sum");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":311
- * # Rolling skewness
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":51
+ * # Rolling mean
  * 
- * cdef void _roll_skew(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int minp, int N):
- *     cdef double val, prev
+ * def _roll_mean(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
+ *     cdef double val, prev, sum_x = 0
  */
 
-static  void __pyx_f_7tseries__roll_skew(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_minp, int __pyx_v_N) {
+static PyObject *__pyx_pf_7tseries__roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  int __pyx_v_win;
+  int __pyx_v_minp;
   double __pyx_v_val;
   double __pyx_v_prev;
-  double __pyx_v_x;
-  double __pyx_v_xx;
-  double __pyx_v_xxx;
+  double __pyx_v_sum_x;
   int __pyx_v_nobs;
   int __pyx_v_i;
-  double __pyx_v_A;
-  double __pyx_v_B;
-  double __pyx_v_C;
-  double __pyx_v_R;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  double __pyx_t_4;
-  double __pyx_t_5;
-  __Pyx_RefNannySetupContext("_roll_skew");
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
+  Py_buffer __pyx_bstruct_output;
+  Py_ssize_t __pyx_bstride_0_output = 0;
+  Py_ssize_t __pyx_bshape_0_output = 0;
+  Py_buffer __pyx_bstruct_input;
+  Py_ssize_t __pyx_bstride_0_input = 0;
+  Py_ssize_t __pyx_bshape_0_input = 0;
+  PyObject *__pyx_r = NULL;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_mean");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[3] = {0,0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("_roll_mean", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
+      if (likely(values[2])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("_roll_mean", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_mean") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_input = ((PyArrayObject *)values[0]);
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 52; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("_roll_mean", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries._roll_mean");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_input);
+  __pyx_bstruct_output.buf = NULL;
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
+  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":314
- *                     int win, int minp, int N):
- *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":53
+ * def _roll_mean(ndarray[double_t, ndim=1] input,
+ *                int win, int minp):
+ *     cdef double val, prev, sum_x = 0             # <<<<<<<<<<<<<<
  *     cdef int nobs = 0, i
- * 
+ *     cdef int N = len(input)
  */
-  __pyx_v_x = 0;
-  __pyx_v_xx = 0;
-  __pyx_v_xxx = 0;
+  __pyx_v_sum_x = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":315
- *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":54
+ *                int win, int minp):
+ *     cdef double val, prev, sum_x = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
  * 
- *     # 3 components of the skewness equation
  */
   __pyx_v_nobs = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":320
- *     cdef double A, B, C, R
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":55
+ *     cdef double val, prev, sum_x = 0
+ *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 55; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":57
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     if minp > N:
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 57; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":59
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
  *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":321
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":60
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -9673,364 +7442,805 @@ static  void __pyx_f_7tseries__roll_skew(__pyx_t_5numpy_double_t *__pyx_v_input,
  *     for i from 0 <= i < minp - 1:
  */
     __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L3;
+    goto __pyx_L6;
   }
-  __pyx_L3:;
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":323
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":62
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":324
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":63
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         # Not NaN
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":327
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":66
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
- *             x += val
+ *             sum_x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":328
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":67
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
- *             x += val
- *             xx += val * val
- */
-      __pyx_v_nobs += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":329
- *         if val == val:
- *             nobs += 1
- *             x += val             # <<<<<<<<<<<<<<
- *             xx += val * val
- *             xxx += val * val * val
- */
-      __pyx_v_x += __pyx_v_val;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":330
- *             nobs += 1
- *             x += val
- *             xx += val * val             # <<<<<<<<<<<<<<
- *             xxx += val * val * val
+ *             sum_x += val
  * 
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":331
- *             x += val
- *             xx += val * val
- *             xxx += val * val * val             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":68
+ *         if val == val:
+ *             nobs += 1
+ *             sum_x += val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
-      goto __pyx_L6;
+      __pyx_v_sum_x += __pyx_v_val;
+      goto __pyx_L9;
     }
-    __pyx_L6:;
+    __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":333
- *             xxx += val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":70
+ *             sum_x += val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from minp - 1 <= i < N:
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":335
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":72
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":336
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":73
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         if i > win - 1:
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":338
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":75
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
  *             prev = input[i - win]
  *             if prev == prev:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":339
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":76
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
  *             if prev == prev:
- *                 x -= prev
+ *                 sum_x -= prev
  */
-      __pyx_v_prev = (__pyx_v_input[(__pyx_v_i - __pyx_v_win)]);
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 76; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":340
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":77
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 x -= prev
- *                 xx -= prev * prev
+ *                 sum_x -= prev
+ *                 nobs -= 1
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":341
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":78
  *             prev = input[i - win]
  *             if prev == prev:
- *                 x -= prev             # <<<<<<<<<<<<<<
- *                 xx -= prev * prev
- *                 xxx -= prev * prev * prev
+ *                 sum_x -= prev             # <<<<<<<<<<<<<<
+ *                 nobs -= 1
+ * 
  */
-        __pyx_v_x -= __pyx_v_prev;
+        __pyx_v_sum_x -= __pyx_v_prev;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":342
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":79
  *             if prev == prev:
- *                 x -= prev
- *                 xx -= prev * prev             # <<<<<<<<<<<<<<
- *                 xxx -= prev * prev * prev
+ *                 sum_x -= prev
+ *                 nobs -= 1             # <<<<<<<<<<<<<<
+ * 
+ *         if val == val:
+ */
+        __pyx_v_nobs -= 1;
+        goto __pyx_L13;
+      }
+      __pyx_L13:;
+      goto __pyx_L12;
+    }
+    __pyx_L12:;
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":81
+ *                 nobs -= 1
+ * 
+ *         if val == val:             # <<<<<<<<<<<<<<
+ *             nobs += 1
+ *             sum_x += val
+ */
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":82
+ * 
+ *         if val == val:
+ *             nobs += 1             # <<<<<<<<<<<<<<
+ *             sum_x += val
+ * 
+ */
+      __pyx_v_nobs += 1;
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":83
+ *         if val == val:
+ *             nobs += 1
+ *             sum_x += val             # <<<<<<<<<<<<<<
+ * 
+ *         if nobs >= minp:
+ */
+      __pyx_v_sum_x += __pyx_v_val;
+      goto __pyx_L14;
+    }
+    __pyx_L14:;
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":85
+ *             sum_x += val
+ * 
+ *         if nobs >= minp:             # <<<<<<<<<<<<<<
+ *             output[i] = sum_x / nobs
+ *         else:
+ */
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":86
+ * 
+ *         if nobs >= minp:
+ *             output[i] = sum_x / nobs             # <<<<<<<<<<<<<<
+ *         else:
+ *             output[i] = NaN
+ */
+      if (unlikely(__pyx_v_nobs == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_t_14 = __pyx_v_i;
+      __pyx_t_15 = -1;
+      if (__pyx_t_14 < 0) {
+        __pyx_t_14 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
+      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_15 = 0;
+      if (unlikely(__pyx_t_15 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_15);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = (__pyx_v_sum_x / __pyx_v_nobs);
+      goto __pyx_L15;
+    }
+    /*else*/ {
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":88
+ *             output[i] = sum_x / nobs
+ *         else:
+ *             output[i] = NaN             # <<<<<<<<<<<<<<
+ * 
+ *     return output
+ */
+      __pyx_t_15 = __pyx_v_i;
+      __pyx_t_16 = -1;
+      if (__pyx_t_15 < 0) {
+        __pyx_t_15 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_15 < 0)) __pyx_t_16 = 0;
+      } else if (unlikely(__pyx_t_15 >= __pyx_bshape_0_output)) __pyx_t_16 = 0;
+      if (unlikely(__pyx_t_16 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_16);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_15, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    }
+    __pyx_L15:;
+  }
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":90
+ *             output[i] = NaN
+ * 
+ *     return output             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._roll_mean");
+  __pyx_r = NULL;
+  goto __pyx_L2;
+  __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":95
+ * # Exponentially weighted moving average
+ * 
+ * def _ewma(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *           int com):
+ *     cdef double cur, prev, neww, oldw, adj
+ */
+
+static PyObject *__pyx_pf_7tseries__ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  int __pyx_v_com;
+  double __pyx_v_cur;
+  double __pyx_v_prev;
+  double __pyx_v_neww;
+  double __pyx_v_oldw;
+  double __pyx_v_adj;
+  int __pyx_v_i;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
+  Py_buffer __pyx_bstruct_output;
+  Py_ssize_t __pyx_bstride_0_output = 0;
+  Py_ssize_t __pyx_bshape_0_output = 0;
+  Py_buffer __pyx_bstruct_input;
+  Py_ssize_t __pyx_bstride_0_input = 0;
+  Py_ssize_t __pyx_bshape_0_input = 0;
+  PyObject *__pyx_r = NULL;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  double __pyx_t_7;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  long __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  long __pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  int __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  int __pyx_t_19;
+  __pyx_t_5numpy_double_t __pyx_t_20;
+  int __pyx_t_21;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__com,0};
+  __Pyx_RefNannySetupContext("_ewma");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[2] = {0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__com);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("_ewma", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_ewma") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_input = ((PyArrayObject *)values[0]);
+    __pyx_v_com = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_com == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_com = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_com == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("_ewma", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries._ewma");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_input);
+  __pyx_bstruct_output.buf = NULL;
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
+  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":99
+ *     cdef double cur, prev, neww, oldw, adj
+ *     cdef int i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":101
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
  * 
  */
-        __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":343
- *                 x -= prev
- *                 xx -= prev * prev
- *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":104
  * 
- *                 nobs -= 1
+ * 
+ *     neww = 1. / (1. + com)             # <<<<<<<<<<<<<<
+ *     oldw = 1. - neww
+ *     adj = oldw
  */
-        __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
+  __pyx_t_7 = (1.0 + __pyx_v_com);
+  if (unlikely(__pyx_t_7 == 0)) {
+    PyErr_Format(PyExc_ZeroDivisionError, "float division");
+    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_v_neww = (1.0 / __pyx_t_7);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":345
- *                 xxx -= prev * prev * prev
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":105
  * 
- *                 nobs -= 1             # <<<<<<<<<<<<<<
+ *     neww = 1. / (1. + com)
+ *     oldw = 1. - neww             # <<<<<<<<<<<<<<
+ *     adj = oldw
  * 
- *         if val == val:
  */
-        __pyx_v_nobs -= 1;
-        goto __pyx_L10;
-      }
-      __pyx_L10:;
-      goto __pyx_L9;
-    }
-    __pyx_L9:;
+  __pyx_v_oldw = (1.0 - __pyx_v_neww);
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":347
- *                 nobs -= 1
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":106
+ *     neww = 1. / (1. + com)
+ *     oldw = 1. - neww
+ *     adj = oldw             # <<<<<<<<<<<<<<
  * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             x += val
+ *     output[0] = neww * input[0]
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+  __pyx_v_adj = __pyx_v_oldw;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":348
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":108
+ *     adj = oldw
  * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             x += val
- *             xx += val * val
+ *     output[0] = neww * input[0]             # <<<<<<<<<<<<<<
+ * 
+ *     for i from 1 <= i < N:
  */
-      __pyx_v_nobs += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":349
- *         if val == val:
- *             nobs += 1
- *             x += val             # <<<<<<<<<<<<<<
- *             xx += val * val
- *             xxx += val * val * val
+  __pyx_t_8 = 0;
+  __pyx_t_9 = -1;
+  if (__pyx_t_8 < 0) {
+    __pyx_t_8 += __pyx_bshape_0_input;
+    if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
+  } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_input)) __pyx_t_9 = 0;
+  if (unlikely(__pyx_t_9 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_9);
+    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_t_10 = 0;
+  __pyx_t_9 = -1;
+  if (__pyx_t_10 < 0) {
+    __pyx_t_10 += __pyx_bshape_0_output;
+    if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
+  } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
+  if (unlikely(__pyx_t_9 != -1)) {
+    __Pyx_RaiseBufferIndexError(__pyx_t_9);
+    {__pyx_filename = __pyx_f[2]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = (__pyx_v_neww * (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_8, __pyx_bstride_0_input)));
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":110
+ *     output[0] = neww * input[0]
+ * 
+ *     for i from 1 <= i < N:             # <<<<<<<<<<<<<<
+ *         cur = input[i]
+ *         prev = output[i - 1]
  */
-      __pyx_v_x += __pyx_v_val;
+  __pyx_t_9 = __pyx_v_N;
+  for (__pyx_v_i = 1; __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":350
- *             nobs += 1
- *             x += val
- *             xx += val * val             # <<<<<<<<<<<<<<
- *             xxx += val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":111
+ * 
+ *     for i from 1 <= i < N:
+ *         cur = input[i]             # <<<<<<<<<<<<<<
+ *         prev = output[i - 1]
  * 
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+    __pyx_t_11 = __pyx_v_i;
+    __pyx_t_12 = -1;
+    if (__pyx_t_11 < 0) {
+      __pyx_t_11 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
+    } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_input)) __pyx_t_12 = 0;
+    if (unlikely(__pyx_t_12 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_12);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_11, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":351
- *             x += val
- *             xx += val * val
- *             xxx += val * val * val             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":112
+ *     for i from 1 <= i < N:
+ *         cur = input[i]
+ *         prev = output[i - 1]             # <<<<<<<<<<<<<<
  * 
- *         if nobs >= minp:
+ *         if cur == cur:
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
-      goto __pyx_L11;
+    __pyx_t_13 = (__pyx_v_i - 1);
+    __pyx_t_12 = -1;
+    if (__pyx_t_13 < 0) {
+      __pyx_t_13 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
+    } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_output)) __pyx_t_12 = 0;
+    if (unlikely(__pyx_t_12 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_12);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_L11:;
+    __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_13, __pyx_bstride_0_output));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":353
- *             xxx += val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":114
+ *         prev = output[i - 1]
  * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             A = x / nobs
- *             B = xx / nobs - A * A
+ *         if cur == cur:             # <<<<<<<<<<<<<<
+ *             if prev == prev:
+ *                 output[i] = oldw * prev + neww * cur
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+    __pyx_t_14 = (__pyx_v_cur == __pyx_v_cur);
+    if (__pyx_t_14) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":354
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":115
  * 
- *         if nobs >= minp:
- *             A = x / nobs             # <<<<<<<<<<<<<<
- *             B = xx / nobs - A * A
- *             C = xxx / nobs - A * A * A - 3 * A * B
+ *         if cur == cur:
+ *             if prev == prev:             # <<<<<<<<<<<<<<
+ *                 output[i] = oldw * prev + neww * cur
+ *             else:
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_14 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_14) {
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":116
+ *         if cur == cur:
+ *             if prev == prev:
+ *                 output[i] = oldw * prev + neww * cur             # <<<<<<<<<<<<<<
+ *             else:
+ *                 output[i] = neww * cur
+ */
+        __pyx_t_12 = __pyx_v_i;
+        __pyx_t_15 = -1;
+        if (__pyx_t_12 < 0) {
+          __pyx_t_12 += __pyx_bshape_0_output;
+          if (unlikely(__pyx_t_12 < 0)) __pyx_t_15 = 0;
+        } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_output)) __pyx_t_15 = 0;
+        if (unlikely(__pyx_t_15 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_15);
+          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_12, __pyx_bstride_0_output) = ((__pyx_v_oldw * __pyx_v_prev) + (__pyx_v_neww * __pyx_v_cur));
+        goto __pyx_L9;
       }
-      __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
+      /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":355
- *         if nobs >= minp:
- *             A = x / nobs
- *             B = xx / nobs - A * A             # <<<<<<<<<<<<<<
- *             C = xxx / nobs - A * A * A - 3 * A * B
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":118
+ *                 output[i] = oldw * prev + neww * cur
+ *             else:
+ *                 output[i] = neww * cur             # <<<<<<<<<<<<<<
+ *         else:
+ *             output[i] = prev
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_15 = __pyx_v_i;
+        __pyx_t_16 = -1;
+        if (__pyx_t_15 < 0) {
+          __pyx_t_15 += __pyx_bshape_0_output;
+          if (unlikely(__pyx_t_15 < 0)) __pyx_t_16 = 0;
+        } else if (unlikely(__pyx_t_15 >= __pyx_bshape_0_output)) __pyx_t_16 = 0;
+        if (unlikely(__pyx_t_16 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_16);
+          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_15, __pyx_bstride_0_output) = (__pyx_v_neww * __pyx_v_cur);
       }
-      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - (__pyx_v_A * __pyx_v_A));
+      __pyx_L9:;
+      goto __pyx_L8;
+    }
+    /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":356
- *             A = x / nobs
- *             B = xx / nobs - A * A
- *             C = xxx / nobs - A * A * A - 3 * A * B             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":120
+ *                 output[i] = neww * cur
+ *         else:
+ *             output[i] = prev             # <<<<<<<<<<<<<<
  * 
- *             R = sqrt(B)
+ *     for i from 0 <= i < N:
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 356; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_16 = __pyx_v_i;
+      __pyx_t_17 = -1;
+      if (__pyx_t_16 < 0) {
+        __pyx_t_16 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
+      } else if (unlikely(__pyx_t_16 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+      if (unlikely(__pyx_t_17 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_17);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - ((__pyx_v_A * __pyx_v_A) * __pyx_v_A)) - ((3 * __pyx_v_A) * __pyx_v_B));
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_16, __pyx_bstride_0_output) = __pyx_v_prev;
+    }
+    __pyx_L8:;
+  }
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":358
- *             C = xxx / nobs - A * A * A - 3 * A * B
- * 
- *             R = sqrt(B)             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":122
+ *             output[i] = prev
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
+ *     for i from 0 <= i < N:             # <<<<<<<<<<<<<<
+ *         cur = input[i]
+ *         output[i] = output[i] / (1. - adj)
  */
-      __pyx_v_R = sqrt(__pyx_v_B);
+  __pyx_t_9 = __pyx_v_N;
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":360
- *             R = sqrt(B)
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":123
+ * 
+ *     for i from 0 <= i < N:
+ *         cur = input[i]             # <<<<<<<<<<<<<<
+ *         output[i] = output[i] / (1. - adj)
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
- *                          ((nobs-2) * R * R * R))
- *         else:
  */
-      __pyx_t_4 = (sqrt((__pyx_v_nobs * (__pyx_v_nobs - 1.0))) * __pyx_v_C);
+    __pyx_t_17 = __pyx_v_i;
+    __pyx_t_18 = -1;
+    if (__pyx_t_17 < 0) {
+      __pyx_t_17 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_17 < 0)) __pyx_t_18 = 0;
+    } else if (unlikely(__pyx_t_17 >= __pyx_bshape_0_input)) __pyx_t_18 = 0;
+    if (unlikely(__pyx_t_18 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_18);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 123; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_cur = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_17, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":361
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":124
+ *     for i from 0 <= i < N:
+ *         cur = input[i]
+ *         output[i] = output[i] / (1. - adj)             # <<<<<<<<<<<<<<
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
- *                          ((nobs-2) * R * R * R))             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
+ *         if cur == cur:
  */
-      __pyx_t_5 = ((((__pyx_v_nobs - 2) * __pyx_v_R) * __pyx_v_R) * __pyx_v_R);
-      if (unlikely(__pyx_t_5 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
+    __pyx_t_18 = __pyx_v_i;
+    __pyx_t_19 = -1;
+    if (__pyx_t_18 < 0) {
+      __pyx_t_18 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_18 < 0)) __pyx_t_19 = 0;
+    } else if (unlikely(__pyx_t_18 >= __pyx_bshape_0_output)) __pyx_t_19 = 0;
+    if (unlikely(__pyx_t_19 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_19);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_t_20 = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_18, __pyx_bstride_0_output));
+    __pyx_t_7 = (1.0 - __pyx_v_adj);
+    if (unlikely(__pyx_t_7 == 0)) {
+      PyErr_Format(PyExc_ZeroDivisionError, "float division");
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_t_19 = __pyx_v_i;
+    __pyx_t_21 = -1;
+    if (__pyx_t_19 < 0) {
+      __pyx_t_19 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_19 < 0)) __pyx_t_21 = 0;
+    } else if (unlikely(__pyx_t_19 >= __pyx_bshape_0_output)) __pyx_t_21 = 0;
+    if (unlikely(__pyx_t_21 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_21);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_19, __pyx_bstride_0_output) = (__pyx_t_20 / __pyx_t_7);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":360
- *             R = sqrt(B)
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":126
+ *         output[i] = output[i] / (1. - adj)
+ * 
+ *         if cur == cur:             # <<<<<<<<<<<<<<
+ *             adj *= oldw
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
- *                          ((nobs-2) * R * R * R))
- *         else:
  */
-      (__pyx_v_output[__pyx_v_i]) = (__pyx_t_4 / __pyx_t_5);
-      goto __pyx_L12;
-    }
-    /*else*/ {
+    __pyx_t_14 = (__pyx_v_cur == __pyx_v_cur);
+    if (__pyx_t_14) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":363
- *                          ((nobs-2) * R * R * R))
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":127
  * 
+ *         if cur == cur:
+ *             adj *= oldw             # <<<<<<<<<<<<<<
  * 
+ *     return output
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
+      __pyx_v_adj *= __pyx_v_oldw;
+      goto __pyx_L12;
     }
     __pyx_L12:;
   }
 
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":129
+ *             adj *= oldw
+ * 
+ *     return output             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries._roll_skew");
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._ewma");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":366
- * 
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":134
+ * # Rolling variance
  * 
- * def _roll_skew_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                          ndarray[double_t, ndim=1] output,
- *                          int win, int minp, int N):
+ * def _roll_var(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0, sum_xx = 0
  */
 
-static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries__roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
-  int __pyx_v_N;
   double __pyx_v_val;
   double __pyx_v_prev;
-  double __pyx_v_x;
-  double __pyx_v_xx;
-  double __pyx_v_xxx;
+  double __pyx_v_sum_x;
+  double __pyx_v_sum_xx;
   int __pyx_v_nobs;
   int __pyx_v_i;
-  double __pyx_v_A;
-  double __pyx_v_B;
-  double __pyx_v_C;
-  double __pyx_v_R;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   Py_buffer __pyx_bstruct_output;
   Py_ssize_t __pyx_bstride_0_output = 0;
   Py_ssize_t __pyx_bshape_0_output = 0;
@@ -10038,27 +8248,30 @@ static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, Py
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
-  int __pyx_t_8;
-  double __pyx_t_9;
-  double __pyx_t_10;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_t_12;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__minp,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_skew_noncontig");
+  int __pyx_t_13;
+  int __pyx_t_14;
+  double __pyx_t_15;
+  int __pyx_t_16;
+  int __pyx_t_17;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_var");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[5] = {0,0,0,0,0};
+    PyObject* values[3] = {0,0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -10071,104 +8284,131 @@ static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, Py
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_skew_noncontig", 1, 5, 5, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_var", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_skew_noncontig", 1, 5, 5, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_skew_noncontig", 1, 5, 5, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_skew_noncontig", 1, 5, 5, 4); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_var", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_skew_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_var") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[4]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_skew_noncontig", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_var", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_skew_noncontig");
+  __Pyx_AddTraceback("tseries._roll_var");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
   __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 134; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":370
- *                          int win, int minp, int N):
- *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":136
+ * def _roll_var(ndarray[double_t, ndim=1] input,
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0, sum_xx = 0             # <<<<<<<<<<<<<<
  *     cdef int nobs = 0, i
- * 
+ *     cdef int N = len(input)
  */
-  __pyx_v_x = 0;
-  __pyx_v_xx = 0;
-  __pyx_v_xxx = 0;
+  __pyx_v_sum_x = 0;
+  __pyx_v_sum_xx = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":371
- *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":137
+ *               int win, int minp):
+ *     cdef double val, prev, sum_x = 0, sum_xx = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
  * 
- *     # 3 components of the skewness equation
  */
   __pyx_v_nobs = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":376
- *     cdef double A, B, C, R
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":138
+ *     cdef double val, prev, sum_x = 0, sum_xx = 0
+ *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":140
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     if minp > N:
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 140; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":142
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
  *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":377
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":143
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -10180,202 +8420,184 @@ static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, Py
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":379
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":145
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":380
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":146
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         # Not NaN
  */
-    __pyx_t_3 = __pyx_v_i;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 380; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_3, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":383
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":149
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
- *             x += val
+ *             sum_x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":384
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":150
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
- *             x += val
- *             xx += val * val
+ *             sum_x += val
+ *             sum_xx += val * val
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":385
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":151
  *         if val == val:
  *             nobs += 1
- *             x += val             # <<<<<<<<<<<<<<
- *             xx += val * val
- *             xxx += val * val * val
- */
-      __pyx_v_x += __pyx_v_val;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":386
- *             nobs += 1
- *             x += val
- *             xx += val * val             # <<<<<<<<<<<<<<
- *             xxx += val * val * val
+ *             sum_x += val             # <<<<<<<<<<<<<<
+ *             sum_xx += val * val
  * 
  */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
+      __pyx_v_sum_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":387
- *             x += val
- *             xx += val * val
- *             xxx += val * val * val             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":152
+ *             nobs += 1
+ *             sum_x += val
+ *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
       goto __pyx_L9;
     }
     __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":389
- *             xxx += val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":154
+ *             sum_xx += val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from minp - 1 <= i < N:
  */
-    __pyx_t_4 = __pyx_v_i;
-    __pyx_t_5 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_5 = 0;
-    if (unlikely(__pyx_t_5 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_5);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":391
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":156
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_5 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_5; __pyx_v_i++) {
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":392
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":157
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         if i > win - 1:
  */
-    __pyx_t_6 = __pyx_v_i;
-    __pyx_t_7 = -1;
-    if (__pyx_t_6 < 0) {
-      __pyx_t_6 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":394
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":159
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
  *             prev = input[i - win]
  *             if prev == prev:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":395
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":160
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
  *             if prev == prev:
- *                 x -= prev
+ *                 sum_x -= prev
  */
-      __pyx_t_7 = (__pyx_v_i - __pyx_v_win);
-      __pyx_t_8 = -1;
-      if (__pyx_t_7 < 0) {
-        __pyx_t_7 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-      } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_8 = 0;
-      if (unlikely(__pyx_t_8 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_8);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 160; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":396
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":161
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
- *                 x -= prev
- *                 xx -= prev * prev
+ *                 sum_x -= prev
+ *                 sum_xx -= prev * prev
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":397
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":162
  *             prev = input[i - win]
  *             if prev == prev:
- *                 x -= prev             # <<<<<<<<<<<<<<
- *                 xx -= prev * prev
- *                 xxx -= prev * prev * prev
+ *                 sum_x -= prev             # <<<<<<<<<<<<<<
+ *                 sum_xx -= prev * prev
+ *                 nobs -= 1
  */
-        __pyx_v_x -= __pyx_v_prev;
+        __pyx_v_sum_x -= __pyx_v_prev;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":398
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":163
  *             if prev == prev:
- *                 x -= prev
- *                 xx -= prev * prev             # <<<<<<<<<<<<<<
- *                 xxx -= prev * prev * prev
- * 
- */
-        __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
-
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":399
- *                 x -= prev
- *                 xx -= prev * prev
- *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
- * 
+ *                 sum_x -= prev
+ *                 sum_xx -= prev * prev             # <<<<<<<<<<<<<<
  *                 nobs -= 1
+ * 
  */
-        __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
+        __pyx_v_sum_xx -= (__pyx_v_prev * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":401
- *                 xxx -= prev * prev * prev
- * 
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":164
+ *                 sum_x -= prev
+ *                 sum_xx -= prev * prev
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
@@ -10388,263 +8610,340 @@ static PyObject *__pyx_pf_7tseries__roll_skew_noncontig(PyObject *__pyx_self, Py
     }
     __pyx_L12:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":403
- *                 nobs -= 1
- * 
- *         if val == val:             # <<<<<<<<<<<<<<
- *             nobs += 1
- *             x += val
- */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":404
- * 
- *         if val == val:
- *             nobs += 1             # <<<<<<<<<<<<<<
- *             x += val
- *             xx += val * val
- */
-      __pyx_v_nobs += 1;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":405
- *         if val == val:
- *             nobs += 1
- *             x += val             # <<<<<<<<<<<<<<
- *             xx += val * val
- *             xxx += val * val * val
- */
-      __pyx_v_x += __pyx_v_val;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":406
- *             nobs += 1
- *             x += val
- *             xx += val * val             # <<<<<<<<<<<<<<
- *             xxx += val * val * val
- * 
- */
-      __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":407
- *             x += val
- *             xx += val * val
- *             xxx += val * val * val             # <<<<<<<<<<<<<<
- * 
- *         if nobs >= minp:
- */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
-      goto __pyx_L14;
-    }
-    __pyx_L14:;
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":409
- *             xxx += val * val * val
- * 
- *         if nobs >= minp:             # <<<<<<<<<<<<<<
- *             A = x / nobs
- *             B = xx / nobs - A * A
- */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":410
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":166
+ *                 nobs -= 1
  * 
- *         if nobs >= minp:
- *             A = x / nobs             # <<<<<<<<<<<<<<
- *             B = xx / nobs - A * A
- *             C = xxx / nobs - A * A * A - 3 * A * B
+ *         if val == val:             # <<<<<<<<<<<<<<
+ *             nobs += 1
+ *             sum_x += val
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":411
- *         if nobs >= minp:
- *             A = x / nobs
- *             B = xx / nobs - A * A             # <<<<<<<<<<<<<<
- *             C = xxx / nobs - A * A * A - 3 * A * B
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":167
  * 
+ *         if val == val:
+ *             nobs += 1             # <<<<<<<<<<<<<<
+ *             sum_x += val
+ *             sum_xx += val * val
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 411; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - (__pyx_v_A * __pyx_v_A));
+      __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":412
- *             A = x / nobs
- *             B = xx / nobs - A * A
- *             C = xxx / nobs - A * A * A - 3 * A * B             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":168
+ *         if val == val:
+ *             nobs += 1
+ *             sum_x += val             # <<<<<<<<<<<<<<
+ *             sum_xx += val * val
  * 
- *             R = sqrt(B)
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 412; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - ((__pyx_v_A * __pyx_v_A) * __pyx_v_A)) - ((3 * __pyx_v_A) * __pyx_v_B));
+      __pyx_v_sum_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":414
- *             C = xxx / nobs - A * A * A - 3 * A * B
- * 
- *             R = sqrt(B)             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":169
+ *             nobs += 1
+ *             sum_x += val
+ *             sum_xx += val * val             # <<<<<<<<<<<<<<
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
+ *         if nobs >= minp:
  */
-      __pyx_v_R = sqrt(__pyx_v_B);
+      __pyx_v_sum_xx += (__pyx_v_val * __pyx_v_val);
+      goto __pyx_L14;
+    }
+    __pyx_L14:;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":416
- *             R = sqrt(B)
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":171
+ *             sum_xx += val * val
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
- *                          ((nobs-2) * R * R * R))
+ *         if nobs >= minp:             # <<<<<<<<<<<<<<
+ *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
  *         else:
  */
-      __pyx_t_9 = (sqrt((__pyx_v_nobs * (__pyx_v_nobs - 1.0))) * __pyx_v_C);
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":417
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":172
  * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
- *                          ((nobs-2) * R * R * R))             # <<<<<<<<<<<<<<
+ *         if nobs >= minp:
+ *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)             # <<<<<<<<<<<<<<
  *         else:
  *             output[i] = NaN
  */
-      __pyx_t_10 = ((((__pyx_v_nobs - 2) * __pyx_v_R) * __pyx_v_R) * __pyx_v_R);
-      if (unlikely(__pyx_t_10 == 0)) {
+      __pyx_t_15 = ((__pyx_v_nobs * __pyx_v_sum_xx) - (__pyx_v_sum_x * __pyx_v_sum_x));
+      __pyx_t_14 = ((__pyx_v_nobs * __pyx_v_nobs) - __pyx_v_nobs);
+      if (unlikely(__pyx_t_14 == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":416
- *             R = sqrt(B)
- * 
- *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
- *                          ((nobs-2) * R * R * R))
- *         else:
- */
-      __pyx_t_8 = __pyx_v_i;
-      __pyx_t_11 = -1;
-      if (__pyx_t_8 < 0) {
-        __pyx_t_8 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_8 < 0)) __pyx_t_11 = 0;
-      } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
-      if (unlikely(__pyx_t_11 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 416; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_16 = __pyx_v_i;
+      __pyx_t_17 = -1;
+      if (__pyx_t_16 < 0) {
+        __pyx_t_16 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
+      } else if (unlikely(__pyx_t_16 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+      if (unlikely(__pyx_t_17 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_17);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = (__pyx_t_9 / __pyx_t_10);
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_16, __pyx_bstride_0_output) = (__pyx_t_15 / __pyx_t_14);
       goto __pyx_L15;
     }
     /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":419
- *                          ((nobs-2) * R * R * R))
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":174
+ *             output[i] = (nobs * sum_xx - sum_x * sum_x) / (nobs * nobs - nobs)
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- * #-------------------------------------------------------------------------------
+ *     return output
  */
-      __pyx_t_11 = __pyx_v_i;
-      __pyx_t_12 = -1;
-      if (__pyx_t_11 < 0) {
-        __pyx_t_11 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
-      } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_output)) __pyx_t_12 = 0;
-      if (unlikely(__pyx_t_12 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 419; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_14 = __pyx_v_i;
+      __pyx_t_17 = -1;
+      if (__pyx_t_14 < 0) {
+        __pyx_t_14 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_14 < 0)) __pyx_t_17 = 0;
+      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+      if (unlikely(__pyx_t_17 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_17);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 174; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_11, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
     }
     __pyx_L15:;
   }
 
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":176
+ *             output[i] = NaN
+ * 
+ *     return output             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
+
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
     __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_skew_noncontig");
+  __Pyx_AddTraceback("tseries._roll_var");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
   __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":425
- * 
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":181
+ * # Rolling skewness
  * 
- * cdef void _roll_kurt(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                      int win, int minp, int N):
+ * def _roll_skew(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
  *     cdef double val, prev
  */
 
-static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_minp, int __pyx_v_N) {
+static PyObject *__pyx_pf_7tseries__roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  int __pyx_v_win;
+  int __pyx_v_minp;
   double __pyx_v_val;
   double __pyx_v_prev;
   double __pyx_v_x;
   double __pyx_v_xx;
   double __pyx_v_xxx;
-  double __pyx_v_xxxx;
   int __pyx_v_nobs;
   int __pyx_v_i;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   double __pyx_v_A;
   double __pyx_v_B;
   double __pyx_v_C;
-  double __pyx_v_D;
   double __pyx_v_R;
-  double __pyx_v_K;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  double __pyx_t_4;
-  double __pyx_t_5;
-  __Pyx_RefNannySetupContext("_roll_kurt");
+  Py_buffer __pyx_bstruct_output;
+  Py_ssize_t __pyx_bstride_0_output = 0;
+  Py_ssize_t __pyx_bshape_0_output = 0;
+  Py_buffer __pyx_bstruct_input;
+  Py_ssize_t __pyx_bstride_0_input = 0;
+  Py_ssize_t __pyx_bshape_0_input = 0;
+  PyObject *__pyx_r = NULL;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  double __pyx_t_15;
+  double __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_skew");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[3] = {0,0,0};
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("_roll_skew", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
+      if (likely(values[2])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("_roll_skew", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_skew") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_input = ((PyArrayObject *)values[0]);
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
+    goto __pyx_L5_argtuple_error;
+  } else {
+    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("_roll_skew", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries._roll_skew");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_input);
+  __pyx_bstruct_output.buf = NULL;
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  }
+  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
+  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":428
- *                      int win, int minp, int N):
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":184
+ *                int win, int minp):
  *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0             # <<<<<<<<<<<<<<
+ *     cdef double x = 0, xx = 0, xxx = 0             # <<<<<<<<<<<<<<
  *     cdef int nobs = 0, i
- * 
+ *     cdef int N = len(input)
  */
   __pyx_v_x = 0;
   __pyx_v_xx = 0;
   __pyx_v_xxx = 0;
-  __pyx_v_xxxx = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":429
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":185
  *     cdef double val, prev
- *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
+ *     cdef double x = 0, xx = 0, xxx = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
  * 
- *     # 5 components of the kurtosis equation
  */
   __pyx_v_nobs = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":434
- *     cdef double A, B, C, D, R, K
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":186
+ *     cdef double x = 0, xx = 0, xxx = 0
+ *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 186; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":188
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     # 3 components of the skewness equation
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 188; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":193
+ *     cdef double A, B, C, R
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
  *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":435
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":194
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -10652,40 +8951,50 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  *     for i from 0 <= i < minp - 1:
  */
     __pyx_v_minp = (__pyx_v_N + 1);
-    goto __pyx_L3;
+    goto __pyx_L6;
   }
-  __pyx_L3:;
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":437
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":196
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":438
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":197
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         # Not NaN
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":441
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":200
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  *             x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":442
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":201
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
@@ -10694,7 +9003,7 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":443
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":202
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
@@ -10703,95 +9012,116 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  */
       __pyx_v_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":444
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":203
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
- *             xxxx += val * val * val * val
+ * 
  */
       __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":445
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":204
  *             x += val
  *             xx += val * val
- *             xxx += val * val * val             # <<<<<<<<<<<<<<
- *             xxxx += val * val * val * val
- * 
- */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":446
- *             xx += val * val
- *             xxx += val * val * val
- *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
+ *             xxx += val * val * val             # <<<<<<<<<<<<<<
  * 
  *         output[i] = NaN
  */
-      __pyx_v_xxxx += (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val);
-      goto __pyx_L6;
+      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      goto __pyx_L9;
     }
-    __pyx_L6:;
+    __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":448
- *             xxxx += val * val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":206
+ *             xxx += val * val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from minp - 1 <= i < N:
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":450
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":208
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":451
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":209
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         if i > win - 1:
  */
-    __pyx_v_val = (__pyx_v_input[__pyx_v_i]);
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":453
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":211
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
  *             prev = input[i - win]
  *             if prev == prev:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":454
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":212
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
  *             if prev == prev:
  *                 x -= prev
  */
-      __pyx_v_prev = (__pyx_v_input[(__pyx_v_i - __pyx_v_win)]);
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":455
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":213
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
  *                 x -= prev
  *                 xx -= prev * prev
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":456
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":214
  *             prev = input[i - win]
  *             if prev == prev:
  *                 x -= prev             # <<<<<<<<<<<<<<
@@ -10800,59 +9130,50 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  */
         __pyx_v_x -= __pyx_v_prev;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":457
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":215
  *             if prev == prev:
  *                 x -= prev
  *                 xx -= prev * prev             # <<<<<<<<<<<<<<
  *                 xxx -= prev * prev * prev
- *                 xxxx -= prev * prev * prev * prev
+ * 
  */
         __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":458
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":216
  *                 x -= prev
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
- *                 xxxx -= prev * prev * prev * prev
  * 
+ *                 nobs -= 1
  */
         __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":459
- *                 xx -= prev * prev
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":218
  *                 xxx -= prev * prev * prev
- *                 xxxx -= prev * prev * prev * prev             # <<<<<<<<<<<<<<
- * 
- *                 nobs -= 1
- */
-        __pyx_v_xxxx -= (((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev) * __pyx_v_prev);
-
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":461
- *                 xxxx -= prev * prev * prev * prev
  * 
  *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
  *         if val == val:
  */
         __pyx_v_nobs -= 1;
-        goto __pyx_L10;
+        goto __pyx_L13;
       }
-      __pyx_L10:;
-      goto __pyx_L9;
+      __pyx_L13:;
+      goto __pyx_L12;
     }
-    __pyx_L9:;
+    __pyx_L12:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":463
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":220
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  *             x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":464
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":221
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
@@ -10861,7 +9182,7 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":465
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":222
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
@@ -10870,200 +9191,202 @@ static  void __pyx_f_7tseries__roll_kurt(__pyx_t_5numpy_double_t *__pyx_v_input,
  */
       __pyx_v_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":466
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":223
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
  *             xxx += val * val * val
- *             xxxx += val * val * val * val
+ * 
  */
       __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":467
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":224
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
- *             xxxx += val * val * val * val
- * 
- */
-      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":468
- *             xx += val * val
- *             xxx += val * val * val
- *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
  * 
  *         if nobs >= minp:
  */
-      __pyx_v_xxxx += (((__pyx_v_val * __pyx_v_val) * __pyx_v_val) * __pyx_v_val);
-      goto __pyx_L11;
+      __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
+      goto __pyx_L14;
     }
-    __pyx_L11:;
+    __pyx_L14:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":470
- *             xxxx += val * val * val * val
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":226
+ *             xxx += val * val * val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
  *             A = x / nobs
- *             R = A * A
+ *             B = xx / nobs - A * A
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":471
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":227
  * 
  *         if nobs >= minp:
  *             A = x / nobs             # <<<<<<<<<<<<<<
- *             R = A * A
- *             B = xx / nobs - R
+ *             B = xx / nobs - A * A
+ *             C = xxx / nobs - A * A * A - 3 * A * B
  */
       if (unlikely(__pyx_v_nobs == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
       __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":472
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":228
  *         if nobs >= minp:
  *             A = x / nobs
- *             R = A * A             # <<<<<<<<<<<<<<
- *             B = xx / nobs - R
- *             R = R * A
- */
-      __pyx_v_R = (__pyx_v_A * __pyx_v_A);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":473
- *             A = x / nobs
- *             R = A * A
- *             B = xx / nobs - R             # <<<<<<<<<<<<<<
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B
+ *             B = xx / nobs - A * A             # <<<<<<<<<<<<<<
+ *             C = xxx / nobs - A * A * A - 3 * A * B
+ * 
  */
       if (unlikely(__pyx_v_nobs == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 228; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - __pyx_v_R);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":474
- *             R = A * A
- *             B = xx / nobs - R
- *             R = R * A             # <<<<<<<<<<<<<<
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A
- */
-      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
+      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - (__pyx_v_A * __pyx_v_A));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":475
- *             B = xx / nobs - R
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B             # <<<<<<<<<<<<<<
- *             R = R * A
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":229
+ *             A = x / nobs
+ *             B = xx / nobs - A * A
+ *             C = xxx / nobs - A * A * A - 3 * A * B             # <<<<<<<<<<<<<<
+ * 
+ *             R = sqrt(B)
  */
       if (unlikely(__pyx_v_nobs == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - __pyx_v_R) - ((3 * __pyx_v_A) * __pyx_v_B));
+      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - ((__pyx_v_A * __pyx_v_A) * __pyx_v_A)) - ((3 * __pyx_v_A) * __pyx_v_B));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":476
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A             # <<<<<<<<<<<<<<
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":231
+ *             C = xxx / nobs - A * A * A - 3 * A * B
  * 
- */
-      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":477
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A             # <<<<<<<<<<<<<<
+ *             R = sqrt(B)             # <<<<<<<<<<<<<<
  * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
+ *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
  */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_D = ((((__pyx_v_xxxx / __pyx_v_nobs) - __pyx_v_R) - (((6 * __pyx_v_B) * __pyx_v_A) * __pyx_v_A)) - ((4 * __pyx_v_C) * __pyx_v_A));
+      __pyx_v_R = sqrt(__pyx_v_B);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":479
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
- * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)             # <<<<<<<<<<<<<<
- *             K = K / ((nobs - 2.)*(nobs-3.))
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":233
+ *             R = sqrt(B)
  * 
+ *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
+ *                          ((nobs-2) * R * R * R))
+ *         else:
  */
-      __pyx_t_4 = (((__pyx_v_nobs * __pyx_v_nobs) - 1.0) * __pyx_v_D);
-      __pyx_t_5 = (__pyx_v_B * __pyx_v_B);
-      if (unlikely(__pyx_t_5 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 479; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_K = ((__pyx_t_4 / __pyx_t_5) - (3 * pow((__pyx_v_nobs - 1.0), 2)));
+      __pyx_t_15 = (sqrt((__pyx_v_nobs * (__pyx_v_nobs - 1.0))) * __pyx_v_C);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":480
- * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
- *             K = K / ((nobs - 2.)*(nobs-3.))             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":234
  * 
- *             output[i] = K
+ *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /
+ *                          ((nobs-2) * R * R * R))             # <<<<<<<<<<<<<<
+ *         else:
+ *             output[i] = NaN
  */
-      __pyx_t_5 = ((__pyx_v_nobs - 2.0) * (__pyx_v_nobs - 3.0));
-      if (unlikely(__pyx_t_5 == 0)) {
+      __pyx_t_16 = ((((__pyx_v_nobs - 2) * __pyx_v_R) * __pyx_v_R) * __pyx_v_R);
+      if (unlikely(__pyx_t_16 == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_K = (__pyx_v_K / __pyx_t_5);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":482
- *             K = K / ((nobs - 2.)*(nobs-3.))
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":233
+ *             R = sqrt(B)
  * 
- *             output[i] = K             # <<<<<<<<<<<<<<
+ *             output[i] = ((sqrt(nobs * (nobs - 1.)) * C) /             # <<<<<<<<<<<<<<
+ *                          ((nobs-2) * R * R * R))
  *         else:
- *             output[i] = NaN
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_K;
-      goto __pyx_L12;
+      __pyx_t_14 = __pyx_v_i;
+      __pyx_t_17 = -1;
+      if (__pyx_t_14 < 0) {
+        __pyx_t_14 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_14 < 0)) __pyx_t_17 = 0;
+      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+      if (unlikely(__pyx_t_17 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_17);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = (__pyx_t_15 / __pyx_t_16);
+      goto __pyx_L15;
     }
     /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":484
- *             output[i] = K
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":236
+ *                          ((nobs-2) * R * R * R))
  *         else:
  *             output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- * def _roll_kurt_noncontig(ndarray[double_t, ndim=1] input,
+ *     return output
  */
-      (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
+      __pyx_t_17 = __pyx_v_i;
+      __pyx_t_18 = -1;
+      if (__pyx_t_17 < 0) {
+        __pyx_t_17 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_17 < 0)) __pyx_t_18 = 0;
+      } else if (unlikely(__pyx_t_17 >= __pyx_bshape_0_output)) __pyx_t_18 = 0;
+      if (unlikely(__pyx_t_18 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_18);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 236; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_17, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
     }
-    __pyx_L12:;
+    __pyx_L15:;
   }
 
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":238
+ *             output[i] = NaN
+ * 
+ *     return output             # <<<<<<<<<<<<<<
+ * 
+ * #-------------------------------------------------------------------------------
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("tseries._roll_kurt");
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._roll_skew");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":486
- *             output[i] = NaN
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":244
  * 
- * def _roll_kurt_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                          ndarray[double_t, ndim=1] output,
- *                          int win, int minp, int N):
+ * 
+ * def _roll_kurt(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                int win, int minp):
+ *     cdef double val, prev
  */
 
-static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries__roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
   int __pyx_v_win;
   int __pyx_v_minp;
-  int __pyx_v_N;
   double __pyx_v_val;
   double __pyx_v_prev;
   double __pyx_v_x;
@@ -11072,6 +9395,8 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
   double __pyx_v_xxxx;
   int __pyx_v_nobs;
   int __pyx_v_i;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   double __pyx_v_A;
   double __pyx_v_B;
   double __pyx_v_C;
@@ -11085,27 +9410,31 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  int __pyx_t_1;
-  long __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  int __pyx_t_6;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyArrayObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
-  int __pyx_t_8;
-  double __pyx_t_9;
-  double __pyx_t_10;
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_t_12;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__minp,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_kurt_noncontig");
+  int __pyx_t_13;
+  int __pyx_t_14;
+  double __pyx_t_15;
+  double __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_kurt");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[5] = {0,0,0,0,0};
+    PyObject* values[3] = {0,0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -11118,105 +9447,133 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_kurt_noncontig", 1, 5, 5, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_kurt", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_kurt_noncontig", 1, 5, 5, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_kurt_noncontig", 1, 5, 5, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  4:
-      values[4] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[4])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_kurt_noncontig", 1, 5, 5, 4); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_kurt", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_kurt_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_kurt") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[4]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 488; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 245; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_kurt_noncontig", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_kurt", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_kurt_noncontig");
+  __Pyx_AddTraceback("tseries._roll_kurt");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
   __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 244; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":490
- *                          int win, int minp, int N):
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":247
+ *                int win, int minp):
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0             # <<<<<<<<<<<<<<
  *     cdef int nobs = 0, i
- * 
+ *     cdef int N = len(input)
  */
   __pyx_v_x = 0;
   __pyx_v_xx = 0;
   __pyx_v_xxx = 0;
   __pyx_v_xxxx = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":491
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":248
  *     cdef double val, prev
  *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
  *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
+ * 
+ */
+  __pyx_v_nobs = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":249
+ *     cdef double x = 0, xx = 0, xxx = 0, xxxx = 0
+ *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":251
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
  *     # 5 components of the kurtosis equation
  */
-  __pyx_v_nobs = 0;
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
+  {
+    __Pyx_BufFmt_StackElem __pyx_stack[1];
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
+  }
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":496
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":256
  *     cdef double A, B, C, D, R, K
  * 
  *     if minp > N:             # <<<<<<<<<<<<<<
  *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_minp > __pyx_v_N);
-  if (__pyx_t_1) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":497
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":257
  * 
  *     if minp > N:
  *         minp = N + 1             # <<<<<<<<<<<<<<
@@ -11228,46 +9585,46 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":499
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":259
  *         minp = N + 1
  * 
  *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_2 = (__pyx_v_minp - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":500
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":260
  * 
  *     for i from 0 <= i < minp - 1:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         # Not NaN
  */
-    __pyx_t_3 = __pyx_v_i;
-    __pyx_t_4 = -1;
-    if (__pyx_t_3 < 0) {
-      __pyx_t_3 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_3 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_3 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 500; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_3, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":503
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":263
  * 
  *         # Not NaN
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  * 
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":504
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":264
  *         # Not NaN
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
@@ -11276,7 +9633,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":507
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":267
  * 
  *             # seriously don't ask me why this is faster
  *             x += val             # <<<<<<<<<<<<<<
@@ -11285,7 +9642,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":508
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":268
  *             # seriously don't ask me why this is faster
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
@@ -11294,7 +9651,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":509
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":269
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
@@ -11303,7 +9660,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":510
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":270
  *             xx += val * val
  *             xxx += val * val * val
  *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
@@ -11315,95 +9672,95 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
     }
     __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":512
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":272
  *             xxxx += val * val * val * val
  * 
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from minp - 1 <= i < N:
  */
-    __pyx_t_4 = __pyx_v_i;
-    __pyx_t_5 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_5 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_5 = 0;
-    if (unlikely(__pyx_t_5 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_5);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 512; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":514
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":274
  *         output[i] = NaN
  * 
  *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i]
  * 
  */
-  __pyx_t_5 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_5; __pyx_v_i++) {
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":515
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":275
  * 
  *     for i from minp - 1 <= i < N:
  *         val = input[i]             # <<<<<<<<<<<<<<
  * 
  *         if i > win - 1:
  */
-    __pyx_t_6 = __pyx_v_i;
-    __pyx_t_7 = -1;
-    if (__pyx_t_6 < 0) {
-      __pyx_t_6 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 515; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 275; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":517
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":277
  *         val = input[i]
  * 
  *         if i > win - 1:             # <<<<<<<<<<<<<<
  *             prev = input[i - win]
  *             if prev == prev:
  */
-    __pyx_t_1 = (__pyx_v_i > (__pyx_v_win - 1));
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":518
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":278
  * 
  *         if i > win - 1:
  *             prev = input[i - win]             # <<<<<<<<<<<<<<
  *             if prev == prev:
  *                 x -= prev
  */
-      __pyx_t_7 = (__pyx_v_i - __pyx_v_win);
-      __pyx_t_8 = -1;
-      if (__pyx_t_7 < 0) {
-        __pyx_t_7 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_7 < 0)) __pyx_t_8 = 0;
-      } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_8 = 0;
-      if (unlikely(__pyx_t_8 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_8);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 518; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
-      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":519
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":279
  *         if i > win - 1:
  *             prev = input[i - win]
  *             if prev == prev:             # <<<<<<<<<<<<<<
  *                 x -= prev
  *                 xx -= prev * prev
  */
-      __pyx_t_1 = (__pyx_v_prev == __pyx_v_prev);
-      if (__pyx_t_1) {
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":520
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":280
  *             prev = input[i - win]
  *             if prev == prev:
  *                 x -= prev             # <<<<<<<<<<<<<<
@@ -11412,7 +9769,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
         __pyx_v_x -= __pyx_v_prev;
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":521
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":281
  *             if prev == prev:
  *                 x -= prev
  *                 xx -= prev * prev             # <<<<<<<<<<<<<<
@@ -11421,7 +9778,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
         __pyx_v_xx -= (__pyx_v_prev * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":522
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":282
  *                 x -= prev
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev             # <<<<<<<<<<<<<<
@@ -11430,7 +9787,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
         __pyx_v_xxx -= ((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":523
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":283
  *                 xx -= prev * prev
  *                 xxx -= prev * prev * prev
  *                 xxxx -= prev * prev * prev * prev             # <<<<<<<<<<<<<<
@@ -11439,7 +9796,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
         __pyx_v_xxxx -= (((__pyx_v_prev * __pyx_v_prev) * __pyx_v_prev) * __pyx_v_prev);
 
-        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":525
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":285
  *                 xxxx -= prev * prev * prev * prev
  * 
  *                 nobs -= 1             # <<<<<<<<<<<<<<
@@ -11454,17 +9811,17 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
     }
     __pyx_L12:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":527
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":287
  *                 nobs -= 1
  * 
  *         if val == val:             # <<<<<<<<<<<<<<
  *             nobs += 1
  *             x += val
  */
-    __pyx_t_1 = (__pyx_v_val == __pyx_v_val);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":528
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":288
  * 
  *         if val == val:
  *             nobs += 1             # <<<<<<<<<<<<<<
@@ -11473,7 +9830,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_nobs += 1;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":529
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":289
  *         if val == val:
  *             nobs += 1
  *             x += val             # <<<<<<<<<<<<<<
@@ -11482,7 +9839,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_x += __pyx_v_val;
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":530
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":290
  *             nobs += 1
  *             x += val
  *             xx += val * val             # <<<<<<<<<<<<<<
@@ -11491,7 +9848,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_xx += (__pyx_v_val * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":531
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":291
  *             x += val
  *             xx += val * val
  *             xxx += val * val * val             # <<<<<<<<<<<<<<
@@ -11500,7 +9857,7 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       __pyx_v_xxx += ((__pyx_v_val * __pyx_v_val) * __pyx_v_val);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":532
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":292
  *             xx += val * val
  *             xxx += val * val * val
  *             xxxx += val * val * val * val             # <<<<<<<<<<<<<<
@@ -11512,17 +9869,17 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
     }
     __pyx_L14:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":534
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":294
  *             xxxx += val * val * val * val
  * 
  *         if nobs >= minp:             # <<<<<<<<<<<<<<
  *             A = x / nobs
  *             R = A * A
  */
-    __pyx_t_1 = (__pyx_v_nobs >= __pyx_v_minp);
-    if (__pyx_t_1) {
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":535
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":295
  * 
  *         if nobs >= minp:
  *             A = x / nobs             # <<<<<<<<<<<<<<
@@ -11531,484 +9888,208 @@ static PyObject *__pyx_pf_7tseries__roll_kurt_noncontig(PyObject *__pyx_self, Py
  */
       if (unlikely(__pyx_v_nobs == 0)) {
         PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 535; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 295; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       }
       __pyx_v_A = (__pyx_v_x / __pyx_v_nobs);
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":536
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":296
  *         if nobs >= minp:
  *             A = x / nobs
  *             R = A * A             # <<<<<<<<<<<<<<
  *             B = xx / nobs - R
  *             R = R * A
  */
-      __pyx_v_R = (__pyx_v_A * __pyx_v_A);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":537
- *             A = x / nobs
- *             R = A * A
- *             B = xx / nobs - R             # <<<<<<<<<<<<<<
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B
- */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 537; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - __pyx_v_R);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":538
- *             R = A * A
- *             B = xx / nobs - R
- *             R = R * A             # <<<<<<<<<<<<<<
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A
- */
-      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":539
- *             B = xx / nobs - R
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B             # <<<<<<<<<<<<<<
- *             R = R * A
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
- */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 539; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - __pyx_v_R) - ((3 * __pyx_v_A) * __pyx_v_B));
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":540
- *             R = R * A
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A             # <<<<<<<<<<<<<<
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
- * 
- */
-      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":541
- *             C = xxx / nobs - R - 3 * A * B
- *             R = R * A
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A             # <<<<<<<<<<<<<<
- * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
- */
-      if (unlikely(__pyx_v_nobs == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 541; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_D = ((((__pyx_v_xxxx / __pyx_v_nobs) - __pyx_v_R) - (((6 * __pyx_v_B) * __pyx_v_A) * __pyx_v_A)) - ((4 * __pyx_v_C) * __pyx_v_A));
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":543
- *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
- * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)             # <<<<<<<<<<<<<<
- *             K = K / ((nobs - 2.)*(nobs-3.))
- * 
- */
-      __pyx_t_9 = (((__pyx_v_nobs * __pyx_v_nobs) - 1.0) * __pyx_v_D);
-      __pyx_t_10 = (__pyx_v_B * __pyx_v_B);
-      if (unlikely(__pyx_t_10 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 543; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_K = ((__pyx_t_9 / __pyx_t_10) - (3 * pow((__pyx_v_nobs - 1.0), 2)));
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":544
- * 
- *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
- *             K = K / ((nobs - 2.)*(nobs-3.))             # <<<<<<<<<<<<<<
- * 
- *             output[i] = K
- */
-      __pyx_t_10 = ((__pyx_v_nobs - 2.0) * (__pyx_v_nobs - 3.0));
-      if (unlikely(__pyx_t_10 == 0)) {
-        PyErr_Format(PyExc_ZeroDivisionError, "float division");
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 544; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_v_K = (__pyx_v_K / __pyx_t_10);
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":546
- *             K = K / ((nobs - 2.)*(nobs-3.))
- * 
- *             output[i] = K             # <<<<<<<<<<<<<<
- *         else:
- *             output[i] = NaN
- */
-      __pyx_t_8 = __pyx_v_i;
-      __pyx_t_11 = -1;
-      if (__pyx_t_8 < 0) {
-        __pyx_t_8 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_8 < 0)) __pyx_t_11 = 0;
-      } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
-      if (unlikely(__pyx_t_11 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 546; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = __pyx_v_K;
-      goto __pyx_L15;
-    }
-    /*else*/ {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":548
- *             output[i] = K
- *         else:
- *             output[i] = NaN             # <<<<<<<<<<<<<<
- * 
- * #-------------------------------------------------------------------------------
- */
-      __pyx_t_11 = __pyx_v_i;
-      __pyx_t_12 = -1;
-      if (__pyx_t_11 < 0) {
-        __pyx_t_11 += __pyx_bshape_0_output;
-        if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
-      } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_output)) __pyx_t_12 = 0;
-      if (unlikely(__pyx_t_12 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 548; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_11, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
-    }
-    __pyx_L15:;
-  }
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_kurt_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":553
- * # Rolling median
- * 
- * def median(ndarray arr):             # <<<<<<<<<<<<<<
- *     cdef double *values
- *     cdef int n = len(arr)
- */
-
-static PyObject *__pyx_pf_7tseries_median(PyObject *__pyx_self, PyObject *__pyx_v_arr); /*proto*/
-static PyObject *__pyx_pf_7tseries_median(PyObject *__pyx_self, PyObject *__pyx_v_arr) {
-  double *__pyx_v_values;
-  int __pyx_v_n;
-  PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  long __pyx_t_6;
-  __Pyx_RefNannySetupContext("median");
-  __pyx_self = __pyx_self;
-  __Pyx_INCREF((PyObject *)__pyx_v_arr);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 553; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":555
- * def median(ndarray arr):
- *     cdef double *values
- *     cdef int n = len(arr)             # <<<<<<<<<<<<<<
- * 
- *     if len(arr) == 0:
- */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 555; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":557
- *     cdef int n = len(arr)
- * 
- *     if len(arr) == 0:             # <<<<<<<<<<<<<<
- *         return np.NaN
- * 
- */
-  __pyx_t_1 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 557; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = (__pyx_t_1 == 0);
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":558
- * 
- *     if len(arr) == 0:
- *         return np.NaN             # <<<<<<<<<<<<<<
- * 
- *     if not np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS):
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__NaN); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 558; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_r = __pyx_t_4;
-    __pyx_t_4 = 0;
-    goto __pyx_L0;
-    goto __pyx_L5;
-  }
-  __pyx_L5:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":560
- *         return np.NaN
- * 
- *     if not np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS):             # <<<<<<<<<<<<<<
- *         arr = np.array(arr)
- * 
- */
-  __pyx_t_2 = (!PyArray_CHKFLAGS(((PyArrayObject *)__pyx_v_arr), NPY_C_CONTIGUOUS));
-  if (__pyx_t_2) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":561
- * 
- *     if not np.PyArray_CHKFLAGS(arr, np.NPY_C_CONTIGUOUS):
- *         arr = np.array(arr)             # <<<<<<<<<<<<<<
- * 
- *     values = <double *> arr.data
- */
-    __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__array); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_INCREF(__pyx_v_arr);
-    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_arr);
-    __Pyx_GIVEREF(__pyx_v_arr);
-    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 561; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(__pyx_v_arr);
-    __pyx_v_arr = __pyx_t_5;
-    __pyx_t_5 = 0;
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":563
- *         arr = np.array(arr)
- * 
- *     values = <double *> arr.data             # <<<<<<<<<<<<<<
- * 
- *     if n % 2:
- */
-  __pyx_v_values = ((double *)((PyArrayObject *)__pyx_v_arr)->data);
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":565
- *     values = <double *> arr.data
- * 
- *     if n % 2:             # <<<<<<<<<<<<<<
- *         return kth_smallest(values, n, n / 2)
- *     else:
- */
-  __pyx_t_6 = __Pyx_mod_long(__pyx_v_n, 2);
-  if (__pyx_t_6) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":566
- * 
- *     if n % 2:
- *         return kth_smallest(values, n, n / 2)             # <<<<<<<<<<<<<<
- *     else:
- *         return (kth_smallest(values, n, n / 2) +
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_5 = PyFloat_FromDouble(kth_smallest(__pyx_v_values, __pyx_v_n, __Pyx_div_long(__pyx_v_n, 2))); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 566; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_r = __pyx_t_5;
-    __pyx_t_5 = 0;
-    goto __pyx_L0;
-    goto __pyx_L7;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":568
- *         return kth_smallest(values, n, n / 2)
- *     else:
- *         return (kth_smallest(values, n, n / 2) +             # <<<<<<<<<<<<<<
- *                 kth_smallest(values, n, n / 2 - 1)) / 2
- * 
- */
-    __Pyx_XDECREF(__pyx_r);
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":569
- *     else:
- *         return (kth_smallest(values, n, n / 2) +
- *                 kth_smallest(values, n, n / 2 - 1)) / 2             # <<<<<<<<<<<<<<
- * 
- * 
- */
-    __pyx_t_5 = PyFloat_FromDouble(((kth_smallest(__pyx_v_values, __pyx_v_n, __Pyx_div_long(__pyx_v_n, 2)) + kth_smallest(__pyx_v_values, __pyx_v_n, (__Pyx_div_long(__pyx_v_n, 2) - 1))) / 2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 569; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_r = __pyx_t_5;
-    __pyx_t_5 = 0;
-    goto __pyx_L0;
-  }
-  __pyx_L7:;
+      __pyx_v_R = (__pyx_v_A * __pyx_v_A);
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("tseries.median");
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_DECREF((PyObject *)__pyx_v_arr);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":297
+ *             A = x / nobs
+ *             R = A * A
+ *             B = xx / nobs - R             # <<<<<<<<<<<<<<
+ *             R = R * A
+ *             C = xxx / nobs - R - 3 * A * B
+ */
+      if (unlikely(__pyx_v_nobs == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_B = ((__pyx_v_xx / __pyx_v_nobs) - __pyx_v_R);
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":576
- * # Rolling min / max
- * 
- * cdef void _roll_max(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int N):
- *     cdef double val
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":298
+ *             R = A * A
+ *             B = xx / nobs - R
+ *             R = R * A             # <<<<<<<<<<<<<<
+ *             C = xxx / nobs - R - 3 * A * B
+ *             R = R * A
  */
+      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
 
-static  void __pyx_f_7tseries__roll_max(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_N) {
-  double __pyx_v_val;
-  int __pyx_v_i;
-  int __pyx_v_j;
-  long __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  double __pyx_t_7;
-  __Pyx_RefNannySetupContext("_roll_max");
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":299
+ *             B = xx / nobs - R
+ *             R = R * A
+ *             C = xxx / nobs - R - 3 * A * B             # <<<<<<<<<<<<<<
+ *             R = R * A
+ *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
+ */
+      if (unlikely(__pyx_v_nobs == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 299; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_C = (((__pyx_v_xxx / __pyx_v_nobs) - __pyx_v_R) - ((3 * __pyx_v_A) * __pyx_v_B));
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":581
- *     cdef int i, j
- * 
- *     for i from 0 <= i < win - 1:             # <<<<<<<<<<<<<<
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":300
+ *             R = R * A
+ *             C = xxx / nobs - R - 3 * A * B
+ *             R = R * A             # <<<<<<<<<<<<<<
+ *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
  * 
  */
-  __pyx_t_1 = (__pyx_v_win - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {
+      __pyx_v_R = (__pyx_v_R * __pyx_v_A);
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":582
- * 
- *     for i from 0 <= i < win - 1:
- *         output[i] = NaN             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":301
+ *             C = xxx / nobs - R - 3 * A * B
+ *             R = R * A
+ *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A             # <<<<<<<<<<<<<<
  * 
- *     for i from win - 1 <= i < N:
+ *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-  }
+      if (unlikely(__pyx_v_nobs == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 301; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_D = ((((__pyx_v_xxxx / __pyx_v_nobs) - __pyx_v_R) - (((6 * __pyx_v_B) * __pyx_v_A) * __pyx_v_A)) - ((4 * __pyx_v_C) * __pyx_v_A));
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":584
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":303
+ *             D = xxxx / nobs - R - 6*B*A*A - 4*C*A
  * 
- *     for i from win - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i - win + 1]
+ *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)             # <<<<<<<<<<<<<<
+ *             K = K / ((nobs - 2.)*(nobs-3.))
  * 
  */
-  __pyx_t_2 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+      __pyx_t_15 = (((__pyx_v_nobs * __pyx_v_nobs) - 1.0) * __pyx_v_D);
+      __pyx_t_16 = (__pyx_v_B * __pyx_v_B);
+      if (unlikely(__pyx_t_16 == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 303; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_K = ((__pyx_t_15 / __pyx_t_16) - (3 * pow((__pyx_v_nobs - 1.0), 2)));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":585
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":304
  * 
- *     for i from win - 1 <= i < N:
- *         val = input[i - win + 1]             # <<<<<<<<<<<<<<
+ *             K = (nobs * nobs - 1.)*D/(B*B) - 3*((nobs-1.)**2)
+ *             K = K / ((nobs - 2.)*(nobs-3.))             # <<<<<<<<<<<<<<
  * 
- *         for j from (i - win + 1) <= j <= i:
+ *             output[i] = K
  */
-    __pyx_v_val = (__pyx_v_input[((__pyx_v_i - __pyx_v_win) + 1)]);
+      __pyx_t_16 = ((__pyx_v_nobs - 2.0) * (__pyx_v_nobs - 3.0));
+      if (unlikely(__pyx_t_16 == 0)) {
+        PyErr_Format(PyExc_ZeroDivisionError, "float division");
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 304; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_K = (__pyx_v_K / __pyx_t_16);
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":587
- *         val = input[i - win + 1]
- * 
- *         for j from (i - win + 1) <= j <= i:             # <<<<<<<<<<<<<<
- *             val = max(val, input[j])
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":306
+ *             K = K / ((nobs - 2.)*(nobs-3.))
  * 
+ *             output[i] = K             # <<<<<<<<<<<<<<
+ *         else:
+ *             output[i] = NaN
  */
-    __pyx_t_3 = __pyx_v_i;
-    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_3; __pyx_v_j++) {
+      __pyx_t_14 = __pyx_v_i;
+      __pyx_t_17 = -1;
+      if (__pyx_t_14 < 0) {
+        __pyx_t_14 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_14 < 0)) __pyx_t_17 = 0;
+      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+      if (unlikely(__pyx_t_17 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_17);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 306; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = __pyx_v_K;
+      goto __pyx_L15;
+    }
+    /*else*/ {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":588
- * 
- *         for j from (i - win + 1) <= j <= i:
- *             val = max(val, input[j])             # <<<<<<<<<<<<<<
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":308
+ *             output[i] = K
+ *         else:
+ *             output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- *         output[j] = val
+ *     return output
  */
-      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = PyFloat_FromDouble((__pyx_v_input[__pyx_v_j])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_6);
-      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
-      __Pyx_GIVEREF(__pyx_t_4);
-      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_5);
-      __pyx_t_4 = 0;
-      __pyx_t_5 = 0;
-      __pyx_t_5 = PyObject_Call(__pyx_builtin_max, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_v_val = __pyx_t_7;
+      __pyx_t_17 = __pyx_v_i;
+      __pyx_t_18 = -1;
+      if (__pyx_t_17 < 0) {
+        __pyx_t_17 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_17 < 0)) __pyx_t_18 = 0;
+      } else if (unlikely(__pyx_t_17 >= __pyx_bshape_0_output)) __pyx_t_18 = 0;
+      if (unlikely(__pyx_t_18 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_18);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 308; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_17, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
     }
+    __pyx_L15:;
+  }
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":590
- *             val = max(val, input[j])
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":310
+ *             output[i] = NaN
  * 
- *         output[j] = val             # <<<<<<<<<<<<<<
+ *     return output             # <<<<<<<<<<<<<<
  * 
- * def _roll_max_noncontig(ndarray[double_t, ndim=1] input,
+ * #-------------------------------------------------------------------------------
  */
-    (__pyx_v_output[__pyx_v_j]) = __pyx_v_val;
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
 
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_WriteUnraisable("tseries._roll_max");
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._roll_kurt");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __pyx_L2:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":592
- *         output[j] = val
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":315
+ * # Rolling median
+ * 
+ * def _roll_median(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *                  int win, int minp):
  * 
- * def _roll_max_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int N):
  */
 
-static PyObject *__pyx_pf_7tseries__roll_max_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_max_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries__roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
   int __pyx_v_win;
-  int __pyx_v_N;
+  int __pyx_v_minp;
   double __pyx_v_val;
+  double __pyx_v_prev;
+  double __pyx_v_midpoint;
+  struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_skiplist;
+  int __pyx_v_nobs;
   int __pyx_v_i;
-  int __pyx_v_j;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   Py_buffer __pyx_bstruct_output;
   Py_ssize_t __pyx_bstride_0_output = 0;
   Py_ssize_t __pyx_bshape_0_output = 0;
@@ -12016,24 +10097,31 @@ static PyObject *__pyx_pf_7tseries__roll_max_noncontig(PyObject *__pyx_self, PyO
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  long __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
+  PyArrayObject *__pyx_t_6 = NULL;
   int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  double __pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_max_noncontig");
+  long __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  int __pyx_t_13;
+  int __pyx_t_14;
+  __pyx_t_5numpy_double_t __pyx_t_15;
+  int __pyx_t_16;
+  int __pyx_t_17;
+  int __pyx_t_18;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("_roll_median");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[4] = {0,0,0,0};
+    PyObject* values[3] = {0,0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
       case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
@@ -12046,350 +10134,615 @@ static PyObject *__pyx_pf_7tseries__roll_max_noncontig(PyObject *__pyx_self, PyO
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_max_noncontig", 1, 4, 4, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_median", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
+      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
       if (likely(values[2])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_max_noncontig", 1, 4, 4, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_max_noncontig", 1, 4, 4, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_median", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_max_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_median") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 594; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 316; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_max_noncontig", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_median", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_max_noncontig");
+  __Pyx_AddTraceback("tseries._roll_median");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
+  __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)Py_None); __Pyx_INCREF(Py_None);
   __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 593; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 315; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":320
+ *     cdef double val, prev, midpoint
+ *     cdef IndexableSkiplist skiplist
+ *     cdef int nobs = 0, i             # <<<<<<<<<<<<<<
+ *     cdef int N = len(input)
+ * 
+ */
+  __pyx_v_nobs = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":321
+ *     cdef IndexableSkiplist skiplist
+ *     cdef int nobs = 0, i
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 321; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":323
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     skiplist = IndexableSkiplist(win)
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 592; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
   }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":325
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ * 
+ *     skiplist = IndexableSkiplist(win)             # <<<<<<<<<<<<<<
+ * 
+ *     if minp > N:
+ */
+  __pyx_t_5 = PyInt_FromLong(__pyx_v_win); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
+  __Pyx_GIVEREF(__pyx_t_5);
+  __pyx_t_5 = 0;
+  __pyx_t_5 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_IndexableSkiplist)), __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 325; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_v_skiplist));
+  __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":598
- *     cdef int i, j
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":327
+ *     skiplist = IndexableSkiplist(win)
  * 
- *     for i from 0 <= i < win - 1:             # <<<<<<<<<<<<<<
- *         output[i] = NaN
+ *     if minp > N:             # <<<<<<<<<<<<<<
+ *         minp = N + 1
  * 
  */
-  __pyx_t_1 = (__pyx_v_win - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {
+  __pyx_t_7 = (__pyx_v_minp > __pyx_v_N);
+  if (__pyx_t_7) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":599
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":328
  * 
- *     for i from 0 <= i < win - 1:
- *         output[i] = NaN             # <<<<<<<<<<<<<<
+ *     if minp > N:
+ *         minp = N + 1             # <<<<<<<<<<<<<<
  * 
- *     for i from win - 1 <= i < N:
+ *     for i from 0 <= i < minp - 1:
  */
-    __pyx_t_2 = __pyx_v_i;
-    __pyx_t_3 = -1;
-    if (__pyx_t_2 < 0) {
-      __pyx_t_2 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
-    } else if (unlikely(__pyx_t_2 >= __pyx_bshape_0_output)) __pyx_t_3 = 0;
-    if (unlikely(__pyx_t_3 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 599; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_2, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_v_minp = (__pyx_v_N + 1);
+    goto __pyx_L6;
   }
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":601
- *         output[i] = NaN
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":330
+ *         minp = N + 1
  * 
- *     for i from win - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i - win + 1]
+ *     for i from 0 <= i < minp - 1:             # <<<<<<<<<<<<<<
+ *         val = input[i]
  * 
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_t_8 = (__pyx_v_minp - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_8; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":602
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":331
  * 
- *     for i from win - 1 <= i < N:
- *         val = input[i - win + 1]             # <<<<<<<<<<<<<<
+ *     for i from 0 <= i < minp - 1:
+ *         val = input[i]             # <<<<<<<<<<<<<<
  * 
- *         for j from (i - win + 1) <= j <= i:
+ *         # Not NaN
  */
-    __pyx_t_1 = ((__pyx_v_i - __pyx_v_win) + 1);
-    __pyx_t_4 = -1;
-    if (__pyx_t_1 < 0) {
-      __pyx_t_1 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_1 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_1 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 602; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_9 = __pyx_v_i;
+    __pyx_t_10 = -1;
+    if (__pyx_t_9 < 0) {
+      __pyx_t_9 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_9 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_1, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_9, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":604
- *         val = input[i - win + 1]
- * 
- *         for j from (i - win + 1) <= j <= i:             # <<<<<<<<<<<<<<
- *             val = max(val, input[j])
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":334
  * 
+ *         # Not NaN
+ *         if val == val:             # <<<<<<<<<<<<<<
+ *             nobs += 1
+ *             skiplist.insert(val)
  */
-    __pyx_t_4 = __pyx_v_i;
-    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_4; __pyx_v_j++) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":605
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":335
+ *         # Not NaN
+ *         if val == val:
+ *             nobs += 1             # <<<<<<<<<<<<<<
+ *             skiplist.insert(val)
  * 
- *         for j from (i - win + 1) <= j <= i:
- *             val = max(val, input[j])             # <<<<<<<<<<<<<<
+ */
+      __pyx_v_nobs += 1;
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":336
+ *         if val == val:
+ *             nobs += 1
+ *             skiplist.insert(val)             # <<<<<<<<<<<<<<
  * 
- *         output[j] = val
+ *         output[i] = NaN
  */
-      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__insert); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __pyx_v_j;
-      __pyx_t_7 = -1;
-      if (__pyx_t_6 < 0) {
-        __pyx_t_6 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-      } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-      if (unlikely(__pyx_t_7 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_7);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_t_8 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input))); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_9);
-      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
-      __Pyx_GIVEREF(__pyx_t_8);
-      __pyx_t_5 = 0;
-      __pyx_t_8 = 0;
-      __pyx_t_8 = PyObject_Call(__pyx_builtin_max, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 605; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_v_val = __pyx_t_10;
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+      __Pyx_GIVEREF(__pyx_t_2);
+      __pyx_t_2 = 0;
+      __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      goto __pyx_L9;
     }
+    __pyx_L9:;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":607
- *             val = max(val, input[j])
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":338
+ *             skiplist.insert(val)
  * 
- *         output[j] = val             # <<<<<<<<<<<<<<
+ *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- * cdef void _roll_min(double_t *input, double_t *output,
+ *     for i from minp - 1 <= i < N:
  */
-    __pyx_t_4 = __pyx_v_j;
-    __pyx_t_7 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 607; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_10 = __pyx_v_i;
+    __pyx_t_11 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_11 = 0;
+    if (unlikely(__pyx_t_11 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_11);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 338; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_val;
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_9);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_max_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":609
- *         output[j] = val
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":340
+ *         output[i] = NaN
+ * 
+ *     for i from minp - 1 <= i < N:             # <<<<<<<<<<<<<<
+ *         val = input[i]
  * 
- * cdef void _roll_min(double_t *input, double_t *output,             # <<<<<<<<<<<<<<
- *                     int win, int N):
- *     cdef double val
  */
+  __pyx_t_11 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_minp - 1); __pyx_v_i < __pyx_t_11; __pyx_v_i++) {
 
-static  void __pyx_f_7tseries__roll_min(__pyx_t_5numpy_double_t *__pyx_v_input, __pyx_t_5numpy_double_t *__pyx_v_output, int __pyx_v_win, int __pyx_v_N) {
-  double __pyx_v_val;
-  int __pyx_v_i;
-  int __pyx_v_j;
-  long __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  double __pyx_t_7;
-  __Pyx_RefNannySetupContext("_roll_min");
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":614
- *     cdef int i, j
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":341
  * 
- *     for i from 0 <= i < win - 1:             # <<<<<<<<<<<<<<
- *         output[i] = NaN
+ *     for i from minp - 1 <= i < N:
+ *         val = input[i]             # <<<<<<<<<<<<<<
  * 
+ *         if i > win - 1:
  */
-  __pyx_t_1 = (__pyx_v_win - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {
+    __pyx_t_12 = __pyx_v_i;
+    __pyx_t_13 = -1;
+    if (__pyx_t_12 < 0) {
+      __pyx_t_12 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
+    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_input)) __pyx_t_13 = 0;
+    if (unlikely(__pyx_t_13 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_13);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_12, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":615
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":343
+ *         val = input[i]
  * 
- *     for i from 0 <= i < win - 1:
- *         output[i] = NaN             # <<<<<<<<<<<<<<
+ *         if i > win - 1:             # <<<<<<<<<<<<<<
+ *             prev = input[i - win]
  * 
- *     for i from win - 1 <= i < N:
  */
-    (__pyx_v_output[__pyx_v_i]) = __pyx_v_7tseries_NaN;
-  }
+    __pyx_t_7 = (__pyx_v_i > (__pyx_v_win - 1));
+    if (__pyx_t_7) {
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":617
- *         output[i] = NaN
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":344
  * 
- *     for i from win - 1 <= i < N:             # <<<<<<<<<<<<<<
- *         val = input[i - win + 1]
+ *         if i > win - 1:
+ *             prev = input[i - win]             # <<<<<<<<<<<<<<
  * 
+ *             if prev == prev:
  */
-  __pyx_t_2 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_2; __pyx_v_i++) {
+      __pyx_t_13 = (__pyx_v_i - __pyx_v_win);
+      __pyx_t_14 = -1;
+      if (__pyx_t_13 < 0) {
+        __pyx_t_13 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
+      } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_input)) __pyx_t_14 = 0;
+      if (unlikely(__pyx_t_14 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_14);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_v_prev = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_13, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":618
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":346
+ *             prev = input[i - win]
  * 
- *     for i from win - 1 <= i < N:
- *         val = input[i - win + 1]             # <<<<<<<<<<<<<<
+ *             if prev == prev:             # <<<<<<<<<<<<<<
+ *                 skiplist.remove(prev)
+ *                 nobs -= 1
+ */
+      __pyx_t_7 = (__pyx_v_prev == __pyx_v_prev);
+      if (__pyx_t_7) {
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":347
+ * 
+ *             if prev == prev:
+ *                 skiplist.remove(prev)             # <<<<<<<<<<<<<<
+ *                 nobs -= 1
  * 
- *         for j from (i - win + 1) <= j <= i:
  */
-    __pyx_v_val = (__pyx_v_input[((__pyx_v_i - __pyx_v_win) + 1)]);
+        __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__remove); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_prev); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
+        __Pyx_GIVEREF(__pyx_t_4);
+        __pyx_t_4 = 0;
+        __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 347; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":620
- *         val = input[i - win + 1]
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":348
+ *             if prev == prev:
+ *                 skiplist.remove(prev)
+ *                 nobs -= 1             # <<<<<<<<<<<<<<
  * 
- *         for j from (i - win + 1) <= j <= i:             # <<<<<<<<<<<<<<
- *             val = min(val, input[j])
+ *         if val == val:
+ */
+        __pyx_v_nobs -= 1;
+        goto __pyx_L13;
+      }
+      __pyx_L13:;
+      goto __pyx_L12;
+    }
+    __pyx_L12:;
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":350
+ *                 nobs -= 1
  * 
+ *         if val == val:             # <<<<<<<<<<<<<<
+ *             nobs += 1
+ *             skiplist.insert(val)
  */
-    __pyx_t_3 = __pyx_v_i;
-    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_3; __pyx_v_j++) {
+    __pyx_t_7 = (__pyx_v_val == __pyx_v_val);
+    if (__pyx_t_7) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":621
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":351
  * 
- *         for j from (i - win + 1) <= j <= i:
- *             val = min(val, input[j])             # <<<<<<<<<<<<<<
+ *         if val == val:
+ *             nobs += 1             # <<<<<<<<<<<<<<
+ *             skiplist.insert(val)
  * 
- *         output[j] = val
  */
-      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_v_nobs += 1;
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":352
+ *         if val == val:
+ *             nobs += 1
+ *             skiplist.insert(val)             # <<<<<<<<<<<<<<
+ * 
+ *         if nobs >= minp:
+ */
+      __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__insert); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = PyFloat_FromDouble((__pyx_v_input[__pyx_v_j])); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_6);
-      PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
-      __Pyx_GIVEREF(__pyx_t_4);
-      PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_5);
+      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_5);
-      __pyx_t_4 = 0;
       __pyx_t_5 = 0;
-      __pyx_t_5 = PyObject_Call(__pyx_builtin_min, __pyx_t_6, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 352; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_7 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_v_val = __pyx_t_7;
+      goto __pyx_L14;
+    }
+    __pyx_L14:;
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":354
+ *             skiplist.insert(val)
+ * 
+ *         if nobs >= minp:             # <<<<<<<<<<<<<<
+ *             midpoint = nobs / 2
+ *             if nobs % 2:
+ */
+    __pyx_t_7 = (__pyx_v_nobs >= __pyx_v_minp);
+    if (__pyx_t_7) {
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":355
+ * 
+ *         if nobs >= minp:
+ *             midpoint = nobs / 2             # <<<<<<<<<<<<<<
+ *             if nobs % 2:
+ *                 output[i] = skiplist.get(midpoint)
+ */
+      __pyx_v_midpoint = __Pyx_div_long(__pyx_v_nobs, 2);
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":356
+ *         if nobs >= minp:
+ *             midpoint = nobs / 2
+ *             if nobs % 2:             # <<<<<<<<<<<<<<
+ *                 output[i] = skiplist.get(midpoint)
+ *             else:
+ */
+      __pyx_t_8 = __Pyx_mod_long(__pyx_v_nobs, 2);
+      if (__pyx_t_8) {
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":357
+ *             midpoint = nobs / 2
+ *             if nobs % 2:
+ *                 output[i] = skiplist.get(midpoint)             # <<<<<<<<<<<<<<
+ *             else:
+ *                 output[i] = (skiplist.get(midpoint) +
+ */
+        __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        __pyx_t_2 = PyFloat_FromDouble(__pyx_v_midpoint); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+        __Pyx_GIVEREF(__pyx_t_2);
+        __pyx_t_2 = 0;
+        __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __pyx_t_15 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __pyx_t_14 = __pyx_v_i;
+        __pyx_t_16 = -1;
+        if (__pyx_t_14 < 0) {
+          __pyx_t_14 += __pyx_bshape_0_output;
+          if (unlikely(__pyx_t_14 < 0)) __pyx_t_16 = 0;
+        } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_output)) __pyx_t_16 = 0;
+        if (unlikely(__pyx_t_16 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_16);
+          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_14, __pyx_bstride_0_output) = __pyx_t_15;
+        goto __pyx_L16;
+      }
+      /*else*/ {
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":359
+ *                 output[i] = skiplist.get(midpoint)
+ *             else:
+ *                 output[i] = (skiplist.get(midpoint) +             # <<<<<<<<<<<<<<
+ *                              skiplist.get(midpoint - 1)) / 2
+ *         else:
+ */
+        __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_midpoint); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
+        __Pyx_GIVEREF(__pyx_t_4);
+        __pyx_t_4 = 0;
+        __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_4);
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":360
+ *             else:
+ *                 output[i] = (skiplist.get(midpoint) +
+ *                              skiplist.get(midpoint - 1)) / 2             # <<<<<<<<<<<<<<
+ *         else:
+ *             output[i] = NaN
+ */
+        __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_5);
+        __pyx_t_2 = PyFloat_FromDouble((__pyx_v_midpoint - 1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+        __Pyx_GIVEREF(__pyx_t_2);
+        __pyx_t_2 = 0;
+        __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_3);
+        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+        __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_GOTREF(__pyx_t_2);
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        __pyx_t_15 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+        /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":359
+ *                 output[i] = skiplist.get(midpoint)
+ *             else:
+ *                 output[i] = (skiplist.get(midpoint) +             # <<<<<<<<<<<<<<
+ *                              skiplist.get(midpoint - 1)) / 2
+ *         else:
+ */
+        __pyx_t_16 = __pyx_v_i;
+        __pyx_t_17 = -1;
+        if (__pyx_t_16 < 0) {
+          __pyx_t_16 += __pyx_bshape_0_output;
+          if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
+        } else if (unlikely(__pyx_t_16 >= __pyx_bshape_0_output)) __pyx_t_17 = 0;
+        if (unlikely(__pyx_t_17 != -1)) {
+          __Pyx_RaiseBufferIndexError(__pyx_t_17);
+          {__pyx_filename = __pyx_f[2]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        }
+        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_16, __pyx_bstride_0_output) = __pyx_t_15;
+      }
+      __pyx_L16:;
+      goto __pyx_L15;
+    }
+    /*else*/ {
+
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":362
+ *                              skiplist.get(midpoint - 1)) / 2
+ *         else:
+ *             output[i] = NaN             # <<<<<<<<<<<<<<
+ * 
+ *     return output
+ */
+      __pyx_t_17 = __pyx_v_i;
+      __pyx_t_18 = -1;
+      if (__pyx_t_17 < 0) {
+        __pyx_t_17 += __pyx_bshape_0_output;
+        if (unlikely(__pyx_t_17 < 0)) __pyx_t_18 = 0;
+      } else if (unlikely(__pyx_t_17 >= __pyx_bshape_0_output)) __pyx_t_18 = 0;
+      if (unlikely(__pyx_t_18 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_18);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_17, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
     }
+    __pyx_L15:;
+  }
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":623
- *             val = min(val, input[j])
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":364
+ *             output[i] = NaN
  * 
- *         output[j] = val             # <<<<<<<<<<<<<<
+ *     return output             # <<<<<<<<<<<<<<
  * 
- * def _roll_min_noncontig(ndarray[double_t, ndim=1] input,
+ * #-------------------------------------------------------------------------------
  */
-    (__pyx_v_output[__pyx_v_j]) = __pyx_v_val;
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
 
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_WriteUnraisable("tseries._roll_min");
+  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
+    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
+  __Pyx_AddTraceback("tseries._roll_median");
+  __pyx_r = NULL;
+  goto __pyx_L2;
   __pyx_L0:;
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
+  __pyx_L2:;
+  __Pyx_DECREF((PyObject *)__pyx_v_skiplist);
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":625
- *         output[j] = val
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":369
+ * # Rolling min / max
  * 
- * def _roll_min_noncontig(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
- *                         ndarray[double_t, ndim=1] output,
- *                         int win, int N):
+ * def _roll_max(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win):
+ *     cdef double val
  */
 
-static PyObject *__pyx_pf_7tseries__roll_min_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries__roll_min_noncontig(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries__roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_max(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyArrayObject *__pyx_v_output = 0;
   int __pyx_v_win;
-  int __pyx_v_N;
   double __pyx_v_val;
   int __pyx_v_i;
   int __pyx_v_j;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
   Py_buffer __pyx_bstruct_output;
   Py_ssize_t __pyx_bstride_0_output = 0;
   Py_ssize_t __pyx_bshape_0_output = 0;
@@ -12397,25 +10750,26 @@ static PyObject *__pyx_pf_7tseries__roll_min_noncontig(PyObject *__pyx_self, PyO
   Py_ssize_t __pyx_bstride_0_input = 0;
   Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
-  long __pyx_t_1;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
+  Py_ssize_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  int __pyx_t_6;
-  int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  double __pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__output,&__pyx_n_s__win,&__pyx_n_s__N,0};
-  __Pyx_RefNannySetupContext("_roll_min_noncontig");
+  PyArrayObject *__pyx_t_6 = NULL;
+  long __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
+  int __pyx_t_11;
+  int __pyx_t_12;
+  double __pyx_t_13;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,0};
+  __Pyx_RefNannySetupContext("_roll_max");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[4] = {0,0,0,0};
+    PyObject* values[2] = {0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -12427,511 +10781,280 @@ static PyObject *__pyx_pf_7tseries__roll_min_noncontig(PyObject *__pyx_self, PyO
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__output);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("_roll_min_noncontig", 1, 4, 4, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_min_noncontig", 1, 4, 4, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  3:
-      values[3] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__N);
-      if (likely(values[3])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("_roll_min_noncontig", 1, 4, 4, 3); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_max", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_min_noncontig") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_max") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_output = ((PyArrayObject *)values[1]);
-    __pyx_v_win = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(values[3]); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
     __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_output = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 1));
-    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_N = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_N == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 627; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_roll_min_noncontig", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_max", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries._roll_min_noncontig");
+  __Pyx_AddTraceback("tseries._roll_max");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF((PyObject *)__pyx_v_output);
-  __pyx_bstruct_input.buf = NULL;
   __pyx_bstruct_output.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_output), __pyx_ptype_5numpy_ndarray, 1, "output", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 626; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
   __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":373
+ *     cdef double val
+ *     cdef int i, j
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
+ */
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 373; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":375
+ *     cdef int N = len(input)
+ * 
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
+ * 
+ *     for i from 0 <= i < win - 1:
+ */
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_v_output, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 625; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 375; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+    }
   }
-  __pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
-  __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
+  __pyx_t_6 = 0;
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
+  __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":631
- *     cdef int i, j
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":377
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
  *     for i from 0 <= i < win - 1:             # <<<<<<<<<<<<<<
  *         output[i] = NaN
  * 
  */
-  __pyx_t_1 = (__pyx_v_win - 1);
-  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_1; __pyx_v_i++) {
+  __pyx_t_7 = (__pyx_v_win - 1);
+  for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":632
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":378
  * 
  *     for i from 0 <= i < win - 1:
  *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
  *     for i from win - 1 <= i < N:
  */
-    __pyx_t_2 = __pyx_v_i;
-    __pyx_t_3 = -1;
-    if (__pyx_t_2 < 0) {
-      __pyx_t_2 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
-    } else if (unlikely(__pyx_t_2 >= __pyx_bshape_0_output)) __pyx_t_3 = 0;
-    if (unlikely(__pyx_t_3 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 632; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_2, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
+    __pyx_t_8 = __pyx_v_i;
+    __pyx_t_9 = -1;
+    if (__pyx_t_8 < 0) {
+      __pyx_t_8 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
+    } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
+    if (unlikely(__pyx_t_9 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_9);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    }
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":634
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":380
  *         output[i] = NaN
  * 
  *     for i from win - 1 <= i < N:             # <<<<<<<<<<<<<<
  *         val = input[i - win + 1]
  * 
  */
-  __pyx_t_3 = __pyx_v_N;
-  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_3; __pyx_v_i++) {
+  __pyx_t_9 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":635
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":381
  * 
  *     for i from win - 1 <= i < N:
  *         val = input[i - win + 1]             # <<<<<<<<<<<<<<
  * 
  *         for j from (i - win + 1) <= j <= i:
  */
-    __pyx_t_1 = ((__pyx_v_i - __pyx_v_win) + 1);
-    __pyx_t_4 = -1;
-    if (__pyx_t_1 < 0) {
-      __pyx_t_1 += __pyx_bshape_0_input;
-      if (unlikely(__pyx_t_1 < 0)) __pyx_t_4 = 0;
-    } else if (unlikely(__pyx_t_1 >= __pyx_bshape_0_input)) __pyx_t_4 = 0;
-    if (unlikely(__pyx_t_4 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_4);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 635; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((__pyx_v_i - __pyx_v_win) + 1);
+    __pyx_t_10 = -1;
+    if (__pyx_t_7 < 0) {
+      __pyx_t_7 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_7 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_1, __pyx_bstride_0_input));
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":637
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":383
  *         val = input[i - win + 1]
  * 
  *         for j from (i - win + 1) <= j <= i:             # <<<<<<<<<<<<<<
- *             val = min(val, input[j])
+ *             val = max(val, input[j])
  * 
  */
-    __pyx_t_4 = __pyx_v_i;
-    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_4; __pyx_v_j++) {
+    __pyx_t_10 = __pyx_v_i;
+    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_10; __pyx_v_j++) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":638
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":384
  * 
  *         for j from (i - win + 1) <= j <= i:
- *             val = min(val, input[j])             # <<<<<<<<<<<<<<
+ *             val = max(val, input[j])             # <<<<<<<<<<<<<<
  * 
  *         output[j] = val
  */
-      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __pyx_v_j;
-      __pyx_t_7 = -1;
-      if (__pyx_t_6 < 0) {
-        __pyx_t_6 += __pyx_bshape_0_input;
-        if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
-      } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_input)) __pyx_t_7 = 0;
-      if (unlikely(__pyx_t_7 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_7);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      __pyx_t_8 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_6, __pyx_bstride_0_input))); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_9);
-      PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
-      __Pyx_GIVEREF(__pyx_t_8);
-      __pyx_t_5 = 0;
-      __pyx_t_8 = 0;
-      __pyx_t_8 = PyObject_Call(__pyx_builtin_min, __pyx_t_9, NULL); if (unlikely(!__pyx_t_8)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_8); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 638; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_v_val = __pyx_t_10;
-    }
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":640
- *             val = min(val, input[j])
- * 
- *         output[j] = val             # <<<<<<<<<<<<<<
- * 
- * def roll_median(ndarray[npy_float64, ndim=1] arr, int window, int minp):
- */
-    __pyx_t_4 = __pyx_v_j;
-    __pyx_t_7 = -1;
-    if (__pyx_t_4 < 0) {
-      __pyx_t_4 += __pyx_bshape_0_output;
-      if (unlikely(__pyx_t_4 < 0)) __pyx_t_7 = 0;
-    } else if (unlikely(__pyx_t_4 >= __pyx_bshape_0_output)) __pyx_t_7 = 0;
-    if (unlikely(__pyx_t_7 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 640; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_4, __pyx_bstride_0_output) = __pyx_v_val;
-  }
-
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_9);
-  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
-    __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries._roll_min_noncontig");
-  __pyx_r = NULL;
-  goto __pyx_L2;
-  __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
-  __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF((PyObject *)__pyx_v_output);
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":642
- *         output[j] = val
- * 
- * def roll_median(ndarray[npy_float64, ndim=1] arr, int window, int minp):             # <<<<<<<<<<<<<<
- *     cdef char *mask_data
- *     cdef ndarray mask
- */
-
-static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_roll_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_arr = 0;
-  int __pyx_v_window;
-  int __pyx_v_minp;
-  char *__pyx_v_mask_data;
-  PyArrayObject *__pyx_v_mask;
-  PyArrayObject *__pyx_v_result;
-  int __pyx_v_i;
-  int __pyx_v_n;
-  Py_buffer __pyx_bstruct_arr;
-  Py_ssize_t __pyx_bstride_0_arr = 0;
-  Py_ssize_t __pyx_bshape_0_arr = 0;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
-  PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyArrayObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  PyArrayObject *__pyx_t_11 = NULL;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__arr,&__pyx_n_s__window,&__pyx_n_s__minp,0};
-  __Pyx_RefNannySetupContext("roll_median");
-  __pyx_self = __pyx_self;
-  if (unlikely(__pyx_kwds)) {
-    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      case  0: break;
-      default: goto __pyx_L5_argtuple_error;
-    }
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__arr);
-      if (likely(values[0])) kw_args--;
-      else goto __pyx_L5_argtuple_error;
-      case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
-      if (likely(values[1])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("roll_median", 1, 3, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      values[2] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-      if (likely(values[2])) kw_args--;
-      else {
-        __Pyx_RaiseArgtupleInvalid("roll_median", 1, 3, 3, 2); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-    }
-    if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "roll_median") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    }
-    __pyx_v_arr = ((PyArrayObject *)values[0]);
-    __pyx_v_window = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_window == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(values[2]); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
-    goto __pyx_L5_argtuple_error;
-  } else {
-    __pyx_v_arr = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_window = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_window == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-    __pyx_v_minp = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely((__pyx_v_minp == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("roll_median", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.roll_median");
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_arr);
-  __pyx_v_mask = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_result.buf = NULL;
-  __pyx_bstruct_arr.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_arr, (PyObject*)__pyx_v_arr, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 642; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
-  __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":648
- *     cdef int i, n
- * 
- *     n = len(arr)             # <<<<<<<<<<<<<<
- *     arr = arr.copy()
- * 
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_arr)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 648; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":649
- * 
- *     n = len(arr)
- *     arr = arr.copy()             # <<<<<<<<<<<<<<
- * 
- *     mask = <ndarray> np.isfinite(arr)
- */
-  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_arr), __pyx_n_s__copy); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_Call(__pyx_t_2, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_3) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_4 = ((PyArrayObject *)__pyx_t_3);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
-    __pyx_t_5 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_arr, (PyObject*)__pyx_t_4, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_5 < 0)) {
-      PyErr_Fetch(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_arr, (PyObject*)__pyx_v_arr, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_6); Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-      }
-    }
-    __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
-    __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
-    if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 649; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  }
-  __pyx_t_4 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_arr));
-  __pyx_v_arr = ((PyArrayObject *)__pyx_t_3);
-  __pyx_t_3 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":651
- *     arr = arr.copy()
- * 
- *     mask = <ndarray> np.isfinite(arr)             # <<<<<<<<<<<<<<
- *     mask_data = <char *> mask.data
- * 
- */
-  __pyx_t_3 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__isfinite); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(((PyObject *)__pyx_v_arr));
-  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_arr));
-  __Pyx_GIVEREF(((PyObject *)__pyx_v_arr));
-  __pyx_t_9 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 651; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_INCREF(((PyObject *)((PyArrayObject *)__pyx_t_9)));
-  __Pyx_DECREF(((PyObject *)__pyx_v_mask));
-  __pyx_v_mask = ((PyArrayObject *)__pyx_t_9);
-  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":652
- * 
- *     mask = <ndarray> np.isfinite(arr)
- *     mask_data = <char *> mask.data             # <<<<<<<<<<<<<<
- * 
- *     result = np.empty(len(arr), dtype=float)
- */
-  __pyx_v_mask_data = ((char *)__pyx_v_mask->data);
+      __pyx_t_11 = __pyx_v_j;
+      __pyx_t_12 = -1;
+      if (__pyx_t_11 < 0) {
+        __pyx_t_11 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
+      } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_input)) __pyx_t_12 = 0;
+      if (unlikely(__pyx_t_12 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_12);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_11, __pyx_bstride_0_input))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
+      __Pyx_GIVEREF(__pyx_t_5);
+      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
+      __Pyx_GIVEREF(__pyx_t_2);
+      __pyx_t_5 = 0;
+      __pyx_t_2 = 0;
+      __pyx_t_2 = PyObject_Call(__pyx_builtin_max, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_v_val = __pyx_t_13;
+    }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":654
- *     mask_data = <char *> mask.data
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":386
+ *             val = max(val, input[j])
  * 
- *     result = np.empty(len(arr), dtype=float)             # <<<<<<<<<<<<<<
+ *         output[j] = val             # <<<<<<<<<<<<<<
  * 
- *     for i from minp <= i <= n:
+ *     return output
  */
-  __pyx_t_9 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_9, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_arr)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_9);
-  __Pyx_GIVEREF(__pyx_t_9);
-  __pyx_t_9 = 0;
-  __pyx_t_9 = PyDict_New(); if (unlikely(!__pyx_t_9)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_9));
-  if (PyDict_SetItem(__pyx_t_9, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_10 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_2, ((PyObject *)__pyx_t_9)); if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_10);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_9)); __pyx_t_9 = 0;
-  if (!(likely(((__pyx_t_10) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_10, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_11 = ((PyArrayObject *)__pyx_t_10);
-  {
-    __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-    __pyx_t_5 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_11, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_5 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_7, &__pyx_t_6);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_nn_npy_float64, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_6);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_7, __pyx_t_6);
-      }
+    __pyx_t_10 = __pyx_v_j;
+    __pyx_t_12 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_12 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_12 = 0;
+    if (unlikely(__pyx_t_12 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_12);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-    if (unlikely(__pyx_t_5 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 654; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_val;
   }
-  __pyx_t_11 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_result));
-  __pyx_v_result = ((PyArrayObject *)__pyx_t_10);
-  __pyx_t_10 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":656
- *     result = np.empty(len(arr), dtype=float)
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":388
+ *         output[j] = val
  * 
- *     for i from minp <= i <= n:             # <<<<<<<<<<<<<<
- *         pass
+ *     return output             # <<<<<<<<<<<<<<
  * 
+ * def _roll_min(ndarray[double_t, ndim=1] input,
  */
-  __pyx_t_5 = __pyx_v_n;
-  for (__pyx_v_i = __pyx_v_minp; __pyx_v_i <= __pyx_t_5; __pyx_v_i++) {
-  }
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
+  goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.roll_median");
+  __Pyx_AddTraceback("tseries._roll_max");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_mask);
-  __Pyx_DECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_arr);
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":659
- *         pass
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":390
+ *     return output
  * 
- * def rolling_median(ndarray[double, ndim=1] arr, int window):             # <<<<<<<<<<<<<<
- *     cdef int i, n, midpoint
- *     cdef IndexableSkiplist skiplist
+ * def _roll_min(ndarray[double_t, ndim=1] input,             # <<<<<<<<<<<<<<
+ *               int win):
+ *     cdef double val
  */
 
-static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyArrayObject *__pyx_v_arr = 0;
-  int __pyx_v_window;
+static PyObject *__pyx_pf_7tseries__roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries__roll_min(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  int __pyx_v_win;
+  double __pyx_v_val;
   int __pyx_v_i;
-  int __pyx_v_n;
-  int __pyx_v_midpoint;
-  struct __pyx_obj_7tseries_IndexableSkiplist *__pyx_v_skiplist;
-  PyArrayObject *__pyx_v_result;
-  int __pyx_v_flag;
-  Py_buffer __pyx_bstruct_arr;
-  Py_ssize_t __pyx_bstride_0_arr = 0;
-  Py_ssize_t __pyx_bshape_0_arr = 0;
-  Py_buffer __pyx_bstruct_result;
-  Py_ssize_t __pyx_bstride_0_result = 0;
-  Py_ssize_t __pyx_bshape_0_result = 0;
+  int __pyx_v_j;
+  int __pyx_v_N;
+  PyArrayObject *__pyx_v_output = 0;
+  Py_buffer __pyx_bstruct_output;
+  Py_ssize_t __pyx_bstride_0_output = 0;
+  Py_ssize_t __pyx_bshape_0_output = 0;
+  Py_buffer __pyx_bstruct_input;
+  Py_ssize_t __pyx_bstride_0_input = 0;
+  Py_ssize_t __pyx_bshape_0_input = 0;
   PyObject *__pyx_r = NULL;
   Py_ssize_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
@@ -12939,19 +11062,15 @@ static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyArrayObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
+  long __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_t_12;
-  int __pyx_t_13;
-  int __pyx_t_14;
-  double __pyx_t_15;
-  int __pyx_t_16;
-  int __pyx_t_17;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__arr,&__pyx_n_s__window,0};
-  __Pyx_RefNannySetupContext("rolling_median");
+  double __pyx_t_13;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__win,0};
+  __Pyx_RefNannySetupContext("_roll_min");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
@@ -12964,406 +11083,233 @@ static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject
     }
     switch (PyTuple_GET_SIZE(__pyx_args)) {
       case  0:
-      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__arr);
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__win);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_median", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("_roll_min", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_median") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "_roll_min") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
-    __pyx_v_arr = ((PyArrayObject *)values[0]);
-    __pyx_v_window = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_window == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_input = ((PyArrayObject *)values[0]);
+    __pyx_v_win = __Pyx_PyInt_AsInt(values[1]); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
     goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_arr = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_window = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_window == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_win = __Pyx_PyInt_AsInt(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely((__pyx_v_win == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_median", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("_roll_min", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.rolling_median");
+  __Pyx_AddTraceback("tseries._roll_min");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __Pyx_INCREF((PyObject *)__pyx_v_arr);
-  __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_v_result = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None);
-  __pyx_bstruct_result.buf = NULL;
-  __pyx_bstruct_arr.buf = NULL;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_arr), __pyx_ptype_5numpy_ndarray, 1, "arr", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF((PyObject *)__pyx_v_input);
+  __pyx_bstruct_output.buf = NULL;
+  __pyx_bstruct_input.buf = NULL;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_arr, (PyObject*)__pyx_v_arr, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 659; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_input, (PyObject*)__pyx_v_input, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 390; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
-  __pyx_bstride_0_arr = __pyx_bstruct_arr.strides[0];
-  __pyx_bshape_0_arr = __pyx_bstruct_arr.shape[0];
+  __pyx_bstride_0_input = __pyx_bstruct_input.strides[0];
+  __pyx_bshape_0_input = __pyx_bstruct_input.shape[0];
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":664
- *     cdef ndarray[double, ndim=1] result
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":394
+ *     cdef double val
+ *     cdef int i, j
+ *     cdef int N = len(input)             # <<<<<<<<<<<<<<
  * 
- *     n = len(arr)             # <<<<<<<<<<<<<<
- *     skiplist = IndexableSkiplist(window)
- *     result = np.empty(n, dtype=float)
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_arr)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 664; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_n = __pyx_t_1;
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 394; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_v_N = __pyx_t_1;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":665
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":396
+ *     cdef int N = len(input)
  * 
- *     n = len(arr)
- *     skiplist = IndexableSkiplist(window)             # <<<<<<<<<<<<<<
- *     result = np.empty(n, dtype=float)
- *     result[:window] = NaN
- */
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_window); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_3);
-  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_IndexableSkiplist)), __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 665; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_skiplist));
-  __pyx_v_skiplist = ((struct __pyx_obj_7tseries_IndexableSkiplist *)__pyx_t_2);
-  __pyx_t_2 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":666
- *     n = len(arr)
- *     skiplist = IndexableSkiplist(window)
- *     result = np.empty(n, dtype=float)             # <<<<<<<<<<<<<<
- *     result[:window] = NaN
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
  * 
+ *     for i from 0 <= i < win - 1:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__empty); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyInt_FromLong(__pyx_v_n); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyInt_FromLong(__pyx_v_N); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyEval_CallObjectWithKeywords(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
   {
     __Pyx_BufFmt_StackElem __pyx_stack[1];
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
-    __pyx_t_7 = __Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
-    if (unlikely(__pyx_t_7 < 0)) {
-      PyErr_Fetch(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
-      if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_result, (PyObject*)__pyx_v_result, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
-        Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10);
-        __Pyx_RaiseBufferFallbackError();
-      } else {
-        PyErr_Restore(__pyx_t_8, __pyx_t_9, __pyx_t_10);
-      }
+    if (unlikely(__Pyx_GetBufferAndValidate(&__pyx_bstruct_output, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_5numpy_double_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
+      __pyx_v_output = ((PyArrayObject *)Py_None); __Pyx_INCREF(Py_None); __pyx_bstruct_output.buf = NULL;
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    } else {__pyx_bstride_0_output = __pyx_bstruct_output.strides[0];
+      __pyx_bshape_0_output = __pyx_bstruct_output.shape[0];
     }
-    __pyx_bstride_0_result = __pyx_bstruct_result.strides[0];
-    __pyx_bshape_0_result = __pyx_bstruct_result.shape[0];
-    if (unlikely(__pyx_t_7 < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 666; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   }
   __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_v_result));
-  __pyx_v_result = ((PyArrayObject *)__pyx_t_5);
+  __pyx_v_output = ((PyArrayObject *)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":667
- *     skiplist = IndexableSkiplist(window)
- *     result = np.empty(n, dtype=float)
- *     result[:window] = NaN             # <<<<<<<<<<<<<<
- * 
- *     for i from 0 <= i < window:
- */
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_v_7tseries_NaN); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_5);
-  if (PySequence_SetSlice(((PyObject *)__pyx_v_result), 0, __pyx_v_window, __pyx_t_5) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 667; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":669
- *     result[:window] = NaN
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":398
+ *     cdef ndarray[double_t, ndim=1] output = np.empty(N, dtype=float)
  * 
- *     for i from 0 <= i < window:             # <<<<<<<<<<<<<<
- *         skiplist.insert(arr[i])
+ *     for i from 0 <= i < win - 1:             # <<<<<<<<<<<<<<
+ *         output[i] = NaN
  * 
  */
-  __pyx_t_7 = __pyx_v_window;
+  __pyx_t_7 = (__pyx_v_win - 1);
   for (__pyx_v_i = 0; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":670
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":399
  * 
- *     for i from 0 <= i < window:
- *         skiplist.insert(arr[i])             # <<<<<<<<<<<<<<
+ *     for i from 0 <= i < win - 1:
+ *         output[i] = NaN             # <<<<<<<<<<<<<<
  * 
- *     midpoint = window / 2
+ *     for i from win - 1 <= i < N:
  */
-    __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__insert); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_11 = __pyx_v_i;
-    __pyx_t_12 = -1;
-    if (__pyx_t_11 < 0) {
-      __pyx_t_11 += __pyx_bshape_0_arr;
-      if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
-    } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_arr)) __pyx_t_12 = 0;
-    if (unlikely(__pyx_t_12 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_8 = __pyx_v_i;
+    __pyx_t_9 = -1;
+    if (__pyx_t_8 < 0) {
+      __pyx_t_8 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_8 < 0)) __pyx_t_9 = 0;
+    } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_output)) __pyx_t_9 = 0;
+    if (unlikely(__pyx_t_9 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_9);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 399; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(double *, __pyx_bstruct_arr.buf, __pyx_t_11, __pyx_bstride_0_arr))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-    __Pyx_GIVEREF(__pyx_t_2);
-    __pyx_t_2 = 0;
-    __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 670; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_8, __pyx_bstride_0_output) = __pyx_v_7tseries_NaN;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":672
- *         skiplist.insert(arr[i])
- * 
- *     midpoint = window / 2             # <<<<<<<<<<<<<<
- * 
- *     cdef int flag = window % 2
- */
-  __pyx_v_midpoint = __Pyx_div_long(__pyx_v_window, 2);
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":674
- *     midpoint = window / 2
- * 
- *     cdef int flag = window % 2             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":401
+ *         output[i] = NaN
  * 
- *     for i from window <= i < n:
- */
-  __pyx_v_flag = __Pyx_mod_long(__pyx_v_window, 2);
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":676
- *     cdef int flag = window % 2
+ *     for i from win - 1 <= i < N:             # <<<<<<<<<<<<<<
+ *         val = input[i - win + 1]
  * 
- *     for i from window <= i < n:             # <<<<<<<<<<<<<<
- *         skiplist.remove(arr[i - window])
- *         skiplist.insert(arr[i])
  */
-  __pyx_t_7 = __pyx_v_n;
-  for (__pyx_v_i = __pyx_v_window; __pyx_v_i < __pyx_t_7; __pyx_v_i++) {
+  __pyx_t_9 = __pyx_v_N;
+  for (__pyx_v_i = (__pyx_v_win - 1); __pyx_v_i < __pyx_t_9; __pyx_v_i++) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":677
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":402
  * 
- *     for i from window <= i < n:
- *         skiplist.remove(arr[i - window])             # <<<<<<<<<<<<<<
- *         skiplist.insert(arr[i])
+ *     for i from win - 1 <= i < N:
+ *         val = input[i - win + 1]             # <<<<<<<<<<<<<<
  * 
+ *         for j from (i - win + 1) <= j <= i:
  */
-    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__remove); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_12 = (__pyx_v_i - __pyx_v_window);
-    __pyx_t_13 = -1;
-    if (__pyx_t_12 < 0) {
-      __pyx_t_12 += __pyx_bshape_0_arr;
-      if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
-    } else if (unlikely(__pyx_t_12 >= __pyx_bshape_0_arr)) __pyx_t_13 = 0;
-    if (unlikely(__pyx_t_13 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_7 = ((__pyx_v_i - __pyx_v_win) + 1);
+    __pyx_t_10 = -1;
+    if (__pyx_t_7 < 0) {
+      __pyx_t_7 += __pyx_bshape_0_input;
+      if (unlikely(__pyx_t_7 < 0)) __pyx_t_10 = 0;
+    } else if (unlikely(__pyx_t_7 >= __pyx_bshape_0_input)) __pyx_t_10 = 0;
+    if (unlikely(__pyx_t_10 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_10);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 402; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_t_4 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(double *, __pyx_bstruct_arr.buf, __pyx_t_12, __pyx_bstride_0_arr))); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
-    __Pyx_GIVEREF(__pyx_t_4);
-    __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 677; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":678
- *     for i from window <= i < n:
- *         skiplist.remove(arr[i - window])
- *         skiplist.insert(arr[i])             # <<<<<<<<<<<<<<
- * 
- *         if flag:
- */
-    __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__insert); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_13 = __pyx_v_i;
-    __pyx_t_14 = -1;
-    if (__pyx_t_13 < 0) {
-      __pyx_t_13 += __pyx_bshape_0_arr;
-      if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
-    } else if (unlikely(__pyx_t_13 >= __pyx_bshape_0_arr)) __pyx_t_14 = 0;
-    if (unlikely(__pyx_t_14 != -1)) {
-      __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    }
-    __pyx_t_5 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(double *, __pyx_bstruct_arr.buf, __pyx_t_13, __pyx_bstride_0_arr))); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
-    __Pyx_GIVEREF(__pyx_t_5);
-    __pyx_t_5 = 0;
-    __pyx_t_5 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 678; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_val = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_7, __pyx_bstride_0_input));
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":680
- *         skiplist.insert(arr[i])
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":404
+ *         val = input[i - win + 1]
  * 
- *         if flag:             # <<<<<<<<<<<<<<
- *             result[i] = skiplist.get(midpoint)
- *         else:
- */
-    __pyx_t_14 = __pyx_v_flag;
-    if (__pyx_t_14) {
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":681
+ *         for j from (i - win + 1) <= j <= i:             # <<<<<<<<<<<<<<
+ *             val = min(val, input[j])
  * 
- *         if flag:
- *             result[i] = skiplist.get(midpoint)             # <<<<<<<<<<<<<<
- *         else:
- *             result[i] = (skiplist.get(midpoint) +
  */
-      __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_2 = PyInt_FromLong(__pyx_v_midpoint); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
-      __Pyx_GIVEREF(__pyx_t_2);
-      __pyx_t_2 = 0;
-      __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_15 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_14 = __pyx_v_i;
-      __pyx_t_16 = -1;
-      if (__pyx_t_14 < 0) {
-        __pyx_t_14 += __pyx_bshape_0_result;
-        if (unlikely(__pyx_t_14 < 0)) __pyx_t_16 = 0;
-      } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_result)) __pyx_t_16 = 0;
-      if (unlikely(__pyx_t_16 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_16);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 681; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(double *, __pyx_bstruct_result.buf, __pyx_t_14, __pyx_bstride_0_result) = __pyx_t_15;
-      goto __pyx_L10;
-    }
-    /*else*/ {
+    __pyx_t_10 = __pyx_v_i;
+    for (__pyx_v_j = ((__pyx_v_i - __pyx_v_win) + 1); __pyx_v_j <= __pyx_t_10; __pyx_v_j++) {
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":683
- *             result[i] = skiplist.get(midpoint)
- *         else:
- *             result[i] = (skiplist.get(midpoint) +             # <<<<<<<<<<<<<<
- *                          skiplist.get(midpoint - 1)) / 2
+      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":405
  * 
- */
-      __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyInt_FromLong(__pyx_v_midpoint); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
-      __Pyx_GIVEREF(__pyx_t_4);
-      __pyx_t_4 = 0;
-      __pyx_t_4 = PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":684
- *         else:
- *             result[i] = (skiplist.get(midpoint) +
- *                          skiplist.get(midpoint - 1)) / 2             # <<<<<<<<<<<<<<
+ *         for j from (i - win + 1) <= j <= i:
+ *             val = min(val, input[j])             # <<<<<<<<<<<<<<
  * 
- *     return result
+ *         output[j] = val
  */
-      __pyx_t_5 = PyObject_GetAttr(((PyObject *)__pyx_v_skiplist), __pyx_n_s__get); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_5 = PyFloat_FromDouble(__pyx_v_val); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_2 = PyInt_FromLong((__pyx_v_midpoint - 1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_11 = __pyx_v_j;
+      __pyx_t_12 = -1;
+      if (__pyx_t_11 < 0) {
+        __pyx_t_11 += __pyx_bshape_0_input;
+        if (unlikely(__pyx_t_11 < 0)) __pyx_t_12 = 0;
+      } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_input)) __pyx_t_12 = 0;
+      if (unlikely(__pyx_t_12 != -1)) {
+        __Pyx_RaiseBufferIndexError(__pyx_t_12);
+        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      }
+      __pyx_t_2 = PyFloat_FromDouble((*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_input.buf, __pyx_t_11, __pyx_bstride_0_input))); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
-      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+      __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __Pyx_GOTREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
+      __Pyx_GIVEREF(__pyx_t_5);
+      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
       __Pyx_GIVEREF(__pyx_t_2);
+      __pyx_t_5 = 0;
       __pyx_t_2 = 0;
-      __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_2 = PyObject_Call(__pyx_builtin_min, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_15 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 684; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __pyx_v_val = __pyx_t_13;
+    }
 
-      /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":683
- *             result[i] = skiplist.get(midpoint)
- *         else:
- *             result[i] = (skiplist.get(midpoint) +             # <<<<<<<<<<<<<<
- *                          skiplist.get(midpoint - 1)) / 2
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":407
+ *             val = min(val, input[j])
  * 
+ *         output[j] = val             # <<<<<<<<<<<<<<
+ * 
+ *     return output
  */
-      __pyx_t_16 = __pyx_v_i;
-      __pyx_t_17 = -1;
-      if (__pyx_t_16 < 0) {
-        __pyx_t_16 += __pyx_bshape_0_result;
-        if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
-      } else if (unlikely(__pyx_t_16 >= __pyx_bshape_0_result)) __pyx_t_17 = 0;
-      if (unlikely(__pyx_t_17 != -1)) {
-        __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        {__pyx_filename = __pyx_f[2]; __pyx_lineno = 683; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-      }
-      *__Pyx_BufPtrStrided1d(double *, __pyx_bstruct_result.buf, __pyx_t_16, __pyx_bstride_0_result) = __pyx_t_15;
+    __pyx_t_10 = __pyx_v_j;
+    __pyx_t_12 = -1;
+    if (__pyx_t_10 < 0) {
+      __pyx_t_10 += __pyx_bshape_0_output;
+      if (unlikely(__pyx_t_10 < 0)) __pyx_t_12 = 0;
+    } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_output)) __pyx_t_12 = 0;
+    if (unlikely(__pyx_t_12 != -1)) {
+      __Pyx_RaiseBufferIndexError(__pyx_t_12);
+      {__pyx_filename = __pyx_f[2]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     }
-    __pyx_L10:;
+    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_double_t *, __pyx_bstruct_output.buf, __pyx_t_10, __pyx_bstride_0_output) = __pyx_v_val;
   }
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":686
- *                          skiplist.get(midpoint - 1)) / 2
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":409
+ *         output[j] = val
  * 
- *     return result             # <<<<<<<<<<<<<<
+ *     return output             # <<<<<<<<<<<<<<
  * 
  * #-------------------------------------------------------------------------------
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_result));
-  __pyx_r = ((PyObject *)__pyx_v_result);
+  __Pyx_INCREF(((PyObject *)__pyx_v_output));
+  __pyx_r = ((PyObject *)__pyx_v_output);
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -13375,26 +11321,25 @@ static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject
   __Pyx_XDECREF(__pyx_t_5);
   { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
     __Pyx_ErrFetch(&__pyx_type, &__pyx_value, &__pyx_tb);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
-    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+    __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __Pyx_ErrRestore(__pyx_type, __pyx_value, __pyx_tb);}
-  __Pyx_AddTraceback("tseries.rolling_median");
+  __Pyx_AddTraceback("tseries._roll_min");
   __pyx_r = NULL;
   goto __pyx_L2;
   __pyx_L0:;
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_arr);
-  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_result);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_output);
+  __Pyx_SafeReleaseBuffer(&__pyx_bstruct_input);
   __pyx_L2:;
-  __Pyx_DECREF((PyObject *)__pyx_v_skiplist);
-  __Pyx_DECREF((PyObject *)__pyx_v_result);
-  __Pyx_DECREF((PyObject *)__pyx_v_arr);
+  __Pyx_XDECREF((PyObject *)__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":693
- * # I could use function pointers here and trim down the code duplication
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":414
+ * # Python interface
  * 
  * def rolling_sum(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
  *     '''
@@ -13407,19 +11352,12 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
   PyArrayObject *__pyx_v_input = 0;
   PyObject *__pyx_v_window = 0;
   PyObject *__pyx_v_minp = 0;
-  PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("rolling_sum");
   __pyx_self = __pyx_self;
@@ -13443,7 +11381,7 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_sum", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_sum", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       if (kw_args > 0) {
@@ -13452,7 +11390,7 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_sum") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_sum") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
     __pyx_v_window = values[1];
@@ -13471,7 +11409,7 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_sum", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_sum", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.rolling_sum");
   return NULL;
@@ -13479,35 +11417,20 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
   __Pyx_INCREF((PyObject *)__pyx_v_input);
   __Pyx_INCREF(__pyx_v_window);
   __Pyx_INCREF(__pyx_v_minp);
-  __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 693; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 414; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":707
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":428
  *     ndarray with length of input
  *     '''
- *     N = len(input)             # <<<<<<<<<<<<<<
- * 
- *     if minp is None:
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 707; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":709
- *     N = len(input)
- * 
  *     if minp is None:             # <<<<<<<<<<<<<<
  *         minp = window
  * 
  */
-  __pyx_t_3 = (__pyx_v_minp == Py_None);
-  if (__pyx_t_3) {
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":710
- * 
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":429
+ *     '''
  *     if minp is None:
  *         minp = window             # <<<<<<<<<<<<<<
  * 
@@ -13520,161 +11443,87 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":712
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":431
  *         minp = window
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_3 = PyObject_IsSubclass(__pyx_t_4, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 712; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = (!__pyx_t_3);
-  if (__pyx_t_5) {
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_3, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 431; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":713
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":432
  * 
  *     if not issubclass(input.dtype.type, float):
  *         input = input.astype(float)             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)
+ *     return _roll_sum(input, window, minp)
  */
-    __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
     PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
     __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 713; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 432; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_input));
-    __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
-    __pyx_t_6 = 0;
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
     goto __pyx_L7;
   }
   __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":715
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":434
  *         input = input.astype(float)
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
- */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
-  __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 715; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":717
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _roll_sum(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":719
- *     if is_contiguous(input):
- *         _roll_sum(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _roll_sum_noncontig(input, output, window, minp, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_window); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_minp); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 719; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__roll_sum(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9, __pyx_t_10);
-    goto __pyx_L8;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":721
- *                    window, minp, N)
- *     else:
- *         _roll_sum_noncontig(input, output, window, minp, N)             # <<<<<<<<<<<<<<
- * 
- *     return output
- */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_sum_noncontig); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_window);
-    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_window);
-    __Pyx_GIVEREF(__pyx_v_window);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 721; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
-  __pyx_L8:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":723
- *         _roll_sum_noncontig(input, output, window, minp, N)
- * 
- *     return output             # <<<<<<<<<<<<<<
+ *     return _roll_sum(input, window, minp)             # <<<<<<<<<<<<<<
  * 
  * def rolling_mean(ndarray input, window, minp=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_sum); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 434; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_5);
   __Pyx_AddTraceback("tseries.rolling_sum");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_DECREF(__pyx_v_window);
   __Pyx_DECREF(__pyx_v_minp);
@@ -13683,12 +11532,12 @@ static PyObject *__pyx_pf_7tseries_rolling_sum(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":725
- *     return output
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":436
+ *     return _roll_sum(input, window, minp)
  * 
  * def rolling_mean(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
- *     N = len(input)
- * 
+ *     if minp is None:
+ *         minp = window
  */
 
 static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -13696,19 +11545,12 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
   PyArrayObject *__pyx_v_input = 0;
   PyObject *__pyx_v_window = 0;
   PyObject *__pyx_v_minp = 0;
-  PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("rolling_mean");
   __pyx_self = __pyx_self;
@@ -13732,7 +11574,7 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_mean", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_mean", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       if (kw_args > 0) {
@@ -13741,7 +11583,7 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_mean") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_mean") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
     __pyx_v_window = values[1];
@@ -13760,7 +11602,7 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_mean", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_mean", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.rolling_mean");
   return NULL;
@@ -13768,35 +11610,20 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
   __Pyx_INCREF((PyObject *)__pyx_v_input);
   __Pyx_INCREF(__pyx_v_window);
   __Pyx_INCREF(__pyx_v_minp);
-  __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 725; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":726
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":437
  * 
  * def rolling_mean(ndarray input, window, minp=None):
- *     N = len(input)             # <<<<<<<<<<<<<<
- * 
- *     if minp is None:
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 726; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":728
- *     N = len(input)
- * 
  *     if minp is None:             # <<<<<<<<<<<<<<
  *         minp = window
  * 
  */
-  __pyx_t_3 = (__pyx_v_minp == Py_None);
-  if (__pyx_t_3) {
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":729
- * 
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":438
+ * def rolling_mean(ndarray input, window, minp=None):
  *     if minp is None:
  *         minp = window             # <<<<<<<<<<<<<<
  * 
@@ -13809,161 +11636,87 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":731
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":440
  *         minp = window
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_3 = PyObject_IsSubclass(__pyx_t_4, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 731; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = (!__pyx_t_3);
-  if (__pyx_t_5) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":732
- * 
- *     if not issubclass(input.dtype.type, float):
- *         input = input.astype(float)             # <<<<<<<<<<<<<<
- * 
- *     cdef ndarray output = np.empty(N, dtype=float)
- */
-    __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
-    __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_4, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 732; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_DECREF(((PyObject *)__pyx_v_input));
-    __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
-    __pyx_t_6 = 0;
-    goto __pyx_L7;
-  }
-  __pyx_L7:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":734
- *         input = input.astype(float)
- * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
- */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
-  __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_4 = PyDict_New(); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  if (PyDict_SetItem(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_6, ((PyObject *)__pyx_t_4)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 734; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":736
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _roll_mean(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":738
- *     if is_contiguous(input):
- *         _roll_mean(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _roll_mean_noncontig(input, output, window, minp, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_window); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_minp); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 738; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__roll_mean(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9, __pyx_t_10);
-    goto __pyx_L8;
-  }
-  /*else*/ {
+  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_3, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":740
- *                    window, minp, N)
- *     else:
- *         _roll_mean_noncontig(input, output, window, minp, N)             # <<<<<<<<<<<<<<
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":441
  * 
- *     return output
+ *     if not issubclass(input.dtype.type, float):
+ *         input = input.astype(float)             # <<<<<<<<<<<<<<
+ * 
+ *     return _roll_mean(input, window, minp)
  */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s_5); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = PyTuple_New(5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_window);
-    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_window);
-    __Pyx_GIVEREF(__pyx_v_window);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_4, 4, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 740; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
+    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
+    __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
+    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 441; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_input));
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
+    goto __pyx_L7;
   }
-  __pyx_L8:;
+  __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":742
- *         _roll_mean_noncontig(input, output, window, minp, N)
- * 
- *     return output             # <<<<<<<<<<<<<<
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":443
+ *         input = input.astype(float)
  * 
+ *     return _roll_mean(input, window, minp)             # <<<<<<<<<<<<<<
  * 
+ * def rolling_median(ndarray input, window, minp=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_mean); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 443; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 443; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 443; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_5);
   __Pyx_AddTraceback("tseries.rolling_mean");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_DECREF(__pyx_v_window);
   __Pyx_DECREF(__pyx_v_minp);
@@ -13972,37 +11725,34 @@ static PyObject *__pyx_pf_7tseries_rolling_mean(PyObject *__pyx_self, PyObject *
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":745
- * 
- * 
- * def ewma(ndarray input, com):             # <<<<<<<<<<<<<<
- *     N = len(input)
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":445
+ *     return _roll_mean(input, window, minp)
  * 
+ * def rolling_median(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
+ *     if minp is None:
+ *         minp = window
  */
 
-static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_rolling_median(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyObject *__pyx_v_com = 0;
-  PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
+  PyObject *__pyx_v_window = 0;
+  PyObject *__pyx_v_minp = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_t_4;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__com,0};
-  __Pyx_RefNannySetupContext("ewma");
+  PyObject *__pyx_t_5 = NULL;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("rolling_median");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[2] = {0,0};
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)Py_None);
     switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -14014,186 +11764,141 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__com);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("ewma", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_median", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      if (kw_args > 0) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
+        if (unlikely(value)) { values[2] = value; kw_args--; }
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "ewma") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_median") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_com = values[1];
-  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
-    goto __pyx_L5_argtuple_error;
+    __pyx_v_window = values[1];
+    __pyx_v_minp = values[2];
   } else {
-    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-    __pyx_v_com = PyTuple_GET_ITEM(__pyx_args, 1);
+    __pyx_v_minp = ((PyObject *)Py_None);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3:
+      __pyx_v_minp = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2:
+      __pyx_v_window = PyTuple_GET_ITEM(__pyx_args, 1);
+      __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+      break;
+      default: goto __pyx_L5_argtuple_error;
+    }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("ewma", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_median", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 445; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.ewma");
+  __Pyx_AddTraceback("tseries.rolling_median");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF(__pyx_v_com);
-  __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 745; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_INCREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 445; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":746
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":446
  * 
- * def ewma(ndarray input, com):
- *     N = len(input)             # <<<<<<<<<<<<<<
+ * def rolling_median(ndarray input, window, minp=None):
+ *     if minp is None:             # <<<<<<<<<<<<<<
+ *         minp = window
+ * 
+ */
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":447
+ * def rolling_median(ndarray input, window, minp=None):
+ *     if minp is None:
+ *         minp = window             # <<<<<<<<<<<<<<
  * 
  *     if not issubclass(input.dtype.type, float):
  */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 746; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
+    __Pyx_INCREF(__pyx_v_window);
+    __Pyx_DECREF(__pyx_v_minp);
+    __pyx_v_minp = __pyx_v_window;
+    goto __pyx_L6;
+  }
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":748
- *     N = len(input)
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":449
+ *         minp = window
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = PyObject_IsSubclass(__pyx_t_3, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 748; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_3, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 449; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = (!__pyx_t_4);
-  if (__pyx_t_5) {
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":749
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":450
  * 
  *     if not issubclass(input.dtype.type, float):
  *         input = input.astype(float)             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)
+ *     return _roll_median(input, window, minp)
  */
-    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
     PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
     __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_5 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 749; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 450; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_input));
-    __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
-    __pyx_t_6 = 0;
-    goto __pyx_L6;
-  }
-  __pyx_L6:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":751
- *         input = input.astype(float)
- * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
- */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
-  __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_2, __pyx_t_6, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 751; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":753
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _ewma(get_double_ptr(input), get_double_ptr(output),
- *               com, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":755
- *     if is_contiguous(input):
- *         _ewma(get_double_ptr(input), get_double_ptr(output),
- *               com, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _ewma_noncontig(input, output, com, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_com); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 755; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__ewma(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9);
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
     goto __pyx_L7;
   }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":757
- *               com, N)
- *     else:
- *         _ewma_noncontig(input, output, com, N)             # <<<<<<<<<<<<<<
- * 
- *     return output
- */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s___ewma_noncontig); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_com);
-    PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_com);
-    __Pyx_GIVEREF(__pyx_v_com);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_3, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 757; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
   __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":759
- *         _ewma_noncontig(input, output, com, N)
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":452
+ *         input = input.astype(float)
  * 
- *     return output             # <<<<<<<<<<<<<<
+ *     return _roll_median(input, window, minp)             # <<<<<<<<<<<<<<
  * 
  * def rolling_var(ndarray input, window, minp=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_median); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_3 = PyObject_Call(__pyx_t_5, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 452; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
@@ -14201,26 +11906,24 @@ static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_ar
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("tseries.ewma");
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("tseries.rolling_median");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF(__pyx_v_com);
+  __Pyx_DECREF(__pyx_v_window);
+  __Pyx_DECREF(__pyx_v_minp);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":761
- *     return output
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":454
+ *     return _roll_median(input, window, minp)
  * 
  * def rolling_var(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
- *     N = len(input)
- * 
+ *     if minp is None:
+ *         minp = window
  */
 
 static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -14228,19 +11931,12 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
   PyArrayObject *__pyx_v_input = 0;
   PyObject *__pyx_v_window = 0;
   PyObject *__pyx_v_minp = 0;
-  PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
   __Pyx_RefNannySetupContext("rolling_var");
   __pyx_self = __pyx_self;
@@ -14264,7 +11960,7 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_var", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_var", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       if (kw_args > 0) {
@@ -14273,7 +11969,7 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_var") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_var") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
     __pyx_v_window = values[1];
@@ -14292,7 +11988,7 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_var", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_var", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.rolling_var");
   return NULL;
@@ -14300,35 +11996,20 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
   __Pyx_INCREF((PyObject *)__pyx_v_input);
   __Pyx_INCREF(__pyx_v_window);
   __Pyx_INCREF(__pyx_v_minp);
-  __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 761; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 454; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":762
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":455
  * 
  * def rolling_var(ndarray input, window, minp=None):
- *     N = len(input)             # <<<<<<<<<<<<<<
- * 
- *     if minp is None:
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 762; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":764
- *     N = len(input)
- * 
  *     if minp is None:             # <<<<<<<<<<<<<<
  *         minp = window
  *     else:
  */
-  __pyx_t_3 = (__pyx_v_minp == Py_None);
-  if (__pyx_t_3) {
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":765
- * 
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":456
+ * def rolling_var(ndarray input, window, minp=None):
  *     if minp is None:
  *         minp = window             # <<<<<<<<<<<<<<
  *     else:
@@ -14341,14 +12022,14 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
   }
   /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":767
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":458
  *         minp = window
  *     else:
  *         minp = max(2, minp)             # <<<<<<<<<<<<<<
  * 
  *     if not issubclass(input.dtype.type, float):
  */
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_int_2);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_2);
@@ -14356,170 +12037,96 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
     __Pyx_INCREF(__pyx_v_minp);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_minp);
     __Pyx_GIVEREF(__pyx_v_minp);
-    __pyx_t_4 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 767; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 458; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_v_minp);
-    __pyx_v_minp = __pyx_t_4;
-    __pyx_t_4 = 0;
+    __pyx_v_minp = __pyx_t_3;
+    __pyx_t_3 = 0;
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":769
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":460
  *         minp = max(2, minp)
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_3 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 769; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_5 = (!__pyx_t_3);
-  if (__pyx_t_5) {
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":770
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":461
  * 
  *     if not issubclass(input.dtype.type, float):
  *         input = input.astype(float)             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)
+ *     return _roll_var(input, window, minp)
  */
-    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
+    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
     __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 770; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_input));
-    __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
-    __pyx_t_6 = 0;
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
     goto __pyx_L7;
   }
   __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":772
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":463
  *         input = input.astype(float)
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
- */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
-  __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 772; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":774
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _roll_var(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":776
- *     if is_contiguous(input):
- *         _roll_var(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _roll_var_noncontig(input, output, window, minp, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_window); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_minp); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 776; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__roll_var(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9, __pyx_t_10);
-    goto __pyx_L8;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":778
- *                    window, minp, N)
- *     else:
- *         _roll_var_noncontig(input, output, window, minp, N)             # <<<<<<<<<<<<<<
- * 
- *     return output
- */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_var_noncontig); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_window);
-    PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_window);
-    __Pyx_GIVEREF(__pyx_v_window);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 778; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
-  __pyx_L8:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":780
- *         _roll_var_noncontig(input, output, window, minp, N)
- * 
- *     return output             # <<<<<<<<<<<<<<
+ *     return _roll_var(input, window, minp)             # <<<<<<<<<<<<<<
  * 
  * def rolling_std(ndarray input, window, minp=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_var); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 463; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_5);
   __Pyx_AddTraceback("tseries.rolling_var");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_DECREF(__pyx_v_window);
   __Pyx_DECREF(__pyx_v_minp);
@@ -14528,12 +12135,12 @@ static PyObject *__pyx_pf_7tseries_rolling_var(PyObject *__pyx_self, PyObject *_
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":782
- *     return output
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":465
+ *     return _roll_var(input, window, minp)
  * 
  * def rolling_std(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
  *     output = rolling_var(input, window, minp=minp)
- * 
+ *     return np.sqrt(output)
  */
 
 static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
@@ -14570,7 +12177,7 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_std", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_std", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       if (kw_args > 0) {
@@ -14579,7 +12186,7 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_std") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_std") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
     __pyx_v_window = values[1];
@@ -14598,24 +12205,24 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_std", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_std", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
   __Pyx_AddTraceback("tseries.rolling_std");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_v_output = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 782; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":783
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":466
  * 
  * def rolling_std(ndarray input, window, minp=None):
  *     output = rolling_var(input, window, minp=minp)             # <<<<<<<<<<<<<<
- * 
  *     return np.sqrt(output)
+ * 
  */
-  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__rolling_var); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__rolling_var); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(((PyObject *)__pyx_v_input));
   PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
@@ -14623,10 +12230,10 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
   __Pyx_INCREF(__pyx_v_window);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_window);
   __Pyx_GIVEREF(__pyx_v_window);
-  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyDict_New(); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_3));
-  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__minp), __pyx_v_minp) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_1, __pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 783; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyDict_SetItem(__pyx_t_3, ((PyObject *)__pyx_n_s__minp), __pyx_v_minp) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyEval_CallObjectWithKeywords(__pyx_t_1, __pyx_t_2, ((PyObject *)__pyx_t_3)); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 466; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
@@ -14635,28 +12242,244 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
   __pyx_v_output = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":785
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":467
+ * def rolling_std(ndarray input, window, minp=None):
  *     output = rolling_var(input, window, minp=minp)
- * 
  *     return np.sqrt(output)             # <<<<<<<<<<<<<<
  * 
  * def rolling_skew(ndarray input, window, minp=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__sqrt); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__sqrt); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_output);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_output);
   __Pyx_GIVEREF(__pyx_v_output);
-  __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 785; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_Call(__pyx_t_3, __pyx_t_4, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("tseries.rolling_std");
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_DECREF(__pyx_v_output);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":469
+ *     return np.sqrt(output)
+ * 
+ * def rolling_skew(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
+ *     if minp is None:
+ *         minp = window
+ */
+
+static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyArrayObject *__pyx_v_input = 0;
+  PyObject *__pyx_v_window = 0;
+  PyObject *__pyx_v_minp = 0;
+  PyObject *__pyx_r = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
+  __Pyx_RefNannySetupContext("rolling_skew");
+  __pyx_self = __pyx_self;
+  if (unlikely(__pyx_kwds)) {
+    Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)Py_None);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      case  0: break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  0:
+      values[0] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__input);
+      if (likely(values[0])) kw_args--;
+      else goto __pyx_L5_argtuple_error;
+      case  1:
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
+      if (likely(values[1])) kw_args--;
+      else {
+        __Pyx_RaiseArgtupleInvalid("rolling_skew", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      }
+      case  2:
+      if (kw_args > 0) {
+        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
+        if (unlikely(value)) { values[2] = value; kw_args--; }
+      }
+    }
+    if (unlikely(kw_args > 0)) {
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_skew") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+    }
+    __pyx_v_input = ((PyArrayObject *)values[0]);
+    __pyx_v_window = values[1];
+    __pyx_v_minp = values[2];
+  } else {
+    __pyx_v_minp = ((PyObject *)Py_None);
+    switch (PyTuple_GET_SIZE(__pyx_args)) {
+      case  3:
+      __pyx_v_minp = PyTuple_GET_ITEM(__pyx_args, 2);
+      case  2:
+      __pyx_v_window = PyTuple_GET_ITEM(__pyx_args, 1);
+      __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+      break;
+      default: goto __pyx_L5_argtuple_error;
+    }
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("rolling_skew", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("tseries.rolling_skew");
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __Pyx_INCREF((PyObject *)__pyx_v_input);
+  __Pyx_INCREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":470
+ * 
+ * def rolling_skew(ndarray input, window, minp=None):
+ *     if minp is None:             # <<<<<<<<<<<<<<
+ *         minp = window
+ *     else:
+ */
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":471
+ * def rolling_skew(ndarray input, window, minp=None):
+ *     if minp is None:
+ *         minp = window             # <<<<<<<<<<<<<<
+ *     else:
+ *         minp = max(2, minp)
+ */
+    __Pyx_INCREF(__pyx_v_window);
+    __Pyx_DECREF(__pyx_v_minp);
+    __pyx_v_minp = __pyx_v_window;
+    goto __pyx_L6;
+  }
+  /*else*/ {
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":473
+ *         minp = window
+ *     else:
+ *         minp = max(2, minp)             # <<<<<<<<<<<<<<
+ * 
+ *     if not issubclass(input.dtype.type, float):
+ */
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_INCREF(__pyx_int_2);
+    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_2);
+    __Pyx_GIVEREF(__pyx_int_2);
+    __Pyx_INCREF(__pyx_v_minp);
+    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_minp);
+    __Pyx_GIVEREF(__pyx_v_minp);
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_v_minp);
+    __pyx_v_minp = __pyx_t_3;
+    __pyx_t_3 = 0;
+  }
+  __pyx_L6:;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":475
+ *         minp = max(2, minp)
+ * 
+ *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
+ *         input = input.astype(float)
+ * 
+ */
+  __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
+
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":476
+ * 
+ *     if not issubclass(input.dtype.type, float):
+ *         input = input.astype(float)             # <<<<<<<<<<<<<<
+ * 
+ *     return _roll_skew(input, window, minp)
+ */
+    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
+    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
+    __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
+    __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(((PyObject *)__pyx_v_input));
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
+    goto __pyx_L7;
+  }
+  __pyx_L7:;
+
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":478
+ *         input = input.astype(float)
+ * 
+ *     return _roll_skew(input, window, minp)             # <<<<<<<<<<<<<<
+ * 
+ * def rolling_kurt(ndarray input, window, minp=None):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_skew); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 478; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
@@ -14664,47 +12487,41 @@ static PyObject *__pyx_pf_7tseries_rolling_std(PyObject *__pyx_self, PyObject *_
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("tseries.rolling_std");
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("tseries.rolling_skew");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_output);
+  __Pyx_DECREF((PyObject *)__pyx_v_input);
+  __Pyx_DECREF(__pyx_v_window);
+  __Pyx_DECREF(__pyx_v_minp);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":787
- *     return np.sqrt(output)
- * 
- * def rolling_skew(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
- *     N = len(input)
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":480
+ *     return _roll_skew(input, window, minp)
  * 
+ * def rolling_kurt(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
+ *     if minp is None:
+ *         minp = window
  */
 
-static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_rolling_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_rolling_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
   PyObject *__pyx_v_window = 0;
   PyObject *__pyx_v_minp = 0;
-  PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
   PyObject *__pyx_r = NULL;
-  Py_ssize_t __pyx_t_1;
+  int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
-  __Pyx_RefNannySetupContext("rolling_skew");
+  __Pyx_RefNannySetupContext("rolling_kurt");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
@@ -14726,7 +12543,7 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
       values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_skew", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+        __Pyx_RaiseArgtupleInvalid("rolling_kurt", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
       case  2:
       if (kw_args > 0) {
@@ -14735,7 +12552,7 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_skew") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_kurt") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
     __pyx_v_window = values[1];
@@ -14754,43 +12571,28 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_skew", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("rolling_kurt", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.rolling_skew");
+  __Pyx_AddTraceback("tseries.rolling_kurt");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
   __Pyx_INCREF(__pyx_v_window);
   __Pyx_INCREF(__pyx_v_minp);
-  __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 787; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":788
- * 
- * def rolling_skew(ndarray input, window, minp=None):
- *     N = len(input)             # <<<<<<<<<<<<<<
- * 
- *     if minp is None:
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 788; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 480; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":790
- *     N = len(input)
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":481
  * 
+ * def rolling_kurt(ndarray input, window, minp=None):
  *     if minp is None:             # <<<<<<<<<<<<<<
  *         minp = window
  *     else:
  */
-  __pyx_t_3 = (__pyx_v_minp == Py_None);
-  if (__pyx_t_3) {
+  __pyx_t_1 = (__pyx_v_minp == Py_None);
+  if (__pyx_t_1) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":791
- * 
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":482
+ * def rolling_kurt(ndarray input, window, minp=None):
  *     if minp is None:
  *         minp = window             # <<<<<<<<<<<<<<
  *     else:
@@ -14803,14 +12605,14 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
   }
   /*else*/ {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":793
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":484
  *         minp = window
  *     else:
  *         minp = max(2, minp)             # <<<<<<<<<<<<<<
  * 
  *     if not issubclass(input.dtype.type, float):
  */
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_int_2);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_2);
@@ -14818,170 +12620,96 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
     __Pyx_INCREF(__pyx_v_minp);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_minp);
     __Pyx_GIVEREF(__pyx_v_minp);
-    __pyx_t_4 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 793; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 484; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_v_minp);
-    __pyx_v_minp = __pyx_t_4;
-    __pyx_t_4 = 0;
+    __pyx_v_minp = __pyx_t_3;
+    __pyx_t_3 = 0;
   }
   __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":795
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":486
  *         minp = max(2, minp)
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 795; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 795; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_3, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_3 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 795; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_1 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 486; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_5 = (!__pyx_t_3);
-  if (__pyx_t_5) {
+  __pyx_t_4 = (!__pyx_t_1);
+  if (__pyx_t_4) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":796
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":487
  * 
  *     if not issubclass(input.dtype.type, float):
  *         input = input.astype(float)             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)
+ *     return _roll_kurt(input, window, minp)
  */
-    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
+    PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
     __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_5 = PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 796; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (!(likely(((__pyx_t_5) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 487; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_input));
-    __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
-    __pyx_t_6 = 0;
+    __pyx_v_input = ((PyArrayObject *)__pyx_t_5);
+    __pyx_t_5 = 0;
     goto __pyx_L7;
   }
   __pyx_L7:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":798
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":489
  *         input = input.astype(float)
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
- */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
-  __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 798; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":800
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _roll_skew(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":802
- *     if is_contiguous(input):
- *         _roll_skew(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _roll_skew_noncontig(input, output, window, minp, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_window); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_minp); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 802; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__roll_skew(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9, __pyx_t_10);
-    goto __pyx_L8;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":804
- *                    window, minp, N)
- *     else:
- *         _roll_skew_noncontig(input, output, window, minp, N)             # <<<<<<<<<<<<<<
- * 
- *     return output
- */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s_6); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_window);
-    PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_window);
-    __Pyx_GIVEREF(__pyx_v_window);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 804; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
-  __pyx_L8:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":806
- *         _roll_skew_noncontig(input, output, window, minp, N)
- * 
- *     return output             # <<<<<<<<<<<<<<
+ *     return _roll_kurt(input, window, minp)             # <<<<<<<<<<<<<<
  * 
- * def rolling_kurt(ndarray input, window, minp=None):
+ * def ewma(ndarray input, com):
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __pyx_t_5 = __Pyx_GetName(__pyx_m, __pyx_n_s___roll_kurt); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_window);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_window);
+  __Pyx_GIVEREF(__pyx_v_window);
+  __Pyx_INCREF(__pyx_v_minp);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_minp);
+  __Pyx_GIVEREF(__pyx_v_minp);
+  __pyx_t_2 = PyObject_Call(__pyx_t_5, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 489; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("tseries.rolling_skew");
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("tseries.rolling_kurt");
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
   __Pyx_DECREF(__pyx_v_window);
   __Pyx_DECREF(__pyx_v_minp);
@@ -14990,41 +12718,33 @@ static PyObject *__pyx_pf_7tseries_rolling_skew(PyObject *__pyx_self, PyObject *
   return __pyx_r;
 }
 
-/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":808
- *     return output
+/* "H:\workspace\pandas\pandas\lib\src\moments.pyx":491
+ *     return _roll_kurt(input, window, minp)
  * 
- * def rolling_kurt(ndarray input, window, minp=None):             # <<<<<<<<<<<<<<
+ * def ewma(ndarray input, com):             # <<<<<<<<<<<<<<
  *     N = len(input)
  * 
  */
 
-static PyObject *__pyx_pf_7tseries_rolling_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyObject *__pyx_pf_7tseries_rolling_kurt(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static PyObject *__pyx_pf_7tseries_ewma(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyArrayObject *__pyx_v_input = 0;
-  PyObject *__pyx_v_window = 0;
-  PyObject *__pyx_v_minp = 0;
+  PyObject *__pyx_v_com = 0;
   PyObject *__pyx_v_N;
-  PyArrayObject *__pyx_v_output = 0;
   PyObject *__pyx_r = NULL;
   Py_ssize_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
   int __pyx_t_5;
   PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_t_8;
-  int __pyx_t_9;
-  int __pyx_t_10;
-  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__window,&__pyx_n_s__minp,0};
-  __Pyx_RefNannySetupContext("rolling_kurt");
+  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__input,&__pyx_n_s__com,0};
+  __Pyx_RefNannySetupContext("ewma");
   __pyx_self = __pyx_self;
   if (unlikely(__pyx_kwds)) {
     Py_ssize_t kw_args = PyDict_Size(__pyx_kwds);
-    PyObject* values[3] = {0,0,0};
-    values[2] = ((PyObject *)Py_None);
+    PyObject* values[2] = {0,0};
     switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
       case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       case  0: break;
@@ -15036,267 +12756,131 @@ static PyObject *__pyx_pf_7tseries_rolling_kurt(PyObject *__pyx_self, PyObject *
       if (likely(values[0])) kw_args--;
       else goto __pyx_L5_argtuple_error;
       case  1:
-      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__window);
+      values[1] = PyDict_GetItem(__pyx_kwds, __pyx_n_s__com);
       if (likely(values[1])) kw_args--;
       else {
-        __Pyx_RaiseArgtupleInvalid("rolling_kurt", 0, 2, 3, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
-      }
-      case  2:
-      if (kw_args > 0) {
-        PyObject* value = PyDict_GetItem(__pyx_kwds, __pyx_n_s__minp);
-        if (unlikely(value)) { values[2] = value; kw_args--; }
+        __Pyx_RaiseArgtupleInvalid("ewma", 1, 2, 2, 1); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
       }
     }
     if (unlikely(kw_args > 0)) {
-      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "rolling_kurt") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+      if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, PyTuple_GET_SIZE(__pyx_args), "ewma") < 0)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
     }
     __pyx_v_input = ((PyArrayObject *)values[0]);
-    __pyx_v_window = values[1];
-    __pyx_v_minp = values[2];
+    __pyx_v_com = values[1];
+  } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    goto __pyx_L5_argtuple_error;
   } else {
-    __pyx_v_minp = ((PyObject *)Py_None);
-    switch (PyTuple_GET_SIZE(__pyx_args)) {
-      case  3:
-      __pyx_v_minp = PyTuple_GET_ITEM(__pyx_args, 2);
-      case  2:
-      __pyx_v_window = PyTuple_GET_ITEM(__pyx_args, 1);
-      __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
-      break;
-      default: goto __pyx_L5_argtuple_error;
-    }
+    __pyx_v_input = ((PyArrayObject *)PyTuple_GET_ITEM(__pyx_args, 0));
+    __pyx_v_com = PyTuple_GET_ITEM(__pyx_args, 1);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("rolling_kurt", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
+  __Pyx_RaiseArgtupleInvalid("ewma", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); {__pyx_filename = __pyx_f[2]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
   __pyx_L3_error:;
-  __Pyx_AddTraceback("tseries.rolling_kurt");
+  __Pyx_AddTraceback("tseries.ewma");
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __Pyx_INCREF((PyObject *)__pyx_v_input);
-  __Pyx_INCREF(__pyx_v_window);
-  __Pyx_INCREF(__pyx_v_minp);
+  __Pyx_INCREF(__pyx_v_com);
   __pyx_v_N = Py_None; __Pyx_INCREF(Py_None);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 808; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_input), __pyx_ptype_5numpy_ndarray, 1, "input", 0))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 491; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":809
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":492
  * 
- * def rolling_kurt(ndarray input, window, minp=None):
+ * def ewma(ndarray input, com):
  *     N = len(input)             # <<<<<<<<<<<<<<
  * 
- *     if minp is None:
- */
-  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 809; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_v_N);
-  __pyx_v_N = __pyx_t_2;
-  __pyx_t_2 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":811
- *     N = len(input)
- * 
- *     if minp is None:             # <<<<<<<<<<<<<<
- *         minp = window
- *     else:
- */
-  __pyx_t_3 = (__pyx_v_minp == Py_None);
-  if (__pyx_t_3) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":812
- * 
- *     if minp is None:
- *         minp = window             # <<<<<<<<<<<<<<
- *     else:
- *         minp = max(2, minp)
- */
-    __Pyx_INCREF(__pyx_v_window);
-    __Pyx_DECREF(__pyx_v_minp);
-    __pyx_v_minp = __pyx_v_window;
-    goto __pyx_L6;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":814
- *         minp = window
- *     else:
- *         minp = max(2, minp)             # <<<<<<<<<<<<<<
- * 
  *     if not issubclass(input.dtype.type, float):
  */
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(__pyx_int_2);
-    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_int_2);
-    __Pyx_GIVEREF(__pyx_int_2);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __pyx_t_4 = PyObject_Call(__pyx_builtin_max, __pyx_t_2, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 814; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_v_minp);
-    __pyx_v_minp = __pyx_t_4;
-    __pyx_t_4 = 0;
-  }
-  __pyx_L6:;
+  __pyx_t_1 = PyObject_Length(((PyObject *)__pyx_v_input)); if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 492; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_v_N);
+  __pyx_v_N = __pyx_t_2;
+  __pyx_t_2 = 0;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":816
- *         minp = max(2, minp)
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":494
+ *     N = len(input)
  * 
  *     if not issubclass(input.dtype.type, float):             # <<<<<<<<<<<<<<
  *         input = input.astype(float)
  * 
  */
-  __pyx_t_4 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__type); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__dtype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_3 = PyObject_IsSubclass(__pyx_t_2, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_3 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 816; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_3 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__type); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_5 = (!__pyx_t_3);
+  __pyx_t_4 = PyObject_IsSubclass(__pyx_t_3, ((PyObject *)((PyObject*)&PyFloat_Type))); if (unlikely(__pyx_t_4 == -1)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 494; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_5 = (!__pyx_t_4);
   if (__pyx_t_5) {
 
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":817
+    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":495
  * 
  *     if not issubclass(input.dtype.type, float):
  *         input = input.astype(float)             # <<<<<<<<<<<<<<
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)
+ *     return _ewma(input, com, N)
  */
-    __pyx_t_2 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_3 = PyObject_GetAttr(((PyObject *)__pyx_v_input), __pyx_n_s__astype); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
+    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)((PyObject*)&PyFloat_Type)));
     __Pyx_GIVEREF(((PyObject *)((PyObject*)&PyFloat_Type)));
-    __pyx_t_6 = PyObject_Call(__pyx_t_2, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    __pyx_t_6 = PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 817; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+    if (!(likely(((__pyx_t_6) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 495; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_DECREF(((PyObject *)__pyx_v_input));
     __pyx_v_input = ((PyArrayObject *)__pyx_t_6);
     __pyx_t_6 = 0;
-    goto __pyx_L7;
+    goto __pyx_L6;
   }
-  __pyx_L7:;
+  __pyx_L6:;
 
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":819
+  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":497
  *         input = input.astype(float)
  * 
- *     cdef ndarray output = np.empty(N, dtype=float)             # <<<<<<<<<<<<<<
- * 
- *     if is_contiguous(input):
+ *     return _ewma(input, com, N)             # <<<<<<<<<<<<<<
  */
-  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyObject_GetAttr(__pyx_t_6, __pyx_n_s__empty); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_6 = __Pyx_GetName(__pyx_m, __pyx_n_s___ewma); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(((PyObject *)__pyx_v_input));
+  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
+  __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
+  __Pyx_INCREF(__pyx_v_com);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_com);
+  __Pyx_GIVEREF(__pyx_v_com);
   __Pyx_INCREF(__pyx_v_N);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_N);
+  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_N);
   __Pyx_GIVEREF(__pyx_v_N);
-  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)&PyFloat_Type))) < 0) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_t_7 = PyEval_CallObjectWithKeywords(__pyx_t_4, __pyx_t_6, ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_3 = PyObject_Call(__pyx_t_6, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 497; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
-  if (!(likely(((__pyx_t_7) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_7, __pyx_ptype_5numpy_ndarray))))) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 819; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_v_output = ((PyArrayObject *)__pyx_t_7);
-  __pyx_t_7 = 0;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":821
- *     cdef ndarray output = np.empty(N, dtype=float)
- * 
- *     if is_contiguous(input):             # <<<<<<<<<<<<<<
- *         _roll_kurt(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)
- */
-  __pyx_t_8 = __pyx_f_7tseries_is_contiguous(__pyx_v_input);
-  if (__pyx_t_8) {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":823
- *     if is_contiguous(input):
- *         _roll_kurt(get_double_ptr(input), get_double_ptr(output),
- *                    window, minp, N)             # <<<<<<<<<<<<<<
- *     else:
- *         _roll_kurt_noncontig(input, output, window, minp, N)
- */
-    __pyx_t_8 = __Pyx_PyInt_AsInt(__pyx_v_window); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_9 = __Pyx_PyInt_AsInt(__pyx_v_minp); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_t_10 = __Pyx_PyInt_AsInt(__pyx_v_N); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 823; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __pyx_f_7tseries__roll_kurt(__pyx_f_7tseries_get_double_ptr(__pyx_v_input), __pyx_f_7tseries_get_double_ptr(__pyx_v_output), __pyx_t_8, __pyx_t_9, __pyx_t_10);
-    goto __pyx_L8;
-  }
-  /*else*/ {
-
-    /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":825
- *                    window, minp, N)
- *     else:
- *         _roll_kurt_noncontig(input, output, window, minp, N)             # <<<<<<<<<<<<<<
- * 
- *     return output
- */
-    __pyx_t_7 = __Pyx_GetName(__pyx_m, __pyx_n_s_7); if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_INCREF(((PyObject *)__pyx_v_input));
-    PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_v_input));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_input));
-    __Pyx_INCREF(((PyObject *)__pyx_v_output));
-    PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_v_output));
-    __Pyx_GIVEREF(((PyObject *)__pyx_v_output));
-    __Pyx_INCREF(__pyx_v_window);
-    PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_window);
-    __Pyx_GIVEREF(__pyx_v_window);
-    __Pyx_INCREF(__pyx_v_minp);
-    PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_v_minp);
-    __Pyx_GIVEREF(__pyx_v_minp);
-    __Pyx_INCREF(__pyx_v_N);
-    PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_v_N);
-    __Pyx_GIVEREF(__pyx_v_N);
-    __pyx_t_6 = PyObject_Call(__pyx_t_7, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 825; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  }
-  __pyx_L8:;
-
-  /* "H:\workspace\pandas\pandas\lib\src\moments.pyx":827
- *         _roll_kurt_noncontig(input, output, window, minp, N)
- * 
- *     return output             # <<<<<<<<<<<<<<
- * 
- */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_output));
-  __pyx_r = ((PyObject *)__pyx_v_output);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
   goto __pyx_L0;
 
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("tseries.rolling_kurt");
+  __Pyx_AddTraceback("tseries.ewma");
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_DECREF(__pyx_v_N);
-  __Pyx_XDECREF((PyObject *)__pyx_v_output);
   __Pyx_DECREF((PyObject *)__pyx_v_input);
-  __Pyx_DECREF(__pyx_v_window);
-  __Pyx_DECREF(__pyx_v_minp);
+  __Pyx_DECREF(__pyx_v_com);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
@@ -17923,7 +15507,7 @@ static PyObject *__pyx_pf_7tseries_getFillVec(PyObject *__pyx_self, PyObject *__
  *         fillVec, maskVec = _nofill(oldIndex, newIndex, oldMap, newMap)
  *     elif kind == 'PAD':
  */
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_kind, ((PyObject *)__pyx_kp_s_8), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_kind, ((PyObject *)__pyx_kp_s_5), Py_EQ); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_2 < 0)) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
@@ -19430,9 +17014,9 @@ static PyObject *__pyx_pf_7tseries_combineFunc(PyObject *__pyx_self, PyObject *_
  */
     __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_s_9));
-    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_9));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_9));
+    __Pyx_INCREF(((PyObject *)__pyx_kp_s_6));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_kp_s_6));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_s_6));
     __pyx_t_3 = PyObject_Call(__pyx_builtin_Exception, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[6]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
@@ -19590,9 +17174,9 @@ static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buf
  */
     __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_u_10));
-    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_10));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_10));
+    __Pyx_INCREF(((PyObject *)__pyx_kp_u_7));
+    PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_7));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_7));
     __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
@@ -19636,9 +17220,9 @@ static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buf
  */
     __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_INCREF(((PyObject *)__pyx_kp_u_11));
-    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_11));
-    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_11));
+    __Pyx_INCREF(((PyObject *)__pyx_kp_u_8));
+    PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_8));
+    __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_8));
     __pyx_t_4 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
@@ -19913,9 +17497,9 @@ static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buf
  */
       __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_12));
-      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_12));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_12));
+      __Pyx_INCREF(((PyObject *)__pyx_kp_u_9));
+      PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_kp_u_9));
+      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_9));
       __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
@@ -20157,7 +17741,7 @@ static int __pyx_pf_5numpy_7ndarray___getbuffer__(PyObject *__pyx_v_self, Py_buf
  */
       __pyx_t_5 = PyInt_FromLong(__pyx_v_t); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_13), __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+      __pyx_t_4 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_10), __pyx_t_5); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -20666,9 +18250,9 @@ static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx_v_desc
  */
       __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_14));
-      PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_14));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_14));
+      __Pyx_INCREF(((PyObject *)__pyx_kp_u_11));
+      PyTuple_SET_ITEM(__pyx_t_5, 0, ((PyObject *)__pyx_kp_u_11));
+      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_11));
       __pyx_t_3 = PyObject_Call(__pyx_builtin_RuntimeError, __pyx_t_5, NULL); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
@@ -20723,9 +18307,9 @@ static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx_v_desc
  */
       __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_INCREF(((PyObject *)__pyx_kp_u_12));
-      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_12));
-      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_12));
+      __Pyx_INCREF(((PyObject *)__pyx_kp_u_9));
+      PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_9));
+      __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_9));
       __pyx_t_5 = PyObject_Call(__pyx_builtin_ValueError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 790; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
@@ -20832,9 +18416,9 @@ static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx_v_desc
  */
         __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_3);
-        __Pyx_INCREF(((PyObject *)__pyx_kp_u_15));
-        PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_15));
-        __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_15));
+        __Pyx_INCREF(((PyObject *)__pyx_kp_u_12));
+        PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_kp_u_12));
+        __Pyx_GIVEREF(((PyObject *)__pyx_kp_u_12));
         __pyx_t_5 = PyObject_Call(__pyx_builtin_RuntimeError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 810; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
@@ -21182,7 +18766,7 @@ static INLINE char *__pyx_f_5numpy__util_dtypestring(PyArray_Descr *__pyx_v_desc
  *             f += 1
  *         else:
  */
-        __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_13), __pyx_v_t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+        __pyx_t_3 = PyNumber_Remainder(((PyObject *)__pyx_kp_u_10), __pyx_v_t); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_3);
         __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 831; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
         __Pyx_GOTREF(__pyx_t_5);
@@ -21834,24 +19418,23 @@ static struct PyMethodDef __pyx_methods[] = {
   {__Pyx_NAMESTR("groupby_withnull"), (PyCFunction)__pyx_pf_7tseries_groupby_withnull, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("groupby"), (PyCFunction)__pyx_pf_7tseries_groupby, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("groupbyfunc"), (PyCFunction)__pyx_pf_7tseries_groupbyfunc, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_groupbyfunc)},
-  {__Pyx_NAMESTR("_roll_sum_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_sum_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_mean_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_mean_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_ewma_noncontig"), (PyCFunction)__pyx_pf_7tseries__ewma_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_var_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_var_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_skew_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_skew_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_kurt_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_kurt_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("median"), (PyCFunction)__pyx_pf_7tseries_median, METH_O, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_max_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_max_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("_roll_min_noncontig"), (PyCFunction)__pyx_pf_7tseries__roll_min_noncontig, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("roll_median"), (PyCFunction)__pyx_pf_7tseries_roll_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("rolling_median"), (PyCFunction)__pyx_pf_7tseries_rolling_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_sum"), (PyCFunction)__pyx_pf_7tseries__roll_sum, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_mean"), (PyCFunction)__pyx_pf_7tseries__roll_mean, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_ewma"), (PyCFunction)__pyx_pf_7tseries__ewma, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_var"), (PyCFunction)__pyx_pf_7tseries__roll_var, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_skew"), (PyCFunction)__pyx_pf_7tseries__roll_skew, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_kurt"), (PyCFunction)__pyx_pf_7tseries__roll_kurt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_median"), (PyCFunction)__pyx_pf_7tseries__roll_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_max"), (PyCFunction)__pyx_pf_7tseries__roll_max, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("_roll_min"), (PyCFunction)__pyx_pf_7tseries__roll_min, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("rolling_sum"), (PyCFunction)__pyx_pf_7tseries_rolling_sum, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_rolling_sum)},
   {__Pyx_NAMESTR("rolling_mean"), (PyCFunction)__pyx_pf_7tseries_rolling_mean, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
-  {__Pyx_NAMESTR("ewma"), (PyCFunction)__pyx_pf_7tseries_ewma, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("rolling_median"), (PyCFunction)__pyx_pf_7tseries_rolling_median, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("rolling_var"), (PyCFunction)__pyx_pf_7tseries_rolling_var, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("rolling_std"), (PyCFunction)__pyx_pf_7tseries_rolling_std, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("rolling_skew"), (PyCFunction)__pyx_pf_7tseries_rolling_skew, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("rolling_kurt"), (PyCFunction)__pyx_pf_7tseries_rolling_kurt, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
+  {__Pyx_NAMESTR("ewma"), (PyCFunction)__pyx_pf_7tseries_ewma, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(0)},
   {__Pyx_NAMESTR("reindex"), (PyCFunction)__pyx_pf_7tseries_reindex, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_reindex)},
   {__Pyx_NAMESTR("reindexObj"), (PyCFunction)__pyx_pf_7tseries_reindexObj, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_reindexObj)},
   {__Pyx_NAMESTR("reindexObject"), (PyCFunction)__pyx_pf_7tseries_reindexObject, METH_VARARGS|METH_KEYWORDS, __Pyx_DOCSTR(__pyx_doc_7tseries_reindexObject)},
@@ -21882,21 +19465,17 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_kp_u_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 1, 0, 0},
   {&__pyx_kp_u_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 1, 0, 0},
   {&__pyx_kp_u_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 1, 0, 0},
-  {&__pyx_kp_u_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 1, 0, 0},
-  {&__pyx_kp_u_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 1, 0, 0},
-  {&__pyx_kp_u_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 1, 0, 0},
   {&__pyx_kp_s_2, __pyx_k_2, sizeof(__pyx_k_2), 0, 0, 1, 0},
   {&__pyx_kp_s_3, __pyx_k_3, sizeof(__pyx_k_3), 0, 0, 1, 0},
   {&__pyx_kp_s_4, __pyx_k_4, sizeof(__pyx_k_4), 0, 0, 1, 0},
-  {&__pyx_n_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 1},
-  {&__pyx_n_s_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 0, 1, 1},
-  {&__pyx_n_s_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 0, 1, 1},
-  {&__pyx_kp_s_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 0, 1, 0},
-  {&__pyx_kp_s_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 0, 1, 0},
+  {&__pyx_kp_s_5, __pyx_k_5, sizeof(__pyx_k_5), 0, 0, 1, 0},
+  {&__pyx_kp_s_6, __pyx_k_6, sizeof(__pyx_k_6), 0, 0, 1, 0},
+  {&__pyx_kp_u_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 1, 0, 0},
+  {&__pyx_kp_u_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 1, 0, 0},
+  {&__pyx_kp_u_9, __pyx_k_9, sizeof(__pyx_k_9), 0, 1, 0, 0},
   {&__pyx_n_s__BACKFILL, __pyx_k__BACKFILL, sizeof(__pyx_k__BACKFILL), 0, 0, 1, 1},
   {&__pyx_n_s__Exception, __pyx_k__Exception, sizeof(__pyx_k__Exception), 0, 0, 1, 1},
   {&__pyx_n_s__KeyError, __pyx_k__KeyError, sizeof(__pyx_k__KeyError), 0, 0, 1, 1},
-  {&__pyx_n_s__N, __pyx_k__N, sizeof(__pyx_k__N), 0, 0, 1, 1},
   {&__pyx_n_s__NIL, __pyx_k__NIL, sizeof(__pyx_k__NIL), 0, 0, 1, 1},
   {&__pyx_n_s__NaN, __pyx_k__NaN, sizeof(__pyx_k__NaN), 0, 0, 1, 1},
   {&__pyx_n_s__O, __pyx_k__O, sizeof(__pyx_k__O), 0, 0, 1, 1},
@@ -21914,9 +19493,13 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s____ne__, __pyx_k____ne__, sizeof(__pyx_k____ne__), 0, 0, 1, 1},
   {&__pyx_n_s____pow__, __pyx_k____pow__, sizeof(__pyx_k____pow__), 0, 0, 1, 1},
   {&__pyx_n_s____sub__, __pyx_k____sub__, sizeof(__pyx_k____sub__), 0, 0, 1, 1},
-  {&__pyx_n_s___ewma_noncontig, __pyx_k___ewma_noncontig, sizeof(__pyx_k___ewma_noncontig), 0, 0, 1, 1},
-  {&__pyx_n_s___roll_sum_noncontig, __pyx_k___roll_sum_noncontig, sizeof(__pyx_k___roll_sum_noncontig), 0, 0, 1, 1},
-  {&__pyx_n_s___roll_var_noncontig, __pyx_k___roll_var_noncontig, sizeof(__pyx_k___roll_var_noncontig), 0, 0, 1, 1},
+  {&__pyx_n_s___ewma, __pyx_k___ewma, sizeof(__pyx_k___ewma), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_kurt, __pyx_k___roll_kurt, sizeof(__pyx_k___roll_kurt), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_mean, __pyx_k___roll_mean, sizeof(__pyx_k___roll_mean), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_median, __pyx_k___roll_median, sizeof(__pyx_k___roll_median), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_skew, __pyx_k___roll_skew, sizeof(__pyx_k___roll_skew), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_sum, __pyx_k___roll_sum, sizeof(__pyx_k___roll_sum), 0, 0, 1, 1},
+  {&__pyx_n_s___roll_var, __pyx_k___roll_var, sizeof(__pyx_k___roll_var), 0, 0, 1, 1},
   {&__pyx_n_s__aMap, __pyx_k__aMap, sizeof(__pyx_k__aMap), 0, 0, 1, 1},
   {&__pyx_n_s__any, __pyx_k__any, sizeof(__pyx_k__any), 0, 0, 1, 1},
   {&__pyx_n_s__ao, __pyx_k__ao, sizeof(__pyx_k__ao), 0, 0, 1, 1},
@@ -21933,7 +19516,6 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__buf, __pyx_k__buf, sizeof(__pyx_k__buf), 0, 0, 1, 1},
   {&__pyx_n_s__byteorder, __pyx_k__byteorder, sizeof(__pyx_k__byteorder), 0, 0, 1, 1},
   {&__pyx_n_s__com, __pyx_k__com, sizeof(__pyx_k__com), 0, 0, 1, 1},
-  {&__pyx_n_s__copy, __pyx_k__copy, sizeof(__pyx_k__copy), 0, 0, 1, 1},
   {&__pyx_n_s__data, __pyx_k__data, sizeof(__pyx_k__data), 0, 0, 1, 1},
   {&__pyx_n_s__datetime, __pyx_k__datetime, sizeof(__pyx_k__datetime), 0, 0, 1, 1},
   {&__pyx_n_s__descr, __pyx_k__descr, sizeof(__pyx_k__descr), 0, 0, 1, 1},
@@ -21978,7 +19560,6 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s__oldIndex, __pyx_k__oldIndex, sizeof(__pyx_k__oldIndex), 0, 0, 1, 1},
   {&__pyx_n_s__oldMap, __pyx_k__oldMap, sizeof(__pyx_k__oldMap), 0, 0, 1, 1},
   {&__pyx_n_s__ones, __pyx_k__ones, sizeof(__pyx_k__ones), 0, 0, 1, 1},
-  {&__pyx_n_s__output, __pyx_k__output, sizeof(__pyx_k__output), 0, 0, 1, 1},
   {&__pyx_n_s__pydatetime, __pyx_k__pydatetime, sizeof(__pyx_k__pydatetime), 0, 0, 1, 1},
   {&__pyx_n_s__random, __pyx_k__random, sizeof(__pyx_k__random), 0, 0, 1, 1},
   {&__pyx_n_s__range, __pyx_k__range, sizeof(__pyx_k__range), 0, 0, 1, 1},
@@ -22004,10 +19585,10 @@ static __Pyx_StringTabEntry __pyx_string_tab[] = {
 static int __Pyx_InitCachedBuiltins(void) {
   __pyx_builtin_Exception = __Pyx_GetName(__pyx_b, __pyx_n_s__Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_builtin_ValueError = __Pyx_GetName(__pyx_b, __pyx_n_s__ValueError); if (!__pyx_builtin_ValueError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_builtin_range = __Pyx_GetName(__pyx_b, __pyx_n_s__range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_builtin_min = __Pyx_GetName(__pyx_b, __pyx_n_s__min); if (!__pyx_builtin_min) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_builtin_KeyError = __Pyx_GetName(__pyx_b, __pyx_n_s__KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __pyx_builtin_max = __Pyx_GetName(__pyx_b, __pyx_n_s__max); if (!__pyx_builtin_max) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 588; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_builtin_range = __Pyx_GetName(__pyx_b, __pyx_n_s__range); if (!__pyx_builtin_range) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_builtin_min = __Pyx_GetName(__pyx_b, __pyx_n_s__min); if (!__pyx_builtin_min) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_builtin_KeyError = __Pyx_GetName(__pyx_b, __pyx_n_s__KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_builtin_max = __Pyx_GetName(__pyx_b, __pyx_n_s__max); if (!__pyx_builtin_max) {__pyx_filename = __pyx_f[2]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_builtin_object = __Pyx_GetName(__pyx_b, __pyx_n_s__object); if (!__pyx_builtin_object) {__pyx_filename = __pyx_f[3]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_builtin_RuntimeError = __Pyx_GetName(__pyx_b, __pyx_n_s__RuntimeError); if (!__pyx_builtin_RuntimeError) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 786; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   return 0;
@@ -22093,8 +19674,8 @@ PyMODINIT_FUNC PyInit_tseries(void)
   if (PyType_Ready(&__pyx_type_7tseries_Node) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   if (__Pyx_SetAttrString(__pyx_m, "Node", (PyObject *)&__pyx_type_7tseries_Node) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 25; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_ptype_7tseries_Node = &__pyx_type_7tseries_Node;
-  if (PyType_Ready(&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  if (__Pyx_SetAttrString(__pyx_m, "IndexableSkiplist", (PyObject *)&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 46; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyType_Ready(&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (__Pyx_SetAttrString(__pyx_m, "IndexableSkiplist", (PyObject *)&__pyx_type_7tseries_IndexableSkiplist) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __pyx_ptype_7tseries_IndexableSkiplist = &__pyx_type_7tseries_IndexableSkiplist;
   /*--- Type import code ---*/
   __pyx_ptype_5numpy_dtype = __Pyx_ImportType("numpy", "dtype", sizeof(PyArray_Descr)); if (unlikely(!__pyx_ptype_5numpy_dtype)) {__pyx_filename = __pyx_f[7]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
@@ -22177,30 +19758,6 @@ PyMODINIT_FUNC PyInit_tseries(void)
  */
   import_array();
 
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":2
- * 
- * cdef double INF = <double> np.inf             # <<<<<<<<<<<<<<
- * cdef double NEGINF = -INF
- * 
- */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__inf); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_v_7tseries_INF = ((double)__pyx_t_3);
-
-  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":3
- * 
- * cdef double INF = <double> np.inf
- * cdef double NEGINF = -INF             # <<<<<<<<<<<<<<
- * 
- * cdef inline _checknull(object val):
- */
-  __pyx_v_7tseries_NEGINF = (-__pyx_v_7tseries_INF);
-
   /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":18
  * cimport numpy as np
  * from numpy cimport *
@@ -22208,10 +19765,10 @@ PyMODINIT_FUNC PyInit_tseries(void)
  * 
  * from random import random
  */
-  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__numpy), 0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__np, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_Import(((PyObject *)__pyx_n_s__numpy), 0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__np, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 18; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":20
  * import numpy as np
@@ -22220,19 +19777,19 @@ PyMODINIT_FUNC PyInit_tseries(void)
  * 
  * # initialize numpy
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
   __Pyx_INCREF(((PyObject *)__pyx_n_s__random));
-  PyList_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_n_s__random));
+  PyList_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_n_s__random));
   __Pyx_GIVEREF(((PyObject *)__pyx_n_s__random));
-  __pyx_t_2 = __Pyx_Import(((PyObject *)__pyx_n_s__random), ((PyObject *)__pyx_t_1)); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__random); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_Import(((PyObject *)__pyx_n_s__random), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__random, __pyx_t_1) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__random); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__random, __pyx_t_2) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":23
  * 
@@ -22243,52 +19800,76 @@ PyMODINIT_FUNC PyInit_tseries(void)
  */
   import_array();
 
-  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":44
- * #         return self.width[i]
+  /* "H:\workspace\pandas\pandas\lib\src\skiplist.pyx":41
+ *         self.width = <int *> width.data
  * 
  * NIL = Node(np.inf, [], np.array([])) # Singleton terminator node             # <<<<<<<<<<<<<<
  * 
  * cdef class IndexableSkiplist:
  */
-  __pyx_t_2 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = PyObject_GetAttr(__pyx_t_2, __pyx_n_s__inf); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_1 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
-  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
-  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_2 = PyObject_GetAttr(__pyx_t_1, __pyx_n_s__inf); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(((PyObject *)__pyx_t_1));
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__array); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_5 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__array); if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(((PyObject *)__pyx_t_4));
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_6, 0, ((PyObject *)__pyx_t_4));
   __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyObject_Call(__pyx_t_5, __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_6);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_2));
-  __Pyx_GIVEREF(((PyObject *)__pyx_t_2));
+  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)__pyx_t_1));
+  __Pyx_GIVEREF(((PyObject *)__pyx_t_1));
   PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
-  __pyx_t_1 = 0;
   __pyx_t_2 = 0;
+  __pyx_t_1 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __pyx_t_4 = PyObject_Call(((PyObject *)((PyObject*)__pyx_ptype_7tseries_Node)), __pyx_t_6, NULL); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__NIL, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s__NIL, __pyx_t_4) < 0) {__pyx_filename = __pyx_f[1]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":2
+ * 
+ * cdef double INF = <double> np.inf             # <<<<<<<<<<<<<<
+ * cdef double NEGINF = -INF
+ * 
+ */
+  __pyx_t_4 = __Pyx_GetName(__pyx_m, __pyx_n_s__np); if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_6 = PyObject_GetAttr(__pyx_t_4, __pyx_n_s__inf); if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[4]; __pyx_lineno = 2; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
+  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+  __pyx_v_7tseries_INF = ((double)__pyx_t_3);
+
+  /* "H:\workspace\pandas\pandas\lib\src\isnull.pyx":3
+ * 
+ * cdef double INF = <double> np.inf
+ * cdef double NEGINF = -INF             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline _checknull(object val):
+ */
+  __pyx_v_7tseries_NEGINF = (-__pyx_v_7tseries_INF);
 
   /* "C:\Python25\lib\site-packages\Cython\Includes\python_dict.pxd":1
  * from python_ref cimport PyObject             # <<<<<<<<<<<<<<
@@ -22336,63 +19917,187 @@ static void __pyx_init_filenames(void) {
   __pyx_f = __pyx_filenames;
 }
 
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
-    PyObject *local_type, *local_value, *local_tb;
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    PyThreadState *tstate = PyThreadState_GET();
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-    if (unlikely(tstate->curexc_type))
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-        goto bad;
-    #endif
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-    Py_INCREF(local_type);
-    Py_INCREF(local_value);
-    Py_INCREF(local_tb);
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    /* Make sure tstate is in a consistent state when we XDECREF
-       these objects (XDECREF may run arbitrary code). */
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
+    PyObject *local_type, *local_value, *local_tb;
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    PyThreadState *tstate = PyThreadState_GET();
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+    if (unlikely(tstate->curexc_type))
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+        goto bad;
+    #endif
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+    Py_INCREF(local_type);
+    Py_INCREF(local_value);
+    Py_INCREF(local_tb);
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
+    /* Make sure tstate is in a consistent state when we XDECREF
+       these objects (XDECREF may run arbitrary code). */
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
+
+static INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
+    if (unlikely(!type)) {
+        PyErr_Format(PyExc_SystemError, "Missing type object");
+        return 0;
+    }
+    if (likely(PyObject_TypeCheck(obj, type)))
+        return 1;
+    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
+                 Py_TYPE(obj)->tp_name, type->tp_name);
+    return 0;
+}
+
+static void __Pyx_RaiseDoubleKeywordsError(
+    const char* func_name,
+    PyObject* kw_name)
+{
+    PyErr_Format(PyExc_TypeError,
+        #if PY_MAJOR_VERSION >= 3
+        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
+        #else
+        "%s() got multiple values for keyword argument '%s'", func_name,
+        PyString_AS_STRING(kw_name));
+        #endif
+}
+
+static void __Pyx_RaiseArgtupleInvalid(
+    const char* func_name,
+    int exact,
+    Py_ssize_t num_min,
+    Py_ssize_t num_max,
+    Py_ssize_t num_found)
+{
+    Py_ssize_t num_expected;
+    const char *number, *more_or_less;
+
+    if (num_found < num_min) {
+        num_expected = num_min;
+        more_or_less = "at least";
+    } else {
+        num_expected = num_max;
+        more_or_less = "at most";
+    }
+    if (exact) {
+        more_or_less = "exactly";
+    }
+    number = (num_expected == 1) ? "" : "s";
+    PyErr_Format(PyExc_TypeError,
+        #if PY_VERSION_HEX < 0x02050000
+            "%s() takes %s %d positional argument%s (%d given)",
+        #else
+            "%s() takes %s %zd positional argument%s (%zd given)",
+        #endif
+        func_name, more_or_less, num_expected, number, num_found);
+}
+
+static int __Pyx_ParseOptionalKeywords(
+    PyObject *kwds,
+    PyObject **argnames[],
+    PyObject *kwds2,
+    PyObject *values[],
+    Py_ssize_t num_pos_args,
+    const char* function_name)
+{
+    PyObject *key = 0, *value = 0;
+    Py_ssize_t pos = 0;
+    PyObject*** name;
+    PyObject*** first_kw_arg = argnames + num_pos_args;
+
+    while (PyDict_Next(kwds, &pos, &key, &value)) {
+        name = first_kw_arg;
+        while (*name && (**name != key)) name++;
+        if (*name) {
+            values[name-argnames] = value;
+        } else {
+            #if PY_MAJOR_VERSION < 3
+            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
+            #else
+            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
+            #endif
+                goto invalid_keyword_type;
+            } else {
+                for (name = first_kw_arg; *name; name++) {
+                    #if PY_MAJOR_VERSION >= 3
+                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
+                        PyUnicode_Compare(**name, key) == 0) break;
+                    #else
+                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
+                        _PyString_Eq(**name, key)) break;
+                    #endif
+                }
+                if (*name) {
+                    values[name-argnames] = value;
+                } else {
+                    /* unexpected keyword found */
+                    for (name=argnames; name != first_kw_arg; name++) {
+                        if (**name == key) goto arg_passed_twice;
+                        #if PY_MAJOR_VERSION >= 3
+                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
+                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
+                        #else
+                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
+                            _PyString_Eq(**name, key)) goto arg_passed_twice;
+                        #endif
+                    }
+                    if (kwds2) {
+                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
+                    } else {
+                        goto invalid_keyword;
+                    }
+                }
+            }
+        }
+    }
     return 0;
+arg_passed_twice:
+    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
+    goto bad;
+invalid_keyword_type:
+    PyErr_Format(PyExc_TypeError,
+        "%s() keywords must be strings", function_name);
+    goto bad;
+invalid_keyword:
+    PyErr_Format(PyExc_TypeError,
+    #if PY_MAJOR_VERSION < 3
+        "%s() got an unexpected keyword argument '%s'",
+        function_name, PyString_AsString(key));
+    #else
+        "%s() got an unexpected keyword argument '%U'",
+        function_name, key);
+    #endif
 bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
     return -1;
 }
 
 
-static INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
-    if (unlikely(!type)) {
-        PyErr_Format(PyExc_SystemError, "Missing type object");
-        return 0;
-    }
-    if (likely(PyObject_TypeCheck(obj, type)))
-        return 1;
-    PyErr_Format(PyExc_TypeError, "Cannot convert %.200s to %.200s",
-                 Py_TYPE(obj)->tp_name, type->tp_name);
-    return 0;
-}
 
 static INLINE int __Pyx_IsLittleEndian(void) {
   unsigned int n = 1;
@@ -22876,140 +20581,10 @@ static INLINE void __Pyx_ErrFetch(PyObject **type, PyObject **value, PyObject **
 }
 
 
-static void __Pyx_RaiseDoubleKeywordsError(
-    const char* func_name,
-    PyObject* kw_name)
-{
-    PyErr_Format(PyExc_TypeError,
-        #if PY_MAJOR_VERSION >= 3
-        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
-        #else
-        "%s() got multiple values for keyword argument '%s'", func_name,
-        PyString_AS_STRING(kw_name));
-        #endif
-}
-
-static void __Pyx_RaiseArgtupleInvalid(
-    const char* func_name,
-    int exact,
-    Py_ssize_t num_min,
-    Py_ssize_t num_max,
-    Py_ssize_t num_found)
-{
-    Py_ssize_t num_expected;
-    const char *number, *more_or_less;
-
-    if (num_found < num_min) {
-        num_expected = num_min;
-        more_or_less = "at least";
-    } else {
-        num_expected = num_max;
-        more_or_less = "at most";
-    }
-    if (exact) {
-        more_or_less = "exactly";
-    }
-    number = (num_expected == 1) ? "" : "s";
-    PyErr_Format(PyExc_TypeError,
-        #if PY_VERSION_HEX < 0x02050000
-            "%s() takes %s %d positional argument%s (%d given)",
-        #else
-            "%s() takes %s %zd positional argument%s (%zd given)",
-        #endif
-        func_name, more_or_less, num_expected, number, num_found);
-}
-
-static int __Pyx_ParseOptionalKeywords(
-    PyObject *kwds,
-    PyObject **argnames[],
-    PyObject *kwds2,
-    PyObject *values[],
-    Py_ssize_t num_pos_args,
-    const char* function_name)
-{
-    PyObject *key = 0, *value = 0;
-    Py_ssize_t pos = 0;
-    PyObject*** name;
-    PyObject*** first_kw_arg = argnames + num_pos_args;
-
-    while (PyDict_Next(kwds, &pos, &key, &value)) {
-        name = first_kw_arg;
-        while (*name && (**name != key)) name++;
-        if (*name) {
-            values[name-argnames] = value;
-        } else {
-            #if PY_MAJOR_VERSION < 3
-            if (unlikely(!PyString_CheckExact(key)) && unlikely(!PyString_Check(key))) {
-            #else
-            if (unlikely(!PyUnicode_CheckExact(key)) && unlikely(!PyUnicode_Check(key))) {
-            #endif
-                goto invalid_keyword_type;
-            } else {
-                for (name = first_kw_arg; *name; name++) {
-                    #if PY_MAJOR_VERSION >= 3
-                    if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
-                        PyUnicode_Compare(**name, key) == 0) break;
-                    #else
-                    if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
-                        _PyString_Eq(**name, key)) break;
-                    #endif
-                }
-                if (*name) {
-                    values[name-argnames] = value;
-                } else {
-                    /* unexpected keyword found */
-                    for (name=argnames; name != first_kw_arg; name++) {
-                        if (**name == key) goto arg_passed_twice;
-                        #if PY_MAJOR_VERSION >= 3
-                        if (PyUnicode_GET_SIZE(**name) == PyUnicode_GET_SIZE(key) &&
-                            PyUnicode_Compare(**name, key) == 0) goto arg_passed_twice;
-                        #else
-                        if (PyString_GET_SIZE(**name) == PyString_GET_SIZE(key) &&
-                            _PyString_Eq(**name, key)) goto arg_passed_twice;
-                        #endif
-                    }
-                    if (kwds2) {
-                        if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
-                    } else {
-                        goto invalid_keyword;
-                    }
-                }
-            }
-        }
-    }
-    return 0;
-arg_passed_twice:
-    __Pyx_RaiseDoubleKeywordsError(function_name, **name);
-    goto bad;
-invalid_keyword_type:
-    PyErr_Format(PyExc_TypeError,
-        "%s() keywords must be strings", function_name);
-    goto bad;
-invalid_keyword:
-    PyErr_Format(PyExc_TypeError,
-    #if PY_MAJOR_VERSION < 3
-        "%s() got an unexpected keyword argument '%s'",
-        function_name, PyString_AsString(key));
-    #else
-        "%s() got an unexpected keyword argument '%U'",
-        function_name, key);
-    #endif
-bad:
-    return -1;
-}
-
 static INLINE void __Pyx_RaiseNoneNotIterableError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
 }
 
-
-
-static INLINE long __Pyx_mod_long(long a, long b) {
-    long r = a % b;
-    r += ((r != 0) & ((r ^ b) < 0)) * b;
-    return r;
-}
-
 static INLINE long __Pyx_div_long(long a, long b) {
     long q = a / b;
     long r = a - q*b;
@@ -23017,6 +20592,12 @@ static INLINE long __Pyx_div_long(long a, long b) {
     return q;
 }
 
+static INLINE long __Pyx_mod_long(long a, long b) {
+    long r = a % b;
+    r += ((r != 0) & ((r ^ b) < 0)) * b;
+    return r;
+}
+
 static INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
     PyErr_Format(PyExc_ValueError,
         #if PY_VERSION_HEX < 0x02050000
diff --git a/pandas/lib/src/tseries.pyx b/pandas/lib/src/tseries.pyx
index dc31345ce..2d3f82778 100644
--- a/pandas/lib/src/tseries.pyx
+++ b/pandas/lib/src/tseries.pyx
@@ -1,4 +1,5 @@
 include "common.pyx"
+include "skiplist.pyx"
 include "isnull.pyx"
 include "groupby.pyx"
 include "moments.pyx"
