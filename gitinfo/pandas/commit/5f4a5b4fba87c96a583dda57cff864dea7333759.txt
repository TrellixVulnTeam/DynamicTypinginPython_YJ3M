commit 5f4a5b4fba87c96a583dda57cff864dea7333759
Author: Jeff Reback <jeff@reback.net>
Date:   Sat Mar 18 22:00:00 2017 -0400

    TST: clean up build testing
    
    Author: Jeff Reback <jeff@reback.net>
    
    Closes #15734 from jreback/build and squashes the following commits:
    
    a99b713 [Jeff Reback] suppress the import json warning when generating _version
    ed7c526 [Jeff Reback] modify install tests
    1cc5b67 [Jeff Reback] TST: have the build test exercise pandas.test()

diff --git a/.travis.yml b/.travis.yml
index 88e165536..705b2380a 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -33,7 +33,6 @@ matrix:
         - PYTHON_VERSION=3.5
         - JOB_NAME: "35_osx"
         - TEST_ARGS="--skip-slow --skip-network"
-        - BUILD_TYPE=conda
         - JOB_TAG=_OSX
         - TRAVIS_PYTHON_VERSION=3.5
         - CACHE_NAME="35_osx"
@@ -107,12 +106,12 @@ matrix:
     - python: 2.7
       env:
         - PYTHON_VERSION=2.7
-        - JOB_NAME: "27_build_test_conda"
+        - JOB_NAME: "27_build_test"
         - JOB_TAG=_BUILD_TEST
         - TEST_ARGS="--skip-slow"
         - FULL_DEPS=true
         - BUILD_TEST=true
-        - CACHE_NAME="27_build_test_conda"
+        - CACHE_NAME="27_build_test"
         - USE_CACHE=true
 #    In allow_failures
     - python: 3.5
@@ -147,12 +146,12 @@ matrix:
       - python: 2.7
         env:
         - PYTHON_VERSION=2.7
-        - JOB_NAME: "27_build_test_conda"
+        - JOB_NAME: "27_build_test"
         - JOB_TAG=_BUILD_TEST
         - TEST_ARGS="--skip-slow"
         - FULL_DEPS=true
         - BUILD_TEST=true
-        - CACHE_NAME="27_build_test_conda"
+        - CACHE_NAME="27_build_test"
         - USE_CACHE=true
       - python: 3.5
         env:
diff --git a/ci/install_test.sh b/ci/install_test.sh
deleted file mode 100755
index 9ace633d7..000000000
--- a/ci/install_test.sh
+++ /dev/null
@@ -1,17 +0,0 @@
-#!/bin/bash
-
-echo "inside $0"
-
-if [ "$INSTALL_TEST" ]; then
-    source activate pandas
-    echo "Starting installation test."
-    conda uninstall cython || exit 1
-    python "$TRAVIS_BUILD_DIR"/setup.py sdist --formats=zip,gztar || exit 1
-    pip install "$TRAVIS_BUILD_DIR"/dist/*tar.gz || exit 1
-    pytest pandas/tests/test_series.py --junitxml=/tmp/pytest_install.xml
-else
-    echo "Skipping installation test."
-fi
-RET="$?"
-
-exit "$RET"
diff --git a/ci/install_travis.sh b/ci/install_travis.sh
index de3b3fb6a..053a2d15a 100755
--- a/ci/install_travis.sh
+++ b/ci/install_travis.sh
@@ -131,10 +131,13 @@ fi
 
 if [ "$BUILD_TEST" ]; then
 
-    # build testing
-    pip uninstall --yes cython
-    pip install cython==0.23
-    ( python setup.py build_ext --inplace && python setup.py develop ) || true
+    # build & install testing
+    echo ["Starting installation test."]
+    python setup.py clean
+    python setup.py build_ext --inplace
+    python setup.py sdist --formats=gztar
+    conda uninstall cython
+    pip install dist/*tar.gz || exit 1
 
 else
 
@@ -142,26 +145,31 @@ else
     echo "[build em]"
     time python setup.py build_ext --inplace || exit 1
 
-    # we may have run installations
-    echo "[conda installs]"
-    REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.run"
-    if [ -e ${REQ} ]; then
-        time conda install -n pandas --file=${REQ} || exit 1
-    fi
+fi
 
-    # we may have additional pip installs
-    echo "[pip installs]"
-    REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.pip"
-    if [ -e ${REQ} ]; then
-       pip install -r $REQ
-    fi
+# we may have run installations
+echo "[conda installs]"
+REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.run"
+if [ -e ${REQ} ]; then
+    time conda install -n pandas --file=${REQ} || exit 1
+fi
 
-    # may have addtl installation instructions for this build
-    echo "[addtl installs]"
-    REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.sh"
-    if [ -e ${REQ} ]; then
-        time bash $REQ || exit 1
-    fi
+# we may have additional pip installs
+echo "[pip installs]"
+REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.pip"
+if [ -e ${REQ} ]; then
+   pip install -r $REQ
+fi
+
+# may have addtl installation instructions for this build
+echo "[addtl installs]"
+REQ="ci/requirements-${PYTHON_VERSION}${JOB_TAG}.sh"
+if [ -e ${REQ} ]; then
+    time bash $REQ || exit 1
+fi
+
+# finish install if we are not doing a build-testk
+if [ -z "$BUILD_TEST" ]; then
 
     # remove any installed pandas package
     # w/o removing anything else
diff --git a/ci/script_multi.sh b/ci/script_multi.sh
index 41f71fd21..2d1211b2f 100755
--- a/ci/script_multi.sh
+++ b/ci/script_multi.sh
@@ -24,7 +24,8 @@ export PYTHONHASHSEED=$(python -c 'import random; print(random.randint(1, 429496
 echo PYTHONHASHSEED=$PYTHONHASHSEED
 
 if [ "$BUILD_TEST" ]; then
-    echo "We are not running pytest as this is simply a build test."
+    cd /tmp
+    python -c "import pandas; pandas.test(['-n 2'])"
 elif [ "$COVERAGE" ]; then
     echo pytest -s -n 2 -m "not single" --cov=pandas --cov-append --cov-report xml:/tmp/cov.xml --junitxml=/tmp/multiple.xml $TEST_ARGS pandas
     pytest -s -n 2 -m "not single" --cov=pandas --cov-append --cov-report xml:/tmp/cov.xml --junitxml=/tmp/multiple.xml $TEST_ARGS pandas
diff --git a/versioneer.py b/versioneer.py
index c010f63e3..104e8e97c 100644
--- a/versioneer.py
+++ b/versioneer.py
@@ -1130,7 +1130,9 @@ SHORT_VERSION_PY = """
 # unpacked source archive. Distribution tarballs contain a pre-generated copy
 # of this file.
 
-import json
+from warnings import catch_warnings
+with catch_warnings(record=True):
+    import json
 import sys
 
 version_json = '''
