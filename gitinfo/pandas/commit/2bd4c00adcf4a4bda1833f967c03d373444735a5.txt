commit 2bd4c00adcf4a4bda1833f967c03d373444735a5
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Thu Dec 15 12:22:37 2011 -0500

    BUG: out buffer for ndarray methods needs to be same dtype, GH #486

diff --git a/pandas/core/common.py b/pandas/core/common.py
index cfd798348..ac7e05715 100644
--- a/pandas/core/common.py
+++ b/pandas/core/common.py
@@ -231,6 +231,10 @@ def take_2d(arr, indexer, out=None, mask=None, needs_masking=None, axis=0):
             mask = indexer == -1
             needs_masking = mask.any()
 
+        # GH #486
+        if out is not None and arr.dtype != out.dtype:
+            arr = arr.astype(out.dtype)
+
         result = arr.take(indexer, axis=axis, out=out)
         result = _maybe_mask(result, mask, needs_masking, axis=axis,
                              out_passed=out is not None)
diff --git a/pandas/core/internals.py b/pandas/core/internals.py
index 1b6e9cf20..d4e034687 100644
--- a/pandas/core/internals.py
+++ b/pandas/core/internals.py
@@ -132,7 +132,8 @@ class Block(object):
         masked_idx = indexer[mask]
 
         if self.values.ndim == 2:
-            new_values = com.take_2d(self.values, masked_idx, axis=0)
+            new_values = com.take_2d(self.values, masked_idx, axis=0,
+                                     needs_masking=False)
         else:
             new_values = self.values.take(masked_idx, axis=0)
 
diff --git a/pandas/tests/test_common.py b/pandas/tests/test_common.py
index 4c200bacb..0816608ae 100644
--- a/pandas/tests/test_common.py
+++ b/pandas/tests/test_common.py
@@ -253,6 +253,10 @@ class TestTake(unittest.TestCase):
         expected[[2, 4]] = np.nan
         tm.assert_almost_equal(result, expected)
 
+        # test with float64 out buffer
+        out = np.empty((len(indexer), arr.shape[1]), dtype='f8')
+        common.take_2d(arr, indexer, out=out) # it works!
+
         # axis=1
         result = common.take_2d(arr, indexer, axis=1)
         result2 = np.empty_like(result)
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index 962878c77..7a90b4fe7 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -4139,6 +4139,12 @@ class TestDataFrameJoin(unittest.TestCase):
         assert_frame_equal(joined, expected)
         self.assertEqual(joined.index.names, index1.names)
 
+    def test_join_float64_float32(self):
+        a = DataFrame(randn(10,2), columns=['a','b'])
+        b = DataFrame(randn(10,1), columns=['c']).astype(np.float32)
+        joined = a.join(b)
+        expected = a.join(b.astype('f8'))
+        assert_frame_equal(joined, expected)
 
 def _join_by_hand(a, b, how='left'):
     join_index = a.index.join(b.index, how=how)
