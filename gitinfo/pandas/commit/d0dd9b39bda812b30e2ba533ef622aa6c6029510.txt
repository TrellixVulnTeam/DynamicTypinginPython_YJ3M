commit d0dd9b39bda812b30e2ba533ef622aa6c6029510
Author: Chang She <chang@lambdafoundry.com>
Date:   Wed Apr 4 22:05:40 2012 -0400

    add factor function for HDFStore that's a contextmanager

diff --git a/pandas/io/pytables.py b/pandas/io/pytables.py
index 63e203dfa..2a89cad57 100644
--- a/pandas/io/pytables.py
+++ b/pandas/io/pytables.py
@@ -13,6 +13,7 @@ from pandas import Series, TimeSeries, DataFrame, Panel, Index, MultiIndex
 from pandas.core.common import adjoin
 import pandas.core.common as com
 import pandas._tseries as lib
+from contextlib import contextmanager
 
 # reading and writing the full object in one go
 _TYPE_MAP = {
@@ -55,6 +56,18 @@ def _tables():
         _table_mod = tables
     return _table_mod
 
+@contextmanager
+def get_store(path, mode='a', complevel=None, complib=None,
+              fletcher32=False):
+    store = None
+    try:
+        store = HDFStore(path, mode=mode, complevel=complevel,
+                         complib=complib, fletcher32=False)
+        yield store
+    finally:
+        if store is not None:
+            store.close()
+
 class HDFStore(object):
     """
     dict-like IO interface for storing pandas objects in PyTables
diff --git a/pandas/io/tests/test_pytables.py b/pandas/io/tests/test_pytables.py
index 7d09d5625..9082c4d54 100644
--- a/pandas/io/tests/test_pytables.py
+++ b/pandas/io/tests/test_pytables.py
@@ -7,7 +7,7 @@ from datetime import datetime
 import numpy as np
 
 from pandas import Series, DataFrame, Panel, DateRange, MultiIndex
-from pandas.io.pytables import HDFStore
+from pandas.io.pytables import HDFStore, get_store
 import pandas.util.testing as tm
 
 try:
@@ -31,6 +31,16 @@ class TesttHDFStore(unittest.TestCase):
         self.store.close()
         os.remove(self.path)
 
+    def test_factory_fun(self):
+        try:
+            with get_store(self.path) as tbl:
+                raise ValueError('blah')
+        except ValueError:
+            pass
+
+        with get_store(self.path) as tbl:
+            pass
+
     def test_len_keys(self):
         self.store['a'] = tm.makeTimeSeries()
         self.store['b'] = tm.makeStringSeries()
