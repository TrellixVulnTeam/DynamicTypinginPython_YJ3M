commit 00f182500e67918e67b58d9dc757bb7a4302ab6a
Author: jbrockmendel <jbrockmendel@gmail.com>
Date:   Sun Mar 8 08:39:06 2020 -0700

    BUG: PeriodIndex.asof_locs (#32310)

diff --git a/pandas/core/indexes/period.py b/pandas/core/indexes/period.py
index 6a7595a66..9ab80c0b6 100644
--- a/pandas/core/indexes/period.py
+++ b/pandas/core/indexes/period.py
@@ -370,27 +370,26 @@ class PeriodIndex(DatetimeIndexOpsMixin, Int64Index):
         # cannot pass _simple_new as it is
         return type(self)(result, freq=self.freq, name=self.name)
 
-    def asof_locs(self, where, mask):
+    def asof_locs(self, where, mask: np.ndarray) -> np.ndarray:
         """
         where : array of timestamps
         mask : array of booleans where data is not NA
-
         """
         where_idx = where
         if isinstance(where_idx, DatetimeIndex):
             where_idx = PeriodIndex(where_idx.values, freq=self.freq)
+        elif not isinstance(where_idx, PeriodIndex):
+            raise TypeError("asof_locs `where` must be DatetimeIndex or PeriodIndex")
+        elif where_idx.freq != self.freq:
+            raise raise_on_incompatible(self, where_idx)
 
-        locs = self._ndarray_values[mask].searchsorted(
-            where_idx._ndarray_values, side="right"
-        )
+        locs = self.asi8[mask].searchsorted(where_idx.asi8, side="right")
 
         locs = np.where(locs > 0, locs - 1, 0)
         result = np.arange(len(self))[mask].take(locs)
 
         first = mask.argmax()
-        result[
-            (locs == 0) & (where_idx._ndarray_values < self._ndarray_values[first])
-        ] = -1
+        result[(locs == 0) & (where_idx.asi8 < self.asi8[first])] = -1
 
         return result
 
diff --git a/pandas/tests/frame/methods/test_asof.py b/pandas/tests/frame/methods/test_asof.py
index e2b417972..c68a547a3 100644
--- a/pandas/tests/frame/methods/test_asof.py
+++ b/pandas/tests/frame/methods/test_asof.py
@@ -1,7 +1,17 @@
 import numpy as np
 import pytest
 
-from pandas import DataFrame, Period, Series, Timestamp, date_range, to_datetime
+from pandas._libs.tslibs import IncompatibleFrequency
+
+from pandas import (
+    DataFrame,
+    Period,
+    Series,
+    Timestamp,
+    date_range,
+    period_range,
+    to_datetime,
+)
 import pandas._testing as tm
 
 
@@ -156,3 +166,13 @@ class TestFrameAsof:
 
         with tm.assert_produces_warning(None):
             result["C"] = 1
+
+    def test_asof_periodindex_mismatched_freq(self):
+        N = 50
+        rng = period_range("1/1/1990", periods=N, freq="H")
+        df = DataFrame(np.random.randn(N), index=rng)
+
+        # Mismatched freq
+        msg = "Input has different freq"
+        with pytest.raises(IncompatibleFrequency, match=msg):
+            df.asof(rng.asfreq("D"))
diff --git a/pandas/tests/indexes/period/test_indexing.py b/pandas/tests/indexes/period/test_indexing.py
index 077fa2a0b..a4c6764d0 100644
--- a/pandas/tests/indexes/period/test_indexing.py
+++ b/pandas/tests/indexes/period/test_indexing.py
@@ -795,3 +795,27 @@ class TestIndexing:
         tm.assert_frame_equal(df, df.loc[list(idx)])
         tm.assert_frame_equal(df.iloc[0:5], df.loc[idx[0:5]])
         tm.assert_frame_equal(df, df.loc[list(idx)])
+
+
+class TestAsOfLocs:
+    def test_asof_locs_mismatched_type(self):
+        dti = pd.date_range("2016-01-01", periods=3)
+        pi = dti.to_period("D")
+        pi2 = dti.to_period("H")
+
+        mask = np.array([0, 1, 0], dtype=bool)
+
+        msg = "must be DatetimeIndex or PeriodIndex"
+        with pytest.raises(TypeError, match=msg):
+            pi.asof_locs(pd.Int64Index(pi.asi8), mask)
+
+        with pytest.raises(TypeError, match=msg):
+            pi.asof_locs(pd.Float64Index(pi.asi8), mask)
+
+        with pytest.raises(TypeError, match=msg):
+            # TimedeltaIndex
+            pi.asof_locs(dti - dti, mask)
+
+        msg = "Input has different freq=H"
+        with pytest.raises(libperiod.IncompatibleFrequency, match=msg):
+            pi.asof_locs(pi2, mask)
diff --git a/pandas/tests/series/methods/test_asof.py b/pandas/tests/series/methods/test_asof.py
index b121efd20..d6462e13b 100644
--- a/pandas/tests/series/methods/test_asof.py
+++ b/pandas/tests/series/methods/test_asof.py
@@ -1,6 +1,8 @@
 import numpy as np
 import pytest
 
+from pandas._libs.tslibs import IncompatibleFrequency
+
 from pandas import Series, Timestamp, date_range, isna, notna, offsets
 import pandas._testing as tm
 
@@ -132,6 +134,11 @@ class TestSeriesAsof:
         d = ts.index[0].to_timestamp() - offsets.BDay()
         assert isna(ts.asof(d))
 
+        # Mismatched freq
+        msg = "Input has different freq"
+        with pytest.raises(IncompatibleFrequency, match=msg):
+            ts.asof(rng.asfreq("D"))
+
     def test_errors(self):
 
         s = Series(
