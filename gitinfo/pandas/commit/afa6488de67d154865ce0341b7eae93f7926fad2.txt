commit afa6488de67d154865ce0341b7eae93f7926fad2
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Dec 1 22:14:29 2012 -0500

    ENH: move cython code from PR #2050 to pandas/lib.pyx

diff --git a/pandas/lib.pyx b/pandas/lib.pyx
index eb94021be..a9d9f76f2 100644
--- a/pandas/lib.pyx
+++ b/pandas/lib.pyx
@@ -164,6 +164,18 @@ cdef double NEGINF = -INF
 
 
 cpdef checknull(object val):
+    if util.is_float_object(val) or util.is_complex_object(val):
+        return val != val # and val != INF and val != NEGINF
+    elif util.is_datetime64_object(val):
+        return get_datetime64_value(val) == NPY_NAT
+    elif val is NaT:
+        return True
+    elif is_array(val):
+        return False
+    else:
+        return util._checknull(val)
+
+cpdef checknull_old(object val):
     if util.is_float_object(val) or util.is_complex_object(val):
         return val != val or val == INF or val == NEGINF
     elif util.is_datetime64_object(val):
@@ -192,6 +204,19 @@ def isnullobj(ndarray[object] arr):
         result[i] = util._checknull(arr[i])
     return result.view(np.bool_)
 
+@cython.wraparound(False)
+@cython.boundscheck(False)
+def isnullobj_old(ndarray[object] arr):
+    cdef Py_ssize_t i, n
+    cdef object val
+    cdef ndarray[uint8_t] result
+
+    n = len(arr)
+    result = np.zeros(n, dtype=np.uint8)
+    for i from 0 <= i < n:
+        result[i] = util._checknull_old(arr[i])
+    return result.view(np.bool_)
+
 
 @cython.wraparound(False)
 @cython.boundscheck(False)
@@ -209,6 +234,36 @@ def isnullobj2d(ndarray[object, ndim=2] arr):
                 result[i, j] = 1
     return result.view(np.bool_)
 
+@cython.wraparound(False)
+@cython.boundscheck(False)
+def isnullobj_old(ndarray[object] arr):
+    cdef Py_ssize_t i, n
+    cdef object val
+    cdef ndarray[uint8_t] result
+
+    n = len(arr)
+    result = np.zeros(n, dtype=np.uint8)
+    for i from 0 <= i < n:
+        result[i] = util._checknull_old(arr[i])
+    return result.view(np.bool_)
+
+
+@cython.wraparound(False)
+@cython.boundscheck(False)
+def isnullobj2d_old(ndarray[object, ndim=2] arr):
+    cdef Py_ssize_t i, j, n, m
+    cdef object val
+    cdef ndarray[uint8_t, ndim=2] result
+
+    n, m = (<object> arr).shape
+    result = np.zeros((n, m), dtype=np.uint8)
+    for i from 0 <= i < n:
+        for j from 0 <= j < m:
+            val = arr[i, j]
+            if checknull_old(val):
+                result[i, j] = 1
+    return result.view(np.bool_)
+
 def list_to_object_array(list obj):
     '''
     Convert list to object ndarray. Seriously can't believe I had to write this
diff --git a/pandas/tests/test_common.py b/pandas/tests/test_common.py
index 353dd0b3d..56991eba9 100644
--- a/pandas/tests/test_common.py
+++ b/pandas/tests/test_common.py
@@ -37,7 +37,7 @@ def test_notnull():
     assert not notnull(np.inf)
     assert not notnull(-np.inf)
 
-    
+    use_inf_as_null(False)
 
     float_series = Series(np.random.randn(5))
     obj_series = Series(np.random.randn(5), dtype=object)
