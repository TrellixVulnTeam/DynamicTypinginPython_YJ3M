commit bf84631de8b37f53162695a7272075d9234a6d39
Author: Chang She <chang@lambdafoundry.com>
Date:   Sun Jun 24 16:47:54 2012 -0400

    BUG: HDFStore converting all to datetime64 #1520

diff --git a/pandas/io/pytables.py b/pandas/io/pytables.py
index 52af5eff7..4ec176556 100644
--- a/pandas/io/pytables.py
+++ b/pandas/io/pytables.py
@@ -716,7 +716,7 @@ class HDFStore(object):
             vlarr.append(value)
         elif value.dtype.type == np.datetime64:
             self.handle.createArray(group, key, value.view('i8'))
-            group._v_attrs.value_type = 'datetime64'
+            getattr(group, key)._v_attrs.value_type = 'datetime64'
         else:
             self.handle.createArray(group, key, value)
 
@@ -958,7 +958,7 @@ def _read_array(group, key):
     if isinstance(node, tables.VLArray):
         return data[0]
     else:
-        dtype = getattr(group._v_attrs, 'value_type', None)
+        dtype = getattr(node._v_attrs, 'value_type', None)
         if dtype == 'datetime64':
             return np.array(data, dtype='M8[ns]')
         return data
diff --git a/pandas/io/tests/test_pytables.py b/pandas/io/tests/test_pytables.py
index 8576b3d69..cddd8e53f 100644
--- a/pandas/io/tests/test_pytables.py
+++ b/pandas/io/tests/test_pytables.py
@@ -660,6 +660,18 @@ class TestHDFStore(unittest.TestCase):
         s = Series(np.random.randn(len(unicode_values)), unicode_values)
         self._check_roundtrip(s, tm.assert_series_equal)
 
+    def test_store_datetime_mixed(self):
+        df = DataFrame({'a': [1,2,3], 'b': [1.,2.,3.], 'c': ['a', 'b', 'c']})
+        ts = tm.makeTimeSeries()
+        df['d'] = ts.index[:3]
+        store = HDFStore('data.h5')
+        store['df'] = df
+        store.close()
+        store = HDFStore('data.h5')
+        test = store['df']
+        assert_series_equal(df.dtypes, test.dtypes)
+        store.close()
+        os.remove('data.h5')
 
 def curpath():
     pth, _ = os.path.split(os.path.abspath(__file__))
