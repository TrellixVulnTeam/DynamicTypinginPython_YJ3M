commit 5abb534bf9bb3fdc786dff64cffd844fc10a81d7
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Fri Nov 4 12:41:59 2011 -0400

    BUG: join should not fail on unconsolidated DataFrame objects, GH #331

diff --git a/pandas/core/internals.py b/pandas/core/internals.py
index cee8b51c6..ef00edbac 100644
--- a/pandas/core/internals.py
+++ b/pandas/core/internals.py
@@ -989,14 +989,16 @@ class _JoinOperation(object):
     BlockManager data structures
     """
     def __init__(self, left, right, axis=1, how='left'):
+        if not left.is_consolidated():
+            left = left.consolidate()
+        if not right.is_consolidated():
+            right = right.consolidate()
+
         self.left = left
         self.right = right
         self.axis = axis
         self.how = how
 
-        assert(left.is_consolidated())
-        assert(right.is_consolidated())
-
         laxis = left.axes[axis]
         raxis = right.axes[axis]
 
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index 96bf7677b..c1db1fd80 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -3378,6 +3378,15 @@ class TestDataFrameJoin(unittest.TestCase):
         x = DataFrame()
         x.join(DataFrame([3], index=[0], columns=['A']), how='outer')
 
+    def test_join_unconsolidated(self):
+        # GH #331
+        a = DataFrame(randn(30,2), columns=['a','b'])
+        c = Series(randn(30))
+        a['c'] = c
+        d = DataFrame(randn(30,1), columns=['d'])
+
+        a.join(d)
+
 def _join_by_hand(a, b, how='left'):
     join_index = a.index.join(b.index, how=how)
 
