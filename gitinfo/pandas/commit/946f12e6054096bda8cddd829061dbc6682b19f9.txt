commit 946f12e6054096bda8cddd829061dbc6682b19f9
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sun Jul 3 15:32:42 2011 -0400

    fixed failing sparse panel and ols unit tests

diff --git a/pandas/core/panel.py b/pandas/core/panel.py
index d4b3620cc..d9b8bc90a 100644
--- a/pandas/core/panel.py
+++ b/pandas/core/panel.py
@@ -357,7 +357,8 @@ class WidePanel(Panel, PandasGeneric):
             mat = value.values
 
         elif np.isscalar(value):
-            mat = np.empty((N, K), dtype=float)
+            dtype = _infer_dtype(value)
+            mat = np.empty((N, K), dtype=dtype)
             mat.fill(value)
 
         mat = mat.reshape((1, N, K))
@@ -1847,6 +1848,16 @@ def _prep_ndarray(values, copy=True):
     assert(values.ndim == 3)
     return values
 
+def _infer_dtype(value):
+    if isinstance(value, (float, np.floating)):
+        return float
+    elif isinstance(value, (int, np.integer)):
+        return int
+    elif isinstance(value, (bool, np.bool_)):
+        return bool
+    else:
+        return object
+
 class Factor(object):
     """
     Represents a categorical variable in classic R / S-plus fashion
diff --git a/pandas/core/sparse.py b/pandas/core/sparse.py
index 127401878..28257c9e6 100644
--- a/pandas/core/sparse.py
+++ b/pandas/core/sparse.py
@@ -16,7 +16,8 @@ from pandas.core.index import Index, NULL_INDEX
 from pandas.core.series import Series, TimeSeries
 from pandas.core.frame import (DataFrame, extract_index, _prep_ndarray,
                                _default_index)
-from pandas.core.panel import Panel, WidePanel, LongPanelIndex, LongPanel
+from pandas.core.panel import (Panel, WidePanel, LongPanelIndex, LongPanel,
+                               PanelAxis)
 import pandas.core.common as common
 import pandas.core.datetools as datetools
 
@@ -1228,6 +1229,10 @@ class SparseWidePanel(WidePanel):
     Notes
     -----
     """
+    items = PanelAxis('_items')
+    major_axis = PanelAxis('_major_axis')
+    minor_axis = PanelAxis('_minor_axis')
+
     def __init__(self, frames, items=None, major_axis=None, minor_axis=None,
                  default_fill_value=nan, default_kind='block'):
         assert(isinstance(frames, dict))
@@ -1257,6 +1262,10 @@ class SparseWidePanel(WidePanel):
         self.major_axis = major_axis
         self.minor_axis = minor_axis
 
+    def _consolidate_inplace(self):
+        # do nothing when DataFrame calls this method
+        pass
+
     @classmethod
     def from_dict(cls, data, intersect=False):
         return SparseWidePanel(data)
diff --git a/pandas/stats/ols.py b/pandas/stats/ols.py
index 1b75b2a6f..d7d1c2ec9 100644
--- a/pandas/stats/ols.py
+++ b/pandas/stats/ols.py
@@ -766,10 +766,10 @@ class MovingOLS(OLS):
         cum_xy = []
 
         if isinstance(x, DataFrame):
-            _x_indexMap = x.index.get_loc
+            _get_index = x.index.get_loc
             def x_slicer(df, dt):
-                i = _x_indexMap[dt]
-                return df.values[i:i+1, :]
+                i = _get_index(dt)
+                return df.values[i:i+1]
         else:
             x_slicer = lambda df, dt: df.truncate(dt, dt).values
 
diff --git a/pandas/tests/test_panel.py b/pandas/tests/test_panel.py
index 5cc7a5d12..1da16aae4 100644
--- a/pandas/tests/test_panel.py
+++ b/pandas/tests/test_panel.py
@@ -30,10 +30,6 @@ class PanelTests(object):
         unpickled = cPickle.loads(pickled)
         assert_frame_equal(unpickled['ItemA'], self.panel['ItemA'])
 
-    # def test_set_values(self):
-    #     self.panel.values = np.array(self.panel.values, order='F')
-    #     assert(self.panel.values.flags.contiguous)
-
     def test_cumsum(self):
         cumsum = self.panel.cumsum()
         assert_frame_equal(cumsum['ItemA'], self.panel['ItemA'].cumsum())
