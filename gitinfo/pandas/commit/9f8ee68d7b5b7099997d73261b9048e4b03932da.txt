commit 9f8ee68d7b5b7099997d73261b9048e4b03932da
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Aug 11 18:23:54 2012 -0400

    BUG: handle min_periods correctly at array start in new rolling min/max close #1695

diff --git a/RELEASE.rst b/RELEASE.rst
index d56932dc5..fe1d7cedf 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -60,6 +60,7 @@ pandas 0.8.2
   - Fix isnull handling of array-like (list) inputs (#1755)
   - Fix regression in handling of Series in Series constructor (#1671)
   - Fix another NumPy datetime64 concatenate bug in DataFrame.append (#1681)
+  - Fix min_periods handling in new rolling_max/min at array start (#1695)
 
 pandas 0.8.1
 ============
diff --git a/pandas/src/moments.pyx b/pandas/src/moments.pyx
index 9a7bfa904..8aa8d83cc 100644
--- a/pandas/src/moments.pyx
+++ b/pandas/src/moments.pyx
@@ -723,7 +723,8 @@ def roll_max2(ndarray[float64_t] a, int window, int minp):
             y[i0] = minpair.value
         else:
             y[i0] = NaN
-    for i0 in range(window - 1):
+
+    for i0 in range(minp - 1):
         y[i0] = NaN
 
     stdlib.free(ring)
@@ -816,7 +817,8 @@ def roll_min2(np.ndarray[np.float64_t, ndim=1] a, int window, int minp):
             y[i0] = minpair.value
         else:
             y[i0] = NaN
-    for i0 in range(window - 1):
+
+    for i0 in range(minp - 1):
         y[i0] = NaN
 
     stdlib.free(ring)
diff --git a/pandas/stats/tests/test_moments.py b/pandas/stats/tests/test_moments.py
index 605720fa6..1d80cb167 100644
--- a/pandas/stats/tests/test_moments.py
+++ b/pandas/stats/tests/test_moments.py
@@ -7,7 +7,7 @@ from datetime import datetime
 from numpy.random import randn
 import numpy as np
 
-from pandas import Series, DataFrame, bdate_range
+from pandas import Series, DataFrame, bdate_range, isnull, notnull
 from pandas.util.testing import assert_almost_equal, assert_series_equal
 import pandas.core.datetools as datetools
 import pandas.stats.moments as mom
@@ -152,6 +152,11 @@ class TestMoments(unittest.TestCase):
             self.assert_(not np.isnan(result[-6]))
             self.assert_(np.isnan(result[-5]))
 
+            arr2 = randn(20)
+            result = func(arr2, 10, min_periods=5)
+            self.assert_(isnull(result[3]))
+            self.assert_(notnull(result[4]))
+
             # min_periods=0
             result0 = func(arr, 20, min_periods=0)
             result1 = func(arr, 20, min_periods=1)
