commit 55826461eba964b3904607a80131ce8f7a499f70
Author: y-p <yoval@gmx.com>
Date:   Wed Mar 13 17:07:17 2013 +0200

    BUG: Enforce grouper=f() result has len(labels) == len(data) GH3035

diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index 3f12f773d..67eb48391 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -1200,6 +1200,13 @@ class Grouping(object):
             # no level passed
             if not isinstance(self.grouper, np.ndarray):
                 self.grouper = self.index.map(self.grouper)
+                if not (hasattr(self.grouper,"__len__") and \
+                   len(self.grouper) == len(self.index)):
+                    errmsg = "Grouper result violates len(labels) == len(data)\n"
+                    errmsg += "result: %s" % com.pprint_thing(self.grouper)
+                    self.grouper = None # Try for sanity
+                    raise AssertionError(errmsg)
+
 
     def __repr__(self):
         return 'Grouping(%s)' % self.name
