commit 61cd97a6eb1ad2a94af4818a7e3c24755ef6300f
Author: Jeff Reback <jeff@reback.net>
Date:   Tue Oct 20 14:16:22 2015 -0400

    TST: fix some warnings filters

diff --git a/pandas/io/ga.py b/pandas/io/ga.py
index 5525b3495..a6f9c9ed9 100644
--- a/pandas/io/ga.py
+++ b/pandas/io/ga.py
@@ -4,13 +4,6 @@
 3. Goto APIs and register for OAuth2.0 for installed applications
 4. Download JSON secret file and move into same directory as this file
 """
-
-# GH11038
-import warnings
-warnings.warn("The pandas.io.ga module is deprecated and will be "
-              "removed in a future version.",
-              FutureWarning, stacklevel=2)
-
 from datetime import datetime
 import re
 from pandas import compat
@@ -27,6 +20,12 @@ from apiclient.errors import HttpError
 from oauth2client.client import AccessTokenRefreshError
 from pandas.compat import zip, u
 
+# GH11038
+import warnings
+warnings.warn("The pandas.io.ga module is deprecated and will be "
+              "removed in a future version.",
+              FutureWarning, stacklevel=2)
+
 TYPE_MAP = {u('INTEGER'): int, u('FLOAT'): float, u('TIME'): int}
 
 NO_CALLBACK = auth.OOB_CALLBACK_URN
diff --git a/pandas/io/tests/test_data.py b/pandas/io/tests/test_data.py
index 29970aef7..60dcb91bd 100644
--- a/pandas/io/tests/test_data.py
+++ b/pandas/io/tests/test_data.py
@@ -293,6 +293,7 @@ class TestYahoo(tm.TestCase):
 
 
 class TestYahooOptions(tm.TestCase):
+
     @classmethod
     def setUpClass(cls):
         super(TestYahooOptions, cls).setUpClass()
diff --git a/pandas/io/tests/test_excel.py b/pandas/io/tests/test_excel.py
index e7ed83b57..b06216719 100644
--- a/pandas/io/tests/test_excel.py
+++ b/pandas/io/tests/test_excel.py
@@ -6,6 +6,7 @@ import sys
 import os
 from distutils.version import LooseVersion
 
+import warnings
 import operator
 import functools
 import nose
@@ -1829,7 +1830,6 @@ class XlsxWriterTests(ExcelWriterBase, tm.TestCase):
         # Applicable to xlsxwriter only.
         _skip_if_no_xlsxwriter()
 
-        import warnings
         with warnings.catch_warnings():
             # Ignore the openpyxl lxml warning.
             warnings.simplefilter("ignore")
diff --git a/pandas/io/tests/test_ga.py b/pandas/io/tests/test_ga.py
index 13d31b43a..965b3441d 100644
--- a/pandas/io/tests/test_ga.py
+++ b/pandas/io/tests/test_ga.py
@@ -1,6 +1,7 @@
 import os
 from datetime import datetime
 
+import warnings
 import nose
 import pandas as pd
 from pandas import compat
@@ -13,7 +14,12 @@ if compat.PY3:
 
 try:
     import httplib2
-    import pandas.io.ga as ga
+    import apiclient
+
+    # deprecated
+    with warnings.catch_warnings(record=True):
+        import pandas.io.ga as ga
+
     from pandas.io.ga import GAnalytics, read_ga
     from pandas.io.auth import AuthenticationConfigError, reset_default_token_store
     from pandas.io import auth
diff --git a/pandas/io/tests/test_packers.py b/pandas/io/tests/test_packers.py
index 894b69928..3434afc41 100644
--- a/pandas/io/tests/test_packers.py
+++ b/pandas/io/tests/test_packers.py
@@ -461,20 +461,21 @@ class TestSparse(TestPackers):
 
     def test_sparse_panel(self):
 
-        items = ['x', 'y', 'z']
-        p = Panel(dict((i, tm.makeDataFrame().ix[:2, :2]) for i in items))
-        sp = p.to_sparse()
+        with tm.assert_produces_warning(FutureWarning, check_stacklevel=False):
+            items = ['x', 'y', 'z']
+            p = Panel(dict((i, tm.makeDataFrame().ix[:2, :2]) for i in items))
+            sp = p.to_sparse()
 
-        self._check_roundtrip(sp, tm.assert_panel_equal,
-                              check_panel_type=True)
+            self._check_roundtrip(sp, tm.assert_panel_equal,
+                                  check_panel_type=True)
 
-        sp2 = p.to_sparse(kind='integer')
-        self._check_roundtrip(sp2, tm.assert_panel_equal,
-                              check_panel_type=True)
+            sp2 = p.to_sparse(kind='integer')
+            self._check_roundtrip(sp2, tm.assert_panel_equal,
+                                  check_panel_type=True)
 
-        sp3 = p.to_sparse(fill_value=0)
-        self._check_roundtrip(sp3, tm.assert_panel_equal,
-                              check_panel_type=True)
+            sp3 = p.to_sparse(fill_value=0)
+            self._check_roundtrip(sp3, tm.assert_panel_equal,
+                                  check_panel_type=True)
 
 
 class TestCompression(TestPackers):
diff --git a/pandas/rpy/tests/test_common.py b/pandas/rpy/tests/test_common.py
index a2e6d08d0..4b579e926 100644
--- a/pandas/rpy/tests/test_common.py
+++ b/pandas/rpy/tests/test_common.py
@@ -6,6 +6,7 @@ import pandas as pd
 import numpy as np
 import unittest
 import nose
+import warnings
 import pandas.util.testing as tm
 
 try:
diff --git a/pandas/stats/tests/test_moments.py b/pandas/stats/tests/test_moments.py
index 86c8f5298..e2ed27156 100644
--- a/pandas/stats/tests/test_moments.py
+++ b/pandas/stats/tests/test_moments.py
@@ -43,10 +43,6 @@ class TestMoments(Base):
 
     def setUp(self):
         self._create_data()
-        warnings.simplefilter("ignore", category=FutureWarning)
-
-    def tearDown(self):
-        warnings.simplefilter("default", category=FutureWarning)
 
     def test_centered_axis_validation(self):
         # ok
@@ -890,7 +886,6 @@ class TestMomentsConsistency(Base):
 
     def setUp(self):
         self._create_data()
-        warnings.simplefilter("ignore", category=FutureWarning)
 
     def _test_moments_consistency(self,
                                   min_periods,
@@ -1516,9 +1511,6 @@ class TestMomentsConsistency(Base):
 
         functions = [lambda x: mom.rolling_cov(x, x, pairwise=True, window=10, min_periods=5),
                      lambda x: mom.rolling_corr(x, x, pairwise=True, window=10, min_periods=5),
-                     # rolling_corr_pairwise is depracated, so the following line should be deleted
-                     # when rolling_corr_pairwise is removed.
-                     lambda x: mom.rolling_corr_pairwise(x, x, window=10, min_periods=5),
                     ]
         for f in functions:
             df_result_panel = f(df)
@@ -1585,9 +1577,6 @@ class TestMomentsConsistency(Base):
                      lambda x: mom.expanding_corr(x, x, pairwise=True, min_periods=5),
                      lambda x: mom.rolling_cov(x, x, pairwise=True, window=10, min_periods=5),
                      lambda x: mom.rolling_corr(x, x, pairwise=True, window=10, min_periods=5),
-                     # rolling_corr_pairwise is depracated, so the following line should be deleted
-                     # when rolling_corr_pairwise is removed.
-                     lambda x: mom.rolling_corr_pairwise(x, x, window=10, min_periods=5),
                     ]
         for f in functions:
             df1_result_panel = f(df1)
diff --git a/pandas/util/testing.py b/pandas/util/testing.py
index d142ffdba..a278c4d0f 100644
--- a/pandas/util/testing.py
+++ b/pandas/util/testing.py
@@ -2020,6 +2020,7 @@ def assert_produces_warning(expected_warning=Warning, filter_level="always",
         warnings.simplefilter(filter_level)
         yield w
         extra_warnings = []
+
         for actual_warning in w:
             if (expected_warning and issubclass(actual_warning.category,
                                                 expected_warning)):
