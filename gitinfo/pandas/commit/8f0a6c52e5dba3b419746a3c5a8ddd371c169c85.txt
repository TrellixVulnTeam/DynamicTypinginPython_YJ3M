commit 8f0a6c52e5dba3b419746a3c5a8ddd371c169c85
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Fri Mar 11 10:03:35 2011 -0500

    fixed NumPy 1.6 broadcasting bug, groupby bugfix

diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index e3f7bf5c4..63be16ce1 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -345,6 +345,9 @@ class DataFrameGroupBy(GroupBy):
             if not isinstance(group, list):
                 group = list(group)
 
+            subframe = self.obj.reindex(group)
+            subframe.groupName = val
+
             if self.axis == 0:
                 indexer, _ = common.get_indexer(self.obj.index,
                                                 subframe.index, None)
@@ -352,15 +355,12 @@ class DataFrameGroupBy(GroupBy):
                 indexer, _ = common.get_indexer(self.obj.columns,
                                                 subframe.columns, None)
 
-            subframe = self.obj.reindex(group)
-            subframe.groupName = val
-
             try:
                 res = func(subframe)
             except Exception:
                 res = subframe.apply(func, axis=self.axis)
 
-            result_values[indexer] = res
+            result_values[indexer] = res.values
 
             # result[val] = res
 
diff --git a/pandas/core/panel.py b/pandas/core/panel.py
index 0a24a1ad6..436b84bc0 100644
--- a/pandas/core/panel.py
+++ b/pandas/core/panel.py
@@ -317,11 +317,10 @@ class WidePanel(Panel, Groupable):
         if isinstance(value, DataFrame):
             value = value.reindex(index=self.major_axis,
                                   columns=self.minor_axis)
-
-            mat = value.values.reshape((1, N, K))
+            mat = value.values
 
         elif np.isscalar(value):
-            mat = np.empty((1, N, K), dtype=float)
+            mat = np.empty((N, K), dtype=float)
             mat.fill(value)
 
         if key in self.items:
@@ -329,7 +328,7 @@ class WidePanel(Panel, Groupable):
             self.values[loc] = mat
         else:
             self.items = Index(list(self.items) + [key])
-
+            mat = mat.reshape((1, N, K))
             # Insert item at end of items for now
             self.values = np.row_stack((self.values, mat))
 
diff --git a/pandas/core/tests/test_frame.py b/pandas/core/tests/test_frame.py
index 38b2c5eb6..ac9d73e07 100644
--- a/pandas/core/tests/test_frame.py
+++ b/pandas/core/tests/test_frame.py
@@ -1209,7 +1209,7 @@ class TestDataFrame(unittest.TestCase):
         for name, group in grouped:
             mean = group.mean()
             for idx in group.index:
-                self.assertEqual(transformed[idx], mean)
+                assert_almost_equal(transformed.xs(idx), mean)
 
         # iterate
         for weekday, group in grouped:
