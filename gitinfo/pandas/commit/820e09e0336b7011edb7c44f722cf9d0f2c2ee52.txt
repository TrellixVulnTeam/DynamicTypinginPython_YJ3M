commit 820e09e0336b7011edb7c44f722cf9d0f2c2ee52
Author: Bhavani Ravi <bhavaniravi@users.noreply.github.com>
Date:   Wed Aug 7 15:08:41 2019 +0530

    CI: Fix setting PATH in azure pipelines (#27787)

diff --git a/azure-pipelines.yml b/azure-pipelines.yml
index cfd7f6546..263a87176 100644
--- a/azure-pipelines.yml
+++ b/azure-pipelines.yml
@@ -22,22 +22,17 @@ jobs:
   timeoutInMinutes: 90
   steps:
   - script: |
-      # XXX next command should avoid redefining the path in every step, but
-      # made the process crash as it couldn't find deactivate
-      #echo '##vso[task.prependpath]$HOME/miniconda3/bin'
+      echo '##vso[task.prependpath]$(HOME)/miniconda3/bin'
       echo '##vso[task.setvariable variable=ENV_FILE]environment.yml'
       echo '##vso[task.setvariable variable=AZURE]true'
     displayName: 'Setting environment variables'
 
   # Do not require a conda environment
-  - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
-      ci/code_checks.sh patterns
+  - script: ci/code_checks.sh patterns
     displayName: 'Looking for unwanted patterns'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       sudo apt-get install -y libc6-dev-i386
       ci/setup_env.sh
     displayName: 'Setup environment and build pandas'
@@ -45,14 +40,12 @@ jobs:
 
   # Do not require pandas
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh lint
     displayName: 'Linting'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh dependencies
     displayName: 'Dependencies consistency'
@@ -60,42 +53,36 @@ jobs:
 
   # Require pandas
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh code
     displayName: 'Checks on imported code'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh doctests
     displayName: 'Running doctests'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh docstrings
     displayName: 'Docstring validation'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       ci/code_checks.sh typing
     displayName: 'Typing validation'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       pytest --capture=no --strict scripts
-    displayName: 'Testing docstring validaton script'
+    displayName: 'Testing docstring validation script'
     condition: true
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       cd asv_bench
       asv check -E existing
@@ -124,16 +111,15 @@ jobs:
   steps:
   - script: |
       echo '##vso[task.setvariable variable=ENV_FILE]environment.yml'
+      echo '##vso[task.prependpath]$(HOME)/miniconda3/bin'
     displayName: 'Setting environment variables'
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       sudo apt-get install -y libc6-dev-i386
       ci/setup_env.sh
     displayName: 'Setup environment and build pandas'
 
   - script: |
-      export PATH=$HOME/miniconda3/bin:$PATH
       source activate pandas-dev
       # Next we should simply have `doc/make.py --warnings-are-errors`, everything else is required because the ipython directive doesn't fail the build on errors (https://github.com/ipython/ipython/issues/11547)
       doc/make.py --warnings-are-errors | tee sphinx.log ; SPHINX_RET=${PIPESTATUS[0]}
diff --git a/ci/azure/posix.yml b/ci/azure/posix.yml
index 39f862290..6093df46f 100644
--- a/ci/azure/posix.yml
+++ b/ci/azure/posix.yml
@@ -56,17 +56,15 @@ jobs:
   steps:
     - script: |
         if [ "$(uname)" == "Linux" ]; then sudo apt-get install -y libc6-dev-i386 $EXTRA_APT; fi
+        echo '##vso[task.prependpath]$(HOME)/miniconda3/bin'
         echo "Creating Environment"
         ci/setup_env.sh
       displayName: 'Setup environment and build pandas'
     - script: |
-        export PATH=$HOME/miniconda3/bin:$PATH
         source activate pandas-dev
         ci/run_tests.sh
       displayName: 'Test'
-    - script: |
-        export PATH=$HOME/miniconda3/bin:$PATH
-        source activate pandas-dev && pushd /tmp && python -c "import pandas; pandas.show_versions();" && popd
+    - script: source activate pandas-dev && pushd /tmp && python -c "import pandas; pandas.show_versions();" && popd
     - task: PublishTestResults@2
       inputs:
         testResultsFiles: 'test-data-*.xml'
@@ -97,7 +95,6 @@ jobs:
         }
       displayName: 'Check for test failures'
     - script: |
-        export PATH=$HOME/miniconda3/bin:$PATH
         source activate pandas-dev
         python ci/print_skipped.py
       displayName: 'Print skipped tests'
diff --git a/ci/azure/windows.yml b/ci/azure/windows.yml
index 20cad1bb4..dfa82819b 100644
--- a/ci/azure/windows.yml
+++ b/ci/azure/windows.yml
@@ -17,7 +17,9 @@ jobs:
         CONDA_PY: "37"
 
   steps:
-    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
+    - powershell: |
+        Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
+        Write-Host "##vso[task.prependpath]$HOME/miniconda3/bin"
       displayName: 'Add conda to PATH'
     - script: conda update -q -n base conda
       displayName: Update conda
@@ -52,7 +54,6 @@ jobs:
         }
       displayName: 'Check for test failures'
     - script: |
-        export PATH=$HOME/miniconda3/bin:$PATH
         source activate pandas-dev
         python ci/print_skipped.py
       displayName: 'Print skipped tests'
