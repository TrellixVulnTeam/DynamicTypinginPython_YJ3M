commit b4431805f325e956af238ee8bbeb0446486dabbd
Author: Marc Garcia <garcia.marc@gmail.com>
Date:   Thu Nov 21 13:06:07 2019 +0000

    DEPS: Unifying testing and building dependencies across builds (#29678)

diff --git a/ci/deps/azure-36-32bit.yaml b/ci/deps/azure-36-32bit.yaml
index 1e2e6c33e..f3e3d577a 100644
--- a/ci/deps/azure-36-32bit.yaml
+++ b/ci/deps/azure-36-32bit.yaml
@@ -3,21 +3,25 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.6.*
+
+  # tools
+  ### Cython 0.29.13 and pytest 5.0.1 for 32 bits are not available with conda, installing below with pip instead
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - attrs=19.1.0
   - gcc_linux-32
-  - gcc_linux-32
   - gxx_linux-32
   - numpy=1.14.*
   - python-dateutil
-  - python=3.6.*
   - pytz=2017.2
-  # universal
-  - pytest
-  - pytest-xdist
-  - pytest-mock
-  - pytest-azurepipelines
-  - hypothesis>=3.58.0
+
+  # see comment above
   - pip
   - pip:
-    # Anaconda doesn't build a new enough Cython
     - cython>=0.29.13
+    - pytest>=5.0.1
diff --git a/ci/deps/azure-36-locale.yaml b/ci/deps/azure-36-locale.yaml
index 76868f598..3baf975af 100644
--- a/ci/deps/azure-36-locale.yaml
+++ b/ci/deps/azure-36-locale.yaml
@@ -3,28 +3,31 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.6.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - beautifulsoup4==4.6.0
   - bottleneck=1.2.*
-  - cython=0.29.13
   - lxml
   - matplotlib=2.2.2
   - numpy=1.14.*
   - openpyxl=2.4.8
   - python-dateutil
   - python-blosc
-  - python=3.6.*
   - pytz=2017.2
   - scipy
   - sqlalchemy=1.1.4
   - xlrd=1.1.0
   - xlsxwriter=0.9.8
   - xlwt=1.2.0
-  # universal
-  - pytest>=5.0.0
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - pytest-azurepipelines
-  - hypothesis>=3.58.0
   - pip
   - pip:
     - html5lib==1.0b2
diff --git a/ci/deps/azure-36-locale_slow.yaml b/ci/deps/azure-36-locale_slow.yaml
index 212053752..01741e9b6 100644
--- a/ci/deps/azure-36-locale_slow.yaml
+++ b/ci/deps/azure-36-locale_slow.yaml
@@ -3,8 +3,18 @@ channels:
   - defaults
   - conda-forge
 dependencies:
-  - beautifulsoup4
+  - python=3.6.*
+
+  # tools
   - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
+  - beautifulsoup4
   - gcsfs
   - html5lib
   - ipython
@@ -17,7 +27,6 @@ dependencies:
   - openpyxl
   - pytables
   - python-dateutil
-  - python=3.6.*
   - pytz
   - s3fs
   - scipy
@@ -25,12 +34,4 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - pytest>=4.0.2
-  - pytest-xdist
-  - pytest-mock
-  - pytest-azurepipelines
   - moto
-  - pip
-  - pip:
-    - hypothesis>=3.58.0
diff --git a/ci/deps/azure-36-minimum_versions.yaml b/ci/deps/azure-36-minimum_versions.yaml
index e2c78165f..1e32ef748 100644
--- a/ci/deps/azure-36-minimum_versions.yaml
+++ b/ci/deps/azure-36-minimum_versions.yaml
@@ -3,25 +3,28 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.6.1
+
+  # tools
+  - cython=0.29.13
+  - pytest=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - beautifulsoup4=4.6.0
   - bottleneck=1.2.1
-  - cython>=0.29.13
   - jinja2=2.8
   - numexpr=2.6.2
   - numpy=1.13.3
   - openpyxl=2.4.8
   - pytables=3.4.2
   - python-dateutil=2.6.1
-  - python=3.6.1
   - pytz=2017.2
   - scipy=0.19.0
   - xlrd=1.1.0
   - xlsxwriter=0.9.8
   - xlwt=1.2.0
-  # universal
   - html5lib=1.0.1
-  - hypothesis>=3.58.0
-  - pytest=4.5.0
-  - pytest-xdist
-  - pytest-mock
-  - pytest-azurepipelines
diff --git a/ci/deps/azure-37-locale.yaml b/ci/deps/azure-37-locale.yaml
index 24464adb7..26446ab53 100644
--- a/ci/deps/azure-37-locale.yaml
+++ b/ci/deps/azure-37-locale.yaml
@@ -3,8 +3,18 @@ channels:
   - defaults
   - conda-forge
 dependencies:
-  - beautifulsoup4
+  - python=3.7.*
+
+  # tools
   - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
+  - beautifulsoup4
   - html5lib
   - ipython
   - jinja2
@@ -17,7 +27,6 @@ dependencies:
   - openpyxl
   - pytables
   - python-dateutil
-  - python=3.7.*
   - pytz
   - s3fs
   - scipy
@@ -25,11 +34,3 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - pytest>=5.0.1
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - pytest-azurepipelines
-  - pip
-  - pip:
-    - hypothesis>=3.58.0
diff --git a/ci/deps/azure-37-numpydev.yaml b/ci/deps/azure-37-numpydev.yaml
index 0fb06fd43..3264df594 100644
--- a/ci/deps/azure-37-numpydev.yaml
+++ b/ci/deps/azure-37-numpydev.yaml
@@ -3,14 +3,17 @@ channels:
   - defaults
 dependencies:
   - python=3.7.*
-  - pytz
-  - Cython>=0.29.13
-  # universal
-  # pytest < 5 until defaults has pytest-xdist>=1.29.0
-  - pytest>=4.0.2,<5.0
-  - pytest-xdist
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
   - pytest-mock
   - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
+  - pytz
   - pip
   - pip:
     - "git+git://github.com/dateutil/dateutil.git"
@@ -18,5 +21,3 @@ dependencies:
     - "--pre"
     - "numpy"
     - "scipy"
-    # https://github.com/pandas-dev/pandas/issues/27421
-    - pytest-azurepipelines<1.0.0
diff --git a/ci/deps/azure-macos-36.yaml b/ci/deps/azure-macos-36.yaml
index 85c090bf6..48ba87d26 100644
--- a/ci/deps/azure-macos-36.yaml
+++ b/ci/deps/azure-macos-36.yaml
@@ -2,6 +2,17 @@ name: pandas-dev
 channels:
   - defaults
 dependencies:
+  - python=3.6.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - beautifulsoup4
   - bottleneck
   - html5lib
@@ -14,7 +25,6 @@ dependencies:
   - openpyxl
   - pyarrow
   - pytables
-  - python=3.6.*
   - python-dateutil==2.6.1
   - pytz
   - xarray
@@ -23,13 +33,4 @@ dependencies:
   - xlwt
   - pip
   - pip:
-    # Anaconda / conda-forge don't build for 3.5
-    - cython>=0.29.13
     - pyreadstat
-    # universal
-    - pytest>=5.0.1
-    - pytest-xdist>=1.29.0
-    - pytest-mock
-    - hypothesis>=3.58.0
-    # https://github.com/pandas-dev/pandas/issues/27421
-    - pytest-azurepipelines<1.0.0
diff --git a/ci/deps/azure-windows-36.yaml b/ci/deps/azure-windows-36.yaml
index 88b38aaef..e3ad1d837 100644
--- a/ci/deps/azure-windows-36.yaml
+++ b/ci/deps/azure-windows-36.yaml
@@ -3,6 +3,17 @@ channels:
   - conda-forge
   - defaults
 dependencies:
+  - python=3.6.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - blosc
   - bottleneck
   - fastparquet>=0.2.1
@@ -13,16 +24,8 @@ dependencies:
   - pyarrow
   - pytables
   - python-dateutil
-  - python=3.6.*
   - pytz
   - scipy
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - cython>=0.29.13
-  - pytest>=5.0.1
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - pytest-azurepipelines
-  - hypothesis>=3.58.0
diff --git a/ci/deps/azure-windows-37.yaml b/ci/deps/azure-windows-37.yaml
index 7680ed9fd..07e134b05 100644
--- a/ci/deps/azure-windows-37.yaml
+++ b/ci/deps/azure-windows-37.yaml
@@ -3,6 +3,17 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.7.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-azurepipelines
+
+  # pandas dependencies
   - beautifulsoup4
   - bottleneck
   - gcsfs
@@ -15,7 +26,6 @@ dependencies:
   - numpy=1.14.*
   - openpyxl
   - pytables
-  - python=3.7.*
   - python-dateutil
   - pytz
   - s3fs
@@ -24,11 +34,4 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - cython>=0.29.13
-  - pytest>=5.0.0
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - pytest-azurepipelines
-  - hypothesis>=3.58.0
   - pyreadstat
diff --git a/ci/deps/travis-36-cov.yaml b/ci/deps/travis-36-cov.yaml
index b2a74fcea..9148e0d4b 100644
--- a/ci/deps/travis-36-cov.yaml
+++ b/ci/deps/travis-36-cov.yaml
@@ -3,6 +3,17 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.6.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+  - pytest-cov  # this is only needed in the coverage build
+
+  # pandas dependencies
   - beautifulsoup4
   - botocore>=1.11
   - cython>=0.29.13
@@ -27,7 +38,6 @@ dependencies:
   - pymysql
   - pytables
   - python-snappy
-  - python=3.6.*
   - pytz
   - s3fs
   - scikit-learn
@@ -38,12 +48,6 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - pytest>=5.0.1
-  - pytest-xdist>=1.29.0
-  - pytest-cov
-  - pytest-mock
-  - hypothesis>=3.58.0
   - pip
   - pip:
     - brotlipy
diff --git a/ci/deps/travis-36-locale.yaml b/ci/deps/travis-36-locale.yaml
index 09f72e650..3199ee037 100644
--- a/ci/deps/travis-36-locale.yaml
+++ b/ci/deps/travis-36-locale.yaml
@@ -3,10 +3,19 @@ channels:
   - defaults
   - conda-forge
 dependencies:
+  - python=3.6.*
+
+  # tools
+  - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+
+  # pandas dependencies
   - beautifulsoup4
   - blosc=1.14.3
   - python-blosc
-  - cython>=0.29.13
   - fastparquet=0.2.1
   - gcsfs=0.2.2
   - html5lib
@@ -24,7 +33,6 @@ dependencies:
   - pymysql=0.7.11
   - pytables
   - python-dateutil
-  - python=3.6.*
   - pytz
   - s3fs=0.3.0
   - scipy
@@ -33,10 +41,3 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - pytest>=5.0.1
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - pip
-  - pip:
-    - hypothesis>=3.58.0
diff --git a/ci/deps/travis-36-slow.yaml b/ci/deps/travis-36-slow.yaml
index e9c5dadbc..eab374c96 100644
--- a/ci/deps/travis-36-slow.yaml
+++ b/ci/deps/travis-36-slow.yaml
@@ -3,8 +3,17 @@ channels:
   - defaults
   - conda-forge
 dependencies:
-  - beautifulsoup4
+  - python=3.6.*
+
+  # tools
   - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+
+  # pandas dependencies
+  - beautifulsoup4
   - html5lib
   - lxml
   - matplotlib
@@ -16,7 +25,6 @@ dependencies:
   - pymysql
   - pytables
   - python-dateutil
-  - python=3.6.*
   - pytz
   - s3fs
   - scipy
@@ -24,9 +32,4 @@ dependencies:
   - xlrd
   - xlsxwriter
   - xlwt
-  # universal
-  - pytest>=5.0.0
-  - pytest-xdist>=1.29.0
-  - pytest-mock
   - moto
-  - hypothesis>=3.58.0
diff --git a/ci/deps/travis-37.yaml b/ci/deps/travis-37.yaml
index 903636f2f..7b75a427a 100644
--- a/ci/deps/travis-37.yaml
+++ b/ci/deps/travis-37.yaml
@@ -5,20 +5,23 @@ channels:
   - c3i_test
 dependencies:
   - python=3.7.*
-  - botocore>=1.11
+
+  # tools
   - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.21
+  - pytest-mock
+  - hypothesis>=3.58.0
+
+  # pandas dependencies
+  - botocore>=1.11
   - numpy
   - python-dateutil
   - nomkl
   - pyarrow
   - pytz
-  # universal
-  - pytest>=5.0.0
-  - pytest-xdist>=1.29.0
-  - pytest-mock
-  - hypothesis>=3.58.0
   - s3fs
-  - pip
   - pyreadstat
+  - pip
   - pip:
     - moto
diff --git a/ci/deps/travis-38.yaml b/ci/deps/travis-38.yaml
index bd62ffa92..88da1331b 100644
--- a/ci/deps/travis-38.yaml
+++ b/ci/deps/travis-38.yaml
@@ -4,13 +4,16 @@ channels:
   - conda-forge
 dependencies:
   - python=3.8.*
+
+  # tools
   - cython>=0.29.13
+  - pytest>=5.0.1
+  - pytest-xdist>=1.29.0  # The rest of the builds use >=1.21, and use pytest-mock
+  - hypothesis>=3.58.0
+
+  # pandas dependencies
   - numpy
   - python-dateutil
   - nomkl
   - pytz
-  # universal
-  - pytest>=5.0.0
-  - pytest-xdist>=1.29.0
-  - hypothesis>=3.58.0
   - pip
diff --git a/environment.yml b/environment.yml
index ef5767f26..54c99f415 100644
--- a/environment.yml
+++ b/environment.yml
@@ -51,7 +51,7 @@ dependencies:
   - botocore>=1.11
   - hypothesis>=3.82
   - moto  # mock S3
-  - pytest>=4.0.2
+  - pytest>=5.0.1
   - pytest-cov
   - pytest-xdist>=1.21
   - seaborn
diff --git a/requirements-dev.txt b/requirements-dev.txt
index 3ae5b57de..87b348c39 100644
--- a/requirements-dev.txt
+++ b/requirements-dev.txt
@@ -30,7 +30,7 @@ boto3
 botocore>=1.11
 hypothesis>=3.82
 moto
-pytest>=4.0.2
+pytest>=5.0.1
 pytest-cov
 pytest-xdist>=1.21
 seaborn
