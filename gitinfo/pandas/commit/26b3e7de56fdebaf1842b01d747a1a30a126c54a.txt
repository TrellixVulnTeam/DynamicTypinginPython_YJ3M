commit 26b3e7de56fdebaf1842b01d747a1a30a126c54a
Author: jbrockmendel <jbrockmendel@gmail.com>
Date:   Mon Jul 30 03:31:35 2018 -0700

    Remove unused cimports, fix #22067 (#22087)

diff --git a/pandas/_libs/hashing.pyx b/pandas/_libs/hashing.pyx
index 448984751..ff92ee306 100644
--- a/pandas/_libs/hashing.pyx
+++ b/pandas/_libs/hashing.pyx
@@ -3,7 +3,7 @@
 # at https://github.com/veorq/SipHash
 
 import cython
-cimport numpy as cnp
+
 import numpy as np
 from numpy cimport ndarray, uint8_t, uint32_t, uint64_t
 
diff --git a/pandas/_libs/tslibs/frequencies.pyx b/pandas/_libs/tslibs/frequencies.pyx
index 7803595ba..5c8efa8c0 100644
--- a/pandas/_libs/tslibs/frequencies.pyx
+++ b/pandas/_libs/tslibs/frequencies.pyx
@@ -2,8 +2,6 @@
 # cython: profile=False
 import re
 
-cimport cython
-
 cimport numpy as cnp
 cnp.import_array()
 
diff --git a/pandas/_libs/tslibs/parsing.pyx b/pandas/_libs/tslibs/parsing.pyx
index 580d155f8..ffa3d8df4 100644
--- a/pandas/_libs/tslibs/parsing.pyx
+++ b/pandas/_libs/tslibs/parsing.pyx
@@ -14,9 +14,7 @@ from cpython.datetime cimport datetime
 import time
 
 import numpy as np
-cimport numpy as cnp
-from numpy cimport int64_t, ndarray
-cnp.import_array()
+from numpy cimport ndarray
 
 # Avoid import from outside _libs
 if sys.version_info.major == 2:
diff --git a/pandas/_libs/tslibs/period.pyx b/pandas/_libs/tslibs/period.pyx
index 4054154cd..65fb0f331 100644
--- a/pandas/_libs/tslibs/period.pyx
+++ b/pandas/_libs/tslibs/period.pyx
@@ -1920,8 +1920,8 @@ class Period(_Period):
         return cls._from_ordinal(ordinal, freq)
 
 
-cdef int64_t _ordinal_from_fields(year, month, quarter, day,
-                                  hour, minute, second, freq):
+cdef int64_t _ordinal_from_fields(int year, int month, quarter, int day,
+                                  int hour, int minute, int second, freq):
     base, mult = get_freq_code(freq)
     if quarter is not None:
         year, month = quarter_to_myear(year, quarter, freq)
diff --git a/pandas/_libs/tslibs/resolution.pyx b/pandas/_libs/tslibs/resolution.pyx
index 4b90c669e..0659e2a55 100644
--- a/pandas/_libs/tslibs/resolution.pyx
+++ b/pandas/_libs/tslibs/resolution.pyx
@@ -5,9 +5,7 @@ cimport cython
 from cython cimport Py_ssize_t
 
 import numpy as np
-cimport numpy as cnp
 from numpy cimport ndarray, int64_t, int32_t
-cnp.import_array()
 
 from util cimport is_string_object, get_nat
 
diff --git a/pandas/_libs/tslibs/strptime.pyx b/pandas/_libs/tslibs/strptime.pyx
index a843a8e2b..de2b74401 100644
--- a/pandas/_libs/tslibs/strptime.pyx
+++ b/pandas/_libs/tslibs/strptime.pyx
@@ -25,8 +25,6 @@ import pytz
 from cython cimport Py_ssize_t
 from cpython cimport PyFloat_Check
 
-cimport cython
-
 import numpy as np
 from numpy cimport ndarray, int64_t
 
diff --git a/pandas/_libs/window.pyx b/pandas/_libs/window.pyx
index 6453b5ed2..efc8a0201 100644
--- a/pandas/_libs/window.pyx
+++ b/pandas/_libs/window.pyx
@@ -9,7 +9,7 @@ from libc.stdlib cimport malloc, free
 
 import numpy as np
 cimport numpy as cnp
-from numpy cimport ndarray, double_t, int64_t, float64_t
+from numpy cimport ndarray, double_t, int64_t, float64_t, float32_t
 cnp.import_array()
 
 
@@ -25,11 +25,11 @@ from skiplist cimport (skiplist_t,
                        skiplist_init, skiplist_destroy,
                        skiplist_get, skiplist_insert, skiplist_remove)
 
-cdef cnp.float32_t MINfloat32 = np.NINF
-cdef cnp.float64_t MINfloat64 = np.NINF
+cdef float32_t MINfloat32 = np.NINF
+cdef float64_t MINfloat64 = np.NINF
 
-cdef cnp.float32_t MAXfloat32 = np.inf
-cdef cnp.float64_t MAXfloat64 = np.inf
+cdef float32_t MAXfloat32 = np.inf
+cdef float64_t MAXfloat64 = np.inf
 
 cdef double NaN = <double> np.NaN
 
diff --git a/pandas/_libs/writers.pyx b/pandas/_libs/writers.pyx
index 77d8ca812..041eb5981 100644
--- a/pandas/_libs/writers.pyx
+++ b/pandas/_libs/writers.pyx
@@ -12,9 +12,7 @@ except ImportError:
     from cpython cimport PyUnicode_GET_SIZE as PyString_GET_SIZE
 
 import numpy as np
-cimport numpy as cnp
 from numpy cimport ndarray, uint8_t
-cnp.import_array()
 
 
 ctypedef fused pandas_string:
diff --git a/pandas/io/msgpack/_packer.pyx b/pandas/io/msgpack/_packer.pyx
index c81069c8e..d67c63218 100644
--- a/pandas/io/msgpack/_packer.pyx
+++ b/pandas/io/msgpack/_packer.pyx
@@ -1,10 +1,16 @@
 # coding: utf-8
 # cython: embedsignature=True
 
-from cpython cimport *
-from libc.stdlib cimport *
-from libc.string cimport *
-from libc.limits cimport *
+from cpython cimport (
+    PyFloat_Check, PyLong_Check, PyInt_Check,
+    PyDict_CheckExact, PyDict_Check,
+    PyTuple_Check, PyList_Check,
+    PyCallable_Check,
+    PyUnicode_Check, PyBytes_Check,
+    PyBytes_AsString,
+    PyBytes_FromStringAndSize,
+    PyUnicode_AsEncodedString)
+from libc.stdlib cimport free, malloc
 
 from pandas.io.msgpack.exceptions import PackValueError
 from pandas.io.msgpack import ExtType
@@ -74,7 +80,7 @@ cdef class Packer(object):
     cdef object _berrors
     cdef char *encoding
     cdef char *unicode_errors
-    cdef bool use_float
+    cdef bint use_float
     cdef bint autoreset
 
     def __cinit__(self):
diff --git a/pandas/io/msgpack/_unpacker.pyx b/pandas/io/msgpack/_unpacker.pyx
index 427414b80..0c50aa5e6 100644
--- a/pandas/io/msgpack/_unpacker.pyx
+++ b/pandas/io/msgpack/_unpacker.pyx
@@ -1,15 +1,23 @@
 # coding: utf-8
 # cython: embedsignature=True
 
-from cpython cimport *
+from cython cimport Py_ssize_t
+
+from cpython cimport (
+    PyCallable_Check,
+    PyBUF_SIMPLE, PyObject_GetBuffer, PyBuffer_Release,
+    PyBytes_Size,
+    PyBytes_FromStringAndSize,
+    PyBytes_AsString)
+
 cdef extern from "Python.h":
     ctypedef struct PyObject
     cdef int PyObject_AsReadBuffer(object o, const void** buff,
                                    Py_ssize_t* buf_len) except -1
 
-from libc.stdlib cimport *
-from libc.string cimport *
-from libc.limits cimport *
+from libc.stdlib cimport free, malloc
+from libc.string cimport memcpy, memmove
+from libc.limits cimport INT_MAX
 
 from pandas.io.msgpack.exceptions import (BufferFull, OutOfData,
                                           UnpackValueError, ExtraData)
diff --git a/pandas/tests/indexes/datetimes/test_datetime.py b/pandas/tests/indexes/datetimes/test_datetime.py
index 1a5f12103..2adf09924 100644
--- a/pandas/tests/indexes/datetimes/test_datetime.py
+++ b/pandas/tests/indexes/datetimes/test_datetime.py
@@ -1,4 +1,5 @@
 import warnings
+import sys
 
 import pytest
 
@@ -126,6 +127,16 @@ class TestDatetimeIndex(object):
         exp = Index([f(x) for x in rng], dtype='<U8')
         tm.assert_index_equal(result, exp)
 
+    @tm.capture_stderr
+    def test_map_fallthrough(self):
+        # GH#22067, check we don't get warnings about silently ignored errors
+        dti = date_range('2017-01-01', '2018-01-01', freq='B')
+
+        dti.map(lambda x: pd.Period(year=x.year, month=x.month, freq='M'))
+
+        cv = sys.stderr.getvalue()
+        assert cv == ''
+
     def test_iteration_preserves_tz(self):
         # see gh-8890
         index = date_range("2012-01-01", periods=3, freq='H', tz='US/Eastern')
