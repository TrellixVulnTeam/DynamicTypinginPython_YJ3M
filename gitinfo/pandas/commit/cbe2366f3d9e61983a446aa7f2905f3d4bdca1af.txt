commit cbe2366f3d9e61983a446aa7f2905f3d4bdca1af
Author: Phillip Cloud <cpcloud@gmail.com>
Date:   Thu Oct 3 18:10:39 2013 -0400

    TST: add test for joining PeriodIndex with DatetimeIndex

diff --git a/doc/source/release.rst b/doc/source/release.rst
index eaf10977a..ebba7444e 100644
--- a/doc/source/release.rst
+++ b/doc/source/release.rst
@@ -553,6 +553,8 @@ Bug Fixes
     passed ``index_col=0`` (:issue:`5066`).
   - Fixed a bug where :func:`~pandas.read_html` was incorrectly infering the
     type of headers (:issue:`5048`).
+  - Fixed a bug where ``DatetimeIndex`` joins with ``PeriodIndex`` caused a
+    stack overflow (:issue:`3899`).
 
 
 pandas 0.12.0
diff --git a/pandas/tseries/period.py b/pandas/tseries/period.py
index fac8aed4b..860fde6e4 100644
--- a/pandas/tseries/period.py
+++ b/pandas/tseries/period.py
@@ -712,11 +712,10 @@ class PeriodIndex(Int64Index):
     def astype(self, dtype):
         dtype = np.dtype(dtype)
         if dtype == np.object_:
-            return Index(np.array([x for x in self], dtype), dtype)
+            return Index(np.array(list(self), dtype), dtype)
         elif dtype == _INT64_DTYPE:
             return Index(self.values.copy(), dtype)
-        else:  # pragma: no cover
-            raise ValueError('Cannot cast PeriodIndex to dtype %s' % dtype)
+        raise ValueError('Cannot cast PeriodIndex to dtype %s' % dtype)
 
     def __iter__(self):
         for val in self.values:
diff --git a/pandas/tseries/tests/test_period.py b/pandas/tseries/tests/test_period.py
index 5629dfa8e..55963b01d 100644
--- a/pandas/tseries/tests/test_period.py
+++ b/pandas/tseries/tests/test_period.py
@@ -1921,7 +1921,7 @@ class TestPeriodIndex(TestCase):
         res = s.index.join(df.columns, how='outer')
         expected = Index([s.index[0], s.index[1],
                           df.columns[0], df.columns[1]], object)
-        np.testing.assert_array_equal(res, expected)
+        tm.assert_index_equal(res, expected)
 
     def test_align_series(self):
         rng = period_range('1/1/2000', '1/1/2010', freq='A')
diff --git a/pandas/tseries/tests/test_timeseries.py b/pandas/tseries/tests/test_timeseries.py
index f3598dd2d..d717033a4 100644
--- a/pandas/tseries/tests/test_timeseries.py
+++ b/pandas/tseries/tests/test_timeseries.py
@@ -2064,6 +2064,19 @@ class TestDatetimeIndex(unittest.TestCase):
         new_index = pd.DatetimeIndex(start=index[0], end=index[-1], freq=index.freq)
         self.assert_index_parameters(new_index)
 
+    def test_join_with_period_index(self):
+        df = tm.makeCustomDataframe(10, 10, data_gen_f=lambda *args:
+                                    np.random.randint(2), c_idx_type='p',
+                                    r_idx_type='dt')
+        s = df.iloc[:5, 0]
+        joins = 'left', 'right', 'inner', 'outer'
+
+        with tm.assertRaisesRegexp(ValueError,
+                                   'can only call with other PeriodIndex-ed '
+                                   'objects'):
+            for join in joins:
+                df.columns.join(s.index, how=join)
+
 
 class TestDatetime64(unittest.TestCase):
     """
