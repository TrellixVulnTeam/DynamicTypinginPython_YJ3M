commit 9b75e50212e3ac5ce589dfe13f7d36b973ca6489
Author: Phillip Cloud <cpcloud@gmail.com>
Date:   Sat Aug 9 20:03:38 2014 -0400

    BUG: fix transform with integers

diff --git a/doc/source/v0.15.0.txt b/doc/source/v0.15.0.txt
index a9266c24d..e6c442159 100644
--- a/doc/source/v0.15.0.txt
+++ b/doc/source/v0.15.0.txt
@@ -385,7 +385,8 @@ Bug Fixes
 
 
 
-
+- Bug in ``GroupBy.transform()`` where int groups with a transform that
+  didn't preserve the index were incorrectly truncated (:issue:`7972`).
 
 
 
diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index 212e5086e..484d1d413 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -2858,7 +2858,9 @@ class NDFrameGroupBy(GroupBy):
 
         # a grouped that doesn't preserve the index, remap index based on the grouper
         # and broadcast it
-        if not isinstance(obj.index,MultiIndex) and type(result.index) != type(obj.index):
+        if ((not isinstance(obj.index,MultiIndex) and
+             type(result.index) != type(obj.index)) or
+            len(result.index) != len(obj.index)):
             results = obj.values.copy()
             for (name, group), (i, row) in zip(self, result.iterrows()):
                 indexer = self._get_index(name)
@@ -2868,7 +2870,7 @@ class NDFrameGroupBy(GroupBy):
         # we can merge the result in
         # GH 7383
         names = result.columns
-        result = obj.merge(result, how='outer', left_index=True, right_index=True).ix[:,-result.shape[1]:]
+        result = obj.merge(result, how='outer', left_index=True, right_index=True).iloc[:,-result.shape[1]:]
         result.columns = names
         return result
 
diff --git a/pandas/tests/test_groupby.py b/pandas/tests/test_groupby.py
index 8e9503b4f..c88ba8368 100644
--- a/pandas/tests/test_groupby.py
+++ b/pandas/tests/test_groupby.py
@@ -3103,7 +3103,6 @@ class TestGroupBy(tm.TestCase):
         exp = np.array([1,2,4,np.nan])
         self.assert_numpy_array_equivalent(result, exp)
 
-
     def test_groupby_first_datetime64(self):
         df = DataFrame([(1, 1351036800000000000), (2, 1351036800000000000)])
         df[1] = df[1].view('M8[ns]')
@@ -4500,6 +4499,20 @@ class TestGroupBy(tm.TestCase):
                                                  [0, 4, 1, 6, 7, 8]]))
         tm.assert_series_equal(r, e)
 
+    def test_transform_doesnt_clobber_ints(self):
+        # GH 7972
+        n = 6
+        x = np.arange(n)
+        df = DataFrame({'a': x // 2, 'b': 2.0 * x, 'c': 3.0 * x})
+        df2 = DataFrame({'a': x // 2 * 1.0, 'b': 2.0 * x, 'c': 3.0 * x})
+
+        gb = df.groupby('a')
+        result = gb.transform('mean')
+
+        gb2 = df2.groupby('a')
+        expected = gb2.transform('mean')
+        tm.assert_frame_equal(result, expected)
+
 
 def assert_fp_equal(a, b):
     assert (np.abs(a - b) < 1e-12).all()
