commit 3552dc0c4533a5eafafe859f5afd29a7ce063e03
Author: Mykola Golubyev <Mykola.Golubyev@twosigma.com>
Date:   Sat Nov 12 11:07:00 2016 -0500

    TST: Fix trailing current date zeros flaky test_format problem
    
    closes #14626
    
    Author: Mykola Golubyev <Mykola.Golubyev@twosigma.com>
    
    Closes #14638 from MykolaGolubyev/issue-14626 and squashes the following commits:
    
    166ec23 [Mykola Golubyev] Inline datetime_now_without_trailing_zeros within test_format
    68a72a7 [Mykola Golubyev] Fix trailing current date zeros flaky test_format problem

diff --git a/pandas/tests/indexes/test_base.py b/pandas/tests/indexes/test_base.py
index b839ed633..ad7e3890b 100644
--- a/pandas/tests/indexes/test_base.py
+++ b/pandas/tests/indexes/test_base.py
@@ -913,7 +913,19 @@ class TestIndex(Base, tm.TestCase):
     def test_format(self):
         self._check_method_works(Index.format)
 
-        index = Index([datetime.now()])
+        # GH 14626
+        # our formatting is different by definition when we have
+        # ms vs us precision (e.g. trailing zeros);
+        # so don't compare this case
+        def datetime_now_without_trailing_zeros():
+            now = datetime.now()
+
+            while str(now).endswith("000"):
+                now = datetime.now()
+
+            return now
+
+        index = Index([datetime_now_without_trailing_zeros()])
 
         # windows has different precision on datetime.datetime.now (it doesn't
         # include us since the default for Timestamp shows these but Index
