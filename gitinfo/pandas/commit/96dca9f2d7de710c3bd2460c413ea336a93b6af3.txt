commit 96dca9f2d7de710c3bd2460c413ea336a93b6af3
Author: Kieran O'Mahony <kieranom@gmail.com>
Date:   Sun Jun 10 16:54:49 2012 +0100

    BUG: ujson don't compare pointers outside their allocated blocks

diff --git a/pandas/src/ujson/lib/ultrajsonenc.c b/pandas/src/ujson/lib/ultrajsonenc.c
index aa1a6497d..aa73abc59 100644
--- a/pandas/src/ujson/lib/ultrajsonenc.c
+++ b/pandas/src/ujson/lib/ultrajsonenc.c
@@ -264,7 +264,7 @@ int Buffer_EscapeStringValidated (JSOBJ obj, JSONObjectEncoder *enc, const char
             {
                 JSUTF32 in;
 
-                if (io + 1 > end)
+                if (end - io < 1)
                 {
                     enc->offset += (of - enc->offset);
                     SetError (obj, enc, "Unterminated UTF-8 sequence when encoding string");
@@ -294,7 +294,7 @@ int Buffer_EscapeStringValidated (JSOBJ obj, JSONObjectEncoder *enc, const char
             {
                 JSUTF32 in;
 
-                if (io + 2 > end)
+                if (end - io < 2)
                 {
                     enc->offset += (of - enc->offset);
                     SetError (obj, enc, "Unterminated UTF-8 sequence when encoding string");
@@ -326,7 +326,7 @@ int Buffer_EscapeStringValidated (JSOBJ obj, JSONObjectEncoder *enc, const char
             {
                 JSUTF32 in;
                 
-                if (io + 3 > end)
+                if (end - io < 3)
                 {
                     enc->offset += (of - enc->offset);
                     SetError (obj, enc, "Unterminated UTF-8 sequence when encoding string");
@@ -411,7 +411,7 @@ int Buffer_EscapeStringValidated (JSOBJ obj, JSONObjectEncoder *enc, const char
 }
 
 #define Buffer_Reserve(__enc, __len) \
-    if ((__enc)->offset + (__len) > (__enc)->end)   \
+    if ((__enc)->end - (__enc)->offset < (__len))  \
     {   \
         Buffer_Realloc((__enc), (__len));\
     }   \
