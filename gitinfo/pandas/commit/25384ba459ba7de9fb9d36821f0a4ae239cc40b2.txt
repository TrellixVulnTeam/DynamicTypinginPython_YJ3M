commit 25384ba459ba7de9fb9d36821f0a4ae239cc40b2
Author: topper-123 <terji78@gmail.com>
Date:   Thu Jul 13 21:35:48 2017 +0100

    Let _get_dtype accept Categoricals and CategoricalIndex  (#16887)

diff --git a/doc/source/whatsnew/v0.21.0.txt b/doc/source/whatsnew/v0.21.0.txt
index a5ee0e0ce..8ba57c0fa 100644
--- a/doc/source/whatsnew/v0.21.0.txt
+++ b/doc/source/whatsnew/v0.21.0.txt
@@ -149,7 +149,6 @@ Conversion
 ^^^^^^^^^^
 
 
-
 Indexing
 ^^^^^^^^
 
diff --git a/pandas/core/dtypes/common.py b/pandas/core/dtypes/common.py
index 2eebf3704..a386c04cc 100644
--- a/pandas/core/dtypes/common.py
+++ b/pandas/core/dtypes/common.py
@@ -11,7 +11,7 @@ from .dtypes import (CategoricalDtype, CategoricalDtypeType,
                      ExtensionDtype)
 from .generic import (ABCCategorical, ABCPeriodIndex,
                       ABCDatetimeIndex, ABCSeries,
-                      ABCSparseArray, ABCSparseSeries)
+                      ABCSparseArray, ABCSparseSeries, ABCCategoricalIndex)
 from .inference import is_string_like
 from .inference import *  # noqa
 
@@ -1713,6 +1713,8 @@ def _get_dtype(arr_or_dtype):
             return PeriodDtype.construct_from_string(arr_or_dtype)
         elif is_interval_dtype(arr_or_dtype):
             return IntervalDtype.construct_from_string(arr_or_dtype)
+    elif isinstance(arr_or_dtype, (ABCCategorical, ABCCategoricalIndex)):
+        return arr_or_dtype.dtype
 
     if hasattr(arr_or_dtype, 'dtype'):
         arr_or_dtype = arr_or_dtype.dtype
diff --git a/pandas/tests/dtypes/test_common.py b/pandas/tests/dtypes/test_common.py
index c32e8590c..7188e397c 100644
--- a/pandas/tests/dtypes/test_common.py
+++ b/pandas/tests/dtypes/test_common.py
@@ -532,16 +532,16 @@ def test_is_complex_dtype():
     (float, np.dtype(float)),
     ('float64', np.dtype('float64')),
     (np.dtype('float64'), np.dtype('float64')),
-    pytest.mark.xfail((str, np.dtype('<U')), ),
+    (str, np.dtype(str)),
     (pd.Series([1, 2], dtype=np.dtype('int16')), np.dtype('int16')),
     (pd.Series(['a', 'b']), np.dtype(object)),
     (pd.Index([1, 2]), np.dtype('int64')),
     (pd.Index(['a', 'b']), np.dtype(object)),
     ('category', 'category'),
     (pd.Categorical(['a', 'b']).dtype, CategoricalDtype()),
-    pytest.mark.xfail((pd.Categorical(['a', 'b']), CategoricalDtype()),),
+    (pd.Categorical(['a', 'b']), CategoricalDtype()),
     (pd.CategoricalIndex(['a', 'b']).dtype, CategoricalDtype()),
-    pytest.mark.xfail((pd.CategoricalIndex(['a', 'b']), CategoricalDtype()),),
+    (pd.CategoricalIndex(['a', 'b']), CategoricalDtype()),
     (pd.DatetimeIndex([1, 2]), np.dtype('<M8[ns]')),
     (pd.DatetimeIndex([1, 2]).dtype, np.dtype('<M8[ns]')),
     ('<M8[ns]', np.dtype('<M8[ns]')),
