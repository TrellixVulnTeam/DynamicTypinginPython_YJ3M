commit 2279c92763a7dc86ddc21d91b9af4a8a38b924a0
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Sat Aug 11 18:47:44 2012 -0400

    BUG: SeriesBinGrouper bugs with how='median' or generic numpy function in some cases close #1688, #1648

diff --git a/RELEASE.rst b/RELEASE.rst
index fe1d7cedf..0767b8ed8 100644
--- a/RELEASE.rst
+++ b/RELEASE.rst
@@ -61,6 +61,8 @@ pandas 0.8.2
   - Fix regression in handling of Series in Series constructor (#1671)
   - Fix another NumPy datetime64 concatenate bug in DataFrame.append (#1681)
   - Fix min_periods handling in new rolling_max/min at array start (#1695)
+  - Fix errors with how='median' and generic NumPy resampling in some cases
+    caused by SeriesBinGrouper (#1648, #1688)
 
 pandas 0.8.1
 ============
diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index 6ed4e9aa8..d819d81ef 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -395,9 +395,10 @@ class GroupBy(object):
         if len(output) == 0:
             return self._python_apply_general(func, *args, **kwargs)
 
-        mask = counts.ravel() > 0
-        for name, result in output.iteritems():
-            output[name] = result[mask]
+        if self.grouper._filter_empty_groups:
+            mask = counts.ravel() > 0
+            for name, result in output.iteritems():
+                output[name] = result[mask]
 
         return self._wrap_aggregated_output(output)
 
diff --git a/pandas/src/reduce.pyx b/pandas/src/reduce.pyx
index 367f36864..115eec1f0 100644
--- a/pandas/src/reduce.pyx
+++ b/pandas/src/reduce.pyx
@@ -129,7 +129,12 @@ cdef class SeriesBinGrouper:
 
         self.dummy = self._check_dummy(dummy)
         self.passed_dummy = dummy is not None
-        self.ngroups = len(bins) + 1
+
+        # kludge for #1688
+        if len(bins) > 0 and bins[-1] == len(series):
+            self.ngroups = len(bins)
+        else:
+            self.ngroups = len(bins) + 1
 
     def _check_dummy(self, dummy=None):
         if dummy is None:
diff --git a/pandas/tseries/tests/test_resample.py b/pandas/tseries/tests/test_resample.py
index fffd98b57..60df7d475 100644
--- a/pandas/tseries/tests/test_resample.py
+++ b/pandas/tseries/tests/test_resample.py
@@ -527,6 +527,18 @@ class TestResample(unittest.TestCase):
         exp = ts.sort_index().resample('D', how='sum')
         assert_series_equal(result, exp)
 
+    def test_resample_median_bug_1688(self):
+        df = DataFrame([1, 2], index=[datetime(2012,1,1,0,0,0),
+                                      datetime(2012,1,1,0,5,0)])
+
+        result = df.resample("T", how=lambda x: x.mean())
+        exp = df.asfreq('T')
+        tm.assert_frame_equal(result, exp)
+
+        result = df.resample("T", how="median")
+        exp = df.asfreq('T')
+        tm.assert_frame_equal(result, exp)
+
 def _simple_ts(start, end, freq='D'):
     rng = date_range(start, end, freq=freq)
     return Series(np.random.randn(len(rng)), index=rng)
