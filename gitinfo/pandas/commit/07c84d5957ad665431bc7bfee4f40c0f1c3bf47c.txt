commit 07c84d5957ad665431bc7bfee4f40c0f1c3bf47c
Author: Jeff Reback <jeff@reback.net>
Date:   Mon Mar 7 16:20:29 2016 -0500

    CI: fix appveyor to use fixed versioning
    
    since the GIT_* env variables are not available

diff --git a/appveyor.yml b/appveyor.yml
index 650137b99..794182020 100644
--- a/appveyor.yml
+++ b/appveyor.yml
@@ -8,9 +8,6 @@
 matrix:
   fast_finish: true     # immediately finish build once one of the jobs fails.
 
-# set clone depth
-clone_depth: 300
-
 environment:
   global:
     # SDK v7.0 MSVC Express 2008's SetEnv.cmd script will fail if the
@@ -23,7 +20,7 @@ environment:
       PYTHON_VERSION: "3.4"
       PYTHON_ARCH: "64"
       CONDA_PY: "34"
-      CONDA_NPY: "110"
+      CONDA_NPY: "19"
 
     - PYTHON: "C:\\Python27_64"
       PYTHON_VERSION: "2.7"
@@ -49,7 +46,8 @@ init:
   - "ECHO %PYTHON_VERSION% %PYTHON%"
 
 install:
-  # this installs the appropriate Miniconda (Py2/Py3, 32/64 bit),
+  # this installs the appropriate Miniconda (Py2/Py3, 32/64 bit)
+  # updates conda & installs: conda-build jinja2 anaconda-client
   - powershell .\ci\install.ps1
   - SET PATH=%PYTHON%;%PYTHON%\Scripts;%PATH%
   - echo "install"
@@ -57,6 +55,9 @@ install:
   - ls -ltr
   - git tag --sort v:refname
 
+  # this can conflict with git
+  - cmd: rmdir C:\cygwin /s /q
+
   # install our build environment
   - cmd: conda config --set show_channel_urls yes --set always_yes yes --set changeps1 no
   - cmd: conda update -q conda
@@ -64,21 +65,22 @@ install:
   - cmd: conda config --set ssl_verify false
 
   # this is now the downloaded conda...
-  - conda info -a
+  - cmd: conda info -a
 
   # build em using the local source checkout in the correct windows env
-  - conda install conda-build
-  - cmd: '%CMD_IN_ENV% conda build ci\appveyor.recipe -q --no-test'
+  - cmd: '%CMD_IN_ENV% conda build ci\appveyor.recipe -q'
 
   # create our env
-  - SET REQ=ci\requirements-%PYTHON_VERSION%-%PYTHON_ARCH%.run
   - cmd: conda create -q -n pandas python=%PYTHON_VERSION% nose
   - cmd: activate pandas
-  - cmd: conda install -q --file=%REQ%
-  - ps: conda install -q (conda build ci\appveyor.recipe -q --output --no-test)
+  - SET REQ=ci\requirements-%PYTHON_VERSION%-%PYTHON_ARCH%.run
+  - cmd: echo "installing requirements from %REQ%"
+  - cmd: conda install -n pandas -q --file=%REQ%
+  - ps: conda install -n pandas (conda build ci\appveyor.recipe -q --output)
 
 test_script:
   # tests
   - cd \
-  - conda list pandas
-  - nosetests --exe -A "not slow and not network and not disabled" pandas
+  - cmd: activate pandas
+  - cmd: conda list
+  - cmd: nosetests --exe -A "not slow and not network and not disabled" pandas
diff --git a/ci/appveyor.recipe/meta.yaml b/ci/appveyor.recipe/meta.yaml
index c497acf33..ccba8a297 100644
--- a/ci/appveyor.recipe/meta.yaml
+++ b/ci/appveyor.recipe/meta.yaml
@@ -1,10 +1,10 @@
 package:
     name: pandas
-    version: {{ environ.get('GIT_DESCRIBE_TAG','') }}
+    version: 0.18.0
 
 build:
-    number: {{ environ.get('GIT_DESCRIBE_NUMBER',0) }}
-    string: np{{ environ.get('CONDA_NPY') }}py{{ environ.get('CONDA_PY') }}_{{ environ.get('GIT_BUILD_STR','') }}
+    number: {{environ.get('APPVEYOR_BUILD_NUMBER', 0)}}  # [win]
+    string: np{{ environ.get('CONDA_NPY') }}py{{ environ.get('CONDA_PY') }}_{{ environ.get('APPVEYOR_BUILD_NUMBER', 0) }} # [win]
 
 source:
 
diff --git a/ci/install.ps1 b/ci/install.ps1
index c964973c6..16c92dc76 100644
--- a/ci/install.ps1
+++ b/ci/install.ps1
@@ -7,11 +7,7 @@ $MINICONDA_URL = "http://repo.continuum.io/miniconda/"
 
 function DownloadMiniconda ($python_version, $platform_suffix) {
     $webclient = New-Object System.Net.WebClient
-    if ($python_version -match "3.4") {
-        $filename = "Miniconda3-latest-Windows-" + $platform_suffix + ".exe"
-    } else {
-        $filename = "Miniconda-latest-Windows-" + $platform_suffix + ".exe"
-    }
+    $filename = "Miniconda3-latest-Windows-" + $platform_suffix + ".exe"
     $url = $MINICONDA_URL + $filename
 
     $basedir = $pwd.Path + "\"
diff --git a/ci/requirements-2.7-64.run b/ci/requirements-2.7-64.run
index 260ae8125..c152c7160 100644
--- a/ci/requirements-2.7-64.run
+++ b/ci/requirements-2.7-64.run
@@ -1,6 +1,6 @@
 dateutil
 pytz
-numpy
+numpy=1.10*
 xlwt
 numexpr
 pytables
diff --git a/ci/requirements-3.4-64.run b/ci/requirements-3.4-64.run
index 5eb8a5666..e90722360 100644
--- a/ci/requirements-3.4-64.run
+++ b/ci/requirements-3.4-64.run
@@ -1,6 +1,6 @@
 python-dateutil
 pytz
-numpy
+numpy=1.9*
 openpyxl
 xlsxwriter
 xlrd
diff --git a/ci/requirements-3.5-64.run b/ci/requirements-3.5-64.run
index 6beeb2fc3..81565f246 100644
--- a/ci/requirements-3.5-64.run
+++ b/ci/requirements-3.5-64.run
@@ -1,6 +1,6 @@
 python-dateutil
 pytz
-numpy
+numpy=1.10*
 openpyxl
 xlsxwriter
 xlrd
