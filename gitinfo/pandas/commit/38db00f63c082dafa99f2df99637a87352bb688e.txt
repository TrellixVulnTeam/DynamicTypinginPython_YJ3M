commit 38db00f63c082dafa99f2df99637a87352bb688e
Author: Wes McKinney <wesmckinn@gmail.com>
Date:   Wed Mar 14 22:26:05 2012 -0400

    BUG: malformed blocks when excluding nuisance columns causing #916

diff --git a/pandas/core/groupby.py b/pandas/core/groupby.py
index d7d121b09..2a3ee9cd7 100644
--- a/pandas/core/groupby.py
+++ b/pandas/core/groupby.py
@@ -1083,6 +1083,9 @@ class DataFrameGroupBy(GroupBy):
                 all_items.extend(b.items)
             output_keys = agg_labels[agg_labels.isin(all_items)]
 
+            for blk in new_blocks:
+                blk.set_ref_items(output_keys, maybe_rename=False)
+
         if not self.as_index:
             index = np.arange(new_blocks[0].values.shape[1])
             mgr = BlockManager(new_blocks, [output_keys, index])
diff --git a/pandas/tools/tests/test_merge.py b/pandas/tools/tests/test_merge.py
index 982aa87be..5b78f41c0 100644
--- a/pandas/tools/tests/test_merge.py
+++ b/pandas/tools/tests/test_merge.py
@@ -964,8 +964,8 @@ class TestConcatenate(unittest.TestCase):
         tm.assert_frame_equal(result, expected)
 
     def test_concat_ignore_index(self):
-        frame1 = DataFrame({"test1": ["a", "b", "c"], 
-                            "test2": [1,2,3], 
+        frame1 = DataFrame({"test1": ["a", "b", "c"],
+                            "test2": [1,2,3],
                             "test3": [4.5, 3.2, 1.2]})
         frame2 = DataFrame({"test3": [5.2, 2.2, 4.3]})
         frame1.index = Index(["x", "y", "z"])
@@ -974,12 +974,12 @@ class TestConcatenate(unittest.TestCase):
         v1 = concat([frame1, frame2], axis=1, ignore_index=True)
 
         nan = np.nan
-        expected = DataFrame([[nan,nan,nan, 4.3], 
+        expected = DataFrame([[nan,nan,nan, 4.3],
                               ['a', 1, 4.5, 5.2],
                               ['b', 2, 3.2, 2.2],
-                              ['c', 3, 1.2, nan]], 
+                              ['c', 3, 1.2, nan]],
                              index=Index(["q", "x", "y", "z"]))
-                
+
         tm.assert_frame_equal(v1, expected)
 
     def test_concat_multiindex_with_keys(self):
@@ -1221,6 +1221,20 @@ class TestConcatenate(unittest.TestCase):
         tm.assert_frame_equal(result, df)
         self.assertRaises(Exception, concat, [None, None])
 
+    def test_mixed_type_join_with_suffix(self):
+        # GH #916
+        df = DataFrame(np.random.randn(20, 6),
+                       columns=['a', 'b', 'c', 'd', 'e', 'f'])
+        df.insert(0, 'id', 0)
+        df.insert(5, 'dt', 'foo')
+
+        grouped = df.groupby('id')
+        mn = grouped.mean()
+        cn = grouped.count()
+
+        # it works!
+        mn.join(cn, rsuffix='_right')
+
 if __name__ == '__main__':
     import nose
     nose.runmodule(argv=[__file__,'-vvs','-x','--pdb', '--pdb-failure'],
