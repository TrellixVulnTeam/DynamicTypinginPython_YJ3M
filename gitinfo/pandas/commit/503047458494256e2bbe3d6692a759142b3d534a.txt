commit 503047458494256e2bbe3d6692a759142b3d534a
Author: Chang She <changshe@gmail.com>
Date:   Sat Nov 3 22:31:06 2012 -0400

    BUG: off-center grid in case of stacked bar plot #2157

diff --git a/pandas/tests/test_graphics.py b/pandas/tests/test_graphics.py
index 35786c242..859d51d56 100644
--- a/pandas/tests/test_graphics.py
+++ b/pandas/tests/test_graphics.py
@@ -288,6 +288,21 @@ class TestDataFramePlots(unittest.TestCase):
         df = DataFrame({'a': [0, 1], 'b': [1, 0]})
         _check_plot_works(df.plot, kind='bar')
 
+    @slow
+    def test_bar_stacked_center(self):
+        #GH2157
+        df = DataFrame({'A' : [3] * 5, 'B' : range(5)}, index = range(5))
+        ax = df.plot(kind='bar', stacked='True', grid=True)
+        self.assertEqual(ax.xaxis.get_ticklocs()[0],
+                         ax.patches[0].get_x() + ax.patches[0].get_width() / 2)
+
+    @slow
+    def test_bar_center(self):
+        df = DataFrame({'A' : [3] * 5, 'B' : range(5)}, index = range(5))
+        ax = df.plot(kind='bar', grid=True)
+        self.assertEqual(ax.xaxis.get_ticklocs()[0],
+                         ax.patches[0].get_x() + ax.patches[0].get_width())
+
     @slow
     def test_boxplot(self):
         df = DataFrame(np.random.randn(6, 4),
diff --git a/pandas/tools/plotting.py b/pandas/tools/plotting.py
index 23d3df8a9..97cae5e35 100644
--- a/pandas/tools/plotting.py
+++ b/pandas/tools/plotting.py
@@ -1083,6 +1083,10 @@ class BarPlot(MPLPlot):
     def __init__(self, data, **kwargs):
         self.stacked = kwargs.pop('stacked', False)
         self.ax_pos = np.arange(len(data)) + 0.25
+        if self.stacked:
+            self.tickoffset = 0.25
+        else:
+            self.tickoffset = 0.375
         MPLPlot.__init__(self, data, **kwargs)
 
     def _args_adjust(self):
@@ -1149,7 +1153,7 @@ class BarPlot(MPLPlot):
             name = self._get_index_name()
             if self.kind == 'bar':
                 ax.set_xlim([self.ax_pos[0] - 0.25, self.ax_pos[-1] + 1])
-                ax.set_xticks(self.ax_pos + 0.375)
+                ax.set_xticks(self.ax_pos + self.tickoffset)
                 ax.set_xticklabels(str_index, rotation=self.rot,
                                    fontsize=self.fontsize)
                 ax.axhline(0, color='k', linestyle='--')
@@ -1158,7 +1162,7 @@ class BarPlot(MPLPlot):
             else:
                 # horizontal bars
                 ax.set_ylim([self.ax_pos[0] - 0.25, self.ax_pos[-1] + 1])
-                ax.set_yticks(self.ax_pos + 0.375)
+                ax.set_yticks(self.ax_pos + self.tickoffset)
                 ax.set_yticklabels(str_index, rotation=self.rot,
                                    fontsize=self.fontsize)
                 ax.axvline(0, color='k', linestyle='--')
