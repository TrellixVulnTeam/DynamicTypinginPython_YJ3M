commit 8a66202679d27ace7b9075fe9b8a1243e4160223
Author: Adam Klein <adamklein@gmail.com>
Date:   Sat Feb 4 18:02:17 2012 -0500

    BUG: fix related to #742, handle nan, none correctly

diff --git a/pandas/src/stats.pyx b/pandas/src/stats.pyx
index 7861c2864..e50bf8c61 100644
--- a/pandas/src/stats.pyx
+++ b/pandas/src/stats.pyx
@@ -166,7 +166,7 @@ def rank_1d_object(object in_arr):
         sum_ranks += i + 1
         dups += 1
         val = util.get_value_at(sorted_data, i)
-        if val == nan_value:
+        if val != val or val is None:
             ranks[argsorted[i]] = nan
             continue
         if (i == n - 1) or util.get_value_at(sorted_data, i + 1) != val:
diff --git a/pandas/tests/test_frame.py b/pandas/tests/test_frame.py
index 4af6812f3..f4a76da75 100644
--- a/pandas/tests/test_frame.py
+++ b/pandas/tests/test_frame.py
@@ -4175,6 +4175,15 @@ class TestDataFrame(unittest.TestCase, CheckIndexing,
         expected = DataFrame([[2.0, 3.0, 1.0], [1, 3, 2]])
         assert_frame_equal(result, expected)
 
+        df = DataFrame([['b',None,'a'],['a','c','b']])
+        result = df.rank(1)
+        expected = DataFrame([[2.0, 1.5, 1.0], [1, 1.5, 2]])
+        assert_frame_equal(result, expected)
+
+        result = df.rank(0)
+        expected = DataFrame([[2.0, 3.0, 1.0], [1, 3, 2]])
+        assert_frame_equal(result, expected)
+
     def test_describe(self):
         desc = self.tsframe.describe()
         desc = self.mixed_frame.describe()
