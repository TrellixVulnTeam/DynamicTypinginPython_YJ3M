commit cb1133f9449e9376f5d29a61964739ae753ab5ac
Author: Chang She <changshe@gmail.com>
Date:   Thu Nov 8 10:48:41 2012 -0500

    BUG: join_non_unique doesn't sort properly for DatetimeIndex #2196

diff --git a/pandas/core/common.py b/pandas/core/common.py
index 7bbbaab49..60a0c30a4 100644
--- a/pandas/core/common.py
+++ b/pandas/core/common.py
@@ -852,6 +852,13 @@ def is_integer_dtype(arr_or_dtype):
             (issubclass(tipo, np.datetime64) or
              issubclass(tipo, np.timedelta64)))
 
+def _is_int_or_datetime_dtype(arr_or_dtype):
+    # also timedelta64
+    if isinstance(arr_or_dtype, np.dtype):
+        tipo = arr_or_dtype.type
+    else:
+        tipo = arr_or_dtype.dtype.type
+    return issubclass(tipo, np.integer)
 
 def is_datetime64_dtype(arr_or_dtype):
     if isinstance(arr_or_dtype, np.dtype):
diff --git a/pandas/tools/merge.py b/pandas/tools/merge.py
index d92ed1cb0..62529201b 100644
--- a/pandas/tools/merge.py
+++ b/pandas/tools/merge.py
@@ -555,7 +555,7 @@ _join_functions = {
 
 
 def _factorize_keys(lk, rk, sort=True):
-    if com.is_integer_dtype(lk) and com.is_integer_dtype(rk):
+    if com._is_int_or_datetime_dtype(lk) and com._is_int_or_datetime_dtype(rk):
         klass = lib.Int64Factorizer
         lk = com._ensure_int64(lk)
         rk = com._ensure_int64(rk)
diff --git a/pandas/tseries/tests/test_timeseries.py b/pandas/tseries/tests/test_timeseries.py
index eabacc222..daaa86f68 100644
--- a/pandas/tseries/tests/test_timeseries.py
+++ b/pandas/tseries/tests/test_timeseries.py
@@ -1645,6 +1645,14 @@ class TestLegacySupport(unittest.TestCase):
         _check_join(index[:15], obj_index[5:], how='right')
         _check_join(index[:15], obj_index[5:], how='left')
 
+    def test_join_nonunique(self):
+        idx1 = to_datetime(['2012-11-06 16:00:11.477563',
+                            '2012-11-06 16:00:11.477563'])
+        idx2 = to_datetime(['2012-11-06 15:11:09.006507',
+                            '2012-11-06 15:11:09.006507'])
+        rs = idx1.join(idx2, how='outer')
+        self.assert_(rs.is_monotonic)
+
     def test_unpickle_daterange(self):
         pth, _ = os.path.split(os.path.abspath(__file__))
         filepath = os.path.join(pth, 'data', 'daterange_073.pickle')
