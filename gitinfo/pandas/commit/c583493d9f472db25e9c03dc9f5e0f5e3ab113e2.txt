commit c583493d9f472db25e9c03dc9f5e0f5e3ab113e2
Author: Phillip Cloud <cpcloud@gmail.com>
Date:   Wed Sep 25 10:41:38 2013 -0400

    ENH: add statsmodels wheel
    
    Also removes the statsmodels/pandas faking part of ci/install.sh by using a
    statsmodels wheel

diff --git a/ci/install.sh b/ci/install.sh
index 86226c530..357d962d9 100755
--- a/ci/install.sh
+++ b/ci/install.sh
@@ -62,19 +62,6 @@ if [ x"$FULL_DEPS" == x"true" ]; then
     echo "Installing FULL_DEPS"
     # for pytables gets the lib as well
     time sudo apt-get $APT_ARGS install libhdf5-serial-dev
-
-    # fool statsmodels into thinking pandas was already installed
-    # so it won't refuse to install itself.
-
-    SITE_PKG_DIR=$VIRTUAL_ENV/lib/python$TRAVIS_PYTHON_VERSION/site-packages
-    echo "Using SITE_PKG_DIR: $SITE_PKG_DIR"
-
-    mkdir  $SITE_PKG_DIR/pandas
-    touch $SITE_PKG_DIR/pandas/__init__.py
-    echo "version='0.10.0-phony'" >  $SITE_PKG_DIR/pandas/version.py
-    time pip install $PIP_ARGS git+git://github.com/statsmodels/statsmodels@c9062e43b8a5f7385537ca95#egg=statsmodels
-
-    rm -Rf $SITE_PKG_DIR/pandas # scrub phoney pandas
 fi
 
 # build pandas
diff --git a/ci/requirements-2.7.txt b/ci/requirements-2.7.txt
index 2e903102d..686dc87f7 100644
--- a/ci/requirements-2.7.txt
+++ b/ci/requirements-2.7.txt
@@ -17,3 +17,4 @@ scikits.timeseries==0.91.3
 MySQL-python==1.2.4
 scipy==0.10.0
 beautifulsoup4==4.2.1
+statsmodels==0.5.0
diff --git a/ci/requirements-2.7_LOCALE.txt b/ci/requirements-2.7_LOCALE.txt
index 056b63bbb..e4cdf0733 100644
--- a/ci/requirements-2.7_LOCALE.txt
+++ b/ci/requirements-2.7_LOCALE.txt
@@ -15,3 +15,4 @@ html5lib==1.0b2
 lxml==3.2.1
 scipy==0.10.0
 beautifulsoup4==4.2.1
+statsmodels==0.5.0
diff --git a/ci/requirements-3.2.txt b/ci/requirements-3.2.txt
index b68904701..b44a708c4 100644
--- a/ci/requirements-3.2.txt
+++ b/ci/requirements-3.2.txt
@@ -12,3 +12,4 @@ patsy==0.1.0
 lxml==3.2.1
 scipy==0.12.0
 beautifulsoup4==4.2.1
+statsmodels==0.4.3
diff --git a/ci/requirements-3.3.txt b/ci/requirements-3.3.txt
index 326098be5..318030e73 100644
--- a/ci/requirements-3.3.txt
+++ b/ci/requirements-3.3.txt
@@ -13,3 +13,4 @@ patsy==0.1.0
 lxml==3.2.1
 scipy==0.12.0
 beautifulsoup4==4.2.1
+statsmodels==0.4.3
diff --git a/ci/speedpack/build.sh b/ci/speedpack/build.sh
index d19c6da8a..689f9aa5d 100755
--- a/ci/speedpack/build.sh
+++ b/ci/speedpack/build.sh
@@ -26,6 +26,42 @@ apt-get build-dep python-lxml -y
 export PYTHONIOENCODING='utf-8'
 export VIRTUALENV_DISTRIBUTE=0
 
+
+function create_fake_pandas() {
+    local site_pkg_dir="$1"
+    rm -rf $site_pkg_dir/pandas
+    mkdir $site_pkg_dir/pandas
+    touch $site_pkg_dir/pandas/__init__.py
+    echo "version = '0.10.0-phony'" > $site_pkg_dir/pandas/version.py
+}
+
+
+function get_site_pkgs_dir() {
+    python$1 -c 'import distutils; print(distutils.sysconfig.get_python_lib())'
+}
+
+
+function create_wheel() {
+    local pip_args="$1"
+    local wheelhouse="$2"
+    local n="$3"
+    local pyver="$4"
+
+    local site_pkgs_dir="$(get_site_pkgs_dir $pyver)"
+
+
+    if [[ "$n" == *statsmodels* ]]; then
+        create_fake_pandas $site_pkgs_dir && \
+        pip wheel $pip_args --wheel-dir=$wheelhouse $n && \
+        pip install $pip_args --no-index $n && \
+        rm -Rf $site_pkgs_dir
+    else
+        pip wheel $pip_args --wheel-dir=$wheelhouse $n
+        pip install $pip_args --no-index $n
+    fi
+}
+
+
 function generate_wheels() {
     # get the requirements file
     local reqfile="$1"
@@ -62,8 +98,7 @@ function generate_wheels() {
 
     # install and build the wheels
     cat $reqfile | while read N; do
-        pip wheel $PIP_ARGS --wheel-dir=$WHEELHOUSE $N
-        pip install $PIP_ARGS --no-index $N
+        create_wheel "$PIP_ARGS" "$WHEELHOUSE" "$N" "$PY_VER"
     done
 }
 
