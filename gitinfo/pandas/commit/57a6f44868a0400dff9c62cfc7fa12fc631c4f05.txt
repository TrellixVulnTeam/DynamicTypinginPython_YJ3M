commit 57a6f44868a0400dff9c62cfc7fa12fc631c4f05
Author: jbrockmendel <jbrockmendel@gmail.com>
Date:   Tue Jan 15 17:34:54 2019 -0800

    PERF avoid object-dtype comparisons (#24792)

diff --git a/pandas/core/internals/blocks.py b/pandas/core/internals/blocks.py
index 20881972c..df764aa4b 100644
--- a/pandas/core/internals/blocks.py
+++ b/pandas/core/internals/blocks.py
@@ -2465,6 +2465,12 @@ class DatetimeTZBlock(ExtensionBlock, DatetimeBlock):
                               klass=ObjectBlock,)
             return newb.setitem(indexer, value)
 
+    def equals(self, other):
+        # override for significant performance improvement
+        if self.dtype != other.dtype or self.shape != other.shape:
+            return False
+        return (self.values.view('i8') == other.values.view('i8')).all()
+
 
 class TimeDeltaBlock(DatetimeLikeBlockMixin, IntBlock):
     __slots__ = ()
diff --git a/pandas/util/testing.py b/pandas/util/testing.py
index 2df43cd67..f441dd20f 100644
--- a/pandas/util/testing.py
+++ b/pandas/util/testing.py
@@ -1199,6 +1199,11 @@ def assert_extension_array_equal(left, right, check_dtype=True,
     if check_dtype:
         assert_attr_equal('dtype', left, right, obj='ExtensionArray')
 
+    if hasattr(left, "asi8") and type(right) == type(left):
+        # Avoid slow object-dtype comparisons
+        assert_numpy_array_equal(left.asi8, right.asi8)
+        return
+
     left_na = np.asarray(left.isna())
     right_na = np.asarray(right.isna())
     assert_numpy_array_equal(left_na, right_na, obj='ExtensionArray NA mask')
