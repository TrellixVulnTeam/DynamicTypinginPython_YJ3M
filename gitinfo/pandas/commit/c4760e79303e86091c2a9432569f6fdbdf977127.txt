commit c4760e79303e86091c2a9432569f6fdbdf977127
Author: y-p <yoval@gmx.com>
Date:   Sun Feb 2 17:50:05 2014 +0200

    BLD: fix travis caching on py3

diff --git a/ci/ironcache/get.py b/ci/ironcache/get.py
index 45ce4165c..a4663472b 100644
--- a/ci/ironcache/get.py
+++ b/ci/ironcache/get.py
@@ -9,13 +9,16 @@ import json
 import base64
 from hashlib import sha1
 from iron_cache import *
+import traceback as tb
 
 key='KEY.%s.%s' %(os.environ.get('TRAVIS_REPO_SLUG','unk'),
                    os.environ.get('JOB_NAME','unk'))
+print(key)
+
 if sys.version_info[0] > 2:
-    key = sha1(bytes(key,encoding='utf8')).hexdigest()[:8]+'.'
-else:
-    key = sha1(key).hexdigest()[:8]+'.'
+    key = bytes(key,encoding='utf8')
+
+key = sha1(key).hexdigest()[:8]+'.'
 
 b = b''
 cache = IronCache()
@@ -23,8 +26,15 @@ for i in range(20):
     print("getting %s" % key+str(i))
     try:
         item = cache.get(cache="travis", key=key+str(i))
-        b += bytes(base64.b64decode(item.value))
-    except:
+        v = item.value
+        if sys.version_info[0] > 2:
+            v = bytes(v,encoding='utf8')
+        b += bytes(base64.b64decode(v))
+    except Exception as e:
+        try:
+            print(tb.format_exc(e))
+        except:
+            print("exception during exception, oh my")
         break
 
 with open(os.path.join(os.environ.get('HOME',''),"ccache.7z"),'wb') as f:
diff --git a/ci/ironcache/put.py b/ci/ironcache/put.py
index 0faf17348..f6aef3a32 100644
--- a/ci/ironcache/put.py
+++ b/ci/ironcache/put.py
@@ -12,10 +12,15 @@ from iron_cache import *
 
 key='KEY.%s.%s' %(os.environ.get('TRAVIS_REPO_SLUG','unk'),
                    os.environ.get('JOB_NAME','unk'))
+
+key='KEY.%s.%s' %(os.environ.get('TRAVIS_REPO_SLUG','unk'),
+                   os.environ.get('JOB_NAME','unk'))
+print(key)
+
 if sys.version_info[0] > 2:
-    key = sha1(bytes(key,encoding='utf8')).hexdigest()[:8]+'.'
-else:
-    key = sha1(key).hexdigest()[:8]+'.'
+    key = bytes(key,encoding='utf8')
+
+key = sha1(key).hexdigest()[:8]+'.'
 
 os.chdir(os.environ.get('HOME'))
 
