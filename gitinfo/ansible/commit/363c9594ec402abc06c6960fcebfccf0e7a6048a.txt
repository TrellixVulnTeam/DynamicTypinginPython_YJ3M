commit 363c9594ec402abc06c6960fcebfccf0e7a6048a
Author: Matt Clay <matt@mystile.com>
Date:   Thu Mar 21 17:31:04 2019 -0700

    Clean up group_by integration test. (#54206)
    
    * Split group creation out into separate file.
    * Move skipped group into separate playbook.

diff --git a/test/integration/targets/group_by/create_groups.yml b/test/integration/targets/group_by/create_groups.yml
new file mode 100644
index 0000000000..588c48a347
--- /dev/null
+++ b/test/integration/targets/group_by/create_groups.yml
@@ -0,0 +1,31 @@
+# test code for the group_by module
+# (c) 2014, Chris Church <cchurch@ansible.com>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+- debug: var=genus
+
+- name: group by genus
+  group_by: key={{ genus }}
+
+- name: group by first three letters of genus with key in quotes
+  group_by: key="{{ genus[:3] }}"
+
+- name: group by first two letters of genus with key not in quotes
+  group_by: key={{ genus[:2] }}
+
+- name: group by genus in uppercase using complex args
+  group_by: { key: "{{ genus | upper() }}" }
diff --git a/test/integration/targets/group_by/runme.sh b/test/integration/targets/group_by/runme.sh
index c6f6841e5c..d119268194 100755
--- a/test/integration/targets/group_by/runme.sh
+++ b/test/integration/targets/group_by/runme.sh
@@ -3,3 +3,4 @@
 set -eux
 
 ansible-playbook test_group_by.yml -i inventory.group_by -v "$@"
+ANSIBLE_HOST_PATTERN_MISMATCH=warning ansible-playbook test_group_by_skipped.yml -i inventory.group_by -v "$@"
diff --git a/test/integration/targets/group_by/test_group_by.yml b/test/integration/targets/group_by/test_group_by.yml
index 3d439c6a09..07368dfe90 100644
--- a/test/integration/targets/group_by/test_group_by.yml
+++ b/test/integration/targets/group_by/test_group_by.yml
@@ -20,18 +20,7 @@
   hosts: all
   gather_facts: false
   tasks:
-    - debug: var=genus
-    - name: group by genus
-      group_by: key={{ genus }}
-
-    - name: group by first three letters of genus with key in quotes
-      group_by: key="{{ genus[:3] }}"
-
-    - name: group by first two letters of genus with key not in quotes
-      group_by: key={{ genus[:2] }}
-
-    - name: group by genus in uppercase using complex args
-      group_by: { key: "{{ genus | upper() }}" }
+    - include_tasks: create_groups.yml
 
 - name: Vicunga group validation
   hosts: vicugna
@@ -141,13 +130,6 @@
     - name: set a fact to check that we ran this play
       set_fact: genus_CAMELUS=true
 
-- name: genus group validation (expect skipped)
-  hosts: 'genus'
-  gather_facts: false
-  tasks:
-    - name: no hosts should match this group
-      fail: msg="should never get here"
-
 - name: alpaca validation of groups
   hosts: alpaca
   gather_facts: false
diff --git a/test/integration/targets/group_by/test_group_by_skipped.yml b/test/integration/targets/group_by/test_group_by_skipped.yml
new file mode 100644
index 0000000000..6c18b4e8d5
--- /dev/null
+++ b/test/integration/targets/group_by/test_group_by_skipped.yml
@@ -0,0 +1,30 @@
+# test code for the group_by module
+# (c) 2014, Chris Church <cchurch@ansible.com>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+- name: Create overall groups
+  hosts: all
+  gather_facts: false
+  tasks:
+    - include_tasks: create_groups.yml
+
+- name: genus group validation (expect skipped)
+  hosts: 'genus'
+  gather_facts: false
+  tasks:
+    - name: no hosts should match this group
+      fail: msg="should never get here"
