commit 7dc60c3f242250beeee66d27212ca5393dfbcdd4
Author: Nathaniel Case <this.is@nathanielca.se>
Date:   Fri Sep 15 15:34:32 2017 -0400

    nxos_install_os install_state fix

diff --git a/lib/ansible/modules/network/nxos/nxos_install_os.py b/lib/ansible/modules/network/nxos/nxos_install_os.py
index d652d90242..9e16291903 100644
--- a/lib/ansible/modules/network/nxos/nxos_install_os.py
+++ b/lib/ansible/modules/network/nxos/nxos_install_os.py
@@ -189,7 +189,6 @@ def main():
     warnings = list()
     check_args(module, warnings)
 
-    install_state = module.params['install_state']
     system_image_file = module.params['system_image_file']
     kickstart_image_file = module.params['kickstart_image_file']
 
@@ -203,6 +202,7 @@ def main():
                        kickstart_image_file):
         changed = True
 
+    install_state = current_boot_options
     if not module.check_mode and changed is True:
         set_boot_options(module,
                          system_image_file,
@@ -213,8 +213,6 @@ def main():
                            kickstart_image_file):
             module.fail_json(msg='Install not successful',
                              install_state=install_state)
-    else:
-        install_state = current_boot_options
 
     module.exit_json(changed=changed, install_state=install_state, warnings=warnings)
 
