commit 46263d77f145ffd46a0ff05ce61c5b96026c02f8
Author: Nathaniel Case <this.is@nathanielca.se>
Date:   Mon Jan 8 10:56:47 2018 -0500

    Fixes for nxos_config integration tests (#34579)
    
    * deletage_to: localhost -> connection: local
    
    * Fix test setup

diff --git a/test/integration/targets/nxos_config/tests/common/backup.yaml b/test/integration/targets/nxos_config/tests/common/backup.yaml
index 15340fd6d4..a9e2f1f82b 100644
--- a/test/integration/targets/nxos_config/tests/common/backup.yaml
+++ b/test/integration/targets/nxos_config/tests/common/backup.yaml
@@ -17,11 +17,11 @@
     provider: "{{ connection }}"
 
 - name: collect any backup files
-  find:
+  find: &backups
     paths: "{{ role_path }}/backup"
     pattern: "{{ inventory_hostname_short }}_config*"
+  connection: local
   register: backup_files
-  delegate_to: localhost
 
 - name: delete backup files
   file:
@@ -46,11 +46,9 @@
       - "result.updates is defined"
 
 - name: collect any backup files
-  find:
-    paths: "{{ role_path }}/backup"
-    pattern: "{{ inventory_hostname_short }}_config*"
+  find: *backups
+  connection: local
   register: backup_files
-  delegate_to: localhost
 
 - assert:
     that:
diff --git a/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml b/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
index c70e8f51eb..7a4864664d 100644
--- a/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
+++ b/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
@@ -4,12 +4,8 @@
   when: ansible_connection == "local"
 
 - name: setup
-  nxos_config:
-    lines:
-      - 10 permit ip 1.1.1.1/32 any log
-      - 20 permit ip 2.2.2.2/32 any log
-      - 30 permit ip 3.3.3.3/32 any log
-    parents: ip access-list test
+  nxos_config: &clear
+    lines: no ip access-list test
     provider: "{{ connection }}"
     match: none
 
@@ -51,9 +47,6 @@
       - "result.changed == false"
 
 - name: teardown
-  nxos_config:
-    lines: no ip access-list test
-    provider: "{{ connection }}"
-    match: none
+  nxos_config: *clear
 
 - debug: msg='END connection={{ ansible_connection }}/sublevel_block.yaml'
