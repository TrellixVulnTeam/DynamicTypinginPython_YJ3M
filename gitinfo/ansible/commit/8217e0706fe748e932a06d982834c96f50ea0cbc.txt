commit 8217e0706fe748e932a06d982834c96f50ea0cbc
Author: Kavin Kankeshwar <kavin@aerospike.com>
Date:   Wed May 29 00:03:12 2013 -0700

    Avoid crash in module_common when the file cannot be moved/copy

diff --git a/lib/ansible/module_common.py b/lib/ansible/module_common.py
index 8565f16d20..a8083100ea 100644
--- a/lib/ansible/module_common.py
+++ b/lib/ansible/module_common.py
@@ -815,7 +815,7 @@ class AnsibleModule(object):
             self.fail_json(msg='Could not make backup of %s to %s: %s' % (fn, backupdest, e))
         return backupdest
 
-    def cleanup(tmpfile):
+    def cleanup(self,tmpfile):
         if os.path.exists(tmpfile):
             try:
                 os.unlink(tmpfile)
@@ -856,7 +856,7 @@ class AnsibleModule(object):
                 # rename might not preserve context
                 self.set_context_if_different(dest, context, False)
         except (shutil.Error, OSError, IOError), e:
-            cleanup(tmp_dest)
+            self.cleanup(tmp_dest)
             self.fail_json(msg='Could not replace file: %s to %s: %s' % (src, dest, e))
 
     def run_command(self, args, check_rc=False, close_fds=False, executable=None, data=None):
