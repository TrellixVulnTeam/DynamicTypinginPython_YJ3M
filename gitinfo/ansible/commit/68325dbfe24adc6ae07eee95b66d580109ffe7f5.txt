commit 68325dbfe24adc6ae07eee95b66d580109ffe7f5
Author: Brian Coca <bcoca@ansible.com>
Date:   Sun Jun 21 01:43:35 2015 -0400

    fixed remote tmp creation when becoem user is not root and '~/' instead of $HOME is the default

diff --git a/lib/ansible/plugins/shell/sh.py b/lib/ansible/plugins/shell/sh.py
index f7ba06d931..3385d9fb04 100644
--- a/lib/ansible/plugins/shell/sh.py
+++ b/lib/ansible/plugins/shell/sh.py
@@ -62,7 +62,7 @@ class ShellModule(object):
         if not basefile:
             basefile = 'ansible-tmp-%s-%s' % (time.time(), random.randint(0, 2**48))
         basetmp = self.join_path(C.DEFAULT_REMOTE_TMP, basefile)
-        if system and basetmp.startswith('$HOME'):
+        if system and basetmp.startswith('$HOME') or basetmp.startswith('~/'):
             basetmp = self.join_path('/tmp', basefile)
         cmd = 'mkdir -p %s' % basetmp
         if mode:
