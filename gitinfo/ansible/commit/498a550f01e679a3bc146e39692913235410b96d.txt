commit 498a550f01e679a3bc146e39692913235410b96d
Author: Michael Scherer <misc@zarb.org>
Date:   Wed Aug 14 23:59:01 2013 +0200

    add test for the disabling of callback plugins

diff --git a/test/TestCallback.py b/test/TestCallback.py
new file mode 100644
index 0000000000..94a415e8b4
--- /dev/null
+++ b/test/TestCallback.py
@@ -0,0 +1,60 @@
+# (C) 2013, Michael Scherer, <misc@zarb.org>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+
+import os
+import unittest
+import subprocess
+
+# if you change here, also change in the plugin
+FILE_DISABLE = '/tmp/ansible_test_disable'
+FILE_RUN = '/tmp/ansible_test_finish'
+
+
+class TestInventory(unittest.TestCase):
+
+    def setUp(self):
+        self.cwd = os.getcwd()
+        os.chdir(os.path.join(os.path.dirname(__file__), 'test_callbacks'))
+
+    def clean_file(self):
+        if os.path.exists(FILE_RUN):
+            os.unlink(FILE_RUN)
+        if os.path.exists(FILE_DISABLE):
+            os.unlink(FILE_DISABLE)
+
+    def tearDown(self):
+        os.chdir(self.cwd)
+
+    def run_ansible_playbook(self):
+        subprocess.call('source ../../hacking/env-setup 2>&1 >/dev/null; ansible-playbook -i "127.0.0.1," test_playbook.yml 2>&1 >/dev/null', shell=True)
+
+    def test_callback(self):
+        self.clean_file()
+
+        self.run_ansible_playbook()
+        assert os.path.exists(FILE_RUN)
+        self.clean_file()
+
+    def test_callback_disabled(self):
+        self.clean_file()
+        open(FILE_DISABLE, 'w').close()
+
+        self.run_ansible_playbook()
+        assert not os.path.exists(FILE_RUN)
+
+        self.clean_file()
diff --git a/test/test_callbacks/callback_plugins/test_log.py b/test/test_callbacks/callback_plugins/test_log.py
new file mode 100644
index 0000000000..3bed373bf7
--- /dev/null
+++ b/test/test_callbacks/callback_plugins/test_log.py
@@ -0,0 +1,27 @@
+# (C) 2013, Michael Scherer, <misc@zarb.org>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+import os
+
+
+class CallbackModule(object):
+    def playbook_on_play_start(self, foo):
+        if os.path.exists('/tmp/ansible_test_disable'):
+            self.disabled = True
+
+    def playbook_on_stats(self, stats):
+            open('/tmp/ansible_test_finish', 'w').close()
diff --git a/test/test_callbacks/test_playbook.yml b/test/test_callbacks/test_playbook.yml
new file mode 100644
index 0000000000..b3049153f1
--- /dev/null
+++ b/test/test_callbacks/test_playbook.yml
@@ -0,0 +1,5 @@
+---
+- hosts: 127.0.0.1
+  connection: local
+  tasks:
+    shell: id 
