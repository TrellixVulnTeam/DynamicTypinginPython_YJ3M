commit 7254b22bf44af3114f13e6fed08e78bf00ec7dfb
Author: Andrew Hamilton <ahamilton55@gmail.com>
Date:   Wed Jul 22 17:12:00 2015 -0700

    Fixing delegate_to when using a variable

diff --git a/lib/ansible/executor/task_executor.py b/lib/ansible/executor/task_executor.py
index a2f75a4228..53962ae56c 100644
--- a/lib/ansible/executor/task_executor.py
+++ b/lib/ansible/executor/task_executor.py
@@ -455,19 +455,19 @@ class TaskExecutor:
         # get the vars for the delegate by its name
         try:
             this_info = variables['hostvars'][self._task.delegate_to]
+
+            # get the real ssh_address for the delegate and allow ansible_ssh_host to be templated
+            #self._play_context.remote_user      = self._compute_delegate_user(self.delegate_to, delegate['inject'])
+            self._play_context.remote_addr      = this_info.get('ansible_ssh_host', self._task.delegate_to)
+            self._play_context.port             = this_info.get('ansible_ssh_port', self._play_context.port)
+            self._play_context.password         = this_info.get('ansible_ssh_pass', self._play_context.password)
+            self._play_context.private_key_file = this_info.get('ansible_ssh_private_key_file', self._play_context.private_key_file)
+            self._play_context.connection       = this_info.get('ansible_connection', C.DEFAULT_TRANSPORT)
+            self._play_context.become_pass      = this_info.get('ansible_sudo_pass', self._play_context.become_pass)
         except:
             # make sure the inject is empty for non-inventory hosts
             this_info = {}
 
-        # get the real ssh_address for the delegate and allow ansible_ssh_host to be templated
-        #self._play_context.remote_user      = self._compute_delegate_user(self.delegate_to, delegate['inject'])
-        self._play_context.remote_addr      = this_info.get('ansible_ssh_host', self._task.delegate_to)
-        self._play_context.port             = this_info.get('ansible_ssh_port', self._play_context.port)
-        self._play_context.password         = this_info.get('ansible_ssh_pass', self._play_context.password)
-        self._play_context.private_key_file = this_info.get('ansible_ssh_private_key_file', self._play_context.private_key_file)
-        self._play_context.connection       = this_info.get('ansible_connection', C.DEFAULT_TRANSPORT)
-        self._play_context.become_pass      = this_info.get('ansible_sudo_pass', self._play_context.become_pass)
-
         if self._play_context.remote_addr in ('127.0.0.1', 'localhost'):
              self._play_context.connection = 'local'
 
