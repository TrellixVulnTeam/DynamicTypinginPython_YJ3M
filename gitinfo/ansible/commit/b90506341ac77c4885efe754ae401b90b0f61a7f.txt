commit b90506341ac77c4885efe754ae401b90b0f61a7f
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Sun Dec 20 08:06:26 2015 -0800

    Fixes for tests that assumed yum as package manager for systems that
    have dnf

diff --git a/test/integration/roles/ec2_elb_instance_setup/tasks/main.yml b/test/integration/roles/ec2_elb_instance_setup/tasks/main.yml
index 341392b00c..79584893ed 100644
--- a/test/integration/roles/ec2_elb_instance_setup/tasks/main.yml
+++ b/test/integration/roles/ec2_elb_instance_setup/tasks/main.yml
@@ -5,7 +5,12 @@
 # install apache on the ec2 instances
 
 - name: install apache on new ec2 instances
-  yum: name=httpd
+  package: name=httpd
+  when: ansible_os_family == 'RedHat'
+
+- name: install apache on new ec2 instances
+  package: name=apache
+  when: ansible_os_family == 'Debian'
 
 - name: start and enable apache
   service: name=httpd state=started enabled=yes
diff --git a/test/integration/roles/setup_postgresql_db/tasks/main.yml b/test/integration/roles/setup_postgresql_db/tasks/main.yml
index fbcc9cab72..c25318a2ad 100644
--- a/test/integration/roles/setup_postgresql_db/tasks/main.yml
+++ b/test/integration/roles/setup_postgresql_db/tasks/main.yml
@@ -9,9 +9,9 @@
 
 # Make sure we start fresh
 - name: remove rpm dependencies for postgresql test
-  yum: name={{ item }} state=absent
+  package: name={{ item }} state=absent
   with_items: postgresql_packages
-  when: ansible_pkg_mgr  ==  'yum'
+  when: ansible_os_family == "RedHat"
 
 - name: remove dpkg dependencies for postgresql test
   apt: name={{ item }} state=absent
@@ -35,9 +35,9 @@
   when: ansible_os_family == "Debian"
 
 - name: install rpm dependencies for postgresql test
-  yum: name={{ item }} state=latest
+  package: name={{ item }} state=latest
   with_items: postgresql_packages
-  when: ansible_pkg_mgr  ==  'yum'
+  when: ansible_os_family == "RedHat"
 
 - name: install dpkg dependencies for postgresql test
   apt: name={{ item }} state=latest
diff --git a/test/integration/roles/test_apt/tasks/main.yml b/test/integration/roles/test_apt/tasks/main.yml
index 8976087371..552b543d2d 100644
--- a/test/integration/roles/test_apt/tasks/main.yml
+++ b/test/integration/roles/test_apt/tasks/main.yml
@@ -1,4 +1,3 @@
-# test code for the yum module
 # (c) 2014, James Tanner <tanner.jc@gmail.com>
 
 # This file is part of Ansible
diff --git a/test/integration/roles/test_docker/tasks/docker-setup-rht.yml b/test/integration/roles/test_docker/tasks/docker-setup-rht.yml
index 3ba234ecff..c25821c3be 100644
--- a/test/integration/roles/test_docker/tasks/docker-setup-rht.yml
+++ b/test/integration/roles/test_docker/tasks/docker-setup-rht.yml
@@ -1,18 +1,17 @@
-- name: Install docker packages (yum)
-  yum:
+- name: Install docker packages (rht family)
+  package:
     state: present
     name: docker-io,docker-registry,python-docker-py,nginx
 
-- name: Install netcat
-  yum:
+- name: Install netcat (Fedora)
+  package:
     state: present
     name: nmap-ncat
-  # RHEL7 as well...
-  when: ansible_distribution == 'Fedora'
+  when: ansible_distribution == 'Fedora' or (ansible_os_family == 'RedHat' and ansible_distribution_version|version_compare('>=', 7))
 
-- name: Install netcat
-  yum:
+- name: Install netcat (RHEL)
+  package:
     state: present
     name: nc
-  when: ansible_distribution != 'Fedora'
+  when: ansible_distribution != 'Fedora' and (ansible_os_family == 'RedHat' and ansible_distribution_version|version_compare('<', 7))
 
diff --git a/test/integration/roles/test_unarchive/tasks/main.yml b/test/integration/roles/test_unarchive/tasks/main.yml
index c26d3aeb10..e4f438e525 100644
--- a/test/integration/roles/test_unarchive/tasks/main.yml
+++ b/test/integration/roles/test_unarchive/tasks/main.yml
@@ -21,6 +21,10 @@
   yum: name=zip state=latest
   when: ansible_pkg_mgr  ==  'yum'
 
+- name: Ensure zip is present to create test archive (dnf)
+  dnf: name=zip state=latest
+  when: ansible_pkg_mgr  ==  'dnf'
+
 - name: Ensure zip is present to create test archive (apt)
   apt: name=zip state=latest
   when: ansible_pkg_mgr  ==  'apt'
diff --git a/test/integration/roles/test_yum/tasks/main.yml b/test/integration/roles/test_yum/tasks/main.yml
index 5df887ae9f..b17af6b465 100644
--- a/test/integration/roles/test_yum/tasks/main.yml
+++ b/test/integration/roles/test_yum/tasks/main.yml
@@ -16,6 +16,8 @@
 # You should have received a copy of the GNU General Public License
 # along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
 
+# Note: We install the yum package onto Fedora so that this will work on dnf systems
+# We want to test that for people who don't want to upgrade their systems.
 - include: 'yum.yml'
   when: ansible_distribution in ['RedHat', 'CentOS', 'ScientificLinux', 'Fedora']
 
