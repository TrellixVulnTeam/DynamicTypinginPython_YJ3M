commit 3c996d0f745c84a50533478014144401629574d6
Author: Brian Coca <bcoca@ansible.com>
Date:   Fri Apr 6 11:19:25 2018 -0400

    make aef test more predictable
    
    revert "Disable any_errors_fatal test."
    This reverts commit 56189cc312ab1907ac91c7eac30620c4f9f21546.
    
    fixes #38407

diff --git a/test/integration/targets/any_errors_fatal/aliases b/test/integration/targets/any_errors_fatal/aliases
index e69de29bb2..79d8b9285e 100644
--- a/test/integration/targets/any_errors_fatal/aliases
+++ b/test/integration/targets/any_errors_fatal/aliases
@@ -0,0 +1 @@
+posix/ci/group3
diff --git a/test/integration/targets/any_errors_fatal/on_includes.yml b/test/integration/targets/any_errors_fatal/on_includes.yml
index cc5a355971..981d9f46d0 100644
--- a/test/integration/targets/any_errors_fatal/on_includes.yml
+++ b/test/integration/targets/any_errors_fatal/on_includes.yml
@@ -1,9 +1,7 @@
 ---
 # based on https://github.com/ansible/ansible/issues/22924
 - name: Test any errors fatal
-  hosts: testhost
+  hosts: testhost,testhost2
   any_errors_fatal: True
   tasks:
      - include: test_fatal.yml
-       #  tags:
-       #   - any_errors_fatal_includes
diff --git a/test/integration/targets/any_errors_fatal/test_fatal.yml b/test/integration/targets/any_errors_fatal/test_fatal.yml
index c8bfa9ccef..a12d741e9e 100644
--- a/test/integration/targets/any_errors_fatal/test_fatal.yml
+++ b/test/integration/targets/any_errors_fatal/test_fatal.yml
@@ -2,10 +2,11 @@
 - name: Setting the fact for 'test' to 'test value'
   set_fact:
     test: "test value"
-  when: "inventory_hostname == groups.all.0"
+  when: inventory_hostname == 'testhost2'
 
-- name: EXPECTED FAILURE echo jinja eval of a var that should not exist
-  shell: "echo {{ test }}"
+- name: EXPECTED FAILURE ejinja eval of a var that should not exist
+  debug: msg="{{ test }}"
 
-- debug:
+- name: testhost should never reach here as testhost2 failure above should end play
+  debug:
     msg: "any_errors_fatal_this_should_never_be_reached"
