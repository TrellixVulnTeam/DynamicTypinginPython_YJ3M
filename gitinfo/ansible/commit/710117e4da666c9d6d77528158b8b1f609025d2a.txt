commit 710117e4da666c9d6d77528158b8b1f609025d2a
Author: James Tanner <tanner.jc@gmail.com>
Date:   Tue Nov 12 10:37:27 2013 -0500

    Addresses #4628 evaluate package check return properly and exit failure if not present

diff --git a/library/packaging/pkgng b/library/packaging/pkgng
index dbae01bbb1..b8221a999d 100644
--- a/library/packaging/pkgng
+++ b/library/packaging/pkgng
@@ -123,8 +123,8 @@ def install_packages(module, pkgin_path, packages, cached, pkgsite):
         if not module.check_mode:
             rc, out, err = module.run_command("%s %s install -U -y %s" % (pkgsite, pkgin_path, package))
 
-        if not module.check_mode and query_package(module, pkgin_path, package):
-            module.fail_json(msg="failed to install %s: %s" % (package, out))
+        if not module.check_mode and not query_package(module, pkgin_path, package):
+            module.fail_json(msg="failed to install %s: %s" % (package, out), stderr=err)
 
         install_c += 1
     
