commit fa9ea32a866dfa5b01947e8ab6ad3f5f11ca6555
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Fri Sep 25 12:08:46 2015 -0700

    Fix test of whether a result has a failed host

diff --git a/lib/ansible/playbook/included_file.py b/lib/ansible/playbook/included_file.py
index 8a7cd7c244..3642bbadb3 100644
--- a/lib/ansible/playbook/included_file.py
+++ b/lib/ansible/playbook/included_file.py
@@ -21,6 +21,7 @@ __metaclass__ = type
 
 import os
 
+from ansible.errors import AnsibleError
 from ansible.template import Templar
 
 class IncludedFile:
@@ -46,7 +47,7 @@ class IncludedFile:
         included_files = []
 
         for res in results:
-            if res._host in tqm._failed_hosts:
+            if res._host.name in tqm._failed_hosts:
                 raise AnsibleError("host is failed, not including files")
 
             if res._task.action == 'include':
