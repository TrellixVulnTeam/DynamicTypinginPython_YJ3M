commit 937584cd525d1f268989b9094c996d5147bca3e5
Author: James Cammarata <jimi@sngx.net>
Date:   Mon Nov 9 14:50:39 2015 -0500

    Ensure 'environment' is set in the magic variables
    
    Fixes #13033

diff --git a/lib/ansible/vars/__init__.py b/lib/ansible/vars/__init__.py
index a332bbd2c7..402a975fc0 100644
--- a/lib/ansible/vars/__init__.py
+++ b/lib/ansible/vars/__init__.py
@@ -366,6 +366,7 @@ class VariableManager:
             variables['role_names'] = [r._role_name for r in play.roles]
 
         if task:
+            variables['environment'] = task.environment
             if task._role:
                 variables['role_path'] = task._role._role_path
 
