commit 7a4e4c2b0290b74a4f9272870b15976ae432d8e9
Author: Robin Roth <robin-roth@online.de>
Date:   Thu Apr 21 20:10:29 2016 +0200

    extend integration test for zypper_repository (#15387)
    
    * include options refresh and priority introduced in ansible/ansible-modules-extras#1990
    * test repo update both based on name and URL
    * run on all suse flavors
    * test overwriting repos by url or name

diff --git a/test/integration/roles/test_zypper_repository/tasks/main.yml b/test/integration/roles/test_zypper_repository/tasks/main.yml
index a805d6e25c..b2c4f754b9 100644
--- a/test/integration/roles/test_zypper_repository/tasks/main.yml
+++ b/test/integration/roles/test_zypper_repository/tasks/main.yml
@@ -18,5 +18,5 @@
 # along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
 
 - include: 'zypper_repository.yml'
-  when: ansible_distribution in ['SLES', 'openSUSE']
+  when: ansible_os_family == 'Suse'
 
diff --git a/test/integration/roles/test_zypper_repository/tasks/zypper_repository.yml b/test/integration/roles/test_zypper_repository/tasks/zypper_repository.yml
index d363e368a7..0c873717df 100644
--- a/test/integration/roles/test_zypper_repository/tasks/zypper_repository.yml
+++ b/test/integration/roles/test_zypper_repository/tasks/zypper_repository.yml
@@ -41,3 +41,71 @@
   assert:
     that:
       - "zypper_result.changed"
+
+- name: use refresh option
+  zypper_repository:
+    name: testrefresh
+    refresh: no
+    state: present
+    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+
+- name: check refreshoption
+  command: zypper -x lr testrefresh
+  register: zypper_result
+
+- assert:
+    that:
+      - '"autorefresh=\"0\"" in zypper_result.stdout'
+
+- name: set repo priority
+  zypper_repository:
+    name: testprio
+    priority: 55
+    state: present
+    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+
+- name: check refreshoption
+  command: zypper -x lr testprio
+  register: zypper_result
+
+- assert:
+    that:
+      - '"priority=\"55\"" in zypper_result.stdout'
+
+- name: add two repos with same url
+  zypper_repository:
+    name: "{{item}}"
+    state: present
+    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+  with_items:
+    - oss1
+    - oss2
+
+- name: check repo is updated by url
+  command: zypper lr oss1
+  register: zypper_result
+  ignore_errors: yes
+
+- assert:
+    that:
+      - "zypper_result.rc == 6"
+      - "'not found' in zypper_result.stderr"
+
+- name: add two repos with same name
+  zypper_repository:
+    name: samename
+    state: present
+    repo: "http://download.opensuse.org/distribution/leap/42.1/repo/{{item}}/"
+  with_items:
+    - oss
+    - non-oss
+
+- name: check repo is updated by name
+  command: zypper lr samename
+  register: zypper_result
+
+- assert:
+    that:
+      - "'/oss/' not in zypper_result.stdout"
+      - "'/non-oss/' in zypper_result.stdout"
+
