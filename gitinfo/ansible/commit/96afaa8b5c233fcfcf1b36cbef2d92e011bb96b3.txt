commit 96afaa8b5c233fcfcf1b36cbef2d92e011bb96b3
Author: Tim Rupp <caphrim007@gmail.com>
Date:   Wed Nov 29 07:58:29 2017 -0800

    Fixes for BIG-IQ (#33363)
    
    Various fixes to correct the BIG-IQ sdk args, and remove common
    bigip stuff if requested in bigiq modules. Will move this to
    separate module includes at a later time.

diff --git a/lib/ansible/module_utils/f5_utils.py b/lib/ansible/module_utils/f5_utils.py
index dd4a14fa1d..d7a3a64bb4 100644
--- a/lib/ansible/module_utils/f5_utils.py
+++ b/lib/ansible/module_utils/f5_utils.py
@@ -226,7 +226,7 @@ class AnsibleF5Client(object):
     def __init__(self, argument_spec=None, supports_check_mode=False,
                  mutually_exclusive=None, required_together=None,
                  required_if=None, required_one_of=None, add_file_common_args=False,
-                 f5_product_name='bigip'):
+                 f5_product_name='bigip', sans_state=False, sans_partition=False):
 
         self.f5_product_name = f5_product_name
 
@@ -234,7 +234,11 @@ class AnsibleF5Client(object):
         merged_arg_spec.update(F5_COMMON_ARGS)
         if argument_spec:
             merged_arg_spec.update(argument_spec)
-            self.arg_spec = merged_arg_spec
+        if sans_state:
+            del merged_arg_spec['state']
+        if sans_partition:
+            del merged_arg_spec['partition']
+        self.arg_spec = merged_arg_spec
 
         mutually_exclusive_params = []
         if mutually_exclusive:
@@ -301,7 +305,7 @@ class AnsibleF5Client(object):
                 kwargs['user'],
                 kwargs['password'],
                 port=kwargs['server_port'],
-                token='local'
+                auth_provider='local'
             )
 
     def reconnect(self):
