commit 8acb901bf2ff1c7bda0f092af970a68ece16ae72
Author: Matt Clay <matt@mystile.com>
Date:   Wed Oct 11 19:18:16 2017 -0700

    Update Azure tests to limit cryptography version. (#31616)
    
    * Revert "Work around cryptography 2.1 requiring pip 8.1.2+"
    
    This reverts commit a10a80b8a36192982829aefbba553dfdc6d9aa55.
    
    * Update Azure tests to limit cryptography version.

diff --git a/packaging/requirements/requirements-azure.txt b/packaging/requirements/requirements-azure.txt
index e0fd5343ab..cc2ce7e006 100644
--- a/packaging/requirements/requirements-azure.txt
+++ b/packaging/requirements/requirements-azure.txt
@@ -1,4 +1,3 @@
-cryptography>=1.3.4,<2.1  # cryptography 2.1 requires pip 8.1.2+
 packaging
 requests[security]
 azure-mgmt-compute>=2.0.0,<3
diff --git a/test/integration/targets/setup_azure/tasks/main.yml b/test/integration/targets/setup_azure/tasks/main.yml
index 17132a497b..8aee658c1d 100644
--- a/test/integration/targets/setup_azure/tasks/main.yml
+++ b/test/integration/targets/setup_azure/tasks/main.yml
@@ -1,2 +1,8 @@
+- name: install cryptography requirement
+  # preempt the installation of cryptography from requirements-azure.txt to limit the version installed
+  # requests[security] requires cryptography >= 1.3.4
+  # cryptography 2.1 requires pip 8.1.2+
+  command: pip install cryptography>=1.3.4,<2.1
+
 - pip:
     requirements: '{{ role_path }}/../../../../packaging/requirements/requirements-azure.txt'
