commit 5128a11cdca479590605c52ee5dd4155e5de68ab
Author: Rene Moser <mail@renemoser.net>
Date:   Thu Jun 2 09:31:08 2016 +0200

    letsencrypt: fix tests failures (#2360)

diff --git a/lib/ansible/modules/extras/.travis.yml b/lib/ansible/modules/extras/.travis.yml
index 9b54c2ddbe..f9e21227fc 100644
--- a/lib/ansible/modules/extras/.travis.yml
+++ b/lib/ansible/modules/extras/.travis.yml
@@ -140,7 +140,7 @@ install:
   - pip install git+https://github.com/ansible/ansible.git@devel#egg=ansible
   - pip install git+https://github.com/sivel/ansible-testing.git#egg=ansible_testing
 script:
-  - python2.4 -m compileall -fq -x 'cloud/|monitoring/zabbix.*\.py|/dnf\.py|/layman\.py|/maven_artifact\.py|clustering/(consul.*|znode)\.py|notification/pushbullet\.py|database/influxdb/influxdb.*\.py|database/mssql/mssql_db\.py' .
+  - python2.4 -m compileall -fq -x 'cloud/|monitoring/zabbix.*\.py|/dnf\.py|/layman\.py|/maven_artifact\.py|clustering/(consul.*|znode)\.py|notification/pushbullet\.py|database/influxdb/influxdb.*\.py|database/mssql/mssql_db\.py|/letsencrypt\.py' .
   - python2.6 -m compileall -fq .
   - python2.7 -m compileall -fq .
   - python3.4 -m compileall -fq . -x $(echo "$PY3_EXCLUDE_LIST"| tr ' ' '|')
diff --git a/lib/ansible/modules/extras/web_infrastructure/letsencrypt.py b/lib/ansible/modules/extras/web_infrastructure/letsencrypt.py
index 35d521a850..81cbb28e51 100644
--- a/lib/ansible/modules/extras/web_infrastructure/letsencrypt.py
+++ b/lib/ansible/modules/extras/web_infrastructure/letsencrypt.py
@@ -47,6 +47,8 @@ description:
    - "Although the defaults are choosen so that the module can be used with
       the Let's Encrypt CA, the module can be used with any service using the ACME
       protocol."
+requirements:
+  - "python >= 2.6"
 options:
   account_key:
     description:
@@ -214,7 +216,7 @@ def write_file(module, dest, content):
     f = open(tmpsrc, 'wb')
     try:
         f.write(content)
-    except Exception, err:
+    except Exception as err:
         os.remove(tmpsrc)
         module.fail_json(msg="failed to create temporary content file: %s" % str(err))
     f.close()
@@ -246,7 +248,7 @@ def write_file(module, dest, content):
         try:
             shutil.copyfile(tmpsrc, dest)
             changed = True
-        except Exception, err:
+        except Exception as err:
             os.remove(tmpsrc)
             module.fail_json(msg="failed to copy %s to %s: %s" % (tmpsrc, dest, str(err)))
     os.remove(tmpsrc)
@@ -350,7 +352,7 @@ class ACMEAccount(object):
         try:
             payload64 = nopad_b64(self.module.jsonify(payload).encode('utf8'))
             protected64 = nopad_b64(self.module.jsonify(protected).encode('utf8'))
-        except Exception, e:
+        except Exception as e:
             self.module.fail_json(msg="Failed to encode payload / headers as JSON: {0}".format(e))
 
         openssl_sign_cmd = [self._openssl_bin, "dgst", "-sha256", "-sign", self.key]
