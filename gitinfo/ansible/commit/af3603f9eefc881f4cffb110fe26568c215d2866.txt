commit af3603f9eefc881f4cffb110fe26568c215d2866
Author: Paul Belanger <pabelanger@redhat.com>
Date:   Wed Jan 15 12:25:38 2020 -0500

    Revert "Allow httpapi for resource modules (#62843)" (#66483)
    
    While this does properly pass our testing for ansible/ansible devel
    branch, it is currently breaking our collection testing for 2.10.
    
    Specifically, this would mean ansible.netcommon would need to directly
    import arista.eos or cisco.nxos collections, causing a circular dependency.
    
    This reverts commit e266e5f8b64c344fe7b9d711afe11c32e07954fa.

diff --git a/lib/ansible/module_utils/network/common/network.py b/lib/ansible/module_utils/network/common/network.py
index fc7a3ae1b3..e76d31e983 100644
--- a/lib/ansible/module_utils/network/common/network.py
+++ b/lib/ansible/module_utils/network/common/network.py
@@ -32,8 +32,6 @@ from ansible.module_utils._text import to_text, to_native
 from ansible.module_utils.basic import AnsibleModule
 from ansible.module_utils.basic import env_fallback
 from ansible.module_utils.connection import Connection, ConnectionError
-from ansible.module_utils.network.eos import eos
-from ansible.module_utils.network.nxos import nxos
 from ansible.module_utils.network.common.netconf import NetconfConnection
 from ansible.module_utils.network.common.parsing import Cli
 from ansible.module_utils.six import iteritems
@@ -214,11 +212,7 @@ def get_resource_connection(module):
 
     capabilities = get_capabilities(module)
     network_api = capabilities.get('network_api')
-    if network_api == 'eapi':
-        module._connection = eos.get_connection(module)
-    elif network_api == 'nxapi':
-        module._connection = nxos.get_connection(module)
-    elif network_api in ('cliconf', 'exosapi'):
+    if network_api in ('cliconf', 'nxapi', 'eapi', 'exosapi'):
         module._connection = Connection(module._socket_path)
     elif network_api == 'netconf':
         module._connection = NetconfConnection(module._socket_path)
diff --git a/lib/ansible/module_utils/network/eos/eos.py b/lib/ansible/module_utils/network/eos/eos.py
index 6721c0e54c..22c675153e 100644
--- a/lib/ansible/module_utils/network/eos/eos.py
+++ b/lib/ansible/module_utils/network/eos/eos.py
@@ -418,9 +418,6 @@ class HttpApi:
             self._session_support = self._connection.supports_sessions()
         return self._session_support
 
-    def get(self, command, **kwargs):
-        return self._connection.send_request(command)
-
     def run_commands(self, commands, check_rc=True):
         """Runs list of commands on remote device and returns results
         """
@@ -514,7 +511,7 @@ class HttpApi:
         """
         return self.edit_config(config, commit, replace)
 
-    def edit_config(self, config, commit=True, replace=False):
+    def edit_config(self, config, commit=False, replace=False):
         """Loads the configuration onto the remote devices
 
         If the device doesn't support configuration sessions, this will
diff --git a/lib/ansible/module_utils/network/eos/facts/legacy/base.py b/lib/ansible/module_utils/network/eos/facts/legacy/base.py
index 6093dedd09..50bb82e849 100644
--- a/lib/ansible/module_utils/network/eos/facts/legacy/base.py
+++ b/lib/ansible/module_utils/network/eos/facts/legacy/base.py
@@ -130,13 +130,6 @@ class Interfaces(FactsBase):
         self.facts['all_ipv6_addresses'] = list()
 
         data = self.responses[0]
-        if not isinstance(data, dict):
-            # EAPI kills the whole request on an error.
-            self.COMMANDS.pop()
-            super(Interfaces, self).populate()
-            self.responses.append(None)
-            data = self.responses[0]
-
         self.facts['interfaces'] = self.populate_interfaces(data)
 
         data = self.responses[1]
diff --git a/lib/ansible/module_utils/network/eos/facts/vlans/vlans.py b/lib/ansible/module_utils/network/eos/facts/vlans/vlans.py
index 63d21b169b..0e01b6c216 100644
--- a/lib/ansible/module_utils/network/eos/facts/vlans/vlans.py
+++ b/lib/ansible/module_utils/network/eos/facts/vlans/vlans.py
@@ -63,7 +63,8 @@ class VlansFacts(object):
                 if obj:
                     objs.extend(obj)
 
-        facts = {'vlans': []}
+        ansible_facts['ansible_network_resources'].pop('vlans', None)
+        facts = {}
         if objs:
             params = utils.validate_config(self.argument_spec, {'config': objs})
             facts['vlans'] = [utils.remove_empties(cfg) for cfg in params['config']]
diff --git a/lib/ansible/utils/jsonrpc.py b/lib/ansible/utils/jsonrpc.py
index 0a97c61054..e48c979d4c 100644
--- a/lib/ansible/utils/jsonrpc.py
+++ b/lib/ansible/utils/jsonrpc.py
@@ -39,7 +39,7 @@ class JsonRpcServer(object):
                 break
 
         if not rpc_method:
-            error = self.method_not_found(rpc_method)
+            error = self.method_not_found()
             response = json.dumps(error)
         else:
             try:
diff --git a/test/integration/targets/eos_interfaces/tasks/cli.yaml b/test/integration/targets/eos_interfaces/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_interfaces/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_interfaces/tasks/main.yaml b/test/integration/targets/eos_interfaces/tasks/main.yaml
index 970e74171e..068963b4c3 100644
--- a/test/integration/targets/eos_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_interfaces/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_interfaces/tests/cli/reset_config.yml
similarity index 96%
rename from test/integration/targets/eos_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_interfaces/tests/cli/reset_config.yml
index 7932f9f948..0613582955 100644
--- a/test/integration/targets/eos_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset initial config
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          description "Interface 1"
          no shutdown
diff --git a/test/integration/targets/eos_l2_interfaces/tasks/cli.yaml b/test/integration/targets/eos_l2_interfaces/tasks/cli.yaml
deleted file mode 100644
index 92c7271ce9..0000000000
--- a/test/integration/targets/eos_l2_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,22 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- block:
-  - name: run test cases (connection=network_cli)
-    include: "{{ test_case_to_run }} ansible_connection=network_cli"
-    with_items: "{{ test_items }}"
-    loop_control:
-      loop_var: test_case_to_run
-    tags: connection_network_cli
-
-  always:
-  - name: Clean up test state
-    include: "{{ role_path }}/tests/common/cleanup.yml ansible_connection=network_cli"
diff --git a/test/integration/targets/eos_l2_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_l2_interfaces/tasks/eapi.yaml
deleted file mode 100644
index f67b3d7214..0000000000
--- a/test/integration/targets/eos_l2_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,22 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- block:
-  - name: run test cases (connection=httpapi)
-    include: "{{ test_case_to_run }} ansible_connection=httpapi"
-    with_items: "{{ test_items }}"
-    loop_control:
-      loop_var: test_case_to_run
-    tags: connection_httpapi
-
-  always:
-  - name: Clean up test state
-    include: "{{ role_path }}/tests/common/cleanup.yml ansible_connection=httpapi"
diff --git a/test/integration/targets/eos_l2_interfaces/tasks/main.yaml b/test/integration/targets/eos_l2_interfaces/tasks/main.yaml
index 970e74171e..35abc8e876 100644
--- a/test/integration/targets/eos_l2_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_l2_interfaces/tasks/main.yaml
@@ -1,3 +1,22 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- block:
+  - name: run test cases (connection=network_cli)
+    include: "{{ test_case_to_run }} ansible_connection=network_cli"
+    with_items: "{{ test_items }}"
+    loop_control:
+      loop_var: test_case_to_run
+  tags: connection_network_cli
+
+  always:
+  - name: Clean up test state
+    include: "{{ role_path }}/tests/cli/cleanup.yml ansible_connection=network_cli"
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/cleanup.yml b/test/integration/targets/eos_l2_interfaces/tests/cli/cleanup.yml
similarity index 77%
rename from test/integration/targets/eos_l2_interfaces/tests/common/cleanup.yml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/cleanup.yml
index 7a6f44dd04..d71a6a9db4 100644
--- a/test/integration/targets/eos_l2_interfaces/tests/common/cleanup.yml
+++ b/test/integration/targets/eos_l2_interfaces/tests/cli/cleanup.yml
@@ -1,12 +1,12 @@
 ---
 - name: Remove all vlans
-  eos_config:
-    lines: no vlan 1-4094
+  cli_config:
+    config: no vlan 1-4094
   become: yes
 
 - name: Completely remove vlans from interfaces
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface {{ item }}
         no switchport mode
         no switchport access vlan
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_l2_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_l2_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_l2_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_l2_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_l2_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_l2_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_l2_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_l2_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_l2_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_l2_interfaces/tests/cli/reset_config.yml
similarity index 96%
rename from test/integration/targets/eos_l2_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_l2_interfaces/tests/cli/reset_config.yml
index cc43075cfd..f4474ce1b7 100644
--- a/test/integration/targets/eos_l2_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_l2_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset state
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          switchport access vlan 20
          no switchport trunk native vlan
diff --git a/test/integration/targets/eos_l3_interfaces/tasks/cli.yaml b/test/integration/targets/eos_l3_interfaces/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_l3_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_l3_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_l3_interfaces/tasks/eapi.yaml
deleted file mode 100644
index acddad170e..0000000000
--- a/test/integration/targets/eos_l3_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_l3_interfaces/tasks/main.yaml b/test/integration/targets/eos_l3_interfaces/tasks/main.yaml
index 970e74171e..82d196e4ed 100644
--- a/test/integration/targets/eos_l3_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_l3_interfaces/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  register: test_cases
+  delegate_to: localhost
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_l3_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_l3_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_l3_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_l3_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_l3_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_l3_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_l3_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_l3_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_l3_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_l3_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_l3_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_l3_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_l3_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_l3_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_l3_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_l3_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_l3_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_l3_interfaces/tests/cli/reset_config.yml
similarity index 96%
rename from test/integration/targets/eos_l3_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_l3_interfaces/tests/cli/reset_config.yml
index f74d1f521c..3efc086a4b 100644
--- a/test/integration/targets/eos_l3_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_l3_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset state
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          ip address 192.0.2.12/24
          ip address 203.0.113.27/31 secondary
diff --git a/test/integration/targets/eos_lacp_interfaces/tasks/cli.yaml b/test/integration/targets/eos_lacp_interfaces/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_lacp_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lacp_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_lacp_interfaces/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_lacp_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_lacp_interfaces/tasks/main.yaml b/test/integration/targets/eos_lacp_interfaces/tasks/main.yaml
index 970e74171e..068963b4c3 100644
--- a/test/integration/targets/eos_lacp_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_lacp_interfaces/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lacp_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_lacp_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_lacp_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_lacp_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_lacp_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_lacp_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_lacp_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_lacp_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_lacp_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_lacp_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_lacp_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_lacp_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_lacp_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_lacp_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_lacp_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_lacp_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_lacp_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_lacp_interfaces/tests/cli/reset_config.yml
similarity index 95%
rename from test/integration/targets/eos_lacp_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_lacp_interfaces/tests/cli/reset_config.yml
index b4e6851365..45caea1f4a 100644
--- a/test/integration/targets/eos_lacp_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_lacp_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset initial config
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          lacp port-priority 30
          lacp rate normal
diff --git a/test/integration/targets/eos_lag_interfaces/tasks/cli.yaml b/test/integration/targets/eos_lag_interfaces/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_lag_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lag_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_lag_interfaces/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_lag_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_lag_interfaces/tasks/main.yaml b/test/integration/targets/eos_lag_interfaces/tasks/main.yaml
index 970e74171e..82d196e4ed 100644
--- a/test/integration/targets/eos_lag_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_lag_interfaces/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  register: test_cases
+  delegate_to: localhost
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lag_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_lag_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_lag_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_lag_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_lag_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_lag_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_lag_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_lag_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_lag_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_lag_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_lag_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_lag_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_lag_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_lag_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_lag_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_lag_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_lag_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_lag_interfaces/tests/cli/reset_config.yml
similarity index 94%
rename from test/integration/targets/eos_lag_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_lag_interfaces/tests/cli/reset_config.yml
index 31ef209866..ba7cf513a2 100644
--- a/test/integration/targets/eos_lag_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_lag_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset state
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          channel-group 5 mode on
       interface Ethernet2
diff --git a/test/integration/targets/eos_lldp_global/tasks/cli.yaml b/test/integration/targets/eos_lldp_global/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_lldp_global/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lldp_global/tasks/eapi.yaml b/test/integration/targets/eos_lldp_global/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_lldp_global/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_lldp_global/tasks/main.yaml b/test/integration/targets/eos_lldp_global/tasks/main.yaml
index 970e74171e..068963b4c3 100644
--- a/test/integration/targets/eos_lldp_global/tasks/main.yaml
+++ b/test/integration/targets/eos_lldp_global/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lldp_global/tests/common/deleted.yaml b/test/integration/targets/eos_lldp_global/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_global/tests/common/deleted.yaml
rename to test/integration/targets/eos_lldp_global/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_lldp_global/tests/common/merged.yaml b/test/integration/targets/eos_lldp_global/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_global/tests/common/merged.yaml
rename to test/integration/targets/eos_lldp_global/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_lldp_global/tests/common/replaced.yaml b/test/integration/targets/eos_lldp_global/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_global/tests/common/replaced.yaml
rename to test/integration/targets/eos_lldp_global/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_lldp_global/tests/common/reset_config.yml b/test/integration/targets/eos_lldp_global/tests/cli/reset_config.yml
similarity index 95%
rename from test/integration/targets/eos_lldp_global/tests/common/reset_config.yml
rename to test/integration/targets/eos_lldp_global/tests/cli/reset_config.yml
index 441edf3891..4e5fd33746 100644
--- a/test/integration/targets/eos_lldp_global/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_lldp_global/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset initial config
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       lldp timer 3000
       lldp holdtime 100
       lldp reinit 5
diff --git a/test/integration/targets/eos_lldp_interfaces/tasks/cli.yaml b/test/integration/targets/eos_lldp_interfaces/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_lldp_interfaces/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lldp_interfaces/tasks/eapi.yaml b/test/integration/targets/eos_lldp_interfaces/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_lldp_interfaces/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_lldp_interfaces/tasks/main.yaml b/test/integration/targets/eos_lldp_interfaces/tasks/main.yaml
index 970e74171e..068963b4c3 100644
--- a/test/integration/targets/eos_lldp_interfaces/tasks/main.yaml
+++ b/test/integration/targets/eos_lldp_interfaces/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_lldp_interfaces/tests/common/deleted.yaml b/test/integration/targets/eos_lldp_interfaces/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_interfaces/tests/common/deleted.yaml
rename to test/integration/targets/eos_lldp_interfaces/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_lldp_interfaces/tests/common/merged.yaml b/test/integration/targets/eos_lldp_interfaces/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_interfaces/tests/common/merged.yaml
rename to test/integration/targets/eos_lldp_interfaces/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_lldp_interfaces/tests/common/overridden.yaml b/test/integration/targets/eos_lldp_interfaces/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_interfaces/tests/common/overridden.yaml
rename to test/integration/targets/eos_lldp_interfaces/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_lldp_interfaces/tests/common/replaced.yaml b/test/integration/targets/eos_lldp_interfaces/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_lldp_interfaces/tests/common/replaced.yaml
rename to test/integration/targets/eos_lldp_interfaces/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_lldp_interfaces/tests/common/reset_config.yml b/test/integration/targets/eos_lldp_interfaces/tests/cli/reset_config.yml
similarity index 94%
rename from test/integration/targets/eos_lldp_interfaces/tests/common/reset_config.yml
rename to test/integration/targets/eos_lldp_interfaces/tests/cli/reset_config.yml
index c2085aef61..99688d8478 100644
--- a/test/integration/targets/eos_lldp_interfaces/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_lldp_interfaces/tests/cli/reset_config.yml
@@ -1,7 +1,7 @@
 ---
 - name: Reset initial config
-  eos_config:
-    lines: |
+  cli_config:
+    config: |
       interface Ethernet1
          no lldp receive
          lldp transmit
diff --git a/test/integration/targets/eos_vlans/tasks/cli.yaml b/test/integration/targets/eos_vlans/tasks/cli.yaml
deleted file mode 100644
index 475fe83154..0000000000
--- a/test/integration/targets/eos_vlans/tasks/cli.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all cli test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=network_cli)
-  include: "{{ test_case_to_run }} ansible_connection=network_cli"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_network_cli
diff --git a/test/integration/targets/eos_vlans/tasks/eapi.yaml b/test/integration/targets/eos_vlans/tasks/eapi.yaml
deleted file mode 100644
index 34ce8f6347..0000000000
--- a/test/integration/targets/eos_vlans/tasks/eapi.yaml
+++ /dev/null
@@ -1,17 +0,0 @@
----
-- name: collect all eapi test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  delegate_to: localhost
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (connection=httpapi)
-  include: "{{ test_case_to_run }} ansible_connection=httpapi"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: connection_httpapi
diff --git a/test/integration/targets/eos_vlans/tasks/main.yaml b/test/integration/targets/eos_vlans/tasks/main.yaml
index 970e74171e..068963b4c3 100644
--- a/test/integration/targets/eos_vlans/tasks/main.yaml
+++ b/test/integration/targets/eos_vlans/tasks/main.yaml
@@ -1,3 +1,17 @@
 ---
-- { include: cli.yaml, tags: ['cli'] }
-- { include: eapi.yaml, tags: ['eapi'] }
+- name: collect all cli test cases
+  find:
+    paths: "{{ role_path }}/tests/cli"
+    patterns: "{{ testcase }}.yaml"
+  delegate_to: localhost
+  register: test_cases
+
+- name: set test_items
+  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
+
+- name: run test cases (connection=network_cli)
+  include: "{{ test_case_to_run }} ansible_connection=network_cli"
+  with_items: "{{ test_items }}"
+  loop_control:
+    loop_var: test_case_to_run
+  tags: connection_network_cli
diff --git a/test/integration/targets/eos_vlans/tests/common/deleted.yaml b/test/integration/targets/eos_vlans/tests/cli/deleted.yaml
similarity index 100%
rename from test/integration/targets/eos_vlans/tests/common/deleted.yaml
rename to test/integration/targets/eos_vlans/tests/cli/deleted.yaml
diff --git a/test/integration/targets/eos_vlans/tests/common/idempotent.yaml b/test/integration/targets/eos_vlans/tests/cli/idempotent.yaml
similarity index 100%
rename from test/integration/targets/eos_vlans/tests/common/idempotent.yaml
rename to test/integration/targets/eos_vlans/tests/cli/idempotent.yaml
diff --git a/test/integration/targets/eos_vlans/tests/common/merged.yaml b/test/integration/targets/eos_vlans/tests/cli/merged.yaml
similarity index 100%
rename from test/integration/targets/eos_vlans/tests/common/merged.yaml
rename to test/integration/targets/eos_vlans/tests/cli/merged.yaml
diff --git a/test/integration/targets/eos_vlans/tests/common/overridden.yaml b/test/integration/targets/eos_vlans/tests/cli/overridden.yaml
similarity index 100%
rename from test/integration/targets/eos_vlans/tests/common/overridden.yaml
rename to test/integration/targets/eos_vlans/tests/cli/overridden.yaml
diff --git a/test/integration/targets/eos_vlans/tests/common/replaced.yaml b/test/integration/targets/eos_vlans/tests/cli/replaced.yaml
similarity index 100%
rename from test/integration/targets/eos_vlans/tests/common/replaced.yaml
rename to test/integration/targets/eos_vlans/tests/cli/replaced.yaml
diff --git a/test/integration/targets/eos_vlans/tests/common/reset_config.yml b/test/integration/targets/eos_vlans/tests/cli/reset_config.yml
similarity index 78%
rename from test/integration/targets/eos_vlans/tests/common/reset_config.yml
rename to test/integration/targets/eos_vlans/tests/cli/reset_config.yml
index 38736d88b5..513a1199b1 100644
--- a/test/integration/targets/eos_vlans/tests/common/reset_config.yml
+++ b/test/integration/targets/eos_vlans/tests/cli/reset_config.yml
@@ -1,17 +1,12 @@
 ---
 - name: Reset initial config
-  eos_config:
-    before:
+  cli_config:
+    config: |
       no vlan 1-4094
-    defaults: yes
-    match: exact
-    lines: |
       vlan 10
          name ten
-         state active
       vlan 20
          name twenty
-         state active
   become: yes
 
 - eos_facts:
