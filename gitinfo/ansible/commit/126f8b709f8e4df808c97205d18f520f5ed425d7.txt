commit 126f8b709f8e4df808c97205d18f520f5ed425d7
Author: Alex Kalinin <camradal@yahoo.com>
Date:   Wed Feb 10 18:52:08 2016 -0800

    Fix opening libvirt esx connection

diff --git a/lib/ansible/modules/extras/cloud/misc/virt.py b/lib/ansible/modules/extras/cloud/misc/virt.py
index b59c7ed3de..65791e43e9 100644
--- a/lib/ansible/modules/extras/cloud/misc/virt.py
+++ b/lib/ansible/modules/extras/cloud/misc/virt.py
@@ -128,6 +128,9 @@ class LibvirtConnection(object):
 
         if "xen" in stdout:
             conn = libvirt.open(None)
+        elif "esx" in uri:
+            auth = [[libvirt.VIR_CRED_AUTHNAME, libvirt.VIR_CRED_NOECHOPROMPT], [], None]
+            conn = libvirt.openAuth(uri, auth)
         else:
             conn = libvirt.open(uri)
 
