commit 17e8500202b0ef58ab2ac41521006b201cfbf094
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Thu Mar 24 16:43:03 2016 -0700

    Don't process the same host multiple times
    
    Fixes #14259

diff --git a/lib/ansible/inventory/dir.py b/lib/ansible/inventory/dir.py
index e716987fd5..bb077e036b 100644
--- a/lib/ansible/inventory/dir.py
+++ b/lib/ansible/inventory/dir.py
@@ -159,7 +159,7 @@ class InventoryDirectory(object):
         if 'ungrouped' in self.groups:
             ungrouped = self.groups['ungrouped']
             # loop on a copy of ungrouped hosts, as we want to change that list
-            for host in ungrouped.hosts[:]:
+            for host in frozenset(ungrouped.hosts):
                 if len(host.groups) > 1:
                     host.groups.remove(ungrouped)
                     ungrouped.hosts.remove(host)
