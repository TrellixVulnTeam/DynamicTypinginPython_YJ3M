commit 7483acde5df45617d641b1dfd200bc7f1418059a
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Jun 4 22:48:08 2014 -0500

    Fix linking issue to directories in file module
    
    The os.path.isdir() returns True for symlinks that point to directories,
    so we also need to check to make sure it's not a symlink too.
    
    Fixes #7657

diff --git a/library/files/file b/library/files/file
index 8d3a71a237..0e50cb67e8 100644
--- a/library/files/file
+++ b/library/files/file
@@ -189,7 +189,7 @@ def main():
 
     elif state in ['link','hard']:
 
-        if os.path.isdir(path):
+        if os.path.isdir(path) and not os.path.islink(path):
             relpath = path
         else:
             relpath = os.path.dirname(path)
