commit 3832d0461111cf2fe7db56aa2bedc8de8f06d4a9
Author: Matt Martz <matt@sivel.net>
Date:   Wed Jun 13 11:22:07 2018 -0500

    Ensure we raise the exception caught _post_validate_environment->_parse_env_kv. Fixes #41322 (#41411)

diff --git a/lib/ansible/playbook/task.py b/lib/ansible/playbook/task.py
index 0163999b00..b300f3c720 100644
--- a/lib/ansible/playbook/task.py
+++ b/lib/ansible/playbook/task.py
@@ -280,7 +280,8 @@ class Task(Base, Conditional, Taggable, Become):
                 except AnsibleUndefinedVariable as e:
                     if self.action in ('setup', 'gather_facts') and 'ansible_env' in to_native(e):
                         # ignore as fact gathering sets ansible_env
-                        pass
+                        return
+                    raise
 
             if isinstance(value, list):
                 for env_item in value:
