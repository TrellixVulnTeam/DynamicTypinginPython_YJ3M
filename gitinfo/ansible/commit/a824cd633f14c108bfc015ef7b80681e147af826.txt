commit a824cd633f14c108bfc015ef7b80681e147af826
Author: Nick Aslanidis <nick.aslanidis@gmail.com>
Date:   Sat May 7 21:00:23 2016 +1000

    corrected version to 2.2. Ensure no vpc-id is returned if detached

diff --git a/lib/ansible/modules/extras/cloud/amazon/ec2_vpc_vgw.py b/lib/ansible/modules/extras/cloud/amazon/ec2_vpc_vgw.py
index 466b81c876..9861e7d0b7 100644
--- a/lib/ansible/modules/extras/cloud/amazon/ec2_vpc_vgw.py
+++ b/lib/ansible/modules/extras/cloud/amazon/ec2_vpc_vgw.py
@@ -22,7 +22,7 @@ description:
   - Deletes AWS VPN Virtual Gateways
   - Attaches Virtual Gateways to VPCs
   - Detaches Virtual Gateways from VPCs
-version_added: "2.1"
+version_added: "2.2"
 requirements: [ boto3 ]
 options:
   state:
@@ -139,7 +139,7 @@ def get_vgw_info(vgws):
         for tag in vgw['Tags']:
             vgw_info['tags'][tag['Key']] = tag['Value']
 
-        if len(vgw['VpcAttachments']) != 0:
+        if len(vgw['VpcAttachments']) != 0 and vgw['VpcAttachments'][0]['State'] == 'attached':
             vgw_info['vpc_id'] = vgw['VpcAttachments'][0]['VpcId']
 
         return vgw_info
@@ -537,7 +537,7 @@ def ensure_vgw_absent(client, module):
             changed = False
             deleted_vgw = None
 
-    result = get_vgw_info(deleted_vgw)
+    result = deleted_vgw
     return changed, result
 
 
