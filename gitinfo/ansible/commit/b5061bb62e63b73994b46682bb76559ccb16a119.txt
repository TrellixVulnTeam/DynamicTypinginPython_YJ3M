commit b5061bb62e63b73994b46682bb76559ccb16a119
Author: Stephen Fromm <sfromm@gmail.com>
Date:   Tue Apr 10 16:27:19 2012 -0700

    Verify that effective uid == remote_user when transport is local
    
    Raise exception if effective uid of process is not the same as
    remote_user.

diff --git a/lib/ansible/runner.py b/lib/ansible/runner.py
index 2093cac655..2e14b517bf 100755
--- a/lib/ansible/runner.py
+++ b/lib/ansible/runner.py
@@ -22,6 +22,7 @@ import fnmatch
 import multiprocessing
 import signal
 import os
+import pwd
 import Queue
 import random
 import traceback
@@ -115,6 +116,9 @@ class Runner(object):
         self.basedir     = basedir
         self.sudo        = sudo
 
+        euid = pwd.getpwuid(os.geteuid())[0]
+        if self.transport == 'local' and self.remote_user != euid:
+            raise Exception("User mismatch: expected %s, but is %s" % (self.remote_user, euid))
         if type(self.module_args) != str:
             raise Exception("module_args must be a string: %s" % self.module_args)
 
