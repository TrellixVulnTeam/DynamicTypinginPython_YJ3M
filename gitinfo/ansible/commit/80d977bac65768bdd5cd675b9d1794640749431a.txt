commit 80d977bac65768bdd5cd675b9d1794640749431a
Author: Brian Coca <bcoca@users.noreply.github.com>
Date:   Wed Oct 10 12:34:58 2018 -0400

    manage levels for 'multiple included lists' (#46359)
    
    * manage levels for 'multiple included lists'
    
    fixes #46343

diff --git a/lib/ansible/plugins/filter/core.py b/lib/ansible/plugins/filter/core.py
index b572ab4d8a..eab0022888 100644
--- a/lib/ansible/plugins/filter/core.py
+++ b/lib/ansible/plugins/filter/core.py
@@ -440,8 +440,8 @@ def flatten(mylist, levels=None):
             if levels is None:
                 ret.extend(flatten(element))
             elif levels >= 1:
-                levels = int(levels) - 1
-                ret.extend(flatten(element, levels=levels))
+                # decrement as we go down the stack
+                ret.extend(flatten(element, levels=(int(levels) - 1)))
             else:
                 ret.append(element)
         else:
