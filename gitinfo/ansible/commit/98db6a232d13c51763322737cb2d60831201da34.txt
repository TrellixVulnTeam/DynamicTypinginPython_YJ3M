commit 98db6a232d13c51763322737cb2d60831201da34
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Wed Mar 18 18:56:46 2015 -0700

    Have selinux allow docker<=>nginx communication

diff --git a/test/integration/roles/test_docker/tasks/docker-tests.yml b/test/integration/roles/test_docker/tasks/docker-tests.yml
index 383b8eb3f6..33ffe6c70c 100644
--- a/test/integration/roles/test_docker/tasks/docker-tests.yml
+++ b/test/integration/roles/test_docker/tasks/docker-tests.yml
@@ -72,5 +72,8 @@
     that:
       - "'hello world' in docker_output.stdout_lines"
 
-- name: Remove the busybox image from the local docker
+- name: Remove containers
+  shell: "docker rm $(docker ps -aq)"
+
+- name: Remove all images from the local docker
   shell: "docker rmi -f $(docker images -q)"
diff --git a/test/integration/roles/test_docker/tasks/registry-tests.yml b/test/integration/roles/test_docker/tasks/registry-tests.yml
index 03d2fa0db7..57b4d25277 100644
--- a/test/integration/roles/test_docker/tasks/registry-tests.yml
+++ b/test/integration/roles/test_docker/tasks/registry-tests.yml
@@ -90,6 +90,20 @@
     that:
       - "{{ docker_output.stdout_lines| length }} <= 1"
 
+#
+# Private registry secured with an SSL proxy
+#
+
+- name: Set selinux to allow docker to connect to nginx
+  seboolean:
+    name: docker_connect_any
+    state: yes
+
+- name: Set selinux to allow nginx to connect to docker
+  seboolean:
+    name: httpd_can_network_connect
+    state: yes
+
 - name: Setup nginx with a user/password
   copy:
     src: docker-registry.htpasswd
