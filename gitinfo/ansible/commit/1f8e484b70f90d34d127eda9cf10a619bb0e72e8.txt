commit 1f8e484b70f90d34d127eda9cf10a619bb0e72e8
Author: Monty Taylor <mordred@inaugust.com>
Date:   Thu Dec 3 07:07:13 2015 -0800

    Fix the refresh flag in openstack inventory
    
    Refresh will update the dogpile cache from shade, but doesn't cause
    the ansible side json cache to be invalidated. It's a simple oversight.

diff --git a/contrib/inventory/openstack.py b/contrib/inventory/openstack.py
index 46b43e9221..231488b06d 100755
--- a/contrib/inventory/openstack.py
+++ b/contrib/inventory/openstack.py
@@ -94,9 +94,9 @@ def get_groups_from_server(server_vars):
     return groups
 
 
-def get_host_groups(inventory):
+def get_host_groups(inventory, refresh=False):
     (cache_file, cache_expiration_time) = get_cache_settings()
-    if is_cache_stale(cache_file, cache_expiration_time):
+    if is_cache_stale(cache_file, cache_expiration_time, refresh=refresh):
         groups = to_json(get_host_groups_from_cloud(inventory))
         open(cache_file, 'w').write(groups)
     else:
@@ -121,8 +121,10 @@ def get_host_groups_from_cloud(inventory):
     return groups
 
 
-def is_cache_stale(cache_file, cache_expiration_time):
+def is_cache_stale(cache_file, cache_expiration_time, refresh=False):
     ''' Determines if cache file has expired, or if it is still valid '''
+    if refresh:
+        return True
     if os.path.isfile(cache_file):
         mod_time = os.path.getmtime(cache_file)
         current_time = time.time()
@@ -176,7 +178,7 @@ def main():
         )
 
         if args.list:
-            output = get_host_groups(inventory)
+            output = get_host_groups(inventory, refresh=args.refresh)
         elif args.host:
             output = to_json(inventory.get_host(args.host))
         print(output)
