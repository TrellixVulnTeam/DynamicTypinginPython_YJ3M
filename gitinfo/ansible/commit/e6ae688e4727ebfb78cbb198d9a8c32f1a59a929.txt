commit e6ae688e4727ebfb78cbb198d9a8c32f1a59a929
Author: Karsten Jakobsen <karsten@karstenjakobsen.dk>
Date:   Mon Feb 11 06:40:24 2019 +0100

    netbox: inventory: Fix VMs do not have device_roles, but instead use roles  (#50761)
    
    This makes sure that roles show up as device_role when using VMs

diff --git a/lib/ansible/plugins/inventory/netbox.py b/lib/ansible/plugins/inventory/netbox.py
index b6aae06dba..fb2feee702 100644
--- a/lib/ansible/plugins/inventory/netbox.py
+++ b/lib/ansible/plugins/inventory/netbox.py
@@ -252,7 +252,10 @@ class InventoryModule(BaseInventoryPlugin, Constructable):
 
     def extract_device_role(self, host):
         try:
-            return [self.device_roles_lookup[host["device_role"]["id"]]]
+            if 'device_role' in host:
+                return [self.device_roles_lookup[host["device_role"]["id"]]]
+            elif 'role' in host:
+                return [self.device_roles_lookup[host["role"]["id"]]]
         except Exception:
             return
 
