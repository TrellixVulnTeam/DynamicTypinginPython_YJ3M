commit 2fcc3593ccf7c865723c46ce8b3b7964b7ab7022
Author: Jordan Borean <jborean93@gmail.com>
Date:   Tue Jan 15 09:02:32 2019 +1000

    ansible-test setup_dep_repo trust package  repo (#50795)

diff --git a/test/integration/targets/setup_deb_repo/tasks/main.yml b/test/integration/targets/setup_deb_repo/tasks/main.yml
index 84c0f909a3..9660416cba 100644
--- a/test/integration/targets/setup_deb_repo/tasks/main.yml
+++ b/test/integration/targets/setup_deb_repo/tasks/main.yml
@@ -28,9 +28,22 @@
     args:
       chdir: "{{ repodir }}"
 
+  # Can't use apt_repository as it doesn't expose a trusted=yes option
   - name: Install the repo
-    apt_repository:
-      repo: "deb file:{{ repodir }} ./"
-      validate_certs: no
+    copy:
+      content: deb [trusted=yes] file:{{ repodir }} ./
+      dest: /etc/apt/sources.list.d/file_tmp_repo.list
+
+  # Need to uncomment the deb-src for the universe component for build-dep state
+  - name: Ensure deb-src for the universe component
+    lineinfile:
+      path: /etc/apt/sources.list
+      backrefs: True
+      regexp: ^#\s*deb-src http://archive\.ubuntu\.com/ubuntu/ (\w*){{ item }} universe$
+      line: deb-src http://archive.ubuntu.com/ubuntu \1{{ item }} universe
+      state: present
+    with_items:
+    - ''
+    - -updates
 
   when: ansible_distribution in ['Ubuntu', 'Debian']
