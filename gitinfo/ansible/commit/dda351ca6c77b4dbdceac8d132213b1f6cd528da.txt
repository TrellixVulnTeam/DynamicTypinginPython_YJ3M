commit dda351ca6c77b4dbdceac8d132213b1f6cd528da
Author: Ganesh Nalawade <ganesh634@gmail.com>
Date:   Tue May 15 10:55:14 2018 +0530

    Fix eos_eapi integration test failure (#40132)

diff --git a/test/integration/targets/eos_eapi/tests/cli/badtransport.yaml b/test/integration/targets/eos_eapi/tests/cli/badtransport.yaml
index 73c812ce59..2c10e6558d 100644
--- a/test/integration/targets/eos_eapi/tests/cli/badtransport.yaml
+++ b/test/integration/targets/eos_eapi/tests/cli/badtransport.yaml
@@ -1,13 +1,14 @@
 - debug: msg="START CLI/BADTRANSPORT.YAML"
 
-- name: Expect transport other than cli to fail
-  eos_eapi:
-    provider: "{{ eapi }}"
-  register: eos_eapi_output
-  connection: local
-  ignore_errors: yes
+- block:
+  - name: Expect transport other than cli to fail
+    eos_eapi:
+      provider: "{{ eapi }}"
+    register: eos_eapi_output
+    ignore_errors: yes
 
-- assert:
-    that: eos_eapi_output.failed == true
+  - assert:
+      that: eos_eapi_output.failed == true
+  when: "ansible_connection == 'local'"
 
 - debug: msg="START CLI/BADTRANSPORT.YAML"
