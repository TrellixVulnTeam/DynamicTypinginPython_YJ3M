commit b87ef7772f34552242f970a29a476c731650e39d
Author: Gregor Giesen <giesen@zaehlwerk.net>
Date:   Mon Sep 12 07:39:12 2016 +0200

    cron: replacement for os.getlogin() (#4777)
    
    os.getlogin() returns the user logged in on the controlling terminal. However
    'crontab' only looks for the login name of the process' real user id which
    pwd.getpwuid(os.getuid())[0] does provide.
    
    While in most cases there is no difference, the former might fail under certain
    circumstances (e.g. a lxc container connected by attachment without login),
    throwing the error 'OSError: [Errno 25] Inappropriate ioctl for device'.

diff --git a/lib/ansible/modules/system/cron.py b/lib/ansible/modules/system/cron.py
index 7df46469b8..62e9e3ba74 100644
--- a/lib/ansible/modules/system/cron.py
+++ b/lib/ansible/modules/system/cron.py
@@ -200,6 +200,7 @@ EXAMPLES = '''
 '''
 
 import os
+import pwd
 import re
 import tempfile
 import platform
@@ -479,7 +480,7 @@ class CronTab(object):
                 return "%s -l %s" % (pipes.quote(CRONCMD), pipes.quote(self.user))
             elif platform.system() == 'HP-UX':
                 return "%s %s %s" % (CRONCMD , '-l', pipes.quote(self.user))
-            elif os.getlogin() != self.user:
+            elif pwd.getpwuid(os.getuid())[0] != self.user:
                 user = '-u %s' % pipes.quote(self.user)
         return "%s %s %s" % (CRONCMD , user, '-l')
 
@@ -491,7 +492,7 @@ class CronTab(object):
         if self.user:
             if platform.system() in ['SunOS', 'HP-UX', 'AIX']:
                 return "chown %s %s ; su '%s' -c '%s %s'" % (pipes.quote(self.user), pipes.quote(path), pipes.quote(self.user), CRONCMD, pipes.quote(path))
-            elif os.getlogin() != self.user:
+            elif pwd.getpwuid(os.getuid())[0] != self.user:
                 user = '-u %s' % pipes.quote(self.user)
         return "%s %s %s" % (CRONCMD , user, pipes.quote(path))
 
