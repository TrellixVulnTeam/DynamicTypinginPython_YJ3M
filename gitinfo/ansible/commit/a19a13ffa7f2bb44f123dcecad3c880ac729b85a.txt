commit a19a13ffa7f2bb44f123dcecad3c880ac729b85a
Author: Daniel Hokka Zakrisson <daniel@hozac.com>
Date:   Sun Jan 13 03:38:53 2013 +0100

    Add check for multiple keys in one invocation

diff --git a/library/authorized_key b/library/authorized_key
index 0ef2cea82d..f65d8bfca6 100644
--- a/library/authorized_key
+++ b/library/authorized_key
@@ -143,6 +143,9 @@ def enforce_state(module, params):
     key   = params["key"]
     state = params.get("state", "present")
 
+    if '\n' in key:
+        module.fail_json(msg="key= can only contain a single key")
+
     # check current state -- just get the filename, don't create file
     params["keyfile"] = keyfile(module, user, write=False)
     keys = readkeys(params["keyfile"])
@@ -174,7 +177,6 @@ def main():
         )
     )
 
-    params = module.params
     results = enforce_state(module, module.params)
     module.exit_json(**results)
 
