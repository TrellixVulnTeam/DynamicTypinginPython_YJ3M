commit 035a17e8aaf65fd07ada5c77a75be44300886c90
Author: nitzmahone <mdavis@ansible.com>
Date:   Fri Sep 15 22:48:30 2017 -0700

    migrate azure_rm_vm tests to active (#30452)

diff --git a/test/integration/targets/azure_rm_virtualmachine/aliases b/test/integration/targets/azure_rm_virtualmachine/aliases
new file mode 100644
index 0000000000..9e23ddb721
--- /dev/null
+++ b/test/integration/targets/azure_rm_virtualmachine/aliases
@@ -0,0 +1,3 @@
+cloud/azure
+posix/ci/cloud/group2/azure
+destructive
diff --git a/test/legacy/roles/azure_rm_virtualmachine/defaults/main.yml b/test/integration/targets/azure_rm_virtualmachine/defaults/main.yml
similarity index 100%
rename from test/legacy/roles/azure_rm_virtualmachine/defaults/main.yml
rename to test/integration/targets/azure_rm_virtualmachine/defaults/main.yml
diff --git a/test/integration/targets/azure_rm_virtualmachine/meta/main.yml b/test/integration/targets/azure_rm_virtualmachine/meta/main.yml
new file mode 100644
index 0000000000..95e1952f98
--- /dev/null
+++ b/test/integration/targets/azure_rm_virtualmachine/meta/main.yml
@@ -0,0 +1,2 @@
+dependencies:
+  - setup_azure
diff --git a/test/integration/targets/azure_rm_virtualmachine/tasks/main.yml b/test/integration/targets/azure_rm_virtualmachine/tasks/main.yml
new file mode 100644
index 0000000000..2c7edd1084
--- /dev/null
+++ b/test/integration/targets/azure_rm_virtualmachine/tasks/main.yml
@@ -0,0 +1 @@
+- include: virtualmachine.yml
diff --git a/test/legacy/roles/azure_rm_virtualmachine/tasks/virtualmachine.yml b/test/integration/targets/azure_rm_virtualmachine/tasks/virtualmachine.yml
similarity index 100%
rename from test/legacy/roles/azure_rm_virtualmachine/tasks/virtualmachine.yml
rename to test/integration/targets/azure_rm_virtualmachine/tasks/virtualmachine.yml
diff --git a/test/legacy/roles/azure_rm_virtualmachine/tasks/main.yml b/test/legacy/roles/azure_rm_virtualmachine/tasks/main.yml
deleted file mode 100644
index f1f1c7e3da..0000000000
--- a/test/legacy/roles/azure_rm_virtualmachine/tasks/main.yml
+++ /dev/null
@@ -1,2 +0,0 @@
-- include: virtualmachine.yml
-#- include: virtualmachine_with_defaults.yml
diff --git a/test/legacy/roles/azure_rm_virtualmachine/tasks/virtualmachine_with_defaults.yml b/test/legacy/roles/azure_rm_virtualmachine/tasks/virtualmachine_with_defaults.yml
deleted file mode 100644
index 46e8504800..0000000000
--- a/test/legacy/roles/azure_rm_virtualmachine/tasks/virtualmachine_with_defaults.yml
+++ /dev/null
@@ -1,106 +0,0 @@
-- name: Remove VM
-  azure_rm_virtualmachine:
-    resource_group: "{{ resource_group }}"
-    name: testvm10
-    state: absent
-    vm_size: Standard_A0
-  register: output
-
-- name: Remove VM
-  azure_rm_virtualmachine:
-    resource_group: "{{ resource_group }}"
-    name: testvm20
-    state: absent
-    vm_size: Standard_A0
-  register: output
-
-- name: Create VM with defaults
-  azure_rm_virtualmachine:
-      resource_group: "{{ resource_group }}"
-      name: testvm10
-      vm_size: Standard_A0
-      admin_username: chouseknecht
-      admin_password: Password123
-      short_hostname: test10
-      os_type: Linux
-      open_ports:
-        - "22-23"
-      image:
-        offer: UbuntuServer
-        publisher: Canonical
-        sku: 16.04-LTS
-        version: latest
-  register: output
-
-- name: Add host
-  add_host:
-      groups: just_created
-      hostname: testvm10
-      ansible_host: "{{ azure_vm.properties.networkProfile.networkInterfaces[0].properties.ipConfigurations[0].properties.publicIPAddress.properties.ipAddress }}"
-      ansible_user: chouseknecht
-      ansible_ssh_pass: Password123
-
-- name: Create VM accessible via ssh keys only
-  azure_rm_virtualmachine:
-      resource_group: "{{ resource_group }}"
-      name: testvm20
-      short_hostname: testvm20
-      ssh_password_enabled: false
-      ssh_public_keys:
-        - path: /home/chouseknecht/.ssh/authorized_keys
-          key_data: "{{ lookup('env', 'HOME') }}/.ssh/id_rsa"
-      vm_size: Standard_A0
-      admin_username: chouseknecht
-      image:
-        offer: UbuntuServer
-        publisher: Canonical
-        sku: 16.04-LTS
-        version: latest
-  register: output
-
-- name: Should be idempotent
-  azure_rm_virtualmachine:
-      resource_group: "{{ resource_group }}"
-      name: testvm20
-      short_hostname: testvm20
-      ssh_password_enabled: false
-      ssh_public_keys:
-        - path: /home/chouseknecht/.ssh/authorized_keys
-          key_data: "{{ lookup('env', 'HOME') }}/.ssh/id_rsa"
-      vm_size: Standard_A0
-      admin_username: chouseknecht
-      image:
-        offer: UbuntuServer
-        publisher: Canonical
-        sku: 16.04-LTS
-        version: latest
-  register: output
-
-- assert:
-      that: not output.changed
-
-- name: Add host
-  add_host:
-      groups: just_created
-      hostname: testvm20
-      ansible_ssh_host: "{{ azure_vm.properties.networkProfile.networkInterfaces[0].properties.ipConfigurations[0].properties.publicIPAddress.properties.ipAddress }}"
-      ansible_ssh_user: chouseknecht
-
-- name: Power Off
-  azure_rm_virtualmachine:
-      resource_group: "{{ resource_group }}"
-      name: testvm10
-      started: no
-  register: output
-
-- assert:
-      that: "azure_vm.powerstate not in ['starting', 'running']"
-
-- name: Power On
-  azure_rm_virtualmachine:
-      resource_group: "{{ resource_group }}"
-      name: testvm10
-  register: output
-
-- assert:
-      that: "azure_vm.powerstate in ['starting', 'running']"
