commit de4a271dd097bcc110bfcc82e2cff3ecbf0a5f4e
Author: Hans-Joachim Kliemeck <git@kliemeck.de>
Date:   Sat Oct 17 23:10:56 2015 +0200

    added userprincipal support

diff --git a/lib/ansible/modules/extras/windows/win_owner.ps1 b/lib/ansible/modules/extras/windows/win_owner.ps1
index 5af5072b37..519d6fe580 100644
--- a/lib/ansible/modules/extras/windows/win_owner.ps1
+++ b/lib/ansible/modules/extras/windows/win_owner.ps1
@@ -48,8 +48,7 @@ Function UserSearch
         $accountname = $env:COMPUTERNAME + "\" + $AccountName
         $IsLocalAccount = $true
     }
- 
- 
+
     if ($IsLocalAccount -eq $true)
     {
         # do not use Win32_UserAccount, because e.g. SYSTEM (BUILTIN\SYSTEM or COMPUUTERNAME\SYSTEM) will not be listed. on Win32_Account groups will be listed too
@@ -59,13 +58,19 @@ Function UserSearch
             return $localaccount.SID
         }
     }
-    ElseIf (($IsDomainAccount -eq $true) -and ($IsUpn -eq $false))
+    ElseIf ($IsDomainAccount -eq $true)
     {
         #Search by samaccountname
         $Searcher = [adsisearcher]""
-        $Searcher.Filter = "sAMAccountName=$($accountname.split("\")[1])"
-        $result = $Searcher.FindOne()
- 
+
+        If ($IsUpn -eq $false) {
+            $Searcher.Filter = "sAMAccountName=$($accountname.split("\")[1])"
+        }
+        Else {
+            $Searcher.Filter = "userPrincipalName=$($accountname)"
+        }
+
+        $result = $Searcher.FindOne() 
         if ($result)
         {
             $user = $result.GetDirectoryEntry()
@@ -77,7 +82,6 @@ Function UserSearch
             return (New-Object System.Security.Principal.SecurityIdentifier($binarySID,0)).Value
         }
     }
- 
 }
  
 $params = Parse-Args $args;
