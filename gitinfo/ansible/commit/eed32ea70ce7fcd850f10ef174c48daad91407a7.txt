commit eed32ea70ce7fcd850f10ef174c48daad91407a7
Author: Andrew Smith <asmith@bcm.com.au>
Date:   Thu Nov 28 10:59:51 2013 +1000

    dest_contents isn’t always defined, so don’t pass it around
    
    I think this is also a bit of a hack since it should probably be set
    before being used, I’m just not sure what it should be set to.

diff --git a/lib/ansible/runner/action_plugins/assemble.py b/lib/ansible/runner/action_plugins/assemble.py
index aeabc0d4ca..ad6caf3c6f 100644
--- a/lib/ansible/runner/action_plugins/assemble.py
+++ b/lib/ansible/runner/action_plugins/assemble.py
@@ -90,10 +90,10 @@ class ActionModule(object):
             module_args = "%s src=%s dest=%s original_basename=%s" % (module_args, pipes.quote(xfered), pipes.quote(dest), pipes.quote(os.path.basename(src)))
 
             if self.runner.noop_on_check(inject):
-                return ReturnData(conn=conn, comm_ok=True, result=dict(changed=True), diff=dict(before_header=dest, after_header=src, before=dest_contents, after=resultant))
+                return ReturnData(conn=conn, comm_ok=True, result=dict(changed=True), diff=dict(before_header=dest, after_header=src, after=resultant))
             else:
-                res.diff = dict(before=dest_contents, after=resultant)
                 res = self.runner._execute_module(conn, tmp, 'copy', module_args, inject=inject)
+                res.diff = dict(after=resultant)
                 return res
         else:
             module_args = "%s src=%s dest=%s original_basename=%s" % (module_args, pipes.quote(xfered), pipes.quote(dest), pipes.quote(os.path.basename(src)))
