commit 31e963dd2a499a9c6eca8c5f30b480a9b867f84b
Author: nitzmahone <mdavis@ansible.com>
Date:   Mon Jul 11 11:51:28 2016 -0700

    tkuratomi bugfix for BOMs in powershell modules
    
    fixes #15998

diff --git a/lib/ansible/executor/module_common.py b/lib/ansible/executor/module_common.py
index b851065819..30d9951736 100644
--- a/lib/ansible/executor/module_common.py
+++ b/lib/ansible/executor/module_common.py
@@ -674,6 +674,12 @@ def _find_snippet_imports(module_name, module_data, module_path, module_args, ta
         module_args_json = to_bytes(json.dumps(module_args))
         module_data = module_data.replace(REPLACER_JSONARGS, module_args_json)
 
+        # Powershell/winrm don't actually make use of shebang so we can
+        # safely set this here.  If we let the fallback code handle this
+        # it can fail in the presence of the UTF8 BOM commonly added by
+        # Windows text editors
+        shebang = u'#!powershell'
+
         # Sanity check from 1.x days.  This is currently useless as we only
         # get here if we are going to substitute powershell.ps1 into the
         # module anyway.  Leaving it for when/if we add other powershell
