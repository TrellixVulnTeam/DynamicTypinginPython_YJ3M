commit c6f397b160b9011aa28a2caa9fe4083cbfa4d1c3
Author: Rene Moser <mail@renemoser.net>
Date:   Sat Feb 3 21:21:24 2018 +0100

    cs_vpc: fix network_domain param ignored (#35690)

diff --git a/lib/ansible/modules/cloud/cloudstack/cs_vpc.py b/lib/ansible/modules/cloud/cloudstack/cs_vpc.py
index 4c08e453bf..cf28c5dc81 100644
--- a/lib/ansible/modules/cloud/cloudstack/cs_vpc.py
+++ b/lib/ansible/modules/cloud/cloudstack/cs_vpc.py
@@ -35,6 +35,7 @@ options:
     description:
       - "Network domain for the VPC."
       - "All networks inside the VPC will belong to this domain."
+      - "Only considered while creating the VPC, can not be changed."
   vpc_offering:
     description:
       - "Name of the VPC offering."
@@ -265,6 +266,7 @@ class AnsibleCloudStackVpc(AnsibleCloudStack):
         args = {
             'name': self.module.params.get('name'),
             'displaytext': self.get_or_fallback('display_text', 'name'),
+            'networkdomain': self.module.params.get('network_domain'),
             'vpcofferingid': self.get_vpc_offering(key='id'),
             'cidr': self.module.params.get('cidr'),
             'account': self.get_account(key='name'),
diff --git a/test/integration/targets/cs_vpc/tasks/main.yml b/test/integration/targets/cs_vpc/tasks/main.yml
index 1df3897ff0..bcf7d6e879 100644
--- a/test/integration/targets/cs_vpc/tasks/main.yml
+++ b/test/integration/targets/cs_vpc/tasks/main.yml
@@ -53,6 +53,7 @@
     display_text: "{{ cs_resource_prefix }}_display_text_custom"
     cidr: 10.10.1.0/16
     vpc_offering: Redundant VPC offering
+    network_domain: test.example.com
     zone: "{{ cs_common_zone_adv }}"
   register: vpc
   check_mode: true
@@ -68,6 +69,7 @@
     display_text: "{{ cs_resource_prefix }}_display_text_custom"
     cidr: 10.10.1.0/16
     vpc_offering: Redundant VPC offering
+    network_domain: test.example.com
     zone: "{{ cs_common_zone_adv }}"
   register: vpc
 - name: verify test create vpc with custom offering
@@ -78,6 +80,7 @@
     - vpc.name == "{{ cs_resource_prefix }}_vpc_custom"
     - vpc.display_text == "{{ cs_resource_prefix }}_display_text_custom"
     - vpc.cidr == "10.10.1.0/16"
+    - vpc.network_domain == "test.example.com"
 
 - name: test create vpc with custom offering idempotence
   cs_vpc:
@@ -85,6 +88,7 @@
     display_text: "{{ cs_resource_prefix }}_display_text_custom"
     cidr: 10.10.1.0/16
     vpc_offering: Redundant VPC offering
+    network_domain: test.example.com
     zone: "{{ cs_common_zone_adv }}"
   register: vpc
 - name: verify test create vpc with custom offering idempotence
@@ -95,6 +99,8 @@
     - vpc.name == "{{ cs_resource_prefix }}_vpc_custom"
     - vpc.display_text == "{{ cs_resource_prefix }}_display_text_custom"
     - vpc.cidr == "10.10.1.0/16"
+    - vpc.network_domain == "test.example.com"
+
 
 - name: test create vpc with default offering in check mode
   cs_vpc:
