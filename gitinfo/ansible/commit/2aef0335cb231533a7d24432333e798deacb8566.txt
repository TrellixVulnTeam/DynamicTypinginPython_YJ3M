commit 2aef0335cb231533a7d24432333e798deacb8566
Author: Grzegorz Nosek <root@localdomain.pl>
Date:   Mon Aug 20 21:00:31 2012 +0200

    Handle UTF-8 in templates
    
    This is required to run commands containing non-ASCII characters, e.g.:
    
    ansible localhost -m shell -a 'echo Ä…'

diff --git a/lib/ansible/utils.py b/lib/ansible/utils.py
index 7dff22b4af..2b21ac0ec6 100644
--- a/lib/ansible/utils.py
+++ b/lib/ansible/utils.py
@@ -215,6 +215,10 @@ def template(text, vars):
     ''' run a text buffer through the templating engine until it no longer changes '''
 
     prev_text = ''
+    try:
+        text = text.decode('utf-8')
+    except UnicodeEncodeError:
+        pass # already unicode
     depth = 0
     while prev_text != text:
         depth = depth + 1
