commit b8e07f0d6efe27b7c7ecaa992700353e38c88984
Author: Dag Wieers <dag@wieers.com>
Date:   Tue Mar 20 23:08:55 2018 +0100

    Add a few Jinja2 tests to simplify template (#37514)
    
    Add list test to simplify template

diff --git a/docs/bin/plugin_formatter.py b/docs/bin/plugin_formatter.py
index 12a034f62e..ff381a3676 100755
--- a/docs/bin/plugin_formatter.py
+++ b/docs/bin/plugin_formatter.py
@@ -29,7 +29,7 @@ import os
 import re
 import sys
 import warnings
-from collections import defaultdict
+from collections import defaultdict, Sequence
 from distutils.version import LooseVersion
 from pprint import PrettyPrinter
 
@@ -132,6 +132,12 @@ def rst_xline(width, char="="):
     return char * width
 
 
+# NOTE: The existing Jinja2 'sequence' tests matches strings and dictionaries
+def test_list(value):
+    ''' Return true if objects is a list or tupple '''
+    return isinstance(value, Sequence)
+
+
 def write_data(text, output_dir, outputname, module=None):
     ''' dumps module output to a file or the screen, as requested '''
 
@@ -304,6 +310,9 @@ def jinja2_environment(template_dir, typ, plugin_type):
         env.filters['html_ify'] = html_ify
         env.filters['fmt'] = rst_fmt
         env.filters['xline'] = rst_xline
+
+        env.tests['list'] = test_list
+
         templates['plugin'] = env.get_template('plugin.rst.j2')
 
         if plugin_type == 'module':
diff --git a/docs/templates/plugin.rst.j2 b/docs/templates/plugin.rst.j2
index 35bf13e41b..c146389a98 100644
--- a/docs/templates/plugin.rst.j2
+++ b/docs/templates/plugin.rst.j2
@@ -108,12 +108,10 @@ Parameters
                 <td>
                     <div class="cell-border">
                         {# Turn boolean values in 'yes' and 'no' values #}
-                        {% if value.default is defined %}
-                            {% if value.default == true %}
-                                {% set _x = value.update({'default': 'yes'}) %}
-                            {% elif value.default == false %}
-                                {% set _x = value.update({'default': 'no'}) %}
-                            {% endif %}
+                        {% if value.default is sameas true %}
+                            {% set _x = value.update({'default': 'yes'}) %}
+                        {% elif value.default is sameas false %}
+                            {% set _x = value.update({'default': 'no'}) %}
                         {% endif %}
                         {% if value.type == 'bool' %}
                             {% set _x = value.update({'choices': ['no', 'yes']}) %}
@@ -123,12 +121,12 @@ Parameters
                             <ul><b>Choices:</b>
                                 {% for choice in value.choices %}
                                     {# Turn boolean values in 'yes' and 'no' values #}
-                                    {% if choice == true %}
+                                    {% if choice is sameas true %}
                                         {% set choice = 'yes' %}
-                                    {% elif choice == false %}
+                                    {% elif choice is sameas false %}
                                         {% set choice = 'no' %}
                                     {% endif %}
-                                    {% if (value.default is string and value.default == choice) or (value.default is iterable and value.default is not string and choice in value.default) %}
+                                    {% if (value.default is string and value.default == choice) or (value.default is list and choice in value.default) %}
                                         <li><div style="color: blue"><b>@{ choice | escape }@</b>&nbsp;&larr;</div></li>
                                     {% else %}
                                         <li>@{ choice | escape }@</li>
