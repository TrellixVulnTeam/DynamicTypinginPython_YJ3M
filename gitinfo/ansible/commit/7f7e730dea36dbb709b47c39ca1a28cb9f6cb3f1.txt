commit 7f7e730dea36dbb709b47c39ca1a28cb9f6cb3f1
Author: James Cammarata <jimi@sngx.net>
Date:   Fri Dec 11 14:55:44 2015 -0500

    Don't mark hosts failed if they've moved to a rescue portion of a block
    
    Fixes #13521

diff --git a/lib/ansible/plugins/strategy/__init__.py b/lib/ansible/plugins/strategy/__init__.py
index 15636b580d..91ca4e8638 100644
--- a/lib/ansible/plugins/strategy/__init__.py
+++ b/lib/ansible/plugins/strategy/__init__.py
@@ -30,6 +30,11 @@ from jinja2.exceptions import UndefinedError
 
 from ansible import constants as C
 from ansible.errors import AnsibleError, AnsibleParserError, AnsibleUndefinedVariable
+<<<<<<< Updated upstream
+=======
+from ansible.executor.play_iterator import PlayIterator
+from ansible.executor.process.worker import WorkerProcess
+>>>>>>> Stashed changes
 from ansible.executor.task_result import TaskResult
 from ansible.inventory.host import Host
 from ansible.inventory.group import Group
@@ -202,8 +207,10 @@ class StrategyBase:
                                 [iterator.mark_host_failed(h) for h in self._inventory.get_hosts(iterator._play.hosts) if h.name not in self._tqm._unreachable_hosts]
                             else:
                                 iterator.mark_host_failed(host)
-                            self._tqm._failed_hosts[host.name] = True
-                            self._tqm._stats.increment('failures', host.name)
+                            (state, tmp_task) = iterator.get_next_task_for_host(host, peek=True)
+                            if state.run_state != PlayIterator.ITERATING_RESCUE:
+                                self._tqm._failed_hosts[host.name] = True
+                                self._tqm._stats.increment('failures', host.name)
                         else:
                             self._tqm._stats.increment('ok', host.name)
                         self._tqm.send_callback('v2_runner_on_failed', task_result, ignore_errors=task.ignore_errors)
