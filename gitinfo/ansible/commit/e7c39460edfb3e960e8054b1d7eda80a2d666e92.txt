commit e7c39460edfb3e960e8054b1d7eda80a2d666e92
Author: Tobias <tobleminer@gmail.com>
Date:   Fri Jun 21 15:26:08 2019 +0200

    ipaddr: Handle ipaddress index in network correctly (#57896)
    
    This commit prevents integer indices from being parsed as ip nets
    
    Fixes #57895
    
    Signed-off-by: Tobias Schramm <tobleminer@gmail.com>

diff --git a/changelogs/fragments/57896-fix-ipaddr-cidr-index-handling.yml b/changelogs/fragments/57896-fix-ipaddr-cidr-index-handling.yml
new file mode 100644
index 0000000000..7593504466
--- /dev/null
+++ b/changelogs/fragments/57896-fix-ipaddr-cidr-index-handling.yml
@@ -0,0 +1,2 @@
+bugfixes:
+  - 'ipaddr: prevent integer indices from being parsed as ip nets'
diff --git a/lib/ansible/plugins/filter/ipaddr.py b/lib/ansible/plugins/filter/ipaddr.py
index d2d1c74b90..f2961b825e 100644
--- a/lib/ansible/plugins/filter/ipaddr.py
+++ b/lib/ansible/plugins/filter/ipaddr.py
@@ -630,7 +630,7 @@ def ipaddr(value, query='', version=False, alias='ipaddr'):
     # address/network is inside that specific subnet
     try:
         # ?? 6to4 and link-local were True here before.  Should they still?
-        if query and (query not in query_func_map or query == 'cidr_lookup') and ipaddr(query, 'network'):
+        if query and (query not in query_func_map or query == 'cidr_lookup') and not str(query).isdigit() and ipaddr(query, 'network'):
             iplist = netaddr.IPSet([netaddr.IPNetwork(query)])
             query = 'cidr_lookup'
     except Exception:
