commit cf585831b4fb80c4ae5c0f5b25583bdb7e31a14d
Author: Chris Van Heuveln <cvanheuv@cisco.com>
Date:   Wed May 8 11:31:11 2019 -0400

    nxos_banner: test file cleanup (#55992)
    
    - Created `sanity.yaml` to contain all of the tests previously kept in separate files
    
    - Removed `cli` and `nxapi` test directories
    
    - Tested on current supported platforms and versions: `N3K,N6K,N7K,N9K,N3K-F,N9K-F`

diff --git a/test/integration/targets/nxos_banner/tests/cli/basic-exec.yaml b/test/integration/targets/nxos_banner/tests/cli/basic-exec.yaml
deleted file mode 100644
index 9cdf650220..0000000000
--- a/test/integration/targets/nxos_banner/tests/cli/basic-exec.yaml
+++ /dev/null
@@ -1,39 +0,0 @@
----
-- debug: msg="START cli/nxos_banner exec test"
-
-- block:
-    - name: setup - remove exec
-      nxos_banner: &remove
-        banner: exec
-        state: absent
-
-    - name: Set exec
-      nxos_banner: &exec
-        banner: exec
-        text: |
-          this is my exec banner
-          that has a multiline
-          string
-        state: present
-      register: result
-
-    - assert:
-        that:
-          - "result.changed == true"
-          - "'banner exec @\nthis is my exec banner\nthat has a multiline\nstring\n@' in result.commands"
-
-    - name: Set exec again (idempotent)
-      nxos_banner: *exec
-      register: result
-
-    - assert:
-        that:
-          - "result.changed == false"
-          - "result.commands | length == 0"
-
-    - name: teardown - remove exec
-      nxos_banner: *remove
-
-  when: platform is match("N7K")
-
-- debug: msg="END cli/nxos_banner exec test"
diff --git a/test/integration/targets/nxos_banner/tests/cli/basic-motd.yaml b/test/integration/targets/nxos_banner/tests/cli/basic-motd.yaml
deleted file mode 100644
index 1280f78696..0000000000
--- a/test/integration/targets/nxos_banner/tests/cli/basic-motd.yaml
+++ /dev/null
@@ -1,35 +0,0 @@
----
-- debug: msg="START cli/nxos_banner motd test"
-
-- name: setup - remove motd
-  nxos_banner: &remove
-    banner: motd
-    state: absent
-
-- name: Set motd
-  nxos_banner: &motd
-    banner: motd
-    text: |
-      this is my motd banner
-      that has a multiline
-      string
-    state: present
-  register: result
-
-- assert:
-    that:
-      - "result.changed == true"
-      - "'banner motd @\nthis is my motd banner\nthat has a multiline\nstring\n@' in result.commands"
-
-- name: Set motd again (idempotent)
-  nxos_banner: *motd
-  register: result
-
-- assert:
-    that:
-      - "result.changed == false"
-
-- name: teardown - remove motd
-  nxos_banner: *remove
-
-- debug: msg="END cli/nxos_banner motd test"
diff --git a/test/integration/targets/nxos_banner/tests/cli/basic-no-motd.yaml b/test/integration/targets/nxos_banner/tests/cli/basic-no-motd.yaml
deleted file mode 100644
index e281f6e471..0000000000
--- a/test/integration/targets/nxos_banner/tests/cli/basic-no-motd.yaml
+++ /dev/null
@@ -1,32 +0,0 @@
----
-- debug: msg="START cli/nxos_banner no-motd test"
-
-- name: Setup
-  nxos_banner:
-    banner: motd
-    text: |
-      Junk motd banner
-      over multiple lines
-    state: present
-
-- name: remove motd
-  nxos_banner: &rm-motd
-    banner: motd
-    state: absent
-  register: result
-
-- assert:
-    that:
-      - "result.changed == true"
-      - "'no banner motd' in result.commands"
-
-- name: remove motd (idempotent)
-  nxos_banner: *rm-motd
-  register: result
-
-- assert:
-    that:
-      - "result.changed == false"
-      - "result.commands | length == 0"
-
-- debug: msg="END cli/nxos_banner no-motd test"
diff --git a/test/integration/targets/nxos_banner/tests/common/sanity.yaml b/test/integration/targets/nxos_banner/tests/common/sanity.yaml
new file mode 100644
index 0000000000..89ef7774d4
--- /dev/null
+++ b/test/integration/targets/nxos_banner/tests/common/sanity.yaml
@@ -0,0 +1,86 @@
+---
+- debug: msg="START connection={{ ansible_connection }} nxos_banner sanity test"
+- debug: msg="Using provider={{ connection.transport }}"
+  when: ansible_connection == "local"
+
+- set_fact: banner_exec_image_ok
+  # N5K/N6K/N9K-F support banner exec but have image defects
+  when: platform is search("N7K|N3K-F")
+
+- set_fact: banner_motd_image_ok
+  # multiline banner issues
+  when: imagetag is not search("I7") and ansible_connection != "httpapi"
+
+
+# banner exec tests
+- block:
+  - debug: msg="START nxos_banner exec tests"
+  - name: setup exec
+    nxos_banner: &remove_exec
+      banner: exec
+      state: absent
+
+  - name: Set exec
+    nxos_banner: &exec
+      banner: exec
+      text: |
+        this is my exec banner
+        that has a multiline
+        string
+      state: present
+    register: result
+
+  - assert:
+      that:
+        - "result.changed == true"
+        - "'banner exec @\nthis is my exec banner\nthat has a multiline\nstring\n@' in result.commands"
+
+  - name: Set exec again (idempotent)
+    nxos_banner: *exec
+    register: result
+
+  - assert:
+      that:
+        - "result.changed == false"
+        - "result.commands | length == 0"
+
+  - name: teardown exec
+    nxos_banner: *remove_exec
+
+  when: banner_exec_image_ok is defined
+
+# banner motd tests
+- block:
+  - name: setup motd
+    nxos_banner: &remove_motd
+      banner: motd
+      state: absent
+
+  - name: Set motd
+    nxos_banner: &motd
+      banner: motd
+      text: |
+        Junk motd banner
+        over multiple lines
+      state: present
+    register: result
+
+  - assert:
+      that:
+        - "result.changed == true"
+        - "'banner motd @\nJunk motd banner\nover multiple lines\n@' in result.commands"
+
+  - name: Set motd again (idempotent)
+    nxos_banner: *motd
+    register: result
+
+  - assert:
+      that:
+        - "result.changed == false"
+
+  - name: teardown motd
+    nxos_banner: *remove_motd
+
+  when: banner_motd_image_ok is defined
+
+- debug: msg="END connection={{ ansible_connection }} nxos_banner sanity test"
diff --git a/test/integration/targets/nxos_banner/tests/nxapi/basic-exec.yaml b/test/integration/targets/nxos_banner/tests/nxapi/basic-exec.yaml
deleted file mode 100644
index ad20a90ac4..0000000000
--- a/test/integration/targets/nxos_banner/tests/nxapi/basic-exec.yaml
+++ /dev/null
@@ -1,32 +0,0 @@
----
-- debug: msg="START nxapi/nxos_banner exec test"
-
-- block:
-    - name: setup - remove exec
-      nxos_banner: &remove
-        banner: exec
-        provider: "{{ connection }}"
-        state: absent
-
-    - name: Set exec
-      nxos_banner: &exec
-        banner: exec
-        text: |
-          this is my exec banner
-          that has a multiline
-          string
-        provider: "{{ connection }}"
-        state: present
-      register: result
-
-    - assert:
-        that:
-          - "result.changed == true"
-          - "'banner exec @\nthis is my exec banner\nthat has a multiline\nstring\n@' in result.commands"
-
-    - name: teardown - remove exec
-      nxos_banner: *remove
-
-  when: platform is match("N7K")
-
-- debug: msg="END nxapi/nxos_banner exec test"
diff --git a/test/integration/targets/nxos_banner/tests/nxapi/basic-motd.yaml b/test/integration/targets/nxos_banner/tests/nxapi/basic-motd.yaml
deleted file mode 100644
index 9555a2c9f5..0000000000
--- a/test/integration/targets/nxos_banner/tests/nxapi/basic-motd.yaml
+++ /dev/null
@@ -1,29 +0,0 @@
----
-- debug: msg="START nxapi/nxos_banner motd test"
-
-- name: setup - remove motd
-  nxos_banner: &remove
-    banner: motd
-    provider: "{{ connection }}"
-    state: absent
-
-- name: Set motd
-  nxos_banner: &motd
-    banner: motd
-    text: |
-      this is my motd banner
-      that has a multiline
-      string
-    provider: "{{ connection }}"
-    state: present
-  register: result
-
-- assert:
-    that:
-      - "result.changed == true"
-      - "'banner motd @\nthis is my motd banner\nthat has a multiline\nstring\n@' in result.commands"
-
-- name: teardown - remove motd
-  nxos_banner: *remove
-
-- debug: msg="END nxapi/nxos_banner motd test"
diff --git a/test/integration/targets/nxos_banner/tests/nxapi/basic-no-motd.yaml b/test/integration/targets/nxos_banner/tests/nxapi/basic-no-motd.yaml
deleted file mode 100644
index e33bdabdfb..0000000000
--- a/test/integration/targets/nxos_banner/tests/nxapi/basic-no-motd.yaml
+++ /dev/null
@@ -1,25 +0,0 @@
----
-- debug: msg="START nxapi/nxos_banner no-motd test"
-
-- name: Setup
-  nxos_banner:
-    banner: motd
-    text: |
-      Junk motd banner
-      over multiple lines
-    provider: "{{ connection }}"
-    state: present
-
-- name: remove motd
-  nxos_banner: &rm-motd
-    banner: motd
-    provider: "{{ connection }}"
-    state: absent
-  register: result
-
-- assert:
-    that:
-      - "result.changed == true"
-      - "'no banner motd' in result.commands"
-
-- debug: msg="END nxapi/nxos_banner no-motd test"
