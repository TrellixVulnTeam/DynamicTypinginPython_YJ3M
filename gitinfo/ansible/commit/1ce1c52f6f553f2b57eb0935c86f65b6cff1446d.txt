commit 1ce1c52f6f553f2b57eb0935c86f65b6cff1446d
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Jun 15 01:40:53 2015 -0400

    centralized bad password handling, fixed outputing of become method

diff --git a/lib/ansible/plugins/connections/__init__.py b/lib/ansible/plugins/connections/__init__.py
index c38dd3bec4..20ed2a80e3 100644
--- a/lib/ansible/plugins/connections/__init__.py
+++ b/lib/ansible/plugins/connections/__init__.py
@@ -130,5 +130,6 @@ class ConnectionBase(with_metaclass(ABCMeta, object)):
 
     def check_incorrect_password(self, output, prompt):
         incorrect_password = gettext.dgettext(self._connection_info.become_method, C.BECOME_ERROR_STRINGS[self._connection_info.become_method])
-        return output.endswith(incorrect_password)
+        if output.endswith(incorrect_password):
+            raise AnsibleError('Incorrect %s password' % self._connection_info.become_method)
 
diff --git a/lib/ansible/plugins/connections/ssh.py b/lib/ansible/plugins/connections/ssh.py
index b29418c996..6f37154380 100644
--- a/lib/ansible/plugins/connections/ssh.py
+++ b/lib/ansible/plugins/connections/ssh.py
@@ -174,9 +174,7 @@ class Connection(ConnectionBase):
             # fail early if the become password is wrong
             if self._connection_info.become and sudoable:
                 if self._connection_info.become_pass:
-                    if self.check_incorrect_password(stdout, prompt):
-                        raise AnsibleError('Incorrect %s password', self._connection_info.become_method)
-
+                    self.check_incorrect_password(stdout, prompt)
                 elif self.check_password_prompt(stdout, prompt):
                     raise AnsibleError('Missing %s password', self._connection_info.become_method)
 
@@ -324,7 +322,7 @@ class Connection(ConnectionBase):
 
             while True:
                 if self.check_become_success(become_output, success_key) or \
-                   self.check_password_prompt(become_output, prompt ):
+                   self.check_password_prompt(become_output, prompt):
                     break
                 rfd, wfd, efd = select.select([p.stdout, p.stderr], [], [p.stdout], self._connection_info.timeout)
                 if p.stderr in rfd:
@@ -333,8 +331,7 @@ class Connection(ConnectionBase):
                         raise AnsibleError('ssh connection closed waiting for privilege escalation password prompt')
                     become_errput += chunk
 
-                    if self.check_incorrect_password(become_errput, prompt):
-                        raise AnsibleError('Incorrect %s password', self._connection_info.become_method)
+                    self.check_incorrect_password(become_errput, prompt)
 
                 if p.stdout in rfd:
                     chunk = p.stdout.read()
