commit aeb0245ebd0ab6c51da7132e5c03ab6eb76e03a2
Author: Simon Dodsley <simon@purestorage.com>
Date:   Thu Jul 18 23:17:31 2019 +0200

    Add check for correct API version before trying to execute (#59205)

diff --git a/lib/ansible/modules/storage/purestorage/purefa_user.py b/lib/ansible/modules/storage/purestorage/purefa_user.py
index 6696bd23da..6f8ff0dc83 100644
--- a/lib/ansible/modules/storage/purestorage/purefa_user.py
+++ b/lib/ansible/modules/storage/purestorage/purefa_user.py
@@ -102,6 +102,8 @@ RETURN = r'''
 from ansible.module_utils.basic import AnsibleModule
 from ansible.module_utils.pure import get_system, purefa_argument_spec
 
+MIN_REQUIRED_API_VERSION = '1.14'
+
 
 def get_user(module, array):
     """Return Local User Account or None"""
@@ -200,6 +202,11 @@ def main():
 
     state = module.params['state']
     array = get_system(module)
+    api_version = array._list_available_rest_versions()
+
+    if MIN_REQUIRED_API_VERSION not in api_version:
+        module.fail_json(msg='FlashArray REST version not supported. '
+                             'Minimum version required: {0}'.format(MIN_REQUIRED_API_VERSION))
 
     if state == 'absent':
         delete_user(module, array)
