commit f623057e0e181fa91c7a1d45953779fd5cf7643a
Author: Calvin Walton <calvin.walton@kepstin.ca>
Date:   Mon Feb 29 11:16:15 2016 -0500

    zabbix_maintenance: Stop using api removed in zabbix 3.0

diff --git a/lib/ansible/modules/extras/monitoring/zabbix_maintenance.py b/lib/ansible/modules/extras/monitoring/zabbix_maintenance.py
index d8b6516581..fe26bd144e 100644
--- a/lib/ansible/modules/extras/monitoring/zabbix_maintenance.py
+++ b/lib/ansible/modules/extras/monitoring/zabbix_maintenance.py
@@ -202,18 +202,6 @@ def delete_maintenance(zbx, maintenance_id):
     return 0, None, None
 
 
-def check_maintenance(zbx, name):
-    try:
-        result = zbx.maintenance.exists(
-            {
-                "name": name
-            }
-        )
-    except BaseException as e:
-        return 1, None, str(e)
-    return 0, result, None
-
-
 def get_group_ids(zbx, host_groups):
     group_ids = []
     for group in host_groups:
@@ -325,11 +313,11 @@ def main():
         else:
             host_ids = []
 
-        (rc, exists, error) = check_maintenance(zbx, name)
+        (rc, maintenance, error) = get_maintenance_id(zbx, name)
         if rc != 0:
             module.fail_json(msg="Failed to check maintenance %s existance: %s" % (name, error))
 
-        if not exists:
+        if not maintenance:
             if not host_names and not host_groups:
                 module.fail_json(msg="At least one host_name or host_group must be defined for each created maintenance.")
 
@@ -344,24 +332,19 @@ def main():
 
     if state == "absent":
 
-        (rc, exists, error) = check_maintenance(zbx, name)
+        (rc, maintenance, error) = get_maintenance_id(zbx, name)
         if rc != 0:
             module.fail_json(msg="Failed to check maintenance %s existance: %s" % (name, error))
 
-        if exists:
-            (rc, maintenance, error) = get_maintenance_id(zbx, name)
-            if rc != 0:
-                module.fail_json(msg="Failed to get maintenance id: %s" % error)
-
-            if maintenance:
-                if module.check_mode:
+        if maintenance:
+            if module.check_mode:
+                changed = True
+            else:
+                (rc, _, error) = delete_maintenance(zbx, maintenance)
+                if rc == 0:
                     changed = True
                 else:
-                    (rc, _, error) = delete_maintenance(zbx, maintenance)
-                    if rc == 0:
-                        changed = True
-                    else:
-                        module.fail_json(msg="Failed to remove maintenance: %s" % error)
+                    module.fail_json(msg="Failed to remove maintenance: %s" % error)
 
     module.exit_json(changed=changed)
 
