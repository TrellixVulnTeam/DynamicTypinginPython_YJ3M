commit 317c2f4bc03b3d800a9c983ae6141d48d15ad65f
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Apr 2 19:46:51 2014 -0500

    Fixes to variable issues introduced by recent changes
    
    Fixes #6801
    Fixes #6832

diff --git a/lib/ansible/playbook/play.py b/lib/ansible/playbook/play.py
index 93af7e6a29..13fd0e471b 100644
--- a/lib/ansible/playbook/play.py
+++ b/lib/ansible/playbook/play.py
@@ -688,6 +688,9 @@ class Play(object):
         else:
             raise errors.AnsibleError("'vars_prompt' section is malformed, see docs")
 
+        if type(self.playbook.extra_vars) == dict:
+            vars = utils.combine_vars(vars, self.playbook.extra_vars)
+
         return vars
 
     # *************************************************
@@ -766,7 +769,8 @@ class Play(object):
         if host is not None:
             inject = {}
             inject.update(self.playbook.inventory.get_variables(host, vault_password=vault_password))
-            inject.update(self.playbook.VARS_CACHE[host])
+            inject.update(self.playbook.SETUP_CACHE.get(host, {}))
+            inject.update(self.playbook.VARS_CACHE.get(host, {}))
 
         for filename in self.vars_files:
 
