commit 29a308a2336b8de36e30743f925c6997e64ef706
Author: Paul Durivage <pauldurivage@gmail.com>
Date:   Thu Jun 19 16:23:38 2014 -0500

    Move functions to top for correct scope

diff --git a/library/windows/win_user.ps1 b/library/windows/win_user.ps1
index dd8a7b4c28..6ce9d02368 100644
--- a/library/windows/win_user.ps1
+++ b/library/windows/win_user.ps1
@@ -19,6 +19,32 @@
 # WANT_JSON
 # POWERSHELL_COMMON
 
+########
+$adsi = [ADSI]"WinNT://$env:COMPUTERNAME"
+
+function Get-User($user) {
+    $adsi.Children | where {$_.SchemaClassName -eq 'user' -and $_.Name -eq $user }
+    return
+}
+
+function Create-User([string]$user, [string]$passwd) {
+   $user = $adsi.Create("User", $user)
+   $user.SetPassword($passwd)
+   $user.SetInfo()
+   $user
+   return
+}
+
+function Update-Password($user, [string]$passwd) {
+    $user.SetPassword($passwd)
+    $user.SetInfo()
+}
+
+function Delete-User($user) {
+    $adsi.delete("user", $user.Name.Value)
+}
+########
+
 $params = Parse-Args $args;
 
 $result = New-Object psobject @{
@@ -82,30 +108,9 @@ else {
     }
 }
 
-$adsi = [ADSI]"WinNT://$env:COMPUTERNAME"
-
-function Get-User($user) {
-    $adsi.Children | where {$_.SchemaClassName -eq 'user' -and $_.Name -eq $user }
-    return
-}
-
-function Create-User([string]$user, [string]$passwd) {
-   $user = $adsi.Create("User", $user)
-   $user.SetPassword($passwd)
-   $user.SetInfo()
-   $user
-   return
-}
-
-function Update-Password($user, [string]$passwd) {
-    $user.SetPassword($passwd)
-    $user.SetInfo()
-}
-
-function Delete-User($user) {
-    $adsi.delete("user", $user.Name.Value)
-}
-
-Set-Attr $result "user" $user_obj; # Soemthing goes here.
+# Set-Attr $result "user" $user_obj
+Set-Attr $result "user_name" $user_obj.Name
+Set-Attr $result "user_fullname" $user_obj.FullName
+Set-Attr $result "user_path" $user_obj.Path
 
 Exit-Json $result;
