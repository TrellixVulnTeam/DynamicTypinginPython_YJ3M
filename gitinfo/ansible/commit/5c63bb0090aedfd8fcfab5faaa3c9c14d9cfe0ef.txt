commit 5c63bb0090aedfd8fcfab5faaa3c9c14d9cfe0ef
Author: Matt Martz <matt@sivel.net>
Date:   Tue Dec 12 12:20:03 2017 -0600

    Add test for clean_copy preservation of keys

diff --git a/test/units/executor/test_task_result.py b/test/units/executor/test_task_result.py
index 82e20dc168..35df122464 100644
--- a/test/units/executor/test_task_result.py
+++ b/test/units/executor/test_task_result.py
@@ -147,3 +147,25 @@ class TestTaskResult(unittest.TestCase):
         tr = TaskResult(mock_host, mock_task, dict(_ansible_no_log=True, secret='DONTSHOWME'))
         clean = tr.clean_copy()
         self.assertTrue('secret' not in clean._result)
+
+    def test_task_result_no_log_preserve(self):
+        mock_host = MagicMock()
+        mock_task = MagicMock()
+
+        # no_log should not remove presrved keys
+        tr = TaskResult(
+            mock_host,
+            mock_task,
+            dict(
+                _ansible_no_log=True,
+                retries=5,
+                attempts=5,
+                changed=False,
+                foo='bar',
+            )
+        )
+        clean = tr.clean_copy()
+        self.assertTrue('retries' in clean._result)
+        self.assertTrue('attempts' in clean._result)
+        self.assertTrue('changed' in clean._result)
+        self.assertTrue('foo' not in clean._result)
