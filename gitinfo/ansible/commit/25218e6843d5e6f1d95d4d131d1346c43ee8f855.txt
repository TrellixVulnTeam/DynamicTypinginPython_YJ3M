commit 25218e6843d5e6f1d95d4d131d1346c43ee8f855
Author: Sloane Hertel <shertel@redhat.com>
Date:   Tue Jul 31 15:50:15 2018 -0400

    Fix dualstack without s3_url (#43510)

diff --git a/lib/ansible/modules/cloud/amazon/aws_s3.py b/lib/ansible/modules/cloud/amazon/aws_s3.py
index 5d22853d4d..367f89c168 100644
--- a/lib/ansible/modules/cloud/amazon/aws_s3.py
+++ b/lib/ansible/modules/cloud/amazon/aws_s3.py
@@ -759,7 +759,7 @@ def main():
     if not s3_url and 'S3_URL' in os.environ:
         s3_url = os.environ['S3_URL']
 
-    if dualstack and 'amazonaws.com' not in s3_url:
+    if dualstack and s3_url is not None and 'amazonaws.com' not in s3_url:
         module.fail_json(msg='dualstack only applies to AWS S3')
 
     if dualstack and not module.botocore_at_least('1.4.45'):
