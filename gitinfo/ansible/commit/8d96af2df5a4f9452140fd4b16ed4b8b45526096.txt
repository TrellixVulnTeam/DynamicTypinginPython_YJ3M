commit 8d96af2df5a4f9452140fd4b16ed4b8b45526096
Author: Matt Clay <matt@mystile.com>
Date:   Fri Mar 29 01:19:51 2019 -0700

    Use correct python for -c invocations in tests. (#54577)
    
    * Use correct python for -c invocations in tests.
    * Only set releasever when available.

diff --git a/test/integration/targets/aws_kms/tasks/main.yml b/test/integration/targets/aws_kms/tasks/main.yml
index b8b73676a6..12b04b2b06 100644
--- a/test/integration/targets/aws_kms/tasks/main.yml
+++ b/test/integration/targets/aws_kms/tasks/main.yml
@@ -108,7 +108,7 @@
       no_log: True
 
     - name: get ARN of calling user
-      command: python -c 'import boto3,json; sts = boto3.client("sts"); print json.dumps(sts.get_caller_identity())'
+      command: "{{ ansible_python_interpreter }} -c 'import boto3, json; sts = boto3.client(\"sts\"); print json.dumps(sts.get_caller_identity())'"
       changed_when: False
       environment: "{{ aws_environment }}"
       register: sts_get_caller_results
diff --git a/test/integration/targets/jinja2_native_types/runtests.yml b/test/integration/targets/jinja2_native_types/runtests.yml
index 9c61e69947..efcdb7a572 100644
--- a/test/integration/targets/jinja2_native_types/runtests.yml
+++ b/test/integration/targets/jinja2_native_types/runtests.yml
@@ -32,7 +32,7 @@
       yaml_none: ~
   tasks:
       - name: check jinja version
-        shell: python -c 'import jinja2; print(jinja2.__version__)'
+        command: "{{ ansible_python_interpreter }} -c 'import jinja2; print(jinja2.__version__)'"
         register: jinja2_version
 
       - name: make sure jinja is the right version
diff --git a/test/integration/targets/script/tasks/main.yml b/test/integration/targets/script/tasks/main.yml
index 441d740691..f1746f7c48 100644
--- a/test/integration/targets/script/tasks/main.yml
+++ b/test/integration/targets/script/tasks/main.yml
@@ -226,7 +226,7 @@
 - name: Run script with shebang omitted
   script: no_shebang.py
   args:
-    executable: python
+    executable: "{{ ansible_python_interpreter }}"
   register: _shebang_omitted_test
   tags:
     - noshebang
diff --git a/test/integration/targets/user/tasks/main.yml b/test/integration/targets/user/tasks/main.yml
index 3923c0d79c..591efba2d3 100644
--- a/test/integration/targets/user/tasks/main.yml
+++ b/test/integration/targets/user/tasks/main.yml
@@ -255,7 +255,7 @@
         mode = oct(0o777 & ~umask)
         print(str(mode).replace('o', ''))
       args:
-        executable: "{{ ansible_facts.python.executable }}"
+        executable: "{{ ansible_python_interpreter }}"
       register: user_login_defs_umask
 
     - name: validate that user home dir is created
diff --git a/test/integration/targets/xml/tasks/main.yml b/test/integration/targets/xml/tasks/main.yml
index ca47f1be04..66cdb8599e 100644
--- a/test/integration/targets/xml/tasks/main.yml
+++ b/test/integration/targets/xml/tasks/main.yml
@@ -15,7 +15,7 @@
 #  when: ansible_os_family == "Darwin"
 
 - name: Get lxml version
-  command: python -c 'from lxml import etree; print(".".join(str(v) for v in etree.LXML_VERSION))'
+  command: "{{ ansible_python_interpreter }} -c 'from lxml import etree; print(\".\".join(str(v) for v in etree.LXML_VERSION))'"
   register: lxml_version
 
 - name: Set lxml capabilities as variables
diff --git a/test/integration/targets/yum/tasks/yuminstallroot.yml b/test/integration/targets/yum/tasks/yuminstallroot.yml
index 13fc300200..affd0d8be9 100644
--- a/test/integration/targets/yum/tasks/yuminstallroot.yml
+++ b/test/integration/targets/yum/tasks/yuminstallroot.yml
@@ -22,13 +22,15 @@
     mode: 0755
 
 - name: get yum releasever
-  shell: python -c 'import yum; yb = yum.YumBase(); print(yb.conf.yumvar["releasever"])' | tail -n 1
+  command: "{{ ansible_python_interpreter }} -c 'import yum; yb = yum.YumBase(); print(yb.conf.yumvar[\"releasever\"])'"
   register: releasever
+  ignore_errors: yes
 
 - name: Populate directory
   copy:
-    content: "{{ releasever.stdout }}\n"
+    content: "{{ releasever.stdout_lines[-1] }}\n"
     dest: "/{{ yumroot.stdout }}/etc/yum/vars/releasever"
+  when: releasever is successful
 
 # This will drag in > 200 MB.
 - name: attempt installroot
