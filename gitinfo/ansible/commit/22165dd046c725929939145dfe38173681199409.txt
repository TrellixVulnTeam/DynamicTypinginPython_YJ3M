commit 22165dd046c725929939145dfe38173681199409
Author: Brian Coca <bcoca@ansible.com>
Date:   Tue Jul 14 11:44:45 2015 -0400

    fixed bad parsing tests

diff --git a/test/integration/Makefile b/test/integration/Makefile
index e6a85acd6b..3d4555b54f 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -24,13 +24,8 @@ CONSUL_RUNNING := $(shell python consul_running.py)
 all: parsing test_var_precedence unicode test_templating_settings non_destructive destructive includes check_mode test_hash test_handlers test_group_by test_vault test_tags
 
 parsing:
-	#ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario1; [ $$? -eq 4 ]
-	#ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario2; [ $$? -eq 4 ]
-	#ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario3; [ $$? -eq 4 ]
-	#ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario4; [ $$? -eq 4 ]
-	#ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario5; [ $$? -eq 4 ]
+	ansible-playbook bad_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -vvv $(TEST_FLAGS) --tags prepare,common,scenario5
 	ansible-playbook good_parsing.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) -v $(TEST_FLAGS)
-	echo "skipping for now..."
 
 includes:
 	ansible-playbook test_includes.yml -i $(INVENTORY) -e @$(VARS_FILE) $(CREDENTIALS_ARG) $(TEST_FLAGS)
diff --git a/test/integration/roles/test_bad_parsing/tasks/main.yml b/test/integration/roles/test_bad_parsing/tasks/main.yml
index 4636383d9e..c0cad8798a 100644
--- a/test/integration/roles/test_bad_parsing/tasks/main.yml
+++ b/test/integration/roles/test_bad_parsing/tasks/main.yml
@@ -48,4 +48,9 @@
 - name: test that a missing/malformed jinja2 filter fails
   debug: msg="{{output_dir|badfiltername}}"
   tags: scenario5
+  register: filter_fail
+  ignore_errors: yes
 
+- assert:
+    that:
+     - filter_fail|failed
