commit b6879ca2bd620a2d73db9f2598ad67c66aff3bbb
Author: James Tanner <tanner.jc@gmail.com>
Date:   Wed Nov 27 17:01:53 2013 -0500

    Fixes #5030 compare connection user and sudo user and disable sudo if identical

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index aafb07bdfa..75866fadca 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -762,10 +762,12 @@ class Runner(object):
             executable = C.DEFAULT_EXECUTABLE
 
         sudo_user = self.sudo_user
-        
-        if self.remote_user == sudo_user:
-            sudoable = False
-        
+
+        # compare connection user to sudo_user and disable if the same
+        if hasattr(conn, 'user'):
+            if conn.user == sudo_user:
+                sudoable = False
+
         rc, stdin, stdout, stderr = conn.exec_command(cmd, tmp, sudo_user, sudoable=sudoable, executable=executable)
 
         if type(stdout) not in [ str, unicode ]:
