commit 57921c0b4d474413ed389862b8b50e8dddf6f2a7
Author: h-hirokawa <h.hirokawa@realglobe.jp>
Date:   Wed Jul 13 16:13:27 2016 +0900

    Fix azure_rm_virtualmachine (#4174).

diff --git a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
index 8346381abd..9da0639a1e 100644
--- a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
+++ b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
@@ -1142,9 +1142,10 @@ class AzureRMVirtualMachine(AzureRMModuleBase):
         valid_name = False
 
         # Attempt to find a valid storage account name
+        storage_account_name_base = self.name[:20].lower()
         for i in range(0, 5):
             rand = random.randrange(1000, 9999)
-            storage_account_name = self.name[:20] + str(rand)
+            storage_account_name = storage_account_name_base + str(rand)
             if self.check_storage_account_name(storage_account_name):
                 valid_name = True
                 break
