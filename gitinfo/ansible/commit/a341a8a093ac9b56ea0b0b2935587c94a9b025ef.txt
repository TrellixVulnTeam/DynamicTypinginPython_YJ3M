commit a341a8a093ac9b56ea0b0b2935587c94a9b025ef
Author: James Cammarata <jimi@sngx.net>
Date:   Tue Sep 1 11:27:00 2015 -0400

    Make sure tasks from a role see their defaults above all others
    
    Fixes #12081

diff --git a/lib/ansible/vars/__init__.py b/lib/ansible/vars/__init__.py
index 8ceed9d3a2..bcddc2e77f 100644
--- a/lib/ansible/vars/__init__.py
+++ b/lib/ansible/vars/__init__.py
@@ -183,6 +183,12 @@ class VariableManager:
             for role in play.get_roles():
                 all_vars = self._combine_vars(all_vars, role.get_default_vars())
 
+            # if we have a task in this context, and that task has a role, make
+            # sure it sees its defaults above any other roles, as we previously
+            # (v1) made sure each task had a copy of its roles default vars
+            if task and task._role is not None:
+                all_vars = self._combine_vars(all_vars, task._role.get_default_vars())
+
         if host:
             # next, if a host is specified, we load any vars from group_vars
             # files and then any vars from host_vars files which may apply to
