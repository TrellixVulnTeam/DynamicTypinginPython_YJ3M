commit bda0f6e2414062cc7ede5e69a433989549d9bce3
Author: Matt Clay <matt@mystile.com>
Date:   Wed Aug 30 10:40:14 2017 -0700

    Fix ansible-test handling of integration dir.

diff --git a/test/runner/lib/classification.py b/test/runner/lib/classification.py
index 59a6587ac2..c111232f4d 100644
--- a/test/runner/lib/classification.py
+++ b/test/runner/lib/classification.py
@@ -216,6 +216,7 @@ class PathMapper(object):
         :type path: str
         :rtype: dict[str, str] | None
         """
+        dirname = os.path.dirname(path)
         filename = os.path.basename(path)
         name, ext = os.path.splitext(filename)
 
@@ -398,29 +399,30 @@ class PathMapper(object):
             }
 
         if path.startswith('test/integration/'):
-            if self.prefixes.get(name) == 'network' and ext == '.yaml':
-                return minimal  # network integration test playbooks are not used by ansible-test
-
-            if filename == 'platform_agnostic.yaml':
-                return minimal  # network integration test playbook not used by ansible-test
-
-            for command in (
-                    'integration',
-                    'windows-integration',
-                    'network-integration',
-            ):
-                if name == command:
-                    return {
-                        command: self.integration_all_target,
-                    }
+            if dirname == 'test/integration':
+                if self.prefixes.get(name) == 'network' and ext == '.yaml':
+                    return minimal  # network integration test playbooks are not used by ansible-test
+
+                if filename == 'platform_agnostic.yaml':
+                    return minimal  # network integration test playbook not used by ansible-test
+
+                for command in (
+                        'integration',
+                        'windows-integration',
+                        'network-integration',
+                ):
+                    if name == command and ext == '.cfg':
+                        return {
+                            command: self.integration_all_target,
+                        }
 
-            if name.startswith('cloud-config-'):
-                cloud_target = 'cloud/%s/' % name.split('-')[2].split('.')[0]
+                if name.startswith('cloud-config-'):
+                    cloud_target = 'cloud/%s/' % name.split('-')[2].split('.')[0]
 
-                if cloud_target in self.integration_targets_by_alias:
-                    return {
-                        'integration': cloud_target,
-                    }
+                    if cloud_target in self.integration_targets_by_alias:
+                        return {
+                            'integration': cloud_target,
+                        }
 
             return {
                 'integration': self.integration_all_target,
