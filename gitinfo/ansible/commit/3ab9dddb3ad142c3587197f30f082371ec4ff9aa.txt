commit 3ab9dddb3ad142c3587197f30f082371ec4ff9aa
Author: Abhijit Menon-Sen <ams@2ndQuadrant.com>
Date:   Thu Aug 25 22:32:45 2016 +0530

    Make the extract filter return Undefined on KeyError
    
    groups['x']|map('extract', hostvars, 'somevar') would break if any host
    didn't have 'somevar' set. With this change, it will return Undefined
    instead. This change permits |map('extract', â€¦)|map('default', 42) to
    set a default value in such cases.

diff --git a/lib/ansible/plugins/filter/core.py b/lib/ansible/plugins/filter/core.py
index 6190cbe9af..5ea24bcd5c 100644
--- a/lib/ansible/plugins/filter/core.py
+++ b/lib/ansible/plugins/filter/core.py
@@ -363,7 +363,10 @@ def extract(item, container, morekeys=None):
         if not isinstance(morekeys, list):
             morekeys = [morekeys]
 
-        value = reduce(lambda d, k: d[k], morekeys, value)
+        try:
+            value = reduce(lambda d, k: d[k], morekeys, value)
+        except KeyError:
+            value = Undefined()
 
     return value
 
