commit c00604210c64a87fccb5a494aa0375175d7b964d
Author: Rene Moser <mail@renemoser.net>
Date:   Tue Feb 7 22:14:43 2017 +0100

    cs_instance: fix ssh keys not found in projects (#21104)
    
    Follow up of 5475f3ee644c32d03f48fb091ef019b7b5fd2706

diff --git a/lib/ansible/modules/cloud/cloudstack/cs_instance.py b/lib/ansible/modules/cloud/cloudstack/cs_instance.py
index a2879a5d85..7486aea986 100644
--- a/lib/ansible/modules/cloud/cloudstack/cs_instance.py
+++ b/lib/ansible/modules/cloud/cloudstack/cs_instance.py
@@ -584,9 +584,18 @@ class AnsibleCloudStackInstance(AnsibleCloudStack):
         if ssh_key_name == instance_ssh_key_name:
             return False
 
-        res = self.cs.listSSHKeyPairs(name=instance_ssh_key_name)
+        args = {
+            'domainid': self.get_domain('id'),
+            'account': self.get_account('name'),
+            'projectid': self.get_project('id')
+        }
+
+        args['name'] = instance_ssh_key_name
+        res = self.cs.listSSHKeyPairs(**args)
         instance_ssh_key = res['sshkeypair'][0]
-        res = self.cs.listSSHKeyPairs(name=ssh_key_name)
+
+        args['name'] = ssh_key_name
+        res = self.cs.listSSHKeyPairs(**args)
         param_ssh_key = res['sshkeypair'][0]
         if param_ssh_key['fingerprint'] != instance_ssh_key['fingerprint']:
             return True
