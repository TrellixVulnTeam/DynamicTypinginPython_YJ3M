commit 786aceb43b5a124740a5985ca79d1720e6b0d3c8
Author: Mark Phillips <mark@probably.co.uk>
Date:   Wed Dec 24 12:39:48 2014 +0000

    vsphere_guest fix for KeyError: folder message

diff --git a/lib/ansible/modules/cloud/vmware/vsphere_guest.py b/lib/ansible/modules/cloud/vmware/vsphere_guest.py
index 378e3ecb9e..805bfd5f3c 100644
--- a/lib/ansible/modules/cloud/vmware/vsphere_guest.py
+++ b/lib/ansible/modules/cloud/vmware/vsphere_guest.py
@@ -684,7 +684,7 @@ def create_vm(vsphere_client, module, esxi, resource_pool, cluster_name, guest,
     hfmor = dcprops.hostFolder._obj
 
     # virtualmachineFolder managed object reference
-    if vm_extra_config['folder']:
+    if vm_extra_config.get('folder'):
         if vm_extra_config['folder'] not in vsphere_client._get_managed_objects(MORTypes.Folder).values():
             vsphere_client.disconnect()
             module.fail_json(msg="Cannot find folder named: %s" % vm_extra_config['folder'])
