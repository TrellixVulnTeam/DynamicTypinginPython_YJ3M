commit 9972c27a9bc1dd2c9051368e082e2b366a04acbe
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Jan 4 18:44:09 2016 -0500

    now handles 'non file diffs'
    
    this allows modules to pass back a 'diff' dict and it will still show using the file interface

diff --git a/lib/ansible/plugins/callback/__init__.py b/lib/ansible/plugins/callback/__init__.py
index cc2a9ad0e7..faf04b1180 100644
--- a/lib/ansible/plugins/callback/__init__.py
+++ b/lib/ansible/plugins/callback/__init__.py
@@ -116,6 +116,10 @@ class CallbackBase:
                     if 'src_larger' in diff:
                         ret.append("diff skipped: source file size is greater than %d\n" % diff['src_larger'])
                     if 'before' in diff and 'after' in diff:
+                        # format complex structures into 'files'
+                        for x in ['before', 'after']:
+                            if isinstance(diff[x], dict):
+                                diff[x] = json.dumps(diff[x], sort_keys=True, indent=4)
                         if 'before_header' in diff:
                             before_header = "before: %s" % diff['before_header']
                         else:
