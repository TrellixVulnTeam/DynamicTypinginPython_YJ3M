commit 6c41d9cd3885583089872989ce8b3f40da5c0e04
Author: Chris Tooley <ctooley@rgare.com>
Date:   Sat Mar 5 00:37:41 2016 +0000

    Add https support for consul clustering modules

diff --git a/lib/ansible/modules/extras/clustering/consul.py b/lib/ansible/modules/extras/clustering/consul.py
index 627f7fb66a..8929a0e78b 100644
--- a/lib/ansible/modules/extras/clustering/consul.py
+++ b/lib/ansible/modules/extras/clustering/consul.py
@@ -71,6 +71,16 @@ options:
           - the port on which the consul agent is running
         required: false
         default: 8500
+    scheme:
+        description:
+          - the protocol scheme on which the consul agent is running
+        required: false
+        default: http
+    verify:
+        description:
+          - whether to verify the tls certificate of the consul agent
+        required: false
+        default: True
     notes:
         description:
           - Notes to attach to check when registering it.
@@ -308,6 +318,8 @@ def remove_service(module, service_id):
 def get_consul_api(module, token=None):
     return consul.Consul(host=module.params.get('host'),
                          port=module.params.get('port'),
+                         scheme=module.params.get('scheme'),
+                         verify=module.params.get('verify'),
                          token=module.params.get('token'))
 
 
@@ -503,6 +515,8 @@ def main():
         argument_spec=dict(
             host=dict(default='localhost'),
             port=dict(default=8500, type='int'),
+            scheme=dict(required=False, default='http'),
+            verify=dict(required=False, default=True, type='bool'),
             check_id=dict(required=False),
             check_name=dict(required=False),
             check_node=dict(required=False),
diff --git a/lib/ansible/modules/extras/clustering/consul_acl.py b/lib/ansible/modules/extras/clustering/consul_acl.py
index 17d59ea62a..2e8149a2c9 100644
--- a/lib/ansible/modules/extras/clustering/consul_acl.py
+++ b/lib/ansible/modules/extras/clustering/consul_acl.py
@@ -69,6 +69,16 @@ options:
           - the port on which the consul agent is running
         required: false
         default: 8500
+    scheme:
+        description:
+          - the protocol scheme on which the consul agent is running
+        required: false
+        default: http
+    verify:
+        description:
+          - whether to verify the tls certificate of the consul agent
+        required: false
+        default: True
 """
 
 EXAMPLES = '''
@@ -300,6 +310,8 @@ def get_consul_api(module, token=None):
         token = module.params.get('token')
     return consul.Consul(host=module.params.get('host'),
                          port=module.params.get('port'),
+                         scheme=module.params.get('scheme'),
+                         verify=module.params.get('verify'),
                          token=token)
 
 def test_dependencies(module):
@@ -315,6 +327,8 @@ def main():
     argument_spec = dict(
         mgmt_token=dict(required=True, no_log=True),
         host=dict(default='localhost'),
+        scheme=dict(required=False, default='http'),
+        verify=dict(required=False, default=True),
         name=dict(required=False),
         port=dict(default=8500, type='int'),
         rules=dict(default=None, required=False, type='list'),
diff --git a/lib/ansible/modules/extras/clustering/consul_kv.py b/lib/ansible/modules/extras/clustering/consul_kv.py
index b61c0ee184..deab7a57a1 100644
--- a/lib/ansible/modules/extras/clustering/consul_kv.py
+++ b/lib/ansible/modules/extras/clustering/consul_kv.py
@@ -99,6 +99,16 @@ options:
           - the port on which the consul agent is running
         required: false
         default: 8500
+    scheme:
+        description:
+          - the protocol scheme on which the consul agent is running
+        required: false
+        default: http
+    verify:
+        description:
+          - whether to verify the tls certificate of the consul agent
+        required: false
+        default: True
 """
 
 
@@ -218,6 +228,8 @@ def remove_value(module):
 def get_consul_api(module, token=None):
     return consul.Consul(host=module.params.get('host'),
                          port=module.params.get('port'),
+                         scheme=module.params.get('scheme'),
+                         verify=module.params.get('verify'),
                          token=module.params.get('token'))
 
 def test_dependencies(module):
@@ -232,6 +244,8 @@ def main():
         flags=dict(required=False),
         key=dict(required=True),
         host=dict(default='localhost'),
+        scheme=dict(required=False, default='http'),
+        verify=dict(required=False, default=True),
         port=dict(default=8500, type='int'),
         recurse=dict(required=False, type='bool'),
         retrieve=dict(required=False, default=True),
diff --git a/lib/ansible/modules/extras/clustering/consul_session.py b/lib/ansible/modules/extras/clustering/consul_session.py
index 663456daf8..436cc282b0 100644
--- a/lib/ansible/modules/extras/clustering/consul_session.py
+++ b/lib/ansible/modules/extras/clustering/consul_session.py
@@ -88,6 +88,16 @@ options:
           - the port on which the consul agent is running
         required: false
         default: 8500
+    scheme:
+        description:
+          - the protocol scheme on which the consul agent is running
+        required: false
+        default: http
+    verify:
+        description:
+          - whether to verify the tls certificate of the consul agent
+        required: false
+        default: True
 """
 
 EXAMPLES = '''
@@ -239,6 +249,8 @@ def main():
         delay=dict(required=False,type='str', default='15s'),
         host=dict(default='localhost'),
         port=dict(default=8500, type='int'),
+        scheme=dict(required=False, default='http'),
+        verify=dict(required=False, default=True),
         id=dict(required=False),
         name=dict(required=False),
         node=dict(required=False),
