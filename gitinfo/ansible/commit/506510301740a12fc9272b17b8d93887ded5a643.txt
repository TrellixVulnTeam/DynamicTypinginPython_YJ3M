commit 506510301740a12fc9272b17b8d93887ded5a643
Author: Daniel Hokka Zakrisson <daniel@hozac.com>
Date:   Wed Nov 28 00:54:08 2012 +0100

    Skip already failed hosts
    
    Fixes #1699.

diff --git a/lib/ansible/playbook/__init__.py b/lib/ansible/playbook/__init__.py
index fe4a3711ce..019d36e91f 100644
--- a/lib/ansible/playbook/__init__.py
+++ b/lib/ansible/playbook/__init__.py
@@ -390,7 +390,8 @@ class PlayBook(object):
 
         # now with that data, handle contentional variable file imports!
 
-        all_hosts = self.inventory.list_hosts(play.hosts)
+        all_hosts = [ h for h in self.inventory.list_hosts(play.hosts)
+                    if not (h in self.stats.failures or h in self.stats.dark) ]
         play.update_vars_files(all_hosts)
 
         serialized_batch = []
