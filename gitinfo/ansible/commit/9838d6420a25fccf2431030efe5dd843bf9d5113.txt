commit 9838d6420a25fccf2431030efe5dd843bf9d5113
Author: Tobias Wolf <towolf@gmail.com>
Date:   Thu Sep 8 17:59:35 2016 +0200

    Re-fix the per-item diff output, (#17458)
    
    which got lost in recent big 'performance improvements' merge by @jimi-c.
    
    I had made a previous PR to fix this, then @bcoca had committed an
    improved fix. Now it's lost again.
    
    cf: d2b3b2c03e2934b126f5701e5f6e25821e2dbe35 (lost here)
    cf:  25e9b5788bb2c43743a06f877f34c2336d19338b (previous fix)
    
    Earlier PR #14849
    Earlier issue #14843
    
    Please note that jimi-c broke this last time as well ... seeing a
    pattern here.

diff --git a/lib/ansible/plugins/strategy/__init__.py b/lib/ansible/plugins/strategy/__init__.py
index 39ca9b9fe2..d1036d4a66 100644
--- a/lib/ansible/plugins/strategy/__init__.py
+++ b/lib/ansible/plugins/strategy/__init__.py
@@ -199,6 +199,9 @@ class StrategyBase:
                     elif task_result.is_skipped():
                         self._tqm.send_callback('v2_runner_item_on_skipped', task_result)
                     else:
+                        if 'diff' in task_result._result:
+                            if self._diff:
+                                self._tqm.send_callback('v2_on_file_diff', task_result)
                         self._tqm.send_callback('v2_runner_item_on_ok', task_result)
                     continue
 
