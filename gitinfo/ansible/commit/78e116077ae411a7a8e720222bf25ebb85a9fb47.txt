commit 78e116077ae411a7a8e720222bf25ebb85a9fb47
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Mar 8 15:43:44 2017 -0500

    readd all.add_host as for loop uses diff data

diff --git a/lib/ansible/inventory/__init__.py b/lib/ansible/inventory/__init__.py
index 591d02be3d..b001f64238 100644
--- a/lib/ansible/inventory/__init__.py
+++ b/lib/ansible/inventory/__init__.py
@@ -140,6 +140,7 @@ class Inventory(object):
                         display.warning("A duplicate localhost-like entry was found (%s). First found localhost was %s" % (h, self.localhost.name))
                     display.vvvv("Set default localhost to %s" % h)
                     self.localhost = new_host
+                all.add_host(new_host)
         elif self._loader.path_exists(host_list):
             # TODO: switch this to a plugin loader and a 'condition' per plugin on which it should be tried, restoring 'inventory pllugins'
             if self.is_directory(host_list):
