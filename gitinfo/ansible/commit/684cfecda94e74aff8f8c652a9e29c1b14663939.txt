commit 684cfecda94e74aff8f8c652a9e29c1b14663939
Author: Serge van Ginderachter <serge@vanginderachter.be>
Date:   Thu Apr 11 23:58:15 2013 +0200

    package and upgrade are not mutually exclusive, but when both were set, upgrade didn't happen

diff --git a/library/apt b/library/apt
index 69d7158815..ac4fcf316b 100644
--- a/library/apt
+++ b/library/apt
@@ -260,7 +260,7 @@ def main():
         if p['update_cache']:
             cache.update()
             cache.open(progress=None)
-            if not p['package']:
+            if not p['package'] and not p['upgrade']:
                 module.exit_json(changed=False)
 
         force_yes = p['force']
