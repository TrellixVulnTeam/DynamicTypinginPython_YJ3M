commit 48fe7ac19d22ba49508eca022d8452a46bb211fa
Author: Gilles Cornu <git@gilles.cornu.name>
Date:   Tue Jun 18 17:53:52 2013 +0200

    Enlarge scope of 'ansible_ssh_user' magic variable
    
    Allow to use ansible_ssh_user variable in `sudo_user` or `when` clauses

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index 6adf5512f7..9b204b9d57 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -378,6 +378,7 @@ class Runner(object):
         inject = utils.combine_vars(inject, host_variables)
         inject = utils.combine_vars(inject, self.module_vars)
         inject = utils.combine_vars(inject, self.setup_cache[host])
+        inject.setdefault('ansible_ssh_user', self.remote_user)
         inject['hostvars'] = HostVars(self.setup_cache, self.inventory)
         inject['group_names'] = host_variables.get('group_names', [])
         inject['groups']      = self.inventory.groups_list()
