commit bba322a10eee55d0a923f66dba8c79e8ac913304
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Fri Mar 6 14:55:11 2015 -0800

    Sort subnets by the order they are specified in the play
    
    Fixes #172

diff --git a/lib/ansible/modules/cloud/amazon/ec2_vpc.py b/lib/ansible/modules/cloud/amazon/ec2_vpc.py
index 00528f2784..a4f7c0ade4 100644
--- a/lib/ansible/modules/cloud/amazon/ec2_vpc.py
+++ b/lib/ansible/modules/cloud/amazon/ec2_vpc.py
@@ -506,6 +506,15 @@ def create_vpc(module, vpc_conn):
             'id': sn.id,
         })
 
+    # Sort subnets by the order they were listed in the play
+    order = {}
+    for idx, val in enumerate(subnets):
+        order[val['cidr']] = idx
+
+    # Number of subnets in the play
+    subnets_in_play = len(subnets)
+    returned_subnets.sort(key=lambda x: order.get(x['cidr'], subnets_in_play))
+
     return (vpc_dict, created_vpc_id, returned_subnets, changed)
 
 def terminate_vpc(module, vpc_conn, vpc_id=None, cidr=None):
