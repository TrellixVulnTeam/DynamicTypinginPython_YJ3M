commit fb87680046a1c9c4939c9debad70fde58da069b6
Author: Trishna Guha <trishnaguha17@gmail.com>
Date:   Thu Jun 1 08:57:17 2017 +0530

    fix state present nxos_evpn_vni (#25212)
    
    Signed-off-by: Trishna Guha <trishnaguha17@gmail.com>

diff --git a/lib/ansible/modules/network/nxos/nxos_evpn_vni.py b/lib/ansible/modules/network/nxos/nxos_evpn_vni.py
index f5e2f465a0..b540a46cca 100644
--- a/lib/ansible/modules/network/nxos/nxos_evpn_vni.py
+++ b/lib/ansible/modules/network/nxos/nxos_evpn_vni.py
@@ -220,9 +220,8 @@ def state_present(module, existing, proposed):
             command = '{0} {1}'.format(key, value)
             commands.append(command)
 
-    else:
-        commands = ['vni {0} l2'.format(module.params['vni'])]
-        parents = ['evpn']
+    if commands:
+        parents = ['evpn', 'vni {0} l2'.format(module.params['vni'])]
 
     return commands, parents
 
diff --git a/test/units/modules/network/nxos/test_nxos_evpn_vni.py b/test/units/modules/network/nxos/test_nxos_evpn_vni.py
index 1c587ec490..c460b733a3 100644
--- a/test/units/modules/network/nxos/test_nxos_evpn_vni.py
+++ b/test/units/modules/network/nxos/test_nxos_evpn_vni.py
@@ -50,9 +50,13 @@ class TestNxosEvpnVniModule(TestNxosModule):
         self.load_config.return_value = None
 
     def test_nxos_evpn_vni_present(self):
-        set_module_args(dict(vni='6000', state='present'))
+        set_module_args(dict(vni='6000',
+                             route_target_import='5000:10',
+                             state='present'))
         result = self.execute_module(changed=True)
-        self.assertEqual(result['commands'], ['evpn', 'vni 6000 l2'])
+        self.assertEqual(result['commands'], ['evpn',
+                                              'vni 6000 l2',
+                                              'route-target import 5000:10'])
 
     def test_nxos_evpn_vni_absent_not_existing(self):
         set_module_args(dict(vni='12000', state='absent'))
