commit a8d748220b9017c0508af95d19d054605e9a0a5c
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Sat Apr 21 11:46:32 2012 -0400

    Don't prompt for password info if the pattern wouldn't have matched any hosts.  Also convert
    Runner() usage to the new inventory model.

diff --git a/bin/ansible b/bin/ansible
index 1a227b3531..d3eafd2d36 100755
--- a/bin/ansible
+++ b/bin/ansible
@@ -29,6 +29,7 @@ import ansible.constants as C
 from ansible import utils
 from ansible import errors
 from ansible import callbacks
+from ansible import inventory
 
 ########################################################
 
@@ -69,6 +70,13 @@ class Cli(object):
         ''' use Runner lib to do SSH things '''
 
         pattern = args[0]
+
+        inventory_manager = inventory.Inventory(options.inventory)
+        hosts = inventory_manager.list_hosts(pattern)
+        if len(hosts) == 0:
+             print >>sys.stderr, "No hosts matched"
+             sys.exit(1) 
+        
         sshpass = None
         sudopass = None
         if options.ask_pass:
@@ -78,7 +86,6 @@ class Cli(object):
 
         if options.tree:
             utils.prepare_writeable_dir(options.tree)
-
         if options.seconds:
             print "background launch...\n\n"
 
@@ -86,7 +93,7 @@ class Cli(object):
             module_name=options.module_name, module_path=options.module_path,
             module_args=options.module_args,
             remote_user=options.remote_user, remote_pass=sshpass,
-            host_list=options.inventory, timeout=options.timeout, 
+            inventory=inventory_manager, timeout=options.timeout, 
             forks=options.forks, 
             background=options.seconds, pattern=pattern, 
             callbacks=self.callbacks, sudo=options.sudo, 
