commit 5671ddcdd392c86bd9724b69b11a7dcb81e6c8aa
Author: Michael Vermaes <mvermaes@gmail.com>
Date:   Thu Dec 19 00:40:44 2013 +0800

    Attempt #2 to cause yum to fail on invalid url

diff --git a/library/packaging/yum b/library/packaging/yum
index 4c930f2f77..240f071b9f 100644
--- a/library/packaging/yum
+++ b/library/packaging/yum
@@ -472,7 +472,11 @@ def install(module, items, repoq, yum_basecmd, conf_file, en_repos, dis_repos):
 
         rc, out, err = module.run_command(cmd)
 
-        if (rc != 0 and 'Nothing to do' in err) or 'Nothing to do' in out:
+        # Fail on invalid urls:
+        if '://' in spec and 'No package %s available.' % spec in out:
+            err = 'Package at %s could not be installed' % spec
+            module.fail_json(changed=False,msg=err,rc=1)
+        elif (rc != 0 and 'Nothing to do' in err) or 'Nothing to do' in out:
             # avoid failing in the 'Nothing To Do' case
             # this may happen with an URL spec.
             # for an already installed group,
