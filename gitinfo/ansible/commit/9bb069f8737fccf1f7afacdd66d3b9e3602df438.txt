commit 9bb069f8737fccf1f7afacdd66d3b9e3602df438
Author: Robin Roth <robin-roth@online.de>
Date:   Mon Apr 18 18:00:02 2016 +0200

    Apache2 module integration test (#15380)
    
    * add integration test for apache2_module
    
    * fix assert syntax
    
    * check os_family for this test
    
    * add comment why only debian and suse are tested
    
    * move apache2 test to destructive
    
    * install apache2 package

diff --git a/test/integration/destructive.yml b/test/integration/destructive.yml
index 92b6e89532..b63a315b90 100644
--- a/test/integration/destructive.yml
+++ b/test/integration/destructive.yml
@@ -21,3 +21,4 @@
     - { role: test_zypper, tags: test_zypper}
     - { role: test_zypper_repository, tags: test_zypper_repository}
     - { role: test_uri, tags: test_uri }
+    - { role: test_apache2_module, tags: test_apache2_module }
diff --git a/test/integration/roles/test_apache2_module/meta/main.yml b/test/integration/roles/test_apache2_module/meta/main.yml
new file mode 100644
index 0000000000..1050c23ce3
--- /dev/null
+++ b/test/integration/roles/test_apache2_module/meta/main.yml
@@ -0,0 +1,3 @@
+dependencies: 
+  - prepare_tests
+
diff --git a/test/integration/roles/test_apache2_module/tasks/actualtest.yml b/test/integration/roles/test_apache2_module/tasks/actualtest.yml
new file mode 100644
index 0000000000..a5f3a40a3c
--- /dev/null
+++ b/test/integration/roles/test_apache2_module/tasks/actualtest.yml
@@ -0,0 +1,61 @@
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+- name: install apache via apt
+  apt: name=apache2 state=present
+  when: "ansible_os_family == 'Debian'"
+
+- name: install apache via zypper
+  zypper: name=apache2 state=present
+  when: "ansible_os_family == 'Suse'"
+
+- name: disable alias module
+  apache2_module: name=alias state=absent
+
+- name: disable alias module, second run
+  apache2_module: name=alias state=absent
+  register: disable
+
+- name: ensure apache2_module is idempotent
+  assert:
+    that:
+      - 'not disable.changed'
+
+- name: enable alias module
+  apache2_module: name=alias state=present
+  register: enable
+
+- name: ensure changed on successful enable
+  assert:
+    that:
+      - 'enable.changed'
+
+- name: enable alias module, second run
+  apache2_module: name=alias state=present
+  register: enabletwo
+
+- name: ensure apache2_module is idempotent
+  assert:
+    that:
+      - 'not enabletwo.changed'
+
+- name: disable alias module, final run
+  apache2_module: name=alias state=absent
+  register: disablefinal
+
+- name: ensure changed on successful disable
+  assert:
+    that:
+      - 'disablefinal.changed'
diff --git a/test/integration/roles/test_apache2_module/tasks/main.yml b/test/integration/roles/test_apache2_module/tasks/main.yml
new file mode 100644
index 0000000000..590fc726e3
--- /dev/null
+++ b/test/integration/roles/test_apache2_module/tasks/main.yml
@@ -0,0 +1,6 @@
+---
+
+- name: include only on supported systems
+  include: actualtest.yml
+  when: ansible_os_family in ['Debian', 'Suse']
+  # centos/RHEL does not have a2enmod/a2dismod
