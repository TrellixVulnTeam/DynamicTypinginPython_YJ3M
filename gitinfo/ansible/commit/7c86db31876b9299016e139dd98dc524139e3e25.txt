commit 7c86db31876b9299016e139dd98dc524139e3e25
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Mon Feb 9 15:37:35 2015 -0800

    Add KSH compat
    
    cherry picked from https://github.com/ansible/ansible/pull/6899

diff --git a/hacking/env-setup b/hacking/env-setup
index 10adad5099..9b9a529d13 100644
--- a/hacking/env-setup
+++ b/hacking/env-setup
@@ -16,6 +16,8 @@ if [ -n "$BASH_SOURCE" ] ; then
     HACKING_DIR=$(dirname "$BASH_SOURCE")
 elif [ $(basename -- "$0") = "env-setup" ]; then
     HACKING_DIR=$(dirname "$0")
+elif [ -n "$KSH_VERSION" ]; then
+    HACKING_DIR=$(dirname "${.sh.file}")
 else
     HACKING_DIR="$PWD/hacking"
 fi
diff --git a/v2/hacking/env-setup b/v2/hacking/env-setup
index c573a56878..fed8e892fd 100644
--- a/v2/hacking/env-setup
+++ b/v2/hacking/env-setup
@@ -14,8 +14,10 @@ fi
 # When run using source as directed, $0 gets set to bash, so we must use $BASH_SOURCE
 if [ -n "$BASH_SOURCE" ] ; then
     HACKING_DIR=$(dirname "$BASH_SOURCE")
-elif [ $(basename "$0") = "env-setup" ]; then
+elif [ $(basename -- "$0") = "env-setup" ]; then
     HACKING_DIR=$(dirname "$0")
+elif [ -n "$KSH_VERSION" ]; then
+    HACKING_DIR=$(dirname "${.sh.file}")
 else
     HACKING_DIR="$PWD/hacking"
 fi
