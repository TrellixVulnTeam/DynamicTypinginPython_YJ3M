commit 7e3c92e909d60fd02c1ffd933f7594e52ae2cd5a
Author: Brian Coca <bcoca@ansible.com>
Date:   Thu Mar 10 15:06:47 2016 -0500

    predictable docker names and autoremove if no fail

diff --git a/test/utils/run_tests.sh b/test/utils/run_tests.sh
index 1bea359b54..a7b7d10ad2 100755
--- a/test/utils/run_tests.sh
+++ b/test/utils/run_tests.sh
@@ -1,6 +1,6 @@
 #!/bin/sh -xe
 
-if [ "${TARGET}" = "sanity" ]; then
+if [ "${TARGET}" == "sanity" ]; then
     ./test/code-smell/replace-urlopen.sh .
     ./test/code-smell/use-compat-six.sh lib
     ./test/code-smell/boilerplate.sh
@@ -8,8 +8,13 @@ if [ "${TARGET}" = "sanity" ]; then
     if test x"$TOXENV" != x'py24' ; then tox ; fi
     if test x"$TOXENV" = x'py24' ; then python2.4 -V && python2.4 -m compileall -fq -x 'module_utils/(a10|rax|openstack|ec2|gce).py' lib/ansible/module_utils ; fi
 else
+    export C_NAME="testAbull_$$_$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 8 | head -n 1)"
     docker build -t ansible_test/${TARGET} test/utils/docker/${TARGET}
-    docker run -d --volume="${PWD}:/root/ansible" ${TARGET_OPTIONS} ansible_test/${TARGET} > /tmp/cid_${TARGET}
+    docker run -d --volume="${PWD}:/root/ansible"  --name "${C_NAME}" ${TARGET_OPTIONS} ansible_test/${TARGET} > /tmp/cid_${TARGET}
     docker exec -ti $(cat /tmp/cid_${TARGET}) /bin/sh -c "export TEST_FLAGS='${TEST_FLAGS}'; cd /root/ansible; . hacking/env-setup; (cd test/integration; LC_ALL=en_US.utf-8 make)"
     docker kill $(cat /tmp/cid_${TARGET})
+
+    if [ "X${TESTS_KEEP_CONTAINER}" == "X" ]; then
+        docker rm "${C_NAME}"
+    fi
 fi
