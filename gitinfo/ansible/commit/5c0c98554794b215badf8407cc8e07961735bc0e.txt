commit 5c0c98554794b215badf8407cc8e07961735bc0e
Author: R. Soto <roberto@numerica.cl>
Date:   Mon Jul 3 17:34:58 2017 -0600

    update auth_flag variable after STARTTLS connection is established, fixes #26376

diff --git a/lib/ansible/modules/notification/mail.py b/lib/ansible/modules/notification/mail.py
index 7c7d5f2e5b..862e61ccef 100644
--- a/lib/ansible/modules/notification/mail.py
+++ b/lib/ansible/modules/notification/mail.py
@@ -312,6 +312,7 @@ def main():
                 try:
                     smtp.starttls()
                     smtp.ehlo()
+                    auth_flag = smtp.has_extn('AUTH')
                     secure_state = True
                 except smtplib.SMTPException:
                     e = get_exception()
