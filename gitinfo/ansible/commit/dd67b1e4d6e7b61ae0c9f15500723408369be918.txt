commit dd67b1e4d6e7b61ae0c9f15500723408369be918
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Aug 12 17:15:52 2015 -0400

    Adjust relative include searches when roles are involved
    
    Fixes #11895

diff --git a/lib/ansible/playbook/included_file.py b/lib/ansible/playbook/included_file.py
index c1b68effc4..e4a1b85aa0 100644
--- a/lib/ansible/playbook/included_file.py
+++ b/lib/ansible/playbook/included_file.py
@@ -64,19 +64,24 @@ class IncludedFile:
 
                     original_task = iterator.get_original_task(res._host, res._task)
                     if original_task:
-                        if original_task._role:
-                            include_file = loader.path_dwim_relative(original_task._role._role_path, 'tasks', include_result['include'])
-                        elif original_task._task_include:
+                        if original_task._task_include:
                             # handle relative includes by walking up the list of parent include
                             # tasks and checking the relative result to see if it exists
                             parent_include = original_task._task_include
                             while parent_include is not None:
                                 parent_include_dir = os.path.dirname(parent_include.args.get('_raw_params'))
-                                include_file = loader.path_dwim_relative(loader.get_basedir(), parent_include_dir, include_result['include'])
+                                if original_task._role:
+                                    new_basedir = os.path.join(original_task._role._role_path, 'tasks', parent_include_dir)
+                                    include_file = loader.path_dwim_relative(new_basedir, 'tasks', include_result['include'])
+                                else:
+                                    include_file = loader.path_dwim_relative(loader.get_basedir(), parent_include_dir, include_result['include'])
+
                                 if os.path.exists(include_file):
                                     break
                                 else:
                                     parent_include = parent_include._task_include
+                        elif original_task._role:
+                            include_file = loader.path_dwim_relative(original_task._role._role_path, 'tasks', include_result['include'])
                         else:
                             include_file = loader.path_dwim(res._task.args.get('_raw_params'))
                     else:
