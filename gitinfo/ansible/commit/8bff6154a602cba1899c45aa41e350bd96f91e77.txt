commit 8bff6154a602cba1899c45aa41e350bd96f91e77
Author: Martin Matuska <martin.matuska@axelspringer.de>
Date:   Tue Jul 5 11:55:13 2016 +0200

    Determine failed hosts with _check_failed_state() (#16566)

diff --git a/lib/ansible/executor/play_iterator.py b/lib/ansible/executor/play_iterator.py
index 4ccc709e66..4613d75fb6 100644
--- a/lib/ansible/executor/play_iterator.py
+++ b/lib/ansible/executor/play_iterator.py
@@ -469,7 +469,7 @@ class PlayIterator:
         self._host_states[host.name] = s
 
     def get_failed_hosts(self):
-        return dict((host, True) for (host, state) in iteritems(self._host_states) if state.run_state == self.ITERATING_COMPLETE and state.fail_state != self.FAILED_NONE)
+        return dict((host, True) for (host, state) in iteritems(self._host_states) if self._check_failed_state(state))
 
     def _check_failed_state(self, state):
         if state is None:
