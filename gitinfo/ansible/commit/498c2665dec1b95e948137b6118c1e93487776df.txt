commit 498c2665dec1b95e948137b6118c1e93487776df
Author: Yap Sok Ann <sokann@gmail.com>
Date:   Tue Sep 10 11:22:06 2013 +0800

    Locate easy_install path after (optionally) creating virtualenv.
    
    Without this, the first call to the easy_install module with a new virtualenv
    will only create the virtualenv without installing the intended package, since
    the `_is_package_installed` check will succeed as running /usr/bin/easy_install
    as non-root user will return permission denied error with empty stdout.

diff --git a/library/packaging/easy_install b/library/packaging/easy_install
index a18b2f7d70..4110ce154a 100644
--- a/library/packaging/easy_install
+++ b/library/packaging/easy_install
@@ -94,7 +94,6 @@ def main():
 
     name = module.params['name']
     env = module.params['virtualenv']
-    easy_install = module.get_bin_path('easy_install', True, ['%s/bin' % env])
     site_packages = module.params['virtualenv_site_packages']
     virtualenv_command = module.params['virtualenv_command']
 
@@ -117,6 +116,8 @@ def main():
             out += out_venv
             err += err_venv
 
+    easy_install = module.get_bin_path('easy_install', True, ['%s/bin' % env])
+
     cmd = None
     changed = False
     installed = _is_package_installed(module, name, easy_install)
