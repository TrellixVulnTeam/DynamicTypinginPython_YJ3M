commit 9b7d782abbfd10cd7a147b9396e3129e3ed5f2d4
Author: graywulf <graywulf0@gmail.com>
Date:   Thu Jun 30 16:39:30 2016 -0700

    Ignore broken pipe errors if the sshpass process has exited (#16515)
    
    This fix prevents a broken pipe exception from occurring when password-less
    SSH is configured and the sshpass process exits and closes the pipe before
    the password is written to the pipe.

diff --git a/lib/ansible/plugins/connection/ssh.py b/lib/ansible/plugins/connection/ssh.py
index 16f086b303..3add4c1a83 100644
--- a/lib/ansible/plugins/connection/ssh.py
+++ b/lib/ansible/plugins/connection/ssh.py
@@ -19,6 +19,7 @@
 from __future__ import (absolute_import, division, print_function)
 __metaclass__ = type
 
+import errno
 import fcntl
 import os
 import pipes
@@ -346,7 +347,12 @@ class Connection(ConnectionBase):
 
         if self._play_context.password:
             os.close(self.sshpass_pipe[0])
-            os.write(self.sshpass_pipe[1], "{0}\n".format(to_bytes(self._play_context.password)))
+            try:
+                os.write(self.sshpass_pipe[1], "{0}\n".format(to_bytes(self._play_context.password)))
+            except OSError as e:
+                # Ignore broken pipe errors if the sshpass process has exited.
+                if e.errno != errno.EPIPE or p.poll() is None:
+                    raise
             os.close(self.sshpass_pipe[1])
 
         ## SSH state machine
