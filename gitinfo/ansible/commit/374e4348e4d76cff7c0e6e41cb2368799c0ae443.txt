commit 374e4348e4d76cff7c0e6e41cb2368799c0ae443
Author: Matt Clay <matt@mystile.com>
Date:   Wed Oct 12 22:22:46 2016 -0700

    Split out var_blending test into targets dir. (#17996)

diff --git a/test/integration/Makefile b/test/integration/Makefile
index ac75f2f6d1..207a20f4d4 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -27,7 +27,7 @@ UNAME := $(shell uname | tr '[:upper:]' '[:lower:]')
 
 all: other non_destructive destructive
 
-other: test_test_infra parsing test_var_precedence unicode test_templating_settings environment test_as includes blocks pull_run pull_no_127 pull_limit_inventory check_mode test_hash test_handlers test_group_by test_vault test_tags test_lookup_paths no_log test_gathering_facts test_binary_modules_posix test_hosts_field test_lookup_properties args
+other: test_test_infra parsing test_var_blending test_var_precedence unicode test_templating_settings environment test_as includes blocks pull_run pull_no_127 pull_limit_inventory check_mode test_hash test_handlers test_group_by test_vault test_tags test_lookup_paths no_log test_gathering_facts test_binary_modules_posix test_hosts_field test_lookup_properties args
 
 test_test_infra:
 	(cd targets/test_infra && ./runme.sh $(TEST_FLAGS))
@@ -149,6 +149,9 @@ test_handlers:
 test_hash:
 	(cd targets/hash && ./runme.sh $(TEST_FLAGS))
 
+test_var_blending:
+	(cd targets/var_blending && ./runme.sh $(TEST_FLAGS))
+
 test_var_precedence:
 	(cd targets/var_precedence && ./runme.sh $(TEST_FLAGS))
 
diff --git a/test/integration/integration_config.yml b/test/integration/integration_config.yml
index 34a7cbf73d..b8e1bbe430 100644
--- a/test/integration/integration_config.yml
+++ b/test/integration/integration_config.yml
@@ -4,7 +4,3 @@ output_dir: ~/ansible_testing
 non_root_test_user: ansible
 pip_test_package: epdb
 
-# variables used in precedence tests, here passed to -e
-etest: 'from -e'
-
-
diff --git a/test/integration/non_destructive.yml b/test/integration/non_destructive.yml
index 292f384269..11caccbf90 100644
--- a/test/integration/non_destructive.yml
+++ b/test/integration/non_destructive.yml
@@ -1,17 +1,7 @@
 - hosts: testhost
-
-  # these variables are defined here for variable blending tests only.
-  # in general, define test variables in the role/rolenamevars/main.yml
-
-  vars_files:
-    - vars_file.yml
-  vars:
-    vars_var: 123
-
   gather_facts: True
   roles: 
     - { role: test_ping, tags: test_ping }
-    - { role: test_var_blending, parameterized_beats_default: 1234, tags: test_var_blending }
     - { role: test_special_vars, tags: test_special_vars }
     - { role: test_ignore_errors, tags: test_ignore_errors }
     - { role: test_conditionals, tags: test_conditionals }
diff --git a/test/integration/roles/test_conditionals/vars/main.yml b/test/integration/roles/test_conditionals/vars/main.yml
index a6ecf62f53..a02b87168e 100644
--- a/test/integration/roles/test_conditionals/vars/main.yml
+++ b/test/integration/roles/test_conditionals/vars/main.yml
@@ -11,3 +11,7 @@ cond_list_of_items:
   - b
   - c
 
+things1:
+    - 1
+    - 2
+vars_file_var: 321
diff --git a/test/integration/roles/test_lookups/vars/main.yml b/test/integration/roles/test_lookups/vars/main.yml
index 5338487676..4c44b1cb86 100644
--- a/test/integration/roles/test_lookups/vars/main.yml
+++ b/test/integration/roles/test_lookups/vars/main.yml
@@ -1,3 +1,9 @@
 mydict:
     mykey1: myval1
     mykey2: myval2
+things1:
+    - 1
+    - 2
+things2:
+    - "{{ foo }}"
+    - "{{ foob | default('') }}"
diff --git a/test/integration/roles/test_var_blending/meta/main.yml b/test/integration/roles/test_var_blending/meta/main.yml
deleted file mode 100644
index 1050c23ce3..0000000000
--- a/test/integration/roles/test_var_blending/meta/main.yml
+++ /dev/null
@@ -1,3 +0,0 @@
-dependencies: 
-  - prepare_tests
-
diff --git a/test/integration/targets/var_blending/integration_config.yml b/test/integration/targets/var_blending/integration_config.yml
new file mode 100644
index 0000000000..0686934a9a
--- /dev/null
+++ b/test/integration/targets/var_blending/integration_config.yml
@@ -0,0 +1,2 @@
+output_dir: .
+etest: 'from -e'
diff --git a/test/integration/roles/test_var_blending/defaults/main.yml b/test/integration/targets/var_blending/roles/test_var_blending/defaults/main.yml
similarity index 100%
rename from test/integration/roles/test_var_blending/defaults/main.yml
rename to test/integration/targets/var_blending/roles/test_var_blending/defaults/main.yml
diff --git a/test/integration/roles/test_var_blending/files/foo.txt b/test/integration/targets/var_blending/roles/test_var_blending/files/foo.txt
similarity index 100%
rename from test/integration/roles/test_var_blending/files/foo.txt
rename to test/integration/targets/var_blending/roles/test_var_blending/files/foo.txt
diff --git a/test/integration/roles/test_var_blending/tasks/main.yml b/test/integration/targets/var_blending/roles/test_var_blending/tasks/main.yml
similarity index 90%
rename from test/integration/roles/test_var_blending/tasks/main.yml
rename to test/integration/targets/var_blending/roles/test_var_blending/tasks/main.yml
index fb2808964d..e18c480a75 100644
--- a/test/integration/roles/test_var_blending/tasks/main.yml
+++ b/test/integration/targets/var_blending/roles/test_var_blending/tasks/main.yml
@@ -46,3 +46,9 @@
     that:
       - var_undefined.undefined_variable == 'VARIABLE IS NOT DEFINED!'
       - same_value_as_var_name.same_value_as_var_name_var == 'same_value_as_var_name_var'
+
+- name: cleanup temporary template output
+  file: path={{output_dir}}/foo.templated state=absent
+
+- name: cleanup temporary copy
+  file: path={{output_dir}}/foo.txt state=absent
diff --git a/test/integration/roles/test_var_blending/templates/foo.j2 b/test/integration/targets/var_blending/roles/test_var_blending/templates/foo.j2
similarity index 100%
rename from test/integration/roles/test_var_blending/templates/foo.j2
rename to test/integration/targets/var_blending/roles/test_var_blending/templates/foo.j2
diff --git a/test/integration/roles/test_var_blending/vars/main.yml b/test/integration/targets/var_blending/roles/test_var_blending/vars/main.yml
similarity index 100%
rename from test/integration/roles/test_var_blending/vars/main.yml
rename to test/integration/targets/var_blending/roles/test_var_blending/vars/main.yml
diff --git a/test/integration/roles/test_var_blending/vars/more_vars.yml b/test/integration/targets/var_blending/roles/test_var_blending/vars/more_vars.yml
similarity index 100%
rename from test/integration/roles/test_var_blending/vars/more_vars.yml
rename to test/integration/targets/var_blending/roles/test_var_blending/vars/more_vars.yml
diff --git a/test/integration/targets/var_blending/runme.sh b/test/integration/targets/var_blending/runme.sh
new file mode 100755
index 0000000000..8f09e3e919
--- /dev/null
+++ b/test/integration/targets/var_blending/runme.sh
@@ -0,0 +1,5 @@
+#!/usr/bin/env bash
+
+set -eux
+
+ansible-playbook test_var_blending.yml -i ../../inventory -e @integration_config.yml -v "$@"
diff --git a/test/integration/targets/var_blending/test_var_blending.yml b/test/integration/targets/var_blending/test_var_blending.yml
new file mode 100644
index 0000000000..88a35b2c2c
--- /dev/null
+++ b/test/integration/targets/var_blending/test_var_blending.yml
@@ -0,0 +1,8 @@
+- hosts: testhost
+  vars_files:
+    - vars_file.yml
+  vars:
+    vars_var: 123
+  gather_facts: True
+  roles:
+    - { role: test_var_blending, parameterized_beats_default: 1234, tags: test_var_blending }
diff --git a/test/integration/vars_file.yml b/test/integration/targets/var_blending/vars_file.yml
similarity index 100%
rename from test/integration/vars_file.yml
rename to test/integration/targets/var_blending/vars_file.yml
