commit 9173a7727cc60c7679fa42e7e02a46f37094c38b
Author: Ricardo Carrillo Cruz <ricardo.carrillo.cruz@gmail.com>
Date:   Fri Mar 10 15:32:24 2017 +0100

    Fix issue on nxos modules when transport is passed via provider (#22488)
    
    The nxos modules read the task level transport variable, thus if
    the user pass it via provider the all fail with an UnboundLocalError.
    
    Fixes #22355

diff --git a/lib/ansible/plugins/action/nxos.py b/lib/ansible/plugins/action/nxos.py
index 5660699c3a..538a9108e3 100644
--- a/lib/ansible/plugins/action/nxos.py
+++ b/lib/ansible/plugins/action/nxos.py
@@ -99,10 +99,7 @@ class ActionModule(_ActionModule):
             self._task.args['provider'] = provider_arg
 
         # make sure a transport value is set in args
-        transport = self._task.args.get('transport')
-        provider_transport = (self._task.args.get('provider') or {}).get('transport')
-        if all((transport is None, provider_transport is None)):
-            self._task.args['transport'] = 'cli'
+        self._task.args['transport'] = transport
 
         return super(ActionModule, self).run(tmp, task_vars)
 
