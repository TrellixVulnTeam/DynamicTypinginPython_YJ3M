commit 98f93fcc079e4b47e42e98b749e79c0b80da24b6
Author: Jeroen Hoekx <jeroen.hoekx@hamok.be>
Date:   Wed May 9 10:31:32 2012 +0200

    Preserve trailing newline after templating.
    
    Jinja seems to eat trailing whitespace. A lot of tools complain about this: iptables-restore, iscsid...

diff --git a/lib/ansible/utils.py b/lib/ansible/utils.py
index 1b3b355c43..92c7aea7c1 100644
--- a/lib/ansible/utils.py
+++ b/lib/ansible/utils.py
@@ -241,7 +241,10 @@ def template(text, vars, setup_cache, no_engine=False):
         return text
     else:
         template = jinja2.Template(text)
-        return template.render(vars)
+        res = template.render(vars)
+        if text.endswith('\n') and not res.endswith('\n'):
+            res = res + '\n'
+        return res
 
 def double_template(text, vars, setup_cache):
     return template(template(text, vars, setup_cache), vars, setup_cache)
