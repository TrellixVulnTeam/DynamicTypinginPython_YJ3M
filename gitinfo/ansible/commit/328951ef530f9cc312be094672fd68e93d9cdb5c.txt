commit 328951ef530f9cc312be094672fd68e93d9cdb5c
Author: Stephen Fromm <sfromm@gmail.com>
Date:   Tue Oct 23 23:34:53 2012 -0700

    Checkout branch before rebase in switch_version

diff --git a/library/git b/library/git
index fe354b45bf..dbc0cf5857 100755
--- a/library/git
+++ b/library/git
@@ -182,6 +182,10 @@ def switch_version(module, dest, remote, version):
             cmd = "git checkout --force %s" % version
     else:
         # is there a better way to do this?
+        branch = get_head_branch(module, dest, remote)
+        (rc, out, err) = _run("git checkout --force %s" % branch)
+        if rc != 0:
+            module.fail_json(msg="Failed to checkout branch %s" % branch)
         cmd = "git rebase %s" % remote
     return _run(cmd)
 
