commit 0b15ad00c141479ac3c2a0d40721939041ef3a7f
Author: James Tanner <tanner.jc@gmail.com>
Date:   Sun Oct 14 20:51:25 2018 -0400

    Add a test target for the foreman inventory script (#46837)
    
    Add a test target for the foreman inventory script

diff --git a/test/integration/targets/inventory_foreman_script/aliases b/test/integration/targets/inventory_foreman_script/aliases
new file mode 100644
index 0000000000..64483bbb69
--- /dev/null
+++ b/test/integration/targets/inventory_foreman_script/aliases
@@ -0,0 +1,2 @@
+shippable/cloud/group1
+cloud/foreman
diff --git a/test/integration/targets/inventory_foreman_script/foreman.sh b/test/integration/targets/inventory_foreman_script/foreman.sh
new file mode 100755
index 0000000000..70d7a99811
--- /dev/null
+++ b/test/integration/targets/inventory_foreman_script/foreman.sh
@@ -0,0 +1,10 @@
+#!/bin/bash
+# Wrapper to use the correct Python interpreter and support code coverage.
+
+REL_SCRIPT="../../../../contrib/inventory/foreman.py"
+ABS_SCRIPT="$("${ANSIBLE_TEST_PYTHON_INTERPRETER}" -c "import os; print(os.path.abspath('${REL_SCRIPT}'))")"
+
+# Make sure output written to current directory ends up in the temp dir.
+cd "${OUTPUT_DIR}"
+
+python.py "${ABS_SCRIPT}" "$@"
diff --git a/test/integration/targets/inventory_foreman_script/runme.sh b/test/integration/targets/inventory_foreman_script/runme.sh
new file mode 100755
index 0000000000..86298f872c
--- /dev/null
+++ b/test/integration/targets/inventory_foreman_script/runme.sh
@@ -0,0 +1,18 @@
+#!/usr/bin/env bash
+
+set -euo pipefail
+
+export FOREMAN_HOST="${FOREMAN_HOST:-localhost}"
+export FOREMAN_PORT="${FOREMAN_PORT:-8080}"
+export FOREMAN_INI_PATH="${OUTPUT_DIR}/foreman.ini"
+
+cat > "$FOREMAN_INI_PATH" <<FOREMAN_INI
+[foreman]
+url = http://${FOREMAN_HOST}:${FOREMAN_PORT}
+user = ansible-tester
+password = secure
+ssl_verify = False
+FOREMAN_INI
+
+# use ansible to validate the return data
+ansible-playbook -i foreman.sh test_foreman_inventory.yml --connection=local
diff --git a/test/integration/targets/inventory_foreman_script/test_foreman_inventory.yml b/test/integration/targets/inventory_foreman_script/test_foreman_inventory.yml
new file mode 100644
index 0000000000..3b563c7656
--- /dev/null
+++ b/test/integration/targets/inventory_foreman_script/test_foreman_inventory.yml
@@ -0,0 +1,7 @@
+- name: check the foreman inventory script result size and attributes
+  hosts: localhost
+  gather_facts: False
+  tasks:
+    - assert:
+        that:
+            - "{{ groups['all']|length > 900 }}"
diff --git a/test/runner/lib/cloud/foreman.py b/test/runner/lib/cloud/foreman.py
index ca05bbadfc..892fe84af0 100644
--- a/test/runner/lib/cloud/foreman.py
+++ b/test/runner/lib/cloud/foreman.py
@@ -31,7 +31,7 @@ class ForemanProvider(CloudProvider):
 
     DOCKER_SIMULATOR_NAME = 'foreman-stub'
 
-    DOCKER_IMAGE = 'quay.io/ansible/foreman-test-container:1.3.1'
+    DOCKER_IMAGE = 'quay.io/ansible/foreman-test-container:1.4.0'
     """Default image to run Foreman stub from.
 
     The simulator must be pinned to a specific version
