commit e460a219cdbba721d80003f43e8b55587f6771e0
Author: Gon√©ri Le Bouder <goneri@lebouder.net>
Date:   Sat Jun 1 22:46:06 2019 -0400

    VMware: vmware_evc_mode: fix the functional tests (#56875)
    
    
    * Updated vmware_evc_mode tests
    * Remove extraneous line in main.yml
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/test/integration/targets/vmware_evc_mode/tasks/main.yml b/test/integration/targets/vmware_evc_mode/tasks/main.yml
index 28c79b9c45..111e61ec8d 100644
--- a/test/integration/targets/vmware_evc_mode/tasks/main.yml
+++ b/test/integration/targets/vmware_evc_mode/tasks/main.yml
@@ -4,22 +4,49 @@
 
 - when: vcsim is not defined
   block:
-  - name: Enable EVC mode on vCenter Cluster
-    vmware_evc_mode: &vmware_evc_data
+  - import_role:
+      name: prepare_vmware_tests
+    vars:
+      setup_datacenter: true
+
+  - name: add cluster
+    vmware_cluster:
+      validate_certs: False
+      hostname: "{{ vcenter_hostname }}"
+      username: "{{ vcenter_username }}"
+      password: "{{ vcenter_password }}"
+      datacenter_name: "{{ dc1 }}"
+      cluster_name: test_cluster_0001
+      state: present
+
+  - &evc_enable_data
+    name: Enable EVC mode on vCenter Cluster
+    vmware_evc_mode:
       hostname: "{{ vcenter_hostname }}"
       username: "{{ vcenter_username }}"
       password: "{{ vcenter_password }}"
       validate_certs: no
+      datacenter_name: "{{ dc1 }}"
+      cluster_name: test_cluster_0001
       evc_mode: intel-broadwell
       state: present
-      check_mode: yes
 
-  - name: Enable EVC mode on vCenter Cluster
-    vmware_evc_mode:
-      <<: *vmware_evc_data
-  
-  - name: Disable EVC mode on vCenter Cluster
+  - <<: *evc_enable_data
+    name: Enable EVC mode on vCenter cluster in check mode
+    check_mode: yes
+
+  - &evc_disable_data
+    name: Disable EVC mode on vCenter Cluster
     vmware_evc_mode:
-      <<: *vmware_evc_data
+      hostname: "{{ vcenter_hostname }}"
+      username: "{{ vcenter_username }}"
+      password: "{{ vcenter_password }}"
+      validate_certs: no
+      datacenter_name: "{{ dc1 }}"
+      cluster_name: test_cluster_0001
+      evc_mode: intel-broadwell
       state: absent
-      check_mode: yes
+
+  - <<: *evc_disable_data
+    name: Disable EVC mode on vCenter Cluster in check mode
+    check_mode: yes
