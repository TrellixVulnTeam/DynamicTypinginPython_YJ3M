commit 91150423f41c063fbce8382bc15ef8e122d7e8cf
Author: Brian Coca <bcoca@users.noreply.github.com>
Date:   Wed Nov 21 11:51:40 2018 -0500

    ignore netapp tests when no libs (#48941)
    
    * ignore tests when no libs

diff --git a/test/units/modules/storage/netapp/test_netapp.py b/test/units/modules/storage/netapp/test_netapp.py
index 5adabc6ac3..028027bae5 100644
--- a/test/units/modules/storage/netapp/test_netapp.py
+++ b/test/units/modules/storage/netapp/test_netapp.py
@@ -4,13 +4,14 @@
 ''' unit tests for module_utils netapp.py '''
 from __future__ import absolute_import, division, print_function
 
+import pytest
+
 from ansible.module_utils.ansible_release import __version__ as ansible_version
 
-import pytest
 import ansible.module_utils.netapp as netapp_utils
 
-HAS_NETAPP_LIB = netapp_utils.has_netapp_lib()
-HAS_NETAPP_LIB_MSG = "pip install netapp_lib is required"
+if not netapp_utils.has_netapp_lib():
+    pytestmark = pytest.mark.skip("skipping as missing required netapp_lib")
 
 
 class MockONTAPConnection(object):
@@ -42,14 +43,6 @@ class MockONTAPConnection(object):
         return xml
 
 
-@pytest.fixture
-def has_zapi():
-    assert HAS_NETAPP_LIB, HAS_NETAPP_LIB_MSG
-
-
-pytestmark = pytest.mark.usefixtures("has_zapi")
-
-
 def test_ems_log_event_version():
     ''' validate Ansible version is correctly read '''
     source = 'unittest'
