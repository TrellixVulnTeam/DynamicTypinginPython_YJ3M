commit c7e841e0e4b4db9a5c0e0bab685b825196bbf36d
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Jul 19 20:23:13 2017 -0400

    better reading of 'facts'

diff --git a/lib/ansible/plugins/action/package.py b/lib/ansible/plugins/action/package.py
index ab4f2d5056..4a20378497 100644
--- a/lib/ansible/plugins/action/package.py
+++ b/lib/ansible/plugins/action/package.py
@@ -52,8 +52,7 @@ class ActionModule(ActionBase):
         if module == 'auto':
             facts = self._execute_module(module_name='setup', module_args=dict(filter='ansible_pkg_mgr', gather_subset='!all'), task_vars=task_vars)
             display.debug("Facts %s" % facts)
-            if 'ansible_facts' in facts and 'ansible_pkg_mgr' in facts['ansible_facts']:
-                module = getattr(facts['ansible_facts'], 'ansible_pkg_mgr', 'auto')
+            module = facts.get('ansible_facts', {}).get('ansible_pkg_mgr', 'auto')
 
         if module != 'auto':
 
diff --git a/lib/ansible/plugins/action/service.py b/lib/ansible/plugins/action/service.py
index 6af9034e2e..d18c3fc4eb 100644
--- a/lib/ansible/plugins/action/service.py
+++ b/lib/ansible/plugins/action/service.py
@@ -51,8 +51,7 @@ class ActionModule(ActionBase):
         if module == 'auto':
             facts = self._execute_module(module_name='setup', module_args=dict(gather_subset='!all', filter='ansible_service_mgr'), task_vars=task_vars)
             self._display.debug("Facts %s" % facts)
-            if 'ansible_facts' in facts and 'ansible_service_mgr' in facts['ansible_facts']:
-                module = facts['ansible_facts']['ansible_service_mgr']
+            module = facts.get('ansible_facts', {}).get('ansible_service_mgr', 'auto')
 
         if not module or module == 'auto' or module not in self._shared_loader_obj.module_loader:
             module = 'service'
