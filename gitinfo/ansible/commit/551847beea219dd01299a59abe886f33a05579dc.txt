commit 551847beea219dd01299a59abe886f33a05579dc
Author: Nathaniel Case <this.is@nathanielca.se>
Date:   Thu Dec 7 17:01:28 2017 -0500

    Fix issues with net_user tests on eos (#33691)
    
    * Fix net_user/eos and also the horribly broken cleanup there
    
    * The rest of net_user/eos has the same problem

diff --git a/test/integration/targets/net_user/tests/eos/userprivilege.yaml b/test/integration/targets/net_user/tests/eos/userprivilege.yaml
index 07918554e4..36ad907eeb 100644
--- a/test/integration/targets/net_user/tests/eos/userprivilege.yaml
+++ b/test/integration/targets/net_user/tests/eos/userprivilege.yaml
@@ -1,4 +1,11 @@
 ---
+- name: Setup
+  net_user: &clear_netop
+    name: netop
+    state: absent
+    authorize: yes
+    provider: "{{ cli }}"
+
 - name: Set user to privilege level 15
   net_user:
     name: netop
@@ -12,9 +19,7 @@
 - assert:
     that:
       - 'result.changed == true'
-      - 'result.commands == ["username netop privilege 15"]'
+      - 'result.commands == ["username netop privilege 15", "username netop nopassword"]'
 
 - name: tearDown
-  net_user:
-    purge: yes
-    provider: "{{ cli }}"
+  net_user: *clear_netop
diff --git a/test/integration/targets/net_user/tests/eos/userrole.yaml b/test/integration/targets/net_user/tests/eos/userrole.yaml
index af12816ab3..c6bbcc8dac 100644
--- a/test/integration/targets/net_user/tests/eos/userrole.yaml
+++ b/test/integration/targets/net_user/tests/eos/userrole.yaml
@@ -1,9 +1,19 @@
 ---
+- name: Setup
+  net_user: &clear_users
+    aggregate:
+      - name: netop
+      - name: netend
+    state: absent
+    authorize: yes
+    provider: "{{ cli }}"
+
 - name: Set multiple users role
   net_user:
     aggregate:
       - name: netop
       - name: netend
+    nopassword: yes
     role: network-operator
     state: present
     authorize: yes
@@ -13,10 +23,7 @@
 - assert:
     that:
       - 'result.changed == true'
-      - 'result.commands == ["username netop role network-operator", "username netend role network-operator"]'
+      - 'result.commands == ["username netop role network-operator", "username netop nopassword", "username netend role network-operator", "username netend nopassword"]'
 
 - name: tearDown
-  net_user:
-    purge: yes
-    authorize: yes
-    provider: "{{ cli }}"
+  net_user: *clear_users
diff --git a/test/integration/targets/net_user/tests/eos/users.yaml b/test/integration/targets/net_user/tests/eos/users.yaml
index 2719173d9e..e179568768 100644
--- a/test/integration/targets/net_user/tests/eos/users.yaml
+++ b/test/integration/targets/net_user/tests/eos/users.yaml
@@ -1,20 +1,27 @@
 ---
+- name: Setup
+  net_user: &clear_netop
+    name: netop
+    state: absent
+    authorize: yes
+    provider: "{{ cli }}"
+
 - name: Create user
   net_user:
     name: netop
+    nopassword: yes
     state: present
+    authorize: yes
     provider: "{{ cli }}"
   register: result
 
 - assert:
     that:
       - 'result.changed == true'
-      - 'result.commands == ["username netop"]'
+      - 'result.commands == ["username netop nopassword"]'
 
-- name: Purge users
-  net_user:
-    purge: yes
-    provider: "{{ cli }}"
+- name: tearDown
+  net_user: *clear_netop
   register: result
 
 - assert:
