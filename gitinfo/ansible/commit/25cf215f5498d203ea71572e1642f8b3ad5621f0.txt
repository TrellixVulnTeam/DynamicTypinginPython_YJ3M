commit 25cf215f5498d203ea71572e1642f8b3ad5621f0
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Mar 5 22:06:59 2014 -0600

    Create the tempdir in the accelerate module if it doesn't exist
    
    Fixes #6047

diff --git a/library/utilities/accelerate b/library/utilities/accelerate
index a6e84e3237..6508f1433e 100644
--- a/library/utilities/accelerate
+++ b/library/utilities/accelerate
@@ -391,7 +391,13 @@ class ThreadedTCPRequestHandler(SocketServer.BaseRequestHandler):
         final_path = None
         if 'user' in data and data.get('user') != getpass.getuser():
             vv("the target user doesn't match this user, we'll move the file into place via sudo")
-            (fd,out_path) = tempfile.mkstemp(prefix='ansible.', dir=os.path.expanduser('~/.ansible/tmp/'))
+            tmp_path = os.path.expanduser('~/.ansible/tmp/')
+            if not os.path.exists(tmp_path):
+                try:
+                    os.makedirs(tmp_path, 0700)
+                except:
+                    return dict(failed=True, msg='could not create a temporary directory at %s' % tmp_path)
+            (fd,out_path) = tempfile.mkstemp(prefix='ansible.', dir=tmp_path)
             out_fd = os.fdopen(fd, 'w', 0)
             final_path = data['out_path']
         else:
