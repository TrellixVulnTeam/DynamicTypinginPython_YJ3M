commit 3bc6228b9748ec10838c7f1ed61f553f575dcf9c
Author: Daniel Hokka Zakrisson <daniel@hozac.com>
Date:   Thu Jan 10 18:22:01 2013 +0100

    Handle unreadable /proc/xen/capabilities
    
    Fixes #1854.

diff --git a/library/setup b/library/setup
index bd0dfc4a98..ce0bb9a752 100644
--- a/library/setup
+++ b/library/setup
@@ -713,10 +713,12 @@ class LinuxVirtual(Virtual):
         if os.path.exists("/proc/xen"):
             self.facts['virtualization_type'] = 'xen'
             self.facts['virtualization_role'] = 'guest'
-            if os.path.exists('/proc/xen/capabilities'):
+            try:
                 for line in open('/proc/xen/capabilities'):
                     if "control_d" in line:
                         self.facts['virtualization_role'] = 'host'
+            except IOError:
+                pass
             return
  
         if os.path.exists('/proc/vz'):
