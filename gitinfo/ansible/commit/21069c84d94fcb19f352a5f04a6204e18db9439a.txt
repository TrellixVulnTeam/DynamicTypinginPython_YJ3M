commit 21069c84d94fcb19f352a5f04a6204e18db9439a
Author: Matt Clay <matt@mystile.com>
Date:   Tue Jan 28 11:24:56 2020 -0800

    Fix ansible-test color `ls` logic.

diff --git a/changelogs/fragments/ansible-test-color-ls.yml b/changelogs/fragments/ansible-test-color-ls.yml
new file mode 100644
index 0000000000..52b602c4bf
--- /dev/null
+++ b/changelogs/fragments/ansible-test-color-ls.yml
@@ -0,0 +1,2 @@
+bugfixes:
+    - ansible-test now enables color ``ls`` on a remote host only if the host supports the feature
diff --git a/test/lib/ansible_test/_data/setup/remote.sh b/test/lib/ansible_test/_data/setup/remote.sh
index 9d37602b74..b05b19483c 100644
--- a/test/lib/ansible_test/_data/setup/remote.sh
+++ b/test/lib/ansible_test/_data/setup/remote.sh
@@ -101,7 +101,11 @@ fi
 # Improve prompts on remote host for interactive use.
 # shellcheck disable=SC1117
 cat << EOF > ~/.bashrc
-alias ls='ls -G'
+if ls --color > /dev/null 2>&1; then
+    alias ls='ls --color'
+elif ls -G > /dev/null 2>&1; then
+    alias ls='ls -G'
+fi
 export PS1='\[\e]0;\u@\h: \w\a\]\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
 EOF
 
