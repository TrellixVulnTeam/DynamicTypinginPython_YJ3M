commit 6541f338dff3805881002c3f45a6dc0d27396505
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Fri Mar 2 22:10:51 2012 -0500

    add pyflakes target & associated fixes.  Also decided to save JSON to --tree file so it can
    be better used programatically.  May have to come up with another system of tree logging for
    playbook if playbook decides to have tree logging.  Presumably not the highest priority.

diff --git a/Makefile b/Makefile
index 9e408a9e5a..fe82cbaf4a 100644
--- a/Makefile
+++ b/Makefile
@@ -26,6 +26,9 @@ pep8:
 	@echo "#############################################"
 	pep8 -r --ignore=E501,E221,W291,W391,E302,E251,E203,W293,E231,E303,E201,E225 lib/ bin/
 
+pyflakes:
+	pyflakes lib/ansible/*.py
+
 clean:
 	rm -rf build
 	find . -type f -name "*.pyc" -delete
diff --git a/bin/ansible b/bin/ansible
index dcf53a9c8e..187ad6219e 100755
--- a/bin/ansible
+++ b/bin/ansible
@@ -119,7 +119,7 @@ class Cli(object):
                 options.one_line
             )
             if options.tree:
-                write_tree_file(hostname, msg)
+                write_tree_file(options.tree, hostname, bigjson(results))
             buf += msg
             
         if has_dark_hosts(results):
diff --git a/lib/ansible/playbook.py b/lib/ansible/playbook.py
index 028da31f17..92d205ce4d 100755
--- a/lib/ansible/playbook.py
+++ b/lib/ansible/playbook.py
@@ -137,7 +137,7 @@ class PlayBook(object):
         # load the module name and parameters from the task entry
         name    = task['name']
         action  = task['action']
-        comment = task.get('comment', '')
+        # comment = task.get('comment', '')
 
         tokens = shlex.split(action)
         module_name = tokens[0]
@@ -167,7 +167,6 @@ class PlayBook(object):
 
         dark      = results.get("dark", {})
         contacted = results.get("contacted", {})
-        ok_hosts  = contacted.keys()
 
         for host, msg in dark.items():
             self.processed[host] = 1
diff --git a/lib/ansible/runner.py b/lib/ansible/runner.py
index 32d3a4587c..5cdb09e6e1 100755
--- a/lib/ansible/runner.py
+++ b/lib/ansible/runner.py
@@ -27,7 +27,6 @@ import fnmatch
 import multiprocessing
 import signal
 import os
-import traceback
 import ansible.constants as C 
 import Queue
 import paramiko
diff --git a/lib/ansible/utils.py b/lib/ansible/utils.py
index 5d816ec79f..5e80f8c0e8 100755
--- a/lib/ansible/utils.py
+++ b/lib/ansible/utils.py
@@ -18,6 +18,7 @@
 ###############################################################
 
 import sys
+import os
 try:
     import json
 except ImportError:
@@ -94,11 +95,11 @@ def command_failure_msg(hostname, result, oneline):
     ''' output from a failed command run '''
     return command_generic_msg(hostname, result, oneline, 'FAILED')
 
-def write_tree_file(hostname,buf):
+def write_tree_file(tree, hostname, buf):
     ''' write something into treedir/hostname '''
     # TODO: might be nice to append playbook runs per host in a similar way
     # in which case, we'd want append mode.
-    path = os.path.join(options.tree, hostname)
+    path = os.path.join(tree, hostname)
     fd = open(path, "w+")
     fd.write(buf)
     fd.close()
@@ -155,7 +156,7 @@ def contacted_host_result(results, hostname):
 def prepare_writeable_dir(tree):
     ''' make sure a directory exists and is writeable '''
     if tree != '/':
-        tree = os.path.realpath(os.path.expanduser(options.tree))
+        tree = os.path.realpath(os.path.expanduser(tree))
     if not os.path.exists(tree):
         try:
             os.makedirs(tree)
