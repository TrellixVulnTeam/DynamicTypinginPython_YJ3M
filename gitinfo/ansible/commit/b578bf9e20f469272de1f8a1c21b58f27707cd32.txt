commit b578bf9e20f469272de1f8a1c21b58f27707cd32
Author: Zhikang Zhang <zzhang63@ncsu.edu>
Date:   Fri Jun 1 15:02:56 2018 -0400

    Fix test-module failing to validate args (#41004)
    
    * Fix test-module failing to validate args
    
    The test-module pass a wrong argument _ansible_tmp cause the validation failed.
    Change the argument _ansible_tmp to _ansible_tmpdir to fix this.
    
    * Add a integration test for test-module.
    
    Prior to this change, we don't have a test for test-module.
    
    This change ensure the correctness of test-module script.

diff --git a/hacking/test-module b/hacking/test-module
index c07d973fe1..c56b8b7216 100755
--- a/hacking/test-module
+++ b/hacking/test-module
@@ -125,7 +125,7 @@ def boilerplate_module(modfile, args, interpreters, check, destfile):
 
     # default selinux fs list is pass in as _ansible_selinux_special_fs arg
     complex_args['_ansible_selinux_special_fs'] = C.DEFAULT_SELINUX_SPECIAL_FS
-    complex_args['_ansible_tmp'] = C.DEFAULT_LOCAL_TMP
+    complex_args['_ansible_tmpdir'] = C.DEFAULT_LOCAL_TMP
     complex_args['_ansible_keep_remote_files'] = C.DEFAULT_KEEP_REMOTE_FILES
 
     if args.startswith("@"):
diff --git a/test/integration/targets/test_infra/runme.sh b/test/integration/targets/test_infra/runme.sh
index a0951ad2b5..be3809f95b 100755
--- a/test/integration/targets/test_infra/runme.sh
+++ b/test/integration/targets/test_infra/runme.sh
@@ -21,3 +21,7 @@ echo "rc was $APB_RC (must be non-zero)"
 echo "ensure playbook output shows assert/fail works (True)"
 echo "$PB_OUT" | grep -F "fail works (True)" || exit 1
 echo "$PB_OUT" | grep -F "assert works (True)" || exit 1
+
+# ensure test-module script works well
+PING_MODULE_PATH="$(pwd)/../../../../lib/ansible/modules/system/ping.py"
+../../../../hacking/test-module -m "$PING_MODULE_PATH" -I ansible_python_interpreter="$(which python)"
