commit 7348a613bbd51652862a99a1ae47090e762750b7
Author: Abhijeet Kasurde <akasurde@redhat.com>
Date:   Mon Jun 19 01:58:33 2017 +0530

    Correct usage of fail_json in hg module (#25847)
    
    Fix adds correct usage for fail_json and also adds
    testcases to verify this.
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/lib/ansible/modules/source_control/hg.py b/lib/ansible/modules/source_control/hg.py
index 7c538e6b4e..9cb9e97982 100644
--- a/lib/ansible/modules/source_control/hg.py
+++ b/lib/ansible/modules/source_control/hg.py
@@ -157,7 +157,7 @@ class Hg(object):
     def get_remote_revision(self):
         (rc, out, err) = self._command(['id', self.repo])
         if rc != 0:
-            self.module_fail_json(msg=err)
+            self.module.fail_json(msg=err)
         else:
             return to_native(out).strip('\n')
 
diff --git a/test/integration/targets/hg/tasks/main.yml b/test/integration/targets/hg/tasks/main.yml
index 03b3458ede..f9c1b1494b 100644
--- a/test/integration/targets/hg/tasks/main.yml
+++ b/test/integration/targets/hg/tasks/main.yml
@@ -72,3 +72,15 @@
   assert:
     that:
       - "not hg_result2.changed"
+
+- name: Checkout non-existent repo clone
+  hg: repo=https://bitbucket.org/pyro46/pythonscript_1 clone=no update=no
+  register: hg_result3
+  ignore_errors: true
+
+- name: Verify result of non-existent repo clone
+  assert:
+    that:
+      - hg_result3.msg
+      - "'abort: HTTP Error 404: Not Found' in hg_result3.msg"
+      - "not hg_result3.changed"
