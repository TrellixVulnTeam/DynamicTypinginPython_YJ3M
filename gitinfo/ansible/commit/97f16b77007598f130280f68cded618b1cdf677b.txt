commit 97f16b77007598f130280f68cded618b1cdf677b
Author: Michael Scherer <misc@zarb.org>
Date:   Mon May 16 14:10:07 2016 +0200

    Port shell snippet to python3/2.4 compatible syntax (#15874)

diff --git a/lib/ansible/module_utils/shell.py b/lib/ansible/module_utils/shell.py
index a01b41b0c5..9e244cd638 100644
--- a/lib/ansible/module_utils/shell.py
+++ b/lib/ansible/module_utils/shell.py
@@ -31,6 +31,7 @@ try:
 except ImportError:
     HAS_PARAMIKO = False
 
+from ansible.module_utils.basic import get_exception
 
 ANSI_RE = re.compile(r'(\x1b\[\?1h\x1b=)')
 
@@ -135,7 +136,8 @@ class Shell(object):
                 if self.read(window):
                     resp = self.strip(recv.getvalue())
                     return self.sanitize(cmd, resp)
-            except ShellError, exc:
+            except ShellError:
+                exc = get_exception()
                 exc.command = cmd
                 raise
 
