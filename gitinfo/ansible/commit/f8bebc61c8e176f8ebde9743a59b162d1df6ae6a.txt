commit f8bebc61c8e176f8ebde9743a59b162d1df6ae6a
Author: Martin Krizek <martin.krizek@gmail.com>
Date:   Wed Apr 17 09:13:53 2019 +0200

    ansible-test yamllint: fix UnicodeDecodeError (#55364)
    
    * ansible-test yamllint: fix UnicodeDecodeError
    
    * Conditional fix

diff --git a/test/runner/lib/util.py b/test/runner/lib/util.py
index 6b32e46907..359e125000 100644
--- a/test/runner/lib/util.py
+++ b/test/runner/lib/util.py
@@ -437,7 +437,10 @@ def raw_command(cmd, capture=False, env=None, data=None, cwd=None, explain=False
 
         if communicate:
             encoding = 'utf-8'
-            data_bytes = data.encode(encoding, 'surrogateescape') if data else None
+            if data is None or isinstance(data, bytes):
+                data_bytes = data
+            else:
+                data_bytes = data.encode(encoding, 'surrogateescape')
             stdout_bytes, stderr_bytes = process.communicate(data_bytes)
             stdout_text = stdout_bytes.decode(encoding, str_errors) if stdout_bytes else u''
             stderr_text = stderr_bytes.decode(encoding, str_errors) if stderr_bytes else u''
