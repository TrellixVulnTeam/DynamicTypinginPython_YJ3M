commit ecd66a6a6e4195a7e7fe734701a8762a059132c1
Author: Brian Coca <bcoca@users.noreply.github.com>
Date:   Wed Mar 25 11:57:53 2020 -0400

    Action module xross coll (#68080)
    
    * added test to verify xrs collection action/module
    
    * added to runme
    
    * sanity fixes
    
    * corrected name
    
    * avoid windoez

diff --git a/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/action/action1.py b/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/action/action1.py
new file mode 100644
index 0000000000..e9f97311f5
--- /dev/null
+++ b/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/action/action1.py
@@ -0,0 +1,29 @@
+from __future__ import (absolute_import, division, print_function)
+__metaclass__ = type
+
+from ansible.plugins.action import ActionBase
+
+
+class ActionModule(ActionBase):
+
+    def run(self, tmp=None, task_vars=None):
+        ''' handler for file transfer operations '''
+        if task_vars is None:
+            task_vars = dict()
+
+        result = super(ActionModule, self).run(tmp, task_vars)
+
+        if result.get('skipped'):
+            return result
+
+        module_args = self._task.args.copy()
+
+        result.update(
+            self._execute_module(
+                module_name='me.mycoll2.module1',
+                module_args=module_args,
+                task_vars=task_vars,
+            )
+        )
+
+        return result
diff --git a/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/modules/action1.py b/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/modules/action1.py
new file mode 100644
index 0000000000..66bb5a41bf
--- /dev/null
+++ b/test/integration/targets/collections/collections/ansible_collections/me/mycoll1/plugins/modules/action1.py
@@ -0,0 +1,24 @@
+#!/usr/bin/python
+from __future__ import absolute_import, division, print_function
+__metaclass__ = type
+
+
+ANSIBLE_METADATA = {'metadata_version': '1.1',
+                    'status': ['stableinterface'],
+                    'supported_by': 'core'}
+
+DOCUMENTATION = '''
+---
+module: action1
+short_description: Action Test module
+description:
+    - Action Test module
+author:
+    - Ansible Core Team
+'''
+
+EXAMPLES = '''
+'''
+
+RETURN = '''
+'''
diff --git a/test/integration/targets/collections/collections/ansible_collections/me/mycoll2/plugins/modules/module1.py b/test/integration/targets/collections/collections/ansible_collections/me/mycoll2/plugins/modules/module1.py
new file mode 100644
index 0000000000..00bb993be0
--- /dev/null
+++ b/test/integration/targets/collections/collections/ansible_collections/me/mycoll2/plugins/modules/module1.py
@@ -0,0 +1,43 @@
+#!/usr/bin/python
+from __future__ import absolute_import, division, print_function
+__metaclass__ = type
+
+
+ANSIBLE_METADATA = {'metadata_version': '1.1',
+                    'status': ['stableinterface'],
+                    'supported_by': 'core'}
+
+DOCUMENTATION = '''
+---
+module: module1
+short_description: module1 Test module
+description:
+    - module1 Test module
+author:
+    - Ansible Core Team
+'''
+
+EXAMPLES = '''
+'''
+
+RETURN = '''
+'''
+
+
+from ansible.module_utils.basic import AnsibleModule
+
+
+def main():
+    module = AnsibleModule(
+        argument_spec=dict(
+            desc=dict(type='str'),
+        ),
+    )
+
+    results = dict(msg="you just ran me.mycoll2.module1", desc=module.params.get('desc'))
+
+    module.exit_json(**results)
+
+
+if __name__ == '__main__':
+    main()
diff --git a/test/integration/targets/collections/invocation_tests.yml b/test/integration/targets/collections/invocation_tests.yml
new file mode 100644
index 0000000000..c80e1edc08
--- /dev/null
+++ b/test/integration/targets/collections/invocation_tests.yml
@@ -0,0 +1,5 @@
+- hosts: testhost
+  gather_facts: false
+  tasks:
+    - name: run action that invokes module from another collection
+      me.mycoll1.action1: desc="this should run me.mycoll2.module1"
diff --git a/test/integration/targets/collections/runme.sh b/test/integration/targets/collections/runme.sh
index f485836eab..a3c61e6b64 100755
--- a/test/integration/targets/collections/runme.sh
+++ b/test/integration/targets/collections/runme.sh
@@ -36,9 +36,13 @@ else
   ansible-playbook -i "${INVENTORY_PATH}" collection_root_user/ansible_collections/testns/testcoll/playbooks/default_collection_playbook.yml
 fi
 
-# run test playbook
+# run test playbooks
 ansible-playbook -i "${INVENTORY_PATH}"  -i ./a.statichost.yml -v "${TEST_PLAYBOOK}" "$@"
 
+if [[ ${INVENTORY_PATH} != *.winrm ]]; then
+	ansible-playbook -i "${INVENTORY_PATH}"  -i ./a.statichost.yml -v invocation_tests.yml "$@"
+fi
+
 # test adjacent with --playbook-dir
 export ANSIBLE_COLLECTIONS_PATHS=''
 ANSIBLE_INVENTORY_ANY_UNPARSED_IS_FAILED=1 ansible-inventory -i a.statichost.yml --list --export --playbook-dir=. -v "$@"
