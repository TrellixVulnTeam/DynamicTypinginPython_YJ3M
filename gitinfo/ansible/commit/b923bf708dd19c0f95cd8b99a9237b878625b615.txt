commit b923bf708dd19c0f95cd8b99a9237b878625b615
Author: David Gonz√°lez <dagoonline@users.noreply.github.com>
Date:   Wed Oct 17 18:29:23 2018 +0200

    [aws] Convert containerPort to int before comparing to avoid jinja2 string-int issues (#39215) (#47195)

diff --git a/lib/ansible/modules/cloud/amazon/ecs_service.py b/lib/ansible/modules/cloud/amazon/ecs_service.py
index 27581a7e59..d688144399 100644
--- a/lib/ansible/modules/cloud/amazon/ecs_service.py
+++ b/lib/ansible/modules/cloud/amazon/ecs_service.py
@@ -516,7 +516,12 @@ def main():
 
                 role = module.params['role']
                 clientToken = module.params['client_token']
-                loadBalancers = module.params['load_balancers']
+
+                loadBalancers = []
+                for loadBalancer in module.params['load_balancers']:
+                    if 'containerPort' in loadBalancer:
+                        loadBalancer['containerPort'] = int(loadBalancer['containerPort'])
+                    loadBalancers.append(loadBalancer)
 
                 if update:
                     if (existing['loadBalancers'] or []) != loadBalancers:
@@ -529,10 +534,6 @@ def main():
                                                           deploymentConfiguration,
                                                           network_configuration)
                 else:
-                    for loadBalancer in loadBalancers:
-                        if 'containerPort' in loadBalancer:
-                            loadBalancer['containerPort'] = int(loadBalancer['containerPort'])
-                    # doesn't exist. create it.
                     try:
                         response = service_mgr.create_service(module.params['name'],
                                                               module.params['cluster'],
