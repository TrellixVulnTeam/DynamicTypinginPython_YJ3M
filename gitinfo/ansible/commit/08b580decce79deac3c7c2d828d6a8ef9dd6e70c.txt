commit 08b580decce79deac3c7c2d828d6a8ef9dd6e70c
Author: James Cammarata <jimi@sngx.net>
Date:   Mon Dec 21 14:09:02 2015 -0500

    Parallelize make command for integration test runner
    
    Also adds a new var, used by the prepare_tests role, to prevent it from
    deleting the temp test directory at the start of each play to avoid any
    potential race conditions

diff --git a/test/integration/roles/prepare_tests/tasks/main.yml b/test/integration/roles/prepare_tests/tasks/main.yml
index 3641880baa..7983ea5236 100644
--- a/test/integration/roles/prepare_tests/tasks/main.yml
+++ b/test/integration/roles/prepare_tests/tasks/main.yml
@@ -22,6 +22,7 @@
   always_run: True
   tags:
     - prepare
+  when: clean_working_dir|default("yes")|bool
 
 - name: create the test directory
   file: name={{output_dir}} state=directory
diff --git a/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml b/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
index f67f088246..8a306a8ada 100644
--- a/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
+++ b/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
@@ -9,7 +9,7 @@
   shell: "cd ~/ansible && pwd"
   register: results
 
-- shell: "ls -la && . hacking/env-setup && cd test/integration && make {{ run_integration_make_target }}"
+- shell: "ls -la && . hacking/env-setup && cd test/integration && TEST_FLAGS='-e clean_working_dir=no' make -j4 {{ run_integration_make_target }}"
   args:
     chdir: "{{ results.stdout }}"
   async: 3600
