commit 5c7f203c33b60de98cc30d5f04150e2bacfa4a84
Author: Martin Krizek <martin.krizek@gmail.com>
Date:   Tue Jan 23 17:52:23 2018 +0100

    Add test for fix using loop_control with delegate_to (#33809)

diff --git a/test/integration/targets/delegate_to/runme.sh b/test/integration/targets/delegate_to/runme.sh
index ce2c0889cc..3d2873ee44 100755
--- a/test/integration/targets/delegate_to/runme.sh
+++ b/test/integration/targets/delegate_to/runme.sh
@@ -4,3 +4,5 @@ set -eux
 
 ANSIBLE_SSH_ARGS='-C -o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null' \
     ANSIBLE_HOST_KEY_CHECKING=false ansible-playbook test_delegate_to.yml -i ../../inventory -v "$@"
+
+ansible-playbook test_loop_control.yml -v "$@"
diff --git a/test/integration/targets/delegate_to/test_loop_control.yml b/test/integration/targets/delegate_to/test_loop_control.yml
new file mode 100644
index 0000000000..61e9304d40
--- /dev/null
+++ b/test/integration/targets/delegate_to/test_loop_control.yml
@@ -0,0 +1,16 @@
+- hosts: localhost
+  gather_facts: no
+  tasks:
+    - name: Test delegate_to with loop_control
+      ping:
+      delegate_to: "{{ item }}"
+      with_items:
+        - localhost
+      loop_control:
+        label: "{{ item }}"
+      register: out
+
+    - name: Check if delegated_host was templated properly
+      assert:
+        that:
+          - out.results[0]['_ansible_delegated_vars']['ansible_delegated_host'] == 'localhost'
