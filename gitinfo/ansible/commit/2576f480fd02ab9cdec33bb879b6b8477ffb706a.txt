commit 2576f480fd02ab9cdec33bb879b6b8477ffb706a
Author: James Cammarata <jimi@sngx.net>
Date:   Tue Jun 30 13:57:47 2015 -0400

    Restoring a state check to play_iterator, which otherwise broke block functionality

diff --git a/lib/ansible/executor/play_iterator.py b/lib/ansible/executor/play_iterator.py
index 585c6556eb..8794e7e403 100644
--- a/lib/ansible/executor/play_iterator.py
+++ b/lib/ansible/executor/play_iterator.py
@@ -242,7 +242,7 @@ class PlayIterator:
         self._host_states[host.name] = s
 
     def get_failed_hosts(self):
-        return dict((host, True) for (host, state) in self._host_states.iteritems() if state.fail_state != self.FAILED_NONE)
+        return dict((host, True) for (host, state) in self._host_states.iteritems() if state.run_state == self.ITERATING_COMPLETE and state.fail_state != self.FAILED_NONE)
 
     def get_original_task(self, host, task):
         '''
