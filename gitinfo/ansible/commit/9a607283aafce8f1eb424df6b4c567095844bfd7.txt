commit 9a607283aafce8f1eb424df6b4c567095844bfd7
Author: Ryan S. Brown <sb@ryansb.com>
Date:   Wed May 2 11:25:52 2018 -0400

    Terraform module: pass `plan_file` argument correctly
    
    Per #39611 the `terraform` module wasn't properly building plan-only
    files.

diff --git a/lib/ansible/modules/cloud/misc/terraform.py b/lib/ansible/modules/cloud/misc/terraform.py
index c0c8972bea..381281bf32 100644
--- a/lib/ansible/modules/cloud/misc/terraform.py
+++ b/lib/ansible/modules/cloud/misc/terraform.py
@@ -255,7 +255,7 @@ def main():
     needs_application, changed = True, True
 
     if state == 'planned':
-        plan_file, needs_application = build_plan(command[0], project_path, variables_args, state_file)
+        plan_file, needs_application = build_plan(command[0], project_path, variables_args, state_file, plan_file)
     if state == 'absent':
         # deleting cannot use a statefile
         needs_application = True
@@ -266,7 +266,7 @@ def main():
     elif plan_file and not os.path.exists(plan_file):
         module.fail_json(msg='Could not find plan_file "{0}", check the path and try again.'.format(plan_file))
     else:
-        plan_file, needs_application = build_plan(command[0], project_path, variables_args, state_file)
+        plan_file, needs_application = build_plan(command[0], project_path, variables_args, state_file, plan_file)
         command.append(plan_file)
 
     if needs_application and not module.check_mode and not state == 'planned':
