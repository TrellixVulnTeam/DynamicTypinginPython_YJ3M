commit 8360f9f46c58ae0472342dc9adfefb2fdd7bf0de
Author: Piotr Kweclich <piotr.kweclich@contium.pl>
Date:   Wed Sep 5 18:18:30 2012 +0200

    added support for custom port definition

diff --git a/library/postgresql_db b/library/postgresql_db
index 32ee920590..fdccd14ddb 100755
--- a/library/postgresql_db
+++ b/library/postgresql_db
@@ -77,6 +77,7 @@ def main():
             login_user=dict(default="postgres"),
             login_password=dict(default=""),
             login_host=dict(default=""),
+            port=dict(default="5432"),
             db=dict(required=True, aliases=['name']),
             owner=dict(default=""),
             template=dict(default=""),
@@ -89,6 +90,7 @@ def main():
         module.fail_json(msg="the python psycopg2 module is required")
 
     db = module.params["db"]
+    port = module.params["port"]
     owner = module.params["owner"]
     template = module.params["template"]
     encoding = module.params["encoding"]
@@ -101,7 +103,8 @@ def main():
     params_map =  {
         "login_host":"host",
         "login_user":"user",
-        "login_password":"password"
+        "login_password":"password",
+        "port":"port"
     }
     kw = dict( (params_map[k], v) for (k, v) in module.params.iteritems() 
               if k in params_map and v != '' )
diff --git a/library/postgresql_user b/library/postgresql_user
index d883cc57cc..6104fd8d00 100755
--- a/library/postgresql_user
+++ b/library/postgresql_user
@@ -224,6 +224,7 @@ def main():
             state=dict(default="present", choices=["absent", "present"]),
             priv=dict(default=None),
             db=dict(default=''),
+            port=dict(default='5432'),
             fail_on_user=dict(default='yes')
         )
     )
@@ -235,6 +236,7 @@ def main():
     if db == '' and module.params["priv"] is not None:
         module.fail_json(msg="privileges require a database to be specified")
     privs = parse_privs(module.params["priv"], db)
+    port = module.params["port"]
 
     if not postgresqldb_found:
         module.fail_json(msg="the python psycopg2 module is required")
@@ -246,6 +248,7 @@ def main():
         "login_host":"host",
         "login_user":"user",
         "login_password":"password",
+        "port":"port",
         "db":"database" 
     }
     kw = dict( (params_map[k], v) for (k, v) in module.params.iteritems() 
