commit 5aa60a5fa7ad36c0235b8f92b54a7c684e344eac
Author: Pilou <pierre-louis.bonicoli@libregerbil.fr>
Date:   Sat Feb 15 14:57:19 2020 +0000

    ovirt: don't ignore instance_cpus parameter (#64366)

diff --git a/changelogs/fragments/ovirt-dont-ignore-instance_cpus-parameter.yaml b/changelogs/fragments/ovirt-dont-ignore-instance_cpus-parameter.yaml
new file mode 100644
index 0000000000..93b33bb7a8
--- /dev/null
+++ b/changelogs/fragments/ovirt-dont-ignore-instance_cpus-parameter.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+  - ovirt - don't ignore ``instance_cpus`` parameter
diff --git a/lib/ansible/modules/cloud/misc/ovirt.py b/lib/ansible/modules/cloud/misc/ovirt.py
index e9372c088a..2f7af490e2 100644
--- a/lib/ansible/modules/cloud/misc/ovirt.py
+++ b/lib/ansible/modules/cloud/misc/ovirt.py
@@ -240,7 +240,7 @@ def create_vm(conn, vmtype, vmname, zone, vmdisk_size, vmcpus, vmnic, vmnetwork,
         # define VM params
         vmparams = params.VM(name=vmname, cluster=conn.clusters.get(name=zone), os=params.OperatingSystem(type_=vmos),
                              template=conn.templates.get(name="Blank"), memory=1024 * 1024 * int(vmmem),
-                             cpu=params.CPU(topology=params.CpuTopology(cores=int(vmcores))), type_=vmtype)
+                             cpu=params.CPU(topology=params.CpuTopology(cores=int(vmcores), sockets=vmcpus)), type_=vmtype)
         # define disk params
         vmdisk = params.Disk(size=1024 * 1024 * 1024 * int(vmdisk_size), wipe_after_delete=True, sparse=True, interface=vmdisk_int, type_="System",
                              format='cow',
@@ -252,7 +252,7 @@ def create_vm(conn, vmtype, vmname, zone, vmdisk_size, vmcpus, vmnic, vmnetwork,
         # define VM params
         vmparams = params.VM(name=vmname, cluster=conn.clusters.get(name=zone), os=params.OperatingSystem(type_=vmos),
                              template=conn.templates.get(name="Blank"), memory=1024 * 1024 * int(vmmem),
-                             cpu=params.CPU(topology=params.CpuTopology(cores=int(vmcores))), type_=vmtype)
+                             cpu=params.CPU(topology=params.CpuTopology(cores=int(vmcores), sockets=vmcpus)), type_=vmtype)
         # define disk params
         vmdisk = params.Disk(size=1024 * 1024 * 1024 * int(vmdisk_size), wipe_after_delete=True, sparse=False, interface=vmdisk_int, type_="System",
                              format='raw', storage_domains=params.StorageDomains(storage_domain=[conn.storagedomains.get(name=sdomain)]))
