commit 4ec8744b8bf35ce75bd1b9ac59cd5ba7e4f48b91
Author: Brandon Davidson <brad@oatmail.org>
Date:   Tue Aug 1 14:10:16 2017 -0400

    Ignore main route table association when determining which associations to remove. (#23781)
    
    They can't be removed anyway, and will just throw an error if you try to disassociate them.

diff --git a/lib/ansible/modules/cloud/amazon/ec2_vpc_route_table.py b/lib/ansible/modules/cloud/amazon/ec2_vpc_route_table.py
index 34f78a9707..139fe54552 100644
--- a/lib/ansible/modules/cloud/amazon/ec2_vpc_route_table.py
+++ b/lib/ansible/modules/cloud/amazon/ec2_vpc_route_table.py
@@ -404,6 +404,8 @@ def ensure_subnet_association(vpc_conn, vpc_id, route_table_id, subnet_id,
         if route_table.id is None:
             continue
         for a in route_table.associations:
+            if a.main:
+                continue
             if a.subnet_id == subnet_id:
                 if route_table.id == route_table_id:
                     return {'changed': False, 'association_id': a.id}
@@ -418,7 +420,7 @@ def ensure_subnet_association(vpc_conn, vpc_id, route_table_id, subnet_id,
 
 def ensure_subnet_associations(vpc_conn, vpc_id, route_table, subnets,
                                check_mode, purge_subnets):
-    current_association_ids = [a.id for a in route_table.associations]
+    current_association_ids = [a.id for a in route_table.associations if not a.main]
     new_association_ids = []
     changed = False
     for subnet in subnets:
