commit 19fb4f861cde021dc45b0a9eeabe0f2cc81713c9
Author: Petr Svoboda <petr@jatys.cz>
Date:   Mon Sep 30 15:47:43 2013 +0200

    Fail cloudformation operation when it is not completed successfully
    
    When cloudformation operation is successfully submitted but some step
    during stack creation or update fails, operation result should be
    failed=True.

diff --git a/library/cloud/cloudformation b/library/cloud/cloudformation
index ae9f2e0f26..41323ac562 100644
--- a/library/cloud/cloudformation
+++ b/library/cloud/cloudformation
@@ -141,12 +141,12 @@ def stack_operation(cfn, stack_name, operation):
                           output = 'Stack %s complete' % operation)
             break
         if '%s_ROLLBACK_COMPLETE' % operation == stack.stack_status:
-            result = dict(changed=True,
+            result = dict(changed=True, failed=True,
                           events = map(str, list(stack.describe_events())),
                           output = 'Problem with %s. Rollback complete' % operation)
             break
         elif '%s_FAILED' % operation == stack.stack_status:
-            result = dict(changed=False,
+            result = dict(changed=True, failed=True,
                           events = map(str, list(stack.describe_events())),
                           output = 'Stack %s failed' % operation)
             break
