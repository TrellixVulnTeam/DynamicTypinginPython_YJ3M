commit 226bf7b227076118eb42f195b275caf5ca0dabf9
Author: Pilou <pierre-louis.bonicoli@libregerbil.fr>
Date:   Thu Dec 12 19:45:54 2019 +0000

    apt target: use 'until' when the cache is updated (#65456)
    
    This integration target can be unstable due to network/mirror issues:
    
        TASK [apt : uninstall hello with apt] ***
        fatal: [testhost]: FAILED! => {
            "changed": false,
            "cmd": "apt-get update",
            "msg": "E: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/bionic-updates/universe/source/Sources.gz File has unexpected size (354740 != 354745). Mirror sync in progress? [...]",
            "rc": 100,
            [...]

diff --git a/test/integration/targets/apt/tasks/apt-multiarch.yml b/test/integration/targets/apt/tasks/apt-multiarch.yml
index e0ade2bbc5..6241664de2 100644
--- a/test/integration/targets/apt/tasks/apt-multiarch.yml
+++ b/test/integration/targets/apt/tasks/apt-multiarch.yml
@@ -4,6 +4,8 @@
 
 - name: install hello:{{ apt_foreign_arch }} with apt
   apt: pkg=hello:{{ apt_foreign_arch }} state=present update_cache=yes
+  register: apt_result
+  until: apt_result is success
 
 - name: uninstall hello:{{ apt_foreign_arch }} with apt
   apt: pkg=hello:{{ apt_foreign_arch }} state=absent purge=yes
diff --git a/test/integration/targets/apt/tasks/apt.yml b/test/integration/targets/apt/tasks/apt.yml
index f9fcdfe3d0..871cb0d7ba 100644
--- a/test/integration/targets/apt/tasks/apt.yml
+++ b/test/integration/targets/apt/tasks/apt.yml
@@ -88,6 +88,7 @@
 - name: uninstall hello with apt
   apt: pkg=hello state=absent purge=yes
   register: apt_result
+  until: apt_result is success
 
 - name: check hello with dpkg
   shell: dpkg-query -l hello
