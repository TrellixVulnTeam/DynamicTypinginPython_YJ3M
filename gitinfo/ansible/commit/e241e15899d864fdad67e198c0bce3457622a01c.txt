commit e241e15899d864fdad67e198c0bce3457622a01c
Author: Matt Clay <matt@mystile.com>
Date:   Fri Jul 28 10:56:25 2017 -0700

    Add support for `non_local` alias in ansible-test.

diff --git a/test/integration/targets/connection_buildah/aliases b/test/integration/targets/connection_buildah/aliases
index ca5668ce04..1e27ef53b7 100644
--- a/test/integration/targets/connection_buildah/aliases
+++ b/test/integration/targets/connection_buildah/aliases
@@ -1 +1,2 @@
 needs/root
+non_local
diff --git a/test/integration/targets/connection_buildah/runme.sh b/test/integration/targets/connection_buildah/runme.sh
index b1acf92376..09902adc18 100755
--- a/test/integration/targets/connection_buildah/runme.sh
+++ b/test/integration/targets/connection_buildah/runme.sh
@@ -2,6 +2,6 @@
 
 set -eux
 
-ANSIBLE_TEST_REMOTE_INTERPRETER='' ./posix.sh "$@"
+./posix.sh "$@"
 
-ANSIBLE_TEST_REMOTE_INTERPRETER='' ANSIBLE_REMOTE_USER="1000" ./posix.sh "$@"
+ANSIBLE_REMOTE_USER="1000" ./posix.sh "$@"
diff --git a/test/integration/targets/connection_buildah/test_connection.inventory b/test/integration/targets/connection_buildah/test_connection.inventory
index 6a3c41f1fe..1c3d8714b3 100644
--- a/test/integration/targets/connection_buildah/test_connection.inventory
+++ b/test/integration/targets/connection_buildah/test_connection.inventory
@@ -5,7 +5,7 @@ buildah-container    ansible_ssh_pipelining=true
 # 2. create container:
 # $ sudo buildah from --name=buildah-container python:2
 # 3. run test:
-# $ ANSIBLE_TEST_REMOTE_INTERPRETER= ansible-test integration --local connection_buildah
+# $ ansible-test integration connection_buildah
 # 6. remove container
 # $ sudo buildah rm buildah-container
 ansible_host=buildah-container
diff --git a/test/integration/targets/connection_docker/aliases b/test/integration/targets/connection_docker/aliases
index e69de29bb2..a51f9c505f 100644
--- a/test/integration/targets/connection_docker/aliases
+++ b/test/integration/targets/connection_docker/aliases
@@ -0,0 +1 @@
+non_local
diff --git a/test/integration/targets/connection_lxd/aliases b/test/integration/targets/connection_lxd/aliases
index e69de29bb2..a51f9c505f 100644
--- a/test/integration/targets/connection_lxd/aliases
+++ b/test/integration/targets/connection_lxd/aliases
@@ -0,0 +1 @@
+non_local
diff --git a/test/integration/targets/openvswitch_db/aliases b/test/integration/targets/openvswitch_db/aliases
index e69de29bb2..a51f9c505f 100644
--- a/test/integration/targets/openvswitch_db/aliases
+++ b/test/integration/targets/openvswitch_db/aliases
@@ -0,0 +1 @@
+non_local
diff --git a/test/runner/lib/executor.py b/test/runner/lib/executor.py
index b22411a640..7479aeba39 100644
--- a/test/runner/lib/executor.py
+++ b/test/runner/lib/executor.py
@@ -629,6 +629,12 @@ def integration_environment(args, target, cmd):
     if args.debug_strategy:
         env.update(dict(ANSIBLE_STRATEGY='debug'))
 
+    if 'non_local/' in target.aliases:
+        if args.coverage:
+            display.warning('Skipping coverage reporting for non-local test: %s' % target.name)
+
+        env.update(dict(ANSIBLE_TEST_REMOTE_INTERPRETER=''))
+
     env.update(integration)
 
     cloud_environment = get_cloud_environment(args, target)
