commit 4b3e5998bf862211a8e080e6c5e5cef22f87ca09
Author: Sloane Hertel <shertel@redhat.com>
Date:   Tue Jul 31 15:04:21 2018 -0400

    Allow AWS endpoints and dualstack (#43497)

diff --git a/lib/ansible/modules/cloud/amazon/aws_s3.py b/lib/ansible/modules/cloud/amazon/aws_s3.py
index fbcff5bcd2..5d22853d4d 100644
--- a/lib/ansible/modules/cloud/amazon/aws_s3.py
+++ b/lib/ansible/modules/cloud/amazon/aws_s3.py
@@ -759,7 +759,7 @@ def main():
     if not s3_url and 'S3_URL' in os.environ:
         s3_url = os.environ['S3_URL']
 
-    if dualstack and s3_url:
+    if dualstack and 'amazonaws.com' not in s3_url:
         module.fail_json(msg='dualstack only applies to AWS S3')
 
     if dualstack and not module.botocore_at_least('1.4.45'):
