commit c697d01151ad485a71936bab06d99f071532ef3f
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Wed Nov 26 10:55:37 2014 -0800

    Integration tests for #9242 and #9640

diff --git a/test/integration/Makefile b/test/integration/Makefile
index b732eb02f8..77c81a76b9 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -57,7 +57,7 @@ test_hash:
 	ANSIBLE_HASH_BEHAVIOUR=merge ansible-playbook test_hash.yml -i $(INVENTORY) $(CREDENTIALS_ARG) -v -e '{"test_hash":{"extra_args":"this is an extra arg"}}'
 
 test_var_precedence:
-	ansible-playbook test_var_precedence.yml -i $(INVENTORY) $(CREDENTIALS_ARG) -v -e 'extra_var=extra_var'
+	ansible-playbook test_var_precedence.yml -i $(INVENTORY) $(CREDENTIALS_ARG) -v -e 'extra_var=extra_var' -e 'extra_var_override=extra_var_override'
 
 test_vault:
 	ansible-playbook test_vault.yml -i $(INVENTORY) $(CREDENTIALS_ARG) -v $(TEST_FLAGS) --vault-password-file $(VAULT_PASSWORD_FILE) --list-tasks
diff --git a/test/integration/inventory b/test/integration/inventory
index 59bb395205..a9f160c989 100644
--- a/test/integration/inventory
+++ b/test/integration/inventory
@@ -9,6 +9,10 @@ testhost2 ansible_ssh_host=127.0.0.1 ansible_connection=local
 [inven_overridehosts]
 invenoverride ansible_ssh_host=127.0.0.1 ansible_connection=local
 
+[all:vars]
+extra_var_override=FROM_INVENTORY
+inven_var=inventory_var
+
 [inven_overridehosts:vars]
 foo=foo
 var_dir=vars
diff --git a/test/integration/test_var_precedence.yml b/test/integration/test_var_precedence.yml
index bbe89a872c..8bddfff447 100644
--- a/test/integration/test_var_precedence.yml
+++ b/test/integration/test_var_precedence.yml
@@ -4,6 +4,8 @@
   - vars_var: "vars_var"
   - param_var: "BAD!"
   - vars_files_var: "BAD!"
+  - extra_var_override_once_removed: "{{ extra_var_override }}"
+  - from_inventory_once_removed: "{{ inven_var | default('BAD!') }}"
   vars_files:
   - vars/test_var_precedence.yml
   roles:
@@ -15,17 +17,22 @@
   - name: use set_fact to override the registered_var
     set_fact: registered_var="this is from set_fact"
   - debug: var=extra_var
+  - debug: var=extra_var_override_once_removed
   - debug: var=vars_var
   - debug: var=vars_files_var
   - debug: var=vars_files_var_role
   - debug: var=registered_var
+  - debug: var=from_inventory_once_removed
   - assert:
       that:
         - 'extra_var == "extra_var"'
+        - 'extra_var_override == "extra_var_override"'
+        - 'extra_var_override_once_removed == "extra_var_override"'
         - 'vars_var == "vars_var"'
         - 'vars_files_var == "vars_files_var"'
         - 'vars_files_var_role == "vars_files_var_role3"'
         - 'registered_var == "this is from set_fact"'
+        - 'from_inventory_once_removed == "inventory_var"'
 
 - hosts: inven_overridehosts
   vars_files:
