commit d336a989e4d493b404db111e20e266479fb38082
Author: The Magician <magic-modules@google.com>
Date:   Tue Jul 9 11:35:36 2019 -0700

    Bug fixes for GCP modules (#58848)

diff --git a/lib/ansible/modules/cloud/google/gcp_compute_backend_service.py b/lib/ansible/modules/cloud/google/gcp_compute_backend_service.py
index bd02a46f2e..135fafd32d 100644
--- a/lib/ansible/modules/cloud/google/gcp_compute_backend_service.py
+++ b/lib/ansible/modules/cloud/google/gcp_compute_backend_service.py
@@ -60,7 +60,7 @@ options:
     required: false
   backends:
     description:
-    - The list of backends that serve this BackendService.
+    - The set of backends that serve this BackendService.
     required: false
     suboptions:
       balancing_mode:
@@ -229,7 +229,7 @@ options:
     type: bool
   health_checks:
     description:
-    - The list of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
+    - The set of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
       checking this BackendService. Currently at most one health check can be specified,
       and a health check is required.
     - For internal load balancing, a URL to a HealthCheck resource must be specified
@@ -339,7 +339,7 @@ EXAMPLES = '''
   gcp_compute_backend_service:
     name: test_object
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -360,7 +360,7 @@ affinityCookieTtlSec:
   type: int
 backends:
   description:
-  - The list of backends that serve this BackendService.
+  - The set of backends that serve this BackendService.
   returned: success
   type: complex
   contains:
@@ -550,7 +550,7 @@ enableCDN:
   type: bool
 healthChecks:
   description:
-  - The list of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
+  - The set of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
     checking this BackendService. Currently at most one health check can be specified,
     and a health check is required.
   - For internal load balancing, a URL to a HealthCheck resource must be specified
diff --git a/lib/ansible/modules/cloud/google/gcp_compute_backend_service_facts.py b/lib/ansible/modules/cloud/google/gcp_compute_backend_service_facts.py
index 4602cdf059..1730d98ea6 100644
--- a/lib/ansible/modules/cloud/google/gcp_compute_backend_service_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_compute_backend_service_facts.py
@@ -76,7 +76,7 @@ resources:
       type: int
     backends:
       description:
-      - The list of backends that serve this BackendService.
+      - The set of backends that serve this BackendService.
       returned: success
       type: complex
       contains:
@@ -267,7 +267,7 @@ resources:
       type: bool
     healthChecks:
       description:
-      - The list of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
+      - The set of URLs to the HttpHealthCheck or HttpsHealthCheck resource for health
         checking this BackendService. Currently at most one health check can be specified,
         and a health check is required.
       - For internal load balancing, a URL to a HealthCheck resource must be specified
diff --git a/lib/ansible/modules/cloud/google/gcp_compute_global_forwarding_rule.py b/lib/ansible/modules/cloud/google/gcp_compute_global_forwarding_rule.py
index c4b34c7d73..cb93e15029 100644
--- a/lib/ansible/modules/cloud/google/gcp_compute_global_forwarding_rule.py
+++ b/lib/ansible/modules/cloud/google/gcp_compute_global_forwarding_rule.py
@@ -181,7 +181,7 @@ EXAMPLES = '''
   gcp_compute_backend_service:
     name: backendservice-globalforwardingrule
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
diff --git a/test/integration/targets/gcp_bigquery_dataset/tasks/main.yml b/test/integration/targets/gcp_bigquery_dataset/tasks/main.yml
index b8a3f237e3..609caf1c43 100644
--- a/test/integration/targets/gcp_bigquery_dataset/tasks/main.yml
+++ b/test/integration/targets/gcp_bigquery_dataset/tasks/main.yml
@@ -49,7 +49,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length >= 1
+      - results['resources'] | map(attribute='name') | select("match", ".*my_example_dataset.*") | list | length == 1
 # ----------------------------------------------------------------------------
 - name: create a dataset that already exists
   gcp_bigquery_dataset:
@@ -93,7 +93,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length == 0
+      - results['resources'] | map(attribute='name') | select("match", ".*my_example_dataset.*") | list | length == 0
 # ----------------------------------------------------------------------------
 - name: delete a dataset that does not exist
   gcp_bigquery_dataset:
diff --git a/test/integration/targets/gcp_bigquery_table/tasks/main.yml b/test/integration/targets/gcp_bigquery_table/tasks/main.yml
index 86c8282035..a06a71b8e9 100644
--- a/test/integration/targets/gcp_bigquery_table/tasks/main.yml
+++ b/test/integration/targets/gcp_bigquery_table/tasks/main.yml
@@ -66,7 +66,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length >= 1
+      - results['resources'] | map(attribute='name') | select("match", ".*example_table.*") | list | length == 1
 # ----------------------------------------------------------------------------
 - name: create a table that already exists
   gcp_bigquery_table:
@@ -117,7 +117,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length == 0
+      - results['resources'] | map(attribute='name') | select("match", ".*example_table.*") | list | length == 0
 # ----------------------------------------------------------------------------
 - name: delete a table that does not exist
   gcp_bigquery_table:
diff --git a/test/integration/targets/gcp_cloudscheduler_job/tasks/main.yml b/test/integration/targets/gcp_cloudscheduler_job/tasks/main.yml
index 48290862a1..b48ccd6096 100644
--- a/test/integration/targets/gcp_cloudscheduler_job/tasks/main.yml
+++ b/test/integration/targets/gcp_cloudscheduler_job/tasks/main.yml
@@ -67,7 +67,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length >= 1
+      - results['resources'] | map(attribute='name') | select("match", ".*job.*") | list | length == 1
 # ----------------------------------------------------------------------------
 - name: create a job that already exists
   gcp_cloudscheduler_job:
@@ -128,7 +128,7 @@
 - name: verify that command succeeded
   assert:
     that:
-      - results['resources'] | length == 0
+      - results['resources'] | map(attribute='name') | select("match", ".*job.*") | list | length == 0
 # ----------------------------------------------------------------------------
 - name: delete a job that does not exist
   gcp_cloudscheduler_job:
diff --git a/test/integration/targets/gcp_compute_backend_service/tasks/main.yml b/test/integration/targets/gcp_compute_backend_service/tasks/main.yml
index aa5502b4c7..5b69756e12 100644
--- a/test/integration/targets/gcp_compute_backend_service/tasks/main.yml
+++ b/test/integration/targets/gcp_compute_backend_service/tasks/main.yml
@@ -38,7 +38,7 @@
   gcp_compute_backend_service:
     name: "{{ resource_name }}"
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -51,7 +51,7 @@
   gcp_compute_backend_service:
     name: "{{ resource_name }}"
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -84,7 +84,7 @@
   gcp_compute_backend_service:
     name: "{{ resource_name }}"
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -103,7 +103,7 @@
   gcp_compute_backend_service:
     name: "{{ resource_name }}"
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -136,7 +136,7 @@
   gcp_compute_backend_service:
     name: "{{ resource_name }}"
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
diff --git a/test/integration/targets/gcp_compute_global_forwarding_rule/tasks/main.yml b/test/integration/targets/gcp_compute_global_forwarding_rule/tasks/main.yml
index 7fe60b9765..b33eebdcee 100644
--- a/test/integration/targets/gcp_compute_global_forwarding_rule/tasks/main.yml
+++ b/test/integration/targets/gcp_compute_global_forwarding_rule/tasks/main.yml
@@ -46,7 +46,7 @@
   gcp_compute_backend_service:
     name: backendservice-globalforwardingrule
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
@@ -211,7 +211,7 @@
   gcp_compute_backend_service:
     name: backendservice-globalforwardingrule
     backends:
-    - group: "{{ instancegroup }}"
+    - group: "{{ instancegroup.selfLink }}"
     health_checks:
     - "{{ healthcheck.selfLink }}"
     enable_cdn: 'true'
