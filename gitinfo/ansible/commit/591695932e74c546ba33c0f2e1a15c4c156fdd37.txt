commit 591695932e74c546ba33c0f2e1a15c4c156fdd37
Author: ABond <ajbond2005@gmail.com>
Date:   Sat Feb 17 21:17:26 2018 -0500

    Fix bug in DigitalOcean module_util (#36352)

diff --git a/lib/ansible/module_utils/digital_ocean.py b/lib/ansible/module_utils/digital_ocean.py
index 8304e06452..00bdd637b1 100644
--- a/lib/ansible/module_utils/digital_ocean.py
+++ b/lib/ansible/module_utils/digital_ocean.py
@@ -62,16 +62,15 @@ class DigitalOceanHelper:
     def __init__(self, module):
         self.module = module
         self.baseurl = 'https://api.digitalocean.com/v2'
-        self.oauth_token = None
+        self.timeout = module.params.get('timeout', 30)
+        self.oauth_token = module.params.get('oauth_token')
         self.headers = {'Authorization': 'Bearer {0}'.format(self.oauth_token),
                         'Content-type': 'application/json'}
 
         # Check if api_token is valid or not
         response = self.get('account')
         if response.status_code == 401:
-            module.fail_json(msg='Failed to login using API token, please verify validity of API token.')
-
-        self.timeout = module.params.get('timeout', 30)
+            self.module.fail_json(msg='Failed to login using API token, please verify validity of API token.')
 
     def _url_builder(self, path):
         if path[0] == '/':
diff --git a/test/sanity/validate-modules/ignore.txt b/test/sanity/validate-modules/ignore.txt
index ca9260499d..1fcebb6147 100644
--- a/test/sanity/validate-modules/ignore.txt
+++ b/test/sanity/validate-modules/ignore.txt
@@ -670,11 +670,9 @@ lib/ansible/modules/cloud/digital_ocean/digital_ocean.py E326
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_floating_ip.py E322
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_floating_ip.py E324
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_floating_ip.py E325
-lib/ansible/modules/cloud/digital_ocean/digital_ocean_floating_ip_facts.py E325
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_sshkey.py E322
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_sshkey.py E324
 lib/ansible/modules/cloud/digital_ocean/digital_ocean_sshkey.py E325
-lib/ansible/modules/cloud/digital_ocean/digital_ocean_sshkey_facts.py E325
 lib/ansible/modules/cloud/dimensiondata/dimensiondata_network.py E325
 lib/ansible/modules/cloud/dimensiondata/dimensiondata_network.py E326
 lib/ansible/modules/cloud/dimensiondata/dimensiondata_vlan.py E324
