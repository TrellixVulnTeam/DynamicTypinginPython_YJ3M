commit 8bff781a0ae19cf39fb57a7fa8f0e8927ff7c88a
Author: Martin Froehlich <martin.j.froehlich@googlemail.com>
Date:   Sun Apr 26 14:50:07 2015 +0100

    Use get_aws_connection_info to get AWS creds.
    
    Previously used get_ec2_creds did not consider security_token,
    making MFA requests fail.

diff --git a/lib/ansible/modules/cloud/amazon/ec2.py b/lib/ansible/modules/cloud/amazon/ec2.py
index 09a4082428..516236ed3b 100755
--- a/lib/ansible/modules/cloud/amazon/ec2.py
+++ b/lib/ansible/modules/cloud/amazon/ec2.py
@@ -1207,15 +1207,11 @@ def main():
 
     ec2 = ec2_connect(module)
 
-    ec2_url, aws_access_key, aws_secret_key, region = get_ec2_creds(module)
+    region, ec2_url, aws_connect_kwargs = get_aws_connection_info(module)
 
     if region:
         try:
-            vpc = boto.vpc.connect_to_region(
-                region,
-                aws_access_key_id=aws_access_key,
-                aws_secret_access_key=aws_secret_key
-            )
+            vpc = boto.vpc.connect_to_region(region, **aws_connect_kwargs)
         except boto.exception.NoAuthHandlerFound, e:
             module.fail_json(msg = str(e))
     else:
