commit f2f11341a324064d3fdc932d7dc3cd6620d82784
Author: Alan Rominger <arominge@redhat.com>
Date:   Mon Mar 25 16:57:46 2019 -0400

    Avoid erroring on host group confusion in keyed groups (#54099)

diff --git a/lib/ansible/plugins/inventory/__init__.py b/lib/ansible/plugins/inventory/__init__.py
index 5330d42eb9..21bdac360d 100644
--- a/lib/ansible/plugins/inventory/__init__.py
+++ b/lib/ansible/plugins/inventory/__init__.py
@@ -428,7 +428,7 @@ class Constructable(object):
                         for bare_name in new_raw_group_names:
                             gname = self._sanitize_group_name('%s%s%s' % (prefix, sep, bare_name))
                             result_gname = self.inventory.add_group(gname)
-                            self.inventory.add_child(result_gname, host)
+                            self.inventory.add_host(host, result_gname)
 
                             if raw_parent_name:
                                 parent_name = self._sanitize_group_name(raw_parent_name)
diff --git a/test/units/plugins/inventory/test_constructed.py b/test/units/plugins/inventory/test_constructed.py
index 40f660c82f..4b7fb8afc7 100644
--- a/test/units/plugins/inventory/test_constructed.py
+++ b/test/units/plugins/inventory/test_constructed.py
@@ -93,6 +93,26 @@ def test_keyed_group_empty_construction(inventory_module):
     assert host.groups == []
 
 
+def test_keyed_group_host_confusion(inventory_module):
+    inventory_module.inventory.add_host('cow')
+    inventory_module.inventory.add_group('cow')
+    host = inventory_module.inventory.get_host('cow')
+    host.vars['species'] = 'cow'
+    keyed_groups = [
+        {
+            'separator': '',
+            'prefix': '',
+            'key': 'species'
+        }
+    ]
+    inventory_module._add_host_to_keyed_groups(
+        keyed_groups, host.vars, host.name, strict=True
+    )
+    group = inventory_module.inventory.groups['cow']
+    # group cow has host of cow
+    assert group.hosts == [host]
+
+
 def test_keyed_parent_groups(inventory_module):
     inventory_module.inventory.add_host('web1')
     inventory_module.inventory.add_host('web2')
