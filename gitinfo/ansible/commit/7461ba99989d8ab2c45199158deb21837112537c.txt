commit 7461ba99989d8ab2c45199158deb21837112537c
Author: Serge van Ginderachter <serge@vanginderachter.be>
Date:   Tue Sep 29 17:19:31 2015 +0200

    Inject existing groups at InventoryDir initialization
    
    This fixes a corner case where ini files live in a subdir
    of the main inventory directory.
    
    Reproducing the original error:
    
    mkdir -p inventory/ini
    cat > inventory/ini/hosts << EOF
    [www]
    www1
    EOF
    
    $ ansible -i inventory/ all -m ping
    ERROR! 'all'
    
    (or without the [www] group, it would complain about 'ungrouped')

diff --git a/lib/ansible/inventory/dir.py b/lib/ansible/inventory/dir.py
index 9394696d7f..7ae9611ddf 100644
--- a/lib/ansible/inventory/dir.py
+++ b/lib/ansible/inventory/dir.py
@@ -107,7 +107,7 @@ class InventoryDirectory(object):
                 continue
             fullpath = os.path.join(self.directory, i)
             if os.path.isdir(fullpath):
-                parser = InventoryDirectory(loader=loader, filename=fullpath)
+                parser = InventoryDirectory(loader=loader, groups=groups, filename=fullpath)
             else:
                 parser = get_file_parser(fullpath, self.groups, loader)
                 if parser is None:
