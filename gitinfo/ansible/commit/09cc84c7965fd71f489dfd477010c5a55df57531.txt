commit 09cc84c7965fd71f489dfd477010c5a55df57531
Author: giovannisciortino <30353557+giovannisciortino@users.noreply.github.com>
Date:   Tue Aug 15 19:07:31 2017 +0200

    Fixes #27635: pam_limits fix add comment (#27999)

diff --git a/lib/ansible/modules/system/pam_limits.py b/lib/ansible/modules/system/pam_limits.py
index 2977ef3468..bc5ce983eb 100644
--- a/lib/ansible/modules/system/pam_limits.py
+++ b/lib/ansible/modules/system/pam_limits.py
@@ -215,9 +215,6 @@ def main():
         if not new_comment:
             new_comment = old_comment
 
-        if new_comment:
-            new_comment = "\t#"+new_comment
-
         line_fields = newline.split(' ')
 
         if len(line_fields) != 4:
@@ -262,6 +259,8 @@ def main():
             # Change line only if value has changed
             if new_value != actual_value:
                 changed = True
+                if new_comment:
+                    new_comment = "\t#" + new_comment
                 new_limit = domain + "\t" + limit_type + "\t" + limit_item + "\t" + new_value + new_comment + "\n"
                 message = new_limit
                 nf.write(new_limit)
@@ -273,6 +272,8 @@ def main():
 
     if not found:
         changed = True
+        if new_comment:
+            new_comment = "\t#"+new_comment
         new_limit = domain + "\t" + limit_type + "\t" + limit_item + "\t" + new_value + new_comment + "\n"
         message = new_limit
         nf.write(new_limit)
