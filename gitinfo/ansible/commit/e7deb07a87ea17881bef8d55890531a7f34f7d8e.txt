commit e7deb07a87ea17881bef8d55890531a7f34f7d8e
Author: Tomas Dobrovolny <sdobrtomas@gmail.com>
Date:   Fri Jun 16 18:06:56 2017 +0200

    facts: Add linux virtio module detection (#25578)
    
    Detect as kvm guest if virtio linux kernel module is loaded

diff --git a/lib/ansible/module_utils/facts/virtual/linux.py b/lib/ansible/module_utils/facts/virtual/linux.py
index adb8ae4de2..09d94cfc57 100644
--- a/lib/ansible/module_utils/facts/virtual/linux.py
+++ b/lib/ansible/module_utils/facts/virtual/linux.py
@@ -215,6 +215,11 @@ class LinuxVirtual(Virtual):
                 virtual_facts['virtualization_role'] = 'host'
                 return virtual_facts
 
+            if 'virtio' in modules:
+                virtual_facts['virtualization_type'] = 'kvm'
+                virtual_facts['virtualization_role'] = 'guest'
+                return virtual_facts
+
         # If none of the above matches, return 'NA' for virtualization_type
         # and virtualization_role. This allows for proper grouping.
         virtual_facts['virtualization_type'] = 'NA'
