commit 85bbce9d6b2e0cc06642ae10fa8ff7b9c8ae5454
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Dec 21 11:48:18 2016 -0600

    Wrap unhandled errors from lookups in an AnsibleError
    
    This provides better error handling, and prevents errors like KeyError
    from bubbliing up to code in odd places.
    
    Fixes #17482

diff --git a/lib/ansible/template/__init__.py b/lib/ansible/template/__init__.py
index f0863eee47..422e7e68fc 100644
--- a/lib/ansible/template/__init__.py
+++ b/lib/ansible/template/__init__.py
@@ -431,7 +431,7 @@ class Templar:
                 raise AnsibleUndefinedVariable(e)
             except Exception as e:
                 if self._fail_on_lookup_errors:
-                    raise
+                    raise AnsibleError("An unhandled exception occurred while running the lookup plugin '%s'. Error was a %s, original message: %s" % (name, type(e), e))
                 ran = None
 
             if ran:
