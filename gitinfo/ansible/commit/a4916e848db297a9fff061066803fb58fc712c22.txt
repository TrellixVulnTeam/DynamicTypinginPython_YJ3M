commit a4916e848db297a9fff061066803fb58fc712c22
Author: Jocelyn Jaubert <jocelyn.jaubert@gmail.com>
Date:   Thu Aug 16 17:37:42 2018 +0200

    interfaces_file: Add test for multiple address_family for same iface

diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family.test_no_changes.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.exceptions.txt
new file mode 100644
index 0000000000..8d223b041b
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.exceptions.txt
@@ -0,0 +1,8 @@
+[0] fail_json message: Error: interface aggi not found
+options:
+{
+    "iface": "aggi",
+    "option": "up",
+    "state": "present",
+    "value": "route add -net 224.0.0.0 netmask 240.0.0.0 dev aggi"
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_aggi_up.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.exceptions.txt
new file mode 100644
index 0000000000..1c9adbd9fc
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.exceptions.txt
@@ -0,0 +1,17 @@
+[0] fail_json message: Error: interface aggi not found
+options:
+{
+    "iface": "aggi",
+    "option": "up",
+    "state": "present",
+    "value": "route add -net 224.0.0.0 netmask 240.0.0.0 dev aggi"
+}
+=====
+[1] fail_json message: Error: interface aggi not found
+options:
+{
+    "iface": "aggi",
+    "option": "up",
+    "state": "absent",
+    "value": null
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_add_and_delete_aggi_up.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method
new file mode 100644
index 0000000000..3e30d6b5a2
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet manual
+  address 192.168.0.1
+
+iface eth0 inet6 manual
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method.exceptions.txt
new file mode 100644
index 0000000000..e69de29bb2
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method.json
new file mode 100644
index 0000000000..2f8251eb0a
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_change_method.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "manual",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert.exceptions.txt
new file mode 100644
index 0000000000..e69de29bb2
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_revert.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu
new file mode 100644
index 0000000000..f8ec44e7a1
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu
@@ -0,0 +1,11 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
+  mtu 1350
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.exceptions.txt
new file mode 100644
index 0000000000..3f0da8b1c7
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.exceptions.txt
@@ -0,0 +1,8 @@
+[0] fail_json message: Error: interface aggi not found
+options:
+{
+    "iface": "aggi",
+    "option": "mtu",
+    "state": "present",
+    "value": "1350"
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_and_eth0_mtu.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.exceptions.txt b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.exceptions.txt
new file mode 100644
index 0000000000..0af87750b7
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.exceptions.txt
@@ -0,0 +1,8 @@
+[0] fail_json message: Error: interface aggi not found
+options:
+{
+    "iface": "aggi",
+    "option": "slaves",
+    "state": "present",
+    "value": "int1  int3"
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.json b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.json
new file mode 100644
index 0000000000..bd63594908
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/golden_output/address_family_set_aggi_slaves.json
@@ -0,0 +1,19 @@
+{
+    "eth0": {
+        "address": "fc00::1",
+        "address_family": "inet6",
+        "down": [],
+        "method": "static",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    },
+    "lo": {
+        "address_family": "inet",
+        "down": [],
+        "method": "loopback",
+        "post-up": [],
+        "pre-up": [],
+        "up": []
+    }
+}
\ No newline at end of file
diff --git a/test/units/modules/system/interfaces_file/fixtures/input/address_family b/test/units/modules/system/interfaces_file/fixtures/input/address_family
new file mode 100644
index 0000000000..26f9d012d0
--- /dev/null
+++ b/test/units/modules/system/interfaces_file/fixtures/input/address_family
@@ -0,0 +1,10 @@
+# The loopback network interface
+auto lo eth0
+iface lo inet loopback
+
+# The primary network interface
+iface eth0 inet static
+  address 192.168.0.1
+
+iface eth0 inet6 static
+  address fc00::1
