commit 9a9b1db62bb840b73203fe490d78825a55e751c0
Author: Ricardo Carrillo Cruz <ricardo.carrillo.cruz@gmail.com>
Date:   Fri Jul 7 10:40:18 2017 +0200

    Enable vyos_linkagg integration tests and test with 3 NICs (#26519)

diff --git a/test/integration/targets/vyos_linkagg/tests/cli/basic.yaml b/test/integration/targets/vyos_linkagg/tests/cli/basic.yaml
index d5ff4a0b62..3142d3da1b 100644
--- a/test/integration/targets/vyos_linkagg/tests/cli/basic.yaml
+++ b/test/integration/targets/vyos_linkagg/tests/cli/basic.yaml
@@ -4,12 +4,16 @@
     name: bond0
     state: absent
 
+- name: Remove linkagg
+  vyos_linkagg:
+    name: bond1
+    state: absent
+
 - name: Create linkagg
   vyos_linkagg:
     name: bond0
     members:
       - eth1
-      - eth2
     state: present
   register: result
 
@@ -18,14 +22,12 @@
       - 'result.changed == true'
       - '"set interfaces bonding bond0 mode 802.3ad" in result.commands'
       - '"set interfaces ethernet eth1 bond-group bond0" in result.commands'
-      - '"set interfaces ethernet eth2 bond-group bond0" in result.commands'
 
 - name: Create linkagg again (idempotent)
   vyos_linkagg:
     name: bond0
     members:
       - eth1
-      - eth2
     state: present
   register: result
 
@@ -37,20 +39,20 @@
   vyos_linkagg:
     name: bond0
     members:
-      - eth3
+      - eth2
     state: present
   register: result
 
 - assert:
     that:
       - 'result.changed == true'
-      - '"set interfaces ethernet eth3 bond-group bond0" in result.commands'
+      - '"set interfaces ethernet eth2 bond-group bond0" in result.commands'
 
 - name: Add linkagg member again (idempotent)
   vyos_linkagg:
     name: bond0
     members:
-      - eth3
+      - eth2
     state: present
   register: result
 
@@ -111,7 +113,6 @@
       - 'result.changed == true'
       - '"delete interfaces ethernet eth1 bond-group" in result.commands'
       - '"delete interfaces ethernet eth2 bond-group" in result.commands'
-      - '"delete interfaces ethernet eth3 bond-group" in result.commands'
       - '"delete interfaces bonding bond0" in result.commands'
 
 - name: Remove linkagg again (idempotent)
@@ -127,8 +128,8 @@
 - name: Create collection of linkagg definitions
   vyos_linkagg:
     collection:
-        - { name: bond0, members: [eth1, eth2] }
-        - { name: bond1, members: [eth3, eth4] }
+        - { name: bond0, members: [eth1] }
+        - { name: bond1, members: [eth2] }
     state: present
   register: result
 
@@ -137,16 +138,14 @@
       - 'result.changed == true'
       - '"set interfaces bonding bond0 mode 802.3ad" in result.commands'
       - '"set interfaces ethernet eth1 bond-group bond0" in result.commands'
-      - '"set interfaces ethernet eth2 bond-group bond0" in result.commands'
       - '"set interfaces bonding bond1 mode 802.3ad" in result.commands'
-      - '"set interfaces ethernet eth3 bond-group bond1" in result.commands'
-      - '"set interfaces ethernet eth4 bond-group bond1" in result.commands'
+      - '"set interfaces ethernet eth2 bond-group bond1" in result.commands'
 
 - name: Create collection of linkagg definitions again (idempotent)
   vyos_linkagg:
     collection:
-        - { name: bond0, members: [eth1, eth2] }
-        - { name: bond1, members: [eth3, eth4] }
+        - { name: bond0, members: [eth1] }
+        - { name: bond1, members: [eth2] }
     state: present
   register: result
 
@@ -166,9 +165,7 @@
     that:
       - 'result.changed == true'
       - '"delete interfaces ethernet eth1 bond-group" in result.commands'
-      - '"delete interfaces ethernet eth2 bond-group" in result.commands'
       - '"delete interfaces bonding bond0" in result.commands'
-      - '"delete interfaces ethernet eth1 bond-group" in result.commands'
       - '"delete interfaces ethernet eth2 bond-group" in result.commands'
       - '"delete interfaces bonding bond1" in result.commands'
 
diff --git a/test/integration/vyos.yaml b/test/integration/vyos.yaml
index 54be412010..8315d19871 100644
--- a/test/integration/vyos.yaml
+++ b/test/integration/vyos.yaml
@@ -42,12 +42,12 @@
       rescue:
         - set_fact: test_failed=true
 
-#    - block:
-#      - include_role:
-#          name: vyos_linkagg
-#        when: "limit_to in ['*', 'vyos_linkagg']"
-#      rescue:
-#        - set_fact: test_failed=true
+    - block:
+      - include_role:
+          name: vyos_linkagg
+        when: "limit_to in ['*', 'vyos_linkagg']"
+      rescue:
+        - set_fact: test_failed=true
 
 
 ###########
