commit 12ed39ef7b94b427e6125730786eb8a7a9cb0d84
Author: James Tanner <tanner.jc@gmail.com>
Date:   Wed Nov 27 13:04:10 2013 -0500

    Fixes #5056 Append new hosts to the groups cache

diff --git a/lib/ansible/runner/action_plugins/add_host.py b/lib/ansible/runner/action_plugins/add_host.py
index 2df7d3b818..ef27d99275 100644
--- a/lib/ansible/runner/action_plugins/add_host.py
+++ b/lib/ansible/runner/action_plugins/add_host.py
@@ -85,6 +85,13 @@ class ActionModule(object):
                     inventory.add_group(new_group)
                 grp = inventory.get_group(group_name)
                 grp.add_host(new_host)
+
+                # add this host to the group cache
+                if inventory._groups_list is not None:
+                    if group_name in inventory._groups_list:
+                        if new_host.name not in inventory._groups_list[group_name]:
+                            inventory._groups_list[group_name].append(new_host.name)
+
                 vv("added host to group via add_host module: %s" % group_name)
             result['new_groups'] = groupnames.split(",")
             
