commit b574c700064b3762045310bdaf4d914f3e7ffe07
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Fri Jul 20 10:00:51 2012 -0400

    host and group vars should update the setup cache

diff --git a/lib/ansible/playbook/play.py b/lib/ansible/playbook/play.py
index 3306c80c80..71eafc57de 100644
--- a/lib/ansible/playbook/play.py
+++ b/lib/ansible/playbook/play.py
@@ -213,10 +213,12 @@ class Play(object):
                 for x in groups:
                     path = os.path.join(basedir, "group_vars/%s" % x)
                     if os.path.exists(path):
-                        self.vars_files.append(path)
+                        data = utils.parse_yaml_from_file(path)
+                        self.playbook.SETUP_CACHE[host].update(data)
                 path = os.path.join(basedir, "host_vars/%s" % hostrec.name)
                 if os.path.exists(path):
-                    self.vars_files.append(path)
+                    data = utils.parse_yaml_from_file(path)
+                    self.playbook.SETUP_CACHE[host].update(data)
 
         for filename in self.vars_files:
 
