commit c85081e9a9b12e3b438ad78d41a8e0505d8d2571
Author: Serge van Ginderachter <serge@vanginderachter.be>
Date:   Thu Feb 27 18:06:34 2014 +0100

    Fixes templating of ansible_ssh_host for delegates

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index 207862857a..800774cfd1 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -308,7 +308,7 @@ class Runner(object):
 
         delegate = {}
 
-        # allow ansible_ssh_host to be templated
+        # allow delegated host to be templated
         delegate['host'] = template.template(self.basedir, host, 
                                 remote_inject, fail_on_undefined=True)
 
@@ -333,7 +333,10 @@ class Runner(object):
             this_info = {}
 
         # get the real ssh_address for the delegate        
-        delegate['ssh_host'] = this_info.get('ansible_ssh_host', delegate['host'])
+        # and allow ansible_ssh_host to be templated
+        delegate['ssh_host'] = template.template(self.basedir,
+                            this_info.get('ansible_ssh_host', this_host),
+                            this_info, fail_on_undefined=True)
 
         delegate['port'] = this_info.get('ansible_ssh_port', port)
 
