commit 6578e63e631fe79dc8fef43e90e7642e53385641
Author: nitzmahone <mdavis@ansible.com>
Date:   Fri Mar 18 08:50:07 2016 -0700

    improve test_test_infra debug messaging, rc check

diff --git a/test/integration/Makefile b/test/integration/Makefile
index 331022ce51..b02592eaf2 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -26,7 +26,8 @@ EUID := $(shell id -u -r)
 all: setup test_test_infra parsing test_var_precedence unicode test_templating_settings environment non_destructive destructive includes blocks pull check_mode test_hash test_handlers test_group_by test_vault test_tags test_lookup_paths no_log test_connection test_gathering_facts
 
 test_test_infra:
-	[ "$$(ansible-playbook -i $(INVENTORY) test_test_infra.yml -e @$(VARS_FILE) $(CREDENTIALS_ARG) $(TEST_FLAGS) | fgrep works | xargs)" = "msg: fail works (True) msg: assert works (True)" ]
+	# ensure fail/assert work and can stop execution with non-zero exit code
+	PB_OUT=$$(ansible-playbook -i $(INVENTORY) test_test_infra.yml -e @$(VARS_FILE) $(CREDENTIALS_ARG) $(TEST_FLAGS)) ; APB_RC=$$? ; echo "$$PB_OUT" ; echo "rc was $$APB_RC (must be non-zero)" ; [ $$APB_RC -ne 0 ]
 
 setup:
 	rm -rf $(TEST_DIR)
diff --git a/test/integration/test_test_infra.yml b/test/integration/test_test_infra.yml
index b78e36d2c9..48028ad8a7 100644
--- a/test/integration/test_test_infra.yml
+++ b/test/integration/test_test_infra.yml
@@ -3,14 +3,16 @@
   tags:
     - always
   tasks:
-  - fail:
+  - name: ensure fail action produces a failing result
+    fail:
     ignore_errors: yes
     register: fail_out
 
   - debug:
       msg: fail works ({{ fail_out.failed }})
 
-  - assert:
+  - name: ensure assert produces a failing result
+    assert:
       that: false
     ignore_errors: yes
     register: assert_out
@@ -18,6 +20,7 @@
   - debug:
       msg: assert works ({{ assert_out.failed }})
 
-  - fail:
-      msg: fail actually failed
+  - name: ensure fail action stops execution
+    fail:
+      msg: fail actually failed (this is expected)
 
