commit 99e657162fde9c0c5d71d4ade486a34d61ef19bd
Author: Matt Clay <matt@mystile.com>
Date:   Sat Feb 29 14:11:25 2020 -0800

    Fix ansible-test module_utils analysis.

diff --git a/changelogs/fragments/ansible-test-ast-parse-bytes.yml b/changelogs/fragments/ansible-test-ast-parse-bytes.yml
new file mode 100644
index 0000000000..330ee8f558
--- /dev/null
+++ b/changelogs/fragments/ansible-test-ast-parse-bytes.yml
@@ -0,0 +1,2 @@
+bugfixes:
+    - "ansible-test - Fix regression introduced in https://github.com/ansible/ansible/pull/67063 which caused module_utils analysis to fail on Python 2.x."
diff --git a/test/lib/ansible_test/_internal/import_analysis.py b/test/lib/ansible_test/_internal/import_analysis.py
index f1cb66353e..daefe33eda 100644
--- a/test/lib/ansible_test/_internal/import_analysis.py
+++ b/test/lib/ansible_test/_internal/import_analysis.py
@@ -8,7 +8,7 @@ import os
 from . import types as t
 
 from .io import (
-    read_text_file,
+    read_binary_file,
 )
 
 from .util import (
@@ -165,7 +165,10 @@ def extract_python_module_utils_imports(path, module_utils):
     :type module_utils: set[str]
     :rtype: set[str]
     """
-    code = read_text_file(path)
+    # Python code must be read as bytes to avoid a SyntaxError when the source uses comments to declare the file encoding.
+    # See: https://www.python.org/dev/peps/pep-0263
+    # Specifically: If a Unicode string with a coding declaration is passed to compile(), a SyntaxError will be raised.
+    code = read_binary_file(path)
 
     try:
         tree = ast.parse(code)
