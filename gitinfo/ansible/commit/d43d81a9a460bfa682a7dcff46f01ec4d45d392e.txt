commit d43d81a9a460bfa682a7dcff46f01ec4d45d392e
Author: Will Thames <will@thames.id.au>
Date:   Thu Aug 2 16:08:51 2012 +1000

    Raise exception when sudo user does not exist
    
    sudo can fail before getting to the password prompt if a user does not exist
    <pre>
    [will@tangerine ansible (sudo_missing_user)]$ sudo -u bobbins echo hello
    sudo: unknown user: bobbins
    sudo: unable to initialize policy plugin
    </pre>
    Fix raises a distinct exception when that occurs

diff --git a/lib/ansible/runner/connection/paramiko_ssh.py b/lib/ansible/runner/connection/paramiko_ssh.py
index 40aca903fe..c1f0e2a84d 100644
--- a/lib/ansible/runner/connection/paramiko_ssh.py
+++ b/lib/ansible/runner/connection/paramiko_ssh.py
@@ -105,7 +105,12 @@ class ParamikoConnection(object):
                     while not sudo_output.endswith(prompt):
                         chunk = chan.recv(bufsize)
                         if not chunk:
-                            raise errors.AnsibleError('ssh connection closed waiting for sudo password prompt')
+                            if 'unknown user' in sudo_output:
+                                raise errors.AnsibleError(
+                                    'user %s does not exist' % sudo_user)
+                            else:
+                                raise errors.AnsibleError('ssh connection ' +
+                                    'closed waiting for password prompt')
                         sudo_output += chunk
                     chan.sendall(self.runner.sudo_pass + '\n')
             except socket.timeout:
