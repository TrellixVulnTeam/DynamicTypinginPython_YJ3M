commit fa04387550de60921373f9d225745d7ca1f80712
Author: Yuwei Zhou <yuwzho@microsoft.com>
Date:   Tue Sep 11 18:52:43 2018 +0800

    fix the autoscale resource id (#45477)
    
    * fix the autoscale resource id
    
    * Update main.yml

diff --git a/lib/ansible/modules/cloud/azure/azure_rm_autoscale.py b/lib/ansible/modules/cloud/azure/azure_rm_autoscale.py
index 5db8e51685..dacc56d525 100644
--- a/lib/ansible/modules/cloud/azure/azure_rm_autoscale.py
+++ b/lib/ansible/modules/cloud/azure/azure_rm_autoscale.py
@@ -521,11 +521,11 @@ class AzureRMAutoScale(AzureRMModuleBase):
 
             resource_id = self.target
             if isinstance(self.target, dict):
-                resource_id = format_resource_id(val=self.target.name,
-                                                 subscription_id=self.target.subscription_id or self.subscription_id,
-                                                 namespace=self.target.namespace,
-                                                 types=self.target.types,
-                                                 resource_group=self.target.resource_group or self.resource_group)
+                resource_id = format_resource_id(val=self.target['name'],
+                                                 subscription_id=self.target.get('subscription_id') or self.subscription_id,
+                                                 namespace=self.target['namespace'],
+                                                 types=self.target['types'],
+                                                 resource_group=self.target.get('resource_group') or self.resource_group)
             self.target = resource_id
             resource_name = self.name
 
diff --git a/test/integration/targets/azure_rm_autoscale/tasks/main.yml b/test/integration/targets/azure_rm_autoscale/tasks/main.yml
index ab90d92030..af769c99bd 100644
--- a/test/integration/targets/azure_rm_autoscale/tasks/main.yml
+++ b/test/integration/targets/azure_rm_autoscale/tasks/main.yml
@@ -74,7 +74,10 @@
   azure_rm_autoscale:
     resource_group: "{{ resource_group }}"
     name: "{{ name }}"
-    target: "{{ vmss.ansible_facts.azure_vmss.id }}"
+    target:
+      name: "testVMSS{{ rpfx }}"
+      types: "virtualMachineScaleSets"
+      namespace: "Microsoft.Compute"
     enabled: true
     profiles:
     - count: '1'
