commit 83d1028a2146c14e6877acd484d3d1dbc47d738d
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Aug 27 23:06:39 2012 -0400

    - Makefile now works with freebsd (date command options are diff)
    date still issues warning and ignores TZ
    
    - Updated tests to work inside bsd jails (127 addresses are an issue)
    Signed-off-by: Brian Coca <briancoca+ansible@gmail.com>

diff --git a/Makefile b/Makefile
index 38c8e4493d..a8aa8250bb 100644
--- a/Makefile
+++ b/Makefile
@@ -1,5 +1,5 @@
 #!/usr/bin/make
-
+# WARN: gmake syntax
 ########################################################
 # Makefile for Ansible
 #
@@ -15,6 +15,7 @@
 # variable section
 
 NAME = "ansible"
+OS = $(shell uname -s)
 
 # Manpages are currently built with asciidoc -- would like to move to markdown
 # This doesn't evaluate until it's called. The -D argument is the
@@ -32,7 +33,12 @@ VERSION := $(shell cat VERSION)
 ifneq ($(shell which git),)
 GIT_DATE := $(shell git log -n 1 --format="%ai")
 endif
+
+ifeq ($(OS), FreeBSD)
+DATE := $(shell date -j -f "%Y-%m-%d %H:%M:%s"  "$(GIT_DATE)" +%Y%m%d%H%M)
+else
 DATE := $(shell date --date="$(GIT_DATE)" +%Y%m%d%H%M)
+endif
 
 # RPM build parameters
 RPMSPECDIR= packaging/rpm
diff --git a/test/TestPlayBook.py b/test/TestPlayBook.py
index 85ee178fb1..87f27910b8 100644
--- a/test/TestPlayBook.py
+++ b/test/TestPlayBook.py
@@ -137,7 +137,7 @@ class TestPlaybook(unittest.TestCase):
        print "**ACTUAL**"
        print utils.jsonify(actual, format=True)
        expected =  {
-            "127.0.0.2": {
+            "localhost": {
                 "changed": 9,
                 "failures": 0,
                 "ok": 11,
diff --git a/test/TestRunner.py b/test/TestRunner.py
index 44f358420c..6f6b518938 100644
--- a/test/TestRunner.py
+++ b/test/TestRunner.py
@@ -71,8 +71,8 @@ class TestRunner(unittest.TestCase):
         # when using nosetests this will only show up on failure
         # which is pretty useful
         print "RESULTS=%s" % results
-        assert "127.0.0.2" in results['contacted']
-        return results['contacted']['127.0.0.2']
+        assert "localhost" in results['contacted']
+        return results['contacted']['localhost']
 
     def test_ping(self):
         result = self._run('ping', [])
@@ -193,7 +193,7 @@ class TestRunner(unittest.TestCase):
 
     def test_fetch(self):
         input_ = self._get_test_file('sample.j2')
-        output = os.path.join(self.stage_dir, '127.0.0.2', input_)
+        output = os.path.join(self.stage_dir, 'localhost', input_)
         result = self._run('fetch', [ "src=%s" % input_, "dest=%s" % self.stage_dir ])
         assert os.path.exists(output)
         assert open(input_).read() == open(output).read()
diff --git a/test/ansible_hosts b/test/ansible_hosts
index bff3d17c4b..94074edc3c 100644
--- a/test/ansible_hosts
+++ b/test/ansible_hosts
@@ -1,2 +1,2 @@
 [somegroup]
-127.0.0.2
+localhost
diff --git a/test/assemble.d/01-source.txt b/test/assemble.d/01-source.txt
index fc88cb924e..099d99e168 100644
--- a/test/assemble.d/01-source.txt
+++ b/test/assemble.d/01-source.txt
@@ -1,2 +1,2 @@
 # This is the second comment.
-127.0.0.2
+localhost
