commit e74d397c01a571285a007e996af7a24b8d69d833
Author: Shachaf92 <shachaf.gold@gmail.com>
Date:   Wed Nov 13 01:05:16 2019 +0200

    setup.ps1 - parity with linux regarding missing local facts path (#58887)
    
    * setup.ps1 - parity with linux regarding missing local facts path
    
    * add warning
    
    * Update setup.ps1-parity-with-linux-regarding-missing-local-facts-path.yml

diff --git a/changelogs/fragments/setup.ps1-parity-with-linux-regarding-missing-local-facts-path.yml b/changelogs/fragments/setup.ps1-parity-with-linux-regarding-missing-local-facts-path.yml
new file mode 100644
index 0000000000..e43747c238
--- /dev/null
+++ b/changelogs/fragments/setup.ps1-parity-with-linux-regarding-missing-local-facts-path.yml
@@ -0,0 +1,2 @@
+minor_changes:
+- "setup.ps1 - parity with linux regarding missing local facts path (https://github.com/ansible/ansible/issues/57974)"
diff --git a/lib/ansible/modules/windows/setup.ps1 b/lib/ansible/modules/windows/setup.ps1
index 652d2b0b72..3422163d88 100644
--- a/lib/ansible/modules/windows/setup.ps1
+++ b/lib/ansible/modules/windows/setup.ps1
@@ -12,15 +12,17 @@ Function Get-CustomFacts {
     $factpath = $null
   )
 
-  if (-not (Test-Path -Path $factpath)) {
-    Fail-Json $result "The path $factpath does not exist. Typo?"
-  }
-
-  $FactsFiles = Get-ChildItem -Path $factpath | Where-Object -FilterScript {($PSItem.PSIsContainer -eq $false) -and ($PSItem.Extension -eq '.ps1')}
+  if (Test-Path -Path $factpath) {
+    $FactsFiles = Get-ChildItem -Path $factpath | Where-Object -FilterScript {($PSItem.PSIsContainer -eq $false) -and ($PSItem.Extension -eq '.ps1')}
 
-  foreach ($FactsFile in $FactsFiles) {
-      $out = & $($FactsFile.FullName)
-      $result.ansible_facts.Add("ansible_$(($FactsFile.Name).Split('.')[0])", $out)
+    foreach ($FactsFile in $FactsFiles) {
+        $out = & $($FactsFile.FullName)
+        $result.ansible_facts.Add("ansible_$(($FactsFile.Name).Split('.')[0])", $out)
+    }
+  }
+  else
+  {
+        Add-Warning $result "Non existing path was set for local facts - $factpath"
   }
 }
 
