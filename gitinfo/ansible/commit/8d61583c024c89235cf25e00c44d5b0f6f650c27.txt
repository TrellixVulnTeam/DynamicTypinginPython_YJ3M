commit 8d61583c024c89235cf25e00c44d5b0f6f650c27
Author: Abhijeet Kasurde <akasurde@redhat.com>
Date:   Tue Dec 12 07:57:34 2017 +0530

    VMware: add trailing / in case of nested folders (#33479)
    
    This fix adds a trailing / in case of nested folders.
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/lib/ansible/modules/cloud/vmware/vmware_guest.py b/lib/ansible/modules/cloud/vmware/vmware_guest.py
index 185ac9b1fd..38eacf4d86 100644
--- a/lib/ansible/modules/cloud/vmware/vmware_guest.py
+++ b/lib/ansible/modules/cloud/vmware/vmware_guest.py
@@ -1339,13 +1339,17 @@ class PyVmomiHelper(PyVmomi):
 
         dcpath = compile_folder_path_for_object(datacenter)
 
+        # Nested folder does not have trailing /
+        if not dcpath.endswith('/'):
+            dcpath += '/'
+
         # Check for full path first in case it was already supplied
         if (self.params['folder'].startswith(dcpath + self.params['datacenter'] + '/vm') or
                 self.params['folder'].startswith(dcpath + '/' + self.params['datacenter'] + '/vm')):
             fullpath = self.params['folder']
-        elif (self.params['folder'].startswith('/vm/') or self.params['folder'] == '/vm'):
+        elif self.params['folder'].startswith('/vm/') or self.params['folder'] == '/vm':
             fullpath = "%s%s%s" % (dcpath, self.params['datacenter'], self.params['folder'])
-        elif (self.params['folder'].startswith('/')):
+        elif self.params['folder'].startswith('/'):
             fullpath = "%s%s/vm%s" % (dcpath, self.params['datacenter'], self.params['folder'])
         else:
             fullpath = "%s%s/vm/%s" % (dcpath, self.params['datacenter'], self.params['folder'])
