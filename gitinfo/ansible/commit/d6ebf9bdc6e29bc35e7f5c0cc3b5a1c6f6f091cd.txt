commit d6ebf9bdc6e29bc35e7f5c0cc3b5a1c6f6f091cd
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Mon Sep 5 19:40:50 2016 -0700

    Symink integration tests for fetch and stat

diff --git a/test/integration/roles/test_fetch/tasks/main.yml b/test/integration/roles/test_fetch/tasks/main.yml
index e14dc2fdad..2b4aef90a0 100644
--- a/test/integration/roles/test_fetch/tasks/main.yml
+++ b/test/integration/roles/test_fetch/tasks/main.yml
@@ -69,3 +69,29 @@
     that:
       - "not fetch_dir|changed"
       - "fetch_dir.msg"
+
+- name: create symlink to a file that we can fetch
+  file:
+    path: "{{ output_dir }}/link"
+    src: "{{ output_dir }}/orig"
+    state: "link"
+
+- name: fetch the file via a symlink
+  fetch: src={{ output_dir }}/link dest={{ output_dir }}/fetched-link
+  register: fetched
+
+- debug: var=fetched
+
+# TODO: check the sudo and non-sudo forms of fetch because in one form we'll do
+# the get method of the connection plugin and in the sudo case we'll use the
+# fetch module.
+
+- name: diff what we fetched with the original file
+  shell: diff {{ output_dir }}/orig {{ output_dir }}/fetched-link/{{inventory_hostname}}{{ output_dir | expanduser }}/link
+  register: diff
+
+- name: check the diff to make sure they are the same
+  assert:
+    that:
+      'diff.stdout == ""'
+
diff --git a/test/integration/roles/test_stat/tasks/main.yml b/test/integration/roles/test_stat/tasks/main.yml
index 0019fda2ae..0a5ab5f796 100644
--- a/test/integration/roles/test_stat/tasks/main.yml
+++ b/test/integration/roles/test_stat/tasks/main.yml
@@ -25,45 +25,146 @@
 
 - debug: var=stat_result
 
-- assert: 
-    that: 
+- assert:
+    that:
+        - "'changed' in stat_result"
+        - "stat_result.changed == false"
+        - "'stat' in stat_result"
+        - "'atime' in stat_result.stat"
+        - "'ctime' in stat_result.stat"
+        - "'dev' in stat_result.stat"
+        - "'exists' in stat_result.stat"
+        - "'gid' in stat_result.stat"
+        - "'inode' in stat_result.stat"
+        - "'isblk' in stat_result.stat"
+        - "'ischr' in stat_result.stat"
+        - "'isdir' in stat_result.stat"
+        - "'isfifo' in stat_result.stat"
+        - "'isgid' in stat_result.stat"
+        - "'isreg' in stat_result.stat"
+        - "'issock' in stat_result.stat"
+        - "'isuid' in stat_result.stat"
+        - "'md5' in stat_result.stat"
+        - "'checksum' in stat_result.stat"
+        - "stat_result.stat.checksum == '2aae6c35c94fcfb415dbe95f408b9ce91ee846ed'"
+        - "'mode' in stat_result.stat"
+        - "'mtime' in stat_result.stat"
+        - "'nlink' in stat_result.stat"
+        - "'pw_name' in stat_result.stat"
+        - "'rgrp' in stat_result.stat"
+        - "'roth' in stat_result.stat"
+        - "'rusr' in stat_result.stat"
+        - "'size' in stat_result.stat"
+        - "'uid' in stat_result.stat"
+        - "'wgrp' in stat_result.stat"
+        - "'woth' in stat_result.stat"
+        - "'wusr' in stat_result.stat"
+        - "'xgrp' in stat_result.stat"
+        - "'xoth' in stat_result.stat"
+        - "'xusr' in stat_result.stat"
+
+- assert:
+    that:
+      - "stat_result.stat.md5 == '5eb63bbbe01eeed093cb22bb8f5acdc3'"
+  when: ansible_fips != True
+
+- name: make a symlink
+  file:
+    src: "{{ output_dir }}/foo.txt"
+    path: "{{ output_dir }}/foo-link"
+    state: link
+
+- name: check stat of a symlink with follow off
+  stat:
+    path: "{{ output_dir }}/foo-link"
+  register: stat_result
+
+- debug: var=stat_result
+
+- assert:
+    that:
+        - "'changed' in stat_result"
+        - "stat_result.changed == false"
+        - "'stat' in stat_result"
+        - "'atime' in stat_result.stat"
+        - "'ctime' in stat_result.stat"
+        - "'dev' in stat_result.stat"
+        - "'exists' in stat_result.stat"
+        - "'gid' in stat_result.stat"
+        - "'inode' in stat_result.stat"
+        - "'isblk' in stat_result.stat"
+        - "'ischr' in stat_result.stat"
+        - "'isdir' in stat_result.stat"
+        - "'isfifo' in stat_result.stat"
+        - "'isgid' in stat_result.stat"
+        - "'isreg' in stat_result.stat"
+        - "'issock' in stat_result.stat"
+        - "'isuid' in stat_result.stat"
+        - "'islnk' in stat_result.stat"
+        - "'mode' in stat_result.stat"
+        - "'mtime' in stat_result.stat"
+        - "'nlink' in stat_result.stat"
+        - "'pw_name' in stat_result.stat"
+        - "'rgrp' in stat_result.stat"
+        - "'roth' in stat_result.stat"
+        - "'rusr' in stat_result.stat"
+        - "'size' in stat_result.stat"
+        - "'uid' in stat_result.stat"
+        - "'wgrp' in stat_result.stat"
+        - "'woth' in stat_result.stat"
+        - "'wusr' in stat_result.stat"
+        - "'xgrp' in stat_result.stat"
+        - "'xoth' in stat_result.stat"
+        - "'xusr' in stat_result.stat"
+
+- name: check stat of a symlink with follow on
+  stat:
+    path: "{{ output_dir }}/foo-link"
+    follow: True
+  register: stat_result
+
+- debug: var=stat_result
+
+- assert:
+    that:
         - "'changed' in stat_result"
         - "stat_result.changed == false"
         - "'stat' in stat_result"
-        - "'atime' in stat_result.stat" 
-        - "'ctime' in stat_result.stat" 
-        - "'dev' in stat_result.stat" 
-        - "'exists' in stat_result.stat" 
-        - "'gid' in stat_result.stat" 
-        - "'inode' in stat_result.stat" 
-        - "'isblk' in stat_result.stat" 
-        - "'ischr' in stat_result.stat" 
-        - "'isdir' in stat_result.stat" 
-        - "'isfifo' in stat_result.stat" 
-        - "'isgid' in stat_result.stat" 
-        - "'isreg' in stat_result.stat" 
-        - "'issock' in stat_result.stat" 
-        - "'isuid' in stat_result.stat" 
+        - "'atime' in stat_result.stat"
+        - "'ctime' in stat_result.stat"
+        - "'dev' in stat_result.stat"
+        - "'exists' in stat_result.stat"
+        - "'gid' in stat_result.stat"
+        - "'inode' in stat_result.stat"
+        - "'isblk' in stat_result.stat"
+        - "'ischr' in stat_result.stat"
+        - "'isdir' in stat_result.stat"
+        - "'isfifo' in stat_result.stat"
+        - "'isgid' in stat_result.stat"
+        - "'isreg' in stat_result.stat"
+        - "'issock' in stat_result.stat"
+        - "'isuid' in stat_result.stat"
         - "'md5' in stat_result.stat"
         - "'checksum' in stat_result.stat"
         - "stat_result.stat.checksum == '2aae6c35c94fcfb415dbe95f408b9ce91ee846ed'"
-        - "'mode' in stat_result.stat" # why is this 420?
-        - "'mtime' in stat_result.stat" 
-        - "'nlink' in stat_result.stat" 
-        - "'pw_name' in stat_result.stat" 
-        - "'rgrp' in stat_result.stat" 
-        - "'roth' in stat_result.stat" 
-        - "'rusr' in stat_result.stat" 
-        - "'size' in stat_result.stat" 
-        - "'uid' in stat_result.stat" 
-        - "'wgrp' in stat_result.stat" 
-        - "'woth' in stat_result.stat" 
-        - "'wusr' in stat_result.stat" 
-        - "'xgrp' in stat_result.stat" 
-        - "'xoth' in stat_result.stat" 
-        - "'xusr' in stat_result.stat" 
+        - "'mode' in stat_result.stat"
+        - "'mtime' in stat_result.stat"
+        - "'nlink' in stat_result.stat"
+        - "'pw_name' in stat_result.stat"
+        - "'rgrp' in stat_result.stat"
+        - "'roth' in stat_result.stat"
+        - "'rusr' in stat_result.stat"
+        - "'size' in stat_result.stat"
+        - "'uid' in stat_result.stat"
+        - "'wgrp' in stat_result.stat"
+        - "'woth' in stat_result.stat"
+        - "'wusr' in stat_result.stat"
+        - "'xgrp' in stat_result.stat"
+        - "'xoth' in stat_result.stat"
+        - "'xusr' in stat_result.stat"
 
 - assert:
     that:
       - "stat_result.stat.md5 == '5eb63bbbe01eeed093cb22bb8f5acdc3'"
   when: ansible_fips != True
+
