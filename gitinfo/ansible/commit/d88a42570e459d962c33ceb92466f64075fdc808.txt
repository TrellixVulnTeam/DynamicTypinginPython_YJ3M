commit d88a42570e459d962c33ceb92466f64075fdc808
Author: Victor Schr√∂der <schrodervictor@gmail.com>
Date:   Mon Jun 29 21:56:36 2015 +0200

    Adds a check for 'not None' values when iterating ElastiCache SecurityGroups keys

diff --git a/plugins/inventory/ec2.py b/plugins/inventory/ec2.py
index e07efac4c0..081990cd8f 100755
--- a/plugins/inventory/ec2.py
+++ b/plugins/inventory/ec2.py
@@ -791,7 +791,11 @@ class Ec2Inventory(object):
 
         # Inventory: Group by security group
         if self.group_by_security_group and not is_redis:
-            if 'SecurityGroups' in cluster:
+
+            # Check for the existance of the 'SecurityGroups' key and also if
+            # this key has some value. When the cluster is not placed in a SG
+            # the query can return None here and cause an error.
+            if 'SecurityGroups' in cluster and cluster['SecurityGroups'] is not None:
                 for security_group in cluster['SecurityGroups']:
                     key = self.to_safe("security_group_" + security_group['SecurityGroupId'])
                     self.push(self.inventory, key, dest)
@@ -879,7 +883,11 @@ class Ec2Inventory(object):
 
         # Inventory: Group by security group
         if self.group_by_security_group:
-            if 'SecurityGroups' in cluster:
+
+            # Check for the existance of the 'SecurityGroups' key and also if
+            # this key has some value. When the cluster is not placed in a SG
+            # the query can return None here and cause an error.
+            if 'SecurityGroups' in cluster and cluster['SecurityGroups'] is not None:
                 for security_group in cluster['SecurityGroups']:
                     key = self.to_safe("security_group_" + security_group['SecurityGroupId'])
                     self.push(self.inventory, key, dest)
