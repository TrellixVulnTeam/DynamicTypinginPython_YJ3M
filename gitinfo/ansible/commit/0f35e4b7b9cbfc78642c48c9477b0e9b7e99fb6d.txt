commit 0f35e4b7b9cbfc78642c48c9477b0e9b7e99fb6d
Author: Sam Doran <sdoran@redhat.com>
Date:   Wed Aug 14 03:43:52 2019 -0400

    apt_facts - Fix cache related performance regression (#60511)
    
    * apt_facts - Fix cache related performance regression
    
    * Another minor performance improvement

diff --git a/changelogs/fragments/package_facts-performace-regression-fix.yaml b/changelogs/fragments/package_facts-performace-regression-fix.yaml
new file mode 100644
index 0000000000..7ad167f00d
--- /dev/null
+++ b/changelogs/fragments/package_facts-performace-regression-fix.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+  - apt_facts - fix performance regression when getting facts about apt packages (https://github.com/ansible/ansible/issues/60450)
diff --git a/lib/ansible/modules/packaging/os/package_facts.py b/lib/ansible/modules/packaging/os/package_facts.py
index 1c7fbb3192..a0032972bc 100644
--- a/lib/ansible/modules/packaging/os/package_facts.py
+++ b/lib/ansible/modules/packaging/os/package_facts.py
@@ -192,7 +192,7 @@ class APT(LibMgr):
 
     @property
     def pkg_cache(self):
-        if self._cache:
+        if self._cache is not None:
             return self._cache
 
         self._cache = self._lib.Cache()
@@ -209,7 +209,9 @@ class APT(LibMgr):
         return we_have_lib
 
     def list_installed(self):
-        return [pk for pk in self.pkg_cache.keys() if self.pkg_cache[pk].is_installed]
+        # Store the cache to avoid running pkg_cache() for each item in the comprehension, which is very slow
+        cache = self.pkg_cache
+        return [pk for pk in cache.keys() if cache[pk].is_installed]
 
     def get_package_details(self, package):
         ac_pkg = self.pkg_cache[package].installed
