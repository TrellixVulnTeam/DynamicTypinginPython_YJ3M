commit ee50792416f2bea2bcc5b811cc5f54c5bfe0c2a1
Author: Matt Clay <matt@mystile.com>
Date:   Mon Jan 27 17:19:42 2020 -0800

    Add a `--no-pip-check` option to ansible-test.

diff --git a/changelogs/fragments/ansible-test-no-pip-check.yml b/changelogs/fragments/ansible-test-no-pip-check.yml
new file mode 100644
index 0000000000..1c119d4a82
--- /dev/null
+++ b/changelogs/fragments/ansible-test-no-pip-check.yml
@@ -0,0 +1,2 @@
+minor_changes:
+- "ansible-test - added a ``--no-pip-check`` option"
diff --git a/test/lib/ansible_test/_internal/cli.py b/test/lib/ansible_test/_internal/cli.py
index 95aa700d8c..cf64e603a0 100644
--- a/test/lib/ansible_test/_internal/cli.py
+++ b/test/lib/ansible_test/_internal/cli.py
@@ -643,6 +643,12 @@ def add_environments(parser, isolated_delegation=True):
                         default=None,
                         help='path to the docker or remote python interpreter')
 
+    parser.add_argument('--no-pip-check',
+                        dest='pip_check',
+                        default=True,
+                        action='store_false',
+                        help='do not run "pip check" to verify requirements')
+
     environments = parser.add_mutually_exclusive_group()
 
     environments.add_argument('--local',
diff --git a/test/lib/ansible_test/_internal/config.py b/test/lib/ansible_test/_internal/config.py
index 3cad3f3747..5b2b6c9e9e 100644
--- a/test/lib/ansible_test/_internal/config.py
+++ b/test/lib/ansible_test/_internal/config.py
@@ -80,6 +80,8 @@ class EnvironmentConfig(CommonConfig):
         self.python_version = self.python or actual_major_minor
         self.python_interpreter = args.python_interpreter
 
+        self.pip_check = args.pip_check
+
         self.delegate = self.docker or self.remote or self.venv
         self.delegate_args = []  # type: t.List[str]
 
diff --git a/test/lib/ansible_test/_internal/executor.py b/test/lib/ansible_test/_internal/executor.py
index caed48d93c..ef54d6f6d1 100644
--- a/test/lib/ansible_test/_internal/executor.py
+++ b/test/lib/ansible_test/_internal/executor.py
@@ -237,14 +237,15 @@ def install_command_requirements(args, python_version=None):
             raise ApplicationError('Conflicts detected in requirements. The following commands reported changes during verification:\n%s' %
                                    '\n'.join((' '.join(cmd_quote(c) for c in cmd) for cmd in changes)))
 
-    # ask pip to check for conflicts between installed packages
-    try:
-        run_command(args, pip + ['check', '--disable-pip-version-check'], capture=True)
-    except SubprocessError as ex:
-        if ex.stderr.strip() == 'ERROR: unknown command "check"':
-            display.warning('Cannot check pip requirements for conflicts because "pip check" is not supported.')
-        else:
-            raise
+    if args.pip_check:
+        # ask pip to check for conflicts between installed packages
+        try:
+            run_command(args, pip + ['check', '--disable-pip-version-check'], capture=True)
+        except SubprocessError as ex:
+            if ex.stderr.strip() == 'ERROR: unknown command "check"':
+                display.warning('Cannot check pip requirements for conflicts because "pip check" is not supported.')
+            else:
+                raise
 
 
 def run_pip_commands(args, pip, commands, detect_pip_changes=False):
