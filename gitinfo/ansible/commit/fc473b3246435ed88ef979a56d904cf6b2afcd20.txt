commit fc473b3246435ed88ef979a56d904cf6b2afcd20
Author: James Tanner <tanner.jc@gmail.com>
Date:   Fri Jan 3 09:46:16 2014 -0500

    Fixes #5146 Handle missing stdin when running under celery with rabbitmq or redis

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index 3318bcba2b..92b25788d0 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -405,8 +405,13 @@ class Runner(object):
             return flags
 
         try:
-            if not new_stdin:
-                self._new_stdin = os.fdopen(os.dup(sys.stdin.fileno()))
+            fileno = sys.stdin.fileno()
+        except ValueError:
+            fileno = None
+
+        try:
+            if not new_stdin and fileno is not None:
+                self._new_stdin = os.fdopen(os.dup(fileno))
             else:
                 self._new_stdin = new_stdin
 
