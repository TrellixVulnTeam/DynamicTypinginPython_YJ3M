commit d668d53112cbb57d812dfff46f7e93fae033d42b
Author: Peter Sprygada <privateip@users.noreply.github.com>
Date:   Thu Jan 26 09:30:38 2017 -0500

    checks connected property to validate connection in Server (#20695)
    
    fixes #20693

diff --git a/bin/ansible-connection b/bin/ansible-connection
index d15962e3e1..c198478570 100755
--- a/bin/ansible-connection
+++ b/bin/ansible-connection
@@ -120,8 +120,8 @@ class Server():
         self._start_time = datetime.datetime.now()
 
         self.conn = connection_loader.get(play_context.connection, play_context, sys.stdin)
-        rc, out, err = self.conn._connect()
-        if rc != 0:
+        self.conn._connect()
+        if not self.conn.connected:
             raise AnsibleConnectionFailure(err)
 
         self.socket = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
