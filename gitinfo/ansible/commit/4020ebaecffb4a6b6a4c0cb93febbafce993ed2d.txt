commit 4020ebaecffb4a6b6a4c0cb93febbafce993ed2d
Author: Rene Moser <mail@renemoser.net>
Date:   Fri Jun 26 11:56:28 2015 +0200

    cloudstack: fix state=expunged in cs_instance

diff --git a/lib/ansible/modules/extras/cloud/cloudstack/cs_instance.py b/lib/ansible/modules/extras/cloud/cloudstack/cs_instance.py
index 321e03023b..f9f7c54bea 100644
--- a/lib/ansible/modules/extras/cloud/cloudstack/cs_instance.py
+++ b/lib/ansible/modules/extras/cloud/cloudstack/cs_instance.py
@@ -633,7 +633,7 @@ class AnsibleCloudStackInstance(AnsibleCloudStack):
             if instance['state'].lower() in [ 'destroying', 'destroyed' ]:
                 self.result['changed'] = True
                 if not self.module.check_mode:
-                    res = self.cs.expungeVirtualMachine(id=instance['id'])
+                    res = self.cs.destroyVirtualMachine(id=instance['id'], expunge=True)
 
             elif instance['state'].lower() not in [ 'expunging' ]:
                 self.result['changed'] = True
@@ -645,7 +645,7 @@ class AnsibleCloudStackInstance(AnsibleCloudStack):
 
             poll_async = self.module.params.get('poll_async')
             if poll_async:
-                instance = self._poll_job(res, 'virtualmachine')
+                res = self._poll_job(res, 'virtualmachine')
         return instance
 
 
