commit 73a2ee73182629c810f78c20ce9a430a7ddb540f
Author: Sam Doran <sdoran@redhat.com>
Date:   Fri Nov 15 17:01:23 2019 -0500

    Fix mysql_replication integration test for CentOS 8 (#64870)

diff --git a/test/integration/targets/mysql_replication/tasks/main.yml b/test/integration/targets/mysql_replication/tasks/main.yml
index 9f5c76a701..6538d89ad2 100644
--- a/test/integration/targets/mysql_replication/tasks/main.yml
+++ b/test/integration/targets/mysql_replication/tasks/main.yml
@@ -3,16 +3,24 @@
 
 # Initial CI tests of mysql_replication module:
 - import_tasks: mysql_replication_initial.yml
-  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version >= '7'
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - ansible_facts.distribution_major_version is version('7', '==')
 
 # Tests of master_delay parameter:
 - import_tasks: mysql_replication_master_delay.yml
-  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version >= '7'
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - ansible_facts.distribution_major_version is version('7', '==')
 
 # Tests of channel parameter:
 - import_tasks: mysql_replication_channel.yml
-  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version >= '7'
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - ansible_facts.distribution_major_version is version('7', '==')
 
 # Tests of resetmaster mode:
 - import_tasks: mysql_replication_resetmaster_mode.yml
-  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version >= '7'
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - ansible_facts.distribution_major_version is version('7', '==')
diff --git a/test/integration/targets/setup_mysql_replication/defaults/main.yml b/test/integration/targets/setup_mysql_replication/defaults/main.yml
index 1608b04f6e..ad06a0ad19 100644
--- a/test/integration/targets/setup_mysql_replication/defaults/main.yml
+++ b/test/integration/targets/setup_mysql_replication/defaults/main.yml
@@ -1,4 +1,5 @@
-repo_link: https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm
+# There is no MySQL 5.7 for RHEL 8. This will need to be retooled to use 8.0 for RHEL 8 or use the setup_mysql8 role for everything
+repo_link: https://repo.mysql.com/mysql57-community-release-el{{ ansible_facts.distribution_major_version }}.rpm
 repo_name: mysql-community
 mysql_package_name: mysql-community-server
 
diff --git a/test/integration/targets/setup_mysql_replication/tasks/main.yml b/test/integration/targets/setup_mysql_replication/tasks/main.yml
index 1f18ff6064..0f507f74f1 100644
--- a/test/integration/targets/setup_mysql_replication/tasks/main.yml
+++ b/test/integration/targets/setup_mysql_replication/tasks/main.yml
@@ -3,4 +3,6 @@
 
 # Setup MySQL master-standby replication into one container:
 - import_tasks: setup_mysql_cluster.yml
-  when: ansible_distribution == 'CentOS' and ansible_distribution_major_version >= '7'
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - ansible_facts.distribution_major_version is version('7', '==')
