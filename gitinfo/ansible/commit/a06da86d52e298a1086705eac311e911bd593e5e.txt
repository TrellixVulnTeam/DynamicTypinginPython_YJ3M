commit a06da86d52e298a1086705eac311e911bd593e5e
Author: Steve Gargan <steve.gargan@intercom.io>
Date:   Fri Sep 16 23:58:17 2016 +0200

    update consul tests to reflect fixes to the core and session modules (#17451)

diff --git a/test/integration/roles/test_consul_acl/tasks/main.yml b/test/integration/roles/test_consul_acl/tasks/main.yml
index 1448c63741..2dd6eb3ef1 100644
--- a/test/integration/roles/test_consul_acl/tasks/main.yml
+++ b/test/integration/roles/test_consul_acl/tasks/main.yml
@@ -29,7 +29,7 @@
       - with_rules.token | length == 36
       - with_rules.name == 'With rule'
       - with_rules.rules | match('.*"foo".*')
-      - with_rules.rules | match('.*"private/foo".*')
+      - with_rules.rules | search(pattern='private/foo')
 
 - name: clear up
   consul_acl:
diff --git a/test/integration/roles/test_consul_kv/tasks/main.yml b/test/integration/roles/test_consul_kv/tasks/main.yml
index 4aff909418..0a7b01082c 100644
--- a/test/integration/roles/test_consul_kv/tasks/main.yml
+++ b/test/integration/roles/test_consul_kv/tasks/main.yml
@@ -5,7 +5,7 @@
     name: 'ACL rule for testing'
     rules:
       - key: 'somekey'
-        policy: all
+        policy: write
   register: test_acl
 
 - name: cleanup from previous failed runs
diff --git a/test/integration/roles/test_consul_session/tasks/main.yml b/test/integration/roles/test_consul_session/tasks/main.yml
index 7e556aa690..aa5d49a2f9 100644
--- a/test/integration/roles/test_consul_session/tasks/main.yml
+++ b/test/integration/roles/test_consul_session/tasks/main.yml
@@ -1,3 +1,4 @@
+
 - name: register basic session with consul
   consul_session:
     name: session1
@@ -13,8 +14,10 @@
 - name: add checks for session health check
   consul:
     check_name: session_check
-    script: /usr/bin/true
-    interval: 15
+    script: /bin/true
+    interval: 1
+
+- pause: seconds=2
 
 - name: register a session with check
   consul_session:
@@ -43,7 +46,7 @@
         - with_delay.changed
         - with_delay.session_id | length == 36
         - with_delay.name == 'session_with_delay'
-        - with_delay.delay == 20
+        - with_delay.delay == "20"
 
 
 - name: retrieve session by id
@@ -65,11 +68,9 @@
       - 3 <= retrieved_by_list.sessions[0]
 
 - name: remove sessions
-  consul_session: id={{item}} state=absent
-  with_items:
-    - basic_result.session_id
-    - with_check.session_id
-    - with_delay.session_id
+  consul_session: id='{{basic_result.session_id}}' state=absent
+- consul_session: id='{{with_check.session_id}}' state=absent
+- consul_session: id='{{with_delay.session_id}}' state=absent
 
 - name: remove check
   consul:
