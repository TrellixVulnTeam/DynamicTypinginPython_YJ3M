commit 9d27d7c8b1028a0ced61934ad9050854fb02602c
Author: Sam Doran <sdoran@redhat.com>
Date:   Wed Jul 15 18:22:44 2020 -0400

    ansible_runner test - Add constraints (#70667)
    
    A recent updated to psutil, which is a dependency of ansible-runner, fails
    to install on older versions of pip.
    
    Commit with the breaking change:
    
      https://github.com/giampaolo/psutil/commit/135628639bd6d73b5e88aefe300acd13a04a858d

diff --git a/changelogs/fragments/test-ansible-runner-pin-psutil.yml b/changelogs/fragments/test-ansible-runner-pin-psutil.yml
new file mode 100644
index 0000000000..99de860bde
--- /dev/null
+++ b/changelogs/fragments/test-ansible-runner-pin-psutil.yml
@@ -0,0 +1,2 @@
+bugfixes:
+  - add constraints file for ``anisble_runner`` test since an update to ``psutil`` is now causing test failures
diff --git a/test/integration/targets/ansible-runner/files/constraints.txt b/test/integration/targets/ansible-runner/files/constraints.txt
new file mode 100644
index 0000000000..c3e394029e
--- /dev/null
+++ b/test/integration/targets/ansible-runner/files/constraints.txt
@@ -0,0 +1,5 @@
+psutil < 5.7.0    # Greater than this version breaks on older pip
+pexpect >= 4.5, <= 4.8.0
+python-daemon <= 2.2.4
+pyyaml < 5.1 ; python_version < '2.7' # pyyaml 5.1 and later require python 2.7 or later
+six <= 1.14.0
diff --git a/test/integration/targets/ansible-runner/tasks/setup.yml b/test/integration/targets/ansible-runner/tasks/setup.yml
index e67f1d4b7f..ea24ced52c 100644
--- a/test/integration/targets/ansible-runner/tasks/setup.yml
+++ b/test/integration/targets/ansible-runner/tasks/setup.yml
@@ -6,6 +6,8 @@
   pip:
     name: ansible-runner
     version: 1.2.0
+    extra_args:
+      -c {{ role_path }}/files/constraints.txt
 
 - name: Find location of ansible-runner installation
   command: "'{{ ansible_python_interpreter }}' -c 'import os, ansible_runner; print(os.path.dirname(ansible_runner.__file__))'"
