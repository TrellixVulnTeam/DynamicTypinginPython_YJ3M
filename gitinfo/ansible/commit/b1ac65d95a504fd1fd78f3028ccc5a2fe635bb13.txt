commit b1ac65d95a504fd1fd78f3028ccc5a2fe635bb13
Author: Jordan Borean <jborean93@gmail.com>
Date:   Tue Mar 27 16:20:10 2018 +1000

    win_copy: added fix for win_copy deleting local tmp folder (#37964)

diff --git a/lib/ansible/plugins/action/win_copy.py b/lib/ansible/plugins/action/win_copy.py
index 3b4616c755..0566b95940 100644
--- a/lib/ansible/plugins/action/win_copy.py
+++ b/lib/ansible/plugins/action/win_copy.py
@@ -11,6 +11,7 @@ import base64
 import json
 import os
 import os.path
+import shutil
 import tempfile
 import traceback
 import zipfile
@@ -320,12 +321,10 @@ class ActionModule(ActionBase):
             )
         )
         copy_args.pop('content', None)
-        os.remove(zip_path)
-
         module_return = self._execute_module(module_name='copy',
                                              module_args=copy_args,
                                              task_vars=task_vars)
-        os.removedirs(os.path.dirname(zip_path))
+        shutil.rmtree(os.path.dirname(zip_path))
         return module_return
 
     def run(self, tmp=None, task_vars=None):
diff --git a/test/integration/targets/win_copy/tasks/main.yml b/test/integration/targets/win_copy/tasks/main.yml
index 0e25c514ca..b2ee103fd0 100644
--- a/test/integration/targets/win_copy/tasks/main.yml
+++ b/test/integration/targets/win_copy/tasks/main.yml
@@ -5,6 +5,16 @@
     state: directory
   delegate_to: localhost
 
+# removes the cached zip module from the previous task so we can replicate
+# the below issue where win_copy would delete DEFAULT_LOCAL_TMP if it
+# had permission to
+# https://github.com/ansible/ansible/issues/35613
+- name: clear the local ansiballz cache
+  file:
+    path: "{{lookup('config', 'DEFAULT_LOCAL_TMP')}}/ansiballz_cache"
+    state: absent
+  delegate_to: localhost
+
 - name: create test folder
   win_file:
     path: '{{test_win_copy_path}}'
