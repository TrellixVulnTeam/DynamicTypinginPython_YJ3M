commit 5bf07454cb1efe4ab69f40608a51b106404d4100
Author: Robin Roth <robin@rroth.de>
Date:   Mon Dec 12 23:19:47 2016 +0100

    Test apache2 force (#18500)
    
    * Use native yaml for apache2 test
    
    * Test removal of default modules with force
    
    a2enmod on debian has `-f`, but not on SUSE (runs there without force).
    Therefore don't test that option on SUSE.
    The docs already specify that the option is intended for Debian systems
    only.

diff --git a/test/integration/targets/apache2_module/tasks/actualtest.yml b/test/integration/targets/apache2_module/tasks/actualtest.yml
index 5b02a1c2ff..fc0408a40b 100644
--- a/test/integration/targets/apache2_module/tasks/actualtest.yml
+++ b/test/integration/targets/apache2_module/tasks/actualtest.yml
@@ -14,18 +14,26 @@
 # along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
 
 - name: install apache via apt
-  apt: name=apache2 state=present
+  apt:
+    name: apache2
+    state: present
   when: "ansible_os_family == 'Debian'"
 
 - name: install apache via zypper
-  zypper: name=apache2 state=present
+  zypper:
+    name: apache2
+    state: present
   when: "ansible_os_family == 'Suse'"
 
 - name: disable userdir module
-  apache2_module: name=userdir state=absent
+  apache2_module:
+    name: userdir
+    state: absent
 
 - name: disable userdir module, second run
-  apache2_module: name=userdir state=absent
+  apache2_module:
+    name: userdir
+    state: absent
   register: disable
 
 - name: ensure apache2_module is idempotent
@@ -34,7 +42,9 @@
       - 'not disable.changed'
 
 - name: enable userdir module
-  apache2_module: name=userdir state=present
+  apache2_module:
+    name: userdir
+    state: present
   register: enable
 
 - name: ensure changed on successful enable
@@ -43,7 +53,9 @@
       - 'enable.changed'
 
 - name: enable userdir module, second run
-  apache2_module: name=userdir state=present
+  apache2_module:
+    name: userdir
+    state: present
   register: enabletwo
 
 - name: ensure apache2_module is idempotent
@@ -52,10 +64,24 @@
       - 'not enabletwo.changed'
 
 - name: disable userdir module, final run
-  apache2_module: name=userdir state=absent
+  apache2_module:
+    name: userdir
+    state: absent
   register: disablefinal
 
 - name: ensure changed on successful disable
   assert:
     that:
       - 'disablefinal.changed'
+
+- name: ensure autoindex enabled
+  apache2_module:
+    name: autoindex
+    state: present
+
+- name: force disable of autoindex  # bug #2499
+  apache2_module:
+    name: autoindex
+    state: absent
+    force: True
+  when: "ansible_os_family != 'Suse'"
