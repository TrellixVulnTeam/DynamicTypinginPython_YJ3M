commit cdc0819939cdab92515bd814a44f6a06d55e4d68
Author: James Tanner <tanner.jc@gmail.com>
Date:   Thu Apr 3 12:02:40 2014 -0400

    Fixes #6088 turn off sudo and su if the connection is local the sudo user matches the current user

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index bb10ec1bb2..9324bfd5f4 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -31,6 +31,7 @@ import sys
 import pipes
 import jinja2
 import subprocess
+import getpass
 
 import ansible.constants as C
 import ansible.inventory
@@ -931,6 +932,12 @@ class Runner(object):
             if conn.user == sudo_user or conn.user == su_user:
                 sudoable = False
                 su = False
+        else:
+            # assume connection type is local if no user attribute
+            this_user = getpass.getuser()
+            if this_user == sudo_user or this_user == su_user:
+                sudoable = False
+                su = False
 
         if su:
             rc, stdin, stdout, stderr = conn.exec_command(cmd,
