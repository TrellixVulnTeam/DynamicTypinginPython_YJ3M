commit 6e13e3918fc85a7d4ca89e2edd97c92dff487941
Author: Will Thames <will@thames.id.au>
Date:   Wed May 17 01:08:21 2017 +1000

    [cloud] Update VPC configuration for existing lambda (#24368)
    
    If a lambda exists but does not have a VPC configuration,
    add the VPC configuration when it's present in the ansible
    parameters.
    
    Prior to this change, setting VPC configuration on a lambda
    that did not have any VPC configuration would ignore that config.

diff --git a/lib/ansible/modules/cloud/amazon/lambda.py b/lib/ansible/modules/cloud/amazon/lambda.py
index 565d2dbbba..2e4fe3499f 100644
--- a/lib/ansible/modules/cloud/amazon/lambda.py
+++ b/lib/ansible/modules/cloud/amazon/lambda.py
@@ -364,9 +364,9 @@ def main():
                 subnet_net_id_changed = sorted(vpc_subnet_ids) != sorted(current_vpc_subnet_ids)
                 vpc_security_group_ids_changed = sorted(vpc_security_group_ids) != sorted(current_vpc_security_group_ids)
 
-                if any((subnet_net_id_changed, vpc_security_group_ids_changed)):
-                    func_kwargs.update({'VpcConfig':
-                                        {'SubnetIds': vpc_subnet_ids,'SecurityGroupIds': vpc_security_group_ids}})
+            if 'VpcConfig' not in current_config or subnet_net_id_changed or vpc_security_group_ids_changed:
+                func_kwargs.update({'VpcConfig':
+                                    {'SubnetIds': vpc_subnet_ids,'SecurityGroupIds': vpc_security_group_ids}})
         else:
             # No VPC configuration is desired, assure VPC config is empty when present in current config
             if ('VpcConfig' in current_config and
