commit 344d8d51ab0dce06bdd2929e18aeb685e145e21e
Author: James Cammarata <jimi@sngx.net>
Date:   Tue Oct 1 14:47:50 2013 -0500

    Use atomic_move to put the file, rather than shelling out
    
    Fixes #4321

diff --git a/library/utilities/accelerate b/library/utilities/accelerate
index 371e4adb92..70411cb344 100644
--- a/library/utilities/accelerate
+++ b/library/utilities/accelerate
@@ -311,14 +311,7 @@ class ThreadedTCPRequestHandler(SocketServer.BaseRequestHandler):
 
         if final_path:
             log("moving %s to %s" % (out_path, final_path))
-            args = ['sudo','cp',out_path,final_path]
-            rc, stdout, stderr = self.server.module.run_command(args, close_fds=True)
-            if rc != 0:
-                return dict(failed=True, stdout="failed to copy the file into position with sudo")
-            args = ['sudo','chown',final_user,out_path,final_path]
-            rc, stdout, stderr = self.server.module.run_command(args, close_fds=True)
-            if rc != 0:
-                return dict(failed=True, stdout="failed to chown the file via sudo")
+            self.server.module.atomic_move(out_path, final_path)
         return dict()
 
 def daemonize(module, password, port, minutes):
