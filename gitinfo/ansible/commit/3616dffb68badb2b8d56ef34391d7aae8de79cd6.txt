commit 3616dffb68badb2b8d56ef34391d7aae8de79cd6
Author: Stavros Korokithakis <stavros@korokithakis.net>
Date:   Fri Nov 2 01:42:04 2012 +0200

    Detect whether we're running in a virtualenv.

diff --git a/lib/ansible/constants.py b/lib/ansible/constants.py
index 6eac602db2..6b42c1c427 100644
--- a/lib/ansible/constants.py
+++ b/lib/ansible/constants.py
@@ -61,7 +61,10 @@ active_user   = pwd.getpwuid(os.geteuid())[0]
 
 # Needed so the RPM can call setup.py and have modules land in the
 # correct location. See #1277 for discussion
-DIST_MODULE_PATH = os.path.join(sys.prefix, 'share/ansible/')
+if getattr(sys, "real_prefix", None):
+    DIST_MODULE_PATH = os.path.join(sys.prefix, 'share/ansible/')
+else:
+    DIST_MODULE_PATH = '/usr/share/ansible/'
 
 # sections in config file
 DEFAULTS='defaults'
