commit 01e4c41be4de5217fd10ab6e43322602c22eb357
Author: nkshrishail <42039941+nkshrishail@users.noreply.github.com>
Date:   Wed Jan 8 03:13:23 2020 -0500

    nxos: Removing local-nxapi plugin and related parameters' usage from the integration tests. (#65068)
    
    * nxos_integration_tests: Removing obsolete provider parameter
    
    * nxos: removing support for local-nxapi plugin
    
    * nxos: removing LocalNxapi plugin implementation
    
    * nxos_nxapi: removing local plugin usage
    
    * REVERT - nxos: removing LocalNxapi plugin implementation
    
    * Addressing yamllint issues
    
    * Removing the condition on the debug messages
    
    * Restoring changes done to nxos_nxapi* tests
    
    * Retaining timeout of 500 on nxos_smoke test
    
    * Some cleanup
    
    * Addressing latest comments
    
    * Restoring the nxos_smoke and removing timeout from nxos_config and nxos_rollback

diff --git a/lib/ansible/plugins/action/nxos.py b/lib/ansible/plugins/action/nxos.py
index 93445d60a0..6a8f304a4f 100644
--- a/lib/ansible/plugins/action/nxos.py
+++ b/lib/ansible/plugins/action/nxos.py
@@ -41,7 +41,7 @@ class ActionModule(ActionNetworkModule):
         self._config_module = True if module_name == 'nxos_config' else False
         persistent_connection = self._play_context.connection.split('.')[-1]
 
-        if (persistent_connection == 'httpapi' or self._task.args.get('provider', {}).get('transport') == 'nxapi') \
+        if (self._play_context.connection in ('httpapi', 'local') or self._task.args.get('provider', {}).get('transport') == 'nxapi') \
                 and module_name in ('nxos_file_copy', 'nxos_nxapi'):
             return {'failed': True, 'msg': "Transport type 'nxapi' is not valid for '%s' module." % (module_name)}
 
diff --git a/test/integration/targets/nxos_aaa_server/tasks/nxapi.yaml b/test/integration/targets/nxos_aaa_server/tasks/nxapi.yaml
index 04c99602e6..a37ed6d358 100644
--- a/test/integration/targets/nxos_aaa_server/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_aaa_server/tasks/nxapi.yaml
@@ -24,10 +24,4 @@
   include: "{{ test_case_to_run }} ansible_connection=httpapi connection={{ nxapi }}"
   with_items: "{{ test_items }}"
   loop_control:
-    loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
+    loop_var: test_case_to_run
\ No newline at end of file
diff --git a/test/integration/targets/nxos_aaa_server/tests/common/radius.yaml b/test/integration/targets/nxos_aaa_server/tests/common/radius.yaml
index 5614e14846..da54b0847e 100644
--- a/test/integration/targets/nxos_aaa_server/tests/common/radius.yaml
+++ b/test/integration/targets/nxos_aaa_server/tests/common/radius.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_aaa_server radius.yaml sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup"
   nxos_aaa_server: &remove
@@ -9,7 +7,6 @@
     deadtime: default
     server_timeout: default
     directed_request: default
-    provider: "{{ connection }}"
     state: default
   ignore_errors: yes
 
@@ -17,7 +14,6 @@
   - name: "Configure radius server defaults"
     nxos_aaa_server: &configure_default_radius
       server_type: radius
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -35,7 +31,6 @@
       server_timeout: 9
       deadtime: 20
       directed_request: enabled
-      provider: "{{ connection }}"
       state: present
     register: result
   
@@ -60,7 +55,6 @@
       server_type: radius
       encrypt_type: 7
       global_key: test_key
-      provider: "{{ connection }}"
       state: present
     register: result
    
@@ -79,7 +73,6 @@
       server_timeout: default
       global_key: default
       directed_request: default
-      provider: "{{ connection }}"
       state: default
     register: result
 
diff --git a/test/integration/targets/nxos_aaa_server/tests/common/tacacs.yaml b/test/integration/targets/nxos_aaa_server/tests/common/tacacs.yaml
index 4735a23f71..9b540fc385 100644
--- a/test/integration/targets/nxos_aaa_server/tests/common/tacacs.yaml
+++ b/test/integration/targets/nxos_aaa_server/tests/common/tacacs.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_aaa_server tacacs.yaml sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Enable feature tacacs+"
   nxos_feature:
     feature: tacacs+
-    provider: "{{ connection }}"
     state: enabled
 
 - name: "Setup"
@@ -15,7 +12,6 @@
     deadtime: default
     server_timeout: default
     directed_request: default
-    provider: "{{ connection }}"
     state: default
   ignore_errors: yes
 
@@ -23,7 +19,6 @@
   - name: "Configure tacacs server defaults"
     nxos_aaa_server: &configure_default_tacacs
       server_type: tacacs
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -41,7 +36,6 @@
       server_timeout: 9
       deadtime: 20
       directed_request: enabled
-      provider: "{{ connection }}"
       state: present
     register: result
   
@@ -66,7 +60,6 @@
       server_type: tacacs
       encrypt_type: 7
       global_key: test_key
-      provider: "{{ connection }}"
       state: present
     register: result
    
@@ -85,7 +78,6 @@
       server_timeout: default
       global_key: default
       directed_request: default
-      provider: "{{ connection }}"
       state: default
     register: result
 
@@ -110,7 +102,6 @@
   - name: "Disable feature tacacs+"
     nxos_feature:
       feature: tacacs+
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_aaa_server tacacs.yaml sanity test"
diff --git a/test/integration/targets/nxos_aaa_server_host/tasks/nxapi.yaml b/test/integration/targets/nxos_aaa_server_host/tasks/nxapi.yaml
index 04c99602e6..a37ed6d358 100644
--- a/test/integration/targets/nxos_aaa_server_host/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_aaa_server_host/tasks/nxapi.yaml
@@ -24,10 +24,4 @@
   include: "{{ test_case_to_run }} ansible_connection=httpapi connection={{ nxapi }}"
   with_items: "{{ test_items }}"
   loop_control:
-    loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
+    loop_var: test_case_to_run
\ No newline at end of file
diff --git a/test/integration/targets/nxos_aaa_server_host/tests/common/radius.yaml b/test/integration/targets/nxos_aaa_server_host/tests/common/radius.yaml
index 1f73efde1b..53fa42a262 100644
--- a/test/integration/targets/nxos_aaa_server_host/tests/common/radius.yaml
+++ b/test/integration/targets/nxos_aaa_server_host/tests/common/radius.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_aaa_server_host radius.yaml sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup"
   nxos_aaa_server_host: &remove
     server_type: radius
     address: 8.8.8.8
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -16,7 +13,6 @@
     nxos_aaa_server_host: &configure_default_radius
       server_type: radius
       address: 8.8.8.8
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -51,7 +47,6 @@
       host_timeout: 25
       auth_port: 2083
       acct_port: 2084
-      provider: "{{ connection }}"
       state: present
     register: result
  
@@ -70,7 +65,6 @@
       host_timeout: default
       auth_port: 1000
       acct_port: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -91,7 +85,6 @@
       acct_port: 2084
       encrypt_type: 0
       key: hello
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -118,7 +111,6 @@
       acct_port: 2084
       encrypt_type: 7
       key: hello
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -139,7 +131,6 @@
       acct_port: 2084
       encrypt_type: 7
       key: helloback
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -163,7 +154,6 @@
       acct_port: default
       encrypt_type: 7
       key: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -183,7 +173,6 @@
       auth_port: default
       acct_port: default
       key: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_aaa_server_host/tests/common/tacacs.yaml b/test/integration/targets/nxos_aaa_server_host/tests/common/tacacs.yaml
index d493fe19ca..1e67197871 100644
--- a/test/integration/targets/nxos_aaa_server_host/tests/common/tacacs.yaml
+++ b/test/integration/targets/nxos_aaa_server_host/tests/common/tacacs.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_aaa_server_host tacacs.yaml sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Enable feature tacacs+"
   nxos_feature:
     feature: tacacs+
-    provider: "{{ connection }}"
     state: enabled
 
 - name: "Setup"
   nxos_aaa_server_host: &remove
     server_type: tacacs
     address: 8.8.8.8
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -23,7 +19,6 @@
     nxos_aaa_server_host: &configure_default_tacacs
       server_type: tacacs
       address: 8.8.8.8
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -57,7 +52,6 @@
       address: 8.8.8.8
       host_timeout: 25
       tacacs_port: 89
-      provider: "{{ connection }}"
       state: present
     register: result
  
@@ -75,7 +69,6 @@
       address: 8.8.8.8
       host_timeout: default
       tacacs_port: 100
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -95,7 +88,6 @@
       tacacs_port: default
       encrypt_type: 0
       key: hello
-      provider: "{{ connection }}"
       state: present
     register: result
    
@@ -121,7 +113,6 @@
       tacacs_port: 89
       encrypt_type: 7
       key: hello
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -141,7 +132,6 @@
       tacacs_port: 89
       encrypt_type: 7
       key: helloback
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -164,7 +154,6 @@
       tacacs_port: 89
       encrypt_type: 7
       key: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -183,7 +172,6 @@
       host_timeout: default
       tacacs_port: default
       key: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -208,7 +196,6 @@
   - name: "Disable feature tacacs+"
     nxos_feature:
       feature: tacacs+
-      provider: "{{ connection }}"
       state: disabled
 
   - debug: msg="END connection={{ ansible_connection }} nxos_aaa_server_host tacacs.yaml sanity test"  
diff --git a/test/integration/targets/nxos_acl/tasks/nxapi.yaml b/test/integration/targets/nxos_acl/tasks/nxapi.yaml
index 04c99602e6..a37ed6d358 100644
--- a/test/integration/targets/nxos_acl/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_acl/tasks/nxapi.yaml
@@ -24,10 +24,4 @@
   include: "{{ test_case_to_run }} ansible_connection=httpapi connection={{ nxapi }}"
   with_items: "{{ test_items }}"
   loop_control:
-    loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
+    loop_var: test_case_to_run
\ No newline at end of file
diff --git a/test/integration/targets/nxos_acl/tests/common/sanity.yaml b/test/integration/targets/nxos_acl/tests/common/sanity.yaml
index ed7cb4f5f8..2313f5d1f5 100644
--- a/test/integration/targets/nxos_acl/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_acl/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_acl sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: time_range="ans-range"
   when: platform is not search('N35|N5K|N6K')
@@ -10,7 +8,6 @@
   nxos_acl: &remove
     name: TEST_ACL
     seq: 10
-    provider: "{{ connection }}"
     state: delete_acl
   ignore_errors: yes
 
@@ -37,7 +34,6 @@
     rst: 'enable'
     syn: 'enable'
     time_range: "{{time_range|default(omit)}}"
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -76,7 +72,6 @@
     rst: 'enable'
     syn: 'enable'
     time_range: "{{time_range|default(omit)}}"
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -94,7 +89,6 @@
     seq: 20
     action: remark
     remark: test_remark
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -112,7 +106,6 @@
     seq: 20
     action: remark
     remark: changed_remark
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -134,7 +127,6 @@
     dest: any
     fragments: enable
     precedence: network
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -155,7 +147,6 @@
     src: any
     dest: any
     precedence: network
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -178,7 +169,6 @@
     src_port1: 1200
     dest: any
     precedence: network
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -199,7 +189,6 @@
     src: any
     dest: any
     precedence: network
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -215,7 +204,6 @@
   nxos_acl: &remace30
     name: TEST_ACL
     seq: 30
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_acl_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_acl_interface/tasks/nxapi.yaml
index 04c99602e6..a37ed6d358 100644
--- a/test/integration/targets/nxos_acl_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_acl_interface/tasks/nxapi.yaml
@@ -24,10 +24,4 @@
   include: "{{ test_case_to_run }} ansible_connection=httpapi connection={{ nxapi }}"
   with_items: "{{ test_items }}"
   loop_control:
-    loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
+    loop_var: test_case_to_run
\ No newline at end of file
diff --git a/test/integration/targets/nxos_acl_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_acl_interface/tests/common/sanity.yaml
index 2697e1ac33..dc76978c27 100644
--- a/test/integration/targets/nxos_acl_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_acl_interface/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_acl_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -13,7 +11,6 @@
   nxos_config: &default
     lines:
       - "default interface {{ intname }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Setup: Put interface into no switch port mode"
@@ -23,14 +20,12 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Setup: Cleanup possibly existing acl"
   nxos_acl: &remove
     name: ANSIBLE_ACL
     seq: 10
-    provider: "{{ connection }}"
     state: delete_acl
   ignore_errors: yes
 
@@ -42,7 +37,6 @@
     proto: tcp
     src: 192.0.2.1/24
     dest: any
-    provider: "{{ connection }}"
 
 - block:
   - name: Configure acl interface egress
@@ -50,7 +44,6 @@
       name: ANSIBLE_ACL
       interface: "{{ intname }}"
       direction: egress
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -71,7 +64,6 @@
       name: ANSIBLE_ACL
       interface: "{{ intname }}"
       direction: ingress
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -88,7 +80,6 @@
       name: ANSIBLE_ACL
       interface: "{{ intname }}"
       direction: egress
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -105,7 +96,6 @@
       name: ANSIBLE_ACL
       interface: "{{ intname }}"
       direction: ingress
-      provider: "{{ connection }}"
       state: absent
     register: result
 
diff --git a/test/integration/targets/nxos_banner/tasks/nxapi.yaml b/test/integration/targets/nxos_banner/tasks/nxapi.yaml
index 04c99602e6..a37ed6d358 100644
--- a/test/integration/targets/nxos_banner/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_banner/tasks/nxapi.yaml
@@ -24,10 +24,4 @@
   include: "{{ test_case_to_run }} ansible_connection=httpapi connection={{ nxapi }}"
   with_items: "{{ test_items }}"
   loop_control:
-    loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
+    loop_var: test_case_to_run
\ No newline at end of file
diff --git a/test/integration/targets/nxos_banner/tests/common/sanity.yaml b/test/integration/targets/nxos_banner/tests/common/sanity.yaml
index 89ef7774d4..ab1eef835b 100644
--- a/test/integration/targets/nxos_banner/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_banner/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_banner sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: banner_exec_image_ok
   # N5K/N6K/N9K-F support banner exec but have image defects
diff --git a/test/integration/targets/nxos_become/tasks/nxapi.yaml b/test/integration/targets/nxos_become/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_become/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_become/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_become/tests/cli/sanity.yaml b/test/integration/targets/nxos_become/tests/cli/sanity.yaml
index 2a97362a52..bee0584563 100644
--- a/test/integration/targets/nxos_become/tests/cli/sanity.yaml
+++ b/test/integration/targets/nxos_become/tests/cli/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/sanity.yaml"
-- debug: msg="Using provider={{ connection.transport }}/sanity.yaml"
-  when: ansible_connection == "local"
 
 - block:
   - name: update role to priv-14
diff --git a/test/integration/targets/nxos_bfd_global/tests/common/sanity.yaml b/test/integration/targets/nxos_bfd_global/tests/common/sanity.yaml
index 52471d560c..0aaf86e471 100644
--- a/test/integration/targets/nxos_bfd_global/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_bfd_global/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bfd_global sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: set facts common
   # nd_* vars are "non-default" values
@@ -81,7 +79,6 @@
 - name: Setup
   nxos_feature: &setup_teardown
     feature: bfd
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
@@ -117,7 +114,6 @@
       fabricpath_interval:   "{{ nd_fab_interval | default(omit) }}"
       fabricpath_slow_timer: "{{ nd_fab_slow | default(omit) }}"
       fabricpath_vlan:       "{{ nd_fab_vlan | default(omit) }}"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -148,7 +144,6 @@
       fabricpath_interval:   "{{ fab_interval | default(omit) }}"
       fabricpath_slow_timer: "{{ fab_slow | default(omit) }}"
       fabricpath_vlan:       "{{ fab_vlan | default(omit) }}"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
diff --git a/test/integration/targets/nxos_bgp/tasks/nxapi.yaml b/test/integration/targets/nxos_bgp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_bgp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_bgp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_bgp/tests/common/dis_policy.yaml b/test/integration/targets/nxos_bgp/tests/common/dis_policy.yaml
index 11963b1f83..dfb1864697 100644
--- a/test/integration/targets/nxos_bgp/tests/common/dis_policy.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/dis_policy.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - debug: msg="This bgp_disable_policy is not supported on {{ image_version }}"
   when: imagetag is search("A8|D1")
@@ -12,14 +10,12 @@
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -30,7 +26,6 @@
       disable_policy_batching: true
       disable_policy_batching_ipv4_prefix_list: v4_p
       disable_policy_batching_ipv6_prefix_list: v6_p
-      provider: "{{ connection }}"
     register: result
     when: bgp_disable_policy
 
@@ -55,7 +50,6 @@
       disable_policy_batching: false
       disable_policy_batching_ipv4_prefix_list: default
       disable_policy_batching_ipv6_prefix_list: default
-      provider: "{{ connection }}"
     register: result
     when: bgp_disable_policy
 
@@ -77,7 +71,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp/tests/common/hels.yaml b/test/integration/targets/nxos_bgp/tests/common/hels.yaml
index e248d6ef8d..db4f547769 100644
--- a/test/integration/targets/nxos_bgp/tests/common/hels.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/hels.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - debug: msg="This test is not supported on {{ image_version }}"
   when: imagetag is search("D1")
@@ -12,7 +10,6 @@
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
   when: test_helsinki
@@ -20,7 +17,6 @@
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
   when: test_helsinki
@@ -38,7 +34,6 @@
       reconnect_interval: 55
       timer_bgp_hold: 110
       timer_bgp_keepalive: 45
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
     when: test_helsinki
@@ -70,7 +65,6 @@
       reconnect_interval: default
       timer_bgp_hold: default
       timer_bgp_keepalive: default
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
     when: test_helsinki
@@ -94,7 +88,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
     when: test_helsinki
diff --git a/test/integration/targets/nxos_bgp/tests/common/isolate.yaml b/test/integration/targets/nxos_bgp/tests/common/isolate.yaml
index d257ddc013..0d507f6eea 100644
--- a/test/integration/targets/nxos_bgp/tests/common/isolate.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/isolate.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 
 - debug: msg="This bgp_isolate is not supported on {{ image_version }}"
@@ -13,14 +11,12 @@
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -31,7 +27,6 @@
     nxos_bgp: &set1
       asn: 65535
       isolate: false
-      provider: "{{ connection }}"
     register: result
     when: bgp_isolate
 
@@ -54,7 +49,6 @@
     nxos_bgp: &reset1
       asn: 65535
       isolate: true
-      provider: "{{ connection }}"
     register: result
     when: bgp_isolate
 
@@ -76,7 +70,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp/tests/common/param.yaml b/test/integration/targets/nxos_bgp/tests/common/param.yaml
index f9198aefc9..fdcd33c5ce 100644
--- a/test/integration/targets/nxos_bgp/tests/common/param.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/param.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -35,7 +31,6 @@
       graceful_restart_helper: true
       log_neighbor_changes: true
       maxas_limit: 50
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -67,7 +62,6 @@
       log_neighbor_changes: false
       maxas_limit: default
       router_id: default
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -85,7 +79,6 @@
       asn: 65535
       vrf: "{{ item }}"
       cluster_id: 10.0.0.1
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -103,7 +96,6 @@
       asn: 65535
       vrf: "{{ item }}"
       cluster_id: default
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -124,7 +116,6 @@
         - 16
         - 22
         - 18
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -140,7 +131,6 @@
       asn: 65535
       confederation_id: default
       confederation_peers: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -161,7 +151,6 @@
         - 16
         - 22
         - 18
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -179,7 +168,6 @@
       local_as: default
       confederation_id: default
       confederation_peers: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -196,7 +184,6 @@
       vrf: myvrf
       local_as: 33
       confederation_id: 99
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -213,7 +200,6 @@
       vrf: myvrf
       confederation_id: default
       local_as: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -235,7 +221,6 @@
       fast_external_fallover: false
       flush_routes: true
       shutdown: true
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -254,7 +239,6 @@
       fast_external_fallover: true
       flush_routes: false
       shutdown: false
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -269,7 +253,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp/tests/common/sanity.yaml b/test/integration/targets/nxos_bgp/tests/common/sanity.yaml
index 7afaffbfb5..580588144d 100644
--- a/test/integration/targets/nxos_bgp/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: neighbor_down_fib_accelerate="true"
   when: (not titanium) and ((imagetag != 'N1') and (imagetag != 'D1'))
@@ -15,14 +13,12 @@
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
 - name: "Setup"
   nxos_bgp: &remove
     asn: 65535
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
   register: result
@@ -32,7 +28,6 @@
     nxos_bgp: &configure_default
       asn: 65535
       router_id: 192.0.2.1
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -94,7 +89,6 @@
       event_history_events: size_medium
       event_history_periodic: size_small
       suppress_fib_pending: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -121,7 +115,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
 
   rescue:
@@ -132,7 +125,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp/tests/common/supp_fib.yaml b/test/integration/targets/nxos_bgp/tests/common/supp_fib.yaml
index a421292207..d9fdbdb3ef 100644
--- a/test/integration/targets/nxos_bgp/tests/common/supp_fib.yaml
+++ b/test/integration/targets/nxos_bgp/tests/common/supp_fib.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: bgp_best_path_limit="false"
 - set_fact: bgp_best_path_limit="true"
@@ -14,14 +12,12 @@
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -33,7 +29,6 @@
       asn: 65535
       vrf: "{{ item }}"
       timer_bestpath_limit: 255
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -55,7 +50,6 @@
       asn: 65535
       vrf: "{{ item }}"
       timer_bestpath_limit: default
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -76,7 +70,6 @@
     nxos_bgp: &set2
       asn: 65535
       suppress_fib_pending: false
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -94,7 +87,6 @@
     nxos_bgp: &reset2
       asn: 65535
       suppress_fib_pending: true
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -115,7 +107,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp_af/tasks/nxapi.yaml b/test/integration/targets/nxos_bgp_af/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_bgp_af/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_bgp_af/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_bgp_af/tests/common/sanity.yaml b/test/integration/targets/nxos_bgp_af/tests/common/sanity.yaml
index 1b2b6472ce..00af4422e5 100644
--- a/test/integration/targets/nxos_bgp_af/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_bgp_af/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp_af sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: advertise_l2vpn_evpn="true"
   when: platform is search('N9K')
@@ -9,21 +7,18 @@
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
 - name: "Enable feature nv overlay"
   nxos_feature:
     feature: nv overlay
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
 - name: "Setup"
   nxos_bgp: &remove
     asn: 65535
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -41,7 +36,6 @@
       afi: ipv4
       safi: unicast
       advertise_l2vpn_evpn: "{{advertise_l2vpn_evpn|default(omit)}}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -63,7 +57,6 @@
       vrf: testing
       afi: ipv4
       safi: unicast
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -82,7 +75,6 @@
       additional_paths_send: true
       client_to_client: False
       default_information_originate: true
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -109,7 +101,6 @@
       additional_paths_send: False
       client_to_client: True
       default_information_originate: False
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -129,7 +120,6 @@
       vrf: "{{ item }}"
       afi: ipv4
       safi: unicast
-      provider: "{{ connection }}"
       state: absent
     with_items: "{{ vrfs }}"
     register: result
@@ -153,7 +143,6 @@
       suppress_inactive: true
       table_map: RouteMap
       table_map_filter: true
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -184,7 +173,6 @@
       suppress_inactive: False
       table_map: default
       table_map_filter: False
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -219,7 +207,6 @@
       inject_map: [['lax_inject_map', 'lax_exist_map'], ['nyc_inject_map', 'nyc_exist_map', 'copy-attributes'], ['fsd_inject_map', 'fsd_exist_map']]
       networks: [['10.0.0.0/16', 'routemap_LA'], ['192.168.1.1/32', 'Chicago'], ['192.168.2.0/24'], ['192.168.3.0/24', 'routemap_NYC']]
       redistribute: [['direct', 'rm_direct'], ['lisp', 'rm_lisp']]
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -247,7 +234,6 @@
       inject_map: [['fsd_inject_map', 'fsd_exist_map']]
       networks: [['192.168.2.0/24']]
       redistribute: [['lisp', 'rm_lisp']]
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -275,7 +261,6 @@
       inject_map: default
       networks: default
       redistribute: default
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -312,13 +297,11 @@
   - name: "Disable feature bgp"
     nxos_feature: &disable_bgp
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
 
   - name: "Disable feature nv overlay"
     nxos_feature: &disable_nvoverlay
       feature: nv overlay
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_bgp_neighbor/tasks/nxapi.yaml b/test/integration/targets/nxos_bgp_neighbor/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_bgp_neighbor/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_bgp_neighbor/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_bgp_neighbor/tests/common/sanity.yaml b/test/integration/targets/nxos_bgp_neighbor/tests/common/sanity.yaml
index 5edb702e73..c8960ca95d 100644
--- a/test/integration/targets/nxos_bgp_neighbor/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_bgp_neighbor/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp_neighbor sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: intname="{{ nxos_int1 }}"
 
@@ -21,7 +19,6 @@
 - name: "Setup: Disable features"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: disabled
   loop: ['bgp', 'bfd']
   ignore_errors: yes
@@ -29,7 +26,6 @@
 - name: "Setup: Enable features"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: enabled
   loop: ['bgp', 'bfd']
 
@@ -54,7 +50,6 @@
       description: "just a description"
       update_source: "{{ intname.capitalize() }}"
       shutdown: true
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -92,7 +87,6 @@
       description: default
       update_source: default
       shutdown: False
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -111,7 +105,6 @@
       asn: 65535
       neighbor: 192.0.2.3/32
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
       state: absent
     with_items: "{{ vrfs }}"
     register: result
@@ -132,7 +125,6 @@
       vrf: "{{ item }}"
       description: "tested by ansible"
       remove_private_as: "{{remove_private_asa|default(omit)}}"
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -153,7 +145,6 @@
       vrf: "{{ item }}"
       description: "tested by ansible"
       remove_private_as: "{{remove_private_asr|default(omit)}}"
-      provider: "{{ connection }}"
       state: present
     with_items: "{{ vrfs }}"
     register: result
@@ -291,7 +282,6 @@
       asn: 65535
       neighbor: 192.0.2.3
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
       state: absent
     with_items: "{{ vrfs }}"
     register: result
@@ -310,7 +300,6 @@
       asn: 65535
       neighbor: 192.168.1.1
       bfd: enable
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -327,7 +316,6 @@
       asn: 65535
       neighbor: 192.168.1.1
       bfd: disable
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -343,7 +331,6 @@
   - name: "Teardown: Disable features"
     nxos_feature:
       feature: "{{ item }}"
-      provider: "{{ connection }}"
       state: disabled
     loop: ['bgp', 'bfd']
     ignore_errors: yes
diff --git a/test/integration/targets/nxos_bgp_neighbor_af/tasks/nxapi.yaml b/test/integration/targets/nxos_bgp_neighbor_af/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_bgp_neighbor_af/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_bgp_neighbor_af/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_bgp_neighbor_af/tests/common/sanity.yaml b/test/integration/targets/nxos_bgp_neighbor_af/tests/common/sanity.yaml
index 71606d5df7..19594e7321 100644
--- a/test/integration/targets/nxos_bgp_neighbor_af/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_bgp_neighbor_af/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_bgp_neighbor_af sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: soft_reconfiguration_ina="always"
   when: imagetag is not search("D1|N1")
@@ -9,14 +7,12 @@
 - name: "Disable feature BGP"
   nxos_feature: &disable_bgp
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -47,7 +43,6 @@
       suppress_inactive: True
       unsuppress_map: 'unsup_map'
       weight: '30'
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -89,7 +84,6 @@
       suppress_inactive: False
       unsuppress_map: default
       weight: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -107,7 +101,6 @@
       neighbor: '192.0.2.3'
       afi: ipv4
       safi: unicast
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -133,7 +126,6 @@
       max_prefix_threshold: 50
       route_map_in: 'rm_in'
       route_map_out: 'rm_out'
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -159,7 +151,6 @@
       max_prefix_threshold: default
       route_map_in: default
       route_map_out: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -189,7 +180,6 @@
       vrf: 'blue'
       neighbor: '192.0.2.3'
       remote_as: 2
-      provider: "{{ connection }}"
 
   - name: "Configure BGP neighbor 3"
     nxos_bgp_neighbor_af: &configure3
@@ -205,7 +195,6 @@
       soft_reconfiguration_in: "{{soft_reconfiguration_ina|default(omit)}}"
       soo: '3:3'
       next_hop_third_party: True
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -229,7 +218,6 @@
       as_override: False
       send_community: default
       soo: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -244,7 +232,6 @@
   - name: "Setup: Remove BGP config"
     nxos_bgp: &remove
       asn: 65535
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -255,7 +242,6 @@
       asn: 65535
       neighbor: '192.0.2.2'
       remote_as: 65535
-      provider: "{{ connection }}"
 
   - name: "Configure BGP neighbor 4"
     nxos_bgp_neighbor_af: &configure4
@@ -264,7 +250,6 @@
       afi: ipv4
       safi: unicast
       route_reflector_client: 'true'
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -282,7 +267,6 @@
       afi: ipv4
       safi: unicast
       route_reflector_client: False
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
diff --git a/test/integration/targets/nxos_command/tasks/nxapi.yaml b/test/integration/targets/nxos_command/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_command/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_command/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_command/tests/common/bad_operator.yaml b/test/integration/targets/nxos_command/tests/common/bad_operator.yaml
index b8220df352..6a3659093f 100644
--- a/test/integration/targets/nxos_command/tests/common/bad_operator.yaml
+++ b/test/integration/targets/nxos_command/tests/common/bad_operator.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.state foo up"
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_command/tests/common/equal.yaml b/test/integration/targets/nxos_command/tests/common/equal.yaml
index cc0ea6b082..a81eb3c5c7 100644
--- a/test/integration/targets/nxos_command/tests/common/equal.yaml
+++ b/test/integration/targets/nxos_command/tests/common/equal.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.state eq up"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +21,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.state == up"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/greaterthan.yaml b/test/integration/targets/nxos_command/tests/common/greaterthan.yaml
index 9bf5d809cf..0b8db6a90b 100644
--- a/test/integration/targets/nxos_command/tests/common/greaterthan.yaml
+++ b/test/integration/targets/nxos_command/tests/common/greaterthan.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask gt 0"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +21,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask > 0"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/greaterthanorequal.yaml b/test/integration/targets/nxos_command/tests/common/greaterthanorequal.yaml
index 394af88dee..3e0c27ca73 100644
--- a/test/integration/targets/nxos_command/tests/common/greaterthanorequal.yaml
+++ b/test/integration/targets/nxos_command/tests/common/greaterthanorequal.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask ge 0"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +21,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask >= 0"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/invalid.yaml b/test/integration/targets/nxos_command/tests/common/invalid.yaml
index 6f7aa6b98e..6532a5eae0 100644
--- a/test/integration/targets/nxos_command/tests/common/invalid.yaml
+++ b/test/integration/targets/nxos_command/tests/common/invalid.yaml
@@ -4,7 +4,6 @@
 - name: run invalid command
   nxos_command:
     commands: ['show foo']
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
@@ -17,7 +16,6 @@
     commands:
       - show version
       - show foo
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_command/tests/common/lessthan.yaml b/test/integration/targets/nxos_command/tests/common/lessthan.yaml
index b60bbce323..7d9509b649 100644
--- a/test/integration/targets/nxos_command/tests/common/lessthan.yaml
+++ b/test/integration/targets/nxos_command/tests/common/lessthan.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask lt 33"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +21,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask lt 33"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/lessthanorequal.yaml b/test/integration/targets/nxos_command/tests/common/lessthanorequal.yaml
index 9104d5446f..70d0f63662 100644
--- a/test/integration/targets/nxos_command/tests/common/lessthanorequal.yaml
+++ b/test/integration/targets/nxos_command/tests/common/lessthanorequal.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask le 32"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +21,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.eth_ip_mask <= 32"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/notequal.yaml b/test/integration/targets/nxos_command/tests/common/notequal.yaml
index 95f4f15760..14f38431b2 100644
--- a/test/integration/targets/nxos_command/tests/common/notequal.yaml
+++ b/test/integration/targets/nxos_command/tests/common/notequal.yaml
@@ -8,7 +8,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.state neq down"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -23,7 +22,6 @@
       - show interface mgmt0 | json
     wait_for:
       - "result[1].TABLE_interface.ROW_interface.state != down"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/output.yaml b/test/integration/targets/nxos_command/tests/common/output.yaml
index 6cdeb36524..e8ee7ed9bb 100644
--- a/test/integration/targets/nxos_command/tests/common/output.yaml
+++ b/test/integration/targets/nxos_command/tests/common/output.yaml
@@ -4,7 +4,6 @@
 - name: get output for single command
   nxos_command:
     commands: ['show version']
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -16,7 +15,6 @@
     commands:
       - show version
       - show interface
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/common/timeout.yaml b/test/integration/targets/nxos_command/tests/common/timeout.yaml
index 34d9135619..a190b27be2 100644
--- a/test/integration/targets/nxos_command/tests/common/timeout.yaml
+++ b/test/integration/targets/nxos_command/tests/common/timeout.yaml
@@ -7,7 +7,6 @@
       - show version
     wait_for:
       - "result[0] contains bad_value_string"
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_command/tests/nxapi/contains.yaml b/test/integration/targets/nxos_command/tests/nxapi/contains.yaml
index fc053932d8..2737af1bfa 100644
--- a/test/integration/targets/nxos_command/tests/nxapi/contains.yaml
+++ b/test/integration/targets/nxos_command/tests/nxapi/contains.yaml
@@ -9,7 +9,6 @@
     wait_for:
       - "result[0] contains NX-OS"
       - "result[1].TABLE_interface.ROW_interface.interface contains mgmt"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_command/tests/nxapi/sanity.yaml b/test/integration/targets/nxos_command/tests/nxapi/sanity.yaml
index 16ef1837eb..bff006a4c1 100644
--- a/test/integration/targets/nxos_command/tests/nxapi/sanity.yaml
+++ b/test/integration/targets/nxos_command/tests/nxapi/sanity.yaml
@@ -4,7 +4,6 @@
 - name: "Disable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
 
 - block:
@@ -22,14 +21,12 @@
   - name: "Enable feature BGP"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "Configure BGP defaults"
     nxos_bgp: &configure_default
       asn: 65535
       router_id: 192.0.2.1
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -64,7 +61,6 @@
   - name: "Disable feature bgp"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END nxapi/sanity.yaml on connection={{ ansible_connection }}"
diff --git a/test/integration/targets/nxos_config/tests/common/backup.yaml b/test/integration/targets/nxos_config/tests/common/backup.yaml
index 327c92e304..d7cea3c432 100644
--- a/test/integration/targets/nxos_config/tests/common/backup.yaml
+++ b/test/integration/targets/nxos_config/tests/common/backup.yaml
@@ -12,7 +12,6 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
 
 - name: collect any backup files
   find: &backups
@@ -35,7 +34,6 @@
     parents:
       - "interface {{ intname }}"
     backup: yes
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/defaults.yaml b/test/integration/targets/nxos_config/tests/common/defaults.yaml
index ba4f7a83bf..c0a17c2011 100644
--- a/test/integration/targets/nxos_config/tests/common/defaults.yaml
+++ b/test/integration/targets/nxos_config/tests/common/defaults.yaml
@@ -12,7 +12,6 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
 
 - name: configure device with defaults included
   nxos_config:
@@ -22,7 +21,6 @@
     parents:
       - "interface {{ intname }}"
     defaults: yes
-    provider: "{{ connection }}"
   register: result
 
 - debug: var=result
@@ -40,7 +38,6 @@
     parents:
       - "interface {{ intname }}"
     defaults: yes
-    provider: "{{ connection }}"
   register: result
 
 - debug: var=result
diff --git a/test/integration/targets/nxos_config/tests/common/sanity.yaml b/test/integration/targets/nxos_config/tests/common/sanity.yaml
index 447fbc0451..58206d1cf7 100644
--- a/test/integration/targets/nxos_config/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_config/tests/common/sanity.yaml
@@ -5,7 +5,6 @@
   nxos_config:
     lines: ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - name: "nxos_config sanity test"
   nxos_config:
@@ -18,7 +17,6 @@
     parents: ip access-list test
     before: no ip access-list test
     match: exact
-    provider: "{{ connection }}"
 
 - name: "nxos_config sanity test - replace block"
   nxos_config:
@@ -30,13 +28,11 @@
     parents: ip access-list test
     before: no ip access-list test
     replace: block
-    provider: "{{ connection }}"
 
 - name: teardown
   nxos_config:
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg='Verify https://github.com/ansible/ansible/issues/50635'
 
@@ -44,14 +40,12 @@
   nxos_config:
     lines:
       - "default interface {{ nxos_int1 }}"
-    provider: "{{ connection }}"
 
 - name: MAKE INTERFACE A SWITCHPORT
   nxos_config:
     lines:
       - switchport
     parents: "interface {{ nxos_int1 }}"
-    provider: "{{ connection }}"
 
 - name: CONFIGURE EDGE TRUNK TYPE
   nxos_config: &config
@@ -60,7 +54,6 @@
       - switchport access vlan 3333
       - spanning-tree port type edge
     parents: "interface {{ nxos_int1 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/save.yaml b/test/integration/targets/nxos_config/tests/common/save.yaml
index 930551bd08..19e6b7c127 100644
--- a/test/integration/targets/nxos_config/tests/common/save.yaml
+++ b/test/integration/targets/nxos_config/tests/common/save.yaml
@@ -12,12 +12,10 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
 
 - name: save config
   nxos_config:
     save_when: always
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -27,7 +25,6 @@
 - name: save should always run
   nxos_config:
     save_when: always
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/src_basic.yaml b/test/integration/targets/nxos_config/tests/common/src_basic.yaml
index f12dcb31c5..c8bc469fb9 100644
--- a/test/integration/targets/nxos_config/tests/common/src_basic.yaml
+++ b/test/integration/targets/nxos_config/tests/common/src_basic.yaml
@@ -11,12 +11,10 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
 
 - name: configure device with config
   nxos_config:
     src: basic/config.j2
-    provider: "{{ connection }}"
     defaults: yes
   register: result
 
@@ -29,7 +27,6 @@
 - name: check device with config
   nxos_config:
     src: basic/config.j2
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/src_invalid.yaml b/test/integration/targets/nxos_config/tests/common/src_invalid.yaml
index f3405c3ebf..f0e721fc31 100644
--- a/test/integration/targets/nxos_config/tests/common/src_invalid.yaml
+++ b/test/integration/targets/nxos_config/tests/common/src_invalid.yaml
@@ -6,7 +6,6 @@
 - name: configure with invalid src
   nxos_config:
     src: basic/foobar.j2
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_config/tests/common/src_match_none.yaml b/test/integration/targets/nxos_config/tests/common/src_match_none.yaml
index 83ac6a19e7..fd2c2d2644 100644
--- a/test/integration/targets/nxos_config/tests/common/src_match_none.yaml
+++ b/test/integration/targets/nxos_config/tests/common/src_match_none.yaml
@@ -12,7 +12,6 @@
     parents:
       - "interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
 
 - name: configure device with config
   nxos_config:
@@ -23,7 +22,6 @@
       - "interface {{ intname }}"
     match: none
     defaults: yes
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -40,7 +38,6 @@
     parents:
       - "interface {{ intname }}"
     defaults: yes
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml b/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
index b4e2c0f91d..3e6c4c2ab2 100644
--- a/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
+++ b/test/integration/targets/nxos_config/tests/common/sublevel_block.yaml
@@ -5,7 +5,6 @@
   nxos_config: &clear
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: configure sub level command using block replace
@@ -17,7 +16,6 @@
       - 40 permit ip 192.0.2.4/32 any log
     parents: ip access-list test
     replace: block
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -38,7 +36,6 @@
       - 40 permit ip 192.0.2.4/32 any log
     parents: ip access-list test
     replace: block
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_config/tests/common/toplevel.yaml b/test/integration/targets/nxos_config/tests/common/toplevel.yaml
index 047233b1e3..3589ea7fdb 100644
--- a/test/integration/targets/nxos_config/tests/common/toplevel.yaml
+++ b/test/integration/targets/nxos_config/tests/common/toplevel.yaml
@@ -5,12 +5,10 @@
   nxos_config:
     lines: hostname switch
     match: none
-    provider: "{{ connection }}"
 
 - name: configure top level command
   nxos_config:
     lines: hostname foo
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -21,7 +19,6 @@
 - name: configure top level command idempotent check
   nxos_config:
     lines: hostname foo
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -32,6 +29,5 @@
   nxos_config:
     lines: hostname switch
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg='END common/toplevel.yaml on connection={{ ansible_connection }}'
diff --git a/test/integration/targets/nxos_config/tests/common/toplevel_nonidempotent.yaml b/test/integration/targets/nxos_config/tests/common/toplevel_nonidempotent.yaml
index c1b104825f..c619a7650a 100644
--- a/test/integration/targets/nxos_config/tests/common/toplevel_nonidempotent.yaml
+++ b/test/integration/targets/nxos_config/tests/common/toplevel_nonidempotent.yaml
@@ -5,13 +5,11 @@
   nxos_config:
     lines: hostname switch
     match: none
-    provider: "{{ connection }}"
 
 - name: configure top level command
   nxos_config:
     lines: hostname foo
     match: strict
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -23,7 +21,6 @@
   nxos_config:
     lines: hostname foo
     match: strict
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -34,6 +31,5 @@
   nxos_config:
     lines: hostname switch
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END common/nonidempotent.yaml on connection={{ ansible_connection }}"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/multilevel.yaml b/test/integration/targets/nxos_config/tests/nxapi/multilevel.yaml
index 73f305e56a..892582559a 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/multilevel.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/multilevel.yaml
@@ -5,7 +5,6 @@
   nxos_config:
     lines: feature bgp
     match: none
-    provider: "{{ connection }}"
 
 - name: configure multi level command
   nxos_config:
@@ -13,7 +12,6 @@
     parents:
       - router bgp 1
       - address-family ipv4 unicast
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -29,7 +27,6 @@
     parents:
       - router bgp 1
       - address-family ipv4 unicast
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -40,6 +37,5 @@
   nxos_config:
     lines: no feature bgp
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/mulitlevel.yaml"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/sublevel.yaml b/test/integration/targets/nxos_config/tests/nxapi/sublevel.yaml
index 85e9835a4d..05d97670f0 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/sublevel.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/sublevel.yaml
@@ -5,14 +5,12 @@
   nxos_config:
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: configure sub level command
   nxos_config:
     lines: 10 permit ip any any log
     parents: ip access-list test
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -25,7 +23,6 @@
   nxos_config:
     lines: 10 permit ip any any log
     parents: ip access-list test
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -36,6 +33,5 @@
   nxos_config:
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/sublevel.yaml"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/sublevel_exact.yaml b/test/integration/targets/nxos_config/tests/nxapi/sublevel_exact.yaml
index c4aefad1ca..c3e4382d99 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/sublevel_exact.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/sublevel_exact.yaml
@@ -11,7 +11,6 @@
       - 50 permit ip 192.0.2.5/32 any log
     parents: ip access-list test
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: configure sub level command using exact match
@@ -25,7 +24,6 @@
     before: no ip access-list test
     match: exact
     replace: block
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -47,7 +45,6 @@
       - 40 permit ip 192.0.2.4/32 any log
     parents: ip access-list test
     match: exact
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -58,6 +55,5 @@
   nxos_config:
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/sublevel_exact.yaml"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/sublevel_strict.yaml b/test/integration/targets/nxos_config/tests/nxapi/sublevel_strict.yaml
index dfe2f34c62..3b0bc378aa 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/sublevel_strict.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/sublevel_strict.yaml
@@ -11,7 +11,6 @@
       - 50 permit ip 192.0.2.5/32 any log
     parents: ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - name: configure sub level command using strict match
   nxos_config:
@@ -24,7 +23,6 @@
     before: no ip access-list test
     match: strict
     replace: block
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -46,7 +44,6 @@
       - 40 permit ip 192.0.2.4/32 any log
     parents: ip access-list test
     match: strict
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -57,6 +54,5 @@
   nxos_config:
     lines: no ip access-list test
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/sublevel_strict.yaml"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/toplevel_after.yaml b/test/integration/targets/nxos_config/tests/nxapi/toplevel_after.yaml
index 59ee86db29..8749be5fd5 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/toplevel_after.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/toplevel_after.yaml
@@ -6,14 +6,12 @@
     lines:
       - "snmp-server contact ansible"
       - "hostname switch"
-    provider: "{{ connection }}"
     match: none
 
 - name: configure top level command with before
   nxos_config:
     lines: hostname foo
     after: snmp-server contact bar
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -26,7 +24,6 @@
   nxos_config:
     lines: hostname foo
     after: snmp-server contact foo
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -39,6 +36,5 @@
       - "no snmp-server contact ansible"
       - "hostname switch"
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/toplevel_after.yaml"
diff --git a/test/integration/targets/nxos_config/tests/nxapi/toplevel_before.yaml b/test/integration/targets/nxos_config/tests/nxapi/toplevel_before.yaml
index 98ff2e6a44..a67530773b 100644
--- a/test/integration/targets/nxos_config/tests/nxapi/toplevel_before.yaml
+++ b/test/integration/targets/nxos_config/tests/nxapi/toplevel_before.yaml
@@ -7,13 +7,11 @@
       - "snmp-server contact ansible"
       - "hostname switch"
     match: none
-    provider: "{{ connection }}"
 
 - name: configure top level command with before
   nxos_config:
     lines: hostname foo
     before: snmp-server contact bar
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -26,7 +24,6 @@
   nxos_config:
     lines: hostname foo
     before: snmp-server contact foo
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -39,6 +36,5 @@
       - "no snmp-server contact ansible"
       - "hostname switch"
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/toplevel_before.yaml"
diff --git a/test/integration/targets/nxos_evpn_global/tasks/nxapi.yaml b/test/integration/targets/nxos_evpn_global/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_evpn_global/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_evpn_global/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_evpn_global/tests/common/sanity.yaml b/test/integration/targets/nxos_evpn_global/tests/common/sanity.yaml
index 0a8b503d03..523c2aa776 100644
--- a/test/integration/targets/nxos_evpn_global/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_evpn_global/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_evpn_global sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup"
   nxos_config: &remove_evpn_config
@@ -12,7 +10,6 @@
 - name: "Disable feature nv overlay"
   nxos_feature: &disable_feature_nv_overlay
     feature: nv overlay
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
 
@@ -20,7 +17,6 @@
   - name: "Enable feature nv overlay"
     nxos_feature: &enable_feature_nv_overlay
       feature: nv overlay
-      provider: "{{ connection }}"
       state: enabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_evpn_vni/tasks/nxapi.yaml b/test/integration/targets/nxos_evpn_vni/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_evpn_vni/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_evpn_vni/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml b/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
index 95d76bcf49..ee6c73cf97 100644
--- a/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_evpn_vni sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: nvoe_supported="{{ platform is not search('N3K|N3L|N35')}}"
 
@@ -9,7 +7,6 @@
   nxos_config: &remove_evpn
     lines: no nv overlay evpn
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
   when: nvoe_supported
 
@@ -17,14 +14,12 @@
   - name: "Enable feature BGP"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "Enable nv overlay evpn"
     nxos_config:
       lines: nv overlay evpn
       match: none
-      provider: "{{ connection }}"
 
   - name: "Configure nxos_evpn_vni"
     nxos_evpn_vni: &evpn_vni
@@ -38,7 +33,6 @@
           - auto
           - "5000:10"
           - "192.0.2.1:43"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -59,7 +53,6 @@
       route_distinguisher: "50:20"
       route_target_import: auto
       route_target_export: auto
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -76,7 +69,6 @@
       route_distinguisher: default
       route_target_import: default
       route_target_export: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -90,7 +82,6 @@
   - name: "remove nxos_evpn_vni"
     nxos_evpn_vni: &rvni
       vni: 6000
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -114,7 +105,6 @@
     - name: "Disable feature bgp"
       nxos_feature:
         feature: bgp
-        provider: "{{ connection }}"
         state: disabled
       ignore_errors: yes
     when: nvoe_supported
diff --git a/test/integration/targets/nxos_facts/tests/common/all_facts.yaml b/test/integration/targets/nxos_facts/tests/common/all_facts.yaml
index 4289e2359a..530ccca1ca 100644
--- a/test/integration/targets/nxos_facts/tests/common/all_facts.yaml
+++ b/test/integration/targets/nxos_facts/tests/common/all_facts.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/all_facts.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: test getting all facts
   nxos_facts:
     gather_subset:
       - all
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_facts/tests/common/default_facts.yaml b/test/integration/targets/nxos_facts/tests/common/default_facts.yaml
index 82775e516c..1a3c4cb33f 100644
--- a/test/integration/targets/nxos_facts/tests/common/default_facts.yaml
+++ b/test/integration/targets/nxos_facts/tests/common/default_facts.yaml
@@ -1,11 +1,8 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/default_facts.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: test getting default facts
   nxos_facts:
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_facts/tests/common/invalid_subset.yaml b/test/integration/targets/nxos_facts/tests/common/invalid_subset.yaml
index 9df2fe53d6..048d2c54a2 100644
--- a/test/integration/targets/nxos_facts/tests/common/invalid_subset.yaml
+++ b/test/integration/targets/nxos_facts/tests/common/invalid_subset.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/invalid_subset.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: test invalid subset (foobar)
   nxos_facts:
     gather_subset:
       - "foobar"
-    provider: "{{ connection }}"
   register: result
   ignore_errors: true
 
diff --git a/test/integration/targets/nxos_facts/tests/common/not_hardware.yaml b/test/integration/targets/nxos_facts/tests/common/not_hardware.yaml
index 6c06ec3a24..0e54e51950 100644
--- a/test/integration/targets/nxos_facts/tests/common/not_hardware.yaml
+++ b/test/integration/targets/nxos_facts/tests/common/not_hardware.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/not_hardware_facts.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: test not hardware
   nxos_facts:
     gather_subset:
       - "!hardware"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_facts/tests/common/sanity.yaml b/test/integration/targets/nxos_facts/tests/common/sanity.yaml
index d895b85ebd..728852b881 100644
--- a/test/integration/targets/nxos_facts/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_facts/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_facts sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "nxos_facts gather hardware facts"
   nxos_facts:
     gather_subset: hardware
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -31,7 +28,6 @@
 - name: "nxos_facts gather config facts"
   nxos_facts:
     gather_subset: config
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -54,7 +50,6 @@
     gather_subset:
       - hardware
       - config
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -80,7 +75,6 @@
 - name: "nxos_facts gather features facts"
   nxos_facts:
     gather_subset: features
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_feature/tasks/nxapi.yaml b/test/integration/targets/nxos_feature/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_feature/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_feature/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_feature/tests/common/configure.yaml b/test/integration/targets/nxos_feature/tests/common/configure.yaml
index 220def42d1..2c02bea4c8 100644
--- a/test/integration/targets/nxos_feature/tests/common/configure.yaml
+++ b/test/integration/targets/nxos_feature/tests/common/configure.yaml
@@ -5,12 +5,10 @@
   nxos_config:
     lines: no feature bgp
     match: none
-    provider: "{{ connection }}"
 
 - name: enable bgp
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   register: result
 
@@ -21,7 +19,6 @@
 - name: verify bgp
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   register: result
 
@@ -32,7 +29,6 @@
 - name: disable bgp
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   register: result
 
@@ -43,7 +39,6 @@
 - name: verify bgp
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: disabled
   register: result
 
@@ -55,6 +50,5 @@
   nxos_config:
     lines: no feature bgp
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END connection={{ ansible_connection }}/configure.yaml"
diff --git a/test/integration/targets/nxos_feature/tests/common/invalid.yaml b/test/integration/targets/nxos_feature/tests/common/invalid.yaml
index 8d0baf6b2c..477eaf6416 100644
--- a/test/integration/targets/nxos_feature/tests/common/invalid.yaml
+++ b/test/integration/targets/nxos_feature/tests/common/invalid.yaml
@@ -4,7 +4,6 @@
 - name: configure invalid feature name
   nxos_feature:
     feature: invalid
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_file_copy/tasks/nxapi.yaml b/test/integration/targets/nxos_file_copy/tasks/nxapi.yaml
index c85edec402..653bcfefe9 100644
--- a/test/integration/targets/nxos_file_copy/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_file_copy/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_file_copy/tests/nxapi/badtransport.yaml b/test/integration/targets/nxos_file_copy/tests/nxapi/badtransport.yaml
index 7cd44709ea..d6f629af35 100644
--- a/test/integration/targets/nxos_file_copy/tests/nxapi/badtransport.yaml
+++ b/test/integration/targets/nxos_file_copy/tests/nxapi/badtransport.yaml
@@ -6,7 +6,6 @@
     local_file: "./network-integration.cfg"
     file_system: "bootflash:"
     connect_ssh_port: "{{ ansible_ssh_port }}"
-    provider: "{{ nxapi }}"
   register: result
   ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_gir/tasks/nxapi.yaml b/test/integration/targets/nxos_gir/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_gir/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_gir/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_gir/tests/common/sanity.yaml b/test/integration/targets/nxos_gir/tests/common/sanity.yaml
index ae99be8e22..03aa124d15 100644
--- a/test/integration/targets/nxos_gir/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_gir/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_gir sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: gir_run="true"
 - set_fact: gir_run="false"
@@ -9,14 +7,12 @@
 #- name: "Setup"
 #  nxos_gir: &setup
 #    system_mode_maintenance: false
-#    provider: "{{ connection }}"
 #  ignore_errors: yes
 
 - block:
   - name: "Put system in maintenance mode with reload reset reason"
     nxos_gir: &reset_reason
       system_mode_maintenance_on_reload_reset_reason: manual_reload
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -35,7 +31,6 @@
     nxos_gir: &remove_reason
       system_mode_maintenance_on_reload_reset_reason: manual_reload
       state: absent
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -49,7 +44,6 @@
   - name: "Put system in maintenance mode with timeout"
     nxos_gir: &mtime
       system_mode_maintenance_timeout: 30
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -64,7 +58,6 @@
     nxos_gir: &remove_timeout
       system_mode_maintenance_timeout: 30
       state: absent
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -78,7 +71,6 @@
 #  - name: "Put system in maintenance mode"
 #    nxos_gir: &configure_system_mode_maintenance
 #      system_mode_maintenance: true
-#      provider: "{{ connection }}"
 #    register: result
 #
 #  - assert: *true
@@ -94,21 +86,18 @@
   - name: "Remove snapshots"
     nxos_snapshot:
       action: delete_all
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: "Remove other config1"
     nxos_config:
       lines: no configure maintenance profile normal-mode
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: "Remove other config2"
     nxos_config:
       lines: no configure maintenance profile maintenance-mode
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
 #  - name: "Put system back in normal mode"
diff --git a/test/integration/targets/nxos_gir_profile_management/tasks/nxapi.yaml b/test/integration/targets/nxos_gir_profile_management/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_gir_profile_management/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_gir_profile_management/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_gir_profile_management/tests/common/sanity.yaml b/test/integration/targets/nxos_gir_profile_management/tests/common/sanity.yaml
index 29327a88cc..5911da91bb 100644
--- a/test/integration/targets/nxos_gir_profile_management/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_gir_profile_management/tests/common/sanity.yaml
@@ -1,26 +1,21 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_gir_profile_management sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup - Remove maintenace mode profiles"
   nxos_gir_profile_management: &remove_maintenance
     mode: maintenance
-    provider: "{{ connection }}"
     state: absent    
   ignore_errors: yes
 
 - name: "Setup - Remove normal mode profiles"
   nxos_gir_profile_management: &remove_normal
     mode: normal
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
 - name: "Setup - Turn on feature eigrp"
   nxos_feature: 
     feature: eigrp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -31,7 +26,6 @@
       commands:
         - router eigrp 11
         - isolate
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -53,7 +47,6 @@
       commands:
         - router eigrp 11
         - isolate
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -106,7 +99,6 @@
   - name: "Turn off feature eigrp"
     nxos_feature:
       feature: eigrp
-      provider: "{{ connection }}"
       state: disabled
 
   - debug: msg="END connection={{ ansible_connection }} nxos_gir_profile_management sanity test"  
diff --git a/test/integration/targets/nxos_hsrp/tasks/nxapi.yaml b/test/integration/targets/nxos_hsrp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_hsrp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_hsrp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_hsrp/tests/common/sanity.yaml b/test/integration/targets/nxos_hsrp/tests/common/sanity.yaml
index cb09438c4c..9e09820a9f 100644
--- a/test/integration/targets/nxos_hsrp/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_hsrp/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_hsrp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname1="{{ nxos_int1 }}"
@@ -11,7 +9,6 @@
   - name: "Enable feature hsrp"
     nxos_feature:
       feature: hsrp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "change int1 mode"
@@ -21,7 +18,6 @@
       parents:
         - "interface {{ intname1 }}"
       match: none
-      provider: "{{ connection }}"
 
   - name: "change int2 mode"
     nxos_config:
@@ -30,7 +26,6 @@
       parents:
         - "interface {{ intname2 }}"
       match: none
-      provider: "{{ connection }}"
 
   - name: "configure nxos_hsrp"
     nxos_hsrp: &conf1000
@@ -42,7 +37,6 @@
       preempt: enabled
       auth_type: md5
       auth_string: "7 1234"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -67,7 +61,6 @@
       preempt: enabled
       auth_type: md5
       auth_string: "0 1234"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -88,7 +81,6 @@
       preempt: disabled
       auth_type: md5
       auth_string: "0 1234"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -107,7 +99,6 @@
       interface: "{{ intname2 }}"
       auth_type: text
       auth_string: "1234"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -126,7 +117,6 @@
       interface: "{{ intname2 }}"
       auth_type: text
       auth_string: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -141,7 +131,6 @@
     nxos_hsrp: &remove
       group: 1000
       interface: "{{ intname1 }}"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -157,7 +146,6 @@
   - name: "Disable feature hsrp"
     nxos_feature:
       feature: hsrp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_igmp/tasks/nxapi.yaml b/test/integration/targets/nxos_igmp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_igmp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_igmp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_igmp/tests/common/sanity.yaml b/test/integration/targets/nxos_igmp/tests/common/sanity.yaml
index e5ea444dce..62b2e12950 100644
--- a/test/integration/targets/nxos_igmp/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_igmp/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_igmp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: restart="true"
   when: platform is not match("N35")
@@ -13,7 +11,6 @@
       flush_routes: true
       enforce_rtr_alert: true
       restart: false
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -34,7 +31,6 @@
       flush_routes: false
       enforce_rtr_alert: false
       restart: "{{restart|default(omit)}}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -52,7 +48,6 @@
 
   - name: Configure igmp state as values
     nxos_igmp: &sdefault
-      provider: "{{ connection }}"
       state: default
     register: result
 
diff --git a/test/integration/targets/nxos_igmp_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_igmp_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_igmp_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_igmp_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_igmp_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_igmp_interface/tests/common/sanity.yaml
index 32c54ef33e..1aaadfc50d 100644
--- a/test/integration/targets/nxos_igmp_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_igmp_interface/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_igmp_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -12,7 +10,6 @@
 - name: "Enable feature PIM"
   nxos_feature:
     feature: pim
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -21,7 +18,6 @@
     commands:
     - "default interface {{ intname }}"
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - block:
@@ -34,7 +30,6 @@
       parents:
         - "interface {{ intname }}"
       match: none
-      provider: "{{ connection }}"
 
   - name: Configure igmp interface with non-default values
     nxos_igmp_interface: &non-default
@@ -54,7 +49,6 @@
       # deprecated
       oif_prefix: 239.255.255.2
       oif_source: 192.0.2.1
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -87,7 +81,6 @@
         - {'prefix': '238.2.2.6'}
         - {'prefix': '238.2.2.5'}
         - {'source': '192.0.2.1', 'prefix': '238.2.2.5'}
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -103,13 +96,11 @@
     nxos_igmp_interface: &restart
       interface: "{{ intname }}"
       restart: "{{restart|default(omit)}}"
-      provider: "{{ connection }}"
 
   - name: Configure igmp interface with default oif_ps
     nxos_igmp_interface: &defoif
       interface: "{{ intname }}"
       oif_ps: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -129,7 +120,6 @@
       startup_query_count: 5
       robustness: 6
       oif_routemap: abcd
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -144,7 +134,6 @@
   - name: Configure igmp interface with default state
     nxos_igmp_interface: &default
       interface: "{{ intname }}"
-      provider: "{{ connection }}"
       state: default
     register: result
 
@@ -159,7 +148,6 @@
   - name: Configure igmp interface with absent state
     nxos_igmp_interface: &absent
       interface: "{{ intname }}"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -181,12 +169,10 @@
       commands:
       - "default interface {{ intname }}"
       match: none
-      provider: "{{ connection }}"
 
   - name: "Disable feature PIM"
     nxos_feature:
       feature: pim
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_igmp_snooping/tasks/nxapi.yaml b/test/integration/targets/nxos_igmp_snooping/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_igmp_snooping/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_igmp_snooping/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_igmp_snooping/tests/common/sanity.yaml b/test/integration/targets/nxos_igmp_snooping/tests/common/sanity.yaml
index 32385ae8af..25e55b3872 100644
--- a/test/integration/targets/nxos_igmp_snooping/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_igmp_snooping/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_igmp_snooping sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - meta: end_host
   # show ip igmp snooping | json does not work on some platforms
@@ -16,7 +14,6 @@
 
 - name: Setup
   nxos_igmp_snooping: &default
-    provider: "{{ connection }}"
     state: default
 
 - block:
@@ -27,7 +24,6 @@
       link_local_grp_supp: false
       report_supp: false
       v3_report_supp: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -49,7 +45,6 @@
       nxos_igmp_snooping:
         snooping: false
         group_timeout: "{{group_timeout|default(omit)}}"
-        provider: "{{ connection }}"
         state: present
       ignore_errors: yes
       register: result
@@ -63,7 +58,6 @@
       nxos_igmp_snooping: &non-defgt
         snooping: true
         group_timeout: "{{group_timeout|default(omit)}}"
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -79,7 +73,6 @@
   - name: Configure igmp snooping with default group timeout
     nxos_igmp_snooping: &defgt
       group_timeout: "{{def_group_timeout|default(omit)}}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_install_os/tasks/main.yaml b/test/integration/targets/nxos_install_os/tasks/main.yaml
index 9199166cd5..0530efb6b3 100644
--- a/test/integration/targets/nxos_install_os/tasks/main.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/main.yaml
@@ -5,6 +5,4 @@
 
 # Upgrade using NX-API
 - include: httpapi.yaml
-  when: ansible_connection == 'httpapi'
-- include: nxapi.yaml
-  when: ansible_connection == 'local'
+  when: ansible_connection == 'httpapi'
\ No newline at end of file
diff --git a/test/integration/targets/nxos_install_os/tasks/nxapi.yaml b/test/integration/targets/nxos_install_os/tasks/nxapi.yaml
deleted file mode 100644
index 51e03b8daf..0000000000
--- a/test/integration/targets/nxos_install_os/tasks/nxapi.yaml
+++ /dev/null
@@ -1,16 +0,0 @@
----
-- name: collect common test cases
-  find:
-    paths: "{{ role_path }}/tests/common"
-    patterns: "{{ testcase }}.yaml"
-  connection: local
-  register: test_cases
-
-- name: set test_items
-  set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
-- name: run test cases (ansible_connection=local transport=nxapi)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/copy_kick_system_images.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/copy_kick_system_images.yaml
index e1c57cad95..9e117835c7 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/copy_kick_system_images.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/copy_kick_system_images.yaml
@@ -8,7 +8,6 @@
 - name: 'Remove SSH known_hosts file before scp of image file'
   nxos_command:
     commands: 'run bash rm /var/home/admin/.ssh/known_hosts'
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Copy {{ si }} to bootflash"
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/delete_files.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/delete_files.yaml
index f72f31569f..27157b690b 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/delete_files.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/delete_files.yaml
@@ -6,6 +6,5 @@
       - allow delete boot-image
       - "delete {{ item }}"
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
   with_items: "{{ delete_image_list }}"
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/enable_scp_server.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/enable_scp_server.yaml
index 4fcae4ca60..f8a4e54e34 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/enable_scp_server.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/enable_scp_server.yaml
@@ -3,4 +3,3 @@
   nxos_feature:
     feature: scp-server
     state: enabled
-    provider: "{{ connection }}"
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/install_os.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/install_os.yaml
index 2c0dac2639..a7d21a5117 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/install_os.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/install_os.yaml
@@ -19,7 +19,6 @@
 - name: "Check installed OS for newly installed version {{ tv }}"
   nxos_command:
     commands: ['show version | json']
-    provider: "{{ connection }}"
   register: output
 
 - debug: msg="Version detected {{ output['stdout_lines'][0]['kickstart_ver_str'] }}"
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/install_system.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/install_system.yaml
index 9b647f459b..09ed721649 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/install_system.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/install_system.yaml
@@ -4,7 +4,6 @@
   nxos_install_os:
     system_image_file: "{{ si }}"
     issu: "{{ issu }}"
-    provider: "{{ connection }}"
   register: result
   when: not force
 
@@ -15,7 +14,6 @@
       - no boot kickstart
       - no boot system
     match: line
-    provider: "{{ connection }}"
   ignore_errors: yes
   when: force
 
@@ -25,7 +23,6 @@
       - "boot nxos bootflash:{{ si }}"
       - copy run start
     match: line
-    provider: "{{ connection }}"
   when: force
 
 - name: "Boot image {{ si }} using reload"
@@ -33,7 +30,6 @@
     lines:
       - 'terminal dont-ask'
       - 'reload'
-    provider: "{{ connection }}"
   ignore_errors: yes
   when: force
 
diff --git a/test/integration/targets/nxos_install_os/tasks/upgrade/install_with_kick.yaml b/test/integration/targets/nxos_install_os/tasks/upgrade/install_with_kick.yaml
index 524a4a5df3..8d02cb9a78 100644
--- a/test/integration/targets/nxos_install_os/tasks/upgrade/install_with_kick.yaml
+++ b/test/integration/targets/nxos_install_os/tasks/upgrade/install_with_kick.yaml
@@ -5,7 +5,6 @@
     system_image_file: "{{ si }}"
     kickstart_image_file: "{{ ki }}"
     issu: "{{ issu }}"
-    provider: "{{ connection }}"
   register: result
   when: not force
 
@@ -18,13 +17,11 @@
       - "boot system bootflash:{{ si }}"
       - copy run start
     match: line
-    provider: "{{ connection }}"
   when: force
 
 - name: "Boot image {{ si }} using reload"
   nxos_command:
     commands: 'terminal dont-ask ; reload'
-    provider: "{{ connection }}"
   ignore_errors: yes
   when: force
 
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade.yaml
index 3c8c213408..5211c51fc1 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 - set_fact: image_dir='/Users/mwiebe/Projects/nxos_ansible/images/'
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_greensboro.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_greensboro.yaml
index e1d47bc531..4c4086bd99 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_greensboro.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_greensboro.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u61a.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u61a.yaml
index 7f5a7a9ea4..3d72792c6f 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u61a.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u61a.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u62a.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u62a.yaml
index bf70c2a5c4..35de71810b 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u62a.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u62a.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u63a.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u63a.yaml
index 6040c159a6..e9b02b3684 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u63a.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n3172_u63a.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_62a88.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_62a88.yaml
index a55948ccbb..2a87ff4b58 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_62a88.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_62a88.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_greensboro.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_greensboro.yaml
index a38e3c1504..1ac5cb409d 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_greensboro.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n35_greensboro.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_730_N11.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_730_N11.yaml
index aafb125ede..4d119133f2 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_730_N11.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_730_N11.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_733_N11.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_733_N11.yaml
index 3ee83ebfef..1e585567ad 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_733_N11.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n5k_733_N11.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_atherton.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_atherton.yaml
index 6ab9b3f607..31e0620fb2 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_atherton.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_atherton.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_helsinki.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_helsinki.yaml
index d80a3b6365..ba6122e85b 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_helsinki.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n7k_helsinki.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro.yaml
index ff1f5a6619..b95cc27b1e 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
@@ -29,7 +28,6 @@
       - no nxapi ssl protocols
       - no nxapi ssl ciphers weak
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 #---------------------------------------------------------#
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro_force.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro_force.yaml
index c6c3ebdd1a..9f6a148145 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro_force.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_greensboro_force.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
@@ -29,7 +28,6 @@
       - no nxapi ssl protocols
       - no nxapi ssl ciphers weak
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 #---------------------------------------------------------#
diff --git a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_hamilton.yaml b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_hamilton.yaml
index cad8250297..b52e2044b5 100644
--- a/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_hamilton.yaml
+++ b/test/integration/targets/nxos_install_os/tests/common/upgrade_n9k_hamilton.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_os_install upgrade"
-- debug: msg="Using provider={{ connection.transport }}"
   when: connection is defined
 
 # Set directory pointer to software images
@@ -27,7 +26,6 @@
       - terminal dont-ask
       - no feature ngmvpn
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 #---------------------------------------------------------#
diff --git a/test/integration/targets/nxos_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_interface/tests/common/intent.yaml b/test/integration/targets/nxos_interface/tests/common/intent.yaml
index 113c8a353f..b3c0f42fb3 100644
--- a/test/integration/targets/nxos_interface/tests/common/intent.yaml
+++ b/test/integration/targets/nxos_interface/tests/common/intent.yaml
@@ -1,6 +1,4 @@
 - debug: msg="START connection={{ ansible_connection }} nxos_interface intent test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint1="{{ nxos_int1 }}"
 - set_fact: testint2="{{ nxos_int2 }}"
@@ -10,7 +8,6 @@
     lines:
       - "default interface {{ testint1 }}"
       - "default interface {{ testint2 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: Check intent arguments
@@ -19,7 +16,6 @@
     admin_state: up
     tx_rate: ge(0)
     rx_rate: ge(0)
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -37,7 +33,6 @@
     admin_state: down
     tx_rate: gt(10000)
     rx_rate: lt(0)
-    provider: "{{ connection }}"
   ignore_errors: yes
   register: result
 
@@ -52,7 +47,6 @@
     aggregate:
       - { name: "{{ testint1 }}", description: "Test aggregation on first interface" }
       - { name: "{{ testint2 }}", mode: layer3 }
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -64,7 +58,6 @@
     lines:
       - "default interface {{ testint1 }}"
       - "default interface {{ testint2 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - debug: msg="END connection={{ ansible_connection }} nxos_interface intent test"
diff --git a/test/integration/targets/nxos_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_interface/tests/common/sanity.yaml
index fa2d520007..3151152eb0 100644
--- a/test/integration/targets/nxos_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_interface/tests/common/sanity.yaml
@@ -1,14 +1,11 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint="{{ nxos_int1 }}"
 
 - name: "Setup: Enable feature interface-vlan"
   nxos_feature:
     feature: interface-vlan
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -16,7 +13,6 @@
   nxos_config: &intcleanup
     lines:
       - "default interface {{ testint }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Setup: Remove possibly existing vlan interfaces"
@@ -26,7 +22,6 @@
       - "no interface vlan 710"
       - "no interface vlan 711"
       - "no interface vlan 712"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - block:
@@ -36,7 +31,6 @@
       mode: layer3
       description: 'Configured by Ansible - Layer3'
       admin_state: up
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -58,7 +52,6 @@
       mode: layer2
       description: 'Configured by Ansible - Layer2'
       admin_state: down
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -74,7 +67,6 @@
     nxos_interface: &createvlans
       interface: "{{ item.os_svi_int }}"
       description: "{{ item.os_svi_desc }}"
-      provider: "{{ connection }}"
     with_items: &vlanitems
       - {os_svi_int: vlan2, os_svi_desc: SVI_VLAN2}
       - {os_svi_int: vlan710, os_svi_desc: SVI_VLAN710}
@@ -91,7 +83,6 @@
         - {name: vlan710, ipv4: 192.168.3.1/24}
         - {name: vlan711, ipv4: 192.168.4.1/24}
         - {name: vlan712, ipv4: 192.168.5.1/24}
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -120,7 +111,6 @@
   - name: "Setup: Disable feature interface-vlan"
     nxos_feature:
       feature: interface-vlan
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_interface/tests/common/set_state_absent.yaml b/test/integration/targets/nxos_interface/tests/common/set_state_absent.yaml
index 4f55e14421..06b06671ea 100644
--- a/test/integration/targets/nxos_interface/tests/common/set_state_absent.yaml
+++ b/test/integration/targets/nxos_interface/tests/common/set_state_absent.yaml
@@ -1,18 +1,14 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/set_state_absent.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: setup
   nxos_config:
     lines:
       - interface Loopback1
-    provider: "{{ connection }}"
 
 - name: set state=absent
   nxos_interface:
     interface: Loopback1
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -23,7 +19,6 @@
 - name: verify state=absent
   nxos_interface:
     interface: Loopback1
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_interface/tests/common/set_state_present.yaml b/test/integration/targets/nxos_interface/tests/common/set_state_present.yaml
index 51f10ef584..ff2bf8c232 100644
--- a/test/integration/targets/nxos_interface/tests/common/set_state_present.yaml
+++ b/test/integration/targets/nxos_interface/tests/common/set_state_present.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/set_state_present.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: setup
   nxos_config:
     lines:
       - no interface Loopback1
-    provider: "{{ connection }}"
   ignore_errors: yes # Fails if the interface is already absent
 
 - name: set state=present
   nxos_interface:
     interface: Loopback1
-    provider: "{{ connection }}"
     state: present
     description: 'Configured by Ansible - Layer3'
   register: result
@@ -25,7 +21,6 @@
 - name: verify state=present
   nxos_interface:
     interface: Loopback1
-    provider: "{{ connection }}"
     state: present
     description: 'Configured by Ansible - Layer3'
   register: result
diff --git a/test/integration/targets/nxos_interface/tests/common/sub_int.yaml b/test/integration/targets/nxos_interface/tests/common/sub_int.yaml
index 15e54b3e9a..16d7fa6028 100644
--- a/test/integration/targets/nxos_interface/tests/common/sub_int.yaml
+++ b/test/integration/targets/nxos_interface/tests/common/sub_int.yaml
@@ -1,14 +1,11 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_interface sub-interface test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint="{{ nxos_int1 }}"
 
 - name: Setup - delete sub-interface
   nxos_interface: &rm
     name: "{{ testint }}.20"
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -16,7 +13,6 @@
   nxos_interface:
     name: "{{ testint }}"
     mode: layer3
-    provider: "{{ connection }}"
 
 - name: Create sub-interface
   nxos_interface: &sub_int
@@ -24,7 +20,6 @@
     description: "sub-interface Configured by Ansible"
     admin_state: up
     mtu: 800
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -45,7 +40,6 @@
     description: "sub-interface Configured by Ansible"
     admin_state: down
     mtu: 800
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_interface_ospf/tasks/nxapi.yaml b/test/integration/targets/nxos_interface_ospf/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_interface_ospf/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_interface_ospf/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_interface_ospf/tests/common/sanity.yaml b/test/integration/targets/nxos_interface_ospf/tests/common/sanity.yaml
index d4faa84fd9..de9f7209f9 100644
--- a/test/integration/targets/nxos_interface_ospf/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_interface_ospf/tests/common/sanity.yaml
@@ -1,14 +1,11 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_interface_ospf sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint="{{ nxos_int1 }}"
 
 - name: Setup - Disable features
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: disabled
   loop: ['ospf', 'bfd']
   ignore_errors: yes
@@ -16,7 +13,6 @@
 - name: Setup - Enable features
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: enabled
   loop: ['ospf', 'bfd']
 
@@ -24,7 +20,6 @@
   nxos_config: &intdefault
     lines:
       - "default interface {{ testint }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Remove switchport config"
@@ -33,7 +28,6 @@
       - no switchport
     parents:
       - "interface {{ testint }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Remove possibly existing port-channel and loopback ints"
@@ -43,7 +37,6 @@
       - no interface port-channel11
       - no interface loopback55
       - no interface loopback77
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - block:
@@ -58,7 +51,6 @@
       hello_interval: 15
       dead_interval: 75
       network: point-to-point
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -84,7 +76,6 @@
       hello_interval: 17
       dead_interval: 70
       network: broadcast
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -105,7 +96,6 @@
       cost: default
       hello_interval: 10
       dead_interval: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -127,7 +117,6 @@
       message_digest_algorithm_type: md5
       message_digest_encryption_type: 3des
       message_digest_password: b69f7bc54725b1bfd1ea93afa7b09400
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -149,7 +138,6 @@
       message_digest_algorithm_type: default
       message_digest_encryption_type: default
       message_digest_password: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -169,7 +157,6 @@
         - interface loopback55
         - interface loopback77
       match: none
-      provider: "{{ connection }}"
 
   - name: "Ensure port-channels are layer3"
     nxos_config:
@@ -177,7 +164,6 @@
         - no switchport
       parents:
         - "interface {{ item }}"
-      provider: "{{ connection }}"
     with_items:
       - port-channel10
       - port-channel11
@@ -191,7 +177,6 @@
       passive_interface: true
       hello_interval: 15
       dead_interval: 75
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -212,7 +197,6 @@
       passive_interface: true
       hello_interval: 15
       dead_interval: 75
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -232,7 +216,6 @@
       cost: 55
       hello_interval: 15
       dead_interval: 75
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -252,7 +235,6 @@
       cost: 77
       hello_interval: 45
       dead_interval: 75
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -274,7 +256,6 @@
       passive_interface: true
       hello_interval: 15
       dead_interval: 75
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -290,7 +271,6 @@
   - name: Disable features
     nxos_feature:
       feature: "{{ item }}"
-      provider: "{{ connection }}"
       state: disabled
     loop: ['ospf', 'bfd']
     ignore_errors: yes
diff --git a/test/integration/targets/nxos_interfaces/tasks/nxapi.yaml b/test/integration/targets/nxos_interfaces/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_interfaces/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_interfaces/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_l2_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_l2_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_l2_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_l2_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_l2_interface/tests/common/agg.yaml b/test/integration/targets/nxos_l2_interface/tests/common/agg.yaml
index 8716424269..25b4183daa 100644
--- a/test/integration/targets/nxos_l2_interface/tests/common/agg.yaml
+++ b/test/integration/targets/nxos_l2_interface/tests/common/agg.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_l2_interface aggregate test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname1="{{ nxos_int1 }}"
@@ -10,7 +8,6 @@
 - name: "Setup vlans"
   nxos_vlan:
     vlan_range: "6,15"
-    provider: "{{ connection }}"
 
 - name: Setup - Ensure interfaces are layer2
   nxos_interface:
@@ -18,14 +15,12 @@
       - { name: "{{ intname1 }}" }
       - { name: "{{ intname2 }}" }
     mode: layer2
-    provider: "{{ connection }}"
 
 - name: Setup - Remove interface aggregate before testing
   nxos_l2_interface:
     aggregate:
       - { name: "{{ intname1 }}", mode: access, access_vlan: 6 }
       - { name: "{{ intname2 }}", mode: access, access_vlan: 15 }
-    provider: "{{ connection }}"
     state: absent
 
 - name: Sleep for 2 seconds on Fretta Platform
@@ -38,7 +33,6 @@
       aggregate:
         - { name: "{{ intname1 }}", mode: access, access_vlan: 6 }
         - { name: "{{ intname2 }}", mode: access, access_vlan: 15 }
-      provider: "{{ connection }}"
     register: result
 
   - assert:
@@ -62,7 +56,6 @@
       aggregate:
         - { name: "{{ intname1 }}", mode: access, access_vlan: 6 }
         - { name: "{{ intname2 }}", mode: access, access_vlan: 15 }
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -86,7 +79,6 @@
   - name: "remove vlans"
     nxos_vlan:
       vlan_range: "6,15"
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
@@ -95,7 +87,6 @@
       aggregate:
         - { name: "{{ intname1 }}", mode: access, access_vlan: 6 }
         - { name: "{{ intname2 }}", mode: access, access_vlan: 15 }
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_l2_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_l2_interface/tests/common/sanity.yaml
index 7854ec28c3..e21bf2d46a 100644
--- a/test/integration/targets/nxos_l2_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_l2_interface/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_l2_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -13,25 +11,21 @@
   nxos_config: &default
     lines:
       - "default interface {{ intname }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: Setup - Ensure interface is layer2
   nxos_interface:
     interface: "{{ intname }}"
     mode: layer2
-    provider: "{{ connection }}"
 
 - name: "Setup vlans"
   nxos_vlan:
     vlan_range: "5-10,20"
-    provider: "{{ connection }}"
 
 - block:
   - name: Ensure interface is in its default switchport state
     nxos_l2_interface: &def_swi
       name: "{{ intname }}"
-      provider: "{{ connection }}"
       state: unconfigured
 
   - name: Ensure interface is configured for access vlan 20
@@ -39,7 +33,6 @@
       name: "{{ intname }}"
       mode: access
       access_vlan: 20
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -64,7 +57,6 @@
       mode: trunk
       native_vlan: 10
       trunk_allowed_vlans: 5-10
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -81,7 +73,6 @@
       mode: trunk
       native_vlan: 10
       trunk_vlans: 2-50
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -97,7 +88,6 @@
       name: "{{ intname }}"
       mode: trunk
       trunk_vlans: 2-50
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -126,7 +116,6 @@
       name: "{{ intname }}"
       mode: trunk
       trunk_vlans: 30-4094
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -154,7 +143,6 @@
   - name: "remove vlans"
     nxos_vlan:
       vlan_range: "5-10,20"
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_l2_interfaces/tasks/nxapi.yaml b/test/integration/targets/nxos_l2_interfaces/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_l2_interfaces/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_l2_interfaces/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_l3_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_l3_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_l3_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_l3_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_l3_interface/tests/cli/sanity.yaml b/test/integration/targets/nxos_l3_interface/tests/cli/sanity.yaml
index 949dcd8829..6a0e48e124 100644
--- a/test/integration/targets/nxos_l3_interface/tests/cli/sanity.yaml
+++ b/test/integration/targets/nxos_l3_interface/tests/cli/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START TRANSPORT:CLI nxos_l3_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: testint2="{{ nxos_int2 }}"
diff --git a/test/integration/targets/nxos_l3_interface/tests/nxapi/sanity.yaml b/test/integration/targets/nxos_l3_interface/tests/nxapi/sanity.yaml
index 4f04c31169..054a356c4b 100644
--- a/test/integration/targets/nxos_l3_interface/tests/nxapi/sanity.yaml
+++ b/test/integration/targets/nxos_l3_interface/tests/nxapi/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START TRANSPORT:NXAPI nxos_l3_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: testint2="{{ nxos_int2 }}"
@@ -16,7 +14,6 @@
     aggregate:
       - { name: "{{ testint2 }}", ipv4: 192.168.22.1/24 }
       - { name: "{{ testint3 }}", ipv4: 192.168.20.1/24, ipv6: "{{ ipv6_address }}" }
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -26,13 +23,11 @@
       - name: "{{ testint2 }}"
       - name: "{{ testint3 }}"
     mode: layer3
-    provider: "{{ connection }}"
 
 - name: Configure ipv4 address to interface
   nxos_l3_interface: &conf
     name: "{{ testint2 }}"
     ipv4: 192.168.22.1/24
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -51,7 +46,6 @@
   nxos_l3_interface: &rm
     name: "{{ testint2 }}"
     ipv4: 192.168.22.1/24
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -72,7 +66,6 @@
     aggregate:
       - { name: "{{ testint2 }}", ipv4: 192.168.22.1/24 }
       - { name: "{{ testint3 }}", ipv4: 192.168.20.1/24, ipv6: "{{ ipv6_address }}" }
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -92,7 +85,6 @@
     aggregate:
       - { name: "{{ testint2 }}", ipv4: 192.168.22.1/24 }
       - { name: "{{ testint3 }}", ipv4: 192.168.20.1/24, ipv6: "{{ ipv6_address }}" }
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_l3_interfaces/tasks/nxapi.yaml b/test/integration/targets/nxos_l3_interfaces/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_l3_interfaces/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_l3_interfaces/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_lacp_interfaces/tasks/nxapi.yaml b/test/integration/targets/nxos_lacp_interfaces/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_lacp_interfaces/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_lacp_interfaces/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_linkagg/tasks/nxapi.yaml b/test/integration/targets/nxos_linkagg/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_linkagg/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_linkagg/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_linkagg/tests/common/sanity.yaml b/test/integration/targets/nxos_linkagg/tests/common/sanity.yaml
index e650cfc859..a25c705719 100644
--- a/test/integration/targets/nxos_linkagg/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_linkagg/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_linkagg sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint1="{{ nxos_int1 }}"
 - set_fact: testint2="{{ nxos_int2 }}"
@@ -9,7 +7,6 @@
 - name: "Enable feature LACP"
   nxos_feature:
     feature: lacp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -18,7 +15,6 @@
     lines:
       - no interface port-channel 20
       - no interface port-channel 100
-    provider: "{{ connection }}"
 
 - name: setup - remove config used in test(part2)
   nxos_config:
@@ -36,13 +32,11 @@
     - { name: "{{testint1}}" }
     - { name: "{{testint2}}" }
     mode: layer2
-    provider: "{{ connection }}"
   when: platform is match("N35")
 
 - name: create linkagg
   nxos_linkagg: &create
     group: 20
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -67,7 +61,6 @@
     members:
       - "{{ testint1 }}"
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -93,7 +86,6 @@
     force: True
     members:
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -113,7 +105,6 @@
 - name: remove linkagg
   nxos_linkagg: &remove
     group: 20
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -135,7 +126,6 @@
     aggregate:
       - { group: 20, min_links: 3 }
       - { group: 100, min_links: 4 }
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -159,7 +149,6 @@
     aggregate:
       - { group: 20, min_links: 3 }
       - { group: 100, min_links: 4 }
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -182,14 +171,12 @@
     lines:
       - no interface port-channel 20
       - no interface port-channel 100
-    provider: "{{ connection }}"
 
 - name: teardown - remove config used in test(part2)
   nxos_config:
     lines:
       - no channel-group 20
     parents: "{{ item }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
   loop:
     - "interface {{ testint1 }}"
@@ -198,7 +185,6 @@
 - name: "Disable feature LACP"
   nxos_feature:
     feature: lacp
-    provider: "{{ connection }}"
     state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_linkagg sanity test"
diff --git a/test/integration/targets/nxos_lldp/tasks/nxapi.yaml b/test/integration/targets/nxos_lldp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_lldp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_lldp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_lldp/tests/cli/sanity.yaml b/test/integration/targets/nxos_lldp/tests/cli/sanity.yaml
index 98c4c9e5a5..5871928c52 100644
--- a/test/integration/targets/nxos_lldp/tests/cli/sanity.yaml
+++ b/test/integration/targets/nxos_lldp/tests/cli/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START TRANSPORT:CLI nxos_lldp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Make sure LLDP is not running before tests
   nxos_feature:
diff --git a/test/integration/targets/nxos_lldp/tests/nxapi/sanity.yaml b/test/integration/targets/nxos_lldp/tests/nxapi/sanity.yaml
index ec5bf8b444..d8abc1caa8 100644
--- a/test/integration/targets/nxos_lldp/tests/nxapi/sanity.yaml
+++ b/test/integration/targets/nxos_lldp/tests/nxapi/sanity.yaml
@@ -1,17 +1,13 @@
 ---
 - debug: msg="START TRANSPORT:NXAPI nxos_lldp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Make sure LLDP is not running before tests
   nxos_feature:
     feature: lldp
-    provider: "{{ connection }}"
     state: disabled
 
 - name: Enable LLDP service
   nxos_lldp:
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -22,7 +18,6 @@
 
 - name: Enable LLDP service again (idempotent)
   nxos_lldp:
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -32,7 +27,6 @@
 
 - name: Disable LLDP service
   nxos_lldp:
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -43,7 +37,6 @@
 
 - name: Disable LLDP service (idempotent)
   nxos_lldp:
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_logging/tasks/nxapi.yaml b/test/integration/targets/nxos_logging/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_logging/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_logging/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_logging/tests/common/basic.yaml b/test/integration/targets/nxos_logging/tests/common/basic.yaml
index d1eb548fc3..4dd11efac7 100644
--- a/test/integration/targets/nxos_logging/tests/common/basic.yaml
+++ b/test/integration/targets/nxos_logging/tests/common/basic.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_logging basic test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # This task is needed to clear out any previous logfile
 # size settings.
@@ -9,19 +7,16 @@
   nxos_config:
     lines:
       - logging logfile test 1 size 4194304
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: Purge logging configuration first
   nxos_logging:
     purge: true
-    provider: "{{ connection }}"
 
 - name: Set up console logging
   nxos_logging: &clog
     dest: console
     dest_level: 0
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -42,7 +37,6 @@
   nxos_logging: &clog2
     dest: console
     dest_level: 2
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -62,13 +56,11 @@
     lines:
       - speed 19200
     parents: line console
-    provider: "{{ connection }}"
 
 - name: Enable console logging with level 3 (will fail)
   nxos_logging: &con3
     dest: console
     dest_level: 3
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
@@ -81,7 +73,6 @@
     lines:
       - speed 38400
     parents: line console
-    provider: "{{ connection }}"
 
 - name: Enable console logging with level 3 (will pass)
   nxos_logging: *con3
@@ -98,7 +89,6 @@
       dest: logfile
       name: test
       dest_level: 1
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -120,7 +110,6 @@
   nxos_logging: &molog
     dest: module
     dest_level: 2
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -138,7 +127,6 @@
   nxos_logging: &mlog
     dest: monitor
     dest_level: 3
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -156,7 +144,6 @@
   nxos_logging: &mlog5
     dest: monitor
     dest_level: 5
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -174,7 +161,6 @@
   nxos_logging: &flog
     facility: daemon
     facility_level: 4
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -196,7 +182,6 @@
     facility_level: 1
     use_vrf: management
     state: present
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -238,7 +223,6 @@
       - { facility: daemon, facility_level: 4 }
       - { dest: server, remote_server: test-syslogserver.com, facility: auth, facility_level: 1, use_vrf: management }
       - { interface: mgmt0 }
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -274,7 +258,6 @@
     nxos_logging: &logm
       interface_message: add-interface-description
       state: present
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -291,7 +274,6 @@
     nxos_logging:
       interface_message: add-interface-description
       state: absent
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -304,7 +286,6 @@
     name: test
     dest_level: 1
     file_size: 16384
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -325,7 +306,6 @@
     name: test
     dest_level: 1
     file_size: 16384
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -453,7 +433,6 @@
 - name: Set up Logging Timestamp
   nxos_logging: &ltms
     timestamp: microseconds
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -478,7 +457,6 @@
   nxos_logging: &felue
     facility: ethpm
     facility_link_status: link-up-error
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -504,7 +482,6 @@
   nxos_logging: &felde
     facility: ethpm
     facility_link_status: link-down-error
-    provider: "{{ connection }}"
     state: present
   register: result
 
diff --git a/test/integration/targets/nxos_logging/tests/common/net_logging.yaml b/test/integration/targets/nxos_logging/tests/common/net_logging.yaml
index 01326ed66c..f19eb9e7d1 100644
--- a/test/integration/targets/nxos_logging/tests/common/net_logging.yaml
+++ b/test/integration/targets/nxos_logging/tests/common/net_logging.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos common/net_logging.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Add minimal testcase to check args are passed correctly to
 # implementation module and module run is successful.
@@ -10,7 +8,6 @@
   net_logging:
     dest: console
     dest_level: 0
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -18,7 +15,6 @@
   net_logging:
     dest: console
     dest_level: 0
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -31,7 +27,6 @@
   net_logging:
     dest: console
     dest_level: 0
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_logging/tests/common/purge.yaml b/test/integration/targets/nxos_logging/tests/common/purge.yaml
index 5c7d09df1f..61a99050ce 100644
--- a/test/integration/targets/nxos_logging/tests/common/purge.yaml
+++ b/test/integration/targets/nxos_logging/tests/common/purge.yaml
@@ -4,7 +4,6 @@
 - name: Purge logging configuration first
   nxos_logging:
     purge: true
-    provider: "{{ connection }}"
 
 - block:
 
@@ -12,7 +11,6 @@
       nxos_logging: &clog
         dest: console
         dest_level: 0
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -24,7 +22,6 @@
     - name: Set up Logging Timestamp
       nxos_logging: &ltms
         timestamp: microseconds
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -37,7 +34,6 @@
       nxos_logging: &mlog
         dest: monitor
         dest_level: 3
-        provider: "{{ connection }}"
       register: result
 
     - assert:
@@ -49,7 +45,6 @@
       nxos_logging: &flog
         facility: daemon
         facility_level: 4
-        provider: "{{ connection }}"
       register: result
 
     - assert:
@@ -60,7 +55,6 @@
     - name: Configure logging level virtual-service 7 using nxos_config
       nxos_config:
         lines: logging level virtual-service 7
-        provider: "{{ connection }}"
       register: result
 
     - assert:
@@ -70,7 +64,6 @@
     - name: Purge the outliers
       nxos_logging:
         purge: yes
-        provider: "{{ connection }}"
       register: result
 
     - assert:
@@ -82,7 +75,6 @@
       - name: Purge the outliers (idempotent)
         nxos_logging:
           purge: yes
-          provider: "{{ connection }}"
         register: result
 
       - assert:
@@ -97,7 +89,6 @@
           - { dest: monitor, dest_level: 3 }
           - { timestamp: microseconds }
           - { facility: daemon, facility_level: 4 }
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_ntp/tasks/nxapi.yaml b/test/integration/targets/nxos_ntp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_ntp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_ntp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_ntp/tests/common/sanity.yaml b/test/integration/targets/nxos_ntp/tests/common/sanity.yaml
index 4aad638441..54ee34411a 100644
--- a/test/integration/targets/nxos_ntp/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_ntp/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_ntp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Setup - Remove ntp if configured
   nxos_ntp: &remove
@@ -10,7 +8,6 @@
     prefer: disabled
     vrf_name: management
     source_addr: 192.0.2.5
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -23,7 +20,6 @@
       prefer: enabled
       vrf_name: management
       source_addr: 192.0.2.5
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -46,7 +42,6 @@
       prefer: enabled
       vrf_name: default
       source_addr: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -75,7 +70,6 @@
       source_int: Ethernet1/3
       peer: 1.2.3.4
       prefer: enabled
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -90,7 +84,6 @@
   - name: Remove source interface
     nxos_ntp: &config3
       source_int: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_ntp_auth/tasks/nxapi.yaml b/test/integration/targets/nxos_ntp_auth/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_ntp_auth/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_ntp_auth/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_ntp_auth/tests/common/sanity.yaml b/test/integration/targets/nxos_ntp_auth/tests/common/sanity.yaml
index 996058b050..e4db5e979b 100644
--- a/test/integration/targets/nxos_ntp_auth/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_ntp_auth/tests/common/sanity.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_ntp_auth sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Configure text ntp authentication
   nxos_ntp_auth: &setup
     key_id: 32
     md5string: hello
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -18,7 +15,6 @@
       key_id: 32
       md5string: hello
       authentication: off
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -31,7 +27,6 @@
       key_id: 32
       md5string: hello
       authentication: off
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -42,7 +37,6 @@
       key_id: 32
       md5string: hello
       auth_type: encrypt
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -59,7 +53,6 @@
   - name: Turn on authentication
     nxos_ntp_auth: &authon
       authentication: on
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -74,7 +67,6 @@
   - name: Turn off authentication
     nxos_ntp_auth: &authoff
       authentication: off
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -90,7 +82,6 @@
     nxos_ntp_auth: &tkey
       key_id: 32
       trusted_key: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -106,7 +97,6 @@
     nxos_ntp_auth: &rtkey
       key_id: 32
       trusted_key: false
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -124,7 +114,6 @@
       md5string: hello
       auth_type: encrypt
       authentication: on
-      provider: "{{ connection }}"
       state: absent
     register: result
 
diff --git a/test/integration/targets/nxos_ntp_options/tasks/nxapi.yaml b/test/integration/targets/nxos_ntp_options/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_ntp_options/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_ntp_options/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_ntp_options/tests/common/sanity.yaml b/test/integration/targets/nxos_ntp_options/tests/common/sanity.yaml
index 201efd3b5a..721765463c 100644
--- a/test/integration/targets/nxos_ntp_options/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_ntp_options/tests/common/sanity.yaml
@@ -1,11 +1,8 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_ntp_options sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Apply default ntp config" 
   nxos_ntp_options: &default
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -15,7 +12,6 @@
     nxos_ntp_options: &configure_master_default_stratum
       master: true
       logging: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -35,7 +31,6 @@
     nxos_ntp_options: &configure_master_non_default_stratum
       master: true
       stratum: 10
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -52,7 +47,6 @@
       master: true
       stratum: 10
       logging: false
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -68,7 +62,6 @@
     nxos_ntp_options: &configure_no_master
       master: false
       logging: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_nxapi/tests/cli/configure.yaml b/test/integration/targets/nxos_nxapi/tests/cli/configure.yaml
index 0f22ef6058..d5bac17d49 100644
--- a/test/integration/targets/nxos_nxapi/tests/cli/configure.yaml
+++ b/test/integration/targets/nxos_nxapi/tests/cli/configure.yaml
@@ -22,13 +22,13 @@
         - show nxapi | json
     register: result
 
-  - include: targets/nxos_nxapi/tasks/platform/n7k/assert_changes_https.yaml
+  - include: tasks/platform/n7k/assert_changes_https.yaml
     when: platform is match('N7K')
 
-  - include: targets/nxos_nxapi/tasks/platform/n5k/assert_changes_https.yaml
+  - include: tasks/platform/n5k/assert_changes_https.yaml
     when: platform is search('N5K|N6K')
 
-  - include: targets/nxos_nxapi/tasks/platform/default/assert_changes_https.yaml
+  - include: tasks/platform/default/assert_changes_https.yaml
     when: platform is not search('N35|N5K|N6K|N7K')
 
   - name: Configure NXAPI HTTPS again
@@ -53,13 +53,13 @@
         - show nxapi | json
     register: result
 
-  - include: targets/nxos_nxapi/tasks/platform/n7k/assert_changes_https_http.yaml
+  - include: tasks/platform/n7k/assert_changes_https_http.yaml
     when: platform is match('N7K')
 
-  - include: targets/nxos_nxapi/tasks/platform/n5k/assert_changes_https_http.yaml
+  - include: tasks/platform/n5k/assert_changes_https_http.yaml
     when: platform is match('N5K')
 
-  - include: targets/nxos_nxapi/tasks/platform/default/assert_changes_https_http.yaml
+  - include: tasks/platform/default/assert_changes_https_http.yaml
     when: platform is not search('N35|N5K|N6K|N7K')
 
   - name: Configure NXAPI HTTPS & HTTP again
@@ -83,13 +83,13 @@
         - show nxapi | json
     register: result
 
-  - include: targets/nxos_nxapi/tasks/platform/n7k/assert_changes_https_http_ports.yaml
+  - include: tasks/platform/n7k/assert_changes_https_http_ports.yaml
     when: platform is match('N7K')
 
-  - include: targets/nxos_nxapi/tasks/platform/n5k/assert_changes_https_http_ports.yaml
+  - include: tasks/platform/n5k/assert_changes_https_http_ports.yaml
     when: platform is match('N5K')
 
-  - include: targets/nxos_nxapi/tasks/platform/default/assert_changes_https_http_ports.yaml
+  - include: tasks/platform/default/assert_changes_https_http_ports.yaml
     when: platform is not search('N35|N5K|N6K|N7K')
 
   - name: Configure different NXAPI HTTPS & HTTP ports again
@@ -111,13 +111,13 @@
         - show nxapi | json
     register: result
 
-  - include: targets/nxos_nxapi/tasks/platform/n7k/assert_changes_http.yaml
+  - include: tasks/platform/n7k/assert_changes_http.yaml
     when: platform is match('N7K')
 
-  - include: targets/nxos_nxapi/tasks/platform/n5k/assert_changes_http.yaml
+  - include: tasks/platform/n5k/assert_changes_http.yaml
     when: platform is match('N5K')
 
-  - include: targets/nxos_nxapi/tasks/platform/default/assert_changes_http.yaml
+  - include: tasks/platform/default/assert_changes_http.yaml
     when: platform is not search('N35|N5K|N6K|N7K')
 
   - name: Configure NXAPI HTTP again
diff --git a/test/integration/targets/nxos_ospf/tasks/nxapi.yaml b/test/integration/targets/nxos_ospf/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_ospf/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_ospf/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_ospf/tests/common/sanity.yaml b/test/integration/targets/nxos_ospf/tests/common/sanity.yaml
index 8ce20925ce..c6bcdfbc60 100644
--- a/test/integration/targets/nxos_ospf/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_ospf/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_ospf sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Enable feature OSPF"
   nxos_feature:
     feature: ospf
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -14,7 +11,6 @@
   - name: Configure ospf
     nxos_ospf: &config
       ospf: 1
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -34,7 +30,6 @@
   - name: "Disable feature OSPF"
     nxos_feature:
       feature: ospf
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
@@ -42,7 +37,6 @@
   - name: Unconfigure ospf
     nxos_ospf: &unconfig
       ospf: 1
-      provider: "{{ connection }}"
       state: absent
     register: result
 
diff --git a/test/integration/targets/nxos_ospf_vrf/tasks/nxapi.yaml b/test/integration/targets/nxos_ospf_vrf/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_ospf_vrf/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_ospf_vrf/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_ospf_vrf/tests/common/sanity.yaml b/test/integration/targets/nxos_ospf_vrf/tests/common/sanity.yaml
index 5cf9ca6d56..00f8b7a02a 100644
--- a/test/integration/targets/nxos_ospf_vrf/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_ospf_vrf/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_ospf_vrf sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: def_met_default="default"
   # CSCvi74876 Cannot remove default-metric
@@ -10,7 +8,6 @@
 - name: "Setup: disable features for initial cleanup"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: disabled
   loop: ['ospf', 'bfd']
   ignore_errors: yes
@@ -18,7 +15,6 @@
 - name: "Enable features"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: enabled
   loop: ['ospf', 'bfd']
 
@@ -36,7 +32,6 @@
       vrf: test
       bfd: enable
       passive_interface: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -64,7 +59,6 @@
       vrf: default
       bfd: disable
       passive_interface: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -85,7 +79,6 @@
       timer_throttle_spf_hold: default
       passive_interface: false
       vrf: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -101,7 +94,6 @@
     nxos_ospf_vrf: &unconfig1
       ospf: 2
       vrf: default
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -118,7 +110,6 @@
     nxos_ospf_vrf: &unconfig
       ospf: 1
       vrf: test
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -135,7 +126,6 @@
   - name: "Disable features"
     nxos_feature:
       feature: "{{ item }}"
-      provider: "{{ connection }}"
       state: disabled
     loop: ['ospf', 'bfd']
     ignore_errors: yes
diff --git a/test/integration/targets/nxos_overlay_global/tasks/nxapi.yaml b/test/integration/targets/nxos_overlay_global/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_overlay_global/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_overlay_global/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_overlay_global/tests/common/sanity.yaml b/test/integration/targets/nxos_overlay_global/tests/common/sanity.yaml
index 7231c8b87d..fe41bde90e 100644
--- a/test/integration/targets/nxos_overlay_global/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_overlay_global/tests/common/sanity.yaml
@@ -1,6 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_overlay_global sanity test"
-  when: ansible_connection == "local"
 
 - set_fact: overlay_global_supported="false"
 - set_fact: overlay_global_supported="true"
diff --git a/test/integration/targets/nxos_pim/tasks/nxapi.yaml b/test/integration/targets/nxos_pim/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_pim/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_pim/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_pim/tests/common/sanity.yaml b/test/integration/targets/nxos_pim/tests/common/sanity.yaml
index be374ec550..7cf12b5eca 100644
--- a/test/integration/targets/nxos_pim/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_pim/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_pim sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup: Disable features"
   nxos_feature: &disable_feature
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: disabled
   ignore_errors: yes
   loop:
@@ -16,7 +13,6 @@
 - name: "Setup: Enable features"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: enabled
   loop:
     - pim
@@ -25,7 +21,6 @@
 - name: "Setup: Configure ssm_range none"
   nxos_pim: &none
     ssm_range: "none"
-    provider: "{{ connection }}"
 
 - block:
   - name: Initial config from none
@@ -34,7 +29,6 @@
       ssm_range:
         - "239.128.1.0/24"
         - "224.0.0.0/8"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -53,7 +47,6 @@
     nxos_pim: &conf_default
       bfd: disable
       ssm_range: "default"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -81,7 +74,6 @@
   - name: "Teardown: Disable features"
     nxos_feature:
       feature: "{{ item }}"
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
     loop:
diff --git a/test/integration/targets/nxos_pim_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_pim_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_pim_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_pim_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_pim_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_pim_interface/tests/common/sanity.yaml
index 26d0656554..90d8a6d2fb 100644
--- a/test/integration/targets/nxos_pim_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_pim_interface/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_pim_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: "Setup: Disable features"
   nxos_feature: &disable_feature
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: disabled
   loop: ['pim', 'bfd']
   ignore_errors: yes
@@ -14,7 +11,6 @@
 - name: "Setup: Enable features"
   nxos_feature:
     feature: "{{ item }}"
-    provider: "{{ connection }}"
     state: enabled
   loop: ['pim', 'bfd']
 
@@ -24,7 +20,6 @@
   nxos_config:
     lines:
       - "default interface {{ testint }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: "Ensure {{testint}} is layer3"
@@ -33,14 +28,12 @@
     mode: layer3
     description: 'Configured by Ansible - Layer3'
     admin_state: 'up'
-    provider: "{{ connection }}"
     state: present
 
 - block:
   - name: Configure nxos_pim_interface state absent
     nxos_pim_interface: &pimabsent
       interface: "{{ testint }}"
-      provider: "{{ connection }}"
       state: absent
 
   - name: configure jp policy and type
@@ -52,7 +45,6 @@
       jp_type_out: routemap
       sparse: True
       border: True
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -72,7 +64,6 @@
       interface: "{{ testint }}"
       neighbor_policy: NPR
       neighbor_type: routemap
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -91,7 +82,6 @@
       interface: "{{ testint }}"
       neighbor_policy: NPPF
       neighbor_type: prefix
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -106,7 +96,6 @@
     nxos_pim_interface: &confighak1
       interface: "{{ testint }}"
       hello_auth_key: password1
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -119,7 +108,6 @@
       sparse: True
       border: True
       bfd: enable
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -137,7 +125,6 @@
       sparse: False
       border: False
       bfd: disable
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -155,7 +142,6 @@
   - name: configure state default
     nxos_pim_interface: &configdefault
       interface: "{{ testint }}"
-      provider: "{{ connection }}"
       state: default
     register: result
 
@@ -171,7 +157,6 @@
     nxos_pim_interface: &configb
       interface: "{{ testint }}"
       border: True
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_pim_rp_address/tasks/nxapi.yaml b/test/integration/targets/nxos_pim_rp_address/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_pim_rp_address/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_pim_rp_address/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_pim_rp_address/tests/common/configure.yaml b/test/integration/targets/nxos_pim_rp_address/tests/common/configure.yaml
index fb1fd00ca4..d5f5898dc6 100644
--- a/test/integration/targets/nxos_pim_rp_address/tests/common/configure.yaml
+++ b/test/integration/targets/nxos_pim_rp_address/tests/common/configure.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_pim_rp_address sanity"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   # platforms do not support bidir
@@ -19,13 +17,11 @@
   - name: "Disable feature PIM"
     nxos_feature: &disable_feature
       feature: pim
-      provider: "{{ connection }}"
       state: disabled
 
   - name: "Enable feature PIM"
     nxos_feature: &enable_feature
       feature: pim
-      provider: "{{ connection }}"
       state: enabled
 
   - name: 1.0 Configure rp_address + group_list
@@ -34,7 +30,6 @@
       rp_address: "10.1.1.1"
       group_list: "224.0.0.0/8"
       bidir: "{{ bidir_true|default(omit) }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -56,7 +51,6 @@
         rp_address: "10.1.1.1"
         group_list: "224.0.0.0/8"
         bidir: false
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -72,7 +66,6 @@
       nxos_pim_rp_address: &config12
         rp_address: "10.1.1.1"
         bidir: true
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -88,7 +81,6 @@
       nxos_pim_rp_address: &config13
         rp_address: "10.1.1.1"
         bidir: false
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -105,7 +97,6 @@
     nxos_pim_rp_address: &config14
       rp_address: "10.1.1.1"
       group_list: "224.0.0.0/8"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -122,7 +113,6 @@
       rp_address: "10.1.1.2"
       prefix_list: "{{ pim_prefix_list|default(omit) }}"
       bidir: "{{ bidir_true|default(omit) }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -140,7 +130,6 @@
         rp_address: "10.1.1.2"
         prefix_list: "{{ pim_prefix_list|default(omit) }}"
         bidir: "{{ bidir_false|default(omit) }}"
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -158,7 +147,6 @@
       rp_address: "10.1.1.2"
       prefix_list: "{{ pim_prefix_list|default(omit)}}"
       bidir: "{{ bidir_false|default(omit)}}"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -175,7 +163,6 @@
       rp_address: "10.1.1.3"
       route_map: "{{ pim_route_map|default(omit)}}"
       bidir: "{{ bidir_true|default(omit) }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -193,7 +180,6 @@
         rp_address: "10.1.1.3"
         route_map: "{{ pim_route_map|default(omit)}}"
         bidir: "{{ bidir_false|default(omit)}}"
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -211,7 +197,6 @@
       rp_address: "10.1.1.3"
       route_map: "{{ pim_route_map|default(omit)}}"
       bidir: "{{ bidir_false|default(omit)}}"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
diff --git a/test/integration/targets/nxos_reboot/tasks/nxapi.yaml b/test/integration/targets/nxos_reboot/tasks/nxapi.yaml
index 7401584edf..0014c8a485 100644
--- a/test/integration/targets/nxos_reboot/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_reboot/tasks/nxapi.yaml
@@ -26,10 +26,3 @@
   loop_control:
     loop_var: test_case_to_run
   tags: nxapi_httpapi
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
-  tags: nxapi_local
diff --git a/test/integration/targets/nxos_reboot/tests/common/sanity.yaml b/test/integration/targets/nxos_reboot/tests/common/sanity.yaml
index f7c73b28bf..839026d534 100644
--- a/test/integration/targets/nxos_reboot/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_reboot/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_reboot sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - debug: msg="***WARNING*** Remove meta end_play to verify this module ***WARNING***"
 
@@ -11,7 +9,6 @@
   - name: Reboot Switch
     nxos_reboot:
       confirm: True
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   always:
diff --git a/test/integration/targets/nxos_rollback/tasks/nxapi.yaml b/test/integration/targets/nxos_rollback/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_rollback/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_rollback/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_rollback/tests/common/sanity.yaml b/test/integration/targets/nxos_rollback/tests/common/sanity.yaml
index c60bda02c9..fab64b5daf 100644
--- a/test/integration/targets/nxos_rollback/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_rollback/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_rollback sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: delete existing checkpoint file
   nxos_config: &delete
@@ -9,18 +7,15 @@
       - terminal dont-ask
       - delete backup.cfg
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: Create checkpoint file
   nxos_rollback:
     checkpoint_file: backup.cfg
-    provider: "{{ connection }}"
 
 - name: rollback to the previously created checkpoint file
   nxos_rollback:
     rollback_to: backup.cfg
-    provider: "{{ connection }}"
 
 - name: cleanup checkpoint file
   nxos_config: *delete
diff --git a/test/integration/targets/nxos_rpm/tasks/nxapi.yaml b/test/integration/targets/nxos_rpm/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_rpm/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_rpm/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_rpm/tests/common/sanity.yaml b/test/integration/targets/nxos_rpm/tests/common/sanity.yaml
index 2a89a911fe..971757452b 100644
--- a/test/integration/targets/nxos_rpm/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_rpm/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_rpm sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: smu_run="false"
 - set_fact: smu_run="true"
@@ -40,7 +38,6 @@
   - name: Remove smu RPM
     nxos_rpm: &rsmurpm
       pkg: "nxos.sample-n9k_ALL-1.0.0-7.0.3.I6.1.lib32_n9000.rpm"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -80,7 +77,6 @@
       aggregate:
           - { pkg: "healthMonitor-1.0-1.5.0.x86_64.rpm" }
           - { pkg: "customCliApp-1.0-1.0.0.x86_64.rpm" }
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -105,7 +101,6 @@
   - name: Wait for device to come back up
     wait_for:
       port: 22
-      provider: "{{ connection }}"
       state: started
       timeout: 600
       delay: 60
@@ -126,7 +121,6 @@
   - name: Remove reload smu RPM
     nxos_rpm: &rrsmurpm
       pkg: "nxos.CSCve91311-n9k_ALL-1.0.0-7.0.3.I6.1.lib32_n9000.rpm"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -135,7 +129,6 @@
   - name: Wait for device to come back up
     wait_for:
       port: 22
-      provider: "{{ connection }}"
       state: started
       timeout: 600
       delay: 60
diff --git a/test/integration/targets/nxos_snapshot/tasks/nxapi.yaml b/test/integration/targets/nxos_snapshot/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snapshot/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snapshot/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snapshot/tests/common/sanity.yaml b/test/integration/targets/nxos_snapshot/tests/common/sanity.yaml
index e308837452..025039dc55 100644
--- a/test/integration/targets/nxos_snapshot/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snapshot/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snapshot sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: snapshot_run="true"
 
@@ -22,7 +20,6 @@
       snapshot_name: test_snapshot1
       description: Ansible
       save_snapshot_locally: True
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -46,7 +43,6 @@
         row_id: ROW_intf
         element_key1: intf-name
         element_key2: intf-name
-        provider: "{{ connection }}"
       register: result
 
     - assert: *true
@@ -68,7 +64,6 @@
       show_command: show ip interface brief
       row_id: ROW_intf
       element_key1: intf-name
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -87,13 +82,11 @@
       comparison_results_file: compare_snapshots.txt
       compare_option: summary
       path: '.'
-      provider: "{{ connection }}"
 
   - name: delete snapshot
     nxos_snapshot: &del
       snapshot_name: test_snapshot2
       action: delete
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -107,7 +100,6 @@
   - name: delete all snapshots
     nxos_snapshot: &delall
       action: delete_all
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -126,13 +118,11 @@
       commands:
         - snapshot section delete myshow
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: delete all snapshots
     nxos_snapshot:
       action: delete_all
-      provider: "{{ connection }}"
     ignore_errors: yes
 
 - debug: msg="END connection={{ ansible_connection }} nxos_snapshot sanity test"
diff --git a/test/integration/targets/nxos_snmp_community/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_community/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_community/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_community/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_community/tests/common/sanity.yaml b/test/integration/targets/nxos_snmp_community/tests/common/sanity.yaml
index 170b78202f..468fd40809 100644
--- a/test/integration/targets/nxos_snmp_community/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snmp_community/tests/common/sanity.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_community sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Setup - Remove snmp_community if configured
   nxos_snmp_community: &remove
     community: TESTING7
     group: network-operator
-    provider: "{{ connection }}"
     state: absent 
   ignore_errors: yes
 
@@ -17,7 +14,6 @@
     nxos_snmp_community: &config
       community: TESTING7
       group: network-operator
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -37,7 +33,6 @@
     nxos_snmp_community: &chg
       community: TESTING7
       group: network-admin
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -65,7 +60,6 @@
     nxos_snmp_community: &configaccess
       community: TESTING7
       access: ro
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -94,7 +88,6 @@
       community: TESTING7
       access: rw
       acl: ansible_acl
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -111,7 +104,6 @@
       community: TESTING7
       access: rw
       acl: new_acl
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -128,7 +120,6 @@
       community: TESTING7
       access: rw
       acl: default
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_snmp_contact/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_contact/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_contact/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_contact/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_contact/tests/common/sanity.yaml b/test/integration/targets/nxos_snmp_contact/tests/common/sanity.yaml
index e5ce4e79d4..d43e60c2a4 100644
--- a/test/integration/targets/nxos_snmp_contact/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snmp_contact/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_community sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Setup - Remove snmp_contact if configured
   nxos_snmp_contact: &remove
     contact: Test
-    provider: "{{ connection }}"
     state: absent 
 
 - block:
@@ -14,7 +11,6 @@
   - name: Configure snmp contact
     nxos_snmp_contact: &config
       contact: Testing
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -33,7 +29,6 @@
   - name: Change snmp contact
     nxos_snmp_contact: &config1
       contact: Test
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_snmp_host/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_host/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_host/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_host/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v1_trap.yaml b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v1_trap.yaml
index db1952fc22..dd50e0719d 100644
--- a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v1_trap.yaml
+++ b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v1_trap.yaml
@@ -3,8 +3,6 @@
 - set_fact: snmp_version="v1"
 
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_host {{ snmp_type }} {{ snmp_version }} sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -21,7 +19,6 @@
     vrf_filter: management
     src_intf: "{{ intname|default(omit) }}"
     udp: 222
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -37,7 +34,6 @@
       vrf_filter: management
       src_intf: "{{ intname|default(omit) }}"
       udp: 222
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -59,7 +55,6 @@
         snmp_host: 192.0.2.3
         vrf_filter: default
         udp: 222
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -79,7 +74,6 @@
       src_intf: "{{ intname|default(omit) }}"
       vrf: management
       vrf_filter: management
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -97,7 +91,6 @@
         snmp_host: 192.0.2.3
         udp: 222
         vrf_filter: default
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v2_inform.yaml b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v2_inform.yaml
index bf8b64e090..e3b9fa7faf 100644
--- a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v2_inform.yaml
+++ b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v2_inform.yaml
@@ -3,8 +3,6 @@
 - set_fact: snmp_version="v2c"
 
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_host {{ snmp_type }} {{ snmp_version }} sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -20,7 +18,6 @@
     vrf_filter: management
     src_intf: "{{ intname|default(omit) }}"
     udp: 222
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -36,7 +33,6 @@
       vrf_filter: management
       src_intf: "{{ intname|default(omit) }}"
       udp: 222
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -58,7 +54,6 @@
         snmp_host: 192.0.2.3
         vrf_filter: default
         udp: 222
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -78,7 +73,6 @@
       src_intf: "{{ intname|default(omit) }}"
       vrf: management
       vrf_filter: management
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -96,7 +90,6 @@
         snmp_host: 192.0.2.3
         udp: 222
         vrf_filter: default
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_inform.yaml b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_inform.yaml
index a6b6402e8a..f41b0176a6 100644
--- a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_inform.yaml
+++ b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_inform.yaml
@@ -4,8 +4,6 @@
 - set_fact: snmp_auth="priv"
 
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_host {{ snmp_type }} {{ snmp_version }} sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -26,7 +24,6 @@
     vrf: management
     vrf_filter: management
     src_intf: "{{ intname|default(omit) }}"
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -42,7 +39,6 @@
       vrf: management
       vrf_filter: management
       src_intf: "{{ intname|default(omit) }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -63,7 +59,6 @@
       nxos_snmp_host: &config1
         snmp_host: 192.0.2.3
         vrf_filter: default
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -82,7 +77,6 @@
       src_intf: "{{ intname|default(omit) }}"
       vrf: management
       vrf_filter: management
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -99,7 +93,6 @@
       nxos_snmp_host: &rem2
         snmp_host: 192.0.2.3
         vrf_filter: default
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_trap.yaml b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_trap.yaml
index 2bb2d1466e..86895ff2ea 100644
--- a/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_trap.yaml
+++ b/test/integration/targets/nxos_snmp_host/tests/common/sanity_snmp_v3_trap.yaml
@@ -4,8 +4,6 @@
 - set_fact: snmp_auth="priv"
 
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_host {{ snmp_type }} {{ snmp_version }} sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -22,7 +20,6 @@
     vrf: management
     vrf_filter: management
     src_intf: "{{ intname|default(omit) }}"
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
 
@@ -39,7 +36,6 @@
       vrf: management
       vrf_filter: management
       src_intf: "{{ intname|default(omit) }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -61,7 +57,6 @@
         snmp_host: 192.0.2.3
         udp: 222
         vrf_filter: default
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -81,7 +76,6 @@
       src_intf: "{{ intname|default(omit) }}"
       vrf: management
       vrf_filter: management
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -99,7 +93,6 @@
         snmp_host: 192.0.2.3
         udp: 222
         vrf_filter: default
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_snmp_location/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_location/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_location/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_location/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_location/tests/common/sanity.yaml b/test/integration/targets/nxos_snmp_location/tests/common/sanity.yaml
index e30d86cfff..e1be07aebf 100644
--- a/test/integration/targets/nxos_snmp_location/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snmp_location/tests/common/sanity.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_location sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Setup - Remove snmp_location if configured
   nxos_snmp_location: &remove
     location: Test 
-    provider: "{{ connection }}"
     state: absent
 
 - block:
   - name: Configure snmp location 
     nxos_snmp_location: &config
       location: Testing
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -32,7 +28,6 @@
   - name: Change snmp location 
     nxos_snmp_location: &config1
       location: Test
-      provider: "{{ connection }}"
       state: present
     register: result
 
diff --git a/test/integration/targets/nxos_snmp_traps/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_traps/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_traps/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_traps/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_traps/tests/common/sanity.yaml b/test/integration/targets/nxos_snmp_traps/tests/common/sanity.yaml
index cc07f42423..c035e2992c 100644
--- a/test/integration/targets/nxos_snmp_traps/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snmp_traps/tests/common/sanity.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_traps sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Setup - Remove snmp_traps if configured
   nxos_snmp_traps: &remove
     group: all
-    provider: "{{ connection }}"
     state: disabled
 
 - block:
   - name: Configure one snmp trap group
     nxos_snmp_traps: &config
       group: bridge
-      provider: "{{ connection }}"
       state: enabled
     register: result
 
@@ -32,7 +28,6 @@
   - name: Remove snmp trap group
     nxos_snmp_traps: &rem1
       group: bridge
-      provider: "{{ connection }}"
       state: disabled
     register: result
 
@@ -47,7 +42,6 @@
   - name: Configure all snmp trap groups
     nxos_snmp_traps: &config1
       group: all
-      provider: "{{ connection }}"
       state: enabled
     register: result
 
diff --git a/test/integration/targets/nxos_snmp_user/tasks/nxapi.yaml b/test/integration/targets/nxos_snmp_user/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_snmp_user/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_snmp_user/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_snmp_user/tests/common/sanity.yaml b/test/integration/targets/nxos_snmp_user/tests/common/sanity.yaml
index e1d8212552..ae09a4d071 100644
--- a/test/integration/targets/nxos_snmp_user/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_snmp_user/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_snmp_user sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: delete_last_user_allowed='true'
 - set_fact: delete_last_user_allowed='false'
@@ -12,7 +10,6 @@
 - name: Remove snmp user
   nxos_snmp_user: &remove_snmp_user
     user: ntc
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
   when: platform is not search('N5K|N6K|N9K-F')
@@ -21,7 +18,6 @@
   # Some platforms will not allow snmp_user to remove the last role
   nxos_user: &workaround_remove_user
     name: ntc
-    provider: "{{ connection }}"
     state: absent
   ignore_errors: yes
   when: platform is search('N5K|N6K|N9K-F')
@@ -38,7 +34,6 @@
       pwd: N$tOpe%1
       privacy: HelloU$er1
       encrypt: true
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -49,7 +44,6 @@
     nxos_snmp_user: &chg
       user: ntc
       group: network-admin
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -66,7 +60,6 @@
     nxos_snmp_user: &remg
       user: ntc
       group: network-admin
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -87,7 +80,6 @@
       nxos_snmp_user: &remove1
         user: ntc
         group: network-operator
-        provider: "{{ connection }}"
         state: absent
       register: result
 
diff --git a/test/integration/targets/nxos_static_route/tasks/nxapi.yaml b/test/integration/targets/nxos_static_route/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_static_route/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_static_route/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_static_route/tests/common/sanity.yaml b/test/integration/targets/nxos_static_route/tests/common/sanity.yaml
index 10d3c7cb37..f07fefb40a 100644
--- a/test/integration/targets/nxos_static_route/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_static_route/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_static_route sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Flag used to test the track feature.  Some platforms
 # don't support it so this flag will be toggled accordingly.
@@ -11,7 +9,6 @@
   nxos_config:
     lines:
       - track 1 ip sla 1
-    provider: "{{ connection }}"
   register: cmd_result
   ignore_errors: yes
 
@@ -30,7 +27,6 @@
       - { prefix: "192.168.22.64/24", next_hop: "192.0.2.3" }
       - { prefix: "192.168.24.64/24", next_hop: "192.0.2.3" }
     vrf: "{{ item }}"
-    provider: "{{ connection }}"
     state: absent
   with_items: "{{ vrfs }}"
   ignore_errors: yes
@@ -40,7 +36,6 @@
     prefix: "192.168.1.164/32"
     next_hop: "192.0.2.3"
     vrf: "{{ item }}"
-    provider: "{{ connection }}"
     state: present
   with_items: "{{ vrfs }}"
 
@@ -53,7 +48,6 @@
       pref: 100
       tag: 5500
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -78,7 +72,6 @@
       pref: 10
       tag: default
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
 
@@ -100,7 +93,6 @@
       tag: default
       track: 1
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
     when: test_track_feature
@@ -126,7 +118,6 @@
       tag: default
       track: 2
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
     with_items: "{{ vrfs }}"
     register: result
     ignore_errors: yes
@@ -144,7 +135,6 @@
       route_name: testing
       pref: 100
       vrf: "{{ item }}"
-      provider: "{{ connection }}"
       state: absent
     with_items: "{{ vrfs }}"
     register: result
@@ -163,7 +153,6 @@
       aggregate:
         - { prefix: "192.168.22.64/24", next_hop: "192.0.2.3" }
         - { prefix: "192.168.24.64/24", next_hop: "192.0.2.3" }
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -179,7 +168,6 @@
       aggregate:
         - { prefix: "192.168.22.64/24", next_hop: "192.0.2.3" }
         - { prefix: "192.168.24.64/24", next_hop: "192.0.2.3" }
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -196,7 +184,6 @@
     nxos_config:
       lines:
         - no track 1
-      provider: "{{ connection }}"
     ignore_errors: yes
     when: test_track_feature
 
diff --git a/test/integration/targets/nxos_system/tasks/nxapi.yaml b/test/integration/targets/nxos_system/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_system/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_system/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_system/tests/common/sanity.yaml b/test/integration/targets/nxos_system/tests/common/sanity.yaml
index fa70625cfd..74d8843226 100644
--- a/test/integration/targets/nxos_system/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_system/tests/common/sanity.yaml
@@ -1,12 +1,9 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/sanity.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - name: remove configuration
     nxos_system: &remove
-      provider: "{{ connection }}"
       state: absent
     register: result
     ignore_errors: yes
@@ -14,7 +11,6 @@
   - name: configure domain lookup
     nxos_system: &dlo
       domain_lookup: true
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -22,7 +18,6 @@
     nxos_system: &hostname
       hostname: switch
       domain_name: test.example.com
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -42,7 +37,6 @@
       name_servers:
         - 8.8.8.8
         - 8.8.4.4
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -58,7 +52,6 @@
       name_servers:
         - { server: 8.8.8.8, vrf: management }
         - { server: 8.8.4.4, vrf: management }
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -72,7 +65,6 @@
   - name: configure domain lookup1
     nxos_system: &ndlo
       domain_lookup: false
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -98,7 +90,6 @@
   - name: configure system mtu
     nxos_system: &sysmtu
       system_mtu: 3000
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -115,7 +106,6 @@
       domain_name: default
       name_servers: default
       system_mtu: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
diff --git a/test/integration/targets/nxos_system/tests/common/set_hostname.yaml b/test/integration/targets/nxos_system/tests/common/set_hostname.yaml
index 29a6fbd5c9..da9090a7a8 100644
--- a/test/integration/targets/nxos_system/tests/common/set_hostname.yaml
+++ b/test/integration/targets/nxos_system/tests/common/set_hostname.yaml
@@ -1,19 +1,15 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/set_hostname.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - name: setup
     nxos_config:
       lines: "hostname switch"
       match: none
-      provider: "{{ connection }}"
 
   - name: configure hostname
     nxos_system:
       hostname: foo
-      provider: "{{ connection }}"
     register: result
 
   - assert:
@@ -23,7 +19,6 @@
   - name: verify hostname
     nxos_system:
       hostname: foo
-      provider: "{{ connection }}"
     register: result
 
   - assert:
@@ -35,7 +30,6 @@
     nxos_config:
       lines: "hostname switch"
       match: none
-      provider: "{{ connection }}"
 
 
   - debug: msg="END connection={{ ansible_connection }}/set_hostname.yaml"
diff --git a/test/integration/targets/nxos_system/tests/nxapi/net_system.yaml b/test/integration/targets/nxos_system/tests/nxapi/net_system.yaml
index d64f97ff04..e7810f7fc5 100644
--- a/test/integration/targets/nxos_system/tests/nxapi/net_system.yaml
+++ b/test/integration/targets/nxos_system/tests/nxapi/net_system.yaml
@@ -10,7 +10,6 @@
       - no ip domain-list ansible.com
       - no ip domain-list redhat.com
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: configure domain_list using platform agnostic module
@@ -18,7 +17,6 @@
     domain_search:
       - ansible.com
       - redhat.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -33,6 +31,5 @@
       - no ip domain-list ansible.com
       - no ip domain-list redhat.com
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxos nxapi/net_system.yaml on connection={{ ansible_connection }}"
diff --git a/test/integration/targets/nxos_system/tests/nxapi/set_domain_list.yaml b/test/integration/targets/nxos_system/tests/nxapi/set_domain_list.yaml
index 0037195bc2..d22736c2e6 100644
--- a/test/integration/targets/nxos_system/tests/nxapi/set_domain_list.yaml
+++ b/test/integration/targets/nxos_system/tests/nxapi/set_domain_list.yaml
@@ -9,7 +9,6 @@
     lines:
       - no ip domain-list {{ item }}
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
   with_items:
       - ansible.com
@@ -20,7 +19,6 @@
     domain_search:
       - ansible.com
       - redhat.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -34,7 +32,6 @@
     domain_search:
       - ansible.com
       - redhat.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -45,7 +42,6 @@
   nxos_system:
     domain_search:
       - ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -57,7 +53,6 @@
   nxos_system:
     domain_search:
       - ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -69,7 +64,6 @@
     domain_search:
       - ansible.com
       - redhat.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -82,7 +76,6 @@
     domain_search:
       - ansible.com
       - redhat.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -94,7 +87,6 @@
     domain_search:
       - ansible.com
       - eng.ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -109,7 +101,6 @@
     domain_search:
       - ansible.com
       - eng.ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -121,7 +112,6 @@
     lines:
       - no ip domain-list {{ item }}
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
   with_items:
       - ansible.com
diff --git a/test/integration/targets/nxos_system/tests/nxapi/set_domain_name.yaml b/test/integration/targets/nxos_system/tests/nxapi/set_domain_name.yaml
index 8b25d46e74..13adfcbf4b 100644
--- a/test/integration/targets/nxos_system/tests/nxapi/set_domain_name.yaml
+++ b/test/integration/targets/nxos_system/tests/nxapi/set_domain_name.yaml
@@ -5,14 +5,12 @@
   nxos_config:
     lines: no ip domain-name eng.ansible.com
     match: none
-    provider: "{{ connection }}"
 # NXAPI errors if you try to remove something that doesn't exist
   ignore_errors: yes
 
 - name: configure domain_name
   nxos_system:
     domain_name: eng.ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -22,7 +20,6 @@
 - name: verify domain_name
   nxos_system:
     domain_name: eng.ansible.com
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -33,6 +30,5 @@
   nxos_config:
     lines: no ip domain-name eng.ansible.com
     match: none
-    provider: "{{ connection }}"
 
 - debug: msg="END nxapi/set_domain_name.yaml"
diff --git a/test/integration/targets/nxos_system/tests/nxapi/set_name_servers.yaml b/test/integration/targets/nxos_system/tests/nxapi/set_name_servers.yaml
index e3130df36f..7baaa7e9f5 100644
--- a/test/integration/targets/nxos_system/tests/nxapi/set_name_servers.yaml
+++ b/test/integration/targets/nxos_system/tests/nxapi/set_name_servers.yaml
@@ -9,7 +9,6 @@
     lines:
       - no ip name-server {{ item }}
     match: none
-    provider: "{{ connection }}"
   ignore_errors: yes
   with_items:
       - 192.0.2.1
@@ -22,7 +21,6 @@
       - 192.0.2.1
       - 192.0.2.2
       - 192.0.2.3
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -38,7 +36,6 @@
       - 192.0.2.1
       - 192.0.2.2
       - 192.0.2.3
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -77,7 +74,6 @@
     name_servers:
       - 192.0.2.1
       - 192.0.2.2
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -89,7 +85,6 @@
 - name: default name server
   nxos_system: &defns
     name_servers: default
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_udld/tasks/nxapi.yaml b/test/integration/targets/nxos_udld/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_udld/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_udld/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_udld/tests/common/sanity.yaml b/test/integration/targets/nxos_udld/tests/common/sanity.yaml
index d61a26819c..7430381137 100644
--- a/test/integration/targets/nxos_udld/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_udld/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_udld sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: udld_run="true"
 - set_fact: udld_run="false"
@@ -13,14 +11,12 @@
   - name: "Enable feature udld"
     nxos_feature: 
       feature: udld
-      provider: "{{ connection }}"
       state: enabled
 
   - name: Configure udld
     nxos_udld: &conf1
       aggressive: enabled
       msg_time: 20
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -38,12 +34,10 @@
   - name: Reset udld
     nxos_udld:
       reset: True
-      provider: "{{ connection }}"
 
   - name: Configure udld2
     nxos_udld: &conf2
       aggressive: disabled
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -57,7 +51,6 @@
   - name: Configure udld3
     nxos_udld: &conf3
       msg_time: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -76,7 +69,6 @@
 
   - name: Remove udld config
     nxos_udld: &conf4
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -94,7 +86,6 @@
   - name: "Disable udld"
     nxos_feature: 
       feature: udld
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_udld_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_udld_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_udld_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_udld_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_udld_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_udld_interface/tests/common/sanity.yaml
index d1a074bd6f..18893cba8a 100644
--- a/test/integration/targets/nxos_udld_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_udld_interface/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_udld_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: udld_run="true"
 - set_fact: udld_enable="true"
@@ -19,7 +17,6 @@
   - name: "Enable feature udld"
     nxos_feature: 
       feature: udld
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "put the interface into default state"
@@ -27,13 +24,11 @@
       commands:
         - "default interface {{intname}}"
       match: none
-      provider: "{{ connection }}"
 
   - name: ensure interface is configured to be in aggressive mode
     nxos_udld_interface: &conf1
       interface: "{{ intname }}"
       mode: aggressive
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -55,7 +50,6 @@
       nxos_udld_interface: &conf2
         interface: "{{ intname }}"
         mode: enabled
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -83,7 +77,6 @@
       nxos_udld_interface: &conf3
         interface: "{{ intname }}"
         mode: disabled
-        provider: "{{ connection }}"
         state: present
       register: result
 
@@ -101,7 +94,6 @@
     nxos_udld_interface: &remove
       interface: "{{ intname }}"
       mode: enabled
-      provider: "{{ connection }}"
       state: absent
 
   when: udld_run
@@ -110,7 +102,6 @@
   - name: "Disable udld"
     nxos_feature: 
       feature: udld
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_user/tasks/nxapi.yaml b/test/integration/targets/nxos_user/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_user/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_user/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_user/tests/common/auth.yaml b/test/integration/targets/nxos_user/tests/common/auth.yaml
index 6fb9ec5f35..a05b1aa5ff 100644
--- a/test/integration/targets/nxos_user/tests/common/auth.yaml
+++ b/test/integration/targets/nxos_user/tests/common/auth.yaml
@@ -4,7 +4,6 @@
     nxos_user:
       name: auth_user
       role: network-operator
-      provider: "{{ connection }}"
       state: present
       configured_password: pasS!123
 
@@ -31,6 +30,5 @@
   - name: delete user
     nxos_user:
       name: auth_user
-      provider: "{{ connection }}"
       state: absent
     register: result
diff --git a/test/integration/targets/nxos_user/tests/common/basic.yaml b/test/integration/targets/nxos_user/tests/common/basic.yaml
index 50d1d2986b..cf77ed3870 100644
--- a/test/integration/targets/nxos_user/tests/common/basic.yaml
+++ b/test/integration/targets/nxos_user/tests/common/basic.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_user basic test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Remove old entries of user
   nxos_user:
@@ -9,7 +7,6 @@
       - { name: ansibletest1 }
       - { name: ansibletest2 }
       - { name: ansibletest3 }
-    provider: "{{ connection }}"
     state: absent
 
 # Start tests
@@ -17,7 +14,6 @@
   nxos_user:
     name: ansibletest1
     roles: network-operator
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -34,7 +30,6 @@
     aggregate:
       - { name: ansibletest2 }
       - { name: ansibletest3 }
-    provider: "{{ connection }}"
     state: present
     roles: network-admin
   register: result
@@ -49,7 +44,6 @@
       - { name: ansibletest1 }
       - { name: ansibletest2 }
       - { name: ansibletest3 }
-    provider: "{{ connection }}"
     state: absent
   register: result
 
diff --git a/test/integration/targets/nxos_user/tests/common/net_user.yaml b/test/integration/targets/nxos_user/tests/common/net_user.yaml
index 8c8a82c1d4..4676577d29 100644
--- a/test/integration/targets/nxos_user/tests/common/net_user.yaml
+++ b/test/integration/targets/nxos_user/tests/common/net_user.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos common/net_user.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Add minimal testcase to check args are passed correctly to
 # implementation module and module run is successful.
@@ -9,7 +7,6 @@
 - name: "Remove old entries of user - setup"
   net_user:
     name: ansibletest1
-    provider: "{{ connection }}"
     state: absent
 
 # Start tests
@@ -17,7 +14,6 @@
   net_user:
     name: ansibletest1
     roles: network-operator
-    provider: "{{ connection }}"
     state: present
   register: result
 
@@ -30,7 +26,6 @@
 - name: teardown
   net_user:
     name: ansibletest1
-    provider: "{{ connection }}"
     state: absent
 
 - debug: msg="END connection={{ ansible_connection }} nxos common/net_user.yaml"
diff --git a/test/integration/targets/nxos_user/tests/common/sanity.yaml b/test/integration/targets/nxos_user/tests/common/sanity.yaml
index 07fee4d000..86b7e4e7fb 100644
--- a/test/integration/targets/nxos_user/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_user/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_user parameter test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: idem="true"
 - set_fact: idem="false"
@@ -14,7 +12,6 @@
       configured_password: Hello!23$
       update_password: on_create
       roles: network-operator
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -35,7 +32,6 @@
   - name: Remove user
     nxos_user: &remove
       name: netend
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -53,7 +49,6 @@
 #    nxos_user: &conf1
 #      name: ansible
 #      sshkey: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"
-#      provider: "{{ connection }}"
 #      state: present
 #    register: result
 #
@@ -75,7 +70,6 @@
         - name: test2
       configured_password: Hello!23$
       update_password: on_create
-      provider: "{{ connection }}"
       state: present
       roles: 
         - network-admin
@@ -97,7 +91,6 @@
     nxos_user: &tear
       name: "{{ ansible_user }}"
       purge: yes
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
diff --git a/test/integration/targets/nxos_vlan/tasks/nxapi.yaml b/test/integration/targets/nxos_vlan/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vlan/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vlan/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vlan/tests/common/agg.yaml b/test/integration/targets/nxos_vlan/tests/common/agg.yaml
index 0ce4ba707b..690e89c80d 100644
--- a/test/integration/targets/nxos_vlan/tests/common/agg.yaml
+++ b/test/integration/targets/nxos_vlan/tests/common/agg.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }}/agg.yaml"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: setup - remove vlan used in test
   nxos_config: &rm
@@ -9,7 +7,6 @@
       - no vlan 102
       - no vlan 103
       - no vlan 104
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 
@@ -20,7 +17,6 @@
       - { name: app03, vlan_id: 103 }
     vlan_state: active
     admin_state: up
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -46,7 +42,6 @@
       - { name: app03, vlan_id: 103 }
     vlan_state: active
     admin_state: down
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -68,7 +63,6 @@
   nxos_vlan: &purge
     vlan_id: 1
     purge: yes
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -89,7 +83,6 @@
   nxos_vlan:
     vlan_id: 104
     purge: true
-    provider: "{{ connection }}"
 
 - name: purge 104 with aggregate add 102-103
   nxos_vlan: &purge_add
@@ -97,7 +90,6 @@
       - { vlan_id: 102 }
       - { vlan_id: 103 }
     purge: true
-    provider: "{{ connection }}"
   register: result
 
 - assert:
diff --git a/test/integration/targets/nxos_vlan/tests/common/interface.yaml b/test/integration/targets/nxos_vlan/tests/common/interface.yaml
index 6e7453760e..580feadaa9 100644
--- a/test/integration/targets/nxos_vlan/tests/common/interface.yaml
+++ b/test/integration/targets/nxos_vlan/tests/common/interface.yaml
@@ -6,7 +6,6 @@
   nxos_config:
     lines:
       - no vlan 100
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - remove vlan from interfaces used in test(part1)
@@ -15,7 +14,6 @@
       - no switchport access vlan 100
     parents: switchport
     before: "interface {{ testint1 }}"
-    provider: "{{ connection }}"
 
 - name: setup - remove vlan from interfaces used in test(part2)
   nxos_config:
@@ -23,12 +21,10 @@
       - no switchport access vlan 100
     parents: switchport
     before: "interface {{ testint2 }}"
-    provider: "{{ connection }}"
 
 - name: create vlan
   nxos_vlan:
     vlan_id: 100
-    provider: "{{ connection }}"
 
 - name: Add interfaces to vlan and check intent (config + intent)
   nxos_vlan: &interfaces
@@ -39,7 +35,6 @@
     associated_interfaces:
       - "{{ testint1 }}"
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -68,7 +63,6 @@
     associated_interfaces:
       - "{{ testint1 }}"
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -80,7 +74,6 @@
     vlan_id: 100
     associated_interfaces:
       - test
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
@@ -93,7 +86,6 @@
     vlan_id: 100
     interfaces:
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -116,7 +108,6 @@
   nxos_config:
     lines:
       - no vlan 100
-    provider: "{{ connection }}"
 
 - name: teardown - remove vlan from interfaces used in test(part1)
   nxos_config:
@@ -124,7 +115,6 @@
       - no switchport access vlan 100
     parents: switchport
     before: "interface {{ testint1 }}"
-    provider: "{{ connection }}"
 
 - name: teardown - remove vlan from interfaces used in test(part2)
   nxos_config:
@@ -132,4 +122,3 @@
       - no switchport access vlan 100
     parents: switchport
     before: "interface {{ testint2 }}"
-    provider: "{{ connection }}"
diff --git a/test/integration/targets/nxos_vlan/tests/common/sanity.yaml b/test/integration/targets/nxos_vlan/tests/common/sanity.yaml
index cc4e5b74f0..5204f3c419 100644
--- a/test/integration/targets/nxos_vlan/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vlan/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vlan sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint1="{{ nxos_int1 }}"
 - set_fact: testint2="{{ nxos_int2 }}"
@@ -12,7 +10,6 @@
       lines:
         - install feature-set fabricpath
         - feature-set fabricpath
-      provider: "{{ connection }}"
     when: platform is search('N5K|N7K')
 
   - name: "Enable feature vn segment"
@@ -20,20 +17,17 @@
       commands:
         - feature vn-segment-vlan-based
       match: none
-      provider: "{{ connection }}"
     when: platform is search('N9K')
 
   - name: vlan teardown
     nxos_vlan: &vlan_teardown
       vlan_range: "2-200"
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
   - name: Ensure a range of VLANs are present on the switch
     nxos_vlan: &conf_vlan
       vlan_range: "2-10,20,50,55-60,100-150"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -55,7 +49,6 @@
       admin_state: down
       name: WEB
       mapped_vni: 5555
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N9K')
 
@@ -77,7 +70,6 @@
       admin_state: up
       name: default
       mapped_vni: default
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N9K')
 
@@ -98,7 +90,6 @@
       vlan_state: suspend
       admin_state: down
       name: WEB
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N3K|N7K')
 
@@ -119,7 +110,6 @@
       vlan_state: active
       admin_state: up
       name: default
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N3K|N7K')
 
@@ -138,7 +128,6 @@
     nxos_vlan: &mode1
       vlan_id: 50
       mode: fabricpath
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N5K|N7K')
 
@@ -157,7 +146,6 @@
     nxos_vlan: &mode2
       vlan_id: 50
       mode: ce
-      provider: "{{ connection }}"
     register: result
     when: platform is search('N5K|N7K')
 
@@ -175,7 +163,6 @@
   - name: Ensure VLAN is NOT on the device
     nxos_vlan: &no_vlan
       vlan_id: 50
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -194,7 +181,6 @@
       interfaces:
         - "{{ testint1 }}"
         - "{{ testint2 }}"
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -209,7 +195,6 @@
     nxos_vlan: &remint
       vlan_id: 101
       interfaces: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -232,7 +217,6 @@
     - name: "Disable feature vn segement"
       nxos_feature:
         feature: vn-segment-vlan-based
-        provider: "{{ connection }}"
         state: disabled
       ignore_errors: yes
       when: platform is search('N9K')
diff --git a/test/integration/targets/nxos_vlans/tasks/nxapi.yaml b/test/integration/targets/nxos_vlans/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vlans/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vlans/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vpc/tasks/nxapi.yaml b/test/integration/targets/nxos_vpc/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vpc/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vpc/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vpc/tests/common/sanity.yaml b/test/integration/targets/nxos_vpc/tests/common/sanity.yaml
index 09e48520fb..2073223a06 100644
--- a/test/integration/targets/nxos_vpc/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vpc/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vpc sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - set_fact: delay_restore_orphan_port=25
@@ -12,23 +10,19 @@
   - name: disable vpc for initial vpc config cleanup
     nxos_feature:
       feature: vpc
-      provider: "{{ connection }}"
       state: disabled
 
   - name: enable feature vpc
     nxos_feature:
       feature: vpc
-      provider: "{{ connection }}"
       state: enabled
 
   - name: Ensure ntc VRF exists on switch
     nxos_vrf:
       vrf: ntc
-      provider: "{{ connection }}"
 
   - name: Configure vpc
     nxos_vpc: &conf_vpc
-      provider: "{{ connection }}"
       state: present
       domain: 100
       pkl_dest: 192.168.100.4
@@ -50,7 +44,6 @@
 
   - name: Configure vpc1
     nxos_vpc: &conf_vpc1
-      provider: "{{ connection }}"
       state: present
       domain: 100
       role_priority: 500
@@ -78,7 +71,6 @@
 
     - name: auto-recovery from default to non-default
       nxos_vpc: &auto_recovery_1
-        provider: "{{ connection }}"
         domain: 100
         auto_recovery: "{{ not def_auto_recovery }}"
       register: result
@@ -93,7 +85,6 @@
 
     - name: auto-recovery from non-default to default
       nxos_vpc: &auto_recovery_2
-        provider: "{{ connection }}"
         domain: 100
         auto_recovery: "{{ def_auto_recovery }}"
       register: result
@@ -110,7 +101,6 @@
 
   - name: Configure auto-recovery reload-delay
     nxos_vpc: &auto_reload
-      provider: "{{ connection }}"
       domain: 100
       auto_recovery_reload_delay: 242
     register: result
@@ -125,7 +115,6 @@
 
   - name: Configure vpc2
     nxos_vpc: &conf_vpc2
-      provider: "{{ connection }}"
       state: present
       domain: 100
       role_priority: default
@@ -146,7 +135,6 @@
 
   - name: Configure vpc3
     nxos_vpc: &conf_vpc3
-      provider: "{{ connection }}"
       state: present
       domain: 100
       peer_gw: False
@@ -162,7 +150,6 @@
 
   - name: remove vpc
     nxos_vpc: &rem_vpc
-      provider: "{{ connection }}"
       state: absent
       domain: 100
     register: result
@@ -179,14 +166,12 @@
   - name: remove vrf
     nxos_vrf:
       vrf: ntc
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
   - name: disable feature vpc
     nxos_feature:
       feature: vpc
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_vpc_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_vpc_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vpc_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vpc_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vpc_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_vpc_interface/tests/common/sanity.yaml
index 4f831389cf..f29feb08b8 100644
--- a/test/integration/targets/nxos_vpc_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vpc_interface/tests/common/sanity.yaml
@@ -1,13 +1,10 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vpc_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - name: enable feature vpc
     nxos_feature:
       feature: vpc
-      provider: "{{ connection }}"
       state: enabled
 
   - name: create port-channel10
@@ -16,7 +13,6 @@
         - interface port-channel10
         - switchport
       match: none
-      provider: "{{ connection }}"
 
   - name: create port-channel11
     nxos_config:
@@ -24,11 +20,9 @@
         - interface port-channel11
         - switchport
       match: none
-      provider: "{{ connection }}"
 
   - name: configure vpc
     nxos_vpc:
-      provider: "{{ connection }}"
       state: present
       domain: 100
       role_priority: 32667
@@ -42,7 +36,6 @@
     nxos_vpc_interface: &conf
       portchannel: 10
       vpc: 10
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -64,7 +57,6 @@
     nxos_vpc_interface: &conf1
       portchannel: 11
       peer_link: True
-      provider: "{{ connection }}"
     register: result
     when: image_version != "7.0(3)I5(1)"
 
@@ -83,7 +75,6 @@
     nxos_vpc_interface: &conf2
       portchannel: 11
       peer_link: False
-      provider: "{{ connection }}"
     register: result
     when: image_version != "7.0(3)I5(1)"
 
@@ -102,7 +93,6 @@
     nxos_vpc_interface: &remove
       portchannel: 10
       vpc: 10
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -117,7 +107,6 @@
   always:
   - name: remove vpc
     nxos_vpc:
-      provider: "{{ connection }}"
       state: absent
       domain: 100
       role_priority: 32667
@@ -132,7 +121,6 @@
     nxos_vpc_interface:
       portchannel: 10
       vpc: 10
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
@@ -142,13 +130,11 @@
         - no interface port-channel10
         - no interface port-channel11
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: disable feature vpc
     nxos_feature:
       feature: vpc
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vpc_interface sanity test"
diff --git a/test/integration/targets/nxos_vrf/tasks/nxapi.yaml b/test/integration/targets/nxos_vrf/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vrf/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vrf/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vrf/tests/common/intent.yaml b/test/integration/targets/nxos_vrf/tests/common/intent.yaml
index 43bc32716e..f98162bc0a 100644
--- a/test/integration/targets/nxos_vrf/tests/common/intent.yaml
+++ b/test/integration/targets/nxos_vrf/tests/common/intent.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vrf intent & aggregate test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: testint1="{{ nxos_int1 }}"
 - set_fact: testint2="{{ nxos_int2 }}"
@@ -12,7 +10,6 @@
       - no vrf member test1
     parents: no switchport
     before: "interface {{ testint1 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - remove vrf from interfaces used in test(part2)
@@ -21,21 +18,18 @@
       - no vrf member test1
     parents: no switchport
     before: "interface {{ testint2 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - delete VRF test1 used in test
   nxos_config:
     lines:
       - no vrf context test1
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - remove VRF test2 used in test
   nxos_config:
     lines:
       - no vrf context test2
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: aggregate definitions of VRFs
@@ -43,7 +37,6 @@
     aggregate:
       - { name: test1, description: Configured by Ansible }
       - { name: test2, description: Testing, admin_state: down }
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -73,7 +66,6 @@
     associated_interfaces:
       - "{{ testint1 }}"
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -99,7 +91,6 @@
     associated_interfaces:
       - "{{ testint1 }}"
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -111,7 +102,6 @@
     name: test1
     associated_interfaces:
       - test
-    provider: "{{ connection }}"
   register: result
   ignore_errors: yes
 
@@ -124,7 +114,6 @@
     name: test1
     interfaces:
       - "{{ testint2 }}"
-    provider: "{{ connection }}"
   register: result
 
 - assert:
@@ -146,7 +135,6 @@
     aggregate:
       - { name: test1, description: Configured by Ansible }
       - { name: test2, description: Testing, admin_state: down }
-    provider: "{{ connection }}"
     state: absent
   register: result
 
@@ -170,7 +158,6 @@
       - no vrf member test1
     parents: no switchport
     before: "interface {{ testint1 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - remove vrf from interfaces used in test(part2)
@@ -179,21 +166,18 @@
       - no vrf member test1
     parents: no switchport
     before: "interface {{ testint2 }}"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - delete VRF test1 used in test
   nxos_config:
     lines:
       - no vrf context test1
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: setup - remove VRF test2 used in test
   nxos_config:
     lines:
       - no vrf context test2
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vrf intent & aggregate test"
diff --git a/test/integration/targets/nxos_vrf/tests/common/sanity.yaml b/test/integration/targets/nxos_vrf/tests/common/sanity.yaml
index a39883cab8..25f778dc62 100644
--- a/test/integration/targets/nxos_vrf/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vrf/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vrf sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: intname1="{{ nxos_int1 }}"
 - set_fact: intname2="{{ nxos_int2 }}"
@@ -21,7 +19,6 @@
 - name: "Enable feature BGP"
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
   ignore_errors: yes
 
@@ -44,7 +41,6 @@
       interfaces:
         - "{{ intname1 }}"
         - "{{ intname2 }}"
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -69,7 +65,6 @@
       vni: "{{vnid|default(omit)}}"
       rd: "{{rdd|default(omit)}}"
       interfaces: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -83,7 +78,6 @@
   - name: Ensure ntc VRF does not exist on switch
     nxos_vrf: &remove
       vrf: ntc
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -110,7 +104,6 @@
   - name: "Disable feature BGP"
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_vrf_af/tasks/nxapi.yaml b/test/integration/targets/nxos_vrf_af/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vrf_af/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vrf_af/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vrf_af/tests/common/sanity.yaml b/test/integration/targets/nxos_vrf_af/tests/common/sanity.yaml
index 1235f9befd..cd321d6fca 100644
--- a/test/integration/targets/nxos_vrf_af/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vrf_af/tests/common/sanity.yaml
@@ -1,24 +1,19 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vrf_af sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - name: Configure feature bgp
   nxos_feature:
     feature: bgp
-    provider: "{{ connection }}"
     state: enabled
 
 - name: Configure feature nv overlay
   nxos_config:
     commands: "feature nv overlay"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - name: Configure nv overlay evpn
   nxos_config:
     commands: "nv overlay evpn"
-    provider: "{{ connection }}"
   ignore_errors: yes
 
 - block:
@@ -27,7 +22,6 @@
       vrf: ansible
       afi: ipv4
       route_target_both_auto_evpn: True
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -47,7 +41,6 @@
       vrf: ansible
       afi: ipv6
       route_target_both_auto_evpn: True
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -63,7 +56,6 @@
       vrf: ansible
       afi: ipv4
       route_target_both_auto_evpn: False
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -79,7 +71,6 @@
       vrf: ansible
       afi: ipv6
       route_target_both_auto_evpn: False
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -95,7 +86,6 @@
       vrf: ansible
       afi: ipv6
       route_target_both_auto_evpn: True
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -115,7 +105,6 @@
       vrf: ansible
       afi: ipv4
       route_target_both_auto_evpn: True
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -136,25 +125,21 @@
   - name: Remove vrf
     nxos_config:
       commands: "no vrf context ansible"
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: Remove nv overlay evpn
     nxos_config:
       commands: "no nv overlay evpn"
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: Remove feature nv overlay
     nxos_config:
       commands: "no feature nv overlay"
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: Remove feature bgp
     nxos_feature:
       feature: bgp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_vrf_interface/tasks/nxapi.yaml b/test/integration/targets/nxos_vrf_interface/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vrf_interface/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vrf_interface/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vrf_interface/tests/common/sanity.yaml b/test/integration/targets/nxos_vrf_interface/tests/common/sanity.yaml
index f4996a7d5e..ef7828cdab 100644
--- a/test/integration/targets/nxos_vrf_interface/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vrf_interface/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vrf_interface sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 # Select interface for test
 - set_fact: intname="{{ nxos_int1 }}"
@@ -14,13 +12,11 @@
       parents:
         - "interface {{ intname }}"
       match: none
-      provider: "{{ connection }}"
 
   - name: Ensure vrf ntc exists on interface
     nxos_vrf_interface: &configure
       vrf: ntc
       interface: "{{ intname }}"
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -40,7 +36,6 @@
     nxos_vrf_interface: &remove
       vrf: ntc
       interface: "{{ intname }}"
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -57,7 +52,6 @@
     nxos_config:
       lines: "default interface {{ intname }}"
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vrf_interface sanity test"
diff --git a/test/integration/targets/nxos_vrrp/tasks/nxapi.yaml b/test/integration/targets/nxos_vrrp/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vrrp/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vrrp/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vrrp/tests/common/sanity.yaml b/test/integration/targets/nxos_vrrp/tests/common/sanity.yaml
index 5c85620315..1ff951c8ad 100644
--- a/test/integration/targets/nxos_vrrp/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vrrp/tests/common/sanity.yaml
@@ -1,25 +1,20 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vrrp sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - name: "Enable interface-vlan"
     nxos_feature: 
       feature: interface-vlan
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "Enable vrrp"
     nxos_feature: 
       feature: vrrp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: "create int vlan 10"
     nxos_config: 
       commands: "int vlan 10"
-      provider: "{{ connection }}"
 
   - name: Ensure vrrp group 100 and vip 10.1.100.1 is on vlan10
     nxos_vrrp: &configure
@@ -27,7 +22,6 @@
       group: 100
       vip: 10.1.100.1
       admin_state: 'no shutdown'
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -48,7 +42,6 @@
       group: 100
       vip: default
       admin_state: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -63,7 +56,6 @@
     nxos_vrrp: &remove
       interface: vlan10
       group: 100
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -90,7 +82,6 @@
       interval: 10
       priority: 130
       authentication: AUTHKEY
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -110,7 +101,6 @@
       interval: default
       priority: default
       authentication: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -131,13 +121,11 @@
         commands:
           - no feature interface-vlan
         match: none
-        provider: "{{ connection }}"
       ignore_errors: yes
 
     - name: "Disable vrrp"
       nxos_feature: 
         feature: vrrp
-        provider: "{{ connection }}"
         state: disabled
       ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_vtp_domain/tasks/nxapi.yaml b/test/integration/targets/nxos_vtp_domain/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vtp_domain/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vtp_domain/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vtp_domain/tests/common/sanity.yaml b/test/integration/targets/nxos_vtp_domain/tests/common/sanity.yaml
index 4ba271ba1d..ebd821aa37 100644
--- a/test/integration/targets/nxos_vtp_domain/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vtp_domain/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vtp_domain sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: vtp_run="true"
 - set_fact: vtp_run="false"
@@ -11,20 +9,17 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
   - name: enable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: configure vtp domain
     nxos_vtp_domain: &configure
       domain: ntc
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -45,7 +40,6 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vtp_domain sanity test"
diff --git a/test/integration/targets/nxos_vtp_password/tasks/nxapi.yaml b/test/integration/targets/nxos_vtp_password/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vtp_password/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vtp_password/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vtp_password/tests/common/sanity.yaml b/test/integration/targets/nxos_vtp_password/tests/common/sanity.yaml
index 2c7ac02d42..dacc586c19 100644
--- a/test/integration/targets/nxos_vtp_password/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vtp_password/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vtp_password sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: vtp_run="true"
 - set_fact: vtp_run="false"
@@ -11,25 +9,21 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
   - name: enable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: configure vtp domain
     nxos_vtp_domain:
       domain: testing
-      provider: "{{ connection }}"
 
   - name: configure vtp password
     nxos_vtp_password: &configure
       vtp_password: ntc
-      provider: "{{ connection }}"
       state: present
     register: result
 
@@ -48,7 +42,6 @@
   - name: remove vtp password
     nxos_vtp_password: &remove
       vtp_password: ntc
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -66,7 +59,6 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vtp_password sanity test"
diff --git a/test/integration/targets/nxos_vtp_version/tasks/nxapi.yaml b/test/integration/targets/nxos_vtp_version/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vtp_version/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vtp_version/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vtp_version/tests/common/sanity.yaml b/test/integration/targets/nxos_vtp_version/tests/common/sanity.yaml
index d73aaaa9a1..ef5c3231d3 100644
--- a/test/integration/targets/nxos_vtp_version/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vtp_version/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vtp_version sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - set_fact: vtp_run="true"
 - set_fact: vtp_run="false"
@@ -11,25 +9,21 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
   - name: enable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: enabled
 
   - name: configure supporting vtp domain
     nxos_vtp_domain:
       domain: foo
-      provider: "{{ connection }}"
 
   - name: configure vtp version
     nxos_vtp_version: &configure
       version: 2
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -50,7 +44,6 @@
   - name: disable feature vtp
     nxos_feature:
       feature: vtp
-      provider: "{{ connection }}"
       state: disabled
 
 - debug: msg="END connection={{ ansible_connection }} nxos_vtp_version sanity test"
diff --git a/test/integration/targets/nxos_vxlan_vtep/tasks/nxapi.yaml b/test/integration/targets/nxos_vxlan_vtep/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vxlan_vtep/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/cleanup.yaml b/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/cleanup.yaml
index 8b89e8cc7b..5f0fe44949 100644
--- a/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/cleanup.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/cleanup.yaml
@@ -4,7 +4,6 @@
     commands:
       - 'terminal dont-ask ; vdc {{ vdcid }} ;  no limit-resource module-type f3'
     match: none
-    provider: "{{ cli }}"
   ignore_errors: yes
 
 - name: Previous command is asynchronous and can take a while.  Allow time for it to complete
@@ -16,7 +15,6 @@
     commands:
       - 'terminal dont-ask ; vdc {{ vdcid }} ; allocate interface unallocated-interfaces'
     match: none
-    provider: "{{ cli }}"
   ignore_errors: yes
 
 - name: Previous command is asynchronous can take a while.  Allow time for it to complete
diff --git a/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/setup.yaml b/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/setup.yaml
index 12ab0b204f..0501a90985 100644
--- a/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/setup.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep/tasks/platform/n7k/setup.yaml
@@ -2,7 +2,6 @@
 - name: "Get default vdc id"
   nxos_command:
     commands: ['show vdc current-vdc | json']
-    provider: "{{ cli }}"
   register: vdcout
 
 - set_fact: vdcid="{{ vdcout.stdout_lines[0].name }}"
@@ -12,7 +11,6 @@
     commands:
       - "terminal dont-ask ; vdc {{ vdcid }} ;  limit-resource module-type f3"
     match: none
-    provider: "{{ cli }}"
   ignore_errors: yes
 
 - name: Previous command is asynchronous and can take a while.  Allow time for it to complete
@@ -24,7 +22,6 @@
     commands:
       - "terminal dont-ask ; vdc {{ vdcid }} ; allocate interface unallocated-interfaces"
     match: none
-    provider: "{{ cli }}"
   ignore_errors: yes
 
 - name: Previous command is asynchronous and can take a while.  Allow time for it to complete
diff --git a/test/integration/targets/nxos_vxlan_vtep/tests/common/sanity.yaml b/test/integration/targets/nxos_vxlan_vtep/tests/common/sanity.yaml
index 2be09de27d..69e54ec7a6 100644
--- a/test/integration/targets/nxos_vxlan_vtep/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vxlan_vtep sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   # N9K(v9.2+) specific attrs
@@ -46,7 +44,6 @@
         - feature nv overlay
         - nv overlay evpn
       match: none
-      provider: "{{ connection }}"
 
   - block:
     - name: "Enable feature ngmvpn"
@@ -54,7 +51,6 @@
         commands:
           - feature ngmvpn
         match: none
-        provider: "{{ connection }}"
     when: global_mcast_group_L3 is defined
 
   - block:
@@ -69,7 +65,6 @@
         global_suppress_arp: "{{ global_suppress_arp|default(omit) }}"
         global_mcast_group_L3: "{{ global_mcast_group_L3|default(omit) }}"
         shutdown: false
-        provider: "{{ connection }}"
       register: result
 
     - assert: &true
@@ -95,7 +90,6 @@
         global_suppress_arp: "{{ def_global_suppress_arp|default(omit) }}"
         global_mcast_group_L3: "{{ def_global_mcast_group_L3|default(omit) }}"
         shutdown: true
-        provider: "{{ connection }}"
       register: result
 
     - assert: *true
@@ -111,7 +105,6 @@
         interface: nve1
         host_reachability: true
         global_mcast_group_L2: "{{ global_mcast_group_L2|default(omit) }}"
-        provider: "{{ connection }}"
       register: result
 
     - assert: *true
@@ -127,7 +120,6 @@
         interface: nve1
         host_reachability: false
         global_mcast_group_L2: "{{ def_global_mcast_group_L2|default(omit) }}"
-        provider: "{{ connection }}"
       register: result
 
     - assert: *true
@@ -148,7 +140,6 @@
         host_reachability: true
         source_interface: Loopback0
         shutdown: false
-        provider: "{{ connection }}"
       register: result
 
     - assert:
@@ -170,7 +161,6 @@
         host_reachability: false
         source_interface: default
         shutdown: true
-        provider: "{{ connection }}"
       register: result
 
     - assert: *true
@@ -191,7 +181,6 @@
       source_interface: Loopback0
       source_interface_hold_down_time: 30
       shutdown: true
-      provider: "{{ connection }}"
       state: absent
     register: result
 
@@ -219,13 +208,11 @@
       commands:
         - no nv overlay evpn
       match: none
-      provider: "{{ connection }}"
     ignore_errors: yes
 
   - name: "Disable feature nv overlay"
     nxos_feature:
       feature: nve
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
diff --git a/test/integration/targets/nxos_vxlan_vtep_vni/tasks/nxapi.yaml b/test/integration/targets/nxos_vxlan_vtep_vni/tasks/nxapi.yaml
index 04c99602e6..cbf41b9294 100644
--- a/test/integration/targets/nxos_vxlan_vtep_vni/tasks/nxapi.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep_vni/tasks/nxapi.yaml
@@ -25,9 +25,3 @@
   with_items: "{{ test_items }}"
   loop_control:
     loop_var: test_case_to_run
-
-- name: run test cases (connection=local)
-  include: "{{ test_case_to_run }} ansible_connection=local connection={{ nxapi }}"
-  with_items: "{{ test_items }}"
-  loop_control:
-    loop_var: test_case_to_run
diff --git a/test/integration/targets/nxos_vxlan_vtep_vni/tests/common/sanity.yaml b/test/integration/targets/nxos_vxlan_vtep_vni/tests/common/sanity.yaml
index 7e606c61d1..4f68ea9c0c 100644
--- a/test/integration/targets/nxos_vxlan_vtep_vni/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_vxlan_vtep_vni/tests/common/sanity.yaml
@@ -1,7 +1,5 @@
 ---
 - debug: msg="START connection={{ ansible_connection }} nxos_vxlan_vtep_vni sanity test"
-- debug: msg="Using provider={{ connection.transport }}"
-  when: ansible_connection == "local"
 
 - block:
   - name: "Apply N7K specific setup config"
@@ -13,20 +11,17 @@
       commands:
         - feature nv overlay
       match: none
-      provider: "{{ connection }}"
 
   - name: configure vxlan_vtep
     nxos_vxlan_vtep:
       interface: nve1
       host_reachability: True
-      provider: "{{ connection }}"
 
   - name: configure vxlan_vtep_vni assoc-vrf
     nxos_vxlan_vtep_vni: &conf1
       interface: nve1
       vni: 6000
       assoc_vrf: True
-      provider: "{{ connection }}"
     register: result
 
   - assert: &true
@@ -46,14 +41,12 @@
       interface: nve1
       vni: 6000
       assoc_vrf: True
-      provider: "{{ connection }}"
       state: absent
 
   - name: configure vxlan_vtep_vni
     nxos_vxlan_vtep_vni: &conf2
       interface: nve1
       vni: 8000
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -63,7 +56,6 @@
       interface: nve1
       vni: 8000
       multicast_group: 224.1.1.1
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -79,7 +71,6 @@
       interface: nve1
       vni: 8000
       multicast_group: default
-      provider: "{{ connection }}"
     register: result
 
   - assert: *true
@@ -94,21 +85,18 @@
     nxos_vxlan_vtep_vni: &remove
       interface: nve1
       vni: 8000
-      provider: "{{ connection }}"
       state: absent
 
   - name: configure vxlan_vtep
     nxos_vxlan_vtep:
       interface: nve1
       host_reachability: False
-      provider: "{{ connection }}"
 
   - block:
     - name: configure vxlan_vtep_vni
       nxos_vxlan_vtep_vni: &conf5
         interface: nve1
         vni: 8000
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -118,7 +106,6 @@
         interface: nve1
         vni: 8000
         ingress_replication: static
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -132,27 +119,23 @@
     - name: Remove and reconfigure vxlan_vtep
       nxos_vxlan_vtep: &remove_vtep
         interface: nve1
-        provider: "{{ connection }}"
         state: absent
 
     - name: Configure vxlan_vtep with host reachability bgp
       nxos_vxlan_vtep:
         interface: nve1
         host_reachability: True
-        provider: "{{ connection }}"
 
     - name: configure vxlan_vtep_vni
       nxos_vxlan_vtep_vni: &config_vni
         interface: nve1
         vni: 8000
-        provider: "{{ connection }}"
 
     - name: configure vxlan_vtep_vni ingress bgp
       nxos_vxlan_vtep_vni: &conf7
         interface: nve1
         vni: 8000
         ingress_replication: bgp
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -168,7 +151,6 @@
         interface: nve1
         vni: 8000
         ingress_replication: default
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -186,7 +168,6 @@
       nxos_vxlan_vtep:
         interface: nve1
         host_reachability: False
-        provider: "{{ connection }}"
 
     - name: configure vxlan_vtep_vni
       nxos_vxlan_vtep_vni: *config_vni
@@ -201,7 +182,6 @@
           - 192.0.2.3
           - 192.0.2.4
         ingress_replication: static
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -218,7 +198,6 @@
         vni: 8000
         peer_list: default
         ingress_replication: static
-        provider: "{{ connection }}"
       register: result
   
     - assert: *true
@@ -260,14 +239,12 @@
     nxos_vxlan_vtep:
       interface: nve1
       shutdown: true
-      provider: "{{ connection }}"
       state: absent
     ignore_errors: yes
 
   - name: "Disable feature nv overlay"
     nxos_feature: 
       feature: nve
-      provider: "{{ connection }}"
       state: disabled
     ignore_errors: yes
 
