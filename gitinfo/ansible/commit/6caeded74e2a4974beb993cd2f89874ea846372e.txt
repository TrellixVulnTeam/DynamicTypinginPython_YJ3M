commit 6caeded74e2a4974beb993cd2f89874ea846372e
Author: Stratos Moros <stratos@indev.gr>
Date:   Mon Feb 16 21:16:26 2015 +0200

    Fix umask calculation on file creation. Fixes #10257

diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py
index 4412291dff..65ea4dd716 100644
--- a/lib/ansible/module_utils/basic.py
+++ b/lib/ansible/module_utils/basic.py
@@ -1391,7 +1391,7 @@ class AnsibleModule(object):
             # based on the current value of umask
             umask = os.umask(0)
             os.umask(umask)
-            os.chmod(dest, 0666 ^ umask)
+            os.chmod(dest, 0666 & ~umask)
             if switched_user:
                 os.chown(dest, os.getuid(), os.getgid())
 
