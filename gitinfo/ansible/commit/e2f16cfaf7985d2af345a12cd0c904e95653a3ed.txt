commit e2f16cfaf7985d2af345a12cd0c904e95653a3ed
Author: Matt Martz <matt@sivel.net>
Date:   Fri Oct 13 12:46:24 2017 -0500

    Port vault-keyring.py to properly load the config. Fixes #31304 (#31315)

diff --git a/contrib/vault/vault-keyring.py b/contrib/vault/vault-keyring.py
index 8a51e6486f..461f2137d5 100755
--- a/contrib/vault/vault-keyring.py
+++ b/contrib/vault/vault-keyring.py
@@ -65,20 +65,20 @@ import sys
 import getpass
 import keyring
 
-import ansible.constants as C
+from ansible.config.manager import ConfigManager, get_ini_config_value
 
 
 def main():
-    (parser, config_path) = C.load_config_file()
-    if parser.has_option('vault', 'username'):
-        username = parser.get('vault', 'username')
-    else:
-        username = getpass.getuser()
+    config = ConfigManager()
+    username = get_ini_config_value(
+        config._parser,
+        dict(section='vault', key='username')
+    ) or getpass.getuser()
 
-    if parser.has_option('vault', 'keyname'):
-        keyname = parser.get('vault', 'keyname')
-    else:
-        keyname = 'ansible'
+    keyname = get_ini_config_value(
+        config._parser,
+        dict(section='vault', key='keyname')
+    ) or 'ansible'
 
     if len(sys.argv) == 2 and sys.argv[1] == 'set':
         intro = 'Storing password in "{}" user keyring using key name: {}\n'
