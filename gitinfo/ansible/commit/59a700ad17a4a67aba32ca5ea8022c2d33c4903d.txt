commit 59a700ad17a4a67aba32ca5ea8022c2d33c4903d
Author: anatoly techtonik <techtonik@gmail.com>
Date:   Mon Nov 10 20:32:05 2014 +0300

    acl: Fix X support in ACL permissions
    
    If you try to set rwX permissions, ACL fails to set them at all.
    
    Expected:
    
        $ sudo setfacl -m 'group::rwX' www
        ...
        drwxrwxr-x  2 root root  4096 Nov 10 17:09 www
    
    With Ansible:
    
        acl: name=/var/www permissions=rwX etype=group state=present
        ...
        drwxrw-r-x  2 root root  4096 Nov 10 17:30 www
    
    x for group is erased. =/

diff --git a/lib/ansible/modules/files/acl.py b/lib/ansible/modules/files/acl.py
index 30c533e006..9790f8c927 100644
--- a/lib/ansible/modules/files/acl.py
+++ b/lib/ansible/modules/files/acl.py
@@ -111,6 +111,9 @@ def normalize_permissions(p):
             perms[1] = 'w'
         if char == 'x':
             perms[2] = 'x'
+        if char == 'X':
+            if perms[2] != 'x':  # 'x' is more permissive
+              perms[2] = 'X'
     return ''.join(perms)
 
 def split_entry(entry):
