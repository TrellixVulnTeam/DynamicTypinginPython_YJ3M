commit 082f54eaf4c566f6862cf58f3dc05cf6a024f231
Author: ABond <ajbond2005@gmail.com>
Date:   Wed Sep 6 10:14:10 2017 -0400

    Fix digital_ocean module_util api_token bug (#28924)
    
    * Fix digital_ocean module_util api_token bug
    
    * Included environment variables also
    
    * Removed try/catch and added a check on self.oauth_token
    
    Modules using the DigitalOceanHelper would expect the module to handle any api key resolution.

diff --git a/lib/ansible/module_utils/digital_ocean.py b/lib/ansible/module_utils/digital_ocean.py
index 564a7df296..2cf1443d9a 100644
--- a/lib/ansible/module_utils/digital_ocean.py
+++ b/lib/ansible/module_utils/digital_ocean.py
@@ -92,11 +92,10 @@ class DigitalOceanHelper:
         return self.send('DELETE', path, data)
 
     def get_do_oauth_token(self):
-        try:
-            self.oauth_token = self.module.params['oauth_token'] or \
-                self.module.params['api_token'] or \
-                os.environ['DO_API_TOKEN'] or \
-                os.environ['DO_API_KEY'] or \
-                os.environ['OAUTH_TOKEN']
-        except KeyError as e:
-            self.module.fail_json(msg='Unable to load %s' % e.message)
+        self.oauth_token = self.module.params.get('oauth_token') or \
+            self.module.params.get('api_token') or \
+            os.environ.get('DO_API_TOKEN') or \
+            os.environ.get('DO_API_KEY') or \
+            os.environ.get('OAUTH_TOKEN')
+        if self.oauth_token is None:
+            self.module.fail_json(msg='Unable to load api key: oauth_token')
