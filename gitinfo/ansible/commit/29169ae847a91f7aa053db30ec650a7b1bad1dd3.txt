commit 29169ae847a91f7aa053db30ec650a7b1bad1dd3
Author: Abhijeet Kasurde <akasurde@redhat.com>
Date:   Fri Jun 26 00:51:50 2020 +0530

    stat: Handle colon in filename (#70259)
    
    Handle colon appearing in filename while parsing the mimetype and charset
    using file command.
    
    Fixes: #70256
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/changelogs/fragments/70256_stat_colon_split.yml b/changelogs/fragments/70256_stat_colon_split.yml
new file mode 100644
index 0000000000..7e2a12a94a
--- /dev/null
+++ b/changelogs/fragments/70256_stat_colon_split.yml
@@ -0,0 +1,2 @@
+bugfixes:
+- stat - handle colons in filename while parsing the mimetype output (https://github.com/ansible/ansible/issues/70256).
diff --git a/lib/ansible/modules/stat.py b/lib/ansible/modules/stat.py
index 8868eb2812..da550623df 100644
--- a/lib/ansible/modules/stat.py
+++ b/lib/ansible/modules/stat.py
@@ -513,11 +513,11 @@ def main():
         output['mimetype'] = output['charset'] = 'unknown'
         mimecmd = module.get_bin_path('file')
         if mimecmd:
-            mimecmd = [mimecmd, '-i', b_path]
+            mimecmd = [mimecmd, '--mime-type', '--mime-encoding', b_path]
             try:
                 rc, out, err = module.run_command(mimecmd)
                 if rc == 0:
-                    mimetype, charset = out.split(':')[1].split(';')
+                    mimetype, charset = out.rsplit(':', 1)[1].split(';')
                     output['mimetype'] = mimetype.strip()
                     output['charset'] = charset.split('=')[1].strip()
             except Exception:
diff --git a/test/integration/targets/stat/tasks/main.yml b/test/integration/targets/stat/tasks/main.yml
index bd6b1e8960..285e2b8375 100644
--- a/test/integration/targets/stat/tasks/main.yml
+++ b/test/integration/targets/stat/tasks/main.yml
@@ -155,3 +155,25 @@
         - "'xgrp' in stat_result.stat"
         - "'xoth' in stat_result.stat"
         - "'xusr' in stat_result.stat"
+
+- name: make a new file with colon in filename
+  copy:
+    dest: "{{ output_dir }}/foo:bar.txt"
+    mode: '0644'
+    content: "hello world"
+
+- name: check stat of a file with colon in name
+  stat:
+    path: "{{ output_dir }}/foo:bar.txt"
+    follow: True
+  register: stat_result
+
+- debug:
+    var: stat_result
+
+- assert:
+    that:
+        - "'changed' in stat_result"
+        - "stat_result.changed == false"
+        - "stat_result.stat.mimetype == 'text/plain'"
+        - "stat_result.stat.charset == 'us-ascii'"
