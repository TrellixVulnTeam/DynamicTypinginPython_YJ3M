commit 89d6c3658481859d69b3b13ec5a1166fd3f7f963
Author: Daniel Andrei MincÄƒ <dminca@users.noreply.github.com>
Date:   Tue Apr 10 19:01:44 2018 +0300

    Optimize file handling in the find module (#38192)
    
    * Optimize file handling
    
    Use the best practice of opening and doing operations on an opened file
    
    Signed-off-by: Daniel Andrei Minca <mandrei17@gmail.com>
    
    * Fix docstring to Sphinx type
    
    - update the docstrings to Sphinx type, as suggested by Toshio
    - Move the pattern object assignment outside the context manager, as
      suggested by Matt
    
    Signed-off-by: Daniel Andrei Minca <mandrei17@gmail.com>

diff --git a/lib/ansible/modules/files/find.py b/lib/ansible/modules/files/find.py
index 3613f1e609..b08105df08 100644
--- a/lib/ansible/modules/files/find.py
+++ b/lib/ansible/modules/files/find.py
@@ -250,19 +250,24 @@ def sizefilter(st, size):
 
 
 def contentfilter(fsname, pattern):
-    '''filter files which contain the given expression'''
+    """
+    Filter files which contain the given expression
+    :arg fsname: Filename to scan for lines matching a pattern
+    :arg pattern: Pattern to look for inside of line
+    :rtype: bool
+    :returns: True if one of the lines in fsname matches the pattern. Otherwise False
+    """
     if pattern is None:
         return True
 
+    prog = re.compile(pattern)
+
     try:
-        f = open(fsname)
-        prog = re.compile(pattern)
-        for line in f:
-            if prog.match(line):
-                f.close()
-                return True
-
-        f.close()
+        with open(fsname) as f:
+            for line in f:
+                if prog.match(line):
+                    return True
+
     except:
         pass
 
