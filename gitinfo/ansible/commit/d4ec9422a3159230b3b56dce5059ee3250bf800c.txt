commit d4ec9422a3159230b3b56dce5059ee3250bf800c
Author: Jordan Borean <jborean93@gmail.com>
Date:   Tue Sep 24 08:43:14 2019 -0400

    Add proper error when trying to run on older PS versions (#62634)

diff --git a/changelogs/fragments/pwsh-minimum.yaml b/changelogs/fragments/pwsh-minimum.yaml
new file mode 100644
index 0000000000..c0f0a4de85
--- /dev/null
+++ b/changelogs/fragments/pwsh-minimum.yaml
@@ -0,0 +1,2 @@
+minor_changes:
+- Windows - Add a check for the minimum PowerShell version so we can create a friendly error message on older hosts
diff --git a/lib/ansible/executor/powershell/bootstrap_wrapper.ps1 b/lib/ansible/executor/powershell/bootstrap_wrapper.ps1
index cfad82703d..cdba80cbb0 100644
--- a/lib/ansible/executor/powershell/bootstrap_wrapper.ps1
+++ b/lib/ansible/executor/powershell/bootstrap_wrapper.ps1
@@ -1,4 +1,10 @@
 &chcp.com 65001 > $null
+
+if ($PSVersionTable.PSVersion -lt [Version]"3.0") {
+    '{"failed":true,"msg":"Ansible requires PowerShell v3.0 or newer"}'
+    exit 1
+}
+
 $exec_wrapper_str = $input | Out-String
 $split_parts = $exec_wrapper_str.Split(@("`0`0`0`0"), 2, [StringSplitOptions]::RemoveEmptyEntries)
 If (-not $split_parts.Length -eq 2) { throw "invalid payload" }
