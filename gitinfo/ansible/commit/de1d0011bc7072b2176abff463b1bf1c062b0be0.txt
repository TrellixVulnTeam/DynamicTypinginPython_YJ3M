commit de1d0011bc7072b2176abff463b1bf1c062b0be0
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Tue Feb 28 02:32:14 2012 -0500

    Take darkened hosts out of the playbook rotation, fix error handling in template
    module so that if a directory path is specified we get valid output

diff --git a/lib/ansible/playbook.py b/lib/ansible/playbook.py
index 0c5377d2ff..33bcb755f7 100755
--- a/lib/ansible/playbook.py
+++ b/lib/ansible/playbook.py
@@ -111,7 +111,7 @@ class PlayBook(object):
         # do not continue to run tasks on hosts that have had failures
         new_hosts = []
         for x in host_list:
-            if not self.failures.has_key(x):
+            if not self.failures.has_key(x) and not self.dark.has_key(x):
                 new_hosts.append(x)
         host_list = new_hosts
 
diff --git a/library/template b/library/template
old mode 100644
new mode 100755
index fd454df42e..3850cb152c
--- a/library/template
+++ b/library/template
@@ -72,6 +72,13 @@ if not os.path.exists(source):
 
 source = file(source).read()
 
+if os.path.isdir(dest):
+    print json.dumps({
+         "failed" : 1,
+         "msg"    : "Destination is a directory"
+    })
+    sys.exit(1)
+
 # record md5sum of original source file so we can report if it changed
 changed = False
 md5sum = None
