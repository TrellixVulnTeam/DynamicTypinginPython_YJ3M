commit 1e340b19404f4a585282f67dd61b0bf2a09e5264
Author: Matt Davis <mrd@redhat.com>
Date:   Thu Nov 2 09:11:43 2017 -0700

    fix typo in azure_rm_vm plan

diff --git a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
index dce1f2a304..3abf2b5f60 100644
--- a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
+++ b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine.py
@@ -879,7 +879,7 @@ class AzureRMVirtualMachine(AzureRMModuleBase):
                     plan = None
                     if self.plan:
                         plan = Plan(name=self.plan.get('name'), product=self.plan.get('product'), publisher=self.plan.get('publisher'),
-                                    promotion_code=self.product.get('promotion_code'))
+                                    promotion_code=self.plan.get('promotion_code'))
 
                     vm_resource = VirtualMachine(
                         self.location,
