commit b06dfc489173affedf63e4df24a48653e84b88b0
Author: Denis Chapligin <akashihi@gmail.com>
Date:   Wed Dec 6 22:22:44 2017 +0100

    Adds 'discard_after_delete' property to ovirt_storage_domains module. (#33450)

diff --git a/lib/ansible/modules/cloud/ovirt/ovirt_storage_domains.py b/lib/ansible/modules/cloud/ovirt/ovirt_storage_domains.py
index 53dc226968..3c94b3574f 100644
--- a/lib/ansible/modules/cloud/ovirt/ovirt_storage_domains.py
+++ b/lib/ansible/modules/cloud/ovirt/ovirt_storage_domains.py
@@ -122,6 +122,12 @@ options:
         description:
             - "If I(True) storage domain will be formatted after removing it from oVirt/RHV."
             - "This parameter is relevant only when C(state) is I(absent)."
+    discard_after_delete:
+        description:
+            - "If I(True) storage domain blocks will be discarded upon deletion. Enabled by default."
+            - "This parameter is relevant only for block based storage domains."
+        version_added: 2.5
+
 extends_documentation_fragment: ovirt
 '''
 
@@ -300,6 +306,8 @@ class StorageDomainModule(BaseModule):
             host=otypes.Host(
                 name=self._module.params['host'],
             ),
+            discard_after_delete=self._module.params['discard_after_delete']
+            if storage_type in ['iscsi', 'fcp'] else False,
             storage=otypes.HostStorage(
                 type=otypes.StorageType(storage_type),
                 logical_units=[
@@ -498,6 +506,7 @@ def main():
         fcp=dict(default=None, type='dict'),
         destroy=dict(type='bool', default=False),
         format=dict(type='bool', default=False),
+        discard_after_delete=dict(type='bool', default=True)
     )
     module = AnsibleModule(
         argument_spec=argument_spec,
