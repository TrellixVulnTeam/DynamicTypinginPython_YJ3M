commit e07352b9de08a2ece01c5fed286b816c15af6368
Author: Jordan Borean <jborean93@gmail.com>
Date:   Thu Aug 23 16:34:50 2018 +1000

    basic.py: catch ValueError when trying to import hash algorithms (#44551)
    
    * basic.py: catch more Exceptions when trying to import md5 hash algorithms

diff --git a/changelogs/fragments/fips_md5_import.yaml b/changelogs/fragments/fips_md5_import.yaml
new file mode 100644
index 0000000000..5bde55ab9a
--- /dev/null
+++ b/changelogs/fragments/fips_md5_import.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+- basic.py - catch ValueError in case a FIPS enabled platform raises this exception - https://github.com/ansible/ansible/issues/44447
diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py
index b87f7e587d..85468515c3 100644
--- a/lib/ansible/module_utils/basic.py
+++ b/lib/ansible/module_utils/basic.py
@@ -132,13 +132,19 @@ try:
         algorithms = ('md5', 'sha1', 'sha224', 'sha256', 'sha384', 'sha512')
     for algorithm in algorithms:
         AVAILABLE_HASH_ALGORITHMS[algorithm] = getattr(hashlib, algorithm)
-except ImportError:
+
+    # we may have been able to import md5 but it could still not be available
+    try:
+        hashlib.md5()
+    except ValueError:
+        algorithms.pop('md5', None)
+except Exception:
     import sha
     AVAILABLE_HASH_ALGORITHMS = {'sha1': sha.sha}
     try:
         import md5
         AVAILABLE_HASH_ALGORITHMS['md5'] = md5.md5
-    except ImportError:
+    except Exception:
         pass
 
 from ansible.module_utils.common._collections_compat import (
