commit 2b22d36b882e820859563847775dd8bc78b22627
Author: Abhijeet Kasurde <akasurde@redhat.com>
Date:   Wed Nov 1 21:51:50 2017 +0530

    Handle error in user addition in postgresql_user (#32443)
    
    The fix adds exception handling while user add operation in
    postgresql_user module.
    
    Fixes: #29738
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/lib/ansible/modules/database/postgresql/postgresql_user.py b/lib/ansible/modules/database/postgresql/postgresql_user.py
index 0eff18cf74..3ad2fd6bc1 100644
--- a/lib/ansible/modules/database/postgresql/postgresql_user.py
+++ b/lib/ansible/modules/database/postgresql/postgresql_user.py
@@ -809,6 +809,10 @@ def main():
             try:
                 changed = user_add(cursor, user, password,
                                    role_attr_flags, encrypted, expires, conn_limit)
+            except psycopg2.ProgrammingError as e:
+                module.fail_json(msg="Unable to add user with given requirement "
+                                     "due to : %s" % to_native(e),
+                                 exception=traceback.format_exc())
             except SQLParseError as e:
                 module.fail_json(msg=to_native(e), exception=traceback.format_exc())
         try:
