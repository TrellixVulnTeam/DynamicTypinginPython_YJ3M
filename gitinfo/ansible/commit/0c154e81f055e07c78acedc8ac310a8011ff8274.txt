commit 0c154e81f055e07c78acedc8ac310a8011ff8274
Author: James Cammarata <jimi@sngx.net>
Date:   Fri Dec 18 11:30:14 2015 -0500

    Make integration tests run in parallel with async

diff --git a/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml b/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
index 2114567d15..980d4a4d32 100644
--- a/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
+++ b/test/utils/ansible-playbook_integration_runner/roles/run_integration/tasks/main.yml
@@ -10,11 +10,21 @@
   register: results
 
 - shell: ". hacking/env-setup && cd test/integration && make {{ run_integration_make_target }}"
+  async: 3600
+  poll: 0
+  register: async_test_results
   sudo: true
   environment:
     TEST_FLAGS: "{{ run_integration_test_flags|default(lookup('env', 'TEST_FLAGS')) }}"
     CREDENTIALS_FILE: "{{ run_integration_credentials_file|default(lookup('env', 'CREDENTIALS_FILE')) }}"
   args:
     chdir: "{{ results.stdout }}/ansible"
+
+- name: poll for test results
+  async_status:
+    jid: "{{async_test_results.ansible_job_id}}"
   register: test_results
+  until: test_results.finished
+  retries: 360
+  wait: 10
   ignore_errors: true
