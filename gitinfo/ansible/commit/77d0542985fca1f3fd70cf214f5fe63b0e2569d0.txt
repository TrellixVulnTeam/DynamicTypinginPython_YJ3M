commit 77d0542985fca1f3fd70cf214f5fe63b0e2569d0
Author: Rene Moser <mail@renemoser.net>
Date:   Fri Jun 30 20:43:34 2017 +0200

    test, integration: add diff support (#26296)

diff --git a/test/runner/lib/executor.py b/test/runner/lib/executor.py
index 302d557640..ec79bd45b1 100644
--- a/test/runner/lib/executor.py
+++ b/test/runner/lib/executor.py
@@ -671,6 +671,9 @@ def command_integration_role(args, target, start_at_task):
         if args.skip_tags:
             cmd += ['--skip-tags', args.skip_tags]
 
+        if args.diff:
+            cmd += ['--diff']
+
         if args.verbosity:
             cmd.append('-' + ('v' * args.verbosity))
 
@@ -1317,6 +1320,7 @@ class IntegrationConfig(TestConfig):
         self.retry_on_error = args.retry_on_error  # type: bool
         self.tags = args.tags
         self.skip_tags = args.skip_tags
+        self.diff = args.diff
 
 
 class PosixIntegrationConfig(IntegrationConfig):
diff --git a/test/runner/test.py b/test/runner/test.py
index 8722e6e56b..da62e53144 100755
--- a/test/runner/test.py
+++ b/test/runner/test.py
@@ -201,6 +201,10 @@ def parse_args():
                              metavar='TAGS',
                              help='only run plays and tasks whose tags do not match these values')
 
+    integration.add_argument('--diff',
+                             action='store_true',
+                             help='show diff output')
+
     integration.add_argument('--allow-destructive',
                              action='store_true',
                              help='allow destructive tests (--local and --tox only)')
