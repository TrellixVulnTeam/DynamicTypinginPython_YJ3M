commit 993bb5c6f1d142aeff549328bb21eb8d5c2298e7
Author: Dietmar Schinnerl <SleeplessAnnoyedNerd+github@gmail.com>
Date:   Sat Aug 11 15:55:14 2012 +0200

    Added stub implementation of filters

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index a1e566ce8e..a31b34faf0 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -655,7 +655,7 @@ class Runner(object):
 
         cmd = " || ".join(md5s)
         cmd = "%s; %s || (echo \"${rc}  %s\")" % (test, cmd, path)
-        return self._low_level_exec_command(conn, cmd, tmp, sudoable=False).split()[0]
+        return utils.last_non_blank_line(self._low_level_exec_command(conn, cmd, tmp, sudoable=False)).split()[0]
 
     # *****************************************************
 
@@ -675,7 +675,7 @@ class Runner(object):
         cmd += ' && echo %s' % basetmp
 
         result = self._low_level_exec_command(conn, cmd, None, sudoable=False)
-        return result.split("\n")[0].strip() + '/'
+        return utils.last_non_blank_line(result.split("\n"))[0].strip() + '/'
 
     # *****************************************************
 
diff --git a/lib/ansible/utils.py b/lib/ansible/utils.py
index e390070187..7b2ef864b9 100644
--- a/lib/ansible/utils.py
+++ b/lib/ansible/utils.py
@@ -117,9 +117,11 @@ def json_loads(data):
 
     return json.loads(data)
 
-def parse_json(data):
+def parse_json(raw_data):
     ''' this version for module return data only '''
 
+    data = filter_leading_garbage(raw_data)
+
     try:
         return json.loads(data)
     except:
@@ -409,3 +411,9 @@ def do_encrypt(result, encrypt, salt_size=None, salt=None):
 
     return result
 
+def last_non_blank_line(lines):
+    return lines
+
+def filter_leading_garbage(lines):
+    return lines
+
