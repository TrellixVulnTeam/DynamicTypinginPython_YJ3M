commit f891e9258135b0bcfa104c8b18ae6424d7ce0389
Author: Prasad Katti <prasadmkatti@gmail.com>
Date:   Mon Nov 13 20:40:55 2017 -0800

    ec2_key: fix fingerprint generation in tests (#32817)

diff --git a/test/integration/targets/ec2_key/tasks/main.yml b/test/integration/targets/ec2_key/tasks/main.yml
index 1881b5cfa6..05dd669288 100644
--- a/test/integration/targets/ec2_key/tasks/main.yml
+++ b/test/integration/targets/ec2_key/tasks/main.yml
@@ -219,8 +219,7 @@
            - 'result.key.name == "{{ec2_key_name}}"'
            - '"fingerprint" in result.key'
            - '"private_key" not in result.key'
-           # FIXME - why don't the fingerprints match?
-           # - 'result.key.fingerprint == "{{fingerprint}}"'
+           - 'result.key.fingerprint == "{{fingerprint}}"'
 
     # ============================================================
     - name: test state=absent with key_material
@@ -267,8 +266,7 @@
            - 'result.results[0].key.name == "{{ec2_key_name}}"'
            - '"fingerprint" in result.results[0].key'
            - '"private_key" not in result.results[0].key'
-           # FIXME - why doesn't result.key.fingerprint == {{fingerprint}}
-           # - 'result.key.fingerprint == "{{fingerprint}}"'
+           - 'result.results[0].key.fingerprint == "{{fingerprint}}"'
 
     # ============================================================
     - name: test state=present with key_material with_files (expect changed=false)
@@ -296,8 +294,7 @@
            - 'result.results[0].key.name == "{{ec2_key_name}}"'
            - '"fingerprint" in result.results[0].key'
            - '"private_key" not in result.results[0].key'
-           # FIXME - why doesn't result.key.fingerprint == {{fingerprint}}
-           # - 'result.key.fingerprint == "{{fingerprint}}"'
+           - 'result.results[0].key.fingerprint == "{{fingerprint}}"'
 
     # ============================================================
     - name: test state=absent with key_material (expect changed=true)
diff --git a/test/integration/targets/setup_sshkey/tasks/main.yml b/test/integration/targets/setup_sshkey/tasks/main.yml
index afea833198..a1254b18c2 100644
--- a/test/integration/targets/setup_sshkey/tasks/main.yml
+++ b/test/integration/targets/setup_sshkey/tasks/main.yml
@@ -33,7 +33,7 @@
     - prepare
 
 - name: record fingerprint
-  shell: ssh-keygen -lf {{sshkey.stdout}}.pub
+  shell: openssl rsa -in {{sshkey.stdout}} -pubout -outform DER 2>/dev/null | openssl md5 -c
   register: fingerprint
   tags:
     - prepare
