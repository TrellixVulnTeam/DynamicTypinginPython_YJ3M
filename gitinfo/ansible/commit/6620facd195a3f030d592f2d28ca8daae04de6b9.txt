commit 6620facd195a3f030d592f2d28ca8daae04de6b9
Author: Jordan Borean <jborean93@gmail.com>
Date:   Fri Jan 4 07:12:30 2019 +1000

    ansible test: re-enable mysql tests with fix (#50430)

diff --git a/test/integration/targets/mysql_db/aliases b/test/integration/targets/mysql_db/aliases
index 0fe22eb59d..5eb727b09b 100644
--- a/test/integration/targets/mysql_db/aliases
+++ b/test/integration/targets/mysql_db/aliases
@@ -1,4 +1,3 @@
-unstable
 destructive
 shippable/posix/group1
 skip/osx
diff --git a/test/integration/targets/mysql_user/aliases b/test/integration/targets/mysql_user/aliases
index a03abe0c05..5eb727b09b 100644
--- a/test/integration/targets/mysql_user/aliases
+++ b/test/integration/targets/mysql_user/aliases
@@ -2,4 +2,3 @@ destructive
 shippable/posix/group1
 skip/osx
 skip/freebsd
-disabled
diff --git a/test/integration/targets/mysql_variables/aliases b/test/integration/targets/mysql_variables/aliases
index a03abe0c05..5eb727b09b 100644
--- a/test/integration/targets/mysql_variables/aliases
+++ b/test/integration/targets/mysql_variables/aliases
@@ -2,4 +2,3 @@ destructive
 shippable/posix/group1
 skip/osx
 skip/freebsd
-disabled
diff --git a/test/integration/targets/setup_mysql_db/tasks/main.yml b/test/integration/targets/setup_mysql_db/tasks/main.yml
index f1027d29f0..ee7e03872d 100644
--- a/test/integration/targets/setup_mysql_db/tasks/main.yml
+++ b/test/integration/targets/setup_mysql_db/tasks/main.yml
@@ -43,9 +43,28 @@
   with_items: "{{mysql_packages}}"
   when: ansible_pkg_mgr  ==  'yum'
 
-- name: install mysqldb_test rpm dependencies
-  dnf: name={{ item }} state=latest
-  with_items: "{{mysql_packages}}"
+- block:
+  # This is required as mariadb-server has a weak dependency on Python 2 which causes the test to break on Py3 hosts
+  - name: create test dnf.conf file to ignore weak dependencies
+    copy:
+      content: |
+        [main]
+        install_weak_deps=False
+      dest: '{{ output_dir }}/dnf.conf'
+    register: test_dnf_conf_copy
+
+  - name: install mysqldb_test rpm dependencies
+    dnf:
+      name: '{{ item }}'
+      state: latest
+      conf_file: '{{ test_dnf_conf_copy.dest }}'
+    with_items: "{{mysql_packages}}"
+
+  always:
+  - name: remove test dnf.conf file
+    file:
+      path: '{{ test_dnf_conf_copy.dest }}'
+      state: absent
   when: ansible_pkg_mgr  ==  'dnf'
 
 - name: install mysqldb_test debian dependencies
diff --git a/test/integration/targets/zabbix_host/aliases b/test/integration/targets/zabbix_host/aliases
index 6b82262261..3d0091e7a9 100644
--- a/test/integration/targets/zabbix_host/aliases
+++ b/test/integration/targets/zabbix_host/aliases
@@ -3,4 +3,3 @@ shippable/posix/group1
 skip/osx
 skip/freebsd
 skip/rhel
-disabled
