commit 588bddbc35746d4f0735d3858287fd44f695b082
Author: Trishna Guha <trishnaguha17@gmail.com>
Date:   Fri Sep 8 19:33:41 2017 +0530

    nxos_banner CI fix (#29134)
    
    Signed-off-by: Trishna Guha <trishnaguha17@gmail.com>

diff --git a/lib/ansible/modules/network/nxos/nxos_banner.py b/lib/ansible/modules/network/nxos/nxos_banner.py
index b3adb4c701..3690a31f1b 100644
--- a/lib/ansible/modules/network/nxos/nxos_banner.py
+++ b/lib/ansible/modules/network/nxos/nxos_banner.py
@@ -96,7 +96,7 @@ def map_obj_to_commands(want, have, module):
     commands = list()
     state = module.params['state']
 
-    if state == 'absent' and have.get('text'):
+    if (state == 'absent' and (have.get('text') and have.get('text') != 'User Access Verification')):
         commands.append('no banner %s' % module.params['banner'])
 
     elif state == 'present' and want.get('text') != have.get('text'):
diff --git a/test/integration/targets/nxos_banner/tests/common/basic-no-exec.yaml b/test/integration/targets/nxos_banner/tests/common/basic-no-exec.yaml
index da7ee1999a..b7c9fbfc99 100644
--- a/test/integration/targets/nxos_banner/tests/common/basic-no-exec.yaml
+++ b/test/integration/targets/nxos_banner/tests/common/basic-no-exec.yaml
@@ -1,16 +1,16 @@
 ---
 - name: Setup
   nxos_banner:
-    banner: exec
+    banner: motd
     text: |
-      Junk exec banner
+      Junk motd banner
       over multiple lines
     state: present
     provider: "{{ connection }}"
 
-- name: remove exec
-  nxos_banner: &rm-exec
-    banner: exec
+- name: remove motd
+  nxos_banner: &rm-motd
+    banner: motd
     state: absent
     provider: "{{ connection }}"
   register: result
@@ -18,10 +18,10 @@
 - assert:
     that:
       - "result.changed == true"
-      - "'no banner exec' in result.commands"
+      - "'no banner motd' in result.commands"
 
-- name: remove exec (idempotent)
-  nxos_banner: *rm-exec
+- name: remove motd (idempotent)
+  nxos_banner: *rm-motd
   register: result
 
 - assert:
