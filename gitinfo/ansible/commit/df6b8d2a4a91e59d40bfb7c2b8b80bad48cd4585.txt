commit df6b8d2a4a91e59d40bfb7c2b8b80bad48cd4585
Author: Matt Martz <matt@sivel.net>
Date:   Mon Aug 5 10:36:41 2019 -0500

    Fix async output with adhoc callbacks. Fixes #15988 (#59935)

diff --git a/changelogs/fragments/adhoc-command-async-output.yaml b/changelogs/fragments/adhoc-command-async-output.yaml
new file mode 100644
index 0000000000..80da9fcd2b
--- /dev/null
+++ b/changelogs/fragments/adhoc-command-async-output.yaml
@@ -0,0 +1,3 @@
+bugfixes:
+- async - Fix async callback plugins to allow async output to be displayed
+  when running command/shell (https://github.com/ansible/ansible/issues/15988)
diff --git a/lib/ansible/plugins/callback/minimal.py b/lib/ansible/plugins/callback/minimal.py
index 111814f0c9..8d3aef5b72 100644
--- a/lib/ansible/plugins/callback/minimal.py
+++ b/lib/ansible/plugins/callback/minimal.py
@@ -62,7 +62,7 @@ class CallbackModule(CallbackBase):
             color = C.COLOR_OK
             state = 'SUCCESS'
 
-        if result._task.action in C.MODULE_NO_JSON:
+        if result._task.action in C.MODULE_NO_JSON and 'ansible_job_id' not in result._result:
             self._display.display(self._command_generic_msg(result._host.get_name(), result._result, state), color=color)
         else:
             self._display.display("%s | %s => %s" % (result._host.get_name(), state, self._dump_results(result._result, indent=4)), color=color)
diff --git a/lib/ansible/plugins/callback/oneline.py b/lib/ansible/plugins/callback/oneline.py
index b89f8b6ed5..20b5be7f71 100644
--- a/lib/ansible/plugins/callback/oneline.py
+++ b/lib/ansible/plugins/callback/oneline.py
@@ -64,7 +64,7 @@ class CallbackModule(CallbackBase):
             color = C.COLOR_OK
             state = 'SUCCESS'
 
-        if result._task.action in C.MODULE_NO_JSON:
+        if result._task.action in C.MODULE_NO_JSON and 'ansible_job_id' not in result._result:
             self._display.display(self._command_generic_msg(result._host.get_name(), result._result, state), color=color)
         else:
             self._display.display("%s | %s => %s" % (result._host.get_name(), state, self._dump_results(result._result, indent=0).replace('\n', '')),
