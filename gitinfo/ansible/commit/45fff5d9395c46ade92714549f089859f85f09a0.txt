commit 45fff5d9395c46ade92714549f089859f85f09a0
Author: nitzmahone <mdavis@ansible.com>
Date:   Wed Nov 4 17:29:08 2015 -0800

    fixed ansible_totalmem fact returning 0
    
    Win32_PhysicalMemory CIM object is busted on some virtual environments, switched
    to Win32_ComputerSystem.TotalPhysicalMemory

diff --git a/lib/ansible/modules/windows/setup.ps1 b/lib/ansible/modules/windows/setup.ps1
index 0b3e2c897e..4d163c7ec2 100644
--- a/lib/ansible/modules/windows/setup.ps1
+++ b/lib/ansible/modules/windows/setup.ps1
@@ -26,11 +26,9 @@ $result = New-Object psobject @{
 };
 
 $win32_os = Get-CimInstance Win32_OperatingSystem
+$win32_cs = Get-CimInstance Win32_ComputerSystem
 $osversion = [Environment]::OSVersion
-$memory = @()
-$memory += Get-WmiObject win32_Physicalmemory
-$capacity = 0
-$memory | foreach {$capacity += $_.Capacity}
+$capacity = $win32_cs.TotalPhysicalMemory # Win32_PhysicalMemory is empty on some virtual platforms
 $netcfg = Get-WmiObject win32_NetworkAdapterConfiguration
 
 $ActiveNetcfg = @(); $ActiveNetcfg+= $netcfg | where {$_.ipaddress -ne $null}
