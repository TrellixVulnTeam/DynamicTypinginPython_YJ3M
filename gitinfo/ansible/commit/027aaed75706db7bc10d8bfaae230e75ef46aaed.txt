commit 027aaed75706db7bc10d8bfaae230e75ef46aaed
Author: Brian Coca <bcoca@ansible.com>
Date:   Fri Jun 19 12:05:50 2015 -0400

    made sensu_check 2.4 friendly

diff --git a/lib/ansible/modules/extras/monitoring/sensu_check.py b/lib/ansible/modules/extras/monitoring/sensu_check.py
index b968304c34..eb9d0b7bf0 100644
--- a/lib/ansible/modules/extras/monitoring/sensu_check.py
+++ b/lib/ansible/modules/extras/monitoring/sensu_check.py
@@ -183,8 +183,8 @@ def sensu_check(module, path, name, state='present', backup=False):
         import simplejson as json
 
     try:
-        with open(path) as stream:
-            config = json.load(stream)
+        stream = open(path, 'r')
+        config = json.load(stream.read())
     except IOError as e:
         if e.errno is 2:  # File not found, non-fatal
             if state == 'absent':
@@ -196,6 +196,9 @@ def sensu_check(module, path, name, state='present', backup=False):
     except ValueError:
         msg = '{path} contains invalid JSON'.format(path=path)
         module.fail_json(msg=msg)
+    finally:
+        if stream:
+            stream.close()
 
     if 'checks' not in config:
         if state == 'absent':
@@ -274,10 +277,13 @@ def sensu_check(module, path, name, state='present', backup=False):
         if backup:
             module.backup_local(path)
         try:
-            with open(path, 'w') as stream:
-                stream.write(json.dumps(config, indent=2) + '\n')
+            stream = open(path, 'w')
+            stream.write(json.dumps(config, indent=2) + '\n')
         except IOError as e:
             module.fail_json(msg=str(e))
+        finally:
+            if stream:
+                stream.close()
 
     return changed, reasons
 
