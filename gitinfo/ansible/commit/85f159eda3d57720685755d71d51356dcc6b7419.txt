commit 85f159eda3d57720685755d71d51356dcc6b7419
Author: Ben Copeland <ben.copeland@linaro.org>
Date:   Thu Mar 5 13:27:49 2015 +0000

    Catch the error for non-ssl SMTP

diff --git a/lib/ansible/modules/extras/notification/mail.py b/lib/ansible/modules/extras/notification/mail.py
index ccf5302974..aa3345b4f9 100644
--- a/lib/ansible/modules/extras/notification/mail.py
+++ b/lib/ansible/modules/extras/notification/mail.py
@@ -189,9 +189,13 @@ def main():
         body = subject
 
     try:
-        smtp = smtplib.SMTP_SSL(host, port=int(port))
-    except (smtplib.SMTPException, ssl.SSLError):
-        smtp = smtplib.SMTP(host, port=int(port))
+        try:
+            smtp = smtplib.SMTP_SSL(host, port=int(port))
+        except (smtplib.SMTPException, ssl.SSLError):
+            smtp = smtplib.SMTP(host, port=int(port))
+    except Exception, e:
+        module.fail_json(rc=1, msg='Failed to send mail to server %s on port %s: %s' % (host, port, e))
+
     smtp.ehlo()
     if username and password:
         if smtp.has_extn('STARTTLS'):
