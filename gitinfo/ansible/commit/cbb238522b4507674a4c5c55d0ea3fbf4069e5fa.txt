commit cbb238522b4507674a4c5c55d0ea3fbf4069e5fa
Author: Pierre-Louis Bonicoli <pierre-louis.bonicoli@libregerbil.fr>
Date:   Fri Jan 5 11:10:44 2018 +0100

    get_url tests: controller & managed node can be distinct
    
    Templating happens on the Ansible controller, not on the taskâ€™s target host.

diff --git a/test/integration/targets/get_url/tasks/main.yml b/test/integration/targets/get_url/tasks/main.yml
index c4e483a8ee..995cd5790b 100644
--- a/test/integration/targets/get_url/tasks/main.yml
+++ b/test/integration/targets/get_url/tasks/main.yml
@@ -33,17 +33,18 @@
 
 - name: Define test files for file schema
   set_fact:
-    geturl_srcfile: "{{ output_dir | expanduser }}/aurlfile.txt"
-    geturl_dstfile: "{{ output_dir | expanduser }}/aurlfile_copy.txt"
+    geturl_srcfile: "{{ output_dir }}/aurlfile.txt"
+    geturl_dstfile: "{{ output_dir }}/aurlfile_copy.txt"
 
 - name: Create source file
   copy:
     dest: "{{ geturl_srcfile }}"
     content: "foobar"
+  register: source_file_copied
 
 - name: test file fetch
   get_url:
-    url: "{{ 'file://' + geturl_srcfile }}"
+    url: "file://{{ source_file_copied.dest }}"
     dest: "{{ geturl_dstfile }}"
   register: result
 
@@ -55,8 +56,8 @@
 
 - name: test nonexisting file fetch
   get_url:
-    url: "{{ 'file://' + geturl_srcfile + 'NOFILE' }}"
-    dest: "{{ geturl_dstfile + 'NOFILE' }}"
+    url: "file://{{ source_file_copied.dest }}NOFILE"
+    dest: "{{ geturl_dstfile }}NOFILE"
   register: result
   ignore_errors: True
 
