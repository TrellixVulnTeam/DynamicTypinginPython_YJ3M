commit d12475c98bcc67df60a0f533975562d454452115
Author: James Cammarata <jimi@sngx.net>
Date:   Thu Nov 3 09:24:48 2016 -0500

    Correctly assign parent when squashing adjacent implict Blocks
    
    Related to: #18315
    Related to: #18206
    Related to: #17810

diff --git a/lib/ansible/playbook/helpers.py b/lib/ansible/playbook/helpers.py
index 36976655e2..ba1d0826cc 100644
--- a/lib/ansible/playbook/helpers.py
+++ b/lib/ansible/playbook/helpers.py
@@ -61,7 +61,7 @@ def load_list_of_blocks(ds, play, parent_block=None, role=None, task_include=Non
             # squash them down to a single block to save processing time later.
             if b._implicit and len(block_list) > 0 and block_list[-1]._implicit:
                 for t in b.block:
-                    t._block = block_list[-1]
+                    t._parent = block_list[-1]
                 block_list[-1].block.extend(b.block)
             else:
                 block_list.append(b)
