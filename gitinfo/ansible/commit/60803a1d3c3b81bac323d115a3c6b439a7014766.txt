commit 60803a1d3c3b81bac323d115a3c6b439a7014766
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Aug 12 19:00:54 2015 -0400

    added lookup paths testing

diff --git a/test/integration/Makefile b/test/integration/Makefile
index af1bee3201..cde8c2ceb6 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -184,3 +184,6 @@ test_galaxy_yaml:
     RC=$$? ; \
     rm -rf $$mytmpdir ; \
     exit $$RC
+
+test_lookup_paths:
+	ansible-playbook lookup_paths/play.yml -i $(INVENTORY) -v $(TEST_FLAGS)
diff --git a/test/integration/lookup_paths/play.yml b/test/integration/lookup_paths/play.yml
new file mode 100644
index 0000000000..29dafff9cc
--- /dev/null
+++ b/test/integration/lookup_paths/play.yml
@@ -0,0 +1,60 @@
+- name: setup state
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - copy: dest={{playbook_dir}}/roles/showfile/files/testfile content='in role files'
+    - copy: dest={{playbook_dir}}/roles/showfile/tasks/testfile content='in role tasks'
+    - copy: dest={{playbook_dir}}/roles/showfile/testfile content='in role'
+    - copy: dest={{playbook_dir}}/files/testfile content='in files'
+    - copy: dest={{playbook_dir}}/testfile content='in local'
+    - set_fact: role_out="in role files" play_out="in files"
+
+- include: testplay.yml
+
+- name: remove from role/files
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - file: path={{playbook_dir}}/roles/showfile/files/testfile state=absent
+    - set_fact: role_out="in role tasks" play_out="in files"
+
+- include: testplay.yml
+
+- name: remove from role/tasks
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - file: path={{playbook_dir}}/roles/showfile/tasks/testfile state=absent
+    - set_fact: role_out="in files" play_out="in files"
+
+- include: testplay.yml
+
+- name: remove from role dir
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - file: path={{playbook_dir}}/roles/showfile/testfile state=absent
+    - set_fact: role_out="in files" play_out="in files"
+
+- include: testplay.yml
+
+- name: remove from play/files
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - file: path={{playbook_dir}}/files/testfile state=absent
+    - set_fact: role_out="in local" play_out="in local"
+
+- include: testplay.yml
+
+- name: cleanup
+  hosts: testhost
+  connection: local
+  gather_facts: false
+  tasks:
+    - file: path={{playbook_dir}}/testfile state=absent
diff --git a/test/integration/lookup_paths/roles/showfile/tasks/main.yml b/test/integration/lookup_paths/roles/showfile/tasks/main.yml
new file mode 100644
index 0000000000..1b3805798d
--- /dev/null
+++ b/test/integration/lookup_paths/roles/showfile/tasks/main.yml
@@ -0,0 +1,2 @@
+- name: relative to role
+  set_fact: role_result="{{lookup('file', 'testfile')}}"
diff --git a/test/integration/lookup_paths/testplay.yml b/test/integration/lookup_paths/testplay.yml
new file mode 100644
index 0000000000..5ab7293d8a
--- /dev/null
+++ b/test/integration/lookup_paths/testplay.yml
@@ -0,0 +1,19 @@
+- name: test initial state
+  hosts: localhost
+  connection: local
+  gather_facts: false
+  roles:
+    - showfile
+  tasks:
+    - name: from play
+      set_fact: play_result="{{lookup('file', 'testfile')}}"
+
+    - name: output output
+      debug: msg="play> {{play_out}}, role> {{role_out}}"
+
+    - name: verify that result match expected
+      assert:
+        that:
+            - 'play_result == play_out'
+            - 'role_result == role_out'
+
