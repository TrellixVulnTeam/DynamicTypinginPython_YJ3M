commit e2a7ba35dbc2b9af5ad1858a64a7bb460e109a0b
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Thu Feb 4 12:44:45 2016 -0800

    Fix --diff to respect no_log task parameter.

diff --git a/lib/ansible/plugins/action/__init__.py b/lib/ansible/plugins/action/__init__.py
index d201850d64..fe8bfc398b 100644
--- a/lib/ansible/plugins/action/__init__.py
+++ b/lib/ansible/plugins/action/__init__.py
@@ -615,4 +615,7 @@ class ActionBase(with_metaclass(ABCMeta, object)):
                 diff['after_header'] = 'dynamically generated'
                 diff['after'] = source
 
+        if self._play_context.no_log and 'after' in diff:
+            diff["after"] = " [[ Diff output has been hidden because 'no_log: true' was specified for this result ]]"
+
         return diff
