commit fb6e91bf98bfda6474833fa4b80f84b1efc5b27b
Author: Adam Miller <admiller@redhat.com>
Date:   Thu Oct 11 10:11:34 2018 -0500

    yum module properly check for None config_file (#46641)
    
    * yum module properly check for None config_file
    * add conf_file test cases to yum integration tests
    
    Signed-off-by: Adam Miller <admiller@redhat.com>

diff --git a/lib/ansible/modules/packaging/os/yum.py b/lib/ansible/modules/packaging/os/yum.py
index 74fd7ee35f..de6e2a8c8c 100644
--- a/lib/ansible/modules/packaging/os/yum.py
+++ b/lib/ansible/modules/packaging/os/yum.py
@@ -1306,8 +1306,8 @@ class YumModule(YumDnf):
         if self.conf_file and os.path.exists(self.conf_file):
             self.yum_basecmd += ['-c', self.conf_file]
 
-        if repoq:
-            repoq += ['-c', self.conf_file]
+            if repoq:
+                repoq += ['-c', self.conf_file]
 
         if self.skip_broken:
             self.yum_basecmd.extend(['--skip-broken'])
diff --git a/test/integration/targets/yum/tasks/yum.yml b/test/integration/targets/yum/tasks/yum.yml
index 54bad92159..6dc29cc73f 100644
--- a/test/integration/targets/yum/tasks/yum.yml
+++ b/test/integration/targets/yum/tasks/yum.yml
@@ -120,6 +120,15 @@
     that:
         - "yum_result is successful"
 
+- name: install sos with state latest in check mode with config file param
+  yum: name=sos state=latest conf_file=/etc/yum.conf
+  check_mode: true
+  register: yum_result
+- name: verify install sos with state latest in check mode with config file param
+  assert:
+    that:
+        - "yum_result is changed"
+
 - name: install sos with state latest in check mode
   yum: name=sos state=latest
   check_mode: true
@@ -145,6 +154,15 @@
     that:
         - "not yum_result is changed"
 
+- name: install sos with state latest idempotence with config file param
+  yum: name=sos state=latest
+  register: yum_result
+- name: verify install sos with state latest idempotence with config file param
+  assert:
+    that:
+        - "not yum_result is changed"
+
+
 # Multiple packages
 - name: uninstall sos and bc
   yum: name=sos,bc state=removed
