commit 718d2cabbb364371ccaf8f067210764ff938cd70
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Wed Feb 19 16:42:02 2014 -0500

    Add tests for fetch.

diff --git a/tests_new/integration/non_destructive.yml b/tests_new/integration/non_destructive.yml
index 9d1357d1f1..63901fb0d0 100644
--- a/tests_new/integration/non_destructive.yml
+++ b/tests_new/integration/non_destructive.yml
@@ -4,4 +4,5 @@
     - { role: test_copy, tags: test_copy }
     - { role: test_template, tags: test_template }
     - { role: test_file, tags: test_file }
+    - { role: test_fetch, tags: test_fetch }
 
diff --git a/tests_new/integration/roles/test_fetch/meta/main.yml b/tests_new/integration/roles/test_fetch/meta/main.yml
new file mode 100644
index 0000000000..1050c23ce3
--- /dev/null
+++ b/tests_new/integration/roles/test_fetch/meta/main.yml
@@ -0,0 +1,3 @@
+dependencies: 
+  - prepare_tests
+
diff --git a/tests_new/integration/roles/test_fetch/tasks/main.yml b/tests_new/integration/roles/test_fetch/tasks/main.yml
new file mode 100644
index 0000000000..7560ae5912
--- /dev/null
+++ b/tests_new/integration/roles/test_fetch/tasks/main.yml
@@ -0,0 +1,42 @@
+# test code for the pip module
+# (c) 2014, Michael DeHaan <michael.dehaan@gmail.com>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+- name: set the output location
+  set_fact: output_file={{ output_dir }}/motd
+
+- name: fetch the motd
+  fetch: src=/etc/motd dest={{ output_file }}
+  register: fetched
+
+- debug: var=fetched
+
+# TODO: check the sudo and non-sudo forms of fetch because in one form we'll do
+# the get method of the connection plugin and in the sudo case we'll use the
+# fetch module.
+
+- name: diff what we fetched with the original file
+  shell: diff /etc/motd {{ output_dir }}/motd/127.0.0.1/etc/motd
+  register: diff
+
+- name: check the diff to make sure they are the same
+  assert:
+    that:
+      'diff.stdout == ""'
+
+ 
+
