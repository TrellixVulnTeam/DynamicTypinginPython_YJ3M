commit 18582295e315e5648dcc947baa14db28da6bbc8c
Author: Will Thames <will@thames.id.au>
Date:   Wed Sep 20 23:27:45 2017 +1000

    Fix broken LimitExceeded check in iam_managed_policy (#30537)
    
    When policy versions exceed 5, we hit LimitExceeded. However,
    the exception checking should use `e.response['Error']['Code']`

diff --git a/lib/ansible/modules/cloud/amazon/iam_managed_policy.py b/lib/ansible/modules/cloud/amazon/iam_managed_policy.py
index 84bbc1ccce..ce4e1d1397 100644
--- a/lib/ansible/modules/cloud/amazon/iam_managed_policy.py
+++ b/lib/ansible/modules/cloud/amazon/iam_managed_policy.py
@@ -188,7 +188,7 @@ def get_or_create_policy_version(module, iam, policy, policy_document):
         version = iam.create_policy_version(PolicyArn=policy['Arn'], PolicyDocument=policy_document)['PolicyVersion']
         return version, True
     except botocore.exceptions.ClientError as e:
-        if e['Error']['Code'] == 'LimitExceeded':
+        if e.response['Error']['Code'] == 'LimitExceeded':
             delete_oldest_non_default_version(module, iam, policy)
             try:
                 version = iam.create_policy_version(PolicyArn=policy['Arn'], PolicyDocument=policy_document)['PolicyVersion']
