commit bf4ad56479a652521056c8f6fbff24f31927dee8
Author: Nathaniel Case <this.is@nathanielca.se>
Date:   Mon Dec 17 12:33:44 2018 -0500

    Move errors from import to connect (#50034)

diff --git a/lib/ansible/plugins/connection/napalm.py b/lib/ansible/plugins/connection/napalm.py
index 16306c7b55..93d79ba81d 100644
--- a/lib/ansible/plugins/connection/napalm.py
+++ b/lib/ansible/plugins/connection/napalm.py
@@ -138,10 +138,7 @@ try:
     from napalm.base import ModuleImportError
     HAS_NAPALM = True
 except ImportError:
-    raise AnsibleError(
-        'Napalm is required to use the napalm connection type.\n'
-        'Please run pip install napalm'
-    )
+    HAS_NAPALM = False
 
 display = Display()
 
@@ -158,6 +155,11 @@ class Connection(NetworkConnectionBase):
         self.napalm = None
 
     def _connect(self):
+        if not HAS_NAPALM:
+            raise AnsibleError(
+                'Napalm is required to use the napalm connection type.\n'
+                'Please run pip install napalm'
+            )
         super(Connection, self)._connect()
 
         if not self.connected:
diff --git a/lib/ansible/plugins/connection/netconf.py b/lib/ansible/plugins/connection/netconf.py
index 9436a034c9..cd20e89aa4 100644
--- a/lib/ansible/plugins/connection/netconf.py
+++ b/lib/ansible/plugins/connection/netconf.py
@@ -188,8 +188,9 @@ try:
     from ncclient.operations import RPCError
     from ncclient.transport.errors import SSHUnknownHostError
     from ncclient.xml_ import to_ele, to_xml
+    HAS_NCCLIENT = True
 except ImportError:
-    raise AnsibleError("ncclient is not installed")
+    HAS_NCCLIENT = False
 
 display = Display()
 
@@ -252,6 +253,12 @@ class Connection(NetworkConnectionBase):
             return super(Connection, self).exec_command(cmd, in_data, sudoable)
 
     def _connect(self):
+        if not HAS_NCCLIENT:
+            raise AnsibleError(
+                'ncclient is required to use the netconf connection type.\n'
+                'Please run pip install ncclient'
+            )
+
         display.display('ssh connection done, starting ncclient', log_only=True)
 
         allow_agent = True
