commit 04bfcd08a83c2a09ca38ce5019c10a26e71ec377
Author: Sumit Jaiswal <sjaiswal@redhat.com>
Date:   Fri Jun 7 21:26:30 2019 +0530

    PR to fix the IOS_NTP integration TC failure (#57481)
    
    * ios_ntp tc fail
    
    Signed-off-by: Sumit Jaiswal <sjaiswal@redhat.com>
    
    * ios_ntp tc fail
    
    Signed-off-by: Sumit Jaiswal <sjaiswal@redhat.com>
    
    * fix for local connection
    
    Signed-off-by: Sumit Jaiswal <sjaiswal@redhat.com>

diff --git a/test/integration/targets/ios_ntp/tests/cli/ntp_configuration.yaml b/test/integration/targets/ios_ntp/tests/cli/ntp_configuration.yaml
index 36efe5f065..7e1e52afa2 100644
--- a/test/integration/targets/ios_ntp/tests/cli/ntp_configuration.yaml
+++ b/test/integration/targets/ios_ntp/tests/cli/ntp_configuration.yaml
@@ -1,4 +1,6 @@
 ---
+- debug: msg="START connection={{ ansible_connection }} ios_ntp sanity test"
+
 - name: remove NTP (if set)
   ios_ntp: &remove
     server: 10.75.32.5
@@ -9,6 +11,7 @@
     auth_key: 15435A030726242723273C21181319000A
     auth: true
     state: absent
+    provider: "{{ cli }}"
   ignore_errors: true
 
 - block:
@@ -18,6 +21,7 @@
       server: 10.75.32.5
       source_int: "{{ test_interface }}"
       state: present
+      provider: "{{ cli }}"
     register: result
 
   - assert: &true
@@ -32,11 +36,22 @@
       that:
         - "result.changed == false"
 
+  - name: load acl NTP_ACL into device
+    ios_config:
+      lines:
+        - 10 permit ip host 192.0.2.1 any log
+      parents: ip access-list extended NTP_ACL
+      provider: "{{ cli }}"
+    register: result
+
+  - assert: *true
+
   - name: configure NTP
     ios_ntp: &config1
       acl: NTP_ACL
       logging: true
       state: present
+      provider: "{{ cli }}"
     register: result
 
   - assert: *true
@@ -53,6 +68,7 @@
       auth_key: 15435A030726242723273C21181319000A
       auth: true
       state: present
+      provider: "{{ cli }}"
     register: result
 
   - assert: *true
@@ -68,6 +84,7 @@
       acl: NTP_ACL
       logging: true
       state: absent
+      provider: "{{ cli }}"
     register: result
 
   - assert: *true
@@ -81,3 +98,10 @@
   always:
   - name: Remove ntp config
     ios_ntp: *remove
+
+  - name: remove NTP_ACL from device
+    ios_config:
+      lines:
+        - no ip access-list extended NTP_ACL
+      provider: "{{ cli }}"
+
