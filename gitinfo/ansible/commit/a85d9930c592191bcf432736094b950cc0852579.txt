commit a85d9930c592191bcf432736094b950cc0852579
Author: Rene Moser <mail@renemoser.net>
Date:   Wed Jun 1 22:43:34 2016 +0200

    apt: fix KeyError for deb=file (#3816)
    
    Fix KeyError: 'prepared' while installing dependencies using deb=<file>.deb
    This error shows up when --diff was not passed by and the deb files has dependencies not yet installed.
    Closes #3752.

diff --git a/lib/ansible/modules/packaging/os/apt.py b/lib/ansible/modules/packaging/os/apt.py
index 1c388b413c..aaed23831a 100644
--- a/lib/ansible/modules/packaging/os/apt.py
+++ b/lib/ansible/modules/packaging/os/apt.py
@@ -535,7 +535,8 @@ def install_deb(m, debs, cache, force, install_recommends, allow_unauthenticated
             stdout = out
         if "diff" in retvals:
             diff = retvals["diff"]
-            diff["prepared"] += '\n\n' + out
+            if 'prepared' in diff:
+                diff['prepared'] += '\n\n' + out
         else:
             diff = out
         if "stderr" in retvals:
