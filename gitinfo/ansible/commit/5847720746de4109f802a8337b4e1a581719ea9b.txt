commit 5847720746de4109f802a8337b4e1a581719ea9b
Author: James Cammarata <jimi@sngx.net>
Date:   Sat Aug 17 00:06:24 2013 -0500

    Fixing a small bug with the new role dependency feature
    
    The block that added the original list of roles was indented too far,
    and was only being reached if a role had dependencies. This resulted
    in roles without dependencies from being added to the list of roles.
    
    Credit goes to looped for reporting and diagnosing the issue.

diff --git a/lib/ansible/playbook/play.py b/lib/ansible/playbook/play.py
index 934e5d6491..03216fe1f1 100644
--- a/lib/ansible/playbook/play.py
+++ b/lib/ansible/playbook/play.py
@@ -177,10 +177,10 @@ class Play(object):
                             del dep_vars['role']
                         self._build_role_dependencies([dep], dep_stack, passed_vars=dep_vars, level=level+1)
                         dep_stack.append([dep,dep_path,dep_vars])
-                    # only add the current role when we're at the top level,
-                    # otherwise we'll end up in a recursive loop 
-                    if level == 0:
-                        dep_stack.append([role,role_path,role_vars])
+            # only add the current role when we're at the top level,
+            # otherwise we'll end up in a recursive loop 
+            if level == 0:
+                dep_stack.append([role,role_path,role_vars])
         return dep_stack
 
     def _load_roles(self, roles, ds):
