commit 4f674ec5223168f49f5d014a251b65efd7f301d3
Author: James Tanner <tanner.jc@gmail.com>
Date:   Thu Oct 17 13:15:32 2013 -0400

    Fixes #4554 Enumerate user homedir if not passed as an argument

diff --git a/library/system/user b/library/system/user
index 2e47055b7e..0528bd5d11 100644
--- a/library/system/user
+++ b/library/system/user
@@ -1513,9 +1513,11 @@ def main():
             result['ssh_public_key'] = user.get_ssh_public_key()
 
         # handle missing homedirs
+        info = user.user_info()
+        if user.home is None:
+            user.home = info[5]
         if not os.path.exists(user.home) and user.createhome:
             if not module.check_mode:
-                info = user.user_info()
                 user.create_homedir(user.home)
                 user.chown_homedir(info[2], info[3], user.home)
             result['changed'] = True
