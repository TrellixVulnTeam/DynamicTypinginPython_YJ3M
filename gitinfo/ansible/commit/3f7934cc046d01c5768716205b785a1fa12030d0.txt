commit 3f7934cc046d01c5768716205b785a1fa12030d0
Author: Joel Crocker <joelcrocker@gmail.com>
Date:   Tue Jun 17 12:01:14 2014 -0400

    Updates django_manage so it populates VIRTUAL_ENV
    
    Virtualenv's activate script sets the VIRTUAL_ENV environment variable to the path of the virtualenv. Checking this variable is a reasonably common way to verify that execution is happening in a virtualenv. It would be convenient if this module's virtualenv handling set this environment variable.

diff --git a/library/web_infrastructure/django_manage b/library/web_infrastructure/django_manage
index 246b9d9e3d..580cc63c2d 100644
--- a/library/web_infrastructure/django_manage
+++ b/library/web_infrastructure/django_manage
@@ -144,6 +144,7 @@ def _ensure_virtualenv(module):
             _fail(module, vcmd, out_venv, err_venv)
 
     os.environ["PATH"] = "%s:%s" % (vbin, os.environ["PATH"])
+    os.environ["VIRTUAL_ENV"] = venv_param
 
 def createcachetable_filter_output(line):
     return "Already exists" not in line
