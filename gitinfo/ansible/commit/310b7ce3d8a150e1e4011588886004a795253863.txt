commit 310b7ce3d8a150e1e4011588886004a795253863
Author: Christopher M. Fuhrman <cfuhrman@panix.com>
Date:   Thu Apr 14 03:51:29 2016 -0700

    pkgin: Fix bad regexp which did not catch packages such as p5-SVN-Notify
    
    The previous version of my regexp did not take into account packages
    such as 'p5-Perl-Tidy' or 'p5-Test-Output', so use a greedy match up to
    the last occurrance of '-' for matching the package.  This regex has
    been extensively tested using all packages as provided by pkgsrc-2016Q1[1].
    
    Footnotes:
    [1]  http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/?only_with_tag=pkgsrc-2016Q1

diff --git a/lib/ansible/modules/extras/packaging/os/pkgin.py b/lib/ansible/modules/extras/packaging/os/pkgin.py
index cd48385eef..055891ebe0 100755
--- a/lib/ansible/modules/extras/packaging/os/pkgin.py
+++ b/lib/ansible/modules/extras/packaging/os/pkgin.py
@@ -164,7 +164,7 @@ def query_package(module, name):
 
             # Search for package, stripping version
             # (results in sth like 'gcc47-libs' or 'emacs24-nox11')
-            pkg_search_obj = re.search(r'^([a-zA-Z]+[0-9]*[\-]*\w*)-[0-9]', pkgname_with_version, re.M)
+            pkg_search_obj = re.search(r'^(.*?)\-[0-9][0-9.]*(nb[0-9]+)*', pkgname_with_version, re.M)
 
             # Do not proceed unless we have a match
             if not pkg_search_obj:
