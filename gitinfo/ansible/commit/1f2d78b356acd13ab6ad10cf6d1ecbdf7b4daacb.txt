commit 1f2d78b356acd13ab6ad10cf6d1ecbdf7b4daacb
Author: Dusan Matejka <matejkadusan32@gmail.com>
Date:   Wed Oct 30 16:38:04 2019 +0100

    unify mongodb installation for both xenial and bionic in integration tests

diff --git a/test/integration/targets/setup_mongodb/defaults/main.yml b/test/integration/targets/setup_mongodb/defaults/main.yml
index 55acd964e8..a319bbf505 100644
--- a/test/integration/targets/setup_mongodb/defaults/main.yml
+++ b/test/integration/targets/setup_mongodb/defaults/main.yml
@@ -1,14 +1,9 @@
 mongodb_version: "4.0"
 
-apt_xenial:
-  keyserver: "keyserver.ubuntu.com"
-  keyserver_id: "2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5"
-  repo: "deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu {{ansible_distribution_release}}/mongodb-org/{{mongodb_version}} multiverse"
-
-apt_bionic:
+apt:
   keyserver: "keyserver.ubuntu.com"
   keyserver_id: "9DA31620334BD75D9DCB49F368818C72E52529D4"
-  repo: "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu {{ansible_distribution_release}}/mongodb-org/{{mongodb_version}} multiverse"
+  repo: "deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu {{ansible_distribution_release}}/mongodb-org/{{mongodb_version}} multiverse"
 
 mongodb_packages:
   mongod: mongodb-org-server
diff --git a/test/integration/targets/setup_mongodb/tasks/main.yml b/test/integration/targets/setup_mongodb/tasks/main.yml
index 4b3817bebd..3271f47286 100644
--- a/test/integration/targets/setup_mongodb/tasks/main.yml
+++ b/test/integration/targets/setup_mongodb/tasks/main.yml
@@ -28,42 +28,21 @@
     or (ansible_distribution == 'CentOS' and ansible_distribution_version == '7')
 
 # Ubuntu
-- name: Import MongoDB public GPG Key xenial
+- name: Import MongoDB public GPG Key
   apt_key:
-    keyserver: "{{ apt_xenial.keyserver }}"
-    id: "{{ apt_xenial.keyserver_id }}"
+    keyserver: "{{ apt.keyserver }}"
+    id: "{{ apt.keyserver_id }}"
   when:
-    - ansible_distribution_version == "16.04"
-    - ansible_distribution == 'Ubuntu'
-
-- name: Add MongoDB repository into sources list xenial
-  apt_repository:
-    repo: "{{ apt_xenial.repo }}"
-    state: present
-  when:
-    - ansible_distribution_version == "16.04"
-    - ansible_distribution == 'Ubuntu'
-
-- name: Import MongoDB public GPG Key bionic
-  apt_key:
-    keyserver: "{{ apt_bionic.keyserver }}"
-    id: "{{ apt_bionic.keyserver_id }}"
-  when:
-    - ansible_distribution_version == "18.04"
+    - ansible_distribution_version in ["16.04", "18.04"]
     - ansible_distribution == 'Ubuntu'
 
-- name: Add MongoDB repository into sources list bionic
+- name: Add MongoDB repository into sources list
   apt_repository:
-    repo: "{{ apt_bionic.repo }}"
+    repo: "{{ apt.repo }}"
     state: present
+    update_cache: yes
   when:
-    - ansible_distribution_version == "18.04"
-    - ansible_distribution == 'Ubuntu'
-
-- name: Update apt keys
-  shell: apt-key update && apt-get update
-  when:
-    - mongodb_version != "4.0"
+    - ansible_distribution_version in ["16.04", "18.04"]
     - ansible_distribution == 'Ubuntu'
 
 # Need to handle various platforms here. Package name will not always be the same
