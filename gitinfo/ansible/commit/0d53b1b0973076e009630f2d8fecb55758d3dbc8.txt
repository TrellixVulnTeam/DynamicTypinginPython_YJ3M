commit 0d53b1b0973076e009630f2d8fecb55758d3dbc8
Author: Ludovic Claude <ludovic.claude@lbpoker.com>
Date:   Wed Jul 18 17:52:51 2012 +0200

    Change previous fix to a one line change relative to upstream

diff --git a/lib/ansible/runner/connection/local.py b/lib/ansible/runner/connection/local.py
index 1779ffb45c..582059036f 100644
--- a/lib/ansible/runner/connection/local.py
+++ b/lib/ansible/runner/connection/local.py
@@ -37,12 +37,12 @@ class LocalConnection(object):
         ''' run a command on the local host '''
 
         if self.runner.sudo and sudoable:
-            if self.runner.sudo_pass:
-                # NOTE: if someone wants to add sudo w/ password to the local connection type, they are welcome
-                # to do so.  The primary usage of the local connection is for crontab and kickstart usage however
-                # so this doesn't seem to be a huge priority
-                raise errors.AnsibleError("sudo with password is presently only supported on the paramiko (SSH) connection type")
             cmd = "sudo -s %s" % cmd
+        if self.runner.sudo and sudoable and self.runner.sudo_pass:
+            # NOTE: if someone wants to add sudo w/ password to the local connection type, they are welcome
+            # to do so.  The primary usage of the local connection is for crontab and kickstart usage however
+            # so this doesn't seem to be a huge priority
+            raise errors.AnsibleError("sudo with password is presently only supported on the paramiko (SSH) connection type")
 
         p = subprocess.Popen(cmd, shell=True, stdin=None,
                              stdout=subprocess.PIPE, stderr=subprocess.PIPE)
