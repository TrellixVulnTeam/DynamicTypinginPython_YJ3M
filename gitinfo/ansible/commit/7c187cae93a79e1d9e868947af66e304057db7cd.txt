commit 7c187cae93a79e1d9e868947af66e304057db7cd
Author: Pilou <pierre-louis@libregerbil.fr>
Date:   Wed Dec 13 16:03:06 2017 +0100

    Fix playbook cli unit test (#33767)
    
    * TestPlaybookCLI: '--flush-cache' were ignored
    
    Check that using '--flush-cache' does something
    
    * check that '_flush_cache' does something
    
    There isn't any fact by default: the assertion was true even if
    'cli._flush_cache()' isn't called.

diff --git a/test/units/cli/test_playbook.py b/test/units/cli/test_playbook.py
index 51b8cf6c0b..a44084b4a7 100644
--- a/test/units/cli/test_playbook.py
+++ b/test/units/cli/test_playbook.py
@@ -30,11 +30,16 @@ from ansible.cli.playbook import PlaybookCLI
 
 class TestPlaybookCLI(unittest.TestCase):
     def test_flush_cache(self):
-        cli = PlaybookCLI(args=["--flush-cache", "foobar.yml"])
+        cli = PlaybookCLI(args=["ansible-playbook", "--flush-cache", "foobar.yml"])
+        cli.parse()
+        self.assertTrue(cli.options.flush_cache)
 
         variable_manager = VariableManager()
         fake_loader = DictDataLoader({'foobar.yml': ""})
         inventory = InventoryManager(loader=fake_loader, sources='testhost,')
 
+        variable_manager.set_host_facts(inventory.get_host('testhost'), {'canary': True})
+        self.assertTrue('testhost' in variable_manager._fact_cache)
+
         cli._flush_cache(inventory, variable_manager)
         self.assertFalse('testhost' in variable_manager._fact_cache)
