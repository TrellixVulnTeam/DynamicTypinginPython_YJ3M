commit 20d49af4752d37f3329985aed8b6cd3220fb73a1
Author: Matt Clay <matt@mystile.com>
Date:   Wed Jul 12 14:16:46 2017 -0700

    Add ANSIBLE_TEST_CI env var to integration tests.

diff --git a/test/runner/lib/executor.py b/test/runner/lib/executor.py
index d8abfdda57..286ad06169 100644
--- a/test/runner/lib/executor.py
+++ b/test/runner/lib/executor.py
@@ -593,6 +593,7 @@ def integration_environment(args, target, cmd):
     integration = dict(
         JUNIT_OUTPUT_DIR=os.path.abspath('test/results/junit'),
         ANSIBLE_CALLBACK_WHITELIST='junit',
+        ANSIBLE_TEST_CI=args.metadata.ci_provider,
     )
 
     if args.debug_strategy:
diff --git a/test/runner/lib/metadata.py b/test/runner/lib/metadata.py
index 8fbd048ecf..221d3cb261 100644
--- a/test/runner/lib/metadata.py
+++ b/test/runner/lib/metadata.py
@@ -5,6 +5,7 @@ import json
 
 from lib.util import (
     display,
+    is_shippable,
 )
 
 from lib.diff import (
@@ -19,6 +20,11 @@ class Metadata(object):
         self.changes = {}  # type: dict [str, tuple[tuple[int, int]]
         self.cloud_config = None  # type: dict [str, str]
 
+        if is_shippable():
+            self.ci_provider = 'shippable'
+        else:
+            self.ci_provider = ''
+
     def populate_changes(self, diff):
         """
         :type diff: list[str] | None
@@ -47,6 +53,7 @@ class Metadata(object):
         return dict(
             changes=self.changes,
             cloud_config=self.cloud_config,
+            ci_provider=self.ci_provider,
         )
 
     def to_file(self, path):
@@ -80,5 +87,6 @@ class Metadata(object):
         metadata = Metadata()
         metadata.changes = data['changes']
         metadata.cloud_config = data['cloud_config']
+        metadata.ci_provider = data['ci_provider']
 
         return metadata
