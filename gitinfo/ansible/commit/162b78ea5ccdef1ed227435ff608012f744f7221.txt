commit 162b78ea5ccdef1ed227435ff608012f744f7221
Author: Stephen Fromm <sfromm@gmail.com>
Date:   Wed Jul 18 16:41:55 2012 -0700

    Check if CPU is QEMU via different mechanism
    
    The processor fact doesn't exist in LinuxVirtual.  Read /proc/cpuinfo
    and check if it is QEMU.

diff --git a/library/setup b/library/setup
index 543886e82f..0395baea36 100755
--- a/library/setup
+++ b/library/setup
@@ -546,7 +546,8 @@ class LinuxVirtual(Virtual):
             elif 'vboxguest' in modules:
                 self.facts['virtualization_type'] = 'virtualbox'
                 self.facts['virtualization_role'] = 'guest'
-        if 'processor' in self.facts and 'QEMU' in self.facts['processor'][0]:
+        data = get_file_content('/proc/cpuinfo')
+        if 'QEMU' in data:
             self.facts['virtualization_type'] = 'kvm'
             self.facts['virtualization_role'] = 'guest'
         if 'distribution' in self.facts and self.facts['distribution'] == 'VMwareESX':
