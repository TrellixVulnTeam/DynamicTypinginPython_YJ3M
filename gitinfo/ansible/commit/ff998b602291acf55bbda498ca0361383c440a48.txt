commit ff998b602291acf55bbda498ca0361383c440a48
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Jun 17 00:09:04 2015 -0400

    Make sure the templar is using the right vars when evaluating conditionals

diff --git a/lib/ansible/playbook/conditional.py b/lib/ansible/playbook/conditional.py
index 707233aaa0..ff00a01de2 100644
--- a/lib/ansible/playbook/conditional.py
+++ b/lib/ansible/playbook/conditional.py
@@ -73,6 +73,9 @@ class Conditional:
         if conditional in all_vars and '-' not in unicode(all_vars[conditional]):
             conditional = all_vars[conditional]
 
+        # make sure the templar is using the variables specifed to this method
+        templar.set_available_variables(variables=all_vars)
+
         conditional = templar.template(conditional)
         if not isinstance(conditional, basestring) or conditional == "":
             return conditional
