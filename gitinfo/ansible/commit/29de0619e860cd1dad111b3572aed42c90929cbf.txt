commit 29de0619e860cd1dad111b3572aed42c90929cbf
Author: Matt Clay <matt@mystile.com>
Date:   Mon Mar 25 16:01:36 2019 -0700

    Fix nuage_vspk integration test:
    
    - Wait for API to be ready.
    - Enumerate test cases on controller.

diff --git a/test/integration/targets/nuage_vspk/defaults/main.yaml b/test/integration/targets/nuage_vspk/defaults/main.yaml
index 78266b65b9..366d2be231 100644
--- a/test/integration/targets/nuage_vspk/defaults/main.yaml
+++ b/test/integration/targets/nuage_vspk/defaults/main.yaml
@@ -1,6 +1,5 @@
 ---
 testcase: "*"
-test_items: []
 nuage_auth:
   api_username: csproot
   api_password: csproot
diff --git a/test/integration/targets/nuage_vspk/tasks/main.yml b/test/integration/targets/nuage_vspk/tasks/main.yml
index f3f7e046b3..37851a1403 100644
--- a/test/integration/targets/nuage_vspk/tasks/main.yml
+++ b/test/integration/targets/nuage_vspk/tasks/main.yml
@@ -1,19 +1,9 @@
 ---
 
 - block:
-    - name: collect all test cases
-      find:
-        paths: "{{ role_path }}/tests"
-        patterns: "{{ testcase }}.yaml"
-      delegate_to: localhost
-      register: test_cases
-
-    - name: set test_items
-      set_fact: test_items="{{ test_cases.files | map(attribute='path') | list }}"
-
     - name: run test case
       include: "{{ test_case_to_run }}"
-      with_items: "{{ test_items }}"
+      with_fileglob: "{{ role_path }}/tests/{{ testcase }}.yaml"
       loop_control:
         loop_var: test_case_to_run
   when: "ansible_python_version is version('2.7', '>=')"
diff --git a/test/integration/targets/prepare_nuage_tests/tasks/main.yml b/test/integration/targets/prepare_nuage_tests/tasks/main.yml
index 2c7214d293..f988342e5e 100644
--- a/test/integration/targets/prepare_nuage_tests/tasks/main.yml
+++ b/test/integration/targets/prepare_nuage_tests/tasks/main.yml
@@ -8,4 +8,9 @@
       shell: "(cd /; nuage-vsd-sim >/dev/null 2>&1 &)"
       async: 10
       poll: 0
+
+    - name: Wait for API to be ready
+      wait_for:
+        port: 5000
+
   when: "ansible_python_version is version('2.7', '>=')"
