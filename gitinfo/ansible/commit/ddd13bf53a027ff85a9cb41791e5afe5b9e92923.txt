commit ddd13bf53a027ff85a9cb41791e5afe5b9e92923
Author: bdowling <bdowling@users.noreply.github.com>
Date:   Mon Nov 7 19:48:43 2016 -0600

    ios_mods - added stdout to exception output. Removed to_lines() (#5428)
    
    stdout lines are now available when certain exceptions occur
    (Ref ansible/ansible#18241)
    
    Also noticed that to_lines was essentially handled in
    lib/ansible/plugins/action/__init__.py -- only difference was
    it didn't handle a list.  to_lines() could be removed across
    network modules now, but this commit is only for ios_command.
    
    Also adds disconnect() to ios_command that was added
    to ios_config in #5247

diff --git a/lib/ansible/modules/network/ios/ios_command.py b/lib/ansible/modules/network/ios/ios_command.py
index 4204a73a68..c5923e4e2b 100644
--- a/lib/ansible/modules/network/ios/ios_command.py
+++ b/lib/ansible/modules/network/ios/ios_command.py
@@ -148,12 +148,6 @@ from ansible.module_utils.six import string_types
 
 VALID_KEYS = ['command', 'prompt', 'response']
 
-def to_lines(stdout):
-    for item in stdout:
-        if isinstance(item, string_types):
-            item = str(item).split('\n')
-        yield item
-
 def parse_commands(module):
     for cmd in module.params['commands']:
         if isinstance(cmd, string_types):
@@ -216,7 +210,9 @@ def main():
         module.fail_json(msg=str(exc), failed_conditions=exc.failed_conditions)
     except NetworkError:
         exc = get_exception()
-        module.fail_json(msg=str(exc))
+        module.disconnect()
+        module.fail_json(msg=str(exc), stdout=exc.kwargs.get('stdout'))
+
 
     result = dict(changed=False, stdout=list())
 
@@ -228,7 +224,6 @@ def main():
         result['stdout'].append(output)
 
     result['warnings'] = warnings
-    result['stdout_lines'] = list(to_lines(result['stdout']))
 
     module.exit_json(**result)
 
diff --git a/lib/ansible/modules/network/ios/ios_config.py b/lib/ansible/modules/network/ios/ios_config.py
index 26a318de37..f7a2d5e675 100644
--- a/lib/ansible/modules/network/ios/ios_config.py
+++ b/lib/ansible/modules/network/ios/ios_config.py
@@ -367,7 +367,7 @@ def main():
     except NetworkError:
         exc = get_exception()
         module.disconnect()
-        module.fail_json(msg=str(exc))
+        module.fail_json(msg=str(exc), stdout=exc.kwargs.get('stdout'))
 
     module.disconnect()
     module.exit_json(**result)
