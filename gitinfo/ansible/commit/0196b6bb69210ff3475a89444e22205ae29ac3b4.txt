commit 0196b6bb69210ff3475a89444e22205ae29ac3b4
Author: Abhijeet Kasurde <akasurde@redhat.com>
Date:   Tue Jan 16 18:04:37 2018 +0530

    ce_engine: Refactor check_ip_addr (#34126)
    
    Signed-off-by: Abhijeet Kasurde <akasurde@redhat.com>

diff --git a/lib/ansible/modules/network/cloudengine/ce_bfd_global.py b/lib/ansible/modules/network/cloudengine/ce_bfd_global.py
index b3a768ca1e..76584086a0 100644
--- a/lib/ansible/modules/network/cloudengine/ce_bfd_global.py
+++ b/lib/ansible/modules/network/cloudengine/ce_bfd_global.py
@@ -195,7 +195,7 @@ import sys
 import socket
 from xml.etree import ElementTree
 from ansible.module_utils.basic import AnsibleModule
-from ansible.module_utils.network.cloudengine.ce import get_nc_config, set_nc_config, ce_argument_spec
+from ansible.module_utils.network.cloudengine.ce import get_nc_config, set_nc_config, ce_argument_spec, check_ip_addr
 
 CE_NC_GET_BFD = """
     <filter type="subtree">
@@ -219,24 +219,6 @@ CE_NC_GET_BFD_GLB = """
 """
 
 
-def check_ip_addr(ipaddr):
-    """check ip address, Supports IPv4 and IPv6"""
-
-    if not ipaddr or '\x00' in ipaddr:
-        return False
-
-    try:
-        res = socket.getaddrinfo(ipaddr, 0, socket.AF_UNSPEC,
-                                 socket.SOCK_STREAM,
-                                 0, socket.AI_NUMERICHOST)
-        return bool(res)
-    except socket.gaierror:
-        err = sys.exc_info()[1]
-        if err.args[0] == socket.EAI_NONAME:
-            return False
-        raise
-
-
 def check_default_ip(ipaddr):
     """check the default multicast IP address"""
 
diff --git a/lib/ansible/modules/network/cloudengine/ce_bfd_session.py b/lib/ansible/modules/network/cloudengine/ce_bfd_session.py
index 1f8757f50e..8f06e420ba 100644
--- a/lib/ansible/modules/network/cloudengine/ce_bfd_session.py
+++ b/lib/ansible/modules/network/cloudengine/ce_bfd_session.py
@@ -180,7 +180,7 @@ import sys
 import socket
 from xml.etree import ElementTree
 from ansible.module_utils.basic import AnsibleModule
-from ansible.module_utils.network.cloudengine.ce import get_nc_config, set_nc_config, ce_argument_spec
+from ansible.module_utils.network.cloudengine.ce import get_nc_config, set_nc_config, ce_argument_spec, check_ip_addr
 
 
 CE_NC_GET_BFD = """
@@ -229,26 +229,6 @@ def is_valid_ip_vpn(vpname):
     return True
 
 
-def check_ip_addr(ipaddr):
-    """check ip address, Supports IPv4 and IPv6"""
-
-    if not ipaddr or '\x00' in ipaddr:
-        return False
-
-    try:
-        res = socket.getaddrinfo(ipaddr, 0, socket.AF_UNSPEC,
-                                 socket.SOCK_STREAM,
-                                 0, socket.AI_NUMERICHOST)
-        return bool(res)
-    except socket.gaierror:
-        err = sys.exc_info()[1]
-        if err.args[0] == socket.EAI_NONAME:
-            return False
-        raise
-
-    return True
-
-
 def check_default_ip(ipaddr):
     """check the default multicast IP address"""
 
