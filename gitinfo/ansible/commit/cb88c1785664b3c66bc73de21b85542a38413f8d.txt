commit cb88c1785664b3c66bc73de21b85542a38413f8d
Author: Trond Hindenes <trond@hindenes.com>
Date:   Wed Sep 23 20:49:26 2015 +0200

    win_chocolatey bugfixes

diff --git a/lib/ansible/modules/extras/windows/win_chocolatey.ps1 b/lib/ansible/modules/extras/windows/win_chocolatey.ps1
index 4a033d2315..ce006fff15 100644
--- a/lib/ansible/modules/extras/windows/win_chocolatey.ps1
+++ b/lib/ansible/modules/extras/windows/win_chocolatey.ps1
@@ -16,7 +16,6 @@
 # You should have received a copy of the GNU General Public License
 # along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
 
-$ErrorActionPreference = "Stop"
 
 # WANT_JSON
 # POWERSHELL_COMMON
@@ -25,72 +24,21 @@ $params = Parse-Args $args;
 $result = New-Object PSObject;
 Set-Attr $result "changed" $false;
 
-If ($params.name)
-{
-    $package = $params.name
-}
-Else
-{
-    Fail-Json $result "missing required argument: name"
-}
-
-If ($params.force)
-{
-    $force = $params.force | ConvertTo-Bool
-}
-Else
-{
-    $force = $false
-}
+$package = Get-Attr -obj $params -name name -failifempty $true -emptyattributefailmessage "missing required argument: name"
+$force = Get-Attr -obj $params -name force -default "false" | ConvertTo-Bool
+$upgrade = Get-Attr -obj $params -name upgrade -default "false" | ConvertTo-Bool
+$version = Get-Attr -obj $params -name version -default $null
 
-If ($params.upgrade)
-{
-    $upgrade = $params.upgrade | ConvertTo-Bool
-}
-Else
-{
-    $upgrade = $false
-}
+$source = Get-Attr -obj $params -name source -default $null
+if ($source) {$source = $source.Tolower()}
 
-If ($params.version)
-{
-    $version = $params.version
-}
-Else
+$showlog = Get-Attr -obj $params -name showlog -default "false" | ConvertTo-Bool
+$state = Get-Attr -obj $params -name state -default "present"
+if ("present","absent" -notcontains $state)
 {
-    $version = $null
+    Fail-Json $result "state is $state; must be present or absent"
 }
 
-If ($params.source)
-{
-    $source = $params.source.ToString().ToLower()
-}
-Else
-{
-    $source = $null
-}
-
-If ($params.showlog)
-{
-    $showlog = $params.showlog | ConvertTo-Bool
-}
-Else
-{
-    $showlog = $null
-}
-
-If ($params.state)
-{
-    $state = $params.state.ToString().ToLower()
-    If (($state -ne "present") -and ($state -ne "absent"))
-    {
-        Fail-Json $result "state is $state; must be present or absent"
-    }
-}
-Else
-{
-    $state = "present"
-}
 
 Function Chocolatey-Install-Upgrade
 {
