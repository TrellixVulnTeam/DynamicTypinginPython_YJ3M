commit c02fa7cfc9a2750251b8f3ea2d247638b2118d18
Author: fdupoux <fdupoux@users.sourceforge.net>
Date:   Sat May 9 14:06:58 2015 +0100

    Suppress prompts from lvcreate using --yes when LVM supports this option

diff --git a/lib/ansible/modules/extras/system/lvol.py b/lib/ansible/modules/extras/system/lvol.py
index 98395463ea..dc7239327e 100644
--- a/lib/ansible/modules/extras/system/lvol.py
+++ b/lib/ansible/modules/extras/system/lvol.py
@@ -85,6 +85,8 @@ import re
 
 decimal_point = re.compile(r"(\.|,)")
 
+def mkversion(major, minor, patch):
+    return (1000 * 1000 * int(major)) + (1000 * int(minor)) + int(patch)
 
 def parse_lvs(data):
     lvs = []
@@ -97,6 +99,17 @@ def parse_lvs(data):
     return lvs
 
 
+def get_lvm_version(module):
+    ver_cmd = module.get_bin_path("lvm", required=True)
+    rc, out, err = module.run_command("%s version" % (ver_cmd))
+    if rc != 0:
+        return None
+    m = re.search("LVM version:\s+(\d+)\.(\d+)\.(\d+).*(\d{4}-\d{2}-\d{2})", out)
+    if not m:
+        return None
+    return mkversion(m.group(1), m.group(2), m.group(3))
+
+
 def main():
     module = AnsibleModule(
         argument_spec=dict(
@@ -109,6 +122,13 @@ def main():
         supports_check_mode=True,
     )
 
+    # Determine if the "--yes" option should be used
+    version_found = get_lvm_version(module)
+    if version_found == None:
+        module.fail_json(msg="Failed to get LVM version number")
+    version_yesopt = mkversion(2, 2, 99) # First LVM with the "--yes" option
+    yesopt = "--yes" if version_found >= version_yesopt else ""
+
     vg = module.params['vg']
     lv = module.params['lv']
     size = module.params['size']
@@ -189,7 +209,7 @@ def main():
                 changed = True
             else:
                 lvcreate_cmd = module.get_bin_path("lvcreate", required=True)
-                rc, _, err = module.run_command("%s -n %s -%s %s%s %s" % (lvcreate_cmd, lv, size_opt, size, size_unit, vg))
+                rc, _, err = module.run_command("%s %s -n %s -%s %s%s %s" % (lvcreate_cmd, yesopt, lv, size_opt, size, size_unit, vg))
                 if rc == 0:
                     changed = True
                 else:
