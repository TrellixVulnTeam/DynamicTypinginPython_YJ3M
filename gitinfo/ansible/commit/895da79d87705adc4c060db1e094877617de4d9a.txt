commit 895da79d87705adc4c060db1e094877617de4d9a
Author: Guillaume Quintard <guillaume.quintard@gmail.com>
Date:   Mon Oct 20 10:09:46 2014 +0200

    Detect docker as virtualization_type
    
    New docker versions use "docker" in /proc/1/cgroup, which disturbs the
    virtualization_type detection. So, grep for docker, in addition of
    "lxc".

diff --git a/lib/ansible/module_utils/facts.py b/lib/ansible/module_utils/facts.py
index 8ec1b4f7c7..42b82301e9 100644
--- a/lib/ansible/module_utils/facts.py
+++ b/lib/ansible/module_utils/facts.py
@@ -2159,6 +2159,10 @@ class LinuxVirtual(Virtual):
 
         if os.path.exists('/proc/1/cgroup'):
             for line in open('/proc/1/cgroup').readlines():
+                if re.search('/docker/', line):
+                    self.facts['virtualization_type'] = 'docker'
+                    self.facts['virtualization_role'] = 'guest'
+                    return
                 if re.search('/lxc/', line):
                     self.facts['virtualization_type'] = 'lxc'
                     self.facts['virtualization_role'] = 'guest'
