commit 45e0f747026c5b6e29b2a32c78785ff970da5655
Author: Pavel BÅ™ezina <pbrezina@redhat.com>
Date:   Thu Jun 25 09:27:24 2020 +0200

    display: use stdout for column width (#70199)
    
    stdout may differ from stdin so it should be used to determine the column
    width, especially since it is the target file descriptor.

diff --git a/changelogs/fragments/display-stdout-column-width.yml b/changelogs/fragments/display-stdout-column-width.yml
new file mode 100644
index 0000000000..da0febc223
--- /dev/null
+++ b/changelogs/fragments/display-stdout-column-width.yml
@@ -0,0 +1,2 @@
+bugfixes:
+  - Ansible output now uses stdout to determine column width instead of stdin
diff --git a/lib/ansible/utils/display.py b/lib/ansible/utils/display.py
index 3914a51671..425c5b1d00 100644
--- a/lib/ansible/utils/display.py
+++ b/lib/ansible/utils/display.py
@@ -530,8 +530,8 @@ class Display(with_metaclass(Singleton, object)):
         return encoding
 
     def _set_column_width(self):
-        if os.isatty(0):
-            tty_size = unpack('HHHH', fcntl.ioctl(0, TIOCGWINSZ, pack('HHHH', 0, 0, 0, 0)))[1]
+        if os.isatty(1):
+            tty_size = unpack('HHHH', fcntl.ioctl(1, TIOCGWINSZ, pack('HHHH', 0, 0, 0, 0)))[1]
         else:
             tty_size = 0
         self.columns = max(79, tty_size - 1)
