commit 0249918c7b69d021d8a17c9ca263a111403c74f7
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Thu Mar 30 08:31:09 2017 -0700

    When outputting text to a file, convert to bytes first.
    
    Fixes #23137

diff --git a/docs/bin/generate_man.py b/docs/bin/generate_man.py
index d231b46232..f3615f63a0 100755
--- a/docs/bin/generate_man.py
+++ b/docs/bin/generate_man.py
@@ -1,11 +1,12 @@
 #!/usr/bin/env python
 
 import os
-import io
 import sys
 
 from jinja2 import Environment, FileSystemLoader
 
+from ansible.module_utils._text import to_bytes
+
 
 def get_options(optlist):
     ''' get actual options '''
@@ -124,6 +125,6 @@ if __name__ == '__main__':
 
         manpage = template.render(tvars)
         filename = '../man/man1/%s' % output[libname]
-        with io.open(filename, 'w') as f:
-            f.write(manpage)
+        with open(filename, 'wb') as f:
+            f.write(to_bytes(manpage))
             print("Wrote man docs to %s" % filename)
