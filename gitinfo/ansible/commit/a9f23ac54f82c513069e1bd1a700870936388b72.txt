commit a9f23ac54f82c513069e1bd1a700870936388b72
Author: Arata Notsu <notsu@virtualtech.jp>
Date:   Wed Jan 6 11:54:57 2016 +0900

    apt: export env vars before run dpkg
    
    Without this change, some trouble may occur when "deb" parameter
    is used as env vars controlling dpkg are not set. For example,
    installing a package that requires user input will never end since
    DEBIAN_FRONTEND=noninteractive is not set.
    
    So export env vars in APT_ENV_VARS before run dpkg, like in cases
    using apt-get/aptitude.

diff --git a/lib/ansible/modules/packaging/os/apt.py b/lib/ansible/modules/packaging/os/apt.py
index 3fe9c62c07..84a019ae20 100755
--- a/lib/ansible/modules/packaging/os/apt.py
+++ b/lib/ansible/modules/packaging/os/apt.py
@@ -443,6 +443,9 @@ def install_deb(m, debs, cache, force, install_recommends, dpkg_options):
         if force:
             options += " --force-all"
 
+        for (k,v) in APT_ENV_VARS.iteritems():
+            os.environ[k] = v
+
         cmd = "dpkg %s -i %s" % (options, " ".join(pkgs_to_install))
         rc, out, err = m.run_command(cmd)
         if "stdout" in retvals:
