commit ef357ed1f2adf1c962099ae9fafb10cfa653897a
Author: Daniel Hokka Zakrisson <daniel@hozac.com>
Date:   Wed Nov 21 23:42:24 2012 +0100

    Use the play's vars for the setup step
    
    Allows using -e ansible_ssh_port=foo and have it apply to all actions.

diff --git a/lib/ansible/playbook/__init__.py b/lib/ansible/playbook/__init__.py
index 00cf2d6dd4..b6f127b586 100644
--- a/lib/ansible/playbook/__init__.py
+++ b/lib/ansible/playbook/__init__.py
@@ -357,7 +357,7 @@ class PlayBook(object):
             forks=self.forks, module_path=self.module_path, timeout=self.timeout, remote_user=play.remote_user,
             remote_pass=self.remote_pass, remote_port=play.remote_port, private_key_file=self.private_key_file,
             setup_cache=self.SETUP_CACHE, callbacks=self.runner_callbacks, sudo=play.sudo, sudo_user=play.sudo_user,
-            transport=play.transport, sudo_pass=self.sudo_pass, is_playbook=True
+            transport=play.transport, sudo_pass=self.sudo_pass, is_playbook=True, module_vars=play.vars,
         ).run()
         self.stats.compute(setup_results, setup=True)
 
