commit db3e4c8c6500f5ccbd254959ff7c2c29a6d3077a
Author: Rene Moser <mail@renemoser.net>
Date:   Wed May 27 20:54:26 2015 +0200

    firewalld: remove BabyJSON
    
    See https://github.com/ansible/ansible-modules-extras/issues/430

diff --git a/lib/ansible/modules/extras/system/firewalld.py b/lib/ansible/modules/extras/system/firewalld.py
index 77cfc4b6bb..e16e4e4a9d 100644
--- a/lib/ansible/modules/extras/system/firewalld.py
+++ b/lib/ansible/modules/extras/system/firewalld.py
@@ -67,8 +67,8 @@ options:
     required: false
     default: 0
 notes:
-   - Not tested on any debian based system.
-requirements: [ firewalld >= 0.2.11 ]
+  - Not tested on any Debian based system.
+requirements: [ 'firewalld >= 0.2.11' ]
 author: '"Adam Miller (@maxamillion)" <maxamillion@fedoraproject.org>'
 '''
 
@@ -82,7 +82,6 @@ EXAMPLES = '''
 
 import os
 import re
-import sys
 
 try:
     import firewall.config
@@ -90,14 +89,9 @@ try:
 
     from firewall.client import FirewallClient
     fw = FirewallClient()
-    if not fw.connected:
-        raise Exception('failed to connect to the firewalld daemon')
+    HAS_FIREWALLD = True
 except ImportError:
-    print "failed=True msg='firewalld required for this module'"
-    sys.exit(1)
-except Exception, e:
-    print "failed=True msg='%s'" % str(e)
-    sys.exit(1)
+    HAS_FIREWALLD = False
 
 ################
 # port handling
@@ -223,6 +217,9 @@ def main():
         supports_check_mode=True
     )
 
+    if not HAS_FIREWALLD:
+        module.fail_json(msg='firewalld required for this module')
+
     ## Pre-run version checking
     if FW_VERSION < "0.2.11":
         module.fail_json(msg='unsupported version of firewalld, requires >= 2.0.11')
@@ -400,6 +397,4 @@ def main():
 #################################################
 # import module snippets
 from ansible.module_utils.basic import *
-
 main()
-
