commit 8382ed72005d251387de8cc8f867c49ebca79eee
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Apr 12 12:59:41 2017 -0400

    added test emulating #23180 use case

diff --git a/test/integration/targets/environment/test_environment.yml b/test/integration/targets/environment/test_environment.yml
index e72224ba76..e35a438582 100644
--- a/test/integration/targets/environment/test_environment.yml
+++ b/test/integration/targets/environment/test_environment.yml
@@ -2,7 +2,17 @@
   vars:
     - test1:
         key1: val1
+  environment:
+    PATH: '{{ansible_env.PATH + ":/lola"}}'
+    lola: 'ido'
   tasks:
+    - name: ensure special case with ansible_env is skipped but others still work
+      assert:
+        that:
+            - lookup('env', 'PATH') == ansible_env.PATH
+            - "'/lola' not in ansible_env.PATH"
+            - ansible_env.lola == 'ido'
+
     - name: check that envvar does not exist
       shell: echo $key1
       register: test_env
