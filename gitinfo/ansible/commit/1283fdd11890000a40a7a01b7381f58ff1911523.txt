commit 1283fdd11890000a40a7a01b7381f58ff1911523
Author: acaveroc <alejandro.cavero.c@gmail.com>
Date:   Wed Jun 17 10:37:47 2015 +0200

    Add port definition support for mysql_vars module

diff --git a/lib/ansible/modules/database/mysql/mysql_variables.py b/lib/ansible/modules/database/mysql/mysql_variables.py
index 0b0face032..753d37433e 100644
--- a/lib/ansible/modules/database/mysql/mysql_variables.py
+++ b/lib/ansible/modules/database/mysql/mysql_variables.py
@@ -52,6 +52,10 @@ options:
         description:
             - mysql host to connect
         required: False
+    login_port:
+        description:
+            - mysql port to connect
+        required: False
     login_unix_socket:
         description:
             - unix socket to connect mysql server
@@ -194,6 +198,7 @@ def main():
             login_user=dict(default=None),
             login_password=dict(default=None),
             login_host=dict(default="localhost"),
+            login_port=dict(default="3306"),
             login_unix_socket=dict(default=None),
             variable=dict(default=None),
             value=dict(default=None)
@@ -203,6 +208,7 @@ def main():
     user = module.params["login_user"]
     password = module.params["login_password"]
     host = module.params["login_host"]
+    port = module.params["login_port"]
     mysqlvar = module.params["variable"]
     value = module.params["value"]
     if not mysqldb_found:
@@ -227,9 +233,9 @@ def main():
         module.fail_json(msg="when supplying login arguments, both login_user and login_password must be provided")
     try:
         if module.params["login_unix_socket"]:
-            db_connection = MySQLdb.connect(host=module.params["login_host"], unix_socket=module.params["login_unix_socket"], user=login_user, passwd=login_password, db="mysql")
+            db_connection = MySQLdb.connect(host=module.params["login_host"], port=module.params["login_port"], unix_socket=module.params["login_unix_socket"], user=login_user, passwd=login_password, db="mysql")
         else:
-            db_connection = MySQLdb.connect(host=module.params["login_host"], user=login_user, passwd=login_password, db="mysql")
+            db_connection = MySQLdb.connect(host=module.params["login_host"], port=module.params["login_port"], user=login_user, passwd=login_password, db="mysql")
         cursor = db_connection.cursor()
     except Exception, e:
         module.fail_json(msg="unable to connect to database, check login_user and login_password are correct or ~/.my.cnf has the credentials")
