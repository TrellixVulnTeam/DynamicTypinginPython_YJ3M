commit 9050c7abebefa20b49fcce82e7cf3ee9e80dbd50
Author: Rene Moser <mail@renemoser.net>
Date:   Fri Nov 9 14:06:34 2018 +0100

    vultr_server_facts: add tests and changelog for firewall group fix in #48342 (#48411)

diff --git a/changelogs/fragments/48342-vultr_server_facts-fix-firewall-group.yml b/changelogs/fragments/48342-vultr_server_facts-fix-firewall-group.yml
new file mode 100644
index 0000000000..c7d40dcc23
--- /dev/null
+++ b/changelogs/fragments/48342-vultr_server_facts-fix-firewall-group.yml
@@ -0,0 +1,2 @@
+bugfixes:
+  - vultr_server_facts - fixed facts gathering fails if firewall is enabled.
diff --git a/test/legacy/roles/vultr_server_facts/tasks/main.yml b/test/legacy/roles/vultr_server_facts/tasks/main.yml
index f60d0c6d7c..95af65e7ee 100644
--- a/test/legacy/roles/vultr_server_facts/tasks/main.yml
+++ b/test/legacy/roles/vultr_server_facts/tasks/main.yml
@@ -19,12 +19,17 @@
     that:
     - ansible_facts.vultr_server_facts | count == 0
 
-- name: Create the server
+- name: setup firewall group
+  vultr_firewall_group:
+    name: test_vultr_server_facts
+
+- name: setup create the server
   vultr_server:
     name: '{{ vultr_server_name }}'
     os: '{{ vultr_server_os }}'
     plan: '{{ vultr_server_plan }}'
     region: '{{ vultr_server_region }}'
+    firewall_group: test_vultr_server_facts
 
 - name: test gather vultr server facts in check mode
   vultr_server_facts:
@@ -47,7 +52,12 @@
   pause:
     minutes: 5
 
-- name: Delete the server
+- name: cleanup the server
   vultr_server:
     name: '{{ vultr_server_name }}'
     state: absent
+
+- name: cleanup firewall group
+  vultr_firewall_group:
+    name: test_vultr_server_facts
+    state: absent
