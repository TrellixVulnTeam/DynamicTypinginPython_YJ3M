commit 2fe193034cdf96adee4235c0e7500cfcd51b7b2f
Author: Seth Vidal <skvidal@fedoraproject.org>
Date:   Tue Mar 27 13:58:49 2012 -0400

    fix up latest so it behaves like latest should
    if installed and updated available: apply update
    if not installed and available: install

diff --git a/library/yum b/library/yum
index a3b95d14ac..cf9a697edd 100755
--- a/library/yum
+++ b/library/yum
@@ -214,13 +214,17 @@ def ensure(my, state, pkgspec):
         return res
                 
     if state == 'latest':
-        if not [ pkg_to_dict(po) for 
-            po in my.doPackageLists(pkgnarrow='updates', patterns=[pkgspec]).updates ]:
+        updates = my.doPackageLists(pkgnarrow='updates', patterns=[pkgspec]).updates
+        avail =  my.doPackageLists(pkgnarrow='available', patterns=[pkgspec]).available
+        if not updates and not avail:
             # there nothing in updates matching this.
             return { 'changed':False,}
 
-        # we have something in updates
-        cmd = "yum -c %s -d1 -y update '%s'" % (yumconf, pkgspec)
+        # we have something in updates or available
+        if not updates:
+            cmd = "yum -c %s -d1 -y install '%s'" % (yumconf, pkgspec)
+        else:
+            cmd = "yum -c %s -d1 -y update '%s'" % (yumconf, pkgspec)
         rc, out, err = run_yum(cmd)
         # FIXME if it is - update it and check to see if it applied
         # check to see if there is no longer an update available for the pkgspec
