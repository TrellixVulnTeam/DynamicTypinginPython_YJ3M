commit 07d9366ed8acca3a94b2f5facec1fbf157920179
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Mar 20 10:56:35 2017 -0400

    added 'existing' back
    
    fixes #22785

diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py
index f3230e1375..448154cb7b 100644
--- a/lib/ansible/module_utils/basic.py
+++ b/lib/ansible/module_utils/basic.py
@@ -1142,6 +1142,8 @@ class AnsibleModule(object):
             b_path = os.path.expanduser(os.path.expandvars(b_path))
         path = to_text(b_path, errors='surrogate_then_strict')
 
+        existing = self.get_file_attributes(b_path)
+
         if existing.get('attr_flags','') != attributes:
             attrcmd = self.get_bin_path('chattr')
             if attrcmd:
