commit 0b0ca9573185c10849ca9b820637b217303821d8
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Wed Mar 12 10:10:45 2014 -0400

    Expand environment variables and tildes passed to commands generically across the board.

diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py
index 6e47dd4560..8bdfb0b976 100644
--- a/lib/ansible/module_utils/basic.py
+++ b/lib/ansible/module_utils/basic.py
@@ -1018,6 +1018,9 @@ class AnsibleModule(object):
             msg = "Argument 'args' to run_command must be list or string"
             self.fail_json(rc=257, cmd=args, msg=msg)
 
+        # expand things like $HOME and ~
+        args = [ os.path.expandvars(os.path.expanduser(x)) for x in args ]
+
         rc = 0
         msg = None
         st_in = None
