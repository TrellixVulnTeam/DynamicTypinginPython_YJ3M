commit 15e9f1e15a3a9c25bfc374766f962ab1cb6ea86c
Author: Matt Wright <mdw1980@gmail.com>
Date:   Wed Aug 8 10:46:23 2012 -0400

    Update per ansible/ansible#794

diff --git a/library/apt_repository b/library/apt_repository
index 1f8591bcbb..675439d004 100755
--- a/library/apt_repository
+++ b/library/apt_repository
@@ -1,4 +1,27 @@
 #!/usr/bin/python
+# -*- coding: utf-8 -*-
+
+# (c) 2012, Matt Wright <matt@nobien.net>
+#
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+#
+# Example:
+# - name: add nginx repo
+#   action: apt_repository repo=ppa:nginx/stable state=present
+#
 
 import platform
 
@@ -32,8 +55,6 @@ def main():
 
     module = AnsibleModule(argument_spec=arg_spec)
 
-    global ADD_APT_REPOSITORY
-
     ADD_APT_REPOSITORY = _find_binary()
 
     repo = module.params['repo']
@@ -44,9 +65,9 @@ def main():
 
     if state == 'absent':
         if not existed:
-            module.exit_json(changed=False, repo=repo)
+            module.exit_json(changed=False, repo=repo, state=state)
         else:
-            module.exit_json(changed=True, repo=repo)
+            module.exit_json(changed=True, repo=repo, state=state)
 
     cmd = '%s %s' % (ADD_APT_REPOSITORY, repo)
 
@@ -61,9 +82,9 @@ def main():
         module.fail_json(msg=err)
 
     if changed:
-        _run('%s update' % APT)
+        rc, out, err = _run('%s update' % APT)
 
-    module.exit_json(changed=changed, existed=existed, repo=repo, cmd=cmd)
+    module.exit_json(changed=changed, repo=repo, state=state)
 
 # this is magic, see lib/ansible/module_common.py
 #<<INCLUDE_ANSIBLE_MODULE_COMMON>>
