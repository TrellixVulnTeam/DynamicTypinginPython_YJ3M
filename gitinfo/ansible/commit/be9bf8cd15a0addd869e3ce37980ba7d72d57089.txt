commit be9bf8cd15a0addd869e3ce37980ba7d72d57089
Author: Andrey Klychkov <aaklychkov@mail.ru>
Date:   Fri Sep 20 14:47:13 2019 +0300

    postgresql: move CI test of *_publication, *_ext, *_slot to separate targets (#62646)

diff --git a/test/integration/targets/postgresql/aliases b/test/integration/targets/postgresql/aliases
index 13148010dd..f33cab1a6a 100644
--- a/test/integration/targets/postgresql/aliases
+++ b/test/integration/targets/postgresql/aliases
@@ -1,15 +1,12 @@
 destructive
 shippable/posix/group4
 postgresql_db
-postgresql_ext
 postgresql_lang
 postgresql_pg_hba
 postgresql_privs
-postgresql_publication
 postgresql_schema
 postgresql_sequence
 postgresql_set
-postgresql_slot
 postgresql_table
 postgresql_user
 skip/osx
diff --git a/test/integration/targets/postgresql/tasks/main.yml b/test/integration/targets/postgresql/tasks/main.yml
index 0a9b53bff8..73172e789d 100644
--- a/test/integration/targets/postgresql/tasks/main.yml
+++ b/test/integration/targets/postgresql/tasks/main.yml
@@ -10,20 +10,7 @@
   - ansible_os_family == 'Debian'
   - postgres_version_resp.stdout is version('9.4', '>=')
 
-# Test postgresql_publication
-- import_tasks: postgresql_publication.yml
-  when: postgres_version_resp.stdout is version('10', '>=')
-
-- include_tasks: '{{ loop_item }}'
-  loop:
-  # Test postgresql_set
-  - postgresql_set.yml
-
-  # Test postgresql_slot module.
-  # Physical replication slots are available from PostgreSQL 9.4
-  - postgresql_slot.yml
-  loop_control:
-    loop_var: loop_item
+- include_tasks: postgresql_set.yml
   when: postgres_version_resp.stdout is version('9.4', '>=')
 
 - include_tasks: '{{ loop_item }}'
@@ -59,21 +46,6 @@
 - import_tasks: postgresql_sequence.yml
   when: postgres_version_resp.stdout is version('9.0', '>=')
 
-# Test postgresql_ext.
-# pg_extension system view is available from PG 9.1.
-# The tests are restricted by Fedora because there will be errors related with
-# attempts to change the environment during postgis installation or
-# missing postgis package in repositories.
-# Anyway, these tests completely depend on Postgres version,
-# not specific distributions.
-- import_tasks: postgresql_ext.yml
-  when:
-  - postgres_version_resp.stdout is version('9.1', '>=')
-  - ansible_distribution == 'Fedora'
-
-- import_tasks: postgresql_ext_version_opt.yml
-  when: ansible_distribution == 'Ubuntu'
-
 # Test postgresql_lang module.
 # To implement tests, it needs to install some additional packages
 # that may cause problems on different distributions,
diff --git a/test/integration/targets/postgresql_ext/aliases b/test/integration/targets/postgresql_ext/aliases
new file mode 100644
index 0000000000..a5f4ec632c
--- /dev/null
+++ b/test/integration/targets/postgresql_ext/aliases
@@ -0,0 +1,4 @@
+destructive
+shippable/posix/group4
+postgresql_ext
+skip/osx
diff --git a/test/integration/targets/postgresql_ext/meta/main.yml b/test/integration/targets/postgresql_ext/meta/main.yml
new file mode 100644
index 0000000000..f3345cb615
--- /dev/null
+++ b/test/integration/targets/postgresql_ext/meta/main.yml
@@ -0,0 +1,3 @@
+---
+dependencies:
+- setup_postgresql_db
diff --git a/test/integration/targets/postgresql_ext/tasks/main.yml b/test/integration/targets/postgresql_ext/tasks/main.yml
new file mode 100644
index 0000000000..d11dc6a83b
--- /dev/null
+++ b/test/integration/targets/postgresql_ext/tasks/main.yml
@@ -0,0 +1,19 @@
+# Initial CI tests of postgresql_ext module.
+# pg_extension system view is available from PG 9.1.
+# The tests are restricted by Fedora because there will be errors related with
+# attempts to change the environment during postgis installation or
+# missing postgis package in repositories.
+# Anyway, these tests completely depend on Postgres version,
+# not specific distributions.
+- import_tasks: postgresql_ext_initial.yml
+  when:
+  - postgres_version_resp.stdout is version('9.1', '>=')
+  - ansible_distribution == 'Fedora'
+
+# CI tests of "version" option.
+# It uses a mock extension, see test/integration/targets/setup_postgresql_db/.
+# TODO: change postgresql_ext_initial.yml to use the mock extension too.
+- import_tasks: postgresql_ext_version_opt.yml
+  when:
+  - ansible_distribution == 'Ubuntu'
+  - postgres_version_resp.stdout is version('9.1', '>=')
diff --git a/test/integration/targets/postgresql/tasks/postgresql_ext.yml b/test/integration/targets/postgresql_ext/tasks/postgresql_ext_initial.yml
similarity index 100%
rename from test/integration/targets/postgresql/tasks/postgresql_ext.yml
rename to test/integration/targets/postgresql_ext/tasks/postgresql_ext_initial.yml
diff --git a/test/integration/targets/postgresql/tasks/postgresql_ext_version_opt.yml b/test/integration/targets/postgresql_ext/tasks/postgresql_ext_version_opt.yml
similarity index 100%
rename from test/integration/targets/postgresql/tasks/postgresql_ext_version_opt.yml
rename to test/integration/targets/postgresql_ext/tasks/postgresql_ext_version_opt.yml
diff --git a/test/integration/targets/postgresql_publication/aliases b/test/integration/targets/postgresql_publication/aliases
new file mode 100644
index 0000000000..c2110e0a3b
--- /dev/null
+++ b/test/integration/targets/postgresql_publication/aliases
@@ -0,0 +1,4 @@
+destructive
+shippable/posix/group4
+postgresql_publication
+skip/osx
diff --git a/test/integration/targets/postgresql_publication/meta/main.yml b/test/integration/targets/postgresql_publication/meta/main.yml
new file mode 100644
index 0000000000..f3345cb615
--- /dev/null
+++ b/test/integration/targets/postgresql_publication/meta/main.yml
@@ -0,0 +1,3 @@
+---
+dependencies:
+- setup_postgresql_db
diff --git a/test/integration/targets/postgresql_publication/tasks/main.yml b/test/integration/targets/postgresql_publication/tasks/main.yml
new file mode 100644
index 0000000000..8743a0d3fa
--- /dev/null
+++ b/test/integration/targets/postgresql_publication/tasks/main.yml
@@ -0,0 +1,3 @@
+# Initial CI tests of postgresql_publication module
+- import_tasks: postgresql_publication_initial.yml
+  when: postgres_version_resp.stdout is version('10', '>=')
diff --git a/test/integration/targets/postgresql/tasks/postgresql_publication.yml b/test/integration/targets/postgresql_publication/tasks/postgresql_publication_initial.yml
similarity index 100%
rename from test/integration/targets/postgresql/tasks/postgresql_publication.yml
rename to test/integration/targets/postgresql_publication/tasks/postgresql_publication_initial.yml
diff --git a/test/integration/targets/postgresql_slot/aliases b/test/integration/targets/postgresql_slot/aliases
new file mode 100644
index 0000000000..17e12dc781
--- /dev/null
+++ b/test/integration/targets/postgresql_slot/aliases
@@ -0,0 +1,4 @@
+destructive
+shippable/posix/group4
+postgresql_slot
+skip/osx
diff --git a/test/integration/targets/postgresql_slot/meta/main.yml b/test/integration/targets/postgresql_slot/meta/main.yml
new file mode 100644
index 0000000000..f3345cb615
--- /dev/null
+++ b/test/integration/targets/postgresql_slot/meta/main.yml
@@ -0,0 +1,3 @@
+---
+dependencies:
+- setup_postgresql_db
diff --git a/test/integration/targets/postgresql_slot/tasks/main.yml b/test/integration/targets/postgresql_slot/tasks/main.yml
new file mode 100644
index 0000000000..f7d3558652
--- /dev/null
+++ b/test/integration/targets/postgresql_slot/tasks/main.yml
@@ -0,0 +1,4 @@
+# Initial CI tests of postgresql_slot module
+# Physical replication slots are available since PostgreSQL 9.4
+- import_tasks: postgresql_slot_initial.yml
+  when: postgres_version_resp.stdout is version('9.4', '>=')
diff --git a/test/integration/targets/postgresql/tasks/postgresql_slot.yml b/test/integration/targets/postgresql_slot/tasks/postgresql_slot_initial.yml
similarity index 100%
rename from test/integration/targets/postgresql/tasks/postgresql_slot.yml
rename to test/integration/targets/postgresql_slot/tasks/postgresql_slot_initial.yml
