commit 8039ceee0f38f5e6232960b89b396bb07042731d
Author: James Cammarata <jimi@sngx.net>
Date:   Wed Feb 3 18:42:06 2016 -0500

    Tweak block integration tests to also test the free strategy

diff --git a/test/integration/Makefile b/test/integration/Makefile
index 28f7224eb9..be1e153d17 100644
--- a/test/integration/Makefile
+++ b/test/integration/Makefile
@@ -130,9 +130,13 @@ test_tags:
 blocks:
 	# remove old output log
 	rm -f block_test.out
-	# run test
+	# run the test and check to make sure the right number of completions was logged
 	ansible-playbook -vv test_blocks/main.yml | tee block_test.out
-	# ensure each test ran
+	[ "$$(grep 'TEST COMPLETE' block_test.out | wc -l)" == "$$(egrep '^[0-9]+ plays in' block_test.out | cut -f1 -d' ')" ]
+	# cleanup the output log again, to make sure the test is clean
+	rm -f block_test.out
+	# run test with free strategy and again count the completions
+	ansible-playbook -vv test_blocks/main.yml -e test_strategy=free | tee block_test.out
 	[ "$$(grep 'TEST COMPLETE' block_test.out | wc -l)" == "$$(egrep '^[0-9]+ plays in' block_test.out | cut -f1 -d' ')" ]
 
 cloud: amazon rackspace azure
diff --git a/test/integration/test_blocks/main.yml b/test/integration/test_blocks/main.yml
index 1e0641ba00..cb6fc66600 100644
--- a/test/integration/test_blocks/main.yml
+++ b/test/integration/test_blocks/main.yml
@@ -1,6 +1,7 @@
 - name: simple block test
   hosts: localhost
   gather_facts: yes
+  strategy: "{{test_strategy|default('linear')}}"
   vars:
     block_tasks_run: false
     block_rescue_run: false
@@ -60,6 +61,7 @@
 - name: block with includes
   hosts: localhost
   gather_facts: yes
+  strategy: "{{test_strategy|default('linear')}}"
   vars:
     rescue_run_after_include_fail: false
     always_run_after_include_fail_in_rescue: false
