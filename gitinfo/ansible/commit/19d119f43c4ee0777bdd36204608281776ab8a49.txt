commit 19d119f43c4ee0777bdd36204608281776ab8a49
Author: Martin Krizek <martin.krizek@gmail.com>
Date:   Mon Jul 31 15:15:15 2017 +0200

    Pass server_hostname from task to subscription-manager (#27420)

diff --git a/lib/ansible/modules/packaging/os/redhat_subscription.py b/lib/ansible/modules/packaging/os/redhat_subscription.py
index 0c20afc6f1..c2b472f7c5 100644
--- a/lib/ansible/modules/packaging/os/redhat_subscription.py
+++ b/lib/ansible/modules/packaging/os/redhat_subscription.py
@@ -344,7 +344,7 @@ class Rhsm(RegistrationBase):
 
     def register(self, username, password, autosubscribe, activationkey, org_id,
                  consumer_type, consumer_name, consumer_id, force_register, environment,
-                 rhsm_baseurl, server_insecure):
+                 rhsm_baseurl, server_insecure, server_hostname):
         '''
             Register the current system to the provided RHSM or Sat6 server
             Raises:
@@ -362,6 +362,9 @@ class Rhsm(RegistrationBase):
         if server_insecure:
             args.extend(['--insecure'])
 
+        if server_hostname:
+            args.extend(['--serverurl', server_hostname])
+
         if activationkey:
             args.extend(['--activationkey', activationkey])
             args.extend(['--org', org_id])
@@ -725,7 +728,7 @@ def main():
                 rhsm.configure(**module.params)
                 rhsm.register(username, password, autosubscribe, activationkey, org_id,
                               consumer_type, consumer_name, consumer_id, force_register,
-                              environment, rhsm_baseurl, server_insecure)
+                              environment, rhsm_baseurl, server_insecure, server_hostname)
                 if pool_ids:
                     subscribed_pool_ids = rhsm.subscribe_by_pool_ids(pool_ids)
                 else:
