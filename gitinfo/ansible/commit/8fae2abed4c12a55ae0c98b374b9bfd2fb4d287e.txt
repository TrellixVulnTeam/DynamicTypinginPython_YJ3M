commit 8fae2abed4c12a55ae0c98b374b9bfd2fb4d287e
Author: James Cammarata <jimi@sngx.net>
Date:   Tue May 5 13:41:32 2015 -0500

    Properly fail out of the task loop in the linear strategy on failures (v2)

diff --git a/lib/ansible/executor/playbook_executor.py b/lib/ansible/executor/playbook_executor.py
index 2d5958697b..5d72ef15bd 100644
--- a/lib/ansible/executor/playbook_executor.py
+++ b/lib/ansible/executor/playbook_executor.py
@@ -117,15 +117,17 @@ class PlaybookExecutor:
                             if len(batch) == 0:
                                 self._tqm.send_callback('v2_playbook_on_play_start', new_play)
                                 self._tqm.send_callback('v2_playbook_on_no_hosts_matched')
-                                result = 0
+                                result = 1
                                 break
                             # restrict the inventory to the hosts in the serialized batch
                             self._inventory.restrict_to_hosts(batch)
                             # and run it...
                             result = self._tqm.run(play=play)
+                            # if the last result wasn't zero, break out of the serial batch loop
                             if result != 0:
                                 break
 
+                        # if the last result wasn't zero, break out of the play loop
                         if result != 0:
                             break
 
@@ -134,6 +136,10 @@ class PlaybookExecutor:
                 if entry:
                     entrylist.append(entry) # per playbook
 
+                # if the last result wasn't zero, break out of the playbook file name loop
+                if result != 0:
+                    break
+
             if entrylist:
                 return entrylist
 
diff --git a/lib/ansible/plugins/strategies/linear.py b/lib/ansible/plugins/strategies/linear.py
index 95ecac1451..bd510dc557 100644
--- a/lib/ansible/plugins/strategies/linear.py
+++ b/lib/ansible/plugins/strategies/linear.py
@@ -226,6 +226,9 @@ class StrategyModule(StrategyBase):
                 # FIXME: this should also be moved to the base class in a method
                 included_files = []
                 for res in host_results:
+                    if res.is_failed():
+                        return 1
+
                     if res._task.action == 'include':
                         if res._task.loop:
                             include_results = res._result['results']
diff --git a/samples/test_play_failure.yml b/samples/test_play_failure.yml
new file mode 100644
index 0000000000..b33fc2e757
--- /dev/null
+++ b/samples/test_play_failure.yml
@@ -0,0 +1,9 @@
+- hosts: localhost
+  gather_facts: no
+  tasks:
+  - fail:
+
+- hosts: localhost
+  gather_facts: no
+  tasks:
+  - debug: msg="you should not see me..."
