commit 98bf473cb299e5767b7af244a3090997e45186ff
Author: Les Aker <me@lesaker.org>
Date:   Mon Sep 16 17:19:39 2013 -0400

    fixes for PTY handling

diff --git a/lib/ansible/runner/connection_plugins/ssh.py b/lib/ansible/runner/connection_plugins/ssh.py
index 02d47e0b1e..4d1fe70e51 100644
--- a/lib/ansible/runner/connection_plugins/ssh.py
+++ b/lib/ansible/runner/connection_plugins/ssh.py
@@ -26,6 +26,7 @@ import fcntl
 import hmac
 import pwd
 import gettext
+import pty
 from hashlib import sha1
 import ansible.constants as C
 from ansible.callbacks import vvv
@@ -175,11 +176,11 @@ class Connection(object):
 
         try:
             # Make sure stdin is a proper (pseudo) pty to avoid: tcgetattr errors
-            import pty
             master, slave = pty.openpty()
             p = subprocess.Popen(ssh_cmd, stdin=slave,
                                  stdout=subprocess.PIPE, stderr=subprocess.PIPE)
             stdin = os.fdopen(master, 'w', 0)
+            os.close(slave)
         except:
             p = subprocess.Popen(ssh_cmd, stdin=subprocess.PIPE,
                                  stdout=subprocess.PIPE, stderr=subprocess.PIPE)
