commit ad652746437b4e7d225a9725a501ca1cdfd07969
Author: Matt Clay <matt@mystile.com>
Date:   Mon Jan 16 13:16:51 2017 -0800

    Only test map on jinja2 >= 2.7

diff --git a/test/integration/targets/filters/tasks/main.yml b/test/integration/targets/filters/tasks/main.yml
index a6f0f4f74d..3558c4e293 100644
--- a/test/integration/targets/filters/tasks/main.yml
+++ b/test/integration/targets/filters/tasks/main.yml
@@ -111,6 +111,9 @@
         - "31 == ['x','y']|map('extract',{'x':42,'y':31})|list|last"
         - "'local' == ['localhost']|map('extract',hostvars,'ansible_connection')|list|first"
         - "'local' == ['localhost']|map('extract',hostvars,['ansible_connection'])|list|first"
+  # map was added to jinja2 in version 2.7
+  when: "{{ ( lookup('pipe', 'pip show --disable-pip-version-check jinja2 | grep ^Version: | sed \"s/^Version: //\"') |
+              version_compare('2.7', '>=') ) }}"
 
 - name: Test json_query filter
   assert:
