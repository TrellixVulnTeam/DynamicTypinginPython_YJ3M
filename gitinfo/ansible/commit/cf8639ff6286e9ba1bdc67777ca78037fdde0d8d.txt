commit cf8639ff6286e9ba1bdc67777ca78037fdde0d8d
Author: Sam Doran <sdoran@ansible.com>
Date:   Mon Oct 24 13:35:00 2016 -0400

    Fish hacking setup fix (#18084)
    
    * Remove old egg-info files before creating new ones
    
    Currently, setup.py generates egg files then they are deleted. This change
    fixes this behavior and matches that in env-setup.
    
    * Do not try to move ansible*egg-info to lib/
    
    setup.py creates the ansible.egg-info in lib/ so this step is unnecessary. Matches env-setup behavior.
    
    * Better test for number of arguments in argv
    
    This prevents an erronous error message from being thrown since set -q returns an error code with the number of variables not defined, resulting in a non-zero exit if no arguments are passed.
    
    Indent case statement within switch statement.

diff --git a/hacking/env-setup.fish b/hacking/env-setup.fish
index 53d17b3235..a5fe291fe9 100644
--- a/hacking/env-setup.fish
+++ b/hacking/env-setup.fish
@@ -4,16 +4,16 @@
 set HACKING_DIR (dirname (status -f))
 set FULL_PATH (python -c "import os; print(os.path.realpath('$HACKING_DIR'))")
 set ANSIBLE_HOME (dirname $FULL_PATH)
-set PREFIX_PYTHONPATH $ANSIBLE_HOME/lib 
-set PREFIX_PATH $ANSIBLE_HOME/bin 
+set PREFIX_PYTHONPATH $ANSIBLE_HOME/lib
+set PREFIX_PATH $ANSIBLE_HOME/bin
 set PREFIX_MANPATH $ANSIBLE_HOME/docs/man
 
 # set quiet flag
-if set -q argv
+if test (count $argv) -ge 1
     switch $argv
-    case '-q' '--quiet'
-        set QUIET "true"
-    case '*'
+        case '-q' '--quiet'
+            set QUIET "true"
+        case '*'
     end
 end
 
@@ -49,15 +49,14 @@ set -gx ANSIBLE_LIBRARY $ANSIBLE_HOME/library
 
 # Generate egg_info so that pkg_resources works
 pushd $ANSIBLE_HOME
+if test -e $PREFIX_PYTHONPATH/ansible*.egg-info
+    rm -r $PREFIX_PYTHONPATH/ansible*.egg-info
+end
 if [ $QUIET ]
     python setup.py -q egg_info
 else
     python setup.py egg_info
 end
-if test -e $PREFIX_PYTHONPATH/ansible*.egg-info
-    rm -r $PREFIX_PYTHONPATH/ansible*.egg-info
-end
-mv ansible*egg-info $PREFIX_PYTHONPATH
 find . -type f -name "*.pyc" -delete
 popd
 
