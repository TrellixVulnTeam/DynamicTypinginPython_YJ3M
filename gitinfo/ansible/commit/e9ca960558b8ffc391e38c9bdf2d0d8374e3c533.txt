commit e9ca960558b8ffc391e38c9bdf2d0d8374e3c533
Author: Shaun Zinck <shaun.zinck@gmail.com>
Date:   Fri Jan 25 16:48:58 2013 -0600

    pkgin: use module.run_command to run stuff
    
    This also fixes an issue where some console output for packages I was
    installing was creating invalid JSON because it contained single-quotes.

diff --git a/library/pkgin b/library/pkgin
index acbc55e046..02fac16f27 100755
--- a/library/pkgin
+++ b/library/pkgin
@@ -63,7 +63,7 @@ def query_package(module, name, state="installed"):
 
     if state == "installed":
 
-        rc = os.system("%s list | grep ^%s" % (PKGIN_PATH, name))
+        (rc, stdout, stderr) = module.run_command("%s list | grep ^%s" % (PKGIN_PATH, name))
 
         if rc == 0:
             return True
@@ -80,7 +80,7 @@ def remove_packages(module, packages):
         if not query_package(module, package):
             continue
 
-        rc = os.system("%s -y remove %s" % (PKGIN_PATH, package))
+        module.run_command("%s -y remove %s" % (PKGIN_PATH, package))
 
         if query_package(module, package):
             module.fail_json(msg="failed to remove %s" % (package))
@@ -102,7 +102,7 @@ def install_packages(module, packages):
         if query_package(module, package):
             continue
 
-        rc = os.system("%s -y install %s" % (PKGIN_PATH, package))
+        module.run_command("%s -y install %s" % (PKGIN_PATH, package))
 
         if not query_package(module, package):
             module.fail_json(msg="failed to install %s" % (package))
