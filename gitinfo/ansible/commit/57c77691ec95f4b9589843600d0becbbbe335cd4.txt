commit 57c77691ec95f4b9589843600d0becbbbe335cd4
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Thu Dec 4 11:35:03 2014 -0800

    Add a check that tilde expansion with copy works

diff --git a/test/integration/roles/test_sudo/files/baz.txt b/test/integration/roles/test_sudo/files/baz.txt
new file mode 100644
index 0000000000..a69dd57604
--- /dev/null
+++ b/test/integration/roles/test_sudo/files/baz.txt
@@ -0,0 +1 @@
+testing tilde expansion with sudo
diff --git a/test/integration/roles/test_sudo/tasks/main.yml b/test/integration/roles/test_sudo/tasks/main.yml
index 0460486d0c..022e7d7422 100644
--- a/test/integration/roles/test_sudo/tasks/main.yml
+++ b/test/integration/roles/test_sudo/tasks/main.yml
@@ -19,6 +19,7 @@
 - assert:
     that:
       - "results.stat.exists == True"
+      - "results.stat.path|dirname|basename == '{{ sudo_test_user }}'"
 
 - name: tilde expansion honors sudo in template
   sudo: True
@@ -35,6 +36,24 @@
 - assert:
     that:
       - "results.stat.exists == True"
+      - "results.stat.path|dirname|basename == '{{ sudo_test_user }}'"
+
+- name: tilde expansion honors sudo in copy
+  sudo: True
+  sudo_user: "{{ sudo_test_user }}"
+  copy:
+    src: baz.txt
+    dest: "~/baz.txt"
+
+- name: check that the path in the user's home dir was created
+  stat:
+    path: "~{{ sudo_test_user }}/baz.txt"
+  register: results
+
+- assert:
+    that:
+      - "results.stat.exists == True"
+      - "results.stat.path|dirname|basename == '{{ sudo_test_user }}'"
 
 - name: Remove test user and their home dir
   user:
