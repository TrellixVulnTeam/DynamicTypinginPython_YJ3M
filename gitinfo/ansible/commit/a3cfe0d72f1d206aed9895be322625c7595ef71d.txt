commit a3cfe0d72f1d206aed9895be322625c7595ef71d
Author: Martin Krizek <martin.krizek@gmail.com>
Date:   Wed May 23 14:43:18 2018 +0200

    apt: don't markmanual if apt-mark is not installed (#40600)
    
    * apt: don't markmanual if apt-mark is not installed
    
    * Add warning

diff --git a/lib/ansible/modules/packaging/os/apt.py b/lib/ansible/modules/packaging/os/apt.py
index 2bb6712d81..717403be94 100644
--- a/lib/ansible/modules/packaging/os/apt.py
+++ b/lib/ansible/modules/packaging/os/apt.py
@@ -492,7 +492,13 @@ def mark_installed_manually(m, packages):
     if not packages:
         return
 
-    apt_mark_cmd_path = m.get_bin_path("apt-mark", required=True)
+    apt_mark_cmd_path = m.get_bin_path("apt-mark")
+
+    # https://github.com/ansible/ansible/issues/40531
+    if apt_mark_cmd_path is None:
+        m.warn("Could not find apt-mark binary, not marking package(s) as manually installed.")
+        return
+
     cmd = "%s manual %s" % (apt_mark_cmd_path, ' '.join(packages))
     rc, out, err = m.run_command(cmd)
 
