commit 495bd02dbf3b1438879cf0572e99561f17d26a45
Author: Chris Van Heuveln <cvanheuv@cisco.com>
Date:   Thu Mar 7 08:09:47 2019 -0500

    nxos_evpn_vni: exclude legacy N3k from sanity test (#53452)
    
    The test was only skipping N3K|N35, needs to also skip N3L (legacy n3048 chassis).

diff --git a/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml b/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
index 8d71ee8479..95d76bcf49 100644
--- a/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
+++ b/test/integration/targets/nxos_evpn_vni/tests/common/sanity.yaml
@@ -3,12 +3,15 @@
 - debug: msg="Using provider={{ connection.transport }}"
   when: ansible_connection == "local"
 
+- set_fact: nvoe_supported="{{ platform is not search('N3K|N3L|N35')}}"
+
 - name: "Setup"
   nxos_config: &remove_evpn
     lines: no nv overlay evpn
     match: none
     provider: "{{ connection }}"
   ignore_errors: yes
+  when: nvoe_supported
 
 - block:
   - name: "Enable feature BGP"
@@ -99,18 +102,21 @@
 
   - assert: *false
 
-  when: not (platform is search('N3K')) and not (platform is match('N35'))
+  when: nvoe_supported
 
-  always:
-  - name: "Remove nv overlay evpn"
-    nxos_config: *remove_evpn
-    ignore_errors: yes
 
-  - name: "Disable feature bgp"
-    nxos_feature:
-      feature: bgp
-      provider: "{{ connection }}"
-      state: disabled
-    ignore_errors: yes
+  always:
+  - block:
+    - name: "Remove nv overlay evpn"
+      nxos_config: *remove_evpn
+      ignore_errors: yes
+
+    - name: "Disable feature bgp"
+      nxos_feature:
+        feature: bgp
+        provider: "{{ connection }}"
+        state: disabled
+      ignore_errors: yes
+    when: nvoe_supported
 
 - debug: msg="END connection={{ ansible_connection }} nxos_evpn_vni sanity test"
