commit 62badd76a5adae504e1e669edf8893195d6dc8e7
Author: Jordan Borean <jborean93@gmail.com>
Date:   Thu Apr 18 15:06:45 2019 +1000

    win_service - simply env test (#55498)

diff --git a/test/integration/targets/win_service/tasks/main.yml b/test/integration/targets/win_service/tasks/main.yml
index 16cb5aef21..5d7a0c2bc1 100644
--- a/test/integration/targets/win_service/tasks/main.yml
+++ b/test/integration/targets/win_service/tasks/main.yml
@@ -51,12 +51,6 @@
     - TestServiceParent2
     - TestServiceDependency
 
-  - name: remove test environment variable
-    win_environment:
-      name: TEST_SERVICE_PATH
-      level: machine
-      state: absent
-
   - name: remove test directory
     win_file:
       path: '{{ test_win_service_dir }}'
diff --git a/test/integration/targets/win_service/tasks/tests.yml b/test/integration/targets/win_service/tasks/tests.yml
index 4ac320c9f2..05ada8094b 100644
--- a/test/integration/targets/win_service/tasks/tests.yml
+++ b/test/integration/targets/win_service/tasks/tests.yml
@@ -594,18 +594,13 @@
     - win_service_path_again is not changed
     - win_service_path_again.path == 'C:\\temp\\test.exe'
 
-- name: create test environment variable
-  win_environment:
-    name: TEST_SERVICE_PATH
-    value: C:\temp
-    level: machine
-    state: present
-
 - name: set service path with quotes and env var
   win_service:
     name: "{{test_win_service_name}}"
     path: '"%TEST_SERVICE_PATH%\test.exe"'
   register: win_service_env_quote_path
+  environment:
+    TEST_SERVICE_PATH: C:\temp
 
 - name: check that the quoted service path has been changed
   assert:
@@ -618,6 +613,8 @@
     name: "{{test_win_service_name}}"
     path: '"%TEST_SERVICE_PATH%\test.exe"'
   register: win_service_env_quote_path_again
+  environment:
+    TEST_SERVICE_PATH: C:\temp
 
 - name: check that the quoted service path has been changed again
   assert:
