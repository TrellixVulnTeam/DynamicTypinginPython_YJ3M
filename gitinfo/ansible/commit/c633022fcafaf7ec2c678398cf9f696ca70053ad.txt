commit c633022fcafaf7ec2c678398cf9f696ca70053ad
Author: Adrian Likins <alikins@redhat.com>
Date:   Wed Sep 14 13:27:42 2016 -0400

    [wip] Let jsonfile and memcached cache plugins understand fact_caching_timeout=0 (#17565)
    
    * Add support for no-expiration to jsonfile cache
    
    * Let memcached cache use fact_caching_timeout=0
    
    If fact_cache=memcached and fact_caching_timeout=0
    memcached would hit a NameError on _expire_keys

diff --git a/lib/ansible/plugins/cache/jsonfile.py b/lib/ansible/plugins/cache/jsonfile.py
index f2f42f3cc2..f13443d871 100644
--- a/lib/ansible/plugins/cache/jsonfile.py
+++ b/lib/ansible/plugins/cache/jsonfile.py
@@ -108,6 +108,9 @@ class CacheModule(BaseCacheModule):
 
     def has_expired(self, key):
 
+        if self._timeout == 0:
+            return False
+
         cachefile = "%s/%s" % (self._cache_dir, key)
         try:
             st = os.stat(cachefile)
diff --git a/lib/ansible/plugins/cache/memcached.py b/lib/ansible/plugins/cache/memcached.py
index 01fbefb07b..80a42a5b21 100644
--- a/lib/ansible/plugins/cache/memcached.py
+++ b/lib/ansible/plugins/cache/memcached.py
@@ -157,7 +157,7 @@ class CacheModule(BaseCacheModule):
     def _expire_keys(self):
         if self._timeout > 0:
             expiry_age = time.time() - self._timeout
-        self._keys.remove_by_timerange(0, expiry_age)
+            self._keys.remove_by_timerange(0, expiry_age)
 
     def get(self, key):
         value = self._cache.get(self._make_key(key))
