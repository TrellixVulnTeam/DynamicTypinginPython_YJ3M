commit 1f6edf7d76c66af0042dfc535b39785f2869dc19
Author: James Tanner <tanner.jc@gmail.com>
Date:   Fri Oct 25 13:46:41 2013 -0400

    Fixes #4665 and #4666 If task is conditional do not flatten items list for packaging modules

diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index 62c2c8a394..95b751f39e 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -442,10 +442,12 @@ class Runner(object):
             if type(items) != list:
                 raise errors.AnsibleError("lookup plugins have to return a list: %r" % items)
 
+            # hack for apt, yum, and pkgng so that with_items maps back into a single module call
             if len(items) and utils.is_list_of_strings(items) and self.module_name in [ 'apt', 'yum', 'pkgng' ]:
-                # hack for apt, yum, and pkgng so that with_items maps back into a single module call
-                inject['item'] = ",".join(items)
-                items = None
+                # only join the item/package names if this task is not conditional
+                if not self.conditional:
+                    inject['item'] = ",".join(items)
+                    items = None
 
         # logic to replace complex args if possible
         complex_args = self.complex_args
