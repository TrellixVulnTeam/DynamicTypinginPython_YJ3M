commit 248ca2df212eb8c16338c88c171dffa3bc2d0496
Author: Matt Clay <matt@mystile.com>
Date:   Tue Mar 20 16:44:57 2018 -0700

    Fix encoding of code-smell paths on stdin.

diff --git a/test/runner/lib/util.py b/test/runner/lib/util.py
index a12aa334bc..70676a2ead 100644
--- a/test/runner/lib/util.py
+++ b/test/runner/lib/util.py
@@ -327,7 +327,7 @@ def raw_command(cmd, capture=False, env=None, data=None, cwd=None, explain=False
 
     if communicate:
         encoding = 'utf-8'
-        data_bytes = data.encode(encoding) if data else None
+        data_bytes = data.encode(encoding, 'surrogateescape') if data else None
         stdout_bytes, stderr_bytes = process.communicate(data_bytes)
         stdout_text = stdout_bytes.decode(encoding, str_errors) if stdout_bytes else u''
         stderr_text = stderr_bytes.decode(encoding, str_errors) if stderr_bytes else u''
