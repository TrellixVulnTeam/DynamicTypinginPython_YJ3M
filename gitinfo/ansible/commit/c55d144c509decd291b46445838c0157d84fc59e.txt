commit c55d144c509decd291b46445838c0157d84fc59e
Author: Michael Vermaes <mvermaes@gmail.com>
Date:   Wed Jan 15 12:20:31 2014 +0800

    Fail yum on invalid url with .rpm suffix

diff --git a/library/packaging/yum b/library/packaging/yum
index 240f071b9f..b584638639 100644
--- a/library/packaging/yum
+++ b/library/packaging/yum
@@ -473,7 +473,7 @@ def install(module, items, repoq, yum_basecmd, conf_file, en_repos, dis_repos):
         rc, out, err = module.run_command(cmd)
 
         # Fail on invalid urls:
-        if '://' in spec and 'No package %s available.' % spec in out:
+        if (rc == 1 and '://' in spec and ('No package %s available.' % spec in out or 'Cannot open: %s. Skipping.' % spec in err)):
             err = 'Package at %s could not be installed' % spec
             module.fail_json(changed=False,msg=err,rc=1)
         elif (rc != 0 and 'Nothing to do' in err) or 'Nothing to do' in out:
