commit 8d5cebd59704cb33bf820eb96ee2fcd047cf3e52
Author: Hillel Antonov <dev.antonov.hillel@dev.bwater.com>
Date:   Tue Dec 15 10:43:33 2015 -0500

    Adding gathering environment variables to gather facts on Windows making similar in functionality to gather facts on Linux

diff --git a/lib/ansible/modules/windows/setup.ps1 b/lib/ansible/modules/windows/setup.ps1
index c60e8f3b9d..fcac689b1e 100644
--- a/lib/ansible/modules/windows/setup.ps1
+++ b/lib/ansible/modules/windows/setup.ps1
@@ -81,6 +81,16 @@ $ips = @()
 Foreach ($ip in $netcfg.IPAddress) { If ($ip) { $ips += $ip } }
 Set-Attr $result.ansible_facts "ansible_ip_addresses" $ips
 
+$env_vars = New-Object psobject
+foreach ($item in Get-ChildItem Env:)
+{
+    $name = $item | select -ExpandProperty Name
+    # Powershell ConvertTo-Json fails if string ends with \
+    $value = ($item | select -ExpandProperty Value).TrimEnd("\")
+    Set-Attr $env_vars $name $value
+}
+Set-Attr $result.ansible_facts "ansible_env" $env_vars
+
 $psversion = $PSVersionTable.PSVersion.Major
 Set-Attr $result.ansible_facts "ansible_powershell_version" $psversion
 
