commit d61b2ed0a3f7c8647fbf0b912c66711e95fc9127
Author: Matt Clay <matt@mystile.com>
Date:   Tue Nov 22 16:50:08 2016 -0800

    Support script interpreters for async_wrapper. (#18592)

diff --git a/lib/ansible/plugins/action/async.py b/lib/ansible/plugins/action/async.py
index e4c67371a1..e7c5661852 100644
--- a/lib/ansible/plugins/action/async.py
+++ b/lib/ansible/plugins/action/async.py
@@ -89,7 +89,15 @@ class ActionModule(ActionBase):
         async_limit = self._task.async
         async_jid   = str(random.randint(0, 999999999999))
 
-        async_cmd = [env_string, remote_async_module_path, async_jid, async_limit, remote_module_path]
+        # call the interpreter for async_wrapper directly
+        # this permits use of a script for an interpreter on non-Linux platforms
+        # TODO: re-implement async_wrapper as a regular module to avoid this special case
+        interpreter = shebang.replace('#!', '').strip()
+        async_cmd = [interpreter, remote_async_module_path, async_jid, async_limit, remote_module_path]
+
+        if env_string:
+            async_cmd.insert(0, env_string)
+
         if argsfile:
             async_cmd.append(argsfile)
         else:
