commit 4f642daae562b25452e2722ae05beae39866519e
Author: Joseph <joseph@josephbanks.me>
Date:   Fri Jul 5 16:03:24 2019 +0100

    Correct machinectl become plugin function arguments (#58734)
    
    * Correct get_option function name and change flags to become_flags
    
    * Remove the '--' from the returned command
    
    * add changelog fragment
    
    * change changelog fragment description
    
    * move the -q argument to machinectl before the shell argument to resolve issues with machinectl v230 (see #56571)

diff --git a/changelogs/fragments/58734-correct-machinectl-become-plugin.yaml b/changelogs/fragments/58734-correct-machinectl-become-plugin.yaml
new file mode 100644
index 0000000000..77e4955086
--- /dev/null
+++ b/changelogs/fragments/58734-correct-machinectl-become-plugin.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+  - machinectl become plugin - correct bugs which induced errors on plugin usage
diff --git a/lib/ansible/plugins/become/machinectl.py b/lib/ansible/plugins/become/machinectl.py
index d52aa65ff7..4e3a69f73b 100644
--- a/lib/ansible/plugins/become/machinectl.py
+++ b/lib/ansible/plugins/become/machinectl.py
@@ -81,7 +81,7 @@ class BecomeModule(BecomeBase):
         if not cmd:
             return cmd
 
-        become = self._get_option('become_exe') or self.name
-        flags = self.get_option('flags') or ''
+        become = self.get_option('become_exe') or self.name
+        flags = self.get_option('become_flags') or ''
         user = self.get_option('become_user') or ''
-        return '%s shell -q %s %s@ -- %s' % (become, flags, user, cmd)
+        return '%s -q shell %s %s@ %s' % (become, flags, user, cmd)
