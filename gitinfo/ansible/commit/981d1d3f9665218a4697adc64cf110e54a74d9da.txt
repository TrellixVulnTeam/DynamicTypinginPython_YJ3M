commit 981d1d3f9665218a4697adc64cf110e54a74d9da
Author: James Tanner <tanner.jc@gmail.com>
Date:   Fri Sep 23 14:09:53 2016 -0400

    vmware_guest: set the cpu and memory settings on clone (#3027)
    
    Fixes #3026

diff --git a/lib/ansible/modules/extras/cloud/vmware/vmware_guest.py b/lib/ansible/modules/extras/cloud/vmware/vmware_guest.py
index 0daac9c372..cfdb81692e 100644
--- a/lib/ansible/modules/extras/cloud/vmware/vmware_guest.py
+++ b/lib/ansible/modules/extras/cloud/vmware/vmware_guest.py
@@ -625,6 +625,17 @@ class PyVmomiHelper(object):
             configspec = vim.vm.ConfigSpec(deviceChange=[diskspec])
             clonespec_kwargs['config'] = configspec
 
+        # set cpu/memory/etc
+        if 'hardware' in self.params:
+            if not 'config' in clonespec_kwargs:
+                clonespec_kwargs['config'] = vim.vm.ConfigSpec()
+            if 'num_cpus' in self.params['hardware']:
+                clonespec_kwargs['config'].numCPUs = \
+                    int(self.params['hardware']['num_cpus'])
+            if 'memory_mb' in self.params['hardware']:
+                clonespec_kwargs['config'].memoryMB = \
+                    int(self.params['hardware']['memory_mb'])
+
         clonespec = vim.vm.CloneSpec(**clonespec_kwargs)
         task = template.Clone(folder=destfolder, name=self.params['name'], spec=clonespec)
         self.wait_for_task(task)
