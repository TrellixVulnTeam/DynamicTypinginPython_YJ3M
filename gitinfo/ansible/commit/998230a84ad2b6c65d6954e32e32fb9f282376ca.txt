commit 998230a84ad2b6c65d6954e32e32fb9f282376ca
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Wed Apr 10 16:40:49 2013 -0400

    Allow $foo and {{ bar }} to be used on the same line in playbooks.

diff --git a/lib/ansible/utils/template.py b/lib/ansible/utils/template.py
index 4158768787..282d790957 100644
--- a/lib/ansible/utils/template.py
+++ b/lib/ansible/utils/template.py
@@ -234,8 +234,7 @@ def template(basedir, varname, vars, lookup_fatal=True, depth=0, expand_lists=Tr
 
     if isinstance(varname, basestring):
         if '{{' in varname or '{%' in varname:
-            res = template_from_string(basedir, varname, vars)
-            return res
+            varname = template_from_string(basedir, varname, vars)
         m = _varFind(basedir, varname, vars, lookup_fatal, depth, expand_lists)
         if not m:
             return varname
