commit ae6d2a5602488e63f181e360e9b9c4d27c31d989
Author: Rene Moser <mail@renemoser.net>
Date:   Tue Feb 2 20:19:56 2016 +0100

    cloudstack: new integration tests test_cs_instance_facts

diff --git a/test/integration/cloudstack.yml b/test/integration/cloudstack.yml
index bc275ad3bb..9f64f9ec94 100644
--- a/test/integration/cloudstack.yml
+++ b/test/integration/cloudstack.yml
@@ -23,5 +23,6 @@
     - { role: test_cs_firewall,             tags: test_cs_firewall }
     - { role: test_cs_loadbalancer_rule,    tags: test_cs_loadbalancer_rule }
     - { role: test_cs_volume,               tags: test_cs_volume }
+    - { role: test_cs_instance_facts,       tags: test_cs_instance_facts }
     - { role: test_cs_configuration,        tags: test_cs_configuration }
 
diff --git a/test/integration/roles/test_cs_instance_facts/defaults/main.yml b/test/integration/roles/test_cs_instance_facts/defaults/main.yml
new file mode 100644
index 0000000000..e393e60f4f
--- /dev/null
+++ b/test/integration/roles/test_cs_instance_facts/defaults/main.yml
@@ -0,0 +1,3 @@
+---
+test_cs_instance_template: CentOS 5.3(64-bit) no GUI (Simulator)
+test_cs_instance_offering_1: Small Instance
diff --git a/test/integration/roles/test_cs_instance_facts/meta/main.yml b/test/integration/roles/test_cs_instance_facts/meta/main.yml
new file mode 100644
index 0000000000..03e38bd4f7
--- /dev/null
+++ b/test/integration/roles/test_cs_instance_facts/meta/main.yml
@@ -0,0 +1,3 @@
+---
+dependencies:
+  - test_cs_common
diff --git a/test/integration/roles/test_cs_instance_facts/tasks/main.yml b/test/integration/roles/test_cs_instance_facts/tasks/main.yml
new file mode 100644
index 0000000000..af35712aa5
--- /dev/null
+++ b/test/integration/roles/test_cs_instance_facts/tasks/main.yml
@@ -0,0 +1,55 @@
+---
+- name: setup ssh key
+  cs_sshkeypair: name={{ cs_resource_prefix }}-sshkey
+  register: sshkey
+- name: verify setup ssh key
+  assert:
+    that:
+    - sshkey|success
+
+- name: setup affinity group
+  cs_affinitygroup: name={{ cs_resource_prefix }}-ag
+  register: ag
+- name: verify setup affinity group
+  assert:
+    that:
+    - ag|success
+
+- name: setup security group
+  cs_securitygroup: name={{ cs_resource_prefix }}-sg
+  register: sg
+- name: verify setup security group
+  assert:
+    that:
+    - sg|success
+
+- name: setup instance
+  cs_instance:
+    name: "{{ cs_resource_prefix }}-vm"
+    template: "{{ test_cs_instance_template }}"
+    service_offering: "{{ test_cs_instance_offering_1 }}"
+    affinity_group: "{{ cs_resource_prefix }}-ag"
+    security_group: "{{ cs_resource_prefix }}-sg"
+    ssh_key: "{{ cs_resource_prefix }}-sshkey"
+    tags: []
+  register: instance
+- name: verify create instance
+  assert:
+    that:
+    - instance|success
+
+- name: test instance facts
+  cs_instance_facts:
+    name: "{{ cs_resource_prefix }}-vm"
+  register: instance_facts
+- name: verify test instance facts
+  assert:
+    that:
+    - instance_facts|success
+    - not instance_facts|changed
+    - cloudstack_instance.id == instance.id
+    - cloudstack_instance.domain == instance.domain
+    - cloudstack_instance.account == instance.account
+    - cloudstack_instance.zone == instance.zone
+    - cloudstack_instance.name == instance.name
+    - cloudstack_instance.service_offering == instance.service_offering
