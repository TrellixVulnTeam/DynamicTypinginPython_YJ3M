commit 16c2d3717eb118fd09808a268414f34630410524
Author: Ganesh Nalawade <ganesh634@gmail.com>
Date:   Wed Apr 11 12:07:56 2018 +0530

    Add junos connection type check (#38527)
    
    junos_netconf works only with connection=netconf
    Add check to report appropriate error if any other
    connection type is used.

diff --git a/lib/ansible/plugins/action/junos.py b/lib/ansible/plugins/action/junos.py
index 6f61701103..64913c14be 100644
--- a/lib/ansible/plugins/action/junos.py
+++ b/lib/ansible/plugins/action/junos.py
@@ -90,7 +90,8 @@ class ActionModule(_ActionModule):
             if any(provider.values()):
                 display.warning('provider is unnecessary when using connection=%s and will be ignored' % self._play_context.connection)
 
-            if self._play_context.connection == 'network_cli' and self._task.action not in CLI_SUPPORTED_MODULES:
+            if (self._play_context.connection == 'network_cli' and self._task.action not in CLI_SUPPORTED_MODULES) or \
+                    (self._play_context.connection == 'netconf' and self._task.action == 'junos_netconf'):
                 return {'failed': True, 'msg': "Connection type '%s' is not valid for '%s' module. "
                                                "Please see http://docs.ansible.com/ansible/latest/network/user_guide/platform_junos.html"
                                                % (self._play_context.connection, self._task.action)}
