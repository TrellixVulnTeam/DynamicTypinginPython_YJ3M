commit 22be69188bec15df56a4e02e146e185365c8b6ba
Author: Sam Doran <sdoran@redhat.com>
Date:   Fri Jan 10 16:58:37 2020 -0500

    Fix unarchive integration test on CentOS 6 (#66362)
    
    * Cleanup packages added for Python TLS support

diff --git a/test/integration/targets/unarchive/handlers/main.yml b/test/integration/targets/unarchive/handlers/main.yml
new file mode 100644
index 0000000000..b612caaf87
--- /dev/null
+++ b/test/integration/targets/unarchive/handlers/main.yml
@@ -0,0 +1,9 @@
+- name: remove python TLS packages
+  yum:
+    name:
+      - python-urllib3
+      - python2-ndg_httpsclient
+      - pyOpenSSL
+      - 'python-backports*'
+      - python-six
+    state: absent
diff --git a/test/integration/targets/unarchive/tasks/main.yml b/test/integration/targets/unarchive/tasks/main.yml
index 9794e6a800..89d27dff44 100644
--- a/test/integration/targets/unarchive/tasks/main.yml
+++ b/test/integration/targets/unarchive/tasks/main.yml
@@ -230,7 +230,7 @@
     src: "{{ remote_tmp_dir }}/unarchive-00.{{item}}"
     dest: "{{ remote_tmp_dir }}/exclude-{{item}}"
     remote_src: yes
-    exclude: 
+    exclude:
       - "exclude/exclude-*.txt"
       - "other/exclude-1.ext"
   with_items:
@@ -633,6 +633,17 @@
 - name: create our unarchive destination
   file: path={{remote_tmp_dir}}/test-unarchive-tar-gz state=directory
 
+- name: Install packages to make TLS connections work on CentOS 6
+  yum:
+    name:
+      - python-urllib3
+      - python2-ndg_httpsclient
+    state: present
+  when:
+    - ansible_facts.distribution == 'CentOS'
+    - not ansible_facts.python.has_sslcontext
+  notify: remove python TLS packages
+
 - name: unarchive a tar from an URL
   unarchive:
     src: "https://releases.ansible.com/ansible/ansible-latest.tar.gz"
