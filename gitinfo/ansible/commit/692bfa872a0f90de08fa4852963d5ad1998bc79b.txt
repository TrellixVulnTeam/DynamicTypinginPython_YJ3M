commit 692bfa872a0f90de08fa4852963d5ad1998bc79b
Author: Matt Robinson <git@nerdoftheherd.com>
Date:   Tue Oct 18 19:50:45 2016 +0100

    Make bcrypt + passlib work in password_hash filter
    
    If hashtype for the password_hash filter is 'blowfish' and passlib is
    available, hashing fails as the hash function for this is named 'bcrypt'
    (and not 'blowfish_crypt').  Special case this so that the correct
    function is called.

diff --git a/lib/ansible/plugins/filter/core.py b/lib/ansible/plugins/filter/core.py
index 276a95dd16..81463ce0e3 100644
--- a/lib/ansible/plugins/filter/core.py
+++ b/lib/ansible/plugins/filter/core.py
@@ -257,7 +257,11 @@ def get_encrypted_password(password, hashtype='sha512', salt=None):
             saltstring =  "$%s$%s" % (cryptmethod[hashtype],salt)
             encrypted = crypt.crypt(password, saltstring)
         else:
-            cls = getattr(passlib.hash, '%s_crypt' % hashtype)
+            if hashtype == 'blowfish':
+                cls = passlib.hash.bcrypt;
+            else:
+                cls = getattr(passlib.hash, '%s_crypt' % hashtype)
+
             encrypted = cls.encrypt(password, salt=salt)
 
         return encrypted
