commit 4ca7726e7590972e775408ee99a62cd51f9598a6
Author: William Holroyd <wholroyd@users.noreply.github.com>
Date:   Fri Mar 10 13:08:54 2017 -0500

    Fix Elasticcache issue where ec2 script would fail on finding lack of primary endpoint address on Redis cluster (#20190)

diff --git a/contrib/inventory/ec2.py b/contrib/inventory/ec2.py
index de549d29bd..03b9820412 100755
--- a/contrib/inventory/ec2.py
+++ b/contrib/inventory/ec2.py
@@ -1254,13 +1254,14 @@ class Ec2Inventory(object):
         if not self.all_elasticache_replication_groups and replication_group['Status'] != 'available':
             return
 
+        # Skip clusters we cannot address (e.g. private VPC subnet or clustered redis)
+        if replication_group['NodeGroups'][0]['PrimaryEndpoint'] is None or \
+           replication_group['NodeGroups'][0]['PrimaryEndpoint']['Address'] is None:
+            return
+
         # Select the best destination address (PrimaryEndpoint)
         dest = replication_group['NodeGroups'][0]['PrimaryEndpoint']['Address']
 
-        if not dest:
-            # Skip clusters we cannot address (e.g. private VPC subnet)
-            return
-
         # Add to index
         self.index[dest] = [region, replication_group['ReplicationGroupId']]
 
