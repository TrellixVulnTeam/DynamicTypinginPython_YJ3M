commit 385f1d82dcdd9bd4e87e6dd697d45c71a703aecc
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Mar 8 11:57:31 2017 -0500

    ensure all hosts in all
    
    fixes #20252

diff --git a/lib/ansible/inventory/__init__.py b/lib/ansible/inventory/__init__.py
index fc808e3ca3..591d02be3d 100644
--- a/lib/ansible/inventory/__init__.py
+++ b/lib/ansible/inventory/__init__.py
@@ -140,7 +140,6 @@ class Inventory(object):
                         display.warning("A duplicate localhost-like entry was found (%s). First found localhost was %s" % (h, self.localhost.name))
                     display.vvvv("Set default localhost to %s" % h)
                     self.localhost = new_host
-                all.add_host(new_host)
         elif self._loader.path_exists(host_list):
             # TODO: switch this to a plugin loader and a 'condition' per plugin on which it should be tried, restoring 'inventory pllugins'
             if self.is_directory(host_list):
@@ -170,8 +169,13 @@ class Inventory(object):
             host.vars = combine_vars(host.vars, self.get_host_variables(host.name))
             self.get_host_vars(host)
 
-            # clear ungrouped of any incorrectly stored by parser
             mygroups = host.get_groups()
+
+            # ensure hosts are always in 'all'
+            if all not in mygroups:
+                all.add_host(host)
+
+            # clear ungrouped of any incorrectly stored by parser
             if len(mygroups) > 2 and ungrouped in mygroups:
                 host.remove_group(ungrouped)
 
