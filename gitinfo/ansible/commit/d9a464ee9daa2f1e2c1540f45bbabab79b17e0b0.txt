commit d9a464ee9daa2f1e2c1540f45bbabab79b17e0b0
Author: Matthew Williams <matthew@flowroute.com>
Date:   Tue Mar 27 08:51:37 2012 -0700

    added format_advanced jinja filter to template module

diff --git a/library/template b/library/template
index 110d397aa1..68e967ffe9 100755
--- a/library/template
+++ b/library/template
@@ -19,6 +19,7 @@
 
 import sys
 import os
+import collections
 import jinja2
 import shlex
 try:
@@ -26,6 +27,21 @@ try:
 except ImportError:
     import simplejson as json
 
+environment = jinja2.Environment()
+
+def format_advanced(fmt, data):
+    # jinja2 filter to use advanced python string formatting
+    # e.g, {{ "{0} {1} {2}"|format_advanced(['a', 'b', 'c']) }}
+    # see http://docs.python.org/library/string.html#formatstrings
+    if isinstance(data, collections.Mapping):
+        return fmt.format(**data)
+    elif isinstance(data, collections.Sequence):
+        return fmt.format(*data)
+    else:
+        return data
+
+environment.filters['format_advanced'] = format_advanced
+
 # ===========================================
 # convert arguments of form a=b c=d
 # to a dictionary
@@ -91,7 +107,7 @@ if os.path.exists(dest):
     md5sum = os.popen("md5sum %s" % dest).read().split()[0]
 
 # call Jinja2 here and save the new template file
-template = jinja2.Template(source)
+template = environment.from_string(source)
 data_out = template.render(data)
 f = open(dest, "w+")
 f.write(data_out)
