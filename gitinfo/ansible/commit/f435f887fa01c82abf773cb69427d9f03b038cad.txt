commit f435f887fa01c82abf773cb69427d9f03b038cad
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Oct 19 16:38:15 2015 -0400

    better handling of checkmode for solaris fixes #2296

diff --git a/lib/ansible/modules/system/user.py b/lib/ansible/modules/system/user.py
index b7db947cbc..41934389a3 100755
--- a/lib/ansible/modules/system/user.py
+++ b/lib/ansible/modules/system/user.py
@@ -1360,20 +1360,21 @@ class SunOS(User):
             cmd.append('-s')
             cmd.append(self.shell)
 
-        if self.module.check_mode:
-            return (0, '', '')
-        else:
-            # modify the user if cmd will do anything
-            if cmd_len != len(cmd):
+        # modify the user if cmd will do anything
+        if cmd_len != len(cmd):
+            (rc, out, err) = (0, '', '')
+            if not self.module.check_mode:
                 cmd.append(self.name)
                 (rc, out, err) = self.execute_command(cmd)
                 if rc is not None and rc != 0:
                     self.module.fail_json(name=self.name, msg=err, rc=rc)
-            else:
-                (rc, out, err) = (None, '', '')
+        else:
+            (rc, out, err) = (None, '', '')
 
-            # we have to set the password by editing the /etc/shadow file 
-            if self.update_password == 'always' and self.password is not None and info[1] != self.password:
+        # we have to set the password by editing the /etc/shadow file 
+        if self.update_password == 'always' and self.password is not None and info[1] != self.password:
+            (rc, out, err) = (0, '', '')
+            if not self.module.check_mode:
                 try:
                     lines = []
                     for line in open(self.SHADOWFILE, 'rb').readlines():
@@ -1390,7 +1391,7 @@ class SunOS(User):
                 except Exception, err:
                     self.module.fail_json(msg="failed to update users password: %s" % str(err))
 
-            return (rc, out, err)
+        return (rc, out, err)
 
 # ===========================================
 class DarwinUser(User):
