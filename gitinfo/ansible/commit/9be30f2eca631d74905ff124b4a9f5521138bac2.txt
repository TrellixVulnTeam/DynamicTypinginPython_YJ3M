commit 9be30f2eca631d74905ff124b4a9f5521138bac2
Author: Angus Williams <angus.williams@intelliflo.com>
Date:   Mon Mar 6 12:55:42 2017 +0000

    Fixes idempotency issue when upgrading chocolatey packages (#21476)

diff --git a/lib/ansible/modules/windows/win_chocolatey.ps1 b/lib/ansible/modules/windows/win_chocolatey.ps1
index 4a44097365..34e2840d63 100644
--- a/lib/ansible/modules/windows/win_chocolatey.ps1
+++ b/lib/ansible/modules/windows/win_chocolatey.ps1
@@ -198,7 +198,7 @@ Function Choco-Upgrade
         $cmd += " --execution-timeout=$executiontimeout"
     }
 
-    $results = invoke-expression $cmd
+    $output = invoke-expression $cmd
 
     $result.rc = $LastExitCode
     if ($LastExitCode -notin $successexitcodes)
@@ -208,7 +208,7 @@ Function Choco-Upgrade
         Throw "Error installing $package"
     }
 
-    if ("$output" -match ' upgraded (\d+)/\d+ package\(s\)\. ')
+    if ("$output" -match ' upgraded (\d+)/\d+ package')
     {
         if ($matches[1] -gt 0)
         {
