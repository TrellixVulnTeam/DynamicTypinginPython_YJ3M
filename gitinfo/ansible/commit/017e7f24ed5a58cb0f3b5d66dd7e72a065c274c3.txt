commit 017e7f24ed5a58cb0f3b5d66dd7e72a065c274c3
Author: bennojoy <benno@ansibleworks.com>
Date:   Wed Jun 5 19:59:39 2013 +0530

    bug fix for #3077, environment settings for script

diff --git a/lib/ansible/runner/action_plugins/script.py b/lib/ansible/runner/action_plugins/script.py
index 84c0ab015b..dba9ca5a74 100644
--- a/lib/ansible/runner/action_plugins/script.py
+++ b/lib/ansible/runner/action_plugins/script.py
@@ -61,7 +61,8 @@ class ActionModule(object):
             prepcmd = 'chmod +x %s' % tmp_src
 
         # add preparation steps to one ssh roundtrip executing the script
-        module_args = prepcmd + '; ' + tmp_src + ' ' + args
+        env_string = self.runner._compute_environment_string(inject)
+        module_args = prepcmd + '; ' + env_string + tmp_src + ' ' + args
 
         handler = utils.plugins.action_loader.get('raw', self.runner)
         result = handler.run(conn, tmp, 'raw', module_args, inject)
