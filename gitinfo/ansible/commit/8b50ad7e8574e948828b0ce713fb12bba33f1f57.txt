commit 8b50ad7e8574e948828b0ce713fb12bba33f1f57
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Thu Oct 25 21:37:37 2012 -0400

    Fix for atomic_replace patch if file does not yet exist

diff --git a/lib/ansible/module_common.py b/lib/ansible/module_common.py
index f0d8c826a4..72aa97099e 100644
--- a/lib/ansible/module_common.py
+++ b/lib/ansible/module_common.py
@@ -596,19 +596,19 @@ class AnsibleModule(object):
 
     def atomic_replace(self, src, dest):
         '''atomically replace dest with src, copying attributes from dest'''
-        st = os.stat(dest)
-        os.chmod(src, st.st_mode & 07777)
-        try:
-            os.chown(src, st.st_uid, st.st_gid)
-        except OSError, e:
-            if e.errno != errno.EPERM:
-                raise
-        if self.selinux_enabled():
-            context = self.selinux_context(dest)
-            self.set_context_if_different(src, context, False)
+        if os.path.exists(dest):
+            st = os.stat(dest)
+            os.chmod(src, st.st_mode & 07777)
+            try:
+                os.chown(src, st.st_uid, st.st_gid)
+            except OSError, e:
+                if e.errno != errno.EPERM:
+                    raise
+            if self.selinux_enabled():
+                context = self.selinux_context(dest)
+                self.set_context_if_different(src, context, False)
         os.rename(src, dest)
 
-
 # == END DYNAMICALLY INSERTED CODE ===
 
 """
