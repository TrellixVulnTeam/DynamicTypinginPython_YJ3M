commit add45d2ca92ea1da2dde767b5bfc239dafd54b18
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Fri Oct 11 19:16:36 2013 -0400

    Fixup legacy var detector.

diff --git a/lib/ansible/utils/template.py b/lib/ansible/utils/template.py
index d7f69b1a1f..77a21df15b 100644
--- a/lib/ansible/utils/template.py
+++ b/lib/ansible/utils/template.py
@@ -262,6 +262,8 @@ def legacy_varReplace(basedir, raw, vars, lookup_fatal=True, depth=0, expand_lis
     ''' Perform variable replacement of $variables in string raw using vars dictionary '''
     # this code originally from yum
 
+    orig = raw
+
     if not isinstance(raw, unicode):
         raw = raw.decode("utf-8")
 
@@ -294,7 +296,7 @@ def legacy_varReplace(basedir, raw, vars, lookup_fatal=True, depth=0, expand_lis
 
     result = ''.join(done)
 
-    if result != raw:
+    if result != orig:
         from ansible import utils
         utils.deprecated("Legacy variable subsitution, such as using ${foo} or $foo instead of {{ foo }} is currently valid but will be phased out and has been out of favor since version 1.2. This is the last of legacy features on our deprecation list. You may continue to use this if you have specific needs for now","1.6")
     return result
diff --git a/test/playbook1.yml b/test/playbook1.yml
index 6a75df52f8..d345d7428d 100644
--- a/test/playbook1.yml
+++ b/test/playbook1.yml
@@ -25,7 +25,7 @@
     action: command true
 
   - name: test basic shell, plus two ways to dereference a variable
-    action: shell echo $HOME {{port}}
+    action: shell echo {{HOME}} {{port}}
 
   - name: test vars_files imports
     action: shell echo {{duck}} {{cow}} {{testing}}
