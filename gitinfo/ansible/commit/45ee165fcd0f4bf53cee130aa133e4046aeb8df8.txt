commit 45ee165fcd0f4bf53cee130aa133e4046aeb8df8
Author: Maxim Babushkin <babushkin.max@gmail.com>
Date:   Thu May 9 19:38:29 2019 +0300

    os_nova_host_aggregate - Fix aggregate delete with hosts (#53166)
    
    Aggregate delete task will fail in case it has hosts within the aggregate.
    As by the OpenStack, the hosts should be removed from the aggregate
    prior aggregate delete.
    
    Add remove host in case provided.

diff --git a/lib/ansible/modules/cloud/openstack/os_nova_host_aggregate.py b/lib/ansible/modules/cloud/openstack/os_nova_host_aggregate.py
index 931bc8cdb3..94bd628988 100644
--- a/lib/ansible/modules/cloud/openstack/os_nova_host_aggregate.py
+++ b/lib/ansible/modules/cloud/openstack/os_nova_host_aggregate.py
@@ -167,6 +167,9 @@ def main():
             if aggregate is None:
                 changed = False
             else:
+                if hosts:
+                    for h in hosts:
+                        cloud.remove_host_from_aggregate(aggregate.id, h)
                 cloud.delete_aggregate(aggregate.id)
                 changed = True
             module.exit_json(changed=changed)
