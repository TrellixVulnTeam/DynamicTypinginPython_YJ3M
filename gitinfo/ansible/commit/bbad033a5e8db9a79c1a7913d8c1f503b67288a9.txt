commit bbad033a5e8db9a79c1a7913d8c1f503b67288a9
Author: Jordan Borean <jborean93@gmail.com>
Date:   Tue Jan 15 11:16:15 2019 +1000

    ansible-test: apt cleanup and futher 18.04 fixes (#50906)

diff --git a/test/integration/targets/apt/tasks/main.yml b/test/integration/targets/apt/tasks/main.yml
index c99dbab510..1d5fae77f8 100644
--- a/test/integration/targets/apt/tasks/main.yml
+++ b/test/integration/targets/apt/tasks/main.yml
@@ -27,8 +27,8 @@
   - block:
       - include: 'repo.yml'
     always:
-      - apt_repository:
-          repo: "deb file:{{ repodir }} ./"
+      - file:
+          path: /etc/apt/sources.list.d/file_tmp_repo.list
           state: absent
       - file:
           name: "{{ repodir }}"
diff --git a/test/integration/targets/apt_repository/tasks/apt.yml b/test/integration/targets/apt_repository/tasks/apt.yml
index 612a7f270d..941335f2c6 100644
--- a/test/integration/targets/apt_repository/tasks/apt.yml
+++ b/test/integration/targets/apt_repository/tasks/apt.yml
@@ -135,6 +135,9 @@
   stat: path='/var/cache/apt/pkgcache.bin'
   register: cache_before
 
+- name: ensure ppa key is present before adding repo that requires authentication
+  apt_key: keyserver=keyserver.ubuntu.com id='{{test_ppa_key}}' state=present
+
 - name: 'name=<spec> (expect: pass)'
   apt_repository: repo='{{test_ppa_spec}}' state=present
   register: result
@@ -167,6 +170,9 @@
   stat: path='/var/cache/apt/pkgcache.bin'
   register: cache_before
 
+- name: ensure ppa key is present before adding repo that requires authentication
+  apt_key: keyserver=keyserver.ubuntu.com id='{{test_ppa_key}}' state=present
+
 - name: 'name=<spec> filename=<filename> (expect: pass)'
   apt_repository: repo='{{test_ppa_spec}}' filename='{{test_ppa_filename}}' state=present
   register: result
