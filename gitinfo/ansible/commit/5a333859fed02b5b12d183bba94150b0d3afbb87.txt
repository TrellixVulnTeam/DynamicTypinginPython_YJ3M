commit 5a333859fed02b5b12d183bba94150b0d3afbb87
Author: Brian Coca <bcoca@ansible.com>
Date:   Mon Mar 19 13:01:29 2018 -0400

    allow for parameterized string functions
    
    now also allow for ending parens
    
    from following, 1, 2, 4 and 5 match, rest are ignored.
    
            {doc | to_nice_json}}
            {{(doc | to_nice_json)}}
            {{doc | to_nice_json| from_json}}
            {{doc | to_nice_json()}}
            {{doc | to_nice_json(indent=2)}}
            {{doc | to_nice_json(indent=2) | from_json()}}
            {{doc | to_nice_json(indent=2) | from_json}}
    
    fixes #37579

diff --git a/lib/ansible/template/__init__.py b/lib/ansible/template/__init__.py
index 000c5b91e5..215a191f23 100644
--- a/lib/ansible/template/__init__.py
+++ b/lib/ansible/template/__init__.py
@@ -290,7 +290,8 @@ class Templar:
             self.environment.block_end_string,
             self.environment.variable_end_string
         ))
-        self._no_type_regex = re.compile(r'.*\|\s*(?:%s)\s*(?:%s)?$' % ('|'.join(C.STRING_TYPE_FILTERS), self.environment.variable_end_string))
+        self._no_type_regex = re.compile(r'.*?\|\s*(?:%s)(?:\([^\|]*\))?\s*\)?\s*(?:%s)' %
+                                         ('|'.join(C.STRING_TYPE_FILTERS), self.environment.variable_end_string))
 
     def _get_filters(self, builtin_filters):
         '''
