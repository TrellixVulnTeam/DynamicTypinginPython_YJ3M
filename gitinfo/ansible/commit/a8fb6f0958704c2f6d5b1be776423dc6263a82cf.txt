commit a8fb6f0958704c2f6d5b1be776423dc6263a82cf
Author: Matt Clay <matt@mystile.com>
Date:   Thu Jan 19 10:54:26 2017 -0800

    Use jinja2 import instead of pip to get version.
    
    This resolves issues with older versions of pip.

diff --git a/test/integration/targets/filters/tasks/main.yml b/test/integration/targets/filters/tasks/main.yml
index 3558c4e293..8075d91c66 100644
--- a/test/integration/targets/filters/tasks/main.yml
+++ b/test/integration/targets/filters/tasks/main.yml
@@ -112,7 +112,7 @@
         - "'local' == ['localhost']|map('extract',hostvars,'ansible_connection')|list|first"
         - "'local' == ['localhost']|map('extract',hostvars,['ansible_connection'])|list|first"
   # map was added to jinja2 in version 2.7
-  when: "{{ ( lookup('pipe', 'pip show --disable-pip-version-check jinja2 | grep ^Version: | sed \"s/^Version: //\"') |
+  when: "{{ ( lookup('pipe', '{{ ansible_python[\"executable\"] }} -c \"import jinja2; print(jinja2.__version__)\"') |
               version_compare('2.7', '>=') ) }}"
 
 - name: Test json_query filter
