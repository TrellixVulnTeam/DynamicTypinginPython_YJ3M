commit 206813158967aa654e2a13e5e699b8f49977eb2b
Author: Graham Mainwaring <gmainwaring@ansible.com>
Date:   Fri Mar 27 20:10:38 2020 -0400

    Fix colorization to not extend across newline boundary (#68517)
    
    * Fix colorization to not extend across newline boundary
    
    * Fix unit test to look for the newline outside the coloration
    
    * Add changelog fragment

diff --git a/changelogs/fragments/warnings-remove-extra-newline-better.yaml b/changelogs/fragments/warnings-remove-extra-newline-better.yaml
new file mode 100644
index 0000000000..20ddb5b3de
--- /dev/null
+++ b/changelogs/fragments/warnings-remove-extra-newline-better.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+  - display - Improve method of removing extra new line after warnings so it does not break Tower/Runner (https://github.com/ansible/ansible/pull/68517)
diff --git a/lib/ansible/utils/display.py b/lib/ansible/utils/display.py
index a24d2cd0d7..fe93986851 100644
--- a/lib/ansible/utils/display.py
+++ b/lib/ansible/utils/display.py
@@ -153,14 +153,19 @@ class Display(with_metaclass(Singleton, object)):
         nocolor = msg
 
         if not log_only:
-            if not msg.endswith(u'\n') and newline:
-                msg2 = msg + u'\n'
+
+            has_newline = msg.endswith(u'\n')
+            if has_newline:
+                msg2 = msg[:-1]
             else:
                 msg2 = msg
 
             if color:
                 msg2 = stringc(msg2, color)
 
+            if has_newline or newline:
+                msg2 = msg2 + u'\n'
+
             msg2 = to_bytes(msg2, encoding=self._output_encoding(stderr=stderr))
             if sys.version_info >= (3,):
                 # Convert back to text string on python3
diff --git a/test/units/utils/display/test_warning.py b/test/units/utils/display/test_warning.py
index 2183005a0f..be63c348bc 100644
--- a/test/units/utils/display/test_warning.py
+++ b/test/units/utils/display/test_warning.py
@@ -27,7 +27,7 @@ def test_warning(capsys, mocker, warning_message):
     d.warning(warning_message)
     out, err = capsys.readouterr()
     assert d._warns == {expected_warning_message: 1}
-    assert err == '\x1b[1;35m{0}\x1b[0m\n\x1b[1;35m\x1b[0m'.format(expected_warning_message.rstrip('\n'))
+    assert err == '\x1b[1;35m{0}\x1b[0m\n'.format(expected_warning_message.rstrip('\n'))
 
 
 def test_warning_no_color(capsys, mocker, warning_message):
