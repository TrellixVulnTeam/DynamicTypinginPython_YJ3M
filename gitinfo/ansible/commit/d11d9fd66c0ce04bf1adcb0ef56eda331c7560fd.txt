commit d11d9fd66c0ce04bf1adcb0ef56eda331c7560fd
Author: James Tanner <tanner.jc@gmail.com>
Date:   Wed Feb 19 17:32:32 2014 -0500

    Add synchronize test

diff --git a/tests_new/integration/non_destructive.yml b/tests_new/integration/non_destructive.yml
index 4ee6d9ea1b..f2008bbac3 100644
--- a/tests_new/integration/non_destructive.yml
+++ b/tests_new/integration/non_destructive.yml
@@ -6,4 +6,5 @@
     - { role: test_template, tags: test_template }
     - { role: test_file, tags: test_file }
     - { role: test_fetch, tags: test_fetch }
+    - { role: test_synchronize, tags: test_synchronize }
 
diff --git a/tests_new/integration/roles/test_synchronize/files/foo.txt b/tests_new/integration/roles/test_synchronize/files/foo.txt
new file mode 100644
index 0000000000..3e96db9b3e
--- /dev/null
+++ b/tests_new/integration/roles/test_synchronize/files/foo.txt
@@ -0,0 +1 @@
+templated_var_loaded
diff --git a/tests_new/integration/roles/test_synchronize/meta/main.yml b/tests_new/integration/roles/test_synchronize/meta/main.yml
new file mode 100644
index 0000000000..1050c23ce3
--- /dev/null
+++ b/tests_new/integration/roles/test_synchronize/meta/main.yml
@@ -0,0 +1,3 @@
+dependencies: 
+  - prepare_tests
+
diff --git a/tests_new/integration/roles/test_synchronize/tasks/main.yml b/tests_new/integration/roles/test_synchronize/tasks/main.yml
new file mode 100644
index 0000000000..2afb68cd68
--- /dev/null
+++ b/tests_new/integration/roles/test_synchronize/tasks/main.yml
@@ -0,0 +1,40 @@
+# test code for the synchronize module
+# (c) 2014, James Tanner <tanner.jc@gmail.com>
+
+# This file is part of Ansible
+#
+# Ansible is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# Ansible is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.
+
+# FIXME: tags should auto-apply to role dependencies
+- name: cleanup old files
+  shell: rm -rf {{output_dir}}/*
+
+- name: make a new file
+  copy: dest={{output_dir}}/foo.txt mode=0644 content="hello world"
+
+- name: synchronize file to new filename
+  synchronize: src={{output_dir}}/foo.txt dest={{output_dir}}/foo.result
+  register: sync_result
+
+- debug: var=sync_result
+
+- assert: 
+    that: 
+        - "'changed' in sync_result"
+        - "sync_result.changed == true"
+        - "'cmd' in sync_result"
+        - "'rsync' in sync_result.cmd"
+        - "'msg' in sync_result"
+        - "sync_result.msg == '>f+++++++++ foo.txt\n'"
+
