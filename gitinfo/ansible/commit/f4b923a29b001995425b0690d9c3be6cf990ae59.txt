commit f4b923a29b001995425b0690d9c3be6cf990ae59
Author: Matt Clay <matt@mystile.com>
Date:   Tue Mar 3 12:56:36 2020 -0800

    Automatically enable test plugins after migration.

diff --git a/test/utils/shippable/linux.sh b/test/utils/shippable/linux.sh
index 9cc2f966cb..579ae667d3 100755
--- a/test/utils/shippable/linux.sh
+++ b/test/utils/shippable/linux.sh
@@ -13,6 +13,13 @@ else
     target="shippable/posix/"
 fi
 
+# detect the post migration ansible/ansible repo and enable test support plugins
+if [ -f lib/ansible/config/routing.yml ]; then
+    # this option is only useful for ansible/ansible (not collections) and should not be used prior to migration (except for incidental tests)
+    enable_test_support=--enable-test-support
+fi
+
 # shellcheck disable=SC2086
 ansible-test integration --color -v --retry-on-error "${target}" ${COVERAGE:+"$COVERAGE"} ${CHANGED:+"$CHANGED"} ${UNSTABLE:+"$UNSTABLE"} \
+    ${enable_test_support:+"$enable_test_support"} \
     --docker "${image}"
diff --git a/test/utils/shippable/remote.sh b/test/utils/shippable/remote.sh
index cd3014ccac..f1d575474a 100755
--- a/test/utils/shippable/remote.sh
+++ b/test/utils/shippable/remote.sh
@@ -17,6 +17,13 @@ fi
 stage="${S:-prod}"
 provider="${P:-default}"
 
+# detect the post migration ansible/ansible repo and enable test support plugins
+if [ -f lib/ansible/config/routing.yml ]; then
+    # this option is only useful for ansible/ansible (not collections) and should not be used prior to migration (except for incidental tests)
+    enable_test_support=--enable-test-support
+fi
+
 # shellcheck disable=SC2086
 ansible-test integration --color -v --retry-on-error "${target}" ${COVERAGE:+"$COVERAGE"} ${CHANGED:+"$CHANGED"} ${UNSTABLE:+"$UNSTABLE"} \
+    ${enable_test_support:+"$enable_test_support"} \
     --remote "${platform}/${version}" --remote-terminate always --remote-stage "${stage}" --remote-provider "${provider}"
diff --git a/test/utils/shippable/windows.sh b/test/utils/shippable/windows.sh
index 549d6a80b5..b4459a1381 100755
--- a/test/utils/shippable/windows.sh
+++ b/test/utils/shippable/windows.sh
@@ -13,6 +13,12 @@ target="shippable/windows/group${group}/"
 stage="${S:-prod}"
 provider="${P:-default}"
 
+# detect the post migration ansible/ansible repo and enable test support plugins
+if [ -f lib/ansible/config/routing.yml ]; then
+    # this option is only useful for ansible/ansible (not collections) and should not be used prior to migration (except for incidental tests)
+    enable_test_support=--enable-test-support
+fi
+
 # python versions to test in order
 # python 2.7 runs full tests while other versions run minimal tests
 python_versions=(
@@ -93,5 +99,6 @@ for version in "${python_versions[@]}"; do
     ansible-test windows-integration --color -v --retry-on-error "${ci}" ${COVERAGE:+"$COVERAGE"} ${CHANGED:+"$CHANGED"} ${UNSTABLE:+"$UNSTABLE"} \
         "${platforms[@]}" --changed-all-target "${changed_all_target}" --changed-all-mode "${changed_all_mode}" \
         --docker default --python "${version}" \
+        ${enable_test_support:+"$enable_test_support"} \
         --remote-terminate "${terminate}" --remote-stage "${stage}" --remote-provider "${provider}"
 done
