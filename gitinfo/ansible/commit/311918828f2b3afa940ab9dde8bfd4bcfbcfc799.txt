commit 311918828f2b3afa940ab9dde8bfd4bcfbcfc799
Author: Ganesh Nalawade <ganesh634@gmail.com>
Date:   Wed Jan 31 11:43:08 2018 +0530

    Fix double prompt issue in network_cli (#35439)
    
    Fixes #33993
    
    In current implementation while trying to fetch the
    current cli prompt terminal plugin executes `\r` on remote host.
    
    This causes if command execution results in a prompt for
    example executing `enable` command results in `Password:` prompt
    there by executing `\r` on password prompt which is not intended.
    
    To fix it while fetching current prompt from terminal plugin use `get_prompt()`
    api in network_cli that returns the latest matched prompt instead of
    unnecessary executing `\r` on remote host.

diff --git a/lib/ansible/plugins/terminal/__init__.py b/lib/ansible/plugins/terminal/__init__.py
index a876c7fb06..f4928082f3 100644
--- a/lib/ansible/plugins/terminal/__init__.py
+++ b/lib/ansible/plugins/terminal/__init__.py
@@ -69,11 +69,7 @@ class TerminalBase(with_metaclass(ABCMeta, object)):
 
         :returns: A byte string of the prompt
         """
-        # do not send '\n' here, exec_cli_command sends '\r' already,
-        # doing so causes double prompts.
-        self._exec_cli_command(b'')
-
-        return self._connection._matched_prompt
+        return self._connection.get_prompt()
 
     def on_open_shell(self):
         """Called after the SSH session is established
