commit d34b586eb6bf162c6c168a3065b3471f0522abf8
Author: James Cammarata <jimi@sngx.net>
Date:   Tue May 5 16:40:11 2015 -0500

    Add ability for connection plugins to set attributes based on host variables (v2)

diff --git a/lib/ansible/executor/task_executor.py b/lib/ansible/executor/task_executor.py
index 7fa2134948..6d62eea68b 100644
--- a/lib/ansible/executor/task_executor.py
+++ b/lib/ansible/executor/task_executor.py
@@ -209,7 +209,9 @@ class TaskExecutor:
 
         # get the connection and the handler for this execution
         self._connection = self._get_connection(variables)
-        self._handler    = self._get_action_handler(connection=self._connection, templar=templar)
+        self._connection.set_host_overrides(host=self._host)
+
+        self._handler = self._get_action_handler(connection=self._connection, templar=templar)
 
         # Evaluate the conditional (if any) for this task, which we do before running
         # the final task post-validation. We do this before the post validation due to
diff --git a/lib/ansible/plugins/connections/__init__.py b/lib/ansible/plugins/connections/__init__.py
index d11f365182..5558f5ba86 100644
--- a/lib/ansible/plugins/connections/__init__.py
+++ b/lib/ansible/plugins/connections/__init__.py
@@ -64,6 +64,17 @@ class ConnectionBase:
 
         raise AnsibleError("Internal Error: this connection module does not support running commands via %s" % become_method)
 
+    def set_host_overrides(self, host):
+        '''
+        An optional method, which can be used to set connection plugin parameters
+        from variables set on the host (or groups to which the host belongs)
+
+        Any connection plugin using this should first initialize its attributes in
+        an overridden `def __init__(self):`, and then use `host.get_vars()` to find
+        variables which may be used to set those attributes in this method.
+        '''
+        pass
+
     @abstractproperty
     def transport(self):
         """String used to identify this Connection class from other classes"""
