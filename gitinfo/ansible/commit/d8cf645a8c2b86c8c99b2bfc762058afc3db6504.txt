commit d8cf645a8c2b86c8c99b2bfc762058afc3db6504
Author: Zim Kalinowski <zikalino@microsoft.com>
Date:   Mon Sep 3 09:49:18 2018 +0800

    merging postgresql server and database facts (#45061)

diff --git a/test/integration/targets/azure_rm_postgresqldatabase/aliases b/test/integration/targets/azure_rm_postgresqldatabase/aliases
deleted file mode 100644
index 49acfee76c..0000000000
--- a/test/integration/targets/azure_rm_postgresqldatabase/aliases
+++ /dev/null
@@ -1,3 +0,0 @@
-cloud/azure
-destructive
-shippable/azure/group2
diff --git a/test/integration/targets/azure_rm_postgresqldatabase/meta/main.yml b/test/integration/targets/azure_rm_postgresqldatabase/meta/main.yml
deleted file mode 100644
index 95e1952f98..0000000000
--- a/test/integration/targets/azure_rm_postgresqldatabase/meta/main.yml
+++ /dev/null
@@ -1,2 +0,0 @@
-dependencies:
-  - setup_azure
diff --git a/test/integration/targets/azure_rm_postgresqldatabase/tasks/main.yml b/test/integration/targets/azure_rm_postgresqldatabase/tasks/main.yml
deleted file mode 100644
index b281ec59d0..0000000000
--- a/test/integration/targets/azure_rm_postgresqldatabase/tasks/main.yml
+++ /dev/null
@@ -1,136 +0,0 @@
-- name: Prepare random number
-  set_fact:
-    rpfx: "{{ resource_group | hash('md5') | truncate(7, True, '') }}{{ 1000 | random }}"
-  run_once: yes
-
-- name: Create PostgreSQL Server
-  azure_rm_postgresqlserver:
-    resource_group: "{{ resource_group }}"
-    name: postgresqlsrv{{ rpfx }}
-    sku:
-        name: GP_Gen4_2
-        tier: GeneralPurpose
-    location: westus
-    storage_mb: 51200
-    enforce_ssl: True
-    admin_username: zimxyz
-    admin_password: Testpasswordxyz12!
-
-- name: Create instance of PostgreSQL Database -- check mode
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-  check_mode: yes
-  register: output
-- name: Assert the resource instance is well created
-  assert:
-    that:
-      - output.changed
-
-- name: Create instance of PostgreSQL Database
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-  register: output
-- name: Assert the resource instance is well created
-  assert:
-    that:
-      - output.changed
-      - output.name == 'testdatabase'
-
-- name: Create again instance of PostgreSQL Database
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-  register: output
-- name: Assert the state has not changed
-  assert:
-    that:
-      - output.changed == false
-      - output.name == 'testdatabase'
-
-- name: Create second instance of PostgreSQL Database
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase2
-
-- name: Gather facts PostgreSQL Database
-  azure_rm_postgresqldatabase_facts:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-  register: output 
-
-- name: Assert that facts are returned
-  assert:
-    that:
-      - output.changed == False
-      - output.databases[0]['server_name'] != None
-      - output.databases[0]['name'] != None
-      - output.databases[0]['charset'] != None
-      - output.databases[0]['collation'] != None
-
-- name: Gather facts PostgreSQL Database
-  azure_rm_postgresqldatabase_facts:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-  register: output
-- name: Assert that facts are returned
-  assert:
-    that:
-      - output.changed == False
-      - output.databases[0]['server_name'] != None
-      - output.databases[0]['name'] != None
-      - output.databases[0]['charset'] != None
-      - output.databases[0]['collation'] != None
-      - output.databases[1]['server_name'] != None
-      - output.databases[1]['name'] != None
-      - output.databases[1]['charset'] != None
-      - output.databases[1]['collation'] != None
-
-- name: Delete instance of PostgreSQL Database -- check mode
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-    state: absent
-  check_mode: yes
-  register: output
-- name: Assert the state has changed
-  assert:
-    that:
-      - output.changed
-
-- name: Delete instance of PostgreSQL Database
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-    state: absent
-  register: output
-- name: Assert the state has changed
-  assert:
-    that:
-      - output.changed
-
-- name: Delete unexisting instance of PostgreSQL Database
-  azure_rm_postgresqldatabase:
-    resource_group: "{{ resource_group }}"
-    server_name: postgresqlsrv{{ rpfx }}
-    name: testdatabase
-    state: absent
-  register: output
-- name: Assert the state has changed
-  assert:
-    that:
-      - output.changed == false
-
-- name: Delete instance of PostgreSQL Server
-  azure_rm_postgresqlserver:
-    resource_group: "{{ resource_group }}"
-    name: postgresqlsrv{{ rpfx }}
-    state: absent
diff --git a/test/integration/targets/azure_rm_postgresqlserver/aliases b/test/integration/targets/azure_rm_postgresqlserver/aliases
index 438cb54762..8c1fb85cc4 100644
--- a/test/integration/targets/azure_rm_postgresqlserver/aliases
+++ b/test/integration/targets/azure_rm_postgresqlserver/aliases
@@ -1,3 +1,6 @@
 cloud/azure
 destructive
 shippable/azure/group8
+azure_rm_postgresqlserver_facts
+azure_rm_postgresqldatabase
+azure_rm_postgresqldatabase_facts
diff --git a/test/integration/targets/azure_rm_postgresqlserver/tasks/main.yml b/test/integration/targets/azure_rm_postgresqlserver/tasks/main.yml
index 986585e134..f596ffe48b 100644
--- a/test/integration/targets/azure_rm_postgresqlserver/tasks/main.yml
+++ b/test/integration/targets/azure_rm_postgresqlserver/tasks/main.yml
@@ -120,6 +120,127 @@
       - output.servers[1]['user_visible_state'] != None
       - output.servers[1]['fully_qualified_domain_name'] != None
 
+
+#
+# azure_rm_postgresqldatabase tests below
+#
+- name: Create instance of PostgreSQL Database -- check mode
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+  check_mode: yes
+  register: output
+- name: Assert the resource instance is well created
+  assert:
+    that:
+      - output.changed
+
+- name: Create instance of PostgreSQL Database
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+  register: output
+- name: Assert the resource instance is well created
+  assert:
+    that:
+      - output.changed
+      - output.name == 'testdatabase'
+
+- name: Create again instance of PostgreSQL Database
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+  register: output
+- name: Assert the state has not changed
+  assert:
+    that:
+      - output.changed == false
+      - output.name == 'testdatabase'
+
+- name: Create second instance of PostgreSQL Database
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase2
+
+- name: Gather facts PostgreSQL Database
+  azure_rm_postgresqldatabase_facts:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+  register: output 
+
+- name: Assert that facts are returned
+  assert:
+    that:
+      - output.changed == False
+      - output.databases[0]['server_name'] != None
+      - output.databases[0]['name'] != None
+      - output.databases[0]['charset'] != None
+      - output.databases[0]['collation'] != None
+
+- name: Gather facts PostgreSQL Database
+  azure_rm_postgresqldatabase_facts:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+  register: output
+- name: Assert that facts are returned
+  assert:
+    that:
+      - output.changed == False
+      - output.databases[0]['server_name'] != None
+      - output.databases[0]['name'] != None
+      - output.databases[0]['charset'] != None
+      - output.databases[0]['collation'] != None
+      - output.databases[1]['server_name'] != None
+      - output.databases[1]['name'] != None
+      - output.databases[1]['charset'] != None
+      - output.databases[1]['collation'] != None
+
+- name: Delete instance of PostgreSQL Database -- check mode
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+    state: absent
+  check_mode: yes
+  register: output
+- name: Assert the state has changed
+  assert:
+    that:
+      - output.changed
+
+- name: Delete instance of PostgreSQL Database
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+    state: absent
+  register: output
+- name: Assert the state has changed
+  assert:
+    that:
+      - output.changed
+
+- name: Delete unexisting instance of PostgreSQL Database
+  azure_rm_postgresqldatabase:
+    resource_group: "{{ resource_group }}"
+    server_name: postgresqlsrv{{ rpfx }}
+    name: testdatabase
+    state: absent
+  register: output
+- name: Assert the state has changed
+  assert:
+    that:
+      - output.changed == false
+
+#
+# azure_rm_postgresqlserver continuation / clean up
+#
+
 - name: Delete instance of PostgreSQL Server -- check mode
   azure_rm_postgresqlserver:
     resource_group: "{{ resource_group }}"
