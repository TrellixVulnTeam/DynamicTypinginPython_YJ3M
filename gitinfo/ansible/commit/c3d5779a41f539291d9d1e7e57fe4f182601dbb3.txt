commit c3d5779a41f539291d9d1e7e57fe4f182601dbb3
Author: Matt Martz <matt@sivel.net>
Date:   Mon Oct 15 16:07:52 2018 -0500

    Use the copied and merged task for calculating task vars in the free strategy. Fixes #47024 (#47060)

diff --git a/changelogs/fragments/free-strategy-include-var-tags.yaml b/changelogs/fragments/free-strategy-include-var-tags.yaml
new file mode 100644
index 0000000000..b2b3665d13
--- /dev/null
+++ b/changelogs/fragments/free-strategy-include-var-tags.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+- dynamic includes - Use the copied and merged task for calculating task vars in the free strategy (https://github.com/ansible/ansible/issues/47024)
diff --git a/lib/ansible/plugins/strategy/free.py b/lib/ansible/plugins/strategy/free.py
index 25fd3bb67c..6c999dbb8d 100644
--- a/lib/ansible/plugins/strategy/free.py
+++ b/lib/ansible/plugins/strategy/free.py
@@ -239,7 +239,7 @@ class StrategyModule(StrategyBase):
                         continue
 
                     for new_block in new_blocks:
-                        task_vars = self._variable_manager.get_vars(play=iterator._play, task=included_file._task)
+                        task_vars = self._variable_manager.get_vars(play=iterator._play, task=new_block._parent)
                         final_block = new_block.filter_tagged_tasks(play_context, task_vars)
                         for host in hosts_left:
                             if host in included_file._hosts:
