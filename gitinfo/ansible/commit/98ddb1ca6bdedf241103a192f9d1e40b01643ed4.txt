commit 98ddb1ca6bdedf241103a192f9d1e40b01643ed4
Author: Jan-Piet Mens <jpmens@gmail.com>
Date:   Sun May 12 11:22:34 2013 +0200

    notification/mqtt: ensure network communication and check error

diff --git a/library/notification/mqtt b/library/notification/mqtt
index efe4557198..7ac687a2fe 100644
--- a/library/notification/mqtt
+++ b/library/notification/mqtt
@@ -119,6 +119,9 @@ def publish(module, topic, payload, server='localhost', port='1883', qos='0',
         module.fail_json(msg="unable to connect to MQTT broker")
 
     mqttc.publish(topic, payload, int(qos), retain)
+    rc = mqttc.loop()
+    if rc != 0:
+        module.fail_json(msg="unable to send to MQTT broker")
 
     mqttc.disconnect()
 
