commit fee6e2953b02229a2be658cca144570c8e54bf9f
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Thu Feb 2 14:31:11 2017 -0800

    Split on newlines when checking for prompt matches (#20945)
    
    * Check for the prompt as a substring of the output
    
    sudo sometimes spits out warnings to stdout before getting to the
    password prompt.  Account for that when trying to match a password
    prompt.
    
    Fixes #20858

diff --git a/lib/ansible/plugins/connection/__init__.py b/lib/ansible/plugins/connection/__init__.py
index 6bc1994b81..77b8dcd8fc 100644
--- a/lib/ansible/plugins/connection/__init__.py
+++ b/lib/ansible/plugins/connection/__init__.py
@@ -254,7 +254,7 @@ class ConnectionBase(with_metaclass(ABCMeta, object)):
             return False
         elif isinstance(self._play_context.prompt, string_types):
             b_prompt = to_bytes(self._play_context.prompt)
-            return b_output.startswith(b_prompt)
+            return b_prompt in b_output
         else:
             return self._play_context.prompt(b_output)
 
