commit e7db3c0eba95f6c2accd2c8ce99031dbb1b3925e
Author: Adrian Lopez <adrian.lopez@opensolutions.cloud>
Date:   Thu Apr 19 00:04:15 2018 +0200

    chkconfig localizes messages, ansible fails to recognise
    
    In the particular case of executin "chkconfig --list NAME", ansible
    checks the stderr looking for a particular english message.
    This message is different in other languages, Spanish for example
    (although it have been corrected in the latests versions)
    
    Fixes #29818

diff --git a/lib/ansible/modules/system/service.py b/lib/ansible/modules/system/service.py
index b2ff5e11a8..e6a719988b 100644
--- a/lib/ansible/modules/system/service.py
+++ b/lib/ansible/modules/system/service.py
@@ -248,7 +248,10 @@ class Service(object):
                 cmd = [to_bytes(c, errors='surrogate_or_strict') for c in shlex.split(cmd)]
             # In either of the above cases, pass a list of byte strings to Popen
 
-            p = subprocess.Popen(cmd, shell=False, stdout=subprocess.PIPE, stderr=subprocess.PIPE, preexec_fn=lambda: os.close(pipe[1]))
+            # chkconfig localizes messages and we're screen scraping so make
+            # sure we use the C locale
+            lang_env = dict(LANG='C', LC_ALL='C', LC_MESSAGES='C')
+            p = subprocess.Popen(cmd, shell=False, stdout=subprocess.PIPE, stderr=subprocess.PIPE, env=lang_env, preexec_fn=lambda: os.close(pipe[1]))
             stdout = b("")
             stderr = b("")
             fds = [p.stdout, p.stderr]
