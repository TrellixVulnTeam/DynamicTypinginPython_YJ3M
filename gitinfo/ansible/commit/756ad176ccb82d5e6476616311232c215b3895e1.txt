commit 756ad176ccb82d5e6476616311232c215b3895e1
Author: Zim Kalinowski <zikalino@microsoft.com>
Date:   Wed Dec 19 11:01:45 2018 +0800

    fixed crash in facts (#50120)

diff --git a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine_facts.py b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine_facts.py
index 4811f111ea..afffc37dd5 100644
--- a/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine_facts.py
+++ b/lib/ansible/modules/cloud/azure/azure_rm_virtualmachine_facts.py
@@ -317,7 +317,9 @@ class AzureRMVirtualMachineFacts(AzureRMModuleBase):
         new_result['state'] = 'present'
         new_result['location'] = vm.location
         new_result['vm_size'] = result['properties']['hardwareProfile']['vmSize']
-        new_result['admin_username'] = result['properties']['osProfile']['adminUsername']
+        os_profile = result['properties'].get('osProfile')
+        if os_profile is not None:
+            new_result['admin_username'] = os_profile.get('adminUsername')
         image = result['properties']['storageProfile'].get('imageReference')
         if image is not None:
             if image.get('publisher', None) is not None:
