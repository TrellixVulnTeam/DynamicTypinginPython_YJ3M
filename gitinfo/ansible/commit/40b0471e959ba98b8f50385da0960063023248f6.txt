commit 40b0471e959ba98b8f50385da0960063023248f6
Author: Maciej Delmanowski <drybjed@gmail.com>
Date:   Mon Sep 23 12:15:33 2013 +0200

    Add Linux Container identification

diff --git a/library/system/setup b/library/system/setup
index 6b5a53e4f6..80cab6ee65 100755
--- a/library/system/setup
+++ b/library/system/setup
@@ -1899,6 +1899,13 @@ class LinuxVirtual(Virtual):
                 self.facts['virtualization_role'] = 'guest'
             return
 
+        if os.path.exists('/proc/1/cgroup'):
+            for line in open('/proc/1/cgroup').readlines():
+                if re.search('/lxc/.*$', line):
+                    self.facts['virtualization_type'] = 'lxc'
+                    self.facts['virtualization_role'] = 'guest'
+                    return
+
         product_name = get_file_content('/sys/devices/virtual/dmi/id/product_name')
 
         if product_name in ['KVM', 'Bochs']:
