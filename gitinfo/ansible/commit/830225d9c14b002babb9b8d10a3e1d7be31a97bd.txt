commit 830225d9c14b002babb9b8d10a3e1d7be31a97bd
Author: James Cammarata <jimi@sngx.net>
Date:   Tue May 12 15:09:03 2015 -0500

    Fix errors in subelements lookup plugin and associated tests (v2)

diff --git a/lib/ansible/plugins/lookup/subelements.py b/lib/ansible/plugins/lookup/subelements.py
index 0636387be6..b934a053eb 100644
--- a/lib/ansible/plugins/lookup/subelements.py
+++ b/lib/ansible/plugins/lookup/subelements.py
@@ -33,8 +33,8 @@ class LookupModule(LookupBase):
             raise errors.AnsibleError(
                 "subelements lookup expects a list of two or three items, "
                 + msg)
-        terms = listify_lookup_plugin_terms(terms, self.basedir, inject)
-        terms[0] = listify_lookup_plugin_terms(terms[0], self.basedir, inject)
+        terms = listify_lookup_plugin_terms(terms, variables, loader=self._loader)
+        terms[0] = listify_lookup_plugin_terms(terms[0], variables, loader=self._loader)
 
         # check lookup terms - check number of terms
         if not isinstance(terms, list) or not 2 <= len(terms) <= 3:
diff --git a/test/integration/roles/test_iterators/tasks/main.yml b/test/integration/roles/test_iterators/tasks/main.yml
index 931e304582..539ac2a4e7 100644
--- a/test/integration/roles/test_iterators/tasks/main.yml
+++ b/test/integration/roles/test_iterators/tasks/main.yml
@@ -119,7 +119,7 @@
     - skip_missing: yes
   register: _subelements_missing_subkeys
 
-- debug: var=_subelements_missing_subkeys.skipped
+- debug: var=_subelements_missing_subkeys
 - debug: var=_subelements_missing_subkeys.results|length
 - name: verify with_subelements in subkeys results
   assert:
