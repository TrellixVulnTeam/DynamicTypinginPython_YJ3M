commit 3763283d018f1fec2b773c97a6f6ca3edfdbddae
Author: Rene Moser <mail@renemoser.net>
Date:   Wed Oct 26 20:59:43 2016 +0200

    tasks_queue_manager: fix fork calculation if serial in %

diff --git a/lib/ansible/executor/task_queue_manager.py b/lib/ansible/executor/task_queue_manager.py
index 2e6948f1e0..08b7dd0f67 100644
--- a/lib/ansible/executor/task_queue_manager.py
+++ b/lib/ansible/executor/task_queue_manager.py
@@ -222,7 +222,7 @@ class TaskQueueManager:
         )
 
         # Fork # of forks, # of hosts or serial, whichever is lowest
-        num_hosts = len(self._inventory.get_hosts(new_play.hosts))
+        num_hosts = len(self._inventory.get_hosts(new_play.hosts, ignore_restrictions=True))
 
         max_serial = 0
         if new_play.serial:
