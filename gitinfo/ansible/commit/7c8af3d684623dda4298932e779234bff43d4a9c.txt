commit 7c8af3d684623dda4298932e779234bff43d4a9c
Author: Sam Doran <sdoran@redhat.com>
Date:   Tue Dec 11 15:30:11 2018 -0500

    Reboot - Fix VMware ESXi not working by adding appropriate commands (#49637)
    
    * Add commands for VMware ESXi
    
    * Add changelog

diff --git a/changelogs/fragments/reboot-vmware-esxi.yaml b/changelogs/fragments/reboot-vmware-esxi.yaml
new file mode 100644
index 0000000000..a626fd5dba
--- /dev/null
+++ b/changelogs/fragments/reboot-vmware-esxi.yaml
@@ -0,0 +1,2 @@
+bugfixes:
+  - reboot - add appropriate commands to make the plugin work with VMware ESXi (https://github.com/ansible/ansible/issues/48425)
diff --git a/lib/ansible/plugins/action/reboot.py b/lib/ansible/plugins/action/reboot.py
index 9686c207e4..7c933808a0 100644
--- a/lib/ansible/plugins/action/reboot.py
+++ b/lib/ansible/plugins/action/reboot.py
@@ -45,10 +45,12 @@ class ActionModule(ActionBase):
         'macosx': 'who -b',
         'solaris': 'who -b',
         'sunos': 'who -b',
+        'vmkernel': 'grep booted /var/log/vmksummary.log | tail -n 1',
     }
 
     SHUTDOWN_COMMANDS = {
         'alpine': 'reboot',
+        'vmkernel': 'reboot',
     }
 
     SHUTDOWN_COMMAND_ARGS = {
@@ -59,10 +61,12 @@ class ActionModule(ActionBase):
         'openbsd': '-r +{delay_min} "{message}"',
         'solaris': '-y -g {delay_sec} -i 6 "{message}"',
         'sunos': '-y -g {delay_sec} -i 6 "{message}"',
+        'vmkernel': '-d {delay_sec}',
     }
 
     TEST_COMMANDS = {
-        'solaris': 'who'
+        'solaris': 'who',
+        'vmkernel': 'who',
     }
 
     def __init__(self, *args, **kwargs):
