commit 0234937ca378b65618e2576e8b97c1ee02dc7d6b
Author: The Magician <magic-modules@google.com>
Date:   Mon Aug 5 15:25:49 2019 -0700

    Bug fixes for GCP modules (#60092)

diff --git a/lib/ansible/modules/cloud/google/gcp_pubsub_subscription_facts.py b/lib/ansible/modules/cloud/google/gcp_pubsub_subscription_facts.py
index 062a91e9cc..478bf57c46 100644
--- a/lib/ansible/modules/cloud/google/gcp_pubsub_subscription_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_pubsub_subscription_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_pubsub_topic_facts.py b/lib/ansible/modules/cloud/google/gcp_pubsub_topic_facts.py
index 7b794fc8ec..527da46be4 100644
--- a/lib/ansible/modules/cloud/google/gcp_pubsub_topic_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_pubsub_topic_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_redis_instance_facts.py b/lib/ansible/modules/cloud/google/gcp_redis_instance_facts.py
index 4c8ea10e32..555bd93afe 100644
--- a/lib/ansible/modules/cloud/google/gcp_redis_instance_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_redis_instance_facts.py
@@ -55,7 +55,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_resourcemanager_project_facts.py b/lib/ansible/modules/cloud/google/gcp_resourcemanager_project_facts.py
index 512ccbf3e4..7d66ff9165 100644
--- a/lib/ansible/modules/cloud/google/gcp_resourcemanager_project_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_resourcemanager_project_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_sourcerepo_repository_facts.py b/lib/ansible/modules/cloud/google/gcp_sourcerepo_repository_facts.py
index 1104fc9dbd..328a39a70d 100644
--- a/lib/ansible/modules/cloud/google/gcp_sourcerepo_repository_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_sourcerepo_repository_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_spanner_database.py b/lib/ansible/modules/cloud/google/gcp_spanner_database.py
index 1ce4fb3dd5..0b54f49874 100644
--- a/lib/ansible/modules/cloud/google/gcp_spanner_database.py
+++ b/lib/ansible/modules/cloud/google/gcp_spanner_database.py
@@ -186,8 +186,7 @@ def create(module, link):
 
 
 def update(module, link):
-    delete(module, self_link(module))
-    create(module, collection(module))
+    module.fail_json(msg="Spanner objects can't be updated to ensure data safety")
 
 
 def delete(module, link):
diff --git a/lib/ansible/modules/cloud/google/gcp_spanner_database_facts.py b/lib/ansible/modules/cloud/google/gcp_spanner_database_facts.py
index 90130dd5f8..b0027a221d 100644
--- a/lib/ansible/modules/cloud/google/gcp_spanner_database_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_spanner_database_facts.py
@@ -60,7 +60,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_spanner_instance.py b/lib/ansible/modules/cloud/google/gcp_spanner_instance.py
index 9cfd81b5cd..764214fff1 100644
--- a/lib/ansible/modules/cloud/google/gcp_spanner_instance.py
+++ b/lib/ansible/modules/cloud/google/gcp_spanner_instance.py
@@ -202,8 +202,7 @@ def create(module, link):
 
 
 def update(module, link):
-    auth = GcpSession(module, 'spanner')
-    return wait_for_operation(module, auth.patch(link, resource_to_update(module)))
+    module.fail_json(msg="Spanner objects can't be updated to ensure data safety")
 
 
 def delete(module, link):
diff --git a/lib/ansible/modules/cloud/google/gcp_spanner_instance_facts.py b/lib/ansible/modules/cloud/google/gcp_spanner_instance_facts.py
index 6b1ecf487a..8891c4e68d 100644
--- a/lib/ansible/modules/cloud/google/gcp_spanner_instance_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_spanner_instance_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_database.py b/lib/ansible/modules/cloud/google/gcp_sql_database.py
index 398d28c111..f1d55122a1 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_database.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_database.py
@@ -187,8 +187,7 @@ def create(module, link, kind):
 
 
 def update(module, link, kind):
-    auth = GcpSession(module, 'sql')
-    return wait_for_operation(module, auth.put(link, resource_to_request(module)))
+    module.fail_json(msg="SQL objects can't be updated to ensure data safety")
 
 
 def delete(module, link, kind):
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_database_facts.py b/lib/ansible/modules/cloud/google/gcp_sql_database_facts.py
index 017f5d3161..bea7019fcc 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_database_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_database_facts.py
@@ -55,7 +55,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_instance.py b/lib/ansible/modules/cloud/google/gcp_sql_instance.py
index c8ba028a61..49a0828476 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_instance.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_instance.py
@@ -763,8 +763,7 @@ def create(module, link, kind):
 
 
 def update(module, link, kind, fetch):
-    auth = GcpSession(module, 'sql')
-    return wait_for_operation(module, auth.put(link, resource_to_request(module)))
+    module.fail_json(msg="SQL objects can't be updated to ensure data safety")
 
 
 def delete(module, link, kind, fetch):
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_instance_facts.py b/lib/ansible/modules/cloud/google/gcp_sql_instance_facts.py
index 1587eafec3..c7a0f71f5b 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_instance_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_instance_facts.py
@@ -49,7 +49,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_user.py b/lib/ansible/modules/cloud/google/gcp_sql_user.py
index 64dca81f6f..50d4a5386a 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_user.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_user.py
@@ -215,7 +215,7 @@ def resource_to_request(module):
 
 
 def unwrap_resource_filter(module):
-    return {'host': module.params['host'], 'name': module.params['name']}
+    return {'name': module.params['name'], 'host': module.params['host']}
 
 
 def unwrap_resource(result, module):
diff --git a/lib/ansible/modules/cloud/google/gcp_sql_user_facts.py b/lib/ansible/modules/cloud/google/gcp_sql_user_facts.py
index 989652cbce..2ea0ff9c64 100644
--- a/lib/ansible/modules/cloud/google/gcp_sql_user_facts.py
+++ b/lib/ansible/modules/cloud/google/gcp_sql_user_facts.py
@@ -60,7 +60,6 @@ EXAMPLES = '''
     project: test_project
     auth_kind: serviceaccount
     service_account_file: "/tmp/auth.pem"
-    state: facts
 '''
 
 RETURN = '''
diff --git a/test/integration/targets/gcp_sql_database/tasks/main.yml b/test/integration/targets/gcp_sql_database/tasks/main.yml
index 9b300adc68..827900e390 100644
--- a/test/integration/targets/gcp_sql_database/tasks/main.yml
+++ b/test/integration/targets/gcp_sql_database/tasks/main.yml
@@ -52,7 +52,6 @@
   assert:
     that:
       - result.changed == true
-      - "result.kind == 'sql#database'"
 - name: verify that database was created
   gcp_sql_database_facts:
       instance: "{{ instance }}"
@@ -81,7 +80,6 @@
   assert:
     that:
       - result.changed == false
-      - "result.kind == 'sql#database'"
 #----------------------------------------------------------
 - name: delete a database
   gcp_sql_database:
diff --git a/test/integration/targets/gcp_sql_instance/tasks/main.yml b/test/integration/targets/gcp_sql_instance/tasks/main.yml
index 96aa398a45..ada068d21a 100644
--- a/test/integration/targets/gcp_sql_instance/tasks/main.yml
+++ b/test/integration/targets/gcp_sql_instance/tasks/main.yml
@@ -47,7 +47,6 @@
   assert:
     that:
       - result.changed == true
-      - "result.kind == 'sql#instance'"
 - name: verify that instance was created
   gcp_sql_instance_facts:
       project: "{{ gcp_project }}"
@@ -80,7 +79,6 @@
   assert:
     that:
       - result.changed == false
-      - "result.kind == 'sql#instance'"
 #----------------------------------------------------------
 - name: delete a instance
   gcp_sql_instance:
diff --git a/test/integration/targets/gcp_sql_user/tasks/main.yml b/test/integration/targets/gcp_sql_user/tasks/main.yml
index 78e1005991..e7c5b2b0ac 100644
--- a/test/integration/targets/gcp_sql_user/tasks/main.yml
+++ b/test/integration/targets/gcp_sql_user/tasks/main.yml
@@ -54,7 +54,6 @@
   assert:
     that:
       - result.changed == true
-      - "result.kind == 'sql#user'"
 - name: verify that user was created
   gcp_sql_user_facts:
       instance: "{{ instance }}"
@@ -84,7 +83,6 @@
   assert:
     that:
       - result.changed == false
-      - "result.kind == 'sql#user'"
 #----------------------------------------------------------
 - name: delete a user
   gcp_sql_user:
diff --git a/test/integration/targets/gcp_storage_bucket/tasks/main.yml b/test/integration/targets/gcp_storage_bucket/tasks/main.yml
index dcf45d5569..d49ec899c1 100644
--- a/test/integration/targets/gcp_storage_bucket/tasks/main.yml
+++ b/test/integration/targets/gcp_storage_bucket/tasks/main.yml
@@ -33,7 +33,6 @@
   assert:
     that:
       - result.changed == true
-      - "result.kind == 'storage#bucket'"
 # ----------------------------------------------------------------------------
 - name: create a bucket that already exists
   gcp_storage_bucket:
@@ -47,7 +46,6 @@
   assert:
     that:
       - result.changed == false
-      - "result.kind == 'storage#bucket'"
 #----------------------------------------------------------
 - name: delete a bucket
   gcp_storage_bucket:
diff --git a/test/integration/targets/gcp_storage_bucket_access_control/tasks/main.yml b/test/integration/targets/gcp_storage_bucket_access_control/tasks/main.yml
index c37b4397c7..301505a1fe 100644
--- a/test/integration/targets/gcp_storage_bucket_access_control/tasks/main.yml
+++ b/test/integration/targets/gcp_storage_bucket_access_control/tasks/main.yml
@@ -45,7 +45,6 @@
   assert:
     that:
       - result.changed == true
-      - "result.kind == 'storage#bucketAccessControl'"
 # ----------------------------------------------------------------------------
 - name: create a bucket access control that already exists
   gcp_storage_bucket_access_control:
@@ -61,7 +60,6 @@
   assert:
     that:
       - result.changed == false
-      - "result.kind == 'storage#bucketAccessControl'"
 #----------------------------------------------------------
 - name: delete a bucket access control
   gcp_storage_bucket_access_control:
