commit 3506febbb9f4cf702bf0f8427bc800ee5a5cb54e
Author: Greg <gate@ilive4code.net>
Date:   Sun Feb 26 01:14:45 2017 -0500

    Fixing issue related to writing ini files
    
    When the file is opened with rwa+ and the update file size is smaller than the original the ini file can become corrupt.  The issue was noticed when we had comments at the top of /etc/yum/pluginconf.d/rhnplugin.conf after using the rhn_register module the file became correct.
    
    rwa+ also make no sense as the file is only written too and why would any appending need to happen?

diff --git a/lib/ansible/module_utils/redhat.py b/lib/ansible/module_utils/redhat.py
index cc79f0f858..1eb6938514 100644
--- a/lib/ansible/module_utils/redhat.py
+++ b/lib/ansible/module_utils/redhat.py
@@ -66,7 +66,7 @@ class RegistrationBase(object):
                 cfg.set('main', 'enabled', 1)
             else:
                 cfg.set('main', 'enabled', 0)
-            fd = open(plugin_conf, 'rwa+')
+            fd = open(plugin_conf, 'w+')
             cfg.write(fd)
             fd.close()
 
