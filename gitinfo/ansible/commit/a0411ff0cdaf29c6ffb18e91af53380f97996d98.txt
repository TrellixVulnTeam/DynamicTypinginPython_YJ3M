commit a0411ff0cdaf29c6ffb18e91af53380f97996d98
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Mon Jul 20 23:09:59 2015 -0700

    Port librarto_annotation from urllib2 to fetch_url

diff --git a/lib/ansible/modules/extras/monitoring/librato_annotation.py b/lib/ansible/modules/extras/monitoring/librato_annotation.py
index 17b42284ba..6d58b223f1 100644
--- a/lib/ansible/modules/extras/monitoring/librato_annotation.py
+++ b/lib/ansible/modules/extras/monitoring/librato_annotation.py
@@ -105,9 +105,6 @@ EXAMPLES = '''
     end_time: 1395954406
 '''
 
-
-import urllib2
-
 def post_annotation(module):
     user = module.params['user']
     api_key = module.params['api_key']
@@ -134,10 +131,9 @@ def post_annotation(module):
     headers = {}
     headers['Content-Type'] = 'application/json'
     headers['Authorization'] = "Basic " + base64.b64encode(user + ":" + api_key).strip()
-    req = urllib2.Request(url, json_body, headers)
-    try:
-        response = urllib2.urlopen(req)
-    except urllib2.HTTPError, e:
+
+    response, info = fetch_url(module, url, data=json_body, headers=headers)
+    if info['status'] != 200:
         module.fail_json(msg="Request Failed", reason=e.reason)
     response = response.read()
     module.exit_json(changed=True, annotation=response)
@@ -161,4 +157,6 @@ def main():
   post_annotation(module)
 
 from ansible.module_utils.basic import *
-main()
+from ansible.module_utils.urls import *
+if __name__ == '__main__':
+    main()
