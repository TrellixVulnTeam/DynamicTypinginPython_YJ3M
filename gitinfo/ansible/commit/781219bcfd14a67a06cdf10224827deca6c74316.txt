commit 781219bcfd14a67a06cdf10224827deca6c74316
Author: Matt Clay <matt@mystile.com>
Date:   Fri Nov 17 10:33:50 2017 -0800

    Fix and re-enable zypper* integration tests in CI.

diff --git a/test/integration/targets/zypper/aliases b/test/integration/targets/zypper/aliases
index 676400008d..71a97e873d 100644
--- a/test/integration/targets/zypper/aliases
+++ b/test/integration/targets/zypper/aliases
@@ -1,4 +1,5 @@
 destructive
+posix/ci/group1
 skip/freebsd
 skip/osx
 skip/rhel
diff --git a/test/integration/targets/zypper/tasks/zypper.yml b/test/integration/targets/zypper/tasks/zypper.yml
index df1111d45c..2f9463ea09 100644
--- a/test/integration/targets/zypper/tasks/zypper.yml
+++ b/test/integration/targets/zypper/tasks/zypper.yml
@@ -189,6 +189,7 @@
 - name: install empty rpm
   zypper:
     name: "{{ output_dir | expanduser }}/zypper2/rpm-build/noarch/empty-1-0.noarch.rpm"
+    disable_gpg_check: yes
   register: zypper_result
 
 - name: check empty with rpm
@@ -285,7 +286,7 @@
       - zypper_patch.msg.startswith('Can not remove patches.')
 
 - name: try rm URL
-  zypper: name=http://download.opensuse.org/repositories/openSUSE:/Leap:/42.1/standard/x86_64/hello-2.9-6.2.x86_64.rpm state=absent
+  zypper: name=http://download.opensuse.org/repositories/openSUSE:/Leap:/{{ ansible_distribution_version }}/standard/x86_64/hello-2.9-6.2.x86_64.rpm state=absent
   ignore_errors: yes
   register: zypper_rm
 - assert:
@@ -293,53 +294,6 @@
       - zypper_rm|failed
       - zypper_rm.msg.startswith('Can not remove via URL.')
 
-# use of version specific (42.1) data in the following
-- block:
-  # test for #1627
-  - name: in existing patch
-    zypper: name=openSUSE-2016-128 type=patch state=present
-  - name: in existing patch again
-    zypper: name=openSUSE-2016-128 type=patch state=present
-    register: zypper_patch
-  - assert:
-      that: not zypper_patch.changed
-
-  - name: in non-existing patch
-    zypper: name=openSUSE-1800-1 type=patch state=present
-    ignore_errors: yes
-    register: zypper_patch
-  - assert:
-      that: zypper_patch|failed
-
-  - name: remove pattern update_test
-    zypper: name=update_test type=pattern state=absent
-  - name: install pattern update_test
-    zypper: name=update_test type=pattern state=present
-    register: zypper_install_pattern1
-  - name: install pattern update_test again
-    zypper: name=update_test type=pattern state=present
-    register: zypper_install_pattern2
-  - assert:
-      that:
-        - zypper_install_pattern1|changed
-        - not zypper_install_pattern2|changed
-
-  - name: remove hello
-    zypper: name=hello state=absent
-  - name: install via URL
-    zypper: state=present name=http://download.opensuse.org/repositories/openSUSE:/Leap:/42.1/standard/x86_64/hello-2.9-6.2.x86_64.rpm
-    register: zypperin1
-  - name: test install
-    zypper: name=hello state=present
-    register: zypperin2
-  - assert:
-      that:
-        - zypperin1|success
-        - zypperin1|changed
-        - not zypperin2|changed
-  when: ansible_distribution == 'openSUSE Leap' and ansible_distribution_version == '42.1'
-
-
 # check for https://github.com/ansible/ansible/issues/20139
 - name: run updatecache
   zypper:
diff --git a/test/integration/targets/zypper_repository/aliases b/test/integration/targets/zypper_repository/aliases
index 676400008d..71a97e873d 100644
--- a/test/integration/targets/zypper_repository/aliases
+++ b/test/integration/targets/zypper_repository/aliases
@@ -1,4 +1,5 @@
 destructive
+posix/ci/group1
 skip/freebsd
 skip/osx
 skip/rhel
diff --git a/test/integration/targets/zypper_repository/tasks/zypper_repository.yml b/test/integration/targets/zypper_repository/tasks/zypper_repository.yml
index 36cd09f810..35f8f8d93b 100644
--- a/test/integration/targets/zypper_repository/tasks/zypper_repository.yml
+++ b/test/integration/targets/zypper_repository/tasks/zypper_repository.yml
@@ -39,7 +39,7 @@
   zypper_repository:
     name: test
     state: present
-    repo: http://download.videolan.org/pub/vlc/SuSE/Leap_42.1/
+    repo: http://download.videolan.org/pub/vlc/SuSE/Leap_{{ ansible_distribution_version }}/
   register: zypper_result
 
 - name: Verify change on URL only change
@@ -57,7 +57,7 @@
     name: testrefresh
     refresh: no
     state: present
-    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+    repo: http://download.opensuse.org/distribution/leap/{{ ansible_distribution_version }}/repo/oss/
 
 - name: check refreshoption
   command: zypper -x lr testrefresh
@@ -72,7 +72,7 @@
     name: testprio
     priority: 55
     state: present
-    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+    repo: http://download.opensuse.org/distribution/leap/{{ ansible_distribution_version }}/repo/oss/
 
 - name: check refreshoption
   command: zypper -x lr testprio
@@ -86,7 +86,7 @@
   zypper_repository:
     name: "{{item}}"
     state: present
-    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+    repo: http://download.opensuse.org/distribution/leap/{{ ansible_distribution_version }}/repo/oss/
   with_items:
     - oss1
     - oss2
@@ -105,14 +105,14 @@
       - "zypper_result1.rc == 6"
       - "'not found' in zypper_result1.stderr"
       - "zypper_result2.rc == 0"
-      - "'http://download.opensuse.org/distribution/leap/42.1/repo/oss/' in zypper_result2.stdout"
+      - "'http://download.opensuse.org/distribution/leap/{{ ansible_distribution_version }}/repo/oss/' in zypper_result2.stdout"
 
 
 - name: reset oss repo (to not break zypper later)
   zypper_repository:
     name: OSS
     state: present
-    repo: http://download.opensuse.org/distribution/leap/42.1/repo/oss/
+    repo: http://download.opensuse.org/distribution/leap/{{ ansible_distribution_version }}/repo/oss/
     priority: 99
     refresh: yes
 
@@ -122,8 +122,8 @@
     state: present
     repo: "{{ item }}"
   with_items:
-    - http://download.opensuse.org/repositories/science/openSUSE_Leap_42.1/
-    - http://download.opensuse.org/repositories/devel:/languages:/python/openSUSE_Leap_42.1/
+    - http://download.opensuse.org/repositories/science/openSUSE_Leap_{{ ansible_distribution_version }}/
+    - http://download.opensuse.org/repositories/devel:/languages:/python/openSUSE_Leap_{{ ansible_distribution_version }}/
 
 - name: check repo is updated by name
   command: zypper lr samename
@@ -136,7 +136,7 @@
 
 - name: remove last added repos (by URL to test that)
   zypper_repository:
-    repo: http://download.opensuse.org/repositories/devel:/languages:/python/openSUSE_Leap_42.1/
+    repo: http://download.opensuse.org/repositories/devel:/languages:/python/openSUSE_Leap_{{ ansible_distribution_version }}/
     state: absent
 
 - name: ensure zypper ref still works
diff --git a/test/runner/completion/docker.txt b/test/runner/completion/docker.txt
index 20d3d54b9f..ef1d2cd6ef 100644
--- a/test/runner/completion/docker.txt
+++ b/test/runner/completion/docker.txt
@@ -3,8 +3,8 @@ centos7@sha256:bd571611112cccefdaa951ea640177cbb77c8ee011f958d2562781d90594ea9c
 default@sha256:424161033bf1342bc463c27c5fad182c171aa3bc17b3c1fe7aac44623cc8d304
 fedora24@sha256:7b642c5d25b779a3a605fb8f70d9d92972f2004a5266fe364264809899fb1117
 fedora25@sha256:828c71d87f1636f4d09916b8e2d87fc9a615d361a9afed22e8843ffb3d2729d2
-opensuse42.2@sha256:fc22d6684910018d2e5f2e8613391b5ae5aca7760d365ac3098971b7aa41d8a2
-opensuse42.3@sha256:7f48e874367528711a1df7ff16da5667d67d2eb15902b8e5151d34546e6af04d
+opensuse42.2@sha256:3c59cd694fe69860d299a10afaa84f4e0b3db0c4139232431e9801e1a0775b0a
+opensuse42.3@sha256:d62cc5f0de0ffddbd32c73271290a4593613bd94fa09b615ac0c025a10bdbe3c
 ubuntu1404@sha256:ba27d23e815a4c3fb361001aea2ef70241d66f08bdf962cf5717037e882ff78a
 ubuntu1604@sha256:ff3898ac817a10ec7129f6483721a717ed0d98c6ba42c27be1472d73908568da
 ubuntu1604py3@sha256:f0b7883eb3f17ee7cb3a77f4aeea0d743101e103f93a76f4f5120aed9c44c0bc
