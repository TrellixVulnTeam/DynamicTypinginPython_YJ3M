commit 98a3fa2dac2e403cf5039a197596f2dff2d239a0
Author: Yuwei Zhou <yuwzho@microsoft.com>
Date:   Wed Mar 27 10:57:36 2019 +0800

    Fix aks failure (#54381)

diff --git a/lib/ansible/modules/cloud/azure/azure_rm_aks.py b/lib/ansible/modules/cloud/azure/azure_rm_aks.py
index 6984d8659a..4df1e7daec 100644
--- a/lib/ansible/modules/cloud/azure/azure_rm_aks.py
+++ b/lib/ansible/modules/cloud/azure/azure_rm_aks.py
@@ -539,9 +539,9 @@ class AzureRMManagedCluster(AzureRMModuleBase):
             if agentpoolcount > 1:
                 self.fail('You cannot specify more than one agent_pool_profiles currently')
 
+            available_versions = self.get_all_versions()
             if not response:
                 to_be_updated = True
-                available_versions = self.get_all_versions()
                 if self.kubernetes_version not in available_versions.keys():
                     self.fail("Unsupported kubernetes version. Expected one of {0} but got {1}".format(available_versions.keys(), self.kubernetes_version))
             else:
