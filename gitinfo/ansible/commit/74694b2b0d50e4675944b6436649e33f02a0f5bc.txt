commit 74694b2b0d50e4675944b6436649e33f02a0f5bc
Author: nitzmahone <mdavis@ansible.com>
Date:   Mon Aug 31 16:38:23 2015 -0700

    moved WinRM setup script test after config

diff --git a/examples/scripts/ConfigureRemotingForAnsible.ps1 b/examples/scripts/ConfigureRemotingForAnsible.ps1
index 1b45ce442b..a67ea8afb2 100644
--- a/examples/scripts/ConfigureRemotingForAnsible.ps1
+++ b/examples/scripts/ConfigureRemotingForAnsible.ps1
@@ -105,31 +105,6 @@ Else
     Write-Verbose "PS Remoting is already enabled."
 }
 
-
-# Test a remoting connection to localhost, which should work.
-$httpResult = Invoke-Command -ComputerName "localhost" -ScriptBlock {$env:COMPUTERNAME} -ErrorVariable httpError -ErrorAction SilentlyContinue
-$httpsOptions = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck
-
-$httpsResult = New-PSSession -UseSSL -ComputerName "localhost" -SessionOption $httpsOptions -ErrorVariable httpsError -ErrorAction SilentlyContinue
-
-If ($httpResult -and $httpsResult)
-{
-    Write-Verbose "HTTP and HTTPS sessions are enabled."
-}
-ElseIf ($httpsResult -and !$httpResult)
-{
-    Write-Verbose "HTTP sessions are disabled, HTTPS session are enabled."
-}
-ElseIf ($httpResult -and !$httpsResult)
-{
-    Write-Verbose "HTTPS sessions are disabled, HTTP session are enabled."
-}
-Else
-{
-    Throw "Unable to establish an HTTP or HTTPS remoting session."
-}
-
-
 # Make sure there is a SSL listener.
 $listeners = Get-ChildItem WSMan:\localhost\Listener
 If (!($listeners | Where {$_.Keys -like "TRANSPORT=HTTPS"}))
@@ -194,5 +169,27 @@ Else
     Write-Verbose "Firewall rule already exists to allow WinRM HTTPS."
 }
 
+# Test a remoting connection to localhost, which should work.
+$httpResult = Invoke-Command -ComputerName "localhost" -ScriptBlock {$env:COMPUTERNAME} -ErrorVariable httpError -ErrorAction SilentlyContinue
+$httpsOptions = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck
+
+$httpsResult = New-PSSession -UseSSL -ComputerName "localhost" -SessionOption $httpsOptions -ErrorVariable httpsError -ErrorAction SilentlyContinue
+
+If ($httpResult -and $httpsResult)
+{
+    Write-Verbose "HTTP and HTTPS sessions are enabled."
+}
+ElseIf ($httpsResult -and !$httpResult)
+{
+    Write-Verbose "HTTP sessions are disabled, HTTPS session are enabled."
+}
+ElseIf ($httpResult -and !$httpsResult)
+{
+    Write-Verbose "HTTPS sessions are disabled, HTTP session are enabled."
+}
+Else
+{
+    Throw "Unable to establish an HTTP or HTTPS remoting session."
+}
 
 Write-Verbose "PS Remoting has been successfully configured for Ansible."
