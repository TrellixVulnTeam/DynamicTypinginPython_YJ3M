commit 4452ee86bdb952faa59cf0125245e433bc298fed
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Wed Sep 28 10:52:33 2016 -0700

    Turn mount test back on (#17797)
    
    * Turn mount test back on
    
    * Mount tests need PRIVILEGED so turn that back on
    
    Revert "Revert "Set PRIVILEGED=true for non_destructive tests. (#17733)" (#17738)"
    
    This reverts commit dc0fb1c212df5f08490c3e959b9dce64ff540169.
    
    * Add a needs_privileged tag so that we can skip mount tests on centos6
    
    Some containers timeout on shippable tests when run with privileged.
    Unfortunately, some tests require that in order to run.  Tagging those
    allows us to skip those tests on the platforms that timeout when we get
    ready to run the integration test in shippable.
    
    * Centos6 times out with PRIVILEGED set so remove that (will disable the mount tests on centos6)
    
    * Remove false start

diff --git a/shippable.yml b/shippable.yml
index f10b7b2299..4aeefc8364 100644
--- a/shippable.yml
+++ b/shippable.yml
@@ -27,14 +27,14 @@ matrix:
     - env: TEST=integration TARGET=destructive IMAGE=ansible/ansible:ubuntu1604py3 PYTHON3=1
 
     - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:centos6
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:centos7
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:fedora-rawhide
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:fedora23
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:opensuseleap
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1204
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1404
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1604
-    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1604py3 PYTHON3=1
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:centos7 PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:fedora-rawhide PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:fedora23 PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:opensuseleap PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1204 PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1404 PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1604 PRIVILEGED=true
+    - env: TEST=integration TARGET=non_destructive IMAGE=ansible/ansible:ubuntu1604py3 PYTHON3=1 PRIVILEGED=true
 
     - env: TEST=integration TARGET=other IMAGE=ansible/ansible:centos6
     - env: TEST=integration TARGET=other IMAGE=ansible/ansible:centos7
diff --git a/test/integration/non_destructive.yml b/test/integration/non_destructive.yml
index 582a038551..5ee1b8c6e6 100644
--- a/test/integration/non_destructive.yml
+++ b/test/integration/non_destructive.yml
@@ -44,4 +44,4 @@
     - { role: test_add_host, tags: test_add_host }
     - { role: test_binary, tags: test_binary }
     - { role: test_loops, tags: test_loops }
-      #- { role: test_mount, tags: [test_mount, requires_root] }
+    - { role: test_mount, tags: [test_mount, needs_root, needs_privileged]}
diff --git a/test/utils/shippable/integration.sh b/test/utils/shippable/integration.sh
index 9c2031f157..35891b02f4 100755
--- a/test/utils/shippable/integration.sh
+++ b/test/utils/shippable/integration.sh
@@ -109,6 +109,10 @@ if [ "${test_python3}" ]; then
     test_flags="--skip-tags ${skip_tags} ${test_flags}"
 fi
 
+if [ "${test_privileged}" = 'false' ]; then
+    test_flags="--skip-tags needs_privileged ${test_flags}"
+fi
+
 if [ -z "${share_source}" ]; then
     docker exec "${container_id}" cp -a "${test_shared_dir}" "${test_ansible_dir}"
 fi
