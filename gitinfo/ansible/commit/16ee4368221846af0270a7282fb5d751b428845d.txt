commit 16ee4368221846af0270a7282fb5d751b428845d
Author: Alex Stephen <alexstephen@google.com>
Date:   Fri Jun 8 07:19:25 2018 -0700

    GCP: Fix gcp_instance metadata keys (#41293)

diff --git a/lib/ansible/modules/cloud/google/gcp_compute_instance.py b/lib/ansible/modules/cloud/google/gcp_compute_instance.py
index 4f49552e39..cb48c1deca 100644
--- a/lib/ansible/modules/cloud/google/gcp_compute_instance.py
+++ b/lib/ansible/modules/cloud/google/gcp_compute_instance.py
@@ -1108,7 +1108,10 @@ def metadata_encoder(metadata):
     metadata_new = []
     for key in metadata:
         value = metadata[key]
-        metadata_new.append({key: value})
+        metadata_new.append({
+            "key": key,
+            "value": value
+        })
     return {
         'items': metadata_new
     }
@@ -1120,7 +1123,7 @@ def metadata_decoder(metadata):
     if 'items' in metadata:
         metadata_items = metadata['items']
         for item in metadata_items:
-            items[item.keys()[0]] = item[item.keys()[0]]
+            items[item['key']] = item['value']
     return items
 
 
