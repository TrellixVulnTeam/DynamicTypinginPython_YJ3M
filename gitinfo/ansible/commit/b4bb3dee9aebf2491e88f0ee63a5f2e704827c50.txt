commit b4bb3dee9aebf2491e88f0ee63a5f2e704827c50
Author: Andrea Tartaglia <andrea@braingap.uk>
Date:   Thu Oct 17 15:22:15 2019 +0100

    gitlab_user: Fix ssh key add and group membership add when there's other changes (#63621)
    
    * Fixed syntax in sshkey/group add
    
    * Added changelog
    
    * pep8 fix

diff --git a/changelogs/fragments/63621-gitlab_user-fix-sshkey-and-user.yml b/changelogs/fragments/63621-gitlab_user-fix-sshkey-and-user.yml
new file mode 100644
index 0000000000..78e49c5e28
--- /dev/null
+++ b/changelogs/fragments/63621-gitlab_user-fix-sshkey-and-user.yml
@@ -0,0 +1,2 @@
+bugfixes:
+- "gitlab_user - Fix adding ssh key to new/changed user and adding group membership for new/changed user"
diff --git a/lib/ansible/modules/source_control/gitlab_user.py b/lib/ansible/modules/source_control/gitlab_user.py
index cb730bfd07..43b8e68920 100644
--- a/lib/ansible/modules/source_control/gitlab_user.py
+++ b/lib/ansible/modules/source_control/gitlab_user.py
@@ -233,13 +233,15 @@ class GitLabUser(object):
 
         # Assign ssh keys
         if options['sshkey_name'] and options['sshkey_file']:
-            changed = changed or self.addSshKeyToUser(user, {
+            key_changed = self.addSshKeyToUser(user, {
                 'name': options['sshkey_name'],
                 'file': options['sshkey_file']})
+            changed = changed or key_changed
 
         # Assign group
         if options['group_path']:
-            changed = changed or self.assignUserToGroup(user, options['group_path'], options['access_level'])
+            group_changed = self.assignUserToGroup(user, options['group_path'], options['access_level'])
+            changed = changed or group_changed
 
         self.userObject = user
         if changed:
