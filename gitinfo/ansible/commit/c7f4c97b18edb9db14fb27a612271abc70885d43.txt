commit c7f4c97b18edb9db14fb27a612271abc70885d43
Author: Guillaume Cor√© <guillaume.core@gmail.com>
Date:   Fri Apr 21 07:06:01 2017 +0200

    async+script: add integration test (#23818)
    
    see #23729

diff --git a/test/integration/targets/script/tasks/main.yml b/test/integration/targets/script/tasks/main.yml
index 2c0f1f02ad..6650ede6f0 100644
--- a/test/integration/targets/script/tasks/main.yml
+++ b/test/integration/targets/script/tasks/main.yml
@@ -69,3 +69,17 @@
     that:
       - "script_result1|changed"
       - "script_result2.state == 'absent'"
+
+# async
+- name: test task failure with async param
+
+  script: /some/script.sh
+  async: 2
+  ignore_errors: true
+  register: script_result3
+
+- name: assert task with async param failed
+  assert:
+    that:
+      - 'script_result3.failed'
+      - 'script_result3.msg == "async is not supported for this task."'
