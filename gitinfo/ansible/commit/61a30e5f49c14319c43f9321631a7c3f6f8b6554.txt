commit 61a30e5f49c14319c43f9321631a7c3f6f8b6554
Author: Brian Coca <bcoca@ansible.com>
Date:   Wed Dec 3 07:26:42 2014 -0500

    better exception handling with delegated hosts

diff --git a/lib/ansible/inventory/__init__.py b/lib/ansible/inventory/__init__.py
index 7d279b7b4d..2048046d3c 100644
--- a/lib/ansible/inventory/__init__.py
+++ b/lib/ansible/inventory/__init__.py
@@ -420,7 +420,7 @@ class Inventory(object):
 
         group = self.get_group(groupname)
         if group is None:
-            raise Exception("group not found: %s" % groupname)
+            raise errors.AnsibleError("group not found: %s" % groupname)
 
         vars = {}
 
@@ -439,7 +439,7 @@ class Inventory(object):
 
         host = self.get_host(hostname)
         if not host:
-            raise Exception("host not found: %s" % hostname)
+            raise errors.AnsibleError("host not found: %s" % hostname)
         return host.get_variables()
 
     def get_host_variables(self, hostname, update_cached=False, vault_password=None):
diff --git a/lib/ansible/runner/__init__.py b/lib/ansible/runner/__init__.py
index f0de42764a..fad769c4ed 100644
--- a/lib/ansible/runner/__init__.py
+++ b/lib/ansible/runner/__init__.py
@@ -394,20 +394,20 @@ class Runner(object):
         actual_user = inject.get('ansible_ssh_user', self.remote_user)
         thisuser = None
 
-        if host in inject['hostvars']:
-            if inject['hostvars'][host].get('ansible_ssh_user'):
-                # user for delegate host in inventory
-                thisuser = inject['hostvars'][host].get('ansible_ssh_user')
-        else:
-            # look up the variables for the host directly from inventory
-            try:
-                host_vars = self.inventory.get_variables(host, vault_password=self.vault_pass)
-                if 'ansible_ssh_user' in host_vars:
-                    thisuser = host_vars['ansible_ssh_user']
-            except Exception, e:
-                # the hostname was not found in the inventory, so
-                # we just ignore this and try the next method
-                pass
+        try:
+            if host in inject['hostvars']:
+                if inject['hostvars'][host].get('ansible_ssh_user'):
+                    # user for delegate host in inventory
+                    thisuser = inject['hostvars'][host].get('ansible_ssh_user')
+                else:
+                    # look up the variables for the host directly from inventory
+                    host_vars = self.inventory.get_variables(host, vault_password=self.vault_pass)
+                    if 'ansible_ssh_user' in host_vars:
+                        thisuser = host_vars['ansible_ssh_user']
+        except errors.AnsibleException, e:
+            # the hostname was not found in the inventory, so
+            # we just ignore this and try the next method
+            pass
 
         if thisuser is None and self.remote_user:
             # user defined by play/runner
