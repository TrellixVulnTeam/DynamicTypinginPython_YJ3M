commit a2ea785d694242dbd0c3ff1ad065b0f53d1da664
Author: Matt Stephenson <mattstep@mattstep.net>
Date:   Mon Feb 23 13:42:03 2015 -0800

    Add function to ipaddr for getting the nth host within a network

diff --git a/lib/ansible/runner/filter_plugins/ipaddr.py b/lib/ansible/runner/filter_plugins/ipaddr.py
index 0a86e5200e..5d9d6e3136 100644
--- a/lib/ansible/runner/filter_plugins/ipaddr.py
+++ b/lib/ansible/runner/filter_plugins/ipaddr.py
@@ -555,6 +555,38 @@ def ipsubnet(value, query = '', index = 'x'):
 
     return False
 
+# Returns the nth host within a network described by value.
+# Usage:
+#
+#  - address or address/prefix | nthhost(nth)
+#      returns the nth host within the given network
+def nthhost(value, query=''):
+    ''' Get the nth host within a given network '''
+    try:
+        vtype = ipaddr(value, 'type')
+        if vtype == 'address':
+            v = ipaddr(value, 'cidr')
+        elif vtype == 'network':
+            v = ipaddr(value, 'subnet')
+
+        value = netaddr.IPNetwork(v)
+    except:
+        return False
+
+    if not query:
+        return False
+
+    try:
+        vsize = ipaddr(v, 'size')
+        nth = int(query)
+        if value.size > nth:
+          return value[nth]
+
+    except ValueError:
+        return False
+
+    return False
+
 
 # ---- HWaddr / MAC address filters ----
 
@@ -612,6 +644,7 @@ class FilterModule(object):
         'ipv4': ipv4,
         'ipv6': ipv6,
         'ipsubnet': ipsubnet,
+        'nthhost': nthhost,
 
         # MAC / HW addresses
         'hwaddr': hwaddr,
