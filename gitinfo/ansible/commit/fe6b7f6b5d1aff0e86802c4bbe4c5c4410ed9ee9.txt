commit fe6b7f6b5d1aff0e86802c4bbe4c5c4410ed9ee9
Author: Vinay Dandekar <vindansam@hotmail.com>
Date:   Mon Sep 24 12:41:23 2018 -0400

    [aws] Change IAM role name parsing to come from the ARN (#45534)

diff --git a/lib/ansible/modules/cloud/amazon/ec2_metadata_facts.py b/lib/ansible/modules/cloud/amazon/ec2_metadata_facts.py
index 5a0f542f3a..2416f9f31c 100644
--- a/lib/ansible/modules/cloud/amazon/ec2_metadata_facts.py
+++ b/lib/ansible/modules/cloud/amazon/ec2_metadata_facts.py
@@ -467,8 +467,8 @@ class Ec2Metadata(object):
         new_fields = {}
         for key, value in fields.items():
             split_fields = key[len(uri):].split('/')
-            if len(split_fields) == 3 and split_fields[0:2] == ['iam', 'security-credentials']:
-                new_fields[self._prefix % "iam-instance-profile-role"] = split_fields[2]
+            if len(split_fields) == 2 and split_fields[0:2] == ['iam', 'info_instanceprofilearn']:
+                new_fields[self._prefix % "iam-instance-profile-role"] = value.split('/')[1]
             if len(split_fields) > 1 and split_fields[1]:
                 new_key = "-".join(split_fields)
                 new_fields[self._prefix % new_key] = value
