commit d44ed533b38c24c157315bd374bc259ece305899
Author: James Cammarata <jimi@sngx.net>
Date:   Mon May 19 23:04:13 2014 -0500

    Default use_proxy to True for fetch_url()
    
    Also added some error handling to the fetch_url() call in the
    apt_repository module, so that failures to look up the PPA info
    are properly handled.
    
    Fixes #7322

diff --git a/lib/ansible/module_utils/urls.py b/lib/ansible/module_utils/urls.py
index f4e50233d1..4edab47167 100644
--- a/lib/ansible/module_utils/urls.py
+++ b/lib/ansible/module_utils/urls.py
@@ -291,7 +291,7 @@ def url_argument_spec():
 
 
 def fetch_url(module, url, data=None, headers=None, method=None, 
-              use_proxy=False, force=False, last_mod_time=None, timeout=10):
+              use_proxy=True, force=False, last_mod_time=None, timeout=10):
     '''
     Fetches a file from an HTTP/FTP server using urllib2
     '''
diff --git a/library/packaging/apt_repository b/library/packaging/apt_repository
index a33c5735a8..e10d2c5492 100644
--- a/library/packaging/apt_repository
+++ b/library/packaging/apt_repository
@@ -320,6 +320,8 @@ class UbuntuSourcesList(SourcesList):
 
         headers = dict(Accept='application/json')
         response, info = fetch_url(self.module, lp_api, headers=headers)
+        if info['status'] != 200:
+            self.module.fail_json(msg="failed to fetch PPA information, error was: %s" % info['msg'])
         return json.load(response)
 
     def _expand_ppa(self, path):
