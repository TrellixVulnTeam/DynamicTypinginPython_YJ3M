commit c55187ff42eb9211da3a04ed5e079e774e365cac
Author: Andrey Trubachev <d3rp@yandex-team.ru>
Date:   Sat Jan 3 10:32:27 2015 +0300

    Fix 'wait_for' doesn't work with ipv6only host

diff --git a/lib/ansible/modules/utilities/logic/wait_for.py b/lib/ansible/modules/utilities/logic/wait_for.py
index 95653b56d3..aa6bd1050c 100644
--- a/lib/ansible/modules/utilities/logic/wait_for.py
+++ b/lib/ansible/modules/utilities/logic/wait_for.py
@@ -362,10 +362,8 @@ def main():
                 except IOError:
                     break
             elif port:
-                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
-                s.settimeout(connect_timeout)
                 try:
-                    s.connect( (host, port) )
+                    s = socket.create_connection( (host, port), connect_timeout)
                     s.shutdown(socket.SHUT_RDWR)
                     s.close()
                     time.sleep(1)
@@ -410,10 +408,8 @@ def main():
                         elapsed = datetime.datetime.now() - start
                         module.fail_json(msg="Failed to stat %s, %s" % (path, e.strerror), elapsed=elapsed.seconds)
             elif port:
-                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
-                s.settimeout(connect_timeout)
                 try:
-                    s.connect( (host, port) )
+                    s = socket.create_connection( (host, port), connect_timeout)
                     if search_regex:
                         data = ''
                         matched = False
