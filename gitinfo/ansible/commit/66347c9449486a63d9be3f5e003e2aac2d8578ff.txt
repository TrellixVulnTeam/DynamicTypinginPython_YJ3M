commit 66347c9449486a63d9be3f5e003e2aac2d8578ff
Author: Marius Gedminas <marius@gedmin.as>
Date:   Thu Nov 19 09:21:06 2015 +0200

    Fix NameError when using loops
    
    vars_copy disappeared in 3d1255d19009aa084fd2635917916fd9396ea898.
    
    Fixes #13213.

diff --git a/lib/ansible/executor/task_executor.py b/lib/ansible/executor/task_executor.py
index 48ba2f2414..fb1e57d4ce 100644
--- a/lib/ansible/executor/task_executor.py
+++ b/lib/ansible/executor/task_executor.py
@@ -188,7 +188,7 @@ class TaskExecutor:
                         else:
                             raise
                 items = self._shared_loader_obj.lookup_loader.get(self._task.loop, loader=self._loader,
-                        templar=templar).run(terms=loop_terms, variables=vars_copy)
+                        templar=templar).run(terms=loop_terms, variables=self._job_vars)
             else:
                 raise AnsibleError("Unexpected failure in finding the lookup named '%s' in the available lookup plugins" % self._task.loop)
 
