commit 3981c729576b8dbe46b4e2522f9d8f41bf1318ef
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Fri Nov 23 10:58:17 2012 -0500

    Streamline code

diff --git a/library/setup b/library/setup
index 0d3d3a94e6..bd0dfc4a98 100644
--- a/library/setup
+++ b/library/setup
@@ -776,28 +776,18 @@ class LinuxVirtual(Virtual):
         for line in open('/proc/cpuinfo').readlines():
             if re.match('^model name.*QEMU Virtual CPU', line):
                 self.facts['virtualization_type'] = 'kvm'
-                self.facts['virtualization_role'] = 'guest'
-                return
-
-            if re.match('^vendor_id.*User Mode Linux', line):
+            elif re.match('^vendor_id.*User Mode Linux', line):
                 self.facts['virtualization_type'] = 'uml'
-                self.facts['virtualization_role'] = 'guest'
-                return
-
-            if re.match('^model name.*UML', line):
+            elif re.match('^model name.*UML', line):
                 self.facts['virtualization_type'] = 'uml'
-                self.facts['virtualization_role'] = 'guest'
-                return
-
-            if re.match('^vendor_id.*PowerVM Lx86', line):
+            elif re.match('^vendor_id.*PowerVM Lx86', line):
                 self.facts['virtualization_type'] = 'powervm_lx86'
-                self.facts['virtualization_role'] = 'guest'
-                return
-
-            if re.match('^vendor_id.*IBM/S390', line):
+            elif re.match('^vendor_id.*IBM/S390', line):
                 self.facts['virtualization_type'] = 'ibm_systemz'
-                self.facts['virtualization_role'] = 'guest'
-                return
+            else:
+                continue
+            self.facts['virtualization_role'] = 'guest'
+            return
 
         # Beware that we can have both kvm and virtualbox running on a single system
         if os.path.exists("/proc/modules"):
