commit e16367739e5a545b691c85fb9b2e178ff880d37b
Author: curious-eyes <curious.staff@gmail.com>
Date:   Sat Feb 27 21:43:45 2016 +0900

    Fix #2761: gce.py - UnboundLocalError: local variable 'md'

diff --git a/lib/ansible/modules/cloud/google/gce.py b/lib/ansible/modules/cloud/google/gce.py
index ef4f89a759..436bf35563 100644
--- a/lib/ansible/modules/cloud/google/gce.py
+++ b/lib/ansible/modules/cloud/google/gce.py
@@ -404,13 +404,13 @@ def create_instances(module, gce, instance_names):
             except SyntaxError as e:
                 module.fail_json(msg='bad metadata syntax')
 
-    if hasattr(libcloud, '__version__') and libcloud.__version__ < '0.15':
-        items = []
-        for k, v in md.items():
-            items.append({"key": k, "value": v})
-        metadata = {'items': items}
-    else:
-        metadata = md
+        if hasattr(libcloud, '__version__') and libcloud.__version__ < '0.15':
+            items = []
+            for k, v in md.items():
+                items.append({"key": k, "value": v})
+            metadata = {'items': items}
+        else:
+            metadata = md
 
     lc_image = LazyDiskImage(module, gce, image, lc_disks)
     ex_sa_perms = []
