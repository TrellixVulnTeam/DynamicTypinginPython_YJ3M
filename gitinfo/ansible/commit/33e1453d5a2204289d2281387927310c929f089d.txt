commit 33e1453d5a2204289d2281387927310c929f089d
Author: provonet <johan@provonet.org>
Date:   Fri May 25 16:13:48 2018 +0200

    support url scheme (#39683)

diff --git a/lib/ansible/plugins/lookup/consul_kv.py b/lib/ansible/plugins/lookup/consul_kv.py
index 1bfa8c6ecb..2994915974 100644
--- a/lib/ansible/plugins/lookup/consul_kv.py
+++ b/lib/ansible/plugins/lookup/consul_kv.py
@@ -93,7 +93,7 @@ class LookupModule(LookupBase):
                 try:
                     url = os.environ['ANSIBLE_CONSUL_URL']
                     u = urlparse(url)
-                    consul_api = consul.Consul(host=u.hostname, port=u.port)
+                    consul_api = consul.Consul(host=u.hostname, port=u.port, scheme=u.scheme)
                 except KeyError:
                     port = kwargs.get('port', '8500')
                     host = kwargs.get('host', 'localhost')
