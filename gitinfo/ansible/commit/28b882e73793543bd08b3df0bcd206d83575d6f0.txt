commit 28b882e73793543bd08b3df0bcd206d83575d6f0
Author: Matt Clay <matt@mystile.com>
Date:   Wed Mar 1 15:48:14 2017 -0800

    Support ansible commands in sanity tests. (#22172)

diff --git a/test/runner/lib/executor.py b/test/runner/lib/executor.py
index ff12d71256..a3764eaba5 100644
--- a/test/runner/lib/executor.py
+++ b/test/runner/lib/executor.py
@@ -769,9 +769,11 @@ def command_sanity_code_smell(args, _):
                    and os.path.isfile(p)
                    and os.path.basename(p) not in skip_tests)
 
+    env = ansible_environment(args)
+
     for test in tests:
         display.info('Code smell check using %s' % os.path.basename(test))
-        run_command(args, [test])
+        run_command(args, [test], env=env)
 
 
 def command_sanity_validate_modules(args, targets):
