commit b43019f3a1a595637054d021251bcb7807de03dd
Author: Michael DeHaan <michael.dehaan@gmail.com>
Date:   Fri Mar 23 20:53:57 2012 -0400

    In playbooks, a return code (rc) of non-zero should fail the playbook.

diff --git a/lib/ansible/playbook.py b/lib/ansible/playbook.py
index 96f179e0c8..d52ef76b3b 100755
--- a/lib/ansible/playbook.py
+++ b/lib/ansible/playbook.py
@@ -214,7 +214,7 @@ class PlayBook(object):
             self.dark[host] = 1
         for (host, host_result) in contacted_hosts.iteritems():
             self.processed[host] = 1
-            if 'failed' in host_result:
+            if 'failed' in host_result or (int(host_result.get('rc',0)) != 0):
                 self.callbacks.on_failed(host, host_result)
                 self.failures[host] = 1
             elif 'skipped' in host_result:
