commit 548cacdf6a28a708142c4a2e4ed1ecba8102b60a
Author: Toshio Kuratomi <a.badger@gmail.com>
Date:   Wed May 10 17:11:11 2017 -0700

    Fix template not showing a diff with a directory
    
    Template can take a directory as the destination.  When that's the case,
    we need to diff between the source and the file inside of the directory.
    That happened when the directory was specified with a trailing slash but
    not when it was specified on its own.  This change fixes that.
    
    Fixes #24413

diff --git a/lib/ansible/plugins/action/template.py b/lib/ansible/plugins/action/template.py
index 6cad672f9e..35bc8d4ce2 100644
--- a/lib/ansible/plugins/action/template.py
+++ b/lib/ansible/plugins/action/template.py
@@ -97,9 +97,14 @@ class ActionModule(ActionBase):
 
         directory_prepended = False
         if dest.endswith(os.sep):
+            # Optimization.  trailing slash means we know it's a directory
             directory_prepended = True
-            base = os.path.basename(source)
-            dest = os.path.join(dest, base)
+            dest = self._connection._shell.join_path(dest, os.path.basename(source))
+        else:
+            # Find out if it's a directory
+            dest_stat = self._execute_remote_stat(dest, task_vars, True, tmp=tmp)
+            if dest_stat['exists'] and dest_stat['isdir']:
+                dest = self._connection._shell.join_path(dest, os.path.basename(source))
 
         # template the source data locally & get ready to transfer
         b_source = to_bytes(source)
