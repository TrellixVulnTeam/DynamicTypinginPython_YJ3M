commit ec7572697a3877d26a5a05569c71a1487556889e
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon Apr 6 17:14:32 2015 +1200

    console: default display mode to new options screen

diff --git a/libmproxy/console/help.py b/libmproxy/console/help.py
index 3b8fbd97..223d2e83 100644
--- a/libmproxy/console/help.py
+++ b/libmproxy/console/help.py
@@ -38,55 +38,6 @@ class HelpView(urwid.ListBox):
         keys = [
             ("c", "client replay"),
             ("i", "set interception pattern"),
-            ("M", "change global default display mode"),
-                (None,
-                    common.highlight_key("automatic", "a") +
-                    [("text", ": automatic detection")]
-                ),
-                (None,
-                    common.highlight_key("hex", "e") +
-                    [("text", ": Hex")]
-                ),
-                (None,
-                    common.highlight_key("html", "h") +
-                    [("text", ": HTML")]
-                ),
-                (None,
-                    common.highlight_key("image", "i") +
-                    [("text", ": Image")]
-                ),
-                (None,
-                    common.highlight_key("javascript", "j") +
-                    [("text", ": JavaScript")]
-                ),
-                (None,
-                    common.highlight_key("json", "s") +
-                    [("text", ": JSON")]
-                ),
-                (None,
-                    common.highlight_key("css", "c") +
-                    [("text", ": CSS")]
-                ),
-                (None,
-                    common.highlight_key("urlencoded", "u") +
-                    [("text", ": URL-encoded data")]
-                ),
-                (None,
-                    common.highlight_key("raw", "r") +
-                    [("text", ": raw data")]
-                ),
-                (None,
-                    common.highlight_key("xml", "x") +
-                    [("text", ": XML")]
-                ),
-                (None,
-                    common.highlight_key("wbxml", "w") +
-                    [("text", ": WBXML")]
-                ),
-                (None,
-                    common.highlight_key("amf", "f") +
-                    [("text", ": AMF (requires PyAMF)")]
-                ),
             ("o", "options"),
             ("q", "quit / return to flow list"),
             ("Q", "quit without confirm prompt"),
diff --git a/libmproxy/console/options.py b/libmproxy/console/options.py
index 10c301f4..2b03f388 100644
--- a/libmproxy/console/options.py
+++ b/libmproxy/console/options.py
@@ -1,6 +1,6 @@
 import urwid
 
-from . import common, signals, grideditor
+from . import common, signals, grideditor, contentview
 
 footer = [
     ('heading_key', "enter/space"), ":toggle ",
@@ -160,7 +160,9 @@ class Options(urwid.WidgetWrap):
                 Heading("Interface"),
                 Option(
                     "Default Display Mode",
-                    "M"
+                    "M",
+                    self.has_default_displaymode,
+                    self.default_displaymode
                 ),
                 Option(
                     "Show Host",
@@ -312,3 +314,13 @@ class Options(urwid.WidgetWrap):
                 self.master.edit_scripts
             )
         )
+
+    def default_displaymode(self):
+        signals.status_prompt_onekey.send(
+            prompt = "Global default display mode",
+            keys = contentview.view_prompts,
+            callback = self.master.change_default_display_mode
+        )
+
+    def has_default_displaymode(self):
+        return self.master.state.default_body_view.name != "Auto"
diff --git a/libmproxy/console/window.py b/libmproxy/console/window.py
index 772102eb..bb811537 100644
--- a/libmproxy/console/window.py
+++ b/libmproxy/console/window.py
@@ -54,12 +54,6 @@ class Window(urwid.Frame):
             raise urwid.ExitMainLoop
         elif k == "q":
             signals.pop_view_state.send(self)
-        elif k == "M":
-            signals.status_prompt_onekey.send(
-                prompt = "Global default display mode",
-                keys = contentview.view_prompts,
-                callback = self.master.change_default_display_mode
-            )
         elif k == "S":
             if not self.master.server_playback:
                 signals.status_prompt_path.send(
