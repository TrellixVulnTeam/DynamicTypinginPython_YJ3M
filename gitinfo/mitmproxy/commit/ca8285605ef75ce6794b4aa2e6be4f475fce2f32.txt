commit ca8285605ef75ce6794b4aa2e6be4f475fce2f32
Author: sanlengjingvv <lankeren123543@gmail.com>
Date:   Sat Jun 27 07:02:03 2020 +0800

    trailers should be Optional

diff --git a/mitmproxy/http.py b/mitmproxy/http.py
index 0a063e65..78878a81 100644
--- a/mitmproxy/http.py
+++ b/mitmproxy/http.py
@@ -140,7 +140,7 @@ class HTTPFlow(flow.Flow):
     """
     request: HTTPRequest
     response: Optional[HTTPResponse] = None
-    trailers: http.Headers
+    trailers: Optional[http.Headers] = None
     error: Optional[flow.Error] = None
     """
     Note that it's possible for a Flow to have both a response and an error
diff --git a/mitmproxy/proxy/protocol/http.py b/mitmproxy/proxy/protocol/http.py
index 7d734d8a..be05cd29 100644
--- a/mitmproxy/proxy/protocol/http.py
+++ b/mitmproxy/proxy/protocol/http.py
@@ -407,10 +407,9 @@ class HttpLayer(base.Layer):
                 self.channel.ask("responseheaders", f)
 
             self.log("response", "debug", [repr(f.response)])
-            self.channel.ask("response", f)
-
             if hasattr(self, 'has_tailers') and self.has_tailers:
                 f.trailers = self.read_trailers_headers()
+            self.channel.ask("response", f)
 
             if not f.response.stream:
                 # no streaming:
