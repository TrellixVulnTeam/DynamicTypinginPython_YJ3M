commit 31a092f6b4678f57cd13c27934189123a5fd6457
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Fri Jul 27 00:19:18 2012 +1200

    Minor refactoring. Make stop_stream also close the associated file descriptor.

diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index ef226641..20020e84 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -1439,13 +1439,13 @@ class FlowMaster(controller.Master):
             for i in self.state._flow_list:
                 if not i.response:
                     self.stream.add(i)
-            self.stream.fo.close()
             self.stop_stream()
 
     def start_stream(self, fp):
         self.stream = FlowWriter(fp)
 
     def stop_stream(self):
+        self.stream.fo.close()
         self.stream = None
 
 
