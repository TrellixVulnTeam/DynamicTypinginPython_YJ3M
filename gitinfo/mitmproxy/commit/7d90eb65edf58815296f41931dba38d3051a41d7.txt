commit 7d90eb65edf58815296f41931dba38d3051a41d7
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sun Apr 8 14:40:59 2012 +1200

    Catch all errors when using jsbeautifier.
    
    Turns out there are some problems that can raise arbitrary exceptions.

diff --git a/libmproxy/console/contentview.py b/libmproxy/console/contentview.py
index 97d217f2..c4e5d9ac 100644
--- a/libmproxy/console/contentview.py
+++ b/libmproxy/console/contentview.py
@@ -232,7 +232,11 @@ def view_urlencoded(hdrs, content):
 def view_javascript(hdrs, content):
     opts = jsbeautifier.default_options()
     opts.indent_size = 2
-    res = jsbeautifier.beautify(content[:VIEW_CUTOFF], opts)
+    try:
+        res = jsbeautifier.beautify(content[:VIEW_CUTOFF], opts)
+    except:
+        # Bugs in jsbeautifier mean that it can trhow arbitrary errors.
+        return None
     return "JavaScript", _view_text(res, len(content))
 
 
