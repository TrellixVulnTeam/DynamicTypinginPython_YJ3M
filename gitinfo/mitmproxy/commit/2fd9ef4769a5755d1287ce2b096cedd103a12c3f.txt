commit 2fd9ef4769a5755d1287ce2b096cedd103a12c3f
Author: Miroslav <ttahabatt@gmail.com>
Date:   Sun Jan 14 13:46:06 2018 +0200

    Other condition

diff --git a/mitmproxy/net/http/url.py b/mitmproxy/net/http/url.py
index d3b93994..f938cb12 100644
--- a/mitmproxy/net/http/url.py
+++ b/mitmproxy/net/http/url.py
@@ -76,9 +76,9 @@ def encode(s: Sequence[Tuple[str, str]], similar_to: str=None) -> str:
 
     encoded = urllib.parse.urlencode(s, False, errors="surrogateescape")
 
-    if remove_trailing_equal:
+    if encoded and remove_trailing_equal:
         encoded = encoded.replace("=&", "&")
-        if encoded and encoded[-1] == '=':
+        if encoded[-1] == '=':
             encoded = encoded[:-1]
 
     return encoded
