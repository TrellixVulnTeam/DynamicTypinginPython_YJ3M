commit ea0c0f8350fc48878886d331a95f1159f7d27833
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Mon Apr 13 13:53:16 2020 +0200

    smoke-test docker images after building

diff --git a/release/cibuild.py b/release/cibuild.py
index 2873a052..85a003f5 100755
--- a/release/cibuild.py
+++ b/release/cibuild.py
@@ -356,6 +356,20 @@ def build_docker_image(be: BuildEnviron):  # pragma: no cover
         "--file", "release/docker/Dockerfile",
         "."
     ])
+    # smoke-test the newly built docker image
+    r = subprocess.run([
+        "docker",
+        "run",
+        "--rm",
+        "--it",
+        "mitmproxy/mitmproxy:" + be.docker_tag,
+        "mitmproxy",
+        "--version",
+    ], check=True)
+    assert "Mitmproxy: " + be.version in r.stdout.decode()
+    assert "Python: " in r.stdout.decode()
+    assert "OpenSSL: " in r.stdout.decode()
+    assert "Platform: " in r.stdout.decode()
 
 
 def build_pyinstaller(be: BuildEnviron):  # pragma: no cover
