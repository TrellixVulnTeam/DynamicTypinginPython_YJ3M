commit 696789b8ec41c6189226896c93eb121014946eff
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Thu Jul 14 09:33:26 2016 +1200

    func.__name__ works in both 2.7 and 3.5
    
    Thanks to @resam and @dwfreed for pointing this out

diff --git a/mitmproxy/controller.py b/mitmproxy/controller.py
index 8b968eb5..2f0c8bf2 100644
--- a/mitmproxy/controller.py
+++ b/mitmproxy/controller.py
@@ -197,9 +197,7 @@ def handler(f):
         with master.handlecontext():
             ret = f(master, message)
             if handling:
-                # Python2/3 compatibility hack
-                fn = getattr(f, "func_name", None) or getattr(f, "__name__")
-                master.addons(fn, message)
+                master.addons(f.__name__, message)
 
         if handling and not message.reply.acked and not message.reply.taken:
             message.reply.ack()
