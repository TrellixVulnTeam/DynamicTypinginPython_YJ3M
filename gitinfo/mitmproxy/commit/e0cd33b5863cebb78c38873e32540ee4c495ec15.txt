commit e0cd33b5863cebb78c38873e32540ee4c495ec15
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Tue Sep 27 16:07:22 2016 -0700

    fix host header modification, refs #1571

diff --git a/mitmproxy/protocol/http.py b/mitmproxy/protocol/http.py
index e1487943..d3e3c80f 100644
--- a/mitmproxy/protocol/http.py
+++ b/mitmproxy/protocol/http.py
@@ -185,8 +185,11 @@ class HttpLayer(base.Layer):
                 return
 
             # update host header in reverse proxy mode
-            if self.mode == "reverse":
-                flow.request.headers["Host"] = self.config.upstream_server.address.host
+            if self.config.options.mode == "reverse":
+                if six.PY2:
+                    flow.request.headers["Host"] = self.config.upstream_server.address.host.encode()
+                else:
+                    flow.request.headers["Host"] = self.config.upstream_server.address.host
 
             # set upstream auth
             if self.mode == "upstream" and self.config.upstream_auth is not None:
