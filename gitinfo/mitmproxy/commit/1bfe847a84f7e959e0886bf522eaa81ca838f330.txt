commit 1bfe847a84f7e959e0886bf522eaa81ca838f330
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sat Aug 18 00:23:41 2012 +1200

    Stop server playback after current playback buffer is exhausted.

diff --git a/libmproxy/console/__init__.py b/libmproxy/console/__init__.py
index 15de4de9..9327ad2c 100644
--- a/libmproxy/console/__init__.py
+++ b/libmproxy/console/__init__.py
@@ -868,7 +868,7 @@ class ConsoleMaster(flow.FlowMaster):
                             elif k == "S":
                                 if not self.server_playback:
                                     self.path_prompt(
-                                        "Server replay: ",
+                                        "Server replay path: ",
                                         self.state.last_saveload,
                                         self.server_playback_path
                                     )
diff --git a/libmproxy/console/flowlist.py b/libmproxy/console/flowlist.py
index ffad5134..2b443636 100644
--- a/libmproxy/console/flowlist.py
+++ b/libmproxy/console/flowlist.py
@@ -146,7 +146,7 @@ class ConnectionItem(common.WWrap):
             )
         else:
             self.master.path_prompt(
-                "Server replay: ",
+                "Server replay path: ",
                 self.state.last_saveload,
                 self.master.server_playback_path
             )
diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 30928177..674197a4 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -1317,6 +1317,8 @@ class FlowMaster(controller.Master):
             if self.refresh_server_playback:
                 response.refresh()
             flow.request._ack(response)
+            if self.server_playback.count() == 0:
+                self.stop_server_playback()
             return True
         return None
 
