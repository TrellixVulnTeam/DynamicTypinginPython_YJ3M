commit f7bd690e3aba0be05c30a3b9a4d499de8dbd5e06
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sun May 31 17:18:55 2015 +1200

    When we see an incomplete read with 0 bytes, it's a disconnect
    
    Partially fixes mitmproxy/mitmproxy:#593

diff --git a/netlib/tcp.py b/netlib/tcp.py
index c8545d4f..f6179faa 100644
--- a/netlib/tcp.py
+++ b/netlib/tcp.py
@@ -225,9 +225,12 @@ class Reader(_FileLike):
         """
         result = self.read(length)
         if length != -1 and len(result) != length:
-            raise NetLibIncomplete(
-                "Expected %s bytes, got %s" % (length, len(result))
-            )
+            if not result:
+                raise NetLibDisconnect()
+            else:
+                raise NetLibIncomplete(
+                    "Expected %s bytes, got %s" % (length, len(result))
+                )
         return result
 
 
