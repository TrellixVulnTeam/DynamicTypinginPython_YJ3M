commit 9f83b6b944db0656372f8c5191670db493415452
Author: Aldo Cortesi <aldo@corte.si>
Date:   Sat May 12 11:16:19 2018 +1200

    script: invoke addons as script with exception handler
    
    Fixes #2837

diff --git a/mitmproxy/addons/script.py b/mitmproxy/addons/script.py
index decd0759..706146b0 100644
--- a/mitmproxy/addons/script.py
+++ b/mitmproxy/addons/script.py
@@ -156,7 +156,8 @@ class ScriptLoader:
             s = Script(path, False)
             for f in flows:
                 for evt, arg in eventsequence.iterate(f):
-                    ctx.master.addons.invoke_addon(s, evt, arg)
+                    with addonmanager.safecall():
+                        ctx.master.addons.invoke_addon(s, evt, arg)
         except exceptions.OptionsError as e:
             script_error_handler(path, e, msg=str(e))
 
