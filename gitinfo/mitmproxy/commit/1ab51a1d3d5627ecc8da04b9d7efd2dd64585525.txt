commit 1ab51a1d3d5627ecc8da04b9d7efd2dd64585525
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Wed Apr 13 20:32:05 2016 -0700

    fix #1082

diff --git a/mitmproxy/flow.py b/mitmproxy/flow.py
index 73493d1f..9c378585 100644
--- a/mitmproxy/flow.py
+++ b/mitmproxy/flow.py
@@ -998,8 +998,8 @@ class FlowMaster(controller.Master):
             self.state.add_flow(f)
         self.replacehooks.run(f)
         self.setheaders.run(f)
-        self.run_script_hook("request", f)
         self.process_new_request(f)
+        self.run_script_hook("request", f)
         return f
 
     def handle_responseheaders(self, f):
