commit d4c3b1c21355a46219c58e23d7542fa059af7573
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Tue Nov 19 04:08:16 2013 +0100

    attempt to fix https://github.com/mitmproxy/netlib/issues/24

diff --git a/libmproxy/proxy.py b/libmproxy/proxy.py
index 75a54192..790ae18a 100644
--- a/libmproxy/proxy.py
+++ b/libmproxy/proxy.py
@@ -258,13 +258,13 @@ class ProxyHandler(tcp.BaseHandler):
                 else:
                     response = response_reply
                     self.send_response(response)
-                    if request and http.request_connection_close(request.httpversion, request.headers):
+                    if request and http.connection_close(request.httpversion, request.headers):
                         return
                     # We could keep the client connection when the server
                     # connection needs to go away.  However, we want to mimic
                     # behaviour as closely as possible to the client, so we
                     # disconnect.
-                    if http.response_connection_close(response.httpversion, response.headers):
+                    if http.connection_close(response.httpversion, response.headers):
                         return
         except (IOError, ProxyError, http.HttpError, tcp.NetLibError), e:
             if hasattr(e, "code"):
