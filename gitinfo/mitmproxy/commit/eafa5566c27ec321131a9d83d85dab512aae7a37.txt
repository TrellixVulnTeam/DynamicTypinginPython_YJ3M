commit eafa5566c27ec321131a9d83d85dab512aae7a37
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon Jul 30 11:30:31 2012 +1200

    Handle disconnects on flush.

diff --git a/netlib/tcp.py b/netlib/tcp.py
index 7d3705da..e7bc79a8 100644
--- a/netlib/tcp.py
+++ b/netlib/tcp.py
@@ -48,8 +48,11 @@ class FileLike:
         return getattr(self.o, attr)
 
     def flush(self):
-        if hasattr(self.o, "flush"):
-            self.o.flush()
+        try:
+            if hasattr(self.o, "flush"):
+                self.o.flush()
+        except socket.error, v:
+            raise NetLibDisconnect(str(v))
 
     def read(self, length):
         """
