commit 5df5ee15f22284ef6ab9fcfc5c2b605c23c8fdc8
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Fri Sep 18 13:27:05 2015 +0200

    remove old server replay workaround, fix #774

diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index d735b9ec..8ee017f6 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -244,13 +244,9 @@ class ServerPlaybackState:
         _, _, path, _, query, _ = urlparse.urlparse(r.url)
         queriesArray = urlparse.parse_qsl(query, keep_blank_values=True)
 
-        # scheme should match the client connection to be able to replay
-        # although r.scheme may have been changed to http to connect to upstream server
-        scheme = "https" if flow.client_conn and flow.client_conn.ssl_established else "http"
-
         key = [
             str(r.port),
-            str(scheme),
+            str(r.scheme),
             str(r.method),
             str(path),
         ]
