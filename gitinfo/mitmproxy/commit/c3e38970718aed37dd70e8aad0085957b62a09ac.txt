commit c3e38970718aed37dd70e8aad0085957b62a09ac
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon Feb 21 10:11:50 2011 +1300

    Fix a subtle Unicode problem in Response.assemble
    
    If msg is Unicode, the proto string is automatically promoted to Unicode.  If
    the proto string is promoted to Unicode, then the FMT interpolation is also
    done in Unicode. If this happens, then binary data in content will cause an
    exception.

diff --git a/libmproxy/proxy.py b/libmproxy/proxy.py
index 5e698c5f..ffc9b264 100644
--- a/libmproxy/proxy.py
+++ b/libmproxy/proxy.py
@@ -338,7 +338,7 @@ class Response(controller.Msg):
             content = ""
         if self.request.client_conn.close:
             headers["connection"] = ["close"]
-        proto = "HTTP/1.1 %s %s"%(self.code, self.msg)
+        proto = "HTTP/1.1 %s %s"%(self.code, str(self.msg))
         data = (proto, str(headers), content)
         return self.FMT%data
 
