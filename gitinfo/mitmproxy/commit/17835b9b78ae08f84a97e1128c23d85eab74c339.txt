commit 17835b9b78ae08f84a97e1128c23d85eab74c339
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Tue Aug 2 15:43:35 2011 +1200

    Fix a rare undefined variable crash in proxy.py.

diff --git a/libmproxy/proxy.py b/libmproxy/proxy.py
index a2805069..6707b65b 100644
--- a/libmproxy/proxy.py
+++ b/libmproxy/proxy.py
@@ -749,7 +749,9 @@ class ProxyHandler(SocketServer.StreamRequestHandler):
                     port = 80
             port = int(port)
         if host is None:
-            raise ProxyError(400, 'Invalid request: %s'%request)
+            # FIXME: We only specify the first part of the invalid request in this error.
+            # We should gather up everything read from the socket, and specify it all.
+            raise ProxyError(400, 'Invalid request: %s'%line)
         if "expect" in headers:
             expect = ",".join(headers['expect'])
             if expect == "100-continue" and httpminor >= 1:
