commit 9e3f06b7f27da778c730bbf912e3f1709ed9f058
Author: Ammonite <pierre@ambox.fr>
Date:   Tue Jan 31 23:23:13 2017 +0100

    Better test

diff --git a/test/mitmproxy/test_examples.py b/test/mitmproxy/test_examples.py
index 25712d2d..e32323a6 100644
--- a/test/mitmproxy/test_examples.py
+++ b/test/mitmproxy/test_examples.py
@@ -108,15 +108,21 @@ class TestScripts(mastertest.MasterTest):
         original_host = "example.com"
 
         host_header = Headers(host=original_host)
-        f = tflow.tflow(req=tutils.treq(headers=host_header))
+        f = tflow.tflow(req=tutils.treq(headers=host_header, port=80))
 
         m.requestheaders(f)
 
         # Rewrite by reverse proxy mode
+        f.request.scheme = "https"
         f.request.host = "mitmproxy.org"
+        f.request.port = 443
 
         m.request(f)
+
+        assert f.request.scheme == "http"
         assert f.request.host == original_host
+        assert f.request.port == 80
+
         assert f.request.headers["Host"] == original_host
 
 
