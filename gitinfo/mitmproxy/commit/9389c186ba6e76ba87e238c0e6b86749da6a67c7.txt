commit 9389c186ba6e76ba87e238c0e6b86749da6a67c7
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Thu Aug 27 02:57:09 2015 +0200

    improve travis

diff --git a/.travis.yml b/.travis.yml
index 3b49224e..cdc57851 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,13 +1,10 @@
-language: python
-
 sudo: false
-
-python:
-  - "2.7"
-  # - pypy # disable until TravisCI ships a PyPy version which works with the latest CFFI
+language: python
 
 matrix:
+  fast_finish: true
   include:
+    - python: 2.7
     - python: 2.7
       env: OPENSSL=1.0.2
       addons:
@@ -18,16 +15,21 @@ matrix:
             - debian-sid
           packages:
             - libssl-dev
-    # - python: pypy
-    #   env: OPENSSL=1.0.2
-    #   addons:
-    #     apt:
-    #       sources:
-    #         # Debian sid currently holds OpenSSL 1.0.2
-    #         # change this with future releases!
-    #         - debian-sid
-    #       packages:
-    #         - libssl-dev
+    - python: pypy
+    - python: pypy
+      env: OPENSSL=1.0.2
+      addons:
+        apt:
+          sources:
+            # Debian sid currently holds OpenSSL 1.0.2
+            # change this with future releases!
+            - debian-sid
+          packages:
+            - libssl-dev
+  allow_failures:
+    # We allow pypy to fail until Travis fixes their infrastructure to a pypy
+    # with a recent enought CFFI library to run cryptography 1.0+.
+    - python: pypy
 
 install:
   - "pip install --src . -r requirements.txt"
@@ -50,7 +52,7 @@ notifications:
   slack:
     rooms:
         - mitmproxy:YaDGC9Gt9TEM7o8zkC2OLNsu
-    on_success: :change
+    on_success: change
     on_failure: always
 
 # exclude cryptography from cache
@@ -58,13 +60,10 @@ notifications:
 # which needs to be compiled specifically to each version
 before_cache:
   - pip uninstall -y cryptography
-  - rm -rf /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/cryptography/
-  - rm -rf /home/travis/virtualenv/pypy-2.5.0/site-packages/cryptography/
-  - rm /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
-  - rm /home/travis/virtualenv/pypy-2.5.0/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
 
 cache:
   directories:
+    - $HOME/.cache/pip
     - /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages
     - /home/travis/virtualenv/python2.7.9/bin
     - /home/travis/virtualenv/pypy-2.5.0/site-packages
