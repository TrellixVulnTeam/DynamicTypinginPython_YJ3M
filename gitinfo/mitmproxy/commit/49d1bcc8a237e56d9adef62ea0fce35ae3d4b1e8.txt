commit 49d1bcc8a237e56d9adef62ea0fce35ae3d4b1e8
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Wed Apr 20 15:27:39 2016 -0700

    fix CONNECT display in upstream mode

diff --git a/mitmproxy/protocol/http.py b/mitmproxy/protocol/http.py
index 13556e9c..fc181b5d 100644
--- a/mitmproxy/protocol/http.py
+++ b/mitmproxy/protocol/http.py
@@ -334,8 +334,7 @@ class HttpLayer(Layer):
         if self.mode == "regular":
             pass  # only absolute-form at this point, nothing to do here.
         elif self.mode == "upstream":
-            if flow.request.first_line_format == "authority":
-                flow.request.scheme = "http"  # pseudo value
+            pass
         else:
             # Setting request.host also updates the host header, which we want to preserve
             host_header = flow.request.headers.get("host", None)
diff --git a/netlib/http/request.py b/netlib/http/request.py
index 160ce3a3..6406a980 100644
--- a/netlib/http/request.py
+++ b/netlib/http/request.py
@@ -178,6 +178,8 @@ class Request(Message):
         """
         The URL string, constructed from the request's URL components
         """
+        if self.first_line_format == "authority":
+            return "%s:%d" % (self.host, self.port)
         return utils.unparse_url(self.scheme, self.host, self.port, self.path)
 
     @url.setter
