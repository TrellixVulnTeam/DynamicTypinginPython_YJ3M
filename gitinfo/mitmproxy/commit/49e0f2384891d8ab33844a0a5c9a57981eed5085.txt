commit 49e0f2384891d8ab33844a0a5c9a57981eed5085
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Fri Mar 10 19:37:18 2017 +0100

    use flow.id to link websocket + handshake flows

diff --git a/mitmproxy/proxy/protocol/websocket.py b/mitmproxy/proxy/protocol/websocket.py
index 1f898ed2..373c6479 100644
--- a/mitmproxy/proxy/protocol/websocket.py
+++ b/mitmproxy/proxy/protocol/websocket.py
@@ -140,7 +140,8 @@ class WebSocketLayer(base.Layer):
 
     def __call__(self):
         self.flow = WebSocketFlow(self.client_conn, self.server_conn, self.handshake_flow, self)
-        self.handshake_flow.metadata['websocket_flow'] = self.flow
+        self.flow.metadata['websocket_handshake'] = self.handshake_flow.id
+        self.handshake_flow.metadata['websocket_flow'] = self.flow.id
         self.channel.ask("websocket_start", self.flow)
 
         client = self.client_conn.connection
