commit c07b9ee301293987d242dc4fe61d54bcad4b903e
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Sat Aug 29 20:58:08 2015 +0200

    update .travis.yml

diff --git a/.travis.yml b/.travis.yml
index 9fd4fbd9..fd2fba3d 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,13 +1,10 @@
-language: python
-
 sudo: false
-
-python:
-  - "2.7"
-  - pypy
+language: python
 
 matrix:
+  fast_finish: true
   include:
+    - python: 2.7
     - python: 2.7
       env: OPENSSL=1.0.2
       addons:
@@ -18,6 +15,7 @@ matrix:
             - debian-sid
           packages:
             - libssl-dev
+    - python: pypy
     - python: pypy
       env: OPENSSL=1.0.2
       addons:
@@ -28,6 +26,10 @@ matrix:
             - debian-sid
           packages:
             - libssl-dev
+  allow_failures:
+    # We allow pypy to fail until Travis fixes their infrastructure to a pypy
+    # with a recent enought CFFI library to run cryptography 1.0+.
+    - python: pypy
 
 install:
   - "pip install --src . -r requirements.txt"
@@ -50,7 +52,7 @@ notifications:
   slack:
     rooms:
         - mitmproxy:YaDGC9Gt9TEM7o8zkC2OLNsu
-    on_success: :change
+    on_success: change
     on_failure: always
 
 # exclude cryptography from cache
@@ -58,14 +60,11 @@ notifications:
 # which needs to be compiled specifically to each version
 before_cache:
   - pip uninstall -y cryptography
-  - rm -rf /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/cryptography/
-  - rm -rf /home/travis/virtualenv/pypy-2.5.0/site-packages/cryptography/
-  - rm /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
-  - rm /home/travis/virtualenv/pypy-2.5.0/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
 
 cache:
   directories:
+    - $HOME/.cache/pip
     - /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages
     - /home/travis/virtualenv/python2.7.9/bin
     - /home/travis/virtualenv/pypy-2.5.0/site-packages
-    - /home/travis/virtualenv/pypy-2.5.0/bin
+    - /home/travis/virtualenv/pypy-2.5.0/bin
\ No newline at end of file
