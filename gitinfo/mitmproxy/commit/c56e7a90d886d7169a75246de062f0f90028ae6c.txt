commit c56e7a90d886d7169a75246de062f0f90028ae6c
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sat Nov 15 12:31:13 2014 +1300

    Fix tracebacks in connection finish

diff --git a/netlib/tcp.py b/netlib/tcp.py
index 6b7540aa..1c3bf230 100644
--- a/netlib/tcp.py
+++ b/netlib/tcp.py
@@ -255,10 +255,10 @@ class _Connection(object):
             if not getattr(self.wfile, "closed", False):
                 try:
                     self.wfile.flush()
+                    self.wfile.close()
                 except NetLibDisconnect:
                     pass
 
-            self.wfile.close()
             self.rfile.close()
         else:
             try:
