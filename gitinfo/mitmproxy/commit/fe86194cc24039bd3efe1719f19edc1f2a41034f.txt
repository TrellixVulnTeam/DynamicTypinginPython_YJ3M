commit fe86194cc24039bd3efe1719f19edc1f2a41034f
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Tue Jul 3 22:55:02 2012 +1200

    Fix Python coredump (!!) on SNI IDNA decoding.

diff --git a/libmproxy/proxy.py b/libmproxy/proxy.py
index 2294a894..f94171f0 100644
--- a/libmproxy/proxy.py
+++ b/libmproxy/proxy.py
@@ -255,7 +255,9 @@ class ProxyHandler(tcp.BaseHandler):
         return line
 
     def handle_sni(self, conn):
-        self.sni = conn.get_servername().decode("utf8").encode("idna")
+        sn = conn.get_servername()
+        if sn:
+            self.sni = sn.decode("utf8").encode("idna")
 
     def read_request(self, client_conn):
         if self.config.transparent_proxy:
