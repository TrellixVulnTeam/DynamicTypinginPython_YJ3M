commit ab2b98b988e6ec76d2c0f79dfe52d9ff4096619c
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Fri Apr 10 19:35:42 2015 +0200

    fix pretty_host if no host is present

diff --git a/libmproxy/protocol/http.py b/libmproxy/protocol/http.py
index 05657ea6..93065b47 100644
--- a/libmproxy/protocol/http.py
+++ b/libmproxy/protocol/http.py
@@ -631,8 +631,10 @@ class HTTPRequest(HTTPMessage):
             host = self.headers.get_first("host")
         if not host:
             host = self.host
-        host = host.encode("idna")
-        return host
+        if host:
+            return host.encode("idna")
+        else:
+            return None
 
     def pretty_url(self, hostheader):
         if self.form_out == "authority":  # upstream proxy mode
