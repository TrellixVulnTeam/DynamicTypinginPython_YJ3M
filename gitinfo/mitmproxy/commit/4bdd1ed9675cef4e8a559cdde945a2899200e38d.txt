commit 4bdd1ed9675cef4e8a559cdde945a2899200e38d
Author: deployable <code@deployable.co>
Date:   Thu Sep 4 10:47:27 2014 +0100

    Add urwid stop prior to stack trace so exceptions are not cleared from screen

diff --git a/libmproxy/console/__init__.py b/libmproxy/console/__init__.py
index 1325aae5..9d029610 100644
--- a/libmproxy/console/__init__.py
+++ b/libmproxy/console/__init__.py
@@ -599,6 +599,8 @@ class ConsoleMaster(flow.FlowMaster):
         try:
             self.ui.run_wrapper(self.loop)
         except Exception:
+            self.ui.stop()
+            sys.stdout.flush()
             print >> sys.stderr, traceback.format_exc()
             print >> sys.stderr, "mitmproxy has crashed!"
             print >> sys.stderr, "Please lodge a bug report at: https://github.com/mitmproxy/mitmproxy"
