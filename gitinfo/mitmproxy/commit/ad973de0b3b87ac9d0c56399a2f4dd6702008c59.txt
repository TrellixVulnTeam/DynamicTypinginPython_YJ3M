commit ad973de0b3b87ac9d0c56399a2f4dd6702008c59
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Mon Dec 29 14:40:34 2014 +0100

    fix mitmproxy -w

diff --git a/libmproxy/console/__init__.py b/libmproxy/console/__init__.py
index 7d25d428..0e42e69d 100644
--- a/libmproxy/console/__init__.py
+++ b/libmproxy/console/__init__.py
@@ -432,20 +432,20 @@ class ConsoleMaster(flow.FlowMaster):
                     print >> sys.stderr, "Script load error:", err
                     sys.exit(1)
 
-        if options.wfile:
-            err = self.start_stream(options.wfile)
+        if options.outfile:
+            err = self.start_stream_to_path(options.outfile[0], options.outfile[1])
             if err:
-                print >> sys.stderr, "Script load error:", err
+                print >> sys.stderr, "Stream file error:", err
                 sys.exit(1)
 
         if options.app:
             self.start_app(self.options.app_host, self.options.app_port)
 
-    def start_stream(self, path):
+    def start_stream_to_path(self, path, mode="wb"):
         path = os.path.expanduser(path)
         try:
-            f = file(path, "wb")
-            flow.FlowMaster.start_stream(self, f, None)
+            f = file(path, mode)
+            self.start_stream(f, None)
         except IOError, v:
             return str(v)
         self.stream_path = path
diff --git a/libmproxy/console/flowlist.py b/libmproxy/console/flowlist.py
index 2c6bfe32..c896ba33 100644
--- a/libmproxy/console/flowlist.py
+++ b/libmproxy/console/flowlist.py
@@ -263,7 +263,7 @@ class FlowListBox(urwid.ListBox):
                 self.master.path_prompt(
                     "Stream flows to: ",
                     self.master.state.last_saveload,
-                    self.master.start_stream
+                    self.master.start_stream_to_path
                 )
         else:
             return urwid.ListBox.keypress(self, size, key)
