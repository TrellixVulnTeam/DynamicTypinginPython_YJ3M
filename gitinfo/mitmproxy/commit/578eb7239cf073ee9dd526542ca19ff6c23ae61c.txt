commit 578eb7239cf073ee9dd526542ca19ff6c23ae61c
Author: Henrique <typoon@gmail.com>
Date:   Tue Nov 12 22:09:04 2019 -0500

    Tests for the new lexer

diff --git a/test/mitmproxy/test_lexer.py b/test/mitmproxy/test_lexer.py
new file mode 100644
index 00000000..c8b30fc6
--- /dev/null
+++ b/test/mitmproxy/test_lexer.py
@@ -0,0 +1,64 @@
+from mitmproxy import lexer
+import pytest
+
+
+class TestScripts:
+
+    def test_simple(self):
+
+        cases = [
+            {
+                "text": r'abc',
+                "result": ['abc']
+            },
+            {
+                "text": r'"Hello \" Double Quotes"',
+                "result": ['"Hello \\" Double Quotes"']
+            },
+            {
+                "text": r"'Hello \' Single Quotes'",
+                "result": ["'Hello \\' Single Quotes'"]
+            },
+            {
+                "text": r'"\""',
+                "result": ['"\\""']
+            },
+            {
+                "text": r'abc "def\" \x bla \z \\ \e \ " xpto',
+                "result": ['abc', '"def\\" \\x bla \\z \\\\ \\e \\ "', 'xpto']
+            },
+            {
+                "text": r'',
+                "result": []
+            },
+            {
+                "text": r' ',
+                "result": []
+            },
+            {
+                "text": r'  ',
+                "result": []
+            },
+            {
+                "text": r'Space in the end ',
+                "result": ['Space', 'in', 'the', 'end']
+            },
+            {
+                "text": '\n\n\rHello\n World With Spaces\n\n',
+                "result": ['Hello', 'World', 'With', 'Spaces']
+            },
+        ]
+
+        for t in cases:
+
+            lex = lexer.Lexer(t['text'])
+            tokens = list(lex)
+            result = t['result']
+            assert(tokens == result)
+
+    def test_fail(self):
+        text = r'"should fail with missing closing quote'
+        lex = lexer.Lexer(text)
+        with pytest.raises(ValueError, match="No closing quotation"):
+            assert list(lex)
+
