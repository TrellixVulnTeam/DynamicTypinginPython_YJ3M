commit 4604c25c6055a37e5f25a238d2a089759bd5d98a
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Sat Mar 12 23:55:56 2016 +0100

    fix #1025, refs #983

diff --git a/mitmproxy/protocol/tls.py b/mitmproxy/protocol/tls.py
index 6913396d..f014142b 100644
--- a/mitmproxy/protocol/tls.py
+++ b/mitmproxy/protocol/tls.py
@@ -562,5 +562,6 @@ class TlsLayer(Layer):
 
         # Some applications don't consider the CN and expect the hostname to be in the SANs.
         # For example, Thunderbird 38 will display a warning if the remote host is only the CN.
-        sans.add(host)
+        if host:
+            sans.add(host)
         return self.config.certstore.get_cert(host, list(sans))
