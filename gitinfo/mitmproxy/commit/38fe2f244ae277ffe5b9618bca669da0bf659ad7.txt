commit 38fe2f244ae277ffe5b9618bca669da0bf659ad7
Author: Simon Vermeersch <simonvermeersch@gmail.com>
Date:   Sun Aug 13 14:00:42 2017 +0200

    Fallback correctly to ipv4 when ipv6 is not supported

diff --git a/mitmproxy/net/tcp.py b/mitmproxy/net/tcp.py
index 0c2f0e28..e109236e 100644
--- a/mitmproxy/net/tcp.py
+++ b/mitmproxy/net/tcp.py
@@ -855,6 +855,8 @@ class TCPServer:
         if self.address[0] == 'localhost':
             raise socket.error("Binding to 'localhost' is prohibited. Please use '::1' or '127.0.0.1' directly.")
 
+        self.socket = None
+
         try:
             # First try to bind an IPv6 socket, with possible IPv4 if the OS supports it.
             # This allows us to accept connections for ::1 and 127.0.0.1 on the same socket.
