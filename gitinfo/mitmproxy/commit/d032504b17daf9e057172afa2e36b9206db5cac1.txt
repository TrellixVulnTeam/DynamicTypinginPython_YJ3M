commit d032504b17daf9e057172afa2e36b9206db5cac1
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sun Jun 10 17:10:43 2012 +1200

    Fix an exception when replaying a flow with no response.

diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 10e2c335..e25460b5 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -746,8 +746,6 @@ class Response(HTTPMsg):
             headers["content-length"] = [str(len(content))]
         else:
             content = ""
-        if self.request.client_conn.close:
-            headers["connection"] = ["close"]
         proto = "HTTP/%s.%s %s %s"%(self.httpversion[0], self.httpversion[1], self.code, str(self.msg))
         data = (proto, str(headers), content)
         return FMT%data
diff --git a/test/test_flow.py b/test/test_flow.py
index d220381d..59d130f7 100644
--- a/test/test_flow.py
+++ b/test/test_flow.py
@@ -835,9 +835,6 @@ class TestResponse:
         resp.content = None
         assert resp._assemble()
 
-        resp.request.client_conn.close = True
-        assert "connection: close" in resp._assemble()
-
         resp.content = flow.CONTENT_MISSING
         assert not resp._assemble()
 
diff --git a/test/tutils.py b/test/tutils.py
index 2d6dad1d..74ce6ce6 100644
--- a/test/tutils.py
+++ b/test/tutils.py
@@ -121,7 +121,7 @@ class ProxTest:
             r = hurl.get(
                 "http://127.0.0.1:%s"%self.proxy.port + "/p/" + spec,
                 validate_cert=False,
-                debug=hurl.utils.stdout_debug
+                #debug=hurl.utils.stdout_debug
             )
             return r
         else:
@@ -129,7 +129,7 @@ class ProxTest:
                 self.urlbase + "/p/" + spec,
                 proxy=self.proxies,
                 validate_cert=False,
-                debug=hurl.utils.stdout_debug
+                #debug=hurl.utils.stdout_debug
             )
 
     @property
