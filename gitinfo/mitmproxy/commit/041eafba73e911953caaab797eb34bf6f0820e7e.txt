commit 041eafba73e911953caaab797eb34bf6f0820e7e
Author: Valtteri Virtanen <valtteri@taiste.fi>
Date:   Mon Mar 5 13:57:57 2012 +0200

    Added tests for ServerPlaybackState with nopop

diff --git a/test/test_flow.py b/test/test_flow.py
index 6ad78ab1..b6818960 100644
--- a/test/test_flow.py
+++ b/test/test_flow.py
@@ -134,6 +134,18 @@ class uServerPlaybackState(libpry.AutoTree):
 
         assert not s.next_flow(r)
 
+    def test_load_with_nopop(self):
+        r = tutils.tflow_full()
+        r.request.headers["key"] = ["one"]
+
+        r2 = tutils.tflow_full()
+        r2.request.headers["key"] = ["two"]
+
+        s = flow.ServerPlaybackState(None, [r, r2], False, True)
+
+        assert s.count() == 2
+        n = s.next_flow(r)
+        assert s.count() == 2
 
 class uFlow(libpry.AutoTree):
     def test_copy(self):
