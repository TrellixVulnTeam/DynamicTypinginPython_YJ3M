commit eb823a04a19de7fd9e15d225064ae4581f0b85bf
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Mon Jun 15 23:36:14 2015 +0200

    http2: improve :authority header

diff --git a/netlib/http2/protocol.py b/netlib/http2/protocol.py
index 8191090c..ac89bac4 100644
--- a/netlib/http2/protocol.py
+++ b/netlib/http2/protocol.py
@@ -171,6 +171,9 @@ class HTTP2Protocol(object):
             headers = []
 
         authority = self.tcp_handler.sni if self.tcp_handler.sni else self.tcp_handler.address.host
+        if self.tcp_handler.address.port != 443:
+            authority += ":%d" % self.tcp_handler.address.port
+
         headers = [
             (b':method', bytes(method)),
             (b':path', bytes(path)),
diff --git a/test/http2/test_http2_protocol.py b/test/http2/test_http2_protocol.py
index 231b35e0..9b49acd3 100644
--- a/test/http2/test_http2_protocol.py
+++ b/test/http2/test_http2_protocol.py
@@ -222,14 +222,14 @@ class TestCreateRequest():
     def test_create_request_simple(self):
         bytes = http2.HTTP2Protocol(self.c).create_request('GET', '/')
         assert len(bytes) == 1
-        assert bytes[0] == '00000c0105000000018284874187089d5c0b8170ff'.decode('hex')
+        assert bytes[0] == '00000d0105000000018284874188089d5c0b8170dc07'.decode('hex')
 
     def test_create_request_with_body(self):
         bytes = http2.HTTP2Protocol(self.c).create_request(
             'GET', '/', [(b'foo', b'bar')], 'foobar')
         assert len(bytes) == 2
         assert bytes[0] ==\
-            '0000140104000000018284874187089d5c0b8170ff408294e7838c767f'.decode('hex')
+            '0000150104000000018284874188089d5c0b8170dc07408294e7838c767f'.decode('hex')
         assert bytes[1] ==\
             '000006000100000001666f6f626172'.decode('hex')
 
