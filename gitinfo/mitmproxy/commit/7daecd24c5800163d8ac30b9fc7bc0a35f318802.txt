commit 7daecd24c5800163d8ac30b9fc7bc0a35f318802
Author: sanlengjingvv <lankeren123543@gmail.com>
Date:   Fri Jun 26 20:11:19 2020 +0800

    store trailers in HTTPFlow

diff --git a/mitmproxy/http.py b/mitmproxy/http.py
index e9902224..0a063e65 100644
--- a/mitmproxy/http.py
+++ b/mitmproxy/http.py
@@ -140,6 +140,7 @@ class HTTPFlow(flow.Flow):
     """
     request: HTTPRequest
     response: Optional[HTTPResponse] = None
+    trailers: http.Headers
     error: Optional[flow.Error] = None
     """
     Note that it's possible for a Flow to have both a response and an error
diff --git a/mitmproxy/proxy/protocol/http.py b/mitmproxy/proxy/protocol/http.py
index 37e1669e..7d734d8a 100644
--- a/mitmproxy/proxy/protocol/http.py
+++ b/mitmproxy/proxy/protocol/http.py
@@ -409,6 +409,9 @@ class HttpLayer(base.Layer):
             self.log("response", "debug", [repr(f.response)])
             self.channel.ask("response", f)
 
+            if hasattr(self, 'has_tailers') and self.has_tailers:
+                f.trailers = self.read_trailers_headers()
+
             if not f.response.stream:
                 # no streaming:
                 # we already received the full response from the server and can
diff --git a/mitmproxy/proxy/protocol/http2.py b/mitmproxy/proxy/protocol/http2.py
index dac9c41b..f4cee048 100644
--- a/mitmproxy/proxy/protocol/http2.py
+++ b/mitmproxy/proxy/protocol/http2.py
@@ -599,7 +599,6 @@ class Http2SingleStreamLayer(httpbase._HttpTransmissionLayer, basethread.BaseThr
                 chunks
             )
 
-
     @detect_zombie_stream
     def update_trailers(self, headers):
         self.trailers_header = headers
@@ -641,6 +640,10 @@ class Http2SingleStreamLayer(httpbase._HttpTransmissionLayer, basethread.BaseThr
             timestamp_end=self.timestamp_end,
         )
 
+    @detect_zombie_stream
+    def read_trailers_headers(self):
+        return self.trailers_header
+
     @detect_zombie_stream
     def read_response_body(self, request, response):
         while True:
