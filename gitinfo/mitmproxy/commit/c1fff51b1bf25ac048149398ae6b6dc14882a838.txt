commit c1fff51b1bf25ac048149398ae6b6dc14882a838
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Mon Mar 10 22:36:47 2014 +0100

    always use relative imports, fix status bar bug

diff --git a/libmproxy/app.py b/libmproxy/app.py
index 69721031..9941d6ea 100644
--- a/libmproxy/app.py
+++ b/libmproxy/app.py
@@ -1,6 +1,7 @@
+from __future__ import absolute_import
 import flask
 import os.path, os
-import proxy
+from . import proxy
 
 mapp = flask.Flask(__name__)
 mapp.debug = True
diff --git a/libmproxy/cmdline.py b/libmproxy/cmdline.py
index bee4aa60..c2911a6b 100644
--- a/libmproxy/cmdline.py
+++ b/libmproxy/cmdline.py
@@ -1,8 +1,10 @@
-from . import proxy
-import re, filt
+from __future__ import absolute_import
+import re
 import argparse
 from argparse import ArgumentTypeError
 from netlib import http
+from . import proxy, filt
+
 
 APP_HOST = "mitm.it"
 APP_PORT = 80
diff --git a/libmproxy/console/__init__.py b/libmproxy/console/__init__.py
index 846abba7..ecca0909 100644
--- a/libmproxy/console/__init__.py
+++ b/libmproxy/console/__init__.py
@@ -1,8 +1,9 @@
+from __future__ import absolute_import
 import mailcap, mimetypes, tempfile, os, subprocess, glob, time, shlex, stat
 import os.path, sys, weakref, traceback
 import urwid
-from .. import controller, utils, flow, script
-import flowlist, flowview, help, common, grideditor, palettes, contentview, flowdetailview
+from .. import controller, utils, flow, script, proxy
+from . import flowlist, flowview, help, common, grideditor, palettes, contentview, flowdetailview
 
 EVENTLOG_SIZE = 500
 
@@ -168,8 +169,9 @@ class StatusBar(common.WWrap):
         if opts:
             r.append("[%s]"%(":".join(opts)))
 
-        if self.master.server.config.upstream_server:
-            r.append("[dest:%s]"%utils.unparse_url(*self.master.server.config.upstream_server))
+        if self.master.server.config.get_upstream_server and \
+                isinstance(self.master.server.config.get_upstream_server, proxy.ConstUpstreamServerResolver):
+            r.append("[dest:%s]"%utils.unparse_url(*self.master.server.config.get_upstream_server.dst))
         if self.master.scripts:
             r.append("[scripts:%s]"%len(self.master.scripts))
         if self.master.debug:
diff --git a/libmproxy/console/common.py b/libmproxy/console/common.py
index 7e2ecbf5..a8440f79 100644
--- a/libmproxy/console/common.py
+++ b/libmproxy/console/common.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 import urwid
 import urwid.util
 from .. import utils
diff --git a/libmproxy/console/contentview.py b/libmproxy/console/contentview.py
index d39d1b9c..60ca13b8 100644
--- a/libmproxy/console/contentview.py
+++ b/libmproxy/console/contentview.py
@@ -1,16 +1,13 @@
-import logging
-import re, cStringIO, traceback, json
-import urwid
-
+from __future__ import absolute_import
+import logging, subprocess, re, cStringIO, traceback, json, urwid
 from PIL import Image
 from PIL.ExifTags import TAGS
 
 import lxml.html, lxml.etree
 import netlib.utils
-import common
+from . import common
 from .. import utils, encoding, flow
 from ..contrib import jsbeautifier, html2text
-import subprocess
 try:
     import pyamf
     from pyamf import remoting, flex
diff --git a/libmproxy/console/flowdetailview.py b/libmproxy/console/flowdetailview.py
index 436d8f07..134c2471 100644
--- a/libmproxy/console/flowdetailview.py
+++ b/libmproxy/console/flowdetailview.py
@@ -1,5 +1,6 @@
+from __future__ import absolute_import
 import urwid
-import common
+from . import common
 from .. import utils
 
 footer = [
diff --git a/libmproxy/console/flowlist.py b/libmproxy/console/flowlist.py
index 6ba97733..deddae60 100644
--- a/libmproxy/console/flowlist.py
+++ b/libmproxy/console/flowlist.py
@@ -1,5 +1,6 @@
+from __future__ import absolute_import
 import urwid
-import common
+from . import common
 
 def _mkhelp():
     text = []
diff --git a/libmproxy/console/flowview.py b/libmproxy/console/flowview.py
index 9b636840..c7cdfa6c 100644
--- a/libmproxy/console/flowview.py
+++ b/libmproxy/console/flowview.py
@@ -1,6 +1,7 @@
+from __future__ import absolute_import
 import os, sys, copy
 import urwid
-import common, grideditor, contentview
+from . import common, grideditor, contentview
 from .. import utils, flow, controller
 from ..protocol.http import HTTPResponse, CONTENT_MISSING
 
diff --git a/libmproxy/console/grideditor.py b/libmproxy/console/grideditor.py
index bbdde4e3..642d8638 100644
--- a/libmproxy/console/grideditor.py
+++ b/libmproxy/console/grideditor.py
@@ -1,6 +1,7 @@
+from __future__ import absolute_import
 import copy, re, os
 import urwid
-import common
+from . import common
 from .. import utils, filt, script
 from netlib import http_uastrings
 
diff --git a/libmproxy/console/help.py b/libmproxy/console/help.py
index b0b7c48c..bd7217e1 100644
--- a/libmproxy/console/help.py
+++ b/libmproxy/console/help.py
@@ -1,5 +1,6 @@
+from __future__ import absolute_import
 import urwid
-import common
+from . import common
 from .. import filt, version
 
 footer = [
diff --git a/libmproxy/contrib/jsbeautifier/unpackers/__init__.py b/libmproxy/contrib/jsbeautifier/unpackers/__init__.py
index 6d136533..96318a5a 100644
--- a/libmproxy/contrib/jsbeautifier/unpackers/__init__.py
+++ b/libmproxy/contrib/jsbeautifier/unpackers/__init__.py
@@ -7,7 +7,7 @@
 
 import pkgutil
 import re
-from jsbeautifier.unpackers import evalbased
+from . import evalbased
 
 # NOTE: AT THE MOMENT, IT IS DEACTIVATED FOR YOUR SECURITY: it runs js!
 BLACKLIST = ['jsbeautifier.unpackers.evalbased']
diff --git a/libmproxy/controller.py b/libmproxy/controller.py
index 470d88fc..c4a60854 100644
--- a/libmproxy/controller.py
+++ b/libmproxy/controller.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 import Queue, threading
 
 should_exit = False
diff --git a/libmproxy/dump.py b/libmproxy/dump.py
index 6cf5e688..6573d97d 100644
--- a/libmproxy/dump.py
+++ b/libmproxy/dump.py
@@ -1,6 +1,7 @@
+from __future__ import absolute_import
 import sys, os
 import netlib.utils
-import flow, filt, utils
+from . import flow, filt, utils
 
 class DumpError(Exception): pass
 
diff --git a/libmproxy/encoding.py b/libmproxy/encoding.py
index 0fd7af52..0fd90870 100644
--- a/libmproxy/encoding.py
+++ b/libmproxy/encoding.py
@@ -1,6 +1,7 @@
 """
     Utility functions for decoding response bodies.
 """
+from __future__ import absolute_import
 import cStringIO
 import gzip, zlib
 
diff --git a/libmproxy/filt.py b/libmproxy/filt.py
index 95076eed..bd429fa3 100644
--- a/libmproxy/filt.py
+++ b/libmproxy/filt.py
@@ -31,8 +31,9 @@
         ~c CODE     Response code.
         rex         Equivalent to ~u rex
 """
+from __future__ import absolute_import
 import re, sys
-import contrib.pyparsing as pp
+from .contrib import pyparsing as pp
 
 
 class _Token:
diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 91231b85..b72a754c 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -2,20 +2,18 @@
     This module provides more sophisticated flow tracking. These match requests
     with their responses, and provide filtering and interception facilities.
 """
+from __future__ import absolute_import
 import base64
 import hashlib, Cookie, cookielib, re, threading
 import os
 import flask
 import requests
-from . import controller, protocol
+from netlib import odict, wsgi, tcp
+import netlib.http
+from . import controller, protocol, tnetstring, filt, script, version, app
 from .protocol import http
 from .proxy.connection import ServerConnection
 from .proxy.primitives import ProxyError
-import tnetstring, filt, script
-from netlib import odict, wsgi, tcp
-import netlib.http
-import version
-import app
 
 ODict = odict.ODict
 ODictCaseless = odict.ODictCaseless
diff --git a/libmproxy/protocol/handle.py b/libmproxy/protocol/handle.py
index 71c3243a..c94cc36e 100644
--- a/libmproxy/protocol/handle.py
+++ b/libmproxy/protocol/handle.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 from . import http, tcp
 
 protocols = {
diff --git a/libmproxy/protocol/http.py b/libmproxy/protocol/http.py
index 37fc4ee5..08dece37 100644
--- a/libmproxy/protocol/http.py
+++ b/libmproxy/protocol/http.py
@@ -1,7 +1,8 @@
+from __future__ import absolute_import
 import Cookie, urllib, urlparse, time, copy
 from email.utils import parsedate_tz, formatdate, mktime_tz
-import netlib.utils
 from netlib import http, tcp, http_status
+import netlib.utils
 from netlib.odict import ODict, ODictCaseless
 from .primitives import KILL, ProtocolHandler, TemporaryServerChangeMixin, Flow, Error
 from ..proxy.connection import ServerConnection
diff --git a/libmproxy/protocol/primitives.py b/libmproxy/protocol/primitives.py
index 5b95e9e5..81730616 100644
--- a/libmproxy/protocol/primitives.py
+++ b/libmproxy/protocol/primitives.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 from .. import stateobject, utils, version
 from ..proxy.primitives import AddressPriority
 from ..proxy.connection import ClientConnection, ServerConnection
diff --git a/libmproxy/protocol/tcp.py b/libmproxy/protocol/tcp.py
index 9d0192c4..3a247858 100644
--- a/libmproxy/protocol/tcp.py
+++ b/libmproxy/protocol/tcp.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 import select, socket
 from cStringIO import StringIO
 from .primitives import ProtocolHandler
diff --git a/libmproxy/proxy/config.py b/libmproxy/proxy/config.py
index ae24d4c9..cf382dc7 100644
--- a/libmproxy/proxy/config.py
+++ b/libmproxy/proxy/config.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 import os
 from .. import utils, platform
 from netlib import http_auth, certutils
diff --git a/libmproxy/proxy/connection.py b/libmproxy/proxy/connection.py
index 3a0273af..389a14ca 100644
--- a/libmproxy/proxy/connection.py
+++ b/libmproxy/proxy/connection.py
@@ -1,8 +1,9 @@
+from __future__ import absolute_import
 import copy
 import os
+from netlib import tcp, certutils
 from .. import stateobject, utils
 from .primitives import ProxyError
-from netlib import tcp, certutils
 
 
 class ClientConnection(tcp.BaseHandler, stateobject.SimpleStateObject):
diff --git a/libmproxy/proxy/primitives.py b/libmproxy/proxy/primitives.py
index e49d9bb4..8ae4b848 100644
--- a/libmproxy/proxy/primitives.py
+++ b/libmproxy/proxy/primitives.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import
+
 class ProxyError(Exception):
     def __init__(self, code, msg, headers=None):
         self.code, self.msg, self.headers = code, msg, headers
diff --git a/libmproxy/proxy/server.py b/libmproxy/proxy/server.py
index e0f058b5..a5b95fb7 100644
--- a/libmproxy/proxy/server.py
+++ b/libmproxy/proxy/server.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import
+
 import socket
 from OpenSSL import SSL
 from netlib import tcp
diff --git a/libmproxy/script.py b/libmproxy/script.py
index d34d3383..9638fdec 100644
--- a/libmproxy/script.py
+++ b/libmproxy/script.py
@@ -1,5 +1,6 @@
+from __future__ import absolute_import
 import os, traceback, threading, shlex
-import controller
+from . import controller
 
 class ScriptError(Exception):
     pass
diff --git a/libmproxy/stateobject.py b/libmproxy/stateobject.py
index a752999d..3437b90e 100644
--- a/libmproxy/stateobject.py
+++ b/libmproxy/stateobject.py
@@ -1,3 +1,5 @@
+from __future__ import absolute_import
+
 class StateObject(object):
     def _get_state(self):
         raise NotImplementedError  # pragma: nocover
diff --git a/libmproxy/utils.py b/libmproxy/utils.py
index 17ad6f09..ca48bdf2 100644
--- a/libmproxy/utils.py
+++ b/libmproxy/utils.py
@@ -1,3 +1,4 @@
+from __future__ import absolute_import
 import os, datetime, urllib, re
 import time, functools, cgi
 import json
