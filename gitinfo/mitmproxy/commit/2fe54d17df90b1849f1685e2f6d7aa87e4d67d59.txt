commit 2fe54d17df90b1849f1685e2f6d7aa87e4d67d59
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Wed Apr 25 14:38:20 2012 +1200

    Don't specify Content-Length on empty content.
    
    Sometimes, mitmproxy would specify a content-length header value of 0 when
    content was empty. Some rare servers (like piratebay.org) would barf on this.

diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 732718d3..2ef56570 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -528,10 +528,10 @@ class Request(HTTPMsg):
         if not 'host' in headers:
             headers["host"] = [utils.hostport(self.scheme, self.host, self.port)]
         content = self.content
-        if content is None:
-            content = ""
-        else:
+        if content:
             headers["content-length"] = [str(len(content))]
+        else:
+            content = ""
         if self.close:
             headers["connection"] = ["close"]
         if not _proxy:
@@ -698,10 +698,10 @@ class Response(HTTPMsg):
             ['proxy-connection', 'connection', 'keep-alive', 'transfer-encoding']
         )
         content = self.content
-        if content is None:
-            content = ""
-        else:
+        if content:
             headers["content-length"] = [str(len(content))]
+        else:
+            content = ""
         if self.request.client_conn.close:
             headers["connection"] = ["close"]
         proto = "HTTP/1.1 %s %s"%(self.code, str(self.msg))
