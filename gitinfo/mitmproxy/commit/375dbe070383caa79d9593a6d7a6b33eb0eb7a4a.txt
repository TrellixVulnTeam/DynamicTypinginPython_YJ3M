commit 375dbe070383caa79d9593a6d7a6b33eb0eb7a4a
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Thu Feb 4 18:16:23 2016 +0100

    always add common name as subjectAltName

diff --git a/libmproxy/protocol/tls.py b/libmproxy/protocol/tls.py
index ccae1661..986eb964 100644
--- a/libmproxy/protocol/tls.py
+++ b/libmproxy/protocol/tls.py
@@ -560,5 +560,7 @@ class TlsLayer(Layer):
         if self._sni_from_server_change:
             sans.add(self._sni_from_server_change)
 
-        sans.discard(host)
+        # Some applications don't consider the CN and expect the hostname to be in the SANs.
+        # For example, Thunderbird 38 will display a warning if the remote host is only the CN.
+        sans.add(host)
         return self.config.certstore.get_cert(host, list(sans))
