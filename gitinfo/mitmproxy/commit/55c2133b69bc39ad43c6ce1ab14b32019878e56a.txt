commit 55c2133b69bc39ad43c6ce1ab14b32019878e56a
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Thu Jul 17 01:47:24 2014 +0200

    add test case for mitmproxy/mitmproxy#295

diff --git a/test/test_certutils.py b/test/test_certutils.py
index 176575ea..2d8c7841 100644
--- a/test/test_certutils.py
+++ b/test/test_certutils.py
@@ -67,6 +67,13 @@ class TestCertStore:
             c3 = ca.get_cert("bar.com", [])
             assert not c1 == c3
 
+    def test_sans_change(self):
+        with tutils.tmpdir() as d:
+            ca = certutils.CertStore.from_store(d, "test")
+            _ = ca.get_cert("foo.com", ["*.bar.com"])
+            cert, key = ca.get_cert("foo.bar.com", ["*.baz.com"])
+            assert "*.baz.com" in cert.altnames
+
     def test_overrides(self):
         with tutils.tmpdir() as d:
             ca1 = certutils.CertStore.from_store(os.path.join(d, "ca1"), "test")
diff --git a/test/test_tcp.py b/test/test_tcp.py
index 77146829..b8837655 100644
--- a/test/test_tcp.py
+++ b/test/test_tcp.py
@@ -1,5 +1,5 @@
 import cStringIO, Queue, time, socket, random
-from netlib import tcp, certutils, test
+from netlib import tcp, certutils, test, certffi
 import mock
 import tutils
 from OpenSSL import SSL
