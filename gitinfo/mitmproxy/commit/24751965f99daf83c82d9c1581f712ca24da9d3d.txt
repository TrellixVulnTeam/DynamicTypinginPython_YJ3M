commit 24751965f99daf83c82d9c1581f712ca24da9d3d
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Wed Dec 21 23:22:14 2016 +0100

    remove output of dumper during tests

diff --git a/mitmproxy/tools/dump.py b/mitmproxy/tools/dump.py
index 90332627..4e2844a1 100644
--- a/mitmproxy/tools/dump.py
+++ b/mitmproxy/tools/dump.py
@@ -30,12 +30,14 @@ class Options(options.Options):
 
 class DumpMaster(master.Master):
 
-    def __init__(self, options, server):
+    def __init__(self, options, server, with_termlog=True, with_dumper=True):
         master.Master.__init__(self, options, server)
         self.has_errored = False
-        self.addons.add(termlog.TermLog())
+        if with_termlog:
+            self.addons.add(termlog.TermLog())
         self.addons.add(*addons.default_addons())
-        self.addons.add(dumper.Dumper())
+        if with_dumper:
+            self.addons.add(dumper.Dumper())
         # This line is just for type hinting
         self.options = self.options  # type: Options
 
diff --git a/mitmproxy/tools/web/master.py b/mitmproxy/tools/web/master.py
index 68a3db70..e6c15a0a 100644
--- a/mitmproxy/tools/web/master.py
+++ b/mitmproxy/tools/web/master.py
@@ -15,7 +15,7 @@ from mitmproxy.tools.web import app
 
 
 class WebMaster(master.Master):
-    def __init__(self, options, server):
+    def __init__(self, options, server, with_termlog=True):
         super().__init__(options, server)
         self.view = view.View()
         self.view.sig_view_add.connect(self._sig_view_add)
@@ -34,8 +34,9 @@ class WebMaster(master.Master):
             intercept.Intercept(),
             self.view,
             self.events,
-            termlog.TermLog(),
         )
+        if with_termlog:
+            self.addons.add(termlog.TermLog())
         self.app = app.Application(
             self, self.options.wdebug
         )
diff --git a/test/mitmproxy/test_tools_dump.py b/test/mitmproxy/test_tools_dump.py
index 1488f33b..2e64d2d2 100644
--- a/test/mitmproxy/test_tools_dump.py
+++ b/test/mitmproxy/test_tools_dump.py
@@ -11,7 +11,8 @@ from . import mastertest
 class TestDumpMaster(mastertest.MasterTest):
     def mkmaster(self, flt, **options):
         o = dump.Options(filtstr=flt, verbosity=-1, flow_detail=0, **options)
-        return dump.DumpMaster(o, proxy.DummyServer())
+        m = dump.DumpMaster(o, proxy.DummyServer(), with_termlog=False, with_dumper=False)
+        return m
 
     def test_read(self):
         with tutils.tmpdir() as t:
diff --git a/test/mitmproxy/test_web_app.py b/test/mitmproxy/test_web_app.py
index 8c15968b..61cf6993 100644
--- a/test/mitmproxy/test_web_app.py
+++ b/test/mitmproxy/test_web_app.py
@@ -19,8 +19,7 @@ def json(resp: httpclient.HTTPResponse):
 class TestApp(tornado.testing.AsyncHTTPTestCase):
     def get_app(self):
         o = options.Options()
-        m = webmaster.WebMaster(o, proxy.DummyServer())
-        m.addons.remove(m.addons.get('termlog'))
+        m = webmaster.WebMaster(o, proxy.DummyServer(), with_termlog=False)
         f = tflow.tflow(resp=True)
         f.id = "42"
         m.view.add(f)
