commit d9cc6f1dd6dfecdc4fe3ef38d2a7c5671f169c5e
Author: Matthias Urlichs <matthias@urlichs.de>
Date:   Fri Jun 28 07:53:56 2013 +0200

    proxy.py: Catch channel.ask() returning None when terminating

diff --git a/libmproxy/proxy.py b/libmproxy/proxy.py
index 69873a38..8dfae77a 100644
--- a/libmproxy/proxy.py
+++ b/libmproxy/proxy.py
@@ -216,7 +216,7 @@ class ProxyHandler(tcp.BaseHandler):
                     return
             else:
                 request_reply = self.channel.ask(request)
-                if request_reply == KILL:
+                if request_reply is None or request_reply == KILL:
                     return
                 elif isinstance(request_reply, flow.Response):
                     request = False
