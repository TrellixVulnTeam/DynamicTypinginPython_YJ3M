commit afa9104005b5f026daaa15f5f78dbfdf40d448c5
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Thu Feb 17 15:10:50 2011 +1300

    Refine verbose mitmdump output.

diff --git a/libmproxy/dump.py b/libmproxy/dump.py
index 2959e95c..3ef12a04 100644
--- a/libmproxy/dump.py
+++ b/libmproxy/dump.py
@@ -67,17 +67,26 @@ class DumpMaster(flow.FlowMaster):
                 print >> self.outfile, f.client_conn.address[0],
                 print >> self.outfile, f.request.short()
                 print >> self.outfile, self.indent(4, f.request.headers)
+                print >> self.outfile
                 print >> self.outfile, " <<", f.response.short()
                 print >> self.outfile, self.indent(4, f.response.headers)
+                print >> self.outfile, "\n\n"
             elif self.o.verbosity == 3:
-                print >> self.outfile, ">>"
-                for i in f.request.request.assemble().splitlines():
-                    print >> self.outfile, "\t", i
-                print >> self.outfile, ">>"
-                print >> self.outfile, "<<"
-                for i in f.request.assemble().splitlines():
-                    print >> self.outfile, "\t", i
-                print >> self.outfile, "<<"
+                print >> self.outfile, f.client_conn.address[0],
+                print >> self.outfile, f.request.short()
+                print >> self.outfile, self.indent(4, f.request.headers)
+                if utils.isBin(f.request.content):
+                    print >> self.outfile, self.indent(4, utils.hexdump(f.request.content))
+                elif f.request.content:
+                    print >> self.outfile, self.indent(4, f.request.content)
+                print >> self.outfile
+                print >> self.outfile, " <<", f.response.short()
+                print >> self.outfile, self.indent(4, f.response.headers)
+                if utils.isBin(f.response.content):
+                    print >> self.outfile, self.indent(4, utils.hexdump(f.response.content))
+                elif f.response.content:
+                    print >> self.outfile, self.indent(4, f.response.content)
+                print >> self.outfile, "\n\n"
             self.state.delete_flow(f)
             if self.o.wfile:
                 self.fwriter.add(f)
