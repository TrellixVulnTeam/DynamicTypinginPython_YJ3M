commit 820ccc69da0dac66c027c6691833592a9fba2f09
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Sun Feb 25 22:19:14 2018 +0100

    use sni to select clientcerts

diff --git a/mitmproxy/connections.py b/mitmproxy/connections.py
index 9c47985c..e8fc4fbf 100644
--- a/mitmproxy/connections.py
+++ b/mitmproxy/connections.py
@@ -286,7 +286,8 @@ class ServerConnection(tcp.TCPClient, stateobject.StateObject):
             else:
                 path = os.path.join(
                     client_certs,
-                    self.address[0].encode("idna").decode()) + ".pem"
+                    (sni or self.address[0].encode("idna").decode()) + ".pem"
+                )
                 if os.path.exists(path):
                     client_cert = path
 
