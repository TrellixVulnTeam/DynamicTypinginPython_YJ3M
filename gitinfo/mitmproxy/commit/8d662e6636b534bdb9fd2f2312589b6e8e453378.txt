commit 8d662e6636b534bdb9fd2f2312589b6e8e453378
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Wed Mar 14 11:20:25 2012 +1300

    Set a "unique" serial number for each generated cert.

diff --git a/libmproxy/certutils.py b/libmproxy/certutils.py
index ddf17f2e..b807e483 100644
--- a/libmproxy/certutils.py
+++ b/libmproxy/certutils.py
@@ -1,4 +1,4 @@
-import subprocess, os, ssl, hashlib, socket
+import subprocess, os, ssl, hashlib, socket, time
 from pyasn1.type import univ, constraint, char, namedtype, tag
 from pyasn1.codec.der.decoder import decode
 import OpenSSL
@@ -13,7 +13,6 @@ def create_ca():
     key.generate_key(OpenSSL.crypto.TYPE_RSA, 1024)
     ca = OpenSSL.crypto.X509()
     ca.set_version(3)
-    ca.set_serial_number(1)
     ca.get_subject().CN = "mitmproxy"
     ca.get_subject().OU = "mitmproxy"
     ca.gmtime_adj_notBefore(0)
@@ -107,6 +106,7 @@ def dummy_cert(certdir, ca, commonname, sans):
     cert.gmtime_adj_notAfter(60 * 60 * 24 * 30)
     cert.set_issuer(ca.get_subject())
     cert.set_subject(req.get_subject())
+    cert.set_serial_number(int(time.time()*10000))
     if ss:
         cert.add_extensions([OpenSSL.crypto.X509Extension("subjectAltName", True, ss)])
     cert.set_pubkey(req.get_pubkey())
diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index e7af996c..450fef30 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -816,9 +816,9 @@ class ServerPlaybackState:
         if not l:
             return None
 
-        if self.nopop: 
+        if self.nopop:
             return l[0]
-        else: 
+        else:
             return l.pop(0)
 
 
