commit 5fb49c3b64af24e2e313f9074a76c9646891742a
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Thu Jul 27 14:42:57 2017 +0200

    add console statusbar test

diff --git a/test/mitmproxy/tools/console/conftest.py b/test/mitmproxy/tools/console/conftest.py
new file mode 100644
index 00000000..afd94c6a
--- /dev/null
+++ b/test/mitmproxy/tools/console/conftest.py
@@ -0,0 +1,9 @@
+from unittest import mock
+
+import pytest
+
+
+@pytest.fixture(scope="module", autouse=True)
+def definitely_atty():
+    with mock.patch("sys.stdout.isatty", lambda: True):
+        yield
diff --git a/test/mitmproxy/tools/console/test_master.py b/test/mitmproxy/tools/console/test_master.py
index 7732483f..a3478bdc 100644
--- a/test/mitmproxy/tools/console/test_master.py
+++ b/test/mitmproxy/tools/console/test_master.py
@@ -1,20 +1,12 @@
-import pytest
+import urwid
 
+from mitmproxy import options
+from mitmproxy import proxy
 from mitmproxy.test import tflow
 from mitmproxy.test import tutils
 from mitmproxy.tools import console
-from mitmproxy import proxy
-from mitmproxy import options
 from mitmproxy.tools.console import common
 from ... import tservers
-import urwid
-from unittest import mock
-
-
-@pytest.fixture(scope="module", autouse=True)
-def definitely_atty():
-    with mock.patch("sys.stdout.isatty", lambda: True):
-        yield
 
 
 def test_format_keyvals():
diff --git a/test/mitmproxy/tools/console/test_statusbar.py b/test/mitmproxy/tools/console/test_statusbar.py
new file mode 100644
index 00000000..55a3c4a0
--- /dev/null
+++ b/test/mitmproxy/tools/console/test_statusbar.py
@@ -0,0 +1,34 @@
+from mitmproxy import options, proxy
+from mitmproxy.tools.console import statusbar, master
+
+
+def test_statusbar(monkeypatch):
+    o = options.Options(
+        setheaders=[":~q:foo:bar"],
+        replacements=[":~q:foo:bar"],
+        ignore_hosts=["example.com", "example.org"],
+        tcp_hosts=["example.tcp"],
+        intercept="~q",
+        view_filter="~dst example.com",
+        stickycookie="~dst example.com",
+        stickyauth="~dst example.com",
+        default_contentview="javascript",
+        console_order="url",
+        anticache=True,
+        anticomp=True,
+        showhost=True,
+        refresh_server_playback=False,
+        replay_kill_extra=True,
+        upstream_cert=False,
+        console_focus_follow=True,
+        stream_large_bodies="3m",
+        mode="transparent",
+        scripts=["nonexistent"],
+        save_stream_file="foo",
+    )
+    m = master.ConsoleMaster(o, proxy.DummyServer())
+    monkeypatch.setattr(m.addons.get("clientplayback"), "count", lambda: 42)
+    monkeypatch.setattr(m.addons.get("serverplayback"), "count", lambda: 42)
+
+    bar = statusbar.StatusBar(m)  # this already causes a redraw
+    assert bar.ib._w
