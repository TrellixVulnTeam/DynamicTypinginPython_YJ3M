commit 77aeac11a9353f290a9e4dfc1af1df4f597f48ee
Author: Colin Bendell <colin@bendell.ca>
Date:   Wed Oct 7 20:30:31 2015 -0400

    Check if server connection hasn't yet been initiated
    
    This fixes #761 when NoneType error is thrown when non-TLS requests initiate a client request but the server connection hasn't yet been initiated.

diff --git a/libmproxy/models/connections.py b/libmproxy/models/connections.py
index f1e10de9..ab046247 100644
--- a/libmproxy/models/connections.py
+++ b/libmproxy/models/connections.py
@@ -135,8 +135,8 @@ class ServerConnection(tcp.TCPClient, stateobject.StateObject):
     def get_state(self, short=False):
         d = super(ServerConnection, self).get_state(short)
         d.update(
-            address={"address": self.address(),
-                     "use_ipv6": self.address.use_ipv6},
+            address=({"address": self.address(),
+                     "use_ipv6": self.address.use_ipv6} if self.address else None), 
             source_address=({"address": self.source_address(),
                              "use_ipv6": self.source_address.use_ipv6} if self.source_address else None),
             cert=self.cert.to_pem() if self.cert else None
