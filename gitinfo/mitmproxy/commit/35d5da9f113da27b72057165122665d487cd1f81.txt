commit 35d5da9f113da27b72057165122665d487cd1f81
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Tue Jul 3 13:42:09 2012 +1200

    Move palette option getting/setting to mitmproxy.
    
    Unbreaks mitmdump.

diff --git a/libmproxy/cmdline.py b/libmproxy/cmdline.py
index 93d99779..822bebec 100644
--- a/libmproxy/cmdline.py
+++ b/libmproxy/cmdline.py
@@ -15,7 +15,6 @@
 
 import proxy
 import optparse, re, filt
-from console import palettes
 
 
 class ParseReplaceException(Exception): pass
@@ -116,7 +115,6 @@ def get_common_options(options):
         wfile = options.wfile,
         verbosity = options.verbose,
         nopop = options.nopop,
-        palette = options.palette,
     )
 
 
@@ -218,11 +216,6 @@ def common_options(parser):
         action="store_true", dest="upstream_cert",
         help="Connect to upstream server to look up certificate details."
     )
-    parser.add_option(
-        "--palette", type="str", default="dark",
-        action="store", dest="palette",
-        help="Select color palette: " + ", ".join(palettes.palettes.keys())
-    )
 
     group = optparse.OptionGroup(parser, "Client Replay")
     group.add_option(
diff --git a/mitmproxy b/mitmproxy
index 0df1cc5d..61527e1a 100755
--- a/mitmproxy
+++ b/mitmproxy
@@ -17,6 +17,7 @@
 
 import sys
 from libmproxy import proxy, console, cmdline
+from libmproxy.console import palettes
 from libmproxy.version import VERSION
 from optparse import OptionParser, OptionGroup
 
@@ -28,6 +29,11 @@ if __name__ == '__main__':
             )
     cmdline.common_options(parser)
     parser.add_option("--debug", dest="debug", default=False, action="store_true")
+    parser.add_option(
+        "--palette", type="str", default="dark",
+        action="store", dest="palette",
+        help="Select color palette: " + ", ".join(palettes.palettes.keys())
+    )
 
 
     group = OptionGroup(
@@ -60,6 +66,8 @@ if __name__ == '__main__':
         parser.error(v.message)
     opts.intercept = options.intercept
     opts.debug = options.debug
+    opts.palette = options.palette
+
     m = console.ConsoleMaster(server, opts)
     try:
         m.run()
