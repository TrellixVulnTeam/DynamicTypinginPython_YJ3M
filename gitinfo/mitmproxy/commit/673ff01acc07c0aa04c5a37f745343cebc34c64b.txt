commit 673ff01acc07c0aa04c5a37f745343cebc34c64b
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Thu Feb 3 12:28:40 2011 +1300

    Fix tracking of edited state.

diff --git a/libmproxy/console.py b/libmproxy/console.py
index 19a5961e..8151ccea 100644
--- a/libmproxy/console.py
+++ b/libmproxy/console.py
@@ -393,6 +393,8 @@ class ConnectionView(WWrap):
             conn = self.flow.request
         else:
             conn = self.flow.response
+
+        self.flow.backup()
         if part == "b":
             conn.content = self._spawn_editor(conn.content or "")
         elif part == "h":
@@ -1177,7 +1179,7 @@ class ConsoleMaster(controller.Master):
                                     ),
                                     self.quit,
                                 )
-                                k = None
+                            k = None
                         elif k == "S":
                             self.path_prompt(
                                 "Save flows: ",
diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 8b8a8bae..9ebe1d69 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -208,7 +208,6 @@ class State:
         if not f:
             return False
         f.response = resp
-        f.backup()
         return f
 
     def add_error(self, err):
@@ -220,7 +219,6 @@ class State:
         if not f:
             return None
         f.error = err
-        f.backup()
         return f
 
     def dump_flows(self):
