commit 65202f5f1c2d9f55e8d72e72656a6d43e7947f88
Author: Charles d'Hondt <charles.dhondt@gmail.com>
Date:   Fri Apr 28 17:00:21 2017 +0200

    Added ldapsss vef

diff --git a/mitmproxy/addons/proxyauth.py b/mitmproxy/addons/proxyauth.py
index eac216c3..281a1a8f 100644
--- a/mitmproxy/addons/proxyauth.py
+++ b/mitmproxy/addons/proxyauth.py
@@ -112,7 +112,7 @@ class ProxyAuth:
                     password,
                     auto_bind=True)
             if conn:
-                conn.search(parts[1][1:], '('+parts[0]+username+')', attributes=['objectclass'])
+                conn.search(parts[1][1:], '(' + parts[0] + username + ')', attributes=['objectclass'])
                 if ctx.options.proxyauth.split(":")[3] in conn.entries[0]['objectclass']:
                     return username, password
 
@@ -156,6 +156,10 @@ class ProxyAuth:
                         server = ldap3.Server(parts[1], use_ssl=True)
                     elif parts[0] == "ldap":
                         server = ldap3.Server(parts[1])
+                    else:
+                        raise exceptions.OptionsError(
+                            "Invalid ldap specfication on the first part"
+                        )
                     self.ldapserver = server
                 else:
                     parts = ctx.options.proxyauth.split(':')
diff --git a/test/mitmproxy/addons/test_proxyauth.py b/test/mitmproxy/addons/test_proxyauth.py
index 6c36b7e8..6311e97e 100644
--- a/test/mitmproxy/addons/test_proxyauth.py
+++ b/test/mitmproxy/addons/test_proxyauth.py
@@ -46,8 +46,12 @@ def test_configure():
         assert up.ldapserver
         ctx.configure(up, proxyauth="ldaps:ldap.forumsys.com:uid=?,dc=example,dc=com:person")
         assert up.ldapserver
+
+        with pytest.raises(exceptions.OptionsError):
+            ctx.configure(up, proxyauth="ldap:ldap.forumsys.comuid=?dc=example,dc=com:person")
+
         with pytest.raises(exceptions.OptionsError):
-            ctx.configure(up, proxyauth="ldapldap.forumsys.com:uid=?dc=example,dc=com:person")
+            ctx.configure(up, proxyauth="ldapssssssss:ldap.forumsys.com:uid=?,dc=example,dc=com:person")
 
         with pytest.raises(exceptions.OptionsError):
             ctx.configure(
