commit 4c9fc2e3e9bcbbc8f781ccd012cb7ce3c45981e9
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Sun Nov 29 15:11:08 2015 +0100

    travis: build binaries on osx

diff --git a/.travis.yml b/.travis.yml
index 266852ee..aa5847ef 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -41,11 +41,11 @@ install:
   - |
     if [[ $TRAVIS_OS_NAME == "osx" ]]
     then
-    	brew update || brew update # try again if it fails
-    	brew outdated openssl || brew upgrade openssl
-    	brew install python
+      brew update || brew update # try again if it fails
+      brew outdated openssl || brew upgrade openssl
+      brew install python
     fi
-  - "pip install -r requirements.txt"
+  - "pip install --src .. -r requirements.txt"
 
 before_script:
   - "openssl version -a"
@@ -55,6 +55,19 @@ script:
 
 after_success:
   - coveralls
+  - |
+    if [[ $TRAVIS_OS_NAME == "osx" && $TRAVIS_BRANCH == "master" && -z $TRAVIS_PULL_REQUEST ]]
+    then
+        brew install curl --with-libssh2
+        pip install virtualenv
+        git clone https://github.com/mitmproxy/release.git ../release
+        pip install -e ../release
+        python ../release/rtool.py -p mitmproxy bdist
+        for f in ../release/dist/*
+        do
+          $(brew --prefix curl)/bin/curl -u $SNAPSHOT_AUTH --hostpubmd5 $SNAPSHOT_PUBKEY -T $f sftp://$SNAPSHOT_HOST/
+        done
+    fi
 
 notifications:
   irc:
