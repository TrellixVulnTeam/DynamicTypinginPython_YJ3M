commit a4048c8871b12a0632423f49af4f749e4968d36b
Author: Ujjwal Verma <ujjwalverma1111@gmail.com>
Date:   Thu Aug 10 02:34:03 2017 +0530

    Fixes #2495

diff --git a/mitmproxy/io/compat.py b/mitmproxy/io/compat.py
index 99da496d..da9d2a44 100644
--- a/mitmproxy/io/compat.py
+++ b/mitmproxy/io/compat.py
@@ -58,7 +58,7 @@ def convert_017_018(data):
     # convert_unicode needs to be called for every dual release and the first py3-only release
     data = convert_unicode(data)
 
-    data["server_conn"]["ip_address"] = data["server_conn"].pop("peer_address")
+    data["server_conn"]["ip_address"] = data["server_conn"].pop("peer_address", None)
     data["marked"] = False
     data["version"] = (0, 18)
     return data
