commit 3a3299bc612218d5073f423a587f9d917868aeec
Author: Aldo Cortesi <aldo@corte.si>
Date:   Thu Mar 8 08:18:26 2018 +1300

    release: put branches in /branches on the snapshots server
    
    This is a precautionary measure to prevent a clash in case we have a branch
    with the same name as a tag. Tags live in the top-level directory, because
    these are releases that users will most often access directly.

diff --git a/release/ci.py b/release/ci.py
index 43fde3dc..eaabaf3a 100755
--- a/release/ci.py
+++ b/release/ci.py
@@ -74,8 +74,10 @@ TAG = os.environ.get("TRAVIS_TAG", os.environ.get("APPVEYOR_REPO_TAG_NAME", None
 BRANCH = os.environ.get("TRAVIS_BRANCH", os.environ.get("APPVEYOR_REPO_BRANCH", None))
 if TAG:
     VERSION = TAG
+    UPLOAD_DIR = VERSION
 elif BRANCH:
     VERSION = BRANCH
+    UPLOAD_DIR = "branches/%s" % VERSION
 else:
     print("Could not establish build name - exiting." % BRANCH)
     sys.exit(0)
@@ -240,7 +242,7 @@ def upload():
                 "aws", "s3", "cp",
                 "--acl", "public-read",
                 DIST_DIR + "/",
-                "s3://snapshots.mitmproxy.org/%s/" % VERSION,
+                "s3://snapshots.mitmproxy.org/%s/" % UPLOAD_DIR,
                 "--recursive",
             ]
         )
