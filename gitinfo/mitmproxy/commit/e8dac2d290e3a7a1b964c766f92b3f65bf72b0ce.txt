commit e8dac2d290e3a7a1b964c766f92b3f65bf72b0ce
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon Apr 30 17:19:39 2018 +1200

    client replay: revert our changes if replay is aborted

diff --git a/mitmproxy/addons/clientplayback.py b/mitmproxy/addons/clientplayback.py
index 305920da..15fa7394 100644
--- a/mitmproxy/addons/clientplayback.py
+++ b/mitmproxy/addons/clientplayback.py
@@ -172,6 +172,8 @@ class ClientPlayback:
         with self.q.mutex:
             lst = list(self.q.queue)
             self.q.queue.clear()
+            for f in lst:
+                f.revert()
             ctx.master.addons.trigger("update", lst)
         ctx.log.alert("Client replay queue cleared.")
 
