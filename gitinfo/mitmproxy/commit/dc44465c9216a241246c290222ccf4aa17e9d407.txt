commit dc44465c9216a241246c290222ccf4aa17e9d407
Author: phackt <phackt@protonmail.com>
Date:   Tue Nov 8 15:39:24 2016 +0100

    fix SNI for transparent mode - #1638
    
    In transparent mode host is set with the target server ip.
    Attribute flow.request.host is used as SNI while mitmproxy is
    initiating TLS handshake, so it should be set with the pretty_host.

diff --git a/examples/sslstrip.py b/examples/sslstrip.py
index b5e46397..5e1eb56f 100644
--- a/examples/sslstrip.py
+++ b/examples/sslstrip.py
@@ -16,6 +16,7 @@ def request(flow):
     if flow.request.pretty_host in secure_hosts:
         flow.request.scheme = 'https'
         flow.request.port = 443
+        flow.request.host = flow.request.pretty_host
 
 
 def response(flow):
