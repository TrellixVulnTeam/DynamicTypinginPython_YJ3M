commit 75f83ba380ca4133bdace8120383978a1e679410
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Fri Mar 10 11:11:12 2017 +1300

    Show custom addon options in --options output

diff --git a/mitmproxy/optmanager.py b/mitmproxy/optmanager.py
index 698c9bb8..a72a4355 100644
--- a/mitmproxy/optmanager.py
+++ b/mitmproxy/optmanager.py
@@ -435,7 +435,7 @@ class OptManager:
             raise ValueError("Unsupported option type: %s", o.typespec)
 
 
-def dump(opts):
+def dump_defaults(opts):
     """
         Dumps an annotated file with all options.
     """
diff --git a/mitmproxy/tools/cmdline.py b/mitmproxy/tools/cmdline.py
index aaefd10a..c5d2bbd7 100644
--- a/mitmproxy/tools/cmdline.py
+++ b/mitmproxy/tools/cmdline.py
@@ -23,7 +23,7 @@ def common_options(parser, opts):
     parser.add_argument(
         '--options',
         action='store_true',
-        help="Dump all options",
+        help="Show all options and their default values",
     )
     parser.add_argument(
         "--conf",
diff --git a/mitmproxy/tools/main.py b/mitmproxy/tools/main.py
index 7b2d2a7b..cc2310c2 100644
--- a/mitmproxy/tools/main.py
+++ b/mitmproxy/tools/main.py
@@ -39,10 +39,8 @@ def process_options(parser, opts, args):
     if args.version:
         print(debug.dump_system_info())
         sys.exit(0)
-    if args.options:
-        print(optmanager.dump(opts))
-        sys.exit(0)
-    if args.quiet:
+    if args.quiet or args.options:
+        args.verbosity = 0
         args.flow_detail = 0
 
     adict = {}
@@ -75,6 +73,9 @@ def run(MasterKlass, args):  # pragma: no cover
         server = process_options(parser, opts, args)
         master = MasterKlass(opts, server)
         master.addons.configure_all(opts, opts.keys())
+        if args.options:
+            print(optmanager.dump_defaults(opts))
+            sys.exit(0)
         opts.set(*args.setoptions)
 
         def cleankill(*args, **kwargs):
diff --git a/test/mitmproxy/test_optmanager.py b/test/mitmproxy/test_optmanager.py
index 0ecfc4e5..6e275802 100644
--- a/test/mitmproxy/test_optmanager.py
+++ b/test/mitmproxy/test_optmanager.py
@@ -280,9 +280,9 @@ def test_option():
     assert o2 != o
 
 
-def test_dump():
+def test_dump_defaults():
     o = options.Options()
-    assert optmanager.dump(o)
+    assert optmanager.dump_defaults(o)
 
 
 class TTypes(optmanager.OptManager):
