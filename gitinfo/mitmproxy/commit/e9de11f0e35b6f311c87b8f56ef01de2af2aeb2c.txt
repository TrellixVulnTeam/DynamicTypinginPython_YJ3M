commit e9de11f0e35b6f311c87b8f56ef01de2af2aeb2c
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Tue Jul 24 22:30:15 2012 +1200

    Don't add stuff to our internal log buffer if noapi is on.

diff --git a/libpathod/pathod.py b/libpathod/pathod.py
index 0ab7e915..8ee7f9ae 100644
--- a/libpathod/pathod.py
+++ b/libpathod/pathod.py
@@ -206,14 +206,15 @@ class Pathod(tcp.TCPServer):
         h.finish()
 
     def add_log(self, d):
-        lock = threading.Lock()
-        with lock:
-            d["id"] = self.logid
-            self.log.insert(0, d)
-            if len(self.log) > self.LOGBUF:
-                self.log.pop()
-            self.logid += 1
-        return d["id"]
+        if not self.noapi:
+            lock = threading.Lock()
+            with lock:
+                d["id"] = self.logid
+                self.log.insert(0, d)
+                if len(self.log) > self.LOGBUF:
+                    self.log.pop()
+                self.logid += 1
+            return d["id"]
 
     def clear_log(self):
         lock = threading.Lock()
