commit 58ff51da10eff7090ff2a63436c558b1eb5150c3
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sat May 12 14:02:20 2018 +1200

    command: handle string without terminal escaped char
    
    Fixes #2810

diff --git a/mitmproxy/command.py b/mitmproxy/command.py
index c94e8abb..27f0921d 100644
--- a/mitmproxy/command.py
+++ b/mitmproxy/command.py
@@ -236,7 +236,10 @@ class CommandManager(mitmproxy.types._CommandBase):
         """
             Execute a command string. May raise CommandError.
         """
-        parts = list(lexer(cmdstr))
+        try:
+            parts = list(lexer(cmdstr))
+        except ValueError as e:
+            raise exceptions.CommandError("Command error: %s" % e)
         if not len(parts) >= 1:
             raise exceptions.CommandError("Invalid command: %s" % cmdstr)
         return self.call_strings(parts[0], parts[1:])
diff --git a/test/mitmproxy/test_command.py b/test/mitmproxy/test_command.py
index 7c0dc06d..029dbafd 100644
--- a/test/mitmproxy/test_command.py
+++ b/test/mitmproxy/test_command.py
@@ -281,6 +281,8 @@ def test_simple():
             c.execute("one.two too many args")
         with pytest.raises(exceptions.CommandError, match="Unknown"):
             c.call("nonexistent")
+        with pytest.raises(exceptions.CommandError, match="No escaped"):
+            c.execute("\\")
 
         c.add("empty", a.empty)
         c.execute("empty")
