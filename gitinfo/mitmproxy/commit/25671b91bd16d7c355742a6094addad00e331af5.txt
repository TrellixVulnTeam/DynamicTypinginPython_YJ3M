commit 25671b91bd16d7c355742a6094addad00e331af5
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Fri Jun 3 14:53:51 2016 +1200

    Fix flow handling for mitmdump
    
    Fixes #1188

diff --git a/mitmproxy/dump.py b/mitmproxy/dump.py
index b1005ee7..cc6896ed 100644
--- a/mitmproxy/dump.py
+++ b/mitmproxy/dump.py
@@ -333,17 +333,15 @@ class DumpMaster(flow.FlowMaster):
 
     @controller.handler
     def request(self, f):
-        flow.FlowMaster.request(self, f)
-        self.state.delete_flow(f)
+        f = flow.FlowMaster.request(self, f)
         if f:
-            f.reply()
+            self.state.delete_flow(f)
         return f
 
     @controller.handler
     def response(self, f):
-        flow.FlowMaster.response(self, f)
+        f = flow.FlowMaster.response(self, f)
         if f:
-            f.reply()
             self._process_flow(f)
         return f
 
