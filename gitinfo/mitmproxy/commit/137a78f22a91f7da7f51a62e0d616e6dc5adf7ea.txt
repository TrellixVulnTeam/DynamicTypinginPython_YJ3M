commit 137a78f22a91f7da7f51a62e0d616e6dc5adf7ea
Author: Matthew Shao <me@matshao.com>
Date:   Thu Jan 11 09:23:50 2018 +0800

    Add test for fix#2766.

diff --git a/test/mitmproxy/addons/test_clientplayback.py b/test/mitmproxy/addons/test_clientplayback.py
index 2dc7eb92..3f990668 100644
--- a/test/mitmproxy/addons/test_clientplayback.py
+++ b/test/mitmproxy/addons/test_clientplayback.py
@@ -52,6 +52,10 @@ class TestClientPlayback:
             cp.stop_replay()
             assert not cp.flows
 
+            df = tflow.DummyFlow(tflow.tclient_conn(), tflow.tserver_conn(), True)
+            with pytest.raises(exceptions.CommandError, match="Can't replay live flow."):
+                cp.start_replay([df])
+
     def test_load_file(self, tmpdir):
         cp = clientplayback.ClientPlayback()
         with taddons.context():
