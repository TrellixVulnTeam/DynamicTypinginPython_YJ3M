commit eb297d82aafe3f3880e35676eba9361f4f459110
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Sat Mar 24 11:19:03 2018 +0100

    fix Tornado 5.0 event loop
    
    https://github.com/tornadoweb/tornado/issues/2183#issuecomment-371001254

diff --git a/setup.py b/setup.py
index 88d46ec5..d973249f 100644
--- a/setup.py
+++ b/setup.py
@@ -77,7 +77,7 @@ setup(
         "pyperclip>=1.6.0, <1.7",
         "ruamel.yaml>=0.13.2, <0.16",
         "sortedcontainers>=1.5.4, <1.6",
-        "tornado>=4.3, <4.6",
+        "tornado>=4.3,<5.1",
         "urwid>=2.0.1,<2.1",
         "wsproto>=0.11.0,<0.12.0",
     ],
diff --git a/test/mitmproxy/addons/test_onboarding.py b/test/mitmproxy/addons/test_onboarding.py
index 810ddef1..0d99b1ff 100644
--- a/test/mitmproxy/addons/test_onboarding.py
+++ b/test/mitmproxy/addons/test_onboarding.py
@@ -4,6 +4,10 @@ from mitmproxy.addons import onboarding
 from mitmproxy.test import taddons
 from .. import tservers
 
+import asyncio
+import tornado.platform.asyncio
+asyncio.set_event_loop_policy(tornado.platform.asyncio.AnyThreadEventLoopPolicy())
+
 
 class TestApp(tservers.HTTPProxyTest):
     def addons(self):
