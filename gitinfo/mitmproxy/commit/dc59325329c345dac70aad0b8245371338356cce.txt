commit dc59325329c345dac70aad0b8245371338356cce
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sun Jan 19 17:40:26 2014 +1300

    Refactor docs to define nav sidebar in only one place.

diff --git a/doc-src/_layout.html b/doc-src/_layout.html
index 836a3e9d..c5fb6376 100644
--- a/doc-src/_layout.html
+++ b/doc-src/_layout.html
@@ -16,54 +16,7 @@
   <div class="row">
     <div class="span3">
       <div class="well sidebar-nav">
-        <ul class="nav nav-list">
-            $!nav(idxpath, this, state)!$
-            $!nav("install.html", this, state)!$
-            $!nav("howmitmproxy.html", this, state)!$
-
-            <li class="nav-header">Tools</li>
-                $!nav("mitmproxy.html", this, state)!$
-                $!nav("mitmdump.html", this, state)!$
-
-            <li class="nav-header">Features</li>
-                $!nav("anticache.html", this, state)!$
-                $!nav("clientreplay.html", this, state)!$
-                $!nav("filters.html", this, state)!$
-                $!nav("proxyauth.html", this, state)!$
-                $!nav("replacements.html", this, state)!$
-                $!nav("serverreplay.html", this, state)!$
-                $!nav("setheaders.html", this, state)!$
-                $!nav("sticky.html", this, state)!$
-                $!nav("reverseproxy.html", this, state)!$
-                $!nav("upstreamcerts.html", this, state)!$
-
-            <li class="nav-header">Installing Certificates</li>
-                $!nav("ssl.html", this, state)!$
-                $!nav("certinstall/firefox.html", this, state)!$
-                $!nav("certinstall/osx.html", this, state)!$
-                $!nav("certinstall/windows7.html", this, state)!$
-                $!nav("certinstall/ios.html", this, state)!$
-                $!nav("certinstall/ios-simulator.html", this, state)!$
-                $!nav("certinstall/android.html", this, state)!$
-
-            <li class="nav-header">Transparent Proxying</li>
-                $!nav("transparent.html", this, state)!$
-                $!nav("transparent/linux.html", this, state)!$
-                $!nav("transparent/osx.html", this, state)!$
-
-            <li class="nav-header">Tutorials</li>
-                $!nav("tutorials/30second.html", this, state)!$
-                $!nav("tutorials/gamecenter.html", this, state)!$
-                $!nav("tutorials/transparent-dhcp.html", this, state)!$
-
-            <li class="nav-header">Scripting mitmproxy</li>
-                $!nav("scripting/inlinescripts.html", this, state)!$
-                $!nav("scripting/libmproxy.html", this, state)!$
-
-            <li class="nav-header">Hacking</li>
-                $!nav("dev/testing.html", this, state)!$
-
-        </ul>
+            $!navbar!$
       </div>
     </div>
 
diff --git a/doc-src/_nav.html b/doc-src/_nav.html
new file mode 100644
index 00000000..3b7c9e80
--- /dev/null
+++ b/doc-src/_nav.html
@@ -0,0 +1,47 @@
+<ul class="nav nav-list">
+    $!nav(idxpath, this, state)!$
+    $!nav("install.html", this, state)!$
+    $!nav("howmitmproxy.html", this, state)!$
+
+    <li class="nav-header">Tools</li>
+        $!nav("mitmproxy.html", this, state)!$
+        $!nav("mitmdump.html", this, state)!$
+
+    <li class="nav-header">Features</li>
+        $!nav("anticache.html", this, state)!$
+        $!nav("clientreplay.html", this, state)!$
+        $!nav("filters.html", this, state)!$
+        $!nav("proxyauth.html", this, state)!$
+        $!nav("replacements.html", this, state)!$
+        $!nav("serverreplay.html", this, state)!$
+        $!nav("setheaders.html", this, state)!$
+        $!nav("sticky.html", this, state)!$
+        $!nav("reverseproxy.html", this, state)!$
+        $!nav("upstreamcerts.html", this, state)!$
+
+    <li class="nav-header">Installing Certificates</li>
+        $!nav("ssl.html", this, state)!$
+        $!nav("certinstall/firefox.html", this, state)!$
+        $!nav("certinstall/osx.html", this, state)!$
+        $!nav("certinstall/windows7.html", this, state)!$
+        $!nav("certinstall/ios.html", this, state)!$
+        $!nav("certinstall/ios-simulator.html", this, state)!$
+        $!nav("certinstall/android.html", this, state)!$
+
+    <li class="nav-header">Transparent Proxying</li>
+        $!nav("transparent.html", this, state)!$
+        $!nav("transparent/linux.html", this, state)!$
+        $!nav("transparent/osx.html", this, state)!$
+
+    <li class="nav-header">Tutorials</li>
+        $!nav("tutorials/30second.html", this, state)!$
+        $!nav("tutorials/gamecenter.html", this, state)!$
+        $!nav("tutorials/transparent-dhcp.html", this, state)!$
+
+    <li class="nav-header">Scripting mitmproxy</li>
+        $!nav("scripting/inlinescripts.html", this, state)!$
+        $!nav("scripting/libmproxy.html", this, state)!$
+
+    <li class="nav-header">Hacking</li>
+        $!nav("dev/testing.html", this, state)!$
+</ul>
diff --git a/doc-src/_websitelayout.html b/doc-src/_websitelayout.html
index 3e9dfad7..cd0d23e2 100644
--- a/doc-src/_websitelayout.html
+++ b/doc-src/_websitelayout.html
@@ -6,7 +6,7 @@
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </a>
-      <a class="brand" href="@!urlTo('/index.html')!@">mitmproxy</a>
+      <a class="brand" href="@!urlTo(idxpath)!@">mitmproxy</a>
       <div class="nav">
         <ul class="nav">
           <li $!'class="active"' if this.match("/index.html", True) else ""!$> <a href="@!top!@/index.html">home</a> </li>
@@ -23,51 +23,7 @@
 
     <div class="span3">
       <div class="well sidebar-nav">
-        <ul class="nav nav-list">
-            $!nav(idxpath, this, state)!$
-            $!nav("install.html", this, state)!$
-            $!nav("howmitmproxy.html", this, state)!$
-
-            <li class="nav-header">Tools</li>
-                $!nav("mitmproxy.html", this, state)!$
-                $!nav("mitmdump.html", this, state)!$
-
-            <li class="nav-header">Features</li>
-                $!nav("anticache.html", this, state)!$
-                $!nav("clientreplay.html", this, state)!$
-                $!nav("filters.html", this, state)!$
-                $!nav("proxyauth.html", this, state)!$
-                $!nav("replacements.html", this, state)!$
-                $!nav("serverreplay.html", this, state)!$
-                $!nav("setheaders.html", this, state)!$
-                $!nav("sticky.html", this, state)!$
-                $!nav("reverseproxy.html", this, state)!$
-                $!nav("upstreamcerts.html", this, state)!$
-
-            <li class="nav-header">SSL interception</li>
-                $!nav("ssl.html", this, state)!$
-                $!nav("certinstall/firefox.html", this, state)!$
-                $!nav("certinstall/osx.html", this, state)!$
-                $!nav("certinstall/windows7.html", this, state)!$
-                $!nav("certinstall/ios.html", this, state)!$
-                $!nav("certinstall/android.html", this, state)!$
-
-            <li class="nav-header">Transparent Proxying</li>
-                $!nav("transparent.html", this, state)!$
-                $!nav("transparent/linux.html", this, state)!$
-                $!nav("transparent/osx.html", this, state)!$
-
-             <li class="nav-header">Tutorials</li>
-                $!nav("tutorials/30second.html", this, state)!$
-                $!nav("tutorials/gamecenter.html", this, state)!$
-
-            <li class="nav-header">Scripting mitmproxy</li>
-                $!nav("scripting/inlinescripts.html", this, state)!$
-                $!nav("scripting/libmproxy.html", this, state)!$
-
-            <li class="nav-header">Hacking</li>
-                $!nav("dev/testing.html", this, state)!$
-        </ul>
+            $!navbar!$
       </div>
     </div>
     <div class="span9">
diff --git a/doc-src/index.py b/doc-src/index.py
index 8f18e714..f222de14 100644
--- a/doc-src/index.py
+++ b/doc-src/index.py
@@ -15,7 +15,6 @@ else:
     ns.idxpath = "index.html"
     this.layout = countershape.Layout("_layout.html")
 
-
 ns.title = countershape.template.Template(None, "<h1>@!this.title!@</h1>")
 this.titlePrefix = "%s - " % version.NAMEVERSION
 this.markup = markup.Markdown(extras=["footnotes"])
@@ -72,6 +71,7 @@ def nav(page, current, state):
     p = state.application.getPage(page)
     return pre + '<a href="%s">%s</a></li>'%(model.UrlTo(page), p.title)
 ns.nav = nav
+ns.navbar = countershape.template.File(None, "_nav.html")
 
 pages = [
     Page("index.html", "Introduction"),
