commit 1b5337e4d44ec0b3d3dc34d8bac66aa0ffff480a
Author: Henrique <typoon@gmail.com>
Date:   Mon Nov 25 09:17:40 2019 -0500

    Making windows happy

diff --git a/mitmproxy/addons/command_history.py b/mitmproxy/addons/command_history.py
index c66af2be..8c1ef052 100644
--- a/mitmproxy/addons/command_history.py
+++ b/mitmproxy/addons/command_history.py
@@ -1,6 +1,7 @@
 import collections
 import os
 import typing
+import atexit
 
 from mitmproxy import command
 from mitmproxy import ctx
@@ -28,6 +29,12 @@ class CommandHistory:
         for l in _history_lines:
             self.add_command(l.strip())
 
+        atexit.register(self.cleanup)
+
+    def cleanup(self):
+        if self.command_history_file:
+            self.command_history_file.close()
+
     @property
     def last_filtered_index(self):
         return len(self.filtered_commands) - 1
