commit daa24b77b49b4841e1a42918f90f65563f182d12
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Tue Aug 1 21:48:00 2017 +0200

    Update proxyauth.py
    
    fix #2334

diff --git a/mitmproxy/addons/proxyauth.py b/mitmproxy/addons/proxyauth.py
index 5f884b55..64233e88 100644
--- a/mitmproxy/addons/proxyauth.py
+++ b/mitmproxy/addons/proxyauth.py
@@ -61,7 +61,7 @@ class ProxyAuth:
             - True, if authentication is done as if mitmproxy is a proxy
             - False, if authentication is done as if mitmproxy is a HTTP server
         """
-        return ctx.options.mode in ("regular", "upstream")
+        return ctx.options.mode == "regular" or ctx.options.mode.startswith("upstream:")
 
     def which_auth_header(self) -> str:
         if self.is_proxy_auth():
