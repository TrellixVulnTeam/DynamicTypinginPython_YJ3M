commit 1548185a17a824273f28a9a20298b2f4a8df4569
Author: Shadab Zafar <dufferzafar0@gmail.com>
Date:   Tue Mar 1 18:38:55 2016 +0530

    Use requests' json parameter

diff --git a/mitmproxy/flow_export.py b/mitmproxy/flow_export.py
index 97d5f403..b3bef62f 100644
--- a/mitmproxy/flow_export.py
+++ b/mitmproxy/flow_export.py
@@ -5,22 +5,6 @@ import netlib.http
 from . import contentviews
 
 
-def prettify(data, headers=None):
-    if not headers:
-        return data
-
-    cv = contentviews.get_content_view(
-        contentviews.get("Auto"),
-        data,
-        headers=headers,
-    )
-
-    if cv[0] == "JSON":
-        return "\n".join(l[0][1] for l in cv[1])
-    else:
-        return data
-
-
 def curl_command(flow):
     data = "curl "
 
@@ -71,8 +55,18 @@ def python_code(flow):
 
     data = ""
     if flow.request.body:
-        data = "\ndata = '''%s'''\n" % prettify(flow.request.body, flow.request.headers)
-        args += "\n    data=data,"
+        cv = contentviews.get_content_view(
+            viewmode=contentviews.get("Auto"),
+            data=flow.request.body,
+            headers=flow.request.headers,
+        )
+
+        if cv[0] == "JSON":
+            data = "\njson = %s\n" % "\n".join(l[0][1] for l in cv[1])
+            args += "\n    json=json,"
+        else:
+            data = "\ndata = '''%s'''\n" % flow.request.body
+            args += "\n    data=data,"
 
     code = code.format(
         url=url,
