commit ad120c380aeca740d3a9a24b05dc3f181a9557b7
Author: Yoann L <yoann.lamouroux@data-impact.fr>
Date:   Fri Oct 25 10:38:35 2019 +0200

    fixes #3559
    
    if the `:authority` header is not found, we can try to guess it from
    variable `flow.request.pretty_host` as .pop() accepts a fallback
    parameter

diff --git a/mitmproxy/addons/clientplayback.py b/mitmproxy/addons/clientplayback.py
index c56c0e74..13fbfebb 100644
--- a/mitmproxy/addons/clientplayback.py
+++ b/mitmproxy/addons/clientplayback.py
@@ -203,7 +203,7 @@ class ClientPlayback:
             # https://github.com/mitmproxy/mitmproxy/issues/2197
             if hf.request.http_version == "HTTP/2.0":
                 hf.request.http_version = "HTTP/1.1"
-                host = hf.request.headers.pop(":authority")
+                host = hf.request.headers.pop(":authority", hf.request.pretty_host)
                 hf.request.headers.insert(0, "host", host)
             self.q.put(hf)
         ctx.master.addons.trigger("update", lst)
