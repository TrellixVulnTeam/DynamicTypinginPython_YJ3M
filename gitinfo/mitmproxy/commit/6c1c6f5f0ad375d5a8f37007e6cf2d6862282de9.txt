commit 6c1c6f5f0ad375d5a8f37007e6cf2d6862282de9
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Fri Jun 5 20:49:03 2015 +0200

    http2: fix EchoHandler test helper

diff --git a/test/http2/test_http2_protocol.py b/test/http2/test_http2_protocol.py
index 6a275430..cb46bc68 100644
--- a/test/http2/test_http2_protocol.py
+++ b/test/http2/test_http2_protocol.py
@@ -12,9 +12,10 @@ class EchoHandler(tcp.BaseHandler):
     sni = None
 
     def handle(self):
-        v = self.rfile.readline()
-        self.wfile.write(v)
-        self.wfile.flush()
+        while True:
+            v = self.rfile.safe_read(1)
+            self.wfile.write(v)
+            self.wfile.flush()
 
 
 class TestCheckALPNMatch(test.ServerTestBase):
