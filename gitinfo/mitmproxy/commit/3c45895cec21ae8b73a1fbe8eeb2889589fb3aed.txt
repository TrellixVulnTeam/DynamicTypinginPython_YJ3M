commit 3c45895cec21ae8b73a1fbe8eeb2889589fb3aed
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Sun Jul 30 02:32:35 2017 +0200

    move isatty check to a better place

diff --git a/mitmproxy/tools/console/master.py b/mitmproxy/tools/console/master.py
index 775817c7..ef3ab0b3 100644
--- a/mitmproxy/tools/console/master.py
+++ b/mitmproxy/tools/console/master.py
@@ -15,7 +15,6 @@ import urwid
 from mitmproxy import addons
 from mitmproxy import master
 from mitmproxy import log
-from mitmproxy import options  # noqa
 from mitmproxy.addons import intercept
 from mitmproxy.addons import readfile
 from mitmproxy.addons import view
@@ -172,6 +171,11 @@ class ConsoleMaster(master.Master):
         self.loop.process_input([key])
 
     def run(self):
+        if not sys.stdout.isatty():
+            print("Error: mitmproxy's console interface requires a tty. "
+                  "Please run mitmproxy in an interactive shell environment.", file=sys.stderr)
+            sys.exit(1)
+
         self.ui = urwid.raw_display.Screen()
         self.ui.set_terminal_properties(256)
         self.set_palette(self.options, None)
diff --git a/mitmproxy/tools/main.py b/mitmproxy/tools/main.py
index d9be06ff..e8cdffca 100644
--- a/mitmproxy/tools/main.py
+++ b/mitmproxy/tools/main.py
@@ -123,11 +123,6 @@ def mitmproxy(args=None):  # pragma: no cover
 
     assert_utf8_env()
 
-    if not sys.stdout.isatty():
-        print("Error: mitmproxy's console interface requires a tty. "
-              "Please run mitmproxy in an interactive shell environment.", file=sys.stderr)
-        sys.exit(1)
-
     from mitmproxy.tools import console
     run(console.master.ConsoleMaster, cmdline.mitmproxy, args)
 
