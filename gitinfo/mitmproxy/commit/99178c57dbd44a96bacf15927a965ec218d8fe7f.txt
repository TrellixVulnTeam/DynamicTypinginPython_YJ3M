commit 99178c57dbd44a96bacf15927a965ec218d8fe7f
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Fri May 6 12:39:00 2016 -0700

    issue-1115

diff --git a/mitmproxy/flow.py b/mitmproxy/flow.py
index d05aabbb..0e084588 100644
--- a/mitmproxy/flow.py
+++ b/mitmproxy/flow.py
@@ -1021,8 +1021,6 @@ class FlowMaster(controller.ServerMaster):
         return f
 
     def handle_responseheaders(self, f):
-        self.run_script_hook("responseheaders", f)
-
         try:
             if self.stream_large_bodies:
                 self.stream_large_bodies.run(f, False)
@@ -1030,6 +1028,8 @@ class FlowMaster(controller.ServerMaster):
             f.reply(Kill)
             return
 
+        self.run_script_hook("responseheaders", f)
+
         f.reply()
         return f
 
