commit cd2b4ea058e82ef9e2dc824a379309d68f08cec4
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Tue Jan 26 19:38:17 2016 +0100

    bump h2 dependency and use latest API

diff --git a/libmproxy/protocol/http2.py b/libmproxy/protocol/http2.py
index 71423bf7..23004497 100644
--- a/libmproxy/protocol/http2.py
+++ b/libmproxy/protocol/http2.py
@@ -144,7 +144,7 @@ class Http2Layer(Layer):
                 raise HttpException("HTTP body too large. Limit is {}.".format(self.config.body_size_limit))
             self.streams[eid].data_queue.put(event.data)
             self.streams[eid].queued_data_length += len(event.data)
-            source_conn.h2.safe_increment_flow_control(event.stream_id, len(event.data))
+            source_conn.h2.safe_increment_flow_control(event.stream_id, event.flow_controlled_length)
         elif isinstance(event, StreamEnded):
             self.streams[eid].timestamp_end = time.time()
             self.streams[eid].data_finished.set()
diff --git a/setup.py b/setup.py
index c7686c6e..522857fd 100644
--- a/setup.py
+++ b/setup.py
@@ -17,7 +17,7 @@ with open(os.path.join(here, 'README.rst'), encoding='utf-8') as f:
 # This will break `pip install` on systems with old setuptools versions.
 deps = {
     "netlib>=%s, <%s" % (version.MINORVERSION, version.NEXT_MINORVERSION),
-    "h2>=2.0.0",
+    "h2>=2.1.0, <3.0",
     "tornado>=4.3.0, <4.4",
     "configargparse>=0.10.0, <0.11",
     "pyperclip>=1.5.22, <1.6",
