commit 1a106f4080d89a236a193f2cb007a00aa195a1ad
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Fri May 29 11:36:56 2015 +1200

    Ensure that flow/view state is consistent.
    
    Fixes #595 and #592

diff --git a/libmproxy/flow.py b/libmproxy/flow.py
index 553bfd84..4893b725 100644
--- a/libmproxy/flow.py
+++ b/libmproxy/flow.py
@@ -459,8 +459,9 @@ class FlowStore(FlowList):
         Notifies the state that a flow has been updated.
         The flow must be present in the state.
         """
-        for view in self.views:
-            view._update(f)
+        if f in self:
+            for view in self.views:
+                view._update(f)
 
     def _remove(self, f):
         """
