commit 52d696df3d23a2ef1d32131752634d97b7fc965c
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Thu Feb 5 16:46:55 2015 +0100

    fix ssl shutdown in tcp mode, refs #464

diff --git a/libmproxy/protocol/tcp.py b/libmproxy/protocol/tcp.py
index d2d21829..5314b577 100644
--- a/libmproxy/protocol/tcp.py
+++ b/libmproxy/protocol/tcp.py
@@ -56,7 +56,9 @@ class TCPHandler(ProtocolHandler):
                         conns.remove(src.rfile)
                         # Shutdown connection to the other peer
                         if dst.ssl_established:
-                            dst.connection.shutdown()
+                            # We can't half-close a connection, so we just close everything here.
+                            # Sockets will be cleaned up on a higher level.
+                            return
                         else:
                             dst.connection.shutdown(socket.SHUT_WR)
 
