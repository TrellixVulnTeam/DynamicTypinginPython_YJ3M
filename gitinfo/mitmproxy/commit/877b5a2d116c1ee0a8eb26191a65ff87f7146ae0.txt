commit 877b5a2d116c1ee0a8eb26191a65ff87f7146ae0
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Sun Jun 24 15:12:31 2012 +1200

    Add staticdir to test.Test.

diff --git a/libpathod/test.py b/libpathod/test.py
index 943fe3c0..cb1b9745 100644
--- a/libpathod/test.py
+++ b/libpathod/test.py
@@ -8,7 +8,7 @@ IFACE = "127.0.0.1"
 class Daemon:
     def __init__(self, staticdir=None, anchors=(), ssl=None):
         self.q = Queue.Queue()
-        self.thread = PaThread(self.q, ssl)
+        self.thread = PaThread(self.q, ssl, staticdir)
         self.thread.start()
         self.port = self.q.get(True, 5)
         self.urlbase = "%s://%s:%s"%("https" if ssl else "http", IFACE, self.port)
@@ -43,9 +43,9 @@ class Daemon:
 
 
 class PaThread(threading.Thread):
-    def __init__(self, q, ssl):
+    def __init__(self, q, ssl, staticdir):
         threading.Thread.__init__(self)
-        self.q, self.ssl = q, ssl
+        self.q, self.ssl, self.staticdir = q, ssl, staticdir
         self.port = None
 
     def run(self):
@@ -56,7 +56,10 @@ class PaThread(threading.Thread):
             )
         else:
             ssloptions = self.ssl
-        self.server = pathod.Pathod((IFACE, 0), ssloptions=ssloptions)
-        #self.server, self.port = pathod.make_server(self.app, 0, IFACE, ssloptions)
+        self.server = pathod.Pathod(
+            (IFACE, 0),
+            ssloptions = ssloptions,
+            staticdir = self.staticdir
+        )
         self.q.put(self.server.port)
         self.server.serve_forever()
diff --git a/test/data/file b/test/data/file
new file mode 100644
index 00000000..26918572
--- /dev/null
+++ b/test/data/file
@@ -0,0 +1 @@
+testfile
diff --git a/test/test_test.py b/test/test_test.py
index 7053bd73..b9a9cfac 100644
--- a/test/test_test.py
+++ b/test/test_test.py
@@ -38,7 +38,7 @@ class TestDaemonManual:
 class TestDaemon:
     @classmethod
     def setUpAll(self):
-        self.d = test.Daemon()
+        self.d = test.Daemon(staticdir=tutils.test_data.path("data"))
 
     @classmethod
     def tearDownAll(self):
@@ -67,5 +67,10 @@ class TestDaemon:
         rsp = self.get("400:msg,b:")
         assert rsp.status_code == 800
 
+    def test_static(self):
+        rsp = self.get("200:b<file")
+        assert rsp.status_code == 200
+        assert rsp.content.strip() == "testfile"
+
 
 
