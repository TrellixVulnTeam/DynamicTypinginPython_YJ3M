commit 8e39b7bf38e7becd1116dfcded380327fd0228d0
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Wed May 18 19:28:23 2016 -0700

    test flow export with duplicate query string

diff --git a/test/mitmproxy/test_flow_export.py b/test/mitmproxy/test_flow_export.py
index 2b1f897c..c252c5bd 100644
--- a/test/mitmproxy/test_flow_export.py
+++ b/test/mitmproxy/test_flow_export.py
@@ -21,7 +21,7 @@ def python_equals(testdata, text):
     assert clean_blanks(text).rstrip() == clean_blanks(d).rstrip()
 
 
-req_get = lambda: netlib.tutils.treq(method='GET', content='', path=b"/")
+req_get = lambda: netlib.tutils.treq(method='GET', content='', path=b"/path?a=foo&a=bar&b=baz")
 
 req_post = lambda: netlib.tutils.treq(method='POST', headers=None)
 
@@ -31,7 +31,7 @@ req_patch = lambda: netlib.tutils.treq(method='PATCH', path=b"/path?query=param"
 class TestExportCurlCommand():
     def test_get(self):
         flow = tutils.tflow(req=req_get())
-        result = """curl -H 'header:qvalue' -H 'content-length:7' 'http://address/path'"""
+        result = """curl -H 'header:qvalue' -H 'content-length:7' 'http://address/path?a=foo&a=bar&b=baz'"""
         assert flow_export.curl_command(flow) == result
 
     def test_post(self):
@@ -70,7 +70,7 @@ class TestRawRequest():
     def test_get(self):
         flow = tutils.tflow(req=req_get())
         result = dedent("""
-            GET /path HTTP/1.1\r
+            GET /path?a=foo&a=bar&b=baz HTTP/1.1\r
             header: qvalue\r
             content-length: 7\r
             host: address:22\r
diff --git a/test/mitmproxy/test_flow_export/locust_get.py b/test/mitmproxy/test_flow_export/locust_get.py
index 72d5932a..632d5d53 100644
--- a/test/mitmproxy/test_flow_export/locust_get.py
+++ b/test/mitmproxy/test_flow_export/locust_get.py
@@ -14,10 +14,16 @@ class UserBehavior(TaskSet):
             'content-length': '7',
         }
 
+        params = {
+            'a': ['foo', 'bar'],
+            'b': 'baz',
+        }
+
         self.response = self.client.request(
             method='GET',
             url=url,
             headers=headers,
+            params=params,
         )
 
     ### Additional tasks can go here ###
diff --git a/test/mitmproxy/test_flow_export/locust_task_get.py b/test/mitmproxy/test_flow_export/locust_task_get.py
index 76f144fa..03821cd8 100644
--- a/test/mitmproxy/test_flow_export/locust_task_get.py
+++ b/test/mitmproxy/test_flow_export/locust_task_get.py
@@ -7,8 +7,14 @@
             'content-length': '7',
         }
 
+        params = {
+            'a': ['foo', 'bar'],
+            'b': 'baz',
+        }
+
         self.response = self.client.request(
             method='GET',
             url=url,
             headers=headers,
+            params=params,
         )
diff --git a/test/mitmproxy/test_flow_export/python_get.py b/test/mitmproxy/test_flow_export/python_get.py
index ee3f48eb..af8f7c81 100644
--- a/test/mitmproxy/test_flow_export/python_get.py
+++ b/test/mitmproxy/test_flow_export/python_get.py
@@ -7,10 +7,16 @@ headers = {
     'content-length': '7',
 }
 
+params = {
+    'a': ['foo', 'bar'],
+    'b': 'baz',
+}
+
 response = requests.request(
     method='GET',
     url=url,
     headers=headers,
+    params=params,
 )
 
 print(response.text)
