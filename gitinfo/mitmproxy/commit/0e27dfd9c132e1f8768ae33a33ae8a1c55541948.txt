commit 0e27dfd9c132e1f8768ae33a33ae8a1c55541948
Author: yonder <kzxiao.hy@gmail.com>
Date:   Fri Mar 4 11:12:03 2016 -0500

    Improve test case

diff --git a/mitmproxy/cmdline.py b/mitmproxy/cmdline.py
index eb15a1d2..b1b860f8 100644
--- a/mitmproxy/cmdline.py
+++ b/mitmproxy/cmdline.py
@@ -119,7 +119,7 @@ def parse_server_spec(url):
 
 
 def parse_upstream_auth(auth):
-    pattern = re.compile(":")
+    pattern = re.compile(".+:")
     if pattern.search(auth) is None:
         raise configargparse.ArgumentTypeError(
             "Invalid upstream auth specification: %s" % auth
diff --git a/test/mitmproxy/test_cmdline.py b/test/mitmproxy/test_cmdline.py
index 1546bb41..e75b7baf 100644
--- a/test/mitmproxy/test_cmdline.py
+++ b/test/mitmproxy/test_cmdline.py
@@ -56,8 +56,12 @@ def test_parse_server_spec():
 
 def test_parse_upstream_auth():
     tutils.raises("Invalid upstream auth specification", cmdline.parse_upstream_auth, "")
+    tutils.raises("Invalid upstream auth specification", cmdline.parse_upstream_auth, ":")
+    tutils.raises("Invalid upstream auth specification", cmdline.parse_upstream_auth, ":test")
     assert cmdline.parse_upstream_auth(
         "test:test") == "Basic" + " " + base64.b64encode("test:test")
+    assert cmdline.parse_upstream_auth(
+        "test:") == "Basic" + " " + base64.b64encode("test:")
 
 
 def test_parse_setheaders():
