commit 260f7290922a013274d701cec2601648f71c4d59
Author: Aldo Cortesi <aldo@corte.si>
Date:   Sat May 12 11:39:44 2018 +1200

    Commit taken messages on kill
    
    Fixes 2879

diff --git a/mitmproxy/controller.py b/mitmproxy/controller.py
index 582a6683..6e219066 100644
--- a/mitmproxy/controller.py
+++ b/mitmproxy/controller.py
@@ -113,6 +113,8 @@ class Reply:
 
     def kill(self, force=False):
         self.send(exceptions.Kill, force)
+        if self._state == "taken":
+            self.commit()
 
     def send(self, msg, force=False):
         if self.state not in {"start", "taken"}:
