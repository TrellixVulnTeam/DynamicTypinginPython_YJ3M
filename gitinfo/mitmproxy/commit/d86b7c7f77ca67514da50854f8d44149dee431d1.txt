commit d86b7c7f77ca67514da50854f8d44149dee431d1
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon May 13 21:41:16 2013 +1200

    Prin an error when mitmproxy runs in a non-UTF environment.

diff --git a/mitmproxy b/mitmproxy
index b1e22fac..e4d72ed8 100755
--- a/mitmproxy
+++ b/mitmproxy
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program.  If not, see <http://www.gnu.org/licenses/>.
 
-import sys, argparse
+import sys, argparse, os
 from libmproxy import proxy, console, cmdline, version
 from libmproxy.console import palettes
 
@@ -62,6 +62,12 @@ if __name__ == '__main__':
     opts.debug = options.debug
     opts.palette = options.palette
 
+    if "utf" not in os.environ.get("LANG", "").lower():
+        print >> sys.stderr, "Error: mitmproxy requires a UTF console environment."
+        print >> sys.stderr, "Set your LANG enviroment variable to something like en_US.UTF-8"
+        sys.exit(1)
+        
+
     m = console.ConsoleMaster(server, opts)
     try:
         m.run()
