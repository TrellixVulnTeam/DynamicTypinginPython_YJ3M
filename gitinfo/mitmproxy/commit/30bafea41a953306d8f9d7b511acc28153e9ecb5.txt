commit 30bafea41a953306d8f9d7b511acc28153e9ecb5
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Fri Apr 29 20:33:07 2016 -0700

    tcp protocol: stop on server shutdown

diff --git a/mitmproxy/protocol/rawtcp.py b/mitmproxy/protocol/rawtcp.py
index b87899e4..7d18025e 100644
--- a/mitmproxy/protocol/rawtcp.py
+++ b/mitmproxy/protocol/rawtcp.py
@@ -39,7 +39,7 @@ class RawTCPLayer(Layer):
         conns = [client, server]
 
         try:
-            while True:
+            while not self.channel.should_exit.is_set():
                 r = ssl_read_select(conns, 10)
                 for conn in r:
                     dst = server if conn == client else client
