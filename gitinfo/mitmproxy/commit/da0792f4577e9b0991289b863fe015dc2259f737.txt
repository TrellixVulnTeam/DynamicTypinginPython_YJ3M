commit da0792f4577e9b0991289b863fe015dc2259f737
Author: Thomas Kriechbaumer <thomas@kriechbaumer.name>
Date:   Mon Jun 8 13:14:35 2015 +0200

    import travis config from netlib
    
    this enables ALPN support with OpenSSL 1.0.2

diff --git a/.travis.yml b/.travis.yml
index 7c4dca92..83fcc265 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,14 +1,47 @@
 language: python
+
+sudo: false
+
 python:
   - "2.7"
-# command to install dependencies, e.g. pip install -r requirements.txt --use-mirrors
-install: 
-  - "pip install --src .. -r requirements.txt"
-# command to run tests, e.g. python setup.py test
-script: 
+  - pypy
+
+matrix:
+  include:
+    - python: 2.7
+      env: OPENSSL=1.0.2
+      addons:
+        apt:
+          sources:
+            # Debian sid currently holds OpenSSL 1.0.2
+            # change this with future releases!
+            - debian-sid
+          packages:
+            - libssl-dev
+    - python: pypy
+      env: OPENSSL=1.0.2
+      addons:
+        apt:
+          sources:
+            # Debian sid currently holds OpenSSL 1.0.2
+            # change this with future releases!
+            - debian-sid
+          packages:
+            - libssl-dev
+
+install:
+  - "pip install --src . -r requirements.txt"
+
+before_script:
+  - "openssl version -a"
+
+script:
   - "nosetests --with-cov --cov-report term-missing"
-after_success: 
+  - "./check_coding_style.sh"
+
+after_success:
   - coveralls
+
 notifications:
   irc:
     channels:
@@ -16,3 +49,19 @@ notifications:
     on_success: change
     on_failure: always
 
+# exclude cryptography from cache
+# it depends on libssl-dev version
+# which needs to be compiled specifically to each version
+before_cache:
+  - pip uninstall -y cryptography
+  - rm -rf /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/cryptography/
+  - rm -rf /home/travis/virtualenv/pypy-2.5.0/site-packages/cryptography/
+  - rm /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
+  - rm /home/travis/virtualenv/pypy-2.5.0/site-packages/pip/_vendor/requests/packages/urllib3/contrib/pyopenssl.py
+
+cache:
+  directories:
+    - /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages
+    - /home/travis/virtualenv/python2.7.9/bin
+    - /home/travis/virtualenv/pypy-2.5.0/site-packages
+    - /home/travis/virtualenv/pypy-2.5.0/bin
