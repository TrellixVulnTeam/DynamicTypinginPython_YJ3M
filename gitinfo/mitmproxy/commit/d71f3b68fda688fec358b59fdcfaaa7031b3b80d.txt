commit d71f3b68fda688fec358b59fdcfaaa7031b3b80d
Author: Maximilian Hils <git@maximilianhils.com>
Date:   Fri Feb 27 22:27:23 2015 +0100

    make tests more robust, fix coveralls

diff --git a/.travis.yml b/.travis.yml
index a2e8d5ff..aac6b272 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -20,4 +20,6 @@ notifications:
 cache:
   directories:
   - /home/travis/virtualenv/python2.7.9/lib/python2.7/site-packages
-  - /home/travis/virtualenv/pypy-2.5.0/site-packages
\ No newline at end of file
+  - /home/travis/virtualenv/python2.7.9/bin
+  - /home/travis/virtualenv/pypy-2.5.0/site-packages
+  - /home/travis/virtualenv/pypy-2.5.0/bin
\ No newline at end of file
diff --git a/netlib/test.py b/netlib/test.py
index 3a23ba8f..db30c0e6 100644
--- a/netlib/test.py
+++ b/netlib/test.py
@@ -15,7 +15,7 @@ class ServerThread(threading.Thread):
         self.server.shutdown()
 
 
-class ServerTestBase:
+class ServerTestBase(object):
     ssl = None
     handler = None
     addr = ("localhost", 0)
diff --git a/test/test_tcp.py b/test/test_tcp.py
index 21fea23e..2216e0d4 100644
--- a/test/test_tcp.py
+++ b/test/test_tcp.py
@@ -563,6 +563,7 @@ class TestServer(test.ServerTestBase):
         c.wfile.flush()
         assert c.rfile.readline() == testval
 
+
 class TestSSLKeyLogger(test.ServerTestBase):
     handler = EchoHandler
     ssl = dict(
@@ -582,6 +583,7 @@ class TestSSLKeyLogger(test.ServerTestBase):
             c = tcp.TCPClient(("127.0.0.1", self.port))
             c.connect()
             c.convert_to_ssl()
+            c.finish()
             tcp.log_ssl_key.close()
             with open(logfile, "rb") as f:
                 assert f.read().count("CLIENT_RANDOM") == 2
