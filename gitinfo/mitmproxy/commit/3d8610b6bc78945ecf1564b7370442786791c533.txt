commit 3d8610b6bc78945ecf1564b7370442786791c533
Author: Aldo Cortesi <aldo@nullcube.com>
Date:   Mon Jun 25 11:22:44 2012 +1200

    Move server to new explicit netlib API.

diff --git a/libpathod/pathoc.py b/libpathod/pathoc.py
index c2abcaeb..5105decf 100644
--- a/libpathod/pathoc.py
+++ b/libpathod/pathoc.py
@@ -26,4 +26,3 @@ class Pathoc(tcp.TCPClient):
         r.serve(self.wfile)
         self.wfile.flush()
         return http.read_response(self.rfile, r.method, None)
-
diff --git a/libpathod/pathod.py b/libpathod/pathod.py
index bc2bf6af..3d0f73e3 100644
--- a/libpathod/pathod.py
+++ b/libpathod/pathod.py
@@ -109,7 +109,9 @@ class Pathod(tcp.TCPServer):
         )
 
     def handle_connection(self, request, client_address):
-        PathodHandler(request, client_address, self)
+        h = PathodHandler(request, client_address, self)
+        h.handle()
+        h.finish()
 
     def add_log(self, d):
         lock = threading.Lock()
