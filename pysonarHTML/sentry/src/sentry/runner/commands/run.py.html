<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/sentry/src/sentry/runner/commands/run.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType'>AddressParamType</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.name', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.name'>name</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__'>__call__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert'>convert</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.Address', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.Address'>Address</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType'>QueueSetType</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.name', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.name'>name</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert'>convert</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSet', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSet'>QueueSet</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.run', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.run'>run</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options'>batching_kafka_options</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault'>ault</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> from __future__ import absolute_import, print_function
<span class='lineno'>   2</span> 
<span class='lineno'>   3</span> import signal
<span class='lineno'>   4</span> import sys
<span class='lineno'>   5</span> from multiprocessing import cpu_count
<span class='lineno'>   6</span> 
<span class='lineno'>   7</span> import click
<span class='lineno'>   8</span> 
<span class='lineno'>   9</span> from sentry.runner.decorators import configuration, log_options
<span class='lineno'>  10</span> from sentry.bgtasks.api import managed_bgtasks
<span class='lineno'>  11</span> from sentry.ingest.types import ConsumerType
<span class='lineno'>  12</span> 
<span class='lineno'>  13</span> 
<span class='lineno'>  14</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType', title='<AddressParamType>'>AddressParamType</a>(click.ParamType):
<span class='lineno'>  15</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.name', title='str'>name</a> = &quot;address&quot;
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__', title='(AddressParamType, ?, None, None) -> (None, int)'>__call__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.self', title='AddressParamType'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', title='?'>value</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.param', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.param', title='None'>param</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.ctx', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.ctx', title='None'>ctx</a>=None):
<span class='lineno'>  18</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', title='?'>value</a> is None:
<span class='lineno'>  19</span>             return (None, None)
<span class='lineno'>  20</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.self', title='AddressParamType'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert', title='(AddressParamType, ?, ?, ?) -> (?, int) / (AddressParamType, ?, None, None) -> (?, int)'>convert</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.value', title='?'>value</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.param', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.param', title='None'>param</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.ctx', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.__call__.ctx', title='None'>ctx</a>)
<span class='lineno'>  21</span> 
<span class='lineno'>  22</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert', title='(AddressParamType, ?, ?, ?) -> (?, int) / (AddressParamType, ?, None, None) -> (?, int)'>convert</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.self', title='AddressParamType'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', title='?'>value</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.param', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.param', title='None'>param</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.ctx', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.ctx', title='None'>ctx</a>):
<span class='lineno'>  23</span>         if &quot;:&quot; in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', title='?'>value</a>:
<span class='lineno'>  24</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', title='?'>host</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', title='?'>port</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', title='?'>value</a>.split(&quot;:&quot;, 1)
<span class='lineno'>  25</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', title='int'>port</a> = int(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', title='?'>port</a>)
<span class='lineno'>  26</span>         else:
<span class='lineno'>  27</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', title='?'>host</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.value', title='?'>value</a>
<span class='lineno'>  28</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', title='None'>port</a> = None
<span class='lineno'>  29</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.host', title='?'>host</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType.convert.port', title='int'>port</a>
<span class='lineno'>  30</span> 
<span class='lineno'>  31</span> 
<span class='lineno'>  32</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.Address', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.Address', title='AddressParamType'>Address</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.AddressParamType', title='<AddressParamType>'>AddressParamType</a>()
<span class='lineno'>  33</span> 
<span class='lineno'>  34</span> 
<span class='lineno'>  35</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType', title='<QueueSetType>'>QueueSetType</a>(click.ParamType):
<span class='lineno'>  36</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.name', title='str'>name</a> = &quot;text&quot;
<span class='lineno'>  37</span> 
<span class='lineno'>  38</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert', title='(QueueSetType, ?, ?, ?) -> None'>convert</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.self', title='QueueSetType'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', title='?'>value</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.param', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.param', title='?'>param</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.ctx', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.ctx', title='?'>ctx</a>):
<span class='lineno'>  39</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', title='?'>value</a> is None:
<span class='lineno'>  40</span>             return None
<span class='lineno'>  41</span>         # Providing a compatibility with splitting
<span class='lineno'>  42</span>         # the `events` queue until multiple queues
<span class='lineno'>  43</span>         # without the need to explicitly add them.
<span class='lineno'>  44</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a> = set()
<span class='lineno'>  45</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', title='?'>queue</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.value', title='?'>value</a>.split(&quot;,&quot;):
<span class='lineno'>  46</span>             if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', title='?'>queue</a> == &quot;events&quot;:
<span class='lineno'>  47</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a>.add(&quot;events.preprocess_event&quot;)
<span class='lineno'>  48</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a>.add(&quot;events.process_event&quot;)
<span class='lineno'>  49</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a>.add(&quot;events.save_event&quot;)
<span class='lineno'>  50</span> 
<span class='lineno'>  51</span>                 from sentry.runner.initializer import show_big_error
<span class='lineno'>  52</span> 
<span class='lineno'>  53</span>                 show_big_error(
<span class='lineno'>  54</span>                     [
<span class='lineno'>  55</span>                         &quot;DEPRECATED&quot;,
<span class='lineno'>  56</span>                         &quot;`events` queue no longer exists.&quot;,
<span class='lineno'>  57</span>                         &quot;Switch to using:&quot;,
<span class='lineno'>  58</span>                         &quot;- events.preprocess_event&quot;,
<span class='lineno'>  59</span>                         &quot;- events.process_event&quot;,
<span class='lineno'>  60</span>                         &quot;- events.save_event&quot;,
<span class='lineno'>  61</span>                     ]
<span class='lineno'>  62</span>                 )
<span class='lineno'>  63</span>             else:
<span class='lineno'>  64</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a>.add(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queue', title='?'>queue</a>)
<span class='lineno'>  65</span>         return frozenset(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType.convert.queues', title='?'>queues</a>)
<span class='lineno'>  66</span> 
<span class='lineno'>  67</span> 
<span class='lineno'>  68</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSet', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSet', title='QueueSetType'>QueueSet</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.QueueSetType', title='<QueueSetType>'>QueueSetType</a>()
<span class='lineno'>  69</span> 
<span class='lineno'>  70</span> 
<span class='lineno'>  71</span> @click.group()
<span class='lineno'>  72</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.run', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.run', title='() -> None'>run</a>():
<span class='lineno'>  73</span>     &quot;Run a service.&quot;
<span class='lineno'>  74</span> 
<span class='lineno'>  75</span> 
<span class='lineno'>  76</span> @run.command()
<span class='lineno'>  77</span> @click.option(&quot;--bind&quot;, &quot;-b&quot;, def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='(?, ?, ?, ?, ?, ?) -> ?'>ault</a>=None, help=&quot;Bind address.&quot;, type=Address)
<span class='lineno'>  78</span> @click.option(
<span class='lineno'>  79</span>     &quot;--workers&quot;, &quot;-w&quot;, default=0, help=&quot;The number of worker processes for handling requests.&quot;
<span class='lineno'>  80</span> )
<span class='lineno'>  81</span> @click.option(&quot;--upgrade&quot;, default=False, is_flag=True, help=&quot;Upgrade before starting.&quot;)
<span class='lineno'>  82</span> @click.option(
<span class='lineno'>  83</span>     &quot;--with-lock&quot;, default=False, is_flag=True, help=&quot;Use a lock if performing an upgrade.&quot;
<span class='lineno'>  84</span> )
<span class='lineno'>  85</span> @click.option(
<span class='lineno'>  86</span>     &quot;--noinput&quot;, default=False, is_flag=True, help=&quot;Do not prompt the user for input of any kind.&quot;
<span class='lineno'>  87</span> )
<span class='lineno'>  88</span> @click.option(
<span class='lineno'>  89</span>     &quot;--uwsgi/--no-uwsgi&quot;,
<span class='lineno'>  90</span>     default=True,
<span class='lineno'>  91</span>     is_flag=True,
<span class='lineno'>  92</span>     help=&quot;Use uWSGI (default) or non-uWSGI (useful for debuggers such as PyCharm&#39;s)&quot;,
<span class='lineno'>  93</span> )
<span class='lineno'>  94</span> @log_options()
<span class='lineno'>  95</span> @configuration
<span class='lineno'>  96</span> def web(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', title='?'>bind</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.workers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.workers', title='?'>workers</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.upgrade', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.upgrade', title='?'>upgrade</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', title='?'>with_lock</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.noinput', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.noinput', title='?'>noinput</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.uwsgi', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.uwsgi', title='?'>uwsgi</a>):
<span class='lineno'>  97</span>     &quot;Run web service.&quot;
<span class='lineno'>  98</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.upgrade', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.upgrade', title='?'>upgrade</a>:
<span class='lineno'>  99</span>         click.echo(&quot;Performing upgrade before service startup...&quot;)
<span class='lineno'> 100</span>         from sentry.runner import call_command
<span class='lineno'> 101</span> 
<span class='lineno'> 102</span>         try:
<span class='lineno'> 103</span>             call_command(
<span class='lineno'> 104</span>                 &quot;sentry.runner.commands.upgrade.upgrade&quot;,
<span class='lineno'> 105</span>                 verbosity=0,
<span class='lineno'> 106</span>                 noinput=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.noinput', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.noinput', title='?'>noinput</a>,
<span class='lineno'> 107</span>                 lock=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', title='?'>with_lock</a>,
<span class='lineno'> 108</span>             )
<span class='lineno'> 109</span>         except click.ClickException:
<span class='lineno'> 110</span>             if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.with_lock', title='?'>with_lock</a>:
<span class='lineno'> 111</span>                 click.echo(&quot;!! Upgrade currently running from another process, skipping.&quot;, err=True)
<span class='lineno'> 112</span>             else:
<span class='lineno'> 113</span>                 raise
<span class='lineno'> 114</span> 
<span class='lineno'> 115</span>     with managed_bgtasks(role=&quot;web&quot;):
<span class='lineno'> 116</span>         if not <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.uwsgi', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.uwsgi', title='?'>uwsgi</a>:
<span class='lineno'> 117</span>             click.echo(
<span class='lineno'> 118</span>                 &quot;Running simple HTTP server. Note that chunked file &quot;
<span class='lineno'> 119</span>                 &quot;uploads will likely not work.&quot;,
<span class='lineno'> 120</span>                 err=True,
<span class='lineno'> 121</span>             )
<span class='lineno'> 122</span> 
<span class='lineno'> 123</span>             from django.conf import settings
<span class='lineno'> 124</span> 
<span class='lineno'> 125</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', title='?'>host</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', title='?'>bind</a>[0] or settings.SENTRY_WEB_HOST
<span class='lineno'> 126</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', title='?'>port</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', title='?'>bind</a>[1] or settings.SENTRY_WEB_PORT
<span class='lineno'> 127</span>             click.echo(&quot;Address: http://%s:%s/&quot; % (<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', title='?'>host</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', title='?'>port</a>))
<span class='lineno'> 128</span> 
<span class='lineno'> 129</span>             from wsgiref.simple_server import make_server
<span class='lineno'> 130</span>             from sentry.wsgi import application
<span class='lineno'> 131</span> 
<span class='lineno'> 132</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.httpd', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.httpd', title='?'>httpd</a> = make_server(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.host', title='?'>host</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.port', title='?'>port</a>, application)
<span class='lineno'> 133</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.httpd', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.httpd', title='?'>httpd</a>.serve_forever()
<span class='lineno'> 134</span>         else:
<span class='lineno'> 135</span>             from sentry.services.http import SentryHTTPServer
<span class='lineno'> 136</span> 
<span class='lineno'> 137</span>             SentryHTTPServer(host=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', title='?'>bind</a>[0], port=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.bind', title='?'>bind</a>[1], workers=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.workers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault.workers', title='?'>workers</a>).run()
<span class='lineno'> 138</span> 
<span class='lineno'> 139</span> 
<span class='lineno'> 140</span> @run.command()
<span class='lineno'> 141</span> @click.option(&quot;--bind&quot;, &quot;-b&quot;, def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a>=None, help=&quot;Bind address.&quot;, type=Address)
<span class='lineno'> 142</span> @click.option(&quot;--upgrade&quot;, default=False, is_flag=True, help=&quot;Upgrade before starting.&quot;)
<span class='lineno'> 143</span> @click.option(
<span class='lineno'> 144</span>     &quot;--noinput&quot;, default=False, is_flag=True, help=&quot;Do not prompt the user for input of any kind.&quot;
<span class='lineno'> 145</span> )
<span class='lineno'> 146</span> @configuration
<span class='lineno'> 147</span> def smtp(bind, upgrade, noinput):
<span class='lineno'> 148</span>     &quot;Run inbound email service.&quot;
<span class='lineno'> 149</span>     if upgrade:
<span class='lineno'> 150</span>         click.echo(&quot;Performing upgrade before service startup...&quot;)
<span class='lineno'> 151</span>         from sentry.runner import call_command
<span class='lineno'> 152</span> 
<span class='lineno'> 153</span>         call_command(&quot;sentry.runner.commands.upgrade.upgrade&quot;, verbosity=0, noinput=noinput)
<span class='lineno'> 154</span> 
<span class='lineno'> 155</span>     from sentry.services.smtp import SentrySMTPServer
<span class='lineno'> 156</span> 
<span class='lineno'> 157</span>     with managed_bgtasks(role=&quot;smtp&quot;):
<span class='lineno'> 158</span>         SentrySMTPServer(host=bind[0], port=bind[1]).run()
<span class='lineno'> 159</span> 
<span class='lineno'> 160</span> 
<span class='lineno'> 161</span> @run.command()
<span class='lineno'> 162</span> @click.option(
<span class='lineno'> 163</span>     &quot;--hostname&quot;,
<span class='lineno'> 164</span>     &quot;-n&quot;,
<span class='lineno'> 165</span>     help=(
<span class='lineno'> 166</span>         &quot;Set custom hostname, e.g. &#39;w1.%h&#39;. Expands: %h&quot; &quot;(hostname), %n (name) and %d, (domain).&quot;
<span class='lineno'> 167</span>     ),
<span class='lineno'> 168</span> )
<span class='lineno'> 169</span> @click.option(
<span class='lineno'> 170</span>     &quot;--queues&quot;,
<span class='lineno'> 171</span>     &quot;-Q&quot;,
<span class='lineno'> 172</span>     type=QueueSet,
<span class='lineno'> 173</span>     help=(
<span class='lineno'> 174</span>         &quot;List of queues to enable for this worker, separated by &quot;
<span class='lineno'> 175</span>         &quot;comma. By def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a> all configured queues are enabled. &quot;
<span class='lineno'> 176</span>         &quot;Example: -Q video,image&quot;
<span class='lineno'> 177</span>     ),
<span class='lineno'> 178</span> )
<span class='lineno'> 179</span> @click.option(&quot;--exclude-queues&quot;, &quot;-X&quot;, type=QueueSet)
<span class='lineno'> 180</span> @click.option(
<span class='lineno'> 181</span>     &quot;--concurrency&quot;,
<span class='lineno'> 182</span>     &quot;-c&quot;,
<span class='lineno'> 183</span>     default=cpu_count(),
<span class='lineno'> 184</span>     help=(
<span class='lineno'> 185</span>         &quot;Number of child processes processing the queue. The &quot;
<span class='lineno'> 186</span>         &quot;default is the number of CPUs available on your &quot;
<span class='lineno'> 187</span>         &quot;system.&quot;
<span class='lineno'> 188</span>     ),
<span class='lineno'> 189</span> )
<span class='lineno'> 190</span> @click.option(
<span class='lineno'> 191</span>     &quot;--logfile&quot;, &quot;-f&quot;, help=(&quot;Path to log file. If no logfile is specified, stderr is used.&quot;)
<span class='lineno'> 192</span> )
<span class='lineno'> 193</span> @click.option(&quot;--quiet&quot;, &quot;-q&quot;, is_flag=True, default=False)
<span class='lineno'> 194</span> @click.option(&quot;--no-color&quot;, is_flag=True, default=False)
<span class='lineno'> 195</span> @click.option(&quot;--autoreload&quot;, is_flag=True, default=False, help=&quot;Enable autoreloading.&quot;)
<span class='lineno'> 196</span> @click.option(&quot;--without-gossip&quot;, is_flag=True, default=False)
<span class='lineno'> 197</span> @click.option(&quot;--without-mingle&quot;, is_flag=True, default=False)
<span class='lineno'> 198</span> @click.option(&quot;--without-heartbeat&quot;, is_flag=True, default=False)
<span class='lineno'> 199</span> @click.option(&quot;--max-tasks-per-child&quot;, default=10000)
<span class='lineno'> 200</span> @log_options()
<span class='lineno'> 201</span> @configuration
<span class='lineno'> 202</span> def worker(**options):
<span class='lineno'> 203</span>     &quot;Run background worker instance.&quot;
<span class='lineno'> 204</span>     from django.conf import settings
<span class='lineno'> 205</span> 
<span class='lineno'> 206</span>     if settings.CELERY_ALWAYS_EAGER:
<span class='lineno'> 207</span>         raise click.ClickException(
<span class='lineno'> 208</span>             &quot;Disable CELERY_ALWAYS_EAGER in your settings file to spawn workers.&quot;
<span class='lineno'> 209</span>         )
<span class='lineno'> 210</span> 
<span class='lineno'> 211</span>     # These options are no longer used, but keeping around
<span class='lineno'> 212</span>     # for backwards compatibility
<span class='lineno'> 213</span>     for o in &quot;without_gossip&quot;, &quot;without_mingle&quot;, &quot;without_heartbeat&quot;:
<span class='lineno'> 214</span>         options.pop(o, None)
<span class='lineno'> 215</span> 
<span class='lineno'> 216</span>     from sentry.celery import app
<span class='lineno'> 217</span> 
<span class='lineno'> 218</span>     with managed_bgtasks(role=&quot;worker&quot;):
<span class='lineno'> 219</span>         worker = app.Worker(
<span class='lineno'> 220</span>             # NOTE: without_mingle breaks everything,
<span class='lineno'> 221</span>             # we can&#39;t get rid of this. Intentionally kept
<span class='lineno'> 222</span>             # here as a warning. Jobs will not process.
<span class='lineno'> 223</span>             # without_mingle=True,
<span class='lineno'> 224</span>             without_gossip=True,
<span class='lineno'> 225</span>             without_heartbeat=True,
<span class='lineno'> 226</span>             pool_cls=&quot;processes&quot;,
<span class='lineno'> 227</span>             **options
<span class='lineno'> 228</span>         )
<span class='lineno'> 229</span>         worker.start()
<span class='lineno'> 230</span>         try:
<span class='lineno'> 231</span>             sys.exit(worker.exitcode)
<span class='lineno'> 232</span>         except AttributeError:
<span class='lineno'> 233</span>             # `worker.exitcode` was added in a newer version of Celery:
<span class='lineno'> 234</span>             # https://github.com/celery/celery/commit/dc28e8a5
<span class='lineno'> 235</span>             # so this is an attempt to be forwards compatible
<span class='lineno'> 236</span>             pass
<span class='lineno'> 237</span> 
<span class='lineno'> 238</span> 
<span class='lineno'> 239</span> @run.command()
<span class='lineno'> 240</span> @click.option(
<span class='lineno'> 241</span>     &quot;--pidfile&quot;,
<span class='lineno'> 242</span>     help=(
<span class='lineno'> 243</span>         &quot;Optional file used to store the process pid. The &quot;
<span class='lineno'> 244</span>         &quot;program will not start if this file already exists and &quot;
<span class='lineno'> 245</span>         &quot;the pid is still alive.&quot;
<span class='lineno'> 246</span>     ),
<span class='lineno'> 247</span> )
<span class='lineno'> 248</span> @click.option(
<span class='lineno'> 249</span>     &quot;--logfile&quot;, &quot;-f&quot;, help=(&quot;Path to log file. If no logfile is specified, stderr is used.&quot;)
<span class='lineno'> 250</span> )
<span class='lineno'> 251</span> @click.option(&quot;--quiet&quot;, &quot;-q&quot;, is_flag=True, def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a>=False)
<span class='lineno'> 252</span> @click.option(&quot;--no-color&quot;, is_flag=True, default=False)
<span class='lineno'> 253</span> @click.option(&quot;--autoreload&quot;, is_flag=True, default=False, help=&quot;Enable autoreloading.&quot;)
<span class='lineno'> 254</span> @click.option(&quot;--without-gossip&quot;, is_flag=True, default=False)
<span class='lineno'> 255</span> @click.option(&quot;--without-mingle&quot;, is_flag=True, default=False)
<span class='lineno'> 256</span> @click.option(&quot;--without-heartbeat&quot;, is_flag=True, default=False)
<span class='lineno'> 257</span> @log_options()
<span class='lineno'> 258</span> @configuration
<span class='lineno'> 259</span> def cron(**options):
<span class='lineno'> 260</span>     &quot;Run periodic task dispatcher.&quot;
<span class='lineno'> 261</span>     from django.conf import settings
<span class='lineno'> 262</span> 
<span class='lineno'> 263</span>     if settings.CELERY_ALWAYS_EAGER:
<span class='lineno'> 264</span>         raise click.ClickException(
<span class='lineno'> 265</span>             &quot;Disable CELERY_ALWAYS_EAGER in your settings file to spawn workers.&quot;
<span class='lineno'> 266</span>         )
<span class='lineno'> 267</span> 
<span class='lineno'> 268</span>     from sentry.celery import app
<span class='lineno'> 269</span> 
<span class='lineno'> 270</span>     with managed_bgtasks(role=&quot;cron&quot;):
<span class='lineno'> 271</span>         app.Beat(
<span class='lineno'> 272</span>             # without_gossip=True,
<span class='lineno'> 273</span>             # without_mingle=True,
<span class='lineno'> 274</span>             # without_heartbeat=True,
<span class='lineno'> 275</span>             **options
<span class='lineno'> 276</span>         ).run()
<span class='lineno'> 277</span> 
<span class='lineno'> 278</span> 
<span class='lineno'> 279</span> @run.command(&quot;post-process-forwarder&quot;)
<span class='lineno'> 280</span> @click.option(
<span class='lineno'> 281</span>     &quot;--consumer-group&quot;,
<span class='lineno'> 282</span>     def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a>=&quot;snuba-post-processor&quot;,
<span class='lineno'> 283</span>     help=&quot;Consumer group used to track event offsets that have been enqueued for post-processing.&quot;,
<span class='lineno'> 284</span> )
<span class='lineno'> 285</span> @click.option(
<span class='lineno'> 286</span>     &quot;--commit-log-topic&quot;,
<span class='lineno'> 287</span>     default=&quot;snuba-commit-log&quot;,
<span class='lineno'> 288</span>     help=&quot;Topic that the Snuba writer is publishing its committed offsets to.&quot;,
<span class='lineno'> 289</span> )
<span class='lineno'> 290</span> @click.option(
<span class='lineno'> 291</span>     &quot;--synchronize-commit-group&quot;,
<span class='lineno'> 292</span>     default=&quot;snuba-consumers&quot;,
<span class='lineno'> 293</span>     help=&quot;Consumer group that the Snuba writer is committing its offset as.&quot;,
<span class='lineno'> 294</span> )
<span class='lineno'> 295</span> @click.option(
<span class='lineno'> 296</span>     &quot;--commit-batch-size&quot;,
<span class='lineno'> 297</span>     default=1000,
<span class='lineno'> 298</span>     type=int,
<span class='lineno'> 299</span>     help=&quot;How many messages to process (may or may not result in an enqueued task) before committing offsets.&quot;,
<span class='lineno'> 300</span> )
<span class='lineno'> 301</span> @click.option(
<span class='lineno'> 302</span>     &quot;--initial-offset-reset&quot;,
<span class='lineno'> 303</span>     default=&quot;latest&quot;,
<span class='lineno'> 304</span>     type=click.Choice([&quot;earliest&quot;, &quot;latest&quot;]),
<span class='lineno'> 305</span>     help=&quot;Position in the commit log topic to begin reading from when no prior offset has been recorded.&quot;,
<span class='lineno'> 306</span> )
<span class='lineno'> 307</span> @log_options()
<span class='lineno'> 308</span> @configuration
<span class='lineno'> 309</span> def post_process_forwarder(**options):
<span class='lineno'> 310</span>     from sentry import eventstream
<span class='lineno'> 311</span>     from sentry.eventstream.base import ForwarderNotRequired
<span class='lineno'> 312</span> 
<span class='lineno'> 313</span>     try:
<span class='lineno'> 314</span>         eventstream.run_post_process_forwarder(
<span class='lineno'> 315</span>             consumer_group=options[&quot;consumer_group&quot;],
<span class='lineno'> 316</span>             commit_log_topic=options[&quot;commit_log_topic&quot;],
<span class='lineno'> 317</span>             synchronize_commit_group=options[&quot;synchronize_commit_group&quot;],
<span class='lineno'> 318</span>             commit_batch_size=options[&quot;commit_batch_size&quot;],
<span class='lineno'> 319</span>             initial_offset_reset=options[&quot;initial_offset_reset&quot;],
<span class='lineno'> 320</span>         )
<span class='lineno'> 321</span>     except ForwarderNotRequired:
<span class='lineno'> 322</span>         sys.stdout.write(
<span class='lineno'> 323</span>             &quot;The configured event stream backend does not need a forwarder &quot;
<span class='lineno'> 324</span>             &quot;process to enqueue post-process tasks. Exiting...\n&quot;
<span class='lineno'> 325</span>         )
<span class='lineno'> 326</span>         return
<span class='lineno'> 327</span> 
<span class='lineno'> 328</span> 
<span class='lineno'> 329</span> @run.command(&quot;query-subscription-consumer&quot;)
<span class='lineno'> 330</span> @click.option(
<span class='lineno'> 331</span>     &quot;--group&quot;,
<span class='lineno'> 332</span>     def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a>=&quot;query-subscription-consumer&quot;,
<span class='lineno'> 333</span>     help=&quot;Consumer group to track query subscription offsets. &quot;,
<span class='lineno'> 334</span> )
<span class='lineno'> 335</span> @click.option(&quot;--topic&quot;, default=None, help=&quot;Topic to get subscription updates from.&quot;)
<span class='lineno'> 336</span> @click.option(
<span class='lineno'> 337</span>     &quot;--commit-batch-size&quot;,
<span class='lineno'> 338</span>     default=100,
<span class='lineno'> 339</span>     type=int,
<span class='lineno'> 340</span>     help=&quot;How many messages to process before committing offsets.&quot;,
<span class='lineno'> 341</span> )
<span class='lineno'> 342</span> @click.option(
<span class='lineno'> 343</span>     &quot;--initial-offset-reset&quot;,
<span class='lineno'> 344</span>     default=&quot;latest&quot;,
<span class='lineno'> 345</span>     type=click.Choice([&quot;earliest&quot;, &quot;latest&quot;]),
<span class='lineno'> 346</span>     help=&quot;Position in the commit log topic to begin reading from when no prior offset has been recorded.&quot;,
<span class='lineno'> 347</span> )
<span class='lineno'> 348</span> @log_options()
<span class='lineno'> 349</span> @configuration
<span class='lineno'> 350</span> def query_subscription_consumer(**options):
<span class='lineno'> 351</span>     from sentry.snuba.query_subscription_consumer import QuerySubscriptionConsumer
<span class='lineno'> 352</span> 
<span class='lineno'> 353</span>     subscriber = QuerySubscriptionConsumer(
<span class='lineno'> 354</span>         group_id=options[&quot;group&quot;],
<span class='lineno'> 355</span>         topic=options[&quot;topic&quot;],
<span class='lineno'> 356</span>         commit_batch_size=options[&quot;commit_batch_size&quot;],
<span class='lineno'> 357</span>         initial_offset_reset=options[&quot;initial_offset_reset&quot;],
<span class='lineno'> 358</span>     )
<span class='lineno'> 359</span> 
<span class='lineno'> 360</span>     def handler(signum, frame):
<span class='lineno'> 361</span>         subscriber.shutdown()
<span class='lineno'> 362</span> 
<span class='lineno'> 363</span>     signal.signal(signal.SIGINT, handler)
<span class='lineno'> 364</span> 
<span class='lineno'> 365</span>     subscriber.run()
<span class='lineno'> 366</span> 
<span class='lineno'> 367</span> 
<span class='lineno'> 368</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options', title='? -> ? -> None'>batching_kafka_options</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.group', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.group', title='?'>group</a>):
<span class='lineno'> 369</span>     &quot;&quot;&quot;
<span class='lineno'> 370</span>     Expose batching_kafka_consumer options as CLI args.
<span class='lineno'> 371</span> 
<span class='lineno'> 372</span>     TODO(markus): Probably want to have this as part of batching_kafka_consumer
<span class='lineno'> 373</span>     as this is duplicated effort between Snuba and Sentry.
<span class='lineno'> 374</span>     &quot;&quot;&quot;
<span class='lineno'> 375</span> 
<span class='lineno'> 376</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner', title='? -> None'>inner</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>):
<span class='lineno'> 377</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a> = click.option(
<span class='lineno'> 378</span>             &quot;--consumer-group&quot;,
<span class='lineno'> 379</span>             &quot;group_id&quot;,
<span class='lineno'> 380</span>             default=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.group', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.group', title='?'>group</a>,
<span class='lineno'> 381</span>             help=&quot;Kafka consumer group for the outcomes consumer. &quot;,
<span class='lineno'> 382</span>         )(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>)
<span class='lineno'> 383</span> 
<span class='lineno'> 384</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a> = click.option(
<span class='lineno'> 385</span>             &quot;--max-batch-size&quot;,
<span class='lineno'> 386</span>             &quot;max_batch_size&quot;,
<span class='lineno'> 387</span>             default=100,
<span class='lineno'> 388</span>             type=int,
<span class='lineno'> 389</span>             help=&quot;How many messages to process before committing offsets.&quot;,
<span class='lineno'> 390</span>         )(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>)
<span class='lineno'> 391</span> 
<span class='lineno'> 392</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a> = click.option(
<span class='lineno'> 393</span>             &quot;--max-batch-time-ms&quot;,
<span class='lineno'> 394</span>             &quot;max_batch_time&quot;,
<span class='lineno'> 395</span>             default=1000,
<span class='lineno'> 396</span>             type=int,
<span class='lineno'> 397</span>             help=&quot;How long to batch for before committing offsets.&quot;,
<span class='lineno'> 398</span>         )(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>)
<span class='lineno'> 399</span> 
<span class='lineno'> 400</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a> = click.option(
<span class='lineno'> 401</span>             &quot;--auto-offset-reset&quot;,
<span class='lineno'> 402</span>             &quot;auto_offset_reset&quot;,
<span class='lineno'> 403</span>             default=&quot;latest&quot;,
<span class='lineno'> 404</span>             type=click.Choice([&quot;earliest&quot;, &quot;latest&quot;, &quot;error&quot;]),
<span class='lineno'> 405</span>             help=&quot;Position in the commit log topic to begin reading from when no prior offset has been recorded.&quot;,
<span class='lineno'> 406</span>         )(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>)
<span class='lineno'> 407</span> 
<span class='lineno'> 408</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner.f', title='?'>f</a>
<span class='lineno'> 409</span> 
<span class='lineno'> 410</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.batching_kafka_options.inner', title='? -> None'>inner</a>
<span class='lineno'> 411</span> 
<span class='lineno'> 412</span> 
<span class='lineno'> 413</span> @run.command(&quot;ingest-consumer&quot;)
<span class='lineno'> 414</span> @log_options()
<span class='lineno'> 415</span> @click.option(
<span class='lineno'> 416</span>     &quot;consumer_types&quot;,
<span class='lineno'> 417</span>     &quot;--consumer-type&quot;,
<span class='lineno'> 418</span>     def<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.runner.commands.run.ault', title='? -> ?'>ault</a>=[],
<span class='lineno'> 419</span>     multiple=True,
<span class='lineno'> 420</span>     help=&quot;Specify which type of consumer to create, i.e. from which topic to consume messages. By default all ingest-related topics are consumed &quot;,
<span class='lineno'> 421</span>     type=click.Choice(ConsumerType.all()),
<span class='lineno'> 422</span> )
<span class='lineno'> 423</span> @click.option(
<span class='lineno'> 424</span>     &quot;--all-consumer-types&quot;,
<span class='lineno'> 425</span>     default=False,
<span class='lineno'> 426</span>     is_flag=True,
<span class='lineno'> 427</span>     help=&quot;Listen to all consumer types at once.&quot;,
<span class='lineno'> 428</span> )
<span class='lineno'> 429</span> @batching_kafka_options(&quot;ingest-consumer&quot;)
<span class='lineno'> 430</span> @click.option(
<span class='lineno'> 431</span>     &quot;--concurrency&quot;,
<span class='lineno'> 432</span>     type=int,
<span class='lineno'> 433</span>     default=1,
<span class='lineno'> 434</span>     help=&quot;Spawn this many threads to process messages. Defaults to 1.&quot;,
<span class='lineno'> 435</span> )
<span class='lineno'> 436</span> @configuration
<span class='lineno'> 437</span> def ingest_consumer(consumer_types, all_consumer_types, **options):
<span class='lineno'> 438</span>     &quot;&quot;&quot;
<span class='lineno'> 439</span>     Runs an &quot;ingest consumer&quot; task.
<span class='lineno'> 440</span> 
<span class='lineno'> 441</span>     The &quot;ingest consumer&quot; tasks read events from a kafka topic (coming from Relay) and schedules
<span class='lineno'> 442</span>     process event celery tasks for them
<span class='lineno'> 443</span>     &quot;&quot;&quot;
<span class='lineno'> 444</span>     from sentry.ingest.ingest_consumer import get_ingest_consumer
<span class='lineno'> 445</span>     from sentry.utils import metrics
<span class='lineno'> 446</span> 
<span class='lineno'> 447</span>     if all_consumer_types:
<span class='lineno'> 448</span>         if consumer_types:
<span class='lineno'> 449</span>             raise click.ClickException(
<span class='lineno'> 450</span>                 &quot;Cannot specify --all-consumer types and --consumer-type at the same time&quot;
<span class='lineno'> 451</span>             )
<span class='lineno'> 452</span>         else:
<span class='lineno'> 453</span>             consumer_types = set(ConsumerType.all())
<span class='lineno'> 454</span> 
<span class='lineno'> 455</span>     if not all_consumer_types and not consumer_types:
<span class='lineno'> 456</span>         raise click.ClickException(&quot;Need to specify --all-consumer-types or --consumer-type&quot;)
<span class='lineno'> 457</span> 
<span class='lineno'> 458</span>     with metrics.global_tags(
<span class='lineno'> 459</span>         ingest_consumer_types=&quot;,&quot;.join(sorted(consumer_types)), _all_threads=True
<span class='lineno'> 460</span>     ):
<span class='lineno'> 461</span>         get_ingest_consumer(consumer_types=consumer_types, **options).run()
</pre></td></tr></table></body></html>