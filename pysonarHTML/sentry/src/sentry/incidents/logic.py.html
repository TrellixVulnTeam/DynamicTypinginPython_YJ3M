<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/sentry/src/sentry/incidents/logic.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS'>WINDOWED_STATS_DATA_POINTS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlreadyDeletedError', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlreadyDeletedError'>AlreadyDeletedError</a><ul>
</ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.InvalidTriggerActionError', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.InvalidTriggerActionError'>InvalidTriggerActionError</a><ul>
</ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident'>create_incident</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status'>update_incident_status</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen'>set_incident_seen</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity'>create_incident_activity</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment'>update_comment</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment'>delete_comment</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot'>create_pending_incident_snapshot</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot'>create_incident_snapshot</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot'>create_event_stat_snapshot</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params'>build_incident_query_params</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range'>calculate_incident_time_range</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow'>calculate_incident_prewindow</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats'>get_incident_event_stats</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates'>get_incident_aggregates</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats'>get_incident_stats</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident'>subscribe_to_incident</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident'>unsubscribe_from_incident</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers'>get_incident_subscribers</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity'>get_incident_activity</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleNameAlreadyUsedError', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleNameAlreadyUsedError'>AlertRuleNameAlreadyUsedError</a><ul>
</ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION'>DEFAULT_ALERT_RULE_RESOLUTION</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule'>create_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule'>snapshot_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule'>update_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule'>subscribe_projects_to_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule'>delete_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query'>validate_alert_rule_query</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule'>get_excluded_projects_for_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleTriggerLabelAlreadyUsedError', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleTriggerLabelAlreadyUsedError'>AlertRuleTriggerLabelAlreadyUsedError</a><ul>
</ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError'>ProjectsNotAssociatedWithAlertRuleError</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__'>__init__</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger'>create_alert_rule_trigger</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger'>update_alert_rule_trigger</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger'>delete_alert_rule_trigger</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule'>get_triggers_for_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule'>get_subscriptions_from_alert_rule</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action'>create_alert_rule_trigger_action</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action'>update_alert_rule_trigger_action</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id'>get_alert_rule_trigger_action_slack_channel_id</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action'>delete_alert_rule_trigger_action</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger'>get_actions_for_trigger</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org'>get_available_action_integrations_for_org</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS'>SUPPORTED_COLUMNS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS'>TRANSLATABLE_COLUMNS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate'>get_column_from_aggregate</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support'>check_aggregate_column_support</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field'>translate_aggregate_field</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> from __future__ import absolute_import
<span class='lineno'>   2</span> 
<span class='lineno'>   3</span> from copy import deepcopy
<span class='lineno'>   4</span> from datetime import timedelta
<span class='lineno'>   5</span> from itertools import chain
<span class='lineno'>   6</span> 
<span class='lineno'>   7</span> import six
<span class='lineno'>   8</span> from django.db import transaction
<span class='lineno'>   9</span> from django.db.models.signals import post_save
<span class='lineno'>  10</span> from django.utils import timezone
<span class='lineno'>  11</span> 
<span class='lineno'>  12</span> from sentry import analytics
<span class='lineno'>  13</span> from sentry.api.event_search import get_filter, resolve_field
<span class='lineno'>  14</span> from sentry.incidents import tasks
<span class='lineno'>  15</span> from sentry.incidents.models import (
<span class='lineno'>  16</span>     AlertRule,
<span class='lineno'>  17</span>     AlertRuleExcludedProjects,
<span class='lineno'>  18</span>     AlertRuleStatus,
<span class='lineno'>  19</span>     AlertRuleTrigger,
<span class='lineno'>  20</span>     AlertRuleTriggerAction,
<span class='lineno'>  21</span>     AlertRuleTriggerExclusion,
<span class='lineno'>  22</span>     Incident,
<span class='lineno'>  23</span>     IncidentActivity,
<span class='lineno'>  24</span>     IncidentActivityType,
<span class='lineno'>  25</span>     IncidentProject,
<span class='lineno'>  26</span>     IncidentSnapshot,
<span class='lineno'>  27</span>     PendingIncidentSnapshot,
<span class='lineno'>  28</span>     IncidentSeen,
<span class='lineno'>  29</span>     IncidentStatus,
<span class='lineno'>  30</span>     IncidentStatusMethod,
<span class='lineno'>  31</span>     IncidentSubscription,
<span class='lineno'>  32</span>     TimeSeriesSnapshot,
<span class='lineno'>  33</span> )
<span class='lineno'>  34</span> from sentry.models import Integration, Project
<span class='lineno'>  35</span> from sentry.snuba.dataset import Dataset
<span class='lineno'>  36</span> from sentry.snuba.models import QueryDatasets
<span class='lineno'>  37</span> from sentry.snuba.subscriptions import (
<span class='lineno'>  38</span>     bulk_create_snuba_subscriptions,
<span class='lineno'>  39</span>     bulk_delete_snuba_subscriptions,
<span class='lineno'>  40</span>     create_snuba_query,
<span class='lineno'>  41</span>     update_snuba_query,
<span class='lineno'>  42</span> )
<span class='lineno'>  43</span> from sentry.snuba.tasks import build_snuba_filter
<span class='lineno'>  44</span> from sentry.utils.compat import zip
<span class='lineno'>  45</span> from sentry.utils.dates import to_timestamp
<span class='lineno'>  46</span> from sentry.utils.snuba import bulk_raw_query, SnubaQueryParams, SnubaTSResult
<span class='lineno'>  47</span> from sentry.shared_integrations.exceptions import DuplicateDisplayNameError
<span class='lineno'>  48</span> 
<span class='lineno'>  49</span> # We can return an incident as &quot;windowed&quot; which returns a range of points around the start of the incident
<span class='lineno'>  50</span> # It attempts to center the start of the incident, only showing earlier data if there isn&#39;t enough time
<span class='lineno'>  51</span> # after the incident started to display the correct start date.
<span class='lineno'>  52</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', title='int'>WINDOWED_STATS_DATA_POINTS</a> = 200
<span class='lineno'>  53</span> 
<span class='lineno'>  54</span> 
<span class='lineno'>  55</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlreadyDeletedError', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlreadyDeletedError', title='<AlreadyDeletedError>'>AlreadyDeletedError</a>(Exception):
<span class='lineno'>  56</span>     pass
<span class='lineno'>  57</span> 
<span class='lineno'>  58</span> 
<span class='lineno'>  59</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.InvalidTriggerActionError', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.InvalidTriggerActionError', title='<InvalidTriggerActionError>'>InvalidTriggerActionError</a>(Exception):
<span class='lineno'>  60</span>     pass
<span class='lineno'>  61</span> 
<span class='lineno'>  62</span> 
<span class='lineno'>  63</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident', title='(?, ?, ?, ?, None, None, None, None, None) -> None'>create_incident</a>(
<span class='lineno'>  64</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.organization', title='?'>organization</a>,
<span class='lineno'>  65</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', title='?'>type_</a>,
<span class='lineno'>  66</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.title', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.title', title='?'>title</a>,
<span class='lineno'>  67</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', title='?'>date_started</a>,
<span class='lineno'>  68</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', title='None'>date_detected</a>=None,
<span class='lineno'>  69</span>     # TODO: Probably remove detection_uuid?
<span class='lineno'>  70</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.detection_uuid', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.detection_uuid', title='None'>detection_uuid</a>=None,
<span class='lineno'>  71</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', title='None'>projects</a>=None,
<span class='lineno'>  72</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.user', title='None'>user</a>=None,
<span class='lineno'>  73</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.alert_rule', title='None'>alert_rule</a>=None,
<span class='lineno'>  74</span> ):
<span class='lineno'>  75</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', title='None'>date_detected</a> is None:
<span class='lineno'>  76</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', title='?'>date_detected</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', title='?'>date_started</a>
<span class='lineno'>  77</span> 
<span class='lineno'>  78</span>     with transaction.atomic():
<span class='lineno'>  79</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a> = Incident.objects.create(
<span class='lineno'>  80</span>             organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.organization', title='?'>organization</a>,
<span class='lineno'>  81</span>             detection_uuid=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.detection_uuid', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.detection_uuid', title='None'>detection_uuid</a>,
<span class='lineno'>  82</span>             status=IncidentStatus.OPEN.value,
<span class='lineno'>  83</span>             type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', title='?'>type_</a>.value,
<span class='lineno'>  84</span>             title=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.title', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.title', title='?'>title</a>,
<span class='lineno'>  85</span>             date_started=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_started', title='?'>date_started</a>,
<span class='lineno'>  86</span>             date_detected=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.date_detected', title='None'>date_detected</a>,
<span class='lineno'>  87</span>             alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.alert_rule', title='None'>alert_rule</a>,
<span class='lineno'>  88</span>         )
<span class='lineno'>  89</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', title='None'>projects</a>:
<span class='lineno'>  90</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', title='[?]'>incident_projects</a> = [
<span class='lineno'>  91</span>                 IncidentProject(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a>, project=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', title='?'>project</a>) for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.project', title='?'>project</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.projects', title='None'>projects</a>
<span class='lineno'>  92</span>             ]
<span class='lineno'>  93</span>             IncidentProject.objects.bulk_create(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', title='[?]'>incident_projects</a>)
<span class='lineno'>  94</span>             # `bulk_create` doesn&#39;t send `post_save` signals, so we manually fire them here.
<span class='lineno'>  95</span>             for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', title='?'>incident_project</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_projects', title='[?]'>incident_projects</a>:
<span class='lineno'>  96</span>                 post_save.send(
<span class='lineno'>  97</span>                     sender=type(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', title='?'>incident_project</a>), instance=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident_project', title='?'>incident_project</a>, created=True
<span class='lineno'>  98</span>                 )
<span class='lineno'>  99</span> 
<span class='lineno'> 100</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', title='(?, ?, None, None, None, None, None) -> None'>create_incident_activity</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a>, IncidentActivityType.DETECTED, user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.user', title='None'>user</a>)
<span class='lineno'> 101</span>         analytics.record(
<span class='lineno'> 102</span>             &quot;incident.created&quot;,
<span class='lineno'> 103</span>             incident_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a>.id,
<span class='lineno'> 104</span>             organization_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a>.organization_id,
<span class='lineno'> 105</span>             incident_type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.type_', title='?'>type_</a>.value,
<span class='lineno'> 106</span>         )
<span class='lineno'> 107</span> 
<span class='lineno'> 108</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident.incident', title='?'>incident</a>
<span class='lineno'> 109</span> 
<span class='lineno'> 110</span> 
<span class='lineno'> 111</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status', title='(?, ?, None, None, ?, None) -> None'>update_incident_status</a>(
<span class='lineno'> 112</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>,
<span class='lineno'> 113</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a>,
<span class='lineno'> 114</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', title='None'>user</a>=None,
<span class='lineno'> 115</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.comment', title='None'>comment</a>=None,
<span class='lineno'> 116</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status_method', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status_method', title='?'>status_method</a>=IncidentStatusMethod.RULE_TRIGGERED,
<span class='lineno'> 117</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', title='None'>date_closed</a>=None,
<span class='lineno'> 118</span> ):
<span class='lineno'> 119</span>     &quot;&quot;&quot;
<span class='lineno'> 120</span>     Updates the status of an Incident and write an IncidentActivity row to log
<span class='lineno'> 121</span>     the change. When the status is CLOSED we also set the date closed to the
<span class='lineno'> 122</span>     current time and take a snapshot of the current incident state.
<span class='lineno'> 123</span>     &quot;&quot;&quot;
<span class='lineno'> 124</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.status == <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a>.value:
<span class='lineno'> 125</span>         # If the status isn&#39;t actually changing just no-op.
<span class='lineno'> 126</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>
<span class='lineno'> 127</span>     with transaction.atomic():
<span class='lineno'> 128</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', title='(?, ?, None, None, None, None, None) -> None'>create_incident_activity</a>(
<span class='lineno'> 129</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>,
<span class='lineno'> 130</span>             IncidentActivityType.STATUS_CHANGE,
<span class='lineno'> 131</span>             user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', title='None'>user</a>,
<span class='lineno'> 132</span>             value=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a>.value,
<span class='lineno'> 133</span>             previous_value=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.status,
<span class='lineno'> 134</span>             comment=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.comment', title='None'>comment</a>,
<span class='lineno'> 135</span>         )
<span class='lineno'> 136</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', title='None'>user</a>:
<span class='lineno'> 137</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', title='(?, ?) -> ? / (?, None) -> ?'>subscribe_to_incident</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.user', title='None'>user</a>)
<span class='lineno'> 138</span> 
<span class='lineno'> 139</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.prev_status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.prev_status', title='?'>prev_status</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.status
<span class='lineno'> 140</span> 
<span class='lineno'> 141</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', title='dict'>kwargs</a> = {&quot;status&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a>.value, &quot;status_method&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status_method', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status_method', title='?'>status_method</a>.value}
<span class='lineno'> 142</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a> == IncidentStatus.CLOSED:
<span class='lineno'> 143</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', title='dict'>kwargs</a>[&quot;date_closed&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', title='None'>date_closed</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.date_closed', title='None'>date_closed</a> else timezone.now()
<span class='lineno'> 144</span>         elif <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a> == IncidentStatus.OPEN:
<span class='lineno'> 145</span>             # If we&#39;re moving back out of closed status then unset the closed
<span class='lineno'> 146</span>             # date
<span class='lineno'> 147</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.kwargs', title='dict'>kwargs</a>[&quot;date_closed&quot;] = None
<span class='lineno'> 148</span>             # Remove the snapshot since it&#39;s only used after the incident is
<span class='lineno'> 149</span>             # closed.
<span class='lineno'> 150</span>             IncidentSnapshot.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>).delete()
<span class='lineno'> 151</span>             PendingIncidentSnapshot.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>).delete()
<span class='lineno'> 152</span> 
<span class='lineno'> 153</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.update(**kwargs)
<span class='lineno'> 154</span> 
<span class='lineno'> 155</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.status', title='?'>status</a> == IncidentStatus.CLOSED:
<span class='lineno'> 156</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot', title='? -> None'>create_pending_incident_snapshot</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>)
<span class='lineno'> 157</span> 
<span class='lineno'> 158</span>         analytics.record(
<span class='lineno'> 159</span>             &quot;incident.status_change&quot;,
<span class='lineno'> 160</span>             incident_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.id,
<span class='lineno'> 161</span>             organization_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.organization_id,
<span class='lineno'> 162</span>             incident_type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.type,
<span class='lineno'> 163</span>             prev_status=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.prev_status', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.prev_status', title='?'>prev_status</a>,
<span class='lineno'> 164</span>             status=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>.status,
<span class='lineno'> 165</span>         )
<span class='lineno'> 166</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_incident_status.incident', title='?'>incident</a>
<span class='lineno'> 167</span> 
<span class='lineno'> 168</span> 
<span class='lineno'> 169</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen', title='(?, None) -> bool'>set_incident_seen</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', title='None'>user</a>=None):
<span class='lineno'> 170</span>     &quot;&quot;&quot;
<span class='lineno'> 171</span>     Updates the incident to be seen
<span class='lineno'> 172</span>     &quot;&quot;&quot;
<span class='lineno'> 173</span> 
<span class='lineno'> 174</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_org_member', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_org_member', title='?'>is_org_member</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', title='?'>incident</a>.organization.has_access(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', title='None'>user</a>)
<span class='lineno'> 175</span> 
<span class='lineno'> 176</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_org_member', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_org_member', title='?'>is_org_member</a>:
<span class='lineno'> 177</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', title='bool'>is_project_member</a> = False
<span class='lineno'> 178</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_project', title='?'>incident_project</a> in IncidentProject.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', title='?'>incident</a>).select_related(
<span class='lineno'> 179</span>             &quot;project&quot;
<span class='lineno'> 180</span>         ):
<span class='lineno'> 181</span>             if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_project', title='?'>incident_project</a>.project.member_set.filter(user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', title='None'>user</a>).exists():
<span class='lineno'> 182</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', title='bool'>is_project_member</a> = True
<span class='lineno'> 183</span>                 break
<span class='lineno'> 184</span> 
<span class='lineno'> 185</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.is_project_member', title='bool'>is_project_member</a>:
<span class='lineno'> 186</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_seen', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_seen', title='?'>incident_seen</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.created', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.created', title='?'>created</a> = IncidentSeen.objects.create_or_update(
<span class='lineno'> 187</span>                 incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident', title='?'>incident</a>, user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.user', title='None'>user</a>, values={&quot;last_seen&quot;: timezone.now()}
<span class='lineno'> 188</span>             )
<span class='lineno'> 189</span>             return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_seen', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.set_incident_seen.incident_seen', title='?'>incident_seen</a>
<span class='lineno'> 190</span> 
<span class='lineno'> 191</span>     return False
<span class='lineno'> 192</span> 
<span class='lineno'> 193</span> 
<span class='lineno'> 194</span> @transaction.atomic
<span class='lineno'> 195</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity', title='(?, ?, None, None, None, None, None) -> None'>create_incident_activity</a>(
<span class='lineno'> 196</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>,
<span class='lineno'> 197</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', title='?'>activity_type</a>,
<span class='lineno'> 198</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a>=None,
<span class='lineno'> 199</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a>=None,
<span class='lineno'> 200</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a>=None,
<span class='lineno'> 201</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.comment', title='None'>comment</a>=None,
<span class='lineno'> 202</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', title='None'>mentioned_user_ids</a>=None,
<span class='lineno'> 203</span> ):
<span class='lineno'> 204</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', title='?'>activity_type</a> == IncidentActivityType.COMMENT and <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a>:
<span class='lineno'> 205</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', title='(?, ?) -> ? / (?, None) -> ?'>subscribe_to_incident</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a>)
<span class='lineno'> 206</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a> = six.text_type(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a>) if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a> is not None else <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a>
<span class='lineno'> 207</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a> = six.text_type(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a>) if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a> is not None else <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a>
<span class='lineno'> 208</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', title='?'>activity</a> = IncidentActivity.objects.create(
<span class='lineno'> 209</span>         incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>,
<span class='lineno'> 210</span>         type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', title='?'>activity_type</a>.value,
<span class='lineno'> 211</span>         user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a>,
<span class='lineno'> 212</span>         value=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.value', title='None'>value</a>,
<span class='lineno'> 213</span>         previous_value=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.previous_value', title='None'>previous_value</a>,
<span class='lineno'> 214</span>         comment=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.comment', title='None'>comment</a>,
<span class='lineno'> 215</span>     )
<span class='lineno'> 216</span> 
<span class='lineno'> 217</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', title='None'>mentioned_user_ids</a>:
<span class='lineno'> 218</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', title='?'>user_ids_to_subscribe</a> = set(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', title='None'>mentioned_user_ids</a>) - set(
<span class='lineno'> 219</span>             IncidentSubscription.objects.filter(
<span class='lineno'> 220</span>                 incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>, user_id__in=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_ids', title='None'>mentioned_user_ids</a>
<span class='lineno'> 221</span>             ).values_list(&quot;user_id&quot;, flat=True)
<span class='lineno'> 222</span>         )
<span class='lineno'> 223</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', title='?'>user_ids_to_subscribe</a>:
<span class='lineno'> 224</span>             IncidentSubscription.objects.bulk_create(
<span class='lineno'> 225</span>                 [
<span class='lineno'> 226</span>                     IncidentSubscription(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>, user_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', title='?'>mentioned_user_id</a>)
<span class='lineno'> 227</span>                     for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.mentioned_user_id', title='?'>mentioned_user_id</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user_ids_to_subscribe', title='?'>user_ids_to_subscribe</a>
<span class='lineno'> 228</span>                 ]
<span class='lineno'> 229</span>             )
<span class='lineno'> 230</span>     tasks.send_subscriber_notifications.apply_async(
<span class='lineno'> 231</span>         kwargs={&quot;activity_id&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', title='?'>activity</a>.id}, countdown=10
<span class='lineno'> 232</span>     )
<span class='lineno'> 233</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity_type', title='?'>activity_type</a> == IncidentActivityType.COMMENT:
<span class='lineno'> 234</span>         analytics.record(
<span class='lineno'> 235</span>             &quot;incident.comment&quot;,
<span class='lineno'> 236</span>             incident_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>.id,
<span class='lineno'> 237</span>             organization_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>.organization_id,
<span class='lineno'> 238</span>             incident_type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.incident', title='?'>incident</a>.type,
<span class='lineno'> 239</span>             user_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a>.id if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.user', title='None'>user</a> else None,
<span class='lineno'> 240</span>             activity_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', title='?'>activity</a>.id,
<span class='lineno'> 241</span>         )
<span class='lineno'> 242</span> 
<span class='lineno'> 243</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_activity.activity', title='?'>activity</a>
<span class='lineno'> 244</span> 
<span class='lineno'> 245</span> 
<span class='lineno'> 246</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment', title='(?, ?) -> None'>update_comment</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.activity', title='?'>activity</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.comment', title='?'>comment</a>):
<span class='lineno'> 247</span>     &quot;&quot;&quot;
<span class='lineno'> 248</span>     Specifically updates an IncidentActivity with type IncidentActivityType.COMMENT
<span class='lineno'> 249</span>     &quot;&quot;&quot;
<span class='lineno'> 250</span> 
<span class='lineno'> 251</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.activity', title='?'>activity</a>.update(comment=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_comment.comment', title='?'>comment</a>)
<span class='lineno'> 252</span> 
<span class='lineno'> 253</span> 
<span class='lineno'> 254</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment', title='? -> None'>delete_comment</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment.activity', title='?'>activity</a>):
<span class='lineno'> 255</span>     &quot;&quot;&quot;
<span class='lineno'> 256</span>     Specifically deletes an IncidentActivity with type IncidentActivityType.COMMENT
<span class='lineno'> 257</span>     &quot;&quot;&quot;
<span class='lineno'> 258</span> 
<span class='lineno'> 259</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment.activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_comment.activity', title='?'>activity</a>.delete()
<span class='lineno'> 260</span> 
<span class='lineno'> 261</span> 
<span class='lineno'> 262</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot', title='? -> None'>create_pending_incident_snapshot</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>):
<span class='lineno'> 263</span>     if PendingIncidentSnapshot.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>).exists():
<span class='lineno'> 264</span>         PendingIncidentSnapshot.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>).delete()
<span class='lineno'> 265</span> 
<span class='lineno'> 266</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.time_window', title='int'>time_window</a> = (
<span class='lineno'> 267</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>.alert_rule.snuba_query.time_window if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>.alert_rule is not None else 60
<span class='lineno'> 268</span>     )
<span class='lineno'> 269</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.target_run_date', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.target_run_date', title='int'>target_run_date</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>.current_end_date + min(
<span class='lineno'> 270</span>         timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.time_window', title='int'>time_window</a> * 10), timedelta(days=10)
<span class='lineno'> 271</span>     )
<span class='lineno'> 272</span>     return PendingIncidentSnapshot.objects.create(
<span class='lineno'> 273</span>         incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.incident', title='?'>incident</a>, target_run_date=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.target_run_date', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_pending_incident_snapshot.target_run_date', title='int'>target_run_date</a>
<span class='lineno'> 274</span>     )
<span class='lineno'> 275</span> 
<span class='lineno'> 276</span> 
<span class='lineno'> 277</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot', title='(?, bool) -> None'>create_incident_snapshot</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 278</span>     &quot;&quot;&quot;
<span class='lineno'> 279</span>     Creates a snapshot of an incident. This includes the count of unique users
<span class='lineno'> 280</span>     and total events, plus a time series snapshot of the entire incident.
<span class='lineno'> 281</span>     &quot;&quot;&quot;
<span class='lineno'> 282</span>     assert <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', title='?'>incident</a>.status == IncidentStatus.CLOSED.value
<span class='lineno'> 283</span> 
<span class='lineno'> 284</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.event_stats_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.event_stats_snapshot', title='None'>event_stats_snapshot</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot', title='(?, bool) -> None'>create_event_stat_snapshot</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', title='?'>incident</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.windowed_stats', title='bool'>windowed_stats</a>)
<span class='lineno'> 285</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', title='None'>aggregates</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', title='(?, None, None, bool, bool) -> None'>get_incident_aggregates</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', title='?'>incident</a>)
<span class='lineno'> 286</span> 
<span class='lineno'> 287</span>     return IncidentSnapshot.objects.create(
<span class='lineno'> 288</span>         incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.incident', title='?'>incident</a>,
<span class='lineno'> 289</span>         event_stats_snapshot=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.event_stats_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.event_stats_snapshot', title='None'>event_stats_snapshot</a>,
<span class='lineno'> 290</span>         unique_users=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', title='None'>aggregates</a>[&quot;unique_users&quot;],
<span class='lineno'> 291</span>         total_events=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_incident_snapshot.aggregates', title='None'>aggregates</a>[&quot;count&quot;],
<span class='lineno'> 292</span>     )
<span class='lineno'> 293</span> 
<span class='lineno'> 294</span> 
<span class='lineno'> 295</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot', title='(?, bool) -> None'>create_event_stat_snapshot</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 296</span>     &quot;&quot;&quot;
<span class='lineno'> 297</span>     Creates an event stats snapshot for an incident in a given period of time.
<span class='lineno'> 298</span>     &quot;&quot;&quot;
<span class='lineno'> 299</span> 
<span class='lineno'> 300</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', title='None'>event_stats</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', title='(?, None, None, bool) -> None'>get_incident_event_stats</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', title='?'>incident</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', title='bool'>windowed_stats</a>)
<span class='lineno'> 301</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.start', title='{int | timedelta}'>start</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.end', title='{int | timedelta}'>end</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', title='(?, None, None, bool) -> ({int | timedelta}, {int | timedelta})'>calculate_incident_time_range</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.incident', title='?'>incident</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.windowed_stats', title='bool'>windowed_stats</a>)
<span class='lineno'> 302</span>     return TimeSeriesSnapshot.objects.create(
<span class='lineno'> 303</span>         start=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.start', title='{int | timedelta}'>start</a>,
<span class='lineno'> 304</span>         end=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.end', title='{int | timedelta}'>end</a>,
<span class='lineno'> 305</span>         values=[[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', title='?'>row</a>[&quot;time&quot;], <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', title='?'>row</a>[&quot;count&quot;]] for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.row', title='?'>row</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', title='None'>event_stats</a>.data[&quot;data&quot;]],
<span class='lineno'> 306</span>         period=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_event_stat_snapshot.event_stats', title='None'>event_stats</a>.rollup,
<span class='lineno'> 307</span>     )
<span class='lineno'> 308</span> 
<span class='lineno'> 309</span> 
<span class='lineno'> 310</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', title='(?, None, None, bool) -> dict'>build_incident_query_params</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.start', title='None'>start</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.end', title='None'>end</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 311</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', title='dict'>params</a> = {}
<span class='lineno'> 312</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', title='dict'>params</a>[&quot;start&quot;], <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', title='dict'>params</a>[&quot;end&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', title='(?, None, None, bool) -> ({int | timedelta}, {int | timedelta})'>calculate_incident_time_range</a>(
<span class='lineno'> 313</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', title='?'>incident</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.start', title='None'>start</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.end', title='None'>end</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.windowed_stats', title='bool'>windowed_stats</a>
<span class='lineno'> 314</span>     )
<span class='lineno'> 315</span> 
<span class='lineno'> 316</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', title='list'>project_ids</a> = list(
<span class='lineno'> 317</span>         IncidentProject.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', title='?'>incident</a>).values_list(&quot;project_id&quot;, flat=True)
<span class='lineno'> 318</span>     )
<span class='lineno'> 319</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', title='list'>project_ids</a>:
<span class='lineno'> 320</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', title='dict'>params</a>[&quot;project_id&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.project_ids', title='list'>project_ids</a>
<span class='lineno'> 321</span> 
<span class='lineno'> 322</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.incident', title='?'>incident</a>.alert_rule.snuba_query
<span class='lineno'> 323</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a> = build_snuba_filter(
<span class='lineno'> 324</span>         QueryDatasets(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a>.dataset),
<span class='lineno'> 325</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a>.query,
<span class='lineno'> 326</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a>.aggregate,
<span class='lineno'> 327</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a>.environment,
<span class='lineno'> 328</span>         params=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.params', title='dict'>params</a>,
<span class='lineno'> 329</span>     )
<span class='lineno'> 330</span> 
<span class='lineno'> 331</span>     return {
<span class='lineno'> 332</span>         &quot;dataset&quot;: Dataset(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_query', title='?'>snuba_query</a>.dataset),
<span class='lineno'> 333</span>         &quot;start&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a>.start,
<span class='lineno'> 334</span>         &quot;end&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a>.end,
<span class='lineno'> 335</span>         &quot;conditions&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a>.conditions,
<span class='lineno'> 336</span>         &quot;filter_keys&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a>.filter_keys,
<span class='lineno'> 337</span>         &quot;having&quot;: [],
<span class='lineno'> 338</span>         &quot;aggregations&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params.snuba_filter', title='?'>snuba_filter</a>.aggregations,
<span class='lineno'> 339</span>     }
<span class='lineno'> 340</span> 
<span class='lineno'> 341</span> 
<span class='lineno'> 342</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range', title='(?, None, None, bool) -> ({int | timedelta}, {int | timedelta})'>calculate_incident_time_range</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='None'>start</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='None'>end</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 343</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a> = (
<span class='lineno'> 344</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>.alert_rule.snuba_query.time_window if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>.alert_rule is not None else 60
<span class='lineno'> 345</span>     )
<span class='lineno'> 346</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', title='timedelta'>time_window_delta</a> = timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a>)
<span class='lineno'> 347</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='timedelta'>start</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>.date_started - <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', title='timedelta'>time_window_delta</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='None'>start</a> is None else <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='None'>start</a>
<span class='lineno'> 348</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='timedelta'>end</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>.current_end_date + <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window_delta', title='timedelta'>time_window_delta</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='None'>end</a> is None else <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='None'>end</a>
<span class='lineno'> 349</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.windowed_stats', title='bool'>windowed_stats</a>:
<span class='lineno'> 350</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', title='?'>now</a> = timezone.now()
<span class='lineno'> 351</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='timedelta'>end</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='timedelta'>start</a> + timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a> * (<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', title='int'>WINDOWED_STATS_DATA_POINTS</a> / 2))
<span class='lineno'> 352</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='timedelta'>start</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='timedelta'>start</a> - timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a> * (<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', title='int'>WINDOWED_STATS_DATA_POINTS</a> / 2))
<span class='lineno'> 353</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='timedelta'>end</a> &gt; <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', title='?'>now</a>:
<span class='lineno'> 354</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='?'>end</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.now', title='?'>now</a>
<span class='lineno'> 355</span> 
<span class='lineno'> 356</span>             # If the incident ended already, &#39;now&#39; could be greater than we&#39;d like
<span class='lineno'> 357</span>             # which would result in showing too many data points after an incident ended.
<span class='lineno'> 358</span>             # This depends on when the task to process snapshots runs.
<span class='lineno'> 359</span>             # To resolve that, we ensure that the end is never greater than the date
<span class='lineno'> 360</span>             # an incident ended + the smaller of time_window*10 or 10 days.
<span class='lineno'> 361</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.latest_end_date', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.latest_end_date', title='int'>latest_end_date</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.incident', title='?'>incident</a>.current_end_date + min(
<span class='lineno'> 362</span>                 timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a> * 10), timedelta(days=10)
<span class='lineno'> 363</span>             )
<span class='lineno'> 364</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='int'>end</a> = min(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='?'>end</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.latest_end_date', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.latest_end_date', title='int'>latest_end_date</a>)
<span class='lineno'> 365</span> 
<span class='lineno'> 366</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='int'>start</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='int'>end</a> - timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.time_window', title='int'>time_window</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.WINDOWED_STATS_DATA_POINTS', title='int'>WINDOWED_STATS_DATA_POINTS</a>)
<span class='lineno'> 367</span> 
<span class='lineno'> 368</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.start', title='{int | timedelta}'>start</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_time_range.end', title='{int | timedelta}'>end</a>
<span class='lineno'> 369</span> 
<span class='lineno'> 370</span> 
<span class='lineno'> 371</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow', title='(?, ?, None) -> int'>calculate_incident_prewindow</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.start', title='?'>start</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.end', title='?'>end</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', title='None'>incident</a>=None):
<span class='lineno'> 372</span>     # Make the a bit earlier to show more relevant data from before the incident started:
<span class='lineno'> 373</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', title='int'>prewindow</a> = (<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.end', title='?'>end</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.start', title='?'>start</a>) / 5
<span class='lineno'> 374</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', title='None'>incident</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', title='None'>incident</a>.alert_rule is not None:
<span class='lineno'> 375</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.alert_rule_time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.alert_rule_time_window', title='timedelta'>alert_rule_time_window</a> = timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.incident', title='None'>incident</a>.alert_rule.snuba_query.time_window)
<span class='lineno'> 376</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', title='int'>prewindow</a> = max(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.alert_rule_time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.alert_rule_time_window', title='timedelta'>alert_rule_time_window</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', title='int'>prewindow</a>)
<span class='lineno'> 377</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.calculate_incident_prewindow.prewindow', title='int'>prewindow</a>
<span class='lineno'> 378</span> 
<span class='lineno'> 379</span> 
<span class='lineno'> 380</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', title='(?, None, None, bool) -> None'>get_incident_event_stats</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.start', title='None'>start</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.end', title='None'>end</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 381</span>     &quot;&quot;&quot;
<span class='lineno'> 382</span>     Gets event stats for an incident. If start/end are provided, uses that time
<span class='lineno'> 383</span>     period, otherwise uses the incident start/current_end.
<span class='lineno'> 384</span>     &quot;&quot;&quot;
<span class='lineno'> 385</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.query_params', title='dict'>query_params</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', title='(?, None, None, bool) -> dict'>build_incident_query_params</a>(
<span class='lineno'> 386</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>, start=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.start', title='None'>start</a>, end=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.end', title='None'>end</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.windowed_stats', title='bool'>windowed_stats</a>
<span class='lineno'> 387</span>     )
<span class='lineno'> 388</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', title='?'>time_window</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.alert_rule.snuba_query.time_window
<span class='lineno'> 389</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.query_params', title='dict'>query_params</a>.pop(&quot;aggregations&quot;)[0]
<span class='lineno'> 390</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a> = [
<span class='lineno'> 391</span>         SnubaQueryParams(
<span class='lineno'> 392</span>             aggregations=[(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a>[1], &quot;count&quot;)],
<span class='lineno'> 393</span>             orderby=&quot;time&quot;,
<span class='lineno'> 394</span>             groupby=[&quot;time&quot;],
<span class='lineno'> 395</span>             rollup=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', title='?'>time_window</a>,
<span class='lineno'> 396</span>             limit=10000,
<span class='lineno'> 397</span>             **query_params
<span class='lineno'> 398</span>         )
<span class='lineno'> 399</span>     ]
<span class='lineno'> 400</span> 
<span class='lineno'> 401</span>     # We want to include the specific buckets for the incident start and closed times,
<span class='lineno'> 402</span>     # so that there&#39;s no need to interpolate to show them on the frontend. If they&#39;re
<span class='lineno'> 403</span>     # cleanly divisible by the `time_window` then there&#39;s no need to fetch, since
<span class='lineno'> 404</span>     # they&#39;ll be included in the standard results anyway.
<span class='lineno'> 405</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', title='[?]'>extra_buckets</a> = []
<span class='lineno'> 406</span>     if int(to_timestamp(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.date_started)) % <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', title='?'>time_window</a>:
<span class='lineno'> 407</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', title='[?]'>extra_buckets</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.date_started)
<span class='lineno'> 408</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.date_closed and int(to_timestamp(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.date_closed)) % <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', title='?'>time_window</a>:
<span class='lineno'> 409</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', title='[?]'>extra_buckets</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>.date_closed.replace(second=0, microsecond=0))
<span class='lineno'> 410</span> 
<span class='lineno'> 411</span>     # We make extra queries to fetch these buckets
<span class='lineno'> 412</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', title='?'>bucket_start</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', title='[?]'>extra_buckets</a>:
<span class='lineno'> 413</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_bucket_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_bucket_query_params', title='dict'>extra_bucket_query_params</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', title='(?, None, None, bool) -> dict'>build_incident_query_params</a>(
<span class='lineno'> 414</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.incident', title='?'>incident</a>, start=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', title='?'>bucket_start</a>, end=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.bucket_start', title='?'>bucket_start</a> + timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.time_window', title='?'>time_window</a>)
<span class='lineno'> 415</span>         )
<span class='lineno'> 416</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_bucket_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_bucket_query_params', title='dict'>extra_bucket_query_params</a>.pop(&quot;aggregations&quot;)[0]
<span class='lineno'> 417</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a>.append(
<span class='lineno'> 418</span>             SnubaQueryParams(
<span class='lineno'> 419</span>                 aggregations=[(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.aggregations', title='?'>aggregations</a>[1], &quot;count&quot;)],
<span class='lineno'> 420</span>                 limit=1,
<span class='lineno'> 421</span>                 **extra_bucket_query_params
<span class='lineno'> 422</span>             )
<span class='lineno'> 423</span>         )
<span class='lineno'> 424</span> 
<span class='lineno'> 425</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', title='?'>results</a> = bulk_raw_query(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a>, referrer=&quot;incidents.get_incident_event_stats&quot;)
<span class='lineno'> 426</span>     # Once we receive the results, if we requested extra buckets we now need to label
<span class='lineno'> 427</span>     # them with timestamp data, since the query we ran only returns the count.
<span class='lineno'> 428</span>     for extra_start, result in zip(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.extra_buckets', title='[?]'>extra_buckets</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', title='?'>results</a>[1:]):
<span class='lineno'> 429</span>         result[&quot;data&quot;][0][&quot;time&quot;] = int(to_timestamp(extra_start))
<span class='lineno'> 430</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', title='list'>merged_data</a> = list(chain(*[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', title='?'>r</a>[&quot;data&quot;] for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.r', title='?'>r</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', title='?'>results</a>]))
<span class='lineno'> 431</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', title='list'>merged_data</a>.sort(key=lambda <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.lambda%146.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.lambda%146.row', title='?'>row</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.lambda%146.row', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.lambda%146.row', title='?'>row</a>[&quot;time&quot;])
<span class='lineno'> 432</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', title='?'>results</a>[0][&quot;data&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.merged_data', title='list'>merged_data</a>
<span class='lineno'> 433</span> 
<span class='lineno'> 434</span>     return SnubaTSResult(
<span class='lineno'> 435</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.results', title='?'>results</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a>[0].start, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a>[0].end, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats.snuba_params', title='[?]'>snuba_params</a>[0].rollup
<span class='lineno'> 436</span>     )
<span class='lineno'> 437</span> 
<span class='lineno'> 438</span> 
<span class='lineno'> 439</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', title='(?, None, None, bool, bool) -> None'>get_incident_aggregates</a>(
<span class='lineno'> 440</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.start', title='None'>start</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.end', title='None'>end</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.windowed_stats', title='bool'>windowed_stats</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.use_alert_aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.use_alert_aggregate', title='bool'>use_alert_aggregate</a>=False
<span class='lineno'> 441</span> ):
<span class='lineno'> 442</span>     &quot;&quot;&quot;
<span class='lineno'> 443</span>     Calculates aggregate stats across the life of an incident, or the provided range.
<span class='lineno'> 444</span>     If `use_alert_aggregate` is True, calculates just the aggregate that the alert is
<span class='lineno'> 445</span>     for, and returns as the `count` key.
<span class='lineno'> 446</span>     If False, returns two values:
<span class='lineno'> 447</span>     - count: Total count of events
<span class='lineno'> 448</span>     - unique_users: Total number of unique users
<span class='lineno'> 449</span>     &quot;&quot;&quot;
<span class='lineno'> 450</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', title='dict'>query_params</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.build_incident_query_params', title='(?, None, None, bool) -> dict'>build_incident_query_params</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.incident', title='?'>incident</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.start', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.start', title='None'>start</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.end', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.end', title='None'>end</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.windowed_stats', title='bool'>windowed_stats</a>)
<span class='lineno'> 451</span>     if not <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.use_alert_aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.use_alert_aggregate', title='bool'>use_alert_aggregate</a>:
<span class='lineno'> 452</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', title='dict'>query_params</a>[&quot;aggregations&quot;] = [
<span class='lineno'> 453</span>             (&quot;count()&quot;, &quot;&quot;, &quot;count&quot;),
<span class='lineno'> 454</span>             (&quot;uniq&quot;, &quot;tags[sentry:user]&quot;, &quot;unique_users&quot;),
<span class='lineno'> 455</span>         ]
<span class='lineno'> 456</span>     else:
<span class='lineno'> 457</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.query_params', title='dict'>query_params</a>[&quot;aggregations&quot;][0][2] = &quot;count&quot;
<span class='lineno'> 458</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.snuba_params_list', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.snuba_params_list', title='[?]'>snuba_params_list</a> = [SnubaQueryParams(limit=10000, **query_params)]
<span class='lineno'> 459</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.results', title='?'>results</a> = bulk_raw_query(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.snuba_params_list', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.snuba_params_list', title='[?]'>snuba_params_list</a>, referrer=&quot;incidents.get_incident_aggregates&quot;)
<span class='lineno'> 460</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.results', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates.results', title='?'>results</a>[0][&quot;data&quot;][0]
<span class='lineno'> 461</span> 
<span class='lineno'> 462</span> 
<span class='lineno'> 463</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats', title='(?, bool) -> {dict | dict}'>get_incident_stats</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', title='bool'>windowed_stats</a>=False):
<span class='lineno'> 464</span>     &quot;&quot;&quot;
<span class='lineno'> 465</span>     Returns stats for an incident. This includes unique user count, total event count
<span class='lineno'> 466</span>     and event stats.
<span class='lineno'> 467</span>     Note that even though this function accepts a windowed_stats parameter, it does not
<span class='lineno'> 468</span>     affect the snapshots. Only the live fetched stats.
<span class='lineno'> 469</span>     &quot;&quot;&quot;
<span class='lineno'> 470</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', title='bool'>windowed_stats</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', title='?'>incident</a>.status == IncidentStatus.CLOSED.value:
<span class='lineno'> 471</span>         # At the moment, snapshots are only ever created with windowed_stats as True
<span class='lineno'> 472</span>         # so if they send False, we need to do a live calculation below.
<span class='lineno'> 473</span>         try:
<span class='lineno'> 474</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', title='?'>snapshot</a> = IncidentSnapshot.objects.get(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', title='?'>incident</a>)
<span class='lineno'> 475</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='?'>event_stats</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', title='?'>snapshot</a>.event_stats_snapshot
<span class='lineno'> 476</span>             return {
<span class='lineno'> 477</span>                 &quot;event_stats&quot;: SnubaTSResult(
<span class='lineno'> 478</span>                     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='?'>event_stats</a>.snuba_values, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='?'>event_stats</a>.start, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='?'>event_stats</a>.end, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='?'>event_stats</a>.period
<span class='lineno'> 479</span>                 ),
<span class='lineno'> 480</span>                 &quot;total_events&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', title='?'>snapshot</a>.total_events,
<span class='lineno'> 481</span>                 &quot;unique_users&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.snapshot', title='?'>snapshot</a>.unique_users,
<span class='lineno'> 482</span>             }
<span class='lineno'> 483</span>         except IncidentSnapshot.DoesNotExist:
<span class='lineno'> 484</span>             pass
<span class='lineno'> 485</span> 
<span class='lineno'> 486</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='None'>event_stats</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_event_stats', title='(?, None, None, bool) -> None'>get_incident_event_stats</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', title='?'>incident</a>, windowed_stats=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.windowed_stats', title='bool'>windowed_stats</a>)
<span class='lineno'> 487</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', title='None'>aggregates</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_aggregates', title='(?, None, None, bool, bool) -> None'>get_incident_aggregates</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.incident', title='?'>incident</a>)
<span class='lineno'> 488</span>     return {
<span class='lineno'> 489</span>         &quot;event_stats&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.event_stats', title='None'>event_stats</a>,
<span class='lineno'> 490</span>         &quot;total_events&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', title='None'>aggregates</a>[&quot;count&quot;],
<span class='lineno'> 491</span>         &quot;unique_users&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_stats.aggregates', title='None'>aggregates</a>[&quot;unique_users&quot;],
<span class='lineno'> 492</span>     }
<span class='lineno'> 493</span> 
<span class='lineno'> 494</span> 
<span class='lineno'> 495</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident', title='(?, ?) -> ? / (?, None) -> ?'>subscribe_to_incident</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.user', title='None'>user</a>):
<span class='lineno'> 496</span>     return IncidentSubscription.objects.get_or_create(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.incident', title='?'>incident</a>, user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_to_incident.user', title='None'>user</a>)
<span class='lineno'> 497</span> 
<span class='lineno'> 498</span> 
<span class='lineno'> 499</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident', title='(?, ?) -> ?'>unsubscribe_from_incident</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.incident', title='?'>incident</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.user', title='?'>user</a>):
<span class='lineno'> 500</span>     return IncidentSubscription.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.incident', title='?'>incident</a>, user=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.user', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.unsubscribe_from_incident.user', title='?'>user</a>).delete()
<span class='lineno'> 501</span> 
<span class='lineno'> 502</span> 
<span class='lineno'> 503</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers', title='? -> ?'>get_incident_subscribers</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers.incident', title='?'>incident</a>):
<span class='lineno'> 504</span>     return IncidentSubscription.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_subscribers.incident', title='?'>incident</a>)
<span class='lineno'> 505</span> 
<span class='lineno'> 506</span> 
<span class='lineno'> 507</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity', title='? -> ?'>get_incident_activity</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity.incident', title='?'>incident</a>):
<span class='lineno'> 508</span>     return IncidentActivity.objects.filter(incident=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity.incident', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_incident_activity.incident', title='?'>incident</a>).select_related(&quot;user&quot;, &quot;incident&quot;)
<span class='lineno'> 509</span> 
<span class='lineno'> 510</span> 
<span class='lineno'> 511</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleNameAlreadyUsedError', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleNameAlreadyUsedError', title='<AlertRuleNameAlreadyUsedError>'>AlertRuleNameAlreadyUsedError</a>(Exception):
<span class='lineno'> 512</span>     pass
<span class='lineno'> 513</span> 
<span class='lineno'> 514</span> 
<span class='lineno'> 515</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', title='int'>DEFAULT_ALERT_RULE_RESOLUTION</a> = 1
<span class='lineno'> 516</span> 
<span class='lineno'> 517</span> 
<span class='lineno'> 518</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule', title='(?, ?, ?, ?, ?, ?, ?, None, bool, None, ?) -> None'>create_alert_rule</a>(
<span class='lineno'> 519</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', title='?'>organization</a>,
<span class='lineno'> 520</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', title='?'>projects</a>,
<span class='lineno'> 521</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', title='?'>name</a>,
<span class='lineno'> 522</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', title='?'>query</a>,
<span class='lineno'> 523</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.aggregate', title='?'>aggregate</a>,
<span class='lineno'> 524</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.time_window', title='?'>time_window</a>,
<span class='lineno'> 525</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.threshold_period', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.threshold_period', title='?'>threshold_period</a>,
<span class='lineno'> 526</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.environment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.environment', title='None'>environment</a>=None,
<span class='lineno'> 527</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', title='bool'>include_all_projects</a>=False,
<span class='lineno'> 528</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='None'>excluded_projects</a>=None,
<span class='lineno'> 529</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.dataset', title='?'>dataset</a>=QueryDatasets.EVENTS,
<span class='lineno'> 530</span> ):
<span class='lineno'> 531</span>     &quot;&quot;&quot;
<span class='lineno'> 532</span>     Creates an alert rule for an organization.
<span class='lineno'> 533</span> 
<span class='lineno'> 534</span>     :param organization:
<span class='lineno'> 535</span>     :param projects: A list of projects to subscribe to the rule. This will be overriden
<span class='lineno'> 536</span>     if `include_all_projects` is True
<span class='lineno'> 537</span>     :param name: Name for the alert rule. This will be used as part of the
<span class='lineno'> 538</span>     incident name, and must be unique per project
<span class='lineno'> 539</span>     :param query: An event search query to subscribe to and monitor for alerts
<span class='lineno'> 540</span>     :param aggregate: A string representing the aggregate used in this alert rule
<span class='lineno'> 541</span>     :param time_window: Time period to aggregate over, in minutes
<span class='lineno'> 542</span>     :param environment: An optional environment that this rule applies to
<span class='lineno'> 543</span>     :param threshold_period: How many update periods the value of the
<span class='lineno'> 544</span>     subscription needs to exceed the threshold before triggering
<span class='lineno'> 545</span>     :param include_all_projects: Whether to include all current and future projects
<span class='lineno'> 546</span>     from this organization
<span class='lineno'> 547</span>     :param excluded_projects: List of projects to exclude if we&#39;re using
<span class='lineno'> 548</span>     `include_all_projects`.
<span class='lineno'> 549</span>     :param dataset: The dataset that this query will be executed on
<span class='lineno'> 550</span> 
<span class='lineno'> 551</span>     :return: The created `AlertRule`
<span class='lineno'> 552</span>     &quot;&quot;&quot;
<span class='lineno'> 553</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.resolution', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.resolution', title='int'>resolution</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', title='int'>DEFAULT_ALERT_RULE_RESOLUTION</a>
<span class='lineno'> 554</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', title='? -> None / None -> None'>validate_alert_rule_query</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', title='?'>query</a>)
<span class='lineno'> 555</span>     if AlertRule.objects.filter(organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', title='?'>organization</a>, name=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', title='?'>name</a>).exists():
<span class='lineno'> 556</span>         raise AlertRuleNameAlreadyUsedError()
<span class='lineno'> 557</span>     with transaction.atomic():
<span class='lineno'> 558</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.snuba_query', title='?'>snuba_query</a> = create_snuba_query(
<span class='lineno'> 559</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.dataset', title='?'>dataset</a>,
<span class='lineno'> 560</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.query', title='?'>query</a>,
<span class='lineno'> 561</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.aggregate', title='?'>aggregate</a>,
<span class='lineno'> 562</span>             timedelta(minutes=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.time_window', title='?'>time_window</a>),
<span class='lineno'> 563</span>             timedelta(minutes=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.resolution', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.resolution', title='int'>resolution</a>),
<span class='lineno'> 564</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.environment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.environment', title='None'>environment</a>,
<span class='lineno'> 565</span>         )
<span class='lineno'> 566</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', title='?'>alert_rule</a> = AlertRule.objects.create(
<span class='lineno'> 567</span>             organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', title='?'>organization</a>,
<span class='lineno'> 568</span>             snuba_query=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.snuba_query', title='?'>snuba_query</a>,
<span class='lineno'> 569</span>             name=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.name', title='?'>name</a>,
<span class='lineno'> 570</span>             threshold_period=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.threshold_period', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.threshold_period', title='?'>threshold_period</a>,
<span class='lineno'> 571</span>             include_all_projects=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', title='bool'>include_all_projects</a>,
<span class='lineno'> 572</span>         )
<span class='lineno'> 573</span> 
<span class='lineno'> 574</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.include_all_projects', title='bool'>include_all_projects</a>:
<span class='lineno'> 575</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='[?]'>excluded_projects</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='None'>excluded_projects</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='None'>excluded_projects</a> else []
<span class='lineno'> 576</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', title='?'>projects</a> = Project.objects.filter(organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.organization', title='?'>organization</a>).exclude(
<span class='lineno'> 577</span>                 id__in=[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', title='?'>p</a>.id for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.p', title='?'>p</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='[?]'>excluded_projects</a>]
<span class='lineno'> 578</span>             )
<span class='lineno'> 579</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.exclusions', title='[?]'>exclusions</a> = [
<span class='lineno'> 580</span>                 AlertRuleExcludedProjects(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', title='?'>alert_rule</a>, project=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', title='?'>project</a>)
<span class='lineno'> 581</span>                 for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.project', title='?'>project</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.excluded_projects', title='[?]'>excluded_projects</a>
<span class='lineno'> 582</span>             ]
<span class='lineno'> 583</span>             AlertRuleExcludedProjects.objects.bulk_create(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.exclusions', title='[?]'>exclusions</a>)
<span class='lineno'> 584</span> 
<span class='lineno'> 585</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', title='(?, ?) -> None / (?, [?]) -> None'>subscribe_projects_to_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', title='?'>alert_rule</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.projects', title='?'>projects</a>)
<span class='lineno'> 586</span> 
<span class='lineno'> 587</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule.alert_rule', title='?'>alert_rule</a>
<span class='lineno'> 588</span> 
<span class='lineno'> 589</span> 
<span class='lineno'> 590</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule', title='? -> None'>snapshot_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', title='?'>alert_rule</a>):
<span class='lineno'> 591</span>     # Creates an archived alert_rule using the same properties as the passed rule
<span class='lineno'> 592</span>     # It will also resolve any incidents attached to this rule.
<span class='lineno'> 593</span>     with transaction.atomic():
<span class='lineno'> 594</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.triggers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.triggers', title='?'>triggers</a> = AlertRuleTrigger.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 595</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.incidents', title='?'>incidents</a> = Incident.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 596</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', title='?'>snuba_query_snapshot</a> = deepcopy(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query)
<span class='lineno'> 597</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', title='?'>snuba_query_snapshot</a>.id = None
<span class='lineno'> 598</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', title='?'>snuba_query_snapshot</a>.save()
<span class='lineno'> 599</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a> = deepcopy(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 600</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>.id = None
<span class='lineno'> 601</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>.status = AlertRuleStatus.SNAPSHOT.value
<span class='lineno'> 602</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>.snuba_query = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.snuba_query_snapshot', title='?'>snuba_query_snapshot</a>
<span class='lineno'> 603</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>.save()
<span class='lineno'> 604</span> 
<span class='lineno'> 605</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.incidents', title='?'>incidents</a>.update(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>)
<span class='lineno'> 606</span> 
<span class='lineno'> 607</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.triggers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.triggers', title='?'>triggers</a>:
<span class='lineno'> 608</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.actions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.actions', title='?'>actions</a> = AlertRuleTriggerAction.objects.filter(alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a>)
<span class='lineno'> 609</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a>.id = None
<span class='lineno'> 610</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a>.alert_rule = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>
<span class='lineno'> 611</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a>.save()
<span class='lineno'> 612</span>             for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', title='?'>action</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.actions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.actions', title='?'>actions</a>:
<span class='lineno'> 613</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', title='?'>action</a>.id = None
<span class='lineno'> 614</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', title='?'>action</a>.alert_rule_trigger = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.trigger', title='?'>trigger</a>
<span class='lineno'> 615</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.action', title='?'>action</a>.save()
<span class='lineno'> 616</span> 
<span class='lineno'> 617</span>     # Change the incident status asynchronously, which could take awhile with many incidents due to snapshot creations.
<span class='lineno'> 618</span>     tasks.auto_resolve_snapshot_incidents.apply_async(
<span class='lineno'> 619</span>         kwargs={&quot;alert_rule_id&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule.alert_rule_snapshot', title='?'>alert_rule_snapshot</a>.id}, countdown=3
<span class='lineno'> 620</span>     )
<span class='lineno'> 621</span> 
<span class='lineno'> 622</span> 
<span class='lineno'> 623</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule', title='(?, None, None, None, None, None, None, None, None, None, None) -> None'>update_alert_rule</a>(
<span class='lineno'> 624</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>,
<span class='lineno'> 625</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', title='None'>dataset</a>=None,
<span class='lineno'> 626</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', title='None'>projects</a>=None,
<span class='lineno'> 627</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>=None,
<span class='lineno'> 628</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', title='None'>query</a>=None,
<span class='lineno'> 629</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', title='None'>aggregate</a>=None,
<span class='lineno'> 630</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', title='None'>time_window</a>=None,
<span class='lineno'> 631</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', title='None'>environment</a>=None,
<span class='lineno'> 632</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', title='None'>threshold_period</a>=None,
<span class='lineno'> 633</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', title='None'>include_all_projects</a>=None,
<span class='lineno'> 634</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', title='None'>excluded_projects</a>=None,
<span class='lineno'> 635</span> ):
<span class='lineno'> 636</span>     &quot;&quot;&quot;
<span class='lineno'> 637</span>     Updates an alert rule.
<span class='lineno'> 638</span> 
<span class='lineno'> 639</span>     :param alert_rule: The alert rule to update
<span class='lineno'> 640</span>     :param excluded_projects: List of projects to subscribe to the rule. Ignored if
<span class='lineno'> 641</span>     `include_all_projects` is True
<span class='lineno'> 642</span>     :param name: Name for the alert rule. This will be used as part of the
<span class='lineno'> 643</span>     incident name, and must be unique per project.
<span class='lineno'> 644</span>     :param query: An event search query to subscribe to and monitor for alerts
<span class='lineno'> 645</span>     :param aggregate: A string representing the aggregate used in this alert rule
<span class='lineno'> 646</span>     :param time_window: Time period to aggregate over, in minutes.
<span class='lineno'> 647</span>     :param environment: An optional environment that this rule applies to
<span class='lineno'> 648</span>     :param threshold_period: How many update periods the value of the
<span class='lineno'> 649</span>     subscription needs to exceed the threshold before triggering
<span class='lineno'> 650</span>     :param include_all_projects: Whether to include all current and future projects
<span class='lineno'> 651</span>     from this organization
<span class='lineno'> 652</span>     :param excluded_projects: List of projects to exclude if we&#39;re using
<span class='lineno'> 653</span>     `include_all_projects`. Ignored otherwise.
<span class='lineno'> 654</span>     :return: The updated `AlertRule`
<span class='lineno'> 655</span>     &quot;&quot;&quot;
<span class='lineno'> 656</span>     if (
<span class='lineno'> 657</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>
<span class='lineno'> 658</span>         and <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.name != <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>
<span class='lineno'> 659</span>         and AlertRule.objects.filter(organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.organization, name=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>).exists()
<span class='lineno'> 660</span>     ):
<span class='lineno'> 661</span>         raise AlertRuleNameAlreadyUsedError()
<span class='lineno'> 662</span> 
<span class='lineno'> 663</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', title='dict'>updated_fields</a> = {}
<span class='lineno'> 664</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a> = {}
<span class='lineno'> 665</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>:
<span class='lineno'> 666</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', title='dict'>updated_fields</a>[&quot;name&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.name', title='None'>name</a>
<span class='lineno'> 667</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', title='None'>query</a> is not None:
<span class='lineno'> 668</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', title='? -> None / None -> None'>validate_alert_rule_query</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', title='None'>query</a>)
<span class='lineno'> 669</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>[&quot;query&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', title='None'>query</a>
<span class='lineno'> 670</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', title='None'>aggregate</a> is not None:
<span class='lineno'> 671</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>[&quot;aggregate&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', title='None'>aggregate</a>
<span class='lineno'> 672</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', title='None'>time_window</a>:
<span class='lineno'> 673</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>[&quot;time_window&quot;] = timedelta(minutes=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', title='None'>time_window</a>)
<span class='lineno'> 674</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', title='None'>threshold_period</a>:
<span class='lineno'> 675</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', title='dict'>updated_fields</a>[&quot;threshold_period&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.threshold_period', title='None'>threshold_period</a>
<span class='lineno'> 676</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', title='None'>include_all_projects</a> is not None:
<span class='lineno'> 677</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_fields', title='dict'>updated_fields</a>[&quot;include_all_projects&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', title='None'>include_all_projects</a>
<span class='lineno'> 678</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', title='None'>dataset</a> is not None and <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', title='None'>dataset</a>.value != <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query.dataset:
<span class='lineno'> 679</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>[&quot;dataset&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.dataset', title='None'>dataset</a>
<span class='lineno'> 680</span> 
<span class='lineno'> 681</span>     with transaction.atomic():
<span class='lineno'> 682</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.incidents', title='?'>incidents</a> = Incident.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>).exists()
<span class='lineno'> 683</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.incidents', title='?'>incidents</a>:
<span class='lineno'> 684</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.snapshot_alert_rule', title='? -> None'>snapshot_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 685</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.update(**updated_fields)
<span class='lineno'> 686</span> 
<span class='lineno'> 687</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a> or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', title='None'>environment</a> != <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query.environment:
<span class='lineno'> 688</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', title='?'>snuba_query</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query
<span class='lineno'> 689</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>.setdefault(&quot;dataset&quot;, QueryDatasets(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', title='?'>snuba_query</a>.dataset))
<span class='lineno'> 690</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>.setdefault(&quot;query&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', title='?'>snuba_query</a>.query)
<span class='lineno'> 691</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>.setdefault(&quot;aggregate&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', title='?'>snuba_query</a>.aggregate)
<span class='lineno'> 692</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_query_fields', title='dict'>updated_query_fields</a>.setdefault(
<span class='lineno'> 693</span>                 &quot;time_window&quot;, timedelta(seconds=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.snuba_query', title='?'>snuba_query</a>.time_window)
<span class='lineno'> 694</span>             )
<span class='lineno'> 695</span>             update_snuba_query(
<span class='lineno'> 696</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query,
<span class='lineno'> 697</span>                 resolution=timedelta(minutes=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.DEFAULT_ALERT_RULE_RESOLUTION', title='int'>DEFAULT_ALERT_RULE_RESOLUTION</a>),
<span class='lineno'> 698</span>                 environment=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.environment', title='None'>environment</a>,
<span class='lineno'> 699</span>                 **updated_query_fields
<span class='lineno'> 700</span>             )
<span class='lineno'> 701</span> 
<span class='lineno'> 702</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='[?]'>existing_subs</a> = []
<span class='lineno'> 703</span>         if (
<span class='lineno'> 704</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.query', title='None'>query</a> is not None
<span class='lineno'> 705</span>             or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.aggregate', title='None'>aggregate</a> is not None
<span class='lineno'> 706</span>             or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.time_window', title='None'>time_window</a> is not None
<span class='lineno'> 707</span>             or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', title='None'>projects</a> is not None
<span class='lineno'> 708</span>             or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', title='None'>include_all_projects</a> is not None
<span class='lineno'> 709</span>             or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', title='None'>excluded_projects</a> is not None
<span class='lineno'> 710</span>         ):
<span class='lineno'> 711</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='?'>existing_subs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query.subscriptions.all().select_related(&quot;project&quot;)
<span class='lineno'> 712</span> 
<span class='lineno'> 713</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', title='[?]'>new_projects</a> = []
<span class='lineno'> 714</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', title='[?]'>deleted_subs</a> = []
<span class='lineno'> 715</span> 
<span class='lineno'> 716</span>         if not <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.include_all_projects:
<span class='lineno'> 717</span>             # We don&#39;t want to have any exclusion rows present if we&#39;re not in
<span class='lineno'> 718</span>             # `include_all_projects` mode
<span class='lineno'> 719</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', title='? -> ?'>get_excluded_projects_for_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>).delete()
<span class='lineno'> 720</span> 
<span class='lineno'> 721</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.include_all_projects:
<span class='lineno'> 722</span>             if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.include_all_projects', title='None'>include_all_projects</a> or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', title='None'>excluded_projects</a> is not None:
<span class='lineno'> 723</span>                 # If we&#39;re in `include_all_projects` mode, we want to just fetch
<span class='lineno'> 724</span>                 # projects that aren&#39;t already subscribed, and haven&#39;t been excluded so
<span class='lineno'> 725</span>                 # we can add them.
<span class='lineno'> 726</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', title='[?]'>excluded_project_ids</a> = (
<span class='lineno'> 727</span>                     {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', title='?'>p</a>.id for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.p', title='?'>p</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', title='None'>excluded_projects</a>} if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_projects', title='None'>excluded_projects</a> else set()
<span class='lineno'> 728</span>                 )
<span class='lineno'> 729</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', title='?'>project_exclusions</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', title='? -> ?'>get_excluded_projects_for_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 730</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', title='?'>project_exclusions</a>.exclude(project_id__in=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', title='[?]'>excluded_project_ids</a>).delete()
<span class='lineno'> 731</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_excluded_project_ids', title='[?]'>existing_excluded_project_ids</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', title='?'>pe</a>.project_id for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.pe', title='?'>pe</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_exclusions', title='?'>project_exclusions</a>}
<span class='lineno'> 732</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_exclusions', title='[?]'>new_exclusions</a> = [
<span class='lineno'> 733</span>                     AlertRuleExcludedProjects(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>, project_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', title='?'>project_id</a>)
<span class='lineno'> 734</span>                     for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', title='?'>project_id</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', title='[?]'>excluded_project_ids</a>
<span class='lineno'> 735</span>                     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project_id', title='?'>project_id</a> not in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_excluded_project_ids', title='[?]'>existing_excluded_project_ids</a>
<span class='lineno'> 736</span>                 ]
<span class='lineno'> 737</span>                 AlertRuleExcludedProjects.objects.bulk_create(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_exclusions', title='[?]'>new_exclusions</a>)
<span class='lineno'> 738</span> 
<span class='lineno'> 739</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', title='?'>new_projects</a> = Project.objects.filter(organization=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>.organization).exclude(
<span class='lineno'> 740</span>                     id__in=set([<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a>.project_id for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='[?]'>existing_subs</a>]) | <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', title='[?]'>excluded_project_ids</a>
<span class='lineno'> 741</span>                 )
<span class='lineno'> 742</span>                 # If we&#39;re subscribed to any of the excluded projects then we want to
<span class='lineno'> 743</span>                 # remove those subscriptions
<span class='lineno'> 744</span>                 <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', title='[?]'>deleted_subs</a> = [
<span class='lineno'> 745</span>                     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a> for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='[?]'>existing_subs</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a>.project_id in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.excluded_project_ids', title='[?]'>excluded_project_ids</a>
<span class='lineno'> 746</span>                 ]
<span class='lineno'> 747</span>         elif <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', title='None'>projects</a> is not None:
<span class='lineno'> 748</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_project_slugs', title='[?]'>existing_project_slugs</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a>.project.slug for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='[?]'>existing_subs</a>}
<span class='lineno'> 749</span>             # Determine whether we&#39;ve added any new projects as part of this update
<span class='lineno'> 750</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', title='[?]'>new_projects</a> = [
<span class='lineno'> 751</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'>project</a> for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'>project</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', title='None'>projects</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'>project</a>.slug not in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_project_slugs', title='[?]'>existing_project_slugs</a>
<span class='lineno'> 752</span>             ]
<span class='lineno'> 753</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_project_slugs', title='[?]'>updated_project_slugs</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'>project</a>.slug for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.project', title='?'>project</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.projects', title='None'>projects</a>}
<span class='lineno'> 754</span>             # Find any subscriptions that were removed as part of this update
<span class='lineno'> 755</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', title='[?]'>deleted_subs</a> = [
<span class='lineno'> 756</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a> for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.existing_subs', title='[?]'>existing_subs</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.sub', title='?'>sub</a>.project.slug not in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.updated_project_slugs', title='[?]'>updated_project_slugs</a>
<span class='lineno'> 757</span>             ]
<span class='lineno'> 758</span> 
<span class='lineno'> 759</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', title='[?]'>new_projects</a>:
<span class='lineno'> 760</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', title='(?, ?) -> None / (?, [?]) -> None'>subscribe_projects_to_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.new_projects', title='[?]'>new_projects</a>)
<span class='lineno'> 761</span> 
<span class='lineno'> 762</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', title='[?]'>deleted_subs</a>:
<span class='lineno'> 763</span>             bulk_delete_snuba_subscriptions(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.deleted_subs', title='[?]'>deleted_subs</a>)
<span class='lineno'> 764</span> 
<span class='lineno'> 765</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule.alert_rule', title='?'>alert_rule</a>
<span class='lineno'> 766</span> 
<span class='lineno'> 767</span> 
<span class='lineno'> 768</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule', title='(?, ?) -> None / (?, [?]) -> None'>subscribe_projects_to_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.alert_rule', title='?'>alert_rule</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.projects', title='[?]'>projects</a>):
<span class='lineno'> 769</span>     &quot;&quot;&quot;
<span class='lineno'> 770</span>     Subscribes a list of projects to an alert rule
<span class='lineno'> 771</span>     :return: The list of created subscriptions
<span class='lineno'> 772</span>     &quot;&quot;&quot;
<span class='lineno'> 773</span>     return bulk_create_snuba_subscriptions(
<span class='lineno'> 774</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.projects', title='[?]'>projects</a>, tasks.INCIDENTS_SNUBA_SUBSCRIPTION_TYPE, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.subscribe_projects_to_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query
<span class='lineno'> 775</span>     )
<span class='lineno'> 776</span> 
<span class='lineno'> 777</span> 
<span class='lineno'> 778</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule', title='? -> None'>delete_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>):
<span class='lineno'> 779</span>     &quot;&quot;&quot;
<span class='lineno'> 780</span>     Marks an alert rule as deleted and fires off a task to actually delete it.
<span class='lineno'> 781</span>     :param alert_rule:
<span class='lineno'> 782</span>     &quot;&quot;&quot;
<span class='lineno'> 783</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.status == AlertRuleStatus.SNAPSHOT.value:
<span class='lineno'> 784</span>         raise AlreadyDeletedError()
<span class='lineno'> 785</span> 
<span class='lineno'> 786</span>     with transaction.atomic():
<span class='lineno'> 787</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.incidents', title='?'>incidents</a> = Incident.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 788</span>         bulk_delete_snuba_subscriptions(list(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query.subscriptions.all()))
<span class='lineno'> 789</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.incidents', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.incidents', title='?'>incidents</a>:
<span class='lineno'> 790</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.update(status=AlertRuleStatus.SNAPSHOT.value)
<span class='lineno'> 791</span>         else:
<span class='lineno'> 792</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.delete()
<span class='lineno'> 793</span> 
<span class='lineno'> 794</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.id:
<span class='lineno'> 795</span>         # Change the incident status asynchronously, which could take awhile with many incidents due to snapshot creations.
<span class='lineno'> 796</span>         tasks.auto_resolve_snapshot_incidents.apply_async(kwargs={&quot;alert_rule_id&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule.alert_rule', title='?'>alert_rule</a>.id})
<span class='lineno'> 797</span> 
<span class='lineno'> 798</span> 
<span class='lineno'> 799</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query', title='? -> None / None -> None'>validate_alert_rule_query</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query.query', title='None'>query</a>):
<span class='lineno'> 800</span>     # TODO: We should add more validation here to reject queries that include
<span class='lineno'> 801</span>     # fields that are invalid in alert rules. For now this will just make sure
<span class='lineno'> 802</span>     # the query parses correctly.
<span class='lineno'> 803</span>     get_filter(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query.query', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.validate_alert_rule_query.query', title='None'>query</a>)
<span class='lineno'> 804</span> 
<span class='lineno'> 805</span> 
<span class='lineno'> 806</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule', title='? -> ?'>get_excluded_projects_for_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule.alert_rule', title='?'>alert_rule</a>):
<span class='lineno'> 807</span>     return AlertRuleExcludedProjects.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_excluded_projects_for_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 808</span> 
<span class='lineno'> 809</span> 
<span class='lineno'> 810</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleTriggerLabelAlreadyUsedError', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.AlertRuleTriggerLabelAlreadyUsedError', title='<AlertRuleTriggerLabelAlreadyUsedError>'>AlertRuleTriggerLabelAlreadyUsedError</a>(Exception):
<span class='lineno'> 811</span>     pass
<span class='lineno'> 812</span> 
<span class='lineno'> 813</span> 
<span class='lineno'> 814</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError', title='<ProjectsNotAssociatedWithAlertRuleError>'>ProjectsNotAssociatedWithAlertRuleError</a>(Exception):
<span class='lineno'> 815</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__', title='? -> ?'>__init__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.self', title='ProjectsNotAssociatedWithAlertRuleError'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.project_slugs', title='?'>project_slugs</a>):
<span class='lineno'> 816</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.self', title='ProjectsNotAssociatedWithAlertRuleError'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.project_slugs', title='?'>project_slugs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.project_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.ProjectsNotAssociatedWithAlertRuleError.__init__.project_slugs', title='?'>project_slugs</a>
<span class='lineno'> 817</span> 
<span class='lineno'> 818</span> 
<span class='lineno'> 819</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger', title='(?, ?, ?, ?, None, None) -> None'>create_alert_rule_trigger</a>(
<span class='lineno'> 820</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', title='?'>alert_rule</a>,
<span class='lineno'> 821</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', title='?'>label</a>,
<span class='lineno'> 822</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.threshold_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.threshold_type', title='?'>threshold_type</a>,
<span class='lineno'> 823</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_threshold', title='?'>alert_threshold</a>,
<span class='lineno'> 824</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.resolve_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.resolve_threshold', title='None'>resolve_threshold</a>=None,
<span class='lineno'> 825</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>=None,
<span class='lineno'> 826</span> ):
<span class='lineno'> 827</span>     &quot;&quot;&quot;
<span class='lineno'> 828</span>     Creates a new AlertRuleTrigger
<span class='lineno'> 829</span>     :param alert_rule: The alert rule to create the trigger for
<span class='lineno'> 830</span>     :param label: A description of the trigger
<span class='lineno'> 831</span>     :param threshold_type: An AlertRuleThresholdType
<span class='lineno'> 832</span>     :param alert_threshold: Value that the subscription needs to reach to trigger the
<span class='lineno'> 833</span>     alert rule
<span class='lineno'> 834</span>     :param resolve_threshold: Optional value that the subscription needs to reach to
<span class='lineno'> 835</span>     resolve the alert
<span class='lineno'> 836</span>     :param excluded_projects: A list of Projects that should be excluded from this
<span class='lineno'> 837</span>     trigger. These projects must be associate with the alert rule already
<span class='lineno'> 838</span>     :return: The created AlertRuleTrigger
<span class='lineno'> 839</span>     &quot;&quot;&quot;
<span class='lineno'> 840</span>     if AlertRuleTrigger.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', title='?'>alert_rule</a>, label=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', title='?'>label</a>).exists():
<span class='lineno'> 841</span>         raise AlertRuleTriggerLabelAlreadyUsedError()
<span class='lineno'> 842</span> 
<span class='lineno'> 843</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', title='[?]'>excluded_subs</a> = []
<span class='lineno'> 844</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>:
<span class='lineno'> 845</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', title='None'>excluded_subs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', title='(?, None) -> None / (?, ?) -> None'>get_subscriptions_from_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', title='?'>alert_rule</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>)
<span class='lineno'> 846</span> 
<span class='lineno'> 847</span>     with transaction.atomic():
<span class='lineno'> 848</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', title='?'>trigger</a> = AlertRuleTrigger.objects.create(
<span class='lineno'> 849</span>             alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_rule', title='?'>alert_rule</a>,
<span class='lineno'> 850</span>             label=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.label', title='?'>label</a>,
<span class='lineno'> 851</span>             threshold_type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.threshold_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.threshold_type', title='?'>threshold_type</a>.value,
<span class='lineno'> 852</span>             alert_threshold=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.alert_threshold', title='?'>alert_threshold</a>,
<span class='lineno'> 853</span>             resolve_threshold=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.resolve_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.resolve_threshold', title='None'>resolve_threshold</a>,
<span class='lineno'> 854</span>         )
<span class='lineno'> 855</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', title='{None | [?]}'>excluded_subs</a>:
<span class='lineno'> 856</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.new_exclusions', title='[?]'>new_exclusions</a> = [
<span class='lineno'> 857</span>                 AlertRuleTriggerExclusion(alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', title='?'>trigger</a>, query_subscription=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', title='?'>sub</a>)
<span class='lineno'> 858</span>                 for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.excluded_subs', title='{None | [?]}'>excluded_subs</a>
<span class='lineno'> 859</span>             ]
<span class='lineno'> 860</span>             AlertRuleTriggerExclusion.objects.bulk_create(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.new_exclusions', title='[?]'>new_exclusions</a>)
<span class='lineno'> 861</span> 
<span class='lineno'> 862</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger.trigger', title='?'>trigger</a>
<span class='lineno'> 863</span> 
<span class='lineno'> 864</span> 
<span class='lineno'> 865</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger', title='(?, None, None, None, None, None) -> None'>update_alert_rule_trigger</a>(
<span class='lineno'> 866</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>,
<span class='lineno'> 867</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', title='None'>label</a>=None,
<span class='lineno'> 868</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', title='None'>threshold_type</a>=None,
<span class='lineno'> 869</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', title='None'>alert_threshold</a>=None,
<span class='lineno'> 870</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.resolve_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.resolve_threshold', title='None'>resolve_threshold</a>=None,
<span class='lineno'> 871</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>=None,
<span class='lineno'> 872</span> ):
<span class='lineno'> 873</span>     &quot;&quot;&quot;
<span class='lineno'> 874</span>     :param trigger: The AlertRuleTrigger to update
<span class='lineno'> 875</span>     :param label: A description of the trigger
<span class='lineno'> 876</span>     :param threshold_type: An AlertRuleThresholdType
<span class='lineno'> 877</span>     :param alert_threshold: Value that the subscription needs to reach to trigger the
<span class='lineno'> 878</span>     alert rule
<span class='lineno'> 879</span>     :param resolve_threshold: Optional value that the subscription needs to reach to
<span class='lineno'> 880</span>     resolve the alert
<span class='lineno'> 881</span>     :param excluded_projects: A list of Projects that should be excluded from this
<span class='lineno'> 882</span>     trigger. These projects must be associate with the alert rule already
<span class='lineno'> 883</span>     :return: The updated AlertRuleTrigger
<span class='lineno'> 884</span>     &quot;&quot;&quot;
<span class='lineno'> 885</span> 
<span class='lineno'> 886</span>     if (
<span class='lineno'> 887</span>         AlertRuleTrigger.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>.alert_rule, label=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', title='None'>label</a>)
<span class='lineno'> 888</span>         .exclude(id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>.id)
<span class='lineno'> 889</span>         .exists()
<span class='lineno'> 890</span>     ):
<span class='lineno'> 891</span>         raise AlertRuleTriggerLabelAlreadyUsedError()
<span class='lineno'> 892</span> 
<span class='lineno'> 893</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a> = {}
<span class='lineno'> 894</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', title='None'>label</a> is not None:
<span class='lineno'> 895</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a>[&quot;label&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.label', title='None'>label</a>
<span class='lineno'> 896</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', title='None'>threshold_type</a> is not None:
<span class='lineno'> 897</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a>[&quot;threshold_type&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.threshold_type', title='None'>threshold_type</a>.value
<span class='lineno'> 898</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', title='None'>alert_threshold</a> is not None:
<span class='lineno'> 899</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a>[&quot;alert_threshold&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.alert_threshold', title='None'>alert_threshold</a>
<span class='lineno'> 900</span>     # We set resolve_threshold to None as a &#39;reset&#39;, in case it was previously a value and we&#39;re removing it here.
<span class='lineno'> 901</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a>[&quot;resolve_threshold&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.resolve_threshold', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.resolve_threshold', title='None'>resolve_threshold</a>
<span class='lineno'> 902</span> 
<span class='lineno'> 903</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', title='[?]'>deleted_exclusion_ids</a> = []
<span class='lineno'> 904</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', title='[?]'>new_subs</a> = []
<span class='lineno'> 905</span> 
<span class='lineno'> 906</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>:
<span class='lineno'> 907</span>         # We link projects to exclusions via QuerySubscriptions. Calculate which
<span class='lineno'> 908</span>         # exclusions need to be deleted, and which need to be created.
<span class='lineno'> 909</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', title='None'>excluded_subs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', title='(?, None) -> None / (?, ?) -> None'>get_subscriptions_from_alert_rule</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>.alert_rule, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_projects', title='None'>excluded_projects</a>)
<span class='lineno'> 910</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', title='?'>existing_exclusions</a> = AlertRuleTriggerExclusion.objects.filter(alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>)
<span class='lineno'> 911</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_sub_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_sub_ids', title='[?]'>new_sub_ids</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a>.id for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', title='None'>excluded_subs</a>}
<span class='lineno'> 912</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_sub_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_sub_ids', title='[?]'>existing_sub_ids</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', title='?'>exclusion</a>.query_subscription_id for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.exclusion', title='?'>exclusion</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', title='?'>existing_exclusions</a>}
<span class='lineno'> 913</span> 
<span class='lineno'> 914</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', title='[?]'>deleted_exclusion_ids</a> = [
<span class='lineno'> 915</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', title='?'>e</a>.id for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', title='?'>e</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_exclusions', title='?'>existing_exclusions</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.e', title='?'>e</a>.query_subscription_id not in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_sub_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_sub_ids', title='[?]'>new_sub_ids</a>
<span class='lineno'> 916</span>         ]
<span class='lineno'> 917</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', title='[?]'>new_subs</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a> for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.excluded_subs', title='None'>excluded_subs</a> if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a>.id not in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_sub_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.existing_sub_ids', title='[?]'>existing_sub_ids</a>]
<span class='lineno'> 918</span> 
<span class='lineno'> 919</span>     with transaction.atomic():
<span class='lineno'> 920</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.updated_fields', title='dict'>updated_fields</a>:
<span class='lineno'> 921</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>.update(**updated_fields)
<span class='lineno'> 922</span> 
<span class='lineno'> 923</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', title='[?]'>deleted_exclusion_ids</a>:
<span class='lineno'> 924</span>             AlertRuleTriggerExclusion.objects.filter(id__in=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.deleted_exclusion_ids', title='[?]'>deleted_exclusion_ids</a>).delete()
<span class='lineno'> 925</span> 
<span class='lineno'> 926</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', title='[?]'>new_subs</a>:
<span class='lineno'> 927</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_exclusions', title='[?]'>new_exclusions</a> = [
<span class='lineno'> 928</span>                 AlertRuleTriggerExclusion(alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>, query_subscription=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a>)
<span class='lineno'> 929</span>                 for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.sub', title='?'>sub</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_subs', title='[?]'>new_subs</a>
<span class='lineno'> 930</span>             ]
<span class='lineno'> 931</span>             AlertRuleTriggerExclusion.objects.bulk_create(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_exclusions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.new_exclusions', title='[?]'>new_exclusions</a>)
<span class='lineno'> 932</span> 
<span class='lineno'> 933</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger.trigger', title='?'>trigger</a>
<span class='lineno'> 934</span> 
<span class='lineno'> 935</span> 
<span class='lineno'> 936</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger', title='? -> None'>delete_alert_rule_trigger</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger.trigger', title='?'>trigger</a>):
<span class='lineno'> 937</span>     &quot;&quot;&quot;
<span class='lineno'> 938</span>     Deletes an AlertRuleTrigger
<span class='lineno'> 939</span>     &quot;&quot;&quot;
<span class='lineno'> 940</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger.trigger', title='?'>trigger</a>.delete()
<span class='lineno'> 941</span> 
<span class='lineno'> 942</span> 
<span class='lineno'> 943</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule', title='? -> ?'>get_triggers_for_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule.alert_rule', title='?'>alert_rule</a>):
<span class='lineno'> 944</span>     return AlertRuleTrigger.objects.filter(alert_rule=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_triggers_for_alert_rule.alert_rule', title='?'>alert_rule</a>)
<span class='lineno'> 945</span> 
<span class='lineno'> 946</span> 
<span class='lineno'> 947</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule', title='(?, None) -> None / (?, ?) -> None'>get_subscriptions_from_alert_rule</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.alert_rule', title='?'>alert_rule</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', title='None'>projects</a>):
<span class='lineno'> 948</span>     &quot;&quot;&quot;
<span class='lineno'> 949</span>     Fetches subscriptions associated with an alert rule filtered by a list of projects.
<span class='lineno'> 950</span>     Raises `ProjectsNotAssociatedWithAlertRuleError` if Projects aren&#39;t associated with
<span class='lineno'> 951</span>     the AlertRule
<span class='lineno'> 952</span>     :param alert_rule: The AlertRule to fetch subscriptions for
<span class='lineno'> 953</span>     :param projects: The Project we want subscriptions for
<span class='lineno'> 954</span>     :return: A list of QuerySubscriptions
<span class='lineno'> 955</span>     &quot;&quot;&quot;
<span class='lineno'> 956</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', title='?'>excluded_subscriptions</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.alert_rule', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.alert_rule', title='?'>alert_rule</a>.snuba_query.subscriptions.filter(project__in=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', title='None'>projects</a>)
<span class='lineno'> 957</span>     if len(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', title='?'>excluded_subscriptions</a>) != len(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', title='None'>projects</a>):
<span class='lineno'> 958</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.invalid_slugs', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.invalid_slugs', title='?'>invalid_slugs</a> = set([<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', title='?'>p</a>.slug for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.p', title='?'>p</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.projects', title='None'>projects</a>]) - set(
<span class='lineno'> 959</span>             [<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', title='?'>s</a>.project.slug for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.s', title='?'>s</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', title='?'>excluded_subscriptions</a>]
<span class='lineno'> 960</span>         )
<span class='lineno'> 961</span>         raise ProjectsNotAssociatedWithAlertRuleError(invalid_slugs)
<span class='lineno'> 962</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_subscriptions_from_alert_rule.excluded_subscriptions', title='?'>excluded_subscriptions</a>
<span class='lineno'> 963</span> 
<span class='lineno'> 964</span> 
<span class='lineno'> 965</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action', title='(?, ?, ?, None, None) -> None'>create_alert_rule_trigger_action</a>(
<span class='lineno'> 966</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', title='?'>trigger</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', title='?'>type</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', title='?'>target_type</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', title='None'>integration</a>=None
<span class='lineno'> 967</span> ):
<span class='lineno'> 968</span>     &quot;&quot;&quot;
<span class='lineno'> 969</span>     Creates an AlertRuleTriggerAction
<span class='lineno'> 970</span>     :param trigger: The trigger to create the action on
<span class='lineno'> 971</span>     :param type: Which sort of action to take
<span class='lineno'> 972</span>     :param target_type: Which type of target to send to
<span class='lineno'> 973</span>     :param target_identifier: (Optional) The identifier of the target
<span class='lineno'> 974</span>     :param target_display: (Optional) Human readable name for the target
<span class='lineno'> 975</span>     :param integration: (Optional) The Integration related to this action.
<span class='lineno'> 976</span>     :return: The created action
<span class='lineno'> 977</span>     &quot;&quot;&quot;
<span class='lineno'> 978</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', title='None'>target_display</a> = None
<span class='lineno'> 979</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', title='?'>type</a> == AlertRuleTriggerAction.Type.SLACK:
<span class='lineno'> 980</span> 
<span class='lineno'> 981</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', title='?'>target_type</a> != AlertRuleTriggerAction.TargetType.SPECIFIC:
<span class='lineno'> 982</span>             raise InvalidTriggerActionError(&quot;Slack action must specify channel&quot;)
<span class='lineno'> 983</span> 
<span class='lineno'> 984</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.channel_id', title='?'>channel_id</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', title='(?, ?, ?) -> ? / (?, ?, None) -> ?'>get_alert_rule_trigger_action_slack_channel_id</a>(
<span class='lineno'> 985</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', title='?'>trigger</a>.alert_rule.organization, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', title='None'>integration</a>.id, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>
<span class='lineno'> 986</span>         )
<span class='lineno'> 987</span> 
<span class='lineno'> 988</span>         # Use the channel name for display
<span class='lineno'> 989</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', title='None'>target_display</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>
<span class='lineno'> 990</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', title='?'>target_identifier</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.channel_id', title='?'>channel_id</a>
<span class='lineno'> 991</span> 
<span class='lineno'> 992</span>     return AlertRuleTriggerAction.objects.create(
<span class='lineno'> 993</span>         alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.trigger', title='?'>trigger</a>,
<span class='lineno'> 994</span>         type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.type', title='?'>type</a>.value,
<span class='lineno'> 995</span>         target_type=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_type', title='?'>target_type</a>.value,
<span class='lineno'> 996</span>         target_identifier=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>,
<span class='lineno'> 997</span>         target_display=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.target_display', title='None'>target_display</a>,
<span class='lineno'> 998</span>         integration=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.create_alert_rule_trigger_action.integration', title='None'>integration</a>,
<span class='lineno'> 999</span>     )
<span class='lineno'>1000</span> 
<span class='lineno'>1001</span> 
<span class='lineno'>1002</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action', title='(?, None, None, None, None) -> None'>update_alert_rule_trigger_action</a>(
<span class='lineno'>1003</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', title='None'>type</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', title='None'>target_type</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>=None, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', title='None'>integration</a>=None
<span class='lineno'>1004</span> ):
<span class='lineno'>1005</span>     &quot;&quot;&quot;
<span class='lineno'>1006</span>     Updates values on an AlertRuleTriggerAction
<span class='lineno'>1007</span>     :param trigger_action: The trigger action to update
<span class='lineno'>1008</span>     :param type: Which sort of action to take
<span class='lineno'>1009</span>     :param target_type: Which type of target to send to
<span class='lineno'>1010</span>     :param target_identifier: The identifier of the target
<span class='lineno'>1011</span>     :param target_display: Human readable name for the target
<span class='lineno'>1012</span>     :param integration: The Integration related to this action.
<span class='lineno'>1013</span>     :return:
<span class='lineno'>1014</span>     &quot;&quot;&quot;
<span class='lineno'>1015</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a> = {}
<span class='lineno'>1016</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', title='None'>type</a> is not None:
<span class='lineno'>1017</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;type&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', title='None'>type</a>.value
<span class='lineno'>1018</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', title='None'>target_type</a> is not None:
<span class='lineno'>1019</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;target_type&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_type', title='None'>target_type</a>.value
<span class='lineno'>1020</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', title='None'>integration</a> is not None:
<span class='lineno'>1021</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;integration&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', title='None'>integration</a>
<span class='lineno'>1022</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a> is not None:
<span class='lineno'>1023</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', title='?'>type</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>.get(&quot;type&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>.type)
<span class='lineno'>1024</span> 
<span class='lineno'>1025</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.type', title='?'>type</a> == AlertRuleTriggerAction.Type.SLACK.value:
<span class='lineno'>1026</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', title='?'>integration</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>.get(&quot;integration&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>.integration)
<span class='lineno'>1027</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.channel_id', title='?'>channel_id</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', title='(?, ?, ?) -> ? / (?, ?, None) -> ?'>get_alert_rule_trigger_action_slack_channel_id</a>(
<span class='lineno'>1028</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>.alert_rule_trigger.alert_rule.organization,
<span class='lineno'>1029</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.integration', title='?'>integration</a>.id,
<span class='lineno'>1030</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>,
<span class='lineno'>1031</span>             )
<span class='lineno'>1032</span> 
<span class='lineno'>1033</span>             # Use the channel name for display
<span class='lineno'>1034</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;target_display&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>
<span class='lineno'>1035</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;target_identifier&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.channel_id', title='?'>channel_id</a>
<span class='lineno'>1036</span>         else:
<span class='lineno'>1037</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.updated_fields', title='dict'>updated_fields</a>[&quot;target_identifier&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.target_identifier', title='None'>target_identifier</a>
<span class='lineno'>1038</span> 
<span class='lineno'>1039</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>.update(**updated_fields)
<span class='lineno'>1040</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.update_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>
<span class='lineno'>1041</span> 
<span class='lineno'>1042</span> 
<span class='lineno'>1043</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id', title='(?, ?, ?) -> ? / (?, ?, None) -> ?'>get_alert_rule_trigger_action_slack_channel_id</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.organization', title='?'>organization</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', title='?'>integration_id</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.name', title='None'>name</a>):
<span class='lineno'>1044</span>     from sentry.integrations.slack.utils import get_channel_id
<span class='lineno'>1045</span> 
<span class='lineno'>1046</span>     try:
<span class='lineno'>1047</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id._prefix', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id._prefix', title='?'>_prefix</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', title='?'>channel_id</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.timed_out', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.timed_out', title='?'>timed_out</a> = get_channel_id(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.organization', title='?'>organization</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', title='?'>integration_id</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.name', title='None'>name</a>)
<span class='lineno'>1048</span>     except DuplicateDisplayNameError as <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.e', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.e', title='?'>e</a>:
<span class='lineno'>1049</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration', title='?'>integration</a> = Integration.objects.get(id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration_id', title='?'>integration_id</a>)
<span class='lineno'>1050</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.domain', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.domain', title='?'>domain</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.integration', title='?'>integration</a>.metadata[&quot;domain_name&quot;]
<span class='lineno'>1051</span> 
<span class='lineno'>1052</span>         raise InvalidTriggerActionError(
<span class='lineno'>1053</span>             &#39;Multiple users were found with display name &quot;%s&quot;. Please use your username, found at %s/account/settings.&#39;
<span class='lineno'>1054</span>             % (e.message, domain)
<span class='lineno'>1055</span>         )
<span class='lineno'>1056</span> 
<span class='lineno'>1057</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.timed_out', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.timed_out', title='?'>timed_out</a>:
<span class='lineno'>1058</span>         raise InvalidTriggerActionError(
<span class='lineno'>1059</span>             &quot;Could not find channel %s. We have timed out trying to look for it. &quot; % name
<span class='lineno'>1060</span>         )
<span class='lineno'>1061</span> 
<span class='lineno'>1062</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', title='?'>channel_id</a> is None:
<span class='lineno'>1063</span>         raise InvalidTriggerActionError(
<span class='lineno'>1064</span>             &quot;Could not find channel %s. Channel may not exist, or Sentry may not &quot;
<span class='lineno'>1065</span>             &quot;have been granted permission to access it&quot; % name
<span class='lineno'>1066</span>         )
<span class='lineno'>1067</span> 
<span class='lineno'>1068</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_alert_rule_trigger_action_slack_channel_id.channel_id', title='?'>channel_id</a>
<span class='lineno'>1069</span> 
<span class='lineno'>1070</span> 
<span class='lineno'>1071</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action', title='? -> None'>delete_alert_rule_trigger_action</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>):
<span class='lineno'>1072</span>     &quot;&quot;&quot;
<span class='lineno'>1073</span>     Deletes a AlertRuleTriggerAction
<span class='lineno'>1074</span>     &quot;&quot;&quot;
<span class='lineno'>1075</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action.trigger_action', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.delete_alert_rule_trigger_action.trigger_action', title='?'>trigger_action</a>.delete()
<span class='lineno'>1076</span> 
<span class='lineno'>1077</span> 
<span class='lineno'>1078</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger', title='? -> ?'>get_actions_for_trigger</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger.trigger', title='?'>trigger</a>):
<span class='lineno'>1079</span>     return AlertRuleTriggerAction.objects.filter(alert_rule_trigger=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger.trigger', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_actions_for_trigger.trigger', title='?'>trigger</a>)
<span class='lineno'>1080</span> 
<span class='lineno'>1081</span> 
<span class='lineno'>1082</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org', title='? -> None'>get_available_action_integrations_for_org</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.organization', title='?'>organization</a>):
<span class='lineno'>1083</span>     &quot;&quot;&quot;
<span class='lineno'>1084</span>     Returns a list of integrations that the organization has installed. Integrations are
<span class='lineno'>1085</span>     filtered by the list of registered providers.
<span class='lineno'>1086</span>     :param organization:
<span class='lineno'>1087</span>     &quot;&quot;&quot;
<span class='lineno'>1088</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.providers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.providers', title='[?]'>providers</a> = [
<span class='lineno'>1089</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', title='?'>registration</a>.integration_provider
<span class='lineno'>1090</span>         for <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', title='?'>registration</a></a> in AlertRuleTriggerAction.get_registered_types()
<span class='lineno'>1091</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.registration', title='?'>registration</a>.integration_provider is not None
<span class='lineno'>1092</span>     ]
<span class='lineno'>1093</span>     return Integration.objects.filter(organizations=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.organization', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.organization', title='?'>organization</a>, provider__in=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.providers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_available_action_integrations_for_org.providers', title='[?]'>providers</a>)
<span class='lineno'>1094</span> 
<span class='lineno'>1095</span> 
<span class='lineno'>1096</span> # TODO: This is temporarily needed to support back and forth translations for snuba / frontend.
<span class='lineno'>1097</span> # Uses a function from discover to break the aggregate down into parts, and then compare the &quot;field&quot;
<span class='lineno'>1098</span> # to a list of accepted fields, or a list of fields we need to translate.
<span class='lineno'>1099</span> # This can be dropped once snuba can handle this aliasing.
<span class='lineno'>1100</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS', title='[str]'>SUPPORTED_COLUMNS</a> = [
<span class='lineno'>1101</span>     &quot;tags[sentry:user]&quot;,
<span class='lineno'>1102</span>     &quot;tags[sentry:dist]&quot;,
<span class='lineno'>1103</span>     &quot;tags[sentry:release]&quot;,
<span class='lineno'>1104</span>     &quot;transaction.duration&quot;,
<span class='lineno'>1105</span> ]
<span class='lineno'>1106</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', title='dict'>TRANSLATABLE_COLUMNS</a> = {
<span class='lineno'>1107</span>     &quot;user&quot;: &quot;tags[sentry:user]&quot;,
<span class='lineno'>1108</span>     &quot;dist&quot;: &quot;tags[sentry:dist]&quot;,
<span class='lineno'>1109</span>     &quot;release&quot;: &quot;tags[sentry:release]&quot;,
<span class='lineno'>1110</span> }
<span class='lineno'>1111</span> 
<span class='lineno'>1112</span> 
<span class='lineno'>1113</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', title='? -> None'>get_column_from_aggregate</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.aggregate', title='?'>aggregate</a>):
<span class='lineno'>1114</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', title='?'>field</a> = resolve_field(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.aggregate', title='?'>aggregate</a>)
<span class='lineno'>1115</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', title='?'>field</a>[1] is not None:
<span class='lineno'>1116</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.column', title='?'>column</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.field', title='?'>field</a>[1][0][1]
<span class='lineno'>1117</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate.column', title='?'>column</a>
<span class='lineno'>1118</span>     return None
<span class='lineno'>1119</span> 
<span class='lineno'>1120</span> 
<span class='lineno'>1121</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support', title='? -> bool'>check_aggregate_column_support</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.aggregate', title='?'>aggregate</a>):
<span class='lineno'>1122</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', title='None'>column</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', title='? -> None'>get_column_from_aggregate</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.aggregate', title='?'>aggregate</a>)
<span class='lineno'>1123</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', title='None'>column</a> is None or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', title='None'>column</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.SUPPORTED_COLUMNS', title='[str]'>SUPPORTED_COLUMNS</a> or <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.check_aggregate_column_support.column', title='None'>column</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', title='dict'>TRANSLATABLE_COLUMNS</a>.keys()
<span class='lineno'>1124</span> 
<span class='lineno'>1125</span> 
<span class='lineno'>1126</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field', title='(?, bool) -> None'>translate_aggregate_field</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', title='?'>aggregate</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.reverse', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.reverse', title='bool'>reverse</a>=False):
<span class='lineno'>1127</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.get_column_from_aggregate', title='? -> None'>get_column_from_aggregate</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', title='?'>aggregate</a>)
<span class='lineno'>1128</span>     if not <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.reverse', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.reverse', title='bool'>reverse</a>:
<span class='lineno'>1129</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', title='dict'>TRANSLATABLE_COLUMNS</a>.keys():
<span class='lineno'>1130</span>             return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', title='?'>aggregate</a>.replace(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', title='dict'>TRANSLATABLE_COLUMNS</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a>])
<span class='lineno'>1131</span>     else:
<span class='lineno'>1132</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a> is not None:
<span class='lineno'>1133</span>             for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.field', title='?'>field</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.translated_field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.translated_field', title='?'>translated_field</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.TRANSLATABLE_COLUMNS', title='dict'>TRANSLATABLE_COLUMNS</a>.items():
<span class='lineno'>1134</span>                 if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.translated_field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.translated_field', title='?'>translated_field</a> == <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a>:
<span class='lineno'>1135</span>                     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', title='?'>aggregate</a>.replace(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.column', title='None'>column</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.field', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.field', title='?'>field</a>)
<span class='lineno'>1136</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.incidents.logic.translate_aggregate_field.aggregate', title='?'>aggregate</a>
</pre></td></tr></table></body></html>