<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/sentry/src/sentry/utils/pytest/kafka.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log'>_log</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT'>MAX_SECONDS_WAITING_FOR_EVENT</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer'>kafka_producer</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper'>_KafkaAdminWrapper</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__'>__init__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic'>delete_topic</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result'>_sync_wait_on_result</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin'>kafka_admin</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter'>kafka_topics_setter</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.requires_kafka', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.requires_kafka'>requires_kafka</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers'>scope_consumers</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer'>session_ingest_consumer</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer', xid='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer'>wait_for_ingest_consumer</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> from __future__ import absolute_import
<span class='lineno'>   2</span> 
<span class='lineno'>   3</span> import os
<span class='lineno'>   4</span> 
<span class='lineno'>   5</span> import pytest
<span class='lineno'>   6</span> import six
<span class='lineno'>   7</span> from confluent_kafka.admin import AdminClient
<span class='lineno'>   8</span> from confluent_kafka import Producer
<span class='lineno'>   9</span> import time
<span class='lineno'>  10</span> import logging
<span class='lineno'>  11</span> 
<span class='lineno'>  12</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', title='?'>_log</a> = logging.getLogger(__name__)
<span class='lineno'>  13</span> 
<span class='lineno'>  14</span> <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT', title='int'>MAX_SECONDS_WAITING_FOR_EVENT</a> = 16
<span class='lineno'>  15</span> 
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span> @pytest.fixture
<span class='lineno'>  18</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer', title='() -> ? -> None'>kafka_producer</a>():
<span class='lineno'>  19</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner', title='? -> None'>inner</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.settings', title='?'>settings</a>):
<span class='lineno'>  20</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.producer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.producer', title='?'>producer</a> = Producer(
<span class='lineno'>  21</span>             {&quot;bootstrap.servers&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.settings', title='?'>settings</a>.KAFKA_CLUSTERS[&quot;default&quot;][&quot;bootstrap.servers&quot;]}
<span class='lineno'>  22</span>         )
<span class='lineno'>  23</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.producer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner.producer', title='?'>producer</a>
<span class='lineno'>  24</span> 
<span class='lineno'>  25</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_producer.inner', title='? -> None'>inner</a>
<span class='lineno'>  26</span> 
<span class='lineno'>  27</span> 
<span class='lineno'>  28</span> class <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper', title='<_KafkaAdminWrapper>'>_KafkaAdminWrapper</a>:
<span class='lineno'>  29</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__', title='? -> ?'>__init__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', title='_KafkaAdminWrapper'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.request', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.request', title='?'>request</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.settings', title='?'>settings</a>):
<span class='lineno'>  30</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', title='_KafkaAdminWrapper'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.test_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.test_name', title='?'>test_name</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.request', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.request', title='?'>request</a>.node.name
<span class='lineno'>  31</span> 
<span class='lineno'>  32</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', title='dict'>kafka_config</a> = {}
<span class='lineno'>  33</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.key', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.key', title='?'>key</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.val', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.val', title='?'>val</a> in six.iteritems(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.settings', title='?'>settings</a>.KAFKA_CLUSTERS[&quot;default&quot;]):
<span class='lineno'>  34</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', title='dict'>kafka_config</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.key', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.key', title='?'>key</a>] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.val', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.val', title='?'>val</a>
<span class='lineno'>  35</span> 
<span class='lineno'>  36</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.self', title='_KafkaAdminWrapper'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.admin_client', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.admin_client', title='?'>admin_client</a> = AdminClient(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.__init__.kafka_config', title='dict'>kafka_config</a>)
<span class='lineno'>  37</span> 
<span class='lineno'>  38</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic', title='(_KafkaAdminWrapper, ?) -> ?'>delete_topic</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', title='_KafkaAdminWrapper'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', title='?'>topic_name</a>):
<span class='lineno'>  39</span>         try:
<span class='lineno'>  40</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.futures_dict', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.futures_dict', title='?'>futures_dict</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', title='_KafkaAdminWrapper'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.admin_client', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.admin_client', title='?'>admin_client</a>.delete_topics([<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', title='?'>topic_name</a>])
<span class='lineno'>  41</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.self', title='_KafkaAdminWrapper'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result', title='(_KafkaAdminWrapper, ?) -> None'>_sync_wait_on_result</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.futures_dict', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.futures_dict', title='?'>futures_dict</a>)
<span class='lineno'>  42</span>         except Exception:  # noqa
<span class='lineno'>  43</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', title='?'>_log</a>.warning(&quot;Could not delete topic %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper.delete_topic.topic_name', title='?'>topic_name</a>)
<span class='lineno'>  44</span> 
<span class='lineno'>  45</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result', title='(_KafkaAdminWrapper, ?) -> None'>_sync_wait_on_result</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.self', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.self', title='_KafkaAdminWrapper'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.futures_dict', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.futures_dict', title='?'>futures_dict</a>):
<span class='lineno'>  46</span>         &quot;&quot;&quot;
<span class='lineno'>  47</span>         Synchronously waits on all futures returned by the admin_client api.
<span class='lineno'>  48</span>         :param futures_dict: the api returns a dict of futures that can be awaited
<span class='lineno'>  49</span>         &quot;&quot;&quot;
<span class='lineno'>  50</span>         # just wait on all futures returned by the async operations of the admin_client
<span class='lineno'>  51</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.f', title='?'>f</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.futures_dict', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.futures_dict', title='?'>futures_dict</a>.values():
<span class='lineno'>  52</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.f', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper._sync_wait_on_result.f', title='?'>f</a>.result(5)  # wait up to 5 seconds for the admin operation to finish
<span class='lineno'>  53</span> 
<span class='lineno'>  54</span> 
<span class='lineno'>  55</span> @pytest.fixture
<span class='lineno'>  56</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin', title='? -> ? -> _KafkaAdminWrapper'>kafka_admin</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.request', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.request', title='?'>request</a>):
<span class='lineno'>  57</span>     &quot;&quot;&quot;
<span class='lineno'>  58</span>     A fixture representing a simple wrapper over the admin interface
<span class='lineno'>  59</span>     :param request: the pytest request
<span class='lineno'>  60</span>     :return: a Kafka admin wrapper
<span class='lineno'>  61</span>     &quot;&quot;&quot;
<span class='lineno'>  62</span> 
<span class='lineno'>  63</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner', title='? -> _KafkaAdminWrapper'>inner</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner.settings', title='?'>settings</a>):
<span class='lineno'>  64</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._KafkaAdminWrapper', title='<_KafkaAdminWrapper>'>_KafkaAdminWrapper</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.request', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.request', title='?'>request</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner.settings', title='?'>settings</a>)
<span class='lineno'>  65</span> 
<span class='lineno'>  66</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_admin.inner', title='? -> _KafkaAdminWrapper'>inner</a>
<span class='lineno'>  67</span> 
<span class='lineno'>  68</span> 
<span class='lineno'>  69</span> @pytest.fixture
<span class='lineno'>  70</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter', title='() -> ? -> None'>kafka_topics_setter</a>():
<span class='lineno'>  71</span>     &quot;&quot;&quot;
<span class='lineno'>  72</span>     Returns a function that given a Django settings objects will setup the
<span class='lineno'>  73</span>     kafka topics names to test names.
<span class='lineno'>  74</span> 
<span class='lineno'>  75</span>     :return: a function that given a settings object changes all kafka topic names
<span class='lineno'>  76</span>     to &quot;test-&lt;normal_topic_name&gt;&quot;
<span class='lineno'>  77</span>     &quot;&quot;&quot;
<span class='lineno'>  78</span> 
<span class='lineno'>  79</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings', title='? -> None'>set_test_kafka_settings</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>):
<span class='lineno'>  80</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', title='str'>ingest_events</a> = &quot;ingest-events&quot;
<span class='lineno'>  81</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_INGEST_EVENTS = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', title='str'>ingest_events</a>
<span class='lineno'>  82</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_TOPICS[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', title='str'>ingest_events</a>] = {&quot;cluster&quot;: &quot;default&quot;, &quot;topic&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_events', title='str'>ingest_events</a>}
<span class='lineno'>  83</span> 
<span class='lineno'>  84</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', title='str'>ingest_transactions</a> = &quot;ingest-transactions&quot;
<span class='lineno'>  85</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.INGEST_TRANSACTIONS = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', title='str'>ingest_transactions</a>
<span class='lineno'>  86</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_TOPICS[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', title='str'>ingest_transactions</a>] = {
<span class='lineno'>  87</span>             &quot;cluster&quot;: &quot;default&quot;,
<span class='lineno'>  88</span>             &quot;topic&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_transactions', title='str'>ingest_transactions</a>,
<span class='lineno'>  89</span>         }
<span class='lineno'>  90</span> 
<span class='lineno'>  91</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', title='str'>ingest_attachments</a> = &quot;ingest-attachments&quot;
<span class='lineno'>  92</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_INGEST_ATTACHMENTS = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', title='str'>ingest_attachments</a>
<span class='lineno'>  93</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_TOPICS[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', title='str'>ingest_attachments</a>] = {
<span class='lineno'>  94</span>             &quot;cluster&quot;: &quot;default&quot;,
<span class='lineno'>  95</span>             &quot;topic&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.ingest_attachments', title='str'>ingest_attachments</a>,
<span class='lineno'>  96</span>         }
<span class='lineno'>  97</span> 
<span class='lineno'>  98</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', title='str'>outcomes</a> = &quot;outcomes&quot;
<span class='lineno'>  99</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_OUTCOMES = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', title='str'>outcomes</a>
<span class='lineno'> 100</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.settings', title='?'>settings</a>.KAFKA_TOPICS[<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', title='str'>outcomes</a>] = {&quot;cluster&quot;: &quot;default&quot;, &quot;topic&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings.outcomes', title='str'>outcomes</a>}
<span class='lineno'> 101</span> 
<span class='lineno'> 102</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.kafka_topics_setter.set_test_kafka_settings', title='? -> None'>set_test_kafka_settings</a>
<span class='lineno'> 103</span> 
<span class='lineno'> 104</span> 
<span class='lineno'> 105</span> @pytest.fixture
<span class='lineno'> 106</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.requires_kafka', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.requires_kafka', title='() -> None'>requires_kafka</a>():
<span class='lineno'> 107</span>     pytest.importorskip(&quot;confluent_kafka&quot;)
<span class='lineno'> 108</span> 
<span class='lineno'> 109</span>     if &quot;SENTRY_KAFKA_HOSTS&quot; not in os.environ:
<span class='lineno'> 110</span>         pytest.xfail(&quot;test requires SENTRY_KAFKA_HOSTS environment variable which is not set&quot;)
<span class='lineno'> 111</span> 
<span class='lineno'> 112</span> 
<span class='lineno'> 113</span> @pytest.fixture(scope=&quot;session&quot;)
<span class='lineno'> 114</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers', title='() -> ?'>scope_consumers</a>():
<span class='lineno'> 115</span>     &quot;&quot;&quot;
<span class='lineno'> 116</span>       Sets up an object to keep track of the scope consumers ( consumers that will only
<span class='lineno'> 117</span>       be created once per test session).
<span class='lineno'> 118</span> 
<span class='lineno'> 119</span>     &quot;&quot;&quot;
<span class='lineno'> 120</span>     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', title='dict'>all_consumers</a> = {
<span class='lineno'> 121</span>         &quot;ingest_events&quot;: None,
<span class='lineno'> 122</span>         &quot;ingest_transactions&quot;: None,
<span class='lineno'> 123</span>         &quot;ingest_attachments&quot;: None,
<span class='lineno'> 124</span>         &quot;outcomes&quot;: None,
<span class='lineno'> 125</span>     }
<span class='lineno'> 126</span>     yield <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', title='dict'>all_consumers</a>
<span class='lineno'> 127</span> 
<span class='lineno'> 128</span>     for (<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', title='?'>consumer</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'>consumer_name</a>) in (
<span class='lineno'> 129</span>         (<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.all_consumers', title='dict'>all_consumers</a>.get(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'>consumer_name</a>), <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'>consumer_name</a>)
<span class='lineno'> 130</span>         for <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'><a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'>consumer_name</a></a> in (
<span class='lineno'> 131</span>             &quot;ingest_events&quot;,
<span class='lineno'> 132</span>             &quot;ingest_transactions&quot;,
<span class='lineno'> 133</span>             &quot;ingest_attachments&quot;,
<span class='lineno'> 134</span>             &quot;outcomes&quot;,
<span class='lineno'> 135</span>         )
<span class='lineno'> 136</span>     ):
<span class='lineno'> 137</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', title='?'>consumer</a> is not None:
<span class='lineno'> 138</span>             try:
<span class='lineno'> 139</span>                 # stop the consumer
<span class='lineno'> 140</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', title='?'>consumer</a>.signal_shutdown()
<span class='lineno'> 141</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer', title='?'>consumer</a>.run()
<span class='lineno'> 142</span>             except:  # noqa:
<span class='lineno'> 143</span>                 <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', title='?'>_log</a>.warning(&quot;Failed to cleanup consumer %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.scope_consumers.consumer_name', title='str'>consumer_name</a>)
<span class='lineno'> 144</span> 
<span class='lineno'> 145</span> 
<span class='lineno'> 146</span> @pytest.fixture(scope=&quot;function&quot;)
<span class='lineno'> 147</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer', title='(?, ?, ?) -> ? -> None'>session_ingest_consumer</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', title='?'>scope_consumers</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.kafka_admin', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.kafka_admin', title='?'>kafka_admin</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.task_runner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.task_runner', title='?'>task_runner</a>):
<span class='lineno'> 148</span>     &quot;&quot;&quot;
<span class='lineno'> 149</span>     Returns a factory for a session ingest consumer.
<span class='lineno'> 150</span> 
<span class='lineno'> 151</span>     Note/Warning: Once an inject consumer is created it will be reused by all tests in the session.
<span class='lineno'> 152</span>     The ingest consumer is created the first time with the provided settings and then reused.
<span class='lineno'> 153</span>     If you don&#39;t want this behaviour DO NOT USE this fixture (create a fixture, similar with this one,
<span class='lineno'> 154</span>     that returns a new consumer at each invocation rather then reusing it)
<span class='lineno'> 155</span> 
<span class='lineno'> 156</span>     :return: a function factory that creates a consumer at first invocation and returns the cached consumer afterwards.
<span class='lineno'> 157</span>     &quot;&quot;&quot;
<span class='lineno'> 158</span> 
<span class='lineno'> 159</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer', title='? -> None'>ingest_consumer</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.settings', title='?'>settings</a>):
<span class='lineno'> 160</span>         from sentry.ingest.ingest_consumer import ConsumerType, get_ingest_consumer
<span class='lineno'> 161</span> 
<span class='lineno'> 162</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', title='?'>scope_consumers</a>[&quot;ingest_events&quot;] is not None:
<span class='lineno'> 163</span>             return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', title='?'>scope_consumers</a>[
<span class='lineno'> 164</span>                 &quot;ingest_events&quot;
<span class='lineno'> 165</span>             ]  # reuse whatever was already created (will ignore the settings)
<span class='lineno'> 166</span> 
<span class='lineno'> 167</span>         # first time the consumer is requested, create it using settings
<span class='lineno'> 168</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.topic_event_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.topic_event_name', title='?'>topic_event_name</a> = ConsumerType.get_topic_name(ConsumerType.Events)
<span class='lineno'> 169</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.admin', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.admin', title='?'>admin</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.kafka_admin', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.kafka_admin', title='?'>kafka_admin</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.settings', title='?'>settings</a>)
<span class='lineno'> 170</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.admin', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.admin', title='?'>admin</a>.delete_topic(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.topic_event_name', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.topic_event_name', title='?'>topic_event_name</a>)
<span class='lineno'> 171</span> 
<span class='lineno'> 172</span>         # simulate the event ingestion task
<span class='lineno'> 173</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.group_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.group_id', title='str'>group_id</a> = &quot;test-consumer&quot;
<span class='lineno'> 174</span> 
<span class='lineno'> 175</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', title='?'>consumer</a> = get_ingest_consumer(
<span class='lineno'> 176</span>             max_batch_size=1,
<span class='lineno'> 177</span>             max_batch_time=10,
<span class='lineno'> 178</span>             group_id=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.group_id', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.group_id', title='str'>group_id</a>,
<span class='lineno'> 179</span>             consumer_types=[ConsumerType.Events],
<span class='lineno'> 180</span>             auto_offset_reset=&quot;earliest&quot;,
<span class='lineno'> 181</span>         )
<span class='lineno'> 182</span> 
<span class='lineno'> 183</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.scope_consumers', title='?'>scope_consumers</a>[&quot;ingest_events&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', title='?'>consumer</a>
<span class='lineno'> 184</span> 
<span class='lineno'> 185</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer.consumer', title='?'>consumer</a>
<span class='lineno'> 186</span> 
<span class='lineno'> 187</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.session_ingest_consumer.ingest_consumer', title='? -> None'>ingest_consumer</a>
<span class='lineno'> 188</span> 
<span class='lineno'> 189</span> 
<span class='lineno'> 190</span> @pytest.fixture(scope=&quot;function&quot;)
<span class='lineno'> 191</span> def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer', title='(?, ?) -> ? -> (?, int) -> None'>wait_for_ingest_consumer</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.session_ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.session_ingest_consumer', title='?'>session_ingest_consumer</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.task_runner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.task_runner', title='?'>task_runner</a>):
<span class='lineno'> 192</span>     &quot;&quot;&quot;
<span class='lineno'> 193</span>     Returns a function that can be used to create a wait loop for the ingest consumer
<span class='lineno'> 194</span> 
<span class='lineno'> 195</span>     The ingest consumer will be called in a loop followed by a query to the supplied
<span class='lineno'> 196</span>     predicate. If the predicate returns a non None value the wait will be ended and
<span class='lineno'> 197</span>     the waiter will return whatever the predicate returned.
<span class='lineno'> 198</span>     If the max_time passes the waiter will be terminated and the waiter will return None
<span class='lineno'> 199</span> 
<span class='lineno'> 200</span>     Note: The reason there we return a factory and not directly the waiter is that we
<span class='lineno'> 201</span>     need to configure the consumer with the test settings (settings are typically available
<span class='lineno'> 202</span>     in the test) so a test would typically first create the waiter and the use it to wait for
<span class='lineno'> 203</span>     the required condition:
<span class='lineno'> 204</span> 
<span class='lineno'> 205</span>     waiter = wait_for_ingest_consumer( test_settings_derived_from_the_project_settings)
<span class='lineno'> 206</span>     result = waiter( my_predicate, SOME_TIMEOUT)
<span class='lineno'> 207</span>     assert result == expected_result
<span class='lineno'> 208</span>     &quot;&quot;&quot;
<span class='lineno'> 209</span> 
<span class='lineno'> 210</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory', title='? -> (?, int) -> None'>factory</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.settings', title='?'>settings</a>):
<span class='lineno'> 211</span>         <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.consumer', title='?'>consumer</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.session_ingest_consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.session_ingest_consumer', title='?'>session_ingest_consumer</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.settings', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.settings', title='?'>settings</a>)
<span class='lineno'> 212</span> 
<span class='lineno'> 213</span>         def <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter', title='(?, int) -> None'>waiter</a>(<a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.exit_predicate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.exit_predicate', title='?'>exit_predicate</a>, <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.max_time', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.max_time', title='int'>max_time</a>=<a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.MAX_SECONDS_WAITING_FOR_EVENT', title='int'>MAX_SECONDS_WAITING_FOR_EVENT</a>):
<span class='lineno'> 214</span>             &quot;&quot;&quot;
<span class='lineno'> 215</span>             Implements a wait loop for the ingest consumer
<span class='lineno'> 216</span>             :param exit_predicate:  A Callable[(),Any] that will be called in a loop after each call
<span class='lineno'> 217</span>                 to the KafkaConsumer _run_once()
<span class='lineno'> 218</span>             :param max_time: maximum time in seconds to wait
<span class='lineno'> 219</span>             :return: the first non None result returned by the exit predicate or None if the
<span class='lineno'> 220</span>                 max time has expired without the exit predicate returning a non None value
<span class='lineno'> 221</span>             &quot;&quot;&quot;
<span class='lineno'> 222</span> 
<span class='lineno'> 223</span>             <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', title='int'>start_wait</a> = time.time()
<span class='lineno'> 224</span>             with <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.task_runner', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.task_runner', title='?'>task_runner</a>():
<span class='lineno'> 225</span>                 while time.time() - <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', title='int'>start_wait</a> &lt; <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.max_time', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.max_time', title='int'>max_time</a>:
<span class='lineno'> 226</span>                     <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.consumer', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.consumer', title='?'>consumer</a>._run_once()  # noqa
<span class='lineno'> 227</span>                     # check if the condition is satisfied
<span class='lineno'> 228</span>                     <a name='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', title='?'>val</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.exit_predicate', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.exit_predicate', title='?'>exit_predicate</a>()
<span class='lineno'> 229</span>                     if <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', title='?'>val</a> is not None:
<span class='lineno'> 230</span>                         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.val', title='?'>val</a>  # we got what we were waiting for stop looping
<span class='lineno'> 231</span> 
<span class='lineno'> 232</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka._log', title='?'>_log</a>.warning(
<span class='lineno'> 233</span>                 &quot;Ingest consumer waiter timed-out after %d seconds&quot;, time.time() - <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter.start_wait', title='int'>start_wait</a>
<span class='lineno'> 234</span>             )
<span class='lineno'> 235</span>             return None  # timout without any success
<span class='lineno'> 236</span> 
<span class='lineno'> 237</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory.waiter', title='(?, int) -> None'>waiter</a>
<span class='lineno'> 238</span> 
<span class='lineno'> 239</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory', xid ='.home.xxm.Desktop.EMSE.dataset.sentry.src.sentry.utils.pytest.kafka.wait_for_ingest_consumer.factory', title='? -> (?, int) -> None'>factory</a>
</pre></td></tr></table></body></html>