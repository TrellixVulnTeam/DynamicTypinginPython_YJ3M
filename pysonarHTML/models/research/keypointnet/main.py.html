<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/research/keypointnet/main.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS'>FLAGS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw'>vw</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh'>vh</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn'>create_input_fn</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer'>Transformer</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix'>__get_matrix</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix'>__read_projection_matrix</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__'>__init__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project'>project</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject'>unproject</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid'>meshgrid</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation'>estimate_rotation</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss'>relative_pose_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss'>separation_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss'>consistency_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss'>variance_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn'>dilated_cnn</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network'>orientation_network</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network'>keypoint_network</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn'>model_fn</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict'>predict</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams'>_default_hparams</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main', xid='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main'>main</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2018 Google LLC
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     https://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # =============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;KeypointNet!!
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span> A reimplementation of &#39;Discovery of Latent 3D Keypoints via End-to-end
<span class='lineno'>  18</span> Geometric Reasoning&#39; keypoint network. Given a single 2D image of a known class,
<span class='lineno'>  19</span> this network can predict a set of 3D keypoints that are consistent across
<span class='lineno'>  20</span> viewing angles of the same object and across object instances. These keypoints
<span class='lineno'>  21</span> and their detectors are discovered and learned automatically without
<span class='lineno'>  22</span> keypoint location supervision.
<span class='lineno'>  23</span> &quot;&quot;&quot;
<span class='lineno'>  24</span> 
<span class='lineno'>  25</span> from __future__ import absolute_import
<span class='lineno'>  26</span> from __future__ import division
<span class='lineno'>  27</span> from __future__ import print_function
<span class='lineno'>  28</span> 
<span class='lineno'>  29</span> import math
<span class='lineno'>  30</span> import matplotlib.pyplot as plt
<span class='lineno'>  31</span> import numpy as np
<span class='lineno'>  32</span> import os
<span class='lineno'>  33</span> from scipy import misc
<span class='lineno'>  34</span> import sys
<span class='lineno'>  35</span> import tensorflow as tf
<span class='lineno'>  36</span> import tensorflow.contrib.slim as slim
<span class='lineno'>  37</span> import <a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', title='utils'>utils</a>
<span class='lineno'>  38</span> 
<span class='lineno'>  39</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a> = tf.app.flags.FLAGS
<span class='lineno'>  40</span> 
<span class='lineno'>  41</span> tf.app.flags.DEFINE_boolean(&quot;predict&quot;, False, &quot;Running inference if true&quot;)
<span class='lineno'>  42</span> tf.app.flags.DEFINE_string(
<span class='lineno'>  43</span>     &quot;input&quot;,
<span class='lineno'>  44</span>     &quot;&quot;,
<span class='lineno'>  45</span>     &quot;Input folder containing images&quot;)
<span class='lineno'>  46</span> tf.app.flags.DEFINE_string(&quot;model_dir&quot;, None, &quot;Estimator model_dir&quot;)
<span class='lineno'>  47</span> tf.app.flags.DEFINE_string(
<span class='lineno'>  48</span>     &quot;dset&quot;,
<span class='lineno'>  49</span>     &quot;&quot;,
<span class='lineno'>  50</span>     &quot;Path to the directory containing the dataset.&quot;)
<span class='lineno'>  51</span> tf.app.flags.DEFINE_integer(&quot;steps&quot;, 200000, &quot;Training steps&quot;)
<span class='lineno'>  52</span> tf.app.flags.DEFINE_integer(&quot;batch_size&quot;, 8, &quot;Size of mini-batch.&quot;)
<span class='lineno'>  53</span> tf.app.flags.DEFINE_string(
<span class='lineno'>  54</span>     &quot;hparams&quot;, &quot;&quot;,
<span class='lineno'>  55</span>     &quot;A comma-separated list of `name=value` hyperparameter values. This flag &quot;
<span class='lineno'>  56</span>     &quot;is used to override hyperparameter settings either when manually &quot;
<span class='lineno'>  57</span>     &quot;selecting hyperparameters or when using Vizier.&quot;)
<span class='lineno'>  58</span> tf.app.flags.DEFINE_integer(
<span class='lineno'>  59</span>     &quot;sync_replicas&quot;, -1,
<span class='lineno'>  60</span>     &quot;If &gt; 0, use SyncReplicasOptimizer and use this many replicas per sync.&quot;)
<span class='lineno'>  61</span> 
<span class='lineno'>  62</span> # Fixed input size 128 x 128.
<span class='lineno'>  63</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a></a> = 128
<span class='lineno'>  64</span> 
<span class='lineno'>  65</span> 
<span class='lineno'>  66</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn', title='(?, ?) -> ? -> ? / (str, ?) -> () -> (?, None)'>create_input_fn</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', title='str'>split</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.batch_size', title='?'>batch_size</a>):
<span class='lineno'>  67</span>   &quot;&quot;&quot;Returns input_fn for tf.estimator.Estimator.
<span class='lineno'>  68</span> 
<span class='lineno'>  69</span>   Reads tfrecords and construts input_fn for either training or eval. All
<span class='lineno'>  70</span>   tfrecords not in test.txt or dev.txt will be assigned to training set.
<span class='lineno'>  71</span> 
<span class='lineno'>  72</span>   Args:
<span class='lineno'>  73</span>     split: A string indicating the split. Can be either &#39;train&#39; or &#39;validation&#39;.
<span class='lineno'>  74</span>     batch_size: The batch size!
<span class='lineno'>  75</span> 
<span class='lineno'>  76</span>   Returns:
<span class='lineno'>  77</span>     input_fn for tf.estimator.Estimator.
<span class='lineno'>  78</span> 
<span class='lineno'>  79</span>   Raises:
<span class='lineno'>  80</span>     IOError: If test.txt or dev.txt are not found.
<span class='lineno'>  81</span>   &quot;&quot;&quot;
<span class='lineno'>  82</span> 
<span class='lineno'>  83</span>   if (not os.path.exists(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset, &quot;test.txt&quot;)) or
<span class='lineno'>  84</span>       not os.path.exists(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset, &quot;dev.txt&quot;))):
<span class='lineno'>  85</span>     raise IOError(&quot;test.txt or dev.txt not found&quot;)
<span class='lineno'>  86</span> 
<span class='lineno'>  87</span>   with open(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset, &quot;test.txt&quot;), &quot;r&quot;) as <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='file'>f</a>:
<span class='lineno'>  88</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.testset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.testset', title='[str]'>testset</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'>x</a>.strip() for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'>x</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='file'>f</a>.readlines()]
<span class='lineno'>  89</span> 
<span class='lineno'>  90</span>   with open(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset, &quot;dev.txt&quot;), &quot;r&quot;) as <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='file'>f</a>:
<span class='lineno'>  91</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', title='[str]'>validset</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'>x</a>.strip() for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.x', title='str'>x</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='file'>f</a>.readlines()]
<span class='lineno'>  92</span> 
<span class='lineno'>  93</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.files', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.files', title='[str]'>files</a> = os.listdir(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset)
<span class='lineno'>  94</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', title='[str]'>filenames</a> = []
<span class='lineno'>  95</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='str'>f</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.files', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.files', title='[str]'>files</a>:
<span class='lineno'>  96</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', title='(str, str)'>sp</a> = os.path.splitext(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='str'>f</a>)
<span class='lineno'>  97</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', title='(str, str)'>sp</a>[1] != &quot;.tfrecord&quot; or <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', title='(str, str)'>sp</a>[0] in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.testset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.testset', title='[str]'>testset</a>:
<span class='lineno'>  98</span>       continue
<span class='lineno'>  99</span> 
<span class='lineno'> 100</span>     if ((<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', title='str'>split</a> == &quot;validation&quot; and <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', title='(str, str)'>sp</a>[0] in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', title='[str]'>validset</a>) or
<span class='lineno'> 101</span>         (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.split', title='str'>split</a> == &quot;train&quot; and <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.sp', title='(str, str)'>sp</a>[0] not in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.validset', title='[str]'>validset</a>)):
<span class='lineno'> 102</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', title='[str]'>filenames</a>.append(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.f', title='str'>f</a>))
<span class='lineno'> 103</span> 
<span class='lineno'> 104</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn', title='() -> (?, None)'>input_fn</a>():
<span class='lineno'> 105</span>     &quot;&quot;&quot;input_fn for tf.estimator.Estimator.&quot;&quot;&quot;
<span class='lineno'> 106</span> 
<span class='lineno'> 107</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser', title='? -> None'>parser</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.serialized_example', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.serialized_example', title='?'>serialized_example</a>):
<span class='lineno'> 108</span>       &quot;&quot;&quot;Parses a single tf.Example into image and label tensors.&quot;&quot;&quot;
<span class='lineno'> 109</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a> = tf.parse_single_example(
<span class='lineno'> 110</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.serialized_example', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.serialized_example', title='?'>serialized_example</a>,
<span class='lineno'> 111</span>           features={
<span class='lineno'> 112</span>               &quot;img0&quot;: tf.FixedLenFeature([], tf.string),
<span class='lineno'> 113</span>               &quot;img1&quot;: tf.FixedLenFeature([], tf.string),
<span class='lineno'> 114</span>               &quot;mv0&quot;: tf.FixedLenFeature([16], tf.float32),
<span class='lineno'> 115</span>               &quot;mvi0&quot;: tf.FixedLenFeature([16], tf.float32),
<span class='lineno'> 116</span>               &quot;mv1&quot;: tf.FixedLenFeature([16], tf.float32),
<span class='lineno'> 117</span>               &quot;mvi1&quot;: tf.FixedLenFeature([16], tf.float32),
<span class='lineno'> 118</span>           })
<span class='lineno'> 119</span> 
<span class='lineno'> 120</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img0&quot;] = tf.div(tf.to_float(tf.image.decode_png(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img0&quot;], 4)), 255)
<span class='lineno'> 121</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img1&quot;] = tf.div(tf.to_float(tf.image.decode_png(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img1&quot;], 4)), 255)
<span class='lineno'> 122</span> 
<span class='lineno'> 123</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img0&quot;].set_shape([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>, 4])
<span class='lineno'> 124</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;img1&quot;].set_shape([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>, 4])
<span class='lineno'> 125</span> 
<span class='lineno'> 126</span>       # fs[&quot;lr0&quot;] = [fs[&quot;mv0&quot;][0]]
<span class='lineno'> 127</span>       # fs[&quot;lr1&quot;] = [fs[&quot;mv1&quot;][0]]
<span class='lineno'> 128</span> 
<span class='lineno'> 129</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;lr0&quot;] = tf.convert_to_tensor([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;mv0&quot;][0]])
<span class='lineno'> 130</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;lr1&quot;] = tf.convert_to_tensor([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>[&quot;mv1&quot;][0]])
<span class='lineno'> 131</span> 
<span class='lineno'> 132</span>       return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser.fs', title='?'>fs</a>
<span class='lineno'> 133</span> 
<span class='lineno'> 134</span>     np.random.shuffle(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', title='[str]'>filenames</a>)
<span class='lineno'> 135</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a> = tf.data.TFRecordDataset(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.filenames', title='[str]'>filenames</a>)
<span class='lineno'> 136</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a>.map(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.parser', title='? -> None'>parser</a>, num_parallel_calls=4)
<span class='lineno'> 137</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a>.shuffle(400).repeat().batch(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.batch_size', title='?'>batch_size</a>)
<span class='lineno'> 138</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a>.prefetch(buffer_size=256)
<span class='lineno'> 139</span> 
<span class='lineno'> 140</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn.dataset', title='?'>dataset</a>.make_one_shot_iterator().get_next(), None
<span class='lineno'> 141</span> 
<span class='lineno'> 142</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn.input_fn', title='() -> (?, None)'>input_fn</a>
<span class='lineno'> 143</span> 
<span class='lineno'> 144</span> 
<span class='lineno'> 145</span> class <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer', title='<Transformer>'>Transformer</a>(object):
<span class='lineno'> 146</span>   &quot;&quot;&quot;A utility for projecting 3D points to 2D coordinates and vice versa.
<span class='lineno'> 147</span> 
<span class='lineno'> 148</span>   3D points are represented in 4D-homogeneous world coordinates. The pixel
<span class='lineno'> 149</span>   coordinates are represented in normalized device coordinates [-1, 1].
<span class='lineno'> 150</span>   See https://learnopengl.com/Getting-started/Coordinate-Systems.
<span class='lineno'> 151</span>   &quot;&quot;&quot;
<span class='lineno'> 152</span> 
<span class='lineno'> 153</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix', title='(Transformer, ?) -> ? / (Transformer, [str]) -> ?'>__get_matrix</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.self', title='Transformer'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.lines', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.lines', title='[str]'>lines</a>):
<span class='lineno'> 154</span>     return np.array([[float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', title='str'>y</a>) for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', title='str'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.y', title='str'>y</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', title='str'>x</a>.strip().split(&quot; &quot;)] for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', title='str'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.x', title='str'>x</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.lines', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix.lines', title='[str]'>lines</a>])
<span class='lineno'> 155</span> 
<span class='lineno'> 156</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix', title='(Transformer, ?) -> None / (Transformer, str) -> None'>__read_projection_matrix</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.self', title='Transformer'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', title='str'>filename</a>):
<span class='lineno'> 157</span>     if not os.path.exists(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', title='str'>filename</a>):
<span class='lineno'> 158</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', title='str'>filename</a> = &quot;/cns/vz-d/home/supasorn/datasets/cars/projection.txt&quot;
<span class='lineno'> 159</span>     with open(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.filename', title='str'>filename</a>, &quot;r&quot;) as <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.f', title='file'>f</a>:
<span class='lineno'> 160</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.lines', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.lines', title='[str]'>lines</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.f', title='file'>f</a>.readlines()
<span class='lineno'> 161</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__get_matrix', title='(Transformer, ?) -> ? / (Transformer, [str]) -> ?'>__get_matrix</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.lines', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix.lines', title='[str]'>lines</a>)
<span class='lineno'> 162</span> 
<span class='lineno'> 163</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__', title='? -> ?'>__init__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.w', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.w', title='int'>w</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.h', title='int'>h</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.dataset_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.dataset_dir', title='?'>dataset_dir</a>):
<span class='lineno'> 164</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.w', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.w', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.w', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.w', title='int'>w</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.w', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.w', title='int'>w</a>
<span class='lineno'> 165</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.h', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.h', title='int'>h</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.h', title='int'>h</a>
<span class='lineno'> 166</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', title='None'>p</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__read_projection_matrix', title='(Transformer, ?) -> None / (Transformer, str) -> None'>__read_projection_matrix</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.dataset_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.dataset_dir', title='?'>dataset_dir</a> + &quot;projection.txt&quot;)
<span class='lineno'> 167</span> 
<span class='lineno'> 168</span>     # transposed of inversed projection matrix.
<span class='lineno'> 169</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', title='?'>pinv_t</a></a> = tf.constant([[1.0 / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', title='None'>p</a>[0, 0], 0, 0,
<span class='lineno'> 170</span>                                 0], [0, 1.0 / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', title='None'>p</a>[1, 1], 0, 0], [0, 0, 1, 0],
<span class='lineno'> 171</span>                                [0, 0, 0, 1]])
<span class='lineno'> 172</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', title='?'>f</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.__init__.p', title='None'>p</a>[0, 0]
<span class='lineno'> 173</span> 
<span class='lineno'> 174</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', title='(Transformer, ?) -> None'>project</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.self', title='Transformer'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', title='?'>xyzw</a>):
<span class='lineno'> 175</span>     &quot;&quot;&quot;Projects homogeneous 3D coordinates to normalized device coordinates.&quot;&quot;&quot;
<span class='lineno'> 176</span> 
<span class='lineno'> 177</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', title='float'>z</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', title='?'>xyzw</a>[:, :, 2:3] + 1e-8
<span class='lineno'> 178</span>     return tf.concat([-<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.f', title='?'>f</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.xyzw', title='?'>xyzw</a>[:, :, :2] / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', title='float'>z</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project.z', title='float'>z</a>], axis=2)
<span class='lineno'> 179</span> 
<span class='lineno'> 180</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', title='(Transformer, ?) -> None'>unproject</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.self', title='Transformer'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', title='?'>xyz</a>):
<span class='lineno'> 181</span>     &quot;&quot;&quot;Unprojects normalized device coordinates with depth to 3D coordinates.&quot;&quot;&quot;
<span class='lineno'> 182</span> 
<span class='lineno'> 183</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', title='?'>z</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', title='?'>xyz</a>[:, :, 2:]
<span class='lineno'> 184</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xy', title='?'>xy</a> = -<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xyz', title='?'>xyz</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', title='?'>z</a>
<span class='lineno'> 185</span> 
<span class='lineno'> 186</span>     def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul', title='(?, ?) -> ?'>batch_matmul</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', title='?'>a</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.b', title='?'>b</a>):
<span class='lineno'> 187</span>       return tf.reshape(
<span class='lineno'> 188</span>           tf.matmul(tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', title='?'>a</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', title='?'>a</a>.shape[2].value]), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.b', title='?'>b</a>),
<span class='lineno'> 189</span>           [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', title='?'>a</a>.shape[1].value, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul.a', title='?'>a</a>.shape[2].value])
<span class='lineno'> 190</span> 
<span class='lineno'> 191</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.batch_matmul', title='(?, ?) -> ?'>batch_matmul</a>(
<span class='lineno'> 192</span>         tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.xy', title='?'>xy</a>[:, :, :2], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', title='?'>z</a>, tf.ones_like(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.z', title='?'>z</a>)], axis=2), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject.self', title='Transformer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.pinv_t', title='?'>pinv_t</a>)
<span class='lineno'> 193</span> 
<span class='lineno'> 194</span> 
<span class='lineno'> 195</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', title='? -> (?, ?) / int -> (?, ?)'>meshgrid</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', title='int'>h</a>):
<span class='lineno'> 196</span>   &quot;&quot;&quot;Returns a meshgrid ranging from [-1, 1] in x, y axes.&quot;&quot;&quot;
<span class='lineno'> 197</span> 
<span class='lineno'> 198</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', title='int'>r</a> = np.arange(0.5, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', title='int'>h</a>, 1) / (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.h', title='int'>h</a> / 2) - 1
<span class='lineno'> 199</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.ranx', title='?'>ranx</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.rany', title='?'>rany</a> = tf.meshgrid(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', title='int'>r</a>, -<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.r', title='int'>r</a>)
<span class='lineno'> 200</span>   return tf.to_float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.ranx', title='?'>ranx</a>), tf.to_float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid.rany', title='?'>rany</a>)
<span class='lineno'> 201</span> 
<span class='lineno'> 202</span> 
<span class='lineno'> 203</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation', title='(?, ?, ?, ?) -> None'>estimate_rotation</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'>xyz0</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'>xyz1</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', title='?'>pconf</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', title='?'>noise</a>):
<span class='lineno'> 204</span>   &quot;&quot;&quot;Estimates the rotation between two sets of keypoints.
<span class='lineno'> 205</span> 
<span class='lineno'> 206</span>   The rotation is estimated by first subtracting mean from each set of keypoints
<span class='lineno'> 207</span>   and computing SVD of the covariance matrix.
<span class='lineno'> 208</span> 
<span class='lineno'> 209</span>   Args:
<span class='lineno'> 210</span>     xyz0: [batch, num_kp, 3] The first set of keypoints.
<span class='lineno'> 211</span>     xyz1: [batch, num_kp, 3] The second set of keypoints.
<span class='lineno'> 212</span>     pconf: [batch, num_kp] The weights used to compute the rotation estimate.
<span class='lineno'> 213</span>     noise: A number indicating the noise added to the keypoints.
<span class='lineno'> 214</span> 
<span class='lineno'> 215</span>   Returns:
<span class='lineno'> 216</span>     [batch, 3, 3] A batch of transposed 3 x 3 rotation matrices.
<span class='lineno'> 217</span>   &quot;&quot;&quot;
<span class='lineno'> 218</span> 
<span class='lineno'> 219</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'>xyz0</a></a> += tf.random_normal(tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'>xyz0</a>), mean=0, stddev=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', title='?'>noise</a>)
<span class='lineno'> 220</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'>xyz1</a></a> += tf.random_normal(tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'>xyz1</a>), mean=0, stddev=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.noise', title='?'>noise</a>)
<span class='lineno'> 221</span> 
<span class='lineno'> 222</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', title='?'>pconf2</a> = tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', title='?'>pconf</a>, 2)
<span class='lineno'> 223</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen0', title='?'>cen0</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'>xyz0</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', title='?'>pconf2</a>, 1, keepdims=True)
<span class='lineno'> 224</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen1', title='?'>cen1</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'>xyz1</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf2', title='?'>pconf2</a>, 1, keepdims=True)
<span class='lineno'> 225</span> 
<span class='lineno'> 226</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.x', title='?'>x</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz0', title='?'>xyz0</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen0', title='?'>cen0</a>
<span class='lineno'> 227</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.y', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.y', title='?'>y</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.xyz1', title='?'>xyz1</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cen1', title='?'>cen1</a>
<span class='lineno'> 228</span> 
<span class='lineno'> 229</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cov', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cov', title='?'>cov</a> = tf.matmul(tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.x', title='?'>x</a>, tf.matrix_diag(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.pconf', title='?'>pconf</a>), transpose_a=True), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.y', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.y', title='?'>y</a>)
<span class='lineno'> 230</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation._', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation._', title='?'>_</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', title='?'>u</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', title='?'>v</a> = tf.svd(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cov', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.cov', title='?'>cov</a>, full_matrices=True)
<span class='lineno'> 231</span> 
<span class='lineno'> 232</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.d', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.d', title='?'>d</a> = tf.matrix_determinant(tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', title='?'>v</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', title='?'>u</a>, transpose_b=True))
<span class='lineno'> 233</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.ud', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.ud', title='?'>ud</a> = tf.concat(
<span class='lineno'> 234</span>       [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', title='?'>u</a>[:, :, :-1], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.u', title='?'>u</a>[:, :, -1:] * tf.expand_dims(tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.d', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.d', title='?'>d</a>, 1), 1)],
<span class='lineno'> 235</span>       axis=2)
<span class='lineno'> 236</span>   return tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.ud', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.ud', title='?'>ud</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation.v', title='?'>v</a>, transpose_b=True)
<span class='lineno'> 237</span> 
<span class='lineno'> 238</span> 
<span class='lineno'> 239</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss', title='(?, ?, ?, ?, ?) -> (?, float)'>relative_pose_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz0', title='?'>xyz0</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz1', title='?'>xyz1</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rot', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rot', title='?'>rot</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.pconf', title='?'>pconf</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.noise', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.noise', title='?'>noise</a>):
<span class='lineno'> 240</span>   &quot;&quot;&quot;Computes the relative pose loss (chordal, angular).
<span class='lineno'> 241</span> 
<span class='lineno'> 242</span>   Args:
<span class='lineno'> 243</span>     xyz0: [batch, num_kp, 3] The first set of keypoints.
<span class='lineno'> 244</span>     xyz1: [batch, num_kp, 3] The second set of keypoints.
<span class='lineno'> 245</span>     rot: [batch, 4, 4] The ground-truth rotation matrices.
<span class='lineno'> 246</span>     pconf: [batch, num_kp] The weights used to compute the rotation estimate.
<span class='lineno'> 247</span>     noise: A number indicating the noise added to the keypoints.
<span class='lineno'> 248</span> 
<span class='lineno'> 249</span>   Returns:
<span class='lineno'> 250</span>     A tuple (chordal loss, angular loss).
<span class='lineno'> 251</span>   &quot;&quot;&quot;
<span class='lineno'> 252</span> 
<span class='lineno'> 253</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.r_transposed', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.r_transposed', title='None'>r_transposed</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.estimate_rotation', title='(?, ?, ?, ?) -> None'>estimate_rotation</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz0', title='?'>xyz0</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.xyz1', title='?'>xyz1</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.pconf', title='?'>pconf</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.noise', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.noise', title='?'>noise</a>)
<span class='lineno'> 254</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rotation', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rotation', title='?'>rotation</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rot', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rot', title='?'>rot</a>[:, :3, :3]
<span class='lineno'> 255</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', title='?'>frob_sqr</a> = tf.reduce_sum(tf.square(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.r_transposed', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.r_transposed', title='None'>r_transposed</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rotation', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.rotation', title='?'>rotation</a>), axis=[1, 2])
<span class='lineno'> 256</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob', title='?'>frob</a> = tf.sqrt(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', title='?'>frob_sqr</a>)
<span class='lineno'> 257</span> 
<span class='lineno'> 258</span>   return tf.reduce_mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob_sqr', title='?'>frob_sqr</a>), \
<span class='lineno'> 259</span>       2.0 * tf.reduce_mean(tf.asin(tf.minimum(1.0, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss.frob', title='?'>frob</a> / (2 * math.sqrt(2)))))
<span class='lineno'> 260</span> 
<span class='lineno'> 261</span> 
<span class='lineno'> 262</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss', title='(?, ?) -> None'>separation_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', title='?'>xyz</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.delta', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.delta', title='?'>delta</a>):
<span class='lineno'> 263</span>   &quot;&quot;&quot;Computes the separation loss.
<span class='lineno'> 264</span> 
<span class='lineno'> 265</span>   Args:
<span class='lineno'> 266</span>     xyz: [batch, num_kp, 3] Input keypoints.
<span class='lineno'> 267</span>     delta: A separation threshold. Incur 0 cost if the distance &gt;= delta.
<span class='lineno'> 268</span> 
<span class='lineno'> 269</span>   Returns:
<span class='lineno'> 270</span>     The seperation loss.
<span class='lineno'> 271</span>   &quot;&quot;&quot;
<span class='lineno'> 272</span> 
<span class='lineno'> 273</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', title='?'>num_kp</a> = tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', title='?'>xyz</a>)[1]
<span class='lineno'> 274</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', title='?'>t1</a> = tf.tile(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', title='?'>xyz</a>, [1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', title='?'>num_kp</a>, 1])
<span class='lineno'> 275</span> 
<span class='lineno'> 276</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t2', title='?'>t2</a> = tf.reshape(tf.tile(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.xyz', title='?'>xyz</a>, [1, 1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', title='?'>num_kp</a>]), tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', title='?'>t1</a>))
<span class='lineno'> 277</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.diffsq', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.diffsq', title='?'>diffsq</a> = tf.square(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t1', title='?'>t1</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.t2', title='?'>t2</a>)
<span class='lineno'> 278</span> 
<span class='lineno'> 279</span>   # -&gt; [batch, num_kp ^ 2]
<span class='lineno'> 280</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.lensqr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.lensqr', title='?'>lensqr</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.diffsq', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.diffsq', title='?'>diffsq</a>, axis=2)
<span class='lineno'> 281</span> 
<span class='lineno'> 282</span>   return (tf.reduce_sum(tf.maximum(-<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.lensqr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.lensqr', title='?'>lensqr</a> + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.delta', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.delta', title='?'>delta</a>, 0.0)) / tf.to_float(
<span class='lineno'> 283</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss.num_kp', title='?'>num_kp</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.batch_size * 2))
<span class='lineno'> 284</span> 
<span class='lineno'> 285</span> 
<span class='lineno'> 286</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss', title='(?, ?, ?) -> None'>consistency_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv0', title='?'>uv0</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv1', title='?'>uv1</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.pconf', title='?'>pconf</a>):
<span class='lineno'> 287</span>   &quot;&quot;&quot;Computes multi-view consistency loss between two sets of keypoints.
<span class='lineno'> 288</span> 
<span class='lineno'> 289</span>   Args:
<span class='lineno'> 290</span>     uv0: [batch, num_kp, 2] The first set of keypoint 2D coordinates.
<span class='lineno'> 291</span>     uv1: [batch, num_kp, 2] The second set of keypoint 2D coordinates.
<span class='lineno'> 292</span>     pconf: [batch, num_kp] The weights used to compute the rotation estimate.
<span class='lineno'> 293</span> 
<span class='lineno'> 294</span>   Returns:
<span class='lineno'> 295</span>     The consistency loss.
<span class='lineno'> 296</span>   &quot;&quot;&quot;
<span class='lineno'> 297</span> 
<span class='lineno'> 298</span>   # [batch, num_kp, 2]
<span class='lineno'> 299</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', title='?'>wd</a> = tf.square(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv0', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv0', title='?'>uv0</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.uv1', title='?'>uv1</a>) * tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.pconf', title='?'>pconf</a>, 2)
<span class='lineno'> 300</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', title='?'>wd</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', title='?'>wd</a>, axis=[1, 2])
<span class='lineno'> 301</span>   return tf.reduce_mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss.wd', title='?'>wd</a>)
<span class='lineno'> 302</span> 
<span class='lineno'> 303</span> 
<span class='lineno'> 304</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss', title='(?, ?, ?, ?) -> None'>variance_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.probmap', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.probmap', title='?'>probmap</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ranx', title='?'>ranx</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.rany', title='?'>rany</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', title='?'>uv</a>):
<span class='lineno'> 305</span>   &quot;&quot;&quot;Computes the variance loss as part of Sillhouette consistency.
<span class='lineno'> 306</span> 
<span class='lineno'> 307</span>   Args:
<span class='lineno'> 308</span>     probmap: [batch, num_kp, h, w] The distribution map of keypoint locations.
<span class='lineno'> 309</span>     ranx: X-axis meshgrid.
<span class='lineno'> 310</span>     rany: Y-axis meshgrid.
<span class='lineno'> 311</span>     uv: [batch, num_kp, 2] Keypoint locations (in NDC).
<span class='lineno'> 312</span> 
<span class='lineno'> 313</span>   Returns:
<span class='lineno'> 314</span>     The variance loss.
<span class='lineno'> 315</span>   &quot;&quot;&quot;
<span class='lineno'> 316</span> 
<span class='lineno'> 317</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', title='?'>ran</a> = tf.stack([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ranx', title='?'>ranx</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.rany', title='?'>rany</a>], axis=2)
<span class='lineno'> 318</span> 
<span class='lineno'> 319</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a> = tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', title='?'>ran</a>)
<span class='lineno'> 320</span>   # [batch, num_kp, vh, vw, 2]
<span class='lineno'> 321</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', title='?'>ran</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', title='?'>ran</a>, [1, 1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a>[1], 2])
<span class='lineno'> 322</span> 
<span class='lineno'> 323</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a> = tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', title='?'>uv</a>)
<span class='lineno'> 324</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', title='?'>uv</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', title='?'>uv</a>, [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.sh', title='?'>sh</a>[1], 1, 1, 2])
<span class='lineno'> 325</span> 
<span class='lineno'> 326</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', title='?'>diff</a> = tf.reduce_sum(tf.square(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.uv', title='?'>uv</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.ran', title='?'>ran</a>), axis=4)
<span class='lineno'> 327</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', title='?'>diff</a></a> *= <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.probmap', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.probmap', title='?'>probmap</a>
<span class='lineno'> 328</span> 
<span class='lineno'> 329</span>   return tf.reduce_mean(tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss.diff', title='?'>diff</a>, axis=[2, 3]))
<span class='lineno'> 330</span> 
<span class='lineno'> 331</span> 
<span class='lineno'> 332</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', title='(?, float, ?) -> None / (?, float, bool) -> None / (?, ?, ?) -> None / (?, ?, bool) -> None'>dilated_cnn</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.images', title='?'>images</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.num_filters', title='float'>num_filters</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.is_training', title='bool'>is_training</a>):
<span class='lineno'> 333</span>   &quot;&quot;&quot;Constructs a base dilated convolutional network.
<span class='lineno'> 334</span> 
<span class='lineno'> 335</span>   Args:
<span class='lineno'> 336</span>     images: [batch, h, w, 3] Input RGB images.
<span class='lineno'> 337</span>     num_filters: The number of filters for all layers.
<span class='lineno'> 338</span>     is_training: True if this function is called during training.
<span class='lineno'> 339</span> 
<span class='lineno'> 340</span>   Returns:
<span class='lineno'> 341</span>     Output of this dilated CNN.
<span class='lineno'> 342</span>   &quot;&quot;&quot;
<span class='lineno'> 343</span> 
<span class='lineno'> 344</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', title='?'>net</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.images', title='?'>images</a>
<span class='lineno'> 345</span> 
<span class='lineno'> 346</span>   with slim.arg_scope(
<span class='lineno'> 347</span>       [slim.conv2d, slim.fully_connected],
<span class='lineno'> 348</span>       normalizer_fn=slim.batch_norm,
<span class='lineno'> 349</span>       activation_fn=lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.lambda%202.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.lambda%202.x', title='?'>x</a>: tf.nn.leaky_relu(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.lambda%202.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.lambda%202.x', title='?'>x</a>, alpha=0.1),
<span class='lineno'> 350</span>       normalizer_params={&quot;is_training&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.is_training', title='bool'>is_training</a>}):
<span class='lineno'> 351</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.i', title='?'>i</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.r', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.r', title='?'>r</a> in enumerate([1, 1, 2, 4, 8, 16, 1, 2, 4, 8, 16, 1]):
<span class='lineno'> 352</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', title='?'>net</a> = slim.conv2d(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', title='?'>net</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.num_filters', title='float'>num_filters</a>, [3, 3], rate=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.r', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.r', title='?'>r</a>, scope=&quot;dconv%d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.i', title='?'>i</a>)
<span class='lineno'> 353</span> 
<span class='lineno'> 354</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn.net', title='?'>net</a>
<span class='lineno'> 355</span> 
<span class='lineno'> 356</span> 
<span class='lineno'> 357</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network', title='(?, float, ?) -> None / (?, ?, ?) -> None / (?, float, bool) -> None'>orientation_network</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.images', title='?'>images</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.num_filters', title='float'>num_filters</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.is_training', title='bool'>is_training</a>):
<span class='lineno'> 358</span>   &quot;&quot;&quot;Constructs a network that infers the orientation of an object.
<span class='lineno'> 359</span> 
<span class='lineno'> 360</span>   Args:
<span class='lineno'> 361</span>     images: [batch, h, w, 3] Input RGB images.
<span class='lineno'> 362</span>     num_filters: The number of filters for all layers.
<span class='lineno'> 363</span>     is_training: True if this function is called during training.
<span class='lineno'> 364</span> 
<span class='lineno'> 365</span>   Returns:
<span class='lineno'> 366</span>     Output of the orientation network.
<span class='lineno'> 367</span>   &quot;&quot;&quot;
<span class='lineno'> 368</span> 
<span class='lineno'> 369</span>   with tf.variable_scope(&quot;OrientationNetwork&quot;):
<span class='lineno'> 370</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.net', title='None'>net</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', title='(?, float, ?) -> None / (?, float, bool) -> None / (?, ?, ?) -> None / (?, ?, bool) -> None'>dilated_cnn</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.images', title='?'>images</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.num_filters', title='float'>num_filters</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.is_training', title='bool'>is_training</a>)
<span class='lineno'> 371</span> 
<span class='lineno'> 372</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', title='int'>modules</a> = 2
<span class='lineno'> 373</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> = slim.conv2d(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.net', title='None'>net</a>, 2, [3, 3], rate=1, activation_fn=None)
<span class='lineno'> 374</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a>, [0, 3, 1, 2])
<span class='lineno'> 375</span> 
<span class='lineno'> 376</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', title='int'>modules</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>])
<span class='lineno'> 377</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> = tf.nn.softmax(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a>)
<span class='lineno'> 378</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.ranx', title='?'>ranx</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.rany', title='?'>rany</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', title='? -> (?, ?) / int -> (?, ?)'>meshgrid</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>)
<span class='lineno'> 379</span> 
<span class='lineno'> 380</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a>, [-1, 2, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>])
<span class='lineno'> 381</span> 
<span class='lineno'> 382</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sx', title='?'>sx</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.ranx', title='?'>ranx</a>, axis=[2, 3])
<span class='lineno'> 383</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sy', title='?'>sy</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.prob', title='?'>prob</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.rany', title='?'>rany</a>, axis=[2, 3])  # -&gt; batch x modules
<span class='lineno'> 384</span> 
<span class='lineno'> 385</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.out_xy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.out_xy', title='?'>out_xy</a> = tf.reshape(tf.stack([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sx', title='?'>sx</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.sy', title='?'>sy</a>], -1), [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.modules', title='int'>modules</a>, 2])
<span class='lineno'> 386</span> 
<span class='lineno'> 387</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.out_xy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network.out_xy', title='?'>out_xy</a>
<span class='lineno'> 388</span> 
<span class='lineno'> 389</span> 
<span class='lineno'> 390</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', title='(?, ?, ?, ?, None, int) -> (?, ?, None, ?, None, ?, [?]) / (?, ?, ?, bool, None, int) -> (?, ?, None, ?, None, ?, [?])'>keypoint_network</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', title='?'>rgba</a>,
<span class='lineno'> 391</span>                      <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', title='?'>num_filters</a>,
<span class='lineno'> 392</span>                      <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>,
<span class='lineno'> 393</span>                      <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', title='bool'>is_training</a>,
<span class='lineno'> 394</span>                      <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', title='None'>lr_gt</a>=None,
<span class='lineno'> 395</span>                      <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', title='int'>anneal</a>=1):
<span class='lineno'> 396</span>   &quot;&quot;&quot;Constructs our main keypoint network that predicts 3D keypoints.
<span class='lineno'> 397</span> 
<span class='lineno'> 398</span>   Args:
<span class='lineno'> 399</span>     rgba: [batch, h, w, 4] Input RGB images with alpha channel.
<span class='lineno'> 400</span>     num_filters: The number of filters for all layers.
<span class='lineno'> 401</span>     num_kp: The number of keypoints.
<span class='lineno'> 402</span>     is_training: True if this function is called during training.
<span class='lineno'> 403</span>     lr_gt: The groundtruth orientation flag used at the beginning of training.
<span class='lineno'> 404</span>         Then we linearly anneal in the prediction.
<span class='lineno'> 405</span>     anneal: A number between [0, 1] where 1 means using the ground-truth
<span class='lineno'> 406</span>         orientation and 0 means using our estimate.
<span class='lineno'> 407</span> 
<span class='lineno'> 408</span>   Returns:
<span class='lineno'> 409</span>     uv: [batch, num_kp, 2] 2D locations of keypoints.
<span class='lineno'> 410</span>     z: [batch, num_kp] The depth of keypoints.
<span class='lineno'> 411</span>     orient: [batch, 2, 2] Two 2D coordinates that correspond to [1, 0, 0] and
<span class='lineno'> 412</span>         [-1, 0, 0] in object space.
<span class='lineno'> 413</span>     sill: The Sillhouette loss.
<span class='lineno'> 414</span>     variance: The variance loss.
<span class='lineno'> 415</span>     prob_viz: A visualization of all predicted keypoints.
<span class='lineno'> 416</span>     prob_vizs: A list of visualizations of each keypoint.
<span class='lineno'> 417</span> 
<span class='lineno'> 418</span>   &quot;&quot;&quot;
<span class='lineno'> 419</span> 
<span class='lineno'> 420</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', title='?'>rgba</a>[:, :, :, :3]
<span class='lineno'> 421</span> 
<span class='lineno'> 422</span>   # [batch, 1]
<span class='lineno'> 423</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', title='None'>orient</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.orientation_network', title='(?, float, ?) -> None / (?, ?, ?) -> None / (?, float, bool) -> None'>orientation_network</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', title='?'>num_filters</a> * 0.5, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', title='bool'>is_training</a>)
<span class='lineno'> 424</span> 
<span class='lineno'> 425</span>   # [batch, 1]
<span class='lineno'> 426</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', title='?'>lr_estimated</a> = tf.maximum(0.0, tf.sign(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', title='None'>orient</a>[:, 0, :1] - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', title='None'>orient</a>[:, 1, :1]))
<span class='lineno'> 427</span> 
<span class='lineno'> 428</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', title='None'>lr_gt</a> is None:
<span class='lineno'> 429</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', title='?'>lr</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', title='?'>lr_estimated</a>
<span class='lineno'> 430</span>   else:
<span class='lineno'> 431</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', title='?'>lr_gt</a> = tf.maximum(0.0, tf.sign(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', title='None'>lr_gt</a>[:, :1]))
<span class='lineno'> 432</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', title='?'>lr</a> = tf.round(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_gt', title='?'>lr_gt</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', title='int'>anneal</a> + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr_estimated', title='?'>lr_estimated</a> * (1 - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.anneal', title='int'>anneal</a>))
<span class='lineno'> 433</span> 
<span class='lineno'> 434</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lrtiled', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lrtiled', title='?'>lrtiled</a> = tf.tile(
<span class='lineno'> 435</span>       tf.expand_dims(tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lr', title='?'>lr</a>, 1), 1),
<span class='lineno'> 436</span>       [1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a>.shape[1], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a>.shape[2], 1])
<span class='lineno'> 437</span> 
<span class='lineno'> 438</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lrtiled', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.lrtiled', title='?'>lrtiled</a>], axis=3)
<span class='lineno'> 439</span> 
<span class='lineno'> 440</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', title='?'>mask</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rgba', title='?'>rgba</a>[:, :, :, 3]
<span class='lineno'> 441</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', title='?'>mask</a> = tf.cast(tf.greater(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', title='?'>mask</a>, tf.zeros_like(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', title='?'>mask</a>)), dtype=tf.float32)
<span class='lineno'> 442</span> 
<span class='lineno'> 443</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', title='None'>net</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.dilated_cnn', title='(?, float, ?) -> None / (?, float, bool) -> None / (?, ?, ?) -> None / (?, ?, bool) -> None'>dilated_cnn</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.images', title='?'>images</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_filters', title='?'>num_filters</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.is_training', title='bool'>is_training</a>)
<span class='lineno'> 444</span> 
<span class='lineno'> 445</span>   # The probability distribution map.
<span class='lineno'> 446</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> = slim.conv2d(
<span class='lineno'> 447</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', title='None'>net</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>, [3, 3], rate=1, scope=&quot;conv_xy&quot;, activation_fn=None)
<span class='lineno'> 448</span> 
<span class='lineno'> 449</span>   # We added the  fixed camera distance as a bias.
<span class='lineno'> 450</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='int'>z</a> = -30 + slim.conv2d(
<span class='lineno'> 451</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.net', title='None'>net</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>, [3, 3], rate=1, scope=&quot;conv_z&quot;, activation_fn=None)
<span class='lineno'> 452</span> 
<span class='lineno'> 453</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, [0, 3, 1, 2])
<span class='lineno'> 454</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='?'>z</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='int'>z</a>, [0, 3, 1, 2])
<span class='lineno'> 455</span> 
<span class='lineno'> 456</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>])
<span class='lineno'> 457</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> = tf.nn.softmax(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, name=&quot;softmax&quot;)
<span class='lineno'> 458</span> 
<span class='lineno'> 459</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', title='?'>ranx</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', title='?'>rany</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.meshgrid', title='? -> (?, ?) / int -> (?, ?)'>meshgrid</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>)
<span class='lineno'> 460</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>])
<span class='lineno'> 461</span> 
<span class='lineno'> 462</span>   # These are for visualizing the distribution maps.
<span class='lineno'> 463</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_viz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_viz', title='?'>prob_viz</a> = tf.expand_dims(tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, 1), 3)
<span class='lineno'> 464</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_vizs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_vizs', title='[?]'>prob_vizs</a> = [tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>[:, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', title='int'>i</a>, :, :], 3) for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.i', title='int'>i</a></a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>)]
<span class='lineno'> 465</span> 
<span class='lineno'> 466</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sx', title='?'>sx</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', title='?'>ranx</a>, axis=[2, 3])
<span class='lineno'> 467</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sy', title='?'>sy</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', title='?'>rany</a>, axis=[2, 3])  # -&gt; batch x num_kp
<span class='lineno'> 468</span> 
<span class='lineno'> 469</span>   # [batch, num_kp]
<span class='lineno'> 470</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', title='?'>sill</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> * tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.mask', title='?'>mask</a>, 1), axis=[2, 3])
<span class='lineno'> 471</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', title='?'>sill</a> = tf.reduce_mean(-tf.log(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', title='?'>sill</a> + 1e-12))
<span class='lineno'> 472</span> 
<span class='lineno'> 473</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='?'>z</a> = tf.reduce_sum(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='?'>z</a>, axis=[2, 3])
<span class='lineno'> 474</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', title='?'>uv</a> = tf.reshape(tf.stack([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sx', title='?'>sx</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sy', title='?'>sy</a>], -1), [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.num_kp', title='?'>num_kp</a>, 2])
<span class='lineno'> 475</span> 
<span class='lineno'> 476</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.variance', title='None'>variance</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.variance_loss', title='(?, ?, ?, ?) -> None'>variance_loss</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob', title='?'>prob</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.ranx', title='?'>ranx</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.rany', title='?'>rany</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', title='?'>uv</a>)
<span class='lineno'> 477</span> 
<span class='lineno'> 478</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.uv', title='?'>uv</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.z', title='?'>z</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.orient', title='None'>orient</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.sill', title='?'>sill</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.variance', title='None'>variance</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_viz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_viz', title='?'>prob_viz</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_vizs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network.prob_vizs', title='[?]'>prob_vizs</a>
<span class='lineno'> 479</span> 
<span class='lineno'> 480</span> 
<span class='lineno'> 481</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn', title='(?, ?, ?, ?) -> dict'>model_fn</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.labels', title='?'>labels</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mode', title='?'>mode</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>):
<span class='lineno'> 482</span>   &quot;&quot;&quot;Returns model_fn for tf.estimator.Estimator.&quot;&quot;&quot;
<span class='lineno'> 483</span> 
<span class='lineno'> 484</span>   del <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.labels', title='?'>labels</a>
<span class='lineno'> 485</span> 
<span class='lineno'> 486</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.is_training', title='bool'>is_training</a> = (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mode', title='?'>mode</a> == tf.estimator.ModeKeys.TRAIN)
<span class='lineno'> 487</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer', title='<Transformer>'>Transformer</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vw', title='int'>vw</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.vh', title='int'>vh</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.dset)
<span class='lineno'> 488</span> 
<span class='lineno'> 489</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', title='? -> ?'>func1</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1.x', title='?'>x</a>):
<span class='lineno'> 490</span>     return tf.transpose(tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1.x', title='?'>x</a>], [-1, 4, 4]), [0, 2, 1])
<span class='lineno'> 491</span> 
<span class='lineno'> 492</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', title='[?]'>mv</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', title='? -> ?'>func1</a>(&quot;mv%d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>) for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a></a> in range(2)]
<span class='lineno'> 493</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', title='[?]'>mvi</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.func1', title='? -> ?'>func1</a>(&quot;mvi%d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>) for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a></a> in range(2)]
<span class='lineno'> 494</span> 
<span class='lineno'> 495</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a> = [None] * 2
<span class='lineno'> 496</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', title='?'>uvz_proj</a> = [None] * 2  # uvz coordinates projected on to the other view.
<span class='lineno'> 497</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', title='?'>viz</a> = [None] * 2
<span class='lineno'> 498</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', title='?'>vizs</a> = [None] * 2
<span class='lineno'> 499</span> 
<span class='lineno'> 500</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', title='int'>loss_sill</a> = 0
<span class='lineno'> 501</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', title='int'>loss_variance</a> = 0
<span class='lineno'> 502</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'>loss_con</a> = 0
<span class='lineno'> 503</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', title='int'>loss_sep</a> = 0
<span class='lineno'> 504</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', title='int'>loss_lr</a> = 0
<span class='lineno'> 505</span> 
<span class='lineno'> 506</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a> in range(2):
<span class='lineno'> 507</span>     with tf.variable_scope(&quot;KeypointNetwork&quot;, reuse=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a> &gt; 0):
<span class='lineno'> 508</span>       # anneal: 1 = using ground-truth, 0 = using our estimate orientation.
<span class='lineno'> 509</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', title='?'>anneal</a> = tf.to_float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.lr_anneal_end - tf.train.get_global_step())
<span class='lineno'> 510</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', title='?'>anneal</a> = tf.clip_by_value(
<span class='lineno'> 511</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', title='?'>anneal</a> / (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.lr_anneal_end - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.lr_anneal_start), 0.0, 1.0)
<span class='lineno'> 512</span> 
<span class='lineno'> 513</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', title='?'>z</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', title='None'>orient</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.sill', title='?'>sill</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.variance', title='None'>variance</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', title='?'>viz</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', title='?'>vizs</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', title='(?, ?, ?, ?, None, int) -> (?, ?, None, ?, None, ?, [?]) / (?, ?, ?, bool, None, int) -> (?, ?, None, ?, None, ?, [?])'>keypoint_network</a>(
<span class='lineno'> 514</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[&quot;img%d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>],
<span class='lineno'> 515</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_filters,
<span class='lineno'> 516</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_kp,
<span class='lineno'> 517</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.is_training', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.is_training', title='bool'>is_training</a>,
<span class='lineno'> 518</span>           lr_gt=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[&quot;lr%d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>],
<span class='lineno'> 519</span>           anneal=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', title='?'>anneal</a>)
<span class='lineno'> 520</span> 
<span class='lineno'> 521</span>       # x-positive/negative axes (dominant direction).
<span class='lineno'> 522</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp_axis', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp_axis', title='?'>xp_axis</a> = tf.tile(
<span class='lineno'> 523</span>           tf.constant([[[1.0, 0, 0, 1], [-1.0, 0, 0, 1]]]),
<span class='lineno'> 524</span>           [tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', title='None'>orient</a>)[0], 1, 1])
<span class='lineno'> 525</span> 
<span class='lineno'> 526</span>       # [batch, 2, 4]  = [batch, 2, 4] x [batch, 4, 4]
<span class='lineno'> 527</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', title='?'>xp</a> = tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp_axis', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp_axis', title='?'>xp_axis</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', title='[?]'>mv</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>])
<span class='lineno'> 528</span> 
<span class='lineno'> 529</span>       # [batch, 2, 3]
<span class='lineno'> 530</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', title='None'>xp</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', title='(Transformer, ?) -> None'>project</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', title='?'>xp</a>)
<span class='lineno'> 531</span> 
<span class='lineno'> 532</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', title='int'>loss_lr</a></a> += tf.losses.mean_squared_error(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.orient', title='None'>orient</a>[:, :, :2], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.xp', title='None'>xp</a>[:, :, :2])
<span class='lineno'> 533</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', title='int'>loss_variance</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.variance', title='None'>variance</a>
<span class='lineno'> 534</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', title='int'>loss_sill</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.sill', title='?'>sill</a>
<span class='lineno'> 535</span> 
<span class='lineno'> 536</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_kp, 2])
<span class='lineno'> 537</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', title='?'>z</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', title='?'>z</a>, [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_kp, 1])
<span class='lineno'> 538</span> 
<span class='lineno'> 539</span>       # [batch, num_kp, 3]
<span class='lineno'> 540</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>] = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.z', title='?'>z</a>], axis=2)
<span class='lineno'> 541</span> 
<span class='lineno'> 542</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.world_coords', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.world_coords', title='?'>world_coords</a> = tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', title='(Transformer, ?) -> None'>unproject</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>]), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', title='[?]'>mvi</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>])
<span class='lineno'> 543</span> 
<span class='lineno'> 544</span>       # [batch, num_kp, 3]
<span class='lineno'> 545</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', title='?'>uvz_proj</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.project', title='(Transformer, ?) -> None'>project</a>(tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.world_coords', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.world_coords', title='?'>world_coords</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', title='[?]'>mv</a>[1 - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>]))
<span class='lineno'> 546</span> 
<span class='lineno'> 547</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', title='?'>pconf</a> = tf.ones(
<span class='lineno'> 548</span>       [tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a>)[0], tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uv', title='?'>uv</a>)[1]], dtype=tf.float32) / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_kp
<span class='lineno'> 549</span> 
<span class='lineno'> 550</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a> in range(2):
<span class='lineno'> 551</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'>loss_con</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.consistency_loss', title='(?, ?, ?) -> None'>consistency_loss</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz_proj', title='?'>uvz_proj</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>][:, :, :2], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[1 - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>][:, :, :2],
<span class='lineno'> 552</span>                                  <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', title='?'>pconf</a>)
<span class='lineno'> 553</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', title='int'>loss_sep</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.separation_loss', title='(?, ?) -> None'>separation_loss</a>(
<span class='lineno'> 554</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', title='(Transformer, ?) -> None'>unproject</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>])[:, :, :3], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.sep_delta)
<span class='lineno'> 555</span> 
<span class='lineno'> 556</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', title='?'>chordal</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', title='float'>angular</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.relative_pose_loss', title='(?, ?, ?, ?, ?) -> (?, float)'>relative_pose_loss</a>(
<span class='lineno'> 557</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', title='(Transformer, ?) -> None'>unproject</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[0])[:, :, :3],
<span class='lineno'> 558</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.t', title='Transformer'>t</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.Transformer.unproject', title='(Transformer, ?) -> None'>unproject</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[1])[:, :, :3], tf.matmul(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mvi', title='[?]'>mvi</a>[0], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.mv', title='[?]'>mv</a>[1]), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.pconf', title='?'>pconf</a>,
<span class='lineno'> 559</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.noise)
<span class='lineno'> 560</span> 
<span class='lineno'> 561</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss', title='float'>loss</a> = (
<span class='lineno'> 562</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_pose * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', title='float'>angular</a> +
<span class='lineno'> 563</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_con * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'>loss_con</a> +
<span class='lineno'> 564</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_sep * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', title='int'>loss_sep</a> +
<span class='lineno'> 565</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_sill * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', title='int'>loss_sill</a> +
<span class='lineno'> 566</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_lr * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', title='int'>loss_lr</a> +
<span class='lineno'> 567</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.loss_variance * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', title='int'>loss_variance</a>
<span class='lineno'> 568</span>   )
<span class='lineno'> 569</span> 
<span class='lineno'> 570</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8', title='? -> ?'>touint8</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8.img', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8.img', title='?'>img</a>):
<span class='lineno'> 571</span>     return tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8.img', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8.img', title='?'>img</a> * 255.0, tf.uint8)
<span class='lineno'> 572</span> 
<span class='lineno'> 573</span>   with tf.variable_scope(&quot;output&quot;):
<span class='lineno'> 574</span>     tf.summary.image(&quot;0_img0&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.touint8', title='? -> ?'>touint8</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[&quot;img0&quot;][:, :, :, :3]))
<span class='lineno'> 575</span>     tf.summary.image(&quot;1_combined&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.viz', title='?'>viz</a>[0])
<span class='lineno'> 576</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.hparams', title='?'>hparams</a>.num_kp):
<span class='lineno'> 577</span>       tf.summary.image(&quot;2_f%02d&quot; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.vizs', title='?'>vizs</a>[0][<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.i', title='int'>i</a>])
<span class='lineno'> 578</span> 
<span class='lineno'> 579</span>   with tf.variable_scope(&quot;stats&quot;):
<span class='lineno'> 580</span>     tf.summary.scalar(&quot;anneal&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.anneal', title='?'>anneal</a>)
<span class='lineno'> 581</span>     tf.summary.scalar(&quot;closs&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'>loss_con</a>)
<span class='lineno'> 582</span>     tf.summary.scalar(&quot;seploss&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sep', title='int'>loss_sep</a>)
<span class='lineno'> 583</span>     tf.summary.scalar(&quot;angular&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', title='float'>angular</a>)
<span class='lineno'> 584</span>     tf.summary.scalar(&quot;chordal&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', title='?'>chordal</a>)
<span class='lineno'> 585</span>     tf.summary.scalar(&quot;lrloss&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_lr', title='int'>loss_lr</a>)
<span class='lineno'> 586</span>     tf.summary.scalar(&quot;sill&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_sill', title='int'>loss_sill</a>)
<span class='lineno'> 587</span>     tf.summary.scalar(&quot;vloss&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_variance', title='int'>loss_variance</a>)
<span class='lineno'> 588</span> 
<span class='lineno'> 589</span>   return {
<span class='lineno'> 590</span>       &quot;loss&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss', title='float'>loss</a>,
<span class='lineno'> 591</span>       &quot;predictions&quot;: {
<span class='lineno'> 592</span>           &quot;img0&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[&quot;img0&quot;],
<span class='lineno'> 593</span>           &quot;img1&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.features', title='?'>features</a>[&quot;img1&quot;],
<span class='lineno'> 594</span>           &quot;uvz0&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[0],
<span class='lineno'> 595</span>           &quot;uvz1&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.uvz', title='?'>uvz</a>[1]
<span class='lineno'> 596</span>       },
<span class='lineno'> 597</span>       &quot;eval_metric_ops&quot;: {
<span class='lineno'> 598</span>           &quot;closs&quot;: tf.metrics.mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.loss_con', title='int'>loss_con</a>),
<span class='lineno'> 599</span>           &quot;angular_loss&quot;: tf.metrics.mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.angular', title='float'>angular</a>),
<span class='lineno'> 600</span>           &quot;chordal_loss&quot;: tf.metrics.mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn.chordal', title='?'>chordal</a>),
<span class='lineno'> 601</span>       }
<span class='lineno'> 602</span>   }
<span class='lineno'> 603</span> 
<span class='lineno'> 604</span> 
<span class='lineno'> 605</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict', title='(?, ?) -> None / (?, None) -> None'>predict</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', title='?'>input_folder</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>):
<span class='lineno'> 606</span>   &quot;&quot;&quot;Predicts keypoints on all images in input_folder.&quot;&quot;&quot;
<span class='lineno'> 607</span> 
<span class='lineno'> 608</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.cols', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.cols', title='?'>cols</a> = plt.cm.get_cmap(&quot;rainbow&quot;)(
<span class='lineno'> 609</span>       np.linspace(0, 1.0, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_kp))[:, :4]
<span class='lineno'> 610</span> 
<span class='lineno'> 611</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', title='?'>img</a> = tf.placeholder(tf.float32, shape=(1, 128, 128, 4))
<span class='lineno'> 612</span> 
<span class='lineno'> 613</span>   with tf.variable_scope(&quot;KeypointNetwork&quot;):
<span class='lineno'> 614</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', title='(?, ?, None, ?, None, ?, [?])'>ret</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.keypoint_network', title='(?, ?, ?, ?, None, int) -> (?, ?, None, ?, None, ?, [?]) / (?, ?, ?, bool, None, int) -> (?, ?, None, ?, None, ?, [?])'>keypoint_network</a>(
<span class='lineno'> 615</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', title='?'>img</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_filters, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_kp, False)
<span class='lineno'> 616</span> 
<span class='lineno'> 617</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv', title='?'>uv</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', title='(?, ?, None, ?, None, ?, [?])'>ret</a>[0], [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_kp, 2])
<span class='lineno'> 618</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.z', title='?'>z</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ret', title='(?, ?, None, ?, None, ?, [?])'>ret</a>[1], [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_kp, 1])
<span class='lineno'> 619</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uvz', title='?'>uvz</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv', title='?'>uv</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.z', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.z', title='?'>z</a>], axis=2)
<span class='lineno'> 620</span> 
<span class='lineno'> 621</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', title='?'>sess</a> = tf.Session()
<span class='lineno'> 622</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.saver', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.saver', title='?'>saver</a> = tf.train.Saver()
<span class='lineno'> 623</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', title='?'>ckpt</a> = tf.train.get_checkpoint_state(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.model_dir)
<span class='lineno'> 624</span> 
<span class='lineno'> 625</span>   print(&quot;loading model: &quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', title='?'>ckpt</a>.model_checkpoint_path)
<span class='lineno'> 626</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.saver', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.saver', title='?'>saver</a>.restore(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', title='?'>sess</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.ckpt', title='?'>ckpt</a>.model_checkpoint_path)
<span class='lineno'> 627</span> 
<span class='lineno'> 628</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.files', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.files', title='[str]'>files</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', title='str'>x</a> for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', title='str'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', title='str'>x</a></a> in os.listdir(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', title='?'>input_folder</a>)
<span class='lineno'> 629</span>            if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.x', title='str'>x</a>[-3:] in [&quot;jpg&quot;, &quot;png&quot;]]
<span class='lineno'> 630</span> 
<span class='lineno'> 631</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', title='str'>output_folder</a> = os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', title='?'>input_folder</a>, &quot;output&quot;)
<span class='lineno'> 632</span>   if not os.path.exists(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', title='str'>output_folder</a>):
<span class='lineno'> 633</span>     os.mkdir(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', title='str'>output_folder</a>)
<span class='lineno'> 634</span> 
<span class='lineno'> 635</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', title='str'>f</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.files', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.files', title='[str]'>files</a>:
<span class='lineno'> 636</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a> = misc.imread(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.input_folder', title='?'>input_folder</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', title='str'>f</a>)).astype(float) / 255
<span class='lineno'> 637</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>.shape[2] == 3:
<span class='lineno'> 638</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='?'>orig</a> = np.concatenate((<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>, np.ones_like(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>[:, :, :1])), axis=2)
<span class='lineno'> 639</span> 
<span class='lineno'> 640</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv_ret', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv_ret', title='?'>uv_ret</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.sess', title='?'>sess</a>.run(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uvz', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uvz', title='?'>uvz</a>, feed_dict={<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.img', title='?'>img</a>: np.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>, 0)})
<span class='lineno'> 641</span> 
<span class='lineno'> 642</span>     <a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', title='utils'>utils</a>.<a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.draw_ndc_points', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.draw_ndc_points', title='(?, ?, ?) -> None / (int, ?, ?) -> None'>draw_ndc_points</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv_ret', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.uv_ret', title='?'>uv_ret</a>.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.hparams', title='None'>hparams</a>.num_kp, 3), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.cols', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.cols', title='?'>cols</a>)
<span class='lineno'> 643</span>     misc.imsave(os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.output_folder', title='str'>output_folder</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.f', title='str'>f</a>), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict.orig', title='int'>orig</a>)
<span class='lineno'> 644</span> 
<span class='lineno'> 645</span> 
<span class='lineno'> 646</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams', title='() -> None'>_default_hparams</a>():
<span class='lineno'> 647</span>   &quot;&quot;&quot;Returns default or overridden user-specified hyperparameters.&quot;&quot;&quot;
<span class='lineno'> 648</span> 
<span class='lineno'> 649</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', title='?'>hparams</a> = tf.contrib.training.HParams(
<span class='lineno'> 650</span>       num_filters=64,  # Number of filters.
<span class='lineno'> 651</span>       num_kp=10,  # Numer of keypoints.
<span class='lineno'> 652</span> 
<span class='lineno'> 653</span>       loss_pose=0.2,  # Pose Loss.
<span class='lineno'> 654</span>       loss_con=1.0,  # Multiview consistency Loss.
<span class='lineno'> 655</span>       loss_sep=1.0,  # Seperation Loss.
<span class='lineno'> 656</span>       loss_sill=1.0,  # Sillhouette Loss.
<span class='lineno'> 657</span>       loss_lr=1.0,  # Orientation Loss.
<span class='lineno'> 658</span>       loss_variance=0.5,  # Variance Loss (part of Sillhouette loss).
<span class='lineno'> 659</span> 
<span class='lineno'> 660</span>       sep_delta=0.05,  # Seperation threshold.
<span class='lineno'> 661</span>       noise=0.1,  # Noise added during estimating rotation.
<span class='lineno'> 662</span> 
<span class='lineno'> 663</span>       learning_rate=1.0e-3,
<span class='lineno'> 664</span>       lr_anneal_start=30000,  # When to anneal in the orientation prediction.
<span class='lineno'> 665</span>       lr_anneal_end=60000,  # When to use the prediction completely.
<span class='lineno'> 666</span>   )
<span class='lineno'> 667</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.hparams:
<span class='lineno'> 668</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', title='?'>hparams</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', title='?'>hparams</a>.parse(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.hparams)
<span class='lineno'> 669</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams.hparams', title='?'>hparams</a>
<span class='lineno'> 670</span> 
<span class='lineno'> 671</span> 
<span class='lineno'> 672</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main', title='? -> None'>main</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.argv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.argv', title='?'>argv</a>):
<span class='lineno'> 673</span>   del <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.argv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.argv', title='?'>argv</a>
<span class='lineno'> 674</span> 
<span class='lineno'> 675</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', title='None'>hparams</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main._default_hparams', title='() -> None'>_default_hparams</a>()
<span class='lineno'> 676</span> 
<span class='lineno'> 677</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.predict:
<span class='lineno'> 678</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.predict', title='(?, ?) -> None / (?, None) -> None'>predict</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.input, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', title='None'>hparams</a>)
<span class='lineno'> 679</span>   else:
<span class='lineno'> 680</span>     <a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', title='utils'>utils</a>.<a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.train_and_eval', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.train_and_eval', title='(?, ?, ?, ?, ?, ?, float, int, int, int, int, int, int) -> None / (?, ?, ?, (?, ?, ?, ?) -> dict, (?, ?) -> ? -> ? / (str, ?) -> () -> (?, None), None, float, int, int, int, int, int, int) -> None'>train_and_eval</a>(
<span class='lineno'> 681</span>         model_dir=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.model_dir,
<span class='lineno'> 682</span>         model_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.model_fn', title='(?, ?, ?, ?) -> dict'>model_fn</a>,
<span class='lineno'> 683</span>         input_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.create_input_fn', title='(?, ?) -> ? -> ? / (str, ?) -> () -> (?, None)'>create_input_fn</a>,
<span class='lineno'> 684</span>         hparams=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.main.hparams', title='None'>hparams</a>,
<span class='lineno'> 685</span>         steps=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.steps,
<span class='lineno'> 686</span>         batch_size=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.batch_size,
<span class='lineno'> 687</span>         save_checkpoints_secs=600,
<span class='lineno'> 688</span>         eval_throttle_secs=1800,
<span class='lineno'> 689</span>         eval_steps=5,
<span class='lineno'> 690</span>         sync_replicas=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.main.FLAGS', title='?'>FLAGS</a>.sync_replicas,
<span class='lineno'> 691</span>     )
<span class='lineno'> 692</span> 
<span class='lineno'> 693</span> 
<span class='lineno'> 694</span> if __name__ == &quot;__main__&quot;:
<span class='lineno'> 695</span>   sys.excepthook = <a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils', title='utils'>utils</a>.<a href='utils.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.colored_hook', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.keypointnet.utils.colored_hook', title='str -> (?, ?, ?) -> None'>colored_hook</a>(
<span class='lineno'> 696</span>       os.path.dirname(os.path.realpath(__file__)))
<span class='lineno'> 697</span>   tf.app.run()
</pre></td></tr></table></body></html>