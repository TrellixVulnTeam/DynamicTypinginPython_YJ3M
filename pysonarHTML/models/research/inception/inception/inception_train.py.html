<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/research/inception/inception/inception_train.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS'>FLAGS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY'>RMSPROP_DECAY</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM'>RMSPROP_MOMENTUM</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON'>RMSPROP_EPSILON</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss'>_tower_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients'>_average_gradients</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train', xid='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train'>train</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2016 Google Inc. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;A library to train Inception using multiple GPUs with synchronous updates.
<span class='lineno'>  16</span> &quot;&quot;&quot;
<span class='lineno'>  17</span> from __future__ import absolute_import
<span class='lineno'>  18</span> from __future__ import division
<span class='lineno'>  19</span> from __future__ import print_function
<span class='lineno'>  20</span> 
<span class='lineno'>  21</span> import copy
<span class='lineno'>  22</span> from datetime import datetime
<span class='lineno'>  23</span> import os.path
<span class='lineno'>  24</span> import re
<span class='lineno'>  25</span> import time
<span class='lineno'>  26</span> 
<span class='lineno'>  27</span> import numpy as np
<span class='lineno'>  28</span> import tensorflow as tf
<span class='lineno'>  29</span> 
<span class='lineno'>  30</span> from inception import image_processing
<span class='lineno'>  31</span> from inception import inception_model as inception
<span class='lineno'>  32</span> from inception.slim import slim
<span class='lineno'>  33</span> 
<span class='lineno'>  34</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a> = tf.app.flags.FLAGS
<span class='lineno'>  35</span> 
<span class='lineno'>  36</span> tf.app.flags.DEFINE_string(&#39;train_dir&#39;, &#39;/tmp/imagenet_train&#39;,
<span class='lineno'>  37</span>                            &quot;&quot;&quot;Directory where to write event logs &quot;&quot;&quot;
<span class='lineno'>  38</span>                            &quot;&quot;&quot;and checkpoint.&quot;&quot;&quot;)
<span class='lineno'>  39</span> tf.app.flags.DEFINE_integer(&#39;max_steps&#39;, 10000000,
<span class='lineno'>  40</span>                             &quot;&quot;&quot;Number of batches to run.&quot;&quot;&quot;)
<span class='lineno'>  41</span> tf.app.flags.DEFINE_string(&#39;subset&#39;, &#39;train&#39;,
<span class='lineno'>  42</span>                            &quot;&quot;&quot;Either &#39;train&#39; or &#39;validation&#39;.&quot;&quot;&quot;)
<span class='lineno'>  43</span> 
<span class='lineno'>  44</span> # Flags governing the hardware employed for running TensorFlow.
<span class='lineno'>  45</span> tf.app.flags.DEFINE_integer(&#39;num_gpus&#39;, 1,
<span class='lineno'>  46</span>                             &quot;&quot;&quot;How many GPUs to use.&quot;&quot;&quot;)
<span class='lineno'>  47</span> tf.app.flags.DEFINE_boolean(&#39;log_device_placement&#39;, False,
<span class='lineno'>  48</span>                             &quot;&quot;&quot;Whether to log device placement.&quot;&quot;&quot;)
<span class='lineno'>  49</span> 
<span class='lineno'>  50</span> # Flags governing the type of training.
<span class='lineno'>  51</span> tf.app.flags.DEFINE_boolean(&#39;fine_tune&#39;, False,
<span class='lineno'>  52</span>                             &quot;&quot;&quot;If set, randomly initialize the final layer &quot;&quot;&quot;
<span class='lineno'>  53</span>                             &quot;&quot;&quot;of weights in order to train the network on a &quot;&quot;&quot;
<span class='lineno'>  54</span>                             &quot;&quot;&quot;new task.&quot;&quot;&quot;)
<span class='lineno'>  55</span> tf.app.flags.DEFINE_string(&#39;pretrained_model_checkpoint_path&#39;, &#39;&#39;,
<span class='lineno'>  56</span>                            &quot;&quot;&quot;If specified, restore this pretrained model &quot;&quot;&quot;
<span class='lineno'>  57</span>                            &quot;&quot;&quot;before beginning any training.&quot;&quot;&quot;)
<span class='lineno'>  58</span> 
<span class='lineno'>  59</span> # **IMPORTANT**
<span class='lineno'>  60</span> # Please note that this learning rate schedule is heavily dependent on the
<span class='lineno'>  61</span> # hardware architecture, batch size and any changes to the model architecture
<span class='lineno'>  62</span> # specification. Selecting a finely tuned learning rate schedule is an
<span class='lineno'>  63</span> # empirical process that requires some experimentation. Please see README.md
<span class='lineno'>  64</span> # more guidance and discussion.
<span class='lineno'>  65</span> #
<span class='lineno'>  66</span> # With 8 Tesla K40&#39;s and a batch size = 256, the following setup achieves
<span class='lineno'>  67</span> # precision@1 = 73.5% after 100 hours and 100K steps (20 epochs).
<span class='lineno'>  68</span> # Learning rate decay factor selected from http://arxiv.org/abs/1404.5997.
<span class='lineno'>  69</span> tf.app.flags.DEFINE_float(&#39;initial_learning_rate&#39;, 0.1,
<span class='lineno'>  70</span>                           &quot;&quot;&quot;Initial learning rate.&quot;&quot;&quot;)
<span class='lineno'>  71</span> tf.app.flags.DEFINE_float(&#39;num_epochs_per_decay&#39;, 30.0,
<span class='lineno'>  72</span>                           &quot;&quot;&quot;Epochs after which learning rate decays.&quot;&quot;&quot;)
<span class='lineno'>  73</span> tf.app.flags.DEFINE_float(&#39;learning_rate_decay_factor&#39;, 0.16,
<span class='lineno'>  74</span>                           &quot;&quot;&quot;Learning rate decay factor.&quot;&quot;&quot;)
<span class='lineno'>  75</span> 
<span class='lineno'>  76</span> # Constants dictating the learning rate schedule.
<span class='lineno'>  77</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY', title='float'>RMSPROP_DECAY</a> = 0.9                # Decay term for RMSProp.
<span class='lineno'>  78</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM', title='float'>RMSPROP_MOMENTUM</a> = 0.9             # Momentum in RMSProp.
<span class='lineno'>  79</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON', title='float'>RMSPROP_EPSILON</a> = 1.0              # Epsilon term for RMSProp.
<span class='lineno'>  80</span> 
<span class='lineno'>  81</span> 
<span class='lineno'>  82</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss', title='(?, ?, ?, ?, None) -> None / (?, ?, int, ?, None) -> None / (?, ?, int, ?, bool) -> None'>_tower_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', title='?'>images</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.labels', title='?'>labels</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.num_classes', title='int'>num_classes</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', title='?'>scope</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.reuse_variables', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.reuse_variables', title='bool'>reuse_variables</a>=None):
<span class='lineno'>  83</span>   &quot;&quot;&quot;Calculate the total loss on a single tower running the ImageNet model.
<span class='lineno'>  84</span> 
<span class='lineno'>  85</span>   We perform &#39;batch splitting&#39;. This means that we cut up a batch across
<span class='lineno'>  86</span>   multiple GPUs. For instance, if the batch size = 32 and num_gpus = 2,
<span class='lineno'>  87</span>   then each tower will operate on an batch of 16 images.
<span class='lineno'>  88</span> 
<span class='lineno'>  89</span>   Args:
<span class='lineno'>  90</span>     images: Images. 4D tensor of size [batch_size, FLAGS.image_size,
<span class='lineno'>  91</span>                                        FLAGS.image_size, 3].
<span class='lineno'>  92</span>     labels: 1-D integer Tensor of [batch_size].
<span class='lineno'>  93</span>     num_classes: number of classes
<span class='lineno'>  94</span>     scope: unique prefix string identifying the ImageNet tower, e.g.
<span class='lineno'>  95</span>       &#39;tower_0&#39;.
<span class='lineno'>  96</span> 
<span class='lineno'>  97</span>   Returns:
<span class='lineno'>  98</span>      Tensor of shape [] containing the total loss for a batch of data
<span class='lineno'>  99</span>   &quot;&quot;&quot;
<span class='lineno'> 100</span>   # When fine-tuning a model, we do not restore the logits but instead we
<span class='lineno'> 101</span>   # randomly initialize the logits. The number of classes in the output of the
<span class='lineno'> 102</span>   # logit is the number of classes in specified Dataset.
<span class='lineno'> 103</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.restore_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.restore_logits', title='?'>restore_logits</a> = not <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.fine_tune
<span class='lineno'> 104</span> 
<span class='lineno'> 105</span>   # Build inference Graph.
<span class='lineno'> 106</span>   with tf.variable_scope(tf.get_variable_scope(), reuse=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.reuse_variables', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.reuse_variables', title='bool'>reuse_variables</a>):
<span class='lineno'> 107</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.logits', title='?'>logits</a> = inception.inference(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', title='?'>images</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.num_classes', title='int'>num_classes</a>, for_training=True,
<span class='lineno'> 108</span>                                  restore_logits=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.restore_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.restore_logits', title='?'>restore_logits</a>,
<span class='lineno'> 109</span>                                  scope=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', title='?'>scope</a>)
<span class='lineno'> 110</span> 
<span class='lineno'> 111</span>   # Build the portion of the Graph calculating the losses. Note that we will
<span class='lineno'> 112</span>   # assemble the total_loss using a custom function below.
<span class='lineno'> 113</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.split_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.split_batch_size', title='?'>split_batch_size</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.images', title='?'>images</a>.get_shape().as_list()[0]
<span class='lineno'> 114</span>   inception.loss(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.logits', title='?'>logits</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.labels', title='?'>labels</a>, batch_size=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.split_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.split_batch_size', title='?'>split_batch_size</a>)
<span class='lineno'> 115</span> 
<span class='lineno'> 116</span>   # Assemble all of the losses for the current tower only.
<span class='lineno'> 117</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', title='?'>losses</a> = tf.get_collection(slim.losses.LOSSES_COLLECTION, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.scope', title='?'>scope</a>)
<span class='lineno'> 118</span> 
<span class='lineno'> 119</span>   # Calculate the total loss for the current tower.
<span class='lineno'> 120</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.regularization_losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.regularization_losses', title='?'>regularization_losses</a> = tf.get_collection(tf.GraphKeys.REGULARIZATION_LOSSES)
<span class='lineno'> 121</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a> = tf.add_n(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', title='?'>losses</a> + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.regularization_losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.regularization_losses', title='?'>regularization_losses</a>, name=&#39;total_loss&#39;)
<span class='lineno'> 122</span> 
<span class='lineno'> 123</span>   # Compute the moving average of all individual losses and the total loss.
<span class='lineno'> 124</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', title='?'>loss_averages</a> = tf.train.ExponentialMovingAverage(0.9, name=&#39;avg&#39;)
<span class='lineno'> 125</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages_op', title='?'>loss_averages_op</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', title='?'>loss_averages</a>.apply(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', title='?'>losses</a> + [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a>])
<span class='lineno'> 126</span> 
<span class='lineno'> 127</span>   # Attach a scalar summmary to all individual losses and the total loss; do the
<span class='lineno'> 128</span>   # same for the averaged version of the losses.
<span class='lineno'> 129</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', title='?'>l</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.losses', title='?'>losses</a> + [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a>]:
<span class='lineno'> 130</span>     # Remove &#39;tower_[0-9]/&#39; from the name in case this is a multi-GPU training
<span class='lineno'> 131</span>     # session. This helps the clarity of presentation on TensorBoard.
<span class='lineno'> 132</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', title='?'>loss_name</a> = re.sub(&#39;%s_[0-9]*/&#39; % inception.TOWER_NAME, &#39;&#39;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', title='?'>l</a>.op.name)
<span class='lineno'> 133</span>     # Name each loss as &#39;(raw)&#39; and name the moving average version of the loss
<span class='lineno'> 134</span>     # as the original loss name.
<span class='lineno'> 135</span>     tf.summary.scalar(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', title='?'>loss_name</a> +&#39; (raw)&#39;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', title='?'>l</a>)
<span class='lineno'> 136</span>     tf.summary.scalar(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_name', title='?'>loss_name</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages', title='?'>loss_averages</a>.average(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.l', title='?'>l</a>))
<span class='lineno'> 137</span> 
<span class='lineno'> 138</span>   with tf.control_dependencies([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.loss_averages_op', title='?'>loss_averages_op</a>]):
<span class='lineno'> 139</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a> = tf.identity(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a>)
<span class='lineno'> 140</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss.total_loss', title='?'>total_loss</a>
<span class='lineno'> 141</span> 
<span class='lineno'> 142</span> 
<span class='lineno'> 143</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients', title='? -> [(?, ?)] / [?] -> [(?, ?)]'>_average_gradients</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.tower_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.tower_grads', title='[?]'>tower_grads</a>):
<span class='lineno'> 144</span>   &quot;&quot;&quot;Calculate the average gradient for each shared variable across all towers.
<span class='lineno'> 145</span> 
<span class='lineno'> 146</span>   Note that this function provides a synchronization point across all towers.
<span class='lineno'> 147</span> 
<span class='lineno'> 148</span>   Args:
<span class='lineno'> 149</span>     tower_grads: List of lists of (gradient, variable) tuples. The outer list
<span class='lineno'> 150</span>       is over individual gradients. The inner list is over the gradient
<span class='lineno'> 151</span>       calculation for each tower.
<span class='lineno'> 152</span>   Returns:
<span class='lineno'> 153</span>      List of pairs of (gradient, variable) where the gradient has been averaged
<span class='lineno'> 154</span>      across all towers.
<span class='lineno'> 155</span>   &quot;&quot;&quot;
<span class='lineno'> 156</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', title='[(?, ?)]'>average_grads</a> = []
<span class='lineno'> 157</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', title='?'>grad_and_vars</a> in zip(*<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.tower_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.tower_grads', title='[?]'>tower_grads</a>):
<span class='lineno'> 158</span>     # Note that each grad_and_vars looks like the following:
<span class='lineno'> 159</span>     #   ((grad0_gpu0, var0_gpu0), ... , (grad0_gpuN, var0_gpuN))
<span class='lineno'> 160</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', title='[?]'>grads</a> = []
<span class='lineno'> 161</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.g', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.g', title='?'>g</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients._', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients._', title='?'>_</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', title='?'>grad_and_vars</a>:
<span class='lineno'> 162</span>       # Add 0 dimension to the gradients to represent the tower.
<span class='lineno'> 163</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.expanded_g', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.expanded_g', title='?'>expanded_g</a> = tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.g', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.g', title='?'>g</a>, 0)
<span class='lineno'> 164</span> 
<span class='lineno'> 165</span>       # Append on a &#39;tower&#39; dimension which we will average over below.
<span class='lineno'> 166</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', title='[?]'>grads</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.expanded_g', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.expanded_g', title='?'>expanded_g</a>)
<span class='lineno'> 167</span> 
<span class='lineno'> 168</span>     # Average over the &#39;tower&#39; dimension.
<span class='lineno'> 169</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', title='?'>grad</a> = tf.concat(axis=0, values=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grads', title='[?]'>grads</a>)
<span class='lineno'> 170</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', title='?'>grad</a> = tf.reduce_mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', title='?'>grad</a>, 0)
<span class='lineno'> 171</span> 
<span class='lineno'> 172</span>     # Keep in mind that the Variables are redundant because they are shared
<span class='lineno'> 173</span>     # across towers. So .. we will just return the first tower&#39;s pointer to
<span class='lineno'> 174</span>     # the Variable.
<span class='lineno'> 175</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.v', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.v', title='?'>v</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_vars', title='?'>grad_and_vars</a>[0][1]
<span class='lineno'> 176</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_var', title='(?, ?)'>grad_and_var</a> = (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad', title='?'>grad</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.v', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.v', title='?'>v</a>)
<span class='lineno'> 177</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', title='[(?, ?)]'>average_grads</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.grad_and_var', title='(?, ?)'>grad_and_var</a>)
<span class='lineno'> 178</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients.average_grads', title='[(?, ?)]'>average_grads</a>
<span class='lineno'> 179</span> 
<span class='lineno'> 180</span> 
<span class='lineno'> 181</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train', title='? -> None'>train</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', title='?'>dataset</a>):
<span class='lineno'> 182</span>   &quot;&quot;&quot;Train on dataset for a number of steps.&quot;&quot;&quot;
<span class='lineno'> 183</span>   with tf.Graph().as_default(), tf.device(&#39;/cpu:0&#39;):
<span class='lineno'> 184</span>     # Create a variable to count the number of train() calls. This equals the
<span class='lineno'> 185</span>     # number of batches processed * FLAGS.num_gpus.
<span class='lineno'> 186</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', title='?'>global_step</a> = tf.get_variable(
<span class='lineno'> 187</span>         &#39;global_step&#39;, [],
<span class='lineno'> 188</span>         initializer=tf.constant_initializer(0), trainable=False)
<span class='lineno'> 189</span> 
<span class='lineno'> 190</span>     # Calculate the learning rate schedule.
<span class='lineno'> 191</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_batches_per_epoch', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_batches_per_epoch', title='?'>num_batches_per_epoch</a> = (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', title='?'>dataset</a>.num_examples_per_epoch() /
<span class='lineno'> 192</span>                              <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.batch_size)
<span class='lineno'> 193</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.decay_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.decay_steps', title='int'>decay_steps</a> = int(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_batches_per_epoch', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_batches_per_epoch', title='?'>num_batches_per_epoch</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_epochs_per_decay)
<span class='lineno'> 194</span> 
<span class='lineno'> 195</span>     # Decay the learning rate exponentially based on the number of steps.
<span class='lineno'> 196</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', title='?'>lr</a> = tf.train.exponential_decay(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.initial_learning_rate,
<span class='lineno'> 197</span>                                     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', title='?'>global_step</a>,
<span class='lineno'> 198</span>                                     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.decay_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.decay_steps', title='int'>decay_steps</a>,
<span class='lineno'> 199</span>                                     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.learning_rate_decay_factor,
<span class='lineno'> 200</span>                                     staircase=True)
<span class='lineno'> 201</span> 
<span class='lineno'> 202</span>     # Create an optimizer that performs gradient descent.
<span class='lineno'> 203</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', title='?'>opt</a> = tf.train.RMSPropOptimizer(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', title='?'>lr</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_DECAY', title='float'>RMSPROP_DECAY</a>,
<span class='lineno'> 204</span>                                     momentum=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_MOMENTUM', title='float'>RMSPROP_MOMENTUM</a>,
<span class='lineno'> 205</span>                                     epsilon=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.RMSPROP_EPSILON', title='float'>RMSPROP_EPSILON</a>)
<span class='lineno'> 206</span> 
<span class='lineno'> 207</span>     # Get images and labels for ImageNet and split the batch across GPUs.
<span class='lineno'> 208</span>     assert <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.batch_size % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus == 0, (
<span class='lineno'> 209</span>         &#39;Batch size must be divisible by number of GPUs&#39;)
<span class='lineno'> 210</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.split_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.split_batch_size', title='int'>split_batch_size</a> = int(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.batch_size / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus)
<span class='lineno'> 211</span> 
<span class='lineno'> 212</span>     # Override the number of preprocessing threads to account for the increased
<span class='lineno'> 213</span>     # number of GPU towers.
<span class='lineno'> 214</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_preprocess_threads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_preprocess_threads', title='?'>num_preprocess_threads</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_preprocess_threads * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus
<span class='lineno'> 215</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images', title='?'>images</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels', title='?'>labels</a> = image_processing.distorted_inputs(
<span class='lineno'> 216</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', title='?'>dataset</a>,
<span class='lineno'> 217</span>         num_preprocess_threads=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_preprocess_threads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_preprocess_threads', title='?'>num_preprocess_threads</a>)
<span class='lineno'> 218</span> 
<span class='lineno'> 219</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.input_summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.input_summaries', title='?'>input_summaries</a> = copy.copy(tf.get_collection(tf.GraphKeys.SUMMARIES))
<span class='lineno'> 220</span> 
<span class='lineno'> 221</span>     # Number of classes in the Dataset label set plus 1.
<span class='lineno'> 222</span>     # Label 0 is reserved for an (unused) background class.
<span class='lineno'> 223</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_classes', title='int'>num_classes</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.dataset', title='?'>dataset</a>.num_classes() + 1
<span class='lineno'> 224</span> 
<span class='lineno'> 225</span>      # Split the batch of images and labels for towers.
<span class='lineno'> 226</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images_splits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images_splits', title='?'>images_splits</a> = tf.split(axis=0, num_or_size_splits=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus, value=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images', title='?'>images</a>)
<span class='lineno'> 227</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels_splits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels_splits', title='?'>labels_splits</a> = tf.split(axis=0, num_or_size_splits=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus, value=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels', title='?'>labels</a>)
<span class='lineno'> 228</span> 
<span class='lineno'> 229</span>     # Calculate the gradients for each model tower.
<span class='lineno'> 230</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', title='[?]'>tower_grads</a> = []
<span class='lineno'> 231</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', title='None'>reuse_variables</a> = None
<span class='lineno'> 232</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', title='int'>i</a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.num_gpus):
<span class='lineno'> 233</span>       with tf.device(&#39;/gpu:%d&#39; % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', title='int'>i</a>):
<span class='lineno'> 234</span>         with tf.name_scope(&#39;%s_%d&#39; % (inception.TOWER_NAME, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', title='int'>i</a>)) as <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', title='?'>scope</a>:
<span class='lineno'> 235</span>           # Force all Variables to reside on the CPU.
<span class='lineno'> 236</span>           with slim.arg_scope([slim.variables.variable], device=&#39;/cpu:0&#39;):
<span class='lineno'> 237</span>             # Calculate the loss for one tower of the ImageNet model. This
<span class='lineno'> 238</span>             # function constructs the entire ImageNet model but shares the
<span class='lineno'> 239</span>             # variables across all towers.
<span class='lineno'> 240</span>             <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', title='None'>loss</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._tower_loss', title='(?, ?, ?, ?, None) -> None / (?, ?, int, ?, None) -> None / (?, ?, int, ?, bool) -> None'>_tower_loss</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images_splits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.images_splits', title='?'>images_splits</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', title='int'>i</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels_splits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.labels_splits', title='?'>labels_splits</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.i', title='int'>i</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.num_classes', title='int'>num_classes</a>,
<span class='lineno'> 241</span>                                <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', title='?'>scope</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', title='bool'>reuse_variables</a>)
<span class='lineno'> 242</span> 
<span class='lineno'> 243</span>           # Reuse variables for the next tower.
<span class='lineno'> 244</span>           <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.reuse_variables', title='bool'>reuse_variables</a> = True
<span class='lineno'> 245</span> 
<span class='lineno'> 246</span>           # Retain the summaries from the final tower.
<span class='lineno'> 247</span>           <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a> = tf.get_collection(tf.GraphKeys.SUMMARIES, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', title='?'>scope</a>)
<span class='lineno'> 248</span> 
<span class='lineno'> 249</span>           # Retain the Batch Normalization updates operations only from the
<span class='lineno'> 250</span>           # final tower. Ideally, we should grab the updates from all towers
<span class='lineno'> 251</span>           # but these stats accumulate extremely fast so we can ignore the
<span class='lineno'> 252</span>           # other stats from the other towers without significant detriment.
<span class='lineno'> 253</span>           <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates', title='?'>batchnorm_updates</a> = tf.get_collection(slim.ops.UPDATE_OPS_COLLECTION,
<span class='lineno'> 254</span>                                                 <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.scope', title='?'>scope</a>)
<span class='lineno'> 255</span> 
<span class='lineno'> 256</span>           # Calculate the gradients for the batch of data on this ImageNet
<span class='lineno'> 257</span>           # tower.
<span class='lineno'> 258</span>           <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', title='?'>grads</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', title='?'>opt</a>.compute_gradients(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', title='None'>loss</a>)
<span class='lineno'> 259</span> 
<span class='lineno'> 260</span>           # Keep track of the gradients across all towers.
<span class='lineno'> 261</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', title='[?]'>tower_grads</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', title='?'>grads</a>)
<span class='lineno'> 262</span> 
<span class='lineno'> 263</span>     # We must calculate the mean of each gradient. Note that this is the
<span class='lineno'> 264</span>     # synchronization point across all towers.
<span class='lineno'> 265</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', title='[(?, ?)]'>grads</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train._average_gradients', title='? -> [(?, ?)] / [?] -> [(?, ?)]'>_average_gradients</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.tower_grads', title='[?]'>tower_grads</a>)
<span class='lineno'> 266</span> 
<span class='lineno'> 267</span>     # Add a summaries for the input processing and global_step.
<span class='lineno'> 268</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a>.extend(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.input_summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.input_summaries', title='?'>input_summaries</a>)
<span class='lineno'> 269</span> 
<span class='lineno'> 270</span>     # Add a summary to track the learning rate.
<span class='lineno'> 271</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a>.append(tf.summary.scalar(&#39;learning_rate&#39;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.lr', title='?'>lr</a>))
<span class='lineno'> 272</span> 
<span class='lineno'> 273</span>     # Add histograms for gradients.
<span class='lineno'> 274</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', title='?'>grad</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', title='?'>var</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', title='[(?, ?)]'>grads</a>:
<span class='lineno'> 275</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', title='?'>grad</a> is not None:
<span class='lineno'> 276</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a>.append(
<span class='lineno'> 277</span>             tf.summary.histogram(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', title='?'>var</a>.op.name + &#39;/gradients&#39;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grad', title='?'>grad</a>))
<span class='lineno'> 278</span> 
<span class='lineno'> 279</span>     # Apply the gradients to adjust the shared variables.
<span class='lineno'> 280</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.apply_gradient_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.apply_gradient_op', title='?'>apply_gradient_op</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.opt', title='?'>opt</a>.apply_gradients(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.grads', title='[(?, ?)]'>grads</a>, global_step=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', title='?'>global_step</a>)
<span class='lineno'> 281</span> 
<span class='lineno'> 282</span>     # Add histograms for trainable variables.
<span class='lineno'> 283</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', title='?'>var</a> in tf.trainable_variables():
<span class='lineno'> 284</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a>.append(tf.summary.histogram(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', title='?'>var</a>.op.name, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.var', title='?'>var</a>))
<span class='lineno'> 285</span> 
<span class='lineno'> 286</span>     # Track the moving averages of all trainable variables.
<span class='lineno'> 287</span>     # Note that we maintain a &quot;double-average&quot; of the BatchNormalization
<span class='lineno'> 288</span>     # global statistics. This is more complicated then need be but we employ
<span class='lineno'> 289</span>     # this for backward-compatibility with our previous models.
<span class='lineno'> 290</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variable_averages', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variable_averages', title='?'>variable_averages</a> = tf.train.ExponentialMovingAverage(
<span class='lineno'> 291</span>         inception.MOVING_AVERAGE_DECAY, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.global_step', title='?'>global_step</a>)
<span class='lineno'> 292</span> 
<span class='lineno'> 293</span>     # Another possibility is to use tf.slim.get_variables().
<span class='lineno'> 294</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_average', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_average', title='?'>variables_to_average</a> = (tf.trainable_variables() +
<span class='lineno'> 295</span>                             tf.moving_average_variables())
<span class='lineno'> 296</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_averages_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_averages_op', title='?'>variables_averages_op</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variable_averages', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variable_averages', title='?'>variable_averages</a>.apply(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_average', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_average', title='?'>variables_to_average</a>)
<span class='lineno'> 297</span> 
<span class='lineno'> 298</span>     # Group all updates to into a single train op.
<span class='lineno'> 299</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates_op', title='?'>batchnorm_updates_op</a> = tf.group(*<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates', title='?'>batchnorm_updates</a>)
<span class='lineno'> 300</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.train_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.train_op', title='?'>train_op</a> = tf.group(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.apply_gradient_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.apply_gradient_op', title='?'>apply_gradient_op</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_averages_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_averages_op', title='?'>variables_averages_op</a>,
<span class='lineno'> 301</span>                         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.batchnorm_updates_op', title='?'>batchnorm_updates_op</a>)
<span class='lineno'> 302</span> 
<span class='lineno'> 303</span>     # Create a saver.
<span class='lineno'> 304</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.saver', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.saver', title='?'>saver</a> = tf.train.Saver(tf.global_variables())
<span class='lineno'> 305</span> 
<span class='lineno'> 306</span>     # Build the summary operation from the last tower summaries.
<span class='lineno'> 307</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_op', title='?'>summary_op</a> = tf.summary.merge(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summaries', title='?'>summaries</a>)
<span class='lineno'> 308</span> 
<span class='lineno'> 309</span>     # Build an initialization operation to run below.
<span class='lineno'> 310</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.init', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.init', title='?'>init</a> = tf.global_variables_initializer()
<span class='lineno'> 311</span> 
<span class='lineno'> 312</span>     # Start running operations on the Graph. allow_soft_placement must be set to
<span class='lineno'> 313</span>     # True to build towers on GPU, as some of the ops do not have GPU
<span class='lineno'> 314</span>     # implementations.
<span class='lineno'> 315</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a> = tf.Session(config=tf.ConfigProto(
<span class='lineno'> 316</span>         allow_soft_placement=True,
<span class='lineno'> 317</span>         log_device_placement=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.log_device_placement))
<span class='lineno'> 318</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>.run(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.init', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.init', title='?'>init</a>)
<span class='lineno'> 319</span> 
<span class='lineno'> 320</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.pretrained_model_checkpoint_path:
<span class='lineno'> 321</span>       assert tf.gfile.Exists(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.pretrained_model_checkpoint_path)
<span class='lineno'> 322</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_restore', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_restore', title='?'>variables_to_restore</a> = tf.get_collection(
<span class='lineno'> 323</span>           slim.variables.VARIABLES_TO_RESTORE)
<span class='lineno'> 324</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.restorer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.restorer', title='?'>restorer</a> = tf.train.Saver(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_restore', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.variables_to_restore', title='?'>variables_to_restore</a>)
<span class='lineno'> 325</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.restorer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.restorer', title='?'>restorer</a>.restore(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.pretrained_model_checkpoint_path)
<span class='lineno'> 326</span>       print(&#39;%s: Pre-trained model restored from %s&#39; %
<span class='lineno'> 327</span>             (datetime.now(), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.pretrained_model_checkpoint_path))
<span class='lineno'> 328</span> 
<span class='lineno'> 329</span>     # Start the queue runners.
<span class='lineno'> 330</span>     tf.train.start_queue_runners(sess=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>)
<span class='lineno'> 331</span> 
<span class='lineno'> 332</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_writer', title='?'>summary_writer</a> = tf.summary.FileWriter(
<span class='lineno'> 333</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.train_dir,
<span class='lineno'> 334</span>         graph=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>.graph)
<span class='lineno'> 335</span> 
<span class='lineno'> 336</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.max_steps):
<span class='lineno'> 337</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.start_time', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.start_time', title='int'>start_time</a> = time.time()
<span class='lineno'> 338</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train._', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train._', title='?'>_</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', title='?'>loss_value</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>.run([<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.train_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.train_op', title='?'>train_op</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss', title='None'>loss</a>])
<span class='lineno'> 339</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', title='int'>duration</a> = time.time() - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.start_time', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.start_time', title='int'>start_time</a>
<span class='lineno'> 340</span> 
<span class='lineno'> 341</span>       assert not np.isnan(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', title='?'>loss_value</a>), &#39;Model diverged with loss = NaN&#39;
<span class='lineno'> 342</span> 
<span class='lineno'> 343</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a> % 10 == 0:
<span class='lineno'> 344</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.examples_per_sec', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.examples_per_sec', title='float'>examples_per_sec</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.batch_size / float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', title='int'>duration</a>)
<span class='lineno'> 345</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.format_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.format_str', title='str'>format_str</a> = (&#39;%s: step %d, loss = %.2f (%.1f examples/sec; %.3f &#39;
<span class='lineno'> 346</span>                       &#39;sec/batch)&#39;)
<span class='lineno'> 347</span>         print(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.format_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.format_str', title='str'>format_str</a> % (datetime.now(), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.loss_value', title='?'>loss_value</a>,
<span class='lineno'> 348</span>                             <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.examples_per_sec', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.examples_per_sec', title='float'>examples_per_sec</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.duration', title='int'>duration</a>))
<span class='lineno'> 349</span> 
<span class='lineno'> 350</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a> % 100 == 0:
<span class='lineno'> 351</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_str', title='?'>summary_str</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>.run(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_op', title='?'>summary_op</a>)
<span class='lineno'> 352</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_writer', title='?'>summary_writer</a>.add_summary(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.summary_str', title='?'>summary_str</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a>)
<span class='lineno'> 353</span> 
<span class='lineno'> 354</span>       # Save the model checkpoint periodically.
<span class='lineno'> 355</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a> % 5000 == 0 or (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a> + 1) == <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.max_steps:
<span class='lineno'> 356</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.checkpoint_path', title='?'>checkpoint_path</a> = os.path.join(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.FLAGS', title='?'>FLAGS</a>.train_dir, &#39;model.ckpt&#39;)
<span class='lineno'> 357</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.saver', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.saver', title='?'>saver</a>.save(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.sess', title='?'>sess</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.checkpoint_path', title='?'>checkpoint_path</a>, global_step=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.inception.inception.inception_train.train.step', title='int'>step</a>)
</pre></td></tr></table></body></html>