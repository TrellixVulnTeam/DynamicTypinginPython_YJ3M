<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/research/street/python/shapes.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions', xid='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions'>rotate_dimensions</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape', xid='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape'>transposing_reshape</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim', xid='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim'>tensor_dim</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', xid='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape'>tensor_shape</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2016 The TensorFlow Authors. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> 
<span class='lineno'>  16</span> &quot;&quot;&quot;Shape manipulation functions.
<span class='lineno'>  17</span> 
<span class='lineno'>  18</span> rotate_dimensions: prepares for a rotating transpose by returning a rotated
<span class='lineno'>  19</span>   list of dimension indices.
<span class='lineno'>  20</span> transposing_reshape: allows a dimension to be factorized, with one of the pieces
<span class='lineno'>  21</span>   transferred to another dimension, or to transpose factors within a single
<span class='lineno'>  22</span>   dimension.
<span class='lineno'>  23</span> tensor_dim: gets a shape dimension as a constant integer if known otherwise a
<span class='lineno'>  24</span>   runtime usable tensor value.
<span class='lineno'>  25</span> tensor_shape: returns the full shape of a tensor as the tensor_dim.
<span class='lineno'>  26</span> &quot;&quot;&quot;
<span class='lineno'>  27</span> from six.moves import xrange
<span class='lineno'>  28</span> import tensorflow as tf
<span class='lineno'>  29</span> 
<span class='lineno'>  30</span> 
<span class='lineno'>  31</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions', title='(int, int, ?) -> [int] / (int, int, int) -> [int] / (?, ?, ?) -> [int]'>rotate_dimensions</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.num_dims', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.num_dims', title='int'>num_dims</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', title='int'>src_dim</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', title='int'>dest_dim</a>):
<span class='lineno'>  32</span>   &quot;&quot;&quot;Returns a list of dimension indices that will rotate src_dim to dest_dim.
<span class='lineno'>  33</span> 
<span class='lineno'>  34</span>   src_dim is moved to dest_dim, with all intervening dimensions shifted towards
<span class='lineno'>  35</span>   the hole left by src_dim. Eg:
<span class='lineno'>  36</span>   num_dims = 4, src_dim=3, dest_dim=1
<span class='lineno'>  37</span>   Returned list=[0, 3, 1, 2]
<span class='lineno'>  38</span>   For a tensor with dims=[5, 4, 3, 2] a transpose would yield [5, 2, 4, 3].
<span class='lineno'>  39</span>   Args:
<span class='lineno'>  40</span>     num_dims: The number of dimensions to handle.
<span class='lineno'>  41</span>     src_dim:  The dimension to move.
<span class='lineno'>  42</span>     dest_dim: The dimension to move src_dim to.
<span class='lineno'>  43</span> 
<span class='lineno'>  44</span>   Returns:
<span class='lineno'>  45</span>     A list of rotated dimension indices.
<span class='lineno'>  46</span>   &quot;&quot;&quot;
<span class='lineno'>  47</span>   # List of dimensions for transpose.
<span class='lineno'>  48</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a> = range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.num_dims', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.num_dims', title='int'>num_dims</a>)
<span class='lineno'>  49</span>   # Shuffle src_dim to dest_dim by swapping to shuffle up the other dims.
<span class='lineno'>  50</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', title='int'>step</a> = 1 if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', title='int'>dest_dim</a> &gt; <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', title='int'>src_dim</a> else -1
<span class='lineno'>  51</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', title='int'>x</a> in xrange(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.src_dim', title='int'>src_dim</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dest_dim', title='int'>dest_dim</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', title='int'>step</a>):
<span class='lineno'>  52</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', title='int'>x</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', title='int'>x</a> + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', title='int'>step</a>] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', title='int'>x</a> + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.step', title='int'>step</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.x', title='int'>x</a>]
<span class='lineno'>  53</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions.dim_list', title='[int]'>dim_list</a>
<span class='lineno'>  54</span> 
<span class='lineno'>  55</span> 
<span class='lineno'>  56</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape', title='(?, ?, ?, ?, ?, ?, None) -> None / (?, int, int, int, int, int, None) -> None / (None, int, int, int, int, int, None) -> None'>transposing_reshape</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', title='None'>tensor</a>,
<span class='lineno'>  57</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a>,
<span class='lineno'>  58</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', title='int'>part_a</a>,
<span class='lineno'>  59</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', title='int'>part_b</a>,
<span class='lineno'>  60</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', title='int'>dest_dim_a</a>,
<span class='lineno'>  61</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', title='int'>dest_dim_b</a>,
<span class='lineno'>  62</span>                         <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='None'>name</a>=None):
<span class='lineno'>  63</span>   &quot;&quot;&quot;Splits src_dim and sends one of the pieces to another dim.
<span class='lineno'>  64</span> 
<span class='lineno'>  65</span>   Terminology:
<span class='lineno'>  66</span>   A matrix is often described as &#39;row-major&#39; or &#39;column-major&#39;, which doesn&#39;t
<span class='lineno'>  67</span>   help if you can&#39;t remember which is the row index and which is the column,
<span class='lineno'>  68</span>   even if you know what &#39;major&#39; means, so here is a simpler explanation of it:
<span class='lineno'>  69</span>   When TF stores a tensor of size [d0, d1, d2, d3] indexed by [i0, i1, i2, i3],
<span class='lineno'>  70</span>   the memory address of an element is calculated using:
<span class='lineno'>  71</span>   ((i0 * d1 + i1) * d2 + i2) * d3 + i3, so, d0 is the MOST SIGNIFICANT dimension
<span class='lineno'>  72</span>   and d3 the LEAST SIGNIFICANT, just like in the decimal number 1234, 1 is the
<span class='lineno'>  73</span>   most significant digit and 4 the least significant. In both cases the most
<span class='lineno'>  74</span>   significant is multiplied by the largest number to determine its &#39;value&#39;.
<span class='lineno'>  75</span>   Furthermore, if we reshape the tensor to [d0&#39;=d0, d1&#39;=d1 x d2, d2&#39;=d3], then
<span class='lineno'>  76</span>   the MOST SIGNIFICANT part of d1&#39; is d1 and the LEAST SIGNIFICANT part of d1&#39;
<span class='lineno'>  77</span>   is d2.
<span class='lineno'>  78</span> 
<span class='lineno'>  79</span>   Action:
<span class='lineno'>  80</span>   transposing_reshape splits src_dim into factors [part_a, part_b], and sends
<span class='lineno'>  81</span>   the most significant part (of size  part_a) to be the most significant part of
<span class='lineno'>  82</span>   dest_dim_a*(Exception: see NOTE 2), and the least significant part (of size
<span class='lineno'>  83</span>   part_b) to be the most significant part of dest_dim_b.
<span class='lineno'>  84</span>   This is basically a combination of reshape, rotating transpose, reshape.
<span class='lineno'>  85</span>   NOTE1: At least one of dest_dim_a and dest_dim_b must equal src_dim, ie one of
<span class='lineno'>  86</span>   the parts always stays put, so src_dim is never totally destroyed and the
<span class='lineno'>  87</span>   output number of dimensions is always the same as the input.
<span class='lineno'>  88</span>   NOTE2: If dest_dim_a == dest_dim_b == src_dim, then parts a and b are simply
<span class='lineno'>  89</span>   transposed within src_dim to become part_b x part_a, so the most significant
<span class='lineno'>  90</span>   part becomes the least significant part and vice versa. Thus if you really
<span class='lineno'>  91</span>   wanted to make one of the parts the least significant side of the destiantion,
<span class='lineno'>  92</span>   the destination dimension can be internally transposed with a second call to
<span class='lineno'>  93</span>   transposing_reshape.
<span class='lineno'>  94</span>   NOTE3: One of part_a and part_b may be -1 to allow src_dim to be of unknown
<span class='lineno'>  95</span>   size with one known-size factor. Otherwise part_a * part_b must equal the size
<span class='lineno'>  96</span>   of src_dim.
<span class='lineno'>  97</span>   NOTE4: The reshape preserves as many known-at-graph-build-time dimension sizes
<span class='lineno'>  98</span>   as are available.
<span class='lineno'>  99</span> 
<span class='lineno'> 100</span>   Example:
<span class='lineno'> 101</span>   Input dims=[5, 2, 6, 2]
<span class='lineno'> 102</span>   tensor=[[[[0, 1][2, 3][4, 5][6, 7][8, 9][10, 11]]
<span class='lineno'> 103</span>            [[12, 13][14, 15][16, 17][18, 19][20, 21][22, 23]]
<span class='lineno'> 104</span>           [[[24, 25]...
<span class='lineno'> 105</span>   src_dim=2, part_a=2, part_b=3, dest_dim_a=3, dest_dim_b=2
<span class='lineno'> 106</span>   output dims =[5, 2, 3, 4]
<span class='lineno'> 107</span>   output tensor=[[[[0, 1, 6, 7][2, 3, 8, 9][4, 5, 10, 11]]
<span class='lineno'> 108</span>                   [[12, 13, 18, 19][14, 15, 20, 21][16, 17, 22, 23]]]
<span class='lineno'> 109</span>                  [[[24, 26, 28]...
<span class='lineno'> 110</span>   Example2:
<span class='lineno'> 111</span>   Input dims=[phrases, words, letters]=[2, 6, x]
<span class='lineno'> 112</span>   tensor=[[[the][cat][sat][on][the][mat]]
<span class='lineno'> 113</span>          [[a][stitch][in][time][saves][nine]]]
<span class='lineno'> 114</span>   We can factorize the 6 words into 3x2 = [[the][cat]][[sat][on]][[the][mat]]
<span class='lineno'> 115</span>   or 2x3=[[the][cat][sat]][[on][the][mat]] and
<span class='lineno'> 116</span>   src_dim=1, part_a=3, part_b=2, dest_dim_a=1, dest_dim_b=1
<span class='lineno'> 117</span>   would yield:
<span class='lineno'> 118</span>   [[[the][sat][the][cat][on][mat]]
<span class='lineno'> 119</span>    [[a][in][saves][stitch][time][nine]]], but
<span class='lineno'> 120</span>   src_dim=1, part_a=2, part_b=3, dest_dim_a=1, dest_dim_b=1
<span class='lineno'> 121</span>   would yield:
<span class='lineno'> 122</span>   [[[the][on][cat][the][sat][mat]]
<span class='lineno'> 123</span>    [[a][time][stitch][saves][in][nine]]], and
<span class='lineno'> 124</span>   src_dim=1, part_a=2, part_b=3, dest_dim_a=0, dest_dim_b=1
<span class='lineno'> 125</span>   would yield:
<span class='lineno'> 126</span>   [[[the][cat][sat]]
<span class='lineno'> 127</span>    [[a][stitch][in]]
<span class='lineno'> 128</span>    [[on][the][mat]]
<span class='lineno'> 129</span>    [[time][saves][nine]]]
<span class='lineno'> 130</span>   Now remember that the words above represent any least-significant subset of
<span class='lineno'> 131</span>   the input dimensions.
<span class='lineno'> 132</span> 
<span class='lineno'> 133</span>   Args:
<span class='lineno'> 134</span>     tensor:     A tensor to reshape.
<span class='lineno'> 135</span>     src_dim:    The dimension to split.
<span class='lineno'> 136</span>     part_a:     The first factor of the split.
<span class='lineno'> 137</span>     part_b:     The second factor of the split.
<span class='lineno'> 138</span>     dest_dim_a: The dimension to move part_a of src_dim to.
<span class='lineno'> 139</span>     dest_dim_b: The dimension to move part_b of src_dim to.
<span class='lineno'> 140</span>     name:       Optional base name for all the ops.
<span class='lineno'> 141</span> 
<span class='lineno'> 142</span>   Returns:
<span class='lineno'> 143</span>     Reshaped tensor.
<span class='lineno'> 144</span> 
<span class='lineno'> 145</span>   Raises:
<span class='lineno'> 146</span>     ValueError: If the args are invalid.
<span class='lineno'> 147</span>   &quot;&quot;&quot;
<span class='lineno'> 148</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', title='int'>dest_dim_a</a> != <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', title='int'>dest_dim_b</a> != <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a>:
<span class='lineno'> 149</span>     raise ValueError(
<span class='lineno'> 150</span>         &#39;At least one of dest_dim_a, dest_dim_b must equal src_dim!&#39;)
<span class='lineno'> 151</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', title='int'>part_a</a> == 0 or <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', title='int'>part_b</a> == 0:
<span class='lineno'> 152</span>     raise ValueError(&#39;Zero not allowed for part_a or part_b!&#39;)
<span class='lineno'> 153</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', title='int'>part_a</a> &lt; 0 and <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', title='int'>part_b</a> &lt; 0:
<span class='lineno'> 154</span>     raise ValueError(&#39;At least one of part_a and part_b must be positive!&#39;)
<span class='lineno'> 155</span>   if not <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='None'>name</a>:
<span class='lineno'> 156</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='str'>name</a> = &#39;transposing_reshape&#39;
<span class='lineno'> 157</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', title='[None]'>prev_shape</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', title='None -> [None] / ? -> [None]'>tensor_shape</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', title='None'>tensor</a>)
<span class='lineno'> 158</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a> = tf.reshape(
<span class='lineno'> 159</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.tensor', title='None'>tensor</a>,
<span class='lineno'> 160</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', title='[None]'>prev_shape</a>[:<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a>] + [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_a', title='int'>part_a</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.part_b', title='int'>part_b</a>] + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.prev_shape', title='[None]'>prev_shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a> + 1:],
<span class='lineno'> 161</span>       name=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='str'>name</a> + &#39;_reshape_in&#39;)
<span class='lineno'> 162</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_b', title='int'>dest_dim_b</a>
<span class='lineno'> 163</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', title='int'>dest_dim_a</a> != <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a>:
<span class='lineno'> 164</span>     # We are just moving part_a to dest_dim_a.
<span class='lineno'> 165</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest_dim_a', title='int'>dest_dim_a</a>
<span class='lineno'> 166</span>   else:
<span class='lineno'> 167</span>     # We are moving part_b to dest_dim_b.
<span class='lineno'> 168</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a></a> += 1
<span class='lineno'> 169</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dim_list', title='[int]'>dim_list</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.rotate_dimensions', title='(int, int, ?) -> [int] / (int, int, int) -> [int] / (?, ?, ?) -> [int]'>rotate_dimensions</a>(len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a>.get_shape()), <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.src_dim', title='int'>src_dim</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a>)
<span class='lineno'> 170</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dim_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dim_list', title='[int]'>dim_list</a>, name=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='str'>name</a> + &#39;_rot_transpose&#39;)
<span class='lineno'> 171</span>   # Reshape identity except dest,dest+1, which get merged.
<span class='lineno'> 172</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', title='[None]'>ex_shape</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', title='None -> [None] / ? -> [None]'>tensor_shape</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a>)
<span class='lineno'> 173</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.combined', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.combined', title='{None | list}'>combined</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', title='[None]'>ex_shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a>] * <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', title='[None]'>ex_shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a> + 1]
<span class='lineno'> 174</span>   return tf.reshape(
<span class='lineno'> 175</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.expanded', title='?'>expanded</a>,
<span class='lineno'> 176</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', title='[None]'>ex_shape</a>[:<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a>] + [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.combined', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.combined', title='{None | list}'>combined</a>] + <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.ex_shape', title='[None]'>ex_shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.dest', title='int'>dest</a> + 2:],
<span class='lineno'> 177</span>       name=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.transposing_reshape.name', title='str'>name</a> + &#39;_reshape_out&#39;)
<span class='lineno'> 178</span> 
<span class='lineno'> 179</span> 
<span class='lineno'> 180</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim', title='(?, ?) -> None / (None, int) -> None / (?, int) -> None'>tensor_dim</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', title='None'>tensor</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', title='int'>dim</a>):
<span class='lineno'> 181</span>   &quot;&quot;&quot;Returns int dimension if known at a graph build time else a tensor.
<span class='lineno'> 182</span> 
<span class='lineno'> 183</span>   If the size of the dim of tensor is known at graph building time, then that
<span class='lineno'> 184</span>   known value is returned, otherwise (instead of None), a Tensor that will give
<span class='lineno'> 185</span>   the size of the dimension when the graph is run. The return value will be
<span class='lineno'> 186</span>   accepted by tf.reshape in multiple (or even all) dimensions, even when the
<span class='lineno'> 187</span>   sizes are not known at graph building time, unlike -1, which can only be used
<span class='lineno'> 188</span>   in one dimension. It is a bad idea to use tf.shape all the time, as some ops
<span class='lineno'> 189</span>   demand a known (at graph build time) size. This function therefore returns
<span class='lineno'> 190</span>   the best available, most useful dimension size.
<span class='lineno'> 191</span>   Args:
<span class='lineno'> 192</span>     tensor: Input tensor.
<span class='lineno'> 193</span>     dim:    Dimension to find the size of.
<span class='lineno'> 194</span> 
<span class='lineno'> 195</span>   Returns:
<span class='lineno'> 196</span>     An integer if shape is known at build time, otherwise a tensor of int32.
<span class='lineno'> 197</span>   &quot;&quot;&quot;
<span class='lineno'> 198</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', title='?'>result</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', title='None'>tensor</a>.get_shape().as_list()[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', title='int'>dim</a>]
<span class='lineno'> 199</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', title='?'>result</a> is None:
<span class='lineno'> 200</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', title='?'>result</a> = tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.tensor', title='None'>tensor</a>)[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.dim', title='int'>dim</a>]
<span class='lineno'> 201</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim.result', title='?'>result</a>
<span class='lineno'> 202</span> 
<span class='lineno'> 203</span> 
<span class='lineno'> 204</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape', title='None -> [None] / ? -> [None]'>tensor_shape</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', title='None'>tensor</a>):
<span class='lineno'> 205</span>   &quot;&quot;&quot;Returns a heterogeneous list of tensor_dim for the tensor.
<span class='lineno'> 206</span> 
<span class='lineno'> 207</span>   See tensor_dim for a more detailed explanation.
<span class='lineno'> 208</span>   Args:
<span class='lineno'> 209</span>     tensor: Input tensor.
<span class='lineno'> 210</span> 
<span class='lineno'> 211</span>   Returns:
<span class='lineno'> 212</span>     A heterogeneous list of integers and int32 tensors.
<span class='lineno'> 213</span>   &quot;&quot;&quot;
<span class='lineno'> 214</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', title='[None]'>result</a> = []
<span class='lineno'> 215</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.d', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.d', title='int'>d</a> in xrange(len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', title='None'>tensor</a>.get_shape())):
<span class='lineno'> 216</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', title='[None]'>result</a>.append(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_dim', title='(?, ?) -> None / (None, int) -> None / (?, int) -> None'>tensor_dim</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.tensor', title='None'>tensor</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.d', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.d', title='int'>d</a>))
<span class='lineno'> 217</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.street.python.shapes.tensor_shape.result', title='[None]'>result</a>
</pre></td></tr></table></body></html>