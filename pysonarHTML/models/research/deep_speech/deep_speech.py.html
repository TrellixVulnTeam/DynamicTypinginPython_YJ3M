<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/research/deep_speech/deep_speech.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE'>_VOCABULARY_FILE</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY'>_WER_KEY</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY'>_CER_KEY</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv'>compute_length_after_conv</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss'>ctc_loss</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model'>evaluate_model</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset'>dataset</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn'>model_fn</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset'>generate_dataset</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size'>per_device_batch_size</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech'>run_deep_speech</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags'>define_deep_speech_flags</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main'>main</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj'>flags_obj</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2018 The TensorFlow Authors. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;Main entry to train and evaluate DeepSpeech model.&quot;&quot;&quot;
<span class='lineno'>  16</span> from __future__ import absolute_import
<span class='lineno'>  17</span> from __future__ import division
<span class='lineno'>  18</span> from __future__ import print_function
<span class='lineno'>  19</span> 
<span class='lineno'>  20</span> import os
<span class='lineno'>  21</span> # pylint: disable=g-bad-import-order
<span class='lineno'>  22</span> from absl import app as absl_app
<span class='lineno'>  23</span> from absl import flags
<span class='lineno'>  24</span> import tensorflow as tf
<span class='lineno'>  25</span> # pylint: enable=g-bad-import-order
<span class='lineno'>  26</span> 
<span class='lineno'>  27</span> import <a href='data/__init__.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data', title='data'>data</a>.dataset as <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>
<span class='lineno'>  28</span> import <a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder', title='decoder'>decoder</a>
<span class='lineno'>  29</span> import <a href='deep_speech_model.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', title='deep_speech_model'>deep_speech_model</a>
<span class='lineno'>  30</span> from official.utils.flags import core as flags_core
<span class='lineno'>  31</span> from official.utils.logs import hooks_helper
<span class='lineno'>  32</span> from official.utils.logs import logger
<span class='lineno'>  33</span> from official.utils.misc import distribution_utils
<span class='lineno'>  34</span> from official.utils.misc import model_helpers
<span class='lineno'>  35</span> 
<span class='lineno'>  36</span> # Default vocabulary file
<span class='lineno'>  37</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE', title='str'>_VOCABULARY_FILE</a> = os.path.join(
<span class='lineno'>  38</span>     os.path.dirname(__file__), &quot;data/vocabulary.txt&quot;)
<span class='lineno'>  39</span> # Evaluation metrics
<span class='lineno'>  40</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', title='str'>_WER_KEY</a> = &quot;WER&quot;
<span class='lineno'>  41</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', title='str'>_CER_KEY</a> = &quot;CER&quot;
<span class='lineno'>  42</span> 
<span class='lineno'>  43</span> 
<span class='lineno'>  44</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv', title='(?, ?, ?) -> None'>compute_length_after_conv</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.max_time_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.max_time_steps', title='?'>max_time_steps</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_time_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_time_steps', title='?'>ctc_time_steps</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.input_length', title='?'>input_length</a>):
<span class='lineno'>  45</span>   &quot;&quot;&quot;Computes the time_steps/ctc_input_length after convolution.
<span class='lineno'>  46</span> 
<span class='lineno'>  47</span>   Suppose that the original feature contains two parts:
<span class='lineno'>  48</span>   1) Real spectrogram signals, spanning input_length steps.
<span class='lineno'>  49</span>   2) Padded part with all 0s.
<span class='lineno'>  50</span>   The total length of those two parts is denoted as max_time_steps, which is
<span class='lineno'>  51</span>   the padded length of the current batch. After convolution layers, the time
<span class='lineno'>  52</span>   steps of a spectrogram feature will be decreased. As we know the percentage
<span class='lineno'>  53</span>   of its original length within the entire length, we can compute the time steps
<span class='lineno'>  54</span>   for the signal after conv as follows (using ctc_input_length to denote):
<span class='lineno'>  55</span>   ctc_input_length = (input_length / max_time_steps) * output_length_of_conv.
<span class='lineno'>  56</span>   This length is then fed into ctc loss function to compute loss.
<span class='lineno'>  57</span> 
<span class='lineno'>  58</span>   Args:
<span class='lineno'>  59</span>     max_time_steps: max_time_steps for the batch, after padding.
<span class='lineno'>  60</span>     ctc_time_steps: number of timesteps after convolution.
<span class='lineno'>  61</span>     input_length: actual length of the original spectrogram, without padding.
<span class='lineno'>  62</span> 
<span class='lineno'>  63</span>   Returns:
<span class='lineno'>  64</span>     the ctc_input_length after convolution layer.
<span class='lineno'>  65</span>   &quot;&quot;&quot;
<span class='lineno'>  66</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_input_length', title='?'>ctc_input_length</a> = tf.to_float(tf.multiply(
<span class='lineno'>  67</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.input_length', title='?'>input_length</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_time_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_time_steps', title='?'>ctc_time_steps</a>))
<span class='lineno'>  68</span>   return tf.to_int32(tf.floordiv(
<span class='lineno'>  69</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.ctc_input_length', title='?'>ctc_input_length</a>, tf.to_float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.max_time_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv.max_time_steps', title='?'>max_time_steps</a>)))
<span class='lineno'>  70</span> 
<span class='lineno'>  71</span> 
<span class='lineno'>  72</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss', title='(?, ?, ?, ?) -> None / (?, None, ?, ?) -> None'>ctc_loss</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', title='?'>label_length</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', title='None'>ctc_input_length</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.labels', title='?'>labels</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.logits', title='?'>logits</a>):
<span class='lineno'>  73</span>   &quot;&quot;&quot;Computes the ctc loss for the current batch of predictions.&quot;&quot;&quot;
<span class='lineno'>  74</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', title='?'>label_length</a> = tf.to_int32(tf.squeeze(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', title='?'>label_length</a>))
<span class='lineno'>  75</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', title='?'>ctc_input_length</a> = tf.to_int32(tf.squeeze(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', title='None'>ctc_input_length</a>))
<span class='lineno'>  76</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.sparse_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.sparse_labels', title='?'>sparse_labels</a> = tf.to_int32(
<span class='lineno'>  77</span>       tf.keras.backend.ctc_label_dense_to_sparse(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.labels', title='?'>labels</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.label_length', title='?'>label_length</a>))
<span class='lineno'>  78</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.y_pred', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.y_pred', title='?'>y_pred</a> = tf.log(tf.transpose(
<span class='lineno'>  79</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.logits', title='?'>logits</a>, perm=[1, 0, 2]) + tf.keras.backend.epsilon())
<span class='lineno'>  80</span> 
<span class='lineno'>  81</span>   return tf.expand_dims(
<span class='lineno'>  82</span>       tf.nn.ctc_loss(labels=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.sparse_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.sparse_labels', title='?'>sparse_labels</a>, inputs=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.y_pred', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.y_pred', title='?'>y_pred</a>,
<span class='lineno'>  83</span>                      sequence_length=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss.ctc_input_length', title='?'>ctc_input_length</a>),
<span class='lineno'>  84</span>       axis=1)
<span class='lineno'>  85</span> 
<span class='lineno'>  86</span> 
<span class='lineno'>  87</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model', title='(?, ?, ?, ?) -> dict / (?, ?, {[?] | [tuple]}, () -> None) -> dict'>evaluate_model</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', title='?'>estimator</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.speech_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.speech_labels', title='?'>speech_labels</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entries', title='{[?] | [tuple]}'>entries</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.input_fn_eval', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.input_fn_eval', title='() -> None'>input_fn_eval</a>):
<span class='lineno'>  88</span>   &quot;&quot;&quot;Evaluate the model performance using WER anc CER as metrics.
<span class='lineno'>  89</span> 
<span class='lineno'>  90</span>   WER: Word Error Rate
<span class='lineno'>  91</span>   CER: Character Error Rate
<span class='lineno'>  92</span> 
<span class='lineno'>  93</span>   Args:
<span class='lineno'>  94</span>     estimator: estimator to evaluate.
<span class='lineno'>  95</span>     speech_labels: a string specifying all the character in the vocabulary.
<span class='lineno'>  96</span>     entries: a list of data entries (audio_file, file_size, transcript) for the
<span class='lineno'>  97</span>       given <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.
<span class='lineno'>  98</span>     input_fn_eval: data input function for evaluation.
<span class='lineno'>  99</span> 
<span class='lineno'> 100</span>   Returns:
<span class='lineno'> 101</span>     Evaluation result containing &#39;wer&#39; and &#39;cer&#39; as two metrics.
<span class='lineno'> 102</span>   &quot;&quot;&quot;
<span class='lineno'> 103</span>   # Get predictions
<span class='lineno'> 104</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.predictions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.predictions', title='?'>predictions</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', title='?'>estimator</a>.predict(input_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.input_fn_eval', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.input_fn_eval', title='() -> None'>input_fn_eval</a>)
<span class='lineno'> 105</span> 
<span class='lineno'> 106</span>   # Get probabilities of each predicted class
<span class='lineno'> 107</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', title='[?]'>probs</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', title='?'>pred</a>[&quot;probabilities&quot;] for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.pred', title='?'>pred</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.predictions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.predictions', title='?'>predictions</a>]
<span class='lineno'> 108</span> 
<span class='lineno'> 109</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', title='int'>num_of_examples</a> = len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', title='[?]'>probs</a>)
<span class='lineno'> 110</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', title='[?]'>targets</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', title='?'>entry</a>[2] for <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entry', title='?'>entry</a></a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.entries', title='{[?] | [tuple]}'>entries</a>]  # The ground truth transcript
<span class='lineno'> 111</span> 
<span class='lineno'> 112</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'>total_wer</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'>total_cer</a> = 0, 0
<span class='lineno'> 113</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', title='DeepSpeechDecoder'>greedy_decoder</a> = <a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder', title='decoder'>decoder</a>.<a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder', title='<DeepSpeechDecoder>'>DeepSpeechDecoder</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.speech_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.speech_labels', title='?'>speech_labels</a>)
<span class='lineno'> 114</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', title='int'>num_of_examples</a>):
<span class='lineno'> 115</span>     # Decode string.
<span class='lineno'> 116</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', title='str'>decoded_str</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', title='DeepSpeechDecoder'>greedy_decoder</a>.<a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.decode', title='(DeepSpeechDecoder, ?) -> str'>decode</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.probs', title='[?]'>probs</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a>])
<span class='lineno'> 117</span>     # Compute CER.
<span class='lineno'> 118</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'>total_cer</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', title='DeepSpeechDecoder'>greedy_decoder</a>.<a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.cer', title='(DeepSpeechDecoder, ?, ?) -> None / (DeepSpeechDecoder, str, ?) -> None'>cer</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', title='str'>decoded_str</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', title='[?]'>targets</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a>]) / float(
<span class='lineno'> 119</span>         len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', title='[?]'>targets</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a>]))
<span class='lineno'> 120</span>     # Compute WER.
<span class='lineno'> 121</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'>total_wer</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.greedy_decoder', title='DeepSpeechDecoder'>greedy_decoder</a>.<a href='decoder.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.decoder.DeepSpeechDecoder.wer', title='(DeepSpeechDecoder, ?, ?) -> None / (DeepSpeechDecoder, str, ?) -> None'>wer</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.decoded_str', title='str'>decoded_str</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', title='[?]'>targets</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a>]) / float(
<span class='lineno'> 122</span>         len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.targets', title='[?]'>targets</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.i', title='int'>i</a>].split()))
<span class='lineno'> 123</span> 
<span class='lineno'> 124</span>   # Get mean value
<span class='lineno'> 125</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'>total_cer</a></a> /= <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', title='int'>num_of_examples</a>
<span class='lineno'> 126</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'><a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'>total_wer</a></a> /= <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.num_of_examples', title='int'>num_of_examples</a>
<span class='lineno'> 127</span> 
<span class='lineno'> 128</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.global_step', title='?'>global_step</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.estimator', title='?'>estimator</a>.get_variable_value(tf.GraphKeys.GLOBAL_STEP)
<span class='lineno'> 129</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.eval_results', title='dict'>eval_results</a> = {
<span class='lineno'> 130</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', title='str'>_WER_KEY</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_wer', title='int'>total_wer</a>,
<span class='lineno'> 131</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', title='str'>_CER_KEY</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.total_cer', title='int'>total_cer</a>,
<span class='lineno'> 132</span>       tf.GraphKeys.GLOBAL_STEP: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.global_step', title='?'>global_step</a>,
<span class='lineno'> 133</span>   }
<span class='lineno'> 134</span> 
<span class='lineno'> 135</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model.eval_results', title='dict'>eval_results</a>
<span class='lineno'> 136</span> 
<span class='lineno'> 137</span> 
<span class='lineno'> 138</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn', title='(?, ?, ?, ?) -> None'>model_fn</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.labels', title='?'>labels</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', title='?'>mode</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.params', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.params', title='?'>params</a>):
<span class='lineno'> 139</span>   &quot;&quot;&quot;Define model function for deep speech model.
<span class='lineno'> 140</span> 
<span class='lineno'> 141</span>   Args:
<span class='lineno'> 142</span>     features: a dictionary of input_data features. It includes the data
<span class='lineno'> 143</span>       input_length, label_length and the spectrogram features.
<span class='lineno'> 144</span>     labels: a list of labels for the input data.
<span class='lineno'> 145</span>     mode: current estimator mode; should be one of
<span class='lineno'> 146</span>       `tf.estimator.ModeKeys.TRAIN`, `EVALUATE`, `PREDICT`.
<span class='lineno'> 147</span>     params: a dict of hyper parameters to be passed to model_fn.
<span class='lineno'> 148</span> 
<span class='lineno'> 149</span>   Returns:
<span class='lineno'> 150</span>     EstimatorSpec parameterized according to the input params and the
<span class='lineno'> 151</span>     current mode.
<span class='lineno'> 152</span>   &quot;&quot;&quot;
<span class='lineno'> 153</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.num_classes', title='?'>num_classes</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.params', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.params', title='?'>params</a>[&quot;num_classes&quot;]
<span class='lineno'> 154</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.input_length', title='?'>input_length</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>[&quot;input_length&quot;]
<span class='lineno'> 155</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.label_length', title='?'>label_length</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>[&quot;label_length&quot;]
<span class='lineno'> 156</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>[&quot;features&quot;]
<span class='lineno'> 157</span> 
<span class='lineno'> 158</span>   # Create DeepSpeech2 model.
<span class='lineno'> 159</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', title='DeepSpeech2'>model</a> = <a href='deep_speech_model.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', title='deep_speech_model'>deep_speech_model</a>.<a href='deep_speech_model.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model.DeepSpeech2', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model.DeepSpeech2', title='<DeepSpeech2>'>DeepSpeech2</a>(
<span class='lineno'> 160</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_hidden_layers, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_type,
<span class='lineno'> 161</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.is_bidirectional, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_hidden_size,
<span class='lineno'> 162</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.num_classes', title='?'>num_classes</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.use_bias)
<span class='lineno'> 163</span> 
<span class='lineno'> 164</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', title='?'>mode</a> == tf.estimator.ModeKeys.PREDICT:
<span class='lineno'> 165</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', title='DeepSpeech2'>model</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>, training=False)
<span class='lineno'> 166</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.predictions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.predictions', title='dict'>predictions</a> = {
<span class='lineno'> 167</span>         &quot;classes&quot;: tf.argmax(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a>, axis=2),
<span class='lineno'> 168</span>         &quot;probabilities&quot;: tf.nn.softmax(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a>),
<span class='lineno'> 169</span>         &quot;logits&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a>
<span class='lineno'> 170</span>     }
<span class='lineno'> 171</span>     return tf.estimator.EstimatorSpec(
<span class='lineno'> 172</span>         mode=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', title='?'>mode</a>,
<span class='lineno'> 173</span>         predictions=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.predictions', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.predictions', title='dict'>predictions</a>)
<span class='lineno'> 174</span> 
<span class='lineno'> 175</span>   # In training mode.
<span class='lineno'> 176</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.model', title='DeepSpeech2'>model</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>, training=True)
<span class='lineno'> 177</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', title='?'>probs</a> = tf.nn.softmax(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.logits', title='?'>logits</a>)
<span class='lineno'> 178</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.ctc_input_length', title='None'>ctc_input_length</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.compute_length_after_conv', title='(?, ?, ?) -> None'>compute_length_after_conv</a>(
<span class='lineno'> 179</span>       tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.features', title='?'>features</a>)[1], tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', title='?'>probs</a>)[1], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.input_length', title='?'>input_length</a>)
<span class='lineno'> 180</span>   # Compute CTC loss
<span class='lineno'> 181</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', title='?'>loss</a> = tf.reduce_mean(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.ctc_loss', title='(?, ?, ?, ?) -> None / (?, None, ?, ?) -> None'>ctc_loss</a>(
<span class='lineno'> 182</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.label_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.label_length', title='?'>label_length</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.ctc_input_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.ctc_input_length', title='None'>ctc_input_length</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.labels', title='?'>labels</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.probs', title='?'>probs</a>))
<span class='lineno'> 183</span> 
<span class='lineno'> 184</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.optimizer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.optimizer', title='?'>optimizer</a> = tf.train.AdamOptimizer(learning_rate=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.learning_rate)
<span class='lineno'> 185</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.global_step', title='?'>global_step</a> = tf.train.get_or_create_global_step()
<span class='lineno'> 186</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.minimize_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.minimize_op', title='?'>minimize_op</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.optimizer', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.optimizer', title='?'>optimizer</a>.minimize(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', title='?'>loss</a>, global_step=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.global_step', title='?'>global_step</a>)
<span class='lineno'> 187</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.update_ops', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.update_ops', title='?'>update_ops</a> = tf.get_collection(tf.GraphKeys.UPDATE_OPS)
<span class='lineno'> 188</span>   # Create the train_op that groups both minimize_ops and update_ops
<span class='lineno'> 189</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.train_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.train_op', title='?'>train_op</a> = tf.group(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.minimize_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.minimize_op', title='?'>minimize_op</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.update_ops', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.update_ops', title='?'>update_ops</a>)
<span class='lineno'> 190</span> 
<span class='lineno'> 191</span>   return tf.estimator.EstimatorSpec(
<span class='lineno'> 192</span>       mode=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.mode', title='?'>mode</a>,
<span class='lineno'> 193</span>       loss=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.loss', title='?'>loss</a>,
<span class='lineno'> 194</span>       train_op=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.train_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn.train_op', title='?'>train_op</a>)
<span class='lineno'> 195</span> 
<span class='lineno'> 196</span> 
<span class='lineno'> 197</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', title='? -> DeepSpeechDataset'>generate_dataset</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.data_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.data_dir', title='?'>data_dir</a>):
<span class='lineno'> 198</span>   &quot;&quot;&quot;Generate a speech dataset.&quot;&quot;&quot;
<span class='lineno'> 199</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.audio_conf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.audio_conf', title='AudioConfig'>audio_conf</a> = <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.AudioConfig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.AudioConfig', title='<AudioConfig>'>AudioConfig</a>(sample_rate=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.sample_rate,
<span class='lineno'> 200</span>                                    window_ms=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.window_ms,
<span class='lineno'> 201</span>                                    stride_ms=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.stride_ms,
<span class='lineno'> 202</span>                                    normalize=True)
<span class='lineno'> 203</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.train_data_conf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.train_data_conf', title='DatasetConfig'>train_data_conf</a> = <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DatasetConfig', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DatasetConfig', title='<DatasetConfig>'>DatasetConfig</a>(
<span class='lineno'> 204</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.audio_conf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.audio_conf', title='AudioConfig'>audio_conf</a>,
<span class='lineno'> 205</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.data_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.data_dir', title='?'>data_dir</a>,
<span class='lineno'> 206</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.vocabulary_file,
<span class='lineno'> 207</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.sortagrad
<span class='lineno'> 208</span>   )
<span class='lineno'> 209</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.speech_dataset', title='DeepSpeechDataset'>speech_dataset</a> = <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset', title='<DeepSpeechDataset>'>DeepSpeechDataset</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.train_data_conf', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.train_data_conf', title='DatasetConfig'>train_data_conf</a>)
<span class='lineno'> 210</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset.speech_dataset', title='DeepSpeechDataset'>speech_dataset</a>
<span class='lineno'> 211</span> 
<span class='lineno'> 212</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size', title='(?, ?) -> int'>per_device_batch_size</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', title='?'>num_gpus</a>):
<span class='lineno'> 213</span>   &quot;&quot;&quot;For multi-gpu, batch-size must be a multiple of the number of GPUs.
<span class='lineno'> 214</span> 
<span class='lineno'> 215</span> 
<span class='lineno'> 216</span>   Note that distribution strategy handles this automatically when used with
<span class='lineno'> 217</span>   Keras. For using with Estimator, we need to get per GPU batch.
<span class='lineno'> 218</span> 
<span class='lineno'> 219</span>   Args:
<span class='lineno'> 220</span>     batch_size: Global batch size to be divided among devices. This should be
<span class='lineno'> 221</span>       equal to num_gpus times the single-GPU batch_size for multi-gpu training.
<span class='lineno'> 222</span>     num_gpus: How many GPUs are used with DistributionStrategies.
<span class='lineno'> 223</span> 
<span class='lineno'> 224</span>   Returns:
<span class='lineno'> 225</span>     Batch size per device.
<span class='lineno'> 226</span> 
<span class='lineno'> 227</span>   Raises:
<span class='lineno'> 228</span>     ValueError: if batch_size is not divisible by number of devices
<span class='lineno'> 229</span>   &quot;&quot;&quot;
<span class='lineno'> 230</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', title='?'>num_gpus</a> &lt;= 1:
<span class='lineno'> 231</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a>
<span class='lineno'> 232</span> 
<span class='lineno'> 233</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', title='?'>remainder</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a> % <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', title='?'>num_gpus</a>
<span class='lineno'> 234</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', title='?'>remainder</a>:
<span class='lineno'> 235</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.err', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.err', title='?'>err</a> = (&#39;When running with multiple GPUs, batch size &#39;
<span class='lineno'> 236</span>            &#39;must be a multiple of the number of available GPUs. Found {} &#39;
<span class='lineno'> 237</span>            &#39;GPUs with a batch size of {}; try --batch_size={} instead.&#39;
<span class='lineno'> 238</span>           ).format(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', title='?'>num_gpus</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.remainder', title='?'>remainder</a>)
<span class='lineno'> 239</span>     raise ValueError(err)
<span class='lineno'> 240</span>   return int(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.batch_size', title='?'>batch_size</a> / <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size.num_gpus', title='?'>num_gpus</a>)
<span class='lineno'> 241</span> 
<span class='lineno'> 242</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech', title='? -> None'>run_deep_speech</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech._', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech._', title='?'>_</a>):
<span class='lineno'> 243</span>   &quot;&quot;&quot;Run deep speech training and eval loop.&quot;&quot;&quot;
<span class='lineno'> 244</span>   tf.set_random_seed(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.seed)
<span class='lineno'> 245</span>   # Data preprocessing
<span class='lineno'> 246</span>   tf.logging.info(&quot;Data preprocessing...&quot;)
<span class='lineno'> 247</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', title='DeepSpeechDataset'>train_speech_dataset</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', title='? -> DeepSpeechDataset'>generate_dataset</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.train_data_dir)
<span class='lineno'> 248</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', title='DeepSpeechDataset'>eval_speech_dataset</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.generate_dataset', title='? -> DeepSpeechDataset'>generate_dataset</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.eval_data_dir)
<span class='lineno'> 249</span> 
<span class='lineno'> 250</span>   # Number of label classes. Label string is &quot;[a-z]&#39; -&quot;
<span class='lineno'> 251</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_classes', title='int'>num_classes</a> = len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', title='DeepSpeechDataset'>train_speech_dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.speech_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.speech_labels', title='?'>speech_labels</a>)
<span class='lineno'> 252</span> 
<span class='lineno'> 253</span>   # Use distribution strategy for multi-gpu training
<span class='lineno'> 254</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', title='?'>num_gpus</a> = flags_core.get_num_gpus(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>)
<span class='lineno'> 255</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.distribution_strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.distribution_strategy', title='?'>distribution_strategy</a> = distribution_utils.get_distribution_strategy(num_gpus=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', title='?'>num_gpus</a>)
<span class='lineno'> 256</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_config', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_config', title='?'>run_config</a> = tf.estimator.RunConfig(
<span class='lineno'> 257</span>       train_distribute=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.distribution_strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.distribution_strategy', title='?'>distribution_strategy</a>)
<span class='lineno'> 258</span> 
<span class='lineno'> 259</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', title='?'>estimator</a> = tf.estimator.Estimator(
<span class='lineno'> 260</span>       model_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.model_fn', title='(?, ?, ?, ?) -> None'>model_fn</a>,
<span class='lineno'> 261</span>       model_dir=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.model_dir,
<span class='lineno'> 262</span>       config=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_config', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_config', title='?'>run_config</a>,
<span class='lineno'> 263</span>       params={
<span class='lineno'> 264</span>           &quot;num_classes&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_classes', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_classes', title='int'>num_classes</a>,
<span class='lineno'> 265</span>       }
<span class='lineno'> 266</span>   )
<span class='lineno'> 267</span> 
<span class='lineno'> 268</span>   # Benchmark logging
<span class='lineno'> 269</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_params', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_params', title='dict'>run_params</a> = {
<span class='lineno'> 270</span>       &quot;batch_size&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.batch_size,
<span class='lineno'> 271</span>       &quot;train_epochs&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.train_epochs,
<span class='lineno'> 272</span>       &quot;rnn_hidden_size&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_hidden_size,
<span class='lineno'> 273</span>       &quot;rnn_hidden_layers&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_hidden_layers,
<span class='lineno'> 274</span>       &quot;rnn_type&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.rnn_type,
<span class='lineno'> 275</span>       &quot;is_bidirectional&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.is_bidirectional,
<span class='lineno'> 276</span>       &quot;use_bias&quot;: <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.use_bias
<span class='lineno'> 277</span>   }
<span class='lineno'> 278</span> 
<span class='lineno'> 279</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.dataset_name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.dataset_name', title='str'>dataset_name</a> = &quot;LibriSpeech&quot;
<span class='lineno'> 280</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', title='?'>benchmark_logger</a> = logger.get_benchmark_logger()
<span class='lineno'> 281</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', title='?'>benchmark_logger</a>.log_run_info(&quot;deep_speech&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.dataset_name', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.dataset_name', title='str'>dataset_name</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_params', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.run_params', title='dict'>run_params</a>,
<span class='lineno'> 282</span>                                 test_id=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.benchmark_test_id)
<span class='lineno'> 283</span> 
<span class='lineno'> 284</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_hooks', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_hooks', title='?'>train_hooks</a> = hooks_helper.get_train_hooks(
<span class='lineno'> 285</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.hooks,
<span class='lineno'> 286</span>       model_dir=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.model_dir,
<span class='lineno'> 287</span>       batch_size=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.batch_size)
<span class='lineno'> 288</span> 
<span class='lineno'> 289</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', title='int'>per_replica_batch_size</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.per_device_batch_size', title='(?, ?) -> int'>per_device_batch_size</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.batch_size, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.num_gpus', title='?'>num_gpus</a>)
<span class='lineno'> 290</span> 
<span class='lineno'> 291</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_train', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_train', title='() -> None'>input_fn_train</a>():
<span class='lineno'> 292</span>     return <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.input_fn', title='(int, DeepSpeechDataset, int) -> None / (?, ?, int) -> None'>input_fn</a>(
<span class='lineno'> 293</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', title='int'>per_replica_batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', title='DeepSpeechDataset'>train_speech_dataset</a>)
<span class='lineno'> 294</span> 
<span class='lineno'> 295</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_eval', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_eval', title='() -> None'>input_fn_eval</a>():
<span class='lineno'> 296</span>     return <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.input_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.input_fn', title='(int, DeepSpeechDataset, int) -> None / (?, ?, int) -> None'>input_fn</a>(
<span class='lineno'> 297</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.per_replica_batch_size', title='int'>per_replica_batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', title='DeepSpeechDataset'>eval_speech_dataset</a>)
<span class='lineno'> 298</span> 
<span class='lineno'> 299</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', title='?'>total_training_cycle</a> = (<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.train_epochs //
<span class='lineno'> 300</span>                           <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.epochs_between_evals)
<span class='lineno'> 301</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', title='int'>cycle_index</a> in range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', title='?'>total_training_cycle</a>):
<span class='lineno'> 302</span>     tf.logging.info(&quot;Starting a training cycle: %d/%d&quot;,
<span class='lineno'> 303</span>                     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', title='int'>cycle_index</a> + 1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.total_training_cycle', title='?'>total_training_cycle</a>)
<span class='lineno'> 304</span> 
<span class='lineno'> 305</span>     # Perform batch_wise dataset shuffling
<span class='lineno'> 306</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', title='DeepSpeechDataset'>train_speech_dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', title='{[?] | [tuple]}'>entries</a> = <a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset', title='dataset'>dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.batch_wise_dataset_shuffle', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.batch_wise_dataset_shuffle', title='(?, ?, ?, ?) -> [?] / ([tuple], int, ?, ?) -> {[?] | [tuple]} / ({[?] | [tuple]}, int, ?, ?) -> {[?] | [tuple]}'>batch_wise_dataset_shuffle</a>(
<span class='lineno'> 307</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_speech_dataset', title='DeepSpeechDataset'>train_speech_dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', title='{[?] | [tuple]}'>entries</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', title='int'>cycle_index</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.sortagrad,
<span class='lineno'> 308</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.batch_size)
<span class='lineno'> 309</span> 
<span class='lineno'> 310</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', title='?'>estimator</a>.train(input_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_train', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_train', title='() -> None'>input_fn_train</a>, hooks=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_hooks', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.train_hooks', title='?'>train_hooks</a>)
<span class='lineno'> 311</span> 
<span class='lineno'> 312</span>     # Evaluation
<span class='lineno'> 313</span>     tf.logging.info(&quot;Starting to evaluate...&quot;)
<span class='lineno'> 314</span> 
<span class='lineno'> 315</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', title='dict'>eval_results</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.evaluate_model', title='(?, ?, ?, ?) -> dict / (?, ?, {[?] | [tuple]}, () -> None) -> dict'>evaluate_model</a>(
<span class='lineno'> 316</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.estimator', title='?'>estimator</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', title='DeepSpeechDataset'>eval_speech_dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.speech_labels', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.speech_labels', title='?'>speech_labels</a>,
<span class='lineno'> 317</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_speech_dataset', title='DeepSpeechDataset'>eval_speech_dataset</a>.<a href='data/dataset.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.data.dataset.DeepSpeechDataset.entries', title='{[?] | [tuple]}'>entries</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_eval', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.input_fn_eval', title='() -> None'>input_fn_eval</a>)
<span class='lineno'> 318</span> 
<span class='lineno'> 319</span>     # Log the WER and CER results.
<span class='lineno'> 320</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.benchmark_logger', title='?'>benchmark_logger</a>.log_evaluation_result(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', title='dict'>eval_results</a>)
<span class='lineno'> 321</span>     tf.logging.info(
<span class='lineno'> 322</span>         &quot;Iteration {}: WER = {:.2f}, CER = {:.2f}&quot;.format(
<span class='lineno'> 323</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.cycle_index', title='int'>cycle_index</a> + 1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', title='dict'>eval_results</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', title='str'>_WER_KEY</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', title='dict'>eval_results</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._CER_KEY', title='str'>_CER_KEY</a>]))
<span class='lineno'> 324</span> 
<span class='lineno'> 325</span>     # If some evaluation threshold is met
<span class='lineno'> 326</span>     if model_helpers.past_stop_threshold(
<span class='lineno'> 327</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>.wer_threshold, <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech.eval_results', title='dict'>eval_results</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._WER_KEY', title='str'>_WER_KEY</a>]):
<span class='lineno'> 328</span>       break
<span class='lineno'> 329</span> 
<span class='lineno'> 330</span> 
<span class='lineno'> 331</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags', title='() -> None'>define_deep_speech_flags</a>():
<span class='lineno'> 332</span>   &quot;&quot;&quot;Add flags for run_deep_speech.&quot;&quot;&quot;
<span class='lineno'> 333</span>   # Add common flags
<span class='lineno'> 334</span>   flags_core.define_base(
<span class='lineno'> 335</span>       data_dir=False,  # we use train_data_dir and eval_data_dir instead
<span class='lineno'> 336</span>       export_dir=True,
<span class='lineno'> 337</span>       train_epochs=True,
<span class='lineno'> 338</span>       hooks=True,
<span class='lineno'> 339</span>       num_gpu=True,
<span class='lineno'> 340</span>       epochs_between_evals=True
<span class='lineno'> 341</span>   )
<span class='lineno'> 342</span>   flags_core.define_performance(
<span class='lineno'> 343</span>       num_parallel_calls=False,
<span class='lineno'> 344</span>       inter_op=False,
<span class='lineno'> 345</span>       intra_op=False,
<span class='lineno'> 346</span>       synthetic_data=False,
<span class='lineno'> 347</span>       max_train_steps=False,
<span class='lineno'> 348</span>       dtype=False
<span class='lineno'> 349</span>   )
<span class='lineno'> 350</span>   flags_core.define_benchmark()
<span class='lineno'> 351</span>   flags.adopt_module_key_flags(flags_core)
<span class='lineno'> 352</span> 
<span class='lineno'> 353</span>   flags_core.set_defaults(
<span class='lineno'> 354</span>       model_dir=&quot;/tmp/deep_speech_model/&quot;,
<span class='lineno'> 355</span>       export_dir=&quot;/tmp/deep_speech_saved_model/&quot;,
<span class='lineno'> 356</span>       train_epochs=10,
<span class='lineno'> 357</span>       batch_size=128,
<span class='lineno'> 358</span>       hooks=&quot;&quot;)
<span class='lineno'> 359</span> 
<span class='lineno'> 360</span>   # Deep speech flags
<span class='lineno'> 361</span>   flags.DEFINE_integer(
<span class='lineno'> 362</span>       name=&quot;seed&quot;, default=1,
<span class='lineno'> 363</span>       help=flags_core.help_wrap(&quot;The random seed.&quot;))
<span class='lineno'> 364</span> 
<span class='lineno'> 365</span>   flags.DEFINE_string(
<span class='lineno'> 366</span>       name=&quot;train_data_dir&quot;,
<span class='lineno'> 367</span>       default=&quot;/tmp/librispeech_data/test-clean/LibriSpeech/test-clean.csv&quot;,
<span class='lineno'> 368</span>       help=flags_core.help_wrap(&quot;The csv file path of train dataset.&quot;))
<span class='lineno'> 369</span> 
<span class='lineno'> 370</span>   flags.DEFINE_string(
<span class='lineno'> 371</span>       name=&quot;eval_data_dir&quot;,
<span class='lineno'> 372</span>       default=&quot;/tmp/librispeech_data/test-clean/LibriSpeech/test-clean.csv&quot;,
<span class='lineno'> 373</span>       help=flags_core.help_wrap(&quot;The csv file path of evaluation dataset.&quot;))
<span class='lineno'> 374</span> 
<span class='lineno'> 375</span>   flags.DEFINE_bool(
<span class='lineno'> 376</span>       name=&quot;sortagrad&quot;, default=True,
<span class='lineno'> 377</span>       help=flags_core.help_wrap(
<span class='lineno'> 378</span>           &quot;If true, sort examples by audio length and perform no &quot;
<span class='lineno'> 379</span>           &quot;batch_wise shuffling for the first epoch.&quot;))
<span class='lineno'> 380</span> 
<span class='lineno'> 381</span>   flags.DEFINE_integer(
<span class='lineno'> 382</span>       name=&quot;sample_rate&quot;, default=16000,
<span class='lineno'> 383</span>       help=flags_core.help_wrap(&quot;The sample rate for audio.&quot;))
<span class='lineno'> 384</span> 
<span class='lineno'> 385</span>   flags.DEFINE_integer(
<span class='lineno'> 386</span>       name=&quot;window_ms&quot;, default=20,
<span class='lineno'> 387</span>       help=flags_core.help_wrap(&quot;The frame length for spectrogram.&quot;))
<span class='lineno'> 388</span> 
<span class='lineno'> 389</span>   flags.DEFINE_integer(
<span class='lineno'> 390</span>       name=&quot;stride_ms&quot;, default=10,
<span class='lineno'> 391</span>       help=flags_core.help_wrap(&quot;The frame step.&quot;))
<span class='lineno'> 392</span> 
<span class='lineno'> 393</span>   flags.DEFINE_string(
<span class='lineno'> 394</span>       name=&quot;vocabulary_file&quot;, default=<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech._VOCABULARY_FILE', title='str'>_VOCABULARY_FILE</a>,
<span class='lineno'> 395</span>       help=flags_core.help_wrap(&quot;The file path of vocabulary file.&quot;))
<span class='lineno'> 396</span> 
<span class='lineno'> 397</span>   # RNN related flags
<span class='lineno'> 398</span>   flags.DEFINE_integer(
<span class='lineno'> 399</span>       name=&quot;rnn_hidden_size&quot;, default=800,
<span class='lineno'> 400</span>       help=flags_core.help_wrap(&quot;The hidden size of RNNs.&quot;))
<span class='lineno'> 401</span> 
<span class='lineno'> 402</span>   flags.DEFINE_integer(
<span class='lineno'> 403</span>       name=&quot;rnn_hidden_layers&quot;, default=5,
<span class='lineno'> 404</span>       help=flags_core.help_wrap(&quot;The number of RNN layers.&quot;))
<span class='lineno'> 405</span> 
<span class='lineno'> 406</span>   flags.DEFINE_bool(
<span class='lineno'> 407</span>       name=&quot;use_bias&quot;, default=True,
<span class='lineno'> 408</span>       help=flags_core.help_wrap(&quot;Use bias in the last fully-connected layer&quot;))
<span class='lineno'> 409</span> 
<span class='lineno'> 410</span>   flags.DEFINE_bool(
<span class='lineno'> 411</span>       name=&quot;is_bidirectional&quot;, default=True,
<span class='lineno'> 412</span>       help=flags_core.help_wrap(&quot;If rnn unit is bidirectional&quot;))
<span class='lineno'> 413</span> 
<span class='lineno'> 414</span>   flags.DEFINE_enum(
<span class='lineno'> 415</span>       name=&quot;rnn_type&quot;, default=&quot;gru&quot;,
<span class='lineno'> 416</span>       enum_values=<a href='deep_speech_model.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model', title='deep_speech_model'>deep_speech_model</a>.<a href='deep_speech_model.py.html#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model.SUPPORTED_RNNS', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech_model.SUPPORTED_RNNS', title='dict'>SUPPORTED_RNNS</a>.keys(),
<span class='lineno'> 417</span>       case_sensitive=False,
<span class='lineno'> 418</span>       help=flags_core.help_wrap(&quot;Type of RNN cell.&quot;))
<span class='lineno'> 419</span> 
<span class='lineno'> 420</span>   # Training related flags
<span class='lineno'> 421</span>   flags.DEFINE_float(
<span class='lineno'> 422</span>       name=&quot;learning_rate&quot;, default=5e-4,
<span class='lineno'> 423</span>       help=flags_core.help_wrap(&quot;The initial learning rate.&quot;))
<span class='lineno'> 424</span> 
<span class='lineno'> 425</span>   # Evaluation metrics threshold
<span class='lineno'> 426</span>   flags.DEFINE_float(
<span class='lineno'> 427</span>       name=&quot;wer_threshold&quot;, default=None,
<span class='lineno'> 428</span>       help=flags_core.help_wrap(
<span class='lineno'> 429</span>           &quot;If passed, training will stop when the evaluation metric WER is &quot;
<span class='lineno'> 430</span>           &quot;greater than or equal to wer_threshold. For libri speech dataset &quot;
<span class='lineno'> 431</span>           &quot;the desired wer_threshold is 0.23 which is the result achieved by &quot;
<span class='lineno'> 432</span>           &quot;MLPerf implementation.&quot;))
<span class='lineno'> 433</span> 
<span class='lineno'> 434</span> 
<span class='lineno'> 435</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main', title='? -> None'>main</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main._', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main._', title='?'>_</a>):
<span class='lineno'> 436</span>   with logger.benchmark_context(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>):
<span class='lineno'> 437</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.run_deep_speech', title='? -> None'>run_deep_speech</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a>)
<span class='lineno'> 438</span> 
<span class='lineno'> 439</span> 
<span class='lineno'> 440</span> if __name__ == &quot;__main__&quot;:
<span class='lineno'> 441</span>   tf.logging.set_verbosity(tf.logging.INFO)
<span class='lineno'> 442</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.define_deep_speech_flags', title='() -> None'>define_deep_speech_flags</a>()
<span class='lineno'> 443</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.flags_obj', title='?'>flags_obj</a> = flags.FLAGS
<span class='lineno'> 444</span>   absl_app.run(<a href='#.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main', xid ='.home.xxm.Desktop.EMSE.dataset.models.research.deep_speech.deep_speech.main', title='? -> None'>main</a>)
</pre></td></tr></table></body></html>