<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/official/utils/flags/_performance.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', xid='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP'>DTYPE_MAP</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype', xid='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype'>get_tf_dtype</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale', xid='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale'>get_loss_scale</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance', xid='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance'>define_performance</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2018 The TensorFlow Authors. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;Register flags for optimizing performance.&quot;&quot;&quot;
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span> from __future__ import absolute_import
<span class='lineno'>  18</span> from __future__ import division
<span class='lineno'>  19</span> from __future__ import print_function
<span class='lineno'>  20</span> 
<span class='lineno'>  21</span> import multiprocessing
<span class='lineno'>  22</span> 
<span class='lineno'>  23</span> from absl import flags    # pylint: disable=g-bad-import-order
<span class='lineno'>  24</span> import tensorflow as tf   # pylint: disable=g-bad-import-order
<span class='lineno'>  25</span> 
<span class='lineno'>  26</span> from official.utils.flags._conventions import help_wrap
<span class='lineno'>  27</span> 
<span class='lineno'>  28</span> 
<span class='lineno'>  29</span> # Map string to TensorFlow dtype
<span class='lineno'>  30</span> <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', title='dict'>DTYPE_MAP</a> = {
<span class='lineno'>  31</span>     &quot;fp16&quot;: tf.float16,
<span class='lineno'>  32</span>     &quot;bf16&quot;: tf.bfloat16,
<span class='lineno'>  33</span>     &quot;fp32&quot;: tf.float32,
<span class='lineno'>  34</span> }
<span class='lineno'>  35</span> 
<span class='lineno'>  36</span> 
<span class='lineno'>  37</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype', title='? -> None'>get_tf_dtype</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', title='?'>flags_obj</a>):
<span class='lineno'>  38</span>   if getattr(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', title='?'>flags_obj</a>, &quot;fp16_implementation&quot;, None) == &quot;graph_rewrite&quot;:
<span class='lineno'>  39</span>     # If the graph_rewrite is used, we build the graph with fp32, and let the
<span class='lineno'>  40</span>     # graph rewrite change ops to fp16.
<span class='lineno'>  41</span>     return tf.float32
<span class='lineno'>  42</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', title='dict'>DTYPE_MAP</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype.flags_obj', title='?'>flags_obj</a>.dtype]
<span class='lineno'>  43</span> 
<span class='lineno'>  44</span> 
<span class='lineno'>  45</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale', title='(?, ?) -> {float | int}'>get_loss_scale</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.default_for_fp16', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.default_for_fp16', title='?'>default_for_fp16</a>):
<span class='lineno'>  46</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', title='None'>dtype</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_tf_dtype', title='? -> None'>get_tf_dtype</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>)
<span class='lineno'>  47</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>.loss_scale == &quot;dynamic&quot;:
<span class='lineno'>  48</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>.loss_scale
<span class='lineno'>  49</span>   elif <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>.loss_scale is not None:
<span class='lineno'>  50</span>     return float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.flags_obj', title='?'>flags_obj</a>.loss_scale)
<span class='lineno'>  51</span>   elif <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', title='None'>dtype</a> == tf.float32 or <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', title='None'>dtype</a> == tf.bfloat16:
<span class='lineno'>  52</span>     return 1  # No loss scaling is needed for fp32
<span class='lineno'>  53</span>   else:
<span class='lineno'>  54</span>     assert <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.dtype', title='None'>dtype</a> == tf.float16
<span class='lineno'>  55</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.default_for_fp16', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.get_loss_scale.default_for_fp16', title='?'>default_for_fp16</a>
<span class='lineno'>  56</span> 
<span class='lineno'>  57</span> 
<span class='lineno'>  58</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance', title='(bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool, bool) -> [?]'>define_performance</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_parallel_calls', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_parallel_calls', title='bool'>num_parallel_calls</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.inter_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.inter_op', title='bool'>inter_op</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.intra_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.intra_op', title='bool'>intra_op</a>=False,
<span class='lineno'>  59</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.synthetic_data', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.synthetic_data', title='bool'>synthetic_data</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.max_train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.max_train_steps', title='bool'>max_train_steps</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dtype', title='bool'>dtype</a>=False,
<span class='lineno'>  60</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.all_reduce_alg', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.all_reduce_alg', title='bool'>all_reduce_alg</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_packs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_packs', title='bool'>num_packs</a>=False,
<span class='lineno'>  61</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_gpu_thread_mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_gpu_thread_mode', title='bool'>tf_gpu_thread_mode</a>=False,
<span class='lineno'>  62</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_private_threads', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_private_threads', title='bool'>datasets_num_private_threads</a>=False,
<span class='lineno'>  63</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_parallel_batches', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_parallel_batches', title='bool'>datasets_num_parallel_batches</a>=False,
<span class='lineno'>  64</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', title='bool'>dynamic_loss_scale</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.fp16_implementation', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.fp16_implementation', title='bool'>fp16_implementation</a>=False,
<span class='lineno'>  65</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale', title='bool'>loss_scale</a>=False,
<span class='lineno'>  66</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_data_experimental_slack', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_data_experimental_slack', title='bool'>tf_data_experimental_slack</a>=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.enable_xla', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.enable_xla', title='bool'>enable_xla</a>=False,
<span class='lineno'>  67</span>                        <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.training_dataset_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.training_dataset_cache', title='bool'>training_dataset_cache</a>=False):
<span class='lineno'>  68</span>   &quot;&quot;&quot;Register flags for specifying performance tuning arguments.
<span class='lineno'>  69</span> 
<span class='lineno'>  70</span>   Args:
<span class='lineno'>  71</span>     num_parallel_calls: Create a flag to specify parallelism of data loading.
<span class='lineno'>  72</span>     inter_op: Create a flag to allow specification of inter op threads.
<span class='lineno'>  73</span>     intra_op: Create a flag to allow specification of intra op threads.
<span class='lineno'>  74</span>     synthetic_data: Create a flag to allow the use of synthetic data.
<span class='lineno'>  75</span>     max_train_steps: Create a flags to allow specification of maximum number
<span class='lineno'>  76</span>       of training steps
<span class='lineno'>  77</span>     dtype: Create flags for specifying dtype.
<span class='lineno'>  78</span>     all_reduce_alg: If set forces a specific algorithm for multi-gpu.
<span class='lineno'>  79</span>     num_packs: If set provides number of packs for MirroredStrategy&#39;s cross
<span class='lineno'>  80</span>       device ops.
<span class='lineno'>  81</span>     tf_gpu_thread_mode: gpu_private triggers us of private thread pool.
<span class='lineno'>  82</span>     datasets_num_private_threads: Number of private threads for datasets.
<span class='lineno'>  83</span>     datasets_num_parallel_batches: Determines how many batches to process in
<span class='lineno'>  84</span>     parallel when using map and batch from tf.data.
<span class='lineno'>  85</span>     dynamic_loss_scale: Allow the &quot;loss_scale&quot; flag to take on the value
<span class='lineno'>  86</span>       &quot;dynamic&quot;. Only valid if `dtype` is True.
<span class='lineno'>  87</span>     fp16_implementation: Create fp16_implementation flag.
<span class='lineno'>  88</span>     loss_scale: Controls the loss scaling, normally for mixed-precision
<span class='lineno'>  89</span>       training. Can only be turned on if dtype is also True.
<span class='lineno'>  90</span>     tf_data_experimental_slack: Determines whether to enable tf.data&#39;s
<span class='lineno'>  91</span>       `experimental_slack` option.
<span class='lineno'>  92</span>     enable_xla: Determines if XLA (auto clustering) is turned on.
<span class='lineno'>  93</span>     training_dataset_cache: Whether to cache the training dataset on workers.
<span class='lineno'>  94</span>        Typically used to improve training performance when training data is in
<span class='lineno'>  95</span>        remote storage and can fit into worker memory.
<span class='lineno'>  96</span> 
<span class='lineno'>  97</span>   Returns:
<span class='lineno'>  98</span>     A list of flags for core.py to marks as key flags.
<span class='lineno'>  99</span>   &quot;&quot;&quot;
<span class='lineno'> 100</span> 
<span class='lineno'> 101</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.key_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.key_flags', title='[?]'>key_flags</a> = []
<span class='lineno'> 102</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_parallel_calls', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_parallel_calls', title='bool'>num_parallel_calls</a>:
<span class='lineno'> 103</span>     flags.DEFINE_integer(
<span class='lineno'> 104</span>         name=&quot;num_parallel_calls&quot;, short_name=&quot;npc&quot;,
<span class='lineno'> 105</span>         default=multiprocessing.cpu_count(),
<span class='lineno'> 106</span>         help=help_wrap(&quot;The number of records that are  processed in parallel &quot;
<span class='lineno'> 107</span>                        &quot;during input processing. This can be optimized per &quot;
<span class='lineno'> 108</span>                        &quot;data set but for generally homogeneous data sets, &quot;
<span class='lineno'> 109</span>                        &quot;should be approximately the number of available CPU &quot;
<span class='lineno'> 110</span>                        &quot;cores. (default behavior)&quot;))
<span class='lineno'> 111</span> 
<span class='lineno'> 112</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.inter_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.inter_op', title='bool'>inter_op</a>:
<span class='lineno'> 113</span>     flags.DEFINE_integer(
<span class='lineno'> 114</span>         name=&quot;inter_op_parallelism_threads&quot;, short_name=&quot;inter&quot;, default=0,
<span class='lineno'> 115</span>         help=help_wrap(&quot;Number of inter_op_parallelism_threads to use for CPU. &quot;
<span class='lineno'> 116</span>                        &quot;See TensorFlow config.proto for details.&quot;)
<span class='lineno'> 117</span>     )
<span class='lineno'> 118</span> 
<span class='lineno'> 119</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.intra_op', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.intra_op', title='bool'>intra_op</a>:
<span class='lineno'> 120</span>     flags.DEFINE_integer(
<span class='lineno'> 121</span>         name=&quot;intra_op_parallelism_threads&quot;, short_name=&quot;intra&quot;, default=0,
<span class='lineno'> 122</span>         help=help_wrap(&quot;Number of intra_op_parallelism_threads to use for CPU. &quot;
<span class='lineno'> 123</span>                        &quot;See TensorFlow config.proto for details.&quot;))
<span class='lineno'> 124</span> 
<span class='lineno'> 125</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.synthetic_data', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.synthetic_data', title='bool'>synthetic_data</a>:
<span class='lineno'> 126</span>     flags.DEFINE_bool(
<span class='lineno'> 127</span>         name=&quot;use_synthetic_data&quot;, short_name=&quot;synth&quot;, default=False,
<span class='lineno'> 128</span>         help=help_wrap(
<span class='lineno'> 129</span>             &quot;If set, use fake data (zeroes) instead of a real dataset. &quot;
<span class='lineno'> 130</span>             &quot;This mode is useful for performance debugging, as it removes &quot;
<span class='lineno'> 131</span>             &quot;input processing steps, but will not learn anything.&quot;))
<span class='lineno'> 132</span> 
<span class='lineno'> 133</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.max_train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.max_train_steps', title='bool'>max_train_steps</a>:
<span class='lineno'> 134</span>     flags.DEFINE_integer(
<span class='lineno'> 135</span>         name=&quot;max_train_steps&quot;, short_name=&quot;mts&quot;, default=None, help=help_wrap(
<span class='lineno'> 136</span>             &quot;The model will stop training if the global_step reaches this &quot;
<span class='lineno'> 137</span>             &quot;value. If not set, training will run until the specified number &quot;
<span class='lineno'> 138</span>             &quot;of epochs have run as usual. It is generally recommended to set &quot;
<span class='lineno'> 139</span>             &quot;--train_epochs=1 when using this flag.&quot;
<span class='lineno'> 140</span>         ))
<span class='lineno'> 141</span> 
<span class='lineno'> 142</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dtype', title='bool'>dtype</a>:
<span class='lineno'> 143</span>     flags.DEFINE_enum(
<span class='lineno'> 144</span>         name=&quot;dtype&quot;, short_name=&quot;dt&quot;, default=&quot;fp32&quot;,
<span class='lineno'> 145</span>         enum_values=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.DTYPE_MAP', title='dict'>DTYPE_MAP</a>.keys(),
<span class='lineno'> 146</span>         help=help_wrap(&quot;The TensorFlow datatype used for calculations. &quot;
<span class='lineno'> 147</span>                        &quot;Variables may be cast to a higher precision on a &quot;
<span class='lineno'> 148</span>                        &quot;case-by-case basis for numerical stability.&quot;))
<span class='lineno'> 149</span> 
<span class='lineno'> 150</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a> = (
<span class='lineno'> 151</span>         &quot;The amount to scale the loss by when the model is run. {}. Before &quot;
<span class='lineno'> 152</span>         &quot;gradients are computed, the loss is multiplied by the loss scale, &quot;
<span class='lineno'> 153</span>         &quot;making all gradients loss_scale times larger. To adjust for this, &quot;
<span class='lineno'> 154</span>         &quot;gradients are divided by the loss scale before being applied to &quot;
<span class='lineno'> 155</span>         &quot;variables. This is mathematically equivalent to training without &quot;
<span class='lineno'> 156</span>         &quot;a loss scale, but the loss scale helps avoid some intermediate &quot;
<span class='lineno'> 157</span>         &quot;gradients from underflowing to zero. If not provided the default &quot;
<span class='lineno'> 158</span>         &quot;for fp16 is 128 and 1 for all other dtypes.{}&quot;
<span class='lineno'> 159</span>     )
<span class='lineno'> 160</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', title='bool'>dynamic_loss_scale</a>:
<span class='lineno'> 161</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a>.format(
<span class='lineno'> 162</span>           &quot;This can be an int/float or the string &#39;dynamic&#39;&quot;,
<span class='lineno'> 163</span>           &quot; The string &#39;dynamic&#39; can be used to dynamically determine the &quot;
<span class='lineno'> 164</span>           &quot;optimal loss scale during training, but currently this &quot;
<span class='lineno'> 165</span>           &quot;significantly slows down performance&quot;)
<span class='lineno'> 166</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_validation_msg', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_validation_msg', title='str'>loss_scale_validation_msg</a> = (&quot;loss_scale should be a positive int/float &quot;
<span class='lineno'> 167</span>                                    &quot;or the string &#39;dynamic&#39;.&quot;)
<span class='lineno'> 168</span>     else:
<span class='lineno'> 169</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a>.format(
<span class='lineno'> 170</span>           &quot;This must be an int/float&quot;, &quot;&quot;)
<span class='lineno'> 171</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_validation_msg', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_validation_msg', title='str'>loss_scale_validation_msg</a> = &quot;loss_scale should be a positive int/float.&quot;
<span class='lineno'> 172</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale', title='bool'>loss_scale</a>:
<span class='lineno'> 173</span>       flags.DEFINE_string(
<span class='lineno'> 174</span>           name=&quot;loss_scale&quot;, short_name=&quot;ls&quot;, default=None,
<span class='lineno'> 175</span>           help=help_wrap(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.loss_scale_help_text', title='str'>loss_scale_help_text</a>))
<span class='lineno'> 176</span> 
<span class='lineno'> 177</span>       @flags.validator(flag_name=&quot;loss_scale&quot;,
<span class='lineno'> 178</span>                        message=loss_scale_validation_msg)
<span class='lineno'> 179</span>       def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale', title='? -> bool'>_check_loss_scale</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='?'>loss_scale</a>):  # pylint: disable=unused-variable
<span class='lineno'> 180</span>         &quot;&quot;&quot;Validator to check the loss scale flag is valid.&quot;&quot;&quot;
<span class='lineno'> 181</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='?'>loss_scale</a> is None:
<span class='lineno'> 182</span>           return True  # null case is handled in get_loss_scale()
<span class='lineno'> 183</span> 
<span class='lineno'> 184</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='?'>loss_scale</a> == &quot;dynamic&quot; and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.dynamic_loss_scale', title='bool'>dynamic_loss_scale</a>:
<span class='lineno'> 185</span>           return True
<span class='lineno'> 186</span> 
<span class='lineno'> 187</span>         try:
<span class='lineno'> 188</span>           <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='float'>loss_scale</a> = float(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='?'>loss_scale</a>)
<span class='lineno'> 189</span>         except ValueError:
<span class='lineno'> 190</span>           return False
<span class='lineno'> 191</span> 
<span class='lineno'> 192</span>         return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_loss_scale.loss_scale', title='float'>loss_scale</a> &gt; 0
<span class='lineno'> 193</span> 
<span class='lineno'> 194</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.fp16_implementation', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.fp16_implementation', title='bool'>fp16_implementation</a>:
<span class='lineno'> 195</span>       flags.DEFINE_enum(
<span class='lineno'> 196</span>           name=&quot;fp16_implementation&quot;, default=&quot;keras&quot;,
<span class='lineno'> 197</span>           enum_values=(&quot;keras&#39;, &#39;graph_rewrite&quot;),
<span class='lineno'> 198</span>           help=help_wrap(
<span class='lineno'> 199</span>               &quot;When --dtype=fp16, how fp16 should be implemented. This has no &quot;
<span class='lineno'> 200</span>               &quot;impact on correctness. &#39;keras&#39; uses the &quot;
<span class='lineno'> 201</span>               &quot;tf.keras.mixed_precision API. &#39;graph_rewrite&#39; uses the &quot;
<span class='lineno'> 202</span>               &quot;tf.train.experimental.enable_mixed_precision_graph_rewrite &quot;
<span class='lineno'> 203</span>               &quot;API.&quot;))
<span class='lineno'> 204</span> 
<span class='lineno'> 205</span>       @flags.multi_flags_validator([&quot;fp16_implementation&quot;, &quot;dtype&quot;,
<span class='lineno'> 206</span>                                     &quot;loss_scale&quot;])
<span class='lineno'> 207</span>       def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation', title='? -> bool'>_check_fp16_implementation</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', title='?'>flags_dict</a>):
<span class='lineno'> 208</span>         &quot;&quot;&quot;Validator to check fp16_implementation flag is valid.&quot;&quot;&quot;
<span class='lineno'> 209</span>         if (<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', title='?'>flags_dict</a>[&quot;fp16_implementation&quot;] == &quot;graph_rewrite&quot; and
<span class='lineno'> 210</span>             <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance._check_fp16_implementation.flags_dict', title='?'>flags_dict</a>[&quot;dtype&quot;] != &quot;fp16&quot;):
<span class='lineno'> 211</span>           raise flags.ValidationError(&quot;--fp16_implementation should not be &quot;
<span class='lineno'> 212</span>                                       &quot;specified unless --dtype=fp16&quot;)
<span class='lineno'> 213</span>         return True
<span class='lineno'> 214</span> 
<span class='lineno'> 215</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.all_reduce_alg', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.all_reduce_alg', title='bool'>all_reduce_alg</a>:
<span class='lineno'> 216</span>     flags.DEFINE_string(
<span class='lineno'> 217</span>         name=&quot;all_reduce_alg&quot;, short_name=&quot;ara&quot;, default=None,
<span class='lineno'> 218</span>         help=help_wrap(&quot;Defines the algorithm to use for performing all-reduce.&quot;
<span class='lineno'> 219</span>                        &quot;When specified with MirroredStrategy for single &quot;
<span class='lineno'> 220</span>                        &quot;worker, this controls &quot;
<span class='lineno'> 221</span>                        &quot;tf.contrib.distribute.AllReduceCrossTowerOps.  When &quot;
<span class='lineno'> 222</span>                        &quot;specified with MultiWorkerMirroredStrategy, this &quot;
<span class='lineno'> 223</span>                        &quot;controls &quot;
<span class='lineno'> 224</span>                        &quot;tf.distribute.experimental.CollectiveCommunication; &quot;
<span class='lineno'> 225</span>                        &quot;valid options are `ring` and `nccl`.&quot;))
<span class='lineno'> 226</span> 
<span class='lineno'> 227</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_packs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.num_packs', title='bool'>num_packs</a>:
<span class='lineno'> 228</span>     flags.DEFINE_integer(
<span class='lineno'> 229</span>         name=&quot;num_packs&quot;, default=1,
<span class='lineno'> 230</span>         help=help_wrap(&quot;Sets `num_packs` in the cross device ops used in &quot;
<span class='lineno'> 231</span>                        &quot;MirroredStrategy.  For details, see &quot;
<span class='lineno'> 232</span>                        &quot;tf.distribute.NcclAllReduce.&quot;))
<span class='lineno'> 233</span> 
<span class='lineno'> 234</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_gpu_thread_mode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_gpu_thread_mode', title='bool'>tf_gpu_thread_mode</a>:
<span class='lineno'> 235</span>     flags.DEFINE_string(
<span class='lineno'> 236</span>         name=&quot;tf_gpu_thread_mode&quot;, short_name=&quot;gt_mode&quot;, default=None,
<span class='lineno'> 237</span>         help=help_wrap(
<span class='lineno'> 238</span>             &quot;Whether and how the GPU device uses its own threadpool.&quot;)
<span class='lineno'> 239</span>     )
<span class='lineno'> 240</span> 
<span class='lineno'> 241</span>     flags.DEFINE_integer(
<span class='lineno'> 242</span>         name=&quot;per_gpu_thread_count&quot;, short_name=&quot;pgtc&quot;, default=0,
<span class='lineno'> 243</span>         help=help_wrap(
<span class='lineno'> 244</span>             &quot;The number of threads to use for GPU. Only valid when &quot;
<span class='lineno'> 245</span>             &quot;tf_gpu_thread_mode is not global.&quot;)
<span class='lineno'> 246</span>     )
<span class='lineno'> 247</span> 
<span class='lineno'> 248</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_private_threads', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_private_threads', title='bool'>datasets_num_private_threads</a>:
<span class='lineno'> 249</span>     flags.DEFINE_integer(
<span class='lineno'> 250</span>         name=&quot;datasets_num_private_threads&quot;,
<span class='lineno'> 251</span>         default=None,
<span class='lineno'> 252</span>         help=help_wrap(
<span class='lineno'> 253</span>             &quot;Number of threads for a private threadpool created for all&quot;
<span class='lineno'> 254</span>             &quot;datasets computation..&quot;)
<span class='lineno'> 255</span>     )
<span class='lineno'> 256</span> 
<span class='lineno'> 257</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_parallel_batches', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.datasets_num_parallel_batches', title='bool'>datasets_num_parallel_batches</a>:
<span class='lineno'> 258</span>     flags.DEFINE_integer(
<span class='lineno'> 259</span>         name=&quot;datasets_num_parallel_batches&quot;,
<span class='lineno'> 260</span>         default=None,
<span class='lineno'> 261</span>         help=help_wrap(
<span class='lineno'> 262</span>             &quot;Determines how many batches to process in parallel when using &quot;
<span class='lineno'> 263</span>             &quot;map and batch from tf.data.&quot;)
<span class='lineno'> 264</span>     )
<span class='lineno'> 265</span> 
<span class='lineno'> 266</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.training_dataset_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.training_dataset_cache', title='bool'>training_dataset_cache</a>:
<span class='lineno'> 267</span>     flags.DEFINE_boolean(
<span class='lineno'> 268</span>         name=&quot;training_dataset_cache&quot;,
<span class='lineno'> 269</span>         default=False,
<span class='lineno'> 270</span>         help=help_wrap(
<span class='lineno'> 271</span>             &quot;Determines whether to cache the training dataset on workers. &quot;
<span class='lineno'> 272</span>             &quot;Typically used to improve training performance when training &quot;
<span class='lineno'> 273</span>             &quot;data is in remote storage and can fit into worker memory.&quot;)
<span class='lineno'> 274</span>     )
<span class='lineno'> 275</span> 
<span class='lineno'> 276</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_data_experimental_slack', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.tf_data_experimental_slack', title='bool'>tf_data_experimental_slack</a>:
<span class='lineno'> 277</span>     flags.DEFINE_boolean(
<span class='lineno'> 278</span>         name=&quot;tf_data_experimental_slack&quot;,
<span class='lineno'> 279</span>         default=False,
<span class='lineno'> 280</span>         help=help_wrap(
<span class='lineno'> 281</span>             &quot;Whether to enable tf.data&#39;s `experimental_slack` option.&quot;)
<span class='lineno'> 282</span>     )
<span class='lineno'> 283</span> 
<span class='lineno'> 284</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.enable_xla', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.enable_xla', title='bool'>enable_xla</a>:
<span class='lineno'> 285</span>     flags.DEFINE_boolean(
<span class='lineno'> 286</span>         name=&quot;enable_xla&quot;, default=False,
<span class='lineno'> 287</span>         help=&quot;Whether to enable XLA auto jit compilation&quot;)
<span class='lineno'> 288</span> 
<span class='lineno'> 289</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.key_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.utils.flags._performance.define_performance.key_flags', title='[?]'>key_flags</a>
</pre></td></tr></table></body></html>