<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/official/staging/training/controller.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller'>Controller</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__'>__init__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model'>_restore_model</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once'>_evaluate_once</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints'>_maybe_save_checkpoints</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate'>_maybe_evaluate</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info'>_log_info</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train'>train</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate'>evaluate</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer'>_StepTimer</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__'>__init__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start'>start</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second', xid='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second'>steps_per_second</a></li></ul>
</li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2019 The TensorFlow Authors. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;A light weight utilities to train TF2 models.&quot;&quot;&quot;
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span> from __future__ import absolute_import
<span class='lineno'>  18</span> from __future__ import division
<span class='lineno'>  19</span> # from __future__ import google_type_annotations
<span class='lineno'>  20</span> from __future__ import print_function
<span class='lineno'>  21</span> 
<span class='lineno'>  22</span> import time
<span class='lineno'>  23</span> 
<span class='lineno'>  24</span> from absl import logging
<span class='lineno'>  25</span> 
<span class='lineno'>  26</span> import tensorflow.compat.v2 as tf
<span class='lineno'>  27</span> from typing import Callable, Dict, Optional, Text
<span class='lineno'>  28</span> 
<span class='lineno'>  29</span> from official.staging.training import utils
<span class='lineno'>  30</span> 
<span class='lineno'>  31</span> 
<span class='lineno'>  32</span> class <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller', title='<Controller>'>Controller</a>(object):
<span class='lineno'>  33</span>   &quot;&quot;&quot;Class that facilitates training and evaluation of models.&quot;&quot;&quot;
<span class='lineno'>  34</span> 
<span class='lineno'>  35</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__', title='? -> ?'>__init__</a>(
<span class='lineno'>  36</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>sel</a>f,
<span class='lineno'>  37</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.strategy', title='None'>str</a>ategy: Optional[tf.distribute.Strategy] = None,
<span class='lineno'>  38</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', title='None'>tra</a>in_fn: Optional[Callable[[tf.Tensor],
<span class='lineno'>  39</span>                                   Optional[Dict[Text, tf.Tensor]]]] = None,
<span class='lineno'>  40</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', title='None'>eva</a>l_fn: Optional[Callable[[tf.Tensor],
<span class='lineno'>  41</span>                                  Optional[Dict[Text, tf.Tensor]]]] = None,
<span class='lineno'>  42</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.global_step', title='None'>glo</a>bal_step: Optional[tf.Variable] = None,
<span class='lineno'>  43</span>       # Train related
<span class='lineno'>  44</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', title='None'>tra</a>in_steps: Optional[int] = None,
<span class='lineno'>  45</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', title='None'>ste</a>ps_per_loop: Optional[int] = None,
<span class='lineno'>  46</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', title='None'>sum</a>mary_dir: Optional[Text] = None,
<span class='lineno'>  47</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', title='None'>che</a>ckpoint_manager: Optional[tf.train.CheckpointManager] = None,
<span class='lineno'>  48</span>       # summary related
<span class='lineno'>  49</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', title='None'>sum</a>mary_interval: Optional[int] = None,
<span class='lineno'>  50</span>       # Evaluation related
<span class='lineno'>  51</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', title='None'>eva</a>l_summary_dir: Optional[Text] = None,
<span class='lineno'>  52</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_steps', title='None'>eva</a>l_steps: Optional[int] = None,
<span class='lineno'>  53</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_interval', title='None'>eva</a>l_interval: Optional[int] = None):
<span class='lineno'>  54</span>     &quot;&quot;&quot;Constructs a `Controller` instance.
<span class='lineno'>  55</span> 
<span class='lineno'>  56</span>     Args:
<span class='lineno'>  57</span>       strategy: An instance of `tf.distribute.Strategy`.
<span class='lineno'>  58</span>       train_fn: A callable defined as `def train_fn(num_steps)`, which
<span class='lineno'>  59</span>         `num_steps` indicates the number of steps to run for each loop.
<span class='lineno'>  60</span>       eval_fn: A callable defined as `def eval_fn(num_steps)`, which `num_steps`
<span class='lineno'>  61</span>         indicates the number of steps for one evaluation.
<span class='lineno'>  62</span>       global_step: An integer `tf.Variable` indicating the global training step
<span class='lineno'>  63</span>         number. Usually this can be obtained from `iterations` property of the
<span class='lineno'>  64</span>         model&#39;s optimizer (e.g. `self.optimizer.iterations`), or users can
<span class='lineno'>  65</span>         create their own global step variable as well. If the users create their
<span class='lineno'>  66</span>         own global step variable, it is recommended to create the `tf.Variable`
<span class='lineno'>  67</span>         inside strategy scope, and with
<span class='lineno'>  68</span>         `aggregation=tf.VariableAggregation.ONLY_FIRST_REPLICA`.
<span class='lineno'>  69</span>       train_steps: The total (maximum) number of training steps to perform.
<span class='lineno'>  70</span>       steps_per_loop: The number of steps to run in each &quot;inner loop&quot; of
<span class='lineno'>  71</span>         training (passed to the `num_steps` parameter of `train_fn`).
<span class='lineno'>  72</span>       summary_dir: The directory to restore and write checkpoints and summaries.
<span class='lineno'>  73</span>         If None, it will be set to `checkpoint_manager.directory`.
<span class='lineno'>  74</span>       checkpoint_manager: An instance of `tf.train.CheckpointManager`.
<span class='lineno'>  75</span>       summary_interval: Step interval for training summaries. Note that this
<span class='lineno'>  76</span>         argument only applies to the summaries outside the training loop. If the
<span class='lineno'>  77</span>         value is None, then training summaries are not enabled.
<span class='lineno'>  78</span>       eval_summary_dir: The directory to write eval summaries. If None, it will
<span class='lineno'>  79</span>         be set to `summary_dir`.
<span class='lineno'>  80</span>       eval_steps: Number of steps to run evaluation.
<span class='lineno'>  81</span>       eval_interval: Step interval for evaluation. If None, will skip evaluation
<span class='lineno'>  82</span>         in the middle of training. Note that evaluation only happens outside the
<span class='lineno'>  83</span>         training loop, which the loop iteration is specify by `steps_per_loop`
<span class='lineno'>  84</span>         parameter.
<span class='lineno'>  85</span> 
<span class='lineno'>  86</span>     Raises:
<span class='lineno'>  87</span>       ValueError: If both `train_fn` and `eval_fn` are None.
<span class='lineno'>  88</span>       ValueError: If `train_fn` is not None and `train_steps` is None.
<span class='lineno'>  89</span>       ValueError: If `steps_per_loop` is None when `train_fn` is provided.
<span class='lineno'>  90</span>       ValueError: If `steps_per_loop` is not a positive integer.
<span class='lineno'>  91</span>     &quot;&quot;&quot;
<span class='lineno'>  92</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', title='None'>train_fn</a> is None and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', title='None'>eval_fn</a> is None:
<span class='lineno'>  93</span>       raise ValueError(&quot;`train_fn` and `eval_fn` should not both be None&quot;)
<span class='lineno'>  94</span> 
<span class='lineno'>  95</span>     # TODO(rxsang): Support training until exhaustion by passing
<span class='lineno'>  96</span>     # `train_steps=-1`. Currently it cannot be supported with a host training
<span class='lineno'>  97</span>     # loop because break statements are not supported with distributed dataset.
<span class='lineno'>  98</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', title='None'>train_fn</a> is not None:
<span class='lineno'>  99</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', title='None'>train_steps</a> is None:
<span class='lineno'> 100</span>         raise ValueError(&quot;`train_steps` is required when `train_fn` is &quot;
<span class='lineno'> 101</span>                          &quot;provided.&quot;)
<span class='lineno'> 102</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', title='None'>steps_per_loop</a> is None:
<span class='lineno'> 103</span>         raise ValueError(&quot;`steps_per_loop` is required when `train_fn is &quot;
<span class='lineno'> 104</span>                          &quot;provided.&quot;)
<span class='lineno'> 105</span>       if not isinstance(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', title='None'>steps_per_loop</a>, int) or <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', title='None'>steps_per_loop</a> &lt; 1:
<span class='lineno'> 106</span>         raise ValueError(&quot;`steps_per_loop` should be a positive integer&quot;)
<span class='lineno'> 107</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', title='None'>summary_interval</a> is not None and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', title='None'>summary_interval</a> &lt;= 0:
<span class='lineno'> 108</span>       raise ValueError(&quot;`summary_interval` should be larger than 0&quot;)
<span class='lineno'> 109</span> 
<span class='lineno'> 110</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', title='None'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', title='None'>strategy</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.strategy', title='None'>strategy</a> or tf.distribute.get_strategy()
<span class='lineno'> 111</span> 
<span class='lineno'> 112</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', title='None'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', title='None'>train_fn</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_fn', title='None'>train_fn</a>
<span class='lineno'> 113</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'>eval_fn</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_fn', title='None'>eval_fn</a>
<span class='lineno'> 114</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.global_step', title='None'>global_step</a>
<span class='lineno'> 115</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', title='None'>checkpoint_manager</a>
<span class='lineno'> 116</span> 
<span class='lineno'> 117</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', title='None'>train_fn</a> is not None:
<span class='lineno'> 118</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'>train_steps</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.train_steps', title='None'>train_steps</a>
<span class='lineno'> 119</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', title='None'>steps_per_loop</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.steps_per_loop', title='None'>steps_per_loop</a>
<span class='lineno'> 120</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', title='None'>summary_dir</a>:
<span class='lineno'> 121</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_dir', title='None'>summary_dir</a>
<span class='lineno'> 122</span>       elif <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', title='None'>checkpoint_manager</a>:
<span class='lineno'> 123</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.checkpoint_manager', title='None'>checkpoint_manager</a>.directory
<span class='lineno'> 124</span>       else:
<span class='lineno'> 125</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a> = None
<span class='lineno'> 126</span> 
<span class='lineno'> 127</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', title='None'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', title='None'>summary_interval</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_interval', title='None'>summary_interval</a>
<span class='lineno'> 128</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', title='None'>summary_interval</a>:
<span class='lineno'> 129</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', title='?'>summary_writer</a> = tf.summary.create_file_writer(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a>)
<span class='lineno'> 130</span>       else:
<span class='lineno'> 131</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', title='None'>summary_writer</a> = None
<span class='lineno'> 132</span>       # TODO(rxsang): Consider pass SummaryManager directly into Controller for
<span class='lineno'> 133</span>       # maximum customizability.
<span class='lineno'> 134</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'>summary_manager</a></a> = utils.SummaryManager(
<span class='lineno'> 135</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.summary_writer', title='None'>summary_writer</a>,
<span class='lineno'> 136</span>           tf.summary.scalar,
<span class='lineno'> 137</span>           global_step=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>,
<span class='lineno'> 138</span>           summary_interval=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_interval', title='None'>summary_interval</a>)
<span class='lineno'> 139</span> 
<span class='lineno'> 140</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'>eval_fn</a> is not None:
<span class='lineno'> 141</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', title='None'>eval_summary_dir</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', title='None'>eval_summary_dir</a> or <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_dir', title='None'>summary_dir</a>
<span class='lineno'> 142</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_writer', title='None'>eval_summary_writer</a> = tf.summary.create_file_writer(
<span class='lineno'> 143</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', title='None'>eval_summary_dir</a>) if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_dir', title='None'>eval_summary_dir</a> else None
<span class='lineno'> 144</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', title='?'>eval_summary_manager</a></a> = utils.SummaryManager(
<span class='lineno'> 145</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_writer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_summary_writer', title='None'>eval_summary_writer</a>, tf.summary.scalar, global_step=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>)
<span class='lineno'> 146</span> 
<span class='lineno'> 147</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', title='None'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', title='None'>eval_steps</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_steps', title='None'>eval_steps</a>
<span class='lineno'> 148</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', title='None'>eval_interval</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.eval_interval', title='None'>eval_interval</a>
<span class='lineno'> 149</span> 
<span class='lineno'> 150</span>       # Creates and initializes the interval triggers.
<span class='lineno'> 151</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', title='?'>eval_trigger</a></a> = utils.IntervalTrigger(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_interval', title='None'>eval_interval</a>,
<span class='lineno'> 152</span>                                                 <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>.numpy())  # pytype: disable=attribute-error
<span class='lineno'> 153</span> 
<span class='lineno'> 154</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>:
<span class='lineno'> 155</span>       tf.summary.experimental.set_step(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>)
<span class='lineno'> 156</span> 
<span class='lineno'> 157</span>     # Restores the model if needed.
<span class='lineno'> 158</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a> is not None:
<span class='lineno'> 159</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.model_restored', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.model_restored', title='None'>model_restored</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', title='(Controller, ?) -> None / (Controller, None) -> None'>_restore_model</a>()
<span class='lineno'> 160</span>       if not <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.model_restored', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.model_restored', title='None'>model_restored</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.checkpoint_interval:
<span class='lineno'> 161</span>         # If the model is not restored from a checkpoint, save an initial
<span class='lineno'> 162</span>         # checkpoint.
<span class='lineno'> 163</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.ckpt_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.ckpt_path', title='?'>ckpt_path</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.save(
<span class='lineno'> 164</span>             checkpoint_number=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>)
<span class='lineno'> 165</span>         logging.info(&quot;Saved checkpoins in %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.ckpt_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.__init__.ckpt_path', title='?'>ckpt_path</a>)
<span class='lineno'> 166</span> 
<span class='lineno'> 167</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', title='(Controller, ?) -> None / (Controller, None) -> None'>_restore_model</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', title='None'>che</a>ckpoint_path=None):
<span class='lineno'> 168</span>     &quot;&quot;&quot;Restore or initialize the model.
<span class='lineno'> 169</span> 
<span class='lineno'> 170</span>     Args:
<span class='lineno'> 171</span>       checkpoint_path: An optional string indicates the checkpoint path to
<span class='lineno'> 172</span>         restore. If None, will restore from `self.checkpoint_manager`.
<span class='lineno'> 173</span> 
<span class='lineno'> 174</span>     Returns:
<span class='lineno'> 175</span>       True if the latest checkpoint is found or restored. Otherwise False.
<span class='lineno'> 176</span>     &quot;&quot;&quot;
<span class='lineno'> 177</span>     with <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.strategy', title='None'>strategy</a>.scope():
<span class='lineno'> 178</span>       # Checkpoint restoring should be inside scope. b/139450638
<span class='lineno'> 179</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', title='None'>checkpoint_path</a> is not None:
<span class='lineno'> 180</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.checkpoint.restore(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.checkpoint_path', title='None'>checkpoint_path</a>)
<span class='lineno'> 181</span>         return True
<span class='lineno'> 182</span>       return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.restore_or_initialize()
<span class='lineno'> 183</span> 
<span class='lineno'> 184</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', title='(Controller, int) -> None / (Controller, ?) -> None'>_evaluate_once</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', title='int'>cur</a>rent_step):
<span class='lineno'> 185</span>     &quot;&quot;&quot;Runs the evaluation once.&quot;&quot;&quot;
<span class='lineno'> 186</span>     logging.info(&quot;Start evaluation at step: %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', title='int'>current_step</a>)
<span class='lineno'> 187</span> 
<span class='lineno'> 188</span>     with <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', title='?'>eval_summary_manager</a>.summary_writer.as_default():
<span class='lineno'> 189</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'>eval_fn</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_steps', title='None'>eval_steps</a>)
<span class='lineno'> 190</span> 
<span class='lineno'> 191</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a>:
<span class='lineno'> 192</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a> = tf.nest.map_structure(lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.lambda%137.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.lambda%137.x', title='?'>x: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.lambda%137.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.lambda%137.x', title='?'></a>x</a>.numpy(), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a>)
<span class='lineno'> 193</span> 
<span class='lineno'> 194</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.info', title='str'>info</a> = &quot;step: {}        evaluation metric: {}&quot;.format(
<span class='lineno'> 195</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.current_step', title='int'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a>)
<span class='lineno'> 196</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', title='(Controller, ?) -> None / (Controller, str) -> None'>_log_info</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.info', title='str'>info</a>)
<span class='lineno'> 197</span> 
<span class='lineno'> 198</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', title='?'>eval_summary_manager</a>.write_summaries(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.eval_outputs', title='?'>eval_outputs</a>)
<span class='lineno'> 199</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_summary_manager', title='?'>eval_summary_manager</a>.flush()
<span class='lineno'> 200</span> 
<span class='lineno'> 201</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', title='(Controller, ?, ?) -> None / (Controller, int, ?) -> None'>_maybe_save_checkpoints</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.current_step', title='int'>cur</a>rent_step, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.force_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.force_trigger', title='?'>for</a>ce_trigger=False):
<span class='lineno'> 202</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.checkpoint_interval:
<span class='lineno'> 203</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', title='?'>ckpt_path</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.save(
<span class='lineno'> 204</span>           checkpoint_number=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.current_step', title='int'>current_step</a>, check_interval=not <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.force_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.force_trigger', title='?'>force_trigger</a>)
<span class='lineno'> 205</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', title='?'>ckpt_path</a> is not None:
<span class='lineno'> 206</span>         logging.info(&quot;Saved checkpoins in %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints.ckpt_path', title='?'>ckpt_path</a>)
<span class='lineno'> 207</span> 
<span class='lineno'> 208</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', title='(Controller, int, ?) -> None / (Controller, ?, ?) -> None'>_maybe_evaluate</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', title='int'>cur</a>rent_step, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.force_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.force_trigger', title='?'>for</a>ce_trigger=False):
<span class='lineno'> 209</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_trigger', title='?'>eval_trigger</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', title='int'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.force_trigger', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.force_trigger', title='?'>force_trigger</a>):
<span class='lineno'> 210</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', title='(Controller, int) -> None / (Controller, ?) -> None'>_evaluate_once</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate.current_step', title='int'>current_step</a>)
<span class='lineno'> 211</span> 
<span class='lineno'> 212</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', title='(Controller, ?) -> None / (Controller, str) -> None'>_log_info</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', title='str'>mes</a>sage):
<span class='lineno'> 213</span>     &quot;&quot;&quot;Logs `message` to the `info` log, and also prints to stdout.&quot;&quot;&quot;
<span class='lineno'> 214</span>     logging.info(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', title='str'>message</a>)
<span class='lineno'> 215</span>     print(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info.message', title='str'>message</a>)
<span class='lineno'> 216</span> 
<span class='lineno'> 217</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train', title='(Controller, ?) -> None'>train</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', title='?'>eva</a>luate=True):
<span class='lineno'> 218</span>     &quot;&quot;&quot;Runs the training, with optional evaluation.
<span class='lineno'> 219</span> 
<span class='lineno'> 220</span>     This handles evaluation, gathering summaries, and saving checkpoints.
<span class='lineno'> 221</span> 
<span class='lineno'> 222</span>     Args:
<span class='lineno'> 223</span>       evaluate: A boolean indicates whether to perform evaluation during
<span class='lineno'> 224</span>         training.
<span class='lineno'> 225</span> 
<span class='lineno'> 226</span>     Raises:
<span class='lineno'> 227</span>       RuntimeError: If `global_step` is not updated correctly in `train_fn`.
<span class='lineno'> 228</span>     &quot;&quot;&quot;
<span class='lineno'> 229</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', title='None'>train_fn</a> is None:
<span class='lineno'> 230</span>       raise ValueError(&quot;`self.train_fn` is required when calling `train` &quot;
<span class='lineno'> 231</span>                        &quot;method.&quot;)
<span class='lineno'> 232</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a> is None:
<span class='lineno'> 233</span>       raise ValueError(&quot;`self.global_step` is required when calling `train` &quot;
<span class='lineno'> 234</span>                        &quot;method.&quot;)
<span class='lineno'> 235</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', title='?'>evaluate</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'>eval_fn</a> is None:
<span class='lineno'> 236</span>       raise ValueError(&quot;`self.eval_fn` is required when calling `train` method &quot;
<span class='lineno'> 237</span>                        &quot;with `evaluate=True`&quot;)
<span class='lineno'> 238</span> 
<span class='lineno'> 239</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.step_timer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.step_timer', title='_StepTimer'>step_timer</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer', title='<_StepTimer>'>_StepTimer</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>)
<span class='lineno'> 240</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='?'>current_step</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>.numpy()
<span class='lineno'> 241</span>     logging.info(&quot;Train at step %s of %s&quot;, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='?'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'>train_steps</a>)
<span class='lineno'> 242</span>     while <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='?'>current_step</a> &lt; <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'>train_steps</a>:
<span class='lineno'> 243</span>       # Calculates steps to run for the next train loop.
<span class='lineno'> 244</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='int'>steps_per_loop</a> = min(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'>train_steps</a> - <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.steps_per_loop', title='None'>steps_per_loop</a>)
<span class='lineno'> 245</span>       logging.info(&quot;Entering training loop with %s steps, at step %s of %s&quot;,
<span class='lineno'> 246</span>                    <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='int'>steps_per_loop</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_steps', title='None'>train_steps</a>)
<span class='lineno'> 247</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a></a> += <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='int'>steps_per_loop</a>
<span class='lineno'> 248</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='?'>steps_per_loop</a> = tf.convert_to_tensor(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='int'>steps_per_loop</a>, dtype=tf.int32)
<span class='lineno'> 249</span> 
<span class='lineno'> 250</span>       with <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'>summary_manager</a>.summary_writer.as_default():
<span class='lineno'> 251</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train_fn', title='None'>train_fn</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_loop', title='?'>steps_per_loop</a>)
<span class='lineno'> 252</span> 
<span class='lineno'> 253</span>       # Updates and verifies the current step after a training loop finishes.
<span class='lineno'> 254</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a> != <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>.numpy():
<span class='lineno'> 255</span>         raise RuntimeError(&quot;`self.train_fn` is not updating `global_step` &quot;
<span class='lineno'> 256</span>                            &quot;correctly, expected: %s, actual: %s&quot; %
<span class='lineno'> 257</span>                            (current_step, self.global_step.numpy()))
<span class='lineno'> 258</span> 
<span class='lineno'> 259</span>       # Print information like metrics and steps_per_second after a training
<span class='lineno'> 260</span>       # loop.
<span class='lineno'> 261</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a>:
<span class='lineno'> 262</span>         <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a> = tf.nest.map_structure(
<span class='lineno'> 263</span>             lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.lambda%138.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.lambda%138.x', title='?'>x: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.lambda%138.x', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.lambda%138.x', title='?'></a>x</a>.numpy(), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a>)
<span class='lineno'> 264</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', title='int'>steps_per_second</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.step_timer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.step_timer', title='_StepTimer'>step_timer</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second', title='(_StepTimer, ?) -> int'>steps_per_second</a>()
<span class='lineno'> 265</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.info', title='str'>info</a> = &quot;step: {}        steps_per_second: {:.2f}        {}&quot;.format(
<span class='lineno'> 266</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', title='int'>steps_per_second</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a>)
<span class='lineno'> 267</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._log_info', title='(Controller, ?) -> None / (Controller, str) -> None'>_log_info</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.info', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.info', title='str'>info</a>)
<span class='lineno'> 268</span> 
<span class='lineno'> 269</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='dict'>train_outputs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='?'>train_outputs</a> or {}
<span class='lineno'> 270</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='dict'>train_outputs</a>[&quot;steps_per_second&quot;] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.steps_per_second', title='int'>steps_per_second</a>
<span class='lineno'> 271</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'>summary_manager</a>.write_summaries(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='dict'>train_outputs</a>)
<span class='lineno'> 272</span> 
<span class='lineno'> 273</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', title='(Controller, ?, ?) -> None / (Controller, int, ?) -> None'>_maybe_save_checkpoints</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>)
<span class='lineno'> 274</span> 
<span class='lineno'> 275</span>       if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', title='?'>evaluate</a>:
<span class='lineno'> 276</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', title='(Controller, int, ?) -> None / (Controller, ?, ?) -> None'>_maybe_evaluate</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>)
<span class='lineno'> 277</span> 
<span class='lineno'> 278</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'>summary_manager</a>.write_summaries(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.train_outputs', title='dict'>train_outputs</a>, always_write=True)
<span class='lineno'> 279</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.summary_manager', title='?'>summary_manager</a>.flush()
<span class='lineno'> 280</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_save_checkpoints', title='(Controller, ?, ?) -> None / (Controller, int, ?) -> None'>_maybe_save_checkpoints</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>, force_trigger=True)
<span class='lineno'> 281</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.evaluate', title='?'>evaluate</a>:
<span class='lineno'> 282</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._maybe_evaluate', title='(Controller, int, ?) -> None / (Controller, ?, ?) -> None'>_maybe_evaluate</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.train.current_step', title='int'>current_step</a>, force_trigger=True)
<span class='lineno'> 283</span> 
<span class='lineno'> 284</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate', title='(Controller, ?, None) -> None'>evaluate</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', title='?'>con</a>tinuous=False, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', title='None'>tim</a>eout_fn=None):
<span class='lineno'> 285</span>     &quot;&quot;&quot;Runs the evaluation.
<span class='lineno'> 286</span> 
<span class='lineno'> 287</span>     Args:
<span class='lineno'> 288</span>       continuous: If `True`, will continously monitor the checkpoint directory
<span class='lineno'> 289</span>         to evaluate on the latest checkpoint. If `False`, will do the evaluation
<span class='lineno'> 290</span>         once.
<span class='lineno'> 291</span>       timeout_fn: Optional callable to call after a timeout. If the function
<span class='lineno'> 292</span>         returns True, then it means that no new checkpoints will be generated
<span class='lineno'> 293</span>         and the iterator will exit.
<span class='lineno'> 294</span> 
<span class='lineno'> 295</span>     Raises:
<span class='lineno'> 296</span>       ValueError: If no checkpoint found in `self.checkpoint_manager.directory`.
<span class='lineno'> 297</span>     &quot;&quot;&quot;
<span class='lineno'> 298</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.eval_fn', title='None'>eval_fn</a> is None:
<span class='lineno'> 299</span>       raise ValueError(&quot;`self.eval_fn` should not be None to call &quot;
<span class='lineno'> 300</span>                        &quot;`evaluate()` method.&quot;)
<span class='lineno'> 301</span> 
<span class='lineno'> 302</span>     if not <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', title='?'>continuous</a> and <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', title='None'>timeout_fn</a> is not None:
<span class='lineno'> 303</span>       raise ValueError(&quot;`timeout_fn` can be only passed when `continuous` is &quot;
<span class='lineno'> 304</span>                        &quot;True&quot;)
<span class='lineno'> 305</span> 
<span class='lineno'> 306</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.continuous', title='?'>continuous</a>:
<span class='lineno'> 307</span>       for <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.checkpoint_path', title='?'>checkpoint_path</a> in tf.train.checkpoints_iterator(
<span class='lineno'> 308</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.directory, timeout_fn=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.timeout_fn', title='None'>timeout_fn</a>):
<span class='lineno'> 309</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', title='(Controller, ?) -> None / (Controller, None) -> None'>_restore_model</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.checkpoint_path', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.checkpoint_path', title='?'>checkpoint_path</a>)
<span class='lineno'> 310</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', title='(Controller, int) -> None / (Controller, ?) -> None'>_evaluate_once</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>.numpy())
<span class='lineno'> 311</span>       return
<span class='lineno'> 312</span> 
<span class='lineno'> 313</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.latest_checkpoint', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.latest_checkpoint', title='?'>latest_checkpoint</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.checkpoint_manager', title='None'>checkpoint_manager</a>.latest_checkpoint
<span class='lineno'> 314</span>     if not <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.latest_checkpoint', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.latest_checkpoint', title='?'>latest_checkpoint</a>:
<span class='lineno'> 315</span>       raise ValueError(&quot;no checkpoint found in dir %s&quot; %
<span class='lineno'> 316</span>                        self.checkpoint_manager.directory)
<span class='lineno'> 317</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._restore_model', title='(Controller, ?) -> None / (Controller, None) -> None'>_restore_model</a>()
<span class='lineno'> 318</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller._evaluate_once', title='(Controller, int) -> None / (Controller, ?) -> None'>_evaluate_once</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.evaluate.self', title='Controller'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller.Controller.global_step', title='None'>global_step</a>.numpy())
<span class='lineno'> 319</span> 
<span class='lineno'> 320</span> 
<span class='lineno'> 321</span> class <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer', title='<_StepTimer>'>_StepTimer</a>(object):
<span class='lineno'> 322</span>   &quot;&quot;&quot;Utility class for measuring steps/second.&quot;&quot;&quot;
<span class='lineno'> 323</span> 
<span class='lineno'> 324</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__', title='? -> ?'>__init__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', title='_StepTimer'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.step', title='None'>ste</a>p):
<span class='lineno'> 325</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', title='_StepTimer'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', title='None'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', title='None'>step</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.step', title='None'>step</a>
<span class='lineno'> 326</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.__init__.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', title='_StepTimer -> None'>start</a>()
<span class='lineno'> 327</span> 
<span class='lineno'> 328</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', title='_StepTimer -> None'>start</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', title='_StepTimer'>sel</a>f):
<span class='lineno'> 329</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', title='_StepTimer'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_iteration', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_iteration', title='?'>last_iteration</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', title='None'>step</a>.numpy()
<span class='lineno'> 330</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start.self', title='_StepTimer'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_time', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_time', title='int'>last_time</a> = time.time()
<span class='lineno'> 331</span> 
<span class='lineno'> 332</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second', title='(_StepTimer, ?) -> int'>steps_per_second</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', title='_StepTimer'>sel</a>f, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.restart', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.restart', title='?'>res</a>tart=True):
<span class='lineno'> 333</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.value', title='int'>value</a> = ((<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.step', title='None'>step</a>.numpy() - <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_iteration', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_iteration', title='?'>last_iteration</a>) /
<span class='lineno'> 334</span>              (time.time() - <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_time', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.last_time', title='int'>last_time</a>))
<span class='lineno'> 335</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.restart', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.restart', title='?'>restart</a>:
<span class='lineno'> 336</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.self', title='_StepTimer'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.start', title='_StepTimer -> None'>start</a>()
<span class='lineno'> 337</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.staging.training.controller._StepTimer.steps_per_second.value', title='int'>value</a>
</pre></td></tr></table></body></html>