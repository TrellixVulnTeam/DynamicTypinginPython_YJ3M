<html>
<head>
<meta charset="utf-8">
<title>/home/xxm/Desktop/EMSE/dataset/models/official/nlp/transformer/beam_search_v1.py</title>
<style type='text/css'>
body { color: #666666; }
a {
    text-decoration: none; color: #5AA2A7;
    border: solid 1px rgba(255,255,255,0);
}
a.active {
    background: -webkit-linear-gradient(top,rgba(255, 255, 200, 0.35) 0,rgba(255, 255, 200, 0.55) 100%);
    border: solid 1px #E5E600;
}
table, th, td { border: 1px solid lightgrey; padding: 5px; corner: rounded; }
.builtin {color: #B17E41;}
.comment, .block-comment {color: #aaaaaa; font-style: italic;}
.constant {color: #888888;}
.decorator {color: #778899;}
.doc-string {color: #aaaaaa;}
.error {border-bottom: 1px solid red;}
.field-name {color: #2e8b57;}
.function {color: #4682b4;}
.identifier {color: #8b7765;}
.info {border-bottom: 1px dotted RoyalBlue;}
.keyword {color: #0000cd;}
.lineno {color: #cccccc;}
.number {color: #483d8b;}
.parameter {color: #777777;}
.string {color: #999999;}
.type-name {color: #4682b4;}
.warning {border-bottom: 1px solid orange; padding-bottom: 1px}
</style>
<script language="JavaScript" type="text/javascript">
var highlighted;

function highlight(xid)
{
    var elms = document.querySelectorAll('[xid="' + xid + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "active";
    }
    highlighted = xid;
}

function clearHighlight() {
    var elms = document.querySelectorAll('[xid="' + highlighted + '"]');
    for (k in elms) {
        v = elms[k]
        v.className = "";
    }
}

window.onload =
    function (e) {
        var tags = document.getElementsByTagName("A")
        for (var i = 0; i < tags.length; i++) {
            tags[i].onmouseover =
                function (e) {
                    clearHighlight();
                    var xid = e.toElement.getAttribute('xid');
                    highlight(xid);
                }
        }
    }</script>
</head>
<body>
<table width=100% border='1px solid gray'><tr><td valign='top'><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf'>inf</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys'>_StateKeys</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX'>CUR_INDEX</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ'>ALIVE_SEQ</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS'>ALIVE_LOG_PROBS</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE'>ALIVE_CACHE</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ'>FINISHED_SEQ</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES'>FINISHED_SCORES</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS'>FINISHED_FLAGS</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch'>SequenceBeamSearch</a><ul>
<li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__'>__init__</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search'>search</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state'>_create_initial_state</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search'>_continue_search</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step'>_search_step</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq'>_grow_alive_seq</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state'>_get_new_alive_state</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state'>_get_new_finished_state</a></li></ul>
</li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search'>sequence_beam_search</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits'>_log_prob_from_logits</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization'>_length_normalization</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size'>_expand_to_beam_size</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list'>_shape_list</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim'>_get_shape_keep_last_dim</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape'>_get_shape</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim'>_flatten_beam_dim</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim'>_unflatten_beam_dim</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams'>_gather_beams</a></li><li><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', xid='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams'>_gather_topk_beams</a></li></ul>
</td><td><pre><span class='lineno'>   1</span> # Copyright 2018 The TensorFlow Authors. All Rights Reserved.
<span class='lineno'>   2</span> #
<span class='lineno'>   3</span> # Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
<span class='lineno'>   4</span> # you may not use this file except in compliance with the License.
<span class='lineno'>   5</span> # You may obtain a copy of the License at
<span class='lineno'>   6</span> #
<span class='lineno'>   7</span> #     http://www.apache.org/licenses/LICENSE-2.0
<span class='lineno'>   8</span> #
<span class='lineno'>   9</span> # Unless required by applicable law or agreed to in writing, software
<span class='lineno'>  10</span> # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
<span class='lineno'>  11</span> # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
<span class='lineno'>  12</span> # See the License for the specific language governing permissions and
<span class='lineno'>  13</span> # limitations under the License.
<span class='lineno'>  14</span> # ==============================================================================
<span class='lineno'>  15</span> &quot;&quot;&quot;Beam search to find the translated sequence with the highest probability.
<span class='lineno'>  16</span> 
<span class='lineno'>  17</span> Source implementation from Tensor2Tensor:
<span class='lineno'>  18</span> https://github.com/tensorflow/tensor2tensor/blob/master/tensor2tensor/utils/beam_search.py
<span class='lineno'>  19</span> &quot;&quot;&quot;
<span class='lineno'>  20</span> 
<span class='lineno'>  21</span> import numpy as np
<span class='lineno'>  22</span> import tensorflow.compat.v1 as tf
<span class='lineno'>  23</span> from tensorflow.python.util import nest
<span class='lineno'>  24</span> 
<span class='lineno'>  25</span> 
<span class='lineno'>  26</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', title='? -> float'>inf</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', title='?'>dtype</a>):
<span class='lineno'>  27</span>   &quot;&quot;&quot;Returns a value close to infinity, but is still finite in `dtype`.
<span class='lineno'>  28</span> 
<span class='lineno'>  29</span>   This is useful to get a very large value that is still zero when multiplied by
<span class='lineno'>  30</span>   zero. The floating-point &quot;Inf&quot; value is NaN when multiplied by zero.
<span class='lineno'>  31</span> 
<span class='lineno'>  32</span>   Args:
<span class='lineno'>  33</span>     dtype: A dtype. The returned value will be finite when casted to this dtype.
<span class='lineno'>  34</span> 
<span class='lineno'>  35</span>   Returns:
<span class='lineno'>  36</span>     A very large value.
<span class='lineno'>  37</span>   &quot;&quot;&quot;
<span class='lineno'>  38</span>   if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', title='?'>dtype</a> == &quot;float32&quot; or <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', title='?'>dtype</a> == &quot;bfloat16&quot;:
<span class='lineno'>  39</span>     return 1e7
<span class='lineno'>  40</span>   elif <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf.dtype', title='?'>dtype</a> == &quot;float16&quot;:
<span class='lineno'>  41</span>     # Disable no-member lint error, as the linter thinks np.float16 does not
<span class='lineno'>  42</span>     # exist for some reason.
<span class='lineno'>  43</span>     return np.finfo(np.float16).max  # pylint: disable=no-member
<span class='lineno'>  44</span>   else:
<span class='lineno'>  45</span>     raise AssertionError(&#39;Invalid dtype: %s&#39; % dtype)
<span class='lineno'>  46</span> 
<span class='lineno'>  47</span> 
<span class='lineno'>  48</span> class <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>(object):
<span class='lineno'>  49</span>   &quot;&quot;&quot;Keys to dictionary storing the state of the beam search loop.&quot;&quot;&quot;
<span class='lineno'>  50</span> 
<span class='lineno'>  51</span>   # Variable storing the loop index.
<span class='lineno'>  52</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a> = &quot;CUR_INDEX&quot;
<span class='lineno'>  53</span> 
<span class='lineno'>  54</span>   # Top sequences that are alive for each batch item. Alive sequences are ones
<span class='lineno'>  55</span>   # that have not generated an EOS token. Sequences that reach EOS are marked as
<span class='lineno'>  56</span>   # finished and moved to the FINISHED_SEQ tensor.
<span class='lineno'>  57</span>   # Has shape [batch_size, beam_size, CUR_INDEX + 1]
<span class='lineno'>  58</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a> = &quot;ALIVE_SEQ&quot;
<span class='lineno'>  59</span>   # Log probabilities of each alive sequence. Shape [batch_size, beam_size]
<span class='lineno'>  60</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a> = &quot;ALIVE_LOG_PROBS&quot;
<span class='lineno'>  61</span>   # Dictionary of cached values for each alive sequence. The cache stores
<span class='lineno'>  62</span>   # the encoder output, attention bias, and the decoder attention output from
<span class='lineno'>  63</span>   # the previous iteration.
<span class='lineno'>  64</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a> = &quot;ALIVE_CACHE&quot;
<span class='lineno'>  65</span> 
<span class='lineno'>  66</span>   # Top finished sequences for each batch item.
<span class='lineno'>  67</span>   # Has shape [batch_size, beam_size, CUR_INDEX + 1]. Sequences that are
<span class='lineno'>  68</span>   # shorter than CUR_INDEX + 1 are padded with 0s.
<span class='lineno'>  69</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a> = &quot;FINISHED_SEQ&quot;
<span class='lineno'>  70</span>   # Scores for each finished sequence. Score = log probability / length norm
<span class='lineno'>  71</span>   # Shape [batch_size, beam_size]
<span class='lineno'>  72</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a> = &quot;FINISHED_SCORES&quot;
<span class='lineno'>  73</span>   # Flags indicating which sequences in the finished sequences are finished.
<span class='lineno'>  74</span>   # At the beginning, all of the sequences in FINISHED_SEQ are filler values.
<span class='lineno'>  75</span>   # True -&gt; finished sequence, False -&gt; filler. Shape [batch_size, beam_size]
<span class='lineno'>  76</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a> = &quot;FINISHED_FLAGS&quot;
<span class='lineno'>  77</span> 
<span class='lineno'>  78</span> 
<span class='lineno'>  79</span> class <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch', title='<SequenceBeamSearch>'>SequenceBeamSearch</a>(object):
<span class='lineno'>  80</span>   &quot;&quot;&quot;Implementation of beam search loop.&quot;&quot;&quot;
<span class='lineno'>  81</span> 
<span class='lineno'>  82</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__', title='? -> ?'>__init__</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>,
<span class='lineno'>  83</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a>,
<span class='lineno'>  84</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.vocab_size', title='?'>vocab_size</a>,
<span class='lineno'>  85</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.batch_size', title='?'>batch_size</a>,
<span class='lineno'>  86</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.beam_size', title='?'>beam_size</a>,
<span class='lineno'>  87</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.alpha', title='?'>alpha</a>,
<span class='lineno'>  88</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.max_decode_length', title='?'>max_decode_length</a>,
<span class='lineno'>  89</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.eos_id', title='?'>eos_id</a>,
<span class='lineno'>  90</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.padded_decode', title='bool'>padded_decode</a>,
<span class='lineno'>  91</span>                <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.dtype', title='?'>dtype</a>=tf.float32):
<span class='lineno'>  92</span>     &quot;&quot;&quot;Initialize sequence beam search.
<span class='lineno'>  93</span> 
<span class='lineno'>  94</span>     Args:
<span class='lineno'>  95</span>       symbols_to_logits_fn: A function to provide logits, which is the
<span class='lineno'>  96</span>         interface to the Transformer model. The passed in arguments are:
<span class='lineno'>  97</span>           ids -&gt; A tensor with shape [batch_size * beam_size, index].
<span class='lineno'>  98</span>           index -&gt; A scalar.
<span class='lineno'>  99</span>           cache -&gt; A nested dictionary of tensors [batch_size * beam_size, ...].
<span class='lineno'> 100</span>         The function must return a tuple of logits and the updated cache:
<span class='lineno'> 101</span>           logits -&gt; A tensor with shape [batch * beam_size, vocab_size].
<span class='lineno'> 102</span>           updated cache -&gt; A nested dictionary with the same structure as the
<span class='lineno'> 103</span>             input cache.
<span class='lineno'> 104</span>       vocab_size: An integer, the size of the vocabulary, used for topk
<span class='lineno'> 105</span>         computation.
<span class='lineno'> 106</span>       batch_size: An integer, the decode batch size.
<span class='lineno'> 107</span>       beam_size: An integer, number of beams for beam search.
<span class='lineno'> 108</span>       alpha: A float, defining the strength of length normalization.
<span class='lineno'> 109</span>       max_decode_length: An integer, the maximum number of steps to decode
<span class='lineno'> 110</span>         a sequence.
<span class='lineno'> 111</span>       eos_id: An integer. ID of end of sentence token.
<span class='lineno'> 112</span>       padded_decode: A bool, indicating if max_sequence_length padding is used
<span class='lineno'> 113</span>         for beam search.
<span class='lineno'> 114</span>       dtype: A tensorflow data type used for score computation. The default is
<span class='lineno'> 115</span>         tf.float32.
<span class='lineno'> 116</span>     &quot;&quot;&quot;
<span class='lineno'> 117</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a>
<span class='lineno'> 118</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', title='?'>vocab_size</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.vocab_size', title='?'>vocab_size</a>
<span class='lineno'> 119</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.batch_size', title='?'>batch_size</a>
<span class='lineno'> 120</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.beam_size', title='?'>beam_size</a>
<span class='lineno'> 121</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', title='?'>alpha</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.alpha', title='?'>alpha</a>
<span class='lineno'> 122</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.max_decode_length', title='?'>max_decode_length</a>
<span class='lineno'> 123</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', title='?'>eos_id</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.eos_id', title='?'>eos_id</a>
<span class='lineno'> 124</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='bool'><a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='bool'>padded_decode</a></a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.padded_decode', title='bool'>padded_decode</a>
<span class='lineno'> 125</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.self', title='SequenceBeamSearch'>self</a>.<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a></a> = tf.as_dtype(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.__init__.dtype', title='?'>dtype</a>)
<span class='lineno'> 126</span> 
<span class='lineno'> 127</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search', title='(SequenceBeamSearch, ?, ?) -> (?, ?)'>search</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_ids', title='?'>initial_ids</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_cache', title='?'>initial_cache</a>):
<span class='lineno'> 128</span>     &quot;&quot;&quot;Beam search for sequences with highest scores.&quot;&quot;&quot;
<span class='lineno'> 129</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state', title='dict'>state</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state_shapes', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state_shapes', title='dict'>state_shapes</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state', title='(SequenceBeamSearch, ?, ?) -> (dict, dict)'>_create_initial_state</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_ids', title='?'>initial_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.initial_cache', title='?'>initial_cache</a>)
<span class='lineno'> 130</span> 
<span class='lineno'> 131</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a> = tf.while_loop(
<span class='lineno'> 132</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search', title='(SequenceBeamSearch, ?) -> None'>_continue_search</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step', title='(SequenceBeamSearch, ?) -> [dict]'>_search_step</a>, loop_vars=[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state', title='dict'>state</a>],
<span class='lineno'> 133</span>         shape_invariants=[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state_shapes', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.state_shapes', title='dict'>state_shapes</a>], parallel_iterations=1, back_prop=False)
<span class='lineno'> 134</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[0]
<span class='lineno'> 135</span> 
<span class='lineno'> 136</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_seq', title='?'>alive_seq</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>]
<span class='lineno'> 137</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_log_probs', title='?'>alive_log_probs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>]
<span class='lineno'> 138</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', title='?'>finished_seq</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>]
<span class='lineno'> 139</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', title='?'>finished_scores</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>]
<span class='lineno'> 140</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', title='?'>finished_flags</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_state', title='?'>finished_state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>]
<span class='lineno'> 141</span> 
<span class='lineno'> 142</span>     # Account for corner case where there are no finished sequences for a
<span class='lineno'> 143</span>     # particular batch item. In that case, return alive sequences for that batch
<span class='lineno'> 144</span>     # item.
<span class='lineno'> 145</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', title='?'>finished_seq</a> = tf.where(
<span class='lineno'> 146</span>         tf.reduce_any(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', title='?'>finished_flags</a>, 1), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', title='?'>finished_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_seq', title='?'>alive_seq</a>)
<span class='lineno'> 147</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', title='?'>finished_scores</a> = tf.where(
<span class='lineno'> 148</span>         tf.reduce_any(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_flags', title='?'>finished_flags</a>, 1), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', title='?'>finished_scores</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.alive_log_probs', title='?'>alive_log_probs</a>)
<span class='lineno'> 149</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_seq', title='?'>finished_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search.finished_scores', title='?'>finished_scores</a>
<span class='lineno'> 150</span> 
<span class='lineno'> 151</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state', title='(SequenceBeamSearch, ?, ?) -> (dict, dict)'>_create_initial_state</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_ids', title='?'>initial_ids</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', title='?'>initial_cache</a>):
<span class='lineno'> 152</span>     &quot;&quot;&quot;Return initial state dictionary and its shape invariants.
<span class='lineno'> 153</span> 
<span class='lineno'> 154</span>     Args:
<span class='lineno'> 155</span>       initial_ids: initial ids to pass into the symbols_to_logits_fn.
<span class='lineno'> 156</span>         int tensor with shape [batch_size, 1]
<span class='lineno'> 157</span>       initial_cache: dictionary storing values to be passed into the
<span class='lineno'> 158</span>         symbols_to_logits_fn.
<span class='lineno'> 159</span> 
<span class='lineno'> 160</span>     Returns:
<span class='lineno'> 161</span>         state and shape invariant dictionaries with keys from _StateKeys
<span class='lineno'> 162</span>     &quot;&quot;&quot;
<span class='lineno'> 163</span>     for <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.key', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.key', title='?'>key</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.value', title='?'>value</a> in <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', title='?'>initial_cache</a>.items():
<span class='lineno'> 164</span>       for <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.inner_value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.inner_value', title='?'>inner_value</a> in nest.flatten(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.value', title='?'>value</a>):
<span class='lineno'> 165</span>         if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.inner_value', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.inner_value', title='?'>inner_value</a>.dtype != <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>:
<span class='lineno'> 166</span>           raise TypeError(
<span class='lineno'> 167</span>               &quot;initial_cache element for key &#39;%s&#39; has dtype %s that does not &quot;
<span class='lineno'> 168</span>               &quot;match SequenceBeamSearch&#39;s dtype of %s. Value: %s&quot; %
<span class='lineno'> 169</span>               (key, value.dtype.name, self.dtype.name, inner_value))
<span class='lineno'> 170</span> 
<span class='lineno'> 171</span>     # Current loop index (starts at 0)
<span class='lineno'> 172</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.cur_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.cur_index', title='?'>cur_index</a> = tf.constant(0)
<span class='lineno'> 173</span> 
<span class='lineno'> 174</span>     # Create alive sequence with shape [batch_size, beam_size, 1]
<span class='lineno'> 175</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='None'>alive_seq</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', title='(?, ?) -> None'>_expand_to_beam_size</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_ids', title='?'>initial_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>)
<span class='lineno'> 176</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='?'>alive_seq</a> = tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='None'>alive_seq</a>, axis=2)
<span class='lineno'> 177</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='bool'>padded_decode</a>:
<span class='lineno'> 178</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='?'>alive_seq</a> = tf.tile(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='?'>alive_seq</a>, [1, 1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a> + 1])
<span class='lineno'> 179</span> 
<span class='lineno'> 180</span>     # Create tensor for storing initial log probabilities.
<span class='lineno'> 181</span>     # Assume initial_ids are prob 1.0
<span class='lineno'> 182</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_log_probs', title='?'>initial_log_probs</a> = tf.constant(
<span class='lineno'> 183</span>         [[0.] + [-float(&quot;inf&quot;)] * (<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a> - 1)], dtype=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)
<span class='lineno'> 184</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_log_probs', title='?'>alive_log_probs</a> = tf.tile(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_log_probs', title='?'>initial_log_probs</a>, [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, 1])
<span class='lineno'> 185</span> 
<span class='lineno'> 186</span>     # Expand all values stored in the dictionary to the beam size, so that each
<span class='lineno'> 187</span>     # beam has a separate cache.
<span class='lineno'> 188</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', title='?'>alive_cache</a> = nest.map_structure(
<span class='lineno'> 189</span>         lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.lambda%111.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.lambda%111.t', title='?'>t</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', title='(?, ?) -> None'>_expand_to_beam_size</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.lambda%111.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.lambda%111.t', title='?'>t</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.initial_cache', title='?'>initial_cache</a>)
<span class='lineno'> 190</span> 
<span class='lineno'> 191</span>     # Initialize tensor storing finished sequences with filler values.
<span class='lineno'> 192</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_seq', title='?'>finished_seq</a> = tf.zeros(tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='?'>alive_seq</a>), tf.int32)
<span class='lineno'> 193</span> 
<span class='lineno'> 194</span>     # Set scores of the initial finished seqs to negative infinity.
<span class='lineno'> 195</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_scores', title='float'>finished_scores</a> = tf.ones([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>],
<span class='lineno'> 196</span>                               dtype=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>) * -<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', title='? -> float'>inf</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)
<span class='lineno'> 197</span> 
<span class='lineno'> 198</span>     # Initialize finished flags with all False values.
<span class='lineno'> 199</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_flags', title='?'>finished_flags</a> = tf.zeros([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>], tf.bool)
<span class='lineno'> 200</span> 
<span class='lineno'> 201</span>     # Create state dictionary
<span class='lineno'> 202</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state', title='dict'>state</a> = {
<span class='lineno'> 203</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.cur_index', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.cur_index', title='?'>cur_index</a>,
<span class='lineno'> 204</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_seq', title='?'>alive_seq</a>,
<span class='lineno'> 205</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_log_probs', title='?'>alive_log_probs</a>,
<span class='lineno'> 206</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', title='?'>alive_cache</a>,
<span class='lineno'> 207</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_seq', title='?'>finished_seq</a>,
<span class='lineno'> 208</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_scores', title='float'>finished_scores</a>,
<span class='lineno'> 209</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.finished_flags', title='?'>finished_flags</a>
<span class='lineno'> 210</span>     }
<span class='lineno'> 211</span> 
<span class='lineno'> 212</span>     # Create state invariants for each value in the state dictionary. Each
<span class='lineno'> 213</span>     # dimension must be a constant or None. A None dimension means either:
<span class='lineno'> 214</span>     #   1) the dimension&#39;s value is a tensor that remains the same but may
<span class='lineno'> 215</span>     #      depend on the input sequence to the model (e.g. batch size).
<span class='lineno'> 216</span>     #   2) the dimension may have different values on different iterations.
<span class='lineno'> 217</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='bool'>padded_decode</a>:
<span class='lineno'> 218</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', title='dict'>state_shape_invariants</a> = {
<span class='lineno'> 219</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>:
<span class='lineno'> 220</span>               tf.TensorShape([]),
<span class='lineno'> 221</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>:
<span class='lineno'> 222</span>               tf.TensorShape(
<span class='lineno'> 223</span>                   [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>,
<span class='lineno'> 224</span>                    <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a> + 1]),
<span class='lineno'> 225</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>:
<span class='lineno'> 226</span>               tf.TensorShape([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>]),
<span class='lineno'> 227</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a>:
<span class='lineno'> 228</span>               nest.map_structure(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape', title='? -> None'>_get_shape</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', title='?'>alive_cache</a>),
<span class='lineno'> 229</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>:
<span class='lineno'> 230</span>               tf.TensorShape(
<span class='lineno'> 231</span>                   [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>,
<span class='lineno'> 232</span>                    <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a> + 1]),
<span class='lineno'> 233</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>:
<span class='lineno'> 234</span>               tf.TensorShape([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>]),
<span class='lineno'> 235</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>:
<span class='lineno'> 236</span>               tf.TensorShape([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>])
<span class='lineno'> 237</span>       }
<span class='lineno'> 238</span>     else:
<span class='lineno'> 239</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', title='dict'>state_shape_invariants</a> = {
<span class='lineno'> 240</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>:
<span class='lineno'> 241</span>               tf.TensorShape([]),
<span class='lineno'> 242</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>:
<span class='lineno'> 243</span>               tf.TensorShape([None, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>, None]),
<span class='lineno'> 244</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>:
<span class='lineno'> 245</span>               tf.TensorShape([None, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>]),
<span class='lineno'> 246</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a>:
<span class='lineno'> 247</span>               nest.map_structure(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim', title='? -> None'>_get_shape_keep_last_dim</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.alive_cache', title='?'>alive_cache</a>),
<span class='lineno'> 248</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>:
<span class='lineno'> 249</span>               tf.TensorShape([None, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>, None]),
<span class='lineno'> 250</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>:
<span class='lineno'> 251</span>               tf.TensorShape([None, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>]),
<span class='lineno'> 252</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>:
<span class='lineno'> 253</span>               tf.TensorShape([None, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>])
<span class='lineno'> 254</span>       }
<span class='lineno'> 255</span> 
<span class='lineno'> 256</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state', title='dict'>state</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._create_initial_state.state_shape_invariants', title='dict'>state_shape_invariants</a>
<span class='lineno'> 257</span> 
<span class='lineno'> 258</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search', title='(SequenceBeamSearch, ?) -> None'>_continue_search</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', title='?'>state</a>):
<span class='lineno'> 259</span>     &quot;&quot;&quot;Return whether to continue the search loop.
<span class='lineno'> 260</span> 
<span class='lineno'> 261</span>     The loops should terminate when
<span class='lineno'> 262</span>       1) when decode length has been reached, or
<span class='lineno'> 263</span>       2) when the worst score in the finished sequences is better than the best
<span class='lineno'> 264</span>          score in the alive sequences (i.e. the finished sequences are provably
<span class='lineno'> 265</span>          unchanging)
<span class='lineno'> 266</span> 
<span class='lineno'> 267</span>     Args:
<span class='lineno'> 268</span>       state: A dictionary with the current loop state.
<span class='lineno'> 269</span> 
<span class='lineno'> 270</span>     Returns:
<span class='lineno'> 271</span>       Bool tensor with value True if loop should continue, False if loop should
<span class='lineno'> 272</span>       terminate.
<span class='lineno'> 273</span>     &quot;&quot;&quot;
<span class='lineno'> 274</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.i', title='?'>i</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>]
<span class='lineno'> 275</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.alive_log_probs', title='?'>alive_log_probs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>]
<span class='lineno'> 276</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', title='?'>finished_scores</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>]
<span class='lineno'> 277</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', title='?'>finished_flags</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>]
<span class='lineno'> 278</span> 
<span class='lineno'> 279</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.not_at_max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.not_at_max_decode_length', title='?'>not_at_max_decode_length</a> = tf.less(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.i', title='?'>i</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a>)
<span class='lineno'> 280</span> 
<span class='lineno'> 281</span>     # Calculate largest length penalty (the larger penalty, the better score).
<span class='lineno'> 282</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.max_length_norm', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.max_length_norm', title='None'>max_length_norm</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', title='(?, int, ?) -> None / (?, ?, ?) -> None'>_length_normalization</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', title='?'>alpha</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.max_decode_length', title='?'>max_decode_length</a>,
<span class='lineno'> 283</span>                                             dtype=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)
<span class='lineno'> 284</span>     # Get the best possible scores from alive sequences.
<span class='lineno'> 285</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.best_alive_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.best_alive_scores', title='None'>best_alive_scores</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.alive_log_probs', title='?'>alive_log_probs</a>[:, 0] / <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.max_length_norm', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.max_length_norm', title='None'>max_length_norm</a>
<span class='lineno'> 286</span> 
<span class='lineno'> 287</span>     # Compute worst score in finished sequences for each batch element
<span class='lineno'> 288</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', title='?'>finished_scores</a></a> *= tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', title='?'>finished_flags</a>,
<span class='lineno'> 289</span>                                <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)  # set filler scores to zero
<span class='lineno'> 290</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', title='?'>lowest_finished_scores</a> = tf.reduce_min(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_scores', title='?'>finished_scores</a>, axis=1)
<span class='lineno'> 291</span> 
<span class='lineno'> 292</span>     # If there are no finished sequences in a batch element, then set the lowest
<span class='lineno'> 293</span>     # finished score to -INF for that element.
<span class='lineno'> 294</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_batches', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_batches', title='?'>finished_batches</a> = tf.reduce_any(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_flags', title='?'>finished_flags</a>, 1)
<span class='lineno'> 295</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', title='float'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', title='?'>lowest_finished_scores</a></a> += ((1.0 -
<span class='lineno'> 296</span>                                 tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_batches', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.finished_batches', title='?'>finished_batches</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)) *
<span class='lineno'> 297</span>                                -<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', title='? -> float'>inf</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>))
<span class='lineno'> 298</span> 
<span class='lineno'> 299</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.worst_finished_score_better_than_best_alive_score', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.worst_finished_score_better_than_best_alive_score', title='?'>worst_finished_score_better_than_best_alive_score</a> = tf.reduce_all(
<span class='lineno'> 300</span>         tf.greater(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.lowest_finished_scores', title='float'>lowest_finished_scores</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.best_alive_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.best_alive_scores', title='None'>best_alive_scores</a>)
<span class='lineno'> 301</span>     )
<span class='lineno'> 302</span> 
<span class='lineno'> 303</span>     return tf.logical_and(
<span class='lineno'> 304</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.not_at_max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.not_at_max_decode_length', title='?'>not_at_max_decode_length</a>,
<span class='lineno'> 305</span>         tf.logical_not(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.worst_finished_score_better_than_best_alive_score', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._continue_search.worst_finished_score_better_than_best_alive_score', title='?'>worst_finished_score_better_than_best_alive_score</a>)
<span class='lineno'> 306</span>     )
<span class='lineno'> 307</span> 
<span class='lineno'> 308</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step', title='(SequenceBeamSearch, ?) -> [dict]'>_search_step</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', title='?'>state</a>):
<span class='lineno'> 309</span>     &quot;&quot;&quot;Beam search loop body.
<span class='lineno'> 310</span> 
<span class='lineno'> 311</span>     Grow alive sequences by a single ID. Sequences that have reached the EOS
<span class='lineno'> 312</span>     token are marked as finished. The alive and finished sequences with the
<span class='lineno'> 313</span>     highest log probabilities and scores are returned.
<span class='lineno'> 314</span> 
<span class='lineno'> 315</span>     A sequence&#39;s finished score is calculating by dividing the log probability
<span class='lineno'> 316</span>     by the length normalization factor. Without length normalization, the
<span class='lineno'> 317</span>     search is more likely to return shorter sequences.
<span class='lineno'> 318</span> 
<span class='lineno'> 319</span>     Args:
<span class='lineno'> 320</span>       state: A dictionary with the current loop state.
<span class='lineno'> 321</span> 
<span class='lineno'> 322</span>     Returns:
<span class='lineno'> 323</span>       new state dictionary.
<span class='lineno'> 324</span>     &quot;&quot;&quot;
<span class='lineno'> 325</span>     # Grow alive sequences by one token.
<span class='lineno'> 326</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', title='?'>new_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', title='?'>new_log_probs</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.topk_ids', title='?'>topk_ids</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_cache', title='?'>new_cache</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq', title='(SequenceBeamSearch, ?) -> (?, ?, ?, ?)'>_grow_alive_seq</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', title='?'>state</a>)
<span class='lineno'> 327</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', title='?'>new_finished_flags</a> = tf.equal(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.topk_ids', title='?'>topk_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.eos_id', title='?'>eos_id</a>)
<span class='lineno'> 328</span>     # Collect top beam_size alive sequences
<span class='lineno'> 329</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.alive_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.alive_state', title='dict'>alive_state</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state', title='(SequenceBeamSearch, ?, ?, ?, ?) -> dict'>_get_new_alive_state</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', title='?'>new_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', title='?'>new_log_probs</a>,
<span class='lineno'> 330</span>                                             <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', title='?'>new_finished_flags</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_cache', title='?'>new_cache</a>)
<span class='lineno'> 331</span> 
<span class='lineno'> 332</span>     # Combine newly finished sequences with existing finished sequences, and
<span class='lineno'> 333</span>     # collect the top k scoring sequences.
<span class='lineno'> 334</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.finished_state', title='dict'>finished_state</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state', title='(SequenceBeamSearch, ?, ?, ?, ?) -> dict'>_get_new_finished_state</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', title='?'>state</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_seq', title='?'>new_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_log_probs', title='?'>new_log_probs</a>,
<span class='lineno'> 335</span>                                                   <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_finished_flags', title='?'>new_finished_flags</a>)
<span class='lineno'> 336</span> 
<span class='lineno'> 337</span>     # Increment loop index and create new state dictionary
<span class='lineno'> 338</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', title='dict'>new_state</a> = {<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>] + 1}
<span class='lineno'> 339</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', title='dict'>new_state</a>.update(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.alive_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.alive_state', title='dict'>alive_state</a>)
<span class='lineno'> 340</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', title='dict'>new_state</a>.update(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.finished_state', title='dict'>finished_state</a>)
<span class='lineno'> 341</span>     return [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._search_step.new_state', title='dict'>new_state</a>]
<span class='lineno'> 342</span> 
<span class='lineno'> 343</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq', title='(SequenceBeamSearch, ?) -> (?, ?, ?, ?)'>_grow_alive_seq</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', title='?'>state</a>):
<span class='lineno'> 344</span>     &quot;&quot;&quot;Grow alive sequences by one token, and collect top 2*beam_size sequences.
<span class='lineno'> 345</span> 
<span class='lineno'> 346</span>     2*beam_size sequences are collected because some sequences may have reached
<span class='lineno'> 347</span>     the EOS token. 2*beam_size ensures that at least beam_size sequences are
<span class='lineno'> 348</span>     still alive.
<span class='lineno'> 349</span> 
<span class='lineno'> 350</span>     Args:
<span class='lineno'> 351</span>       state: A dictionary with the current loop state.
<span class='lineno'> 352</span>     Returns:
<span class='lineno'> 353</span>       Tuple of
<span class='lineno'> 354</span>       (Top 2*beam_size sequences [batch_size, 2 * beam_size, cur_index + 1],
<span class='lineno'> 355</span>        Scores of returned sequences [batch_size, 2 * beam_size],
<span class='lineno'> 356</span>        New alive cache, for each of the 2 * beam_size sequences)
<span class='lineno'> 357</span>     &quot;&quot;&quot;
<span class='lineno'> 358</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', title='?'>i</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>]
<span class='lineno'> 359</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', title='?'>alive_seq</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>]
<span class='lineno'> 360</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_log_probs', title='?'>alive_log_probs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>]
<span class='lineno'> 361</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_cache', title='?'>alive_cache</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a>]
<span class='lineno'> 362</span> 
<span class='lineno'> 363</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', title='int'>beams_to_keep</a> = 2 * <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>
<span class='lineno'> 364</span> 
<span class='lineno'> 365</span>     # Get logits for the next candidate IDs for the alive sequences. Get the new
<span class='lineno'> 366</span>     # cache values at the same time.
<span class='lineno'> 367</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='?'>padded_decode</a>:
<span class='lineno'> 368</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', title='?'>flat_ids</a> = tf.reshape(
<span class='lineno'> 369</span>           tf.slice(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', title='?'>alive_seq</a>, [0, 0, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', title='?'>i</a>], [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>, 1]),
<span class='lineno'> 370</span>           [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>, -1])
<span class='lineno'> 371</span>     else:
<span class='lineno'> 372</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', title='None'>flat_ids</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', title='? -> None'>_flatten_beam_dim</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', title='?'>alive_seq</a>)  # [batch_size * beam_size]
<span class='lineno'> 373</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', title='?'>flat_cache</a> = nest.map_structure(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', title='? -> None'>_flatten_beam_dim</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_cache', title='?'>alive_cache</a>)
<span class='lineno'> 374</span> 
<span class='lineno'> 375</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_logits', title='?'>flat_logits</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', title='?'>flat_cache</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_ids', title='None'>flat_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', title='?'>i</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', title='?'>flat_cache</a>)
<span class='lineno'> 376</span> 
<span class='lineno'> 377</span>     # Unflatten logits to shape [batch_size, beam_size, vocab_size]
<span class='lineno'> 378</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.logits', title='None'>logits</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', title='(?, ?, ?) -> None'>_unflatten_beam_dim</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_logits', title='?'>flat_logits</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>)
<span class='lineno'> 379</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', title='?'>new_cache</a> = nest.map_structure(
<span class='lineno'> 380</span>         lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.lambda%112.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.lambda%112.t', title='?'>t</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', title='(?, ?, ?) -> None'>_unflatten_beam_dim</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.lambda%112.t', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.lambda%112.t', title='?'>t</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>),
<span class='lineno'> 381</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_cache', title='?'>flat_cache</a>)
<span class='lineno'> 382</span> 
<span class='lineno'> 383</span>     # Convert logits to normalized log probs
<span class='lineno'> 384</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.candidate_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.candidate_log_probs', title='None'>candidate_log_probs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits', title='? -> ? / None -> None'>_log_prob_from_logits</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.logits', title='None'>logits</a>)
<span class='lineno'> 385</span> 
<span class='lineno'> 386</span>     # Calculate new log probabilities if each of the alive sequences were
<span class='lineno'> 387</span>     # extended # by the the candidate IDs.
<span class='lineno'> 388</span>     # Shape [batch_size, beam_size, vocab_size]
<span class='lineno'> 389</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.log_probs', title='None'>log_probs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.candidate_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.candidate_log_probs', title='None'>candidate_log_probs</a> + tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_log_probs', title='?'>alive_log_probs</a>, axis=2)
<span class='lineno'> 390</span> 
<span class='lineno'> 391</span>     # Each batch item has beam_size * vocab_size candidate sequences. For each
<span class='lineno'> 392</span>     # batch item, get the k candidates with the highest log probabilities.
<span class='lineno'> 393</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_log_probs', title='?'>flat_log_probs</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.log_probs', title='None'>log_probs</a>,
<span class='lineno'> 394</span>                                 [-1, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', title='?'>vocab_size</a>])
<span class='lineno'> 395</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_log_probs', title='?'>topk_log_probs</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', title='?'>topk_indices</a> = tf.nn.top_k(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.flat_log_probs', title='?'>flat_log_probs</a>, k=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', title='int'>beams_to_keep</a>)
<span class='lineno'> 396</span> 
<span class='lineno'> 397</span>     # Extract the alive sequences that generate the highest log probabilities
<span class='lineno'> 398</span>     # after being extended.
<span class='lineno'> 399</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_beam_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_beam_indices', title='?'>topk_beam_indices</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', title='?'>topk_indices</a> // <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', title='?'>vocab_size</a>
<span class='lineno'> 400</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', title='?'>new_cache</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', title='([?], ?, ?, ?) -> None / ([float], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([?], ?, ?, int) -> None'>_gather_beams</a>(
<span class='lineno'> 401</span>         [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.alive_seq', title='?'>alive_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', title='?'>new_cache</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_beam_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_beam_indices', title='?'>topk_beam_indices</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>,
<span class='lineno'> 402</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.beams_to_keep', title='int'>beams_to_keep</a>)
<span class='lineno'> 403</span> 
<span class='lineno'> 404</span>     # Append the most probable IDs to the topk sequences
<span class='lineno'> 405</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', title='?'>topk_ids</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_indices', title='?'>topk_indices</a> % <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.vocab_size', title='?'>vocab_size</a>
<span class='lineno'> 406</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='?'>padded_decode</a>:
<span class='lineno'> 407</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, perm=[2, 0, 1])
<span class='lineno'> 408</span>       # TODO(b/145533236, hongkuny): Reverts once TF fix the validation.
<span class='lineno'> 409</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a> = tf.tensor_scatter_nd_update(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, [[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.i', title='?'>i</a> + 1]],
<span class='lineno'> 410</span>                                              tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', title='?'>topk_ids</a>, axis=0))
<span class='lineno'> 411</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a> = tf.transpose(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, perm=[1, 2, 0])
<span class='lineno'> 412</span>     else:
<span class='lineno'> 413</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', title='?'>topk_ids</a>, axis=2)], axis=2)
<span class='lineno'> 414</span>     return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_seq', title='?'>topk_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_log_probs', title='?'>topk_log_probs</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.topk_ids', title='?'>topk_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._grow_alive_seq.new_cache', title='?'>new_cache</a>
<span class='lineno'> 415</span> 
<span class='lineno'> 416</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state', title='(SequenceBeamSearch, ?, ?, ?, ?) -> dict'>_get_new_alive_state</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_seq', title='?'>new_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', title='?'>new_log_probs</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_finished_flags', title='?'>new_finished_flags</a>,
<span class='lineno'> 417</span>                            <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_cache', title='?'>new_cache</a>):
<span class='lineno'> 418</span>     &quot;&quot;&quot;Gather the top k sequences that are still alive.
<span class='lineno'> 419</span> 
<span class='lineno'> 420</span>     Args:
<span class='lineno'> 421</span>       new_seq: New sequences generated by growing the current alive sequences
<span class='lineno'> 422</span>         int32 tensor with shape [batch_size, 2 * beam_size, cur_index + 1]
<span class='lineno'> 423</span>       new_log_probs: Log probabilities of new sequences float32 tensor with
<span class='lineno'> 424</span>         shape [batch_size, beam_size]
<span class='lineno'> 425</span>       new_finished_flags: A boolean Tensor indicates which sequences are live
<span class='lineno'> 426</span>         inside the beam.
<span class='lineno'> 427</span>       new_cache: Dict of cached values for each sequence.
<span class='lineno'> 428</span> 
<span class='lineno'> 429</span>     Returns:
<span class='lineno'> 430</span>       Dictionary with alive keys from _StateKeys:
<span class='lineno'> 431</span>         {Top beam_size sequences that are still alive (don&#39;t end with eos_id)
<span class='lineno'> 432</span>          Log probabilities of top alive sequences
<span class='lineno'> 433</span>          Dict cache storing decoder states for top alive sequences}
<span class='lineno'> 434</span>     &quot;&quot;&quot;
<span class='lineno'> 435</span>     # To prevent finished sequences from being considered, set log probs to -inf
<span class='lineno'> 436</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', title='float'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', title='?'>new_log_probs</a></a> += tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_finished_flags', title='?'>new_finished_flags</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>) * -<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', title='? -> float'>inf</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)
<span class='lineno'> 437</span> 
<span class='lineno'> 438</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_seq', title='?'>top_alive_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_log_probs', title='?'>top_alive_log_probs</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_cache', title='?'>top_alive_cache</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', title='([?], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([float], float, ?, ?) -> None'>_gather_topk_beams</a>(
<span class='lineno'> 439</span>         [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_seq', title='?'>new_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', title='float'>new_log_probs</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_cache', title='?'>new_cache</a>], <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.new_log_probs', title='float'>new_log_probs</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>,
<span class='lineno'> 440</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>)
<span class='lineno'> 441</span> 
<span class='lineno'> 442</span>     return {
<span class='lineno'> 443</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_SEQ', title='str'>ALIVE_SEQ</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_seq', title='?'>top_alive_seq</a>,
<span class='lineno'> 444</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_LOG_PROBS', title='str'>ALIVE_LOG_PROBS</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_log_probs', title='?'>top_alive_log_probs</a>,
<span class='lineno'> 445</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.ALIVE_CACHE', title='str'>ALIVE_CACHE</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_alive_state.top_alive_cache', title='?'>top_alive_cache</a>
<span class='lineno'> 446</span>     }
<span class='lineno'> 447</span> 
<span class='lineno'> 448</span>   def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state', title='(SequenceBeamSearch, ?, ?, ?, ?) -> dict'>_get_new_finished_state</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', title='?'>state</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_seq', title='?'>new_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_log_probs', title='?'>new_log_probs</a>,
<span class='lineno'> 449</span>                               <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', title='?'>new_finished_flags</a>):
<span class='lineno'> 450</span>     &quot;&quot;&quot;Combine new and old finished sequences, and gather the top k sequences.
<span class='lineno'> 451</span> 
<span class='lineno'> 452</span>     Args:
<span class='lineno'> 453</span>       state: A dictionary with the current loop state.
<span class='lineno'> 454</span>       new_seq: New sequences generated by growing the current alive sequences
<span class='lineno'> 455</span>         int32 tensor with shape [batch_size, beam_size, i + 1]
<span class='lineno'> 456</span>       new_log_probs: Log probabilities of new sequences float32 tensor with
<span class='lineno'> 457</span>         shape [batch_size, beam_size]
<span class='lineno'> 458</span>       new_finished_flags: A boolean Tensor indicates which sequences are live
<span class='lineno'> 459</span>         inside the beam.
<span class='lineno'> 460</span> 
<span class='lineno'> 461</span>     Returns:
<span class='lineno'> 462</span>       Dictionary with finished keys from _StateKeys:
<span class='lineno'> 463</span>         {Top beam_size finished sequences based on score,
<span class='lineno'> 464</span>          Scores of finished sequences,
<span class='lineno'> 465</span>          Finished flags of finished sequences}
<span class='lineno'> 466</span>     &quot;&quot;&quot;
<span class='lineno'> 467</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.i', title='?'>i</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.CUR_INDEX', title='str'>CUR_INDEX</a>]
<span class='lineno'> 468</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>]
<span class='lineno'> 469</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', title='?'>finished_scores</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>]
<span class='lineno'> 470</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', title='?'>finished_flags</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.state', title='?'>state</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>]
<span class='lineno'> 471</span> 
<span class='lineno'> 472</span>     # First append a column of 0-ids to finished_seq to increment the length.
<span class='lineno'> 473</span>     # New shape of finished_seq: [batch_size, beam_size, i + 1]
<span class='lineno'> 474</span>     if not <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.padded_decode', title='?'>padded_decode</a>:
<span class='lineno'> 475</span>       <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a> = tf.concat([
<span class='lineno'> 476</span>           <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a>,
<span class='lineno'> 477</span>           tf.zeros([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>, 1], tf.int32)
<span class='lineno'> 478</span>       ],
<span class='lineno'> 479</span>                                axis=2)
<span class='lineno'> 480</span> 
<span class='lineno'> 481</span>     # Calculate new seq scores from log probabilities.
<span class='lineno'> 482</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.length_norm', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.length_norm', title='None'>length_norm</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', title='(?, int, ?) -> None / (?, ?, ?) -> None'>_length_normalization</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.alpha', title='?'>alpha</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.i', title='?'>i</a> + 1, dtype=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)
<span class='lineno'> 483</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', title='None'>new_scores</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_log_probs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_log_probs', title='?'>new_log_probs</a> / <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.length_norm', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.length_norm', title='None'>length_norm</a>
<span class='lineno'> 484</span> 
<span class='lineno'> 485</span>     # Set the scores of the still-alive seq in new_seq to large negative values.
<span class='lineno'> 486</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', title='?'><a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', title='None'>new_scores</a></a> += ((1. - tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', title='?'>new_finished_flags</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>)) *
<span class='lineno'> 487</span>                    -<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.inf', title='? -> float'>inf</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.dtype', title='?'>dtype</a>))
<span class='lineno'> 488</span> 
<span class='lineno'> 489</span>     # Combine sequences, scores, and flags.
<span class='lineno'> 490</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_seq', title='?'>new_seq</a>], axis=1)
<span class='lineno'> 491</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', title='?'>finished_scores</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', title='?'>finished_scores</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_scores', title='?'>new_scores</a>], axis=1)
<span class='lineno'> 492</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', title='?'>finished_flags</a> = tf.concat([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', title='?'>finished_flags</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.new_finished_flags', title='?'>new_finished_flags</a>], axis=1)
<span class='lineno'> 493</span> 
<span class='lineno'> 494</span>     # Return the finished sequences with the best scores.
<span class='lineno'> 495</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_seq', title='?'>top_finished_seq</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_scores', title='?'>top_finished_scores</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_flags', title='?'>top_finished_flags</a> = (
<span class='lineno'> 496</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', title='([?], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([float], float, ?, ?) -> None'>_gather_topk_beams</a>([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_seq', title='?'>finished_seq</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', title='?'>finished_scores</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_flags', title='?'>finished_flags</a>],
<span class='lineno'> 497</span>                            <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.finished_scores', title='?'>finished_scores</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.self', title='SequenceBeamSearch'>self</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.beam_size', title='?'>beam_size</a>))
<span class='lineno'> 498</span> 
<span class='lineno'> 499</span>     return {
<span class='lineno'> 500</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SEQ', title='str'>FINISHED_SEQ</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_seq', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_seq', title='?'>top_finished_seq</a>,
<span class='lineno'> 501</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_SCORES', title='str'>FINISHED_SCORES</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_scores', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_scores', title='?'>top_finished_scores</a>,
<span class='lineno'> 502</span>         <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys', title='<_StateKeys>'>_StateKeys</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._StateKeys.FINISHED_FLAGS', title='str'>FINISHED_FLAGS</a>: <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_flags', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch._get_new_finished_state.top_finished_flags', title='?'>top_finished_flags</a>
<span class='lineno'> 503</span>     }
<span class='lineno'> 504</span> 
<span class='lineno'> 505</span> 
<span class='lineno'> 506</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search', title='(?, ?, ?, ?, ?, ?, ?, ?, bool) -> (?, ?)'>sequence_beam_search</a>(
<span class='lineno'> 507</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', title='?'>initial_ids</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_cache', title='?'>initial_cache</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.vocab_size', title='?'>vocab_size</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.beam_size', title='?'>beam_size</a>,
<span class='lineno'> 508</span>     <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.alpha', title='?'>alpha</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.max_decode_length', title='?'>max_decode_length</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.eos_id', title='?'>eos_id</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', title='bool'>padded_decode</a>=False):
<span class='lineno'> 509</span>   &quot;&quot;&quot;Search for sequence of subtoken ids with the largest probability.
<span class='lineno'> 510</span> 
<span class='lineno'> 511</span>   Args:
<span class='lineno'> 512</span>     symbols_to_logits_fn: A function that takes in ids, index, and cache as
<span class='lineno'> 513</span>       arguments. The passed in arguments will have shape:
<span class='lineno'> 514</span>         ids -&gt; A tensor with shape [batch_size * beam_size, index].
<span class='lineno'> 515</span>         index -&gt; A scalar.
<span class='lineno'> 516</span>         cache -&gt; A nested dictionary of tensors [batch_size * beam_size, ...].
<span class='lineno'> 517</span>       The function must return a tuple of logits and new cache:
<span class='lineno'> 518</span>         logits -&gt; A tensor with shape [batch * beam_size, vocab_size].
<span class='lineno'> 519</span>         new cache -&gt; A nested dictionary with the same shape/structure as the
<span class='lineno'> 520</span>           inputted cache.
<span class='lineno'> 521</span>     initial_ids: An int32 tensor with shape [batch_size]. Starting ids for
<span class='lineno'> 522</span>       each batch item.
<span class='lineno'> 523</span>     initial_cache: A dictionary, containing starting decoder variables
<span class='lineno'> 524</span>       information.
<span class='lineno'> 525</span>     vocab_size: An integer, the size of the vocabulary, used for topk
<span class='lineno'> 526</span>       computation.
<span class='lineno'> 527</span>     beam_size: An integer, the number of beams.
<span class='lineno'> 528</span>     alpha: A float, defining the strength of length normalization.
<span class='lineno'> 529</span>     max_decode_length: An integer, the maximum length to decoded a sequence.
<span class='lineno'> 530</span>     eos_id: An integer, ID of eos token, used to determine when a sequence has
<span class='lineno'> 531</span>       finished.
<span class='lineno'> 532</span>     padded_decode: A bool, indicating if max_sequence_length padding is used
<span class='lineno'> 533</span>       for beam search.
<span class='lineno'> 534</span> 
<span class='lineno'> 535</span>   Returns:
<span class='lineno'> 536</span>     Top decoded sequences [batch_size, beam_size, max_decode_length]
<span class='lineno'> 537</span>     sequence scores [batch_size, beam_size]
<span class='lineno'> 538</span>   &quot;&quot;&quot;
<span class='lineno'> 539</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.batch_size', title='?'>batch_size</a> = (
<span class='lineno'> 540</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', title='?'>initial_ids</a>.shape.as_list()[0] if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', title='bool'>padded_decode</a> else
<span class='lineno'> 541</span>       tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', title='?'>initial_ids</a>)[0])
<span class='lineno'> 542</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.sbs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.sbs', title='SequenceBeamSearch'>sbs</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch', title='<SequenceBeamSearch>'>SequenceBeamSearch</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.symbols_to_logits_fn', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.symbols_to_logits_fn', title='?'>symbols_to_logits_fn</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.vocab_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.vocab_size', title='?'>vocab_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.batch_size', title='?'>batch_size</a>,
<span class='lineno'> 543</span>                            <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.beam_size', title='?'>beam_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.alpha', title='?'>alpha</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.max_decode_length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.max_decode_length', title='?'>max_decode_length</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.eos_id', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.eos_id', title='?'>eos_id</a>,
<span class='lineno'> 544</span>                            <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.padded_decode', title='bool'>padded_decode</a>)
<span class='lineno'> 545</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.sbs', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.sbs', title='SequenceBeamSearch'>sbs</a>.<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.SequenceBeamSearch.search', title='(SequenceBeamSearch, ?, ?) -> (?, ?)'>search</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_ids', title='?'>initial_ids</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_cache', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1.sequence_beam_search.initial_cache', title='?'>initial_cache</a>)
<span class='lineno'> 546</span> 
<span class='lineno'> 547</span> 
<span class='lineno'> 548</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits', title='? -> ? / None -> None'>_log_prob_from_logits</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', title='None'>logits</a>):
<span class='lineno'> 549</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', title='None'>logits</a> - tf.reduce_logsumexp(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._log_prob_from_logits.logits', title='None'>logits</a>, axis=2, keepdims=True)
<span class='lineno'> 550</span> 
<span class='lineno'> 551</span> 
<span class='lineno'> 552</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization', title='(?, int, ?) -> None / (?, ?, ?) -> None'>_length_normalization</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.alpha', title='?'>alpha</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.length', title='int'>length</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.dtype', title='?'>dtype</a>=tf.float32):
<span class='lineno'> 553</span>   &quot;&quot;&quot;Return length normalization factor.&quot;&quot;&quot;
<span class='lineno'> 554</span>   return tf.pow(((5. + tf.cast(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.length', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.length', title='int'>length</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.dtype', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.dtype', title='?'>dtype</a>)) / 6.), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.alpha', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._length_normalization.alpha', title='?'>alpha</a>)
<span class='lineno'> 555</span> 
<span class='lineno'> 556</span> 
<span class='lineno'> 557</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size', title='(?, ?) -> None'>_expand_to_beam_size</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', title='?'>tensor</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.beam_size', title='?'>beam_size</a>):
<span class='lineno'> 558</span>   &quot;&quot;&quot;Tiles a given tensor by beam_size.
<span class='lineno'> 559</span> 
<span class='lineno'> 560</span>   Args:
<span class='lineno'> 561</span>     tensor: tensor to tile [batch_size, ...]
<span class='lineno'> 562</span>     beam_size: How much to tile the tensor by.
<span class='lineno'> 563</span> 
<span class='lineno'> 564</span>   Returns:
<span class='lineno'> 565</span>     Tiled tensor [batch_size, beam_size, ...]
<span class='lineno'> 566</span>   &quot;&quot;&quot;
<span class='lineno'> 567</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', title='?'>tensor</a> = tf.expand_dims(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', title='?'>tensor</a>, axis=1)
<span class='lineno'> 568</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', title='[int]'>tile_dims</a> = [1] * <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', title='?'>tensor</a>.shape.ndims
<span class='lineno'> 569</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', title='[int]'>tile_dims</a>[1] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.beam_size', title='?'>beam_size</a>
<span class='lineno'> 570</span> 
<span class='lineno'> 571</span>   return tf.tile(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tensor', title='?'>tensor</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._expand_to_beam_size.tile_dims', title='[int]'>tile_dims</a>)
<span class='lineno'> 572</span> 
<span class='lineno'> 573</span> 
<span class='lineno'> 574</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', title='? -> None'>_shape_list</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', title='?'>tensor</a>):
<span class='lineno'> 575</span>   &quot;&quot;&quot;Return a list of the tensor&#39;s shape, and ensure no None values in list.&quot;&quot;&quot;
<span class='lineno'> 576</span>   # Get statically known shape (may contain None&#39;s for unknown dimensions)
<span class='lineno'> 577</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', title='?'>shape</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', title='?'>tensor</a>.get_shape().as_list()
<span class='lineno'> 578</span> 
<span class='lineno'> 579</span>   # Ensure that the shape values are not None
<span class='lineno'> 580</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.dynamic_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.dynamic_shape', title='?'>dynamic_shape</a> = tf.shape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.tensor', title='?'>tensor</a>)
<span class='lineno'> 581</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', title='int'>i</a> in range(len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', title='?'>shape</a>)):  # pylint: disable=consider-using-enumerate
<span class='lineno'> 582</span>     if <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', title='?'>shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', title='int'>i</a>] is None:
<span class='lineno'> 583</span>       <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', title='?'>shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', title='int'>i</a>] = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.dynamic_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.dynamic_shape', title='?'>dynamic_shape</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.i', title='int'>i</a>]
<span class='lineno'> 584</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list.shape', title='?'>shape</a>
<span class='lineno'> 585</span> 
<span class='lineno'> 586</span> 
<span class='lineno'> 587</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim', title='? -> None'>_get_shape_keep_last_dim</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.tensor', title='?'>tensor</a>):
<span class='lineno'> 588</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', title='? -> None'>_shape_list</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.tensor', title='?'>tensor</a>)
<span class='lineno'> 589</span> 
<span class='lineno'> 590</span>   # Only the last
<span class='lineno'> 591</span>   for <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.i', title='int'>i</a> in range(len(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a>) - 1):
<span class='lineno'> 592</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a>[<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.i', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.i', title='int'>i</a>] = None
<span class='lineno'> 593</span> 
<span class='lineno'> 594</span>   if isinstance(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a>[-1], tf.Tensor):
<span class='lineno'> 595</span>     <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a>[-1] = None
<span class='lineno'> 596</span>   return tf.TensorShape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape_keep_last_dim.shape_list', title='None'>shape_list</a>)
<span class='lineno'> 597</span> 
<span class='lineno'> 598</span> 
<span class='lineno'> 599</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape', title='? -> None'>_get_shape</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape.tensor', title='?'>tensor</a>):
<span class='lineno'> 600</span>   &quot;&quot;&quot;Return the shape of the input tensor.&quot;&quot;&quot;
<span class='lineno'> 601</span>   return tf.TensorShape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', title='? -> None'>_shape_list</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._get_shape.tensor', title='?'>tensor</a>))
<span class='lineno'> 602</span> 
<span class='lineno'> 603</span> 
<span class='lineno'> 604</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim', title='? -> None'>_flatten_beam_dim</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', title='?'>tensor</a>):
<span class='lineno'> 605</span>   &quot;&quot;&quot;Reshapes first two dimensions in to single dimension.
<span class='lineno'> 606</span> 
<span class='lineno'> 607</span>   Args:
<span class='lineno'> 608</span>     tensor: Tensor to reshape of shape [A, B, ...]
<span class='lineno'> 609</span> 
<span class='lineno'> 610</span>   Returns:
<span class='lineno'> 611</span>     Reshaped tensor of shape [A*B, ...]
<span class='lineno'> 612</span>   &quot;&quot;&quot;
<span class='lineno'> 613</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', title='None'>shape</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', title='? -> None'>_shape_list</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', title='?'>tensor</a>)
<span class='lineno'> 614</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', title='None'>shape</a>[0] *= <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', title='None'>shape</a>[1]
<span class='lineno'> 615</span>   <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', title='None'>shape</a>.pop(1)  # Remove beam dim
<span class='lineno'> 616</span>   return tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.tensor', title='?'>tensor</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._flatten_beam_dim.shape', title='None'>shape</a>)
<span class='lineno'> 617</span> 
<span class='lineno'> 618</span> 
<span class='lineno'> 619</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim', title='(?, ?, ?) -> None'>_unflatten_beam_dim</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', title='?'>tensor</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.batch_size', title='?'>batch_size</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.beam_size', title='?'>beam_size</a>):
<span class='lineno'> 620</span>   &quot;&quot;&quot;Reshapes first dimension back to [batch_size, beam_size].
<span class='lineno'> 621</span> 
<span class='lineno'> 622</span>   Args:
<span class='lineno'> 623</span>     tensor: Tensor to reshape of shape [batch_size*beam_size, ...]
<span class='lineno'> 624</span>     batch_size: Tensor, original batch size.
<span class='lineno'> 625</span>     beam_size: int, original beam size.
<span class='lineno'> 626</span> 
<span class='lineno'> 627</span>   Returns:
<span class='lineno'> 628</span>     Reshaped tensor of shape [batch_size, beam_size, ...]
<span class='lineno'> 629</span>   &quot;&quot;&quot;
<span class='lineno'> 630</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.shape', title='None'>shape</a> = <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._shape_list', title='? -> None'>_shape_list</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', title='?'>tensor</a>)
<span class='lineno'> 631</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.new_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.new_shape', title='[?]'>new_shape</a> = [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.beam_size', title='?'>beam_size</a>] + <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.shape', title='None'>shape</a>[1:]
<span class='lineno'> 632</span>   return tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.tensor', title='?'>tensor</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.new_shape', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._unflatten_beam_dim.new_shape', title='[?]'>new_shape</a>)
<span class='lineno'> 633</span> 
<span class='lineno'> 634</span> 
<span class='lineno'> 635</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', title='([?], ?, ?, ?) -> None / ([float], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([?], ?, ?, int) -> None'>_gather_beams</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.nested', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.nested', title='{[?] | [float]}'>nested</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.beam_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.beam_indices', title='?'>beam_indices</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', title='?'>batch_size</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', title='int'>new_beam_size</a>):
<span class='lineno'> 636</span>   &quot;&quot;&quot;Gather beams from nested structure of tensors.
<span class='lineno'> 637</span> 
<span class='lineno'> 638</span>   Each tensor in nested represents a batch of beams, where beam refers to a
<span class='lineno'> 639</span>   single search state (beam search involves searching through multiple states
<span class='lineno'> 640</span>   in parallel).
<span class='lineno'> 641</span> 
<span class='lineno'> 642</span>   This function is used to gather the top beams, specified by
<span class='lineno'> 643</span>   beam_indices, from the nested tensors.
<span class='lineno'> 644</span> 
<span class='lineno'> 645</span>   Args:
<span class='lineno'> 646</span>     nested: Nested structure (tensor, list, tuple or dict) containing tensors
<span class='lineno'> 647</span>       with shape [batch_size, beam_size, ...].
<span class='lineno'> 648</span>     beam_indices: int32 tensor with shape [batch_size, new_beam_size]. Each
<span class='lineno'> 649</span>      value in beam_indices must be between [0, beam_size), and are not
<span class='lineno'> 650</span>      necessarily unique.
<span class='lineno'> 651</span>     batch_size: int size of batch
<span class='lineno'> 652</span>     new_beam_size: int number of beams to be pulled from the nested tensors.
<span class='lineno'> 653</span> 
<span class='lineno'> 654</span>   Returns:
<span class='lineno'> 655</span>     Nested structure containing tensors with shape
<span class='lineno'> 656</span>       [batch_size, new_beam_size, ...]
<span class='lineno'> 657</span>   &quot;&quot;&quot;
<span class='lineno'> 658</span>   # Computes the i&#39;th coodinate that contains the batch index for gather_nd.
<span class='lineno'> 659</span>   # Batch pos is a tensor like [[0,0,0,0,],[1,1,1,1],..].
<span class='lineno'> 660</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', title='int'>batch_pos</a> = tf.range(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', title='?'>batch_size</a> * <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', title='int'>new_beam_size</a>) // <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', title='int'>new_beam_size</a>
<span class='lineno'> 661</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', title='?'>batch_pos</a> = tf.reshape(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', title='int'>batch_pos</a>, [<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.new_beam_size', title='int'>new_beam_size</a>])
<span class='lineno'> 662</span> 
<span class='lineno'> 663</span>   # Create coordinates to be passed to tf.gather_nd. Stacking creates a tensor
<span class='lineno'> 664</span>   # with shape [batch_size, beam_size, 2], where the last dimension contains
<span class='lineno'> 665</span>   # the (i, j) gathering coordinates.
<span class='lineno'> 666</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.coordinates', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.coordinates', title='?'>coordinates</a> = tf.stack([<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.batch_pos', title='?'>batch_pos</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.beam_indices', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.beam_indices', title='?'>beam_indices</a>], axis=2)
<span class='lineno'> 667</span> 
<span class='lineno'> 668</span>   return nest.map_structure(
<span class='lineno'> 669</span>       lambda <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.lambda%113.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.lambda%113.state', title='?'>state</a>: tf.gather_nd(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.lambda%113.state', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.lambda%113.state', title='?'>state</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.coordinates', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.coordinates', title='?'>coordinates</a>), <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.nested', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams.nested', title='{[?] | [float]}'>nested</a>)
<span class='lineno'> 670</span> 
<span class='lineno'> 671</span> 
<span class='lineno'> 672</span> def <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams', title='([?], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([float], float, ?, ?) -> None'>_gather_topk_beams</a>(<a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.nested', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.nested', title='{[?] | [float]}'>nested</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.score_or_log_prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.score_or_log_prob', title='float'>score_or_log_prob</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.batch_size', title='?'>batch_size</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', title='?'>beam_size</a>):
<span class='lineno'> 673</span>   &quot;&quot;&quot;Gather top beams from nested structure.&quot;&quot;&quot;
<span class='lineno'> 674</span>   <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams._', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams._', title='?'>_</a>, <a name='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.topk_indexes', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.topk_indexes', title='?'>topk_indexes</a> = tf.nn.top_k(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.score_or_log_prob', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.score_or_log_prob', title='float'>score_or_log_prob</a>, k=<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', title='?'>beam_size</a>)
<span class='lineno'> 675</span>   return <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_beams', title='([?], ?, ?, ?) -> None / ([float], ?, ?, ?) -> None / (?, ?, ?, ?) -> None / ([?], ?, ?, int) -> None'>_gather_beams</a>(<a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.nested', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.nested', title='{[?] | [float]}'>nested</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.topk_indexes', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.topk_indexes', title='?'>topk_indexes</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.batch_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.batch_size', title='?'>batch_size</a>, <a href='#.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', xid ='.home.xxm.Desktop.EMSE.dataset.models.official.nlp.transformer.beam_search_v1._gather_topk_beams.beam_size', title='?'>beam_size</a>)
</pre></td></tr></table></body></html>